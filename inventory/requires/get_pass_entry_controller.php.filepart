<?
header('Content-type:text/html; charset=utf-8');
session_start();
include('../../includes/common.php');

$user_id = $_SESSION['logic_erp']["user_id"];
if( $_SESSION['logic_erp']['user_id'] == "" ) { header("location:login.php"); die; }
$permission=$_SESSION['page_permission'];

$data=$_REQUEST['data'];
$action=$_REQUEST['action'];

if ($action=="load_drop_down_buyer2")
{
	$data=explode("_",$data);
	if($data[1]==1)
	{
		echo create_drop_down( "cbo_party_name", 130, "select comp.id, comp.company_name from lib_company comp where comp.status_active=1 and comp.is_deleted=0 $company_cond order by comp.company_name","id,company_name", 1, "-- select Company --", "", "");
	}
	else
	{
		echo create_drop_down( "cbo_party_name", 130, "select buy.id,buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company='$data[0]' $buyer_cond  and buy.id in (select  buyer_id from  lib_buyer_party_type where party_type in (2,3)) order by buyer_name","id,buyer_name", 1, "-- select Party --","", "" );
	}	
	exit();	 
} 

if($action=="sent_to_popup")
{
  	echo load_html_head_contents("Sent To Info","../../", 1, 1, '','1','');
	extract($_REQUEST);
	//echo $txt_sent_to;die;
    ?>
	<script>
	
	function js_set_value(str)
	{
		var splitData = str.split("_");
		//alert (splitData[1]);
		$("#hidden_sent_to_name").val(splitData[1]); 
		$("#hidden_sent_to_id").val(splitData[0]); 
		parent.emailwindow.hide();
	}
    </script>

	</head>
	<body>
	<div align="center">
	<fieldset style="width:370px;margin-left:10px">
    	<input type="hidden" name="hidden_sent_to_id" id="hidden_sent_to_id" class="text_boxes" value="">
        <input type="hidden" name="hidden_sent_to_name" id="hidden_sent_to_name" class="text_boxes" value="">
        <form name="searchbuyerfrm_1"  id="searchbuyerfrm_1" autocomplete="off">
            <table cellspacing="0" cellpadding="0" border="1" rules="all" width="350" class="rpt_table" >
                <thead>
                    <th width="50">SL</th>
                    <th>Party Name</th>
                </thead>
            </table>
            <div style="width:350px; overflow-y:scroll; max-height:280px;" id="buyer_list_view" align="center">
                <table cellspacing="0" cellpadding="0" border="1" rules="all" width="332" class="rpt_table" id="tbl_list_search" >
                <?
				if($cbo_basis==50 || $cbo_basis==8)
				{
					$sql_supplier=sql_select("select id,buyer_name as supplier_name from lib_buyer where status_active =1 and is_deleted=0 order by supplier_name");
				}
				else 
				{
					$sql_supplier=sql_select("select id,supplier_name from lib_supplier where status_active =1 and is_deleted=0 order by supplier_name");
				}
			 	foreach($sql_supplier as $row)
            	{
					$supplier_arr[$row[csf('id')]]=$row[csf('supplier_name')];
				}
                 $i=1; $supplier_row_id=""; 
				$hidden_supplier_id=explode(",",$txt_sent_to);
                foreach($supplier_arr as $id=>$name)
                {
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";					 
					if(in_array($id,$txt_sent_to)) 
					{ 
						if($supplier_row_id=="") $supplier_row_id=$i; else $supplier_row_id.=",".$i;
					}
					if($id==$hidden_supplier_id[0])
					{
						?>
						<tr bgcolor="<? echo "yellow"; ?>" style="text-decoration:none; cursor:pointer" id="search<? echo $i;?>" onClick="js_set_value('<? echo $id.'_'.$name;?>')"> 
							<td width="50" align="center"><?php echo "$i"; ?>
								<input type="hidden" name="txt_individual_id" id="txt_individual_id<?php echo $i ?>" value="<? echo $id; ?>"/>	
								<input type="hidden" name="txt_individual" id="txt_individual<?php echo $i ?>" value="<? echo $name; ?>"/>
                            	<input type="hidden" name="txt_mandatory" id="txt_mandatory<?php echo $i ?>" value="<? echo $mandatory; ?>"/>
							</td>	
							<td><p><? echo $name; ?></p></td>
						</tr>
						<?
					}
					else
					{
						?>
						<tr bgcolor="<? echo $bgcolor; ?>" style="text-decoration:none; cursor:pointer" id="search<? echo $i;?>" onClick="js_set_value('<? echo $id.'_'.$name;?>')"> 
							<td width="50" align="center"><?php echo "$i"; ?>
								<input type="hidden" name="txt_individual_id" id="txt_individual_id<?php echo $i ?>" value="<? echo $id; ?>"/>	
								<input type="hidden" name="txt_individual" id="txt_individual<?php echo $i ?>" value="<? echo $name; ?>"/>
                            	<input type="hidden" name="txt_mandatory" id="txt_mandatory<?php echo $i ?>" value="<? echo $mandatory; ?>"/>
							</td>	
							<td><p><? echo $name; ?></p></td>
						</tr>
						<?
					}
					$i++;
                }
                //echo $supplier_row_id;
                ?>
                </table>
            </div>
            <table width="350" cellspacing="0" cellpadding="0" style="border:none" align="center">
                <tr>
                    <td align="center" height="30" valign="bottom">
                        <div style="width:100%"> 
                            <div style="width:50%; float:left" align="left">
                                <input type="hidden" name="check_all" id="check_all" onClick="check_all_data()" /> Check / Uncheck All
                            </div>
                            <div style="width:50%; float:left" align="left">
                                <input type="button" name="close" onClick="parent.emailwindow.hide();" class="formbutton" value="Close" style="width:100px" />
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </form>
    </fieldset>
	</div>    
	</body>           
	<script src="../../includes/functions_bottom.js" type="text/javascript"></script>
	<script>
		setFilterGrid('tbl_list_search',-1);
		set_all();
	</script>
	</html>
	<?
	exit();
}

if($action=="print_to_html_report_scandex")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//print_r ($data); die;
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[2];
	$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");
	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	
	$sql="select id, sys_number, company_id, basis, department_id, issue_purpose, within_group, section, attention, sent_by, carried_by, sent_to, vhicle_number, out_date, challan_no, time_hour, time_minute, returnable, delivery_as, est_return_date, location_id, location_name, com_location_id, remarks, mobile_no, returnable_gate_pass_reff, delivery_company from inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 "; 
	//echo $sql;
	$dataArray=sql_select($sql);

	$gate_id=$dataArray[0][csf('id')];
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
 	$sent_to=$dataArray[0][csf('sent_to')];
	$shipmode_cartoon=sql_select("select  b.total_carton_qnty, b.shiping_mode, b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no'") ;

	$shipmodes=sql_select("select a.lock_no, b.shiping_mode, b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no' and (b.shiping_mode is not null or b.shiping_mode!=0) ") ;
	/*echo "<pre>";
	print_r($shipmodes);die;*/

	if($basis==5 or $basis==1 or $basis==7 or $basis==38)
    {
		$sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags from  inv_gate_pass_dtls a where a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 order by a.uom,a.id ";

		$sql_sel=sql_select($sql_dtls);
	}
	else
	{
		$sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags,b.issue_id from  inv_gate_pass_dtls a,inv_gate_pass_mst b  where b.id=a.mst_id and a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 ";
		//echo $sql_dtls;
		
		$sql_result=sql_select($sql_dtls);
		
	}
	$buyer_order_id=array();
	foreach ($sql_result as $value)
	{

		if($buyer_order_id[$value[csf("buyer_order_id")]] != $value[csf("buyer_order_id")])
		{	
			$buyer_order_id[$value[csf("buyer_order_id")]] = $value[csf("buyer_order_id")];
		}
	}
	$buyer_order_ids= implode(",", $buyer_order_id);
 
	if($basis==1)
	{ 
		if($within_group==1)
		{
			//$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
		else
		{
			//$send_to_company=$dataArray[0][csf('sent_to')];		
		}
	}
	else if($basis==8 || $basis==9 || $basis==27)
	{
		//$send_to_company=$dataArray[0][csf('sent_to')];	
		$sql_no_of_roll = "select a.id,b.carton_roll as no_roll,b.reject_qty,b.total_carton_qnty,b.id as dtls_id from subcon_delivery_mst a ,subcon_delivery_dtls b where a.id=b.mst_id  and a.delivery_no='$challan_no' and a.status_active=1 and a.is_deleted=0  and a.process_id in(2,4,3) and b.order_id in( $buyer_order_ids)";
		//echo $sql_no_of_roll;//die;
		$no_of_rolls = sql_select($sql_no_of_roll);
				
	}
	else if($basis==17)
	{
		$no_of_rolls=sql_select("select b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty as cons_quantity,
		b.yarn_lot,b.rate as cons_rate,b.transfer_value as cons_amount,b.brand_id,c.product_name_details,d.no_of_bags,b.roll as no_roll from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c,inv_transaction d 
		where a.id=b.mst_id and c.id=b.from_prod_id and b.from_prod_id=d.prod_id and a.transfer_system_id='$challan_no' and b.item_category=13 
		and b.status_active = '1' and b.is_deleted = '0' and d.no_of_bags is not NULL
		group by  b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty,
		b.yarn_lot,b.rate,b.transfer_value ,b.brand_id,c.product_name_details,d.no_of_bags ,b.roll ");
	}
	else if($basis==11)
	{
		$no_of_rolls=sql_select("select a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity,b.batch_id,roll as no_roll
				from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
				where a.sys_number='$challan_no' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form=54 and b.entry_form=54");
	}
	else if($basis==12)
	{
		//$send_to_company=$supplier_name_library[$dataArray[0][csf('sent_to')]];
	}
	else if($basis==10)
	{
		$no_of_rolls=sql_select("select a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity,b.roll as no_roll
				from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
				where a.sys_number='$challan_no' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.entry_form=53 and b.entry_form=53");
	}
	else if($basis==15) //Finish Fabric Recv Return
	{
		//echo $mst_challan;
		
		 $no_of_rolls =sql_select("select a.id as issue_id, a.item_category, a.received_id, a.received_mrr_no, b.id as trans_id, b.cons_quantity as cons_quantity,b.cons_uom, b.cons_rate, b.cons_amount, c.product_name_details, c.id as prod_id  ,b.no_of_roll as no_roll 
			from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id
			where a.id=b.mst_id and b.item_category=2 and b.transaction_type=3 and  a.issue_number='$challan_no' order by b.id");
		   
	}
	else if($basis==4)
	{
		$no_of_rolls = sql_select("select a.id,a.transaction_type,a.item_category,b.product_name_details,a.cons_rate,a.cons_quantity,a.cons_uom ,a.cons_amount,a.remarks,b.unit_of_measure ,c.no_of_roll as no_roll from inv_transaction a, product_details_master b,inv_finish_fabric_issue_dtls c ,inv_issue_master d,inv_gate_pass_mst e  where a.prod_id=b.id and d.id=a.mst_id  and d.id=c.mst_id and a.id=c.trans_id and d.id=e.issue_id and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.issue_number='$challan_no'"); 
 	}
 	else if($basis==22)
	{
	$no_of_rolls = sql_select("select b.roll_no as no_roll from inv_receive_mas_batchroll a,pro_grey_batch_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.recv_number='$challan_no'"); 

 	}
	else
	{
			
			//echo $within_group.'=='.$basis;
			/*if($basis==2 || $basis==3 || $basis==4 || $basis==5 || $basis==6 || $basis==7  ||  $basis==10 || $basis==13 ||  $basis==14 ||  $basis==11 ||  $basis==15)
			{
				if($within_group==2)
				{
					$send_to_company=$dataArray[0][csf('sent_to')];
				}
				else
				{
					$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
				}
			}
			else
			{
					$send_to_company=$dataArray[0][csf('sent_to')];	
			}*/
		
		
		
		//$send_to_company=$dataArray[0][csf('sent_to')];
	}
	
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	if($show_item==1)
	{
		$width=1150;
		//$colspan=5;
	}
	else
	{
		$width=1150;
		//$colspan=5;
		$colspan2=2;
	}
	$com_dtls = fnc_company_location_address($company, $location, 2);
	?>
	<style type="text/css">
		@media print{
			#signature_bottom{ 
				position:fixed; 
				bottom:-30px;
			}
			tr.page_break { 
				/* display: block; */ 
				page-break-before: always; }
			/*#table_row{
				position: relative;
				bottom: 0;
				height: 1180px!important;
				  overflow:hidden;
			}*/
		}

		@media screen{
		
		}
		
	</style>
	<div style="width:<? echo $width;?>px;" align="center">
    <table width="<? echo $width;?>" cellspacing="0" align="center" border="0">
        <tr>
          <tr>
            <td  align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="70" width="150"></td>
            <td colspan="7" align="left"  style="font-size:xx-large;"><strong style="margin-left:100px" >From Company : Scandex Textile Industries Ltd.<? //echo $com_dtls[0]; ?></strong>
             <div style="float:right;width:34%; text-align:right">
               	&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
            </div>
            </td>
           
           
           
        </tr>
        <tr class="form_caption">
            <td colspan="8" align="center">
				<?
				echo $com_dtls[1];
				//$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
					//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
					/*foreach ($nameArray as $result)
					{ 
						echo $result[csf('plot_no')]; 
						echo $result[csf('level_no')];
						echo $result[csf('road_no')];
						echo $result[csf('block_no')];
						echo $result[csf('city')];
						echo $result[csf('zip_code')];
						echo $result[csf('province')].',';
						echo $country_arr[$result[csf('country_id')]]; 
						echo $result[csf('email')]; 
						echo $result[csf('website')];
					}*/
                ?> 
                <div style="width:34%; text-align:center">From Location : Uttar Gazaria, Kaliakair, Gazipur
               	&nbsp;<? //if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
            </div>
            </td>
        </tr>
        <tr>
        	<td style="display:none" colspan="8" align="center"><strong> <? //if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
        </tr>
        <tr>
            <td colspan="8" align="center" style="font-size:x-large"><strong><u>Delivery Challan</u></strong></td>
        </tr>
        <tr>
            <td width="160"><strong>System ID</strong></td>
			<td width="175px" style="font-size:20px">: <b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
            <td width="120"><strong>Basis</strong></td>
			<td width="175px" >: <? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
            <td><strong>Department</strong></td> <td width="175px">: <? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
        </tr>
		<tr>
			<td width="125"><strong>Challan/System No</strong></td>
			<td colspan="5">: <? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
		</tr>
         <tr>
            <td><strong>Attention</strong></td><td width="175px" >: <? echo $dataArray[0][csf('attention')]; ?></td>
            
            <td><strong>Section</strong></td><td width="175px" >: <? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
            <td><strong>Sent By</strong></td> <td width="175px">: <? echo $dataArray[0][csf('sent_by')]; ?></td>
        </tr>
        <tr>
            <td><strong>Sent To</strong></td><td width="175px" style="font-size:18px">: <b><? echo $send_to_company; ?></b></td>
            <td><strong>Out-Time</strong></td><td width="85px" >: <? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
            <td><strong>Out Date</strong></td><td width="175px" colspan="2">: <? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
        </tr>
        <tr>
        	<td><strong>Purpose</strong></td><td>: <? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
            
            <td><strong>Returnable </strong></td><td width="175px">: <? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
            <td><strong>Delivery As</strong></td><td width="175px">: <? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
        </tr>
         <tr>
            <td><strong>Est. Return Date</strong></td><td width="175px">: <? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
            <td><strong>Carried By</strong></td><td>: <? echo $dataArray[0][csf('carried_by')]; ?></td>
            <td><strong>Vehicle Number</strong></td><td>: <? echo $dataArray[0][csf('vhicle_number')]; ?></td>
            
        </tr>
        <tr>
			<td><strong>Against Returnable Gate Pass</strong></td>
			<td>: <?  echo $dataArray[0][csf("returnable_gate_pass_reff")]; ?></td>
           	<td><strong>To Location</strong></td><td>: <?  if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
           	<td><strong>Bar Code</strong></td><td  colspan="2" id="barcode_img_id"></td> 
        </tr>
        <? if ($basis==12)
        {
        	?>
        	<tr>
				<td> <strong> Shipping Mode </strong></td>
				<td align="left"> <?  echo $shipment_mode[$shipmodes[0][csf("shiping_mode")]]; ?> </td>
				<td> <strong> Lock number </strong></td>
				<td colspan="4" align="left"> <?  echo $shipmodes[0][csf("lock_no")]; ?> </td>
			</tr>
	
       <? }?>
       <tr>
         <td><strong>Delivery Company</strong></td>
          	<td>: <?  echo $dataArray[0][csf("delivery_company")]; ?> </td>
          <td><strong>Mobile No</strong></td>
          <td align="left"> <?  echo $dataArray[0][csf("mobile_no")]; ?> </td>
		  <td><strong>Remarks</strong></td>
			<td colspan="3" align="left"> <?  echo $dataArray[0][csf("remarks")]; ?> </td>
        </tr>

    </table>
    <br>
    <? if($basis==5 or $basis==1 or $basis==7 or $basis==38)
    {
    	?>
	    <table align="center" cellspacing="0" width="<? echo $width;?>"  border="1" rules="all" class="rpt_table" >
	        <thead bgcolor="#dddddd" align="center">
	            <th width="30">SL</th>
	            <th width="100" align="center">Item Category</th>
	            <th width="100" align="center">Sample</th>
	            <th width="220" align="center">Item Description</th>
	            <th width="50" align="center">UOM</th>
	            <th width="80" align="center">Quantity</th>
	            <? if($basis==12)
	            {
					?>
					<th width="60" align="center">No Of Cartoon </th>
					<?
	            }
	            else
	            {
					?>
					<th width="60" align="center">No Of Roll </th>
					<?
	             }
	             ?>
	            <th width="60" align="center">No Of Bag/Roll </th>
	            <?
	            if($show_item==1)
				{
					?>
					<th width="60" align="center">Rate</th> 
					<th width="90" align="center">Amount </th>
					<?
				}
				?>
	            <th width="150" align="center">Buyer Order </th>
	            <th align="center">Remarks</th>
	        </thead>
		<?
	    $i=1;
		$gate_id=$dataArray[0][csf('id')];
		$sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags from  inv_gate_pass_dtls a where a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 order by a.uom,a.id ";

		$sql_sel=sql_select($sql_dtls);
		foreach($sql_sel as $values)
		{
			$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['qty']+=$values[csf("quantity")];

			$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['item_category_id']=$values[csf("item_category_id")];

			$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['sample_id']=$values[csf("sample_id")];

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['item_description']=$values[csf("item_description")];


				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['quantity']+=$values[csf("quantity")];

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['amount']+=$values[csf("amount")];

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['rate']+=$values[csf("rate")];

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['buyer_order_id'].=$values[csf("buyer_order_id")].",";

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['buyer_order'].=$values[csf("buyer_order")].",";

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['remarks']=$values[csf("remarks")];

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['no_of_bags']+=$values[csf("no_of_bags")];
		}
	           //echo "<pre>";print_r($general_item_arr);die;
	            $row_span_arr=array();

	            foreach($general_item_arr as $key=>$value)
	            {

	                $row_span=0;
	                foreach($value as $item_description_id=>$row)
	                {
	                    $row_span++;
	                }

	                $row_span_arr[$key]=$row_span;
	            }


	             $i=1;
	            foreach($general_item_arr as $key=>$value)
	            {

	                $j=0;
	                foreach($value as $item_description_id=>$row)
	                {
	                  
						if($i==27){ $pagebreak = " class='page_break'";} else{ $pagebreak = "";}
	                ?>

	                 <tr <?= $pagebreak;?>>
						<td width="40"   align="center"><? echo $i;$i++; ?></td>
						<td><?  echo $item_category[$row["item_category_id"]]; ?></td>
						<td><?  echo $sample_library_arr[$row["sample_id"]]; ?></td>
						<td><?  echo $row['item_description']; ?></td>
						<? if($j==0)
						{
				
						?>
						<td width="40" rowspan="<? echo $row_span_arr[$key]?>" align="center"><? echo $unit_of_measurement[$key]; ?></td>
						<?
						}
						?>
						<td align="right"><? echo number_format($row['quantity'],2,'.',''); ?></td>  
						<td align="right">&nbsp;</td>  

	             	<td align="right"><? echo number_format($row['no_of_bags'],2,'.',''); ?></td>
	                 <?
					if($show_item==1)
					{
						?> 
	                    <td align="right"><? $rate=$row['amount']/$row['quantity']; echo number_format($rate,2,'.',''); ?></td>
	                    <td align="right"><? echo number_format($row['amount'],2,'.',''); ?></td>
	                    <?
					}
					?>
	                <td style="word-break:break-all;"><? echo implode(",",array_unique(explode(",",chop($row['buyer_order'],",")))); ?></td>
	                <td><? echo $row['remarks']; ?></td>


				<?
	             
	             $j++;
	             $total+=$row[("qty")];
	             $gr_total+=$row[("qty")];
	             $tot_qty +=$row['quantity'];
	             $tot_bags +=$row['no_of_bags'];
	             $subtotAmount +=$row['amount'];
	             $totAmount +=$row['amount'];
	             }
	             ?>
	             <tr>
	                 <td colspan="5" align="right"><b>Sub Total</b></td>
	                 <td align="right">  <b><? echo number_format($total,2); $total=0; ?></b></td>
	                 <?
					if($show_item==1)
					{
					?>
		                 <td colspan="3"></td>
		                 <td align="right"><b><? echo number_format($subtotAmount,2); $subtotAmount=0; ?></b></td>
		             <?
		             }
		             ?>
	             </tr>
	              <?
	         }
	         ?>

	         <tfoot bgcolor="#CCCCCC">
	        <tr>
	        <td colspan="5" align="right"> <b> Total</b></td>
	        <td align="right"><b><? echo number_format($tot_qty,2);?></b></td> 
	         <?
			if($show_item==1)
			{
			?>      
	        <td align="right"><b><? echo $tot_roll;?></b></td>    
	        <?
			}
			else
			{  
				echo "<td></td>" ;
			}
			?>

			<td align="right"><b><? echo number_format($tot_bags,2);?></b></td>
	          <?
			if($show_item==1)
			{
			?>      
	        <td></td>    
	        <td align="right"><b><? echo number_format($totAmount,2); ?></b></td>    
	        <?
			}
			
			?>
	        <td align="right"> </td>
	        <td colspan="<? echo 4+$colspan2;?>"></td>
	        </tr>
		</tfoot>
	              
	           
	        <?
	            
		//echo $sql_dtls;
		$uom_check=array();
		$sql_result=sql_select($sql_dtls);
		$tot_qty=0; $tot_amount=0; $tot_amount=0;
		$p=0;
		
		//$tot_check=array();
		if(count($uom_check)==1)
		{
		?>
	   
	    <?
		}
		 $width_sign=$width.'px';
		?>
    	</table>
    	<?
    }
    else 
    {
    	?>
	    <table align="center" cellspacing="0" width="<? echo $width;?>"  border="1" rules="all" class="rpt_table" >
	        <thead bgcolor="#dddddd" align="center">
	            <th width="30">SL</th>
	            <th width="100" align="center">Item Category</th>
	            <th width="100" align="center">Sample</th>
	            <th width="220" align="center">Item Description</th>
	            <th width="50" align="center">UOM</th>
	            <th width="80" align="center">Quantity</th>
	            
	            <? if($basis==9 || $basis==8)
	            {?>
	             <th width="100" align="center">Reject Qty </th>
		
	            <?
	            }
	            ?>
	            
	            <? if($basis==12 || $basis==27)
	            {?>
	             <th width="100" align="center">Total Carton Qty </th>
		
	            <?
	            }
	            else
	            {
	            ?>
	             <th width="100" align="center">No Of Roll </th>
	             <?
	             }
	             if($basis!=12 && $basis!=27)
	            {?>

	            	<th width="80" align="center">No Of Bag/Roll </th>
	            <?
 				}
	             ?>

	            <?
	            if($show_item==1)
				{
				?>
	          	<th width="50" align="center">Rate</th> 
	            <th width="80" align="center">Amount </th>
	            <?
				}
				?>
	            <th width="80" align="center">Buyer Order </th>
	            <th align="center">Remarks</th>
	        </thead>
		<?
	    $i=1;
		$gate_id=$dataArray[0][csf('id')];
		$sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags,b.issue_id from  inv_gate_pass_dtls a,inv_gate_pass_mst b  where b.id=a.mst_id and a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 ";
		//echo $sql_dtls;
		$uom_check=array();
		$sql_result=sql_select($sql_dtls);
		$tot_qty=0; $tot_amount=0; $tot_amount=0; $noOfCarton=0;
		$tot_roll=0;
		$p=0;
		foreach($sql_result as $row)
		{
			$gatepass_data_arr[$row[csf('issue_id')]]['buyer_order']=$row[csf('buyer_order')];
			$gatepass_data_arr[$row[csf('issue_id')]]['remarks']=$row[csf('remarks')];
			if ($i%2==0)  
				$bgcolor="#E9F3FF";
			else
				$bgcolor="#FFFFFF";
				
				$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
				$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
				//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
				$uom_check[$row[csf('uom')]]=$row[csf('uom')];
				if($i==21){ $pagebreak = " class='page_break'";} else{ $pagebreak = "";}
				?>
				<tr bgcolor="<? echo $bgcolor; ?>" <?= $pagebreak; ?>>
	                <td><? echo $i; ?></td>
	                <td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
	                <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
	                <td><?  echo $row[csf('item_description')]; ?></td>
	                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
	                <td align="right"><? echo number_format($row[csf('quantity')],2,'.',''); ?></td> 
	                 <?  if($basis==9 || $basis==8)             
		                {
		                	?>
		                	<td align="right"><? echo $no_of_rolls[$p][csf("reject_qty")]; ?></td>
		                	<?
		                }
					?>
	                
	                  
	                <?  if($basis==12)             
		                {
		                	?>
		                	<td align="right"><? echo $shipmode_cartoon[$p][csf("total_carton_qnty")]; ?></td>
		                	<?
		                }
		                else if ($basis==27) {
		                	?>
		                	<td align="right"><? echo $no_of_rolls[$p][csf("total_carton_qnty")]; ?></td>
		                	<?
		                }
		                else
		                {
			                ?>
			                <td align="right"><? if($basis==3){echo $no_of_rolls[$p][csf("no_roll")] =1; } else{echo $no_of_rolls[$p][csf("no_roll")] ;} ?></td>  
			                <?
		                }
	               
	                 if($basis!=12 && $basis!=27)
	           		 {?>
	                	<td align="right"><? echo number_format($row[csf('no_of_bags')],2,'.',''); ?></td>
	                <?
		            }
		            ?>
	                <?
					if($show_item==1)
					{
					?>
	                <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
	                <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
	                <?
					}
					?>
	                <td><? echo $row[csf('buyer_order')]; ?></td>
	                <td><? echo $row[csf('remarks')]; ?></td>
				</tr>
			<?php
			$tot_roll +=$no_of_rolls[$p][csf("no_roll")];
			if ($basis==12) {
				$noOfCarton+=$shipmode_cartoon[$p][csf("total_carton_qnty")];
			}
			else if ($basis==27) {
				$noOfCarton+=$no_of_rolls[$p][csf("total_carton_qnty")];
			}
			else
			{
				$noOfCarton+=$shipmode_cartoon[$p][csf("total_carton_qnty")];
			}
			$noOfReject+=$no_of_rolls[$p][csf("reject_qty")];
	    	$i++;
	    	$p++;
			
			$tot_qty+=$row[csf('quantity')];		
			$tot_amount+=$row[csf('amount')];
			$tot_bags+=$row[csf('no_of_bags')];
			$subtotAmount +=$row['amount'];
	        $totAmount +=$row['amount'];
	    }
	    if($basis==8)
    	{ 
			if($issueID !='')
    		{
    			$sql_result_2=sql_select("select a.id,b.delivery_qty as cons_quantity,b.item_id,b.order_id,b.batch_id,b.reject_qty,b.carton_roll,b.mst_id from subcon_delivery_mst a ,subcon_delivery_dtls b where a.id=b.mst_id and b.mst_id=$issueID and a.status_active=1 and a.is_deleted=0 and a.process_id in(2,4) and b.delivery_qty<=0 ");	
    		}
			
			$lib_item_arr=return_library_array( "select id,const_comp from lib_subcon_charge",'id','const_comp');
			foreach($sql_result_2 as $row)
			{
				if($i==27){ $pagebreak = " class='page_break'";} else{ $pagebreak = "";}
				?>
				<tr bgcolor="<? echo $bgcolor; ?>" <?= $pagebreak; ?>>
	                <td><? echo $i; ?></td>
	                <td><?  echo $item_category[13]; ?></td>
	                <td><?  //echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
	                <td><?  echo $lib_item_arr[$row[csf('item_id')]]; ?></td>
	                <td align="center"><? echo $unit_of_measurement[12]; ?></td>
	                <td align="right"><? echo number_format($row[csf('cons_quantity')],2,'.',''); ?></td> 
	                <?
					if($basis==9 || $basis==8)             
					{
						?>
						<td align="right"><? echo $row[csf("reject_qty")]; ?></td>
						<?
					}
					if($basis==12)             
					{
						?>
						<td align="right"><? echo $shipmode_cartoon[$p][csf("total_carton_qnty")]; ?></td>
						<?
					}
					else
					{
						?>
						<td align="right"><? if($basis==3){echo $no_of_rolls[$p][csf("no_roll")] =1; } else{echo $row[csf("carton_roll")] ;} ?></td>  
						<?
					}
	                ?>
	                <td align="right"><? echo number_format($row[csf('no_of_bags')],2,'.',''); ?></td>
	                <?
					if($show_item==1)
					{
					?>
	                <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
	                <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
	                <?
					}
					?>
	                <td><? echo $gatepass_data_arr[$row[csf('mst_id')]]['buyer_order']; ?></td>
	                <td><? echo $gatepass_data_arr[$row[csf('mst_id')]]['remarks']; ?></td>
				</tr>
				<?		
			}
			$tot_roll +=$row[csf("carton_roll")];
			$noOfCarton+=$shipmode_cartoon[$p][csf("total_carton_qnty")];
			$noOfReject+=$row[csf("reject_qty")];
			$subtotAmount +=$row['amount'];
	        $totAmount +=$row['amount'];
		}
		//$tot_check=array();
		if(count($uom_check)==1)
		{
		?>
	    <tfoot bgcolor="#CCCCCC">
	        <tr>
	        <td colspan="5" align="right"> <b> Total</b></td>
	        <td align="right"><b><? echo number_format($tot_qty,2);?></b></td>
	        <?
	        if($basis==9 || $basis==8)
		  	{
				?>
					<td align="right"><b><? echo $noOfReject;?></b></td> 
	            <?   
			}
	        ?>
	        
	         <?
			if($show_item==1)
			{
				if($basis==12 || $basis==27)
				{
				?>
					<td align="right"><b><? echo $noOfCarton;?></b></td> 
	            <?   
				}
				else
				{
				?>
					 <td align="right"><b><? echo $tot_roll;?></b></td> 
	            <?
				} 
			?>         
	        <?
			}
			else
			{
				if($basis==12 || $basis==27)
				{
				?>
					<td align="right"><b><? echo $noOfCarton;?></b></td> 
	        	<?
				}
				else
				{
					?>
                    <!--25.02.2020-->
					<!--<td></td>-->
                    <td align="right"><b><?php echo $tot_roll; ?></b></td>
                    <?php 
				}
			}
			
			if($basis!=12 && $basis!=27)
	        {
				?>
				<td align="right"><b><? echo number_format($tot_bags,2);?></b></td>
			<?
			}

			if($show_item==1)
			{
			?>
	        <td align="right"> </td>
	        <td align="right"><strong><? echo number_format($tot_amount,2);?></strong></td>
			<?
			}
			?>
	        <td colspan="<? echo 3+$colspan2;?>"></td>
	        </tr>
		</tfoot>
	    <?
		}
		 $width_sign=$width.'px';
		?>
	    </table>
    	<? 

	}
		if($show_item==1)
		{
		?>
			<!-- <span><h4 align="center">In Words : &nbsp;<? //echo number_to_words($totAmount,"");?></h4></span> -->
		<?
		}
		
		
    ?>
	<? echo signature_table(114, $data[0], $width_sign,$template_id); ?>
	</div>
	<div id="signature_bottom">
		
	</div> 
 	<script type="text/javascript" src="../../js/jquery.js"></script>
      <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
    <script>

	function generateBarcode( valuess ){
		   
			var value = valuess;//$("#barcodeValue").val();
		 // alert(value)
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='bmp';// $("input[name=renderer]:checked").val();
			 
			var settings = {
			  output:renderer,
			  bgColor: '#FFFFFF',
			  color: '#000000',
			  barWidth: 1,
			  barHeight: 30,
			  moduleSize:5,
			  posX: 10,
			  posY: 20,
			  addQuietZone: 1
			};
			$("#barcode_img_id").html('11');
			 value = {code:value, rect: false};
			
			$("#barcode_img_id").show().barcode(value, btype, settings);
		} 
	 generateBarcode('<? echo $data[1]; ?>');
	 </script>
	<?
	exit();
}

if ($action=="get_out_entry_print28")
{
	
	extract($_REQUEST);
	$data=explode('*',$data);
	//echo "<pre>";
	//print_r($data);
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[5];
	
	$print_mercer = str_replace("'","",$print_mercer);
	//echo $company.'='.$location.'='.$print_mercer;die;
	
	//echo $print_mercer;//die; 
	$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$brand_arr=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
	$designation_a=return_library_array("select id,custom_designation from lib_designation","id","custom_designation");

	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );	
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,vhicle_number,com_location_id,mobile_no,remarks,inserted_by,issue_id,driver_name from inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 ";
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	$inserted_by=$dataArray[0][csf('inserted_by')];
	$issue_id=$dataArray[0][csf('issue_id')];
	$bags_cone_arr=array();
	$prod_id=array();
	$brand_lot_arr=array();
	
	//echo $basis; die;
	
	if($basis==2)
	{
		$sqls="SELECT a.id,a.prod_id,a.no_of_bags,a.cone_per_bag from inv_transaction a,inv_gate_pass_mst b,inv_gate_pass_dtls c where a.id=c.challan_no and b.id=c.mst_id  and b.sys_number='$data[1]' group by a.id,a.prod_id,a.no_of_bags,a.cone_per_bag ";
		foreach(sql_select($sqls) as $val)
		{
			$bags_cone_arr[$val[csf("id")]]["bags"]=$val[csf("no_of_bags")];
			$bags_cone_arr[$val[csf("id")]]["cone"]=$val[csf("cone_per_bag")];
			$bags_cone_arr[$val[csf("id")]]["prod_id"]=$val[csf("prod_id")];
			$prod_id[$val[csf("prod_id")]]=$val[csf("prod_id")];
		}
		$prod_ids=0;
		if(count($prod_id)>0)
		{
			$prod_ids=implode(",", $prod_id);
		}

		$sql2="SELECT  id,brand,lot  from product_details_master where  id in($prod_ids) ";
		foreach(sql_select($sql2) as $val)
		{
			$brand_lot_arr[$val[csf("id")]]["brand"]=$brand_arr[$val[csf("brand")]];
			$brand_lot_arr[$val[csf("id")]]["lot"]=$val[csf("lot")];
			 
		}

	}	
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	/*$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}*/
	$order_array=array();
	
	if($basis==51)
	{
		$order_sql="select a.subcon_job, a.within_group, a.party_id as buyer_name, b.id, b.order_no, b.order_quantity, b.buyer_po_id,b.buyer_po_no, b.buyer_style_ref as style_ref_no, 
        b.buyer_buyer from subcon_ord_mst a, subcon_ord_dtls b where a.subcon_job=b.job_no_mst and a.entry_form=295 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	}
	elseif($basis==9)
	{
		$order_sql="select a.subcon_job, a.within_group, a.party_id as buyer_name, b.id, b.order_no, b.order_quantity, b.buyer_po_id,b.buyer_po_no, b.CUST_STYLE_REF as style_ref_no, 
       b.buyer_buyer from subcon_ord_mst a, subcon_ord_dtls b where a.subcon_job=b.job_no_mst and a.entry_form=238 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	}
	else
	{
		$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	}
	// echo $order_sql;
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	//print_r($order_array); 186
	$copy_no=array(1,2,3); //for Dynamic Copy here 
	foreach($copy_no as $cid)
	{
		if($show_item==1)
		{
			$width=1150;
			$colspan=5;
		}
		else
		{
			$width=1150;
			$colspan=5;
			$colspan2=2;
		}
	$com_dtls = fnc_company_location_address($company, $location, 2);
	?>
	<div style="width:<? echo $width;?>px;" align="center">
	    <table width="<? echo $width;?>px" cellspacing="0" align="center" border="0">
	        <tr>
	          <tr>
	            <td  align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="70" width="200"></td>
	            <td colspan="7" align="center"  style="font-size:xx-large;"><strong style="margin-left:100px" ><? echo $com_dtls[0]; ?><span style="font-size:x-large; margin-left:200px !important;"><? echo $cid;?><sup><?php if($cid==1) { echo 'st';} elseif($cid==2) { echo  'nd';} else{ echo 'rd';} ?></sup> Copy</span></strong>
	           <div style="float:right;width:34%; margin-top:10px; text-align:right">
	               	&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
	            </div> 
	            </td>
	           
	           
	           
	        </tr>
	        <tr class="form_caption">
	            <td colspan="8" align="center">
					<?
					echo $com_dtls[1];
					//$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
						//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
						/*foreach ($nameArray as $result)
						{ 
							echo $result[csf('plot_no')];if($result[csf('plot_no')]!="") {echo ',';} else{echo '';}
							echo $result[csf('level_no')];if($result[csf('level_no')]!="") {echo ',';} else{echo '';}
							echo $result[csf('road_no')];if($result[csf('road_no')]!="") {echo ',';} else{echo '';}
							echo $result[csf('block_no')];if($result[csf('block_no')]!="") {echo ',';} else{echo '';}
							echo $result[csf('city')];if($result[csf('city')]!="") {echo ',';} else{echo '';}
							echo $result[csf('zip_code')];if($result[csf('zip_code')]!="") {echo ',';} else{echo '';}
							echo $result[csf('province')];if($result[csf('province')]!="") {echo ',';} else{echo '';}
							echo $country_arr[$result[csf('country_id')]].'<br>'; 
							echo $result[csf('email')]; if($result[csf('email')]!="") {echo ',';} else{echo '';}
							echo $result[csf('website')];if($result[csf('website')]!="") {echo ',';} else{echo '';}
						}*/
	                ?> 
	                <div style="width:34%; text-align:center">
	               	&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
	                </div>
	            </td>
	        </tr>
	        <tr>
	        	<td style="display:none" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
	        </tr>
	        <tr>
	            <td colspan="8" align="center" style="font-size:x-large"><strong><u>Delivery Challan</u></strong></td>
	        </tr>
	        <tr>
	            <td width="160"><strong>System ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
	            <td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
	            <td width="125"><strong>Challan/System No:</strong></td><td width="175px" colspan="2"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
	        </tr>
	         <tr>
	            
	            <td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
	            <td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
	            <td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
	        </tr>
	        <tr>
	            <td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
	            <td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
	            <td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
	        </tr>
	        <tr>
	          
	            <td><strong>Out-Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
	            <td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
	            <td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
	        </tr>
	         <tr>
	            <td><strong>Est. Return Date 	 :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
	            <td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
	            <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
	            
	        </tr>
	        <tr>
	           <td><strong>Bar Code:</strong></td><td  colspan="3" id="barcode_img_id_<? echo $cid; ?>"></td> 
	           <td><strong>To Location:</strong></td><td><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
	        </tr>
	        <tr>
	            <td><strong>Driver Name:</strong></td>
				<td><? echo $dataArray[0][csf('driver_name')]; ?></td>
	            <td>&nbsp;&nbsp;</td><td>&nbsp;&nbsp;</td>
				<td><strong>Vehicle No:</strong></td>
				<td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
	        </tr>
			<tr>
			    <td><strong>Mobile No:</strong></td>
				<td><? echo $dataArray[0][csf('mobile_no')]; ?></td>
	            <td>&nbsp;&nbsp;</td><td>&nbsp;&nbsp;</td>
				<td><strong>Remarks: </strong></td>
				<td colspan="4"><? echo $dataArray[0][csf('remarks')];?></td>
			</tr>
	    </table>
	    <br>
	    <table align="center" cellspacing="0" width="<? echo $width;?>px;"  border="1" rules="all" class="rpt_table" >
	        <thead bgcolor="#dddddd" align="center">
	            <th width="30">SL</th>
	            <th width="100" align="center">Item Category</th>
	            <? 
	            if($basis==2)
	            {
	            	?>
	            	<th width="70" align="center">Brand</th>
	            	<?

	            }
	            ?>
	            <th width="100" align="center">Sample</th>
	            <th width="200" align="center">Item Description</th>
	            <? 
	            if($basis==2)
	            {
	            	?>
	            	<th width="70" align="center">Lot</th>
	            	<?

	            }
	            ?>
	            <th width="50" align="center">UOM</th>
	            <th width="80" align="center">Quantity</th>
	            <? 
	            if($basis==2)
	            {
	            	?>
	            	<th width="70" align="center">No. of Bag/Crtn</th>
	            	<th width="70" align="center">No.of Cone</th>
	            	 
	            	<?

	            }
	            
	            if($show_item==1)
				{
				?>
	            <th width="50" align="center">Rate</th> 
	            <th width="80" align="center">Amount </th>
	            <?
				}
				if ($dataArray[0][csf('basis')]==33) 
				{
				?>
					<th width="100" align="center">Customer Buyer</th>
				<?
				}
				else
				{
				?>
	            	<th width="100" align="center">Buyer</th>
				<?
				}
				?>
	            <th width="100" align="center">Style</th>
	            <th width="80" align="center">Buyer Order</th>
	            <th width="60" align="center">NO of Bags/Rolls</th>
	            <th align="center">Remarks</th>
	        </thead>
		<?
	    $i=1;
		$gate_id=$dataArray[0][csf('id')];
		$sql_dtls= " SELECT id,item_category_id,sample_id, item_description,uom_qty, quantity, uom, rate, amount,buyer_order_id,buyer_order, remarks, challan_no, no_of_bags from  inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 ";

		// echo $sql_dtls;
		if($data[4]==8) //subcon challan (grey fabric)
		{
			$sql_result_subcon_grey=sql_select($sql_dtls);
			$buyer_orderIDs="";
			foreach($sql_result_subcon_grey as $row)
			{
				$buyer_orderIDs.=$row[csf('buyer_order')];
			}
			$buyer_orderID=chop($buyer_orderIDs,',');
			
			$sql_subcon_order_buyer=sql_select("select order_no,cust_buyer from subcon_ord_dtls where order_no in('$buyer_orderID') and status_active=1 and is_deleted=0");
			foreach($sql_subcon_order_buyer as $row)
			{
				$subcon_buyer_arr[$row[csf('order_no')]]['cust_buyer']=$row[csf('cust_buyer')];
			}
		}elseif($basis==9) //SubCon Dyeing And Finishing Delivery
		{
			$sql_result_subcon_grey=sql_select($sql_dtls);
			$buyer_orderIDs="";
			foreach($sql_result_subcon_grey as $row)
			{
				$buyer_orderIDs.=$row[csf('buyer_order_id')].',';
			}
			$buyer_orderID=chop($buyer_orderIDs,',');
			
			$sql_subcon_order_buyer=sql_select("SELECT a.party_id as PARTY_ID, b.order_id as ORDER_ID from subcon_delivery_mst a,subcon_delivery_dtls b where a.id=b.mst_id and a.id in($issue_id) and b.order_id in($buyer_orderID) and a.status_active=1 and b.status_active=1 ");
			foreach($sql_subcon_order_buyer as $row)
			{
				$subcon_buyer_arr[$row['ORDER_ID']]['cust_buyer']=$buyer_library[$row['PARTY_ID']];
			}
		}
		
		//echo $sql_dtls;
		$uom_check=array();
		$sql_result=sql_select($sql_dtls);
		$sql_count=count($sql_result);
		$tot_qty=0;$tot_amount=0; $no_of_bags=0;
		foreach($sql_result as $row)
		{
			$ref_id=$row[csf("challan_no")];
			if ($i%2==0)  
				$bgcolor="#E9F3FF";
			else
				$bgcolor="#FFFFFF";
				
				$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
				//echo $buyer; 9
				$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
				//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
				$uom_check[$row[csf('uom')]]=$row[csf('uom')];
				?>
				<tr bgcolor="<? echo $bgcolor; ?>">
	                <td><? echo $i; ?></td>
	                <td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
	                <? 
	                if($basis==2)
	                {
	                	?>
	                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["brand"]; ?></td>
	                	<?

	                }
	                ?>
	                <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
	                <td><?  echo $row[csf('item_description')]; ?></td>
	                <? 
	                if($basis==2)
	                {
	                	?>
	                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["lot"]; ?></td>
	                	<?

	                }
	                ?>

	                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
	                <td align="right"><? echo $row[csf('quantity')]; ?></td>
	                <? 
	                if($basis==2)
	                {
	                	?>
	                	<td width="70" align="center"><? echo $bags_cone_arr[$ref_id]["bags"];?></td>
	                	<td width="70" align="center"><? echo $bags_cone_arr[$ref_id]["cone"];?></td>
	                	 
	                	<?

	                }
	                 
					if($show_item==1)
					{
					?>
	                <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
	                <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
	                <?
					}
					?>
	                <td align="center"><? 
					if($data[4]==8)
					{
						echo $subcon_buyer_arr[$row[csf('buyer_order')]]['cust_buyer'];
					}
					elseif($data[4]==9)
					{
					     echo $subcon_buyer_arr[$row[csf('buyer_order_id')]]['cust_buyer'];
					}
					else
					{
						echo $buyer_library[$buyer]; 
					}
					?></td>
	                <td><? echo $style_ref_no; ?></td>
	                <td><? echo $row[csf('buyer_order')]; ?></td>
	                <td align="right"><? echo $row[csf('no_of_bags')]; ?></td>
	                <td><? echo $row[csf('remarks')]; ?></td>
				</tr>
			<?php
	    	$i++;
			
			$tot_qty+=$row[csf('quantity')];
			$no_of_bags+=$row[csf('no_of_bags')];
			$tot_amount+=$row[csf('amount')];
			//if($sql_count>1) {$inWordTxt="Quantity";} else{ $inWordTxt=$unit_of_measurement[$row[csf('uom')]];}
			$inWordTxt=$unit_of_measurement[$row[csf('uom')]];
	    }
		//$tot_check=array();
		if($basis==2)$colspan+=2;
		if(count($uom_check)==1)
		{

		?>
	    <tfoot bgcolor="#CCCCCC">
	        <tr>
	        <td colspan="<? echo $colspan;?>" align="right"> <b> Total</b></td>
	        <td align="right"><b><? echo number_format($tot_qty,2);?></b> </td>
	          <?
	        if($basis==2)
	        {
	        	?>
	        	<td colspan="2"></td>

	        	<?
	        }
			if($show_item==1)
			{
			?>
	        <td> </td>
	        <td align="right"><b> <? echo number_format($tot_amount,2);?></b> </td>
	        <?
				}
			?>
	        <td colspan="3"></td>
	        <td align="right"><b> <? echo number_format($no_of_bags,2);?></b> </td>
	        <td align="right"><b></b> </td>
	        </tr>
	        
		</tfoot>
	    <?
		}
		$width_sign=$width.'px';
		?>
	    </table>
	      <span><h4 align="center">In Words : &nbsp;<? echo number_to_words($tot_qty,$inWordTxt);?></h4></span>

	</div>
	 <?php
      $hisSql =  "select MST_ID,APPROVED_BY,APPROVED_DATE, SEQUENCE_NO from APPROVAL_MST where ENTRY_FORM=59 and MST_ID=$gate_id order by sequence_no";
		//echo $hisSql;die();
		$hisSqlRes=sql_select($hisSql);

		foreach($hisSqlRes as $Row)
		{
			$Row['APPROVED_DATE']=strtotime($Row['APPROVED_DATE']);
			
			$sys_id_arr[$Row['APPROVED_BY']]=array(
			'APPROVED_BY'=>$Row['APPROVED_BY'],
			'SEQUENCE_NO'=>$Row['SEQUENCE_NO'],
			'APPROVED_DATE'=>date('d-m-Y h:i:s A',$Row['APPROVED_DATE']),
		);
		$userIdArr[$Row['APPROVED_BY']]=$Row['APPROVED_BY'];
		}
		// 	echo 11;die;
		// 	echo "<pre>";
		// print_r($sys_id_arr); 
		//   echo "</pre>";die();

		$sql="select a.USER_ID,a.DEPARTMENT,b.DESIGNATION,b.USER_FULL_NAME from electronic_approval_setup a,user_passwd b where b.id=a.USER_ID ".where_con_using_array($userIdArr,0,'a.USER_ID')."";
		//echo $sql;die();
		$sql_res=sql_select($sql);

		foreach($sql_res as $roww){
			$userName[$roww['USER_ID']]=$roww['USER_FULL_NAME'];
			$userDeg[$roww['USER_ID']]=$roww['DESIGNATION'];
			if($department_arr[$roww['DEPARTMENT']]!=''){$userDep[$roww['USER_ID']][$roww['DEPARTMENT']]=$department_arr[$roww['DEPARTMENT']];}
		}
		// echo "<pre>";
		// 	print_r($userName); 
		// 	  echo "</pre>";die();
		$hisSql ="select MST_ID,REFUSING_REASON from REFUSING_CAUSE_HISTORY where ENTRY_FORM=59 and MST_ID==$gate_id";
		//echo $hisSql;die();
			$hisSqlRes=sql_select($hisSql);
			$refusing_res_arr = array();
			foreach($hisSqlRes as $key => $prerow){
				$refusing_res_arr[$key+2] = $prerow['REFUSING_REASON'];

			}
		// echo "<pre>";
		// print_r($refusing_res_arr); 
		//   echo "</pre>";die();
		?>
		<br>
			<table border="1" rules="all">
				<thead>   
					<tr> <th colspan="5" ><strong>Approval Authority</strong></th></tr>
					<tr>
						<th>Name</th>
						<th>Designation</th>
						<th>Reason For Unapproval</th>
						<th>Approve Status</th>
						<th>Time/Date</th>
					</tr>
		        </thead>
				<tbody>
					<?
					foreach ($sys_id_arr as $row) 
					{  
					?>
					
					<tr>   
						<td><?=$userName[$row['APPROVED_BY']];?></td>
						<td><?=$designation_a[$userDeg[$row['APPROVED_BY']]];?></td>
						<td><?=$refusing_res_arr[$row['SEQUENCE_NO']];?></td>
						<td><? echo "Yes";?></td>
						<td><?=$row[APPROVED_DATE]; ?></td>
					</tr>
					<?
					
					}
					?>
				</tbody>
	        </table> 
	   <div>
		<? echo signature_table(114, $data[0], $width_sign,$template_id,1,$inserted_by); ?>
	    
	      <script type="text/javascript" src="../../js/jquery.js"></script>
	      <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
	     <script>
			    function generateBarcode( valuess ){
				
					var value = valuess;//$("#barcodeValue").val();
				    // alert(value)
					var btype = 'code39';//$("input[name=btype]:checked").val();
					var renderer ='bmp';// $("input[name=renderer]:checked").val();	 
					var settings = {
					output:renderer,
					bgColor: '#FFFFFF',
					color: '#000000',
					barWidth: 1,
					barHeight: 30,
					moduleSize:5,
					posX: 10,
					posY: 20,
					addQuietZone: 1
					};
					$("#barcode_img_id_<? echo $cid; ?>").html('11');
					value = {code:value, rect: false};
					
					$("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
				} 
			   generateBarcode('<? echo $data[1]; ?>');
		 </script>
	</div>
	<p style="page-break-after:always;"></p>
	<?
	}	
	die; ?>
	<div style="width:1150px;" align="center">
	    <table width="1150" cellspacing="0" align="center" border="0">
	        <tr>
	          <tr>
	            <td  align="center"><img src="../../<? echo $image_location; ?>" height="50" width="60"></td>
	            <td colspan="7" align="center"  style="font-size:xx-large;"><strong style="margin-left:180px" ><? echo $company_library[$data[0]]; ?><span style="font-size:x-large; margin-left:200px !important;">2<sup>nd</sup> Copy</span></strong>
	             <div style="float:right;width:34%;margin-top:10px; text-align:right">
	               	&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
	            </div>
	            </td> 
	        </tr>
	        <tr class="form_caption">
	            <td colspan="8" align="center">
					<?
					$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
						//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
						foreach ($nameArray as $result)
						{ 
							echo $result[csf('plot_no')]; 
							echo $result[csf('level_no')];
							echo $result[csf('road_no')];
							echo $result[csf('block_no')];
							echo $result[csf('city')];
							echo $result[csf('zip_code')];
							echo $result[csf('province')].',';
							echo $country_arr[$result[csf('country_id')]].'<br>'; 
							echo $result[csf('email')]; 
							echo $result[csf('website')];
						}
	                ?> 
	                <div style="width:34%; text-align:center">
	               	&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
	            </div>
	            </td>
	        </tr>
	        <tr>
	        	<td style="display:none" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
	        </tr>
	        <tr>
	            <td colspan="8" align="center" style="font-size:x-large"><strong><u><?  if ($print_mercer=="Print-Mercer") {echo "Delivery Challan";} else {echo "Gate Pass";}?></u></strong></td>
	        </tr>
	        <tr>
	            <td width="160"><strong>System ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
	            <td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
	            <td width="125"><strong>Challan/System No:</strong></td><td width="175px" colspan="2"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
	        </tr>
	         <tr>
	            
	            <td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
	            <td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
	            <td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
	        </tr>
	        <tr>
	            <td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
	            <td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
	            <td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
	        </tr>
	        <tr>
	          
	            <td><strong>Out-Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
	            <td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
	            <td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
	        </tr>
	         <tr>
	            <td><strong>Est. Return Date 	 :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
	            <td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
	            <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
	            
	        </tr>
	        <tr>
	           <td><strong>Bar Code:</strong></td><td  colspan="3" id="barcode_img_id"></td> 
	           <td><strong>To Location :</strong></td><td><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]]; else echo $dataArray[0][csf('location_name')];?></td>
	        </tr>
	    </table>
	    <br>
	    <table align="center" cellspacing="0" width="1150"  border="1" rules="all" class="rpt_table" >
	        <thead bgcolor="#dddddd" align="center">
	            <th width="30">SL</th>
	            <th width="100" align="center">Item Category</th>
	            <th width="100" align="center">Sample</th>
	            <th width="200" align="center">Item Description</th>
	            <th width="50" align="center">UOM</th>
	            <th width="80" align="center">Quantity</th>
	            <th width="50" align="center">Rate</th> 
	            <th width="80" align="center">Amount </th>
	            <th width="100" align="center">Buyer</th>
	            <th width="100" align="center">Style</th>
	            <th width="80" align="center">Buyer Order </th>
	            <th align="center">Remarks</th>
	        </thead>
	<?
	    $i=1;
		$gate_id=$dataArray[0][csf('id')];
		$sql_dtls= " select id,item_category_id,sample_id, item_description,uom_qty, quantity, uom, rate, amount,buyer_order_id,buyer_order, remarks from  inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 ";
		//echo $sql_dtls;
		$uom_check=array();
		$sql_result=sql_select($sql_dtls);
		$tot_qty=0;$tot_amount=0;
		foreach($sql_result as $row)
		{
			if ($i%2==0)  
				$bgcolor="#E9F3FF";
			else
				$bgcolor="#FFFFFF";
				
				$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
				$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
				//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
				$uom_check[$row[csf('uom')]]=$row[csf('uom')];
				?>
				<tr bgcolor="<? echo $bgcolor; ?>">
	                <td><? echo $i; ?></td>
	                <td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
	                <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
	                <td><?  echo $row[csf('item_description')]; ?></td>
	                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
	                <td align="right"><? echo $row[csf('quantity')]; ?></td>
	                <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
	                <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
	                <td><? echo $buyer_library[$buyer]; ?></td>
	                <td><? echo $style_ref_no; ?></td>
	                <td><? echo $row[csf('buyer_order')]; ?></td>
	                <td><? echo $row[csf('remarks')]; ?></td>
				</tr>
			<?php
	    	$i++;
			
			$tot_qty+=$row[csf('quantity')];
			$tot_amount+=$row[csf('amount')];
	    }
		//$tot_check=array();
		if(count($uom_check)==1)
		{
		?>
	    <tfoot bgcolor="#CCCCCC">
	        <tr>
	        <td colspan="5" align="right"> <b> Total</b></td>
	        <td align="right"><b><? echo number_format($tot_qty,2);?></b> </td>
	        <td> </td>
	        <td align="right"><b> <? echo number_format($tot_amount,2);?></b> </td>
	        <td colspan="4"></td>
	        </tr>
		</tfoot>
	    <?
		}
		?>
	    </table>
	</div>
	<div>
		<? echo signature_table(114, $data[0], "1150px",$template_id,20,$inserted_by); ?>
	</div> 
	<p style="page-break-after:always;"></p>
	<div style="width:1150px;" align="center">
	    <table width="1150" cellspacing="0" align="center" border="0">
	        <tr>
	          <tr>
	            <td  align="center"><img src="../../<? echo $image_location; ?>" height="50" width="60"></td>
	            <td colspan="7" align="center"  style="font-size:xx-large;"><strong style="margin-left:180px" ><? echo $company_library[$data[0]]; ?><span style="font-size:x-large; margin-left:200px !important;">3<sup>rd</sup> Copy</span></strong>
	             <div style="float:right;width:34%; margin-top:10px; text-align:right">
	               	&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
	            </div>
	            </td>
	           
	           
	           
	        </tr>
	        <tr class="form_caption">
	            <td colspan="8" align="center">
					<?
					$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
						//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
						foreach ($nameArray as $result)
						{ 
							echo $result[csf('plot_no')]; 
							echo $result[csf('level_no')];
							echo $result[csf('road_no')];
							echo $result[csf('block_no')];
							echo $result[csf('city')];
							echo $result[csf('zip_code')];
							echo $result[csf('province')].',';
							echo $country_arr[$result[csf('country_id')]].'<br>'; 
							echo $result[csf('email')]; 
							echo $result[csf('website')];
						}
	                ?> 
	                <div style="width:34%; text-align:center">
	               	&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
	            </div>
	            </td>
	        </tr>
	        <tr>
	        	<td style="display:none" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
	        </tr>
	        <tr>
	            <td colspan="8" align="center" style="font-size:x-large"><strong><u><?  if ($print_mercer=="Print-Mercer") {echo "Delivery Challan";} else {echo "Gate Pass";}?></u></strong></td>
	        </tr>
	        <tr>
	            <td width="160"><strong>System ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
	            <td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
	            <td width="125"><strong>Challan/System No:</strong></td><td width="175px" colspan="2"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
	        </tr>
	         <tr>
	            
	            <td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
	            <td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
	            <td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
	        </tr>
	        <tr>
	            <td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
	            <td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
	            <td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
	        </tr>
	        <tr>
	          
	            <td><strong>Out-Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
	            <td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
	            <td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
	        </tr>
	         <tr>
	            <td><strong>Est. Return Date 	 :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
	            <td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
	            <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
	            
	        </tr>
	        <tr>
	           <td><strong>Bar Code:</strong></td><td  colspan="3" id="barcode_img_id"></td> 
	           <td><strong>To Location :</strong></td><td><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_id')]; ?></td>
	        </tr>
	    </table>
	    <br>
	    <table align="center" cellspacing="0" width="1150"  border="1" rules="all" class="rpt_table" >
	        <thead bgcolor="#dddddd" align="center">
	            <th width="30">SL</th>
	            <th width="100" align="center">Item Category</th>
	            <th width="100" align="center">Sample</th>
	            <th width="200" align="center">Item Description</th>
	            <th width="50" align="center">UOM</th>
	            <th width="80" align="center">Quantity</th>
	            <th width="50" align="center">Rate</th> 
	            <th width="80" align="center">Amount </th>
	            <th width="100" align="center">Buyer</th>
	            <th width="100" align="center">Style</th>
	            <th width="80" align="center">Buyer Order </th>
	            <th align="center">Remarks</th>
	        </thead>
	<?
	    $i=1;
		$gate_id=$dataArray[0][csf('id')];
		$sql_dtls= " select id,item_category_id,sample_id, item_description,uom_qty, quantity, uom, rate, amount,buyer_order_id,buyer_order, remarks from  inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 ";
		//echo $sql_dtls;
		$uom_check=array();
		$sql_result=sql_select($sql_dtls);
		$tot_qty=0;$tot_amount=0;
		foreach($sql_result as $row)
		{
			if ($i%2==0)  
				$bgcolor="#E9F3FF";
			else
				$bgcolor="#FFFFFF";
				
				$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
				$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
				//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
				$uom_check[$row[csf('uom')]]=$row[csf('uom')];
				?>
				<tr bgcolor="<? echo $bgcolor; ?>">
	                <td><? echo $i; ?></td>
	                <td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
	                <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
	                <td><?  echo $row[csf('item_description')]; ?></td>
	                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
	                <td align="right"><? echo $row[csf('quantity')]; ?></td>
	                <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
	                <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
	                <td><? echo $buyer_library[$buyer]; ?></td>
	                <td><? echo $style_ref_no; ?></td>
	                <td><? echo $row[csf('buyer_order')]; ?></td>
	                <td><? echo $row[csf('remarks')]; ?></td>
				</tr>
			<?php
	    	$i++;
			
			$tot_qty+=$row[csf('quantity')];
			$tot_amount+=$row[csf('amount')];
	    }
		//$tot_check=array();
		if(count($uom_check)==1)
		{
		?>
	    <tfoot bgcolor="#CCCCCC">
	        <tr>
	        <td colspan="5" align="right"> <b> Total</b></td>
	        <td align="right"><b><? echo number_format($tot_qty,2);?></b> </td>
	        <td> </td>
	        <td align="right"><b> <? echo number_format($tot_amount,2);?></b> </td>
	        <td colspan="4"></td>
	        </tr>
		</tfoot>
	    <?
		}
		?>
	    </table>
	</div>
	<div>
		<? echo signature_table(114, $data[0], "1150px",$template_id,20,$inserted_by); ?>
	</div>  
	 <script type="text/javascript" src="../../js/jquery.js"></script>
	      <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
	     <script>

		function generateBarcode( valuess ){
			   
				var value = valuess;//$("#barcodeValue").val();
			 // alert(value)
				var btype = 'code39';//$("input[name=btype]:checked").val();
				var renderer ='bmp';// $("input[name=renderer]:checked").val();
				 
				var settings = {
				  output:renderer,
				  bgColor: '#FFFFFF',
				  color: '#000000',
				  barWidth: 1,
				  barHeight: 30,
				  moduleSize:5,
				  posX: 10,
				  posY: 20,
				  addQuietZone: 1
				};
				$("#barcode_img_id").html('11');
				 value = {code:value, rect: false};
				
				$("#barcode_img_id").show().barcode(value, btype, settings);
		} 
		 	generateBarcode('<? echo $data[1]; ?>');
		 
		 
		 


		 </script>

		 
	<?
	exit();
}

if($action=="print_button_variable_setting")
{
	extract($_REQUEST);
	$variable_roll=return_field_value("fabric_roll_level"," variable_settings_production","company_name ='".$data."' and variable_list=3 and item_category_id=13 and is_deleted=0 and status_active=1","fabric_roll_level");
	if($variable_roll!=1) $variable_roll=2;
	echo "document.getElementById('variable_roll').value = '".$variable_roll."';\n";
	$print_report_format=return_field_value("format_id"," lib_report_template","template_name ='".$data."' and module_id=6 and report_id=38 and is_deleted=0 and status_active=1");	
	$print_report_format_arr=explode(",",$print_report_format);
	//print_r($print_report_format_arr);

	$buttonHtml.='<input type="text" value="1"  title="No. of copy" placeholder="No. of copy" id="no_copy" class="text_boxes_numeric" style="width:60px;"/>';
	foreach($print_report_format_arr as $id) {

		if($id==115) $buttonHtml.='<input type="button" style="width:80px;" name="Printt1" id="Printt1"  onClick="fnc_getpass_entry(4)" class="formbutton_disabled" value="Print" />';
		else if($id==116) $buttonHtml.='<input type="button" style="width:80px;" name="id_print_to_button" id="id_print_to_button"  onClick="print_to_html_report(2)" class="formbutton_disabled" value="Print 2" />';
		else if($id==136) $buttonHtml.='<input type="button" style="width:100px;" name="with_color_size_print" id="with_color_size_print"  onClick="print_to_html_report(3)" class="formbutton_disabled" value="Embellishment" />';
		else if($id==137) $buttonHtml.='<input type="button" style="width:80px;" name="id_print_to_button5" id="id_print_to_button5"  onClick="print_to_html_report(5)" class="formbutton_disabled" value="Print4" />';
		else if($id==129) $buttonHtml.='<input type="button" style="width:80px;" name="id_print_to_button12" id="id_print_to_button12"  onClick="print_to_html_report(12)" class="formbutton_disabled" value="Print5" />';
		else if($id==161) $buttonHtml.='<input type="button" style="width:80px;" name="print6" id="print6"  onClick="fnc_getpass_entry(6)" class="formbutton_disabled" value="Print 6" />';
		else if($id==191) $buttonHtml.='<input type="button" style="width:80px;" name="print13" id="print13"  onClick="print_to_html_report(13)" class="formbutton_disabled" value="Print 7" />';	
		//else if($id==191) $buttonHtml.='<input type="button" style="width:80px;" name="id_print_to_button4" id="id_print_to_button4"  onClick="print_to_html_report(4)" class="formbutton_disabled" value="Gmts. Delivery" />';	
		else if($id==196) $buttonHtml.='<input type="button" style="width:80px;" name="id_print_to_button6" id="id_print_to_button6"  onClick="print_to_html_report(6)" class="formbutton_disabled" value="Cutting Delivery" />';
		else if($id==199) $buttonHtml.='<input type="button" style="width:80px;" name="id_print_to_button7" id="id_print_to_button7"  onClick="print_to_html_report(7)" class="formbutton_disabled" value="Fabric Delivery" />';
		else if($id==206) $buttonHtml.='<input type="button" style="width:80px;" name="id_print_to_button8" id="id_print_to_button8"  onClick="fnc_getpass_entry(8)" class="formbutton_disabled" value="General" />';
		else if($id==207) $buttonHtml.='<input type="button" style="width:100px;" name="id_print_to_button9" id="id_print_to_button9"  onClick="print_to_html_report(9)" class="formbutton_disabled" value="Gmts Delivery2" />';
		else if($id==208) $buttonHtml.='<input type="button" style="width:100px;" name="id_print_to_button10" id="id_print_to_button10"  onClick="print_to_html_report(10)" class="formbutton_disabled" value="Sample Delivery" />';
		else if($id==212) $buttonHtml.='<input type="button" style="width:80px;" name="id_print_to_button11" id="id_print_to_button11"  onClick="print_to_html_report(11)" class="formbutton_disabled" value="Yarn Delivery" />';
		else if($id==271) $buttonHtml.='<input type="button" style="width:80px;" name="id_print_to_button14" id="id_print_to_button14"  onClick="print_to_html_report(14)" class="formbutton_disabled" value="Finish Fabric Delivery" />';
		else if($id==42) $buttonHtml.='<input type="button" style="width:80px;" name="id_print_to_button15" id="id_print_to_button15"  onClick="print_to_html_report(15)" class="formbutton_disabled" value="Challan Wise" />';
		else if($id==362) $buttonHtml.='<input type="button" style="width:80px;" name="id_print_to_button18" id="id_print_to_button18"  onClick="print_to_html_report(18)" class="formbutton_disabled" value="Challan Wise2" />';
		//else if($id==362) $buttonHtml.='<input type="button" style="width:80px;" name="id_print_to_button19" id="id_print_to_button19"  onClick="print_to_html_report(19)" class="formbutton_disabled" value="Challan Wise3" />';
		else if($id==227) $buttonHtml.='<input type="button" style="width:80px;" name="id_print_to_button16" id="id_print_to_button16"  onClick="print_to_html_report(16)" class="formbutton_disabled" value="Print 8" />';
		else if($id==707) $buttonHtml.='<input type="button" style="width:80px;" name="with_challan" id="with_challan"  onClick="print_to_html_report(17)" class="formbutton_disabled" value="With Challan" />';
		else if($id==235) $buttonHtml.='<input type="button" style="width:80px;" name="print9" id="print9"  onClick="fnc_getpass_entry(9)" class="formbutton_disabled" value="Print 9" />';
		else if($id==274) $buttonHtml.='<input type="button" style="width:80px;" name="print10" id="print10"  onClick="fnc_getpass_entry(10)" class="formbutton_disabled" value="Print 10" />';
		else if($id==738) $buttonHtml.='<input type="button" style="width:80px;" name="printamt" id="printamt"  onClick="fnc_getpass_entry(11)" class="formbutton_disabled" value="Print AMT" />';
		else if($id==747) $buttonHtml.='<input type="button" style="width:80px;" name="printlibas" id="printlibas"  onClick="fnc_getpass_entry(14)" class="formbutton_disabled" value="Print Libas" />';
		else if($id==241) $buttonHtml.='<input type="button" style="width:80px;" name="print11" id="print11"  onClick="fnc_getpass_entry(15)" class="formbutton_disabled" value="Print 11" />';
        else if($id==427) $buttonHtml.='<input type="button" style="width:80px;" name="print12" id="print12"  onClick="fnc_getpass_entry(20)" class="formbutton_disabled" value="Print 12" />';
		else if($id==28) $buttonHtml.='<input type="button" style="width:80px;" name="print14" id="print14"  onClick="fnc_getpass_entry(21)" class="formbutton_disabled" value="Print 13" />';
		else if($id==437) $buttonHtml.='<input type="button" style="width:80px;" name="print15" id="print15"  onClick="fnc_getpass_entry(22)" class="formbutton_disabled" value="Print 27" />';
		else if($id==280) $buttonHtml.='<input type="button" style="width:80px;" id="id_print_to_button_Scandex"  onClick="fnc_getpass_entry(23)" class="formbutton_disabled" name="id_print_to_button_Scandex" value="Print B14" />';
		else if($id==304) $buttonHtml.='<input id="print_mercer"  class="formbutton_disabled" type="button" style="width:70px;" onClick="fnc_getpass_entry(24)" name="print_mercer" value="Print B15">';
		else if($id==719) $buttonHtml.='<input id="print_16"  class="formbutton_disabled" type="button" style="width:70px;" onClick="fnc_getpass_entry(25)" name="print_16" value="Print 16">';
		else if($id==723) $buttonHtml.='<input id="print_17"  class="formbutton_disabled" type="button" style="width:70px;" onClick="fnc_getpass_entry(26)" name="print_17" value="Print 17">';
		else if($id==836) $buttonHtml.='<input type="button" style="width:100px;" name="id_print_to_button20" id="id_print_to_button20"  onClick="print_to_html_report(20)" class="formbutton_disabled" value="Yarn Delivery QR" />';
    }

    echo "document.getElementById('button_data_panel').innerHTML = '".$buttonHtml."';\n";
    exit();
}

if($action=="load_drop_down_chalan")
{
	if($data==1)
	{
		?><input type="text" name="txt_chalan_no" id="txt_chalan_no" class="text_boxes" style="width:140px;" ><?
	}
	else
	{
		?><input type="text" name="txt_chalan_no" id="txt_chalan_no" class="text_boxes" style="width:140px;" placeholder="Browse Or Scan" onDblClick="chalan_popup();"><?	
	}
	exit();
}

if($action=="load_drop_down_purpose")
{
	if($data==1)
	{
		?>
		<input type="text" name="cbo_issue_purpose" id="cbo_issue_purpose" class="text_boxes" style="width:135px;" placeholder="Write">
		<input type="hidden" name="hidden_purpose_id" id="hidden_purpose_id" class="text_boxes" style="width:50px;"  />	
		<? 
	}
	else
	{
		?>
		<input type="text" name="cbo_issue_purpose" id="cbo_issue_purpose" class="text_boxes" style="width:135px;" placeholder="Display">
		<input type="hidden" name="hidden_purpose_id" id="hidden_purpose_id" class="text_boxes" style="width:50px;"  />	
		<?
	}
	exit();
}

if($action=="load_drop_down_section")
{
	echo create_drop_down( "cbo_section", 150, "select id,section_name from  lib_section where department_id=$data  and status_active=1 order by section_name","id,section_name",1, "-- Select --", 0, "" );
	exit(); 
}

if($action=="load_drop_down_dying_source")
{
	$data = explode("_",$data);
	if($data[2]==3)
	{
		if($data[0]==1)
		{
			echo create_drop_down( "txt_sent_to", 150, "select id,company_name from lib_company where status_active=1 and is_deleted=0  order by company_name","id,company_name", 1, "-- Select --", 0, "" );
		}
		else if($data[0]==3 && $data[1]==1)
		{
			echo create_drop_down( "txt_sent_to", 150, "select a.id,a.supplier_name from lib_supplier a, lib_supplier_party_type b where a.id=b.supplier_id and b.party_type in(1,9,20) and a.status_active=1 group by a.id order by a.supplier_name","id,supplier_name", 1, "-- Select --", 0, "",0 );
		}
		else if($data[0]==3 && $data[1]==2)
		{
			echo create_drop_down( "txt_sent_to", 150, "select a.id,a.supplier_name from lib_supplier a, lib_supplier_party_type b where a.id=b.supplier_id and b.party_type in(1,9,21,24) and a.status_active=1 group by a.id order by a.supplier_name","id,supplier_name", 1, "-- Select --", 0, "",0 );
		}
		else if($data[0]==3)
		{		
			echo create_drop_down( "txt_sent_to", 150, "select a.id,a.supplier_name from lib_supplier a, lib_supplier_party_type b where a.id=b.supplier_id and a.status_active=1 group by a.id order by a.supplier_name","id,supplier_name", 1, "-- Select --", 0, "",0 );
		}
		else
		{ 
			echo create_drop_down( "txt_sent_to", 150, $blank_array,"", 1, "-- Select --", 0, "",0 );
		}
	}
	if($data[2]==4)
	{
		if($data[0]==1)
		{
			echo create_drop_down( "txt_sent_to", 150, "select comp.id, comp.company_name from lib_company comp where comp.status_active=1 and comp.is_deleted=0 $company_cond order by comp.company_name","id,company_name",1, "--Select Sewing Company--", "$company_id", "","" );
		}
		else if($data[0]==3)
		{
			echo create_drop_down( "txt_sent_to", 150, "select a.id,a.supplier_name from lib_supplier a, lib_supplier_party_type b where a.id=b.supplier_id and b.party_type=21 and a.status_active=1 group by a.id,a.supplier_name order by a.supplier_name","id,supplier_name", 1, "--Select Sewing Company--", 1, "" );
		}
		else
		{
			echo create_drop_down( "cbo_sewing_company", 150, $blank_array,"",1, "--Select Sewing Company--", 1, "" );
		}
	}
	if($data[2]==6)
	{
		echo create_drop_down( "txt_sent_to", 150, "select comp.id, comp.company_name from lib_company comp where comp.status_active=1 and comp.is_deleted=0 $company_cond order by comp.company_name","id,company_name",1, "--Select Sewing Company--", "$company_id", "","" );
	}
	
	if($data[2]==2)
	{
		if($data[0]==1)
			echo create_drop_down( "txt_sent_to", 150, "select id,company_name from lib_company where status_active=1 and is_deleted=0  order by company_name","id,company_name", 1, "-- Select --", $company, "" );
		else if($data[0]==3 && $data[1]==1)
			echo create_drop_down( "txt_sent_to", 150, "select a.id,a.supplier_name from lib_supplier a, lib_supplier_party_type b where a.id=b.supplier_id and b.party_type in(1,9,20) and a.status_active=1 group by a.id, a.supplier_name order by a.supplier_name","id,supplier_name", 1, "-- Select --", 0, "",0 );
		else if($data[0]==3 && $data[1]==2)
			echo create_drop_down( "txt_sent_to", 150, "select a.id,a.supplier_name from lib_supplier a, lib_supplier_party_type b where a.id=b.supplier_id and b.party_type in(1,9,21,24) and a.status_active=1 group by a.id,a.supplier_name order by a.supplier_name","id,supplier_name", 1, "-- Select --", 0, "",0 );
		else if($data[0]==3)		
			echo create_drop_down( "txt_sent_to", 150, "select a.id,a.supplier_name from lib_supplier a, lib_supplier_party_type b where a.id=b.supplier_id and a.status_active=1 group by a.id,a.supplier_name order by a.supplier_name","id,supplier_name", 1, "-- Select --", 0, "",0 );
		else if($data[0]==0)		
			echo create_drop_down( "txt_sent_to", 150, $blank_array,"", 1, "-- Select --", $selected, "","","" );	
	}
	if($data[2]==5 || $data[2]==7)
	{
		echo create_drop_down( "txt_sent_to", 150, "select id,company_name from lib_company comp where status_active=1 and is_deleted=0  order by company_name","id,company_name", 1, "-- Select Company --", $selected,"","0" );
	}
	exit();
}

if($action=="load_drop_down_sent")
{
	$data=explode("_",$data);
	//print_r($data);
	if($data[1]==1)
	{ //within+'_'+document.getElementById('cbo_basis').value
		if($data[0]==1)
		{
			echo create_drop_down( "txt_sent_to", 150, "select id,company_name from lib_company comp where status_active=1 and is_deleted=0  order by company_name","id,company_name", 1, "-- Select Company --", $selected,"load_drop_down( 'requires/get_pass_entry_controller',document.getElementById('cbo_group').value+'_'+this.value, 'load_drop_down_location', 'location_td' );","0" );
		}
		else
		{
			?><input type="text" name="txt_sent_to" id="txt_sent_to" class="text_boxes" onDblClick="openmypage_sent_to()" oninput="senttoAutoComplete()"  style="width:140px;"><?	
		}
	}
	else if($data[1]==2 || $data[1]==3 || $data[1]==4 || $data[1]==5 ||  $data[1]==6 || $data[1]==7 || $data[1]==13 || $data[1]==14 || $data[1]==15 ||  $data[1]==38 || $data[1]==55 || $data[1]==62) 
	{
		if($data[0]==1)
		{
			echo create_drop_down( "txt_sent_to", 150, "select id,company_name from lib_company comp where status_active=1 and is_deleted=0  order by company_name","id,company_name", 1, "-- Select Company --", $selected,"load_drop_down( 'requires/get_pass_entry_controller',document.getElementById('cbo_group').value+'_'+this.value, 'load_drop_down_location', 'location_td' );","0" );
			
		}
		else
		{
			?><input type="text" name="txt_sent_to" id="txt_sent_to" class="text_boxes" onDblClick="openmypage_sent_to();" oninput="senttoAutoComplete();" style="width:140px;"><?	
		}
	}
	else
	{
		if($data[0]==1) //Yes
		{
			if($data[1]==12)
			{
				echo create_drop_down( "txt_sent_to", 172, "select distinct a.id,a.supplier_name from  lib_supplier a, lib_supplier_tag_company b where a.status_active =1 and a.is_deleted=0 and b.supplier_id=a.id  $buyer_cond  and a.id in (select  supplier_id  from  lib_supplier_party_type where party_type in (35,30,31,32)) order by supplier_name","id,supplier_name", 1, "-- Select Transport --", $selected, "" ); 
			}
			else
			{
				echo create_drop_down( "txt_sent_to", 150, "select id,company_name from lib_company comp where status_active=1 and is_deleted=0  order by company_name","id,company_name", 1, "-- Select Company --", $selected,"load_drop_down( 'requires/get_pass_entry_controller',document.getElementById('cbo_group').value+'_'+this.value, 'load_drop_down_location', 'location_td' );","0" );
			}
		}
		else
		{
			?><input type="text" name="txt_sent_to" id="txt_sent_to" class="text_boxes" onDblClick="openmypage_sent_to();" oninput="senttoAutoComplete();" style="width:140px;"><?	
		}
	}
	exit();
}

if ($action=="load_drop_down_transport_com")
{
	echo create_drop_down( "txt_sent_to", 150, "select a.id,a.supplier_name from  lib_supplier a, lib_supplier_tag_company b where a.status_active =1 and a.is_deleted=0 and a.id=$data and b.supplier_id=a.id and a.id in (select  supplier_id  from  lib_supplier_party_type where party_type in (30,31,32,35)) order by supplier_name","id,supplier_name", 1, "-- Select Transport --", $selected, "" ,1); 
	exit();
}

if ($action=="load_drop_down_buyer")
{
	echo create_drop_down( "cbo_buyer_1", 80, "select buy.id,buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company='$data'  $buyer_cond and buy.id in (select  buyer_id from  lib_buyer_party_type where party_type in (1,3,21,30,90)) order by buyer_name","id,buyer_name", 1, "-- Select Buyer --", $selected, "",1 );
	exit();	
} 

if ($action=="load_drop_down_location")
{
	$data=explode("_",$data);
	//print_r($data);
	$within_group=$data[0];
	$sent_to=$data[1];
	if($within_group==1) //Yes
	{
		echo create_drop_down( "cbo_location", 150, "select id,location_name from lib_location where company_id='$sent_to' and status_active =1 and is_deleted=0 order by location_name","id,location_name", 1, "-- Select Location --", 0, "" );
	}
	else
	{
		?><input type="text" name="cbo_location" id="cbo_location" class="text_boxes" style="width:140px;"><?	
	}
	exit();
}

if ($action=="load_drop_down_com_location")
{
	$userCredential = sql_select("SELECT unit_id as company_id, store_location_id, item_cate_id, company_location_id as location_id FROM user_passwd where id=$user_id");
	$location_id = $userCredential[0][csf('location_id')];
	if ($location_id !='') {
	    $location_credential_cond = " and id in($location_id)";
	}
	$sql="select id,location_name from lib_location where company_id='$data' $location_credential_cond and status_active =1 and is_deleted=0 order by location_name";
	$sql_res=sql_select($sql);
	$location_select="";
	if (count($sql_res)==1){
		$location_select=$sql_res[0][csf('id')];
	}
	
	echo create_drop_down( "cbo_com_location_id", 150, $sql,"id,location_name", 1, "-- Select Location --", $location_select, "" );
	exit();
}

//load drop down company department
if ($action=="load_drop_down_com_department")
{
	echo create_drop_down( "cbo_department_name", 150, "select a.id,a.department_name from  lib_department a, lib_division b where b.id=a.division_id and a.status_active =1 and a.is_deleted=0 and b.company_id='$data' order by department_name","id,department_name", 1, "-- Select --", $selected, "load_drop_down( 'requires/get_pass_entry_controller', this.value, 'load_drop_down_section', 'section_td' );",0 );
	exit();
}

if ($action=="system_id_popup")
{
  	echo load_html_head_contents("Popup Info","../../", 1, 1, $unicode);
	extract($_REQUEST);
	$selected_index = $company;
	?>     
	<script>
		function js_set_value(str)
		{			
			$("#hidden_sys_number").val(str);
			parent.emailwindow.hide(); 
		}
	</script>
	</head>
	<body>
		<div align="center" style="width:100%;" >
		<form name="searchorderfrm_1"  id="searchorderfrm_1" autocomplete="off">
			<table width="870" cellspacing="0" cellpadding="0" border="1" class="rpt_table" align="center" rules="all">
				<thead>
					<th width="130" class="must_entry_caption">Company</th>
					<th width="150">Basis</th>
					<th width="140">System ID</th>
					<th width="250" class="must_entry_caption">Date Range</th>
					<th><input type="reset" name="re_button" id="re_button" value="Reset" style="width:100px" class="formbutton"  /></th>           
				</thead>
				<tbody>
					<tr>
						<td><?=create_drop_down( "cbo_company_name", 130, "select id,company_name from lib_company comp where status_active=1 and is_deleted=0  order by company_name","id,company_name", 1, "-- Select Company --", $selected_index,""); ?></td>
						<td><?=create_drop_down( "cbo_basis", 150, $get_pass_basis,"",1, "-- Select --", 0, "" ); ?></td>
						<td><input name="txt_get_pass" id="txt_get_pass"  style="width:140px" class="text_boxes" /></td>
						<td align="center">
							<input name="txt_date_from" id="txt_date_from" class="datepicker" style="width:100px" placeholder="From Date" />
							<input name="txt_date_to" id="txt_date_to" class="datepicker" style="width:100px" placeholder="To Date" />
						</td> 
						<td align="center">
							<input type="button" name="btn_show" class="formbutton" value="Show" onClick="show_list_view ( document.getElementById('cbo_basis').value+'_'+document.getElementById('txt_get_pass').value+'_'+document.getElementById('txt_date_from').value+'_'+document.getElementById('txt_date_to').value+'_'+document.getElementById('cbo_company_name').value+'_'+document.getElementById('cbo_year_selection').value, 'create_sys_search_list_view', 'search_div', 'get_pass_entry_controller', 'setFilterGrid(\'list_view\',-1)')" style="width:100px;" />				
						</td>
					</tr>
					<tr class="general">                  
						<td align="center" valign="middle" colspan="5">
							<? echo load_month_buttons(1);  ?>
							<input type="hidden" id="hidden_sys_number" value="hidden_sys_number" />
						</td>
					</tr>    
				</tbody>
			</table>    
			<div valign="top" id="search_div"></div> 
			</form>
		</div>
	</body>           
	<script src="../../includes/functions_bottom.js" type="text/javascript"></script>
	</html>
	<?
	exit();
}

if($action=="create_sys_search_list_view")
{	
	$ex_data = explode("_",$data);
	$basis =str_replace("'","",$ex_data[0]);
	$getpass_id = str_replace("'","",$ex_data[1]);
	$fromDate = str_replace("'","",$ex_data[2]);
	$toDate = str_replace("'","",$ex_data[3]);
	$company_id= str_replace("'","",$ex_data[4]);
	$insYear= str_replace("'","",$ex_data[5]);

	if($company_id==0 && $fromDate =="" && $toDate =="")
	{
		echo "Please Select Company Name OR Date Range field Value"; die;
	}
	
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	
	$company_cond=$basis_cond=$get_cond='';
 	if ($company_id > 0) $company_cond=" and company_id = '$company_id'";
	if ($basis > 0) $basis_cond=" and basis='$basis'";
	if ($getpass_id !='' ) $get_cond=" and sys_number_prefix_num like '".$getpass_id."' ";
	
	$sql_cond='';
	if ($fromDate!=0 && $toDate!=0) $sql_cond= " and out_date between '".change_date_format($fromDate,'yyyy-mm-dd',"-",1)."' and '".change_date_format($toDate,'yyyy-mm-dd',"-",1)."'";

	$sql_system_id_search = "SELECT id as ID, company_id as COMPANY_ID, sys_number_prefix_num as SYS_NUMBER_PREFIX_NUM, sys_number as SYS_NUMBER, basis as BASIS, within_group as WITHIN_GROUP, sent_by as SENT_BY, sent_to as SENT_TO, out_date as OUT_DATE, challan_no as CHALLAN_NO, extract( year from insert_date) as YEAR,APPROVED from inv_gate_pass_mst where status_active=1 and is_deleted=0 and (is_gate_out!=1 or is_gate_out is null) and to_char(insert_date,'YYYY')='$insYear' $basis_cond $get_cond $sql_cond $company_cond order by sys_number desc";
	$sqlResult = sql_select($sql_system_id_search);
	?>
    <div style="width:1030px;">
        <table cellspacing="0" cellpadding="0" border="1" rules="all" width="1000" class="rpt_table" style="margin-right: 17px;">
            <thead>
                <th width="30">SL</th>
                <th width="120">Company</th>
                <th width="130" align="center">Gate Pass No</th>
                <th width="50" align="center">Prefix</th>
                <th width="50" align="center">Year</th>
                <th width="100" align="center">Basis </th>
                <th width="80" align="center">Sent By</th>                    
                <th width="150" align="center">Sent To</th>
                <th width="80" align="center">Out Date</th>
                <th width="100" align="center">Challan No</th>
                <th align="center">App Status</th>
            </thead> 
        </table>
    </div>
    <div style="width:1020px;max-height:180px; overflow-y:scroll" id="sewing_production_list_view">
		<table cellspacing="0" cellpadding="0" border="1" rules="all" width="1000px" class="rpt_table" id="list_view">
        	<?
        	$i=1;
			$appStatusArr=array(0=>'Pending',3=>'Partial',1=>'Full');
			foreach($sqlResult as $selectResult)
			{				
				if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				$basis=$selectResult['BASIS'];
				$within_group=$selectResult['WITHIN_GROUP'];
				if ($basis==1)
				{ 
					if ($within_group==1) $send_to_company=$company_library[$selectResult['SENT_TO']];
					else $send_to_company=$selectResult['SENT_TO'];
				}
				else if($basis==16 || $basis==22 || $basis==20 || $basis==25 ||$basis==15 || $basis==1 || $basis==18 || $basis==19 || $basis==50)
				{ 
					if($within_group==1) $send_to_company=$company_library[$selectResult['SENT_TO']];
					else $send_to_company=$selectResult['SENT_TO'];
				}
				else if($basis==8 || $basis==9)
				{
					$send_to_company=$selectResult['SENT_TO'];	
				}
				else if ($basis==12)
				{
					if ($within_group==2) $send_to_company=$selectResult['SENT_TO'];
					else $send_to_company=$supplier_name_library[$selectResult['SENT_TO']];
				}
				else
				{
					if ($basis==2 || $basis==3 || $basis==4 || $basis==5 || $basis==6 || $basis==7 || $basis==10 || $basis==11 || $basis==13 ||  $basis==14 ||  $basis==21 ||  $basis==28 ||  $basis==38 || $basis==52)
					{
						if ($within_group==2) $send_to_company=$selectResult['SENT_TO'];
						else $send_to_company=$company_library[$selectResult['SENT_TO']];
					}
					else $send_to_company=$selectResult['SENT_TO'];
				}
				?>
        		<tr bgcolor="<? echo $bgcolor; ?>" style="text-decoration:none; cursor:pointer" onClick="js_set_value('<? echo $selectResult['ID']."_".$selectResult["SYS_NUMBER"]; ?>','','');" > 
                    <td width="30" align="center"><? echo $i; ?></td>
                    <td width="120" style="word-break:break-all"><?php echo $company_library[$selectResult['COMPANY_ID']];  ?></td>
                    <td width="130" style="word-break:break-all" align="center"><? echo $selectResult['SYS_NUMBER']; ?></td>
                    <td width="50" style="word-break:break-all" align="center"><?php echo $selectResult['SYS_NUMBER_PREFIX_NUM']; ?></td>
                    <td width="50" align="center"><? echo $selectResult['YEAR']; ?></td>
                    <td width="100" style="word-break:break-all" align="center"><?php echo $get_pass_basis[$selectResult['BASIS']]; ?></td>
                    <td width="80" style="word-break:break-all" align="center"><?php  echo $selectResult['SENT_BY']; ?></td>
                    <td width="150" style="word-break:break-all" align="center"><?php  echo $send_to_company; ?></td>
                    <td width="80" style="word-break:break-all" align="center"><?php echo change_date_format($selectResult['OUT_DATE']); ?></td>
                    <td width="100" style="word-break:break-all" align="center"><p><? echo $selectResult['CHALLAN_NO']; ?></td>                    
                    <td align="center"><? echo $appStatusArr[$selectResult['APPROVED']]; ?></td>                    
                </tr>
                <?
			    $i++;			   
			}
			?>
        </table>
    </div>
    <?	
	exit();
}

if($action == "against_returnable_gate_pass_popup")
{
	echo load_html_head_contents("Popup Info","../../", 1, 1, $unicode);
	extract($_REQUEST);  
	?>     
	<script>
		function js_set_value(str)
		{	
			//var str=str.split("_");
			//alert(str);		
			$("#hidden_gate_pass_number").val(str);
			//$("#hidden_gate_pass_id").val(str[0]);
			parent.emailwindow.hide(); 
		}
	</script>
	</head>
	<body>
		<div align="center" style="width:100%;" >
		<form name="searchorderfrm_1"  id="searchorderfrm_1" autocomplete="off">
			<table width="850" cellspacing="0" cellpadding="0" border="1" class="rpt_table" align="center" rules="all">
				<thead>
					<th width="130">Company</th>
					<th width="150">Basis</th>
					<th width="140">System ID</th>
					<th width="250">Date Range</th>
					<th><input type="reset" name="re_button" id="re_button" value="Reset" style="width:100px" class="formbutton"  /></th>           
				</thead>
				<tbody>
					<tr>
						<td><?php 
							echo create_drop_down( "cbo_company_name", 130, "select id,company_name from lib_company comp where status_active=1 and is_deleted=0  order by company_name","id,company_name", 1, "-- Select Company --", $cbo_company,"");
						?></td>
						<td>
							<? 
							//load_drop_down( 'requires/get_pass_entry_controller', this.value, 'load_drop_down_chalan', 'chalan_td');
							echo create_drop_down( "cbo_basis", 150, $get_pass_basis,"",1, "-- Select --", 0, "" ); 
							?> 
						
						</td>
						<td> <input name="txt_get_pass" id="txt_get_pass"  style="width:140px" class="text_boxes" /></td>
	
						<td align="center">
							<input name="txt_date_from" id="txt_date_from" class="datepicker" style="width:100px" placeholder="From Date" />
							<input name="txt_date_to" id="txt_date_to" class="datepicker" style="width:100px" placeholder="To Date" />
						</td> 
						<td align="center">
						<input type="button" name="btn_show" class="formbutton" value="Show" onClick="show_list_view ( document.getElementById('cbo_basis').value+'_'+document.getElementById('txt_get_pass').value+'_'+<? echo $cbo_sent_to;?>+'_'+<? echo $cbo_company;?>+'_'+document.getElementById('txt_date_from').value+'_'+document.getElementById('txt_date_to').value, 'create_against_gate_pass_list_view', 'search_div', 'get_pass_entry_controller', 'setFilterGrid(\'list_view\',-1)')" style="width:100px;" />				
						</td>
					</tr>
					<tr class="general">                  
						<td align="center" valign="middle" colspan="5">
							<? echo load_month_buttons(1);  ?>
							<input type="hidden" id="hidden_gate_pass_number" name="hidden_gate_pass_number" value="" />
							<input type="hidden" id="hidden_gate_pass_id" name="hidden_gate_pass_id" value="" />
						</td>
					</tr>    
				</tbody>
			</table>    
			<div align="center" valign="top" id="search_div"> </div> 
			</form>
		</div>
	</body>           
	<script src="../../includes/functions_bottom.js" type="text/javascript"></script>
	</html>
	<?
	exit();
}

if($action=="create_against_gate_pass_list_view")
{
	$ex_data = explode("_",$data);
	$basis =str_replace("'","",$ex_data[0]);
	$getpass_id = str_replace("'","",$ex_data[1]);
	$sentTo = str_replace("'","",$ex_data[2]);
	$company_id = str_replace("'","",$ex_data[3]);
	$fromDate = str_replace("'","",$ex_data[4]);
	$toDate= str_replace("'","",$ex_data[5]);
	//$cbo_within_group= str_replace("'","",$ex_data[6]);
 	
 	if($company_id !=0) $company_cond="and company_id = '$company_id'"; else $company_cond="";
	if( $basis!=0 )  $basis_cond=" and basis='$basis'"; else  $basis_cond="";
	if( $getpass_id!="" )  $get_cond=" and sys_number_prefix_num like '".$getpass_id."' "; else  $get_cond="";

	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );	
	
	$returnable_items ="select id,company_id,sys_number_prefix_num, sys_number,basis,within_group, sent_by, sent_to, out_date,challan_no,extract( year from insert_date) as year, department_id, carried_by,com_location_id,remarks,mobile_no from  inv_gate_pass_mst where  within_group=1 and company_id=$sentTo and sent_to='$company_id' and returnable=1  $get_cond $basis_cond and status_active=1 and is_deleted=0";
	$sqlResult = sql_select($returnable_items);
	?>
    <div style="width:870px;">
        <table cellspacing="0" cellpadding="0" border="1" rules="all" width="850" class="rpt_table" align="left">
            <thead>
                <th width="30">SL</th>
                <th width="120">Company</th>
                <th width="130" align="center">Gate Pass No</th>
                <th width="50" align="center">Year</th>
                <th width="100" align="center">Basis </th>
                <th width="80" align="center">Sent By</th>                    
                <th width="150" align="center">Sent  To</th>
                <th width="80" align="center">Out Date</th>
                <th align="center">Challan No</th>
            </thead> 
        </table>
    </div>
    <div style="width:870px;max-height:180px; overflow-y:scroll" id="sewing_production_list_view" >
		<table cellspacing="0" cellpadding="0" border="1" rules="all" width="850px" class="rpt_table" id="list_view">
			<?
			$i=1;
			foreach($sqlResult as $selectResult)
			{
				
				if ($i%2==0)  $bgcolor="#E9F3FF";
				else $bgcolor="#FFFFFF";
				$basis=$selectResult[csf('basis')];
				$within_group=$selectResult[csf('within_group')];					
				?>
	        	<tr bgcolor="<? echo $bgcolor; ?>" style="text-decoration:none; cursor:pointer" onClick="js_set_value('<? echo $selectResult[csf('id')]."_".$selectResult[csf("sys_number")]; ?>','','');" > 
					<td width="30" align="center"><? echo $i; ?></td>
					<td width="120"><?php echo $company_library[$selectResult[csf('company_id')]];  ?></td>
					<td width="130" align="center"><p><? echo $selectResult[csf('sys_number')]; ?></p></td>
					<td width="50" align="center"><p><? echo $selectResult[csf('year')]; ?></p></td>
					<td width="100" align="center"><p><?php echo $get_pass_basis[$selectResult[csf('basis')]]; ?></p></td>
					<td width="80" align="center"><p><?php  echo $selectResult[csf('sent_by')]; ?></p></td>
					<td width="150" align="center"><p><?php  echo $company_library[str_replace("'","",$selectResult[csf('sent_to')])]; ?></p></td>
					<td width="80" align="center"><p><?php echo change_date_format($selectResult[csf('out_date')]); //$serving_company; ?></p></td>
					<td width="" align="center"><p><? echo $selectResult[csf('challan_no')]; ?></p></td>				
				</tr>
               <?
			   $i++;
			   
			}
			?>
        </table>
    </div>
    <?	
	exit();
}

if($action=="populate_sent_data")
{
	$ex_data = explode("_",$data);
	$sys_no=$ex_data[0];
	$basis=$ex_data[1];
	$roll_type=$ex_data[2];
	//print_r($ex_data);
	if($basis==10 || $basis==11)
	{		
		if($roll_type==1) // roll
		{
			$sql_issue_dtls = "select company_id,knitting_source as knit_dye_source,knitting_company as  knit_dye_company from  pro_grey_prod_delivery_mst where status_active=1 and is_deleted=0 and sys_number='".$sys_no."' ";	
		}
		else
		{
			$sql_issue_dtls = "select company_id,knitting_source as knit_dye_source,knitting_company as  knit_dye_company from  pro_grey_prod_delivery_mst where status_active=1 and is_deleted=0 and sys_number='".$sys_no."' ";	
		}
	}
	/*else if($basis==11)
	{
		$sql_issue_dtls = "select a.id,b.grey_sys_number from  pro_grey_prod_delivery_mst a,pro_grey_prod_delivery_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and a.sys_number='".$sys_no."' group by a.id,b.grey_sys_number";	
	}*/
	else if($basis==8 || $basis==27)
	{
		$sql_issue_dtls = "select company_id,id,party_id,delivery_prefix_num, delivery_no,challan_no,vehical_no, within_group from  subcon_delivery_mst	where status_active=1 and is_deleted=0 and process_id in(2,4,3) and delivery_no='".$sys_no."' ";	
	}
	else if($basis==9)
	{
		$sql_issue_dtls = "select company_id,id,party_id,delivery_prefix_num, delivery_no,challan_no,vehical_no, within_group from  subcon_delivery_mst	where status_active=1 and is_deleted=0 and process_id in(2,4,3) and id='".$sys_no."' ";	
	}
	else if($basis==26) //SubCon Material Return
	{
		$sql_issue_dtls = "select company_id,id,party_id,prefix_no_num as delivery_prefix_num, sys_no as delivery_no,chalan_no as challan_no from  sub_material_mst	where status_active=1 and is_deleted=0 and trans_type in(3) and sys_no='".$sys_no."' ";	
	}
	else if($basis==64) //SubCon Material Receive Return
	{
		$sql_issue_dtls = "select company_id,id,party_id,prefix_no_num as delivery_prefix_num, sys_no as delivery_no,chalan_no as challan_no from  sub_material_return_mst where status_active=1 and is_deleted=0 and sys_no='".$sys_no."' ";	
	}
	else if($basis==12) //Garments Delivery
	{
		// $sql_issue_dtls = "select id,company_id,remarks,truck_no,forwarder,transport_supplier as trans_company_id from pro_ex_factory_delivery_mst where status_active=1 and is_deleted=0 and sys_number='".$sys_no."' ";	
		$sql_issue_dtls = "SELECT id, sys_number, company_id, location_id, challan_no, buyer_id, transport_supplier, delivery_date, lock_no, driver_name, truck_no,dl_no,destination_place,forwarder,forwarder_2,delivery_company_id,delivery_location_id,delivery_floor_id,attention,remarks,mobile_no, do_no, gp_no,source
		from  pro_ex_factory_delivery_mst where  is_deleted=0 and sys_number in('".$sys_no."') ";	
	}
	else if($basis==13 || $basis==55 || $basis==62 || $basis == 65) //Embelishment
	{
		$sql_issue_dtls = "select id,company_id,serving_company as knit_dye_company,production_source as knit_dye_source from pro_garments_production_mst where status_active=1 and is_deleted=0 and id in(".$sys_no.") ";	
	}
	else if($basis==14) //Cutting Delivery
	{
		$sql_issue_dtls = "select id,company_id,knitting_company as knit_dye_company,knitting_source as knit_dye_source from pro_cut_delivery_mst where status_active=1 and is_deleted=0 and  sys_number in('".$sys_no."') ";	
	}
	else if($basis==2) //Yarn Delivery
	{
		 $sql_issue_dtls="select company_id,knit_dye_source,knit_dye_company,issue_purpose,supplier_id as party_id,location_id, entry_form from inv_issue_master where  id in($sys_no) and status_active=1 and is_deleted=0";
	}
	else if($basis==28) //Sample Delivery
	{
		 $sql_issue_dtls="select company_id, location as location_id from sample_ex_factory_mst where  id in($sys_no) and status_active=1 and is_deleted=0";
	}
	else if($basis==33)//SubCon Embellishment Delivery
	{
		$sql_issue_dtls = "select company_id,id,party_id,delivery_prefix_num, delivery_no,challan_no,vehical_no from  subcon_delivery_mst	where status_active=1 and is_deleted=0 and entry_form=4 and delivery_no='".$sys_no."' ";	
	}
	else if($basis==59)
	{
		$sql_issue_dtls = "select company_id,id,party_id,delivery_prefix_num, delivery_no,challan_no,vehical_no from  trims_delivery_mst	where status_active=1 and is_deleted=0  and delivery_no='".$sys_no."' ";	
	}
	else if($basis==49)
	{
		$sql_issue_dtls = "select company_id, id, party_id, delivery_prefix_num, delivery_no, remarks from subcon_delivery_mst where status_active=1 and is_deleted=0  and delivery_no='".$sys_no."' ";	
	}
	else if($basis==50)
	{
		/* $sql_issue_dtls = "select id, entry_form, trims_del, del_no_prefix, del_no_prefix_num, company_id, location_id, within_group, party_id, party_location, currency_id,  delivery_date, receive_id, order_id, challan_no, gate_pass_no, remarks  from  trims_delivery_mst	where status_active=1 and is_deleted=0  and trims_del='".$sys_no."' ";*/
		 
		 $sql_issue_dtls = "select id, entry_form, trims_del, del_no_prefix, del_no_prefix_num, company_id, location_id, within_group, party_id, party_location, currency_id,  delivery_date, order_id, challan_no, gate_pass_no, remarks  from  trims_delivery_mst	where status_active=1 and is_deleted=0  and id in($sys_no) ";	
	}
	else if($basis==51)
	{
		 $sql_issue_dtls = "select company_id,id,party_id,delivery_prefix_num, delivery_no,challan_no,vehical_no,location_id,within_group from  subcon_delivery_mst	where status_active=1 and is_deleted=0 and entry_form=303 and delivery_no='".$sys_no."' ";
	}
	else if($basis==52)
	{
		 $sql_issue_dtls = "select id,entry_form,prefix_no,prefix_no_num,product_no,product_type,company_id,location_id,party_id,product_date,delivery_party,delv_party_location,remarks,within_group from  subcon_production_mst where status_active=1 and is_deleted=0 and entry_form=307 and product_no='".$sys_no."' ";
	}
	else if($basis==53) //Bundle Wise Cutting Delivery
	{
		$sql_issue_dtls = "SELECT id,company_id,serving_company as knit_dye_company,production_source as knit_dye_source from pro_gmts_delivery_mst where status_active=1 and is_deleted=0 and  sys_number in('".$sys_no."') ";	
	}
	else if($basis==56) //Wash Material Receive Return
	{
		$sql_issue_dtls = "select id, within_group, company_id, party_id, prefix_no_num as delivery_prefix_num, sys_no as delivery_no, chalan_no as challan_no from sub_material_mst where status_active=1 and is_deleted=0 and trans_type in(3) and entry_form=372 and sys_no='".$sys_no."' ";	
	}
	else if($basis==19 || $basis==34 || $basis==16 ) //Trims Transfer
	{
		 $sql_issue_dtls="select company_id,knit_dye_source,knit_dye_company,issue_purpose,supplier_id as party_id, entry_form from inv_issue_master where id in($sys_no) and status_active=1 and is_deleted=0";	
	}
	else if( $basis==17) //Grey Fabric Transfer
	{
		 $sql_issue_dtls="SELECT company_id, transfer_criteria as knit_dye_source, to_company as knit_dye_company, 0 as issue_purpose, 0 as party_id, entry_form from inv_item_transfer_mst where id in($sys_no) and status_active=1 and is_deleted=0";	
	}
	else if($basis==66) //Left Over Garments Issue
	{	
		$sql_issue_dtls = "SELECT id, sys_number, company_id, location_id, challan_no, buyer_id, transport_supplier, delivery_date, lock_no, driver_name, truck_no,dl_no,destination_place,forwarder,forwarder_2,delivery_company_id,delivery_location_id,delivery_floor_id,attention,remarks,mobile_no, do_no, gp_no,source
		from  pro_ex_factory_delivery_mst where  is_deleted=0 and sys_number in('".$sys_no."') ";	
	}
	else
	{
		$sql_issue_dtls="select company_id,knit_dye_source,knit_dye_company,issue_purpose,supplier_id as party_id, entry_form from inv_issue_master where  issue_number='$sys_no' and status_active=1 and is_deleted=0";
	}
	//echo  $sql_issue_dtls; die;
	$res = sql_select($sql_issue_dtls);
	//print_r($res);die;
	$supplier_lib=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	foreach($res as $row)
	{
	    //echo 'aaaaaaaaaaaaaaa';die;	
		$dying_source=$row[csf("knit_dye_source")];
		$dying_company=$row[csf("knit_dye_company")];
		if($row[csf("entry_form")]==5 || $row[csf("entry_form")]==21)
		{
			$issue_purpose=$general_issue_purpose[$row[csf("issue_purpose")]];
		}
		else
		{
			$issue_purpose=$yarn_issue_purpose[$row[csf("issue_purpose")]];
		}
		
		$party_id=$row[csf("party_id")];
		//$sql_dtls = "select a.id,b.grey_sys_number from  pro_grey_prod_delivery_mst a,pro_grey_prod_delivery_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and a.sys_number='".$sys_no."' group by a.id,b.grey_sys_number";	
		//echo $basis; die;
		if($basis==10 || $basis==11 || $basis==28)
		{ 
			//if($dying_source!=3){echo "load_drop_down( 'requires/get_pass_entry_controller',1+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n";}
			echo "load_drop_down( 'requires/get_pass_entry_controller',1+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n";
			echo "$('#cbo_company_name').val(".$row[csf("company_id")].");\n"; 
			//echo "$('#cbo_group').val(1);\n";
			echo  "$('#txt_sent_to').attr('disabled',false);\n";
			if($dying_source==3)
			{
			echo "$('#txt_sent_to').val(".$row[csf("company_id")].");\n";
			//echo "load_drop_down( 'requires/get_pass_entry_controller','".$row[csf("company_id")]."', 'load_drop_down_location', 'location_td' );";
			}
		}
		else if($basis==12)
		{
			$buyer_name_library_arr=return_library_array( "select id,buyer_name   from   lib_buyer ", "id", "buyer_name"  );
			$inhouse_company_name_arr=return_library_array( "select id,company_name   from   lib_company ", "id", "company_name"  );

			if($row[csf("within_group")]==2)
			{
				$delivery_company= $buyer_name_library_arr[$row[csf("delivery_company_id")]];
			}
			else
			{
				$delivery_company= $inhouse_company_name_arr[$row[csf("delivery_company_id")]];
			}			

			echo "load_drop_down( 'requires/get_pass_entry_controller',".$row[csf("company_id")].", 'load_drop_down_transport_com', 'sent_td');\n";
			echo "$('#cbo_company_name').val(".$row[csf("company_id")].");\n"; 
			echo "load_drop_down( 'requires/get_pass_entry_controller',2+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n";
			echo "$('#txt_vhicle_number').val('".$row[csf("truck_no")]."');\n";
			echo "$('#txt_do_no').val('".$row[csf("do_no")]."');\n";
			echo "$('#txt_mobile').val('".$row[csf("mobile_no")]."');\n";
			echo "$('#txt_driver_name').val('".$row[csf("driver_name")]."');\n";
			echo "$('#txt_driver_license_no').val('".$row[csf("dl_no")]."');\n";
			echo "$('#txt_security_lock_no').val('".$row[csf("lock_no")]."');\n";
			echo "$('#txt_delivery_company').val('".$delivery_company."');\n";
			echo "$('#txt_remarks_mst').val('".$row[csf("remarks")]."');\n";
			echo "$('#txt_attention').val('".$row[csf("attention")]."');\n";
			echo "load_drop_down( 'requires/get_pass_entry_controller',2+'_'+'".$row[csf("company_id")]."', 'load_drop_down_location', 'location_td' );";
			/*$drop_down_data=$row[csf("within_group")].'_'.$row[csf("company_id")];
			echo "load_drop_down( 'requires/get_pass_entry_controller','".$drop_down_data."', 'load_drop_down_location', 'location_td' );";*/
			echo "$('#cbo_group').val(2);\n";
			echo "$('#txt_sent_to').val('".$supplier_lib[$row[csf("forwarder")]]."');\n";
			echo  "$('#txt_sent_to').attr('disabled',false);\n";		
		}
		else if($basis==15 || $basis==29 || $basis==31 || $basis==32)
		{
			echo "$('#cbo_company_name').val(".$row[csf("company_id")].");\n"; 
			if($dying_source!=3){echo "load_drop_down( 'requires/get_pass_entry_controller',1+'_'+".$row[csf("company_id")].", 'load_drop_down_location', 'location_td' );";}
			if($dying_source!=3){echo "load_drop_down( 'requires/get_pass_entry_controller',1+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n";}
			echo "$('#txt_sent_to').val('".$row[csf("company_id")]."');\n"; 
			echo  "$('#txt_sent_to').attr('disabled',false);\n";
		}
		else if($basis==1)
		{
			echo "$('#txt_sent_to').val(".$sent_to.");\n";
		}
		else if($basis==27)
		{
			echo "$('#txt_vhicle_number').val('".$row[csf("vehical_no")]."');\n";
		}
		else if($basis==9)
		{
			$party_arr=return_library_array( "select id, buyer_name from lib_buyer",'id','buyer_name');
			echo "$('#cbo_company_name').val(".$row[csf("company_id")].");\n";
			echo "load_drop_down( 'requires/get_pass_entry_controller',2+'_'+'".$row[csf("company_id")]."', 'load_drop_down_location', 'location_td' );"; 
			echo "$('#txt_sent_to').val('".$party_arr[$party_id]."');\n";
			echo "$('#cbo_group').val(2);\n";
		}
		else
		{ 
			$buyer_name_library_arr=return_library_array( "select id,buyer_name from lib_buyer", "id", "buyer_name");
			$dyeing_company_library_arr=return_library_array( "select a.id,a.supplier_name from lib_supplier a, lib_supplier_party_type b where a.id=b.supplier_id  and a.status_active=1 group by a.id,a.supplier_name order by a.supplier_name ", "id", "supplier_name"  );

			//echo 'aaaaaaaaaaaaaaa'.$row[csf("entry_form")];die;
			echo "$('#cbo_issue_purpose').val('".$issue_purpose."');\n"; 
			echo "$('#hidden_purpose_id').val('".$row[csf("issue_purpose")]."');\n"; 
			echo "$('#hidden_entry_form').val('".$row[csf("entry_form")]."');\n"; 
			
			if($basis==8 || $basis==13 || $basis==23 || $basis==24 || $basis==64 || $basis==25 || $basis==26 || $basis==33 || $basis==37 || $basis==55 || $basis==62 || $basis==65 )
			{
				//echo "$('#cbo_group').val(2);\n";
				echo "$('#cbo_company_name').val(".$row[csf("company_id")].");\n"; 
				echo "load_drop_down( 'requires/get_pass_entry_controller',2+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n";
				echo "load_drop_down( 'requires/get_pass_entry_controller',2+'_'+'".$row[csf("company_id")]."', 'load_drop_down_location', 'location_td' );";
				echo "$('#txt_sent_to').val('".$buyer_name_library_arr[$party_id]."');\n";
				echo  "$('#txt_sent_to').attr('disabled',false);\n";
                if($basis == 23){
                    $sqlSuplliersDetails = sql_select("select supplier_name, address_1 from lib_supplier where id = ".$ex_data[3]);
                    echo "$('#txt_sent_to').val('".$sqlSuplliersDetails[0][csf('supplier_name')]."');\n";
                    echo "$('#cbo_group').val(2);\n";
                    echo "$('#cbo_location').val('".$sqlSuplliersDetails[0][csf('address_1')]."');\n";
                }
				else if($basis == 8){
					$sql_address = sql_select("select address_1 from lib_buyer where id = ".$party_id);
					echo "$('#cbo_group').val(2);\n";
					echo "$('#cbo_location').val('".$sql_address[0][csf('address_1')]."');\n";
				}
			}
			else
			{
				if($dying_source==1)
				{
				   	$within=1;
					//if($dying_source!=3){echo "load_drop_down( 'requires/get_pass_entry_controller',1+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n";}
					echo "load_drop_down( 'requires/get_pass_entry_controller',1+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n";
					echo "$('#txt_sent_to').val('".$dying_company."');\n"; 
					echo "$('#txt_sent_to').attr('hidd_id','".$dying_company."');\n"; 
					echo  "$('#txt_sent_to').attr('disabled',false);\n"; 	
					echo "load_drop_down( 'requires/get_pass_entry_controller',1+'_'+".$row[csf("company_id")].", 'load_drop_down_location', 'location_td' );";
				}
				else if($dying_source==3)
				{
					//echo $dying_source.'aziz';
					$within=1;
					//if($dying_source!=3){echo "load_drop_down( 'requires/get_pass_entry_controller',1+'_'+$basis, 'load_drop_down_sent', 'sent_td');\n";}
					echo "load_drop_down( 'requires/get_pass_entry_controller',1+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n";
					echo "$('#txt_sent_to').val('".$dying_company."');\n";
					//echo "$('#txt_sent_to').attr('hidd_id','".$dying_company."');\n"; 
					echo "$('#txt_sent_to').attr('hidd_id','0');\n"; 
					echo  "$('#txt_sent_to').attr('disabled',false);\n";
					echo "$('#cbo_company_name').val(".$row[csf("company_id")].");\n"; 
					//if($dying_source!=3){echo "load_drop_down( 'requires/get_pass_entry_controller',1+'_'+'".$row[csf("company_id")]."', 'load_drop_down_location', 'location_td' );";}		
					echo "load_drop_down( 'requires/get_pass_entry_controller',1+'_'+".$row[csf("company_id")].", 'load_drop_down_location', 'location_td' );";
				}
				else
				{
					echo "$('#txt_sent_to').val('".$dyeing_company_library_arr[$dying_company]."');\n";   
				}
			}
		}

		if($basis==3 || $basis==4 || $basis==6 || $basis==10 || $basis==11 || $basis==13 || $basis==14 || $basis==55 || $basis==62 || $basis == 65)
		{
			//echo  "$('#cbo_group').attr('disabled',true);\n";
			echo  "$('#txt_sent_to').attr('disabled',false);\n";
			if($dying_source==3)
			{
				echo  "$('#cbo_location').removeAttr('disabled','disabled');\n";	
				//$('#txt_ext_no').attr('disabled','disabled');
			}
			else
			{
				//echo  "$('#cbo_location').attr('disabled',false);\n";
				echo  "$('#cbo_location').attr('disabled','disabled');\n";	
			}
			echo "$('#hidden_sent_to_name').val('');\n";
			echo "$('#txt_sent_to').val('".$supplier_lib[$dying_company]."');\n";
			echo "$('#hidden_sent_to_name').val('".$dying_company."');\n";			
		}

		
		if($basis==13)
		{
			//echo  "$('#cbo_group').attr('disabled',true);\n";
			$inhouse_company_name_arr=return_library_array( "select id,company_name from lib_company","id","company_name");
			echo  "$('#txt_sent_to').attr('disabled',false);\n";
			if($dying_source==3)
			{
				echo "$('#cbo_group').val('2');\n";
				echo  "$('#cbo_location').removeAttr('disabled','disabled');\n";
				echo "$('#txt_sent_to').val('".$supplier_lib[$dying_company]."');\n";
			}
			else
			{
				echo "$('#cbo_group').val('1');\n";
				echo  "$('#cbo_location').attr('disabled','disabled');\n";
				echo "load_drop_down( 'requires/get_pass_entry_controller',1+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n";
				echo "$('#txt_sent_to').val('".$dying_company."');\n";
			}
			echo "$('#hidden_sent_to_name').val('');\n";
			echo "$('#hidden_sent_to_name').val('".$dying_company."');\n";
		}
		
		if($basis==2) //yarn
		{
			if($dying_source==1){$withinGrp=1;}else{$withinGrp=2;}
			echo "$('#cbo_group').val('".$withinGrp."');\n";
			
			if($withinGrp==2)
			{
				echo "load_drop_down( 'requires/get_pass_entry_controller', ".$withinGrp."+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n"; 
				echo "$('#txt_sent_to').val('".$supplier_lib[$dying_company]."');\n";
				echo "load_drop_down( 'requires/get_pass_entry_controller', ".$withinGrp."+'_'+".$dying_company.", 'load_drop_down_location', 'location_td' );";
				echo "$('#cbo_location').val('".$row[csf("location_id")]."');\n";
			}
			else
			{
				echo "load_drop_down( 'requires/get_pass_entry_controller', ".$withinGrp."+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n";
				echo "$('#txt_sent_to').val('".$dying_company."');\n"; 
				echo "load_drop_down( 'requires/get_pass_entry_controller', ".$withinGrp."+'_'+".$dying_company.", 'load_drop_down_location', 'location_td' );";
				echo "$('#cbo_location').val('".$row[csf("location_id")]."');\n";
			}
			echo "$('#hidden_sent_to_name').val('".$dying_company."');\n";			
		}
		
		if($basis==50) //trims
		{
			// $sql_issue_dtls = "select id, entry_form, trims_del, del_no_prefix, del_no_prefix_num, company_id, location_id, within_group, party_id, party_location, currency_id,  delivery_date, receive_id, order_id, challan_no, gate_pass_no, remarks  from  trims_delivery_mst	where status_active=1 and is_deleted=0  and id in($sys_no) ";	
			if($row[csf("within_group")]==1){$withinGrp=1;}else{$withinGrp=2;}
			echo "$('#cbo_group').val('".$row[csf("within_group")]."');\n";
			
			if($row[csf("within_group")]==2)
			{
				$party_id_lib=return_library_array( "select id, buyer_name from  lib_buyer", "id", "buyer_name");
				echo "load_drop_down( 'requires/get_pass_entry_controller', ".$withinGrp."+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n"; 
				echo "$('#txt_sent_to').val('".$party_id_lib[$party_id]."');\n";
			}
			else
			{
				echo "load_drop_down( 'requires/get_pass_entry_controller', ".$withinGrp."+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n";
				echo "$('#txt_sent_to').val('".$party_id."');\n"; 
			}
			echo "$('#hidden_sent_to_name').val('".$party_id."');\n";
			//echo "$('#txt_sent_to').val('".$row[csf("party_id")]."');\n";
		}
		
		if($basis==51) //wash delevery
		{
			// $sql_issue_dtls = "select id, entry_form, trims_del, del_no_prefix, del_no_prefix_num, company_id, location_id, within_group, party_id, party_location, currency_id,  delivery_date, receive_id, order_id, challan_no, gate_pass_no, remarks  from  trims_delivery_mst	where status_active=1 and is_deleted=0  and id in($sys_no) ";	
			if($row[csf("within_group")]==1){$withinGrp=1;}else{$withinGrp=2;}
			echo "$('#cbo_group').val('".$row[csf("within_group")]."');\n";
			
			if($row[csf("within_group")]==2)
			{
				$party_id_lib=return_library_array( "select id, buyer_name from  lib_buyer", "id", "buyer_name");
				echo "load_drop_down( 'requires/get_pass_entry_controller', ".$withinGrp."+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n"; 
				echo "$('#txt_sent_to').val('".$party_id_lib[$party_id]."');\n";
			}
			else
			{
				echo "load_drop_down( 'requires/get_pass_entry_controller', ".$withinGrp."+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n";
				echo "$('#txt_sent_to').val('".$party_id."');\n"; 
			}
			echo "$('#hidden_sent_to_name').val('".$party_id."');\n";
			//echo "$('#txt_sent_to').val('".$row[csf("party_id")]."');\n";
		}

		if($basis==49) //Printing delevery
		{
			echo "$('#txt_remarks_mst').val('".$row[csf("remarks")]."');\n";
		}

		if($basis==56) //Wash Material Receive Return
		{
			// $sql_issue_dtls = "select id, entry_form, trims_del, del_no_prefix, del_no_prefix_num, company_id, location_id, within_group, party_id, party_location, currency_id,  delivery_date, receive_id, order_id, challan_no, gate_pass_no, remarks  from  trims_delivery_mst	where status_active=1 and is_deleted=0  and id in($sys_no) ";	
			if($row[csf("within_group")]==1){$withinGrp=1;}else{$withinGrp=2;}
			echo "$('#cbo_group').val('".$row[csf("within_group")]."');\n";
			
			if($row[csf("within_group")]==2)
			{
				$party_id_lib=return_library_array( "select id, buyer_name from  lib_buyer", "id", "buyer_name");
				echo "load_drop_down( 'requires/get_pass_entry_controller', ".$withinGrp."+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n"; 
				echo "$('#txt_sent_to').val('".$party_id_lib[$party_id]."');\n";
			}
			else
			{
				echo "load_drop_down( 'requires/get_pass_entry_controller', ".$withinGrp."+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n";
				echo "$('#txt_sent_to').val('".$party_id."');\n"; 
			}
			echo "$('#hidden_sent_to_name').val('".$party_id."');\n";
			//echo "$('#txt_sent_to').val('".$row[csf("party_id")]."');\n";
		}

		if ($basis == 65)
		{
			echo "$('#txt_sent_to').val('');\n";
		}
	}
	exit();	
}

if($action=="populate_master_from_data")
{
	$sample_library=return_library_array( "select id, company_name from lib_company", "id", "company_name");
	$sample_supplier=return_library_array( "select id, supplier_name from lib_supplier", "id", "supplier_name");
	$sql="SELECT id, company_id, hidden_purpose_id, issue_purpose, location_id, location_name, com_location_id, carried_by, basis, department_id, section, sent_by, within_group, sent_to, out_date, challan_no, attention, returnable, time_hour, delivery_company, time_minute, delivery_as, est_return_date, remarks, do_no, mobile_no, vhicle_number, issue_id, returnable_gate_pass_reff, driver_name, driver_license_no, security_lock_no, ready_to_approved, challan_entry_form,APPROVED from inv_gate_pass_mst where sys_number='$data'";
	//echo $sql;	

	$res = sql_select($sql);
	foreach($res as $row)
	{
		$basis=$row[csf("basis")];
		$within_group=$row[csf("within_group")];
		echo "get_php_form_data( ".$row[csf("company_id")].", 'company_wise_report_button_setting','requires/get_pass_entry_controller');\n";
		echo "$('#cbo_company_name').val(".$row[csf("company_id")].");\n";
		echo "$('#cbo_basis').val(".$row[csf("basis")].");\n"; 
		echo "$('#cbo_department_name').val(".$row[csf("department_id")].");\n";
		echo "$('#cbo_section').val(".$row[csf("section")].");\n"; 
		echo "$('#txt_issue_no').val('".$row[csf("issue_id")]."');\n";  
		echo "$('#hidden_entry_form').val('".$row[csf("challan_entry_form")]."');\n"; 
		if($within_group==1) //Yes
		{
			echo "load_drop_down( 'requires/get_pass_entry_controller',".$within_group."+'_'+".$row[csf("sent_to")].", 'load_drop_down_location', 'location_td' );";
			echo "$('#cbo_location').val('".$row[csf("location_id")]."');\n";
		}
		else
		{
			//echo "load_drop_down( 'requires/get_pass_entry_controller','".$row[csf("company_id")]."', 'load_drop_down_location', 'location_td' );";
			echo "$('#cbo_location').val('".$row[csf("location_name")]."');\n";
		}
		
		echo "$('#cbo_group').val(".$row[csf("within_group")].");\n";
		echo "$('#txt_attention').val('".$row[csf("attention")]."');\n";	
		echo "$('#cbo_issue_purpose').val('".$row[csf("issue_purpose")]."');\n";
		echo "$('#hidden_purpose_id').val('".$row[csf("hidden_purpose_id")]."');\n";		
	    echo "$('#txt_return_date').val('".change_date_format($row[csf("est_return_date")])."');\n";	
		echo "$('#txt_sent_by').val('".$row[csf("sent_by")]."');\n";
		echo "load_drop_down( 'requires/get_pass_entry_controller','".$row[csf("company_id")]."', 'load_drop_down_com_location', 'com_location_td' );";
		echo "$('#cbo_com_location_id').val('".$row[csf("com_location_id")]."');\n";
		echo "$('#cbo_com_location_id').attr('disabled','true')" . ";\n";
		echo "$('#cbo_company_name').val(".$row[csf("company_id")].");\n";		
		
				
		if($basis==1) // Independant
		{ 	
			if($within_group==1)
			{ 
				$sample_library=return_library_array( "select id,company_name  from   lib_company  where status_active=1 and is_deleted=0 and id=".$row[csf("sent_to")]."", "id", "company_name"  );
				echo "load_drop_down( 'requires/get_pass_entry_controller', ".$row[csf("within_group")]."+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n"; 
				echo "$('#txt_sent_to').val('".$row[csf("sent_to")]."');\n";
				echo "load_drop_down( 'requires/get_pass_entry_controller', ".$row[csf("within_group")]."+'_'+".$row[csf("sent_to")].", 'load_drop_down_location', 'location_td' );";
				echo "$('#cbo_location').val('".$row[csf("location_id")]."');\n";	
			}
			else
			{
				echo "$('#txt_sent_to').val('".$row[csf("sent_to")]."');\n";
				echo "$('#cbo_location').val('".$row[csf("location_name")]."');\n";
			}
		}
		else if($basis==2 || $basis==3 || $basis==4 || $basis==5 || $basis==6 || $basis==7 || $basis==14 || $basis==15 || $basis==38) //Yarn
		{
			if( $within_group==1) //Yes
			{
				echo "load_drop_down( 'requires/get_pass_entry_controller', ".$row[csf("within_group")]."+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n"; 	
				echo "$('#txt_sent_to').val(".$row[csf("sent_to")].");\n";
				echo "$('#txt_sent_to').attr('hidd_id','0');\n";
			}
			else
			{
				echo "load_drop_down( 'requires/get_pass_entry_controller', ".$row[csf("within_group")]."+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n"; 
				echo "$('#txt_sent_to').val('".$row[csf("sent_to")]."');\n";
				echo "$('#txt_sent_to').attr('hidd_id','".$row[csf("sent_to")]."');\n";
			}
		}		
		else
		{
			if($within_group==1)
			{
				echo "load_drop_down( 'requires/get_pass_entry_controller', ".$row[csf("within_group")]."+'_'+".$basis.", 'load_drop_down_sent', 'sent_td');\n";
				echo "$('#txt_sent_to').val(".$row[csf("sent_to")].");\n";
			}
			else
			{
				echo "$('#txt_sent_to').val('".$row[csf("sent_to")]."');\n";	
			}
		}

		if($basis==3)
		{
			echo "document.getElementById('systemid_th').style.display = 'true';\n";	
		}
		else
		{
			echo "document.getElementById('systemid_th').style.display = 'none';\n";	
		}	
			
		echo "$('#txt_rece_date').val('".change_date_format($row[csf("out_date")])."');\n";	
		echo "$('#txt_chalan_no').val('".$row[csf("challan_no")]."');\n";
		echo "$('#cbo_returnable').val('".$row[csf("returnable")]."');\n";	
		echo "$('#cbo_delevery_as').val(".$row[csf("delivery_as")].");\n";
		echo "$('#txt_start_hours').val(".$row[csf("time_hour")].");\n";	
		echo "$('#txt_carried_by').val('".$row[csf("carried_by")]."');\n";	
		echo "$('#txt_start_minuties').val(".$row[csf("time_minute")].");\n"; 
		echo "$('#txt_remarks_mst').val('".$row[csf("remarks")]."');\n";
		echo "$('#txt_driver_name').val('".$row[csf("driver_name")]."');\n";
		echo "$('#txt_driver_license_no').val('".$row[csf("driver_license_no")]."');\n";
		echo "$('#txt_security_lock_no').val('".$row[csf("security_lock_no")]."');\n";
		echo "$('#txt_vhicle_number').val('".$row[csf("vhicle_number")]."');\n";
		echo "$('#txt_do_no').val('".$row[csf("do_no")]."');\n";
		echo "$('#txt_mobile').val('".$row[csf("mobile_no")]."');\n";	
		echo "$('#txt_returnable_gate_pass').val('".$row[csf("returnable_gate_pass_reff")]."');\n";	
		echo "$('#txt_delivery_company').val('".$row[csf("delivery_company")]."');\n";

		echo "$('#cbo_ready_to_approved').val('".$row[csf("ready_to_approved")]."');\n";
	
		echo "$('#update_id').val(".$row[csf("id")].");\n";	 
		
		$appStatusArr=array(0=>'Pending',3=>'Partial Approved',1=>'Full Approved');
		echo "document.getElementById('app_status_display').innerHTML = '<b style=\'color:red;\'>".$appStatusArr[$row[csf("APPROVED")]]."</b>';\n";		
	}
	exit();
}

if($action=="populate_returnable_master_from_data")
{
	$sql="select id, company_id,hidden_purpose_id,issue_purpose,location_id,location_name,com_location_id,carried_by,basis,department_id,section,sent_by,within_group,sent_to,out_date,challan_no,attention,returnable,time_hour,time_minute,delivery_as,est_return_date,remarks,do_no,mobile_no,vhicle_number from inv_gate_pass_mst where sys_number='$data'";
	//echo $sql;
	$sample_library=return_library_array( "select id,company_name  from   lib_company  where status_active=1 and is_deleted=0", "id", "company_name"  );
	$sample_supplier=return_library_array( "select id,supplier_name  from   lib_supplier  where status_active=1 and is_deleted=0", "id", "supplier_name"  );
	$res = sql_select($sql);
	foreach($res as $row)
	{	
		$basis=$row[csf("basis")];
		$within_group=$row[csf("within_group")];
		$sent_to=$row[csf("sent_to")];
		echo "$('#cbo_company_name').val(".$sent_to.");\n";
		echo "$('#cbo_basis').val(".$row[csf("basis")].");\n"; 
		//echo "$('#cbo_department_name').val(".$row[csf("department_id")].");\n";
		echo "$('#cbo_section').val(".$row[csf("section")].");\n";
		echo "$('#cbo_location').val('".$row[csf("location_id")]."');\n";
		echo "$('#cbo_group').val(".$row[csf("within_group")].");\n";
		echo "$('#txt_attention').val('".$row[csf("attention")]."');\n";	
		echo "$('#cbo_issue_purpose').val('".$row[csf("issue_purpose")]."');\n";
		echo "$('#hidden_purpose_id').val('".$row[csf("hidden_purpose_id")]."');\n";		
	    echo "$('#txt_return_date').val('".change_date_format($row[csf("est_return_date")])."');\n";	
		echo "$('#txt_sent_by').val('".$row[csf("sent_by")]."');\n";
		//echo "load_drop_down( 'requires/get_pass_entry_controller','".$row[csf("company_id")]."', 'load_drop_down_com_location', 'com_location_td' );";
		echo "$('#cbo_com_location_id').val(".$row[csf("com_location_id")].");\n";
		echo "$('#txt_sent_to').val(".$row[csf("company_id")].");\n";		
		echo "$('#txt_rece_date').val('".change_date_format($row[csf("out_date")])."');\n";	
		echo "$('#txt_chalan_no').val('".$row[csf("challan_no")]."');\n";
		echo "$('#cbo_delevery_as').val(".$row[csf("delivery_as")].");\n";
		echo "$('#txt_carried_by').val('".$row[csf("carried_by")]."');\n";	
		echo "$('#txt_remarks_mst').val('".$row[csf("remarks")]."');\n";
		echo "$('#txt_vhicle_number').val('".$row[csf("vhicle_number")]."');\n";
		echo "$('#txt_do_no').val('".$row[csf("do_no")]."');\n";
		echo "$('#txt_mobile').val('".$row[csf("mobile_no")]."');\n";	
	
		echo "$('#update_id').val(".$row[csf("id")].");\n";	  	
	}

	$com_location_id=return_field_value("com_location_id", " inv_gate_in_mst", "company_id='".$sent_to."' and gate_pass_no='$data' and returnable=1","com_location_id");
	if ($com_location_id>0){
		echo "$('#cbo_com_location_id').val(".$com_location_id.");\n";
	}
	exit();	
}

if($action=="chalan_id_popup")
{
  	echo load_html_head_contents("Popup Info","../../", 1, 1, $unicode);
	extract($_REQUEST); 
	//echo $basis;
	?>
	<script>
		function js_set_value(str)
		{
			$("#hidden_sys_number").val(str);
			//alert($("#hidden_sys_number").val());return;
			parent.emailwindow.hide(); 
		}
	</script>
	<?		
	if($basis==12 || $basis==13 || $basis==55 || $basis==62 || $basis==10 || $basis==19 || $basis==34 || $basis==16 || $basis==17 ||  $basis  == 65 ||  $basis  == 5 ||  $basis  == 18 ||  $basis  == 66 ||  $basis  == 15)
	{
		?>
		<script>
			function js_set_value13(str)
			{
				//alert(str);
				$("#hidden_sys_number").val(str);
				//alert($("#hidden_sys_number").val());return;
				parent.emailwindow.hide(); 
			}
		</script>
		<script type="text/javascript">
		var selected_id = new Array, selected_name = new Array(); selected_attach_id = new Array(); selected_dtls_id = new Array(); selected_issue_id = new Array();
	
		function toggle( x, origColor ) {
			var newColor = 'yellow';
			if ( x.style ) {
				x.style.backgroundColor = ( newColor == x.style.backgroundColor )? origColor : newColor;
			}
		}

		function check_all_data()
		{
			var row_num=$('#list_view tr').length-1;
			for(var i=1;  i<=row_num;  i++)
			{
				$("#tr_"+i).click();
			}				
		}

		function js_set_value5(id)
		{
			var str=id.split("_");
			toggle( document.getElementById( 'tr_' + str[0] ), '#FFFFFF' );
			var strdt=str[2];
			var str=str[1];

			if( jQuery.inArray(  str , selected_id ) == -1 ) {
				selected_id.push( str );
				selected_name.push( strdt );
			}
			else {
				for( var i = 0; i < selected_id.length; i++ ) {
					if( selected_id[i] == str  ) break;
				}
				selected_id.splice( i, 1 );
				selected_name.splice( i,1 );
			}
			var id = '';
			var ddd='';
			for( var i = 0; i < selected_id.length; i++ ) {
				id += selected_id[i] + ',';
				ddd += selected_name[i] + ',';
			}
			id = id.substr( 0, id.length - 1 );
			ddd = ddd.substr( 0, ddd.length - 1 );
			//alert(ddd)
			$('#txt_po_id').val( id );
			$('#txt_po_val').val( ddd );
		}

		function js_set_value18(id)
		{
			var str=id.split("_");
			var strdt=str[2];
			var entryForm=str[5];
			var dtls_id=str[4];
			var issue_id=str[1];
			str1=str[3];

			if(entryFormArr.length==0)
			{
				entryFormArr.push(entryForm);
			}
			else if( jQuery.inArray( entryForm, entryFormArr )==-1 &&  entryFormArr.length>0)
			{
				alert("To Company Mixed is Not Allow");
				return;
			}

			toggle( document.getElementById( 'tr_' + str[0] ), '#FFFFFF' );

			if( jQuery.inArray(  str1 , selected_id ) == -1 || jQuery.inArray(  strdt , selected_name ) == -1 || jQuery.inArray(  dtls_id , selected_dtls_id ) == -1 ) {

				selected_id.push( str1 );
				selected_name.push( strdt );
				selected_dtls_id.push( dtls_id );
				selected_issue_id.push( issue_id );
			}
			else {

				for( var i = 0; i < selected_id.length; i++ ) {
					if( selected_id[i] == str1 && selected_dtls_id[i] == dtls_id  ) break;
				}

				if(selected_id[i] == str1 && selected_dtls_id[i] == dtls_id && selected_name[i] == strdt)
				{
					selected_id.splice( i, 1 );
					selected_name.splice( i,1 );
					selected_dtls_id.splice( i,1 );
					selected_issue_id.splice( i,1 );
				}
			}
			var id = '';
			var ddd='';
			var issue='';

			for( var i = 0; i < selected_id.length; i++ ) {
				id += selected_id[i] + ',';
				ddd += selected_name[i] + ',';
				issue += selected_issue_id[i] + ',';
			}

			id = id.substr( 0, id.length - 1 );
			ddd = ddd.substr( 0, ddd.length - 1 );
			issue_no = issue.substr( 0, issue.length - 1 );

			$('#txt_po_id').val( id );
			$('#txt_po_val').val( ddd );
			$('#txt_issue_id').val( issue_no );
		}
			
		function js_set_value13(id)
		{
			//alert(id);
			var str=id.split("_");
			toggle( document.getElementById( 'tr_' + str[0] ), '#FFFFFF' );
			var strdt=str[2];
			var roltype=str[4];
			//alert(strdt)
			str=str[1];

			//alert(str);
			if( jQuery.inArray(  str , selected_id ) == -1 ) {
				selected_id.push( str );
				selected_name.push( strdt );
			}
			else {
				for( var i = 0; i < selected_id.length; i++ ) {
					if( selected_id[i] == str  ) break;
				}
				selected_id.splice( i, 1 );
				selected_name.splice( i,1 );
			}
			var id = '';
			var ddd='';
			for( var i = 0; i < selected_id.length; i++ ) {
				id += selected_id[i] + ',';
				ddd += selected_name[i] + ',';
			}
			id = id.substr( 0, id.length - 1 );
			ddd = ddd.substr( 0, ddd.length - 1 );
			//alert(ddd)
			$('#txt_po_id').val( id );
			$('#txt_po_val').val( ddd );
			$('#txt_rolltype_id').val( roltype );
		}

		var entryFormArr = new Array; //for check entry form mix			
		function js_set_value17(id)
		{
			//alert(id);
			var str=id.split("_");
			toggle( document.getElementById( 'tr_' + str[0] ), '#FFFFFF' );
			var strdt=str[2];
			var entryForm=str[4];
			str=str[1];
			if(entryFormArr.length==0)
			{
				entryFormArr.push(entryForm);
			}
			else if( jQuery.inArray( entryForm, entryFormArr )==-1 &&  entryFormArr.length>0)
			{
				alert("Entry Page Mixed is Not Allow");return;
			}
			//alert(str);
			if( jQuery.inArray(  str , selected_id ) == -1 ) {
				selected_id.push( str );
				selected_name.push( strdt );
			}
			else {
				for( var i = 0; i < selected_id.length; i++ ) {
					if( selected_id[i] == str  ) break;
				}
				selected_id.splice( i, 1 );
				selected_name.splice( i,1 );
				// entryFormArr.length=0;
			}
			var id = '';
			var ddd='';
			for( var i = 0; i < selected_id.length; i++ ) {
				id += selected_id[i] + ',';
				ddd += selected_name[i] + ',';
			}
			id = id.substr( 0, id.length - 1 );
			ddd = ddd.substr( 0, ddd.length - 1 );
			//alert(ddd)
			$('#txt_po_id').val( id );
			$('#txt_po_val').val( ddd );
			$('#txt_rolltype_id').val( entryForm );
		}

		function js_set_value21(id)
		{
			// alert(id);
			var str=id.split("_");
			toggle( document.getElementById( 'tr_' + str[0] ), '#FFFFFF' );
			var strdt=str[3];
			var roltype=str[4];
			str=str[1];

			//alert(str);
			if( jQuery.inArray(  str , selected_id ) == -1 ) {
				selected_id.push( str );
				selected_name.push( strdt );
			}
			else {
				for( var i = 0; i < selected_id.length; i++ ) {
					if( selected_id[i] == str  ) break;
				}
				selected_id.splice( i, 1 );
				selected_name.splice( i,1 );
			}
			var id = '';
			var ddd='';
			for( var i = 0; i < selected_id.length; i++ ) {
				id += selected_id[i] + ',';
				ddd += selected_name[i] + ',';
			}
			id = id.substr( 0, id.length - 1 );
			ddd = ddd.substr( 0, ddd.length - 1 );
			$('#txt_po_id').val( id );
			$('#txt_po_val').val( ddd );
			$('#txt_rolltype_id').val( roltype );
			// alert(id+'___'+ddd+'___'+roltype);
		} 
		</script>
		<?
	}

	if($basis==2 || $basis==21 || $basis==22 || $basis==57 || $basis==28 || $basis==3 || $basis==4 || $basis==8 || $basis==11 || $basis==50 || $basis==54 || $basis==60 || $basis==9 || $basis==63 || $basis==7) //Multi Challan Selection
	{
		?>
		<script>
			function js_set_value2(str)
			{
				// alert(str);
				$("#hidden_sys_number").val(str);
				//alert($("#hidden_sys_number").val())
				//parent.emailwindow.hide(); 
			}
		</script>
		<script type="text/javascript">
			var selected_id = new Array, selected_name = new Array(); selected_sys_id = new Array(); 
			selected_attach_id = new Array(); selected_supplier = new Array();

			function toggle( x, origColor ) {
				var newColor = 'yellow';
				if ( x.style ) {
					x.style.backgroundColor = ( newColor == x.style.backgroundColor )? origColor : newColor;
				}
			}

			function check_all_data()
			{
				var row_num=$('#list_view tr').length-1;
				for(var i=1;  i<=row_num;  i++)
				{
					$("#tr_"+i).click();
				}				
			}

			function js_set_value2(id)
			{
				var str=id.split("_");
				var supplierID=str[4];
				var roltype=str[5];
				var supplierID_prev=$('#txt_supplier_id').val();
				var supplierID_new=supplierID				
				
				<? 
				if($basis==2) 
				{ 
					?>					
					toggle( document.getElementById( 'tr_' + str[0] ), '#FFFFFF' );				
					<? 	
				}
				else
				{ 
					?>				
					if(supplierID_prev=="" || supplierID_prev==supplierID_new)
					{
						toggle( document.getElementById( 'tr_' + str[0] ), '#FFFFFF' );
					}
					else
					{
						alert('Please Match the Supplier/Party');
						return;
					} 
					<? 
				} 
				?>		
				//alert(supplierID);
				//toggle( document.getElementById( 'tr_' + str[0] ), '#FFFFFF' );
				var strdt=str[2];
				str=str[1];
				
				if( jQuery.inArray(  str , selected_id ) == -1 ) 
				{
					selected_id.push( str );
					selected_name.push( strdt );
					selected_supplier.push( supplierID );
				}
				else 
				{
					for( var i = 0; i < selected_id.length; i++ ) 
					{
						if( selected_id[i] == str  ) break;
					}
					selected_id.splice( i, 1 );
					selected_name.splice( i,1 );
					selected_supplier.splice( i,1 );
				}
				var id = '';
				var ddd='';
				supplier='';
				for( var i = 0; i < selected_id.length; i++ ) 
				{
					id += selected_id[i] + ',';
					ddd += selected_name[i] + ',';
					supplier = selected_supplier[i];
				}
				id = id.substr( 0, id.length - 1 );
				ddd = ddd.substr( 0, ddd.length - 1 );
				supplier = supplier.substr( 0, supplier.length  );
				//alert(id+'='+ddd+'='+supplier+'='+roltype);
				$('#txt_po_id').val( id );
				$('#txt_po_val').val( ddd );
				$('#txt_supplier_id').val( supplier );
				$('#txt_rolltype_id').val( roltype );
			}

			function js_set_value9(id)
			{
				var str=id.split("_");
				//alert(str[1]);
				var supplierID=str[4];
				var roltype=str[5];
				var supplierID_prev='';
				var supplierID_new=supplierID				
				
				<? 
				if($basis==2) 
				{ 
					?>
					<? 	
				}
				else 
				{ 
					?>				
					if(supplierID_prev=="" || supplierID_prev==supplierID_new)
					{
						toggle( document.getElementById( 'tr_' + str[0] ), '#FFFFFF' );
					}
					else
					{
						alert('Please Match the Supplier/Party');
						return;
					}					 
					<? 
				} 
				?>
		
				//alert(supplierID);
				//toggle( document.getElementById( 'tr_' + str[0] ), '#FFFFFF' );
				var strdt=str[2];
				str=str[1];
			
				if( jQuery.inArray(  str , selected_id ) == -1 ) 
				{
					selected_id.push( str );
					selected_name.push( strdt );
					selected_supplier.push( supplierID );
				}
				else 
				{
					for( var i = 0; i < selected_id.length; i++ ) 
					{
						if( selected_id[i] == str  ) break;
					}
					selected_id.splice( i, 1 );
					selected_name.splice( i,1 );
					selected_supplier.splice( i,1 );
				}
				var id = '';
				var ddd='';
				supplier='';
				
				for( var i = 0; i < selected_id.length; i++ ) 
				{					
					id += selected_id[i] + ',';
					ddd += selected_name[i] + ',';
					supplier = selected_supplier[i];					
				}
				id = id.substr( 0, id.length - 1 );
				ddd = ddd.substr( 0, ddd.length - 1 );
				// supplier = supplier.substr( 0, supplier.length  );
				// alert(id);
				// alert(id+'='+ddd+'='+supplier+'='+roltype);
				$('#txt_po_id').val( id );
				$('#txt_po_val').val( ddd );
				$('#txt_supplier_id').val( supplier );
				$('#txt_rolltype_id').val( roltype );
			}

			function js_set_value28(id) //Sample Delivery Challan, issue 6721
			{
				//alert('Second'+id);
				var str=id.split("_");
				var supplierID=str[4];
				var roltype=str[5];
				var supplierID_prev=$('#txt_supplier_id').val();
				var supplierID_new=supplierID				
				
				<? 
				if($basis==2) 
				{ 
					?>					
					toggle( document.getElementById( 'tr_' + str[0] ), '#FFFFFF' );				
					<? 	
				}
				else 
				{ 
					?>				
					if(supplierID_prev=="" || supplierID_prev==supplierID_new)
					{
						toggle( document.getElementById( 'tr_' + str[0] ), '#FFFFFF' );
					}
					else
					{
						alert('Please Match the Supplier/Party');
						return;
					} 
					<? 
				} 
				?>
		
				//alert(supplierID);
				//toggle( document.getElementById( 'tr_' + str[0] ), '#FFFFFF' );
				var strdt=str[2];
				var strSysId=str[3];
				str=str[1];
				
				if( jQuery.inArray(  str , selected_id ) == -1 ) 
				{
					selected_id.push( str );
					selected_sys_id.push( strSysId );
					selected_name.push( strdt );
					selected_supplier.push( supplierID );
				}
				else 
				{
					for( var i = 0; i < selected_id.length; i++ ) 
					{
						if( selected_id[i] == str  ) break;
					}
					selected_id.splice( i, 1 );
					selected_sys_id.splice( i,1 );
					selected_name.splice( i,1 );
					selected_supplier.splice( i,1 );
				}
				var id = '';
				var sysId='';
				var ddd='';
				supplier='';
				for( var i = 0; i < selected_id.length; i++ ) 
				{
					id += selected_id[i] + ',';
					sysId += selected_sys_id[i] + ',';
					ddd += selected_name[i] + ',';
					supplier = selected_supplier[i];
				}
				id = id.substr( 0, id.length - 1 );
				sysId = sysId.substr( 0, sysId.length - 1 );
				ddd = ddd.substr( 0, ddd.length - 1 );
				supplier = supplier.substr( 0, supplier.length  );
				//alert(id+'='+ddd+'='+sysId+'='+supplier+'='+roltype);
				var sysNum = ddd.split(',');
				var sys_num = sysNum.filter(onlyUnique);
				var sys_id = sysId.split(',');
				var sys_id = sys_id.filter(onlyUnique);
				//alert(sys_id);
				$('#txt_po_id').val( sys_id );
				$('#txt_po_val').val( sys_num );
				$('#txt_supplier_id').val( supplier );
				$('#txt_rolltype_id').val( roltype );
			}

			function js_set_value_new(id) //Multi challan
			{
				var str=id.split("_");
				var str_id=str[2];
				var strSysId=str[3];

				toggle( document.getElementById( 'tr_' + str[0] ), '#FFFFFF' );
				
				
				if( jQuery.inArray(  str_id , selected_id ) == -1 ) 
				{
					selected_id.push( str_id );
					selected_sys_id.push( strSysId );
				}
				else 
				{
					for( var i = 0; i < selected_id.length; i++ ) 
					{
						if( selected_id[i] == str_id  ) break;
					}
					selected_id.splice( i, 1 );
					selected_sys_id.splice( i,1 );
				}
				var id = '';
				var sysId='';
				for( var i = 0; i < selected_id.length; i++ ) 
				{
					id += selected_id[i] + ',';
					sysId += selected_sys_id[i] + ',';
				}

				id = id.substr( 0, id.length - 1 );
				sysId = sysId.substr( 0, sysId.length - 1 );

				$('#txt_po_id').val( id ); //dtls_id
				$('#txt_po_val').val( sysId ); // issue id
			}

			function onlyUnique(value, index, self) {
			    return self.indexOf(value) === index;
			}	
		</script>
		<?
	}
	?>
	<script type="text/javascript">
		function fnc_load_party_popup(type,within_group)
		{
			var company = <? echo $company ?>;
			var within_group = $('#cbo_roll_by').val();
			load_drop_down( 'get_pass_entry_controller', company+'_'+within_group, 'load_drop_down_buyer2', 'buyer_td' );
		}
	</script>	
	</head>
	<body>
		<div align="center" style="width:100%;" >
		<form name="searchorderfrm_1"  id="searchorderfrm_1" autocomplete="off">
			<table width="700" cellspacing="0" cellpadding="0" border="1" class="rpt_table" align="center" rules="all">
				<thead>
	                <?
					if($basis==50)
					{
						?>
						<th width="50">Within Group</th>
	                	<? 
					}
					else
					{
						?>
	                	<th width="50">Roll</th>
						<? 
					}
					?>
					<th width="120">Search By</th>
					<th width="150" id="search_by_td_up">Please Enter Challan No</th>
                     <th width="120">Party Name</th>
					<th width="150">Date Range</th>
					<th><input type="reset" name="re_button" id="re_button" value="Reset" style="width:80px" class="formbutton"  /></th>           
				</thead>
				<tbody>
					<tr class="general">
						<td>
							<input type="hidden" id="hidden_sys_number" value="hidden_sys_number" />
							<?
							//$roll_type=array(1=>"Yes",2=>"No");$cbo_roll_by
							//echo $disabled.test;
							//create_drop_down($field_id, $field_width, $query, $field_list, $show_select, $select_text_msg="", $selected_index="", $onchange_func="", $is_disabled="", $array_index="", $fixed_options="", $fixed_values="", $not_show_array_index="", $tab_index="", $new_conn="", $field_name="", $additionalClass="", $additionalAttributes="")
							if($basis==50)
							{
								echo create_drop_down( "cbo_roll_by", 50, $yes_no,"", 0, "--  --", 1, "fnc_load_party_popup(1,this.value);" ); 
							}
							else
							{								
								echo create_drop_down( "cbo_roll_by", 50, $yes_no,"",0, "--Select--",$variable_roll ,"",0 );
							}								
							?>
						</td>
						<td> 
							<?
							if($basis==13 || $basis == 65) $mmm=2;
							else if ($basis==55 || $basis==56 || $basis==62) $mmm=2;
							else if ($basis==55 || $basis==61 || $basis==62) $mmm=1;
							else $mmm="";
							if ($basis==60 || $basis==66) $srarch_arr=array(1=>"Issue ID");
							else if ($basis==61) $srarch_arr=array(1=>"System ID");
							else $srarch_arr=array(1=>"System ID",2=>"Challan No",3=>"Order No");
							$dd="change_search_event(this.value, '0*0*0*0*0*0', '0*0*0*0*0*0', '../../') ";
							echo create_drop_down( "cbo_search_by", 120, $srarch_arr,"",0, "--Select--", $mmm,$dd,0 );
							?>
						</td>
                        <td align="center" id="search_by_td">
                        	<input type="text" style="width:130px" class="text_boxes"  name="txt_search_common" id="txt_search_common" />
                        </td> 
                        <td id="buyer_td">
                           	<? echo create_drop_down( "cbo_party_name", 130, "","", 1, "-- select Party --", $data[2], "fnc_load_party_popup(1,this.value);" );   	 
                            ?>
                        </td>               	
						<td align="center">
							<input name="txt_date_from" id="txt_date_from" class="datepicker" style="width:60px" placeholder="From Date" />
							<input name="txt_date_to" id="txt_date_to" class="datepicker" style="width:60px" placeholder="To Date" />
						</td>						
						<td align="center">
						<input type="button" name="btn_show" class="formbutton" value="Show" onClick="show_list_view(document.getElementById('cbo_search_by').value+'_'+document.getElementById('txt_search_common').value+'_'+<? echo $company; ?>+'_'+<? echo $basis; ?>+'_'+document.getElementById('txt_date_from').value+'_'+document.getElementById('txt_date_to').value+'_'+document.getElementById('cbo_roll_by').value+'_'+document.getElementById('cbo_party_name').value, 'create_chalan_list_view', 'search_div', 'get_pass_entry_controller', 'setFilterGrid(\'list_view\',-1)')" style="width:80px;" />
						</td>
					</tr>
				</tbody>
			</table>    
			<div align="center" valign="top" id="search_div"></div> 
			</form>		
		</div>
	</body> 
	<script src="../../includes/functions_bottom.js" type="text/javascript">
	</script>
	</html>
	<?
	exit();
}

if($action=="create_chalan_list_view")
{
	$ex_data = explode("_",$data);
	$search_by = $ex_data[0];
	$chalan_id=trim($ex_data[1]);
	$company = str_replace("'","",$ex_data[2]);
	$basis = str_replace("'","",$ex_data[3]);
	$from_date = str_replace("'","",$ex_data[4]);
	$to_date = str_replace("'","",$ex_data[5]);
	$roll_type = str_replace("'","",$ex_data[6]);
	$party = str_replace("'","",$ex_data[7]);	
	// echo $roll_type; die;

	if($search_by==3)
	{
		if($chalan_id!='') $order_cond="and b.po_number='$chalan_id'"; else $order_cond='';
	}

	if($db_type==0) 
	{
		$from_date=change_date_format($from_date,'yyyy-mm-dd');
		$to_date=change_date_format($to_date,'yyyy-mm-dd');
	}
	else if($db_type==2) 
	{
		$from_date=change_date_format($from_date,'','',1);
		$to_date=change_date_format($to_date,'','',1);
	}
	//echo $issue_id.'aziz';
	if($chalan_id!="")
	{  
		if($search_by==1)
		{
			$iss_number_cond=" and issue_number_prefix_num in(trim(".$chalan_id.")) ";
			$subcon_delivery_cond=" and delivery_prefix_num in(trim(".$chalan_id.")) ";
			$cutting_delivery_cond=" and b.sys_number_prefix_num in(trim(".$chalan_id.")) ";
			$prefix_no_num_cond=" and prefix_no_num in(trim(".$chalan_id.")) ";//prefix_no_num, sys_no
			
		} 
		else
		{
			$iss_number_cond=" and challan_no=trim('".$chalan_id."') ";	
			$chalan_no_cond=" and chalan_no=trim('".$chalan_id."') ";	
		}
	} 
	else
	{
		if($search_by==1)
		{
			$iss_number_cond="";
			$cutting_delivery_cond="";	
			$prefix_no_num_cond="";
		}
		else
		{
			$iss_number_cond="";
			$chalan_no_cond="";
			$cutting_delivery_cond="";	
		}
	}
	//echo $chalan_no_cond;die;
	$con = connect();
	if($basis==10) //Grey Fabric Delivery to Store
	{
		?>
    	<input type="hidden" id="txt_po_id" />
		<input type="hidden" id="txt_po_val" />
        <input type="hidden" id="txt_supplier_id" />
        <input type="hidden" id="txt_rolltype_id" />
        <?
		if($roll_type==2)
		{
			$date_cond=$sys_cond="";
			if ($from_date!="" && $to_date!="" ) $date_cond= " and delevery_date  between '".$from_date."' and '".$to_date."'";			
			if ($chalan_id!="") $sys_cond="and sys_number_prefix_num like '$chalan_id'";
			if ($company>0) $sys_cond.=" and company_id=$company";
			$sql="select id, sys_number_prefix_num, sys_number, delevery_date from  pro_grey_prod_delivery_mst where status_active=1 and is_deleted=0 and entry_form=53 and sys_number not in (select challan_no from inv_gate_pass_mst where status_active=1 and is_deleted=0 and challan_no is not null ) $date_cond $sys_cond";
			//$arr=array(2=>$item_category);
			echo create_list_view("list_view", "Sys No prifix,Challan No,Delevery Date","150,120,70","540","260",0, $sql , "js_set_value13", "id,sys_number,sys_number", "", 1, "0,0,0,0,0", $arr, "sys_number_prefix_num,sys_number,delevery_date", "",'','0,0,3',"",1);
		}
		else
		{
			if($search_by==2 || $search_by==1)
			{
				if($chalan_id!="") $challan_cond=" and  a.sys_number_prefix_num in(trim(".$chalan_id."))";
			}
			
			$date_cond="";
			if ($from_date!="" && $to_date!="" ) $date_cond= " and a.delevery_date  between '".$from_date."' and '".$to_date."'";
			if ($company>0) $comp_cond=" and company_id=$company";
				 
			$sql = "select a.id, a.sys_number_prefix_num, a.sys_number, sum(b.current_delivery) current_delivery, a.knitting_source, a.delevery_date, 1 as roll_type_yes from pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b where a.id=b.mst_id and a.status_active=1 and b.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and a.entry_form=56 and sys_number not in (select challan_no from inv_gate_pass_mst where status_active=1 and is_deleted=0 and challan_no is not null )$comp_cond $challan_cond  $date_cond group by a.id, a.sys_number_prefix_num, a.sys_number, a.knitting_source, a.delevery_date order by a.delevery_date desc";
			
			$arr=array(2=>$knitting_source);
			echo create_list_view("list_view", "Challan No,Challan No prifix,Knittting Source,Delivery Date,Delivery Qty","150,70,150,80","580","300",0, $sql , "js_set_value13", "id,sys_number,sys_number,roll_type_yes", "", 1, "0,0,knitting_source,0,0", $arr, "sys_number,sys_number_prefix_num,knitting_source,delevery_date,current_delivery", "",'','0,0,0,3,0',"",1);
		}
	}
	else if($basis==11) //Finish Fabric Delivery to Store
	{
		?>
    	<input type="hidden" id="txt_po_id" />
		<input type="hidden" id="txt_po_val" />
        <input type="hidden" id="txt_supplier_id" />
        <input type="hidden" id="txt_rolltype_id" />
        <?
		$company_library=return_library_array( "select id,company_name  from   lib_company  where status_active=1 and is_deleted=0", "id", "company_name"  );
		if($roll_type==2)
		{
			$date_cond=$sys_cond="";
			if ($from_date!="" && $to_date!="" ) $date_cond= " and delevery_date  between '".$from_date."' and '".$to_date."'";			
			if ($chalan_id!="") $sys_cond="and sys_number_prefix_num like '$chalan_id'";
			if ($company>0) $sys_cond.=" and company_id=$company";			
			
			$sql="select id,sys_number_prefix_num,sys_number,delevery_date,company_id,2 as roll_type_yes from pro_grey_prod_delivery_mst where status_active=1 and is_deleted=0 and entry_form=54 $sys_cond";
			
			//$arr=array(2=>$item_category);
			echo create_list_view("list_view", "Sys No prifix,Challan No,Delevery Date","150,120,70","540","300",0, $sql , "js_set_value2", "id,sys_number,sys_number,company_id,roll_type_yes", "", 1, "0,0,0,0,0", $arr, "sys_number_prefix_num,sys_number,delevery_date", "",'','0,0,3','',1);	
		}
		else
		{
			if($search_by==2 || $search_by==1)
			{
				if($chalan_id!="") $challan_cond=" and  a.sys_number_prefix_num in(trim(".$chalan_id."))";
			}
			
			$date_cond="";
			if( $from_date!="" && $to_date!="" ) $date_cond= " and a.delevery_date  between '".$from_date."' and '".$to_date."'";
			if($company>0) $comp_cond=" and company_id=$company";
			
			//$sql = "select id, $year_field sys_number_prefix_num, sys_number, company_id, knitting_source, knitting_company, delevery_date from pro_grey_prod_delivery_mst where entry_form=67 and status_active=1 and is_deleted=0 $comp_cond $challan_cond  $date_cond order by id"; 
			$sql = "select a.id, a.sys_number_prefix_num, a.sys_number,sum(b.current_delivery) current_delivery, a.knitting_source,a.company_id, a.delevery_date,1 as roll_type_yes  from pro_grey_prod_delivery_mst a,pro_grey_prod_delivery_dtls b where a.id=b.mst_id and a.status_active=1 and b.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and a.entry_form=67 $comp_cond $challan_cond  $date_cond group by a.id, a.sys_number_prefix_num, a.sys_number, a.knitting_source,a.company_id, a.delevery_date order by a.delevery_date asc";
			
			$arr=array(2=>$knitting_source,3=>$company_library);			
			echo create_list_view("list_view", "Challan No,Challan No prifix,Knittting Source,Knittting Company,Delivery Date,Delivery Qty","150,70,150,80,80","680","300",0, $sql , "js_set_value2", "id,sys_number,sys_number,company_id,roll_type_yes", "", 1, "0,0,knitting_source,company_id,0,0", $arr, "sys_number,sys_number_prefix_num,knitting_source,company_id,delevery_date,current_delivery", "",'','0,0,0,0,3,0','',1);		
		}	
	}
	else if($basis==12) //Garments Delivery Entry/Return
	{
		$date_cond=$sys_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and delivery_date  between '".$from_date."' and '".$to_date."'";	
		if($chalan_id!="") $sys_cond="and sys_number_prefix_num like '$chalan_id'";
		?>		
		<input type="hidden" id="txt_po_id" />
		<input type="hidden" id="txt_po_val" />
		<input type="hidden" id="txt_supplier_id" />
        <input type="hidden" id="txt_rolltype_id" />
        <?	
		
		$sql="select id,sys_number_prefix_num,sys_number,delivery_date from pro_ex_factory_delivery_mst where status_active=1 and is_deleted=0 and company_id=".$company."  and is_gate_pass=0 $date_cond $sys_cond  order by id desc";	
		//$arr=array(2=>$item_category);
		echo create_list_view("list_view", "Sys No Prefix,Challan No,Delevery Date","150,120,70","540","300",0, $sql , "js_set_value21", "id,sys_number,sys_number", "", 1, "0,0,0,0,0", $arr, "sys_number_prefix_num,sys_number,delivery_date", "",'','0,0,3','',1);		
	}

	else if($basis==13) //Embellishment Issue Entry (Gross)
	{
		?>		
		<input type="hidden" id="txt_po_id" />
		<input type="hidden" id="txt_po_val" />
		<input type="hidden" id="txt_supplier_id" />
        <input type="hidden" id="txt_rolltype_id" />
        <?

        $date_cond="";
		if( $from_date!="" && $to_date!="" )
            $date_cond= " and a.production_date  between '".$from_date."' and '".$to_date."'";
        $sys_cond = '';
        if ($search_by==2) {
            if($chalan_id!="") $sys_cond = " and a.challan_no like '%".$chalan_id."%' ";
		}elseif ($search_by==3) {
            $order_id = return_library_array("select b.id as key, b.id as val from wo_po_break_down b, wo_po_details_master a where b.po_number = '".$chalan_id."' and a.company_name=".$company." and b.status_active=1 and b.is_deleted = 0 and b.job_no_mst = a.job_no group by b.id", "key","val");
            $order_id = implode(',',$order_id);
            if($order_id!='')
            {
                $sys_cond = " and a.po_break_down_id in($order_id) ";
            }
		}elseif($search_by == 1) {
            if($chalan_id!="") $sys_cond = " and a.id in($chalan_id) ";
        }

		$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
		$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
		$inhouse_company_name_arr=return_library_array( "select id,company_name   from   lib_company ", "id", "company_name"  );

		$delivery_id_arr=return_library_array("SELECT b.challan_no, b.challan_no as challan from inv_gate_pass_mst a, inv_gate_pass_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.challan_no is not null and a.basis in(13) and a.company_id=$company","challan_no","challan");

		if(count($delivery_id_arr>0))
		{
			$delivery_ids=implode(",", $delivery_id_arr);

			$deliveryIds_arr = array_unique(explode(",", $delivery_ids));			
			$all_delivery_ids_cond=""; $deliveryCond="";
			if($db_type==2 && count($deliveryIds_arr)>999)
			{
				$all_deliveryIds_arr_chunk=array_chunk($deliveryIds_arr,999) ;
				foreach($all_deliveryIds_arr_chunk as $chunk_arr)
				{
					$chunk_arr_value=implode(",",$chunk_arr);
					$deliveryCond.="  a.id not in($chunk_arr_value) or ";
				}
				$all_delivery_ids_cond.=" and (".chop($deliveryCond,'or ').")";
			}
			else
			{			
				if($delivery_ids ==''){
					$all_delivery_ids_cond="";
				}else{
					$all_delivery_ids_cond=" and a.id not in($delivery_ids)";
				}
			}
		}
		$sql="SELECT a.id,a.country_id,a.po_break_down_id as order_id,a.production_date,a.production_quantity,a.serving_company,a.location,a.challan_no, a.item_number_id 
		from  pro_garments_production_mst a where (a.production_type=2 or a.production_type=63) and a.company_id=".$company." and a.status_active=1 and a.is_deleted=0 $all_delivery_ids_cond $date_cond  $sys_cond order by a.id desc";
		//        echo $sql;
		$sql_po= sql_select($sql);
		$po_array_id=array();
		foreach($sql_po as $row)
		{
            $po_array_id[$row[csf("order_id")]]=$row[csf("order_id")];//rtrim($po_number_string,",");
		}
        $po_array = array(); $po_array_style=array(); $po_array_job=array(); $po_array_ship_date=array();
        if(count($po_array_id) > 0){
            $po_array_id = array_chunk($po_array_id, 900);
            $po_cond = "";
            foreach($po_array_id as $k => $v){
                if($k == 0)
                    $po_cond .= " b.id in (".implode(',', $v).")";
                else
                    $po_cond .= " or b.id in (".implode(',', $v).")";
            }
		//            $po_array=return_library_array( "select id,po_number from wo_po_break_down where $po_cond", "id", "po_number");
            $sql_po = sql_select("select b.id, a.job_no,a.style_ref_no,b.pub_shipment_date,b.po_number,b.job_no_mst from wo_po_details_master a, wo_po_break_down b  where a.id=b.job_id and a.status_active=1 and  a.is_deleted=0 and b.status_active=1 and  b.is_deleted=0  and ($po_cond) ");
            foreach($sql_po as $row)
            {
                $po_array_job[$row[csf("id")]]=$row[csf("job_no")];
                $po_array_style[$row[csf("id")]]=$row[csf("style_ref_no")];//rtrim($po_number_string,",");
                $po_array_ship_date[$row[csf("id")]]=$row[csf("pub_shipment_date")];
                $po_array[$row[csf("id")]] = $row[csf("po_number")];
            }
        }



        $arr=array(0=>$po_array_job,1=>$po_array_style,2=>$po_array,3=>$po_array_ship_date,4=>$country_arr,5=>$garments_item,8=>$inhouse_company_name_arr,9=>$location_library);
		echo create_list_view("list_view", "Job,Style,Po No,Ship Date,Country,Item Name,Prod. Date,Prod. Qty.,Serving Company,Location,Challan","100,100,100,80,100,120,70,70,130,100,100","1120","300",0, $sql , "js_set_value21", "id,id,id,id", "", 1, "order_id,order_id,order_id,order_id,country_id,item_number_id,0,0,serving_company,location,0", $arr, "order_id,order_id,order_id,order_id,country_id,item_number_id,production_date,production_quantity,serving_company,location,challan_no", "","","0,0,0,0,0,0,3,2,0,0,0","",1);	
	}

	else if($basis==55) //Embellishment Issue for Bundle - Printing
	{
		?>
		<input type="hidden" id="txt_po_id" />
		<input type="hidden" id="txt_po_val" />
		<input type="hidden" id="txt_rolltype_id" />
        <?
        $date_cond='';
		if ($from_date != '' && $to_date != '') $date_cond= " and a.production_date  between '".$from_date."' and '".$to_date."'";
		
		$sys_id_cond=$chalan_no_cond=$order_cond='';	
		if ($chalan_id != '')
		{
			if ($search_by==2) $chalan_no_cond=" and b.sys_number_prefix_num=$chalan_id";
			else if ($search_by==3)  $order_cond="and a.po_break_down_id in($order_id)";
			else $sys_id_cond=" and b.sys_number like '%$chalan_id'";
		}	

		$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
		$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
		$inhouse_company_name_arr=return_library_array( "select id,company_name   from   lib_company ", "id", "company_name"  );
		$po_number=return_library_array( "select id,po_number from wo_po_break_down", "id", "po_number");	
		
		$sql_po = sql_select("select b.id, a.job_no,a.style_ref_no,b.pub_shipment_date,b.po_number,b.job_no_mst from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0");
		$po_array_style=array();
		$po_array_job=array();
		$po_array_ship_date=array();
		foreach($sql_po as $row)
		{
			$po_array_job[$row[csf("id")]]=$row[csf("job_no")];
			$po_array_style[$row[csf("id")]]=$row[csf("style_ref_no")];//rtrim($po_number_string,",");	
			$po_array_ship_date[$row[csf("id")]]=$row[csf("pub_shipment_date")];
		} 

		$delivery_id_arr=return_library_array("SELECT b.challan_no, b.challan_no as challan from inv_gate_pass_mst a, inv_gate_pass_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.challan_no is not null and a.basis=55 and a.company_id=$company","challan_no","challan");
		//echo count($delivery_id_arr);
		if(count($delivery_id_arr)>0)
		{
			$delivery_ids=implode(",", $delivery_id_arr);

			$deliveryIds_arr = array_unique(explode(",", $delivery_ids));			
			$all_delivery_ids_cond=""; $deliveryCond="";
			if($db_type==2 && count($deliveryIds_arr)>999)
			{
				$all_deliveryIds_arr_chunk=array_chunk($deliveryIds_arr,999) ;
				foreach($all_deliveryIds_arr_chunk as $chunk_arr)
				{
					$chunk_arr_value=implode(",",$chunk_arr);
					$deliveryCond.="  a.id not in($chunk_arr_value) or ";
				}

				$all_delivery_ids_cond.=" and (".chop($deliveryCond,'or ').")";
			}
			else
			{
				$all_delivery_ids_cond=" and a.id not in($delivery_ids)";
			}

			//$all_delivery_ids_cond; die;
		}
		//echo $all_delivery_ids_cond;die;
		$sql_chal="SELECT a.id, a.country_id, a.po_break_down_id as order_id, a.production_date, a.production_quantity, a.serving_company, a.location, a.challan_no, a.item_number_id, b.sys_number from pro_garments_production_mst a, pro_gmts_delivery_mst b where a.delivery_mst_id=b.id and b.embel_name in(1) and a.production_type=2 and a.company_id=".$company." and a.status_active=1 and a.is_deleted=0 $all_delivery_ids_cond $date_cond $sys_id_cond $chalan_no_cond $order_cond";

		$sql_chal_res= sql_select($sql_chal);
		$po_array=array();
		foreach($sql_chal_res as $row)
		{
			$po_array[$row[csf("order_id")]]=$po_number[$row[csf("order_id")]];//rtrim($po_number_string,",");	
		}	

		$arr=array(0=>$po_array_job,1=>$po_array_style,2=>$po_array,3=>$po_array_ship_date,4=>$country_arr,5=>$garments_item,8=>$inhouse_company_name_arr,9=>$location_library);
				
		echo create_list_view("list_view", "Job,Style,Po No,Ship Date,Country,Item Name,Prod. Date,Prod. Qty.,Serving Company,Location,Challan","100,100,100,70,80,120,70,70,120,100,140","1120","300",0, $sql_chal , "js_set_value13", "id,sys_number", "", 1, "order_id,order_id,order_id,order_id,country_id,item_number_id,0,0,serving_company,location,0", $arr, "order_id,order_id,order_id,order_id,country_id,item_number_id,production_date,production_quantity,serving_company,location,sys_number", "","","0,0,0,0,0,0,3,2,0,0,0","",1);	
	}

	else if($basis==62) //Embellishment Issue for Bundle - Embrodary
	{
		?>
		<input type="hidden" id="txt_po_id" />
		<input type="hidden" id="txt_po_val" />
		<input type="hidden" id="txt_rolltype_id" />
        <?
        $date_cond='';
		if ($from_date != '' && $to_date != '') $date_cond= " and a.production_date  between '".$from_date."' and '".$to_date."'";
		
		$sys_id_cond=$chalan_no_cond=$order_cond='';
		if ($chalan_id != '')
		{
			if ($search_by==2) $chalan_no_cond=" and b.sys_number_prefix_num=$chalan_id";
			else if ($search_by==3)  $order_cond="and a.po_break_down_id in($order_id)";
			else $sys_id_cond=" and b.sys_number like '%$chalan_id'";
		}

		$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
		$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
		$inhouse_company_name_arr=return_library_array( "select id,company_name   from   lib_company ", "id", "company_name"  );
		$po_number=return_library_array( "select id,po_number from wo_po_break_down", "id", "po_number");		
		
		$sql_po = sql_select("select b.id, a.job_no,a.style_ref_no,b.pub_shipment_date,b.po_number,b.job_no_mst from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0");
		$po_array_style=array();
		$po_array_job=array();
		$po_array_ship_date=array();
		foreach($sql_po as $row)
		{
			$po_array_job[$row[csf("id")]]=$row[csf("job_no")];
			$po_array_style[$row[csf("id")]]=$row[csf("style_ref_no")];//rtrim($po_number_string,",");	
			$po_array_ship_date[$row[csf("id")]]=$row[csf("pub_shipment_date")];
		} 

		$delivery_id_arr=return_library_array("SELECT b.challan_no, b.challan_no as challan from inv_gate_pass_mst a, inv_gate_pass_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.challan_no is not null and a.basis=62 and a.company_id=$company","challan_no","challan");
		//echo count($delivery_id_arr);
		if(count($delivery_id_arr)>0)
		{
			$delivery_ids=implode(",", $delivery_id_arr);

			$deliveryIds_arr = array_unique(explode(",", $delivery_ids));			
			$all_delivery_ids_cond=""; $deliveryCond="";
			if($db_type==2 && count($deliveryIds_arr)>999)
			{
				$all_deliveryIds_arr_chunk=array_chunk($deliveryIds_arr,999) ;
				foreach($all_deliveryIds_arr_chunk as $chunk_arr)
				{
					$chunk_arr_value=implode(",",$chunk_arr);
					$deliveryCond.="  a.id not in($chunk_arr_value) or ";
				}

				$all_delivery_ids_cond.=" and (".chop($deliveryCond,'or ').")";
			}
			else
			{
				$all_delivery_ids_cond=" and a.id not in($delivery_ids)";
			}

			//$all_delivery_ids_cond; die;
		}
		//echo $all_delivery_ids_cond;die;
		$sql_chal="SELECT a.id, a.country_id, a.po_break_down_id as order_id, a.production_date, a.production_quantity, a.serving_company, a.location, a.challan_no, a.item_number_id, b.sys_number from pro_garments_production_mst a, pro_gmts_delivery_mst b where a.delivery_mst_id=b.id and b.embel_name in(2) and a.production_type=2 and a.company_id=".$company." and a.status_active=1 and a.is_deleted=0 $all_delivery_ids_cond $date_cond $sys_id_cond $chalan_no_cond $order_cond";

		$sql_chal_res= sql_select($sql_chal);
		$po_array=array();
		foreach($sql_chal_res as $row)
		{
			$po_array[$row[csf("order_id")]]=$po_number[$row[csf("order_id")]];//rtrim($po_number_string,",");	
		}	

		$arr=array(0=>$po_array_job,1=>$po_array_style,2=>$po_array,3=>$po_array_ship_date,4=>$country_arr,5=>$garments_item,8=>$inhouse_company_name_arr,9=>$location_library);
				
		echo create_list_view("list_view", "Job,Style,Po No,Ship Date,Country,Item Name,Prod. Date,Prod. Qty.,Serving Company,Location,Challan","100,100,100,70,80,120,70,70,120,100,140","1120","300",0, $sql_chal , "js_set_value13", "id,sys_number,", "", 1, "order_id,order_id,order_id,order_id,country_id,item_number_id,0,0,serving_company,location,0", $arr, "order_id,order_id,order_id,order_id,country_id,item_number_id,production_date,production_quantity,serving_company,location,sys_number", "","","0,0,0,0,0,0,3,2,0,0,0","",1);	
	}

    else if($basis==65) //Sewing Input
    {
        ?>
        <input type="hidden" id="txt_po_id" />
        <input type="hidden" id="txt_po_val" />
        <input type="hidden" id="txt_supplier_id" />
        <input type="hidden" id="txt_rolltype_id" />
        <?

        $date_cond="";
        if( $from_date!="" && $to_date!="" )
            $date_cond= " and a.production_date  between '".$from_date."' and '".$to_date."'";
        $sys_cond = '';
        if ($search_by==2) {
            if($chalan_id!="") $sys_cond = " and a.challan_no like '%".$chalan_id."%' ";
        }elseif ($search_by==3) {
            $order_id = return_library_array("select b.id as key, b.id as val from wo_po_break_down b, wo_po_details_master a where b.po_number = '".$chalan_id."' and a.company_name=".$company." and b.status_active=1 and b.is_deleted = 0 and b.job_no_mst = a.job_no group by b.id", "key","val");
            $order_id = implode(',',$order_id);
            if($order_id!='')
            {
                $sys_cond = " and a.po_break_down_id in($order_id) ";
            }
        }elseif($search_by == 1) {
            if($chalan_id!="") $sys_cond = " and a.id in($chalan_id) ";
        }

        $location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
        $country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
        $inhouse_company_name_arr=return_library_array( "select id,company_name   from   lib_company ", "id", "company_name"  );

        $delivery_id_arr=return_library_array("SELECT b.challan_no, b.challan_no as challan from inv_gate_pass_mst a, inv_gate_pass_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.challan_no is not null and a.basis in(13) and a.company_id=$company","challan_no","challan");

        if(count($delivery_id_arr>0))
        {
            $delivery_ids=implode(",", $delivery_id_arr);

            $deliveryIds_arr = array_unique(explode(",", $delivery_ids));
            $all_delivery_ids_cond=""; $deliveryCond="";
            if($db_type==2 && count($deliveryIds_arr)>999)
            {
                $all_deliveryIds_arr_chunk=array_chunk($deliveryIds_arr,999) ;
                foreach($all_deliveryIds_arr_chunk as $chunk_arr)
                {
                    $chunk_arr_value=implode(",",$chunk_arr);
                    $deliveryCond.="  a.id not in($chunk_arr_value) or ";
                }
                $all_delivery_ids_cond.=" and (".chop($deliveryCond,'or ').")";
            }
            else
            {
                if($delivery_ids ==''){
                    $all_delivery_ids_cond="";
                }else{
                    $all_delivery_ids_cond=" and a.id not in($delivery_ids)";
                }
            }
        }
        $sql="SELECT a.id,a.country_id,a.po_break_down_id as order_id,a.production_date,a.production_quantity,a.serving_company,a.location,a.challan_no, a.item_number_id 
		from  pro_garments_production_mst a where a.production_type=4 and a.company_id=".$company." and a.status_active=1 and a.is_deleted=0 $all_delivery_ids_cond $date_cond  $sys_cond order by a.id desc";
		//        echo $sql;
        $sql_po= sql_select($sql);
        $po_array_id=array();
        foreach($sql_po as $row)
        {
            $po_array_id[$row[csf("order_id")]]=$row[csf("order_id")];//rtrim($po_number_string,",");
        }
        $po_array = array(); $po_array_style=array(); $po_array_job=array(); $po_array_ship_date=array();
        if(count($po_array_id) > 0){
            $po_array_id = array_chunk($po_array_id, 900);
            $po_cond = "";
            foreach($po_array_id as $k => $v){
                if($k == 0)
                    $po_cond .= " b.id in (".implode(',', $v).")";
                else
                    $po_cond .= " or b.id in (".implode(',', $v).")";
            }
		//            $po_array=return_library_array( "select id,po_number from wo_po_break_down where $po_cond", "id", "po_number");
            $sql_po = sql_select("select b.id, a.job_no,a.style_ref_no,b.pub_shipment_date,b.po_number,b.job_no_mst from wo_po_details_master a, wo_po_break_down b  where a.job_no = b.job_no_mst and a.status_active=1 and  a.is_deleted=0 and b.status_active=1 and  b.is_deleted=0  and ($po_cond) ");
            foreach($sql_po as $row)
            {
                $po_array_job[$row[csf("id")]]=$row[csf("job_no")];
                $po_array_style[$row[csf("id")]]=$row[csf("style_ref_no")];//rtrim($po_number_string,",");
                $po_array_ship_date[$row[csf("id")]]=$row[csf("pub_shipment_date")];
                $po_array[$row[csf("id")]] = $row[csf("po_number")];;
            }
        }



        $arr=array(0=>$po_array_job,1=>$po_array_style,2=>$po_array,3=>$po_array_ship_date,4=>$country_arr,5=>$garments_item,8=>$inhouse_company_name_arr,9=>$location_library);
        echo create_list_view("list_view", "Job,Style,Po No,Ship Date,Country,Item Name,Prod. Date,Prod. Qty.,Serving Company,Location,Challan","100,100,100,80,100,120,70,70,130,100,100","1120","300",0, $sql , "js_set_value21", "id,id,id", "", 1, "order_id,order_id,order_id,order_id,country_id,item_number_id,0,0,serving_company,location,0", $arr, "order_id,order_id,order_id,order_id,country_id,item_number_id,production_date,production_quantity,serving_company,location,challan_no", "","","0,0,0,0,0,0,3,2,0,0,0","",1);
    }

	else if($basis==8) //SubCon Knitting Delivery
	{
		$date_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and delivery_date  between '".$from_date."' and '".$to_date."'";
		
		$sql = "select id, party_id, delivery_prefix_num, delivery_no, challan_no from  subcon_delivery_mst where status_active=1 and is_deleted=0 and company_id=".$company."  and process_id in(2) and id not in (select b.challan_no as challan_id from inv_gate_pass_mst a, inv_gate_pass_dtls b where a.id=b.mst_id and company_id=".$company." and a.basis=8 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.challan_no is not null ) $date_cond $subcon_delivery_cond";
	
		$arr=array(2=>$item_category);
		echo create_list_view("list_view", "Delivery No,Delivery No prifix,Challan No","150,70,120","540","300",0, $sql , "js_set_value9", "id,delivery_no,challan_no", "", 1, "0,0,0,0,0", $arr, "delivery_no,delivery_prefix_num,challan_no", "",'','','',1);
		?>
		<input type="hidden" id="txt_po_id" />
		<input type="hidden" id="txt_po_val" />
		<input type="hidden" id="txt_supplier_id" />
		<input type="hidden" id="txt_rolltype_id" />
		<?
	}

	else if($basis==26) //SubCon Material Return
	{
		$date_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and subcon_date  between '".$from_date."' and '".$to_date."'";
		
		$sql = "select id,party_id,prefix_no_num, sys_no,chalan_no,subcon_date  from  sub_material_mst	where status_active=1 and is_deleted=0 and company_id=".$company."  and trans_type in(3) and sys_no not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and challan_no is not null ) $date_cond $prefix_no_num_cond $chalan_no_cond ";
	
		$arr=array(2=>$item_category);
		echo create_list_view("list_view", "Delivery No,Delivery No prifix,Challan No, Subcon Date","150,70,120,100","640","300",0, $sql , "js_set_value", "id,sys_no,chalan_no", "", 1, "0,0,0,0,0", $arr, "sys_no,prefix_no_num,chalan_no,subcon_date", "",'','0,0,0,3');	
	}

	else if($basis==64) //SubCon Material Receive Return
	{
		$date_cond="";
		if ($from_date!="" && $to_date!="") $date_cond= " and return_date between '".$from_date."' and '".$to_date."'";		
		
		$sql = "select id, party_id, prefix_no_num, sys_no, chalan_no, return_date from sub_material_return_mst	where status_active=1 and is_deleted=0 and company_id=".$company."  and sys_no not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and challan_no is not null ) $date_cond $prefix_no_num_cond $chalan_no_cond";	
		
		echo create_list_view("list_view", "Return Number,Return No prifix,Challan No, Return Date","150,70,120,100","640","300",0, $sql , "js_set_value", "id,sys_no,chalan_no", "", 1, "0,0,0,0,0", "", "sys_no,prefix_no_num,chalan_no,return_date", "",'','0,0,0,3');	
	}
	
	else if($basis==27) //SubCon Garment Delivery
	{
		if($search_by==1)
		{
			if( $chalan_id!="" ) $subcon_delivery_cond ="and delivery_prefix_num='$chalan_id'"; else $subcon_delivery_cond ="";
		}
		else if($search_by==2)
		{
			if( $chalan_id!="" ) $subcon_delivery_cond ="and challan_no=$chalan_id"; else $subcon_delivery_cond ="";
		}
		else {}		
		
		$date_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and delivery_date  between '".$from_date."' and '".$to_date."'";
		
	 	$sql = "select id,party_id,delivery_prefix_num, delivery_no,challan_no from  subcon_delivery_mst where status_active=1 and is_deleted=0 and company_id=".$company."  and process_id in(3) $date_cond $subcon_delivery_cond ";
	
		$arr=array(2=>$item_category);
		echo create_list_view("list_view", "Delivery No,Delivery No prifix,Challan No","150,70,120","540","300",0, $sql , "js_set_value", "id,delivery_no,challan_no", "", 1, "0,0,0,0,0", $arr, "delivery_no,delivery_prefix_num,challan_no", "",'','');	
	}
	
	else if($basis==9) //SubCon Dyeing And Finishing Delivery
	{
		$date_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and delivery_date  between '".$from_date."' and '".$to_date."'";
		
		$sql = "select id,party_id,delivery_prefix_num, delivery_no,challan_no from  subcon_delivery_mst	where status_active=1 and is_deleted=0 and company_id=".$company."  and process_id in(4) and delivery_no not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and challan_no is not null )  $subcon_delivery_cond ";
		
		$arr=array(2=>$item_category);
		echo create_list_view("list_view", "Delivery No,Delivery No prifix,Challan No","150,70,120","540","300",0, $sql , "js_set_value9", "id,delivery_no,challan_no", "", 1, "0,0,0,0,0", $arr, "delivery_no,delivery_prefix_num,challan_no", "",'','','',1);	
		?><input type="hidden" id="txt_po_id" />
		<input type="hidden" id="txt_po_val" />
		<input type="hidden" id="txt_supplier_id" />
		<input type="hidden" id="txt_rolltype_id" />
		<?
	}

	else if($basis==14) //Cutting Delivery To Input Challan
	{
		$date_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and b.delivery_date  between '".$from_date."' and '".$to_date."'";
		
		$sql = "select b.id, a.po_break_down_id, a.item_number_id, a.country_id, a.cut_delivery_date, a.cut_delivery_qnty, a.location, a.challan_no, b.sys_number, b.sys_number_prefix_num from  pro_cut_delivery_order_dtls a,  pro_cut_delivery_mst b where a.delivery_mst_id=b.id and a.status_active=1 and a.is_deleted=0 and b.company_id=".$company." $cutting_delivery_cond order by id";
		// echo $sql;
		$arr=array(2=>$garments_item,3=>$item_category);
		echo create_list_view("list_view", "System No,Prefix No,Item Name,Challan No, Delivery Date,Delivery Qty.","150,70,130,120,80,70","700","300",0, $sql , "js_set_value", "id,sys_number,challan_no", "", 1, "0,0,item_number_id,0,0", $arr, "id,sys_number,item_number_id,challan_no,cut_delivery_date,cut_delivery_qnty", "",'','0,0,0,0,3,2');	
	}

	else if($basis==15) //Knit Finish Fabric Receive Return
	{
		?>		
		<input type="hidden" id="txt_po_id" />
		<input type="hidden" id="txt_po_val" />
		<input type="hidden" id="txt_supplier_id" />
        <input type="hidden" id="txt_rolltype_id" />
        <?

		$date_cond=$iss_number_cond="";
		if ($from_date!="" && $to_date!="") $date_cond= " and a.issue_date  between '".$from_date."' and '".$to_date."'";
		
		if ($chalan_id!='') $iss_number_cond=" and a.issue_number_prefix_num in(trim(".$chalan_id."))";
		 
		$sql = "SELECT a.id as issue_id, a.issue_number, a.issue_number_prefix_num, a.supplier_id, a.issue_date, a.item_category, a.received_id, a.received_mrr_no, b.id as trans_id, b.cons_quantity, c.product_name_details, c.id as prod_id from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id where a.id=b.mst_id and b.item_category=2 and b.transaction_type=3 and  a.company_id=".$company." and a.issue_number not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and challan_no is not null ) $iss_number_cond order by b.id";
		
		$arr=array(2=>$item_category);
		echo create_list_view("list_view", "System No,Prefix No,Category,Description, Cons Qty,Recv MRR No.","150,70,100,130,80,70","700","300",0, $sql , "js_set_value21", "issue_id,issue_number,received_mrr_no", "", 1, "0,0,item_category,0,0,0", $arr, "issue_number,issue_number_prefix_num,item_category,product_name_details,cons_quantity,received_mrr_no", "",'','0,0,0,0,1,0',"",1);	
	}

	else if($basis==16) //Yarn Transfer
	{
		?>
    	<input type="hidden" id="txt_po_id" />
		<input type="hidden" id="txt_po_val" />
        <input type="hidden" id="txt_rolltype_id" />
        <?
		$date_cond=$sys_no_cond=$challan_no_cond="";	
		if ($from_date!="" && $to_date!="") $date_cond= " and a.transfer_date  between '".$from_date."' and '".$to_date."'";
		if ($search_by==1 && $chalan_id!='') $sys_no_cond=" and a.transfer_system_id like '%$chalan_id%' ";
		if ($search_by==2 && $chalan_id!='') $challan_no_cond=" and a.challan_no = '$chalan_id' ";
		 
		$inhouse_company_name_arr=return_library_array( "select id,company_name   from   lib_company ", "id", "company_name"  );
			
		$sql = "SELECT a.id as yarn_trnsf_id,a.transfer_system_id,a.transfer_prefix_number,a.challan_no,a.to_company,a.transfer_date,a.item_category,b.id as dtls_id from inv_item_transfer_mst a,inv_item_transfer_dtls b where a.id=b.mst_id and a.status_active=1 and b.status_active=1 and a.transfer_system_id not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and challan_no is not null ) and a.item_category=1 and  a.company_id=".$company." $date_cond $sys_no_cond $challan_no_cond order by a.id desc";
			//inv_item_transfer_mst,inv_item_transfer_dtls,inv_transaction,product_details_master,inv_mrr_wise_issue_details
		
		$arr=array(2=>$item_category,4=>$inhouse_company_name_arr);
		// echo create_list_view("list_view", "Challan No,Transfer System ID,Category,Transfer Date,To Company","70,150,100,80","600","300",0, $sql , "js_set_value", "challan_no,transfer_system_id,yarn_trnsf_id", "", 1, "0,0,item_category,0,to_company", $arr, "challan_no,transfer_system_id,item_category,transfer_date,to_company", "",'','0,0,0,3,0');	
		echo create_list_view("list_view", "Challan No,Transfer System ID,Category,Transfer Date,To Company","70,150,100,80","600","300",0, $sql , "js_set_value13", "yarn_trnsf_id,transfer_system_id,challan_no,dtls_id", "", 1, "0,0,item_category,0,to_company", $arr, "challan_no,transfer_system_id,item_category,transfer_date,to_company", "",'','0,0,0,3,0',"",1);	

	}
	
	else if($basis==17) //Grey Fabric Transfer
	{
		?>
    	<input type="hidden" id="txt_po_id" />
		<input type="hidden" id="txt_po_val" />
        <input type="hidden" id="txt_rolltype_id" />
        <?
		$date_cond=$sys_no_cond=$challan_no_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and a.transfer_date  between '".$from_date."' and '".$to_date."'";
		if($search_by==1 &&  $chalan_id!='' ) $sys_no_cond=" and a.transfer_system_id like '%$chalan_id%'";
		if($search_by==2 &&  $chalan_id!='') $challan_no_cond=" and a.challan_no = '$chalan_id'";
		$challan_entry_form_cond="";
		if($roll_type==1)
		{
			$entry_form_cond=" and a.entry_form=82"; 
			$challan_entry_form_cond=" and challan_entry_form=82";
		}
		else 
		{
			$entry_form_cond=" and a.entry_form in (12,13)";
			$challan_entry_form_cond=" and challan_entry_form <> 82";
		}
		if($company>0) $comp_cond=" and a.company_id=$company";
		$inhouse_company_name_arr=return_library_array( "select id,company_name   from   lib_company ", "id", "company_name"  );
		$sql = "SELECT a.id as grey_trnsf_id, a.transfer_system_id, a.transfer_prefix_number, a.challan_no, a.to_company, a.transfer_date, a.item_category, a.entry_form from inv_item_transfer_mst a,inv_item_transfer_dtls b where a.id=b.mst_id and a.item_category=13 and a.transfer_system_id not in (select challan_no from inv_gate_pass_mst where status_active=1 and is_deleted=0 and BASIS = 17 and challan_no is not null $challan_entry_form_cond) $date_cond $sys_no_cond $challan_no_cond $entry_form_cond $comp_cond group by a.id, a.transfer_system_id, a.transfer_prefix_number, a.challan_no, a.to_company, a.transfer_date, a.item_category, a.entry_form";
		//product_details_master,inv_item_transfer_mst,inv_transaction,inv_item_transfer_dtls
		//echo $sql;
		$arr=array(2=>$item_category,4=>$inhouse_company_name_arr);
		echo create_list_view("list_view", "Challan No,Transfer System ID,Category,Transfer Date,To Company","70,150,100,80","600","300",0, $sql , "js_set_value17", "grey_trnsf_id,transfer_system_id,challan_no,entry_form", "", 1, "0,0,item_category,0,to_company", $arr, "challan_no,transfer_system_id,item_category,transfer_date,to_company", "",'','0,0,0,3,0',"",1);	
	}

	else if($basis==18) //General Item Transfer
	{
		?>
	    	<input type="hidden" id="txt_po_id" />
			<input type="hidden" id="txt_po_val" />
			<input type="hidden" id="txt_issue_id" />
        <?
		$date_cond=$sys_no_cond=$challan_no_cond="";
		if ($from_date!="" && $to_date!="") $date_cond= " and a.transfer_date  between '".$from_date."' and '".$to_date."'";
		if ($search_by==1 &&  $chalan_id!='') $sys_no_cond=" and a.transfer_system_id like '%$chalan_id%'";
		if ($search_by==2 &&  $chalan_id!='') $challan_no_cond=" and a.challan_no = '$chalan_id'";
		$inhouse_company_name_arr=return_library_array( "select id,company_name   from   lib_company ", "id", "company_name"  );
		$sql = "select a.id as gnrl_trnsf_id, b.id as dtls_id, a.transfer_system_id, a.transfer_prefix_number, a.challan_no, a.to_company, a.transfer_date, a.item_category from inv_item_transfer_mst a,inv_item_transfer_dtls b where a.id=b.mst_id and a.entry_form=57  and a.transfer_system_id not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and challan_no is not null and basis=18) and company_id=".$company." $date_cond $sys_no_cond $challan_no_cond";
		 //product_details_master,inv_item_transfer_mst,inv_transaction,inv_item_transfer_dtls,inv_mrr_wise_issue_details
		$arr=array(2=>$item_category,4=>$inhouse_company_name_arr);
		echo create_list_view("list_view", "Challan No,Transfer System ID,Category,Transfer Date,To Company","70,150,100,80","600","300",0, $sql , "js_set_value18", "challan_no,transfer_system_id,gnrl_trnsf_id,dtls_id,to_company,transfer_date", "", 1, "0,0,item_category,0,to_company", $arr, "challan_no,transfer_system_id,item_category,transfer_date,to_company", "",'','0,0,0,3,0','',1);	
	}

	else if($basis==19) //Trims Transfer
	{
		?>
    	<input type="hidden" id="txt_po_id" />
		<input type="hidden" id="txt_po_val" />
        <input type="hidden" id="txt_supplier_id" />
        <input type="hidden" id="txt_rolltype_id" />
        <?
        $date_cond=$sys_no_cond= $challan_no_cond="";
		if ($from_date!="" && $to_date!="") $date_cond= " and a.transfer_date  between '".$from_date."' and '".$to_date."'";
		if ($search_by==1 &&  $chalan_id!='' ) $sys_no_cond=" and a.transfer_system_id like '%$chalan_id%'";
		if ($search_by==2 &&  $chalan_id!='') $challan_no_cond=" and a.challan_no = '$chalan_id'";
		$inhouse_company_name_arr=return_library_array("select id,company_name   from   lib_company ", "id", "company_name");
		$sql = "SELECT a.id as trims_trnsf_id,b.id as dtls_id, a.transfer_system_id, a.transfer_prefix_number, a.challan_no, case when a.transfer_criteria = 2 and a.to_company = 0 then a.company_id else a.to_company end as to_company, a.transfer_date, b.item_category from inv_item_transfer_mst a,inv_item_transfer_dtls b where a.id=b.mst_id and a.entry_form in(78,112) and company_id=".$company." and  transfer_system_id not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and challan_no is not null ) $date_cond $sys_no_cond $challan_no_cond order by a.id desc";
		$arr=array(2=>$item_category,4=>$inhouse_company_name_arr);
		echo create_list_view("list_view", "Challan No,Transfer System ID,Category,Transfer Date,To Company","70,150,100,80","600","300",0, $sql , "js_set_value13", "trims_trnsf_id,transfer_system_id,challan_no,dtls_id", "", 1, "0,0,item_category,0,to_company", $arr, "challan_no,transfer_system_id,item_category,transfer_date,to_company", "",'','0,0,0,3,0',"",1);
	}

	else if($basis==20) //Dyes and Chemical Transfer
	{
		$date_cond=$sys_no_cond=$challan_no_cond="";
		if ($from_date!="" && $to_date!="") $date_cond= " and a.transfer_date  between '".$from_date."' and '".$to_date."'";
		if ($search_by==1 &&  $chalan_id!='' ) $sys_no_cond=" and a.transfer_system_id like '%$chalan_id%'";
		if ($search_by==2 &&  $chalan_id!='') $challan_no_cond=" and a.challan_no = '$chalan_id'";
		$inhouse_company_name_arr=return_library_array( "select id,company_name from lib_company ", "id", "company_name");
		$sql = "SELECT a.id as dys_chm_trnsf_id, b.id as dtls_id, a.transfer_system_id, a.transfer_prefix_number, a.challan_no, a.to_company, a.transfer_date, a.item_category from inv_item_transfer_mst a,inv_item_transfer_dtls b where a.id=b.mst_id and a.entry_form=55 $date_cond $sys_no_cond $challan_no_cond";
		 //product_details_master,inv_item_transfer_mst,inv_transaction,inv_item_transfer_dtls,inv_mrr_wise_issue_details,inv_store_wise_qty_dtls
		$arr=array(2=>$item_category,4=>$inhouse_company_name_arr);
		echo create_list_view("list_view", "Challan No,Transfer System ID,Category,Transfer Date,To Company","70,150,100,80","600","300",0, $sql , "js_set_value", "challan_no,transfer_system_id,dys_chm_trnsf_id,dtls_id", "", 1, "0,0,item_category,0,to_company", $arr, "challan_no,transfer_system_id,item_category,transfer_date,to_company", "",'','0,0,0,3,0');	
	}

	else if($basis==21) //Yarn Recv Return
	{
		?>
        <input type="hidden" id="txt_po_id" />
        <input type="hidden" id="txt_po_val" />
        <input type="hidden" id="txt_supplier_id" />
        <input type="hidden" id="txt_rolltype_id" />            
        <?
        $date_cond=$challan_no_cond=$sys_no_cond="";
		if ( $from_date!="" && $to_date!="") $date_cond= " and a.transfer_date  between '".$from_date."' and '".$to_date."'";
		if ($search_by==2 &&  $chalan_id!='') $challan_no_cond=" and a.challan_no = '$chalan_id'";
		if ($search_by==1 &&  $chalan_id!='') $sys_no_cond=" and a.issue_number like '%$chalan_id'";
		
		if ($from_date!="" && $to_date!="") 
		{
			if($db_type==0)
			{
				$sql_cond .= " and a.issue_date between '".change_date_format($from_date,'yyyy-mm-dd')."' and '".change_date_format($to_date,'yyyy-mm-dd')."'";
			}
			else
			{
				$sql_cond .= " and a.issue_date between '".change_date_format($from_date,'','',1)."' and '".change_date_format($to_date,'','',1)."'";
			}
		}
	
		if(trim($company)!="") $sql_cond .= " and a.company_id='$company'";
		
		if ($db_type==0) $year_field="YEAR(a.insert_date) as year,"; 
		else if($db_type==2) $year_field="to_char(a.insert_date,'YYYY') as year,";
		else $year_field="";//defined Later
		$inhouse_company_name_arr=return_library_array( "select id,company_name   from   lib_company ", "id", "company_name"  );
		$sql = "SELECT a.id, $year_field a.issue_number_prefix_num, a.issue_number as transfer_system_id, a.issue_number, a.challan_no, a.company_id, a.supplier_id, a.issue_date as transfer_date, a.item_category, a.received_id,a.received_mrr_no, sum(b.cons_quantity)as cons_quantity,a.is_posted_account from inv_issue_master a, inv_transaction b where a.id=b.mst_id and b.transaction_type=3 and a.status_active=1 and a.item_category=1 and b.item_category=1 and a.entry_form=8 $sql_cond $sys_no_cond and a.issue_number not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and challan_no is not null ) group by a.id, a.issue_number_prefix_num, a.issue_number,a.challan_no, a.company_id, a.supplier_id, a.issue_date, a.item_category, a.received_id, a.received_mrr_no, a.insert_date,a.is_posted_account order by a.id";

		$arr=array(2=>$item_category,4=>$inhouse_company_name_arr);

		echo create_list_view("list_view", "Challan No,Transfer System ID,Category,Transfer Date,Company","70,150,100,80","600","300",0, $sql , "js_set_value2", "id,issue_number,challan_no,supplier_id", "", 1, "0,0,item_category,0,company_id", $arr, "challan_no,transfer_system_id,item_category,transfer_date,company_id", "",'','0,0,0,3,0','',1);	
	}

	else if($basis==30) //Fabric Service Receive Return
	{
		if ($basis==22) $entry_form=91; 
		else $entry_form=206;
		$date_cond=$sys_no_cond="";
		if($search_by==1 &&  $chalan_id!='' ) $sys_no_cond=" and recv_number_prefix_num like '%$chalan_id'";

		if($start_date!="" && $end_date!="")
		{
			if($db_type==0)
			{
				$date_cond="and receive_date between '".change_date_format(trim($from_date), "yyyy-mm-dd", "-")."' and '".change_date_format(trim($to_date), "yyyy-mm-dd", "-")."'";
			}
			else
			{
				$date_cond="and receive_date between '".change_date_format(trim($from_date),'','',1)."' and '".change_date_format(trim($to_date),'','',1)."'";
			}
		}

		$inhouse_company_name_arr=return_library_array( "select id,company_name   from   lib_company ", "id", "company_name"  );
		
		$sql = "select id,recv_number_prefix_num,  dyeing_source,recv_number, company_id, receive_date from inv_receive_mas_batchroll where entry_form=$entry_form and status_active=1 and is_deleted=0 and company_id=$company $sys_no_cond $date_cond $mstIds order by id"; 
			
		$arr=array(2=>$item_category,4=>$inhouse_company_name_arr);
		echo create_list_view("list_view", "Challan No,System ID,Category,Issue Date,Company","70,150,100,80","600","300",0, $sql , "js_set_value", "id,recv_number,dys_chm_trnsf_id,dtls_id", "", 1, "0,0,item_category,0,company_id", $arr, "challan_no,recv_number,item_category,receive_date,company_id", "",'','0,0,0,3,0');	
		exit();	
	}

	else if($basis==22) //Fabric Issue to Finish Process
	{
		?>
        <input type="hidden" id="txt_po_id" />
        <input type="hidden" id="txt_po_val" />
        <input type="hidden" id="txt_supplier_id" />
        <input type="hidden" id="txt_rolltype_id" />            
        <?
        $date_cond=$sys_no_cond="";
		if($search_by==1 &&  $chalan_id!='' ) $sys_no_cond=" and recv_number_prefix_num like '%$chalan_id' ";
		if ($from_date!="" && $to_date!="")
		{
			if($db_type==0)
			{
				$date_cond="and receive_date between '".change_date_format(trim($from_date), "yyyy-mm-dd", "-")."' and '".change_date_format(trim($to_date), "yyyy-mm-dd", "-")."'";
			}
			else
			{
				$date_cond="and receive_date between '".change_date_format(trim($from_date),'','',1)."' and '".change_date_format(trim($to_date),'','',1)."'";
			}
		}

		//$con = connect();
		$sql_challan_res=sql_select("select challan_no from inv_gate_pass_mst where basis=22 and status_active=1 and is_deleted=0 and challan_no is not null");
		foreach ($sql_challan_res as $val) {
			$challan .= $val[csf('challan_no')].',';
		}
		$challanNo=rtrim($challan,',');
		$ex_challanNo=explode(',', $challanNo);
		$tot_rows=0;
		foreach ($ex_challanNo as $challan) {
			$challan_no.="'".$challan."'".',';
			$tot_rows++;
		}
		
		if ($challanNo != '')
	    {
	        $challan_nos = explode(',', rtrim($challan_no,','));
	        $challan_no_cond = '';

	        if($db_type==2 && $tot_rows>1000)
	        {
	            $challan_no_cond = ' and (';
	            $challan_noArr = array_chunk($challan_nos,999);
	            foreach($challan_noArr as $chalan)
	            {
	                $chalan = implode(',',$chalan);
	                $challan_no_cond .= " recv_number not in($chalan) and ";
	            }
	            $challan_no_cond = rtrim($challan_no_cond,'and ');
	            $challan_no_cond .= ')';
	        }
	        else
	        {
	            $challan_nos = implode(',', $challan_nos);
	            $challan_no_cond=" and recv_number not in ($challan_nos)";
	        }
	    } 

	    $inhouse_company_name_arr=return_library_array( "select id,company_name   from   lib_company ", "id", "company_name"  ); 

		$sql = "select id, recv_number_prefix_num, dyeing_source, recv_number, company_id, receive_date from inv_receive_mas_batchroll where entry_form=91 and status_active=1 and is_deleted=0 and company_id=$company $sys_no_cond $date_cond $mstIds $challan_no_cond order by id DESC";
			
		$arr=array(2=>$item_category,4=>$inhouse_company_name_arr);
		echo create_list_view("list_view", "Challan No,System ID,Category,Issue Date,Company","70,150,100,80","600","300",0, $sql , "js_set_value2", "id,recv_number,dys_chm_trnsf_id,dtls_id", "", 1, "0,0,item_category,0,company_id", $arr, "challan_no,recv_number,item_category,receive_date,company_id", "",'','0,0,0,3,0','',1) ;	
		exit();				
	}

	else if($basis==28) //Sample Delivery Challan
	{
		?>
        <input type="hidden" id="txt_po_id" />
        <input type="hidden" id="txt_po_val" />
        <input type="hidden" id="txt_supplier_id" />   
        <input type="hidden" id="txt_rolltype_id" />         
        <?
        $date_cond=$sys_no_cond="";
		if ($from_date!="" && $to_date!="") $date_cond= " and a.ex_factory_date  between '".$from_date."' and '".$to_date."'";
		if ($search_by==1 &&  $chalan_id!='' ) $sys_no_cond=" and a.sys_number like '%$chalan_id'";
		if( $from_date!="" && $to_date!="" ) 
		{
			if($db_type==0)
			{
				$sql_cond .= " and a.ex_factory_date between '".change_date_format($from_date,'yyyy-mm-dd')."' and '".change_date_format($to_date,'yyyy-mm-dd')."'";
			}
			else
			{
				$sql_cond .= " and a.ex_factory_date between '".change_date_format($from_date,'','',1)."' and '".change_date_format($to_date,'','',1)."'";
			}
		}
	
		if (trim($company)!="") $sql_cond .= " and a.company_id='$company'";		
		if ($db_type==0) $year_field="YEAR(a.insert_date) as year,"; 
		else if($db_type==2) $year_field="to_char(a.insert_date,'YYYY') as year,";
		else $year_field="";//defined Later

		$data_array = sql_select("SELECT a.id from sample_ex_factory_mst a, sample_ex_factory_dtls b, sample_development_mst c where a.id=b.sample_ex_factory_mst_id and b.sample_development_id=c.id and a.status_active=1 and (a.entry_form_id=132 or a.entry_form_id=551 or a.entry_form_id=544) $sql_cond $sys_no_cond group by a.id order by a.id");
        $challan_id = array();
		$inserted_barcode = array();
		foreach ($data_array as $val) 
		{
			$challan_id[$val[csf('id')]] = $val[csf('id')];
		}
		if(!empty($challan_id))
		{
			$challan_ids = implode(",", $challan_id);
			$chalanCond = $chalan_check = "";
			if($db_type==2 && count($challan_id)>999)
			{
				$chalan_arr_chunk=array_chunk($challan_id,999) ;
				foreach($chalan_arr_chunk as $chunk_arr)
				{
					$chalanCond.=" b.CHALLAN_NO in(".implode(",",$chunk_arr).") or ";
				}
				$chalan_check.=" and (".chop($chalanCond,'or ').")";
			}
			else
			{
				$chalan_check=" and b.CHALLAN_NO in($challan_ids)";
			}

			$inserted_gatePass = sql_select("SELECT b.challan_no from inv_gate_pass_mst a, INV_GATE_PASS_DTLS b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.basis=28 and a.company_id=$company $chalan_check group by b.challan_no");
		}
		else
		{
			echo "No data found";
			die;
		}
		if (!empty($inserted_gatePass)) 
		{
			$gate_passs_check=array();
			foreach ($inserted_gatePass as $b_id) 
			{
				$gate_passs_check[$b_id[csf('challan_no')]] = $b_id[csf('challan_no')];
			}

		} // end if inserted_gatePass
		$challan_id2=array();
		foreach ($challan_id as $barcode_key=> $barcode) 
		{
			if($gate_passs_check[$barcode_key]=="")
			{
				$challan_id2[$barcode_key]=$barcode_key;
			}

		}
		$all_challan_id = implode(",", $challan_id2);
		$challanCond2 = $all_challan_id_cond = "";
		if($db_type==2 && count($challan_id2)>999)
		{
			$all_challan_id_arr_chunk2=array_chunk($challan_id2,999) ;
			foreach($all_challan_id_arr_chunk2 as $chunk_arr)
			{
				$challanCond2.=" a.id in(".implode(",",$chunk_arr).") or ";
			}
			$all_challan_id_cond.=" and (".chop($challanCond2,'or ').")";
		}
		else
		{
			$all_challan_id_cond=" and a.id in($all_challan_id)";
		}
		//echo $all_challan_id_cond;die;
		$sql = "SELECT a.id, $year_field a.sys_number_prefix_num, a.sys_number as sys_number,a.company_id, a.delivery_basis,a.ex_factory_date as ex_factory_date, sum(b.ex_factory_qty)as cons_quantity, c.requisition_number_prefix_num, c.buyer_name, c.style_ref_no 
		from sample_ex_factory_mst a, sample_ex_factory_dtls b, sample_development_mst c 
		where a.id=b.sample_ex_factory_mst_id and b.sample_development_id=c.id and a.status_active=1 and (a.entry_form_id=132 or a.entry_form_id=551 or a.entry_form_id=544) $sql_cond $sys_no_cond $all_challan_id_cond
		group by a.id, a.sys_number_prefix_num, a.sys_number, a.company_id,a.delivery_basis,a.ex_factory_date,a.insert_date, c.requisition_number_prefix_num, c.requisition_number, c.buyer_name, c.style_ref_no order by a.id desc";
		//        echo $sql;
		$buyer_arr = return_library_array( "select id, buyer_name from  lib_buyer",'id','buyer_name');
		$inhouse_company_name_arr=return_library_array( "select id,company_name   from   lib_company ", "id", "company_name"  );
		$arr=array(2=>$inhouse_company_name_arr,6=>$sample_delivery_basis,4=>$buyer_arr,5=>$garments_item);
		
		echo create_list_view("list_view", "Challan No, Delivery Date,Company,Requisition NO,Buyer Name,Style ref. NO,Delivery Basis,Qty","150,100,110,100,110,100,100,100","950","300",0, $sql , "js_set_value28", "requisition_number_prefix_num,sys_number,id,company_id,0", "", 1, "0,0,company_id,0,buyer_name,0,delivery_basis,0,0", $arr, "sys_number,ex_factory_date,company_id,requisition_number_prefix_num,buyer_name,style_ref_no,delivery_basis,cons_quantity", "",'','0,3,0,0,0,0,0,0,0','',1);	
	}

	else if($basis==57) //Sample Delivery To MKT
	{
		?>
        <input type="hidden" id="txt_po_id" />
        <input type="hidden" id="txt_po_val" />
        <input type="hidden" id="txt_supplier_id" />   
        <input type="hidden" id="txt_rolltype_id" />         
        <?
        $date_cond=$sys_no_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and b.delivery_date  between '".$from_date."' and '".$to_date."'";
		if($search_by==1 &&  $chalan_id!='' ) $sys_no_cond=" and a.sys_number like '%$chalan_id'";
		if( $from_date!="" && $to_date!="" ) 
		{
			if($db_type==0)
			{
				$sql_cond .= " and b.delivery_date between '".change_date_format($from_date,'yyyy-mm-dd')."' and '".change_date_format($to_date,'yyyy-mm-dd')."'";
			}
			else
			{
				$sql_cond .= " and b.delivery_date between '".change_date_format($from_date,'','',1)."' and '".change_date_format($to_date,'','',1)."'";
			}
		}
	
		if (trim($company)!="") $sql_cond .= " and a.company_id='$company'";		
		if ($db_type==0) $year_field="YEAR(a.insert_date) as year,"; 
		else if($db_type==2) $year_field="to_char(a.insert_date,'YYYY') as year,";
		else $year_field="";//defined Later
		
		$sql = "SELECT a.id, $year_field a.sys_number_prefix_num, a.sys_number as sys_number,a.company_id, a.delivery_basis,b.delivery_date as delivery_date, sum(b.ex_factory_qty)as cons_quantity, c.requisition_number_prefix_num, c.buyer_name, c.style_ref_no 
		from sample_ex_factory_mst a, sample_ex_factory_dtls b, sample_development_mst c 
		where a.id=b.sample_ex_factory_mst_id and b.sample_development_id=c.id and a.status_active=1 and a.entry_form_id=396 $sql_cond $sys_no_cond group by a.id, a.sys_number_prefix_num, a.sys_number, a.company_id,a.delivery_basis,b.delivery_date,a.insert_date, c.requisition_number_prefix_num, c.requisition_number, c.buyer_name, c.style_ref_no order by a.id";

		$buyer_arr = return_library_array( "select id, buyer_name from  lib_buyer",'id','buyer_name');
		$inhouse_company_name_arr=return_library_array( "select id,company_name   from   lib_company ", "id", "company_name"  );
		//$sample_delivery_basis = return_library_array( "select id, sample_name from  lib_sample",'id','sample_name');
		$arr=array(2=>$inhouse_company_name_arr,6=>$sample_delivery_basis,4=>$buyer_arr,5=>$garments_item); //sample_name_arr
		
		echo create_list_view("list_view", "Challan No, Delivery Date,Company,Requisition NO,Buyer Name,Style ref. NO,Delivery Basis,Qty","150,100,110,100,110,100,100,100","950","300",0, $sql , "js_set_value2", "id,sys_number,sys_number,company_id,0", "", 1, "0,0,company_id,0,buyer_name,0,delivery_basis,0,0", $arr, "sys_number,delivery_date,company_id,requisition_number_prefix_num,buyer_name,style_ref_no,delivery_basis,cons_quantity", "",'','0,3,0,0,0,0,0,0,0','',1);	
	}

	else if($basis==29) //Woven Finish Fabric Receive Return
	{
		$date_cond= $iss_number_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and a.issue_date  between '".$from_date."' and '".$to_date."'";		
		if($chalan_id!='') $iss_number_cond=" and a.issue_number_prefix_num in(trim(".$chalan_id."))";
		 
		$sql = "select a.id as issue_id, a.issue_number, a.issue_number_prefix_num,a.supplier_id, a.issue_date, a.item_category, a.received_id, a.received_mrr_no, b.id as trans_id, b.cons_quantity, c.product_name_details, c.id as prod_id from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id where a.id=b.mst_id and b.item_category=3 and b.transaction_type=3 and a.entry_form=202 and  a.company_id=".$company." $iss_number_cond order by b.id";
		
		$arr=array(2=>$item_category);
		echo create_list_view("list_view", "System No,Prefix No,Category,Description, Cons Qty,Recv MRR No.","150,70,100,130,80,70","700","300",0, $sql , "js_set_value", "issue_id,issue_number,received_mrr_no", "", 1, "0,0,item_category,0,0,0", $arr, "issue_number,issue_number_prefix_num,item_category,product_name_details,cons_quantity,received_mrr_no", "",'','0,0,0,0,1,0') ;	
	}

	else if($basis==3 || $basis==4) //3=Knit Grey Fabric Issue/Return, 4=Knit Finish Fabric Issue
	{
			
		if($issue_id!='')
		{		
			$issueIds=chop($issue_id,','); 
			$issueIds_cond="";
			$issue_ids=count(array_unique(explode(",",$issueIds)));
			//echo $issue_ids.'D'; 
			if($db_type==2 && $issue_ids>1000)
			{
				//echo  $issue_ids.'d';
				$issueIds_cond=" and (";
				$issueIdsArr=array_chunk(explode(",",$issueIds),999);
				foreach($issueIdsArr as $ids)
				{
					$ids=implode(",",$ids);
					//$poIds_cond.=" po_break_down_id in($ids) or ";
					$issueIds_cond.=" id not in($ids) or"; 
				}
				$issueIds_cond=chop($issueIds_cond,'or ');
				$issueIds_cond.=")";
			}
			else
			{
				if($issueIds!="")
				{
					$issue_ids=implode(",",array_unique(explode(",",$issueIds)));
					$issueIds_cond=" and id not in($issue_ids)";
				}
				else { $issueIds_cond ="";}
			}
		
		}
		
		?>
    	<input type="hidden" id="txt_po_id" />
		<input type="hidden" id="txt_po_val" />
        <input type="hidden" id="txt_supplier_id" />
        <input type="hidden" id="txt_rolltype_id" />
        <?
		if($is_approved_val==1) $is_approved_cond=" and is_approved=1 ";
		if ($basis==4) $entry_form_cond=" and entry_form in(18,71)";
		else if($basis==3) $entry_form_cond=" and entry_form in (16,61)";
		
		$date_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and issue_date  between '".$from_date."' and '".$to_date."'";
		
		if($basis==3)
		{
				if($roll_type==1)
				{
					$sql = "select id, issue_number_prefix_num, issue_number, item_category, style_ref, challan_no, company_id, supplier_id from  inv_issue_master	where status_active=1 and is_deleted=0 and company_id=".$company." $date_cond  $iss_number_cond and entry_form in (61,84) $issueIds_cond  $is_approved_cond and issue_number not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and challan_no is not null )";
				}
				else
		
				{
					$sql = "select id, issue_number_prefix_num, issue_number, item_category, style_ref, challan_no, company_id, supplier_id from  inv_issue_master	where status_active=1 and is_deleted=0 and company_id=".$company." $date_cond  $iss_number_cond and entry_form in (16,51) $issueIds_cond  $is_approved_cond and issue_number not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and challan_no is not null )";
					
				}
		
		}
		else
		{
			$sql = "select id, issue_number_prefix_num, issue_number, item_category, style_ref, challan_no, company_id, supplier_id from  inv_issue_master	where status_active=1 and is_deleted=0 and company_id=".$company." $date_cond  $iss_number_cond $entry_form_cond $issueIds_cond  $is_approved_cond and issue_number not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and challan_no is not null )";
		}
		
		
		// echo $sql;
		$sample_arr = return_library_array( "select id, sample_name from lib_sample",'id','sample_name');
		$arr=array(2=>$item_category);
		echo create_list_view("list_view", "Issue No,issue No prifix,Item Catagory,Style,Challan No","150,70,150,200,120","750","300",0, $sql , "js_set_value2", "id,issue_number,challan_no,supplier_id", "", 1, "0,0,item_category,0,0", $arr, "issue_number,issue_number_prefix_num,item_category,style_ref,challan_no", "",'','','',1);	
	}

  	else if($basis==31) //Woven Finish Fabric Issue Return
	{
		$date_cond=$sys_no_cond="";
		if($search_by==1 &&  $chalan_id!='' ) $sys_no_cond=" and recv_number_prefix_num like '%$chalan_id'";
		if($from_date!="" && $to_date!="")
		{
			if($db_type==0)
			{
				$date_cond="and receive_date between '".change_date_format(trim($from_date), "yyyy-mm-dd", "-")."' and '".change_date_format(trim($to_date), "yyyy-mm-dd", "-")."'";
			}
			else
			{
				$date_cond="and receive_date between '".change_date_format(trim($from_date),'','',1)."' and '".change_date_format(trim($to_date),'','',1)."'";
			}
		}
		
		$inhouse_company_name_arr=return_library_array( "select id,company_name   from   lib_company ", "id", "company_name"  );
		$sql = "SELECT a.id as mst_id,a.recv_number_prefix_num, a.recv_number, a.receive_date, a.item_category, a.issue_id, $year_field b.id as trans_id, b.cons_quantity, c.product_name_details, c.id as prod_id, d.batch_no, a.company_id from inv_receive_master a, inv_transaction b, product_details_master c, pro_batch_create_mst d where a.id=b.mst_id and b.prod_id=c.id and b.batch_id_from_fissuertn=d.id and b.item_category=3 and b.transaction_type=4 and a.entry_form=209 and  a.company_id=".$company." $sys_no_cond $date_cond $mstIds order by a.id";			
			
		$arr=array(2=>$item_category,4=>$inhouse_company_name_arr);
		echo create_list_view("list_view", "Challan No,System ID,Category,Issue Date,Company","70,150,100,80","600","300",0, $sql , "js_set_value", "mst_id,recv_number,trans_id", "", 1, "0,0,item_category,0,company_id", $arr, "challan_no,recv_number,item_category,receive_date,company_id", "",'','0,0,0,3,0');	
		exit();	
	}

	else if($basis==32) //Woven Finish Fabric Issue
	{
		$date_cond=$iss_number_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and a.issue_date  between '".$from_date."' and '".$to_date."'";		
		if($chalan_id!='') $iss_number_cond=" and a.issue_number_prefix_num in(trim(".$chalan_id."))";
		 
		$sql = "SELECT a.id as issue_id, a.issue_number, a.issue_number_prefix_num,a.supplier_id, a.issue_date, a.item_category, a.received_id, a.received_mrr_no, b.id as trans_id, b.cons_quantity, c.product_name_details, c.id as prod_id from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id where a.id=b.mst_id and b.item_category=3 and b.transaction_type=2 and a.entry_form=19 and  a.company_id=".$company." $iss_number_cond order by b.id";
		
		$arr=array(2=>$item_category);
		echo create_list_view("list_view", "System No,Prefix No,Category,Description, Cons Qty,Recv MRR No.","150,70,100,130,80,70","700","300",0, $sql , "js_set_value", "issue_id,issue_number,received_mrr_no", "", 1, "0,0,item_category,0,0,0", $arr, "issue_number,issue_number_prefix_num,item_category,product_name_details,cons_quantity,received_mrr_no", "",'','0,0,0,0,1,0');	
	}

	else if($basis==33) //SubCon Embellishment Delivery
	{
		$date_cond="";	
		if( $from_date!="" && $to_date!="" ) $date_cond= " and delivery_date  between '".$from_date."' and '".$to_date."'";
		
		$sql = "select id,party_id,delivery_prefix_num, delivery_no,challan_no from  subcon_delivery_mst	where status_active=1 and is_deleted=0 and company_id=".$company."   and entry_form=4 $date_cond $subcon_delivery_cond ";
	
		$arr=array(2=>$item_category);
		echo create_list_view("list_view", "Delivery No,Delivery No prifix,Challan No","150,70,120","540","300",0, $sql , "js_set_value", "id,delivery_no,challan_no", "", 1, "0,0,0,0,0", $arr, "delivery_no,delivery_prefix_num,challan_no", "",'','');	
	}

	else if($basis==34) //Finish Fabric Transfer Entry
	{
		?>
    	<input type="hidden" id="txt_po_id" />
		<input type="hidden" id="txt_po_val" />
        <input type="hidden" id="txt_supplier_id" />
        <input type="hidden" id="txt_rolltype_id" />
        <?
        $date_cond=$sys_no_cond=$challan_no_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and a.transfer_date  between '".$from_date."' and '".$to_date."'";
		if($search_by==1 &&  $chalan_id!='' ) $sys_no_cond=" and a.transfer_system_id like '%$chalan_id%'";
		if($search_by==2 &&  $chalan_id!='') $challan_no_cond=" and a.challan_no = '$chalan_id'";
		if($roll_type==1) $entry_form_cond=" and a.entry_form in(134,306)"; else $entry_form_cond=" and a.entry_form in(14,306)";
		$inhouse_company_name_arr=return_library_array( "select id,company_name   from   lib_company ", "id", "company_name"  );
		$sql = "select a.id as grey_trnsf_id,a.transfer_system_id,a.transfer_prefix_number,a.challan_no,a.to_company,a.transfer_date,a.item_category from inv_item_transfer_mst a,inv_item_transfer_dtls b where a.id=b.mst_id and a.item_category=2 and company_id=".$company."  and a.transfer_system_id not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and challan_no is not null ) $date_cond $sys_no_cond $challan_no_cond $entry_form_cond group by a.id,a.transfer_system_id,a.transfer_prefix_number,a.challan_no,a.to_company,a.transfer_date,a.item_category";

		//echo $sql; die;
		 //product_details_master,inv_item_transfer_mst,inv_transaction,inv_item_transfer_dtls
		$arr=array(2=>$item_category,4=>$inhouse_company_name_arr);
		echo create_list_view("list_view", "Challan No,Transfer System ID,Category,Transfer Date,To Company","70,150,100,80","600","300",0, $sql , "js_set_value13", "grey_trnsf_id,transfer_system_id,challan_no", "", 1, "0,0,item_category,0,to_company", $arr, "challan_no,transfer_system_id,item_category,transfer_date,to_company", "",'','0,0,0,3,0',"",1);
	}

	else if($basis==35) //scrap sales
	{
		$date_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and selling_date  between '".$from_date."' and '".$to_date."'";
		if($search_by==1 &&  $chalan_id!='' ) $sys_no_cond=" and sys_challan_no like '%$chalan_id%' "; else $sys_no_cond="";

		$sql= "select id as sys_id, challan_no_prefix_num,sys_challan_no, item_category,selling_date, pay_term, customer_id, currency_id, remarks from inv_scrap_sales_mst where status_active=1 and is_deleted=0 $date_cond $sys_no_cond and  company_id=".$company."  order by id DESC ";
		//echo $sql; 
		$party_arr=return_library_array( "select id, buyer_name from lib_buyer",'id','buyer_name');
		$arr=array (1=>$item_category,3=>$party_arr,4=>$currency);
		echo  create_list_view("list_view", "System No,Item Category,Selling Date,Customer,Currency", "70,120,80,130,100","580","300",0, $sql , "js_set_value", "sys_id,sys_challan_no,sys_id", "", 1, "0,item_category,0,customer_id,currency_id", $arr , "challan_no_prefix_num,item_category,selling_date,customer_id,currency_id","",'0,0,3,0,0') ; 
	}

	else if($basis==49) //Printing Delivery
	{
		$date_cond=$sys_no_cond=$challan_no_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and a.delivery_date  between '".$from_date."' and '".$to_date."'";
		if($search_by==1 &&  $chalan_id!='' ) $sys_no_cond=" and a.delivery_no like '%$chalan_id%'";
		if($search_by==2 &&  $chalan_id!='') $challan_no_cond=" and a.challan_no = '$chalan_id'";
		//if($roll_type==1) $entry_form_cond=" and a.entry_form=82"; else $entry_form_cond=" and a.entry_form=12";
		if($company>0) $comp_cond=" and a.company_id=$company";

		if($_SESSION['logic_erp']["buyer_id"]!=''){
			$buyer_cond = " and a.party_id in (" . $_SESSION['logic_erp']["buyer_id"] . ")";
		}

		$sql= "SELECT a.id,a.party_id, a.delivery_no,a.challan_no,a.delivery_date, a.delivery_prefix_num 
		from subcon_delivery_mst a, subcon_delivery_dtls b 
		where a.id=b.mst_id and a.delivery_no not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and challan_no is not null ) and a.entry_form='254' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $date_cond $sys_no_cond $challan_no_cond $comp_cond $delivery_date  $withinGroup $delivery_id_cond $spo_idsCond $po_idsCond and a.within_group=1 
		group by a.id,a.party_id, a.delivery_no,a.challan_no, a.delivery_prefix_num,a.delivery_date 
		union all 
		SELECT a.id,a.party_id, a.delivery_no,a.challan_no,a.delivery_date, a.delivery_prefix_num 
		from subcon_delivery_mst a, subcon_delivery_dtls b 
		where a.id=b.mst_id and a.delivery_no not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and challan_no is not null ) and a.entry_form='254' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $date_cond $sys_no_cond $challan_no_cond $comp_cond $delivery_date $buyer_cond $withinGroup $delivery_id_cond $spo_idsCond $po_idsCond and a.within_group=2 
		group by a.id,a.party_id, a.delivery_no,a.challan_no, a.delivery_prefix_num,a.delivery_date order by id DESC"; 
		//echo $sql;//die;
		$arr=array(2=>$item_category);
		echo create_list_view("list_view", "Delivery No,Delivery No prifix,Delivery Date,Challan No","150,70,80,90","540","300",0, $sql , "js_set_value", "id,delivery_no,delivery_date", "", 1, "0,0,0,0,0", $arr, "delivery_no,delivery_prefix_num,delivery_date,challan_no", "",'','') ;	
	}

	else if($basis==51) //Wash Delivery
	{
		$date_cond=$sys_no_cond=$challan_no_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and a.delivery_date  between '".$from_date."' and '".$to_date."'";		
		if($search_by==1 &&  $chalan_id!='' ) $sys_no_cond=" and a.delivery_no like '%$chalan_id%'";
		if($search_by==2 &&  $chalan_id!='') $challan_no_cond=" and a.challan_no = '$chalan_id'";
		//if($roll_type==1) $entry_form_cond=" and a.entry_form=82"; else $entry_form_cond=" and a.entry_form=12";
		if($company>0) $comp_cond=" and a.company_id=$company";

		$sql= "SELECT a.id,a.party_id, a.delivery_no,a.challan_no,a.delivery_date, a.delivery_prefix_num from subcon_delivery_mst a, subcon_delivery_dtls b where a.id=b.mst_id and a.delivery_no not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and challan_no is not null ) and a.entry_form='303' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $date_cond $sys_no_cond $challan_no_cond $comp_cond $delivery_date  $buyer_cond $withinGroup $delivery_id_cond $spo_idsCond $po_idsCond group by a.id,a.party_id, a.delivery_no,a.challan_no, a.delivery_prefix_num,a.delivery_date order by a.id DESC ";
		$arr=array(2=>$item_category);
		echo create_list_view("list_view", "Delivery No,Delivery No prifix,Delivery Date,Challan No","150,70,80,90","540","300",0, $sql , "js_set_value", "id,delivery_no,delivery_date", "", 1, "0,0,0,0,0", $arr, "delivery_no,delivery_prefix_num,delivery_date,challan_no", "",'','');	
	}

	else if($basis==52) //AOP Delivery Challan
	{
		$date_cond= $sys_no_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and a.product_date  between '".$from_date."' and '".$to_date."'";
		if($search_by==1 &&  $chalan_id!='' ) $sys_no_cond=" and a.product_no like '%$chalan_id%'";
		//if($search_by==2 &&  $chalan_id!='') $challan_no_cond=" and a.challan_no = '$chalan_id' "; else $challan_no_cond="";
		//if($roll_type==1) $entry_form_cond=" and a.entry_form=82"; else $entry_form_cond=" and a.entry_form=12";
		if($company>0) $comp_cond=" and a.company_id=$company";

		$sql= "SELECT a.id,a.party_id, a.product_no,a.product_date, a.prefix_no_num from subcon_production_mst a, subcon_production_dtls b where a.id=b.mst_id and a.product_no not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and challan_no is not null ) and a.entry_form='307' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $date_cond $sys_no_cond  $comp_cond $delivery_date  $buyer_cond $withinGroup $delivery_id_cond $spo_idsCond $po_idsCond group by a.id,a.party_id, a.product_no,a.product_date, a.prefix_no_num  order by a.id DESC ";
		$arr=array(2=>$item_category);
		echo create_list_view("list_view", "Delivery No,Delivery No prifix,Delivery Date","150,70,80","540","300",0, $sql , "js_set_value", "id,product_no,product_date", "", 1, "0,0,0,0,0", $arr, "product_no,prefix_no_num,product_date", "",'','');	
	}

	else if($basis==53) //Bundle Wise Cutting Delivery To Input Challan
	{
		$date_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and b.delivery_date  between '".$from_date."' and '".$to_date."'";
		//id,issue_number,issue_number,supplier_id
		$sql = "SELECT b.id,a.po_break_down_id,b.challan_no,a.item_number_id,a.country_id,b.delivery_date,a.production_quantity,a.location,b.sys_number,b.sys_number_prefix_num from  pro_garments_production_mst a,  pro_gmts_delivery_mst b where a.delivery_mst_id=b.id and a.status_active=1 and b.sys_number not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and basis=53 and challan_no is not null ) and a.is_deleted=0 and b.entry_form=347 and a.entry_form=347 and a.production_type=9 and b.company_id=".$company." $cutting_delivery_cond order by id";
		// echo $sql;
		$arr=array(2=>$garments_item,3=>$item_category);
		echo create_list_view("list_view", "System No,Prefix No,Item Name,Challan No, Delivery Date,Delivery Qty.","150,70,130,120,80,70","700","300",0, $sql , "js_set_value", "id,sys_number,sys_number,challan_no", "", 1, "0,0,item_number_id,0,0", $arr, "sys_number,sys_number_prefix_num,item_number_id,challan_no,delivery_date,production_quantity", "",'','0,0,0,0,3,2');	
	}

	else if($basis==56) //Wash Material Receive Return
	{
		$date_cond=$sys_cond=$party_cond='';
		if ($from_date!='' && $to_date!='') $date_cond= " and a.subcon_date between '".$from_date."' and '".$to_date."'";
		if ($chalan_id != ''){
			if($search_by==1) $sys_cond=" and prefix_no_num='$chalan_id'";
			else if($search_by==2) $sys_cond=" and chalan_no like '%$chalan_id'";
		}		

		if($party>0) $party_cond=" and a.party_id=$party";

		$party_arr=return_library_array("select id, buyer_name from lib_buyer",'id','buyer_name');
		$company_library=return_library_array( "select id,company_name  from   lib_company  where status_active=1 and is_deleted=0", "id", "company_name");		

		$sql = "SELECT a.id, a.sys_no as sys_number, a.prefix_no_num, a.chalan_no as chalan_no, a.within_group, a.party_id, a.embl_job_no as job_no from sub_material_mst a, sub_material_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and a.sys_no not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and basis=56 and challan_no is not null ) and a.entry_form=372 and a.trans_type=3 and a.company_id=".$company." $party_cond $sys_cond $date_cond group by a.id, a.sys_no, a.prefix_no_num, a.chalan_no, a.within_group, a.party_id, a.embl_job_no order by id";
		//echo $sql;die;
		$sql_res= sql_select($sql);
		$order_array=array();
		foreach($sql_res as $row)
		{
			if($row[csf("within_group")]==1) $within_group_arr[$row[csf("sys_number")]]=$company_library[$row[csf("party_id")]];
			else $within_group_arr[$row[csf("sys_number")]]=$party_arr[$row[csf("party_id")]];
			$job_no.="'".$row[csf("job_no")]."',";
		}

		$job_nos=implode(',',array_unique(explode(',',rtrim($job_no,','))));
		$sql_order_res=sql_select("select subcon_job, order_no from subcon_ord_mst where status_active=1 and is_deleted=0 and subcon_job in($job_nos)");
		foreach ($sql_order_res as $row) {
			$order_array[$row[csf("subcon_job")]]=$row[csf("order_no")];
		}
		$arr=array(1=>$within_group_arr,3=>$order_array);

		echo create_list_view("list_view", "Return No,Party Name,Challan No,Order No","120,120,120,120,80","600","300",0, $sql , "js_set_value", "id,sys_number,chalan_no", "", 1, "0,sys_number,0,job_no", $arr, "sys_number,sys_number,chalan_no,job_no", "",'','0,0,0,0');
	}

	else if($basis==58) // Grey Roll Issue to Process
	{
		$date_cond=$sys_no_cond=$challan_no_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and a.receive_date  between '".$from_date."' and '".$to_date."'";
		if($search_by==1 &&  $chalan_id!='' ) $sys_no_cond=" and a.recv_number_prefix_num like '%$chalan_id%'";
		if($search_by==2 &&  $chalan_id!='') $challan_no_cond=" and a.recv_number like '%$chalan_id%'";
		$inhouse_company_name_arr=return_library_array( "select id,company_name   from   lib_company ", "id", "company_name");

		$sql = "SELECT a.id, a.recv_number,a.recv_number_prefix_num, a.dyeing_source, a.company_id, a.dyeing_company, a.receive_date,a.item_category
		from inv_receive_mas_batchroll a where recv_number not in (select challan_no from inv_gate_pass_mst where status_active=1 and is_deleted=0 and challan_no is not null) and a.entry_form=63 and a.company_id=".$company." $date_cond $sys_no_cond $challan_no_cond";

		$arr=array(2=>$item_category,4=>$inhouse_company_name_arr);
		echo create_list_view("list_view", "Challan No,System ID,Category,Issue Date,Company","70,150,100,80","600","300",0, $sql , "js_set_value", "id,recv_number,id", "", 1, "0,0,item_category,0,company_id", $arr, "challan_no,recv_number,item_category,receive_date,company_id", "",'','0,0,0,3,0');
	}

	else if($basis==59) // Embroidery Delivery Entry
	{
		$date_cond=$sys_no_cond=$challan_no_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and a.delivery_date  between '".$from_date."' and '".$to_date."'";
		if($search_by==1 &&  $chalan_id!='' ) $sys_no_cond=" and a.delivery_no like '%$chalan_id%'";
		if($search_by==2 &&  $chalan_id!='') $challan_no_cond=" and a.challan_no = '$chalan_id'";
		//if($roll_type==1) $entry_form_cond=" and a.entry_form=82"; else $entry_form_cond=" and a.entry_form=12";
		if($company>0) $comp_cond=" and a.company_id=$company";

		if($_SESSION['logic_erp']["buyer_id"]!=''){
			$buyer_cond = " and a.party_id in (" . $_SESSION['logic_erp']["buyer_id"] . ")";
		}

		$sql= "SELECT a.id,a.party_id, a.delivery_no,a.challan_no,a.delivery_date, a.delivery_prefix_num 
		from subcon_delivery_mst a, subcon_delivery_dtls b 
		where a.id=b.mst_id and a.delivery_no not in (select challan_no from inv_gate_pass_mst where status_active=1 and is_deleted=0 and basis=59 and challan_no is not null ) and a.entry_form='325' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $date_cond $sys_no_cond $challan_no_cond $comp_cond $delivery_date  $withinGroup $delivery_id_cond $spo_idsCond $po_idsCond and a.within_group=1 
		group by a.id,a.party_id, a.delivery_no,a.challan_no, a.delivery_prefix_num,a.delivery_date 
		union all 
		SELECT a.id,a.party_id, a.delivery_no,a.challan_no,a.delivery_date, a.delivery_prefix_num 
		from subcon_delivery_mst a, subcon_delivery_dtls b 
		where a.id=b.mst_id and a.delivery_no not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and basis=59 and challan_no is not null ) and a.entry_form='325' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $date_cond $sys_no_cond $challan_no_cond $comp_cond $delivery_date $buyer_cond $withinGroup $delivery_id_cond $spo_idsCond $po_idsCond and a.within_group=2 
		group by a.id,a.party_id, a.delivery_no,a.challan_no, a.delivery_prefix_num,a.delivery_date order by id DESC"; 
		//echo $sql;//die;
		$arr=array(2=>$item_category);
		echo create_list_view("list_view", "Delivery No,Delivery No prifix,Delivery Date,Challan No","150,70,80,90","540","300",0, $sql , "js_set_value", "id,delivery_no,delivery_date", "", 1, "0,0,0,0,0", $arr, "delivery_no,delivery_prefix_num,delivery_date,challan_no", "",'','') ;	
	}

	else if($basis==60) //Sample Embellisment Issue
	{
		?>
        <input type="hidden" id="txt_po_id" />
        <input type="hidden" id="txt_po_val" />
        <input type="hidden" id="txt_supplier_id" />   
        <input type="hidden" id="txt_rolltype_id" />
        <?
        $issue_id_cond="";
		if ($search_by==1 &&  $chalan_id!='' ) $issue_id_cond=" and b.id=$chalan_id";
		if ( $from_date!="" && $to_date!="" ) 
		{
			if($db_type==0)
			{
				$sql_cond .= " and a.sewing_date between '".change_date_format($from_date,'yyyy-mm-dd')."' and '".change_date_format($to_date,'yyyy-mm-dd')."'";
			}
			else
			{
				$sql_cond .= " and a.sewing_date between '".change_date_format($from_date,'','',1)."' and '".change_date_format($to_date,'','',1)."'";
			}
		}
	
		if (trim($company)!="") $sql_cond .= " and c.company_id='$company'";
		if ($db_type==0) $year_field="YEAR(a.insert_date) as year,";
		else if($db_type==2) $year_field="to_char(a.insert_date,'YYYY') as year,";
		else $year_field="";


		$sql_challan_res=sql_select("select issue_id from inv_gate_pass_mst  where basis=60 and status_active=1 and is_deleted=0 and issue_id is not null");
		foreach ($sql_challan_res as $val) {
			$challan .= $val[csf('issue_id')].',';
		}
		$challanNo=rtrim($challan,',');
		$ex_challanNo=explode(',', $challanNo);
		$tot_rows=0;
		foreach ($ex_challanNo as $challan) {
			$challan_no.="'".$challan."'".',';
			$tot_rows++;
		}
		
		if ($challanNo != '')
	    {
	        $challan_nos = explode(',', rtrim($challan_no,','));
	        $challan_no_cond = '';

	        if($db_type==2 && $tot_rows>1000)
	        {
	            $challan_no_cond = ' and (';
	            $challan_noArr = array_chunk($challan_nos,999);
	            foreach($challan_noArr as $chalan)
	            {
	                $chalan = implode(',',$chalan);
	                $challan_no_cond .= " b.id not in($chalan) and ";
	            }
	            $challan_no_cond = rtrim($challan_no_cond,'and ');
	            $challan_no_cond .= ')';
	        }
	        else
	        {
	            $challan_nos = implode(',', $challan_nos);
	            $challan_no_cond=" and b.id not in ($challan_nos)";
	        }
	    }

	    if ($db_type==0) $issue_dtls_id = "group_concat(a.id) as issue_dtls_id";
	    else $issue_dtls_id = "listagg(cast(a.id as varchar2(4000)),',') within group (order by a.id) as issue_dtls_id";

		
		//echo $all_challan_id_cond;die;
		$sql = "SELECT $issue_dtls_id, a.item_number_id, a.sample_name, sum(a.qc_pass_qty) as quantity, b.id as issue_id, c.company_id, c.requisition_number_prefix_num, c.buyer_name, c.style_ref_no 
		from sample_sewing_output_dtls a, sample_sewing_output_mst b, sample_development_mst c 
		where a.sample_sewing_output_mst_id=b.id and b.sample_development_id=c.id and a.status_active=1 and a.is_deleted=0 and b.entry_form_id=338 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $sql_cond $issue_id_cond $challan_no_cond
		group by a.sewing_date, a.item_number_id, a.sample_name, b.id, c.company_id, c.requisition_number_prefix_num, c.buyer_name, c.style_ref_no order by b.id";

		$buyer_arr = return_library_array( "select id, buyer_name from lib_buyer",'id','buyer_name');
		$company_arr = return_library_array( "select id, company_name from lib_company",'id','company_name');
		$arr=array(0=>$company_arr,1=>$buyer_arr);
		
		echo create_list_view("list_view", "Company, Buyer Name, Style ref. No, Requisition No, Issue Id, Quantity, Issue Date","150,150,120,120,100,100,100","950","300",0, $sql , "js_set_value_new", "requisition_number_prefix_num,issue_dtls_id,issue_id", "", 1, "company_id,buyer_name,0,0,0,0,0,0", $arr, "company_id,buyer_name,style_ref_no,requisition_number_prefix_num,issue_id,quantity,sewing_date", "",'','0,0,0,0,0,0,0','',1);
	}

	else if($basis==61) //Wash Dyes Chemical Issue
	{
		$date_cond=$sys_id_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and a.issue_date  between '".$from_date."' and '".$to_date."'";
		if ($chalan_id != '')
		{
			if ($search_by==1) $sys_id_cond=" and a.issue_number like '%$chalan_id'";
		}

		$sql="SELECT a.id, a.issue_number, a.issue_date, a.order_id, a.sub_order_id, a.buyer_job_no, a.issue_number_prefix_num, a.challan_no 
		from  inv_issue_master a where a.issue_number not in (select challan_no from inv_gate_pass_mst where basis=61 and status_active=1 and is_deleted=0 and challan_no is not null ) and a.entry_form=298 and a.company_id=".$company." and a.status_active=1 and a.is_deleted=0 $date_cond $sys_id_cond ";
		//echo $sql;die;
		$sql_res=sql_select($sql);
		$all_subcon_order="";
		foreach($sql_res as $row)
		{
			$all_subcon_order.=$row[csf("sub_order_id")].",";
		}

		$all_subcon_order=implode(",",array_unique(explode(",",chop($all_subcon_order,","))));

		if($all_subcon_order!="")
		{
			$subcon_job_arr=array();
			$subcon_po_sqls=sql_select("select a.id as po_id, a.job_no_mst, a.order_no from subcon_ord_dtls a where a.status_active=1 and a.is_deleted=0 and a.id in($all_subcon_order)");
			foreach($subcon_po_sqls as $row)
			{
				$subcon_job_arr[$row[csf('po_id')]]=$row[csf('job_no_mst')];
				//$subcon_order_data[$row[csf('po_id')]]['order_no']=$row[csf('order_no')];
			}
		}
		
		$arr=array(2=>$subcon_job_arr);
			
		echo create_list_view("list_view", "Issue Number,Issue Number Prefix,Job No,Order No,Challan No","150,150,150,150,150","800","300",0, $sql , "js_set_value", "id,issue_number,issue_number", "", 1, "0,0,sub_order_id,0,0", $arr, "issue_number,issue_number_prefix_num,sub_order_id,buyer_job_no,challan_no", "","","0,0,0,0,0","");	
			//exit();
	}
	else if($basis==66) //Left Over Garments Issue
	{
		?>		
		<input type="hidden" id="txt_po_id" />
		<input type="hidden" id="txt_po_val" />
		<!-- <input type="hidden" id="txt_supplier_id" /> -->
        <input type="hidden" id="txt_rolltype_id" />
        <?
        $date_cond=$sys_cond="";
		if( $from_date!="" && $to_date!="" ) $date_cond= " and issue_date between '".$from_date."' and '".$to_date."'";	
		if($chalan_id!="") $sys_cond="and sys_number_prefix_num like '$chalan_id'";

		$sql_challan_res=sql_select("select challan_no from inv_gate_pass_mst where basis=66 and status_active=1 and is_deleted=0 and challan_no is not null");
		foreach ($sql_challan_res as $val) {
			$challan .= $val[csf('challan_no')].',';
		}
		$challanNo=rtrim($challan,',');
		$ex_challanNo=explode(',', $challanNo);
		$tot_rows=0;
		foreach ($ex_challanNo as $challan) {
			$challan_no.="'".$challan."'".',';
			$tot_rows++;
		}
		
		if ($challanNo != '')
	    {
	        $challan_nos = explode(',', rtrim($challan_no,','));
	        $challan_no_cond = '';

	        if($db_type==2 && $tot_rows>1000)
	        {
	            $challan_no_cond = ' and (';
	            $challan_noArr = array_chunk($challan_nos,999);
	            foreach($challan_noArr as $chalan)
	            {
	                $chalan = implode(',',$chalan);
	                $challan_no_cond .= " sys_number not in($chalan) and ";
	            }
	            $challan_no_cond = rtrim($challan_no_cond,'and ');
	            $challan_no_cond .= ')';
	        }
	        else
	        {
	            $challan_nos = implode(',', $challan_nos);
	            $challan_no_cond=" and sys_number not in ($challan_nos)";
	        }
	    }		
		
		$sql="SELECT id,sys_number_prefix_num,sys_number,issue_date from pro_leftover_gmts_issue_mst where status_active=1 and is_deleted=0 and company_id=".$company." $date_cond $sys_cond $challan_no_cond order by id desc";		
		//$arr=array(2=>$item_category);
		echo create_list_view("list_view", "Sys No Prefix,Challan No,Issue Date","150,120,70","540","300",0, $sql , "js_set_value21", "id,sys_number,sys_number", "", 1, "0,0,0,0,0", $arr, "sys_number_prefix_num,sys_number,issue_date", "",'','0,0,3','',1);		
	}
	else
	{
		if($db_type==2) $group_concat="listagg(CAST(id as VARCHAR(4000)),',') within group (order by id) as po_id";
		else  $group_concat="group_concat(id) as po_id";
		$order_id=return_field_value("$group_concat", " wo_po_break_down", "po_number='".$chalan_id."'","po_id");

		$sql_insert_id=sql_select("select issue_id from inv_gate_pass_mst where issue_id is not null and status_active=1 and is_deleted=0 and company_id=$company and basis=$basis");
		$issue_id="";
		foreach($sql_insert_id as $iss_id)
		{
			$issue_row_id=$iss_id[csf('issue_id')];
			if($issue_row_id!=0)
			{
				$issue_id=$iss_id[csf('issue_id')];
				$r_id2=execute_query("insert into tmp_poid (userid, poid) values ($user_id,$issue_id)");
				//echo $r_id2; die;
				if($issue_id=="") $issue_id=$iss_id[csf('issue_id')];else $issue_id.=",".$iss_id[csf('issue_id')];
			}
			
		}
		if($db_type==0)
		{
			if($r_id2)
			{
				mysql_query("COMMIT");  
			}
		}
		if($db_type==2 || $db_type==1 )
		{
			if($r_id2)
			{
				oci_commit($con);  
			}
		}

		if($basis==2)
		{
		 	$entry_form_cond=" and entry_form=3";
		 	$is_approved_arr=sql_select("SELECT a.setup_date , b. approval_need from  approval_setup_mst a ,approval_setup_dtls b where a.id= b.mst_id and a.status_active=1 and b.status_active=1 and b.page_id=19 and a.company_id=$company order by a.setup_date desc ,a.id  desc ");
		 	$is_approved_val=$is_approved_arr[0][csf("approval_need")];
		}

		if($basis==5) $entry_form_cond=" and entry_form=21";
		//if($basis==3) $entry_form_cond=" and entry_form=16";
		if($basis==3) $entry_form_cond=" and entry_form in (16,61)";
		//if($basis==4) $entry_form_cond=" and entry_form=18";
		if($basis==6) $entry_form_cond=" and entry_form=5";
		if($basis==7) $entry_form_cond=" and entry_form=25";
		if($basis==23) $entry_form_cond=" and entry_form=26";
		if($basis==24) $entry_form_cond=" and entry_form=49";
		if($basis==25) $entry_form_cond=" and entry_form=28"; 
		
		//if($basis==36) $entry_form_cond=" and entry_form=263"; 
		if($basis==37) $entry_form_cond=" and entry_form=264"; 
		if($basis==38) $entry_form_cond=" and entry_form=265"; 
		//if($basis==39) $entry_form_cond=" and entry_form=266"; 
		if($basis==54) $entry_form_cond=" and entry_form=224"; 
		if($basis==63) $entry_form_cond=" and entry_form=318"; 
		//echo $issue_id.'systewm';

		if($issue_id!='')
		{
     		$issueIds=chop($issue_id,','); 
			$issueIds_cond="";
			$issue_ids=count(array_unique(explode(",",$issueIds)));
			//echo $issue_ids.'D'; 
			if($db_type==2 && $issue_ids>1000)
			{
				//echo  $issue_ids.'d';
				$issueIds_cond=" and (";
				$issueIdsArr=array_chunk(explode(",",$issueIds),999);
				foreach($issueIdsArr as $ids)
				{
					$ids=implode(",",$ids);
					//$poIds_cond.=" po_break_down_id in($ids) or ";
					$issueIds_cond.=" id not in($ids) and"; 
				}
				$issueIds_cond=chop($issueIds_cond,'and ');
				$issueIds_cond.=")";
			}
			else
			{
				if($issueIds!="")
				{
					$issue_ids=implode(",",array_unique(explode(",",$issueIds)));
					$issueIds_cond=" and id not in($issue_ids)";
				}
				else { $issueIds_cond ="";}
			}
		}
		//echo $issueIds_cond;		
		
		if($basis==2)
		{
			?>
            <input type="hidden" id="txt_po_id" />
 			<input type="hidden" id="txt_po_val" />
            <input type="hidden" id="txt_supplier_id" />
            <input type="hidden" id="txt_rolltype_id" />

            <?
			if($is_approved_val==1)
			{
				$is_approved_cond=" and is_approved=1 ";
			}
			$date_cond="";
			if( $from_date!="" && $to_date!="" ) $date_cond= " and issue_date  between '".$from_date."' and '".$to_date."'";

			$sql_issue_id = "SELECT id, issue_id from inv_gate_pass_mst where basis=2 and status_active=1 and is_deleted=0 and company_id=$company";
			$sql_issue_id_result=sql_select($sql_issue_id);
			$issue_ids="";
			foreach($sql_issue_id_result as $row)
			{
				if($row[csf('issue_id')]!='')
				{
					$issue_ids.=$row[csf('issue_id')].',';
					
				}
			}
			$issue_ids=chop($issue_ids,',');
			$issue_ids_arr = array_unique(explode(",", $issue_ids));
			
			$sql_chcek = sql_select("select id from  inv_issue_master	where status_active=1 and is_deleted=0 $entry_form_cond  and company_id=".$company."   and id not in(select poid from tmp_poid where userid=$user_id) $date_cond  $iss_number_cond   $is_approved_cond order by id  desc");
			$issueIds='';
			foreach($sql_chcek as $row)
			{
				if (!in_array($row[csf('id')], $issue_ids_arr, true)) 
				{
					$issueIds.=$row[csf('id')].",";
				}
				
			}
			$issueIds =chop($issueIds,',');
			$issueIds_arr = array_unique(explode(",", $issueIds));
			
			$all_issue_ids_cond=""; $issueCond="";
			if($db_type==2 && count($issueIds_arr)>999)
			{
				$all_issueIds_arr_chunk=array_chunk($issueIds_arr,999) ;
				foreach($all_issueIds_arr_chunk as $chunk_arr)
				{
					$chunk_arr_value=implode(",",$chunk_arr);
					$issueCond.="  id in($chunk_arr_value) or ";
				}

				$all_issue_ids_cond.=" and (".chop($issueCond,'or ').")";
			}
			else
			{
				$all_issue_ids_cond=" and id in($issueIds)";
			}
			// echo $all_issue_ids_cond;die;
			
			$sql = "SELECT id, issue_number_prefix_num, issue_number,item_category,style_ref, challan_no,company_id,supplier_id from  inv_issue_master	where status_active=1 and is_deleted=0 $entry_form_cond  and company_id=".$company."   and id not in(select poid from tmp_poid where userid=$user_id) $all_issue_ids_cond $date_cond  $iss_number_cond   $is_approved_cond order by id  desc";
			$sample_arr = return_library_array( "select id, sample_name from lib_sample",'id','sample_name');
			$arr=array(2=>$item_category);
			echo create_list_view("list_view", "Issue No,issue No prifix,Item Catagory,Style,Challan No","150,70,150,200,120","750","300",0, $sql , "js_set_value2", "id,issue_number,challan_no,supplier_id", "", 1, "0,0,item_category,0,0", $arr, "issue_number,issue_number_prefix_num,item_category,style_ref,challan_no", "",'','','',1) ;	
		}
		else if($basis==50)
		{
			?>
        	<input type="hidden" id="txt_po_id" />
			<input type="hidden" id="txt_po_val" />
            <input type="hidden" id="txt_supplier_id" />
            <input type="hidden" id="txt_rolltype_id" />
            <?
			$date_cond=$sys_no_cond=$challan_no_cond="";
			if( $from_date!="" && $to_date!="" ) $date_cond= " and a.delivery_date  between '".$from_date."' and '".$to_date."'";
			if($search_by==1 &&  $chalan_id!='' ) $sys_no_cond=" and a.trims_del like '%$chalan_id%'";
			if($search_by==2 &&  $chalan_id!='') $challan_no_cond=" and a.challan_no = '$chalan_id'";
			//if($roll_type==1) $entry_form_cond=" and a.entry_form=82"; else $entry_form_cond=" and a.entry_form=12";
			if($company>0) $comp_cond=" and a.company_id=$company";
			if($party>0) $party_cond=" and a.party_id=$party";
			$within_group=$roll_type;
		
			$sql= "SELECT a.id,a.party_id, a.trims_del,a.challan_no,a.delivery_date, a.del_no_prefix_num,a.within_group from trims_delivery_mst a, trims_delivery_dtls b where a.id=b.mst_id and a.trims_del not in (select challan_no from inv_gate_pass_mst  where status_active=1 and is_deleted=0 and challan_no is not null ) and a.entry_form='208' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and  a.within_group=$within_group $date_cond $sys_no_cond $challan_no_cond $comp_cond $delivery_date  $buyer_cond $party_cond $withinGroup $delivery_id_cond $spo_idsCond $po_idsCond group by a.id,a.party_id, a.trims_del,a.challan_no, a.del_no_prefix_num,a.delivery_date,a.within_group order by a.id DESC ";
			
			if($within_group==1)
			{
				$party_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
			}
			else
			{
				$party_arr=return_library_array( "select id, buyer_name from lib_buyer",'id','buyer_name');
			} 
			$arr=array(2=>$party_arr);
		
			echo create_list_view("list_view", "Delivery No,Delivery No prifix,Party,Delivery Date,Challan No","130,70,130,80,90","600","300",0, $sql , "js_set_value2", "id,trims_del,challan_no,party_id", "", 1, "0,0,party_id,0,0,0", $arr, "trims_del,del_no_prefix_num,party_id,delivery_date,challan_no","",'','','',1) ;	
		}
		else if($basis==54)
		{
			?>
        	<input type="hidden" id="txt_po_id" />
				<input type="hidden" id="txt_po_val" />
            <input type="hidden" id="txt_supplier_id" />
            <input type="hidden" id="txt_rolltype_id" />
            <?			
			if($is_approved_val==1)
			{
				$is_approved_cond=" and is_approved=1 ";
			}
			$date_cond="";
			if( $from_date!="" && $to_date!="" ) $date_cond= " and issue_date  between '".$from_date."' and '".$to_date."'";
			$sql = "select id, issue_number_prefix_num, issue_number,item_category,style_ref, challan_no,company_id,supplier_id from  inv_issue_master where status_active=1 and is_deleted=0 $entry_form_cond  and company_id=".$company." $date_cond  $iss_number_cond  and id not in(select poid from tmp_poid where userid=$user_id)   $is_approved_cond order by id  desc";
			//echo $sql;
			$sample_arr = return_library_array( "select id, sample_name from lib_sample",'id','sample_name');
			$arr=array(2=>$item_category);
			echo create_list_view("list_view", "Issue No,issue No prifix,Item Catagory,Style,Challan No","150,70,150,200,120","750","300",0, $sql , "js_set_value2", "id,issue_number,issue_number,supplier_id", "", 1, "0,0,item_category,0,0", $arr, "issue_number,issue_number_prefix_num,item_category,style_ref,challan_no", "",'','','',1) ;	
		}

		else if($basis==63)
		{
			?>
        	<input type="hidden" id="txt_po_id" />
			<input type="hidden" id="txt_po_val" />
            <input type="hidden" id="txt_supplier_id" />
            <input type="hidden" id="txt_rolltype_id" />
            <?			
			if($is_approved_val==1)
			{
				$is_approved_cond=" and is_approved=1 ";
			}
			if( $from_date!="" && $to_date!="" ) $date_cond= " and issue_date  between '".$from_date."' and '".$to_date."'"; else
			$date_cond="";
			$sql = "select id, issue_number_prefix_num, issue_number,item_category,style_ref, challan_no,company_id,supplier_id from  inv_issue_master where status_active=1 and is_deleted=0 $entry_form_cond  and company_id=".$company." $date_cond  $iss_number_cond  and id not in(select poid from tmp_poid where userid=$user_id)   $is_approved_cond order by id  desc";
			//echo $sql;
			$sample_arr = return_library_array( "select id, sample_name from lib_sample",'id','sample_name');
			$arr=array(2=>$item_category);
			echo create_list_view("list_view", "Issue No,issue No prifix,Item Catagory,Style,Challan No","150,70,150,200,120","750","300",0, $sql , "js_set_value2", "id,issue_number,issue_number,supplier_id", "", 1, "0,0,item_category,0,0", $arr, "issue_number,issue_number_prefix_num,item_category,style_ref,challan_no", "",'','','',1) ;	
		}

		else if ($basis==7)
		{
			?>
        	<input type="hidden" id="txt_po_id" />
			<input type="hidden" id="txt_po_val" />
            <input type="hidden" id="txt_supplier_id" />
            <input type="hidden" id="txt_rolltype_id" />
            <?
			if($is_approved_val==1)
			{
				$is_approved_cond=" and is_approved=1 ";
			}
			if( $from_date!="" && $to_date!="" ) $date_cond= " and issue_date  between '".$from_date."' and '".$to_date."'"; else
			$date_cond="";
			$sql = "select id, issue_number_prefix_num, issue_number,item_category,style_ref, challan_no,company_id,supplier_id from  inv_issue_master where status_active=1 and is_deleted=0 $entry_form_cond  and company_id=".$company." $date_cond  $iss_number_cond  and id not in(select poid from tmp_poid where userid=$user_id) $is_approved_cond $issueIds_cond order by id  desc";
			$sample_arr = return_library_array( "select id, sample_name from lib_sample",'id','sample_name');
			$arr=array(2=>$item_category);
			echo create_list_view("list_view", "Issue No,issue No prifix,Item Catagory,Style,Challan No","150,70,150,200,120","750","300",0, $sql , "js_set_value2", "id,issue_number,issue_number,supplier_id", "", 1, "0,0,item_category,0,0", $arr, "issue_number,issue_number_prefix_num,item_category,style_ref,challan_no", "",'','','',1) ;
		}

		else if ($basis==5)
		{
			?>
        	<input type="hidden" id="txt_po_id" />
			<input type="hidden" id="txt_po_val" />
            <?

			if($is_approved_val==1)
			{
				$is_approved_cond=" and is_approved=1 ";
			}
			if( $from_date!="" && $to_date!="" ) $date_cond= " and issue_date  between '".$from_date."' and '".$to_date."'"; else
			$date_cond="";
			$sql = "select id, issue_number_prefix_num, issue_number,item_category,style_ref, challan_no,company_id,supplier_id from  inv_issue_master where status_active=1 and is_deleted=0 $entry_form_cond  and company_id=".$company." $date_cond  $iss_number_cond  and id not in(select poid from tmp_poid where userid=$user_id)   $is_approved_cond order by id  desc";
			$sample_arr = return_library_array( "select id, sample_name from lib_sample",'id','sample_name');
			$arr=array(2=>$item_category);

			echo create_list_view("list_view", "Issue No,issue No prifix,Item Catagory,Style,Challan No","150,70,150,200,120","750","300",0, $sql , "js_set_value5", "id,issue_number,issue_number,supplier_id", "", 1, "0,0,item_category,0,0", $arr, "issue_number,issue_number_prefix_num,item_category,style_ref,challan_no", "",'','','',1) ;	
		}	
		
		else
		{
			if($is_approved_val==1)
			{
				$is_approved_cond=" and is_approved=1 ";
			}
			if( $from_date!="" && $to_date!="" ) $date_cond= " and issue_date  between '".$from_date."' and '".$to_date."'"; else
			$date_cond="";
			$sql = "select id, issue_number_prefix_num, issue_number,item_category,style_ref, challan_no,company_id,supplier_id from  inv_issue_master where status_active=1 and is_deleted=0 $entry_form_cond  and company_id=".$company." $date_cond  $iss_number_cond  and id not in(select poid from tmp_poid where userid=$user_id)   $is_approved_cond order by id  desc";
			$sample_arr = return_library_array( "select id, sample_name from lib_sample",'id','sample_name');
			$arr=array(2=>$item_category);
			echo create_list_view("list_view", "Issue No,issue No prifix,Item Catagory,Style,Challan No","150,70,150,200,120","750","300",0, $sql , "js_set_value", "id,issue_number,issue_number,supplier_id", "", 1, "0,0,item_category,0,0", $arr, "issue_number,issue_number_prefix_num,item_category,style_ref,challan_no", "",'','') ;	
		}
		
		$r_id3=execute_query("delete from tmp_poid where userid=$user_id");
		if($db_type==0)
		{
			if($r_id3)
			{
				mysql_query("COMMIT");  
			}
		}
		if($db_type==2 || $db_type==1 )
		{
			if($r_id3)
			{
				oci_commit($con);  
			}
		}
	}
	disconnect($con);
	exit();
}

if($action=="system_order")
{
  	echo load_html_head_contents("Popup Info","../../", 1, 1, $unicode);
	extract($_REQUEST);  
	?>
	<script>
		function js_set_value(str)
		{
			//alert(str);
			$("#hidden_order_number").val(str);
			//alert($("#hidden_sys_number").val())
			parent.emailwindow.hide(); 
		}
	</script>
	</head>
	<body>
		<div align="center" style="width:100%;" >
		<form name="searchorderfrm_1"  id="searchorderfrm_1" autocomplete="off">
			<table width="450" cellspacing="0" cellpadding="0" border="0" class="rpt_table" align="center">
				<thead>
					<th width="150">Company Name</th>
					
					<th width="150" id="search_by_td_up">Buyer Name</th>
					<th width="130">Job No</th>
					<th width="130">Style Reff.</th>
					<th width="130">Order No</th>
					<th><input type="reset" name="re_button" id="re_button" value="Reset" style="width:100px" class="formbutton"  /></th>           
				</thead>
				<tbody>
					<tr>
						<td width="150">
							<? 
							echo create_drop_down( "cbo_company", 150, "select id,company_name from lib_company comp where status_active=1 and is_deleted=0  order by company_name","id,company_name", 1, "-- Select Company --", $company,"","0" );
							?>
						</td>
						<td> 
							<? 
								echo create_drop_down( "cbo_buyer_name", 150, "select buy.id,buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company='$company' order by buyer_name","id,buyer_name", 1, "-- Select Buyer --", $selected, "" ); 
							?>
						</td>
					
						<td align="center" id="">				
							<input type="text" style="width:130px" class="text_boxes"  name="txt_job_no" id="txt_job_no" />	
						</td>   
						<td align="center" id="">				
							<input type="text" style="width:130px" class="text_boxes"  name="txt_style" id="txt_style" />	
						</td>  
						<td align="center" id="">				
							<input type="text" style="width:130px" class="text_boxes"  name="txt_order" id="txt_order" />	
						</td>  
						<td align="center">
						<input type="button" name="btn_show" class="formbutton" value="Show" onClick="show_list_view ( document.getElementById('txt_job_no').value+'_'+document.getElementById('txt_style').value+'_'+document.getElementById('cbo_buyer_name').value+'_'+<? echo $company; ?>+'_'+document.getElementById('txt_order').value+'_'+document.getElementById('cbo_company').value, 'create_order_list_view', 'search_div', 'get_pass_entry_controller', 'setFilterGrid(\'list_view\',-1)')" style="width:100px;" />				
						</td>
					</tr>
					<tr>                  
						<td align="center" height="40" valign="middle" colspan="5">
						
							<input type="hidden" id="hidden_order_number" value="hidden_order_number" />
							<!-- END--> 
						</td>
					</tr>    
				</tbody>
			</table>    
			<div align="center" valign="top" id="search_div"> </div> 
			</form>
		</div>
	</body>           
	<script src="../../includes/functions_bottom.js" type="text/javascript"></script>
	</html>
	<?
	exit();
}

if($action=="create_order_list_view")
{
	$ex_data = explode("_",$data);
	$buyer_id =str_replace("'","", $ex_data[2]);
	//$company_id =str_replace("'","", $ex_data[3]);
	$company_id =str_replace("'","", $ex_data[5]);
	$style =str_replace("'","", $ex_data[1]);
	$job_no =str_replace("'","", $ex_data[0]);
	$order_no =str_replace("'","", $ex_data[4]);

    if($buyer_id!=0){  $buyer_cond=" and b.buyer_name=".$buyer_id." ";} else $buyer_cond="";
	if($style!=""){  $style_cond=" and b.style_ref_no like '%".$style."%' ";} else $style_cond="";
	if($job_no!=""){  $job_cond=" and b.job_no like '%".$job_no."%' ";} else $job_cond="";
	if($order_no!=""){  $order_cond=" and a.po_number ='".$order_no."' ";} else $order_cond="";
	
	$sql = "select a.id,b.job_no_prefix_num ,extract( year from b.insert_date) as year,b.buyer_name,a.po_number,b.style_ref_no from   wo_po_details_master b, wo_po_break_down a	where a.job_no_mst=b.job_no and a.status_active=1 and a.is_deleted=0   and b.company_name=".$company_id." $buyer_cond $style_cond $job_cond $order_cond";
	
	//echo $sql; die;
	//echo $sql_cond; die;
	$buyer_arr = return_library_array( "select id, buyer_name from  lib_buyer",'id','buyer_name');
	$arr=array(2=>$buyer_arr);
	echo create_list_view("list_view", "Job NO ,Year,Buyer Name ,Style,Order","100,100,200,150,150","750","260",0, $sql , "js_set_value", "po_number,id", "", 1, "0,0,buyer_name,0,0", $arr, "job_no_prefix_num,year,buyer_name,style_ref_no,po_number", "",'','') ;	
	exit();
}

if($action=="returnable_item_dtls_pupup")
{
	echo load_html_head_contents("Popup Info","../../", 1, 1, $unicode);
	extract($_REQUEST);

	?>
	<script>
		var permission='<? echo $permission; ?>';
		function termsName____(rowID)
		{
			//$("#termsconditionID_"+rowID).val('');

			$(function() {
				var terms_name = [<? echo substr($terms_name, 0, -1); ?>];
				/*$("#itemDescription_"+rowID).autocomplete({
					source: terms_name,
					select: function (event, ui) {
						$("#itemDescription_"+rowID).val(ui.item.value); // display the selected text
						//$("#termsconditionID_"+rowID).val(ui.item.id); // save selected id to hidden input
					}
				});*/
			});
		}

		function add_break_down_tr(i)
		{
			var row_num=$('#tbl_returnable_details tr').length-1;
			if (row_num!=i)
			{
				return false;
			}
			else
			{
				i++;
				$("#tbl_returnable_details tr:last").clone().find("input,select").each(function() {
					$(this).attr({
					'id': function(_, id) { var id=id.split("_"); return id[0] +"_"+ i },
					'name': function(_, name) { return name + i },
					'value': function(_, value) { return value }
					});
				}).end().appendTo("#tbl_returnable_details");
				$("#tbl_returnable_details tr:last td:first").html(i);
				//$('#itemDescription_'+i).removeAttr("onKeyPress").attr("onKeyPress","termsName("+i+");");
				//$('#itemDescription_'+i).removeAttr("onKeyUp").attr("onKeyUp","termsName("+i+");");
				$('#increase_'+i).removeAttr("onClick").attr("onClick","add_break_down_tr("+i+");");
				$('#decrease_'+i).removeAttr("onClick").attr("onClick","fn_deletebreak_down_tr("+i+")");
				$('#cboItemCat_'+i).val("");
				$('#itemDescription_'+i).val("");
				$('#qty_'+i).val("");
				$('#cbouom_'+i).val("");
				$('#txtRemarks_'+i).val("");
			}
		}

		function fn_deletebreak_down_tr(rowNo)
		{
			var numRow = $('table#tbl_returnable_details tbody tr').length;
			if(numRow==rowNo && rowNo!=1)
			{
				$('#tbl_returnable_details tbody tr:last').remove();
			}
		}

		function fnc_returnable_item_dtls( operation )
		{
			if (operation==2) {
				alert("Delete restricted");return;
			}
			var row_num=$('#tbl_returnable_details tr').length-1;
			var data_all="";
			for (var i=1; i<=row_num; i++)
			{
				if (form_validation('itemDescription_'+i,'Item Description')==false)
				{
					return;
				}

				data_all=data_all+get_submitted_data_string('get_pass_id*txt_system_id*itemDescription_'+i+'*cboItemCat_'+i+'*qty_'+i+'*cbouom_'+i+'*txtRemarks_'+i,"../../");
			}

			var data="action=save_update_delete_returnable&operation="+operation+'&total_row='+row_num+data_all;
			//alert(data);
			//freeze_window(operation);
			http.open("POST","get_pass_entry_controller.php",true);
			http.setRequestHeader("Content-type","application/x-www-form-urlencoded");
			http.send(data);
			http.onreadystatechange = fnc_returnable_item_reponse;
		}

		function fnc_returnable_item_reponse()
		{
			if(http.readyState == 4)
			{
				//alert(http.responseText);
				var reponse=trim(http.responseText).split('**');
				if (reponse[0].length>2) reponse[0]=10;
				if(reponse[0]==0)
				{
					alert('Data Saved Successfully');
					set_button_status(1, permission, 'fnc_returnable_item_dtls',1);
					//parent.emailwindow.hide();
				}
				if (reponse[0]==1) 
				{
					alert('Data Update Successfully');
					set_button_status(1, permission, 'fnc_returnable_item_dtls',1);
				}
				if (reponse[0]==10) 
				{
					alert('Invalid Operation');return;
				}
				if (reponse[0]==11) 
				{
					alert('This Gate Pass No. Already Gate Out. Changed Not Allowed.');return;
				}
				parent.emailwindow.hide();
			}
		}

		function itemDescription()
		{
			var itemDescrip = [];
			var row_num=$('#tbl_returnable_details tbody tr').length;
			//console.log(row_num);
			var flag=0;
			for(var i=1; i<=row_num; i++)
			{			
				var ItemCat=$('#cboItemCat_'+i).val();
				var itemDescription=$('#itemDescription_'+i).val();
				
				var cat_des=ItemCat+'***'+itemDescription;
				if(itemDescrip.includes(cat_des))
				{
					alert('Item Catagory wise Item Description found duplicate.');
					$('#itemDescription_'+i).val('');
					flag=1;
					return;
				}
				if(flag==1) break;
				itemDescrip.push(cat_des);

			}
		
			// var inputs = $('#tbl_returnable_details td:nth-child(3) input');

			// inputs.each(function()
			// {
			// 	var v = this.value;
			// 	if(!v) return true;
			// 	if(itemDescrip.includes(v))
			// 	inputs.filter(function()
			// 	{
			// 		return this.value == v;
			// 	}).val("");
			// 	itemDescrip.push(v);
			// });
		};
	
	</script>

	</head>

	<body>
	<div align="center" style="width:100%;" >
		<? echo load_freeze_divs ("../../",$permission,1); ?>
		<fieldset>
			<form id="returnable_1" autocomplete="off">
				<input type="hidden" id="get_pass_id" name="get_pass_id" value="<? echo str_replace("'","",$update_id) ?>"/>
				<input type="hidden" id="txt_system_id" name="txt_system_id" value="<? echo str_replace("'","",$txt_system_id) ?>"/>
				<table width="780" cellspacing="0" class="rpt_table" border="0" id="tbl_returnable_details" rules="all">
					<thead>
						<tr>
							<th width="50">Sl</th>
							<th width="130">Item Catagory</th>
							<th width="130">Item Description</th>
							<th width="130">Qty.</th>
							<th width="130">UOM</th>
							<th width="130">Remarks</th>
							<th ></th>
						</tr>
					</thead>
					<tbody>
					<?
					//id = $update_id
					$data_array=sql_select("SELECT id,entry_form,item_catagory_id,item_description,quantity,uom,remarks from returnable_item_dtls where gate_pass_id=$update_id and status_active=1 and is_deleted=0 and entry_form=251 order by id");
					if( count($data_array)>0 )
					{
						$i=0;
						foreach( $data_array as $row )
						{
							$i++;
							?>
								<tr id="settr_1" align="center">
									<td>
									<? echo $i;?>
									</td>
									<td>
									<? echo create_drop_down( "cboItemCat_".$i, 130, $item_category,"", 1, "-- Select Item --", $row[csf('item_catagory_id')], "itemDescription()","",""); ?>
									</td>
									<td>
									<input type="text" id="itemDescription_<? echo $i;?>"   name="itemDescription_<? echo $i;?>" style="width:90%"  class="text_boxes"  value="<? echo $row[csf('item_description')]; ?>" onChange="itemDescription()"/>
									</td>
									<td>
									<input type="text" id="qty_<? echo $i;?>"   name="qty_<? echo $i;?>" style="width:90%"  class="text_boxes_numeric required"  value="<? echo $row[csf('quantity')]; ?>" />
									</td>
									<td>
									<? echo create_drop_down( "cbouom_".$i, 130, $unit_of_measurement,"", 1, "-UOM-", $row[csf('uom')], "",0,"1,12,23,27"); ?>
									</td>
									<td>
									<input type="text" id="txtRemarks_<? echo $i;?>"   name="txtRemarks_<? echo $i;?>" style="width:90%"  class="text_boxes"  value="<? echo $row[csf('remarks')]; ?>" />
									</td>
									<td>
									<input type="button" id="increase_<? echo $i; ?>" style="width:30px" class="formbuttonplasminus" value="+" onClick="add_break_down_tr(<? echo $i; ?> )" />
									<input type="button" id="decrease_<? echo $i; ?>" style="width:30px" class="formbuttonplasminus" value="-" onClick="javascript:fn_deletebreak_down_tr(<? echo $i; ?>);" />
									</td>
								</tr>
							<?
						}
					}
					else
					{
						?>
						<tr id="settr_1" align="center">
							<td>
							<? echo 1;?>
							</td>
							<td>
							<? echo create_drop_down( "cboItemCat_1", 130, $item_category,"", 1, "-- Select Item --", $selected, "itemDescription()","",""); ?>
							</td>
							<td>
							<input type="text" id="itemDescription_1" name="itemDescription_1" style="width:90%" class=" text_boxes" value="" onChange="itemDescription()"/>
							</td>
							<td>
							<input type="text" id="qty_1" name="qty_1" style="width:90%"  class="text_boxes_numeric required" value="" />
							</td>
							<td>
								<? echo create_drop_down( "cbouom_1", 130, $unit_of_measurement,'', 1, '-UOM-', 12, "",0,"1,12,23,27" ); ?>
							</td>
							<td>
							<input type="text" id="txtRemarks_<? echo 1;?>"   name="txtRemarks_<? echo 1;?>" style="width:90%"  class="text_boxes"  value="" />
							</td>
							<td>
							<input type="button" id="increase_<? echo 1; ?>" style="width:30px" class="formbuttonplasminus" value="+" onClick="add_break_down_tr(<? echo 1; ?> )" />
							<input type="button" id="decrease_<? echo 1; ?>" style="width:30px" class="formbuttonplasminus" value="-" onClick="javascript:fn_deletebreak_down_tr(<? echo 1; ?>);" />
							</td>
						</tr>
						<?
					}
					?>
				</tbody>
				</table>

				<table width="650" cellspacing="0" class="" border="0">
					<tr>
						<td align="center" height="15" width="100%"> </td>
					</tr>
					<tr>
						<td align="center" width="100%" class="button_container">
							<?
							if( count($data_array)>0 )
							{
								echo load_submit_buttons( $permission, "fnc_returnable_item_dtls", 1,0 ,"reset_form('returnable_1','','','','')",1) ;
							}
							else
							{								
								echo load_submit_buttons( $permission, "fnc_returnable_item_dtls", 0,0 ,"reset_form('returnable_1','','','','')",1) ;
							}
							?>
						</td>
					</tr>
				</table>
			</form>
		</fieldset>
	</div>
	</body>
	<script src="../../includes/functions_bottom.js" type="text/javascript"></script>
	</html>
	<?
}

if($action=="save_update_delete_returnable")
{
	$process = array( &$_POST );
	//echo "10**string";die;

	extract(check_magic_quote_gpc( $process ));
	$isScanGatePassNo = return_field_value("gate_pass_id","inv_gate_out_scan","gate_pass_id='".str_replace("'","",$txt_system_id)."'");
	//echo $isScanGatePassNo.'==';
	$msg="This Gate Pass No. Already Gate Out. Changed Not Allowed.";
	if($isScanGatePassNo!='')
	{
		if($db_type==0) {mysql_query("ROLLBACK");}
		else {oci_rollback($con);} 
		echo "11**".$msg;
		exit();
	}
	if ($operation==0)  // Insert Here
	{
		$con = connect();
		if($db_type==0) mysql_query("BEGIN");

		$id=return_next_id( "id", "returnable_item_dtls", 1 );
		$field_array = "id,gate_pass_id,gate_pass_sys_id,entry_form,item_catagory_id,item_description,quantity,uom,remarks,inserted_by,insert_date"; $data_array = "";
		$idsArr = "";$j=0;
		for ($i=1;$i<=$total_row;$i++) //get_pass_id
		{
			$cboItemCat		= "cboItemCat_".$i;
			$itemDescription = "itemDescription_".$i;
			$qty			= "qty_".$i;
			$cbouom 		= "cbouom_".$i;
			$txtRemarks 	= "txtRemarks_".$i;

			$j++;
			if ($j!=1){ $data_array .=",";}
			$data_array .="(".$id.",".$get_pass_id.",".$txt_system_id.",251,".$$cboItemCat.",".$$itemDescription.",".$$qty.",".$$cbouom.",".$$txtRemarks.",".$user_id.",'".$pc_date_time."')";
			$id=$id+1;
		}

 		if($data_array!="")
		{
			//echo "10**insert into returnable_item_dtls(".$field_array.") values ".$data_array."";die;
			$rID=sql_insert("returnable_item_dtls",$field_array,$data_array,0);
		}
		//echo "10**$get_pass_id.'##'.$rID";die;
		//oci_commit($con); oci_rollback($con);
		if($db_type==0)
		{
			if( $rID && $data_array!=""){
				mysql_query("COMMIT");
				echo "0**";
			}
			else if($rID && $data_array==""){
				mysql_query("COMMIT");
				echo "0**";
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**";
			}
		}

		if( $rID && $data_array!="")
		{
			oci_commit($con);
			echo "0**";
		}
		else
		{
			oci_rollback($con);
			echo "10**";
		}
		disconnect($con);
		die;
	}
	if ($operation==1)  // Update Here
	{
		//echo "10**string";die;
		$con = connect();
		if($db_type==0) mysql_query("BEGIN");

		$id=return_next_id( "id", "returnable_item_dtls", 1 );
		$field_array = "id,gate_pass_id,gate_pass_sys_id,entry_form,item_catagory_id,item_description,quantity,uom,remarks,inserted_by,insert_date"; $data_array = "";
		$idsArr = "";$j=0;
		for ($i=1;$i<=$total_row;$i++) 
		{
			$cboItemCat		= "cboItemCat_".$i;
			$itemDescription = "itemDescription_".$i;
			$qty			= "qty_".$i;
			$cbouom 		= "cbouom_".$i;
			$txtRemarks 	= "txtRemarks_".$i;

			$j++;
			if ($j!=1){ $data_array .=",";}
			$data_array .="(".$id.",".$get_pass_id.",".$txt_system_id.",251,".$$cboItemCat.",".$$itemDescription.",".$$qty.",".$$cbouom.",".$$txtRemarks.",".$user_id.",'".$pc_date_time."')";
			$id=$id+1;
		}
		$get_pass_id = str_replace("'", '',$get_pass_id);
		//echo "10**delete from returnable_item_dtls where gate_pass_id=".$get_pass_id." and entry_form=251";die;

		$query = execute_query("delete from returnable_item_dtls where gate_pass_id=".$get_pass_id." and entry_form=251", 0);

 		if($data_array!="")
		{
			//echo "10**insert into returnable_item_dtls(".$field_array.") values ".$data_array."";die;
			$rID=sql_insert("returnable_item_dtls",$field_array,$data_array,0);
		}
		//echo "10**$rID##$query##$get_pass_id##$flag";die;
		//oci_commit($con); oci_rollback($con);
		if($db_type==0)
		{
			if( $rID && $data_array!="" && $query){
				mysql_query("COMMIT");
				echo "0**";
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**";
			}
		}

		if( $rID && $data_array!="" && $query)
		{
			oci_commit($con);
			echo "1**";
		}
		else
		{
			oci_rollback($con);
			echo "10**";
		}
		disconnect($con);
		die;
	}
}

//data save update delete here------------------------------//
if($action=="save_update_delete")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	
	if(str_replace("'",'',$txt_return_date)!='')
	{
		$return_date=strtotime(str_replace("'",'',$txt_return_date));
		$rece_date=strtotime(str_replace("'",'',$txt_rece_date));
		//$current_date=strtotime(date("d-m-Y"));
		if($rece_date>$return_date)
		{
			echo "26**"; die;
		}
	}	
	
	if( $operation==0 ) // Insert Here-------------------------------
	{
		$con = connect();
		if($db_type==0)	{ mysql_query("BEGIN");}
		
		$chalan_no=str_replace("'",'',$txt_chalan_no);
		$cbo_basis=str_replace("'",'',$cbo_basis);
		if($cbo_basis!=1)
		{
			$prev_gate_pass_sql=sql_select("SELECT sys_number from inv_gate_pass_mst where basis=$cbo_basis and company_id=$cbo_company_name and challan_no like '%$chalan_no%' and status_active=1 and is_deleted=0");
			if (count($prev_gate_pass_sql)>0)
			{
				$msg="Gate Pass Found. Gate Pass No: ".$prev_gate_pass_sql[0][csf('sys_number')];
				echo "11**".$msg;
				disconnect($con);exit();
			}
		}

		// echo "10**string";die;		
		$within_group=str_replace("'",'',$cbo_group);
		if ($within_group==1) $location_con="location_id"; //Yes
		else $location_con="location_name";

		if(str_replace("'","",$txt_system_id)!="") //update cbo_com_location_id
		{
			$id= return_field_value("id","inv_gate_pass_mst","sys_number=$txt_system_id");//check sys id for update or insert	
			$field_array="sent_by*sent_to*out_date*remarks*delivery_company*mobile_no*do_no*challan_no*currency_id*gate_pass_no*vhicle_number*time_hour*time_minute*carried_by*issue_purpose*com_location_id*$location_con*hidden_purpose_id*ready_to_approved*updated_by*update_date*status_active*is_deleted*returnable_gate_pass_reff*challan_entry_form";
			$data_array="".$cbo_sample."*".$cbo_item_category."*".$txt_sent_by."*".$txt_sent_to."*".$txt_receive_date."*".$txt_remarks_mst."*".$txt_delivery_company."*".$txt_mobile."*".$txt_do_no."*".$txt_challan_no."'*".$cbo_currency."*".$txt_gate_pass_no."*".$txt_vhicle_number.'*'.$txt_start_hours."*".$txt_start_minuties."*".$txt_carried_by."*'".$cbo_issue_purpose."*".$cbo_com_location_id."*".$cbo_location."*".$hidden_purpose_id."*".$cbo_ready_to_approved."*'".$user_id."'*'".$pc_date_time."'*1*0*'".$txt_returnable_gate_pass."'*".$hidden_entry_form."";
			//$rID=sql_update("inv_gate_pass_mst",$field_array,$data_array,"id",$id,1);	
			$return_no=str_replace("'",'',$txt_system_id);
		}
		else // new insert com_location_id
		{
			$id=return_next_id("id", "inv_gate_pass_mst", 1);		
			if($db_type==2)
			{	
				$new_sys_number=explode("*",return_mrr_number( str_replace("'","",$cbo_company_name), '', 'GPE', date("Y"), 5, "select sys_number_prefix,sys_number_prefix_num from inv_gate_pass_mst where company_id=$cbo_company_name and TO_CHAR(insert_date,'YYYY')=".date('Y',time())." order by id DESC ", "sys_number_prefix", "sys_number_prefix_num" ));
			}
			if($db_type==0)
			{	
				$new_sys_number=explode("*",return_mrr_number( str_replace("'","",$cbo_company_name), '', 'GPE', date("Y"), 5, "select sys_number_prefix,sys_number_prefix_num from inv_gate_pass_mst where company_id=$cbo_company_name and YEAR(insert_date)=".date('Y',time())." order by id DESC ", "sys_number_prefix", "sys_number_prefix_num" ));
			}
			//echo $cbo_basis;die;//
			
			if(str_replace("'",'',$cbo_basis)==13 || str_replace("'",'',$cbo_basis)==55 || str_replace("'",'',$cbo_basis)==62)
			{
				$txt_issue_no=0;
				//echo 'AA';die;
			}
			else
			{
				$txt_issue_no=$txt_issue_no;
				//echo 'BB';	die;
			}
			//echo $issue_no;die;
			//print_r($new_sys_number);die;

			$field_array="id,sys_number_prefix,sys_number_prefix_num,sys_number,company_id,com_location_id,basis,department_id,section,sent_by,vhicle_number,within_group,sent_to,out_date,attention,remarks,driver_name,driver_license_no,security_lock_no,delivery_company,do_no,mobile_no,challan_no,time_hour,time_minute,returnable,delivery_as,est_return_date,carried_by,issue_purpose,$location_con,hidden_purpose_id,issue_id,ready_to_approved,inserted_by,insert_date,status_active,is_deleted,returnable_gate_pass_reff,challan_entry_form";
			$data_array="(".$id.",'".$new_sys_number[1]."','".$new_sys_number[2]."','".$new_sys_number[0]."',".$cbo_company_name.",".$cbo_com_location_id.",".$cbo_basis.",".$cbo_department_name.",".$cbo_section.",".$txt_sent_by.",".$txt_vhicle_number.",".$cbo_group.",".$txt_sent_to.",".$txt_rece_date.",".$txt_attention.",".$txt_remarks_mst.",".$txt_driver_name.",".$txt_driver_license_no.",".$txt_security_lock_no.",".$txt_delivery_company.",".$txt_do_no.",".$txt_mobile.",".$txt_chalan_no.",".$txt_start_hours.",".$txt_start_minuties.",".$cbo_returnable.",".$cbo_delevery_as.",".$txt_return_date.",".$txt_carried_by.",".$cbo_issue_purpose.",".$cbo_location.",".$hidden_purpose_id.",".$txt_issue_no.",".$cbo_ready_to_approved.",'".$user_id."','".$pc_date_time."',1,0,".$txt_returnable_gate_pass.",".$hidden_entry_form.")";
			
			//$rID=sql_insert("inv_gate_pass_mst",$field_array,$data_array,1); 		
			$return_no=str_replace("'",'',$new_sys_number[0]);
		}
		
		$dtlsid=return_next_id("id", "inv_gate_pass_dtls", 1);		
        $field_array1="id, mst_id, sample_id, item_category_id,buyer_order,buyer_order_id,item_description,quantity,reject_qty,uom,rate,amount,remarks,uom_qty,inserted_by,insert_date,no_of_bags,total_carton_qty,status_active,is_deleted,challan_no,challan_details_id,system_id,prod_id,is_sales_flag";
		//$data_array1.="(".$dtlsid.",".$id.",".$$txt_sample.",".$$item_category_id.",".$$txt_order.",".$$txtorderid.",".$$txt_descrption.",".$$txt_qty.",".$$cbo_uom.",".$$txt_rate.",".$$txt_amount.",".$$txt_ramarks.",".$$txtuomqty.",'".$user_id."','".$pc_date_time."',".$$txtbag_id.",1,0)"; 
		$add_comma=0;		
		for($i=1; $i<=$row_num; $i++)
		{
			$item_category_id="cboitemcategory_".$i;
			$txt_sample="cbosample_".$i;
			$txt_descrption="txtitemdescription_".$i;
			$txt_qty="txtquantity_".$i;			
			if (str_replace("'","",$$txt_qty)=="") $txt_quantity=0;
			else $txt_quantity=$$txt_qty;
			$txt_reject_qty="txtrejectqty_".$i;
			$cbo_uom="cbouom_".$i;
			$txtuomqty="txtuomqty_".$i;
			$txt_rate="txtrate_".$i;
			$txt_amount="txtamount_".$i;
            $txtbag_id="txtbag_".$i;
            $txtcartonqnty="txtcartonqnty_".$i;
			$txt_order="txtorder_".$i;
			$txtorderid="txtorderidhidden_".$i;
			$cbo_buyer="cbo_buyer_".$i;
			$txt_ramarks="txtremarks_".$i;
			$update_details_id="updatedtlsid_".$i;
			$challandtlsIds="challandtlsIds_".$i;
			$challan_ids="challanIds_".$i;
			$systemid="systemid_".$i;
			$prodID="prodID_".$i;
			$issalesflag="hiddenissalesflag_".$i;

			if($cbo_basis==3){
				$systemid = $$systemid;
			}
			else
			{
				$systemid = "''";
			}

			if(str_replace("'","",$cbo_basis)==8)
			{
				if ($add_comma!=0) $data_array1 .=",";
				$data_array1.="(".$dtlsid.",".$id.",".$$txt_sample.",".$$item_category_id.",".$$txt_order.",".$$txtorderid.",".$$txt_descrption.",".$txt_quantity.",".$$txt_reject_qty.",".$$cbo_uom.",".$$txt_rate.",".$$txt_amount.",".$$txt_ramarks.",".$$txtuomqty.",'".$user_id."','".$pc_date_time."',".$$txtbag_id.",".$$txtcartonqnty.",1,0,".$$challan_ids.",".$$challandtlsIds.",".$systemid.",".$$prodID.",'".$$issalesflag."')"; 
				$dtlsid=$dtlsid+1;
				$add_comma++;
			}
			else
			{
				if(str_replace("'","",$txt_quantity)>0 || str_replace("'","",$$txt_reject_qty)>0)
				{
					if ($add_comma!=0) $data_array1 .=",";
					$data_array1.="(".$dtlsid.",".$id.",".$$txt_sample.",".$$item_category_id.",".$$txt_order.",".$$txtorderid.",".$$txt_descrption.",".$txt_quantity.",".$$txt_reject_qty.",".$$cbo_uom.",".$$txt_rate.",".$$txt_amount.",".$$txt_ramarks.",".$$txtuomqty.",'".$user_id."','".$pc_date_time."',".$$txtbag_id.",".$$txtcartonqnty.",1,0,".$$challan_ids.",".$$challandtlsIds.",".$systemid.",".$$prodID.",'".$$issalesflag."')"; 
					$dtlsid=$dtlsid+1;
					$add_comma++;
				}
			}			
		}
		//echo "10**INSERT INTO inv_gate_pass_dtls(".$field_array1.") VALUES ".$data_array1;oci_rollback($con);disconnect($con);die;
		$flag=1;
		
		if(str_replace("'","",$txt_system_id)!="") //update
		{
			$rID=sql_update("inv_gate_pass_mst",$field_array,$data_array,"id",$id,1);
			if($rID==1 && $flag==1) $flag=1; else $flag=0;
		}
		else // new insert
		{
			$rID=sql_insert("inv_gate_pass_mst",$field_array,$data_array,1); 
			if($rID==1 && $flag==1) $flag=1; else $flag=0;
		}
		
		$dtlsrID=sql_insert("inv_gate_pass_dtls",$field_array1,$data_array1,1); 
		if($dtlsrID==1 && $flag==1) $flag=1; else $flag=0;
		
		if($flag==1 && str_replace("'","",$cbo_basis)==12)
		{
			$gatepassup=execute_query( "update pro_ex_factory_delivery_mst set is_gate_pass=1 where id =".$txt_issue_no." and status_active=1 and is_deleted=0",1);
			if($gatepassup==1 && $flag==1) $flag=1; else $flag=0;
		}
 		//echo "10**".$data_array1; die;
 		// echo "10**".$rID ."&&". $dtlsrID; die;
		if($db_type==0)
		{
			if($flag==1)
			{
				mysql_query("COMMIT");  
				echo "0**".str_replace("'",'',$return_no)."**".str_replace("'",'',$id);
			}
			else
			{
				mysql_query("ROLLBACK"); 
				echo "10**".str_replace("'",'',$return_no)."**".str_replace("'",'',$id);
			}
		}
		if($db_type==2||$db_type==1)
		{	
			if($flag==1)
			{
				oci_commit($con);
				echo "0**".str_replace("'",'',$return_no)."**".str_replace("'",'',$id)."**".str_replace("'",'',$row_num);
			}
			else
			{
				oci_rollback($con);
				echo "10**".str_replace("'",'',$return_no)."**".str_replace("'",'',$id);
			}
		}
		disconnect($con);
		die;
	}	
	else if ($operation==1) // Update Here----------------------------------------------------------
	{
		$con = connect();		
		if($db_type==0)	{ mysql_query("BEGIN"); }
		check_table_status( $_SESSION['menu_id'],0);
		if( str_replace("'","",$txt_system_id) == "")
		{
			echo "15";disconnect($con);exit(); 
		}
		$isScanGatePassNo = return_field_value("gate_pass_id","inv_gate_out_scan","gate_pass_id='".str_replace("'","",$txt_system_id)."'");
		//echo $isScanGatePassNo.'==';
		$msg="This Gate Pass No. Already Gate Out. Changed Not Allowed.";
		if($isScanGatePassNo!='')
		{
			if($db_type==0) {mysql_query("ROLLBACK");}
			else {oci_rollback($con);} 
			echo "11**".$msg;
			disconnect($con);exit();
		}
		
		$within_group=str_replace("'",'',$cbo_group);
		if ($within_group==1) $location_con="location_id";
		else $location_con="location_name";

		//inv_gate_in_mst master table UPDATE here START----------------------//
		if(str_replace("'",'',$cbo_basis)==13 || str_replace("'",'',$cbo_basis)==55  || str_replace("'",'',$cbo_basis)==62 )
		{
			$txt_issue_no=0;
			//echo 'AA';die;
		}
		else
		{
			$txt_issue_no=$txt_issue_no;
			//echo 'BB';	die;
		}	

		/*#### Stop not eligible field from update operation start ####*/
		// com_location_id*sent_to*within_group*
		// $cbo_com_location_id."*". $txt_sent_to."'*".$cbo_group."*'".
		/*#### Stop not eligible field from update operation end ####*/
		
		$field_array="department_id*section*sent_by*remarks*driver_name*driver_license_no*security_lock_no*delivery_company*do_no*mobile_no*vhicle_number*attention*out_date*returnable*time_hour*time_minute*delivery_as*est_return_date*carried_by*issue_purpose*$location_con*ready_to_approved*updated_by*update_date*status_active*is_deleted*returnable_gate_pass_reff*challan_entry_form";
		$data_array="".$cbo_department_name."*".$cbo_section."*".$txt_sent_by."*".$txt_remarks_mst."*".$txt_driver_name."*".$txt_driver_license_no."*".$txt_security_lock_no."*".$txt_delivery_company."*".$txt_do_no."*".$txt_mobile."*".$txt_vhicle_number."*".$txt_attention."*".$txt_rece_date."*".$cbo_returnable."*".$txt_start_hours."*".$txt_start_minuties."*".$cbo_delevery_as."*".$txt_return_date."*".$txt_carried_by."*".$cbo_issue_purpose."*".$cbo_location."*".$cbo_ready_to_approved."*'".$user_id."'*'".$pc_date_time."'*1*0*".$txt_returnable_gate_pass."*".$hidden_entry_form."";
		
		$dtlsid=return_next_id("id", "inv_gate_pass_dtls", 1);		
		$field_array1="id,mst_id,sample_id,item_category_id,buyer_order,buyer_order_id,item_description,quantity,reject_qty,uom,rate,amount,no_of_bags,total_carton_qty,remarks,uom_qty,system_id,inserted_by,insert_date,status_active,is_deleted,prod_id";
		$field_arrayup = "item_category_id*sample_id*buyer_order*buyer_order_id*item_description*quantity*reject_qty*uom*rate*amount*no_of_bags*total_carton_qty*remarks*system_id*updated_by*update_date*status_active*is_deleted*prod_id";
		$add_comma=0;
		for($i=1; $i<=$row_num; $i++)
		{
			$item_category_id="cboitemcategory_".$i;
			$txt_sample="cbosample_".$i;
			$txt_descrption="txtitemdescription_".$i;
			$txt_qty="txtquantity_".$i;
			if (str_replace("'","",$$txt_qty)=="") $txt_quantity=0;
			else $txt_quantity=$$txt_qty;
			$txt_reject_qty="txtrejectqty_".$i;
			$cbo_uom="cbouom_".$i;
			$txtuomqty="txtuomqty_".$i;
			$txt_rate="txtrate_".$i;
			$txt_amount="txtamount_".$i;
			$txtbag="txtbag_".$i;
			$txtcartonqnty="txtcartonqnty_".$i;
			$txt_order="txtorder_".$i;
			$txtorderid="txtorderidhidden_".$i;
			$cbo_buyer="cbo_buyer_".$i;
			$txt_ramarks="txtremarks_".$i;
			$update_details_id="updatedtlsid_".$i;
			$systemid="systemid_".$i;
			$prodID="prodID_".$i;

			if($cbo_basis==3){

				$systemid = $$systemid;
			}
			else
			{
				$systemid = "''";
			}

 			if(str_replace("'","",$txt_quantity)>0 && str_replace("'",'',$$update_details_id)=="")
			{
				if ($add_comma!=0) $data_array1 .=",";
				$data_array1.="(".$dtlsid.",".$update_id.",".$$txt_sample.",".$$item_category_id.",".$$txt_order.",".$$txtorderid.",".$$txt_descrption.",".$txt_quantity.",".$$txt_reject_qty.",".$$cbo_uom.",".$$txt_rate.",".$$txt_amount.",".$$txtbag.",".$$txtcartonqnty.",".$$txt_ramarks.",".$$txtuomqty.",".$systemid.",'".$user_id."','".$pc_date_time."',1,0,".$$prodID.")"; 
				$dtlsid=$dtlsid+1;
				$add_comma++;
			}
			else  
			{
				$updateID_array[]=str_replace("'",'',$$update_details_id); 
				$data_array_up[str_replace("'",'',$$update_details_id)]=explode("*",("".$$item_category_id."*".$$txt_sample."*".$$txt_order."*".$$txtorderid."*".$$txt_descrption."*".$txt_quantity."*".$$txt_reject_qty."*".$$cbo_uom."*".$$txt_rate."*".$$txt_amount."*".$$txtbag."*".$$txtcartonqnty."*".$$txt_ramarks."*".$systemid."*'".$user_id."'*'".$pc_date_time."'*1*0*".$$prodID.""));
			}
		}
		$dtlsUpdate_id_array=array();
		$sql_dtls="Select id from inv_gate_pass_dtls where mst_id=$update_id and status_active=1 and is_deleted=0";
		$nameArray=sql_select( $sql_dtls );
		foreach($nameArray as $row)
		{
			$dtlsUpdate_id_array[]=$row[csf('id')];
		}
		if(implode(',',$updateID_array)!="")
		{
			$distance_delete_id=array_diff($dtlsUpdate_id_array,$updateID_array);
		}
		else
		{
			$distance_delete_id=$dtlsUpdate_id_array;
		}
		//print_r($distance_delete_id);
		$flag=1;
		$field_array_del="status_active*is_deleted*updated_by*update_date";
		$data_array_del="'0'*'1'*".$_SESSION['logic_erp']['user_id']."*'".$pc_date_time."'";
		if(implode(',',$distance_delete_id)!="")
		{
			foreach($distance_delete_id as $id_val)
			{
				$rID=sql_update("inv_gate_pass_dtls",$field_array_del,$data_array_del,"id","".$id_val."",1);
				if($rID) $flag=1; else $flag=0;
			}
		}
		
		//echo "INSERT INTO inv_gate_pass_mst(".$field_array.") VALUES ".$data_array;die;
		//print_r($data_array_up);
		
		//$rID=sql_update_gate_pass("inv_gate_pass_mst",$field_array,$data_array,"id",$update_id,1);
		$rID=sql_update("inv_gate_pass_mst",$field_array,$data_array,"id",$update_id,1);
		if($rID==1 && $flag==1) $flag=1; else $flag=0;
		$dtlsrID=execute_query(bulk_update_sql_statement("inv_gate_pass_dtls","id",$field_arrayup,$data_array_up,$updateID_array),1);
		if($flag==1) 
		{
			if($dtlsrID==1) $flag=1; else $flag=0; 
		}		
		
		//echo "INSERT INTO inv_gate_pass_dtls(".$field_array1.") VALUES ".$data_array1;die;
		if($data_array1!="") 
		{
			$dtlsrID1=sql_insert("inv_gate_pass_dtls",$field_array1,$data_array1,1); 
			if($flag==1) 
			{
				if($dtlsrID1==1) $flag=1; else $flag=0; 
			} 
		}
		
		if($flag==1 && str_replace("'","",$cbo_basis)==12)
		{
			$gatepassup=execute_query( "update pro_ex_factory_delivery_mst set is_gate_pass=1 where id =".$txt_issue_no." and status_active=1 and is_deleted=0",1);
			if($gatepassup==1 && $flag==1) $flag=1; else $flag=0;
		}
		// echo "10**".$rID.'=='.$dtlsrID.'='.$flag;die;
		if($db_type==0)
		{	
			if($flag==1)
			{
				mysql_query("COMMIT");  
				echo "1**".str_replace("'",'',$txt_system_id)."**".str_replace("'",'',$update_id)."**".str_replace("'",'',$row_num);
			}
			else
			{
				mysql_query("ROLLBACK"); 
				echo "10**".str_replace("'",'',$txt_system_id)."**".str_replace("'",'',$update_id)."**".str_replace("'",'',$row_num);
			}
		}
		else if($db_type==2||$db_type==1)
		{	
			if($flag==1)
			{
				oci_commit($con);
				echo "1**".str_replace("'",'',$txt_system_id)."**".str_replace("'",'',$update_id)."**".str_replace("'",'',$row_num);
			}
			else
			{
				oci_rollback($con);
				echo "10**".str_replace("'",'',$txt_system_id)."**".str_replace("'",'',$update_id)."**".str_replace("'",'',$row_num);
			}
		}
		disconnect($con);
		die;
	}
	else if ($operation==2) // Delete Here----------------------------------------------------------
	{
		$con = connect(); 
		if($db_type==0)	{ mysql_query("BEGIN"); }
		// master table delete here---------------------------------------
		
		$field_array="updated_by*update_date*status_active*is_deleted";
		$data_array="'".$user_id."'*'".$pc_date_time."'*0*1";
		$flag=1;
		$rID=sql_update("inv_gate_pass_mst",$field_array,$data_array,"id",$update_id,1);
		if($rID==1 && $flag==1) $flag=1; else $flag=0;
		$dtlsrID=sql_update("inv_gate_pass_dtls",$field_array,$data_array,"mst_id",$update_id,1);	
		if($dtlsrID==1 && $flag==1) $flag=1; else $flag=0;
		
		if($flag==1 && str_replace("'","",$cbo_basis)==12)
		{
			$gatepassup=execute_query( "update pro_ex_factory_delivery_mst set is_gate_pass=0 where id =".$txt_issue_no." and status_active=1 and is_deleted=0",1);
			if($gatepassup==1 && $flag==1) $flag=1; else $flag=0;
		}	
		/*$rID = sql_update("inv_gate_pass_mst",'status_active*is_deleted','0*1',"id",$update_id,1);
		$dtlsrID = sql_update("inv_gate_pass_dtls",'status_active*is_deleted','0*1',"mst_id",$update_id,1);*/
		
		if($db_type==2)
		{	
			if($flag==1)
			{
				oci_commit($con);
				echo "2**".str_replace("'",'',$txt_system_id)."**".str_replace("'",'',$update_id);
			}
			else
			{
				oci_rollback($con);
				echo "10**".str_replace("'",'',$txt_system_id)."**".str_replace("'",'',$update_id);
			}
		}
		if($db_type==0)
		{
			if($flag==1)
			{
				mysql_query("COMMIT");  
				echo "2**"."**".str_replace("'",'',$txt_system_id)."**".str_replace("'",'',$id);
			}
			else
			{
				mysql_query("ROLLBACK"); 
				echo "10**"."**".str_replace("'",'',$txt_system_id)."**".str_replace("'",'',$id);
			}
		}
		disconnect($con);
		die;
	}		
}

if($action=="show_update_list_view")
{
	$tbl_row=0;
 	$basis= return_field_value("basis","inv_gate_pass_mst","id=$data");
	$sql = "SELECT a.id,sample_id,a.item_category_id,a.item_description,a.quantity,a.reject_qty,a.uom_qty,a.uom,a.rate,a.amount,a.remarks,a.buyer_order,a.buyer_order_id, a.no_of_bags, a.total_carton_qty, a.challan_no, a.challan_details_id,a.system_id, a.prod_id,b.approved,a.is_sales_flag 
	from inv_gate_pass_dtls a,inv_gate_pass_mst b where  a.mst_id=b.id and a.mst_id='$data'  and a.status_active=1 and a.is_deleted=0 order by a.id"; 
	$result=sql_select($sql);
	$count_td=count($result);
	$garment_item_uom_check_arr=array();
	$total_quantity=0;
	foreach($result as $row)
	{
		$tbl_row++;
		if($tbl_row!=$count_td) $display="none"; 
		else $display="";
		
		if ($row[csf("item_category_id")]!=0) $dd=0;
		else $dd=1;			
		
		if($row[csf("sample_id")]!=0) $mm=0;
		else $mm=1;

		$sys_number_id = $row[csf("system_id")];

		if ($basis==2){
			$row[csf('buyer_order')]="";
			$row[csf('buyer_order_id')]="";
		}

		?>
		<tr class="" id="tr_<? echo $tbl_row; ?>">
        <? 
        if($basis==1)
		{
			
			if($row[csf('approved')]==1){$disable_filed="disabled";}
			?>
	        <td><? echo create_drop_down( "cboitemcategory_".$tbl_row, 120,$item_category,"",1, "-- Select --",$row[csf('item_category_id')] , "gate_enable_disable(1)",'0' ); ?>

	        	<input type="hidden" name="challanIds_<? echo $tbl_row; ?>" id="challanIds_<? echo $tbl_row; ?>" value="<? echo $row[csf('challan_no')]; ?>">
                <input type="hidden" name="challandtlsIds_<? echo $tbl_row; ?>" id="challandtlsIds_<? echo $tbl_row; ?>" value="<? echo $row[csf('challan_details_id')]; ?>">
	        </td>
            <td><? echo create_drop_down( "cbosample_".$tbl_row, 120, "select id,sample_name from lib_sample where status_active=1 order by sample_name","id,sample_name",1, "-- Select --",$row[csf('sample_id')], "gate_enable_disable(2)" ); ?></td>
            <td><input type="text" name="txtitemdescription_<? echo $tbl_row; ?>" id="txtitemdescription_<? echo $tbl_row; ?>" class="text_boxes" style="width:180px;" value="<? echo $row[csf('item_description')];?>" >
            <input type="hidden" name="prodID_<? echo $tbl_row; ?>" id="prodID_<? echo $tbl_row; ?>" value="<? echo $row[csf('prod_id')];?>">
            </td>
            <td><input type="text" name="txtquantity_<? echo $tbl_row; ?>" id="txtquantity_<? echo $tbl_row; ?>" class="text_boxes_numeric" onKeyUp="fn_calculate_amount(this.id)"   value="<? echo $row[csf('quantity')];?>" style="width:60px;" <? echo $disable_filed; ?> ></td>
            <td><input type="text" name="txtrejectqty_<? echo $tbl_row; ?>" id="txtrejectqty_<? echo $tbl_row; ?>" class="text_boxes_numeric" value="<? echo $row[csf('reject_qty')];?>" style="width:60px;" disabled=""></td>
            <td><? echo create_drop_down( "cbouom_".$tbl_row, 60, $unit_of_measurement,"", 1, "-- Select--", $row[csf('uom')], "",0 ); ?>
            <input type="hidden" name="txtuomqty_<? echo $tbl_row; ?>" id="txtuomqty_<? echo $tbl_row; ?>" class="text_boxes" onKeyUp="fn_calculate_amount(this.id)" value="<? echo $row[csf('uom_qty')];?>" style="width:60px;" ></td>
            <td><input type="text" name="txtrate_<? echo $tbl_row; ?>" id="txtrate_<? echo $tbl_row; ?>" class="text_boxes_numeric" onKeyUp="fn_calculate_amount(this.id)"  value="<? echo $row[csf('rate')];?>" style="width:70px" <? echo $disable_filed; ?>  ></td>
            <td><input type="text" name="txtamount_<? echo $tbl_row; ?>" id="txtamount_<? echo $tbl_row; ?>" class="text_boxes_numeric" style="width:80px"  value="<? echo $row[csf('amount')];?>" readonly ></td>
            <td><input type="text" name="txtbag_<? echo $tbl_row; ?>" id="txtbag_<? echo $tbl_row; ?>" class="text_boxes_numeric" style="width:70px"  value="<? echo $row[csf('no_of_bags')];?>"  ></td>
            <td><input type="text" name="txtcartonqnty_<? echo $tbl_row; ?>" id="txtcartonqnty_<? echo $tbl_row; ?>" class="text_boxes_numeric" style="width:70px"  value="<? echo $row[csf('total_carton_qty')];?>" ></td>
            <td><input type="text" name="txtorder_<? echo $tbl_row; ?>" id="txtorder_<? echo $tbl_row; ?>" class="text_boxes" style="width:80px" onDblClick="openmypage_order(this.id);" value="<? echo $row[csf('buyer_order')];;?>" readonly  >
            <input type="hidden" id="txtorderidhidden_<? echo $tbl_row; ?>" name="txtorderidhidden_<? echo $tbl_row; ?>"  class="text_boxes" style="width:20px" value="<? echo $row[csf('buyer_order_id')];?>" />
            </td>
            <td><input type="text" name="txtremarks_<? echo $tbl_row; ?>" id="txtremarks_<? echo $tbl_row; ?>" class="text_boxes" style="width:100px"  value="<? echo $row[csf('remarks')];?>">
            	<input type="hidden" id="updatedtlsid_<? echo $tbl_row; ?>" name="updatedtlsid_<? echo $tbl_row; ?>"  value="<? echo $row[csf('id')];?>" />
	        </td>
	        <?
		}
		else
		{
			$total_quantity+=$row[csf('quantity')];
			$garment_item_uom_check_arr[$row[csf('uom')]]=$row[csf('uom')];
			?>
            <td><? echo create_drop_down( "cboitemcategory_".$tbl_row, 120,$item_category,"",1, "-- Select --",$row[csf('item_category_id')] , "gate_enable_disable(1)",'1' ); ?>
            	
            	<? //For Embellisment Issue   
            	if ($basis==13 || $basis==55  || $basis==62) { ?>
            		<input type="hidden" name="challanIds_<? echo $tbl_row; ?>" id="challanIds_<? echo $tbl_row; ?>" value="<? echo $row[csf('challan_no')];?>">
            	<? }else{ ?>
            		<input type="hidden" name="challanIds_<? echo $tbl_row; ?>" id="challanIds_<? echo $tbl_row; ?>" value="<? echo $row[csf('challan_no')]; ?>">
            	<? } ?>
                
                <input type="hidden" name="challandtlsIds_<? echo $tbl_row; ?>" id="challandtlsIds_<? echo $tbl_row; ?>" value="<? echo $row[csf('challan_details_id')]; ?>">

            </td>
            <td><? echo create_drop_down( "cbosample_".$tbl_row, 120, "select id,sample_name from lib_sample where status_active=1 order by sample_name","id,sample_name",1, "-- Select --",$row[csf('sample_id')], "gate_enable_disable(2)",$mm ); ?></td>
            <td><input type="text" name="txtitemdescription_<? echo $tbl_row; ?>" id="txtitemdescription_<? echo $tbl_row; ?>" class="text_boxes" style="width:180px;" value="<? echo $row[csf('item_description')];?>" disabled="">
            <input type="hidden" name="prodID_<? echo $tbl_row; ?>" id="prodID_<? echo $tbl_row; ?>" value="<? echo $row[csf('prod_id')];?>">
            </td>
            <td><input type="text" name="txtquantity_<? echo $tbl_row; ?>" id="txtquantity_<? echo $tbl_row; ?>" class="text_boxes_numeric" onKeyUp="fn_calculate_amount(this.id)"   value="<? echo $row[csf('quantity')];?>" style="width:60px;" disabled=""></td>
            <td><input type="text" name="txtrejectqty_<? echo $tbl_row; ?>" id="txtrejectqty_<? echo $tbl_row; ?>" class="text_boxes_numeric" value="<? echo $row[csf('reject_qty')];?>" style="width:60px;" disabled=""></td>
            <td><? echo create_drop_down( "cbouom_".$tbl_row, 60, $unit_of_measurement,"", 1, "-- Select--", $row[csf('uom')], "",1 ); ?>
            <input type="hidden" name="txtuomqty_<? echo $tbl_row; ?>" id="txtuomqty_<? echo $tbl_row; ?>" class="text_boxes" onKeyUp="fn_calculate_amount(this.id)" value="<? echo $row[csf('uom_qty')];?>" style="width:60px;" ></td>
            <td><input type="text" name="txtrate_<? echo $tbl_row; ?>" id="txtrate_<? echo $tbl_row; ?>" class="text_boxes_numeric" onKeyUp="fn_calculate_amount(this.id)"  value="<? echo $row[csf('rate')];?>" style="width:70px" disabled=""></td>
            <td><input type="text" name="txtamount_<? echo $tbl_row; ?>" id="txtamount_<? echo $tbl_row; ?>" class="text_boxes_numeric" style="width:80px"  value="<? echo $row[csf('amount')];?>" readonly disabled=""></td>
            <td><input type="text" name="txtbag_<? echo $tbl_row; ?>" id="txtbag_<? echo $tbl_row; ?>" class="text_boxes_numeric" style="width:70px"  value="<? echo $row[csf('no_of_bags')];?>"  ></td>
            <td><input type="text" name="txtcartonqnty_<? echo $tbl_row; ?>" id="txtcartonqnty_<? echo $tbl_row; ?>" class="text_boxes_numeric" style="width:70px"  value="<? echo $row[csf('total_carton_qty')]; ?>" <? if($basis!=12) echo "disabled=disabled"; else echo ''; ?> ></td>
            <td><input type="text" name="txtorder_<? echo $tbl_row; ?>" id="txtorder_<? echo $tbl_row; ?>" class="text_boxes" style="width:80px" onDblClick="openmypage_order(this.id);" value="<? echo $row[csf('buyer_order')]; ?>" readonly  disabled="">
            <input type="hidden" id="txtorderidhidden_<? echo $tbl_row; ?>" name="txtorderidhidden_<? echo $tbl_row; ?>"  class="text_boxes" style="width:20px" value="<? echo $row[csf('buyer_order_id')]; ?>" />
            </td>
            <?php
            	if($basis==3)
            	{ 
            ?>
            <td>
            	<input type="text" name="systemid_<? echo $tbl_row; ?>" id="systemid_<? echo $tbl_row; ?>" class="text_boxes" style="width:120px" value="<? echo $sys_number_id;?>" readonly disabled>
                  <input type="hidden" name="hiddenissalesflag_<? echo $tbl_row; ?>" id="hiddenissalesflag_<? echo $tbl_row; ?>" class="text_boxes" style="width:120px" value="<? echo $row[csf('is_sales_flag')];;?>" readonly disabled>
            </td>
            <?php 
            	}
            ?>
            <td><input type="text" name="txtremarks_<? echo $tbl_row; ?>" id="txtremarks_<? echo $tbl_row; ?>" class="text_boxes" style="width:100px"  value="<? echo $row[csf('remarks')];?>">
            	<input type="hidden" id="updatedtlsid_<? echo $tbl_row; ?>" name="updatedtlsid_<? echo $tbl_row; ?>"  value="<? echo $row[csf('id')];?>" />
            </td>
	        <?
		}
		?>
        <td>
        <?
        if($basis==1)
		{
			?>
            <input type="button" id="increase_<? echo $tbl_row; ?>" style="width:25px;display:<? echo $display; ?>" class="formbutton" value="+" onClick="add_break_down_tr(<? echo $tbl_row;?>)" />
            <input type="button" id="decrease_<? echo $tbl_row; ?>" style="width:25px;display:<? echo $display; ?>" class="formbutton" value="-" onClick="javascript:fn_deletebreak_down_tr(<? echo $tbl_row; ?>,'tbl_order_details');" />
            <?
        }
		?>
        </td>
		</tr>		
		<?php		
		$i++;
	}

	if ($basis==50)
	{
		if (count($garment_item_uom_check_arr)==1)
		{
			?>
			<tr style="background-color:#ddd;" id="total_display_last_tr">
				<td width="120"></td>
				<td width="120"></td>
				<td width="180" align="right"><strong>Total:</strong></td>
				<td width="60" align="right"><strong><? echo $total_quantity; ?></strong></td>
				<td width="60"></td>
				<td width="60"></td>
				<td width="70"></td>
				<td width="80"></td>
				<td width="70"></td>
				<td width="70"></td>
				<td width="80"></td>
				<td width="100"></td>
			</tr>
			<?
		}
	}
	exit();
} 

if($action=="show_returnable_update_list_view")
{
	$tbl_row=0;
 	$basis= return_field_value("basis","inv_gate_pass_mst","id=$data");
	$sql = "select a.id,sample_id,a.item_category_id,a.item_description,a.quantity, a.reject_qty,a.uom_qty,a.uom,a.rate,a.amount,a.remarks,a.buyer_order,a.buyer_order_id, a.no_of_bags, a.total_carton_qty, a.challan_no,a.prod_id from inv_gate_pass_dtls a where  a.mst_id='$data' and a.status_active=1 and a.is_deleted=0 order by a.id"; 
	$result=sql_select($sql);
	$count_td=count($result);
	foreach($result as $row)
	{
		$tbl_row++;
		if($tbl_row!=$count_td) $display="none"; 
		else $display="";
		
		if($row[csf("item_category_id")]!=0) $dd=0;
		else $dd=1;

		if($row[csf("sample_id")]!=0) $mm=0;
		else $mm=1;
		
		?>
		<tr class="" id="tr_<? echo $tbl_row; ?>">
        <? 
        if($basis==1)
		{
		    ?>
            <td><? echo create_drop_down( "cboitemcategory_".$tbl_row, 120,$item_category,"",1, "-- Select --",$row[csf('item_category_id')] , "gate_enable_disable(1)",'0' ); ?>

        	<input type="hidden" name="challanIds_<? echo $tbl_row; ?>" id="challanIds_<? echo $tbl_row; ?>" value="<? echo $row[csf('challan_no')]; ?>">
            <input type="hidden" name="challandtlsIds_<? echo $tbl_row; ?>" id="challandtlsIds_<? echo $tbl_row; ?>" value="<? echo $row[csf('id')]; ?>">
            </td>
            <td><? echo create_drop_down( "cbosample_".$tbl_row, 120, "select id,sample_name from lib_sample where status_active=1 order by sample_name","id,sample_name",1, "-- Select --",$row[csf('sample_id')], "gate_enable_disable(2)" ); ?></td>
            <td>
            
            <input type="text" name="txtitemdescription_<? echo $tbl_row; ?>" id="txtitemdescription_<? echo $tbl_row; ?>" class="text_boxes" style="width:180px;" value="<? echo $row[csf('item_description')];?>" >
            <input type="hidden" name="prodID_<? echo $tbl_row; ?>" id="prodID_<? echo $tbl_row; ?>" value="<? echo $row[csf('prod_id')];?>">
            
            
            </td>
            <td><input type="text" name="txtquantity_<? echo $tbl_row; ?>" id="txtquantity_<? echo $tbl_row; ?>" class="text_boxes_numeric" onKeyUp="fn_calculate_amount(this.id)"   value="<? echo $row[csf('quantity')];?>" style="width:60px;" ></td>
            <td><input type="text" name="txtrejectqty_<? echo $tbl_row; ?>" id="txtrejectqty_<? echo $tbl_row; ?>" class="text_boxes_numeric" value="<? echo $row[csf('reject_qty')];?>" style="width:60px;"></td>
            <td><? echo create_drop_down( "cbouom_".$tbl_row, 80, $unit_of_measurement,"", 1, "-- Select--", $row[csf('uom')], "",0 ); ?>
            <input type="hidden" name="txtuomqty_<? echo $tbl_row; ?>" id="txtuomqty_<? echo $tbl_row; ?>" class="text_boxes" onKeyUp="fn_calculate_amount(this.id)" value="<? echo $row[csf('uom_qty')];?>" style="width:60px;" ></td>
            <td><input type="text" name="txtrate_<? echo $tbl_row; ?>" id="txtrate_<? echo $tbl_row; ?>" class="text_boxes_numeric" onKeyUp="fn_calculate_amount(this.id)"  value="<? echo $row[csf('rate')];?>" style="width:70px" ></td>
            <td><input type="text" name="txtamount_<? echo $tbl_row; ?>" id="txtamount_<? echo $tbl_row; ?>" class="text_boxes_numeric" style="width:80px"  value="<? echo $row[csf('amount')];?>" readonly ></td>
            <td><input type="text" name="txtbag_<? echo $tbl_row; ?>" id="txtbag_<? echo $tbl_row; ?>" class="text_boxes_numeric" style="width:70px"  value="<? echo $row[csf('no_of_bags')];?>"  ></td>
            <td><input type="text" name="txtcartonqnty_<? echo $tbl_row; ?>" id="txtcartonqnty_<? echo $tbl_row; ?>" class="text_boxes_numeric" style="width:70px"  value="<? echo $row[csf('total_carton_qty')];?>" disabled=disabled ></td>
            <td><input type="text" name="txtorder_<? echo $tbl_row; ?>" id="txtorder_<? echo $tbl_row; ?>" class="text_boxes" style="width:80px" onDblClick="openmypage_order(this.id);" value="<? echo $row[csf('buyer_order')];;?>" readonly  >
            <input type="hidden" id="txtorderidhidden_<? echo $tbl_row; ?>" name="txtorderidhidden_<? echo $tbl_row; ?>"  class="text_boxes" style="width:20px" value="<? echo $row[csf('buyer_order_id')];?>" />
            </td>
            <td><input type="text" name="txtremarks_<? echo $tbl_row; ?>" id="txtremarks_<? echo $tbl_row; ?>" class="text_boxes" style="width:100px"  value="<? echo $row[csf('remarks')];?>">
            	<input type="hidden" id="updatedtlsid_<? echo $tbl_row; ?>" name="updatedtlsid_<? echo $tbl_row; ?>"  value="<? echo $row[csf('id')];?>" />
            </td>
            <?
		}
		else
		{
		    ?>
            <td><? echo create_drop_down( "cboitemcategory_".$tbl_row, 120,$item_category,"",1, "-- Select --",$row[csf('item_category_id')] , "gate_enable_disable(1)",'1' ); ?>
            	
            	<? //For Embellisment Issue   
            	if ($basis==13 || $basis==55  || $basis==62) { ?>
            		<input type="hidden" name="challanIds_<? echo $tbl_row; ?>" id="challanIds_<? echo $tbl_row; ?>" value="<? echo $row[csf('challan_no')];?>">
            	<? }else{ ?>
            		<input type="hidden" name="challanIds_<? echo $tbl_row; ?>" id="challanIds_<? echo $tbl_row; ?>" value="<? echo $row[csf('challan_no')]; ?>">
            	<? } ?>
                
                <input type="hidden" name="challandtlsIds_<? echo $tbl_row; ?>" id="challandtlsIds_<? echo $tbl_row; ?>" value="<? echo $row[csf('id')]; ?>">

            </td>
            <td><? echo create_drop_down( "cbosample_".$tbl_row, 120, "select id,sample_name from lib_sample where status_active=1 order by sample_name","id,sample_name",1, "-- Select --",$row[csf('sample_id')], "gate_enable_disable(2)",$mm ); ?></td>
            <td><input type="text" name="txtitemdescription_<? echo $tbl_row; ?>" id="txtitemdescription_<? echo $tbl_row; ?>" class="text_boxes" style="width:180px;" value="<? echo $row[csf('item_description')];?>" disabled="">
            <input type="hidden" name="prodID_<? echo $tbl_row; ?>" id="prodID_<? echo $tbl_row; ?>" value="<? echo $row[csf('prod_id')];?>">
            
            </td>
            <td><input type="text" name="txtquantity_<? echo $tbl_row; ?>" id="txtquantity_<? echo $tbl_row; ?>" class="text_boxes_numeric" onKeyUp="fn_calculate_amount(this.id)"   value="<? echo $row[csf('quantity')];?>" style="width:60px;" disabled=""></td>
            <td><input type="text" name="txtrejectqty_<? echo $tbl_row; ?>" id="txtrejectqty_<? echo $tbl_row; ?>" class="text_boxes_numeric" value="<? echo $row[csf('reject_qty')];?>" style="width:60px;"></td>
            <td><? echo create_drop_down( "cbouom_".$tbl_row, 80, $unit_of_measurement,"", 1, "-- Select--", $row[csf('uom')], "",1 ); ?>
            <input type="hidden" name="txtuomqty_<? echo $tbl_row; ?>" id="txtuomqty_<? echo $tbl_row; ?>" class="text_boxes" onKeyUp="fn_calculate_amount(this.id)" value="<? echo $row[csf('uom_qty')];?>" style="width:60px;" ></td>
            <td><input type="text" name="txtrate_<? echo $tbl_row; ?>" id="txtrate_<? echo $tbl_row; ?>" class="text_boxes_numeric" onKeyUp="fn_calculate_amount(this.id)"  value="<? echo $row[csf('rate')];?>" style="width:70px" disabled=""></td>
            <td><input type="text" name="txtamount_<? echo $tbl_row; ?>" id="txtamount_<? echo $tbl_row; ?>" class="text_boxes_numeric" style="width:80px"  value="<? echo $row[csf('amount')];?>" readonly disabled=""></td>
            <td><input type="text" name="txtbag_<? echo $tbl_row; ?>" id="txtbag_<? echo $tbl_row; ?>" class="text_boxes_numeric" style="width:70px"  value="<? echo $row[csf('no_of_bags')];?>"  ></td>
            <td><input type="text" name="txtcartonqnty_<? echo $tbl_row; ?>" id="txtcartonqnty_<? echo $tbl_row; ?>" class="text_boxes_numeric" style="width:70px"  value="<? echo $row[csf('total_carton_qty')];?>" <? if($basis!=12) echo "disabled=disabled"; else echo ''; ?> ></td>
            <td><input type="text" name="txtorder_<? echo $tbl_row; ?>" id="txtorder_<? echo $tbl_row; ?>" class="text_boxes" style="width:80px" onDblClick="openmypage_order(this.id);" value="<? echo $row[csf('buyer_order')];;?>" readonly  disabled="">
            <input type="hidden" id="txtorderidhidden_<? echo $tbl_row; ?>" name="txtorderidhidden_<? echo $tbl_row; ?>"  class="text_boxes" style="width:20px" value="<? echo $row[csf('buyer_order_id')];?>" />
            </td>
            <td><input type="text" name="txtremarks_<? echo $tbl_row; ?>" id="txtremarks_<? echo $tbl_row; ?>" class="text_boxes" style="width:100px"  value="<? echo $row[csf('remarks')];?>">
            	<input type="hidden" id="updatedtlsid_<? echo $tbl_row; ?>" name="updatedtlsid_<? echo $tbl_row; ?>"  value="<? echo $row[csf('id')];?>" />
            </td>
        	<?
		}
		?>
		</tr>
		<?php	
		$i++;
	}
	exit();
} 

if($action=="show_scan_list_view")
{	
	$data=explode("_",$data);
	$sys_no=$data[0];
	$basis=$data[1];
	$challan_roll=explode("-",$sys_no);

	$sys_no_arr=explode(",",$sys_no);
	foreach($sys_no_arr as $challan_no){
		$challan_nos.="'".trim($challan_no)."',";
	}
	$sys_no=rtrim($challan_nos,',');

	$tbl_row=0;
		
	
	//echo "select id from inv_gate_pass_mst where  challan_no in($sys_no) and status_active=1 and is_deleted=0";die;
	$sql_insert_id=sql_select("select id from inv_gate_pass_mst where challan_no in($sys_no) and status_active=1 and is_deleted=0");
	//print_r($sql_insert_id);die;

	if(count($sql_insert_id)>0)
	{
		?>
		<input type="hidden" name="txtuomqty_" id="txtuomqty_" class="text_boxes" style="width:60px;">
        
        <tr id="tr_1">
            <td><? echo create_drop_down( "cboitemcategory_1", 120,$item_category,1, "-- Select --", 13, "","gate_enable_disable(1)" ); ?></td>
            <td><? echo create_drop_down( "cbosample_1", 120, "select id,sample_name from lib_sample where status_active=1 order by sample_name","id,sample_name",1, "-- Select --", 0, "gate_enable_disable(2)" ); ?></td>
            <td><input type="text" name="txtitemdescription_1" id="txtitemdescription_1" class="text_boxes" style="width:180px;">
          <input type="hidden" name="prodID_1" id="prodID_1" value="">  
            
            </td>
            <td><input type="text" name="txtquantity_1" id="txtquantity_1" class="text_boxes_numeric" onKeyUp="fn_calculate_amount(this.id)" style="width:60px;"></td>
            <td><input type="text" name="txtrejectqty_1" id="txtrejectqty_1" class="text_boxes_numeric"  style="width:60px;"></td>
            <td><? echo create_drop_down( "cbouom_1", 60, $unit_of_measurement,"", 1, "-- Select--", $selected, "",0 ); ?></td>
            <td><input type="text" name="txtrate_1" id="txtrate_1" class="text_boxes_numeric" onKeyUp="fn_calculate_amount(this.id)" style="width:70px"></td>
            <td><input type="text" name="txtamount_1" id="txtamount_1" class="text_boxes_numeric" style="width:80px" randomly disabled></td>
            <td><input type="text" name="txtorder_1" id="txtorder_1" class="text_boxes" style="width:80px" placeholder="Browse"  onDblClick="openmypage_order(this.id);" readonly>
            <input type="hidden" id="txtorderidhidden_1" name="txtorderidhidden_1"  class="text_boxes" style="width:20px"  />
            </td>
            <td><input type="text" name="txtremarks_1" id="txtremarks_1" class="text_boxes" style="width:100px"/>
            <input type="hidden" id="updatedtlsid_1" name="updatedtlsid_1" value="" /><input type="hidden" name="hiderow_1" id="hiderow_1" class="text_boxes" value="0" style="width:70px;" />
            </td>
            <td>
            <?
            if($basis==1)
			{
				?>
                <input type="button" id="increase_1" style="width:25px;" class="formbutton" value="+" onClick="add_break_down_tr(1)" />
                <input type="button" id="decrease_1" style="width:25px;" class="formbutton" value="-" onClick="javascript:fn_deletebreak_down_tr(1,'tbl_order_details');" />               
               <?
			}
			?>
            </td>
		</tr>
		<?
	}
	else
	{
		if($basis==11)
		{
			$composition_arr=array();
			$construction_arr=array();
			$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id";		
			$data_array=sql_select($sql_deter);
			if(count($data_array)>0)
			{
				foreach( $data_array as $row )
				{
					$construction_arr[$row[csf('id')]]=$row[csf('construction')];
					if(array_key_exists($row[csf('id')],$composition_arr))
					{
						$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]]." ".$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
					}
					else
					{
						$composition_arr[$row[csf('id')]]=$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
					}
				}
			}

			$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number");
			if($challan_roll[1]=="FDSR")
			{				
				$sql="select a.id,b.order_id, b.determination_id, sum(b.current_delivery) as cons_quantity, count(b.barcode_num) as no_of_bags, b.batch_id from pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b where a.sys_number in($sys_no) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form=67 and b.entry_form=67 group by  a.id,b.order_id, b.determination_id,b.batch_id";
			}
			else
			{
				$sql="select a.id, b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity, b.batch_id from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b where a.sys_number in($sys_no) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form=54 and b.entry_form=54";				
			}		
		}
		else if($basis==10)
		{
			$composition_arr=array();
			$construction_arr=array();
			$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id";		
			$data_array=sql_select($sql_deter);
			if(count($data_array)>0)
			{
				foreach( $data_array as $row )
				{
					$construction_arr[$row[csf('id')]]=$row[csf('construction')];
					if(array_key_exists($row[csf('id')],$composition_arr))
					{
						$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]]." ".$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
					}
					else
					{
						$composition_arr[$row[csf('id')]]=$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
					}
				}
			}

			$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number");
			if($challan_roll[1]=="GDSR")
			{
				$sql="SELECT a.id,b.order_id, b.determination_id, sum(b.current_delivery) as cons_quantity,count(b.barcode_num) as no_of_bags 
				from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
				where a.sys_number in($sys_no) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form=56 and b.entry_form=56  group by a.id,b.order_id, b.determination_id";
				$result_data=sql_select($sql);
				foreach ($result_data as $key => $value) 
				{
					$delivery_arr[$value[csf('id')]]=$value[csf('id')];
				}
				$delivery_id_cond=implode(',', $delivery_arr);
				$reject_qty_sql="SELECT a.mst_id as delivery_id, a.order_id, sum(b.reject_qnty) as reject_qty 
				from pro_grey_prod_delivery_dtls a, pro_roll_details b
				where a.grey_sys_id=b.mst_id and a.sys_dtls_id=b.dtls_id and a.barcode_num=b.barcode_no and b.entry_form=2 and a.mst_id in($delivery_id_cond) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.mst_id, a.order_id";	
				//echo $reject_qty_sql; //and b.mst_id in(43053,43054,43054)
				$sql_data_arr=sql_select($reject_qty_sql);
				$delivery_reject_qty_arr=array();
				foreach ($sql_data_arr as $key => $value) 
				{
					$delivery_reject_qty_arr[$value[csf('delivery_id')]][$value[csf('order_id')]]=$value[csf('reject_qty')];	
				}
				//echo "<pre>";print_r($delivery_reject_qty_arr);
			}
			else
			{		
			    $sql="select a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b where a.sys_number in($sys_no) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form=53 and b.entry_form=53";
			}	
		}		
		/*else if($basis==8 || $basis==9)
		{
			$sql_iss_id="select id from  inv_issue_master where issue_number='".$sys_no."'";
			//echo $sql_iss_id;die;
			$res=sql_select($sql_iss_id);
			foreach($res as $val)
			{
				$issue_id=$val[csf('id')];
			}		
			$sql = "select a.id,a.transaction_type,a.item_category,b.product_name_details,a.cons_rate,a.cons_quantity,a.cons_uom ,a.cons_amount,a.remarks  from inv_transaction a, product_details_master b where a.prod_id=b.id and a.mst_id=$issue_id and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0"; 
		
		}*/	
		else if($basis==8 || $basis==9)
		{
			$knit_des_arr=return_library_array( "select id, const_comp from lib_subcon_charge",'id','const_comp');
			$subcon_po_number_arr=return_library_array("select id, order_no from subcon_ord_dtls", "id", "order_no");
			$sql = "SELECT a.id, b.delivery_qty as cons_quantity, b.item_id as item_number_id, b.order_id,b.carton_roll as no_of_bags 
			from subcon_delivery_mst a , subcon_delivery_dtls b 
			where a.id=b.mst_id  and a.delivery_no in($sys_no) and a.status_active=1 and a.is_deleted=0 and a.process_id in(2,4)";
		}
		else if($basis==27)
		{
			//$sql = "select a.id,a.vehical_no,b.delivery_qty as cons_quantity,b.item_id as item_number_id,b.order_id,c.rate as cons_rate,c.amount as cons_amount,d.fabric_description as item_des  from subcon_delivery_mst a ,subcon_delivery_dtls b,subcon_ord_dtls c,subcon_production_dtls d  where a.id=b.mst_id  and a.delivery_no='$sys_no' and b.order_id=c.id and c.job_no_mst=d.job_no and to_char(b.order_id)=d.order_id and a.status_active=1 and a.is_deleted=0  and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and a.process_id in(3)";
			$knit_des_arr=return_library_array( "select id, const_comp from lib_subcon_charge",'id','const_comp');
			$subcon_po_number_arr=return_library_array("select id, order_no from subcon_ord_dtls", "id", "order_no");
			$sql = "select a.id,a.vehical_no,b.delivery_qty as cons_quantity,b.item_id,b.order_id,c.rate as cons_rate,c.amount as cons_amount  from subcon_delivery_mst a ,subcon_delivery_dtls b, subcon_ord_dtls c where a.id=b.mst_id  and a.delivery_no in($sys_no) and b.order_id=c.id and a.status_active=1 and a.is_deleted=0  and c.status_active=1 and c.is_deleted=0 and a.process_id in(3)";
		}
		else if($basis==12 ) //Garments Delivery
		{
			$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number");
			$sql="select a.id,b.po_break_down_id as order_id, b.item_number_id, b.ex_factory_qnty as cons_quantity from  pro_ex_factory_delivery_mst a, pro_ex_factory_mst b where sys_number in($sys_no) and a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
		}
		else if($basis==22 ) //Fabric Issue to Fin. Process
		{
			$composition_arr=array();
			$construction_arr=array();
			$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id";
			$data_array=sql_select($sql_deter);
			if(count($data_array)>0)
			{	
				foreach( $data_array as $row )
				{
					$construction_arr[$row[csf('id')]]=$row[csf('construction')];
					if(array_key_exists($row[csf('id')],$composition_arr))
					{
						$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]]." ".$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
					}
					else
					{
						$composition_arr[$row[csf('id')]]=$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
					}
				}
			}
			
			$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
			$color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
			$sql="SELECT a.id, a.recv_number as challan_no, b.batch_issue_qty as cons_quantity, b.order_id, b.body_part_id, b.febric_description_id, b.gsm, b.width, b.color_id, b.id as dtls_id, b.prod_id, b.buyer_id, b.job_no, b.width_dia_type, b.color_range_id, b.batch_id, b.process_id, b.batch_wgt, b.outbound_batchname, b.fin_dia, b.fin_gsm, b.roll_no,c.uom as cons_uom  from inv_receive_mas_batchroll a, pro_grey_batch_dtls b, wo_booking_dtls c where a.id=b.mst_id and c.id=b.booking_dtls_id and a.entry_form=91 and a.recv_number in($sys_no) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by b.id";
		}
		else if($basis==13 || $basis==55 || $basis==65)
		{
			$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number");
			$sql="select a.id as id ,a.po_break_down_id as order_id, a.item_number_id, sum(a.production_quantity) as  cons_quantity from  pro_garments_production_mst a where a.id in($sys_no) and a.production_type=2 and a.status_active=1 and a.is_deleted=0 group by a.id,a.po_break_down_id,a.item_number_id";			
		}
		else if ($basis==62) //Emblishment issue for bundle
		{
			$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number");
			$sql="select a.id as id ,a.po_break_down_id as order_id, a.item_number_id, sum(a.production_quantity) as  cons_quantity from  pro_garments_production_mst a where a.id in($sys_no) and a.production_type=2 and a.status_active=1 and a.is_deleted=0 group by a.id,a.po_break_down_id,a.item_number_id";
			$sql="SELECT a.id, a.country_id, a.po_break_down_id as order_id, a.production_date, a.production_quantity as cons_quantity, a.serving_company, a.location, a.challan_no, a.item_number_id, b.sys_number from pro_garments_production_mst a, pro_gmts_delivery_mst b where a.delivery_mst_id=b.id and b.embel_name in(2) and a.production_type=2 and b.sys_number in($sys_no) and a.status_active=1 and a.is_deleted=0";
		}
		else if($basis==15) //Finish Fabric Recv Return
		{
			$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number");
			$trans_po_id_arr=return_library_array( "select trans_id, po_breakdown_id from  order_wise_pro_details where entry_form=46 and trans_type=3",'trans_id','po_breakdown_id');
			$sql = "select a.id as issue_id, a.item_category, a.received_id, a.received_mrr_no, b.id as trans_id, b.cons_quantity as cons_quantity, b.cons_uom, b.cons_rate, b.cons_amount, c.product_name_details, c.id as prod_id from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id where a.id=b.mst_id and b.item_category=2 and b.transaction_type=3 and a.issue_number in($sys_no) order by b.id";			   
		}
		else if($basis==21) //Yarn receive return .......
		{
			if($return_number!="") $cond .= " and a.issue_number='$return_number'";
			if($ret_mst_id!="") $cond .= " and a.id='$ret_mst_id'";
			
			$sql = "select a.issue_number, a.company_id, a.supplier_id, a.issue_date, a.item_category, a.received_id, a.received_mrr_no, b.id, b.no_of_bags, b.cone_per_bag, b.cons_quantity, b.cons_uom as unit_of_measure, b.cons_rate, b.cons_amount, c.product_name_details, c.id as prod_id from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id where a.id=b.mst_id and b.item_category=1 and b.transaction_type=3 and a.issue_number in($sys_no) $cond";
		}
		else if($basis==26)//SubCon Material Return
		{
			$subcon_po_number_arr=return_library_array("select id, order_no from subcon_ord_dtls", "id", "order_no");
		 	$sql = "select a.id, b.subcon_roll, b.quantity as cons_quantity, b.material_description as product_name_details, b.order_id, b.subcon_uom as unit_of_measure, b.item_category_id as item_category from sub_material_mst a, sub_material_dtls b where a.id=b.mst_id and a.sys_no in($sys_no) and a.status_active=1 and a.is_deleted=0  and a.trans_type in(3) ";
		}
		else if($basis==23 || $basis==24 || $basis==25 || $basis==37) //General Item , Trims ,Chemical and Dyes receive return .......
		{
			//if($mst_challan!="") $cond .= " and a.issue_number='$mst_challan'";
			//if($mstid!="") $cond2 = " and a.id='$mstid'";else $cond2 = " ";
			$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number");
			$trans_po_id_arr=return_library_array( "select trans_id, po_breakdown_id from  order_wise_pro_details where entry_form=46 and trans_type=3",'trans_id','po_breakdown_id');
			$sql = "select a.issue_number, a.company_id, a.supplier_id, a.issue_date,a.received_id, a.received_mrr_no, b.transaction_type as trans_id, b.id, b.no_of_bags, b.cone_per_bag, b.cons_quantity, b.item_category,b.cons_uom as unit_of_measure, b.cons_rate, b.cons_amount, c.product_name_details, c.id as prod_id from inv_issue_master a, inv_transaction b,product_details_master c 
			where a.id=b.mst_id and b.prod_id=c.id and b.transaction_type=3 and b.status_active=1 and b.is_deleted=0 and a.issue_number in($sys_no) ";
		}
		else if($basis==35) //Scrap sale
		{
			$sql= "select a.id as issue_id, a.challan_no_prefix_num, a.item_category, a.selling_date, a.pay_term, a.customer_id, a.currency_id, a.remarks,b.id as dtls_id, b.prod_id, b.rej_uom, b.sales_qty_as_rej_uom, b.sales_uom, b.sales_qty as cons_quantity, b.sales_rate as cons_rate, b.sales_amount as cons_amount from inv_scrap_sales_mst a, inv_scrap_sales_dtls b where  a.sys_challan_no in($sys_no) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.id DESC ";
		}
		else if($basis==58) // Grey Roll Issue to Process
		{
			$composition_arr=array();
			$construction_arr=array();
			$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id";		
			$data_array=sql_select($sql_deter);
			if(count($data_array)>0)
			{
				foreach( $data_array as $row )
				{
					$construction_arr[$row[csf('id')]]=$row[csf('construction')];
					if(array_key_exists($row[csf('id')],$composition_arr))
					{
						$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]]." ".$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
					}
					else
					{
						$composition_arr[$row[csf('id')]]=$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
					}
				}
			}

			$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number");
			$color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
			$sql="SELECT a.id as issue_id, b.roll_wgt as cons_quantity, b.order_id, b.body_part_id, b.febric_description_id, b.gsm, b.width, b.color_id, b.id as dtls_id, b.mst_id, b.prod_id, b.buyer_id, b.job_no, b.width_dia_type, b.color_range_id, b.batch_id, b.process_id, b.batch_wgt, b.outbound_batchname, b.fin_dia, b.fin_gsm, b.roll_no from inv_receive_mas_batchroll a, pro_grey_batch_dtls b where a.id=b.mst_id and a.recv_number in($sys_no) and b.status_active=1 and b.is_deleted=0 order by b.id";
		}

		else if($basis==61)  //Wash Dyes Chemical Issue
		{
			$sql="SELECT a.id as prod_id, a.item_category_id as item_category, a.item_group_id, a.sub_group_name, a.item_description, a.item_size, a.unit_of_measure, a.current_stock, b.id as dtls_id, b.trans_id, c.cons_rate, c.cons_quantity, c.cons_amount, d.remarks, d.issue_number, d.id as issue_id from product_details_master a, dyes_chem_issue_dtls b, inv_transaction c, inv_issue_master d where a.id=b.product_id and b.trans_id=c.id and c.mst_id=d.id and d.issue_number in($sys_no) and d.entry_form=298 and a.item_category_id in(5,6,7,23) and c.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 order by a.item_category_id";	
		}
		else if ($basis==3) // knit grey fabric roll issue
		{
			$sql_iss_id="select id from inv_issue_master where issue_number='".$sys_no."'";
			//echo $sql_iss_id;die;
			$res=sql_select($sql_iss_id);
			foreach($res as $val)
			{
				$issue_id=$val[csf('id')];
			}	
		
			$sql = "SELECT a.id, a.mst_id as mst_id, a.transaction_type, a.item_category, b.product_name_details, a.cons_rate, a.cons_quantity, a.cons_uom, a.cons_amount, a.remarks from inv_transaction a, product_details_master b where a.prod_id=b.id and a.mst_id=$issue_id and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
			
			$sql_order=sql_select("SELECT a.trans_id, a.trans_type, b.id as po_id, b.po_number, c.prod_id, c.no_of_roll as no_of_bags, c.mst_id as issue_id from inv_grey_fabric_issue_dtls c, pro_roll_details d, order_wise_pro_details a, wo_po_break_down b where c.id=d.dtls_id and d.po_breakdown_id=b.id and c.mst_id=$issue_id and d.entry_form in(16,61) and a.entry_form in(16,61) and trans_type in(2,3) and a.dtls_id=c.id");
			$order_number_arr = array();
			foreach($sql_order as $row_order)
			{
				$order_number_arr[$row_order[csf('trans_id')]]['po_number']=$row_order[csf('po_number')];
				$order_number_arr[$row_order[csf('trans_id')]]['po_id']=$row_order[csf('po_id')];
				$order_number_arr[$row_order[csf('trans_id')]]['challan_no']=$sys_no;
			}
		}			
		else
		{
			$sql_iss_id="select id from  inv_issue_master where issue_number in($sys_no)";
			//echo $sql_iss_id;die;
			$res=sql_select($sql_iss_id);
			foreach($res as $val)
			{
				$issue_id=$val[csf('id')];
			}	
		
			$sql = "select a.id,a.transaction_type,a.item_category,b.product_name_details,a.cons_rate,a.cons_quantity,a.cons_uom ,a.cons_amount,a.remarks, b.detarmination_id  from inv_transaction a, product_details_master b where a.prod_id=b.id and a.mst_id=$issue_id and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0"; 		
		}
		// echo $sql;
		$composition_arr=array(); $constructtion_arr=array();
		$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id";
		$data_array=sql_select($sql_deter);
		foreach( $data_array as $row )
		{
			$constructtion_arr[$row[csf('id')]]=$row[csf('construction')];
			$composition_arr[$row[csf('id')]].=$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."% ";
		}
					
		$result=sql_select($sql);
		$count_td=count($result);
		foreach($result as $row)
		{
			$tbl_row++;
			if($tbl_row!=$count_td) $display="none"; else $display="";
			
			
			if($basis==11)
			{
				$row['product_name_details']=$construction_arr[$row[csf('determination_id')]].','.$composition_arr[$row[csf('determination_id')]].','.$row[csf('gsm')].','.$row[csf('dia')].',[Batch No: '.$row[csf('batch_id')].']';
				$order_number=$po_number_arr[$row[csf('order_id')]];
				$order_id=$row[csf('order_id')];
				
				$row[csf('cons_uom')]=12;
				//$row['item_category']=2;
				$row[csf('item_category')]=2;
			}
			else if($basis==3)
			{
				$row['product_name_details']=$row[csf('product_name_details')];
				$row[csf('item_category')]=13;
				$row[csf('cons_uom')]=1;
				$row[csf('no_of_bags')]=1;
				$row[csf('dtls_id')]=$row[csf('id')];
				$order_number=$order_number_arr[$row[csf('id')]]['po_number'];
				$order_id=$order_number_arr[$row[csf('id')]]['po_id'];
				$system_no=$order_number_arr[$row[csf('id')]]['challan_no'];
			}
			else if($basis==12) // Garments Delivery
			{
				$row['product_name_details']=$garments_item[$row[csf('item_number_id')]];
				$order_number=$po_number_arr[$row[csf('order_id')]];
				$order_id=$row[csf('order_id')];
				$row[csf('cons_uom')]=1;
				$row[csf('item_category')]=30;
			}
			else if($basis==22)
			{
				$row['product_name_details']=$body_part[$row[csf('body_part_id')]].','.$composition_arr[$row[csf('febric_description_id')]].','.$row[csf('gsm')].','.$row[csf('width')].','.$color_arr[$row[csf('color_id')]];
				$row[csf('item_category')]=12;
				$row[csf('cons_uom')]=12;
				$order_number=$po_number_arr[$row[csf('order_id')]];
				$order_id=$row[csf('order_id')];
			}
			else if($basis==13 || $basis==55  || $basis==62 || $basis==65) // Emblishment issue
			{
				$row['product_name_details']=$garments_item[$row[csf('item_number_id')]];
				$order_number=$po_number_arr[$row[csf('order_id')]];
				$order_id=$row[csf('order_id')];
				$row[csf('cons_uom')]=1;
				$row[csf('item_category')]=25;
				$row[csf('mst_id')]=$row[csf('id')];
			}
			else if($basis==15) // Finish Fabric Recv Retn
			{
				$row['product_name_details']=$row[csf('product_name_details')];
				$order_number=$po_number_arr[$trans_po_id_arr[$row[csf('trans_id')]]];
				$order_id=$trans_po_id_arr[$row[csf('trans_id')]];
				$row[csf('cons_uom')]=12;
				$row[csf('item_category')]=2;
			}
			else if($basis==10)
			{
				$row['product_name_details']=$construction_arr[$row[csf('determination_id')]].','.$composition_arr[$row[csf('determination_id')]].','.$row[csf('gsm')].','.$row[csf('dia')];
				$order_number=$po_number_arr[$row[csf('order_id')]];
				$order_id=$row[csf('order_id')];
				$row[csf('cons_uom')]=12;
				//$row['item_category']=13;	
				$row[csf('item_category')]=13;	
				$delivery_reject_qty=$delivery_reject_qty_arr[$row[csf('id')]][$row[csf('order_id')]];
			}
			else if($basis==8 || $basis==9 || $basis==27)
			{
				$row[csf('product_name_details')]=$knit_des_arr[$row[csf('item_number_id')]];
				$order_number=$subcon_po_number_arr[$row[csf('order_id')]];
				$order_id=$row[csf('order_id')];
				$row[csf('cons_uom')]=12;
				$item_des=$knit_des_arr[$row[csf('item_number_id')]];

				if($basis==8)
				{
					$row[csf('item_category')]=13;	
				}
				else if($basis==9)
				{
					$row[csf('item_category')]=2;		
				}
				
			 	else
			 	{
					$row[csf('item_category')]=30;
					$row[csf('cons_uom')]=1;
					$row[csf('product_name_details')]=$garments_item[$row[csf('item_id')]];
			 	}
			}
			
			else if($basis==23 || $basis==24 || $basis==25 || $basis==37) //General Item , Trims ,Chemical and Dyes receive return .......
			{
				$row['product_name_details']=$row[csf('product_name_details')];
				$order_number=$po_number_arr[$trans_po_id_arr[$row[csf('trans_id')]]];
				$order_id=$trans_po_id_arr[$row[csf('trans_id')]];
				$row[csf('cons_uom')]=$row[csf('unit_of_measure')];
				$row[csf('item_category')]=$row[csf('item_category')];
				$row[csf('no_of_bags')]=$row[csf('no_of_bags')];
			}
			else if($basis==26) // SubCon Material Return
			{
				$row['product_name_details']=$row[csf('product_name_details')];
				$order_number=$subcon_po_number_arr[$row[csf('order_id')]];
				$order_number=implode(",",array_unique(explode(",",$order_number)));
				//$order_number=$po_number_arr[$trans_po_id_arr[$row[csf('trans_id')]]];
				//$order_id=$trans_po_id_arr[$row[csf('trans_id')]];
				$row[csf('cons_uom')]=$row[csf('unit_of_measure')];
				$row[csf('item_category')]=$row[csf('item_category')];
				$row[csf('no_of_bags')]=$row[csf('subcon_roll')];
			}
			else if($basis==35) // Scrap sales
			{
				$row[csf('cons_uom')]=$row[csf('sales_uom')];
				$productNameArr=return_library_array("select id, product_name_details from product_details_master", "id", "product_name_details");
				$row[csf('product_name_details')]=$productNameArr[$row[csf('prod_id')]];
			}
			else if($basis==58)// Grey issue to process
			{			
				$row['product_name_details']=$body_part[$row[csf('body_part_id')]].','.$composition_arr[$row[csf('febric_description_id')]].','.$row[csf('gsm')].','.$row[csf('width')].','.$color_arr[$row[csf('color_id')]];

				$row[csf('item_category')]=13;
				$row[csf('cons_uom')]=12;
				$order_number=$po_number_arr[$row[csf('order_id')]];
				$order_id=$row[csf('order_id')];
			}

			else if($basis==61) //Wash Dyes Chemical Issue
			{  
				$row[csf('cons_uom')]=$row[csf('unit_of_measure')];
				$row['product_name_details']=$row[csf('item_description')];
			}
			
			else
			{
				$sql_order=sql_select("select b.id as po_id,b.po_number from order_wise_pro_details a, wo_po_break_down b where a.po_breakdown_id=b.id and a.trans_id=".$row[csf('id')]." and trans_type=2");
				foreach($sql_order as $row_order)
				{
					$order_number=$row_order[csf('po_number')];	
					$order_id=$row_order[csf('po_id')];	
				}	
				$item_des = $constructtion_arr[$row[csf('detarmination_id')]].",".$composition_arr[$row[csf('detarmination_id')]];		
			}			
			
			if($basis==1)
			{
				$disable_filed="";
				$disable_cbo=0;
			}
			else
			{
				$disable_filed="disabled";
				$disable_cbo=1;
			}
			//echo $basis.'aaaa';
			?>
            <input type="hidden" name="txtuomqty_<? echo $tbl_row; ?>" id="txtuomqty_<? echo $tbl_row; ?>" class="text_boxes"    value="<? //echo $row[csf('cons_quantity')];?>" style="width:60px;">
            <input type="hidden" id="txt_issue_no" name="txt_issue_no" value="<? echo $row[csf('issue_id')];?>" />
            
            
            
			<tr class="" id="tr_<? echo $tbl_row; ?>">
                <td>
					<? echo create_drop_down( "cboitemcategory_".$tbl_row, 120,$item_category,"",1, "-- Select --",$row[csf('item_category')] , "gate_enable_disable(1)",$disable_cbo ); ?>                
					<input type="hidden" name="challanIds_<? echo $tbl_row; ?>" id="challanIds_<? echo $tbl_row; ?>" value="<? echo $row[csf('mst_id')];?>">
					<input type="hidden" name="challandtlsIds_<? echo $tbl_row; ?>" id="challandtlsIds_<? echo $tbl_row; ?>" value="<? echo $row[csf('dtls_id')];?>">
                </td>
                <td><?  echo create_drop_down( "cbosample_".$tbl_row, 120, "select id,sample_name from lib_sample where status_active=1 order by sample_name","id,sample_name",1, "-- Select --", $selected,"gate_enable_disable(2)",$disable_cbo ); ?></td>
				
                <td><input type="text" name="txtitemdescription_<? echo $tbl_row; ?>" id="txtitemdescription_<? echo $tbl_row; ?>" class="text_boxes" style="width:180px;" value="<? echo $item_des;?>"  <? echo $disable_filed;?>>
                <input type="hidden" name="prodID_<? echo $tbl_row; ?>" id="prodID_<? echo $tbl_row; ?>" value="<? echo $row[csf('prod_id')];?>">
                
                </td>
				
                <td><input type="text" name="txtquantity_<? echo $tbl_row; ?>" id="txtquantity_<? echo $tbl_row; ?>" class="text_boxes_numeric" onKeyUp="fn_calculate_amount()"   value="<? echo $row[csf('cons_quantity')];?>" style="width:60px;" readonly  <? echo $disable_filed;?>></td>
                <td><input type="text" name="txtrejectqty_<? echo $tbl_row; ?>" id="txtrejectqty_<? echo $tbl_row; ?>" class="text_boxes_numeric"  value="<? echo $delivery_reject_qty;?>" style="width:60px;" readonly  <? echo $disable_filed;?>></td>
                <td><?echo create_drop_down( "cbouom_".$tbl_row, 60, $unit_of_measurement,"", 1, "-- Select--",$row[csf('cons_uom')] , "",$disable_cbo ); ?></td>
                <td><input type="text" name="txtrate_<? echo $tbl_row; ?>" id="txtrate_<? echo $tbl_row; ?>" class="text_boxes_numeric" onKeyUp="fn_calculate_amount()"  value="<? echo $row[csf('cons_rate')];?>" style="width:70px"   <? echo $disable_filed;?>></td>
                <td><input type="text" name="txtamount_<? echo $tbl_row; ?>" id="txtamount_<? echo $tbl_row; ?>" class="text_boxes_numeric" style="width:80px"  value="<? echo $row[csf('cons_amount')];?>" randomly  <? echo $disable_filed;?> ></td>
                
				<td><input type="text" name="txtbag_<? echo $tbl_row; ?>" id="txtbag_<? echo $tbl_row; ?>" class="text_boxes_numeric"  value="<? echo $row[csf('no_of_bags')];?>" style="width:70px" ></td>
				<td><input type="text" name="txtcartonqnty_<? echo $tbl_row; ?>" id="txtcartonqnty_<? echo $tbl_row; ?>" class="text_boxes_numeric"  value="<? echo $row[csf('total_carton_qty')];?>" style="width:70px" ></td>

                <td><input type="text" name="txtorder_<? echo $tbl_row; ?>" id="txtorder_<? echo $tbl_row; ?>" class="text_boxes" style="width:80px"   onDblClick="openmypage_order(this.id);"  value="<? echo $order_number;?>" readonly  <? echo $disable_filed;?> ><input type="hidden" id="txtorderidhidden_<? echo $tbl_row; ?>" name="txtorderidhidden_<? echo $tbl_row; ?>"  class="text_boxes" style="width:20px" value="<? echo $order_id;?>" /></td>
                <td><input type="text" name="txtremarks_<? echo $tbl_row; ?>" id="txtremarks_<? echo $tbl_row; ?>" class="text_boxes" style="width:150px"    value="<? echo $row[csf('remarks')];?>"  <? //echo $disable_filed;?> >
                <input type="hidden" id="updatedtlsid_<? echo $tbl_row; ?>" name="updatedtlsid_<? echo $tbl_row; ?>"  value="<? echo $row[csf('product_name_details')];?>" /><input type="hidden" name="hiderow_<? echo $tbl_row; ?>" id="hiderow_<? echo $tbl_row; ?>" class="text_boxes" value="0" style="width:70px;" />
                </td>
                <td>
                <?
                if($basis==1)
				{
					?>
             		<input type="button" id="increase_<? echo $tbl_row; ?>" style="width:25px;" class="formbutton" value="+" onClick="add_break_down_tr(<? echo $tbl_row;?>)" />
               		<input type="button" id="decrease_<? echo $tbl_row; ?>" style="width:25px;" class="formbutton" value="-" onClick="javascript:fn_deletebreak_down_tr(<? echo $tbl_row; ?>,'tbl_order_details');" />               
               		<?
				}
			   ?>
            </td>
			</tr>
			<?php
			$i++;
		}
	}
	exit();
} 

if($action=="independent_list_view")
{
	$data=explode("_",$data);
	$sys_no=$data[0];
	$basis=$data[1];
	$tbl_row=0;
	$challan_roll=explode("-",$sys_no);
	?>
	<input type="hidden" name="txtuomqty_" id="txtuomqty_" class="text_boxes" style="width:60px;">
    
    <tr id="tr_1">
        <td>
			<? echo create_drop_down( "cboitemcategory_1", 120,$item_category,"",1, "-- Select --", 0, "gate_enable_disable(1)" ); ?>
			<input type="hidden" name="challanIds_1" id="challanIds_1" value="">
            <input type="hidden" name="challandtlsIds_1" id="challandtlsIds_1" value="">
		</td>
        <td><? echo create_drop_down( "cbosample_1", 120, "select id,sample_name from lib_sample where status_active=1 order by sample_name","id,sample_name",1, "-- Select --", 0, "gate_enable_disable(2)" ); ?></td>
        <td><input type="text" name="txtitemdescription_1" id="txtitemdescription_1" class="text_boxes" style="width:180px;">
    <input type="hidden" name="prodID_1" id="prodID_1" value="">    
        </td>
        <td><input type="text" name="txtquantity_1" id="txtquantity_1" class="text_boxes_numeric" onKeyUp="fn_calculate_amount(this.id)" style="width:60px;"></td>
        <td><input type="text" name="txtrejectqty_1" id="txtrejectqty_1" class="text_boxes_numeric"  style="width:60px;"></td>
        <td><? echo create_drop_down( "cbouom_1", 80, $unit_of_measurement,"", 1, "-- Select--", $selected, "",0 ); ?><input type="hidden" name="txtuomqty_1" id="txtuomqty_1" class="text_boxes"></td>
        <td><input type="text" name="txtrate_1" id="txtrate_1" class="text_boxes_numeric" onKeyUp="fn_calculate_amount(this.id)" style="width:70px"></td>
        <td><input type="text" name="txtamount_1" id="txtamount_1" class="text_boxes_numeric" style="width:80px" readonly disabled></td>

        <td><input type="text" name="txtbag_1" id="txtbag_1" class="text_boxes_numeric" style="width:70px"  ></td>
        <td><input type="text" name="txtcartonqnty_1" id="txtcartonqnty_1" class="text_boxes_numeric" style="width:70px"  ></td>

        <td><input type="text" name="txtorder_1" id="txtorder_1" class="text_boxes" style="width:80px" placeholder="Browse"  onDblClick="openmypage_order(this.id);" readonly>
         <input type="hidden" id="txtorderidhidden_1" name="txtorderidhidden_1"  style="width:20px" value="" />
        </td>
       
        <td><input type="text" name="txtremarks_1" id="txtremarks_1" class="text_boxes" style="width:100px">
        <input type="hidden" id="updatedtlsid_1" name="updatedtlsid_1" value="" />
        </td>
        <td> <input type="button" id="increase_1" style="width:25px" class="formbutton" value="+" onClick="add_break_down_tr(1)" />
             <input type="button" id="decrease_1" style="width:25px" class="formbutton" value="-" onClick="javascript:fn_deletebreak_down_tr(1,'tbl_order_details');" />
        </td>
    </tr>
	<?
	exit();
}

if($action=="show_dtls_list_view")
{ 
	$data=explode("_",$data);
	$mst_challan=$data[0];
	$basis=$data[1];
	$mst_id=$data[2];
	//echo $mst_id.'system';
	
	$dtls_id=$data[3];
	$mstid=$data[4];
	$entry_form=$data[3];
	$tbl_row=0;
	
	if($basis==12) //Challan Garments Delivery
	{
		$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
		$sql="SELECT a.id,b.po_break_down_id as order_id, b.item_number_id, b.ex_factory_qnty as cons_quantity,b.carton_qnty as no_of_bags, b.total_carton_qnty from pro_ex_factory_delivery_mst a, pro_ex_factory_mst b where a.id in($mst_challan) and a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by b.id";
	}
	else if($basis==13 || $basis==55 || $basis==62) //Challan Embellishment Issue
	{
		$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
		$sql="SELECT a.id as id ,a.po_break_down_id as order_id, a.item_number_id, sum(a.production_quantity) as  cons_quantity from  pro_garments_production_mst a where a.id in($mst_challan) and (a.production_type=2 or a.production_type=63)  and a.status_active=1 and a.is_deleted=0 group by a.id,a.po_break_down_id,a.item_number_id";
	}
    else if($basis==65) //Challan Embellishment Issue
    {
        $po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
        $sql="SELECT a.id as id ,a.po_break_down_id as order_id, a.item_number_id, sum(a.production_quantity) as  cons_quantity from  pro_garments_production_mst a where a.id in($mst_challan) and a.production_type=4 and a.status_active=1 and a.is_deleted=0 group by a.id,a.po_break_down_id,a.item_number_id";
    }
	else if($basis==14) //Challan Cutting
	{
		$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
		$sql ="SELECT a.id,a.po_break_down_id as order_id,a.item_number_id,sum(a.cut_delivery_qnty) as cons_quantity from  pro_cut_delivery_order_dtls a,  pro_cut_delivery_mst b where a.delivery_mst_id=b.id and  a.delivery_mst_id in($mst_challan) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.id,a.po_break_down_id,a.item_number_id  order by id";		   
	}
	else if($basis==15) //Finish Fabric Recv Return
	{
		$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
		$trans_po_id_arr=return_library_array( "select trans_id, po_breakdown_id from  order_wise_pro_details where entry_form in(18,46,61,71,78,112) and trans_type in(2,3,5,6)",'trans_id','po_breakdown_id');
		$sql = "SELECT a.id as issue_id, a.item_category, a.received_id, a.received_mrr_no, b.id as trans_id, b.cons_quantity as cons_quantity,b.cons_uom, b.cons_rate, b.cons_amount, c.product_name_details, c.id as prod_id from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id where a.id=b.mst_id and b.item_category=2 and b.transaction_type=3 and a.id in($mst_challan) order by b.id";		   
	}
	else if($basis==11) //Finish Fabric Delivery to Store
	{
		$composition_arr=array();
		$construction_arr=array();
		$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id";
		$data_array=sql_select($sql_deter);
		if(count($data_array)>0)
		{	
			foreach( $data_array as $row )
			{
				$construction_arr[$row[csf('id')]]=$row[csf('construction')];
				if(array_key_exists($row[csf('id')],$composition_arr))
				{
					$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]]." ".$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
				}
				else
				{
					$composition_arr[$row[csf('id')]]=$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
				}
			}
		}
		$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
		$roll_type=$data[2];
		if($roll_type==1)
		{
			$sql="SELECT a.id,b.order_id, b.determination_id, sum(b.current_delivery) as cons_quantity,count(b.barcode_num) as no_of_bags,b.batch_id from pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b where a.id in ($mst_challan) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.entry_form=67 and b.entry_form=67 group by a.id,b.order_id, b.determination_id,b.batch_id";				
				// $sql = "select a.id,a.transaction_type,a.item_category,b.product_name_details,a.cons_rate,a.cons_quantity,a.cons_uom ,a.cons_amount,a.remarks,b.unit_of_measure ,a.no_of_bags  from inv_transaction a, product_details_master b where a.prod_id=b.id and a.mst_id in($mst_challan) and a.transaction_type=2 and a.item_category=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0"; 
		}
		else
		{
			$sql="SELECT a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity, b.batch_id from pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b where a.id in ($mst_challan) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form=54 and b.entry_form=54";
		}
	}
	else if($basis==10) //Grey Fabric Delivery to Store
	{
		$composition_arr=array();
		$construction_arr=array();
		$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id";
		$data_array=sql_select($sql_deter);
		if(count($data_array)>0)
		{	
			foreach( $data_array as $row )
			{
				$construction_arr[$row[csf('id')]]=$row[csf('construction')];
				if(array_key_exists($row[csf('id')],$composition_arr))
				{
					$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]]." ".$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
				}
				else
				{
					$composition_arr[$row[csf('id')]]=$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
				}
			}
		}

		$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
		$roll_type=$data[2];
		if($roll_type==1)
		{
			/*$sql="SELECT a.id,b.order_id, b.determination_id, sum(b.current_delivery) as cons_quantity,count(b.barcode_num) as no_of_bags  
				from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
				where a.id='$mst_challan' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.entry_form=56 and b.entry_form=56 group by a.id,b.order_id, b.determination_id";*/
			$sql="SELECT a.id,b.order_id, b.determination_id,count(b.barcode_num) as no_of_bags ,sum(c.qnty) as  cons_quantity 
			from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b ,pro_roll_details c
			where a.id in($mst_challan) and a.id=b.mst_id and b.id=c.dtls_id and b.mst_id=c.mst_id and b.order_id=c.po_breakdown_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.entry_form=56 and b.entry_form=56 and c.entry_form=56 group by a.id,b.order_id, b.determination_id";
			$result_data=sql_select($sql);
			foreach ($result_data as $key => $value) 
			{
				$delivery_arr[$value[csf('id')]]=$value[csf('id')];
			}
			$delivery_id_cond=implode(',', $delivery_arr);
			$reject_qty_sql="SELECT a.mst_id as delivery_id, a.order_id, sum(b.reject_qnty) as reject_qty , a.determination_id
			from pro_grey_prod_delivery_dtls a, pro_roll_details b
			where a.grey_sys_id=b.mst_id and a.sys_dtls_id=b.dtls_id and a.barcode_num=b.barcode_no and b.entry_form=2 and a.mst_id in($delivery_id_cond) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.mst_id, a.order_id, a.determination_id";	
			// echo $reject_qty_sql;die; //and b.mst_id in(43053,43054,43054)
			$sql_data_arr=sql_select($reject_qty_sql);
			$delivery_reject_qty_arr=array();
			foreach ($sql_data_arr as $key => $value) 
			{
				$delivery_reject_qty_arr[$value[csf('delivery_id')]][$value[csf('order_id')]][$value[csf('determination_id')]]=$value[csf('reject_qty')];	
			}
			//echo "<pre>";print_r($delivery_reject_qty_arr);	
		}
		else
		{
			$sql="SELECT a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b where a.id in($mst_challan) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.entry_form=53 and b.entry_form=53";
		}
		//echo $sql;
	}
	else if($basis==8 || $basis==9) //SubCon Knitting Delivery, SubCon Dyeing And Finishing Delivery
	{
		$knit_des_arr=return_library_array( "select id, const_comp from lib_subcon_charge",'id','const_comp');
		$subcon_po_number_arr=return_library_array( "select id, order_no from subcon_ord_dtls", "id", "order_no");
		$sql = "select a.id, b.id as dtls_id, b.delivery_qty as cons_quantity, b.reject_qty as reject_qty, b.item_id,b.order_id,b.batch_id, b.carton_roll as no_of_bags from subcon_delivery_mst a, subcon_delivery_dtls b where a.id=b.mst_id and b.mst_id in ($mst_challan) and a.status_active=1 and a.is_deleted=0  and a.process_id in(2,4) ";

		if($basis==9)
		{
			$sql_subcon_fab = "select distinct  a.item_id,a.batch_id, b.mst_id,b.po_id,b.item_description from subcon_delivery_dtls a,pro_batch_create_dtls b where a.mst_id in ($mst_challan)  and a.batch_id=b.mst_id and  a.status_active=1 and b.status_active=1  order by a.item_id desc";
			//echo $sql_subcon_fab;//die;
			$sql_subcon_fab_desc = sql_select($sql_subcon_fab);
			foreach($sql_subcon_fab_desc as $row)
			{				
				$fab_desc_arr[$row[csf('mst_id')]][$row[csf('po_id')]][$row[csf('item_id')]]['item_description']=$row[csf('item_description')];
				if($row[csf('batch_id')]!=""){
					$batch_id_arr[$row[csf('batch_id')]]=$row[csf('batch_id')];
				}
			}
			$batch_ids= implode(",",$batch_id_arr) ;//die;
			$batch_array=array();
			$batch_sql="select a.id, b.id as item_id, b.po_id, b.item_description from pro_batch_create_mst a, pro_batch_create_dtls b where a.id=b.mst_id and a.entry_form=36 and a.id in($batch_ids) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 ";
			$batch_sql_result=sql_select($batch_sql);
			foreach($batch_sql_result as $row)
			{
				$batch_array[$row[csf('id')]][$row[csf('po_id')]][$row[csf('item_id')]]['item_description']=$row[csf('item_description')];
			}		
		}
	}
	else if($basis==27) //SubCon Garment Delivery
	{
		//$sql = "select a.id,a.vehical_no,b.delivery_qty as cons_quantity,b.item_id,b.order_id,c.rate as cons_rate,c.amount as cons_amount,d.fabric_description as item_des  from subcon_delivery_mst a ,subcon_delivery_dtls b,subcon_ord_dtls c,subcon_production_dtls d  where a.id=b.mst_id  and b.mst_id=$mst_challan and b.order_id=c.id and c.job_no_mst=d.job_no and to_char(b.order_id)=d.order_id and a.status_active=1 and a.is_deleted=0  and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and a.process_id in(3)";
		$knit_des_arr=return_library_array( "select id, const_comp from lib_subcon_charge",'id','const_comp');
		$subcon_po_number_arr=return_library_array( "select id, order_no from subcon_ord_dtls", "id", "order_no");
	    $sql = "SELECT a.id,a.vehical_no,b.delivery_qty as cons_quantity,b.item_id,b.order_id,CASE when c.order_uom=2 then (c.rate/12) when c.order_uom=1 then c.rate end  as cons_rate,case when c.order_uom=2 then (c.rate/12)*b.delivery_qty when c.order_uom=1 then (b.delivery_qty*c.rate) end  as cons_amount,c.order_uom as unit_of_measure  from subcon_delivery_mst a ,subcon_delivery_dtls b,subcon_ord_dtls c  where a.id=b.mst_id  and b.mst_id=$mst_challan and b.order_id=c.id and a.status_active=1 and a.is_deleted=0  and c.status_active=1 and c.is_deleted=0 and a.process_id in(3)";
	}
	else if($basis==2) //Yarn Issue
	{
		$sql = "SELECT a.id, a.transaction_type, a.item_category, b.product_name_details, a.cons_rate, a.cons_quantity, a.cons_uom, a.cons_amount, a.remarks, b.unit_of_measure, a.no_of_bags from inv_transaction a, product_details_master b where a.prod_id=b.id and a.mst_id in($mst_challan) and a.transaction_type=2 and a.item_category=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0"; 
	}
	else if($basis==16) //yarn Transfer
	{
		$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
		$trans_po_id_arr=return_library_array( "select trans_id, po_breakdown_id from  order_wise_pro_details where entry_form in(18,46,61,71,78,112) and trans_type in(2,3,5,6)",'trans_id','po_breakdown_id');
		$sql="SELECT b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty as cons_quantity,
		b.yarn_lot,b.rate as cons_rate,b.transfer_value as cons_amount,b.brand_id,c.product_name_details,b.no_of_bag as no_of_bags
		from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c where a.id=b.mst_id and c.id=b.from_prod_id and a.id in ($data[0]) and b.item_category=1 and b.status_active = '1' and b.is_deleted = '0' group by  b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty, b.yarn_lot,b.rate,b.transfer_value ,b.brand_id,c.product_name_details,b.no_of_bag order by b.id"; 
		//and b.id='$data[3]' 
	}
	else if($basis==17) //Grey Fabric Transfer
	{
		//$sql = "select $trans_group_con,b.id as prod_id,a.transaction_type,a.item_category,b.product_name_details,avg(b.avg_rate_per_unit) as cons_rate,sum(a.cons_quantity) as cons_quantity,sum(a.cons_amount) as cons_amount,c.remarks,b.unit_of_measure  from inv_issue_master c ,inv_transaction a, product_details_master b where c.id=a.mst_id  and a.prod_id=b.id and a.mst_id in($mst_challan) and c.entry_form in(16,61) and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.id,a.transaction_type,a.item_category,b.product_name_details,c.remarks,b.unit_of_measure order by b.id "; 
		
		/*$sql="select a.entry_form, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id,b.to_order_id, sum(b.transfer_qnty) as cons_quantity,
		b.yarn_lot,b.rate as cons_rate,b.transfer_value as cons_amount,b.brand_id,c.product_name_details,d.no_of_bags 
		from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c,inv_transaction d 
		where a.id=b.mst_id and c.id=b.from_prod_id and b.from_prod_id=d.prod_id and b.mst_id='$data[2]' and b.item_category=13 
		and b.status_active = '1' and b.is_deleted = '0' and d.no_of_bags is not NULL
		group by  a.entry_form, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id,b.to_order_id,
		b.yarn_lot,b.rate,b.transfer_value ,b.brand_id,c.product_name_details,d.no_of_bags";*/
		$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
		$sql="SELECT a.entry_form, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id,b.to_order_id, sum(b.transfer_qnty) as cons_quantity,b.rate as cons_rate,b.transfer_value as cons_amount,b.brand_id from inv_item_transfer_mst a,inv_item_transfer_dtls b where a.id=b.mst_id and b.mst_id in($data[2]) and b.item_category=13 and b.status_active = '1' and b.is_deleted = '0' group by a.entry_form, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id,b.to_order_id,b.rate,b.transfer_value ,b.brand_id";

		if($entry_form==82) 
		{
			$sql_transfer="SELECT a.entry_form,b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id,b.to_order_id,b.trans_id, b.transfer_qnty as cons_quantity,b.rate as cons_rate,b.transfer_value as cons_amount,b.brand_id,c.product_name_details,d.roll_no as no_of_bags from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c , pro_roll_details d where a.id=b.mst_id and c.id=b.from_prod_id and b.id=d.dtls_id and b.mst_id in ($data[2]) and b.item_category=13 and b.status_active = '1' and b.is_deleted = '0' and d.entry_form=82 group by  a.entry_form,b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id,b.to_order_id,b.trans_id, b.transfer_qnty,b.rate,b.transfer_value ,b.brand_id,c.product_name_details,d.roll_no order by b.id"; 

			$sql_roll="SELECT count(b.id) as id,a.entry_form,b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id,b.to_order_id,b.brand_id
			from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c, pro_roll_details d where a.id=b.mst_id and c.id=b.from_prod_id and b.id=d.dtls_id and b.mst_id in ($data[2]) and b.item_category=13 and b.status_active = '1' and b.is_deleted = '0' and d.entry_form=82 group by a.entry_form,b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id,b.to_order_id,b.brand_id";

			$sql_roll_no=sql_select($sql_roll);
			foreach ($sql_roll_no as $row) 
			{
				$dtls_data_arr[$row[csf('entry_form')]][$row[csf('mst_id')]][$row[csf('from_store')]][$row[csf('to_store')]][$row[csf('from_prod_id')]][$row[csf('to_prod_id')]][$row[csf('to_order_id')]][$row[csf('brand_id')]]['no_of_bags']=$row[csf('id')];
			}
		}
		else
		{
			$sql_transfer="SELECT a.entry_form,b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id,b.to_order_id,b.trans_id, b.transfer_qnty as cons_quantity,b.rate as cons_rate,b.transfer_value as cons_amount,b.brand_id,c.product_name_details,d.no_of_bags 
		    from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c,inv_transaction d where a.id=b.mst_id and c.id=b.from_prod_id and b.from_prod_id=d.prod_id and b.mst_id in ($data[2]) and b.item_category=13 and b.status_active = '1' and b.is_deleted = '0' and d.no_of_bags is not NULL group by  a.entry_form,b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id,b.to_order_id,b.trans_id, b.transfer_qnty,b.rate,b.transfer_value ,b.brand_id,c.product_name_details,d.no_of_bags"; 
			//echo $sql_transfer;

		    $sql_trnsf=sql_select($sql_transfer);
		    foreach ($sql_trnsf as $row) 
		    {
  				$dtls_data_arr[$row[csf('entry_form')]][$row[csf('mst_id')]][$row[csf('from_store')]][$row[csf('to_store')]][$row[csf('from_prod_id')]][$row[csf('to_prod_id')]][$row[csf('to_order_id')]][$row[csf('brand_id')]]['no_of_bags']+=1;	
  			}
		}
		//echo $sql_transfer;
		$sql_trnsf=sql_select($sql_transfer);
		foreach ($sql_trnsf as $row) 
		{
  			$dtls_data_arr[$row[csf('entry_form')]][$row[csf('mst_id')]][$row[csf('from_store')]][$row[csf('to_store')]][$row[csf('from_prod_id')]][$row[csf('to_prod_id')]][$row[csf('to_order_id')]][$row[csf('brand_id')]]['product_name_details']=$row[csf('product_name_details')];
  		}
	}
	else if($basis==18) //General Item  Transfer
	{
		$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
		$trans_po_id_arr=return_library_array( "select trans_id, po_breakdown_id from  order_wise_pro_details where entry_form in(18,46,61,71,78,112) and trans_type in(2,3,5,6)",'trans_id','po_breakdown_id');
		$sql="SELECT b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty as cons_quantity,
		b.yarn_lot,b.rate as cons_rate,b.transfer_value as cons_amount,b.brand_id,b.item_category,b.uom,c.product_name_details,d.no_of_bags 
		from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c,inv_transaction d where a.id=b.mst_id and c.id=b.from_prod_id and b.from_prod_id=d.prod_id and b.mst_id in($data[2]) and b.status_active = '1' and b.is_deleted = '0' and d.no_of_bags is not NULL
		group by  b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty, b.yarn_lot,b.rate,b.transfer_value ,b.brand_id,b.item_category,b.uom,c.product_name_details,d.no_of_bags"; 
	}
	else if($basis==19) //Trims Transfer
	{
		// $sql="select b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty as cons_quantity,
		// b.yarn_lot,b.rate as cons_rate,b.transfer_value as cons_amount,b.brand_id,b.item_category,b.uom,c.product_name_details,d.no_of_bags, d.id as trans_id
		// from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c,inv_transaction d 
		// where a.id=b.mst_id and c.id=b.from_prod_id and a.id=d.mst_id and d.transaction_type in(5,6) and b.from_prod_id=d.prod_id and b.mst_id in ($data[0])  
		// and b.status_active = '1' and b.is_deleted = '0' and d.no_of_bags is not NULL
		// group by  b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty,
		// b.yarn_lot,b.rate,b.transfer_value,b.brand_id,b.item_category,b.uom,c.product_name_details,d.no_of_bags,d.id"; 
		$po_number_arr=return_library_array( "select job_id, po_number from wo_po_break_down", "job_id", "po_number" );
		$trans_po_id_arr=return_library_array( "select job_id, id from  wo_po_break_down", "job_id", "id" );
		$sql="SELECT b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.job_id, b.transfer_qnty as cons_quantity, b.yarn_lot,b.rate as cons_rate, b.transfer_value as cons_amount,b.brand_id,b.item_category,b.uom,b.from_order_id,b.to_order_id,b.no_of_bag,c.product_name_details from inv_item_transfer_mst a,inv_item_transfer_dtls b, product_details_master c where a.id=b.mst_id and c.id=b.from_prod_id and b.mst_id in ($data[0]) and b.status_active = '1' and b.is_deleted = '0' group by b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty, b.yarn_lot,b.rate,b.transfer_value,b.brand_id,b.job_id, b.item_category,b.uom,b.no_of_bag,c.product_name_details,b.from_order_id,b.to_order_id ";

		//		echo $sql;
	}
	else if($basis==20) //Dyes and Chemical Transfer data 
	{
		$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
		$trans_po_id_arr=return_library_array( "select trans_id, po_breakdown_id from  order_wise_pro_details where entry_form in(18,46,61,71,78,112) and trans_type in(2,3,5,6)",'trans_id','po_breakdown_id');
		$sql="SELECT b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty as cons_quantity,
		b.yarn_lot,b.rate as cons_rate,b.transfer_value as cons_amount, b.brand_id, b.item_category, b.uom, c.product_name_details, d.no_of_bags 
		from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c,inv_transaction d where a.id=b.mst_id and c.id=b.from_prod_id and b.from_prod_id=d.prod_id and b.mst_id='$data[2]' and b.status_active = '1' and b.is_deleted = '0' and d.no_of_bags is not NULL
		group by  b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty, b.yarn_lot,b.rate,b.transfer_value ,b.brand_id,b.item_category,b.uom,c.product_name_details,d.no_of_bags"; 
	}
	else if($basis==21) //Yarn receive return .......
	{
	
		if($return_number!="") $cond .= " and a.issue_number='$return_number'";
		if($ret_mst_id!="") $cond .= " and a.id='$ret_mst_id'";
	
		$sql = "SELECT a.id as issue_id,a.issue_number, a.company_id, a.supplier_id, a.issue_date, a.item_category, a.received_id, a.received_mrr_no, b.id, b.no_of_bags, b.cone_per_bag, b.cons_quantity, b.cons_uom as unit_of_measure, b.rcv_rate as cons_rate, b.rcv_amount as cons_amount, c.product_name_details, c.id as prod_id from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id where a.id=b.mst_id and b.item_category=1 and b.transaction_type=3 and a.id in($data[0]) $cond";
	}
	else if($basis==22 || $basis==30) //Fabric Issue to Fin. Process // basis: 30 Fabric service receive return .......
	{
		$composition_arr=array();
		$construction_arr=array();
		$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id";
		$data_array=sql_select($sql_deter);
		if(count($data_array)>0)
		{	
			foreach( $data_array as $row )
			{
				$construction_arr[$row[csf('id')]]=$row[csf('construction')];
				if(array_key_exists($row[csf('id')],$composition_arr))
				{
					$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]]." ".$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
				}
				else
				{
					$composition_arr[$row[csf('id')]]=$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
				}
			}
		}

		$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
		$color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
		$sql="SELECT b.batch_issue_qty as cons_quantity, b.order_id, b.body_part_id, b.febric_description_id, b.gsm, b.width, b.color_id, 		
		b.id, b.mst_id, b.prod_id,  b.buyer_id, b.job_no,  b.width_dia_type, b.color_range_id, b.batch_id,  b.process_id, b.batch_wgt,  b.outbound_batchname, b.fin_dia, b.fin_gsm, b.roll_no,c.uom from pro_grey_batch_dtls b, wo_booking_dtls c where c.id=b.booking_dtls_id and  b.mst_id in($data[0]) and b.status_active=1 and b.is_deleted=0 order by b.id";	
	}
	else if($basis==26)//SubCon Material Return
	{
		$subcon_po_number_arr=return_library_array( "select id, order_no from subcon_ord_dtls", "id", "order_no");
	  	$sql = "SELECT a.id, b.subcon_roll, b.quantity as cons_quantity, b.material_description as product_name_details, b.order_id,b.subcon_uom as unit_of_measure, b.item_category_id as item_category from sub_material_mst a ,sub_material_dtls b where a.id=b.mst_id  and b.mst_id=$mst_challan and a.status_active=1 and a.is_deleted=0  and a.trans_type in(3) ";
	}
	else if($basis==64)//SubCon Material Return
	{
	  	$sql = "SELECT a.id, b.item_category_id as item_category, b.quantity as cons_quantity, b.material_description as product_name_details, b.order_id, c.subcon_uom as unit_of_measure, c.rate as cons_rate, c.subcon_roll from sub_material_return_mst a, sub_material_return_dtls b, sub_material_dtls c where a.id=b.mst_id and b.receive_dtls_id=c.id and a.id=$mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	}
	else if($basis==23 || $basis==24 || $basis==25 || $basis==37) //General Item , Trims ,Chemical and Dyes receive return .......
	{
		if($mst_challan!="") $cond .= " and a.issue_number='$mst_challan'";
		if($mstid!="") $cond2 = " and a.id='$mstid'";else $cond2 = " ";		
		//"select item_order_id from inv_issue_master a,inv_trims_issue_dtls b where a.id=b.mst_id and and a.id='$mstid'";
		    // $order_id = return_field_value("b.order_id as order_id", "inv_issue_master a,inv_trims_issue_dtls b", "a.id=b.mst_id and and a.id='$mstid' and transaction_type in (3)", "order_id");		
		$sql = "SELECT a.id as issue_id, a.issue_number, a.company_id, a.supplier_id, a.issue_date,a.received_id, a.received_mrr_no,b.transaction_type as trans_id, b.id as dtls_id, b.no_of_bags, b.cone_per_bag, b.cons_quantity, b.item_category,b.cons_uom as unit_of_measure, b.cons_rate, b.cons_amount, c.product_name_details, c.id as prod_id from inv_issue_master a, inv_transaction b,product_details_master c where a.id=b.mst_id and b.prod_id=c.id and a.entry_form<>45 and b.transaction_type=3 and b.status_active=1 and b.is_deleted=0  $cond ";
	}
	else if($basis==3) //Grey Fabric
	{
		if($db_type==2) 
		{
			$trans_group_con="LISTAGG(a.id, ',') WITHIN GROUP (ORDER BY a.id desc) as id";
		}
		else
		{
			$trans_group_con="group_concat(a.id) as id";
		}
		//group by b.id,a.transaction_type,a.item_category,b.product_name_details, b.avg_rate_per_unit,b.unit_of_measure,c.remarks
		$sql = "SELECT c.id as issue_id, c.issue_number as sys_number_id,b.id as prod_id,a.transaction_type,a.item_category,b.product_name_details,avg(b.avg_rate_per_unit) as cons_rate,sum(a.cons_quantity) as cons_quantity,sum(a.cons_amount) as cons_amount,c.remarks,b.unit_of_measure, $trans_group_con from inv_issue_master c ,inv_transaction a, product_details_master b where c.id=a.mst_id and a.prod_id=b.id and a.mst_id in($mst_challan) and c.entry_form in(16,61) and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.id,a.transaction_type,a.item_category,b.product_name_details,c.remarks,b.unit_of_measure,c.issue_number,c.id order by b.id ";

		$result_data = sql_select($sql);

		$issue_id_arr = array();

		foreach($result_data as $data)
		{
			$issue_id_arr[]=$data[csf('issue_id')];
		}

		$issue_id_arr = array_unique($issue_id_arr);

		$all_issue_id = implode(",",$issue_id_arr);
 		$sql_order=sql_select("select a.trans_id,a.trans_type,b.id as po_id,b.po_number, c.prod_id, c.no_of_roll as no_of_bags, c.mst_id as issue_id,d.is_sales from inv_grey_fabric_issue_dtls c,pro_roll_details d, order_wise_pro_details a, wo_po_break_down b where c.id=d.dtls_id and d.po_breakdown_id=b.id and c.mst_id in(".$all_issue_id.") and d.entry_form in(16,61) and a.entry_form in(16,61) and trans_type in(2,3) and a.dtls_id=c.id ") ;

		$order_number_id_arr = array();
		$order_id_arr = array();
		$item_order_number_arr = array();
		$item_order_numbers_arr = array();
		$no_of_bags_arr=array();
		$sales_po_number_arr=return_library_array( "select id, JOB_NO from FABRIC_SALES_ORDER_MST", "id", "JOB_NO");
		foreach($sql_order as $row_order)
		{
			
				if($row_order[csf('is_sales')]==1)
				{
					$order_number_id_arr[$row_order[csf('prod_id')]]=$sales_po_number_arr[$row_order[csf('po_id')]];	
					$order_id_arr[$row_order[csf('prod_id')]]=$row_order[csf('po_id')];	
					$item_order_number_arr[$row_order[csf('prod_id')]][$row_order[csf('trans_type')]].=$row_order[csf('po_number')].',';
					$item_order_numbers_arr[$row_order[csf('prod_id')]][$row_order[csf('trans_id')]].=$row_order[csf('po_number')].',';	
					$is_sales=1;
				
				}
				else
				{
					$order_number_id_arr[$row_order[csf('prod_id')]]=$row_order[csf('po_number')];	
					$order_id_arr[$row_order[csf('prod_id')]]=$row_order[csf('po_id')];	
					$item_order_number_arr[$row_order[csf('prod_id')]][$row_order[csf('trans_type')]].=$row_order[csf('po_number')].',';
					$item_order_numbers_arr[$row_order[csf('prod_id')]][$row_order[csf('trans_id')]].=$row_order[csf('po_number')].',';	
					$is_sales=0;
					
				}
				
				 
		}
		

		$sql_issue=sql_select("select c.prod_id, sum(c.no_of_roll) as no_of_bags, c.mst_id as issue_id from inv_grey_fabric_issue_dtls c where c.mst_id in(".$all_issue_id.") and c.status_active=1 and c.is_deleted=0 group by c.prod_id, c.mst_id");
		foreach ($sql_issue as $row)
		{
			$no_of_bags_arr[$row[csf('issue_id')]][$row[csf('prod_id')]]=$row[csf('no_of_bags')];
		}
		//echo '<pre>';print_r($no_of_bags_arr);

	}
	else if($basis==28)//Sample Delivery, issue 6906
	{
	 	if($return_number!="") $cond .= " and a.sys_number='$return_number'";
		if($ret_mst_id!="") $cond .= " and a.id='$ret_mst_id'";
		$sample_name_arr=return_library_array( "select id, sample_name from  lib_sample",'id','sample_name');
		$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
		$sql = "SELECT a.id,a.sys_number_prefix_num, a.sys_number as issue_number,a.company_id, a.delivery_basis,a.ex_factory_date as ex_factory_date,b.sample_name,b.gmts_item_id, sum(b.ex_factory_qty)as cons_quantity,sum(b.carton_qty) as no_of_bags,b.remarks,b.sample_development_id, b.id as dtls_id from sample_ex_factory_mst a, sample_ex_factory_dtls b where  a.id=b.sample_ex_factory_mst_id and a.status_active=1 and (a.entry_form_id=132 or a.entry_form_id=551 or a.entry_form_id=544) and a.id in($data[0]) $cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.id, a.sys_number_prefix_num, a.sys_number, a.company_id,b.sample_name,b.gmts_item_id, a.delivery_basis,a.ex_factory_date,b.remarks,b.sample_development_id, b.id order by a.id";
	}
	else if($basis==57)//Sample Delivery
	{
	 	if($return_number!="") $cond .= " and a.sys_number='$return_number'";
		if($ret_mst_id!="") $cond .= " and a.id='$ret_mst_id'";
		$sample_name_arr=return_library_array( "select id, sample_name from  lib_sample",'id','sample_name');
		
		$sql = "SELECT a.id,a.sys_number_prefix_num, a.sys_number as issue_number,a.company_id, a.delivery_basis,b.delivery_date as ex_factory_date,b.sample_name,b.gmts_item_id, sum(b.ex_factory_qty)as cons_quantity,sum(b.carton_qty) as no_of_bags,b.remarks,b.sample_development_id
		from sample_ex_factory_mst a, sample_ex_factory_dtls b where a.id=b.sample_ex_factory_mst_id and a.status_active=1 and a.entry_form_id=396 and a.id in($data[0]) $cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.id, a.sys_number_prefix_num, a.sys_number, a.company_id,b.sample_name,b.gmts_item_id, a.delivery_basis,b.delivery_date,b.remarks,b.sample_development_id order by a.id";
	}
	else if($basis==29) //Woven Finish Fabric Recv Return
	{
		$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
		$trans_po_id_arr=return_library_array( "select trans_id, po_breakdown_id from  order_wise_pro_details where entry_form in(18,46,61,71,78,112) and trans_type in(2,3,5,6)",'trans_id','po_breakdown_id');
		$sql = "SELECT a.id as issue_id, a.item_category, a.received_id, a.received_mrr_no, b.id as trans_id, b.cons_quantity as cons_quantity,b.cons_uom, b.cons_rate, b.cons_amount, c.product_name_details, c.id as prod_id from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id where a.id=b.mst_id and b.item_category=3 and a.entry_form=202 and b.transaction_type=3 and  a.id in($mst_challan) order by b.id";		   
	}
	else if($basis==4) //Finish Fabric
	{
		$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
		$trans_po_id_arr=return_library_array( "select trans_id, po_breakdown_id from  order_wise_pro_details where entry_form in(18,46,61,71,78,112) and trans_type in(2,3,5,6)",'trans_id','po_breakdown_id');
		$sql = "SELECT a.id,a.transaction_type,a.item_category,b.product_name_details,a.cons_rate,a.cons_quantity,a.cons_uom ,a.cons_amount,a.remarks,b.unit_of_measure,c.no_of_roll as no_of_bags  from inv_transaction a,inv_finish_fabric_issue_dtls c, product_details_master b where a.mst_id=c.mst_id and a.id=c.trans_id and a.prod_id=b.id and a.mst_id in($mst_challan) and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by  a.id,a.transaction_type,a.item_category,b.product_name_details,a.cons_rate,a.cons_quantity,a.cons_uom ,a.cons_amount,a.remarks,b.unit_of_measure,c.no_of_roll order by a.id"; 
	}	
	else if($basis==31)//woven Finish Fabric issue return
	{
		$sql = "SELECT a.id as issue_id,a.item_category,a.id asreceived_id, a.recv_number_prefix_num, a.recv_number as received_mrr_no,b.id as trans_id, b.cons_quantity as cons_quantity,b.cons_uom  as unit_of_measure, b.cons_rate, b.cons_amount, c.product_name_details, c.id as prod_id from inv_receive_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id where a.id=b.mst_id and b.item_category=3 and b.transaction_type=4 and  a.id in($mst_challan) order by b.id";
	}
	else if($basis==32) //Woven Finish Fabric Issue
	{
		$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );	
		$trans_po_id_arr=return_library_array( "select trans_id, po_breakdown_id from  order_wise_pro_details where entry_form in(18,46,61,71,78,112) and trans_type in(2,3,5,6)",'trans_id','po_breakdown_id');
		$sql = "SELECT a.id as issue_id, a.item_category, a.received_id, a.received_mrr_no, b.id as trans_id, b.cons_quantity as cons_quantity, b.cons_rate, b.cons_amount, c.product_name_details, c.id as prod_id,c.unit_of_measure as cons_uom from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id where a.id=b.mst_id and b.item_category=3 and a.entry_form=19 and b.transaction_type=2 and  a.id in($mst_challan) order by b.id";		   
	}
	else if($basis==33) //SubCon Embellishment Delivery
	{
		$knit_des_arr=return_library_array( "select id, const_comp from lib_subcon_charge",'id','const_comp');
		$subcon_po_number_arr=return_library_array( "select id, order_no from subcon_ord_dtls", "id", "order_no");
		$color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
		$sql = "SELECT a.id,b.delivery_qty as cons_quantity,b.item_id,b.order_id,b.batch_id,b.batch_against,b.color_id,b.prod_id,c.rate as cons_rate,c.amount as cons_amount from subcon_delivery_mst a ,subcon_delivery_dtls b,subcon_ord_dtls c  where a.id=b.mst_id and b.order_id=c.id and b.mst_id=$mst_challan and a.status_active=1 and a.is_deleted=0  and a.entry_form=4 ";	
		$result=sql_select($sql);
		$batch_ids="";
		foreach($result as $row)
		{
			$batch_ids.=$row[csf('batch_id')].',';
		}
		$batch_id=chop($batch_ids,",");
		$sql_batch_no = "select  id,batch_no from pro_batch_create_mst where id in($batch_id) and status_active=1 and is_deleted=0";	
		$result_batch=sql_select($sql_batch_no);
		$batch_arr=array();
		foreach($result_batch as $row)
		{
			$batch_arr[$row[csf('id')]]['batch_no']=$row[csf('batch_no')];
		}		
	}
	else if($basis==34) //Finish Fabric Transfer
	{
		$sql="SELECT a.entry_form,b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id,b.to_order_id,b.trans_id, b.transfer_qnty as cons_quantity,
		b.yarn_lot,b.rate as cons_rate,b.transfer_value as cons_amount,b.brand_id,c.product_name_details,b.no_of_roll as no_of_bags
		from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c,inv_transaction d 
		where a.id=b.mst_id and c.id=b.from_prod_id and b.from_prod_id=d.prod_id and b.mst_id in ($data[0]) and b.item_category=2 
		and b.status_active = '1' and b.is_deleted = '0' and d.no_of_bags is not NULL
		group by  a.entry_form,b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id,b.to_order_id,b.trans_id, b.transfer_qnty,
		b.yarn_lot,b.rate,b.transfer_value ,b.brand_id,c.product_name_details,b.no_of_roll"; 
		//  b.mst_id='$data[2]'		
	}
	else if($basis==35) //scrap sales
	{
		/*$sql="select a.entry_form,b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id,b.to_order_id,b.trans_id, b.transfer_qnty as cons_quantity,
		b.yarn_lot,b.rate as cons_rate,b.transfer_value as cons_amount,b.brand_id,c.product_name_details,d.no_of_bags 
		from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c,inv_transaction d 
		where a.id=b.mst_id and c.id=b.from_prod_id and b.from_prod_id=d.prod_id and b.mst_id='$data[2]' and b.item_category=2 
		and b.status_active = '1' and b.is_deleted = '0' and d.no_of_bags is not NULL
		group by  a.entry_form,b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id,b.to_order_id,b.trans_id, b.transfer_qnty,
		b.yarn_lot,b.rate,b.transfer_value ,b.brand_id,c.product_name_details,d.no_of_bags"; */

		$sql= "SELECT a.id as issue_id, a.challan_no_prefix_num, a.item_category, a.selling_date, a.pay_term, a.customer_id, a.currency_id, a.remarks,b.id as dtls_id, b.prod_id, b.rej_uom, b.sales_qty_as_rej_uom, b.sales_uom, b.sales_qty as cons_quantity, b.sales_rate as cons_rate, b.sales_amount as cons_amount from inv_scrap_sales_mst a, inv_scrap_sales_dtls b where  a.id='$data[2]' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.id DESC ";
	}
	else if($basis==49) //Printing Delivery
	{
		$knit_des_arr=return_library_array( "select id, const_comp from lib_subcon_charge",'id','const_comp');
		$subcon_po_number_arr=return_library_array( "select id, order_no from subcon_ord_dtls", "id", "order_no");
		$size_arr=return_library_array( "select id,size_name from  lib_size",'id','size_name');
		$color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
		$sql = "SELECT a.id,b.delivery_qty as cons_quantity,b.item_id,b.order_id,b.batch_id,b.color_size_id as breakdown_id,b.remarks,c.rate as cons_rate,b.buyer_po_id,c.main_process_id,c.embl_type,c.body_part,c.gmts_item_id,(b.delivery_qty*c.rate) as cons_amount 
		from subcon_delivery_mst a ,subcon_delivery_dtls b,subcon_ord_dtls c  
		where a.id=b.mst_id and b.order_id=c.id   and b.mst_id=$mst_challan and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and b.delivery_qty>0 group by a.id,b.delivery_qty ,b.item_id,b.order_id,b.batch_id,b.color_size_id,b.remarks,c.rate,b.buyer_po_id,c.main_process_id,c.embl_type,c.body_part,c.gmts_item_id";

		$data_sql_arr=sql_select($sql);
		$breakdown_id="";
		$buyer_po_id="";
		foreach ($data_sql_arr as $row)
		{
			$breakdown_id.=$row[csf("breakdown_id")].",";
			$buyer_po_id.=$row[csf("buyer_po_id")].",";
		}
		$breakdown_ids=chop($breakdown_id,",");
		$buyer_po_ids=chop($buyer_po_id,",");
		$sql_breakdown_data=sql_select("select d.id,d.color_id,d.size_id from subcon_ord_breakdown d where d.id in($breakdown_ids)"); 
		foreach ($sql_breakdown_data as $row)
		{
			$breakdown_data_arr[$row[csf("id")]]['color_id']=$row[csf("color_id")];
			$breakdown_data_arr[$row[csf("id")]]['size_id']=$row[csf("size_id")];
		}

		$po_sql ="Select a.style_ref_no, a.buyer_name, b.id, b.po_number from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and b.id in($buyer_po_ids) and a.status_active=1 and a.is_deleted=0  and b.status_active=1 and b.is_deleted=0";
		$po_sql_res=sql_select($po_sql);
		foreach ($po_sql_res as $row)
		{
			$buyer_po_arr[$row[csf("id")]]['po']=$row[csf("po_number")];
		}

	}
	else if($basis==50)  //Trims Delivery Challan
	{
		/*$sql = "select a.id,b.delivery_qty as cons_quantity,b.item_id,b.order_id,b.batch_id,b.color_size_id as breakdown_id,c.rate as cons_rate,b.buyer_po_id,c.main_process_id,c.embl_type,c.body_part,c.gmts_item_id,(b.delivery_qty*c.rate) as cons_amount 
		from subcon_delivery_mst a ,subcon_delivery_dtls b,subcon_ord_dtls c  
		where a.id=b.mst_id and b.order_id=c.id   and b.mst_id=$mst_challan and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and b.delivery_qty>0 group by a.id,b.delivery_qty ,b.item_id,b.order_id,b.batch_id,b.color_size_id,c.rate,b.buyer_po_id,c.main_process_id,c.embl_type,c.body_part,c.gmts_item_id";
		
		*/
		/*id, mst_id, booking_dtls_id, receive_dtls_id, job_dtls_id, production_dtls_id,  order_id, order_no, buyer_po_id, buyer_po_no,  buyer_style_ref, buyer_buyer, section,item_group, order_uom, order_quantity, delevery_qty, claim_qty, remarks,description, color_id, size_id,color_name,size_name,delevery_status,workoder_qty*/
		
		
		/*$sql = "select a.id,b.id as dtls_id,b.delevery_qty as cons_quantity,b.order_id,b.buyer_po_id,b.buyer_po_no,b.description,b.color_id,b.order_uom,b.color_name,b.size_name
		from trims_delivery_mst a,trims_delivery_dtls b 
		where a.id=b.mst_id and b.mst_id=$mst_challan and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and b.delevery_qty>0 group by a.id,b.id,b.delevery_qty,b.order_id,b.buyer_po_id,b.buyer_po_no,b.description,b.color_id,b.order_uom,b.color_name,b.size_name";*/
		
		$knit_des_arr=return_library_array( "select id, const_comp from lib_subcon_charge",'id','const_comp');
		$subcon_po_number_arr=return_library_array( "select id, order_no from subcon_ord_dtls", "id", "order_no");
		$size_arr=return_library_array( "select id,size_name from  lib_size",'id','size_name');
		$sql = "SELECT a.id,b.id as dtls_id,b.delevery_qty as cons_quantity,b.order_id,b.buyer_po_id,b.buyer_po_no,b.description,b.color_id,b.order_uom,b.color_name,b.size_name,b.no_of_roll_bag as no_of_bags from trims_delivery_mst a,trims_delivery_dtls b where a.id=b.mst_id  and b.mst_id in($mst_challan)  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and b.delevery_qty>0 group by a.id,b.id,b.delevery_qty,b.order_id,b.buyer_po_id,b.buyer_po_no,b.description,b.color_id,b.order_uom,b.color_name,b.size_name,b.no_of_roll_bag";

		$data_sql_arr=sql_select($sql);
		$breakdown_id="";
		$buyer_po_id="";
		foreach ($data_sql_arr as $row)
		{
			$breakdown_id.=$row[csf("breakdown_id")].",";
			$buyer_po_id.=$row[csf("buyer_po_id")].",";
		}
		$breakdown_ids=chop($breakdown_id,",");
		$buyer_po_ids=chop($buyer_po_id,",");
		$sql_breakdown_data=sql_select("select d.id,d.color_id,d.size_id from subcon_ord_breakdown d where d.id in($breakdown_ids)"); 
		foreach ($sql_breakdown_data as $row)
		{
			$breakdown_data_arr[$row[csf("id")]]['color_id']=$row[csf("color_id")];
			$breakdown_data_arr[$row[csf("id")]]['size_id']=$row[csf("size_id")];
		}

		$po_sql ="Select a.style_ref_no, a.buyer_name, b.id, b.po_number from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and b.id in($buyer_po_ids) and a.status_active=1 and a.is_deleted=0  and b.status_active=1 and b.is_deleted=0";
		$po_sql_res=sql_select($po_sql);
		foreach ($po_sql_res as $row)
		{
			$buyer_po_arr[$row[csf("id")]]['po']=$row[csf("po_number")];
		}

	}
	else if($basis==51) //Wash Delivery
	{
		$knit_des_arr=return_library_array( "select id, const_comp from lib_subcon_charge",'id','const_comp');
		$subcon_po_number_arr=return_library_array( "select id, order_no from subcon_ord_dtls", "id", "order_no");
		$sql = "SELECT a.id,b.delivery_qty as cons_quantity,b.item_id,b.order_id,b.batch_id,b.batch_against,b.color_id,b.prod_id from subcon_delivery_mst a ,subcon_delivery_dtls b, subcon_ord_dtls c where a.id=b.mst_id and b.order_id=c.id and b.mst_id=$mst_challan and a.status_active=1 and a.is_deleted=0  and a.entry_form=303 ";	
		$result=sql_select($sql);
		$batch_ids="";
		foreach($result as $row)
		{
			$batch_ids.=$row[csf('batch_id')].',';
		}
		$batch_id=chop($batch_ids,",");
		$sql_batch_no = "select  id,batch_no from pro_batch_create_mst where id in($batch_id) and status_active=1 and is_deleted=0";	
		$result_batch=sql_select($sql_batch_no);
		$batch_arr=array();
		foreach($result_batch as $row)
		{
			$batch_arr[$row[csf('id')]]['batch_no']=$row[csf('batch_no')];
		}
		
	}
	else if($basis==52) //AOP Delivery Challan
	{
		$subcon_po_number_arr=return_library_array( "select id, order_no from subcon_ord_dtls", "id", "order_no");
		$sql = "SELECT a.id,b.product_qnty as cons_quantity,b.fabric_description as item_id,b.order_id,b.batch_id,b.color_id,b.body_part_id,b.uom_id from subcon_production_mst a ,subcon_production_dtls b where a.id=b.mst_id and b.mst_id=$mst_challan and a.status_active=1 and a.is_deleted=0  and a.entry_form=307 ";		  
		$result=sql_select($sql);
		$batch_ids="";
		foreach($result as $row)
		{
			$batch_ids.=$row[csf('batch_id')].',';
		}
		$batch_id=chop($batch_ids,",");
		$sql_batch_no = "select  id,batch_no from pro_batch_create_mst where id in($batch_id) and status_active=1 and is_deleted=0";	
		$result_batch=sql_select($sql_batch_no);
		$batch_arr=array();
		foreach($result_batch as $row)
		{
			$batch_arr[$row[csf('id')]]['batch_no']=$row[csf('batch_no')];
		}		
	}
	else if($basis==53) //Challan Embellishment Issue
	{
		$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
		$sql="SELECT a.id as id ,a.po_break_down_id as order_id, a.item_number_id, sum(a.production_quantity) as  cons_quantity from  pro_garments_production_mst a where a.delivery_mst_id in($mst_challan) and a.production_type=9 and a.status_active=1 and a.is_deleted=0 group by a.id,a.po_break_down_id,a.item_number_id";		 
		//$sql = "SELECT b.id,a.po_break_down_id,b.challan_no,a.item_number_id,a.country_id,b.delivery_date,a.production_quantity,a.location,b.sys_number,b.sys_number_prefix_num from  pro_garments_production_mst a,  pro_gmts_delivery_mst b where a.delivery_mst_id=b.id and a.status_active=1 and a.is_deleted=0 and b.entry_form=347 and a.entry_form=347 and a.production_type=9 order by id";
	}
	else if($basis==54) //Finish Fabric Delivery To Germents
	{
		$sql = "SELECT a.id, a.transaction_type, a.item_category, b.item_description as product_name_details, a.order_rate as cons_rate, a.order_qnty as cons_quantity, a.cons_uom , a.order_amount as cons_amount, a.remarks, b.unit_of_measure from inv_transaction a, product_details_master b where a.prod_id=b.id and a.mst_id in($mst_challan) and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0"; 
		//echo $sql;
	}
	else if($basis==63) //Finish Fabric Roll Delivery To Garments
	{
		$sql = "SELECT a.id,a.transaction_type,a.item_category,b.product_name_details,a.cons_rate,a.cons_quantity,a.cons_uom ,a.cons_amount,a.remarks,b.unit_of_measure  from inv_transaction a, product_details_master b where a.prod_id=b.id and a.mst_id in($mst_challan) and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	}
	else if($basis==56)  //Wash Material Receive Return
	{
		$color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
		$sql = "SELECT d.id, d.sys_no as sys_number, d.prefix_no_num, d.chalan_no, d.within_group, d.party_id, d.embl_job_no as job_no, c.remarks, c.quantity as cons_quantity, b.gmts_item_id, b.order_uom as uom, b.gmts_color_id as color_id, a.order_id, a.order_no
		from subcon_ord_mst a, subcon_ord_dtls b, sub_material_dtls c, sub_material_mst d
		where a.subcon_job=b.job_no_mst  and a.id=b.mst_id and b.id=c.job_dtls_id and c.mst_id=d.id  and a.entry_form=295 and d.entry_form=372 and d.trans_type=3 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and d.id=$mst_id and d.sys_no='$mst_challan'";
		//$data_sql_arr=sql_select($sql);		
	}
	else if($basis==58) //Grey Roll Issue to Process
	{
		$composition_arr=array();
		$construction_arr=array();
		$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id";
		$data_array=sql_select($sql_deter);
		if(count($data_array)>0)
		{	
			foreach( $data_array as $row )
			{
				$construction_arr[$row[csf('id')]]=$row[csf('construction')];
				if(array_key_exists($row[csf('id')],$composition_arr))
				{
					$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]]." ".$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
				}
				else
				{
					$composition_arr[$row[csf('id')]]=$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
				}
			}
		}

		$color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
		$po_number_arr=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number" );
		$sql="SELECT b.roll_wgt as cons_quantity, b.order_id, b.body_part_id, b.febric_description_id, b.gsm, b.width, b.color_id, b.id as dtls_id, b.mst_id, b.prod_id, b.buyer_id, b.job_no, b.width_dia_type, b.color_range_id, b.batch_id, b.process_id, b.batch_wgt, b.outbound_batchname, b.fin_dia, b.fin_gsm, b.roll_no from pro_grey_batch_dtls b where b.mst_id in($data[2]) and b.status_active=1 and b.is_deleted=0 order by b.id";
	}
	else if($basis==59)  //Embroidery Delivery Entry
	{
		$knit_des_arr=return_library_array( "select id, const_comp from lib_subcon_charge",'id','const_comp');
		$subcon_po_number_arr=return_library_array( "select id, order_no from subcon_ord_dtls", "id", "order_no");
		$color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
		$sql = "SELECT a.id,b.delivery_qty as cons_quantity,b.item_id,b.order_id,b.batch_id,b.color_size_id as breakdown_id,c.rate as cons_rate,b.buyer_po_id,c.main_process_id,c.embl_type,c.body_part,c.gmts_item_id,(b.delivery_qty*c.rate) as cons_amount from subcon_delivery_mst a ,subcon_delivery_dtls b, subcon_ord_dtls c where a.id=b.mst_id and b.order_id=c.id and b.mst_id=$mst_challan and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and b.delivery_qty>0 group by a.id,b.delivery_qty ,b.item_id,b.order_id,b.batch_id,b.color_size_id,c.rate,b.buyer_po_id,c.main_process_id,c.embl_type,c.body_part,c.gmts_item_id";

		$data_sql_arr=sql_select($sql);
		$breakdown_id="";
		$buyer_po_id="";
		foreach ($data_sql_arr as $row)
		{
			$breakdown_id.=$row[csf("breakdown_id")].",";
			$buyer_po_id.=$row[csf("buyer_po_id")].",";
		}
		$breakdown_ids=chop($breakdown_id,",");
		$buyer_po_ids=chop($buyer_po_id,",");
		$sql_breakdown_data=sql_select("select d.id,d.color_id,d.size_id from subcon_ord_breakdown d where d.id in($breakdown_ids)"); 
		foreach ($sql_breakdown_data as $row)
		{
			$breakdown_data_arr[$row[csf("id")]]['color_id']=$row[csf("color_id")];
			$breakdown_data_arr[$row[csf("id")]]['size_id']=$row[csf("size_id")];
		}

		$po_sql ="Select a.style_ref_no, a.buyer_name, b.id, b.po_number from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and b.id in($buyer_po_ids) and a.status_active=1 and a.is_deleted=0  and b.status_active=1 and b.is_deleted=0";
		$po_sql_res=sql_select($po_sql);
		foreach ($po_sql_res as $row)
		{
			$buyer_po_arr[$row[csf("id")]]['po']=$row[csf("po_number")];
		}
	}
	else if($basis==60) //Sample Embellishment Issue
	{
		if ($return_number!="") $cond .= " and a.sys_number='$return_number'";
		if ($ret_mst_id!="") $cond .= " and a.id='$ret_mst_id'";

	    $sample_name_arr=return_library_array( "select id, sample_name from  lib_sample",'id','sample_name');
		
		$sql = "SELECT a.id as dtls_id, a.sewing_date, a.item_number_id, a.sample_name, a.remarks, sum(a.qc_pass_qty) as cons_quantity, b.id as issue_id, c.company_id, c.requisition_number_prefix_num, c.buyer_name, c.style_ref_no from sample_sewing_output_dtls a, sample_sewing_output_mst b, sample_development_mst c where a.sample_sewing_output_mst_id=b.id and b.sample_development_id=c.id and a.status_active=1 and a.is_deleted=0 and b.entry_form_id=338 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and b.id in($data[0]) and a.id in($data[3]) group by a.id, a.sewing_date, a.item_number_id, a.sample_name, a.remarks, b.id, c.company_id, c.requisition_number_prefix_num, c.buyer_name, c.style_ref_no order by b.id";
	}
	else if($basis==61)  //Wash Dyes Chemical Issue
	{
		$sql="SELECT a.id as prod_id, a.item_category_id, a.item_group_id, a.sub_group_name, a.item_description, a.item_size, a.unit_of_measure, a.current_stock, b.id as dtls_id, b.trans_id, c.cons_rate, c.cons_quantity, c.cons_amount, d.remarks from product_details_master a, dyes_chem_issue_dtls b, inv_transaction c, inv_issue_master d where a.id=b.product_id and b.trans_id=c.id and c.mst_id=d.id and d.id=$mstid and d.entry_form=298 and a.item_category_id in(5,6,7,23) and c.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 order by a.item_category_id";	
	}
	else if($basis==66) //Left Over Garments Issue
	{
		$sql="SELECT a.id,b.id as dtls_id,b.po_break_down_id as order_id,b.ORDER_NO, b.item_number_id, b.TOTAL_ISSUE as cons_quantity from pro_leftover_gmts_issue_mst a, pro_leftover_gmts_issue_dtls b where a.id in($mst_challan) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by b.id";
	}
	else if($basis==67) //Knit Grey Fabric Receive Return
	{
		if($db_type==2) 
		{
			$trans_group_con="LISTAGG(a.id, ',') WITHIN GROUP (ORDER BY a.id desc) as id";
		}
		else
		{
			$trans_group_con="group_concat(a.id) as id";
		}
		//group by b.id,a.transaction_type,a.item_category,b.product_name_details, b.avg_rate_per_unit,b.unit_of_measure,c.remarks
		$sql = "SELECT c.id as issue_id, c.issue_number as sys_number_id,b.id as prod_id,a.transaction_type,a.item_category,b.product_name_details,avg(b.avg_rate_per_unit) as cons_rate,sum(a.cons_quantity) as cons_quantity,sum(a.cons_amount) as cons_amount,c.remarks,b.unit_of_measure, $trans_group_con from inv_issue_master c ,inv_transaction a, product_details_master b where c.id=a.mst_id and a.prod_id=b.id and a.mst_id in($mst_challan) and c.entry_form in(45) and a.transaction_type=3 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.id,a.transaction_type,a.item_category,b.product_name_details,c.remarks,b.unit_of_measure,c.issue_number,c.id order by b.id ";

		// echo $sql ;die;

		$result_data = sql_select($sql);

		$issue_id_arr = array();

		foreach($result_data as $data)
		{
			$issue_id_arr[]=$data[csf('issue_id')];
		}

		$issue_id_arr = array_unique($issue_id_arr);

		$all_issue_id = implode(",",$issue_id_arr);
		$sql_order=sql_select("select a.trans_id,a.trans_type,b.id as po_id,b.po_number, c.prod_id, c.no_of_roll as no_of_bags, c.mst_id as issue_id from inv_grey_fabric_issue_dtls c,pro_roll_details d, order_wise_pro_details a, wo_po_break_down b where c.id=d.dtls_id and d.po_breakdown_id=b.id and c.mst_id in(".$all_issue_id.") and d.entry_form in(45) and a.entry_form in(45) and trans_type in(2,3) and a.dtls_id=c.id ") ;

		$order_number_id_arr = array();
		$order_id_arr = array();
		$item_order_number_arr = array();
		$item_order_numbers_arr = array();
		$no_of_bags_arr=array();
		foreach($sql_order as $row_order)
		{
			$order_number_id_arr[$row_order[csf('prod_id')]]=$row_order[csf('po_number')];	
			$order_id_arr[$row_order[csf('prod_id')]]=$row_order[csf('po_id')];	
			$item_order_number_arr[$row_order[csf('prod_id')]][$row_order[csf('trans_type')]].=$row_order[csf('po_number')].',';
			$item_order_numbers_arr[$row_order[csf('prod_id')]][$row_order[csf('trans_id')]].=$row_order[csf('po_number')].',';			
		}
		

		$sql_issue=sql_select("select c.prod_id, sum(c.no_of_roll) as no_of_bags, c.mst_id as issue_id from inv_grey_fabric_issue_dtls c where c.mst_id in(".$all_issue_id.") and c.status_active=1 and c.is_deleted=0 group by c.prod_id, c.mst_id");
		foreach ($sql_issue as $row)
		{
			$no_of_bags_arr[$row[csf('issue_id')]][$row[csf('prod_id')]]=$row[csf('no_of_bags')];
		}
		//echo '<pre>';print_r($no_of_bags_arr);

	}
	else 
	{
		$sql = "SELECT a.id, a.prod_id, a.transaction_type, a.item_category, b.product_name_details, a.cons_rate, a.cons_quantity, a.cons_uom ,a.cons_amount,a.remarks, b.unit_of_measure  
		from inv_transaction a, product_details_master b 
		where a.prod_id=b.id and a.mst_id in($mst_challan) and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0"; 
	}
	//echo $sql; die;
	$result=sql_select($sql);
	$count_td=count($result);
	$garment_item_uom_check_arr=array();
	$total_quantity=0;
	foreach($result as $row)
	{
		$tbl_row++;		
		if($tbl_row!=$count_td) $display="none"; else $display="";
		if($basis==32) //Woven Finish Fabric Issue
	  	{
			$sql_order=sql_select("select a.trans_type,b.id as po_id,b.po_number from order_wise_pro_details a, wo_po_break_down b where a.po_breakdown_id=b.id and a.trans_id in(".$row[csf('trans_id')].") and trans_type in(2,3)");
		}
		else if ($basis==17) 
		{
			$sql_order=sql_select("select a.trans_type,b.id as po_id,b.po_number from order_wise_pro_details a, wo_po_break_down b where a.po_breakdown_id=b.id and b.id in(".$row[csf('to_order_id')].") and trans_type in(2,3) group by a.trans_type,b.id,b.po_number");
		}
		else if($basis==54)
		{
			$sql_order=sql_select("select a.trans_type, b.id as po_id, b.job_no as po_number from order_wise_pro_details a, fabric_sales_order_mst b where a.po_breakdown_id=b.id and a.trans_id in(".$row[csf('id')].") and trans_type in(2,3)");
		}	
		else
		{
			if($basis!=3)
			{
				$sql_order=sql_select("select a.trans_id,a.trans_type,b.id as po_id,b.po_number from order_wise_pro_details a, wo_po_break_down b where a.po_breakdown_id=b.id and a.trans_id in(".$row[csf('id')].") and trans_type in(2,3)");
			}
		}		
		//echo "select a.trans_type,b.id as po_id,b.po_number from order_wise_pro_details a, wo_po_break_down b where a.po_breakdown_id=b.id and a.trans_id in(".$row[csf('id')].") and trans_type in(2,3)";
			
		if($basis==3)//Grey Fab.(Challan) Issue
		{
			//echo "select  c.barcode_no from inv_grey_fabric_issue_dtls b,pro_roll_details c where c.dtls_id=b.id and c.entry_form=61 and b.trans_id in(".$row[csf('id')].") group by c.barcode_no";
		 	$grey_issue_roll=sql_select("select  c.barcode_no from inv_grey_fabric_issue_dtls b,pro_roll_details c where c.dtls_id=b.id and c.entry_form=61 and b.trans_id in(".$row[csf('id')].") group by c.barcode_no");		
			$no_of_roll=count($grey_issue_roll);
			if ($no_of_roll == 0){
				$no_of_roll=$no_of_bags_arr[$row[csf('issue_id')]][$row[csf('prod_id')]];
			}			
		}		
		
		if($basis==3)
		{
			$order_number=$order_number_id_arr[$row[csf('prod_id')]];
			$order_id=$order_id_arr[$row[csf('prod_id')]];
			$order_number_arr[$row[csf('transaction_type')]].=$item_order_number_arr[$row[csf('prod_id')]][$row[csf('transaction_type')]];
		}
		else if($basis==2)
		{
			$order_number="";
			$order_id="";
		}
		else
		{
			foreach($sql_order as $row_order)
			{
				$order_number=$row_order[csf('po_number')];	
				$order_id=$row_order[csf('po_id')];	
				$order_number_arr[$row_order[csf('trans_type')]].=$row_order[csf('po_number')].',';
				$order_numbers_arr[$row_order[csf('trans_id')]].=$row_order[csf('po_number')].',';

			}
		}
		
		if($basis==4)//Finish Fab.(Challan)
		{
			$garment_item_uom=$row[csf('unit_of_measure')];
			$garment_item_data=$row[csf('item_category')];
			$item_des=$row[csf('product_name_details')];
			$order_number=$po_number_arr[$trans_po_id_arr[$row[csf('id')]]];
			$order_id=$trans_po_id_arr[$row[csf('id')]];
		}
		else if($basis==11)
		{
			$item_des=$construction_arr[$row[csf('determination_id')]].','.$composition_arr[$row[csf('determination_id')]].','.$row[csf('gsm')].','.$row[csf('dia')].',[Batch No: '.$row[csf('batch_id')].']';
			$order_number=$po_number_arr[$row[csf('order_id')]];
			$order_id=$row[csf('order_id')];
			$garment_item_uom=12;
			$garment_item_data=2;	
		}
		else if($basis==10)
		{
			$item_des=$construction_arr[$row[csf('determination_id')]].','.$composition_arr[$row[csf('determination_id')]].','.$row[csf('gsm')].','.$row[csf('dia')];
			$order_number=$po_number_arr[$row[csf('order_id')]];
			$garment_item_uom=12;
			$garment_item_data=13;	
			$delivery_reject_qty=$delivery_reject_qty_arr[$row[csf('id')]][$row[csf('order_id')]][$row[csf('determination_id')]];
		}
		else if ($basis==8)
		{
			$item_des=$knit_des_arr[$row[csf('item_id')]];
			$order_number=$subcon_po_number_arr[$row[csf('order_id')]];
			$order_id=$row[csf('order_id')];
			$garment_item_uom=12;
			$garment_item_data=13;
			$delivery_reject_qty=$row[csf('reject_qty')];
		}
		else if($basis==9 || $basis==27 || $basis==33 || $basis==49 || $basis==50 || $basis==51 || $basis==52 || $basis==59)
		{
			if($basis==52)
			{ 
				$item_des=$row[csf('item_id')];
				$order_number=$subcon_po_number_arr[$row[csf('order_id')]];
				$order_id=$row[csf('order_id')];
				$garment_item_uom=12;
			}
			else
			{
				$item_des=$knit_des_arr[$row[csf('item_id')]];
				$order_number=$subcon_po_number_arr[$row[csf('order_id')]];
				$order_id=$row[csf('order_id')];
				$garment_item_uom=12;
			}
			
			if($basis==33 || $basis==51  || $basis==52 )
			{
				$garment_item_data=13;
				if($basis==33)
				{
					$garment_item_data=30;
					$garment_item_uom=1;
					$gmts_item_array=array();
					$item_array=explode(",",$po_item_array[$row[csf('po_id')]]);
					foreach($item_array as $item)
					{
						$gmts_item_array[$item]=$garments_item[$item];
					}
					$item_des=$batch_against[$row[csf('batch_against')]].','.$batch_arr[$row[csf('batch_id')]]['batch_no'].','.$color_arr[$row[csf('color_id')]].','.$gmts_item_array[$row[csf('prod_id')]];
				}
				else if($basis==51)
				{
					$garment_item_data=30;
					$garment_item_uom=1;
					$gmts_item_array=array();
					$item_array=explode(",",$po_item_array[$row[csf('po_id')]]);
					foreach($item_array as $item)
					{
						$gmts_item_array[$item]=$garments_item[$item];
					}
					//$item_des=$batch_against[$row[csf('batch_against')]].','.$batch_arr[$row[csf('batch_id')]]['batch_no'].','.$color_arr[$row[csf('color_id')]].','.$gmts_item_array[$row[csf('prod_id')]];
				}
				else if($basis==52)
				{
					$garment_item_data=12;
					$garment_item_uom=$row[csf('uom_id')];
					$gmts_item_array=array();
					$item_array=explode(",",$po_item_array[$row[csf('po_id')]]);
					foreach($item_array as $item)
					{
						$gmts_item_array[$item]=$garments_item[$item];
					}
					//$item_des=$batch_against[$row[csf('batch_against')]].','.$batch_arr[$row[csf('batch_id')]]['batch_no'].','.$color_arr[$row[csf('color_id')]].','.$gmts_item_array[$row[csf('prod_id')]];
				}
			}
			else if ($basis==49 || $basis==59) 
			{
			 	$order_id=$row[csf('buyer_po_id')];
			 	//$garment_item_data="28,30";
				$garment_item_uom=1;
				$order_number=$buyer_po_arr[$row[csf("buyer_po_id")]]['po'];	
				if($row[csf("main_process_id")]==1) $emb_type=$emblishment_print_type;
				else if($row[csf("main_process_id")]==2) $emb_type=$emblishment_embroy_type;
				else if($row[csf("main_process_id")]==3) $emb_type=$emblishment_wash_type;
				else if($row[csf("main_process_id")]==4) $emb_type=$emblishment_spwork_type;
				else if($row[csf("main_process_id")]==5) $emb_type=$emblishment_gmts_type;
				else $emb_type="";
				$item_des=$garments_item[$row[csf("gmts_item_id")]].','.$body_part[$row[csf("body_part")]].','.$emb_type[$row[csf("embl_type")]].','.$color_arr[$breakdown_data_arr[$row[csf("breakdown_id")]]['color_id']].','.$size_arr[$breakdown_data_arr[$row[csf("breakdown_id")]]['size_id']]; 
			}
			else if ($basis==50)
			{
			 	$garment_item_data=4;
				$garment_item_uom=$row[csf("order_uom")];
				$order_number=$buyer_po_arr[$row[csf("buyer_po_id")]]['po'];	
				if($row[csf("main_process_id")]==1) $emb_type=$emblishment_print_type;
				else if($row[csf("main_process_id")]==2) $emb_type=$emblishment_embroy_type;
				else if($row[csf("main_process_id")]==3) $emb_type=$emblishment_wash_type;
				else if($row[csf("main_process_id")]==4) $emb_type=$emblishment_spwork_type;
				else if($row[csf("main_process_id")]==5) $emb_type=$emblishment_gmts_type;
				else $emb_type="";
				//$row[csf('no_of_bags')]=$row[csf("no_of_roll_bag")];
				
				$item_des=$row[csf("description")].','.$row[csf("color_name")].','.$row[csf("size_name")];
				$garment_item_uom_check_arr[$garment_item_uom]=$garment_item_uom;
				$total_quantity+=$row[csf('cons_quantity')];
			}
			else if($basis==9)
			{
				$garment_item_data=2;
				$item_des=$batch_array[$row[csf('batch_id')]][$row[csf('order_id')]][$row[csf('item_id')]]['item_description'];
			}
			else
			{
				$garment_item_data=30;
				$garment_item_uom=1;
				$item_des=$garments_item[$row[csf('item_id')]];
				//$garment_item_uom=$row[csf('unit_of_measure')];	
			}
		}
		else if($basis==12)//Challan Garments Delivery
		{
			$item_des=$garments_item[$row[csf('item_number_id')]];
			$order_number=$po_number_arr[$row[csf('order_id')]];	
			$order_id=$row[csf('order_id')];
			$garment_item_uom=1;
			$garment_item_data=30;		
		}
		else if($basis==13 || $basis==55 || $basis==62 || $basis==65)//Challan Emblish
		{
			$item_des=$garments_item[$row[csf('item_number_id')]];
			$order_number=$po_number_arr[$row[csf('order_id')]];
			$order_id=$row[csf('order_id')];
			$garment_item_uom=1;
			//$garment_item_data="28,30";				
		}
		else if($basis==56) //Wash Material Receive Return
		{
			$item_des=$garments_item[$row[csf('gmts_item_id')]].','.$color_arr[$row[csf('color_id')]];
			$order_number=$row[csf('order_no')];
			$order_id=$row[csf('order_id')];
			$garment_item_uom=$row[csf('uom')];
			//$garment_item_data="28,30";				
		}		
		else if($basis==14)//Challan Cutting Delivery
		{
			$item_des=$garments_item[$row[csf('item_number_id')]];
			$order_number=$po_number_arr[$row[csf('order_id')]];
			$order_id=$row[csf('order_id')];
			$garment_item_uom=1;		
		}
		else if($basis==15)//Challan Finish Fabric Recv Return
		{
			$garment_item_data=2;
			$garment_item_uom=12;
			$item_des=$row[csf('product_name_details')];
			$order_number=$po_number_arr[$trans_po_id_arr[$row[csf('trans_id')]]];
			$order_id=$trans_po_id_arr[$row[csf('trans_id')]];					
		}
		else if($basis==29 || $basis==32)//Woven Challan Finish Fabric Recv Return
		{
			$garment_item_data=3;
			$garment_item_uom=$row[csf('cons_uom')];
			$item_des=$row[csf('product_name_details')];
			$order_number=$po_number_arr[$trans_po_id_arr[$row[csf('trans_id')]]];
			$order_id=$trans_po_id_arr[$row[csf('trans_id')]];					
		}
		else if($basis==16)//yarn Transfer data
		{
			$garment_item_data=1;
			$garment_item_uom=12;
			//$item_des=$product_arr[$row[csf('from_prod_id')]];
			$item_des=$row[csf('product_name_details')];
			$order_number=$po_number_arr[$trans_po_id_arr[$row[csf('trans_id')]]];
			$order_id=$trans_po_id_arr[$row[csf('trans_id')]];					
		}
		else if($basis==17)//Grey fabric Transfer data
		{
			$garment_item_data=13;
			$garment_item_uom=12;
			//$item_des=$product_arr[$row[csf('from_prod_id')]];
			$sys_number_id ='';
			$item_des=$row[csf('product_name_details')];
			if ($row[csf('entry_form')]==82) 
			{
				$order_number=$po_number_arr[$row[csf('to_order_id')]];
				$order_id=$row[csf('to_order_id')];
			}
			else
			{
				//$order_number=$po_number_arr[$trans_po_id_arr[$row[csf('trans_id')]]];
				//$order_id=$trans_po_id_arr[$row[csf('trans_id')]];
				$order_number;
				$order_id;
			}

			$item_des=$dtls_data_arr[$row[csf('entry_form')]][$row[csf('mst_id')]][$row[csf('from_store')]][$row[csf('to_store')]][$row[csf('from_prod_id')]][$row[csf('to_prod_id')]][$row[csf('to_order_id')]][$row[csf('brand_id')]]['product_name_details'];
			$row[csf('no_of_bags')]=$dtls_data_arr[$row[csf('entry_form')]][$row[csf('mst_id')]][$row[csf('from_store')]][$row[csf('to_store')]][$row[csf('from_prod_id')]][$row[csf('to_prod_id')]][$row[csf('to_order_id')]][$row[csf('brand_id')]]['no_of_bags'];
			//$row[csf('product_name_details')]=$dtls_data_arr[$row[csf('entry_form')]][$row[csf('mst_id')]][$row[csf('from_store')]][$row[csf('to_store')]][$row[csf('from_prod_id')]][$row[csf('to_prod_id')]][$row[csf('to_order_id')]][$row[csf('brand_id')]]['product_name_details'];					
		}
		else if($basis==18)//General item Transfer data
		{
			$garment_item_data=$row[csf('item_category')];
			$garment_item_uom=$row[csf('uom')];
			//$item_des=$product_arr[$row[csf('from_prod_id')]];
			$item_des=$row[csf('product_name_details')];
			$order_number=$po_number_arr[$trans_po_id_arr[$row[csf('trans_id')]]];
			$order_id=$trans_po_id_arr[$row[csf('trans_id')]];					
		}
		else if($basis==19)//Trims Transfer data //pending work
		{
			$garment_item_data=$row[csf('item_category')];
			$garment_item_uom=$row[csf('uom')];
			//$item_des=$product_arr[$row[csf('from_prod_id')]];
			$item_des=$row[csf('product_name_details')];
			//echo $row[csf('mst_id')]."--".$trans_po_id_arr[$row[csf('mst_id')]]."--".$po_number_arr[$trans_po_id_arr[$row[csf('mst_id')]]];
			$order_number=$po_number_arr[$row[csf('job_id')]];
			$order_id=$trans_po_id_arr[$row[csf('job_id')]];
		}
		else if($basis==20)//Dyes and Chemical Transfer data 
		{
			$garment_item_data=$row[csf('item_category')];
			$garment_item_uom=$row[csf('uom')];
			//$item_des=$product_arr[$row[csf('from_prod_id')]];
			$item_des=$row[csf('product_name_details')];
			$order_number=$po_number_arr[$trans_po_id_arr[$row[csf('trans_id')]]];
			$order_id=$trans_po_id_arr[$row[csf('trans_id')]];
		}
		else if($basis==22 || $basis==30)//Dyes and Chemical Transfer data 
		{
			$item_des=$body_part[$row[csf('body_part_id')]].','.$composition_arr[$row[csf('febric_description_id')]].','.$row[csf('gsm')].','.$row[csf('width')].','.$color_arr[$row[csf('color_id')]];
			$garment_item_data=13;
			$garment_item_uom=$row[csf('uom')];
			$order_number=$po_number_arr[$row[csf('order_id')]];
			$order_id=$row[csf('order_id')];
		}
		else if($basis==58)// Grey issue to process
		{
			$item_des=$body_part[$row[csf('body_part_id')]].','.$composition_arr[$row[csf('febric_description_id')]].','.$row[csf('gsm')].','.$row[csf('width')].','.$color_arr[$row[csf('color_id')]];

			$garment_item_data=13;
			$garment_item_uom=12;
			$order_number=$po_number_arr[$row[csf('order_id')]];
			$order_id=$row[csf('order_id')];
		}
		else if($basis==12)
		{
			$garment_item_data=30;
			$garment_item_uom=1;
		}
		else if($basis==13 || $basis==55 || $basis==62 || $basis==65) //Embelishment
		{
			//$garment_item_data=25;
			//$garment_item_uom=1;
			$garment_item_uom=1;
		}		
		else if($basis==53)//Challan Emblish
		{
			$item_des=$garments_item[$row[csf('item_number_id')]];
			$order_number=$po_number_arr[$row[csf('order_id')]];
			$order_id=$row[csf('order_id')];
			$garment_item_uom=1;
			//$garment_item_data="28,30";				
		}
		else if($basis==14) //Cutting Delivery 
		{
			$garment_item_data=28;
			$garment_item_uom=1;
		}
		else if($basis==23 || $basis==24 || $basis==25 || $basis==37) //Trims Recv Ret.
		{
			$order_number=rtrim($order_number_arr[$row[csf('trans_id')]],',');
			$order_number=implode(",",array_unique(explode(",",$order_number)));			
			$item_des=$row[csf('product_name_details')];
			$garment_item_data=$row[csf('item_category')];
			$garment_item_uom=$row[csf('unit_of_measure')];			
		}
		else if($basis==26) //SubCon Material Return
		{
			$order_number=$subcon_po_number_arr[$row[csf('order_id')]];
			$order_number=implode(",",array_unique(explode(",",$order_number)));			
			$item_des=$row[csf('product_name_details')];
			$garment_item_data=$row[csf('item_category')];
			$garment_item_uom=$row[csf('unit_of_measure')];	
			$row[csf('no_of_bags')]=$row[csf('subcon_roll')];			
		}
		else if($basis==64) //SubCon Material Receive Return
		{
			$item_des=$row[csf('product_name_details')];
			$garment_item_data=$row[csf('item_category')];
			$garment_item_uom=$row[csf('unit_of_measure')];	
			$row[csf('no_of_bags')]=$row[csf('subcon_roll')];			
		}
		else if($basis==3) //Grey Fab Roll Issue
		{
			$order_number=$order_number;	
			$order_id=$order_id;	
			//echo $order_number.'='.$order_id.',';
			$item_des=$row[csf('product_name_details')];
			$garment_item_data=$row[csf('item_category')];
			$garment_item_uom=$row[csf('unit_of_measure')];	
			$row[csf('no_of_bags')]=$no_of_roll;
			$sys_number_id = $row[csf('sys_number_id')];
		}
		else if($basis==28) //Sample Delivery
		{
			$delivery_basis=$row[csf('delivery_basis')];
			$delivery_basis=$row[csf('delivery_basis')];
			if($delivery_basis==2)
			{
				$order_number=$po_number_arr[$row[csf('sample_development_id')]];
				$order_id=$row[csf('sample_development_id')];	
					
			} 
			$garment_item_data=30;
			$garment_item_uom=1;
			$sample_name=$sample_name_arr[$row[csf('sample_name')]];
			$item_des=$garments_item[$row[csf('gmts_item_id')]];
		}
		else if($basis==57) //Sample Delivery To MKT
		{
			$garment_item_data=30;
			$garment_item_uom=1;
			$sample_name=$sample_name_arr[$row[csf('sample_name')]];
			$item_des=$garments_item[$row[csf('gmts_item_id')]];
		}
		else if($basis==34)//Finish fabric Transfer data
		{
			$garment_item_data=2;
			$garment_item_uom=12;
			//$item_des=$product_arr[$row[csf('from_prod_id')]];
			$item_des=$row[csf('product_name_details')];
		}
		else if($basis==35)//Scrap sales
		{
			$garment_item_data=$row[csf('item_category')];
			$garment_item_uom=$row[csf('rej_uom')];
			$productNameArr=return_library_array("select id, product_name_details from product_details_master", "id", "product_name_details");
			$item_des=$productNameArr[$row[csf('prod_id')]];
		}
		else if($basis==60) //Sample Delivery
		{
			$garment_item_data=30;
			$garment_item_uom=1;
			$sample_name=$sample_name_arr[$row[csf('sample_name')]];
			$item_des=$garments_item[$row[csf('item_number_id')]];
		}
		else if($basis==61) //Wash Dyes Chemical Issue
		{
			$garment_item_data=$row[csf('item_category_id')];
			$garment_item_uom=$row[csf('unit_of_measure')];
			$item_des=$row[csf('item_description')];
		}
		else if($basis==7)
		{
			$item_des=$row[csf('product_name_details')];
			$garment_item_data=$row[csf('item_category')];
			$garment_item_uom=$row[csf('unit_of_measure')];
			//$order_number=$order_number_arr[$row[csf('transaction_type')]];
			$order_number=rtrim($order_numbers_arr[$row[csf('id')]],',');
		}
		else if($basis==66)//Left Over Garments Issue
		{
			$item_des=$garments_item[$row[csf('item_number_id')]];
			$order_number=$row[csf('order_no')];	
			$order_id=$row[csf('order_id')];
			$garment_item_uom=1;
			$garment_item_data=30;		
		}
		else
		{
		 	$item_des=$row[csf('product_name_details')];
			$garment_item_data=$row[csf('item_category')];
			$garment_item_uom=$row[csf('unit_of_measure')];
		}

		//gate_enable_disable(1)gate_enable_disable(2)
		//echo $garment_item_data.'='.$garment_item_uom;			
		?>
        <input type="hidden" name="txtuomqty_<? //echo $tbl_row; ?>" id="txtuomqty_<? echo $tbl_row; ?>" class="text_boxes" value="<? //echo $row[csf('cons_quantity')];?>" style="width:60px;">
        
		<tr class="" id="tr_<? echo $tbl_row; ?>">
            <td>
            	<?				
				if ($basis==13 || $basis==49 || $basis==53 || $basis==55 || $basis==59 || $basis==62 )
				{ 
            		echo create_drop_down( "cboitemcategory_".$tbl_row, 120,$item_category,"",1, "-- Select --","28", "","","28,30"); 
				}
                else if ($basis==65 )
                {
                    echo create_drop_down( "cboitemcategory_".$tbl_row, 120,$item_category,"",1, "-- Select --","30", "","","28,30");
                }
				else if ($basis==56) 
				{ 
            		echo create_drop_down( "cboitemcategory_".$tbl_row, 120,$item_category,"",1, "-- Select --","30", "",1,"30"); 
				}
				else if ($basis==14) 
				{ 
            		echo create_drop_down( "cboitemcategory_".$tbl_row, 120,$item_category,"",1, "-- Select --","28", "",1,"28"); 
				}
				else if ($basis==22) 
				{ 
            		echo create_drop_down( "cboitemcategory_".$tbl_row, 120,$item_category,"",1, "-- Select --","12", "",1,"12"); 
				}
				else
				{ 
					echo create_drop_down( "cboitemcategory_".$tbl_row, 120,$item_category,"",1, "-- Select --",$garment_item_data , "",1 ); 
				}
            	//For Embellisment Issue   //|| $basis==3 
            	if ($basis==13 || $basis==2 || $basis==22 || $basis==28 || $basis==57 || $basis==4 || $basis==8 || $basis==11 || $basis==55 || $basis==62 || $basis==65 || $basis==50 || $basis==66)
            	{
            		?>
            		<input type="hidden" name="challanIds_<? echo $tbl_row; ?>" id="challanIds_<? echo $tbl_row; ?>" value="<? echo $row[csf('id')];?>">
            		<? 
            	}
				else if($basis==21 || $basis==23 || $basis==24 || $basis==25 || $basis==37 || $basis==60)
				{
					?>
					<input type="hidden" name="challanIds_<? echo $tbl_row; ?>" id="challanIds_<? echo $tbl_row; ?>" value="<? echo $row[csf('issue_id')];?>">
					<?
				}
				else if($basis==58 || $basis==17)
				{
					?>
					<input type="hidden" name="challanIds_<? echo $tbl_row; ?>" id="challanIds_<? echo $tbl_row; ?>" value="<? echo $row[csf('mst_id')];?>">
					<?
				}
				else
				{
					?>
            		<input type="hidden" name="challanIds_<? echo $tbl_row; ?>" id="challanIds_<? echo $tbl_row; ?>" value="">
            		<? 
            	} 
            	?>                
                <input type="hidden" name="challandtlsIds_<? echo $tbl_row; ?>" id="challandtlsIds_<? echo $tbl_row; ?>" value="<? echo $row[csf('dtls_id')];?>">
            </td>
            <td><? echo create_drop_down( "cbosample_".$tbl_row, 120, "select id,sample_name from lib_sample where status_active=1 order by sample_name","id,sample_name",1, "-- Select --", $row[csf('sample_name')],"",1 ); ?></td>

            <td>
            <input type="text" name="txtitemdescription_<? echo $tbl_row; ?>" id="txtitemdescription_<? echo $tbl_row; ?>" class="text_boxes" style="width:180px;" value="<? echo $item_des;?>" disabled >
            <input type="hidden" name="prodID_<? echo $tbl_row; ?>" id="prodID_<? echo $tbl_row; ?>" value="<? echo $row[csf('prod_id')];?>">
            </td>

            <td><input type="text" name="txtquantity_<? echo $tbl_row; ?>" id="txtquantity_<? echo $tbl_row; ?>" class="text_boxes_numeric" disabled onKeyUp="fn_calculate_amount()"   value="<? echo $row[csf('cons_quantity')];?>" style="width:60px;"></td>

            <td><input type="text" name="txtrejectqty_<? echo $tbl_row; ?>" id="txtrejectqty_<? echo $tbl_row; ?>" class="text_boxes_numeric" style="width:60px;" disabled value="<? echo $delivery_reject_qty; ?>"></td>

            <td><? echo create_drop_down( "cbouom_".$tbl_row, 60, $unit_of_measurement,"", 1, "-- Select--", $garment_item_uom, "",1 ); ?></td>

            <td><input type="text" name="txtrate_<? echo $tbl_row; ?>" id="txtrate_<? echo $tbl_row; ?>" class="text_boxes_numeric" onKeyUp="fn_calculate_amount()"  value="<? echo $row[csf('cons_rate')];?>" style="width:70px" disabled></td>

            <td><input type="text" name="txtamount_<? echo $tbl_row; ?>" id="txtamount_<? echo $tbl_row; ?>" class="text_boxes_numeric" style="width:80px"  value="<? echo $row[csf('cons_amount')];?>" randomly disabled></td>
		
			<td><input type="text" name="txtbag_<? echo $tbl_row; ?>" id="txtbag_<? echo $tbl_row; ?>" class="text_boxes_numeric" onKeyUp="fn_calculate_amount()"  value="<? echo $row[csf('no_of_bags')]; ?>" style="width:70px" ></td>

			<td><input type="text" name="txtcartonqnty_<? echo $tbl_row; ?>" id="txtcartonqnty_<? echo $tbl_row; ?>" class="text_boxes_numeric"   value="<? echo $row[csf('total_carton_qnty')];?>" style="width:70px" <? if ($basis==12 || $basis==66) echo ""; else 'disabled=disabled'; ?>></td>

            <td><input type="text" name="txtorder_<? echo $tbl_row; ?>" id="txtorder_<? echo $tbl_row; ?>" class="text_boxes" style="width:80px"   onDblClick="openmypage_order(this.id);"  value="<? echo $order_number;?>" readonly disabled>
            <input type="hidden" name="txtorderidhidden_<? echo $tbl_row; ?>" id="txtorderidhidden_<? echo $tbl_row; ?>" class="text_boxes" style="width:80px"  value="<? echo $order_id;?>" readonly disabled>
            </td>
            <?php
            	if($basis==3)
            	{
            ?>
            <td>
            	<input type="text" name="systemid_<? echo $tbl_row; ?>" id="systemid_<? echo $tbl_row; ?>" class="text_boxes" style="width:120px" value="<? echo $sys_number_id;?>" readonly disabled>
                
                <input type="hidden" name="hiddenissalesflag_<? echo $tbl_row; ?>" id="hiddenissalesflag_<? echo $tbl_row; ?>" class="text_boxes" style="width:120px" value="<? echo $is_sales;?>" readonly disabled>
            </td>
            <?php
            	}
            ?>
            <td><input type="text" name="txtremarks_<? echo $tbl_row; ?>" id="txtremarks_<? echo $tbl_row; ?>" class="text_boxes" style="width:100px"    value="<? echo $row[csf('remarks')];?>">
            <input type="hidden" id="updatedtlsid_<? echo $tbl_row; ?>" name="updatedtlsid_<? echo $tbl_row; ?>"  value="<? echo $row[csf('product_name_details')];?>" /><input type="hidden" name="hiderow_<? echo $tbl_row; ?>" id="hiderow_<? echo $tbl_row; ?>" class="text_boxes" value="0" style="width:70px;" />
            </td>

            <td>
            <?
            if($basis==1)
			{
				?>
            	<input type="button" id="increase_<? echo $tbl_row; ?>" style="width:25px;" class="formbutton" value="+" onClick="add_break_down_tr(<? echo $tbl_row;?>)" />
                <input type="button" id="decrease_<? echo $tbl_row; ?>" style="width:25px;" class="formbutton" value="-" onClick="javascript:fn_deletebreak_down_tr(<? echo $tbl_row; ?>,'tbl_order_details');" />
                <?
			}
			?>
            </td>
		</tr>
		<?php
		$i++;
	}

	if ($basis==50)
	{
		if (count($garment_item_uom_check_arr)==1)
		{
			?>
			<tr style="background-color:#ddd;" id="total_display_last_tr">
				<td width="120"></td>
				<td width="120"></td>
				<td width="180" align="right"><strong>Total:</strong></td>
				<td width="60" align="right"><strong><? echo $total_quantity; ?></strong></td>
				<td width="60"></td>
				<td width="60"></td>
				<td width="70"></td>
				<td width="80"></td>
				<td width="70"></td>
				<td width="70"></td>
				<td width="80"></td>
				<td width="100"></td>
			</tr>
			<?
		}
	}
	echo "&nbsp;";die;
	exit();
} 

if($action=="print_to_html_report")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	// print_r ($data);// die;
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[2];
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");


	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
	
	$sql="SELECT id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to,vhicle_number, out_date, challan_no, driver_name, security_lock_no, driver_license_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,com_location_id,remarks,mobile_no,returnable_gate_pass_reff,delivery_company,issue_id from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 "; 
	//echo $sql;
	$dataArray=sql_select($sql);
	// echo"<pre>";
	// print_r($dataArray);

	$gate_id=$dataArray[0][csf('id')];
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
 	$sent_to=$dataArray[0][csf('sent_to')];
 	$issue_id=$dataArray[0][csf('issue_id')];
	$shipmode_cartoon=sql_select("select  b.total_carton_qnty,b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no'") ;

	$shipmodes=sql_select("select a.lock_no, a.dl_no, b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no' and (b.shiping_mode is not null or b.shiping_mode!=0) ") ;
	// echo "<pre>";
	// print_r($shipmodes);die;
	$pro_ex_factory_delivery_mst_id_sql="SELECT a.id FROM pro_ex_factory_delivery_mst a WHERE a.status_active = 1 AND a.is_deleted = 0 AND a.sys_number = '$challan_no' ";
	$sql_pro_ex_factory_delivery_mst_id=sql_select($pro_ex_factory_delivery_mst_id_sql);

	$pro_ex_factory_delivery_mst_id=$sql_pro_ex_factory_delivery_mst_id[0][csf('id')];

    // echo $pro_ex_factory_delivery_mst_id;
    $additional_sql="SELECT  additional_info_id from PRO_EX_FACTORY_MST where delivery_mst_id='$pro_ex_factory_delivery_mst_id' order by id asc ";
	// echo $additional_sql;
	$additional_arr=array();
	$kk=0;
	$add_data="";
	foreach(sql_select($additional_sql) as $vals)
	{
		if($kk==0)
		{
			if($vals[csf("additional_info_id")])
			{
				$add_data.=$vals[csf("additional_info_id")];
				$kk++;
			}
		}
	}
	//echo "string $add_data";
	$add_data=explode("___", $add_data);
	$truck_type=$truck_type_arr[$add_data[0]];
	$trans_type=$transport_type_arr[$add_data[1]];
	$sizes=$add_data[2];
	$chassis_no=$add_data[3];
	$courier_name=$add_data[4];
	$cbm=$add_data[5];

	if($basis==5 or $basis==1 or $basis==7 or $basis==38)
    {
		$sql_dtls="select a.id, a.item_category_id, a.sample_id, a.item_description, a.uom_qty, a.quantity, a.uom, rate, a.amount, a.buyer_order_id, a.buyer_order, a.remarks, a.no_of_bags from inv_gate_pass_dtls a where a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 order by a.uom,a.id";

		$sql_sel=sql_select($sql_dtls);
	}
	else
	{
		$sql_dtls="select a.id, a.item_category_id, a.sample_id, a.item_description, a.uom_qty, a.quantity, a.uom, rate, a.amount, a.buyer_order_id, a.buyer_order, a.remarks, a.no_of_bags, b.issue_id from inv_gate_pass_dtls a, inv_gate_pass_mst b where b.id=a.mst_id and a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
		//echo $sql_dtls;
		
		$sql_result=sql_select($sql_dtls);
		
	}
	$buyer_order_id=array();
	foreach ($sql_result as $value)
	{
		if($buyer_order_id[$value[csf("buyer_order_id")]] != $value[csf("buyer_order_id")])
		{	
			$buyer_order_id[$value[csf("buyer_order_id")]] = $value[csf("buyer_order_id")];
		}
	}
	$buyer_order_ids= implode(",", $buyer_order_id);
 
	if($basis==1)
	{ 
		if($within_group==1)
		{
			//$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
		else
		{
			//$send_to_company=$dataArray[0][csf('sent_to')];		
		}
	}
	else if($basis==8 || $basis==9 || $basis==27)
	{
		//$send_to_company=$dataArray[0][csf('sent_to')];	
		$sql_no_of_roll = "select a.id,b.carton_roll as no_roll,b.reject_qty,b.total_carton_qnty,b.id as dtls_id from subcon_delivery_mst a ,subcon_delivery_dtls b where a.id=b.mst_id  and a.delivery_no='$challan_no' and a.status_active=1 and a.is_deleted=0  and a.process_id in(2,4,3) and b.order_id in( $buyer_order_ids)";
		//echo $sql_no_of_roll;//die;
		$no_of_rolls = sql_select($sql_no_of_roll);
		if($basis==8)
		{
			$buyer_orderIDs="";
			foreach($sql_result as $row)
			{
			  $buyer_orderIDs.="'".$row[csf('buyer_order')]."',";
			}
			$buyer_orderID=chop($buyer_orderIDs,',');
			
			$sql_subcon_order_buyer=sql_select("select order_no,cust_buyer from subcon_ord_dtls where order_no in($buyer_orderID) and status_active=1 and is_deleted=0");
			foreach($sql_subcon_order_buyer as $row)
			{
			  $subcon_buyer_arr[$row[csf('order_no')]]['cust_buyer']=$row[csf('cust_buyer')];
			}
		}
		if($basis==9) //SubCon Dyeing And Finishing Delivery
		{
			$sql_subcon_order_buyer=sql_select("SELECT a.party_id as PARTY_ID, b.order_id as ORDER_ID from subcon_delivery_mst a,subcon_delivery_dtls b where a.id=b.mst_id and a.id in($issue_id) and b.order_id in($$buyer_order_ids) and a.status_active=1 and b.status_active=1 ");
			foreach($sql_subcon_order_buyer as $row)
			{
				$subcon_buyer_arr[$row['ORDER_ID']]['buyer_name']=$buyer_library[$row['PARTY_ID']];
			}
		}
				
	}
	else if($basis==17)
	{
		$no_of_rolls=sql_select("select b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty as cons_quantity,
		b.yarn_lot,b.rate as cons_rate,b.transfer_value as cons_amount,b.brand_id,c.product_name_details,d.no_of_bags,b.roll as no_roll from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c,inv_transaction d 
		where a.id=b.mst_id and c.id=b.from_prod_id and b.from_prod_id=d.prod_id and a.transfer_system_id='$challan_no' and b.item_category=13 
		and b.status_active = '1' and b.is_deleted = '0' and d.no_of_bags is not NULL
		group by  b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty,
		b.yarn_lot,b.rate,b.transfer_value ,b.brand_id,c.product_name_details,d.no_of_bags ,b.roll ");
	}
	else if($basis==11)
	{
		$no_of_rolls=sql_select("select a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity,b.batch_id,roll as no_roll
		from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
		where a.sys_number='$challan_no' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form=54 and b.entry_form=54");
	}
	else if($basis==12)
	{
		//$send_to_company=$supplier_name_library[$dataArray[0][csf('sent_to')]];
	}
	else if($basis==10)
	{
		$no_of_rolls=sql_select("select a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity,b.roll as no_roll
				from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
				where a.sys_number='$challan_no' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.entry_form=53 and b.entry_form=53");
	}
	else if($basis==15) //Finish Fabric Recv Return
	{
		//echo $mst_challan;
		
		 $no_of_rolls =sql_select("select a.id as issue_id, a.item_category, a.received_id, a.received_mrr_no, b.id as trans_id, b.cons_quantity as cons_quantity,b.cons_uom, b.cons_rate, b.cons_amount, c.product_name_details, c.id as prod_id  ,b.no_of_roll as no_roll 
			from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id
			where a.id=b.mst_id and b.item_category=2 and b.transaction_type=3 and  a.issue_number='$challan_no' order by b.id");
		   
	}
	else if($basis==4)
	{
		$no_of_rolls = sql_select("select a.id,a.transaction_type,a.item_category,b.product_name_details,a.cons_rate,a.cons_quantity,a.cons_uom ,a.cons_amount,a.remarks,b.unit_of_measure ,c.no_of_roll as no_roll 
		from inv_transaction a, product_details_master b,inv_finish_fabric_issue_dtls c ,inv_issue_master d,inv_gate_pass_mst e  
		where a.prod_id=b.id and d.id=a.mst_id  and d.id=c.mst_id and a.id=c.trans_id and d.id=e.issue_id and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.issue_number='$challan_no'"); 
 	}
 	else if($basis==22)
	{
		$no_of_rolls = sql_select("select b.roll_no as no_roll 
		from inv_receive_mas_batchroll a,pro_grey_batch_dtls b 
		where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.recv_number='$challan_no'"); 
 	}
 	else if($basis==54)
	{
		$booking_id_arr=array();
		$sales_order_array=array();
		$sql_fabric_sales_order_buyer=sql_select("select a.id, a.within_group, a.buyer_id, a.style_ref_no as style_ref_no, a.booking_id from fabric_sales_order_mst a where a.entry_form=109 and a.status_active=1 and a.is_deleted=0 and a.id in($buyer_order_ids)");
		foreach($sql_fabric_sales_order_buyer as $row)
		{
			if ($row[csf('within_group')]==1)
			{
				$booking_id.=$row[csf('booking_id')].',';
				$booking_id_arr[$row[csf('booking_id')]]=$row[csf('id')];
			}
			else
			{
				$sales_order_array[$row[csf('id')]]['buyer_name']=$buyer_library[$row[csf('buyer_id')]];
			}		
		}

		$booking_ids=rtrim($booking_id,',');
		if ($booking_ids != ""){
			$sql_booking=sql_select("select id, buyer_id from wo_booking_mst where status_active=1 and is_deleted=0 and id in($booking_ids)");
			foreach ($sql_booking as $row) {
				$sales_order_array[$booking_id_arr[$row[csf('id')]]]['buyer_name']=$buyer_library[$row[csf('buyer_id')]];
			}
		} 
 	}
	else
	{
		//echo $within_group.'=='.$basis;
		/*if($basis==2 || $basis==3 || $basis==4 || $basis==5 || $basis==6 || $basis==7  ||  $basis==10 || $basis==13 ||  $basis==14 ||  $basis==11 ||  $basis==15)
		{
			if($within_group==2)
			{
				$send_to_company=$dataArray[0][csf('sent_to')];
			}
			else
			{
				$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
			}
		}
		else
		{
				$send_to_company=$dataArray[0][csf('sent_to')];	
		}*/
		//$send_to_company=$dataArray[0][csf('sent_to')];
	}
	
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.id=b.job_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	if($show_item==1)
	{
		$width=1250;
		//$colspan=5;
	}
	else
	{
		$width=1250;
		//$colspan=5;
		$colspan2=2;
	}
	$com_dtls = fnc_company_location_address($company, $location, 2);
	?>
	<!-- <style type="text/css">
		@media print{
			#signature_bottom{ 
				position:fixed; 
				bottom:-30px;
			}
			tr.page_break { 
				/* display: block; */ 
				page-break-before: always; }
			/*#table_row{
				position: relative;
				bottom: 0;
				height: 1180px!important;
				  overflow:hidden;
			}*/
		}

		@media screen{
		
		}
	</style> -->
	<div style="width:<? echo $width;?>px;" align="center"><!-- border: 1px solid #F00; -->
    <table width="<? echo $width;?>" cellspacing="0" align="center" border="0">
        <tr>
          <tr>
            <td  align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="70" width="200"></td>
            <td colspan="7" align="center"  style="font-size:xx-large;"><strong style="margin-left:100px" ><? echo $com_dtls[0]; ?></strong>
             <div style="float:right;width:34%; text-align:right">
               	&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
            </div>
            </td>
        </tr>
        <tr class="form_caption">
            <td colspan="8" align="center">
				<?
				echo $com_dtls[1];
				//$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
					//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
					/*foreach ($nameArray as $result)
					{ 
						echo $result[csf('plot_no')]; 
						echo $result[csf('level_no')];
						echo $result[csf('road_no')];
						echo $result[csf('block_no')];
						echo $result[csf('city')];
						echo $result[csf('zip_code')];
						echo $result[csf('province')].',';
						echo $country_arr[$result[csf('country_id')]]; 
						echo $result[csf('email')]; 
						echo $result[csf('website')];
					}*/
                ?> 
                <div style="width:34%; text-align:center">
               	&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
            </div>
            </td>
        </tr>
        <tr>
        	<td style="display:none" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
        </tr>
        <tr>
            <td colspan="8" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
        </tr>
        <tr>
            <td width="160"><strong>System ID</strong></td>
			<td width="175px" style="font-size:20px">: <b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
            <td width="120"><strong>Basis</strong></td>
			<td width="175px" >: <? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
            <td><strong>Department</strong></td> <td width="175px">: <? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
        </tr>
		<tr>
			<td width="125"><strong>Challan/System No</strong></td>
			<td colspan="5">: <? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
		</tr>
         <tr>
            <td><strong>Attention</strong></td><td width="175px" >: <? echo $dataArray[0][csf('attention')]; ?></td>
            
            <td><strong>Section</strong></td><td width="175px" >: <? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
            <td><strong>Sent By</strong></td> <td width="175px">: <? echo $dataArray[0][csf('sent_by')]; ?></td>
        </tr>
        <tr>
            <td><strong>Sent To</strong></td><td width="175px" style="font-size:18px">: <b><? echo $send_to_company; ?></b></td>
            <td><strong>Out-Time</strong></td><td width="85px" >: <? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
            <td><strong>Out Date</strong></td><td width="175px" colspan="2">: <? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
        </tr>
        <tr>
        	<td><strong>Purpose</strong></td><td>: <? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
            
            <td><strong>Returnable </strong></td><td width="175px">: <? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
            <td><strong>Delivery As</strong></td><td width="175px">: <? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
        </tr>
         <tr>
            <td><strong>Est. Return Date</strong></td><td width="175px">: <? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
            <td><strong>Carried By</strong></td><td>: <? echo $dataArray[0][csf('carried_by')]; ?></td>
            <td><strong>Vehicle Number</strong></td><td>: <? echo $dataArray[0][csf('vhicle_number')]; ?></td>
            
        </tr>
        <tr>
			<td><strong>Against Returnable Gate Pass</strong></td>
			<td>: <?  echo $dataArray[0][csf("returnable_gate_pass_reff")]; ?></td>
           	<td><strong>To Location</strong></td><td>: <?  if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
           	<td><strong>Bar Code</strong></td><td  colspan="2" id="barcode_img_id"></td> 
        </tr>
        <? if ($basis==12)
        {
        	?>
        	<tr>
				<td> <strong> Shipping Mode </strong></td>
				<td align="left">: <?  echo $shipment_mode[$shipmodes[0][csf("shiping_mode")]]; ?> </td>
				<!-- <td> <strong> Lock number </strong></td>
				<td colspan="4" align="left">: <?  //echo $shipmodes[0][csf("lock_no")]; ?> </td> -->
			</tr>
	
       <? }?>
       
		<tr>
			<td><strong>Driver Name</strong></td>
			<td  align="left">: <?  echo $dataArray[0][csf("driver_name")]; ?> </td>
         <td><strong>DL No</strong></td>
          	<td>: <?
          	/*if ($basis==1) {
          		$dl_no=$dataArray[0][csf("driver_license_no")];
          	}else{
          	  	$dl_no=$shipmodes[0][csf("dl_no")];
          	  } */
          	 echo $dataArray[0][csf("driver_license_no")]; ?></td>
          	
          
		  <td><strong>Security Lock No</strong></td>
			<td colspan="3">: <?  echo $dataArray[0][csf("security_lock_no")]; ?>  </td>
        </tr>
        <tr>
         <td><strong>Delivery Company</strong></td>
          	<td>: <?  echo $dataArray[0][csf("delivery_company")]; ?> </td>
          <td><strong>Mobile No</strong></td>
          <td align="left">: <?  echo $dataArray[0][csf("mobile_no")]; ?> </td>
          <td><strong>Chassis No</strong></td>
          <td colspan="3" align="left">: <? echo $chassis_no; ?></td>
		  	
        </tr> 
        <tr>
        	<td><strong>Remarks</strong></td>
			<td colspan="3" align="left">: <?  echo $dataArray[0][csf("remarks")]; ?> </td>
        </tr>
    </table>
    <br>
    <? if($basis==5 or $basis==1 or $basis==7 or $basis==38 or $basis==18)
    {
    	?>
	    <table align="center" cellspacing="0" width="<? echo $width;?>"  border="1" rules="all" class="rpt_table" >
	        <thead bgcolor="#dddddd" align="center">
	            <th width="30">SL</th>
	            <th width="150" align="center">Item Category</th>
	            <th width="100" align="center">Sample</th>
	            <th width="220" align="center">Item Description</th>
	            <th width="50" align="center">UOM</th>
	            <th width="80" align="center">Quantity</th>
	            <? if($basis==1 || $basis==12)
	            {
					?>
					<th width="60" align="center">No Of Carton </th>
					<?
	            }
	            else
	            {
					?>
					<!-- <th width="60" align="center">No Of Roll </th> -->
					<?
	             }
	             ?>
	            <th width="60" align="center">No Of Bag/Roll/GMT </th>
	            <?
	            if($show_item==1)
				{
					?>
					<th width="60" align="center">Rate</th> 
					<th width="90" align="center">Amount </th>
					<?
				}
				?>
				<th width="100" align="center">Buyer</th>
	            <th width="150" align="center">Buyer Order </th>
	            <th align="center">Remarks</th>
	        </thead>
		<?
	    $i=1;
		$gate_id=$dataArray[0][csf('id')];
		$sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity,a.total_carton_qty, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags from  inv_gate_pass_dtls a where a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 order by a.uom,a.id ";

		$sql_sel=sql_select($sql_dtls);
		foreach($sql_sel as $values)
		{
			$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['qty']+=$values[csf("quantity")];

			$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['item_category_id']=$values[csf("item_category_id")];

			$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['sample_id']=$values[csf("sample_id")];

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['item_description']=$values[csf("item_description")];


				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['quantity']+=$values[csf("quantity")];

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['amount']+=$values[csf("amount")];

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['rate']+=$values[csf("rate")];

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['buyer_order_id'].=$values[csf("buyer_order_id")].",";

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['buyer_order'].=$values[csf("buyer_order")].",";

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['remarks']=$values[csf("remarks")];

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['no_of_bags']+=$values[csf("no_of_bags")];
				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['total_carton_qty']+=$values[csf("total_carton_qty")];
		}
       	//echo "<pre>";print_r($general_item_arr);die;
        $row_span_arr=array();

        foreach($general_item_arr as $key=>$value)
        {

            $row_span=0;
            foreach($value as $item_description_id=>$row)
            {
                $row_span++;
            }

            $row_span_arr[$key]=$row_span;
        }


        $i=1;
        foreach($general_item_arr as $key=>$value)
        {
            $j=0;
            foreach($value as $item_description_id=>$row)
            {
				if($i==27){ $pagebreak = " class='page_break'";} else{ $pagebreak = "";}

				$buyer=$order_array[$row['buyer_order_id']]['buyer_name'];
            	?>

            	<tr <?= $pagebreak;?>>
					<td width="40" align="center"><? echo $i;$i++; ?></td>
					<td><?  echo $item_category[$row["item_category_id"]]; ?></td>
					<td><?  echo $sample_library_arr[$row["sample_id"]]; ?></td>
					<td><?  echo $row['item_description']; ?></td>
					<? if($j==0)
					{
						?>
						<td width="40" rowspan="<? echo $row_span_arr[$key]?>" align="center"><? echo $unit_of_measurement[$key]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($row['quantity'],2,'.',''); ?></td>  
					<?
					if ($basis==1) {
						?>
							<td align="right"><? echo number_format($row['total_carton_qty'],2,'.',''); ?></td>
						<?
					}else{
						?>
						    <!-- <td align="right">&nbsp;</td> -->
						<?
					}
					?>

						<td align="right"><? echo $row['no_of_bags']; ?></td>

	         		
	             	<?
					if($show_item==1)
					{
						?> 
	                    <td align="right"><? $rate=$row['amount']/$row['quantity']; echo number_format($rate,2,'.',''); ?></td>
	                    <td align="right"><? echo number_format($row['amount'],2,'.',''); ?></td>
	                    <?
					}
					?>
					<td><? echo $buyer_library[$buyer]; ?></td>
	                <td style="word-break:break-all;"><? echo implode(",",array_unique(explode(",",chop($row['buyer_order'],",")))); ?></td>
	                <td><? echo $row['remarks']; ?></td>


					<?
	         
					$j++;
					$total+=$row[("qty")];
					$gr_total+=$row[("qty")];
					$tot_qty +=$row['quantity'];
					$tot_bags +=$row['no_of_bags'];
					$subtotAmount +=$row['amount'];
					$totAmount +=$row['amount'];
					$totCartonQty +=$row['total_carton_qty'];
         	}
         	?>
        	<tr>
	            <td colspan="5" align="right"><b>Sub Total</b></td>
	            <td align="right">  <b><? echo number_format($total,2); $total=0; ?></b></td>
	            <?
				if($show_item==1)
				{
					?>
	                 <td colspan="3"></td>
	                 <td align="right"><b><? echo number_format($subtotAmount,2); $subtotAmount=0; ?></b></td>
	            	<?
	            }
	            ?>
        	</tr>
          <?
    	}
    	?>

        <tfoot bgcolor="#CCCCCC">
	        <tr>
		        <td colspan="5" align="right"> <b> Total</b></td>
		        <td align="right"><b><? echo number_format($tot_qty,2);?></b></td> 
		        <td align="right"><b><? echo number_format($totCartonQty,2);?></b></td> 
		        <td align="right"><b><? echo number_format($tot_bags,2);?></b></td>
		        <?
				if($show_item==1)
				{
				?>      
		        <td align="right"><b><? echo  $tot_roll;?></b></td>    
		        <?
				}
				else
				{  
					//echo "<td></td>" ;
				}
				?>

				
		          <?
				if($show_item==1)
				{
				?>      
		         
		        <td align="right"><b><? echo number_format($totAmount,2); ?></b></td>    
		        <?
				}
				
				?>
		        
		        <td align="right"> </td>
		        <td colspan="<? echo 4+$colspan2;?>"></td>
	        </tr>
		</tfoot>
	    <?
	            
		//echo $sql_dtls;
		$uom_check=array();
		$sql_result=sql_select($sql_dtls);
		$tot_qty=0; $tot_amount=0; $tot_amount=0;
		$p=0;
		
		//$tot_check=array();
		if(count($uom_check)==1)
		{
			?>
		   
		    <?
		}
		 $width_sign=$width.'px';
		?>
    	</table>
    	<?
    }
    else 
    {
    	?>
	    <table align="center" cellspacing="0" width="<? echo $width;?>"  border="1" rules="all" class="rpt_table" >
	        <thead bgcolor="#dddddd" align="center">
	            <th width="30">SL</th>
	            <th width="100" align="center">Item Category</th>
	            <th width="100" align="center">Sample</th>
	            <th width="220" align="center">Item Description</th>
	            <th width="50" align="center">UOM</th>
	            <th width="80" align="center">Quantity</th>
	            
	            <? if($basis==9 || $basis==8)
	            {?>
	             <th width="100" align="center">Reject Qty</th>
		
	            <?
	            }
	            ?>
	            
	            <? if($basis==12 || $basis==27)
	            {?>
	             <th width="100" align="center">Total Carton Qty </th>
		
	            <?
	            }
	            else
	            {
	            ?>
	             <!-- <th width="100" align="center">No Of Roll </th> -->
	             <?
	             }
	             if($basis!=12 && $basis!=27)
	            {?>

	            	<th width="80" align="center">No Of Bag/Roll/GMT </th>
	            <?
 				}
	             ?>

	            <?
	            if($show_item==1)
				{
				?>
	          	<th width="50" align="center">Rate</th> 
	            <th width="80" align="center">Amount </th>
	            <?
				}
				?>
				<th width="100" align="center">Buyer</th>
	            <th width="80" align="center">Order No</th>
	            <th align="center">Remarks</th>
	        </thead>
			<?
		    $i=1;
			$gate_id=$dataArray[0][csf('id')];
			$sql_dtls= " select a.id, a.item_category_id, a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.total_carton_qty, a.amount, a.buyer_order_id, a.buyer_order, a.remarks, a.no_of_bags, b.issue_id from inv_gate_pass_dtls a,inv_gate_pass_mst b where b.id=a.mst_id and a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
			//echo $sql_dtls;
			$uom_check=array();
			$sql_result=sql_select($sql_dtls);
			$tot_qty=0; $tot_amount=0; $tot_amount=0; $noOfCarton=0;
			$tot_roll=0;
			$p=0;
			foreach($sql_result as $row)
			{
				$gatepass_data_arr[$row[csf('issue_id')]]['buyer_order']=$row[csf('buyer_order')];
				$gatepass_data_arr[$row[csf('issue_id')]]['remarks']=$row[csf('remarks')];
				if ($i%2==0)  
					$bgcolor="#E9F3FF";
				else
					$bgcolor="#FFFFFF";
					
					$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
					$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
					//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
					$uom_check[$row[csf('uom')]]=$row[csf('uom')];
					if($i==21){ $pagebreak = " class='page_break'";} else{ $pagebreak = "";}
					?>
					<tr bgcolor="<? echo $bgcolor; ?>" <?= $pagebreak; ?>>
		                <td><? echo $i; ?></td>
		                <td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
		                <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
		                <td><?  echo $row[csf('item_description')]; ?></td>
		                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
		                <td align="right"><? echo number_format($row[csf('quantity')],2,'.',''); ?></td> 
		                 <?  if($basis==9 || $basis==8)             
			                {
			                	?>
			                	<td align="right"><? echo $no_of_rolls[$p][csf("reject_qty")]; ?></td>
			                	<?
			                }
						?>
		                
		                  
		                <?  if($basis==12)             
			                {
			                	?>
			                	<td align="right"><? echo $row[csf("total_carton_qty")]; ?></td>
			                	<?
			                }
			                else if ($basis==27) {
			                	?>
			                	<td align="right"><? echo $no_of_rolls[$p][csf("total_carton_qnty")]; ?></td>
			                	<?
			                }
			                else
			                {
				                ?>
				                <!-- <td align="right"><?// if($basis==3){echo $no_of_rolls[$p][csf("no_roll")] =1; } else{echo $no_of_rolls[$p][csf("no_roll")] ;} ?></td>   -->
				                <?
			                }
		               
		                 if($basis!=12 && $basis!=27)
		           		 {?>
		                	<td align="right"><? echo $row[csf('no_of_bags')]; ?></td>
		                <?
			            }
			            ?>
		                <?
						if($show_item==1)
						{
						?>
		                <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
		                <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
		                <?
						}
						?>
						<td>
							<? 
							if($basis==8)
							{
							  echo $subcon_buyer_arr[$row[csf('buyer_order')]]['cust_buyer'];
							}
							else if ($basis==9)
							{
							  echo $subcon_buyer_arr[$row[csf('buyer_order_id')]]['buyer_name'];
							}
							else if ($basis==54){ echo $sales_order_array[$row[csf('buyer_order_id')]]['buyer_name']; }
							else{ echo $buyer_library[$buyer]; }
							?>
						</td>
		                <td><? echo $row[csf('buyer_order')]; ?></td>
		                <td><? echo $row[csf('remarks')]; ?></td>
					</tr>
				<?php
				$tot_roll +=$no_of_rolls[$p][csf("no_roll")];
				if ($basis==12) {
					$noOfCarton+=$row[csf("total_carton_qty")];
				}
				else if ($basis==27) {
					$noOfCarton+=$no_of_rolls[$p][csf("total_carton_qnty")];
				}
				else
				{
					$noOfCarton+=$shipmode_cartoon[$p][csf("total_carton_qnty")];
				}
				$noOfReject+=$no_of_rolls[$p][csf("reject_qty")];
		    	$i++;
		    	$p++;
				
				$tot_qty+=$row[csf('quantity')];		
				$tot_amount+=$row[csf('amount')];
				$tot_bags+=$row[csf('no_of_bags')];
				$subtotAmount +=$row['amount'];
		        $totAmount +=$row['amount'];
		    }
		    if($basis==8)
	    	{ 
				if($issueID !='')
	    		{
	    			$sql_result_2=sql_select("select a.id,b.delivery_qty as cons_quantity,b.item_id,b.order_id,b.batch_id,b.reject_qty,b.carton_roll,b.mst_id from subcon_delivery_mst a ,subcon_delivery_dtls b where a.id=b.mst_id and b.mst_id=$issueID and a.status_active=1 and a.is_deleted=0 and a.process_id in(2,4) and b.delivery_qty<=0 ");	
	    		}
				
				$lib_item_arr=return_library_array( "select id,const_comp from lib_subcon_charge",'id','const_comp');
				foreach($sql_result_2 as $row)
				{
					if($i==27){ $pagebreak = " class='page_break'";} else{ $pagebreak = "";}
					?>
					<tr bgcolor="<? echo $bgcolor; ?>" <?= $pagebreak; ?>>
		                <td><? echo $i; ?></td>
		                <td><?  echo $item_category[13]; ?></td>
		                <td><?  //echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
		                <td><?  echo $lib_item_arr[$row[csf('item_id')]]; ?></td>
		                <td align="center"><? echo $unit_of_measurement[12]; ?></td>
		                <td align="right"><? echo number_format($row[csf('cons_quantity')],2,'.',''); ?></td> 
		                <?
						if($basis==9 || $basis==8)             
						{
							?>
							<td align="right"><? echo $row[csf("reject_qty")]; ?></td>
							<?
						}
						if($basis==12)             
						{
							?>
							<td align="right"><? echo $shipmode_cartoon[$p][csf("total_carton_qnty")]; ?></td>
							<?
						}
						else
						{
							?>
							<td align="right"><? if($basis==3){echo $no_of_rolls[$p][csf("no_roll")] =1; } else{echo $row[csf("carton_roll")] ;} ?></td>  
							<?
						}
		                ?>
		                <td align="right"><? echo $row[csf('no_of_bags')]; ?></td>
		                <?
						if($show_item==1)
						{
						?>
		                <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
		                <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
		                <?
						}
						?>
		                <td><? echo $gatepass_data_arr[$row[csf('mst_id')]]['buyer_order']; ?></td>
		                <td><? echo $gatepass_data_arr[$row[csf('mst_id')]]['remarks']; ?></td>
					</tr>
					<?		
				}
				$tot_roll +=$row[csf("carton_roll")];
				$noOfCarton+=$shipmode_cartoon[$p][csf("total_carton_qnty")];
				$noOfReject+=$row[csf("reject_qty")];
				$subtotAmount +=$row['amount'];
		        $totAmount +=$row['amount'];
			}
			//$tot_check=array();
			if(count($uom_check)==1)
			{
			?>
		    <tfoot bgcolor="#CCCCCC">
		        <tr>
		        <td colspan="5" align="right"> <b> Total</b></td>
		        <td align="right"><b><? echo number_format($tot_qty,2);?></b></td>
		        <?
		        if($basis==9 || $basis==8)
			  	{
					?>
						<td align="right"><b><? echo $noOfReject;?></b></td> 
		            <?   
				}
		        ?>
		        
		         <?
				if($show_item==1)
				{
					if($basis==12 || $basis==27)
					{
					?>
						<td align="right"><b><? echo $noOfCarton;?></b></td> 
		            <?   
					}
					else
					{
					?>
						 <!-- <td align="right"><b><?// echo $tot_roll;?></b></td>  -->
		            <?
					} 
				?>         
		        <?
				}
				else
				{
					if($basis==12 || $basis==27)
					{
					?>
						<td align="right"><b><? echo $noOfCarton;?></b></td> 
		        	<?
					}
					else
					{
						?>
	                    <!--25.02.2020-->
						<!--<td></td>-->
	                    <!-- <td align="right"><b><?php //echo $tot_roll; ?></b></td> -->
	                    <?php 
					}
				}
				
				if($basis!=12 && $basis!=27)
		        {
					?>
					<td align="right"><b><? echo number_format($tot_bags,2);?></b></td>
				<?
				}

				if($show_item==1)
				{
				?>
		        <td align="right"> </td>
		        <td align="right"><strong><? echo number_format($tot_amount,2);?></strong></td>
				<?
				}
				?>
		        <td colspan="<? echo 3+$colspan2;?>"></td>
		        </tr>
			</tfoot>
		    <?
			}
			 $width_sign=$width.'px';
			?>
	    </table>
    	<? 
	}
	if($show_item==1)
	{
		?>
		<!-- <span><h4 align="center">In Words : &nbsp;<? //echo number_to_words($totAmount,"");?></h4></span> -->
		<?
	}
    ?>
	</div>
	<!-- <div id="signature_bottom"> -->
	<div>
		<? echo signature_table(114, $data[0], $width_sign,1); ?>
	</div> 
 	<script type="text/javascript" src="../../js/jquery.js"></script>
      <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
    <script>

	function generateBarcode( valuess ){
		   
			var value = valuess;//$("#barcodeValue").val();
		 // alert(value)
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='bmp';// $("input[name=renderer]:checked").val();
			 
			var settings = {
			  output:renderer,
			  bgColor: '#FFFFFF',
			  color: '#000000',
			  barWidth: 1,
			  barHeight: 30,
			  moduleSize:5,
			  posX: 10,
			  posY: 20,
			  addQuietZone: 1
			};
			$("#barcode_img_id").html('11');
			 value = {code:value, rect: false};
			
			$("#barcode_img_id").show().barcode(value, btype, settings);
		} 
	 generateBarcode('<? echo $data[1]; ?>');
	 </script>
	<?
	exit();
}

if ($action=="get_out_entry_print")  // Print
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//echo "<pre>";
	//print_r($data);
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[5];
	//echo $company.'='.$location;die;
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$brand_arr=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$color_arr=return_library_array( "select id, color_name from lib_color where status_active=1", "id", "color_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");

	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );	
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );

	$sql="SELECT a.id, a.sys_number, a.company_id,a.basis,a.department_id,a.issue_purpose,a.within_group,a.section,a.attention, a.sent_by,a.carried_by, a.sent_to, a.out_date, a.challan_no, a.delivery_company, a.time_hour, a.time_minute,a.returnable,a.delivery_as,a.est_return_date,a.location_id,a.location_name,a.vhicle_number,a.com_location_id,a.mobile_no,a.driver_name, a.security_lock_no, a.driver_license_no,a.remarks,a.issue_id,a.inserted_by, b.buyer_order_id from inv_gate_pass_mst a, inv_gate_pass_dtls b where a.id=b.mst_id and a.company_id='$data[0]' and a.sys_number='$data[1]' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	$issue_id=$dataArray[0][csf('issue_id')];
	$inserted_by=$dataArray[0][csf('inserted_by')];

	foreach ($dataArray as $row){
		if ( $row[csf('buyer_order_id')] != ""){
			$order_ids.= $row[csf('buyer_order_id')].',';
		}
	}
	$order_ids=rtrim($order_ids,',');

	$bags_cone_arr=array();
	$prod_id=array();
	$brand_lot_arr=array();
	
	//echo $basis; die;
	
	if($basis==2)
	{
		$sqls="SELECT a.id,a.prod_id,a.no_of_bags,a.cone_per_bag from inv_transaction a,inv_gate_pass_mst b,inv_gate_pass_dtls c where a.id=c.challan_no and b.id=c.mst_id  and b.sys_number='$data[1]' group by a.id,a.prod_id,a.no_of_bags,a.cone_per_bag ";
		foreach(sql_select($sqls) as $val)
		{
			$bags_cone_arr[$val[csf("id")]]["bags"]=$val[csf("no_of_bags")];
			$bags_cone_arr[$val[csf("id")]]["cone"]=$val[csf("cone_per_bag")];
			$bags_cone_arr[$val[csf("id")]]["prod_id"]=$val[csf("prod_id")];
			$prod_id[$val[csf("prod_id")]]=$val[csf("prod_id")];
		}
		$prod_ids=0;
		if(count($prod_id)>0)
		{
			$prod_ids=implode(",", $prod_id);
			
		}

		$sql2="SELECT  id,brand,lot  from product_details_master where  id in($prod_ids) ";
		foreach(sql_select($sql2) as $val)
		{
			$brand_lot_arr[$val[csf("id")]]["brand"]=$brand_arr[$val[csf("brand")]];
			$brand_lot_arr[$val[csf("id")]]["lot"]=$val[csf("lot")];
			 
		}

	}	
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	/*$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}*/
	$order_array=array();
	
	if($basis==51)
	{
		$order_sql="select a.subcon_job, a.within_group, a.party_id as buyer_name, b.id, b.order_no, b.order_quantity, b.buyer_po_id,b.buyer_po_no, b.buyer_style_ref as style_ref_no, b.buyer_buyer from subcon_ord_mst a, subcon_ord_dtls b where a.subcon_job=b.job_no_mst and a.entry_form=295 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";	
		$order_sql_result=sql_select($order_sql);
		foreach ($order_sql_result as $row)
		{
			$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
			$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
		}	
	}	
	else if ($basis==12 || $basis==13)
	{
		$order_sql="select a.style_ref_no, a.job_no, a.buyer_name, b.id, b.po_number, b.po_quantity, c.color_number_id from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.id=b.job_id and b.id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.id in($order_ids)";
		$order_sql_result=sql_select($order_sql);
		foreach ($order_sql_result as $row)
		{
			$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
			$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
			if ($check_order_color[$row[csf('id')]][$row[csf('color_number_id')]]==""){
				$order_array[$row[csf('id')]]['color'].=$color_arr[$row[csf('color_number_id')]].', ';
				$check_order_color[$row[csf('id')]][$row[csf('color_number_id')]]=$row[csf('color_number_id')];
			}
		}
	}
	else
	{
		$order_sql="select a.style_ref_no, a.job_no, a.buyer_name, b.id, b.po_number, b.po_quantity from wo_po_details_master a, wo_po_break_down b where a.id=b.job_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
		$order_sql_result=sql_select($order_sql);
		foreach ($order_sql_result as $row)
		{
			$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
			$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
		}
	}
	//  echo $order_sql; die();
	

	if($basis==24)
	{
		$trims_rec_arr=array();
		$sql_item_rec=sql_select("SELECT a.id, b.issue_number, c.issue_qnty, d.booking_no,d.buyer_id, f.style_ref_no, g.po_number
		FROM inv_gate_pass_mst a, inv_issue_master b, inv_trims_issue_dtls c left join wo_po_break_down g on g.id=c.order_id, wo_booking_mst d, wo_trim_book_con_dtls e, wo_po_details_master f WHERE a.sys_number = '$data[1]' AND a.challan_no=b.issue_number and b.id=c.mst_id AND c.booking_id=d.id and  d.booking_no= e.booking_no and e.JOB_NO=f.JOB_NO AND a.status_active = 1 AND a.is_deleted = 0");
		foreach($sql_item_rec as $row){
			$trims_rec_arr[$row[csf('id')]]['buyer_id']=$row[csf('buyer_id')];
			$trims_rec_arr[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
			$trims_rec_arr[$row[csf('id')]]['po_number']=$row[csf('po_number')];		
		}
    }
		
	$copy_no=array(1,2,3); //for Dynamic Copy here 
	foreach($copy_no as $cid)
	{
		if($show_item==1)
		{
			$width=1350;
			$colspan=5;
		}
		else
		{
			$width=1330;
			$colspan=5;
		}
		$tot_reject_qty = 0;
	$com_dtls = fnc_company_location_address($company, $location, 2);
	?>
	<div style="width:<? echo $width;?>px;" align="center">
	    <table width="<? echo $width;?>px" cellspacing="0" align="center" border="0">
	        <tr>
	            <td  align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="70" width="200"></td>
	            <td colspan="4" align="center"><strong style="font-size:x-large;" ><? echo $com_dtls[0]; ?></strong> <br>
				<?
					echo $com_dtls[1];
	                ?> <br>
					<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
					<br>
					Delivery Company: <? echo $dataArray[0][csf('delivery_company')]; ?>
			    </td> 
				<td colspan="2"><strong> <span style="font-size:x-large; !important;"><? //echo $cid;?><?php if($cid==1) { echo 'Store';} elseif($cid==2) { echo  'Supplier';} else{ echo 'Gate';} ?> Copy</span></strong>
			    </td>
				<td colspan="2">
	               <div style="font-size:xx-large;; margin-top:10px; text-align:right">
	                	&nbsp;<? 
					   if($dataArray[0][csf('returnable')]==1)
					   {echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>"; }
					   elseif($dataArray[0][csf('returnable')]==2)
					   {echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Non-Returnable</span>";}?>
	               </div> 
	            </td>
	        </tr>
	        <tr>
	            <td colspan="6" align="center" style="font-size:x-large"><? if($dataArray[0][csf('basis')]==1){
						echo"<strong><u>Gate Pass </u>/<u> Challan</u></strong>";
					}
					else{
						echo"<strong><u>Gate Pass </strong>";
						}
					?></td>
	        </tr>
	        <tr>
	            <td width="160"><strong>System ID</strong></td> <td width="185px" style="font-size:20px"><b>:<? echo $dataArray[0][csf('sys_number')]; ?></b></td>
	            <td width="120"><strong>Basis</strong></td><td width="175px" >:<? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
	            <td width="145"><strong>Challan/System No</strong></td><td width="185px" colspan="2">:<? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
	        </tr>
	         <tr>
	            
	            <td><strong>Department</strong></td> <td width="175px">:<? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
	            <td><strong>Section</strong></td><td width="175px" >:<? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
	            <td><strong>Sent By</strong></td> <td width="175px">:<? echo $dataArray[0][csf('sent_by')]; ?></td>
	        </tr>
	        <tr>
	            <td><strong>Sent To</strong></td><td width="175px" style="font-size:18px"><b>:<? echo $send_to_company; ?></b></td>
	            <td><strong>Attention</strong></td><td width="175px" >:<? echo $dataArray[0][csf('attention')]; ?></td>
	            <td><strong>Out Date</strong></td><td width="175px" colspan="2">:<? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
	        </tr>
	        <tr>
	          
	            <td><strong>Out-Time</strong></td><td width="85px" >:<? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
	            <td><strong>Returnable </strong></td><td width="175px">:<? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
	            <td><strong>Delivery As</strong></td><td width="175px">:<? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
	        </tr>
	         <tr>
	            <td><strong>Est. Return Date 	 </strong></td><td width="175px">:<? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
	            <td><strong>Carried By</strong></td><td>:<? echo $dataArray[0][csf('carried_by')]; ?></td>
	            <td><strong>Purpose</strong></td><td>:<? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
	            
	        </tr>
	        <tr>
	           <td><strong>Bar Code</strong></td><td  colspan="3" id="barcode_img_id_<? echo $cid; ?>"></td> 
	           <td><strong>To Location</strong></td><td>:<? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
	        </tr>
	        <tr>
				<td><strong>Driver Name</strong></td>
				<td  align="left">: <?  echo $dataArray[0][csf("driver_name")]; ?> </td>
	         	<td><strong>Driver License No</strong></td>
	          	<td>: <?
	          	 echo $dataArray[0][csf("driver_license_no")]; ?></td>          
			  	<td><strong>Security Lock No</strong></td>
				<td colspan="3">: <?  echo $dataArray[0][csf("security_lock_no")]; ?>  </td>
	        </tr>
	        <tr>
	        <td><strong>Mobile No</strong></td>
				<td>:<? echo $dataArray[0][csf('mobile_no')]; ?></td>
	        <td>&nbsp;&nbsp;</td><td>&nbsp;&nbsp;</td>
				<td><strong>Vehicle No</strong></td>
				<td>:<? echo $dataArray[0][csf('vhicle_number')]; ?></td>
	        </tr>
			<tr>
				<td><strong>Remarks </strong></td>
				<td colspan="4">:<? echo $dataArray[0][csf('remarks')];?></td>
			</tr>
	    </table>
	    <br>
	    <table align="center" cellspacing="0" width="<? echo $width;?>px;"  border="1" rules="all" class="rpt_table" >
	        <thead bgcolor="#dddddd" align="center">
	            <th width="30">SL</th>
	            <th width="100" align="center">Item Category</th>
	            <? 
	            if($basis==2)
	            {
	            	?>
	            	<th width="70" align="center">Brand</th>
	            	<?
	            }
	            ?>
	            <th width="100" align="center">Sample</th>
	            <th width="200" align="center">Item Description</th>
	            <? 
	            if($basis==2)
	            {
	            	?>
	            	<th width="70" align="center">Lot</th>
	            	<?
	            }
	            ?>
	            <th width="50" align="center">UOM</th>
	            <th width="80" align="center">Quantity</th>
	            <th width="80" align="center">Reject Qty</th>
	            <? 
	            if($basis==2)
	            {
	            	?>
	            	<th width="70" align="center">No. of Bag/Crtn</th>
	            	<th width="70" align="center">No.of Cone</th>	            	 
	            	<?
	            }
	            
	            if($show_item==1)
				{
					?>
					<th width="50" align="center">Rate</th> 
					<th width="80" align="center">Amount </th>
					<?
				}
				if ($dataArray[0][csf('basis')]==33) 
				{
					?>
					<th width="100" align="center">Customer Buyer</th>
					<?
				}
				else
				{
					?>
	            	<th width="100" align="center">Buyer</th>
					<?
				}
				?>
	            <th width="100" align="center">Style</th>
	            <th width="160" align="center">Order No</th>
				<th width="100" align="center">Color</th>
	            <th width="60" align="center">NO of Bags/Rolls/GMT</th>
				<? 
					if($basis==12)
					{
						?>
						<th width="70" align="center">No of Carton</th>
						<?
					}
					else
					{
						?>
						<th width="70" align="center">Carton Qty</th>
						<?
					}
	            ?>
	            <th align="center">Remarks</th>
	        </thead>
		<?
	    $i=1;
		$gate_id=$dataArray[0][csf('id')];
		$sql_dtls= " SELECT id, mst_id, item_category_id, sample_id, item_description,uom_qty, quantity,reject_qty, uom, rate, amount, buyer_order_id, buyer_order, remarks, challan_no, no_of_bags, total_carton_qty from  inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 ";
		if($basis==8) //subcon challan (grey fabric)
		{
			$sql_result_subcon_grey=sql_select($sql_dtls);
			$buyer_orderIDs="";
			foreach($sql_result_subcon_grey as $row)
			{
				$buyer_orderIDs.=$row[csf('buyer_order')];
			}
			$buyer_orderID=chop($buyer_orderIDs,',');
			
			$sql_subcon_order_buyer=sql_select("select order_no,cust_buyer from subcon_ord_dtls where order_no in('$buyer_orderID') and status_active=1 and is_deleted=0");
			foreach($sql_subcon_order_buyer as $row)
			{
				$subcon_buyer_arr[$row[csf('order_no')]]['cust_buyer']=$row[csf('cust_buyer')];
			}
		}
		else if ($basis==54)
		{
			$sql_fabric_sales=sql_select($sql_dtls);
			$buyer_orderIDs="";
			foreach($sql_fabric_sales as $row)
			{
				$buyer_orderIDs.=$row[csf('buyer_order_id')].',';
			}
			$buyer_orderID=chop($buyer_orderIDs,',');
			$booking_id_arr=array();
			$sales_order_array=array();
			$sql_fabric_sales_order_buyer=sql_select("select a.id, a.within_group, a.buyer_id, a.style_ref_no as style_ref_no, a.booking_id from fabric_sales_order_mst a where a.entry_form=109 and a.status_active=1 and a.is_deleted=0 and a.id in($buyer_orderID)");
			foreach($sql_fabric_sales_order_buyer as $row)
			{
				if ($row[csf('within_group')]==1)
				{
					$booking_id.=$row[csf('booking_id')].',';
					$booking_id_arr[$row[csf('booking_id')]]=$row[csf('id')];
				}
				else
				{
					$sales_order_array[$row[csf('id')]]['buyer_name']=$buyer_library[$row[csf('buyer_id')]];
				}		
				$sales_order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
			}

			$booking_ids=rtrim($booking_id,',');
			if ($booking_ids != ""){
				$sql_booking=sql_select("select id, buyer_id from wo_booking_mst where status_active=1 and is_deleted=0 and id in($booking_ids)");
				foreach ($sql_booking as $row) {
					$sales_order_array[$booking_id_arr[$row[csf('id')]]]['buyer_name']=$buyer_library[$row[csf('buyer_id')]];
				}
			}						
		}	
		elseif($basis==9) //SubCon Dyeing And Finishing Delivery
		{
			$sql_result_subcon_grey=sql_select($sql_dtls);
			$buyer_orderIDs="";
			foreach($sql_result_subcon_grey as $row)
			{
				$buyer_orderIDs.=$row[csf('buyer_order_id')].',';
			}
			$buyer_orderID=chop($buyer_orderIDs,',');
			
			$sql_subcon_order_buyer=sql_select("SELECT a.party_id as PARTY_ID, b.order_id as ORDER_ID from subcon_delivery_mst a,subcon_delivery_dtls b where a.id=b.mst_id and a.id in($issue_id) and b.order_id in($buyer_orderID) and a.status_active=1 and b.status_active=1 ");
			foreach($sql_subcon_order_buyer as $row)
			{
				$subcon_buyer_arr[$row['ORDER_ID']]['buyer_name']=$buyer_library[$row['PARTY_ID']];
			}
		}
		elseif($basis==5)
		{
			
			$sql_dtls= " SELECT a.issue_id,b.id,b.item_category_id,b.sample_id, b.item_description,b.uom_qty, b.quantity,b.reject_qty, b.uom, b.rate, b.amount, b.buyer_order_id, b.buyer_order, b.remarks, b.challan_no, b.no_of_bags, b.total_carton_qty from inv_gate_pass_mst a, inv_gate_pass_dtls b where a.id=b.mst_id and b.mst_id=$gate_id and b.status_active=1 and b.is_deleted=0 ";
			$sql_result=sql_select($sql_dtls);
			foreach($sql_result as $val){
				$issue_idArr[$val[csf('issue_id')]]=$val[csf('issue_id')];
			}
			$issue_ids=implode(",",$issue_idArr);
		}
		elseif($basis==2)
		{
			
			$sql_dtls= " SELECT a.issue_id, b.id, b.mst_id, b.item_category_id, b.sample_id, b.item_description, b.uom_qty, b.quantity, b.reject_qty, b.uom, b.rate, b.amount, b.buyer_order_id, b.buyer_order, b.remarks, b.challan_no, b.no_of_bags, b.total_carton_qty from  inv_gate_pass_mst a, inv_gate_pass_dtls b where a.id=b.mst_id and mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
			$sql_result=sql_select($sql_dtls);
			foreach($sql_result as $val){
				$issue_idArr[$val[csf('issue_id')]]=$val[csf('issue_id')];
			}
			$issue_ids=implode(",",$issue_idArr);
		}

		
		
		//=========start================ buyer,style,order number =========================
		if($basis==5)
		{
			$order_data=sql_select("SELECT a.issue_number, b.id,a.id as inv_id, b.prod_id, b.order_id, c.item_category_id, c.item_group_id, e.id as po_id, e.po_number, e.po_quantity, f.style_ref_no, f.buyer_name, f.id as job_id ,c.product_name_details
		    from  inv_issue_master a, inv_transaction b, product_details_master c, order_wise_general_details d, wo_po_break_down e, wo_po_details_master f 
		    where a.id=b.mst_id and b.prod_id=c.id and b.id=d.trans_id and d.po_breakdown_id=e.id and c.id=d.prod_id and e.job_id=f.id and b.transaction_type=2 and a.entry_form=21 and b.status_active=1 and c.status_active=1 and d.status_active=1 and e.status_active=1 and f.status_active=1 and a.id in ($issue_ids) ");
			$describe="";
			foreach ($order_data as $val)
			{
				$describe=trim($val[csf('product_name_details')]);
				$orderBuyer[$val[csf('inv_id')]][$val[csf('item_category_id')]][$describe][$buyer_library[$val[csf('buyer_name')]]] =$buyer_library[$val[csf('buyer_name')]];
				$orderStyle[$val[csf('inv_id')]][$val[csf('item_category_id')]][$describe][$val[csf('style_ref_no')]] =$val[csf('style_ref_no')];
				$orderNo[$val[csf('inv_id')]][$val[csf('item_category_id')]][$describe][$val[csf('po_number')]] =$val[csf('po_number')];
				$t++;
			}		
		}

		else if ($basis==2)
		{
			$buyerStyleOrder_arr=array();
			$sql_buyerStyleOrder="select c.id as ISSUE_ID, e.JOB_NO, e.CUSTOMER_BUYER, e.STYLE_REF_NO, f.COLOR_ID from inv_issue_master c, inv_transaction b left join order_wise_pro_details d on b.id=d.trans_id left join fabric_sales_order_mst e on d.po_breakdown_id=e.id left join fabric_sales_order_dtls f on e.id=f.mst_id
			where c.id=b.mst_id and b.transaction_type=2 and b.item_category=1 and c.entry_form=3 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and c.id in ($issue_id)";
			$sql_buyerStyleOrder_res=sql_select($sql_buyerStyleOrder);
			foreach ($sql_buyerStyleOrder_res as $row){
				$buyerStyleOrder_arr[$row['ISSUE_ID']]['fso_order']=$row['JOB_NO'];
				$buyerStyleOrder_arr[$row['ISSUE_ID']]['style_ref_no']=$row['STYLE_REF_NO'];
				$buyerStyleOrder_arr[$row['ISSUE_ID']]['buyer_id']=$row['CUSTOMER_BUYER'];				
			}

			/* $planbooking = sql_select("select a.id as ISSUE_ID, b.requisition_no, e.booking_no as pln_booking_no, d.id, d.color_id as COLOR_ID from inv_issue_master a, inv_transaction b, ppl_yarn_requisition_entry c, ppl_planning_info_entry_dtls d, ppl_planning_info_entry_mst e where a.id=b.mst_id and b.requisition_no=c.requisition_no and c.knit_id=d.id and d.mst_id=e.id and a.id in($issue_id) and b.transaction_type=2 and b.item_category=1 and a.entry_form=3 and a.status_active=1 and b.status_active=1");
			foreach ($planbooking as $row){
				$buyerStyleOrder_arr[$row['ISSUE_ID']]['color_id'].=$color_arr[$row['COLOR_ID']].',';
			} */

		}
		//echo $sql_buyerStyleOrder;

		// echo "<pre>";
		// print_r($orderBuyer);
		//=========end================ buyer,style,order number =========================
		$uom_check=array();
		$sql_result=sql_select($sql_dtls);
		$sql_count=count($sql_result);
		$tot_qty=0;$tot_amount=0;$total_bags=$total_carton_qty=0;
		foreach($sql_result as $row)
		{
			$ref_id=$row[csf("challan_no")];
			if ($i%2==0) $bgcolor="#E9F3FF";				
			else $bgcolor="#FFFFFF";
			$color_name=rtrim($order_array[$row[csf('buyer_order_id')]]['color'],', ');	
			$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
			$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
			$uom_check[$row[csf('uom')]]=$row[csf('uom')];
			$desc=trim($row[csf('item_description')]);
			if($basis==5)
			{
				$buyer_name=implode(",",$orderBuyer[$row[csf('issue_id')]][$row[csf('item_category_id')]][$desc]);
				$style_ref_no=implode(",",$orderStyle[$row[csf('issue_id')]][$row[csf('item_category_id')]][$desc]);
				$po_number=implode(",",$orderNo[$row[csf('issue_id')]][$row[csf('item_category_id')]][$desc]);
			}
			else if($basis==2) 
			{				
				$buyer_name=$buyerStyleOrder_arr[$row[csf('issue_id')]]['buyer_id'];
				$style_ref_no=$buyerStyleOrder_arr[$row[csf('issue_id')]]['style_ref_no'];
				$order_no=$buyerStyleOrder_arr[$row[csf('issue_id')]]['fso_order'];
				//$color_name=implode(',',array_unique(explode(',',rtrim($buyerStyleOrder_arr[$row['ISSUE_ID']]['color_id'],','))));				
			}
			?>
				<tr bgcolor="<? echo $bgcolor; ?>">
	                <td><? echo $i; ?></td>
	                <td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
	                <? 
	                if($basis==2)
	                {
	                	?>
	                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["brand"]; ?></td>
	                	<?
	                }
	                ?>
	                <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
	                <td><?  echo $row[csf('item_description')]; ?></td>
	                <? 
	                if($basis==2)
	                {
	                	?>
	                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["lot"]; ?></td>
	                	<?
	                }
	                ?>

	                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
	                <td align="right"><? echo $row[csf('quantity')]; ?></td>
	                <td align="right"><? echo $row[csf('reject_qty')]; ?></td>
	                <? 
	                if($basis==2)
	                {
	                	?>
	                	<td width="70" align="center"><? echo $bags_cone_arr[$ref_id]["bags"];?></td>
	                	<td width="70" align="center"><? echo $bags_cone_arr[$ref_id]["cone"];?></td>	                	 
	                	<?
	                }
	                 
					if($show_item==1)
					{
						?>
						<td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
						<td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
						<?
					}
					?>
	                <td align="center">
						<? 
						if($basis==8) echo $subcon_buyer_arr[$row[csf('buyer_order')]]['cust_buyer'];
						else if ($basis==54) echo $sales_order_array[$row[csf('buyer_order_id')]]['buyer_name'];
						else if ($basis==9) echo $subcon_buyer_arr[$row[csf('buyer_order_id')]]['buyer_name'];
						else if ($basis==5) echo $buyer_name;
						else if ($basis==24) echo $buyer_library[$trims_rec_arr[$row[csf('mst_id')]]['buyer_id']];
						else if ($basis==2) echo $buyer_library[$buyer_name];
						else echo $buyer_library[$buyer];
						?>
					</td>
	                <td><? if ($data[4]==54) { echo $sales_order_array[$row[csf('buyer_order_id')]]['style_ref_no'];} elseif ($data[4]==5) { echo $style_ref_no;} elseif ($data[4]==24) { echo $trims_rec_arr[$row[csf('mst_id')]]['style_ref_no'];} else { echo $style_ref_no;} ?></td>
	                <td><? if($data[4]==5){ echo $po_number;} else if ($basis==2) { echo $order_no; } elseif ($data[4]==24){ echo $trims_rec_arr[$row[csf('mst_id')]]['po_number'];}else{ echo $row[csf('buyer_order')];}  ?></td>
					<td ><? echo $color_name; ?></td>
	                <td align="right"><? echo $row[csf('no_of_bags')];?></td>
					<? 
						if($basis==12)
						{
							?>
							<td align="right"><? echo $row[csf('total_carton_qty')];?></td>
							<?
						}
						else
						{
							?>
							<td align="right"><? echo $row[csf('total_carton_qty')];?></td>
							<?
						}
					?>
	                <td><? echo $row[csf('remarks')]; ?></td>
				</tr>
			<?php
	    	$i++;			
			$tot_qty+= $row[csf('quantity')];
			$tot_reject_qty+=$row[csf('reject_qty')];
			$tot_amount+=$row[csf('amount')];
			$total_bags+=$row[csf('no_of_bags')];
			$total_carton_qty+=$row[csf('total_carton_qty')];
			$inWordTxt=$unit_of_measurement[$row[csf('uom')]];
	    }

		if($basis==2) $colspan+=2;
		if(count($uom_check)==1)
		{
			?>
			<tfoot bgcolor="#CCCCCC">
				<tr>
					<td colspan="<? echo $colspan;?>" align="right"><b>Total</b></td>
					<td align="right"><b><? echo number_format($tot_qty,2);?></b></td>
					<td align="right"><b><? echo number_format($tot_reject_qty,2);?></b></td>
					<?
					if($basis==2)
					{
						?>
						<td colspan="2"></td>
						<?
					}
					if($show_item==1)
					{
						?>
						<td></td>
						<td align="right"><b> <? echo number_format($tot_amount,2);?></b></td>
						<?
					}
					?>
					<td colspan="4"></td>
					<td align="right"><b><? echo number_format($total_bags,4);?></b></td>
					<td align="right"><b><? echo number_format($total_carton_qty,4);?></b></td>
					<td></td>
				</tr>
			</tfoot>
			<?
		}
		$width_sign=$width.'px';
		?>
	    </table>
		<?
		if($show_item==1)
		{
		   ?>
	      <span><h4 align="center">In Words : &nbsp;<? 
		   $tot_amount_in_word = round($tot_qty);
		   echo number_to_words($tot_amount_in_word);?></h4></span>
	       <span><h4 align="center">Total Amount : &nbsp;<? $tot_qty = number_format($tot_amount,10); echo number_format($tot_amount)." ".'Taka Only';?></h4></span>
			<? 
		}
		echo signature_table(114, $data[0], $width_sign,1,1,$inserted_by,$userSignatureArr); 
		?>
	    
	    <script type="text/javascript" src="../../js/jquery.js"></script>
	    <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
	    <script>
		function generateBarcode( valuess )
		{			   
			var value = valuess;//$("#barcodeValue").val();
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='css';// $("input[name=renderer]:checked").val();				
			var settings = {
				output:renderer,
				bgColor: '#FFFFFF',
				color: '#000000',
				barWidth: 1,
				barHeight: 30,
				moduleSize:8,
				posX: 10,
				posY: 20,
				addQuietZone: 1,
				showHRI: false,
			};
			$("#barcode_img_id_<? echo $cid; ?>").html('');
			value = {code:value, rect: false};				
			$("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
		} 
		generateBarcode('<? echo $data[1]; ?>');



		</script>

	



		</div>
		<p style="page-break-after:always;"></p>
		<?
	}	
	exit();
}

if ($action=="print_to_html_report14")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//print_r($data);
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[2];
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$brand_arr=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$color_arr=return_library_array( "select id, color_name from lib_color",'id','color_name');
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");

	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );	
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,vhicle_number,com_location_id,mobile_no,issue_id from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 ";
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	$bags_cone_arr=array();
	$prod_id=array();
	$brand_lot_arr=array();
	if($basis==11)
	{
		$sqls="SELECT a.id,a.prod_id,a.no_of_bags,a.cone_per_bag from inv_transaction a,inv_gate_pass_mst b,inv_gate_pass_dtls c where a.id=c.challan_no and b.id=c.mst_id  and b.sys_number='$data[1]' group by a.id,a.prod_id,a.no_of_bags,a.cone_per_bag ";
		foreach(sql_select($sqls) as $val)
		{
			$bags_cone_arr[$val[csf("id")]]["bags"]=$val[csf("no_of_bags")];
			$bags_cone_arr[$val[csf("id")]]["cone"]=$val[csf("cone_per_bag")];
			$bags_cone_arr[$val[csf("id")]]["prod_id"]=$val[csf("prod_id")];
			$prod_id[$val[csf("prod_id")]]=$val[csf("prod_id")];
		}
		$prod_ids=0;
		if(count($prod_id)>0)
		{
			$prod_ids=implode(",", $prod_id);
		}

		$sql2="SELECT  id,brand,lot  from product_details_master where  id in($prod_ids) ";
		foreach(sql_select($sql2) as $val)
		{
			$brand_lot_arr[$val[csf("id")]]["brand"]=$brand_arr[$val[csf("brand")]];
			$brand_lot_arr[$val[csf("id")]]["lot"]=$val[csf("lot")];
			 
		}

	}	
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	
	
	$composition_arr=array();
	$construction_arr=array();
	$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id";
	$data_array=sql_select($sql_deter);
	if(count($data_array)>0)
	{
	
	foreach( $data_array as $row )
	{
		$construction_arr[$row[csf('id')]]=$row[csf('construction')];
		if(array_key_exists($row[csf('id')],$composition_arr))
		{
			$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]]." ".$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
		}
		else
		{
			$composition_arr[$row[csf('id')]]=$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
		}
	}
	}
	
	//print_r($order_array); 186
	
		if($show_item==1)
		{
			$width=1250;
			$colspan=5;
		}
		else
		{
			$width=1250;
			$colspan=5;
			$colspan2=2;
		}
	$com_dtls = fnc_company_location_address($company, $location, 2);
	?>
	<div style="width:<? echo $width;?>px;" align="center">
	    <table width="<? echo $width;?>px" cellspacing="0" align="center" border="0">
	        <tr>
	          <tr>
	            <td  align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="70" width="200"></td>
	            <td colspan="7" align="center"  style="font-size:xx-large;"><strong style="margin-left:100px" ><? echo $com_dtls[0]; ?><span style="font-size:x-large; margin-left:200px !important;"></strong>
	             <div style="float:right;width:34%; margin-top:10px; text-align:right">
	               	&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
	            </div>
	            </td>
	           
	           
	           
	        </tr>
	        <tr class="form_caption">
	            <td colspan="8" align="center">
					<?
					echo $com_dtls[1];
					/*$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
						//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
						foreach ($nameArray as $result)
						{ 
							echo $result[csf('plot_no')];if($result[csf('plot_no')]!="") {echo ',';} else{echo '';}
							echo $result[csf('level_no')];if($result[csf('level_no')]!="") {echo ',';} else{echo '';}
							echo $result[csf('road_no')];if($result[csf('road_no')]!="") {echo ',';} else{echo '';}
							echo $result[csf('block_no')];if($result[csf('block_no')]!="") {echo ',';} else{echo '';}
							echo $result[csf('city')];if($result[csf('city')]!="") {echo ',';} else{echo '';}
							echo $result[csf('zip_code')];if($result[csf('zip_code')]!="") {echo ',';} else{echo '';}
							echo $result[csf('province')];if($result[csf('province')]!="") {echo ',';} else{echo '';}
							echo $country_arr[$result[csf('country_id')]].'<br>'; 
							echo $result[csf('email')]; if($result[csf('email')]!="") {echo ',';} else{echo '';}
							echo $result[csf('website')];if($result[csf('website')]!="") {echo ',';} else{echo '';}
						}*/
	                ?> 
	                <div style="width:34%; text-align:center">
	               	&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
	            </div>
	            </td>
	        </tr>
	        <tr>
	        	<td style="display:none" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
	        </tr>
	        <tr>
	            <td colspan="8" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
	        </tr>
	        <tr>
	            <td width="160"><strong>System ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
	            <td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
	            <td width="125"><strong>Challan/System No:</strong></td><td width="175px" colspan="2"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
	        </tr>
	         <tr>
	            
	            <td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
	            <td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
	            <td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
	        </tr>
	        <tr>
	            <td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
	            <td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
	            <td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
	        </tr>
	        <tr>
	          
	            <td><strong>Out-Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
	            <td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
	            <td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
	        </tr>
	         <tr>
	            <td><strong>Est. Return Date 	 :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
	            <td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
	            <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
	            
	        </tr>
	        <tr>
	           <td><strong>Bar Code:</strong></td><td  colspan="3" id="barcode_img_id_<? echo $cid; ?>"></td> 
	           <td><strong>To Location:</strong></td><td><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
	        </tr>
	        <tr>
	        <td><strong>Mobile No:</strong></td>
				<td><? echo $dataArray[0][csf('mobile_no')]; ?></td>
	        <td>&nbsp;&nbsp;</td><td>&nbsp;&nbsp;</td>
				<td><strong>Vehicle No:</strong></td>
				<td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
	        </tr>
	    </table>
	    <br>
	    <table align="center" cellspacing="0" width="<? echo $width;?>px;"  border="1" rules="all" class="rpt_table" >
	        <thead bgcolor="#dddddd" align="center">
                <th width="30">SL</th>
                <th width="100" align="center">Buyer</th>
                <th width="100" align="center">Batch No</th>									
                <th width="120" align="center">Booking No</th>
                <th width="50" align="center">Color</th>
                <th width="80" align="center">Color Type</th>
                <th width="120" align="center">Body Part</th> 
                <th width="80" align="center">Dia Type </th>
                <th width="150" align="center">Fabric Type</th>
                <th width="100" align="center">Fin GSM</th>
                <th width="100" align="center">Fin. Dia</th>
                <th width="80" align="center">Total Roll </th>
                <th align="center">Gate Pass Qty</th>
	        </thead>
		<?
	    $i=1;
		$gate_id=$dataArray[0][csf('id')];
		$issue_id=$dataArray[0][csf('issue_id')];
		$challan_no=$dataArray[0][csf('challan_no')];
		$company_id=$dataArray[0][csf('company_id')];
		$get_pass_no=$dataArray[0][csf('get_pass_no')];
		
	
		
	$batch_data=sql_select("select a.id, a.batch_no, a.booking_no_id, a.booking_no, a.booking_without_order from  pro_batch_create_mst a, pro_batch_create_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and batch_against>0 and batch_for>0 group by a.id, a.batch_no, a.booking_no_id, a.booking_no, a.booking_without_order");
	foreach($batch_data as $row)
	{
		$batch_details[$row[csf('id')]]['batch_no']=$row[csf('batch_no')];
		$batch_details[$row[csf('id')]]['booking_no_id']=$row[csf('booking_no_id')];
		$batch_details[$row[csf('id')]]['booking_no']=$row[csf('booking_no')];
	}
		
		
		
		/*$sql_dtls="select c.no_of_bags,c.quantity,d.buyer_id,e.batch_id,e.color_id,e.construction, e.composition,e.bodypart_id,e.width_type,
   e.gsm, e.dia,e.roll,e.fabric_shade,e.determination_id from inv_gate_pass_mst b,inv_gate_pass_dtls c,pro_grey_prod_delivery_mst d,pro_grey_prod_delivery_dtls e where  b.id=c.mst_id and d.id=b.issue_id and d.id=e.mst_id and b.id=$gate_id and d.id=$issue_id and b.issue_id=$issue_id and d.entry_form=54 and e.entry_form=54 ";*/
   
  $sql_dtls="select d.buyer_id,e.batch_id,e.color_id,e.construction, e.composition,e.bodypart_id,e.width_type,
   e.gsm, e.dia,e.roll,e.fabric_shade,e.determination_id,e.current_delivery,e.roll from pro_grey_prod_delivery_mst d,pro_grey_prod_delivery_dtls e where  d.id=e.mst_id  and d.id=$issue_id and d.entry_form=54 and e.entry_form=54 ";
	
		
		if($data[4]==8) //subcon challan (grey fabric)
		{
			$sql_result_subcon_grey=sql_select($sql_dtls);
			$buyer_orderIDs="";
			foreach($sql_result_subcon_grey as $row)
			{
				$buyer_orderIDs.=$row[csf('buyer_order')];
			}
			$buyer_orderID=chop($buyer_orderIDs,',');
			
			$sql_subcon_order_buyer=sql_select("select order_no,cust_buyer from subcon_ord_dtls where order_no in('$buyer_orderID') and status_active=1 and is_deleted=0");
			foreach($sql_subcon_order_buyer as $row)
			{
				$subcon_buyer_arr[$row[csf('order_no')]]['cust_buyer']=$row[csf('cust_buyer')];
			}
		}
		
		//echo $sql_dtls;
		$uom_check=array();
		$sql_result=sql_select($sql_dtls);
		$sql_count=count($sql_result);
		$tot_qty=0;$tot_amount=0;
		foreach($sql_result as $row)
		{
			$ref_id=$row[csf("challan_no")];
			if ($i%2==0)  
				$bgcolor="#E9F3FF";
			else
				$bgcolor="#FFFFFF";
				
				$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
				//echo $buyer; 9
				$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
				//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
				$uom_check[$row[csf('uom')]]=$row[csf('uom')];
				?>
				<tr bgcolor="<? echo $bgcolor; ?>">
                    <td width="30"><? echo $i; ?></td>
                    <td width="100" align="center"><? echo $buyer_library[$row[csf('buyer_id')]];?></td>
                    <td width="100" align="center"><? echo $batch_details[$row[csf('batch_id')]]['batch_no'];?></td>									
                    <td width="120" align="center"><? echo $batch_details[$row[csf('batch_id')]]['booking_no']; ?></td>
                    <td width="50" align="center"><? echo $color_arr[$row[csf('color_id')]]; ?></td>
                    <td width="80" align="center"><?  ?></td>
                    <td width="120" align="center"><? echo $body_part[$row[csf('bodypart_id')]]; ?></td> 
                    <td width="80" align="center"><? echo $fabric_typee[$row[csf('width_type')]]; ?></td>
                    <td width="150" align="center"><? echo $composition_arr[$row[csf('determination_id')]]; ?></td>
                    <td width="100" align="center"><? echo $row[csf('gsm')]; ?></td>
                    <td width="100" align="center"><? echo $row[csf('dia')]; ?></td>
                    <td width="80" align="center"><? echo $row[csf('roll')]; ?></td>
                    <td align="center"><? echo $row[csf('current_delivery')]; ?></td>
				</tr>
			<?php
	    	$i++;
			
			$tot_qty+=$row[csf('quantity')];
			$tot_amount+=$row[csf('amount')];
			//if($sql_count>1) {$inWordTxt="Quantity";} else{ $inWordTxt=$unit_of_measurement[$row[csf('uom')]];}
			$inWordTxt=$unit_of_measurement[$row[csf('uom')]];
	    }
		$width_sign=$width.'px';
		?>
	    </table>
	</div>
	<div>
		<? echo signature_table(114, $data[0], $width_sign,$template_id); ?>
	    
	    <script type="text/javascript" src="../../js/jquery.js"></script>
	      <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
	     <script>

		function generateBarcode( valuess ){
			   
				var value = valuess;//$("#barcodeValue").val();
			 // alert(value)
				var btype = 'code39';//$("input[name=btype]:checked").val();
				var renderer ='bmp';// $("input[name=renderer]:checked").val();
				 
				var settings = {
				  output:renderer,
				  bgColor: '#FFFFFF',
				  color: '#000000',
				  barWidth: 1,
				  barHeight: 30,
				  moduleSize:5,
				  posX: 10,
				  posY: 20,
				  addQuietZone: 1
				};
				$("#barcode_img_id_<? echo $cid; ?>").html('11');
				 value = {code:value, rect: false};
				
				$("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
			} 
		 generateBarcode('<? echo $data[1]; ?>');
		 </script>
	</div>
	<?
	exit();
}

if ($action=="get_out_entry_print6") // Print 6
{
	extract($_REQUEST);
	$data=explode('*',$data);
	// echo "<pre>";
	// print_r($data);	
	$show_item=$data[4];
	$cbo_returnable = $data[6];
	$company=$data[0];
	$location=$data[2];
	
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$brand_arr=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name");
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");
	$designation_a=return_library_array("select id,custom_designation from lib_designation","id","custom_designation");

	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );	
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,vhicle_number,com_location_id,mobile_no,remarks ,inserted_by from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 ";
	// echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	$inserted_by=$dataArray[0][csf('inserted_by')];
	$bags_cone_arr=array();
	$prod_id=array();
	$brand_lot_arr=array();
	if($basis==2)
	{
		$sqls="SELECT a.id,a.prod_id,a.no_of_bags,a.cone_per_bag from inv_transaction a,inv_gate_pass_mst b,inv_gate_pass_dtls c where a.id=c.challan_no and b.id=c.mst_id  and b.sys_number='$data[1]' group by a.id,a.prod_id,a.no_of_bags,a.cone_per_bag ";
		foreach(sql_select($sqls) as $val)
		{
			$bags_cone_arr[$val[csf("id")]]["bags"]=$val[csf("no_of_bags")];
			$bags_cone_arr[$val[csf("id")]]["cone"]=$val[csf("cone_per_bag")];
			$bags_cone_arr[$val[csf("id")]]["prod_id"]=$val[csf("prod_id")];
			$prod_id[$val[csf("prod_id")]]=$val[csf("prod_id")];
		}
		$prod_ids=0;
		if(count($prod_id)>0)
		{
			$prod_ids=implode(",", $prod_id);
		}

		$sql2="SELECT  id,brand,lot  from product_details_master where  id in($prod_ids) ";
		foreach(sql_select($sql2) as $val)
		{
			$brand_lot_arr[$val[csf("id")]]["brand"]=$brand_arr[$val[csf("brand")]];
			$brand_lot_arr[$val[csf("id")]]["lot"]=$val[csf("lot")];
			 
		}

	}else {
		$sqls="SELECT a.id,a.prod_id,c.no_of_bags,a.cone_per_bag from inv_transaction a,inv_gate_pass_mst b,inv_gate_pass_dtls c where a.id=c.challan_no and b.id=c.mst_id  and b.sys_number='$data[1]' group by a.id,a.prod_id,c.no_of_bags,a.cone_per_bag ";
		foreach(sql_select($sqls) as $val)
		{
			$bags_cone_arr[$val[csf("id")]]["bags"]=$val[csf("no_of_bags")];
		}
		// echo "<pre>"; print_r($bags_cone_arr); die;
	}	
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}	
	if($cbo_returnable==1){

		$copy_no=array(1,2,3); 
	}else{

		$copy_no=array(1,2); 
	}
	foreach($copy_no as $cid)
	{
		if($show_item==1){
			$width=1150;
			$colspan=5;		}
		else{
			$width=1150;
			$colspan=5;
			$colspan2=2;
		}
		$address = "";
		$add_info = "";
		$nameArray=sql_select("select plot_no, level_no, road_no, block_no, country_id, province, city, zip_code, email, website from lib_company where id=$data[0]");
		if($nameArray[0][csf('plot_no')] != ''){
			$address.="Plot# ".$nameArray[0][csf('plot_no')].',';
		}
		if($nameArray[0][csf('level_no')] != ''){
			$address.="Level# ".$nameArray[0][csf('level_no')].',';
		}
		if($nameArray[0][csf('road_no')] != ''){
			$address.="Road# ".$nameArray[0][csf('road_no')].',';
		}
		if($nameArray[0][csf('block_no')] != ''){
			$address.="Block# ".$nameArray[0][csf('block_no')].'<br>';
		}
		if($nameArray[0][csf('city')] != ''){
			$address.=$nameArray[0][csf('city')].',';
		}
		if($nameArray[0][csf('zip_code')] != 0 && $nameArray[0][csf('zip_code')] != ''){
			$address.='-'.$nameArray[0][csf('zip_code')].',';
		}
		if($nameArray[0][csf('province')] != ''){
			$address.=$nameArray[0][csf('province')].','.$country_arr[$nameArray[0][csf('country_id')]];
		}
		if($nameArray[0][csf('email')] != 0){
			$add_info.='Email: '.$nameArray[0][csf('email')].', ';
		}
		if($nameArray[0][csf('website')] != 0){
			$add_info.='Website: '.$nameArray[0][csf('website')].',';
		}
		$com_dtls = fnc_company_location_address($company, $location, 2);
		?>
		<div data-print=section class="print6_data">
			<div style="width:<? echo $width;?>px;" align="center">
			    <table style="table-layout: fixed; " width="<? echo $width;?>">
					<tr>
						<td rowspan="5" width="300"><img src="<?=base_url($com_dtls[2]); ?>" height="45" width="45"></td>
					</tr>
					<tr style="font-size:xx-large;">
						<td width="500" style="text-align: center;"><strong><? echo $com_dtls[0]; ?></strong></td>
						<td width="200" style="text-align: right; padding-right: 7px">
						<span style="font-size:x-large; font-weight: bold;">
						<? echo $cid;?><sup><?php if($cid==1) { echo 'st';} elseif($cid==2) { echo  'nd';} else{ echo 'rd';} ?></sup> Copy</span><br/>
						<span>
							<?
								if($cbo_returnable == 1){
									echo "Returnable";
								}
							?>
						</span>
						</td>
					</tr>
					<tr>				
						<td style="text-align: center;"><?php echo $com_dtls[1]; ?>
						</td>
						<td style="text-align: right; "><span  id="barcode_img_id_<? echo $cid; ?>" ></span></td>
					</tr>
					<tr>			
						<td style="text-align: center;"><?php echo $add_info ?></td>
					</tr>
					<tr>
						<td style="text-align: center; font-size:x-large; text-decoration: underline; font-weight: bold;">Gate Pass</td>
					</tr>
				</table>
				<br>
			    <table border="1" cellpadding="1" cellspacing="1" style="width:1150px" rules="all">
			        <tr>
			            <td width="160"><strong>System ID:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sys_number')]; ?></td>
			            <td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
			            <td width="125"><strong>Challan/System No:</strong></td><td width="175px" colspan="2"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
			        </tr>
			        <tr>	            
			            <td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
			            <td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
			            <td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
			        </tr>
			        <tr>
			            <td><strong>Sent To:</strong></td><td width="175px"><? echo $send_to_company; ?></td>
			            <td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
			            <td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
			        </tr>
			        <tr>		          
			            <td><strong>Out-Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
			            <td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
			            <td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
			        </tr>
			        <tr>
			            <td><strong>Est. Return Date 	 :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
			            <td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
			            <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
			            
			        </tr>
			        <tr>	           
				        <td><strong>To Location:</strong></td><td><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?>			        	
				        </td>
				        <td><strong>Mobile No:</strong></td>
						<td><? echo $dataArray[0][csf('mobile_no')]; ?></td>
						<td><strong>Vehicle No:</strong></td>
						<td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
			        </tr>

					<tr>	           
				        <td><strong>Remarks:</strong></td>
						<td><? echo $dataArray[0][csf('remarks')]; ?></td>
				        <td></td>
						<td></td>
						<td></td>
						<td></td>
			        </tr>
			    </table>
			    <br>
			    <table align="center" cellspacing="0" width="<? echo $width;?>px;"  border="1" rules="all" class="rpt_table" >
			        <thead bgcolor="#dddddd" align="center">
			            <th width="30">SL</th>
			            <th width="100" align="center">Item Category</th>
			            <? 
			            if($basis==2)
			            {
			            	?>
			            	<th width="70" align="center">Brand</th>
			            	<?

			            }
			            ?>
			            <th width="100" align="center">Sample</th>
			            <th width="200" align="center">Item Description</th>
			            <? 
			            if($basis==2)
			            {
			            	?>
			            	<th width="70" align="center">Lot</th>
			            	<?

			            }
			            ?>
			            <th width="50" align="center">UOM</th>
			            <th width="80" align="center">Quantity</th>
						
			            <? 
			            if($basis==2)
			            {
			            	?>
			            	
			            	<th width="70" align="center">No.of Cone</th>
			            	 
			            	<?

			            }
			            
			            if($show_item==1)
						{
						?>
			            <th width="50" align="center">Rate</th> 
			            <th width="80" align="center">Amount </th>
						<th width="70" align="center">No Of Bag/Roll/GMT</th>
			            <?
						}
						if ($dataArray[0][csf('basis')]==33) 
						{
						?>
							<th width="100" align="center">Customer Buyer</th>
						<?
						}
						else
						{
						?>
			            	<th width="100" align="center">Buyer</th>
						<?
						}
						?>
			            <th width="100" align="center">Style</th>
			            <th width="80" align="center">Buyer Order </th>
			            <th align="center">Remarks</th>
			        </thead>
				<?
			    $i=1;
				$gate_id=$dataArray[0][csf('id')];
				$sql_dtls= " SELECT id,item_category_id,sample_id, item_description,uom_qty, quantity, uom, rate, amount,buyer_order_id,buyer_order, remarks,challan_no, no_of_bags from  inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 ";
				if($data[4]==8) //subcon challan (grey fabric)
				{
					$sql_result_subcon_grey=sql_select($sql_dtls);
					$buyer_orderIDs="";
					foreach($sql_result_subcon_grey as $row)
					{
						$buyer_orderIDs.=$row[csf('buyer_order')];
					}
					$buyer_orderID=chop($buyer_orderIDs,',');
					
					$sql_subcon_order_buyer=sql_select("select order_no,cust_buyer from subcon_ord_dtls where order_no in('$buyer_orderID') and status_active=1 and is_deleted=0");
					foreach($sql_subcon_order_buyer as $row)
					{
						$subcon_buyer_arr[$row[csf('order_no')]]['cust_buyer']=$row[csf('cust_buyer')];
					}
				}
				
				// echo $sql_dtls;
				$uom_check=array();
				$sql_result=sql_select($sql_dtls);
				$tot_qty=0;$tot_amount=0; $tot_beg=0;
				foreach($sql_result as $row)
				{
					$ref_id=$row[csf("challan_no")];
					if ($i%2==0)  
						$bgcolor="#E9F3FF";
					else
						$bgcolor="#FFFFFF";
						
						$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
						$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
						//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
						$uom_check[$row[csf('uom')]]=$row[csf('uom')];
						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
			                <td><? echo $i; ?></td>
			                <td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
			                <? 
			                if($basis==2)
			                {
			                	?>
			                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["brand"]; ?></td>
			                	<?

			                }
			                ?>
			                <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
			                <td><?  echo $row[csf('item_description')]; ?></td>
			                <? 
			                if($basis==2)
			                {
			                	?>
			                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["lot"]; ?></td>
			                	<?

			                }
			                ?>

			                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
			                <td align="right"><? echo $row[csf('quantity')]; ?></td>
							
			                <? 
			                if($basis==2)
			                {
			                	?>
			                	
			                	<td width="70" align="center"><? echo $bags_cone_arr[$ref_id]["cone"];?></td>
			                	 
			                	<?

			                }
			                 
							if($show_item==1)
							{
							?>
			                <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
			                <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
							
							<!-- <td width="70" align="center"><?// echo $bags_cone_arr[$ref_id]["bags"];?></td> -->
							<td width="70" align="center"><? echo $row[csf('no_of_bags')];?></td>
			                <?
							}
							?>
			                <td align="center"><? 
							if($data[4]==8)
							{
								echo $subcon_buyer_arr[$row[csf('buyer_order')]]['cust_buyer'];
							}
							else
							{
								echo $buyer_library[$buyer]; 
							}
							?></td>
			                <td><? echo $style_ref_no; ?></td>
			                <td><? echo $row[csf('buyer_order')]; ?></td>
			                <td><? echo $row[csf('remarks')]; ?></td>
						</tr>
					<?php
			    	$i++;
					
					$tot_qty+=$row[csf('quantity')];
					$tot_amount+=$row[csf('amount')];
					$tot_beg+=$row[csf('no_of_bags')];
			    }
				//$tot_check=array();
				if($basis==2)$colspan+=2;
				if(count($uom_check)==1)
				{

				?>
			    <tfoot bgcolor="#CCCCCC">
			        <tr>
			        <td colspan="<? echo $colspan;?>" align="right"> <b> Total</b></td>
			        <td align="right"><b><? echo number_format($tot_qty,2);?></b> </td>
					
			          <?
			        if($basis==2)
			        {
			        	?>
			        	<td></td>

			        	<?
			        }
					if($show_item==1)
					{
					?>
			        <td> </td>
			        <td align="right"><b> <? echo number_format($tot_amount,2);?></b> </td>
					<td align="center"><b> <? echo $tot_beg;?></b> </td>
					
			        <?
						}
					?>
			        <td colspan="<? echo 4+$colspan2;?>"></td>
			        </tr>
				</tfoot>
			    <?
				}
				$width_sign=$width.'px';
				?>
			    </table>
			</div>
			<?php

      $hisSql =  "select MST_ID,APPROVED_BY,APPROVED_DATE, SEQUENCE_NO from APPROVAL_MST where ENTRY_FORM=59 and MST_ID=$gate_id order by sequence_no";
		//echo $hisSql;die();
		$hisSqlRes=sql_select($hisSql);

		foreach($hisSqlRes as $Row)
		{
			$Row['APPROVED_DATE']=strtotime($Row['APPROVED_DATE']);
			
			$sys_id_arr[$Row['APPROVED_BY']]=array(
			'APPROVED_BY'=>$Row['APPROVED_BY'],
			'SEQUENCE_NO'=>$Row['SEQUENCE_NO'],
			'APPROVED_DATE'=>date('d-m-Y h:i:s A',$Row['APPROVED_DATE']),
		);
		$userIdArr[$Row['APPROVED_BY']]=$Row['APPROVED_BY'];
		}
		// 	echo 11;die;
		// 	echo "<pre>";
		// print_r($sys_id_arr); 
		//   echo "</pre>";die();

		$sql="select a.USER_ID,a.DEPARTMENT,b.DESIGNATION,b.USER_FULL_NAME from electronic_approval_setup a,user_passwd b where b.id=a.USER_ID ".where_con_using_array($userIdArr,0,'a.USER_ID')."";
		//echo $sql;die();
		$sql_res=sql_select($sql);

		foreach($sql_res as $roww){
			$userName[$roww['USER_ID']]=$roww['USER_FULL_NAME'];
			$userDeg[$roww['USER_ID']]=$roww['DESIGNATION'];
			if($department_arr[$roww['DEPARTMENT']]!=''){$userDep[$roww['USER_ID']][$roww['DEPARTMENT']]=$department_arr[$roww['DEPARTMENT']];}
		}

		// echo "<pre>";
		// 	print_r($userName); 
		// 	  echo "</pre>";die();

		$hisSql ="select MST_ID,REFUSING_REASON from REFUSING_CAUSE_HISTORY where ENTRY_FORM=59 and MST_ID==$gate_id";
		//echo $hisSql;die();
			$hisSqlRes=sql_select($hisSql);
			$refusing_res_arr = array();
			foreach($hisSqlRes as $key => $prerow){
				$refusing_res_arr[$key+2] = $prerow['REFUSING_REASON'];

			}
		// echo "<pre>";
		// print_r($refusing_res_arr); 
		//   echo "</pre>";die();

		?>
		<br>
			<table border="1" rules="all">
				<thead>   
					<tr> <th colspan="5" ><strong>Approval Authority</strong></th></tr>
					<tr>
						<th>Name</th>
						<th>Designation</th>
						<th>Reason For Unapproval</th>
						<th>Approve Status</th>
						<th>Time/Date</th>
					</tr>
		        </thead>
				<tbody>
					<?
					foreach ($sys_id_arr as $row) 
					{  
					?>
					
					<tr>   
						<td><?=$userName[$row['APPROVED_BY']];?></td>
						<td><?=$designation_a[$userDeg[$row['APPROVED_BY']]];?></td>
						<td><?=$refusing_res_arr[$row['SEQUENCE_NO']];?></td>
						<td><? echo "Yes";?></td>
						<td><?=$row[APPROVED_DATE]; ?></td>
					</tr>
					<?
					
					}
					?>
				</tbody>
	        </table> 

			<? 
			 
			$appSql = "select a.APPROVED_BY, a.APPROVED_DATE,b.USER_FULL_NAME,c.CUSTOM_DESIGNATION from approval_mst a,USER_PASSWD b,LIB_DESIGNATION c where a.mst_id ={$dataArray[0][csf('id')]} and a.APPROVED_BY=b.id and b.DESIGNATION=c.id and c.STATUS_ACTIVE=1 and c.IS_DELETED=0 and b.STATUS_ACTIVE=1 and b.IS_DELETED=0
			union all
			select b.id as APPROVED_BY, a.INSERT_DATE as APPROVED_DATE,b.USER_FULL_NAME,c.CUSTOM_DESIGNATION from INV_GATE_PASS_MST a,USER_PASSWD b,LIB_DESIGNATION c where a.id ={$dataArray[0][csf('id')]} and a.INSERTED_BY=b.id and b.DESIGNATION=c.id and c.STATUS_ACTIVE=1 and c.IS_DELETED=0 and b.STATUS_ACTIVE=1 and b.IS_DELETED=0";
			// echo $appSql;die;
			$appSqlRes=sql_select($appSql);
			$userDtlsArr=array();
			foreach($appSqlRes as $row){
				$userDtlsArr[$row['APPROVED_BY']]="<div><b>".$row['USER_FULL_NAME']."</b></div><div><b></div><div><small>".$row['APPROVED_DATE']."</small></div>";
			}
			echo get_app_signature(114, $data[0], $width_sign,$template_id, 50,$inserted_by,$userDtlsArr); 

			?>	
		</div>			    
			<script type="text/javascript" src="../../js/jquery.js"></script>
			<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
			<script>
				function generateBarcode( valuess ){					   
						var value = valuess;
						var btype = 'code39';
						var renderer ='bmp';						 
						var settings = {
						  output:renderer,
						  bgColor: '#FFFFFF',
						  color: '#000000',
						  barWidth: 1,
						  barHeight: 30,
						  moduleSize:5,
						  posX: 10,
						  posY: 20,
						  addQuietZone: 1
						};
						$("#barcode_img_id_<? echo $cid; ?>").html('11');
						 value = {code:value, rect: false};						
						$("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
					} 
				 generateBarcode('<? echo $data[1]; ?>');
			</script>
		<?
	}
	?>	
	<script type="text/javascript">
		var staticHeight = 0;
		var pageHeight = 880;
		$('.print6_data').each(function() {
		    staticHeight += $(this).filter(':visible').outerHeight(true);
		    console.log(staticHeight)
		    if (staticHeight > pageHeight) {
		        $(this).after( '<p style="page-break-after:always;"></p>');		        
		        staticHeight = 0;
		    }
		    else{
		    	$(this).after( '<hr style="border-top: dotted 2px #000">');
		    	$(this).css({
					"height": "auto",
					"margin-bottom": "2px"
					});
		    	//$(this).css('height', "680px");
		    	$('.print6_data').addClass("devider");
		    }

		});
	</script>
	<style type="text/css">		
		.devider:nth-of-type(2){
			margin-top: 40px;
		}
	</style>
	<?
	exit();
}

if ($action=="get_out_entry_print20") // Print 20
{ 
    extract($_REQUEST);
    $data=explode('*',$data);
 // echo "<pre>";
     // print_r($data);
    $show_item=$data[4];
    $cbo_returnable = $data[6];
    $company=$data[0];
    $location=$data[2];
	if($data[7]){$copy_no=$data[7];}else{$copy_no=1;}
	 $is_sales_flag=$data[8]; 
    //$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
    $company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
    $brand_arr=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );
    $department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name");
    $country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
    $buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
    $location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
    $supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
    $image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");

    $section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
    $sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
    $sql="SELECT id, sys_number,company_id,approved,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,vhicle_number,com_location_id,mobile_no,driver_name,security_lock_no,inserted_by,remarks  from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 ";
	
	//echo $sql;die();
    $dataArray=sql_select($sql);
    $basis=$dataArray[0][csf('basis')];
    $within_group=$dataArray[0][csf('within_group')];
    $challan_no=$dataArray[0][csf('challan_no')];
    $sent_to=$dataArray[0][csf('sent_to')];
	$inserted_by=$dataArray[0][csf('inserted_by')];
	$is_approved=$dataArray[0][csf('approved')];
	if($is_approved==1){ $approved_status="Full Approved";}
    else if($is_approved==0){ $approved_status="Un Approved";}
    else{ $approved_status="Partial Approved";}
    $bags_cone_arr=array();
    $prod_id=array();
    $brand_lot_arr=array();
    if($basis==2)
    {
        $sqls="SELECT a.id,a.prod_id,a.no_of_bags,a.cone_per_bag, d.issue_basis from inv_transaction a,inv_gate_pass_mst b,inv_gate_pass_dtls c,inv_issue_master d where a.id=c.challan_no and b.id=c.mst_id and a.transaction_type=2 and a.mst_id=d.id and b.sys_number='$data[1]' group by a.id,a.prod_id,a.no_of_bags,a.cone_per_bag,d.issue_basis ";
        foreach(sql_select($sqls) as $val)
        {
            $bags_cone_arr[$val[csf("id")]]["bags"]=$val[csf("no_of_bags")];
            $bags_cone_arr[$val[csf("id")]]["cone"]=$val[csf("cone_per_bag")];
            $bags_cone_arr[$val[csf("id")]]["prod_id"]=$val[csf("prod_id")];
            $bags_cone_arr[$val[csf("id")]]["issue_basis"]=$val[csf("issue_basis")];
            $prod_id[$val[csf("prod_id")]]=$val[csf("prod_id")];
        }
        $prod_ids=0;
        if(count($prod_id)>0)
        {
            $prod_ids=implode(",", $prod_id);
        }

        $sql2="SELECT  id,brand,lot  from product_details_master where  id in($prod_ids) ";
        foreach(sql_select($sql2) as $val)
        {
            $brand_lot_arr[$val[csf("id")]]["brand"]=$brand_arr[$val[csf("brand")]];
            $brand_lot_arr[$val[csf("id")]]["lot"]=$val[csf("lot")];

        }

    }
    if($within_group==2)
    {
        $send_to_company=$dataArray[0][csf('sent_to')];
    }
    else
    {
        $send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
    }
	
	
	
   
   
    // $copy_no=array(1);
	//    if($cbo_returnable==1){
	//
	//        $copy_no=array(1,2,3);
	//    }else{
	//
	//        $copy_no=array(1,2);
	//    }
    for($cid=1; $cid<=$copy_no; $cid++)
    {
        if($show_item==1){
            $width=1250;
            $colspan=5;		}
        else{
            $width=1150;
            $colspan=5;
            $colspan2=2;
        }
        $address = "";
        $add_info = "";
        $nameArray=sql_select("select plot_no, level_no, road_no, block_no, country_id, province, city, zip_code, email, website from lib_company where id=$data[0]");
        if($nameArray[0][csf('plot_no')] != ''){
            $address.="Plot# ".$nameArray[0][csf('plot_no')].',';
        }
        if($nameArray[0][csf('level_no')] != ''){
            $address.="Level# ".$nameArray[0][csf('level_no')].',';
        }
        if($nameArray[0][csf('road_no')] != ''){
            $address.="Road# ".$nameArray[0][csf('road_no')].',';
        }
        if($nameArray[0][csf('block_no')] != ''){
            $address.="Block# ".$nameArray[0][csf('block_no')].'<br>';
        }
        if($nameArray[0][csf('city')] != ''){
            $address.=$nameArray[0][csf('city')].',';
        }
        if($nameArray[0][csf('zip_code')] != 0 && $nameArray[0][csf('zip_code')] != ''){
            $address.='-'.$nameArray[0][csf('zip_code')].',';
        }
        if($nameArray[0][csf('province')] != ''){
            $address.=$nameArray[0][csf('province')].','.$country_arr[$nameArray[0][csf('country_id')]];
        }
        if($nameArray[0][csf('email')] != 0){
            $add_info.='Email: '.$nameArray[0][csf('email')].', ';
        }
        if($nameArray[0][csf('website')] != 0){
            $add_info.='Website: '.$nameArray[0][csf('website')].',';
        }
        $com_dtls = fnc_company_location_address($company, $location, 2);
        ?>
        <div data-print=section class="print20_data">
            <div style="width:<? echo $width;?>px;" align="center">
                <table style="table-layout: fixed; " width="<? echo $width;?>">
                    <tr>
                        <td rowspan="5" width="300"> <img src="<?=base_url($com_dtls[2]); ?>" height="70" width="200"></td>
                    </tr>
                    <tr style="font-size:xx-large;">
                        <td width="500" style="text-align: center;"><strong><? echo $com_dtls[0]; ?></strong></td>
                        <td width="200" style="text-align: right; padding-right: 7px">
						<span style="font-size:x-large; font-weight: bold;">
						<!-- <? //echo $cid;?><sup><?php// if($cid==1) { echo 'st';} elseif($cid==2) { echo  'nd';} elseif($cid==3){echo 'rd';} else{ echo 'th';} ?></sup> Copy</span><br/> -->
                            <span>
							<?
                            if($cbo_returnable == 1){
                                echo "Returnable";
                            }
                            ?>
						</span>
                        </td>
                    </tr>
                    <tr>
                        <td style="text-align: center;"><?php echo $location_library[$dataArray[0][csf('com_location_id')]]; //echo $com_dtls[1]; ?>
                        </td>
                        <td style="text-align: right; "><span  id="barcode_img_id_<? echo $cid; ?>" ></span></td>
                    </tr>
                    <tr>
                        <td style="text-align: center;"><?php echo $add_info ?></td>
                    </tr>
                    <tr>
                        <td style="text-align: center; font-size:x-large; text-decoration: underline; font-weight: bold;">Gate Pass</td>
						<td width="180" align="center" rowspan="5" style="font-size:18px;color:red;"><?=$approved_status;?> </td>
                    </tr>
                </table>
                <br>
                <table border="1" cellpadding="1" cellspacing="1" style="width:1150px" rules="all">
                    <tr>
                        <td width="160"><strong>Gate Pass ID :</strong></td> <td width="175px"><strong><? echo $dataArray[0][csf('sys_number')]; ?></strong></td>
                        <td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
                        <td width="125"><strong>Challan/System No:</strong></td><td width="175px" colspan="2"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
                    </tr>
                    <tr>
                        <td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
                        <td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
                        <td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
                    </tr>
                    <tr>
                        <td><strong>Sent To:</strong></td><td width="175px"><? echo $send_to_company; ?></td>
                        <td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
                        <td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
                    </tr>
                    <tr>
                      
						<td><strong>To Location:</strong></td><td><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?>
                        </td>
                        <td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
                        <td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
                    </tr>
                    <tr>
                        <td><strong>Est. Return Date 	 :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
                        <td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
                        <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td>

                    </tr>
                    <tr>
						<td><strong>Out-Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
                        <td><strong>Mobile No:</strong></td>
                        <td><? echo $dataArray[0][csf('mobile_no')]; ?></td>
                        <td><strong>Vehicle No:</strong></td>
                        <td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
                    </tr>
					<tr>
                        <td><strong>Driver Name:</strong></td><td><? echo $dataArray[0][csf('driver_name')]; ?>
                        </td>
                        <td><strong>Security Lock No:</strong></td>
                        <td><? echo $dataArray[0][csf('security_lock_no')]; ?></td>
                        <td><strong>Remarks:</strong></td>
                        <td><? echo $dataArray[0][csf('remarks')]; ?></td>
                    </tr>
                </table>
                <br>
                <table align="center" cellspacing="0" width="<? echo $width;?>px;"  border="1" rules="all" class="rpt_table" >
                    <thead bgcolor="#dddddd" align="center">
						<th width="30">SL</th>
						<th width="100" align="center">Item Category</th>
						<?
						if($basis==2)
						{
							?>
							<th width="70" align="center">Brand</th>
							<?
						}
						?>
						<th width="100" align="center">Sample</th>
						<th width="200" align="center">Item Description</th>
						<?
						if($basis==2)
						{
							?>
							<th width="70" align="center">Lot</th>
							<?
						}
						?>
						<th width="50" align="center">UOM</th>
						<th width="80" align="center">Quantity</th>
						<?
						if($show_item==1)
						{
							?>
							<th width="50" align="center">Rate</th>
							<th width="80" align="center">Amount </th>
							<?
						}
						if($basis==2)
						{
							?>
							<th width="70" align="center">No. of Bag/Crtn</th>
							<th width="70" align="center">No.of Cone</th>
							<?
						}
						if ($dataArray[0][csf('basis')]==33)
						{
							?>
							<th width="100" align="center">Customer Buyer</th>
							<?
						}
						else
						{
							?>
							<th width="100" align="center">Buyer</th>
							<?
						}
						?>
						<th width="100" align="center">Style</th>
						<th width="80" align="center">Buyer/ Sales Order </th>
						<?
							if($basis==12)
							{
								?>
								<th width="60" align="center">Total Carton Qty</th>
								<?
							}
							else
							{
								?>
								<th width="70" align="center">No Of Carton</th>
								<th width="70" align="center">No Of Bag/Roll/GMT</th>
								<?
							}
						?>
						<th align="center">Remarks</th>
                    </thead>
					<tbody>
                    <?
                    $i=1;
                    $gate_id=$dataArray[0][csf('id')];
                    $sql_dtls= " SELECT id,item_category_id,sample_id, item_description,uom_qty, quantity, uom, rate, amount,buyer_order_id,buyer_order, remarks, challan_no, total_carton_qty, no_of_bags from  inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 order by id";
					//echo $sql_dtls;
					$sql_result=sql_select($sql_dtls);
                    if($data[4]==8) //subcon challan (grey fabric)
                    {
                        // $sql_result_subcon_grey=sql_select($sql_dtls);
                        $buyer_orderIDs="";
                        foreach($sql_result as $row)
                        {
                            $buyer_orderIDs.=$row[csf('buyer_order')].",";
                        }
                        $buyer_orderID=chop($buyer_orderIDs,',');

                        $sql_subcon_order_buyer=sql_select("select order_no,cust_buyer from subcon_ord_dtls where order_no in('$buyer_orderID') and status_active=1 and is_deleted=0");
                        foreach($sql_subcon_order_buyer as $row)
                        {
                            $subcon_buyer_arr[$row[csf('order_no')]]['cust_buyer']=$row[csf('cust_buyer')];
                        }
                    }
					if($basis==2)
					{
						$buyer_orderIDs="";
						foreach($sql_result as $row)
                        {
                            $buyer_orderIDs.=$row[csf('buyer_order_id')].",";
                        }
                        $buyer_orderID=chop($buyer_orderIDs,',');
						$jobData = sql_select("SELECT id, job_no, style_ref_no, customer_buyer from fabric_sales_order_mst where id in($buyer_orderID) and status_active=1 and is_deleted=0");
						foreach ($jobData as $row)
						{
							$job_no_array[$row[csf('id')]]['job_no'] = $row[csf('job_no')];
							$job_no_array[$row[csf('id')]]['style_ref'] = $row[csf('style_ref_no')];
							$job_no_array[$row[csf('id')]]['customer_buyer'] = $row[csf('customer_buyer')];
						}
					}
					 
					$order_array=array();
					if($is_sales_flag==1)
					{
						
							$buyer_orderIDs="";
							foreach($sql_result as $row)
							{
								$buyer_orderIDs.=$row[csf('buyer_order_id')].",";
							}
                       		 $buyer_orderID=chop($buyer_orderIDs,',');
						   $order_sql="select id, style_ref_no,buyer_id,customer_buyer from  fabric_sales_order_mst where id in($buyer_orderID) and status_active=1 and is_deleted=0";
							$order_sql_result=sql_select($order_sql);
							foreach ($order_sql_result as $row)
							{
								//$order_array[$row[csf('id')]]['buyer_name']=$buyer_library[$row[csf('buyer_id')]];
								$order_array[$row[csf('id')]]['buyer_name']=$row[csf('customer_buyer')];
								$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
							}
					
					}
					else
					{
						 $order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
						 $order_sql_result=sql_select($order_sql);
						foreach ($order_sql_result as $row)
						{
							$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
							$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
						}
					
					}
												
						 

                    $uom_check=array();
                    $tot_qty=0;$tot_amount=0;
					$tot_crtn=$tot_bag=0;
					if($basis==2)$colspan+=2;
                    foreach($sql_result as $row)
                    {
                        $ref_id=$row[csf("challan_no")];
                        if ($i%2==0)
                            $bgcolor="#E9F3FF";
                        else
                            $bgcolor="#FFFFFF";

                        $buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
                        $style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
                        //if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
						if(!in_array($row[csf('uom')],$uom_check))
						{
							$uom_check[$row[csf('uom')]]=$row[csf('uom')];
							if($i!=1 && $basis!=12)
							{
								?>
								<tr>
									<td colspan="<? echo $colspan;?>" align="right"> <b>Sub Total</b></td>
									<td align="right"><b><? echo number_format($sub_tot_qty,2);?></b> </td>
									<?
									if($basis==2)
									{
										?>
										<td colspan="2"></td>
										<?
									}
									if($show_item==1)
									{
										?>
										<td> </td>
										<td align="right"><b> <? echo number_format($sub_tot_amount,2);?></b> </td>
										<?
									}
									?>
									<td colspan="3"></td>
									<?
										if($basis==12)
										{
											?>
											<td align="right"><b></b></td>
											<?
										}
										else
										{
											?>
											<td align="right"><b></b></td>
											<td align="right"><b></b></td>
											<?
										}
									?>
									<td></td>
								</tr>
								<?
							}
							$sub_tot_qty=$sub_tot_amount=$sub_tot_crtn=$sub_tot_bag=0;
						}
                        ?>
                        <tr bgcolor="<? echo $bgcolor; ?>">
                            <td><? echo $i; ?></td>
                            <td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
                            <?
                            if($basis==2)
                            {
                                ?>
                                <td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["brand"]; ?></td>
                                <?
                            }
                            ?>
                            <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
                            <td><?  echo $row[csf('item_description')]; ?></td>
                            <?
                            if($basis==2)
                            {
                                ?>
                                <td align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["lot"]; ?></td>
                                <?
                            }
                            ?>

                            <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
                            <td align="right"><? echo $row[csf('quantity')]; ?></td>
                            <?
							
							if($show_item==1)
                            {
                                ?>
                                <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
                                <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
                                <?
                            }
                            if($basis==2)
                            {
                                ?>
                                <td align="center"><? echo $bags_cone_arr[$ref_id]["bags"];?></td>
                                <td align="center"><? echo $bags_cone_arr[$ref_id]["cone"];?></td>
                                <?
                            }

                            ?>
                            <td align="center"><?
                                if($data[4]==8)
                                {
                                    echo $subcon_buyer_arr[$row[csf('buyer_order')]]['cust_buyer'];
                                }
                                else if($basis==2 || $bags_cone_arr[$ref_id]["issue_basis"]==3)
                                {
                                    echo $buyer_library[$job_no_array[$row[csf('buyer_order_id')]]['customer_buyer']];
                                }
                                else
                                {
                                    echo $buyer_library[$buyer];
                                }
                                ?>
							</td>
                            <td><? if($basis==2 || $bags_cone_arr[$ref_id]["issue_basis"]==3){echo $job_no_array[$row[csf('buyer_order_id')]]['style_ref'];}else{echo $style_ref_no;} ?></td>
                            <td><? if($basis==2 || $bags_cone_arr[$ref_id]["issue_basis"]==3){echo $job_no_array[$row[csf('buyer_order_id')]]['job_no'];}else{echo $row[csf('buyer_order')];} ?></td>
							<?
								if($basis==12)
								{
									?>
									<td align="right"><?=$row['TOTAL_CARTON_QTY'];?></td>
									<?
								}
								else
								{
									?>
									<td align="right"><?=$row['TOTAL_CARTON_QTY'];?></td>
									<td align="right"><?=$row['NO_OF_BAGS'];?></td>
									<?
								}
							?>
                            <td><? echo $row[csf('remarks')]; ?></td>
                        </tr>
                        <?php
                        $i++;

                        $tot_qty+=$row[csf('quantity')];
                        $tot_amount+=$row[csf('amount')];
						$tot_crtn+=$row['TOTAL_CARTON_QTY'];
						$tot_bag+=$row['NO_OF_BAGS'];

                        $sub_tot_qty+=$row['QUANTITY'];
                        $sub_tot_amount+=$row['AMOUNT'];
						// $sub_tot_crtn+=$row['TOTAL_CARTON_QTY'];
						// $sub_tot_bag+=$row['NO_OF_BAGS'];
                    }
                    //$tot_check=array();
                    
                    // if(count($uom_check)==1)
                    // {
						if($basis!=12)
						{
                        ?>
							<tr>
								<td colspan="<? echo $colspan;?>" align="right"> <b>Sub Total</b></td>
								<td align="right"><b><? echo number_format($sub_tot_qty,2);?></b> </td>
								<?
								if($show_item==1)
								{
									?>
									<td> </td>
									<td align="right"><b> <? echo number_format($sub_tot_amount,2);?></b> </td>
									<?
								}
								if($basis==2)
								{
									?>
									<td colspan="2"></td>
									<?
								}
								?>
								<td colspan="3"></td>
								<?
									if($basis==12)
									{
										?>
										<td align="right"><b></b></td>
										<?
									}
									else
									{
										?>
										<td align="right"><b></b></td>
										<td align="right"><b></b></td>
										<?
									}
								?>
								<td></td>
							</tr>
						<?
							}
						?>
						</tbody>
                        <tfoot bgcolor="#CCCCCC">
							<tr>
								<td colspan="<? echo $colspan;?>" align="right"> <b>Grand Total</b></td>
								<td align="right"><b><? echo number_format($tot_qty,2);?></b> </td>
								<?
								if($show_item==1)
								{
									?>
									<td> </td>
									<td align="right"><b> <? echo number_format($tot_amount,2);?></b> </td>
									<?
								}
								if($basis==2)
								{
									?>
									<td colspan="2"></td>

									<?
								}
								?>
								<td colspan="3"></td>
								<?
									if($basis==12)
									{
										?>
										<td align="right"><b><? echo number_format($tot_crtn,2);?></b></td>
										<?
									}
									else
									{
										?>
										<td align="right"><b><? echo number_format($tot_crtn,2);?></b></td>
										<td align="right"><b><? echo number_format($tot_bag,2);?></b></td>
										<?
									}
								?>
								<td></td>
							</tr>
                        </tfoot>
                        <?
                    // }
                    $width_sign=$width.'px';
                    ?>
                </table>
            </div>
            <? 
			 
			$appSql = "select a.APPROVED_BY, a.APPROVED_DATE,b.USER_FULL_NAME,c.CUSTOM_DESIGNATION from approval_mst a,USER_PASSWD b,LIB_DESIGNATION c where a.mst_id ={$dataArray[0][csf('id')]} and a.APPROVED_BY=b.id and b.DESIGNATION=c.id and c.STATUS_ACTIVE=1 and c.IS_DELETED=0 and b.STATUS_ACTIVE=1 and b.IS_DELETED=0
			union all
			select b.id as APPROVED_BY, a.INSERT_DATE as APPROVED_DATE,b.USER_FULL_NAME,c.CUSTOM_DESIGNATION from INV_GATE_PASS_MST a,USER_PASSWD b,LIB_DESIGNATION c where a.id ={$dataArray[0][csf('id')]} and a.INSERTED_BY=b.id and b.DESIGNATION=c.id and c.STATUS_ACTIVE=1 and c.IS_DELETED=0 and b.STATUS_ACTIVE=1 and b.IS_DELETED=0";
			// echo $appSql;die;
			$appSqlRes=sql_select($appSql);
			$userDtlsArr=array();
			foreach($appSqlRes as $row){
				$userDtlsArr[$row['APPROVED_BY']]="<div><b>".$row['USER_FULL_NAME']."</b></div><div><b>".$row['CUSTOM_DESIGNATION']."</b></div><div><small>".$row['APPROVED_DATE']."</small></div>";
			}
			echo get_app_signature(114, $data[0], $width_sign,$template_id, 50,$inserted_by,$userDtlsArr); 

			?>
        </div>
        <script type="text/javascript" src="../../js/jquery.js"></script>
        <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
        <script>
            function generateBarcode( valuess ){
                var value = valuess;
                var btype = 'code39';
                var renderer ='bmp';
                var settings = {
                    output:renderer,
                    bgColor: '#FFFFFF',
                    color: '#000000',
                    barWidth: 1,
                    barHeight: 30,
                    moduleSize:5,
                    posX: 10,
                    posY: 20,
                    addQuietZone: 1
                };
                $("#barcode_img_id_<? echo $cid; ?>").html('11');
                value = {code:value, rect: false};
                $("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
            }
            generateBarcode('<? echo $data[1]; ?>');
        </script>
        <?
    }
    ?>
    <script type="text/javascript">
        var staticHeight = 0;
        var pageHeight = 880;
        $('.print20_data').each(function() {
            staticHeight += $(this).filter(':visible').outerHeight(true);
            if (staticHeight > pageHeight) {
                $(this).after( '<p style="page-break-after:always;"></p>');
                staticHeight = 0;
            }
            else{
               // $(this).after( '<hr style="border-top: dotted 2px #000">');
                $(this).css({
                    "height": "auto",
                    "margin-bottom": "2px"
                });
                //$(this).css('height', "680px");
                $('.print20_data').addClass("devider");
            }

        });
    </script>
    <style type="text/css">
        .devider:nth-of-type(2){
            margin-top: 40px;
        }
    </style>
    <?
    exit();
}

if ($action=="get_pass_entry_print11") // Print 11
{
	extract($_REQUEST);
	$data=explode('*',$data);
	// echo "<pre>";
	// print_r($data);	
	$show_item=$data[4];
	$cbo_returnable = $data[6];
	$company=$data[0];
	$location=$data[2];
	//$user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$brand_arr=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name");
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");

	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );	
	$sql="SELECT id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,vhicle_number,com_location_id,mobile_no,delivery_company,remarks,issue_id,inserted_by,security_lock_no from inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 ";
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	$issue_id=$dataArray[0][csf('issue_id')];
	$inserted_by=$dataArray[0][csf('inserted_by')];

	$bags_cone_arr=array();
	$prod_id=array();
	$brand_lot_arr=array();
	if($basis==2)
	{
		$sqls="SELECT a.id,a.prod_id,a.no_of_bags,a.cone_per_bag from inv_transaction a,inv_gate_pass_mst b,inv_gate_pass_dtls c where a.id=c.challan_no and b.id=c.mst_id  and b.sys_number='$data[1]' group by a.id,a.prod_id,a.no_of_bags,a.cone_per_bag ";
		foreach(sql_select($sqls) as $val)
		{
			$bags_cone_arr[$val[csf("id")]]["bags"]=$val[csf("no_of_bags")];
			$bags_cone_arr[$val[csf("id")]]["cone"]=$val[csf("cone_per_bag")];
			$bags_cone_arr[$val[csf("id")]]["prod_id"]=$val[csf("prod_id")];
			$prod_id[$val[csf("prod_id")]]=$val[csf("prod_id")];
		}
		$prod_ids=0;
		if(count($prod_id)>0)
		{
			$prod_ids=implode(",", $prod_id);
		}

		$sql2="SELECT  id,brand,lot  from product_details_master where  id in($prod_ids) ";
		foreach(sql_select($sql2) as $val)
		{
			$brand_lot_arr[$val[csf("id")]]["brand"]=$brand_arr[$val[csf("brand")]];
			$brand_lot_arr[$val[csf("id")]]["lot"]=$val[csf("lot")];
			 
		}

	}	
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}	
	// if($cbo_returnable==1){

		$copy_no=array(1,2,3); 
	// }else{

	// 	$copy_no=array(1,2); 
	// }
	foreach($copy_no as $cid)
	{
		if($show_item==1){
			$width=1150;
			$colspan=5;		}
		else{
			$width=1150;
			$colspan=5;
			$colspan2=2;
		}
		$address = "";
		$add_info = "";
		$nameArray=sql_select("select plot_no, level_no, road_no, block_no, country_id, province, city, zip_code, email, website from lib_company where id=$data[0]");
		if($nameArray[0][csf('plot_no')] != ''){
			$address.="Plot# ".$nameArray[0][csf('plot_no')].',';
		}
		if($nameArray[0][csf('level_no')] != ''){
			$address.="Level# ".$nameArray[0][csf('level_no')].',';
		}
		if($nameArray[0][csf('road_no')] != ''){
			$address.="Road# ".$nameArray[0][csf('road_no')].',';
		}
		if($nameArray[0][csf('block_no')] != ''){
			$address.="Block# ".$nameArray[0][csf('block_no')].'<br>';
		}
		if($nameArray[0][csf('city')] != ''){
			$address.=$nameArray[0][csf('city')].',';
		}
		if($nameArray[0][csf('zip_code')] != 0 && $nameArray[0][csf('zip_code')] != ''){
			$address.='-'.$nameArray[0][csf('zip_code')].',';
		}
		if($nameArray[0][csf('province')] != ''){
			$address.=$nameArray[0][csf('province')].','.$country_arr[$nameArray[0][csf('country_id')]];
		}
		if($nameArray[0][csf('email')] != 0){
			$add_info.='Email: '.$nameArray[0][csf('email')].', ';
		}
		if($nameArray[0][csf('website')] != 0){
			$add_info.='Website: '.$nameArray[0][csf('website')].',';
		}
		$com_dtls = fnc_company_location_address($company, $location, 2);
		?>
		<div data-print=section class="print11_data">
			<div style="width:<? echo $width;?>px;" align="center">
			    <table style="table-layout: fixed; " width="<? echo $width;?>">
					<tr>
						<td rowspan="5" width="300"> <img src="<?=base_url($com_dtls[2]); ?>" height="45" width="45"></td>
					</tr>
					<tr style="font-size:xx-large;">
						<td width="500" style="text-align: center;"><strong><? echo $com_dtls[0]; ?></strong></td>
						<td width="200" style="text-align: right; padding-right: 7px">
						<span style="font-size:x-large; font-weight: bold;">
						<? echo $cid;?><sup><?php if($cid==1) { echo 'st';} elseif($cid==2) { echo  'nd';} else{ echo 'rd';} ?></sup> Copy</span><br/>
						<span>
							<?
								if($cbo_returnable == 1){
									echo "Returnable";
								}
							?>
						</span>
						</td>
					</tr>
					<tr>				
						<td style="text-align: center;"><?php echo $location_library[$location]; //$com_dtls[1]; ?>
						</td>
						<td style="text-align: right; "><span  id="barcode_img_id_<? echo $cid; ?>" ></span></td>
					</tr>
					<tr>			
						<td style="text-align: center;"><?php echo $add_info ?></td>
					</tr>
					<tr>
						<td style="text-align: center; font-size:x-large; text-decoration: underline; font-weight: bold;">Gate Pass</td>
					</tr>
				</table>
				<br>
			    <table border="1" cellpadding="1" cellspacing="1" style="width:1150px" rules="all">
			        <tr>
			            <td width="140"><strong>System ID:</strong></td> <td width="155px"><? echo $dataArray[0][csf('sys_number')]; ?></td>
			            <td width="100"><strong>Basis:</strong></td><td width="155px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
			            <td width="135" colspan="2"><strong>Challan/System No:</strong></td><td width="165px" colspan="2"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
					
			        </tr>
			        <tr>	            
			            <td width="140"><strong>Department:</strong></td> <td width="155px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
						<td width="100"><strong>Out-Time:</strong></td><td width="155px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
			            <td width="135"><strong>Sent By:</strong></td> <td width="165px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
			            <td><strong>Sent To:</strong></td><td width="155px"><? echo $send_to_company; ?></td>
			        </tr>
			        <tr>
			           
						<td width="140"><strong>Vehicle Number :</strong></td><td width="155px" ><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
			            <td width="100"><strong>Out Date:</strong></td><td width="155px" ><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
						<td width="135"><strong>Est. Return Date :</strong></td><td width="165px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
						<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
			        </tr>
			        <tr>
						<td width="140"><strong>To Location:</strong></td><td width="155px"><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?>			        	
				        </td>
						<td width="100"><strong>Purpose:</strong></td><td width="155px" ><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
						
			            <td width="135"><strong>Security Lock No :</strong></td><td width="165px"><? echo $dataArray[0][csf('security_lock_no')]; ?></td>
			            <td width="135"><strong>Remarks :</strong></td><td width="165px"><? echo $dataArray[0][csf('remarks')]; ?></td>
			        </tr>
			      
			    </table>
			    <br>
			    <table align="center" cellspacing="0" width="<? echo $width;?>px;"  border="1" rules="all" class="rpt_table" >
			        <thead bgcolor="#dddddd" align="center">
			            <th width="30">SL</th>
			            <th width="100" align="center">Item Category</th>
			            <? 
			            if($basis==2)
			            {
			            	?>
			            	<th width="70" align="center">Brand</th>
			            	<?

			            }
			            ?>
			            <th width="100" align="center">Sample</th>
			            <th width="200" align="center">Item Description</th>
			            <? 
			            if($basis==2)
			            {
			            	?>
			            	<th width="70" align="center">Lot</th>
			            	<?

			            }
			            ?>
			            <th width="50" align="center">UOM</th>
			            <th width="80" align="center">Quantity</th>
			            <? 
			            if($basis==2)
			            {
			            	?>
			            	<th width="70" align="center">No. of Bag/Crtn</th>
			            	<th width="70" align="center">No.of Cone</th>
			            	 
			            	<?

			            }
			            
			            if($show_item==1)
						{
						?>
			            <th width="50" align="center">Rate</th> 
			            <th width="80" align="center">Amount </th>
			            <?
						}
						if ($dataArray[0][csf('basis')]==33) 
						{
						?>
							<th width="100" align="center">Customer Buyer</th>
						<?
						}
						else
						{
						?>
			            	<th width="100" align="center">Buyer</th>
						<?
						}
						?>
			            <th width="100" align="center">Style</th>
			            <th width="80" align="center">Buyer Order </th>
			            <th align="center">Remarks</th>
			        </thead>
				<?
			    $i=1;
				$gate_id=$dataArray[0][csf('id')];
				$sql_dtls= " SELECT id,item_category_id,sample_id, item_description,uom_qty, quantity, uom, rate, amount,buyer_order_id,buyer_order, remarks,challan_no from  inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 ";
				if($basis==8) //subcon challan (grey fabric)
				{
					$sql_result_subcon_grey=sql_select($sql_dtls);
					$buyer_orderIDs="";
					foreach($sql_result_subcon_grey as $row)
					{
						$buyer_orderIDs.=$row[csf('buyer_order')].',';
					}
					$buyer_orderID=chop($buyer_orderIDs,',');
					
					$sql_subcon_order_buyer=sql_select("select order_no,cust_buyer from subcon_ord_dtls where order_no in('$buyer_orderID') and status_active=1 and is_deleted=0");
					foreach($sql_subcon_order_buyer as $row)
					{
						$subcon_buyer_arr[$row[csf('order_no')]]['cust_buyer']=$row[csf('cust_buyer')];
					}
				}
				elseif($basis==9) //SubCon Dyeing And Finishing Delivery
				{
					$sql_result_subcon_grey=sql_select($sql_dtls);
					$buyer_orderIDs="";
					foreach($sql_result_subcon_grey as $row)
					{
						$buyer_orderIDs.=$row[csf('buyer_order_id')].',';
					}
					$buyer_orderID=chop($buyer_orderIDs,',');
					
					$sql_subcon_order_buyer=sql_select("SELECT a.party_id as PARTY_ID, b.order_id as ORDER_ID from subcon_delivery_mst a,subcon_delivery_dtls b where a.id=b.mst_id and a.id in($issue_id) and b.order_id in($buyer_orderID) and a.status_active=1 and b.status_active=1 ");
					foreach($sql_subcon_order_buyer as $row)
					{
						$subcon_buyer_arr[$row['ORDER_ID']]['cust_buyer']=$buyer_library[$row['PARTY_ID']];
					}
				}
				
				//echo $sql_dtls;
				$uom_check=array();
				$sql_result=sql_select($sql_dtls);
				$tot_rows = count($sql_result);
				$tot_qty=0;$tot_amount=0;
				foreach($sql_result as $row)
				{
					$ref_id=$row[csf("challan_no")];
					if ($i%2==0)  
						$bgcolor="#E9F3FF";
					else
						$bgcolor="#FFFFFF";
						
						$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
						$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
						//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
						$uom_check[$row[csf('uom')]]=$row[csf('uom')];
						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
			                <td><? echo $i; ?></td>
			                <td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
			                <? 
			                if($basis==2)
			                {
			                	?>
			                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["brand"]; ?></td>
			                	<?

			                }
			                ?>
			                <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
			                <td><?  echo $row[csf('item_description')]; ?></td>
			                <? 
			                if($basis==2)
			                {
			                	?>
			                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["lot"]; ?></td>
			                	<?

			                }
			                ?>

			                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
			                <td align="right"><? echo $row[csf('quantity')]; ?></td>
			                <? 
			                if($basis==2)
			                {
			                	?>
			                	<td width="70" align="center"><? echo $bags_cone_arr[$ref_id]["bags"];?></td>
			                	<td width="70" align="center"><? echo $bags_cone_arr[$ref_id]["cone"];?></td>
			                	 
			                	<?

			                }
			                 
							if($show_item==1)
							{
							?>
			                <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
			                <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
			                <?
							}
							?>
			                <td align="center"><? 
							if($basis==8)
							{
								echo $subcon_buyer_arr[$row[csf('buyer_order')]]['cust_buyer'];
							}
							elseif($basis==9)
							{
								echo $subcon_buyer_arr[$row[csf('buyer_order_id')]]['cust_buyer'];
							}
							else
							{
								echo $buyer_library[$buyer]; 
							}
							?></td>
			                <td><? echo $style_ref_no; ?></td>
			                <td><? echo $row[csf('buyer_order')]; ?></td>
			                <td><? echo $row[csf('remarks')]; ?></td>
						</tr>
					<?php
			    	$i++;
					
					$tot_qty+=$row[csf('quantity')];
					$tot_amount+=$row[csf('amount')];
			    }
				//$tot_check=array();
				if($basis==2)$colspan+=2;
				if(count($uom_check)==1)
				{

				?>
			    <tfoot bgcolor="#CCCCCC">
			        <tr>
			        <td colspan="<? echo $colspan;?>" align="right"> <b> Total</b></td>
			        <td align="right"><b><? echo number_format($tot_qty,2);?></b> </td>
			          <?
			        if($basis==2)
			        {
			        	?>
			        	<td colspan="2"></td>

			        	<?
			        }
					if($show_item==1)
					{
					?>
			        <td> </td>
			        <td align="right"><b> <? echo number_format($tot_amount,2);?></b> </td>
			        <?
						}
					?>
			        <td colspan="<? echo 4+$colspan2;?>"></td>
			        </tr>
				</tfoot>
			    <?
				}
				$width_sign=$width.'px';
				?>
			    </table>
			</div>
			
			<?
			   echo signature_table(114, $data[0], $width_sign,$template_id, 20,$inserted_by); 
			 ?>	
					
		</div>			    
			<script type="text/javascript" src="../../js/jquery.js"></script>
			<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
			<script>
				function generateBarcode( valuess ){					   
						var value = valuess;
						var btype = 'code39';
						var renderer ='bmp';						 
						var settings = {
						  output:renderer,
						  bgColor: '#FFFFFF',
						  color: '#000000',
						  barWidth: 1,
						  barHeight: 30,
						  moduleSize:5,
						  posX: 10,
						  posY: 20,
						  addQuietZone: 1
						};
						$("#barcode_img_id_<? echo $cid; ?>").html('11');
						 value = {code:value, rect: false};						
						$("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
					} 
				 generateBarcode('<? echo $data[1]; ?>');
			</script>
		<?
	}
	?>	
	<script type="text/javascript">
		var tot_rows = <? echo $tot_rows;?>;
		$('.print11_data').each(function() {
		    console.log(tot_rows)
		    if (tot_rows > 3) {
		        $(this).after( '<p style="page-break-after:always;"></p>');	
		    }
		    else{
		    	$(this).after( '<hr class="hr_divider" style="border-top: dotted 2px #000">');
		    	$(this).css({
					"height": "510px",
					"margin-bottom": "20px"
					});
		    	//$(this).css('height', "680px");
		    	$('.print11_data').addClass("devider");
		    }

		});
	</script>
	<style type="text/css">		
		.devider:nth-of-type(3){
			margin-top: 30px;
		}
		.hr_divider:nth-of-type(3){
			display: none;
		}
	</style>
	<?
	exit();
}

if ($action=="get_out_entry_printamt") // Print AMT
{
	extract($_REQUEST);
	$data=explode('*',$data);
	// echo "<pre>";
	// print_r($data);	
	$show_item=$data[4];
	$cbo_returnable = $data[6];
	$company=$data[0];
	$location=$data[2];
	
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$brand_arr=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name");
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");

	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );	
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,vhicle_number,com_location_id,mobile_no from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 ";
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	$bags_cone_arr=array();
	$prod_id=array();
	$brand_lot_arr=array();
	if($basis==2)
	{
		$sqls="SELECT a.id,a.prod_id,a.no_of_bags,a.cone_per_bag from inv_transaction a,inv_gate_pass_mst b,inv_gate_pass_dtls c where a.id=c.challan_no and b.id=c.mst_id  and b.sys_number='$data[1]' group by a.id,a.prod_id,a.no_of_bags,a.cone_per_bag ";
		foreach(sql_select($sqls) as $val)
		{
			$bags_cone_arr[$val[csf("id")]]["bags"]=$val[csf("no_of_bags")];
			$bags_cone_arr[$val[csf("id")]]["cone"]=$val[csf("cone_per_bag")];
			$bags_cone_arr[$val[csf("id")]]["prod_id"]=$val[csf("prod_id")];
			$prod_id[$val[csf("prod_id")]]=$val[csf("prod_id")];
		}
		$prod_ids=0;
		if(count($prod_id)>0)
		{
			$prod_ids=implode(",", $prod_id);
		}

		$sql2="SELECT  id,brand,lot  from product_details_master where  id in($prod_ids) ";
		foreach(sql_select($sql2) as $val)
		{
			$brand_lot_arr[$val[csf("id")]]["brand"]=$brand_arr[$val[csf("brand")]];
			$brand_lot_arr[$val[csf("id")]]["lot"]=$val[csf("lot")];
			 
		}

	}	
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
    // New SQL
	$gate_id=$dataArray[0][csf('id')];
				$sql_dtls= " SELECT id,item_category_id,sample_id, item_description,uom_qty, quantity, uom, rate, amount,buyer_order_id,buyer_order, remarks,challan_no from  inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 ";
				if($data[4]==8) //subcon challan (grey fabric)
				{
					$sql_result_subcon_grey=sql_select($sql_dtls);
					$buyer_orderIDs="";
					foreach($sql_result_subcon_grey as $row)
					{
						$buyer_orderIDs.=$row[csf('buyer_order')];
					}
					$buyer_orderID=chop($buyer_orderIDs,',');
					
					$sql_subcon_order_buyer=sql_select("select order_no,cust_buyer from subcon_ord_dtls where order_no in('$buyer_orderID') and status_active=1 and is_deleted=0");
					foreach($sql_subcon_order_buyer as $row)
					{
						$subcon_buyer_arr[$row[csf('order_no')]]['cust_buyer']=$row[csf('cust_buyer')];
					}
				}
				$uom_check=array();
				$sql_result_uom=sql_select($sql_dtls);
	// SQL end
	$sql_emb="select id, company_id, challan_no, po_break_down_id, item_number_id, country_id, production_source, serving_company, location, embel_name, embel_type,production_date, production_quantity, production_type, remarks, floor_id from pro_garments_production_mst where production_type=2 and id in($challan_no) and status_active=1 and is_deleted=0 ";
	// echo $sql_emb;
	$dataArrayEmb=sql_select($sql_emb);
	$sql_color_type=sql_select("SELECT color_type_id from pro_garments_production_dtls where status_active=1 and is_deleted=0 and mst_id='$challan_no' and production_type=2");
	$color_type_id=$sql_color_type[0][csf("color_type_id")];

	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}	
	if($cbo_returnable==1){

		$copy_no=array(1,2,3); 
	}else{

		$copy_no=array(1,2,3); 
	}
	foreach($copy_no as $cid)
	{
		if($show_item==1){
			$width=1300;
			$colspan=5;		}
		else{
			$width=1300;
			$colspan=5;
			$colspan2=2;
		}
		$address = "";
		$add_info = "";
		$nameArray=sql_select("select plot_no, level_no, road_no, block_no, country_id, province, city, zip_code, email, website from lib_company where id=$data[0]");
		if($nameArray[0][csf('plot_no')] != ''){
			$address.="Plot# ".$nameArray[0][csf('plot_no')].',';
		}
		if($nameArray[0][csf('level_no')] != ''){
			$address.="Level# ".$nameArray[0][csf('level_no')].',';
		}
		if($nameArray[0][csf('road_no')] != ''){
			$address.="Road# ".$nameArray[0][csf('road_no')].',';
		}
		if($nameArray[0][csf('block_no')] != ''){
			$address.="Block# ".$nameArray[0][csf('block_no')].'<br>';
		}
		if($nameArray[0][csf('city')] != ''){
			$address.=$nameArray[0][csf('city')].',';
		}
		if($nameArray[0][csf('zip_code')] != 0 && $nameArray[0][csf('zip_code')] != ''){
			$address.='-'.$nameArray[0][csf('zip_code')].',';
		}
		if($nameArray[0][csf('province')] != ''){
			$address.=$nameArray[0][csf('province')].','.$country_arr[$nameArray[0][csf('country_id')]];
		}
		if($nameArray[0][csf('email')] != 0){
			$add_info.='Email: '.$nameArray[0][csf('email')].', ';
		}
		if($nameArray[0][csf('website')] != 0){
			$add_info.='Website: '.$nameArray[0][csf('website')].',';
		}
		$com_dtls = fnc_company_location_address($company, $location, 2);
		?>
		<div data-print=section class="print6_data">
			<div style="width:<? echo $width;?>px;" align="center">
			    <table style="table-layout: fixed; " width="<? echo $width;?>">
					<tr>
						<td rowspan="5" width="450"><img src="<?=base_url($com_dtls[2]); ?>" height="70" width="200"></td>
					</tr>
					<tr style="font-size:xx-large;">
						<td width="500" style="text-align: center;"><strong><? echo $com_dtls[0]; ?></strong></td>
						<td width="200" style="text-align: right; padding-right: 7px">
						<span style="font-size:x-large; font-weight: bold;">
						<? echo $cid;?><sup><?php if($cid==1) { echo 'st';} elseif($cid==2) { echo  'nd';} else{ echo 'rd';} ?></sup> Copy</span><br/>
						<span>
							<?
								if($cbo_returnable == 1){
									echo "Returnable";
								}
							?>
						</span>
						</td>
					</tr>
					<tr>				
						<td style="text-align: center;"><?php echo $com_dtls[1]; ?>
						</td>
						<!-- <td style="text-align: right; "><span  id="barcode_img_id_<? echo $cid; ?>" ></span></td> -->
					</tr>
					<tr>			
						<td style="text-align: center;"><?php echo $add_info ?></td>
					</tr>
					<tr>
						<td style="text-align: center; font-size:x-large; text-decoration: underline; font-weight: bold;">Gate Pass</td>
					</tr>
				</table>
				<br>
			    <table border="1" cellpadding="1" cellspacing="1" style="width:1300px" rules="all">
			        <tr>
			            <td width="100"><strong>System ID:</strong></td> <td width="130px"><? echo $dataArray[0][csf('sys_number')]; ?></td>
			            <td width="100"><strong>Basis:</strong></td><td width="120px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
			            <td width="140"><strong>Challan/System No:</strong></td><td width="120px"><? echo $challan_no;?></td>
			            <td width="100"><strong> </strong></td><td width="120px"> </td>
			            <td width="100"><strong>Attention:</strong></td><td width="120px"> <? echo $dataArray[0][csf('attention')]; ?> </td>
			        </tr>
			        <tr>	            
			            <td><strong>Department:</strong></td> <td><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
			            <td><strong>Section:</strong></td><td><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
			            <td><strong>Sent By:</strong></td> <td><? echo $dataArray[0][csf('sent_by')]; ?></td>
			            <td><strong>Sent To:</strong></td> <td><? echo $send_to_company; ?></td>
			            <td><strong> </strong></td> <td> </td>
			        </tr>
			        <tr>
			            <td><strong>Out Date:</strong></td><td><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
						<td><strong>Out-Time:</strong></td><td><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
						<td><strong>Returnable :</strong></td><td><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
						<td><strong>Delivery As:</strong></td><td><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
						<td><strong>Est. Return Date 	 :</strong></td><td><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
			        </tr>
			        <tr>		          
					    <td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
			            <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
						<td><strong>To Location:</strong></td><td><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
						<td><strong>Mobile No:</strong></td><td><? echo $dataArray[0][csf('mobile_no')]; ?></td>
						<td><strong>Vehicle No:</strong></td><td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
			        </tr>
			        <tr>
			            <td><strong>Item:</strong></td><td><? echo $garments_item[$dataArrayEmb[0][csf('item_number_id')]]; ?></td>
			            <td><strong>Emb. Source:</strong></td><td><? echo $knitting_source[$dataArrayEmb[0][csf('production_source')]]; ?></td>
			            <td><strong>Emb.Type:</strong></td><td>
						    <? 
								if ($dataArrayEmb[0][csf('embel_name')]==1) echo $emblishment_print_type[$dataArrayEmb[0][csf('embel_type')]]; 
								elseif ($dataArrayEmb[0][csf('embel_name')]==2) echo $emblishment_embroy_type[$dataArrayEmb[0][csf('embel_type')]]; 
								elseif ($dataArrayEmb[0][csf('embel_name')]==3) echo $emblishment_wash_type[$dataArrayEmb[0][csf('embel_type')]]; 
								elseif ($dataArrayEmb[0][csf('embel_name')]==4) echo $emblishment_spwork_type[$dataArrayEmb[0][csf('embel_type')]]; 
								elseif ($dataArrayEmb[0][csf('embel_name')]==5) echo $emblishment_gmts_type[$dataArrayEmb[0][csf('embel_type')]]; 
						    ?>
						</td>  
			            <td><strong>Emb. Name:</strong></td><td><? echo $emblishment_name_array[$dataArrayEmb[0][csf('embel_name')]]; ?></td>  
			            <td><strong>Color Type:</strong></td><td><? echo $color_type[$color_type_id]; ?></td>  
			        </tr>
			    </table>
			    <br>

                <?
					$mst_id=$dataArrayEmb[0][csf('id')];
					$po_break_id=$dataArrayEmb[0][csf('po_break_down_id')];
					$sql="SELECT sum(a.production_qnty) as production_qnty, b.color_number_id, b.size_number_id from pro_garments_production_dtls a, wo_po_color_size_breakdown b where a.mst_id in($mst_id) and b.po_break_down_id='$po_break_id' and a.color_size_break_down_id=b.id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by  b.size_number_id, b.color_number_id ";
					// echo $sql;
					$result=sql_select($sql);
					$size_array=array ();
					$qun_array=array ();
					foreach ( $result as $row )
					{
						$size_array[$row[csf('size_number_id')]]=$row[csf('size_number_id')];
						$qun_array[$row[csf('color_number_id')]][$row[csf('size_number_id')]]=$row[csf('production_qnty')];
					}

					$sql="SELECT sum(a.production_qnty) as production_qnty, b.color_number_id from pro_garments_production_dtls a, wo_po_color_size_breakdown b where a.mst_id in($mst_id) and b.po_break_down_id='$po_break_id' and a.color_size_break_down_id=b.id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_number_id ";

					//echo $sql; and a.production_date='$production_date'
					$result=sql_select($sql);
					$color_array=array ();
					foreach ( $result as $row )
					{
						$color_array[$row[csf('color_number_id')]]=$row[csf('color_number_id')];
					}

					$sizearr=return_library_array("select id,size_name from lib_size ","id","size_name");
					$colorarr=return_library_array("select id,color_name from  lib_color ","id","color_name");
		        ?>

			    <table align="center" cellspacing="0" width="<? echo $width;?>px;"  border="1" rules="all" class="rpt_table" >
				    <thead bgcolor="#dddddd" align="center">
						<th width="85">SL</th>
						<th width="100" align="center">Item Category</th>
						<th width="100" align="center">Issue ID</th>
						<th width="200" align="center">Item Description</th>
						<th width="50" align="center">UOM</th>
						<th width="150" align="center">Color/Size</th>
							<?
							foreach ($size_array as $sizid)
							{
								//$size_count=count($sizid);
								?>
									<th width="150"><strong><? echo  $sizearr[$sizid];  ?></strong></th>
								<?
							}
							?>
						<th width="80" align="center">Total Issue Qnty.</th>
					</thead>
					<tbody>
						<?
						  //$mrr_no=$dataArray[0][csf('issue_number')];
							$i=1;
							$tot_qnty=array();
							foreach($color_array as $cid)
							{
								if ($i%2==0)
									$bgcolor="#E9F3FF";
								else
									$bgcolor="#FFFFFF";
								$color_count=count($cid);
								?>
								<tr bgcolor="<? echo $bgcolor; ?>">
									<td><? echo $i;  ?></td>
									<?
									foreach($sql_result_uom as $row)
									{
										?>
										<td  align="center"><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
									<td  align="center"><? echo $row[csf('challan_no')]; ?></td>
									<td  align="center"><?  echo $row[csf('item_description')]; ?></td>
									<td  align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
									<?
									}
									?>
									<td><? echo $colorarr[$cid]; ?></td>
									<?
									foreach ($size_array as $sizval)
									{
										$size_count=count($sizval);
										?>
										<td align="right"><? echo $qun_array[$cid][$sizval]; ?></td>
										<?
										$tot_qnty[$cid]+=$qun_array[$cid][$sizval];
										$tot_qnty_size[$sizval]+=$qun_array[$cid][$sizval];
									}
									?>
									<td align="right"><? echo $tot_qnty[$cid]; ?></td>
								</tr>
								<?
								$production_quantity+=$tot_qnty[$cid];
								$i++;
							}
						?>
					</tbody>
					<tr>
						<td colspan="5" align="center"><strong>Total :</strong></td>
						<td align="center"></td>
						<?
							foreach ($size_array as $sizval)
							{
								?>
								<td align="right"><?php echo $tot_qnty_size[$sizval]; ?></td>
								<?
							}
						?>
						<td align="right"><?php echo $production_quantity; ?></td>
					</tr>
					<tr>
					    <td align="center"><strong>In Word :</strong></td>
					    <td colspan="8" align="left">&nbsp;&nbsp;<? echo number_to_words($production_quantity,$mcurrency);?></td>
					</tr>
			     <?
				$width_sign=$width.'px';
				?>
			    </table>
			</div>
			<? echo signature_table(114, $data[0], $width_sign,$template_id, 50); ?>			
		</div>			    
			<script type="text/javascript" src="../../js/jquery.js"></script>
			<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
			<script>
				function generateBarcode( valuess ){					   
						var value = valuess;
						var btype = 'code39';
						var renderer ='bmp';						 
						var settings = {
						  output:renderer,
						  bgColor: '#FFFFFF',
						  color: '#000000',
						  barWidth: 1,
						  barHeight: 30,
						  moduleSize:5,
						  posX: 10,
						  posY: 20,
						  addQuietZone: 1
						};
						$("#barcode_img_id_<? echo $cid; ?>").html('11');
						 value = {code:value, rect: false};						
						$("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
					} 
				 generateBarcode('<? echo $data[1]; ?>');
			</script>
		<?
	}
	?>	
	<script type="text/javascript">
		var staticHeight = 0;
		var pageHeight = 900;
		$('.print6_data').each(function() {
		    staticHeight += $(this).filter(':visible').outerHeight(true);
		    console.log(staticHeight)
		    if (staticHeight > pageHeight) {
		        $(this).after( '<p style="page-break-after:always;"></p>');		        
		        staticHeight = 0;
		    }
		    else{
		    	$(this).after( '<hr style="border-top: dotted 2px #000">');
		    	$(this).css({
					"height": "680px",
					"margin-bottom": "30px"
					});
		    	//$(this).css('height', "680px");
		    	$('.print6_data').addClass("devider");
		    }

		});
	</script>
	<style type="text/css">		
		.devider:nth-of-type(2){
			margin-top: 40px;
		}
	</style>
	<?
	exit();
}

if ($action=="get_out_entry_print9") // Print 9
{
    echo load_html_head_contents("Report Info","../", 1, 1, $unicode,'','');
	?>
	<style>
		 @media print{
			.tbodySetting {
				font-size: 13pt !important;
	  		}
	 		.tbodySettingTr{
	        	font-size: 13pt !important;
	        }
		}
	</style>
	<?
	extract($_REQUEST);
	$data=explode('*',$data);
	// echo "<pre>";
	// print_r($data);	
	$show_item=$data[4];
	$cbo_returnable = $data[6];
	$company=$data[0];
	$location=$data[2];
	
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$brand_arr=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name");
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");

	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );	
	$location_name_arr=return_library_array( "select id,location_name from lib_location where company_id='$data[0]' and status_active =1 and is_deleted=0 order by location_name", "id", "location_name"  );	
	$sql="SELECT id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,vhicle_number,com_location_id,mobile_no,do_no,remarks,com_location_id as from_location 
	from inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 ";
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	$bags_cone_arr=array();
	$prod_id=array();
	$brand_lot_arr=array();
	if($basis==2)
	{
		$sqls="SELECT a.id,a.prod_id,a.no_of_bags,a.cone_per_bag from inv_transaction a,inv_gate_pass_mst b,inv_gate_pass_dtls c where a.id=c.challan_no and b.id=c.mst_id  and b.sys_number='$data[1]' group by a.id,a.prod_id,a.no_of_bags,a.cone_per_bag ";
		foreach(sql_select($sqls) as $val)
		{
			$bags_cone_arr[$val[csf("id")]]["bags"]=$val[csf("no_of_bags")];
			$bags_cone_arr[$val[csf("id")]]["cone"]=$val[csf("cone_per_bag")];
			$bags_cone_arr[$val[csf("id")]]["prod_id"]=$val[csf("prod_id")];
			$prod_id[$val[csf("prod_id")]]=$val[csf("prod_id")];
		}
		$prod_ids=0;
		if(count($prod_id)>0)
		{
			$prod_ids=implode(",", $prod_id);
		}

		$sql2="SELECT  id,brand,lot  from product_details_master where  id in($prod_ids) ";
		foreach(sql_select($sql2) as $val)
		{
			$brand_lot_arr[$val[csf("id")]]["brand"]=$brand_arr[$val[csf("brand")]];
			$brand_lot_arr[$val[csf("id")]]["lot"]=$val[csf("lot")];
			 
		}

	}	
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	$order_array=array();
	$order_sql="SELECT a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}	
	if($cbo_returnable==1){

		$copy_no=array(1,2,3); 
	}else{

		$copy_no=array(1,2); 
	}
	// foreach($copy_no as $cid)
	// {
		if($show_item==1){
			$width=1150;
			$colspan=5;		}
		else{
			$width=1150;
			$colspan=5;
			$colspan2=2;
		}
		$address = "";
		$add_info = "";
		$nameArray=sql_select("select plot_no, level_no, road_no, block_no, country_id, province, city, zip_code, email, website from lib_company where id=$data[0]");
		if($nameArray[0][csf('plot_no')] != ''){
			$address.="Plot# ".$nameArray[0][csf('plot_no')].',';
		}
		if($nameArray[0][csf('level_no')] != ''){
			$address.="Level# ".$nameArray[0][csf('level_no')].',';
		}
		if($nameArray[0][csf('road_no')] != ''){
			$address.="Road# ".$nameArray[0][csf('road_no')].',';
		}
		if($nameArray[0][csf('block_no')] != ''){
			$address.="Block# ".$nameArray[0][csf('block_no')].'<br>';
		}
		if($nameArray[0][csf('city')] != ''){
			$address.=$nameArray[0][csf('city')].',';
		}
		if($nameArray[0][csf('zip_code')] != 0 && $nameArray[0][csf('zip_code')] != ''){
			$address.='-'.$nameArray[0][csf('zip_code')].',';
		}
		if($nameArray[0][csf('province')] != ''){
			$address.=$nameArray[0][csf('province')].','.$country_arr[$nameArray[0][csf('country_id')]];
		}
		if($nameArray[0][csf('email')] != 0){
			$add_info.='Email: '.$nameArray[0][csf('email')].', ';
		}
		if($nameArray[0][csf('website')] != 0){
			$add_info.='Website: '.$nameArray[0][csf('website')].',';
		}
		$com_dtls = fnc_company_location_address($company, $location, 2);
		?>
		<div data-print=section class="print6_data">
			<div style="width:<? echo $width;?>px;" align="center">
			    <table style="table-layout: fixed;font-family: Arial Narrow; " width="<? echo $width;?>">
					<tr>
						<td rowspan="5" width="370"> <img src="<?=base_url($com_dtls[2]); ?>" height="45" width="45"></td>
					</tr>
					<tr style="font-size:xx-large;">
						<td width="600" style="text-align: center;"><strong><? echo $com_dtls[0]; ?></strong></td>
						<td width="200" style="text-align: right; padding-right: 7px">
						<span>
							<?
								if($cbo_returnable == 1){
									echo "Returnable";
								}
							?>
						</span>
						</td>
					</tr>
					<tr>				
						<td style="text-align: left;font-family: Arial Narrow;font-size: 18px;"><strong><?php echo $com_dtls[1]; ?>
						</strong></td>
						<td style="text-align: right; "><span  id="barcode_img_id_<? echo $cid; ?>" ></span></td>
					</tr>
					<tr>			
						<td style="text-align: center;"><?php echo $add_info ?></td>
					</tr>
					<tr>
						<td style="text-align: center; font-size:x-large; text-decoration: underline; font-weight: bold;">Gate Pass</td>
						<td style="text-align: right;font-size: 22px; "><strong>Location: <? echo $location_name_arr[$dataArray[0][csf('from_location')]]; ?></strong></td>
					</tr>
				</table>
				<br>
			    <table border="1" cellpadding="1" cellspacing="1" style="width:1150px; font-family: Arial Narrow;font-size: 16px;" rules="all">
			        <tr>
			            <td width="160"><strong>System ID:</strong></td> <td width="175px"><strong><? echo $dataArray[0][csf('sys_number')]; ?></strong></td>
			            <td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
			            <td width="125"><strong>Challan/System No:</strong></td><td width="175px" colspan="2"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
			        </tr>
			        <tr>	            
			            <td><strong>Out Date:</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
			            <td><strong>Out-Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
			            <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td>
			        </tr>
			        <tr>
			            <td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
			            <td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
			            <td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
			        </tr>
			        <tr>		          
			            <td><strong>Sent To:</strong></td><td width="175px"><? echo $send_to_company; ?></td>
			            <td><strong>To Location:</strong></td><td><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
			            <td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
			        </tr>
			        <tr>
			            <td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
			            <td><strong>Est. Return Date 	 :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
			            <td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td> 
			            
			        </tr>
			        <tr>	           
				        <td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
				        <td><strong>Mobile No:</strong></td>
						<td><? echo $dataArray[0][csf('mobile_no')]; ?></td>
						<td><strong>Vehicle No:</strong></td>
						<td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
			        </tr>
			        <tr>	           
				        <td><strong>D.O.No.:</strong></td><td><? echo $dataArray[0][csf('do_no')]; ?></td>
				        <td><strong>Remarks</strong></td>
						<td colspan="3"><? echo $dataArray[0][csf('remarks')]; ?></td>
			        </tr>
			    </table>
			    <br>
			    <table style="font-size: 14px; font-family: Arial Narrow;" align="center" cellspacing="0" width="<? echo $width;?>px;"  border="1" rules="all" class="rpt_table">
			        <thead bgcolor="#dddddd" align="center">
			            <th width="30">SL</th>
			            <th width="100" align="center">ITEM CATEGORY</th>
			            <? 
			            if($basis==2)
			            {
			            	?>
			            	<th width="70" align="center">BRAND</th>
			            	<?

			            }
			            ?>
			            <th width="100" align="center">SAMPLE</th>
			            <th width="200" align="center">ITEM DESCRIPTION</th>
			            <? 
			            if($basis==2)
			            {
			            	?>
			            	<th width="70" align="center">LOT</th>
			            	<?

			            }
			            ?>
			            <th width="50" align="center">UOM</th>
			            <th width="80" align="center">QUANTITY</th>
			            <? 
			            if($basis==2)
			            {
			            	?>
			            	<th width="70" align="center">NO. OF BAG/CRTN</th>
			            	<th width="70" align="center">NO. OF CONE</th>
			            	 
			            	<?

			            }
			            
			            if($show_item==1)
						{
						?>
			            <th width="50" align="center">RATE</th> 
			            <th width="80" align="center">AMOUNT </th>
			            <?
						}
						if ($dataArray[0][csf('basis')]==33) 
						{
						?>
							<th width="100" align="center">CUSTOMER BUYER</th>
						<?
						}
						else
						{
						?>
			            	<th width="100" align="center">BUYER</th>
						<?
						}
						?>
			            <th width="100" align="center">STYLE</th>
			            <th width="80" align="center">BUYER ORDER </th>
			            <th align="center">REMARKS</th>
			        </thead>
			        <tbody style="font-size: 16px; font-family: Arial Narrow;" class="tbodySetting">
					<?
				    $i=1;
					$gate_id=$dataArray[0][csf('id')];
					$sql_dtls= " SELECT id,item_category_id,sample_id, item_description,uom_qty, quantity, uom, rate, amount,buyer_order_id,buyer_order, remarks,challan_no,challan_details_id as dtls_id from  inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 ";
					if($data[4]==8) //subcon challan (grey fabric)
					{
						$sql_result_subcon_grey=sql_select($sql_dtls);
						$buyer_orderIDs="";
						foreach($sql_result_subcon_grey as $row)
						{
							$buyer_orderIDs.=$row[csf('buyer_order')];
						}
						$buyer_orderID=chop($buyer_orderIDs,',');
						
						$sql_subcon_order_buyer=sql_select("select order_no,cust_buyer from subcon_ord_dtls where order_no in('$buyer_orderID') and status_active=1 and is_deleted=0");
						foreach($sql_subcon_order_buyer as $row)
						{
							$subcon_buyer_arr[$row[csf('order_no')]]['cust_buyer']=$row[csf('cust_buyer')];
						}
					}
					// echo $data[4];die;
					if ($basis==28 || $basis==57) // Sample Delivery Challan Or MKT
					{
						$sqls="SELECT a.sample_development_id from sample_ex_factory_dtls a, inv_gate_pass_mst b, inv_gate_pass_dtls c where a.sample_ex_factory_mst_id=c.challan_no and b.id=c.mst_id and b.sys_number='$data[1]' group by a.sample_development_id";
						foreach(sql_select($sqls) as $val)
						{
							$sample_req_arr[$val[csf("sample_development_id")]]=$val[csf("sample_development_id")];
						}
						$sample_req_ids=0;
						if(count($sample_req_arr)>0)
						{
							$sample_req_ids=implode(",", $sample_req_arr);
						}

						$sql2="SELECT b.sample_ex_factory_mst_id as challan_no, b.id as dtls_id, b.sample_name, a.buyer_name, a.style_ref_no from sample_development_mst a, sample_ex_factory_dtls b where a.id=b.sample_development_id and a.id in($sample_req_ids) group by b.sample_ex_factory_mst_id, b.sample_name, a.buyer_name, a.style_ref_no, b.id";
						$req_buyer_style_name_arr=array();
						foreach(sql_select($sql2) as $val) 
						{
							if ($basis==28) // issue id 6721
							{
								$req_buyer_style_name_arr[$val[csf("challan_no")]][$val[csf("dtls_id")]]["buyer_name"]=$val[csf("buyer_name")];
								$req_buyer_style_name_arr[$val[csf("challan_no")]][$val[csf("dtls_id")]]["style_ref_no"]=$val[csf("style_ref_no")];
							}
							else
							{
								$req_buyer_style_name_arr[$val[csf("challan_no")]]["buyer_name"]=$val[csf("buyer_name")];
								$req_buyer_style_name_arr[$val[csf("challan_no")]]["style_ref_no"]=$val[csf("style_ref_no")];
							}
						}
					}
					// echo "<pre>";print_r($req_buyer_style_name_arr);
					//echo $sql_dtls;
					$uom_check=array();
					$sql_result=sql_select($sql_dtls);
					$tot_qty=0;$tot_amount=0;
					foreach($sql_result as $row)
					{
						$ref_id=$row[csf("challan_no")];
						$dtls_id=$row[csf("dtls_id")];
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

						if ($basis==28 || $basis==57) 
						{
							if ($basis==28) 
							{
								$buyer=$req_buyer_style_name_arr[$ref_id][$dtls_id]['buyer_name'];
								$style_ref_no=$req_buyer_style_name_arr[$ref_id][$dtls_id]['style_ref_no'];
							}
							else
							{
								$buyer=$req_buyer_style_name_arr[$ref_id]['buyer_name'];
								$style_ref_no=$req_buyer_style_name_arr[$ref_id]['style_ref_no'];
							}							
						}
						else
						{
							$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
							$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
						}
						//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
						$uom_check[$row[csf('uom')]]=$row[csf('uom')];
						?>
						<tr bgcolor="<? echo $bgcolor; ?>" class="tbodySettingTr">
			                <td style="padding-top: 15px; padding-bottom: 15px;"><? echo $i; ?></td>
			                <td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
			                <? 
			                if($basis==2)
			                {
			                	?>
			                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["brand"]; ?></td>
			                	<?
			                }
			                ?>
			                <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
			                <td><?  echo $row[csf('item_description')]; ?></td>
			                <? 
			                if($basis==2)
			                {
			                	?>
			                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["lot"]; ?></td>
			                	<?
			                }
			                ?>
			                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
			                <td align="right"><? echo $row[csf('quantity')]; ?></td>
			                <? 
			                if($basis==2)
			                {
			                	?>
			                	<td width="70" align="center"><? echo $bags_cone_arr[$ref_id]["bags"];?></td>
			                	<td width="70" align="center"><? echo $bags_cone_arr[$ref_id]["cone"];?></td>
			                	 
			                	<?
			                }
							if($show_item==1)
							{
								?>
				                <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
				                <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
				                <?
							}
							?>
			                <td align="center"><? 
							if($data[4]==8)
							{
								echo $subcon_buyer_arr[$row[csf('buyer_order')]]['cust_buyer'];
							}
							else
							{
								echo $buyer_library[$buyer]; 
							}
							?></td>
			                <td title="Challan: <? echo $ref_id; ?>"><? echo $style_ref_no; ?></td>
			                <td><? echo $row[csf('buyer_order')]; ?></td>
			                <td><? echo $row[csf('remarks')]; ?></td>
						</tr>
						<?php
				    	$i++;
						
						$tot_qty+=$row[csf('quantity')];
						$tot_amount+=$row[csf('amount')];
				    }
					//$tot_check=array();
					if($basis==2)$colspan+=2;
					if(count($uom_check)==1)
					{
						?>
					</tbody>
					    <tfoot style="font-family: Arial Narrow;font-size: 16px;" bgcolor="#CCCCCC">
					        <tr>
					        <td colspan="<? echo $colspan;?>" align="right"> <b> Total</b></td>
					        <td align="right"><b><? echo number_format($tot_qty,2);?></b> </td>
					          <?
					        if($basis==2)
					        {
					        	?>
					        	<td colspan="2"></td>

					        	<?
					        }
							if($show_item==1)
							{
							?>
					        <td> </td>
					        <td align="right"><b> <? echo number_format($tot_amount,2);?></b> </td>
					        <?
								}
							?>
					        <td colspan="<? echo 4+$colspan2;?>"></td>
					        </tr>
						</tfoot>
					    <?
					}
					$width_sign=$width.'px';
					?>
			    </table>
			</div>
			<? echo signature_table(114, $data[0], $width_sign,$template_id, 50); ?>			
		</div>			    
			<script type="text/javascript" src="../../js/jquery.js"></script>
			<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
			<script>
				function generateBarcode( valuess ){					   
						var value = valuess;
						var btype = 'code39';
						var renderer ='bmp';						 
						var settings = {
						  output:renderer,
						  bgColor: '#FFFFFF',
						  color: '#000000',
						  barWidth: 1,
						  barHeight: 30,
						  moduleSize:5,
						  posX: 10,
						  posY: 20,
						  addQuietZone: 1
						};
						$("#barcode_img_id_<? echo $cid; ?>").html('11');
						 value = {code:value, rect: false};						
						$("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
					} 
				 generateBarcode('<? echo $data[1]; ?>');
			</script>
		<?
	//}
	?>	
	<script type="text/javascript">
		var staticHeight = 0;
		var pageHeight = 900;
		$('.print6_data').each(function() {
		    staticHeight += $(this).filter(':visible').outerHeight(true);
		    console.log(staticHeight)
		    if (staticHeight > pageHeight) {
		        $(this).after( '<p style="page-break-after:always;"></p>');		        
		        staticHeight = 0;
		    }
		    else{
		    	$(this).after( '<hr style="border-top: dotted 2px #000">');
		    	$(this).css({
					"height": "680px",
					"margin-bottom": "30px"
					});
		    	//$(this).css('height', "680px");
		    	$('.print6_data').addClass("devider");
		    }

		});
	</script>
	<style type="text/css">		
		.devider:nth-of-type(2){
			margin-top: 40px;
		}
	</style>
	<?
	exit();
}

if ($action=="get_out_entry_emb_issue_print_emb_print")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//print_r ($data); die;
	$emb_issue_ids=$data[4];
	$company=$data[0];
	$location=$data[2];
	$sysNumber= "'" . $data[1] . "'";
	$rptType = 1;

	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );

	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");
	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$sizearr=return_library_array("select id,size_name from lib_size ","id","size_name");
	$colorarr=return_library_array("select id,color_name from  lib_color ","id","color_name");
	$user_library=return_library_array( "select id, user_full_name from user_passwd", "id", "user_full_name"  );
	
	$sql="SELECT id, sys_number, company_id, basis, department_id, issue_purpose, within_group, section, attention, sent_by, carried_by, sent_to, out_date, challan_no, time_hour, time_minute, returnable, delivery_as, est_return_date, location_id, location_name, vhicle_number, com_location_id, remarks, inserted_by from inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0";
	// echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$mst_id=$dataArray[0][csf('id')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	$vehicle_no=$dataArray[0][csf('vhicle_number')];
	$remarks=$dataArray[0][csf('remarks')];
	$prepared_by=$user_library[$dataArray[0][csf('inserted_by')]];
	
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}

	$remarks_arr=array();
	$remarks_data=sql_select("SELECT challan_no,remarks from inv_gate_pass_dtls where mst_id=$mst_id and status_active=1 and is_deleted=0");
	foreach ($remarks_data as $value) 
	{	
		$remarks_arr[$value[csf("challan_no")]]=$value[csf("remarks")];
	}
	// echo $sql;

	$emb_issue_ids = array_unique(explode(",",$emb_issue_ids));

	foreach ($emb_issue_ids as $key => $data) {
		$emb_issue_ids[$key] = "'".$data."'";
	}

	$emb_issue_ids = implode(",", $emb_issue_ids);


	$sql = "select a.id, sum(b.production_qnty) as production_qnty, c.color_number_id, c.size_number_id, c.po_break_down_id from pro_gmts_delivery_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c where c.id=b.color_size_break_down_id and a.id=b.delivery_mst_id and a.sys_number in ($emb_issue_ids) group by a.id,  c.color_number_id, c.size_number_id, c.po_break_down_id";
	//    echo $sql;

	$result=sql_select($sql);
	$size_array=array ();
	$color_array=array ();
	$qun_array=array ();
	foreach ( $result as $row )
	{
		$size_array[$row[csf('size_number_id')]]=$row[csf('size_number_id')];
		$color_array[$row[csf('color_number_id')]]=$row[csf('color_number_id')];
		$qun_array[$row[csf('id')]][$row[csf('po_break_down_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]=$row[csf('production_qnty')];
	}
	
	?>
		<style type="text/css">.pagebreak { page-break-before: always; }</style>
	<?
	$width=1180+count($size_array)*50;
	$copy_no=array("Store", "Supplier", "Gate"); //for Dynamic Copy here 
	foreach($copy_no as $cid)
	{
	$com_dtls = fnc_company_location_address($company, $location, 2);
	?>
	<div style="width:<? echo $width;?>px;" align="center">
		<table width="<? echo $width;?>px" cellspacing="0" align="center" border="0">
			<tr>
				<td  align="left" rowspan="5"><img src="<?=base_url($com_dtls[2]); ?>" height="70" width="200"></td>
				<td colspan="4" align="center"  style="font-size:xx-large; width:800px;">
					<strong>
						<? echo $com_dtls[0]; ?>
					</strong>
				</td>  
				<td colspan="3">&nbsp;</td>
			</tr>

			<tr>
				<td colspan="4" align="center">
					<strong>
						<span style="font-size:x-large;">
					<? echo $cid;?><sup><?php if($cid==1) { echo 'Store';} elseif($cid==2) { echo  'nd';} elseif($cid==3) ?></sup> Copy</span>
					</strong>
				</td>
				<td align="right" style="width: 90px;"><strong> Bar Code : </strong></td>
			
				<td colspan="2" style="float: right;" id="barcode_img_id_<? echo $cid; ?>"></td>
				
		
			</tr>
			<tr>
			<td colspan="6"><div style="float:right;width:34%; margin-top:10px; text-align:right">

           &nbsp;<? if($dataArray[0][csf('returnable')]==1){
						echo"<span style='border:1px solid #CCC; font-size:30px;  background:#EEE;padding:3px;'>Returnable</span>";
					}
					else{
						echo"<span style='border:1px solid #CCC;font-size:30px; background:#EEE;padding:3px;'>Non-Returnable</span>";
						}
					?>
				</div></td>
			</tr>

			<tr class="form_caption">
				<td colspan="4" align="center">
					<?
					echo $com_dtls[1];
					//$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
						/*foreach ($nameArray as $result)
						{ 
							echo $result[csf('plot_no')]; 
							echo $result[csf('level_no')];
							echo $result[csf('road_no')];
							echo $result[csf('block_no')];
							echo $result[csf('city')];
							echo $result[csf('zip_code')];
							echo $result[csf('province')].',';
							echo $country_arr[$result[csf('country_id')]].'<br>'; 
							echo $result[csf('email')]; 
							echo $result[csf('website')];
						}*/
					?> 
					<div style="width:34%; text-align:center">
					&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
				</div>
				
				<!-- <td  style="font-size:20px"><b></b></td> -->
				<td colspan="3" rowspan="3"></td>
			</tr>


			<tr>
				<td style="display:none" colspan="4" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
			</tr>


			<tr>
				<td colspan="5" align="center" style="font-size:x-large;">
					<strong style="margin-left: 205px;">
						<u>Gate Pass/Challan</u>
					</strong>
				</td>
			</tr>
			<tr>
				<td></td>
			</tr>
		</table>

	<!-- ######################################################################################################################## -->

		<table width="<? echo $width;?>px" cellspacing="0" align="center" border="0">
			<tr>
				<td width="160"><strong>System ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
				<td width="120"><strong>Basis:</strong></td><td width="225px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
				<td width="125"><strong>Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]);; ?></td>
			</tr>
			<tr>
				
				<td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
				<td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
				<td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
			</tr>
			<tr>
				<td><strong>Sent To:</strong></td><td width="175px" colspan="3" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
				<td><strong>To Location:</strong></td><td width="175px" colspan="2"><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
			</tr>
			<tr>
				<td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
				<td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
				<td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
			</tr>
			<tr>
				<td><strong>Est. Return Date 	 :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
				<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
				<td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
				
				
			</tr>
			
			<tr>
			
			<td valign="top"><strong>Challan/System No:</strong></td><td valign="top"><? echo $challan_no; ?></td>
			<td valign="top"><strong>Remarks:</strong></td><td valign="top" ><? echo $remarks; ?></td>
			<td valign="top"><strong>Vehicle No:</strong></td><td valign="top" ><? echo $vehicle_no; ?></td>
			
			</tr>
		</table>
		<br>

		<!-- ##################################################### Body part Start ########################################################### -->
		
		<?

			?> 

		<div style="width:100%;">
			<table align="right" cellspacing="0" width="<? echo $width;?>"  border="1" rules="all" class="rpt_table" >
				<thead bgcolor="#dddddd" align="center">
					<th width="30">SL</th>
					<th width="150">Item Category</th>
					<th width="150">Buyer</th>
					<th width="100">Job No</th>
					<th width="150">Style</th>
					<th width="120">Buyer Order</th>
					<th width="170">Item Description</th>
					<th width="80" align="center">Color/Size</th>
						<?
						foreach ($size_array as $sizid)
						{
							?>
								<th width="50"><strong><? echo  $sizearr[$sizid];  ?></strong></th>
							<?
						}
						?>
					<th width="80" align="center">Total Issue Qty.</th>
					<th width="80" align="center">No of Bags/Rolls.</th>
					<th>Remarks</th>
				</thead>
				<tbody>
					<?
						if(count($result)) {
							$sql_prod="SELECT g.id, sum(b.production_qnty) as production_qnty, a.item_number_id,  c.color_number_id, d.style_ref_no, d.job_no, d.buyer_name, e.id as po_id, e.po_number,f.remarks, f.no_of_bags,f.item_category_id from pro_garments_production_mst a, pro_garments_production_dtls b,  wo_po_color_size_breakdown c, wo_po_details_master d,  wo_po_break_down e,INV_GATE_PASS_DTLS f, pro_gmts_delivery_mst g where g.id=b.delivery_mst_id and a.id=b.mst_id and f.CHALLAN_NO=a.id and a.status_active=1 and a.is_deleted=0 and a.production_type=2 and b.production_type=2 and a.po_break_down_id=c.po_break_down_id and b.status_active=1 and b.is_deleted=0 and b.color_size_break_down_id=c.id and c.status_active=1 and c.is_deleted=0 and d.job_no=c.job_no_mst and d.job_no=e.job_no_mst and c.po_break_down_id=e.id and d.status_active=1 and d.is_deleted=0 and e.status_active=1 and e.is_deleted=0 and f.mst_id=$mst_id group by g.id,a.item_number_id,c.color_number_id, d.style_ref_no, d.job_no, d.buyer_name, e.id, e.po_number,f.remarks,f.no_of_bags,f.item_category_id order by e.id";
						} else {
							$sql_prod = "select b.buyer_order, b.item_description, b.quantity, b.remarks, b.item_category_id , b.no_of_bags
							from inv_gate_pass_mst a, inv_gate_pass_dtls b
							where a.id=b.mst_id and a.sys_number=$sysNumber and a.status_active=1 and b.status_active=1";
							$rptType = 2;
						}
//						echo $sql_prod;
						$result_prod=sql_select($sql_prod);
						$i=1; $no_bag=0;
						$tot_specific_size_qnty=array();
						$grandTotal = 0;
						if($rptType == 2) {
							foreach ($result_prod as $val) 
								{
									$colorSizeArr = array();

									if($val[csf("buyer_order")]) {
										$buyerOrd = "'".$val[csf("buyer_order")]."'";
										$colorSizeArr = sql_select("select distinct a.style_ref_no, a.buyer_name, a.job_no, c.color_number_id
											from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c
											where b.po_number=$buyerOrd and b.job_no_mst=a.job_no and c.po_break_down_id=b.id");
									}

									$tot_color_size_qty=0;
									if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
							?>
									<tr>
										<td><?php echo $i; ?></td>
										<td><?php echo $item_category[$val[csf("item_category_id")]]; ?></td>
										<td><?php echo $buyer_library[$colorSizeArr[0][csf('buyer_name')]]; ?></td>
										<td><?php echo $val[csf("job_no")]; ?></td>
										<td><?php echo $colorSizeArr[0][csf('style_ref_no')]; ?></td>
										<td><?php echo $val[csf("buyer_order")]; ?></td>
										<td><?php echo $val[csf("item_description")]; ?></td>
										<td><?php echo $colorarr[$colorSizeArr[0][csf('color_number_id')]]; ?></td>
										<td align="right"><?php echo $val[csf("quantity")]; ?></td>
										<td align="right"><?php echo $val[csf("no_of_bags")]; $no_bag+=$val[csf("no_of_bags")];?></td>
										
										<td><?php echo $val[csf("remarks")]; ?></td>
										
									</tr>
							<?
								$i++;
								$grandTotal+=$val[csf("quantity")];
							}

						} else {
							foreach ($result_prod as $val) 
								{
									$tot_color_size_qty=0;
									if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
							?>
									<tr>
										<td> <? echo $i;  ?> </td>
										<td><?php echo $item_category[$val[csf("item_category_id")]]; ?></td>
										<td> <? echo $buyer_library[$val[csf("buyer_name")]];  ?> </td>
										<td><?php echo $val[csf("job_no")]; ?></td>
										<td> <? echo $val[csf("style_ref_no")]; ?> </td>
										<td> <? echo $val[csf("po_number")]; ?> </td>
										<td> <? echo $garments_item[$val[csf("item_number_id")]]; ?> </td>
										
										<td> <? echo $colorarr[$val[csf("color_number_id")]]; ?> </td>
										<?
										foreach ($size_array as $sizval)
										{
										?>
											<td align="right"><?  echo $qun_array[$val[csf("id")]][$val[csf("po_id")]][$val[csf("color_number_id")]][$sizval]; ?></td>
										<?
										$tot_color_size_qty+=$qun_array[$val[csf("id")]][$val[csf("po_id")]][$val[csf("color_number_id")]][$sizval];
										$tot_specific_size_qnty[$sizval]+=$qun_array[$val[csf("id")]][$val[csf("po_id")]][$val[csf("color_number_id")]][$sizval];
										}
										?>
										<td align="right"> 
											<? 
											echo $tot_color_size_qty; 
											?> 
										</td>
										
										<td align="right"><?php echo $val[csf("no_of_bags")]; $no_bag+=$val[csf("no_of_bags")]; ?></td>
										<td><p>
												<? echo $val[csf("remarks")]; ?>
											</p></td>
										
										
									</tr>
							<?
								$i++;	}
						}
						
					?>
				</tbody>
				<tr>
					<td colspan="8" align="right"><strong>Grand Total : &nbsp;</strong></td>
					<?
						foreach ($size_array as $sizval)
						{
							?>
							<td align="right"><?php echo $tot_specific_size_qnty[$sizval]; ?></td>
							<?
						}
					?>
					<td align="right"><?php echo $rptType==2 ? $grandTotal : array_sum($tot_specific_size_qnty); ?></td>
					<td align="right" ><?php echo $no_bag; ?></td>
					<td></td>
					
				</tr>                           
			</table>
	</div>

	<div>
		<style type="text/css">
			#signatureTblId{
				float: left !important;
				margin-left: -50px;
			}
		</style>
		<? echo signature_table(114, $company, "1380px", $template_id, 40, $prepared_by); ?>
		
		<script type="text/javascript" src="../../js/jquery.js"></script>
		<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
		<script>

		function generateBarcode( valuess ){
			
				var value = valuess;//$("#barcodeValue").val();
			// alert(value)
				var btype = 'code39';//$("input[name=btype]:checked").val();
				var renderer ='bmp';// $("input[name=renderer]:checked").val();
				
				var settings = {
				output:renderer,
				bgColor: '#FFFFFF',
				color: '#000000',
				barWidth: 1,
				barHeight: 30,
				moduleSize:5,
				posX: 10,
				posY: 20,
				addQuietZone: 1
				};
				$("#barcode_img_id_<? echo $cid; ?>").html('11');
				value = {code:value, rect: false};
				
				$("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
			} 
		generateBarcode('<? echo $data[1]; ?>');
		</script>
	</div>
	<div class="pagebreak"> </div>
	<?
		}
	exit();
}

if ($action=="get_out_entry_emb_issue_print")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//print_r ($data); die;
	$emb_issue_ids=$data[4];
	$company=$data[0];
	$location=$data[2];
	$sysNumber= "'" . $data[1] . "'";
	$rptType = 1;

	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );

	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");
	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$sizearr=return_library_array("select id,size_name from lib_size ","id","size_name");
	$colorarr=return_library_array("select id,color_name from  lib_color ","id","color_name");
	$user_library=return_library_array( "select id, user_full_name from user_passwd", "id", "user_full_name"  );

	
	$sql="SELECT id, sys_number, company_id, basis, department_id, issue_purpose, within_group, section, attention, sent_by, carried_by, sent_to, out_date, challan_no, time_hour, time_minute, returnable, delivery_as, est_return_date, location_id, location_name, vhicle_number, com_location_id, remarks, inserted_by from inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0";
	// echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$mst_id=$dataArray[0][csf('id')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	$vehicle_no=$dataArray[0][csf('vhicle_number')];
	$remarks=$dataArray[0][csf('remarks')];
	$prepared_by=$user_library[$dataArray[0][csf('inserted_by')]];


	
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}

	$remarks_arr=array();
	$remarks_data=sql_select("SELECT challan_no,remarks from inv_gate_pass_dtls where mst_id=$mst_id and status_active=1 and is_deleted=0");
	foreach ($remarks_data as $value) 
	{	
		$remarks_arr[$value[csf("challan_no")]]=$value[csf("remarks")];
	}
	$sql="select a.id, sum(b.production_qnty) as production_qnty, c.color_number_id, c.size_number_id from pro_garments_production_mst a, pro_garments_production_dtls b,  wo_po_color_size_breakdown c where a.id in ($emb_issue_ids) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and a.production_type=2 and b.production_type=2 and a.po_break_down_id=c.po_break_down_id and b.status_active=1 and b.is_deleted=0 and b.color_size_break_down_id=c.id and c.status_active=1 and c.is_deleted=0 group by a.id,c.color_number_id, c.size_number_id";
	// echo $sql;

	$result=sql_select($sql);
	$size_array=array ();
	$color_array=array ();
	$qun_array=array ();
	foreach ( $result as $row )
	{
		$size_array[$row[csf('size_number_id')]]=$row[csf('size_number_id')];
		$color_array[$row[csf('color_number_id')]]=$row[csf('color_number_id')];
		$qun_array[$row[csf('id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]=$row[csf('production_qnty')];
	}
	
	?>
		<style type="text/css">.pagebreak { page-break-before: always; }</style>
	<?
	$width=1180+count($size_array)*50;
	$copy_no=array("Store", "Supplier", "Gate"); //for Dynamic Copy here 
	foreach($copy_no as $cid)
	{
	$com_dtls = fnc_company_location_address($company, $location, 2);
	?>
	<div style="width:<? echo $width;?>px;" align="center">
		<table width="<? echo $width;?>px" cellspacing="0" align="center" border="0">
			<tr>
				<td  align="left" rowspan="5"><img src="<?=base_url($com_dtls[2]); ?>" height="45" width="45"></td>
				<td colspan="4" align="center"  style="font-size:xx-large; width:800px;">
					<strong>
						<? echo $com_dtls[0]; ?>
					</strong>
				</td>  
				<td colspan="3">&nbsp;</td>
			</tr>

			<tr>
				<td colspan="4" align="center">
					<strong>
						<span style="font-size:x-large;">
					<? echo $cid;?><sup><?php if($cid==1) { echo 'Store';} elseif($cid==2) { echo  'nd';} elseif($cid==3) ?></sup> Copy</span>
					</strong>
				</td>
				<td align="right" style="width: 90px;"><strong> Bar Code : </strong></td>
			
				<td colspan="2" style="float: right;" id="barcode_img_id_<? echo $cid; ?>"></td>
				
		
			</tr>
			<tr>
			<td colspan="6"><div style="float:right;width:34%; margin-top:10px; text-align:right">

           &nbsp;<? if($dataArray[0][csf('returnable')]==1){
						echo"<span style='border:1px solid #CCC; font-size:30px;  background:#EEE;padding:3px;'>Returnable</span>";
					}
					else{
						echo"<span style='border:1px solid #CCC;font-size:30px; background:#EEE;padding:3px;'>Non-Returnable</span>";
						}
					?>
				</div></td>
			</tr>

			<tr class="form_caption">
				<td colspan="4" align="center">
					<?
					echo $com_dtls[1];
					//$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
						/*foreach ($nameArray as $result)
						{ 
							echo $result[csf('plot_no')]; 
							echo $result[csf('level_no')];
							echo $result[csf('road_no')];
							echo $result[csf('block_no')];
							echo $result[csf('city')];
							echo $result[csf('zip_code')];
							echo $result[csf('province')].',';
							echo $country_arr[$result[csf('country_id')]].'<br>'; 
							echo $result[csf('email')]; 
							echo $result[csf('website')];
						}*/
					?> 
					<div style="width:34%; text-align:center">
					&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
				</div>
				
				<!-- <td  style="font-size:20px"><b></b></td> -->
				<td colspan="3" rowspan="3"></td>
			</tr>


			<tr>
				<td style="display:none" colspan="4" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
			</tr>


			<tr>
				<td colspan="5" align="center" style="font-size:x-large;">
					<strong style="margin-left: 205px;">
						<u>Gate Pass/Challan</u>
					</strong>
				</td>
			</tr>
			<tr>
				<td></td>
			</tr>
		</table>

	<!-- ######################################################################################################################## -->

		<table width="<? echo $width;?>px" cellspacing="0" align="center" border="0">
			<tr>
				<td width="160"><strong>System ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
				<td width="120"><strong>Basis:</strong></td><td width="225px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
				<td width="125"><strong>Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]);; ?></td>
			</tr>
			<tr>
				
				<td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
				<td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
				<td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
			</tr>
			<tr>
				<td><strong>Sent To:</strong></td><td width="175px" colspan="3" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
				<td><strong>To Location:</strong></td><td width="175px" colspan="2"><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
			</tr>
			<tr>
				<td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
				<td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
				<td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
			</tr>
			<tr>
				<td><strong>Est. Return Date 	 :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
				<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
				<td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
				
				
			</tr>
			
			<tr>
			
			<td valign="top"><strong>Challan/System No:</strong></td><td valign="top"><? echo $challan_no; ?></td>
			<td valign="top"><strong>Remarks:</strong></td><td valign="top" ><? echo $remarks; ?></td>
			<td valign="top"><strong>Vehicle No:</strong></td><td valign="top" ><? echo $vehicle_no; ?></td>
			
			</tr>
		</table>
		<br>

		<!-- ##################################################### Body part Start ########################################################### -->
		
		<?

			?> 

		<div style="width:100%;">
			<table align="right" cellspacing="0" width="<? echo $width;?>"  border="1" rules="all" class="rpt_table" >
				<thead bgcolor="#dddddd" align="center">
					<th width="30">SL</th>
					<th width="150">Item Category</th>
					<th width="150">Buyer</th>
					<th width="100">Job No</th>
					<th width="150">Style</th>
					<th width="120">Buyer Order</th>
					<th width="170">Item Description</th>
					<th width="80" align="center">Color/Size</th>
						<?
						foreach ($size_array as $sizid)
						{
							?>
								<th width="50"><strong><? echo  $sizearr[$sizid];  ?></strong></th>
							<?
						}
						?>
					<th width="80" align="center">Total Issue Qty.</th>
					<th width="80" align="center">No of Bags/Rolls.</th>
					<th>Remarks</th>
				</thead>
				<tbody>
					<?
						if(count($result)) {
							$sql_prod="SELECT a.id, sum(b.production_qnty) as production_qnty, a.item_number_id,  c.color_number_id, d.style_ref_no, d.job_no, d.buyer_name, e.id as po_id, e.po_number, f.no_of_bags,f.item_category_id from pro_garments_production_mst a, pro_garments_production_dtls b,  wo_po_color_size_breakdown c, wo_po_details_master d,  wo_po_break_down e,INV_GATE_PASS_DTLS f where a.id in ($emb_issue_ids) and a.id=b.mst_id and f.CHALLAN_NO=a.id and a.status_active=1 and a.is_deleted=0 and a.production_type=2 and b.production_type=2 and a.po_break_down_id=c.po_break_down_id and b.status_active=1 and b.is_deleted=0 and b.color_size_break_down_id=c.id and c.status_active=1 and c.is_deleted=0 and d.job_no=c.job_no_mst and d.job_no=e.job_no_mst and c.po_break_down_id=e.id and d.status_active=1 and d.is_deleted=0 and e.status_active=1 and e.is_deleted=0 and f.mst_id=$mst_id group by a.id,a.item_number_id,c.color_number_id, d.style_ref_no, d.job_no, d.buyer_name, e.id, e.po_number,f.no_of_bags,f.item_category_id";
						} else {
							$sql_prod = "select b.buyer_order, b.item_description, b.quantity, b.remarks, b.item_category_id , b.no_of_bags
							from inv_gate_pass_mst a, inv_gate_pass_dtls b
							where a.id=b.mst_id and a.sys_number=$sysNumber and a.status_active=1 and b.status_active=1";
							$rptType = 2;
						}

						
						
						$result_prod=sql_select($sql_prod);
						$i=1;
						$tot_specific_size_qnty=array();
						$grandTotal = 0;
						if($rptType == 2) {
							foreach ($result_prod as $val) 
								{
									$colorSizeArr = array();

									if($val[csf("buyer_order")]) {
										$buyerOrd = "'".$val[csf("buyer_order")]."'";
										$colorSizeArr = sql_select("select distinct a.style_ref_no, a.buyer_name, a.job_no, c.color_number_id
											from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c
											where b.po_number=$buyerOrd and b.job_no_mst=a.job_no and c.po_break_down_id=b.id");
									}

									$tot_color_size_qty=0;
									if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
							?>
									<tr>
										<td><?php echo $i; ?></td>
										<td><?php echo $item_category[$val[csf("item_category_id")]]; ?></td>
										<td><?php echo $buyer_library[$colorSizeArr[0][csf('buyer_name')]]; ?></td>
										<td><?php echo $val[csf("job_no")]; ?></td>
										<td><?php echo $colorSizeArr[0][csf('style_ref_no')]; ?></td>
										<td><?php echo $val[csf("buyer_order")]; ?></td>
										<td><?php echo $val[csf("item_description")]; ?></td>
										<td><?php echo $colorarr[$colorSizeArr[0][csf('color_number_id')]]; ?></td>
										<td align="right"><?php echo $val[csf("quantity")]; ?></td>
										<td><?php echo $val[csf("no_of_bags")]; ?></td>
										
										<td><?php echo $val[csf("remarks")]; ?></td>
										
									</tr>
							<?
								$i++;
								$grandTotal+=$val[csf("quantity")];
							}

						} else {
							foreach ($result_prod as $val) 
								{
									$tot_color_size_qty=0;
									if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
							?>
									<tr>
										<td> <? echo $i;  ?> </td>
										<td><?php echo $item_category[$val[csf("item_category_id")]]; ?></td>
										<td> <? echo $buyer_library[$val[csf("buyer_name")]];  ?> </td>
										<td><?php echo $val[csf("job_no")]; ?></td>
										<td> <? echo $val[csf("style_ref_no")]; ?> </td>
										<td> <? echo $val[csf("po_number")]; ?> </td>
										<td> <? echo $garments_item[$val[csf("item_number_id")]]; ?> </td>
										
										<td> <? echo $colorarr[$val[csf("color_number_id")]]; ?> </td>
										<?
										foreach ($size_array as $sizval)
										{
										?>
											<td align="right"><? echo $qun_array[$val[csf("id")]][$val[csf("color_number_id")]][$sizval]; ?></td>
										<?
										$tot_color_size_qty+=$qun_array[$val[csf("id")]][$val[csf("color_number_id")]][$sizval];
										$tot_specific_size_qnty[$sizval]+=$qun_array[$val[csf("id")]][$val[csf("color_number_id")]][$sizval];
										}
										?>
										<td align="right"> 
											<? 
											echo $tot_color_size_qty; 
											?> 
										</td>
										
										<td><?php echo $val[csf("no_of_bags")]; ?></td>
										<td><p>
												<? echo $remarks_arr[$val[csf("id")]]; ?>
											</p></td>
										
										
									</tr>
							<?
								$i++;	}
						}
						
					?>
				</tbody>
				<tr>
					<td colspan="8" align="right"><strong>Grand Total : &nbsp;</strong></td>
					<?
						foreach ($size_array as $sizval)
						{
							?>
							<td align="right"><?php echo $tot_specific_size_qnty[$sizval]; ?></td>
							<?
						}
					?>
					<td align="right"><?php echo $rptType==2 ? $grandTotal : array_sum($tot_specific_size_qnty); ?></td>
					<td></td>
					<td></td>
					
				</tr>                           
			</table>
	</div>

	<div>
		<? echo signature_table(114, $data[0], $width, $template_id, 40, $prepared_by); ?>
		
		<script type="text/javascript" src="../../js/jquery.js"></script>
		<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
		<script>

		function generateBarcode( valuess ){
			
				var value = valuess;//$("#barcodeValue").val();
			// alert(value)
				var btype = 'code39';//$("input[name=btype]:checked").val();
				var renderer ='bmp';// $("input[name=renderer]:checked").val();
				
				var settings = {
				output:renderer,
				bgColor: '#FFFFFF',
				color: '#000000',
				barWidth: 1,
				barHeight: 30,
				moduleSize:5,
				posX: 10,
				posY: 20,
				addQuietZone: 1
				};
				$("#barcode_img_id_<? echo $cid; ?>").html('11');
				value = {code:value, rect: false};
				
				$("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
			} 
		generateBarcode('<? echo $data[1]; ?>');
		</script>
	</div>
	<div class="pagebreak"> </div>
	<?
		}
	exit();
}

if ($action=="get_out_entry_printing_delivery_print")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//print_r ($data);
	$emb_issue_noumber=$data[3];
	$emb_issue_ids=$data[4];

	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");
	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	
	$sql="SELECT id, sys_number, company_id, basis, department_id, issue_purpose, within_group, section, attention, sent_by, carried_by, sent_to, out_date, challan_no, time_hour, time_minute, returnable, delivery_as, est_return_date, location_id, location_name, vhicle_number, com_location_id from inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0";
	//echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$mst_id=$dataArray[0][csf('id')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}

	
	
	?>
		<style type="text/css">.pagebreak { page-break-before: always; }</style>
	<?
	$width=1150;
	$copy_no=array(1,2,3); //for Dynamic Copy here 
	foreach($copy_no as $cid)
	{
	
	?>
	<div style="width:<? echo $width;?>px;" align="center">
		<table width="<? echo $width;?>px" cellspacing="0" align="center" border="0">
			<tr>
				<td  align="left" rowspan="5"><img src="<?=base_url($image_location); ?>" height="70" width="200"></td>
				<td colspan="4" align="center"  style="font-size:xx-large; width:800px;">
					<strong>
						<? echo $company_library[$data[0]]; ?>
					</strong>
				</td>  
				<td colspan="3">&nbsp;</td>
			</tr>

			<tr>
				<td colspan="4" align="center">
					<strong>
						<span style="font-size:x-large;">
					<? echo $cid;?><sup><?php if($cid==1) { echo 'st';} elseif($cid==2) { echo  'nd';} else{ echo 'rd';} ?></sup> Copy</span>
					</strong>
				</td>
				<td align="right" style="width: 90px;"><strong> Bar Code : </strong></td>
				<td colspan="2" style="float: right;" id="barcode_img_id_<? echo $cid; ?>"></td>
			</tr>

			<tr class="form_caption">
				<td colspan="4" align="center">
					<?
					$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
						foreach ($nameArray as $result)
						{ 
							echo $result[csf('plot_no')]; 
							echo $result[csf('level_no')];
							echo $result[csf('road_no')];
							echo $result[csf('block_no')];
							echo $result[csf('city')];
							echo $result[csf('zip_code')];
							echo $result[csf('province')].',';
							echo $country_arr[$result[csf('country_id')]].'<br>'; 
							echo $result[csf('email')]; 
							echo $result[csf('website')];
						}
					?> 
					<div style="width:34%; text-align:center">
					&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
				</div>
				</td>
				
				<td colspan="3" rowspan="3"></td>
			</tr>


			<tr>
				<td style="display:none" colspan="4" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
			</tr>


			<tr>
				<td colspan="4" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
			</tr>
		</table>

	<!-- ######################################################################################################################## -->

		<table width="<? echo $width;?>px" cellspacing="0" align="center" border="0">
			<tr>
				<td width="160"><strong>System ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
				<td width="120"><strong>Basis:</strong></td><td width="225px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
				<td width="125"><strong>Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]);; ?></td>
			</tr>
			<tr>
				
				<td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
				<td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
				<td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
			</tr>
			<tr>
				<td><strong>Sent To:</strong></td><td width="175px" colspan="3" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
				<td><strong>To Location:</strong></td><td width="175px" colspan="2"><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
			</tr>
			<tr>
				<td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
				<td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
				<td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
			</tr>
			<tr>
				<td><strong>Est. Return Date 	 :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
				<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
				<td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
				
			</tr>
			<tr>
			
			<td><strong>Challan/System No:</strong></td><td width="175px" colspan="3"><? echo $challan_no; ?></td>
			</tr>
		</table>
		<br>

		<!-- ##################################################### Body part Start ########################################################### -->
		
		<?
				//$sql="select a.id, sum(b.production_qnty) as production_qnty, c.color_number_id, c.size_number_id from pro_garments_production_mst a, pro_garments_production_dtls b,  wo_po_color_size_breakdown c where a.id in ($emb_issue_ids) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and a.production_type=2 and b.production_type=2 and a.po_break_down_id=c.po_break_down_id and b.status_active=1 and b.is_deleted=0 and b.color_size_break_down_id=c.id and c.status_active=1 and c.is_deleted=0 group by a.id,c.color_number_id, c.size_number_id";
				
				
	$buyer_po_arr=array();
	$po_sql ="Select a.buyer_name, a.style_ref_no, b.id, b.po_number from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst";
	$po_sql_res=sql_select($po_sql);
	foreach ($po_sql_res as $row)
	{
		$buyer_po_arr[$row[csf("id")]]['style']=$row[csf("style_ref_no")];
		$buyer_po_arr[$row[csf("id")]]['po']=$row[csf("po_number")];
		$buyer_po_arr[$row[csf("id")]]['buyer']=$row[csf("buyer_name")];
	}
	unset($po_sql_res);
				
	/*$remarks_arr=array();		
	$remarks=sql_select("SELECT challan_no,remarks from inv_gate_pass_dtls where mst_id=$mst_id and status_active=1 and is_deleted=0");
	foreach ($remarks as $value) 
	{	
		$remarks_arr[$value[csf("challan_no")]]=$value[csf("remarks")];
	}*/
				 $sql= "select b.id as order_id,b.buyer_po_id,c.color_id as color_number_id,c.size_id as size_number_id,d.delivery_qty as production_qnty,d.remarks from subcon_ord_dtls b, subcon_ord_breakdown c,subcon_delivery_dtls d where  b.id=c.mst_id and c.id=d.color_size_id 
							 and  b.status_active=1 and b.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and d.mst_id='$data[4]' order by c.id ASC";

				$result=sql_select($sql);
				
				$size_array=array ();
				$color_array=array ();
				$qun_array=array ();
				$remarks_arr=array();
				foreach ( $result as $row )
				{
					$size_array[$row[csf('size_number_id')]]=$row[csf('size_number_id')];
					$color_array[$row[csf('color_number_id')]]=$row[csf('color_number_id')];
					$qun_array[$row[csf('buyer_po_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]=$row[csf('production_qnty')];
					$remarks_arr[$row[csf('buyer_po_id')]]=$row[csf('remarks')];
				}

				$sizearr=return_library_array("select id,size_name from lib_size ","id","size_name");
				$colorarr=return_library_array("select id,color_name from  lib_color ","id","color_name");
			?> 

		<div style="width:100%;">
			<table align="right" cellspacing="0" width="<? echo $width;?>"  border="1" rules="all" class="rpt_table" >
				<thead bgcolor="#dddddd" align="center">
					<th width="30">SL</th>
					<th width="150">Buyer</th>
					<th width="150">Style</th>
					<th width="120">Buyer Order</th>
					<th width="170">Item Description</th>
					<th width="80" align="center">Color/Size</th>
						<?
						foreach ($size_array as $sizid)
						{
							?>
								<th width="50"><strong><? echo  $sizearr[$sizid];  ?></strong></th>
							<?
						}
						?>
					<th width="80" align="center">Total Issue Qty.</th>
					<th>Remarks</th>
				</thead>
				<tbody>
					<?
						//$sql_prod="SELECT a.id, sum(b.production_qnty) as production_qnty, a.item_number_id,  c.color_number_id, d.style_ref_no, d.buyer_name, e.id as po_id, e.po_number from pro_garments_production_mst a, pro_garments_production_dtls b,  wo_po_color_size_breakdown c, wo_po_details_master d,  wo_po_break_down e where a.id in ($emb_issue_ids) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and a.production_type=2 and b.production_type=2 and a.po_break_down_id=c.po_break_down_id and b.status_active=1 and b.is_deleted=0 and b.color_size_break_down_id=c.id and c.status_active=1 and c.is_deleted=0 and d.job_no=c.job_no_mst and d.job_no=e.job_no_mst and c.po_break_down_id=e.id and d.status_active=1 and d.is_deleted=0 and e.status_active=1 and e.is_deleted=0 group by a.id,a.item_number_id,c.color_number_id, d.style_ref_no, d.buyer_name, e.id, e.po_number";
						
						//$sql_prod= "select b.id,b.buyer_po_id,c.color_id as color_number_id,c.size_id as size_number_id,sum(d.delivery_qty) as production_qnty  from subcon_ord_dtls b, subcon_ord_breakdown c, subcon_delivery_dtls d where  b.id=c.mst_id and c.id=d.color_size_id 
							// and  b.status_active=1 and b.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and d.mst_id='$data[4]' group by   b.id,b.buyer_po_id,c.color_id,c.size_id order by b.id ASC";
							 
							/* echo $sql_prod= "select  b.gmts_item_id,b.buyer_po_id,c.color_id as color_number_id,c.size_id as size_number_id from subcon_ord_mst a, subcon_ord_dtls b, subcon_ord_breakdown c, subcon_delivery_dtls d where a.embellishment_job=b.job_no_mst and b.id=c.mst_id and c.id=d.color_size_id and a.entry_form=204 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and a.company_id='$data[0]' and  d.mst_id='$data[4]' group by b.buyer_po_id,c.color_id,c.size_id,b.gmts_item_id order by b.buyer_po_id";
							 */
							   $sql_prod= "select  b.gmts_item_id,b.buyer_po_id,c.color_id as color_number_id from subcon_ord_mst a, subcon_ord_dtls b, subcon_ord_breakdown c, subcon_delivery_dtls d where a.embellishment_job=b.job_no_mst and b.id=c.mst_id and c.id=d.color_size_id and a.entry_form=204 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and a.company_id='$data[0]' and  d.mst_id='$data[4]' group by b.buyer_po_id,c.color_id,b.gmts_item_id order by b.buyer_po_id";
						
						$result_prod=sql_select($sql_prod);
						$i=1;
						$tot_specific_size_qnty=array();
						foreach ($result_prod as $val) 
						{
							$tot_color_size_qty=0;
							if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
							<tr>
								<td> <? echo $i;  ?> </td>
								<td> <? echo $buyer_library[$buyer_po_arr[$val[csf("buyer_po_id")]]['buyer']];  ?> </td>
								<td> <? echo $buyer_po_arr[$val[csf("buyer_po_id")]]['style']; //$val[csf("style_ref_no")]; ?> </td>
								<td> <? echo $buyer_po_arr[$val[csf("buyer_po_id")]]['po'];//$val[csf("buyer_po_id")]; ?> </td>
								<td> <? echo $garments_item[$val[csf("gmts_item_id")]]; ?> </td>
								
								<td> <? echo $colorarr[$val[csf("color_number_id")]]; ?> </td>
								<?
								foreach ($size_array as $sizval)
								{
								?>
									<td align="right"><? echo $qun_array[$val[csf("buyer_po_id")]][$val[csf("color_number_id")]][$sizval]; ?></td>
								<?
									$tot_color_size_qty+=$qun_array[$val[csf("buyer_po_id")]][$val[csf("color_number_id")]][$sizval];
									$tot_specific_size_qnty[$sizval]+=$qun_array[$val[csf("buyer_po_id")]][$val[csf("color_number_id")]][$sizval];
								}
								?>
								<td align="right"> 
									<? 
									echo $tot_color_size_qty; 
									?> 
								</td>
								<td>
									<p>
										<? echo $remarks_arr[$val[csf("buyer_po_id")]]; ?>
									</p>
								</td>
							</tr>
					<?
						$i++;	}
					?>
				</tbody>
				<tr>
					<td colspan="6" align="right"><strong>Grand Total : &nbsp;</strong></td>
					<?
						foreach ($size_array as $sizval)
						{
							?>
							<td align="right"><?php echo $tot_specific_size_qnty[$sizval]; ?></td>
							<?
						}
					?>
					<td align="right"><?php echo array_sum($tot_specific_size_qnty); ?></td>
					<td></td>
				</tr>                           
			</table>
	</div>

	<div>
		<? echo signature_table(114, $data[0], $width, $template_id); ?>
		
		<script type="text/javascript" src="../../js/jquery.js"></script>
		<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
		<script>

		function generateBarcode( valuess ){
			
				var value = valuess;//$("#barcodeValue").val();
			// alert(value)
				var btype = 'code39';//$("input[name=btype]:checked").val();
				var renderer ='bmp';// $("input[name=renderer]:checked").val();
				
				var settings = {
				output:renderer,
				bgColor: '#FFFFFF',
				color: '#000000',
				barWidth: 1,
				barHeight: 30,
				moduleSize:5,
				posX: 10,
				posY: 20,
				addQuietZone: 1
				};
				$("#barcode_img_id_<? echo $cid; ?>").html('11');
				value = {code:value, rect: false};
				
				$("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
			} 
		generateBarcode('<? echo $data[1]; ?>');
		</script>
	</div>
	<div class="pagebreak"> </div>
	<?
		}
	exit();
}

if($action=="print_to_html_report4")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//print_r ($data);
	$show_item=$data[2];
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");


	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
	
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to,vhicle_number, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,com_location_id,remarks from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 "; 
	//echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
 	$sent_to=$dataArray[0][csf('sent_to')];
	$shipmode_cartoon=sql_select("select  b.total_carton_qnty,b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no'") ;

	$shipmodes=sql_select("select  b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no' and (b.shiping_mode is not null or b.shiping_mode!=0) ") ;
	/*echo "<pre>";
	print_r($shipmode_cartoon);die;*/
	$ex_factory_del_data=array();
	if($basis==12)
	{
		 $sql_mst_ex_factory_del=sql_select("select a.sys_number,a.lock_no, a.dl_no,a.mobile_no, a.do_no, a.gp_no,a.remarks,a.truck_no,a.buyer_id,b.po_break_down_id from  pro_ex_factory_delivery_mst a,pro_ex_factory_mst b where a.sys_number='$challan_no' and a.entry_form!=85 and a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0");
	}
	$po_break_down_id="";
	foreach($sql_mst_ex_factory_del as $row)
	{
		$po_break_down_id.=$row[csf('po_break_down_id')].',';
		$ex_factory_del_data[$row[csf('sys_number')]]['lock_no']=$row[csf('lock_no')];
		$ex_factory_del_data[$row[csf('sys_number')]]['dl_no']=$row[csf('dl_no')];
		$ex_factory_del_data[$row[csf('sys_number')]]['mobile_no']=$row[csf('mobile_no')];
		$ex_factory_del_data[$row[csf('sys_number')]]['remarks']=$row[csf('remarks')];
		$ex_factory_del_data[$row[csf('sys_number')]]['truck_no']=$row[csf('truck_no')];
		
	}
	$poBreakDownId =chop($po_break_down_id,',');
	
	$res_breakDown = sql_select("select a.id,a.po_quantity,a.plan_cut, a.po_number,a.po_quantity,b.company_name, b.buyer_name, b.style_ref_no,b.gmts_item_id, b.order_uom, b.job_no,b.location_name,a.shipment_date   from wo_po_break_down a, wo_po_details_master b where a.job_no_mst=b.job_no and a.id in($poBreakDownId)"); 
	$break_down_data_arr=array();
 	foreach($res_breakDown as $row)
	{
		$break_down_data_arr[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$break_down_data_arr[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	if($basis==1)
	{ 
		if($within_group==1)
		{
			//$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
		else
		{
			//$send_to_company=$dataArray[0][csf('sent_to')];		
		}
	}
	
	if($within_group==2)
		{
			$send_to_company=$dataArray[0][csf('sent_to')];
		}
		else
		{
			$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	if($show_item==1)
	{
		$width=1150;
		//$colspan=5;
	}
	else
	{
		$width=1150;
		//$colspan=5;
		$colspan2=2;
	}
	
	?>
    
  
	<div style="width:<? echo $width+200;?>px;" align="center">
    <table width="<? echo $width+200;?>" cellspacing="0" align="center" border="0">
        
        <tr>
            <td  align="left"><img src="../../<? echo $image_location; ?>" height="70" width="200"></td>
            <td colspan="7" align="center"  style="font-size:xx-large; text-align:left;"><strong style="margin-left:100px" ><? echo $company_library[$data[0]]; ?></strong>
             <div style="float:right;width:34%; text-align:right">
               	&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
            </div>
            </td>
        </tr>
        <tr class="form_caption">
            <td colspan="8" align="center">
				<?
				$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
					//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
					foreach ($nameArray as $result)
					{ 
						echo $result[csf('plot_no')]; 
						echo $result[csf('level_no')];
						echo $result[csf('road_no')];
						echo $result[csf('block_no')];
						echo $result[csf('city')];
						echo $result[csf('zip_code')];
						echo $result[csf('province')].',';
						echo $country_arr[$result[csf('country_id')]].'<br>'; 
						echo $result[csf('email')]; 
						echo $result[csf('website')];
					}
                ?> 
                <div style="width:34%; text-align:center">
               	&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
            </div>
            </td>
        </tr>
        <tr>
        	<td style="display:none" colspan="6" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
        </tr>
        <tr>
            <td colspan="5" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
        </tr>
 	</table>
 </div>
 <div style="width:<? echo $width+200;?>px;" align="center">
    <table width="<? echo $width+200;?>" cellspacing="0" align="center" border="0">       
        <tr>
            <td style="width:150px;;"><strong>System ID:</strong></td>
            <td style="width:245px; font-size:20px;"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
            <td width="120"><strong>Basis:</strong></td>
            <td width="245px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
            <td width="165"><strong>Challan/System No:</strong></td>
            <td width="155px"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
        </tr>
         <tr>
            <td><strong>Department:</strong></td> <td><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
            <td><strong>Section:</strong></td><td><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
            <td><strong>Sent By:</strong></td> <td><? echo $dataArray[0][csf('sent_by')]; ?></td>
        </tr>
        <tr>
            <td><strong>Out-Time:</strong></td><td><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
            <td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
            <td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
        </tr>
        <tr>
          
            <td><strong>Est. Return Date :</strong></td><td><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
            <td><strong>Attention:</strong></td><td><? echo $dataArray[0][csf('attention')]; ?></td>
            <td><strong>Delivery As:</strong></td><td><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
        </tr>
         <tr>
            <td><strong>Vehicle Number:</strong></td><td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
            <td><strong>Returnable :</strong></td><td><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
            <td><strong>Lock:</strong></td><td><? echo $ex_factory_del_data[$challan_no]['lock_no'];//$dataArray[0][csf('issue_purpose')]; ?></td> 
        </tr>
         <tr>
            <td><strong>D/L Number:</strong></td><td><? echo $ex_factory_del_data[$challan_no]['dl_no']; ?></td>
            <td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
            <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
        </tr>
        <tr>
		  <td><strong>Mobile Number:</strong></td><td><? echo $ex_factory_del_data[$challan_no]['mobile_no']; ?></td>
           <td><strong>To Location :</strong></td><td><?  if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
           <td><strong>Bar Code:</strong></td><td  colspan="2" id="barcode_img_id"></td> 
        </tr>
        
        <tr>
           <td><strong>Remarks:</strong></td><td colspan="5"><? echo  $dataArray[0][csf('remarks')]; ?></td>
        </tr>
        
        
        
        
      <?php /*?>  <? if ($basis==12)
        {
        	?>
        	<tr>

       	 <td> <strong> Shipping Mode </strong></td>
       	 <td colspan="5" align="left"> <?  echo $shipment_mode[$shipmodes[0][csf("shiping_mode")]]; ?> </td>

       	 </tr>

	
       <? }?><?php */?>
        


    </table>
    <br>
    <table align="center" cellspacing="0" width="<? echo $width+200;?>"  border="1" rules="all" class="rpt_table" >
        <thead bgcolor="#dddddd" align="center">
            <th width="30">SL</th>
            
             <th width="100" align="center">Buyer</th>
             <th width="100" align="center">Style</th>
             
            <th width="80" align="center">Buyer Order </th>
            <th width="100" align="center">Item Category</th>
            <th width="100" align="center">Sample</th>
            <th width="200" align="center">Item Description</th>
            <th width="50" align="center">UOM</th>
            <th width="80" align="center">Quantity</th>
            <? if($basis==12)
            {?>
             <th width="100" align="center">No Of Carton </th>
	
            <?
            }
            else
            {
            ?>
             <th width="100" align="center">No Of Roll </th>
             <?
             }
             ?>
            <th width="80" align="center">No Of Bag/Roll/GMT </th>
            <?
            if($show_item==1)
			{
			?>
          	<th width="50" align="center">Rate</th> 
            <th width="80" align="center">Amount </th>
            <?
			}
			?>
            
            <th align="center">Remarks</th>
        </thead>
	<?
    $i=1;
	$gate_id=$dataArray[0][csf('id')];
	$sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags from  inv_gate_pass_dtls a where a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 ";
	//echo $sql_dtls;
	$uom_check=array();
	$sql_result=sql_select($sql_dtls);
	$tot_qty=0; $tot_amount=0; $tot_amount=0; $noOfCarton=0;
	$tot_roll=0;
	$p=0;
	foreach($sql_result as $row)
	{
		if ($i%2==0)  
			$bgcolor="#E9F3FF";
		else
			$bgcolor="#FFFFFF";
			
			$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
			$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
			//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
			$uom_check[$row[csf('uom')]]=$row[csf('uom')];
			?>
			<tr bgcolor="<? echo $bgcolor; ?>">
                <td><? echo $i; ?></td>
                
                <td><?  echo $buyer_library[$break_down_data_arr[$row[csf('buyer_order_id')]]['buyer_name']]; ?></td>
                <td><?  echo $break_down_data_arr[$row[csf('buyer_order_id')]]['style_ref_no']; ?></td>
                
                <td><? echo $row[csf('buyer_order')]; ?></td>
                <td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
                <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
                <td><?  echo $row[csf('item_description')]; ?></td>
                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
                <td align="right"><? echo number_format($row[csf('quantity')],2,'.',''); ?></td>   
                <?  if($basis==12)             
	                {
	                	?>
	                	<td align="right"><? echo $shipmode_cartoon[$p][csf("total_carton_qnty")]; ?></td>
	                	<?
	                }
	                else
	                {
		                ?>
		                <td align="right"><? if($basis==3){echo $no_of_rolls[$p][csf("no_roll")] =1; } else{echo $no_of_rolls[$p][csf("no_roll")] ;} ?></td>  
		                <?
	                }
                ?>
                <td align="right"><? echo $row[csf('no_of_bags')]; ?></td>
                <?
				if($show_item==1)
				{
				?>
                <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
                <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
                <?
				}
				?>
               
                <td><? echo $row[csf('remarks')]; ?></td>
			</tr>
		<?php
		$tot_roll +=$no_of_rolls[$p][csf("no_roll")];
		$noOfCarton+=$shipmode_cartoon[$p][csf("total_carton_qnty")];
    	$i++;
    	$p++;
		
		$tot_qty+=$row[csf('quantity')];		
		$tot_amount+=$row[csf('amount')];
		//$tot_bags+=$row[csf('no_of_bags')];
    }
	//$tot_check=array();
	if(count($uom_check)==1)
	{
	?>
    <tfoot bgcolor="#CCCCCC">
        <tr>
        <td colspan="8" align="right"> <b> Total</b></td>
        <td align="right"><b><? echo number_format($tot_qty,2);?></b></td>
         <?
		if($show_item==1)
		{
			if($basis==12)
			{
			?>
				<td align="right"><b><? echo $noOfCarton;?></b></td> 
            <?   
			}
			else
			{
			?>
				 <td align="right"><b><? echo $tot_roll;?></b></td> 
            <?
			} 
		?>         
        <?
		}
		else
		{
			if($basis==12)
			{
			?>
				<td align="right"><b><? echo $noOfCarton;?></b></td> 
        	<?
			}
			else
			{
				echo "<td></td>" ;
			}
		}
		?>
		<td align="right"><b><? echo number_format($tot_bags,2);?></b></td>
       
        <td colspan="<? echo 4+$colspan2;?>"></td>
        </tr>
	</tfoot>
    <?
	}
	 $width_sign=$width.'px';
	?>
    </table>
   


	</div>
	<div>
	<? echo signature_table(114, $data[0], $width_sign,$template_id); ?>
	</div> 
 <script type="text/javascript" src="../../js/jquery.js"></script>
      <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
     <script>

	function generateBarcode( valuess ){
		   
			var value = valuess;//$("#barcodeValue").val();
		 // alert(value)
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='bmp';// $("input[name=renderer]:checked").val();
			 
			var settings = {
			  output:renderer,
			  bgColor: '#FFFFFF',
			  color: '#000000',
			  barWidth: 1,
			  barHeight: 30,
			  moduleSize:5,
			  posX: 10,
			  posY: 20,
			  addQuietZone: 1
			};
			$("#barcode_img_id").html('11');
			 value = {code:value, rect: false};
			
			$("#barcode_img_id").show().barcode(value, btype, settings);
		} 
	 generateBarcode('<? echo $data[1]; ?>');
	 </script>
	<?
	exit();
}

if($action=="print_to_html_report9")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	// echo "<pre>";
	// print_r ($data);
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[5];
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");


	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	
	$sql_mst="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to,vhicle_number, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,com_location_id,do_no,remarks, driver_name from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 "; 
	//echo $sql;
	$dataArray=sql_select($sql_mst);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$driver_name=$dataArray[0][csf('driver_name')];
 	$sent_to=$dataArray[0][csf('sent_to')];
	$gate_mst_id=$dataArray[0][csf('id')];
	//echo $gate_mst_id.'=='.$challan_no;
	$shipmode_cartoon=sql_select("select  b.total_carton_qnty,b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no'") ;

	$shipmodes=sql_select("select  b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no' and (b.shiping_mode is not null or b.shiping_mode!=0) ") ;
	$actual_po_library=return_library_array( "SELECT id, acc_po_no from wo_po_acc_po_info",'id','acc_po_no');
	/*echo "<pre>";
	print_r($shipmode_cartoon);die;*/
	$ex_factory_del_data=array();
	$ex_factory_del_data_po=array();
	if($basis==12)
	{
		 $sql_mst_ex_factory_del=sql_select("select a.sys_number,a.lock_no, a.dl_no,a.mobile_no, a.do_no, a.gp_no,a.remarks,a.truck_no,a.buyer_id,b.po_break_down_id,b.actual_po from  pro_ex_factory_delivery_mst a,pro_ex_factory_mst b where a.sys_number='$challan_no' and a.entry_form!=85 and a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0");
		 //echo "select a.sys_number,a.lock_no, a.dl_no,a.mobile_no, a.do_no, a.gp_no,a.remarks,a.truck_no,a.buyer_id,b.po_break_down_id,b.actual_po from  pro_ex_factory_delivery_mst a,pro_ex_factory_mst b where a.sys_number='$challan_no' and a.entry_form!=85 and a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0";
	}
	$po_break_down_id="";
	foreach($sql_mst_ex_factory_del as $row)
	{
		$actual_po=explode(",", $row[csf('actual_po')]);
	 	$actual_po_no="";
	 	foreach($actual_po as $val)
	 	{
	 		if($actual_po_no=="") $actual_po_no=$actual_po_library[$val]; else $actual_po_no.=','.$actual_po_library[$val];
	 	}
		$po_break_down_id.=$row[csf('po_break_down_id')].',';
		$ex_factory_del_data[$row[csf('sys_number')]]['lock_no']=$row[csf('lock_no')];
		$ex_factory_del_data[$row[csf('sys_number')]]['dl_no']=$row[csf('dl_no')];
		$ex_factory_del_data[$row[csf('sys_number')]]['mobile_no']=$row[csf('mobile_no')];
		$ex_factory_del_data[$row[csf('sys_number')]]['remarks']=$row[csf('remarks')];
		$ex_factory_del_data[$row[csf('sys_number')]]['truck_no']=$row[csf('truck_no')];
		//$ex_factory_del_data[$row[csf('sys_number')]]['actual_po'].=$actual_po_no;
		$ex_factory_del_data_po[$row[csf('sys_number')]][$row[csf('po_break_down_id')]]['actual_po']=$actual_po_no;
	
	}
	//var_dump($ex_factory_del_data);
	$poBreakDownId =chop($po_break_down_id,',');
	if($poBreakDownId=='') $poBreakDownId=0;else $poBreakDownId=$poBreakDownId;
	$res_breakDown = sql_select("select a.id,a.po_quantity,a.plan_cut, a.po_number,a.po_quantity,b.company_name, b.buyer_name, b.style_ref_no,b.gmts_item_id, b.order_uom, b.job_no,b.location_name,a.shipment_date   from wo_po_break_down a, wo_po_details_master b where a.job_no_mst=b.job_no and a.id in($poBreakDownId)"); 
	$break_down_data_arr=array();
 	foreach($res_breakDown as $row)
	{
		$break_down_data_arr[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$break_down_data_arr[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	if($basis==12)
	{ 
		if($within_group==1)
		{
			$send_to_company=$supplier_name_library[$dataArray[0][csf('sent_to')]];
		}
		else
		{
			$send_to_company=$dataArray[0][csf('sent_to')];		
		}
	}
	//echo $dataArray[0][csf('sent_to')].'D';
	
	/*if($within_group==2)
		{
			$send_to_company=$dataArray[0][csf('sent_to')];
		}
		else
		{
			$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}*/
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}

	/*$sqlResult =sql_select("SELECT id,garments_nature,po_break_down_id,item_number_id,country_id,location,ex_factory_date,ex_factory_qnty,total_carton_qnty,challan_no,invoice_no,lc_sc_no,carton_qnty,transport_com,remarks,shiping_status,entry_break_down_type,inspection_qty_validation,delivery_mst_id,is_posted_account,shiping_mode,foc_or_claim,inco_terms,actual_po,additional_info,additional_info_id  from pro_ex_factory_mst where id='$data' and status_active=1 and entry_form<>85 and is_deleted=0 order by id");

 	$actual_po=explode(",", $sqlResult[0][csf('actual_po')]);
 	$actual_po_no="";
 	foreach($actual_po as $val)
 	{
 		if($actual_po_no=="")$actual_po_no=$actual_po_library[$val]; else $actual_po_no.=','.$actual_po_library[$val];
 	}*/

	$width=1050;
	$com_dtls = fnc_company_location_address($company, $location, 2);
	?>
  
	<div style="width:<? echo $width+200;?>px;" align="center">
    <table width="<? echo $width+200;?>" cellspacing="0" align="center" border="0">
        
        <tr>
            <td  align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="70" width="200"></td>
            <td colspan="6" align="center"  style="font-size:xx-large; text-align:left;"><strong style="margin-left:100px" ><? echo $com_dtls[0]; ?></strong>
             <div style="float:right;width:24px; margin-right:80px; text-align:right">
				 <div style="height:13px; width:15px;" id="qrcode"></div> 
            </div>
            </td>
        </tr>
        <tr class="form_caption">
            <td colspan="8" align="center">
				<?
				echo $com_dtls[1];
				/*$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
					//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
					foreach ($nameArray as $result)
					{ 
						echo $result[csf('plot_no')]; 
						echo $result[csf('level_no')];
						echo $result[csf('road_no')];
						echo $result[csf('block_no')];
						echo $result[csf('city')];
						echo $result[csf('zip_code')];
						echo $result[csf('province')].',';
						echo $country_arr[$result[csf('country_id')]].'<br>'; 
						echo $result[csf('email')]; 
						echo $result[csf('website')];
					}*/
                ?> 
                <div style="width:34%; text-align:center">
               	&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
            </div>
               	
            </td>
        </tr>
        <tr>
        	<td style="display:none" colspan="6" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
        </tr>
        <tr>
            <td colspan="5" align="center" style="font-size:x-large;"><strong><u>Gate Pass</u></strong>
				<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC;float:right; background:#EEE;padding:0px;'>Returnable</span>";?>
			</td>
			
        </tr>
 	</table>
 </div>
 <div style="width:<? echo $width+200;?>px;" align="center">
    <table width="<? echo $width+200;?>" cellspacing="0" align="center" border="0">       
        <tr>
            <td style="width:150px;;"><strong>System ID:</strong></td>
            <td style="width:245px; font-size:20px;"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
            <td width="120"><strong>Basis:</strong></td>
            <td width="245px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
            <td width="165"><strong>Challan/System No:</strong></td>
            <td width="155px"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
        </tr>
         <tr>
            <td><strong>Department:</strong></td> <td><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
            <td><strong>Section:</strong></td><td><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
            <td><strong>Sent By:</strong></td> <td><? echo $dataArray[0][csf('sent_by')]; ?></td>
        </tr>
        <tr>
            <td><strong>Out-Time:</strong></td><td><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
            <td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
            <td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
        </tr>
        <tr>
          
            <td><strong>Est. Return Date :</strong></td><td><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
            <td><strong>Attention:</strong></td><td><? echo $dataArray[0][csf('attention')]; ?></td>
            <td><strong>Delivery As:</strong></td><td><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
        </tr>
         <tr>
            <td><strong>Vehicle Number:</strong></td><td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
            <td><strong>Returnable :</strong></td><td><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
            <td><strong>Lock:</strong></td><td><? echo $ex_factory_del_data[$challan_no]['lock_no'];//$dataArray[0][csf('issue_purpose')]; ?></td> 
        </tr>
         <tr>
            <td><strong>D/L Number:</strong></td><td><? echo $ex_factory_del_data[$challan_no]['dl_no']; ?></td>
            <td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
            <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
        </tr>
        <tr>
		  <td><strong>Mobile Number:</strong></td><td><? echo $ex_factory_del_data[$challan_no]['mobile_no']; ?></td>
           <td><strong>To Location :</strong></td><td><?  if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
           <td><strong>D.O No:</strong></td><td><? echo $dataArray[0][csf('do_no')]; ?></td>
        </tr>
        
        <tr>
           <td><strong>Remarks:</strong></td><td ><? echo  $dataArray[0][csf('remarks')]; ?></td>
           <td><strong>Driver Name :</strong></td><td ><? echo  $dataArray[0][csf('driver_name')]; ?></td>
		   <td><strong>Barcode:</strong></td><td id="barcode_img_id"></td>
        </tr>
        

    </table>
    <br>
    <table align="center" cellspacing="0" width="<? echo $width+200;?>"  border="1" rules="all" class="rpt_table" >
        <thead bgcolor="#dddddd" align="center">
            <th width="30">SL</th>
            
             <th width="100" align="center">Buyer</th>
             <th width="100" align="center">Style</th>
             
            <th width="80" align="center">Buyer Order </th>
            <th width="100" align="center">Actual PO</th>
            <th width="100" align="center">Item Category</th>
           
            <th width="200" align="center">Item Description</th>
            <th width="50" align="center">UOM</th>
            <th width="80" align="center">Quantity</th>
			 <th width="100" align="center">Total Carton Qty </th>
 			<th align="center">Remarks</th>
           
        </thead>
	<?
    $i=1;
	
	$sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.total_carton_qty from  inv_gate_pass_dtls a where a.mst_id=$gate_mst_id and a.status_active=1 and a.is_deleted=0 ";
	//echo $sql_dtls;
	//$uom_check=array();
	$sql_result=sql_select($sql_dtls);
	$tot_qty=0; $tot_amount=0; $tot_amount=0; $noOfCarton=0;
	$tot_roll=0;
	$p=0;
	foreach($sql_result as $row)
	{
		if ($i%2==0)  
			$bgcolor="#E9F3FF";
		else
			$bgcolor="#FFFFFF";
			
			$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
			$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
			//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
			//$uom_check[$row[csf('uom')]]=$row[csf('uom')];
			?>
			<tr bgcolor="<? echo $bgcolor; ?>">
                <td><? echo $i; ?></td>
                
                <td align="center"><?  echo $buyer_library[$break_down_data_arr[$row[csf('buyer_order_id')]]['buyer_name']]; ?></td>
                <td align="center"><?  echo $break_down_data_arr[$row[csf('buyer_order_id')]]['style_ref_no']; ?></td>
                
                <td align="center"><? echo $row[csf('buyer_order')]; ?></td>
                <td align="center"><? echo $ex_factory_del_data_po[$challan_no][$row[csf('buyer_order_id')]]['actual_po']; ?></td>
                <td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
               
                <td align="center"><?  echo $row[csf('item_description')]; ?></td>
                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
                <td align="right"><? echo number_format($row[csf('quantity')],2,'.',''); ?></td> 
				<td align="right"><b><? echo number_format($row[csf('total_carton_qty')],0);?></b></td> 
				 <td><?  echo $row[csf('remarks')]; ?></td>  
              
			</tr>
		<?php
		//$tot_roll +=$no_of_rolls[$p][csf("no_roll")];
		//$noOfCarton+=$shipmode_cartoon[$p][csf("total_carton_qnty")];
    	$i++;
    	//$p++;
		
		$tot_qty+=$row[csf('quantity')];		
		//$tot_amount+=$row[csf('amount')];
		$total_carton_qty+=$row[csf('total_carton_qty')];
    }
	//$tot_check=array();
	//if(count($uom_check)==1)
	//{
	?>
    <tfoot bgcolor="#CCCCCC">
        <tr>
        <td colspan="8" align="right"> <b> Total</b></td>
        <td align="right"><b><? echo number_format($tot_qty,2);?></b></td>
	 	<td align="right"><b><? echo number_format($total_carton_qty,2);?></td>
		<td align="right">&nbsp;</td>
		
        
        </tr>
	</tfoot>
    <?
	//}
	 $width_sign=$width+'200'.'px';
	?>
    </table>
   


	</div>
	<div>
		<? echo signature_table(114, $data[0], $width_sign,$template_id); ?>
	</div> 
	<script type="text/javascript" src="../../js/jquery.js"></script>
	<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
	<script type="text/javascript" src="../../js/jquery.qrcode.min.js"></script>
	<script>
		var main_value='<? echo $data[1]; ?>';
		//alert(main_value);
		$('#qrcode').qrcode(main_value);

		function generateBarcode( valuess ){			   
			var value = valuess;//$("#barcodeValue").val();
			//alert(value)
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='bmp';// $("input[name=renderer]:checked").val();
				
			var settings = {
				output:renderer,
				bgColor: '#FFFFFF',
				color: '#000000',
				barWidth: 1,
				barHeight: 30,
				moduleSize:5,
				posX: 10,
				posY: 20,
				addQuietZone: 1
			};
			$("#barcode_img_id").html('11');
			value = {code:value, rect: false};
			   
			$("#barcode_img_id").show().barcode(value, btype, settings);
		} 
		generateBarcode('<? echo $data[1]; ?>');
	</script>
	<?
	exit();
}

if($action=="print_to_html_report10") //Sample Delivery
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//print_r ($data);
	$show_item=$data[2];
	$company=$data[0];
	$location=$data[5];
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$color_name_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");

	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	/*$non_ord_booking_no_library=return_library_array( "select id, booking_no from  wo_non_ord_samp_booking_dtls", "id", "booking_no"  );
	$non_sample="select a.buyer_id,b.id, b.booking_no from  wo_non_ord_samp_booking_mst a,wo_non_ord_samp_booking_dtls b where a.booking_no=b.booking_no";
	
	$sampple_dataArray=sql_select($non_sample);
	foreach($sampple_dataArray as $row)
	{
		$sample_non_ord_arr[$row[csf('id')]]['booking_no']=$row[csf('booking_no')];
		$sample_non_ord_arr[$row[csf('id')]]['buyer_id']=$row[csf('buyer_id')];
	}*/
	
	$sql_mst="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to,vhicle_number, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,mobile_no,location_id,location_name,com_location_id,do_no,remarks from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 "; 
	//echo $sql;
	$dataArray=sql_select($sql_mst);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
 	$sent_to=$dataArray[0][csf('sent_to')];
	$gate_mst_id=$dataArray[0][csf('id')];
	
	$challan_no=array_unique(explode(",",$challan_no));
   $all_challan="";
    foreach($challan_no as $cno)
	{
			if($all_challan=="") $all_challan="'".$cno."'"; else $all_challan.=","."'".$cno."'";
	}
	//echo $gate_mst_id.'=='.$challan_no;

	$ex_factory_del_data=array();
	 $sql_mst_ex_factory_del=sql_select("select a.sys_number,a.delivery_basis,b.sample_development_id,a.final_destination from  sample_ex_factory_mst a, sample_ex_factory_dtls b where  a.id=b.sample_ex_factory_mst_id and a.status_active=1 and a.entry_form_id=132 and a.sys_number in($all_challan)  and a.status_active=1 and a.is_deleted=0");
		
	$po_break_down_id="";$final_destination="";
	foreach($sql_mst_ex_factory_del as $row)
	{
		$delivery_basis=$row[csf('delivery_basis')];
		if($delivery_basis==2)
		{
			$po_break_down_id.=$row[csf('sample_development_id')].',';
		}
		if($row[csf('final_destination')]!='')
		{
			$final_destination.=$row[csf('final_destination')].',';
		}
	}
	
	
	
	$poBreakDownId =chop($po_break_down_id,',');
	if($poBreakDownId=='') $poBreakDownId=0;else $poBreakDownId=$poBreakDownId;
	$res_breakDown = sql_select("select a.id,a.po_quantity,a.plan_cut, a.po_number,a.po_quantity,b.job_no,b.company_name, b.buyer_name, b.style_ref_no,b.gmts_item_id, b.order_uom, b.job_no,b.location_name,a.shipment_date   from wo_po_break_down a, wo_po_details_master b where a.job_no_mst=b.job_no and a.id in($poBreakDownId)"); 
	$break_down_data_arr=array();
 	foreach($res_breakDown as $row)
	{
		$break_down_data_arr[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$break_down_data_arr[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
		$break_down_data_arr[$row[csf('id')]]['po_number']=$row[csf('po_number')];
		$break_down_data_arr[$row[csf('id')]]['job_no']=$row[csf('job_no')];
	}
	if($basis==28)
	{ 
		if($within_group==1)
		{
			$send_to_company=$supplier_name_library[$dataArray[0][csf('sent_to')]];
		}
		else
		{
			$send_to_company=$dataArray[0][csf('sent_to')];		
		}
	}
	
	
	$width=1050;
	$com_dtls = fnc_company_location_address($company, $location, 2);
	?>
  
	<div style="width:<? echo $width+200;?>px;" align="center">
    <table width="<? echo $width+200;?>" cellspacing="0" align="center" border="0">
        
        <tr>
            <td  align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="70" width="200"></td>
            <td colspan="6" align="center"  style="font-size:xx-large; text-align:left;"><strong style="margin-left:100px" ><? echo $com_dtls[0]; ?></strong>
             <div style="float:right;width:24px; margin-right:80px; text-align:right">
				 <div style="height:13px; width:15px;" id="qrcode"></div> 
            </div>
            </td>
        </tr>
        <tr class="form_caption">
            <td colspan="8" align="center">
				<?
				echo $com_dtls[1];
				/*$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
					//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
					foreach ($nameArray as $result)
					{ 
						echo $result[csf('plot_no')]; 
						echo $result[csf('level_no')];
						echo $result[csf('road_no')];
						echo $result[csf('block_no')];
						echo $result[csf('city')];
						echo $result[csf('zip_code')];
						echo $result[csf('province')].',';
						echo $country_arr[$result[csf('country_id')]].'<br>'; 
						echo $result[csf('email')]; 
						echo $result[csf('website')];
					}*/
                ?> 
                <div style="width:34%; text-align:center">
               	&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
            </div>
               	
            </td>
        </tr>
        <tr>
        	<td style="display:none" colspan="6" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
        </tr>
        <tr>
            <td colspan="5" align="center" style="font-size:x-large;"><strong><u>Gate Pass</u></strong>
				<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC;float:right; background:#EEE;padding:0px;'>Returnable</span>";?>
			</td>
			
        </tr>
 	</table>
 </div>
 <div style="width:<? echo $width+200;?>px;" align="center">
    <table width="<? echo $width+200;?>" cellspacing="0" align="center" border="0">       
        <tr>
            <td style="width:150px;;"><strong>Gate Pass ID:</strong></td>
            <td style="width:245px; font-size:20px;"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
            <td width="130"><strong>Basis:</strong></td>
            <td width="245px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
            <td width="165"><strong>Do No:</strong></td>
             <td><strong>D.O No:</strong></td><td><? echo $dataArray[0][csf('do_no')]; ?></td>
        </tr>
         <tr>
            <td><strong>Department:</strong></td> <td><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
            <td><strong>Section:</strong></td><td><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
            <td><strong>Sent By:</strong></td> <td><? echo $dataArray[0][csf('sent_by')]; ?></td>
        </tr>
        <tr>
            <td><strong>Out-Time:</strong></td><td> &nbsp;<? echo $dataArray[0][csf('time_hour')]." : ".$dataArray[0][csf('time_minute')];;//$dataArray[0][csf('time_hour')].":".str_pad("0",2,$dataArray[0][csf('time_minute')]).""; ?></td>
            <td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
            <td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
        </tr>
        <tr>
            <td><strong>Final Destination:</strong></td><td><? $final_destination=rtrim($final_destination,",");echo implode(",",array_unique(explode(",",$final_destination))); ?></td>
            <td><strong width="130">Est. Return Date:</strong></td><td><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
            <td><strong>Returnable :</strong></td><td><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
        </tr>
         
         <tr>
             <td><strong>To Location :</strong></td><td><?  if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
            <td><strong width="130">Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
			 <td><strong>Mobile Number:</strong></td><td><? echo $dataArray[0][csf('mobile_no')];; ?></td>
            
        </tr>
        <tr>
		  <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
		  <td><strong>Remarks:</strong></td><td colspan="5"><? echo  $dataArray[0][csf('remarks')]; ?></td>
        </tr>

    </table>
    <br>
    <table align="center" cellspacing="0" width="<? echo $width+200;?>"  border="1" rules="all" class="rpt_table" >
        <thead bgcolor="#dddddd" align="center">
            <th width="30">SL</th>
            <th width="140" align="center">Challan/System No</th>
			<th width="140" align="center">Job & Booking No.</th>
			<th width="100" align="center">Buyer</th>
			<th width="100" align="center">Style Ref.</th>
            <th width="80" align="center">Order No </th>
			<th width="140" align="center">Type Of Sample</th>
			<th width="100" align="center">Item Name</th>
            <th width="120" align="center">Color Name</th>
            <th width="80" align="center">Delivery Qnty</th>
			<th width="70" align="center">NO Of Carton</th>
 			<th align="center">Remarks</th>
        </thead>
	<?
		$sample_name_library=return_library_array( "select sample_name,id from lib_sample where is_deleted=0 and status_active=1 order by sample_name", "id", "sample_name"  );
   
	   $sql_sample= "select a.sys_number_prefix_num,b.sample_development_id, a.sys_number as sys_number,a.company_id, a.delivery_basis,a.ex_factory_date as ex_factory_date,b.sample_name,b.gmts_item_id, sum(c.size_pass_qty) as quantity,c.color_id
			from sample_ex_factory_mst a, sample_ex_factory_dtls b,sample_ex_factory_colorsize c
			where a.id=b.sample_ex_factory_mst_id and c.sample_ex_factory_mst_id=a.id and c.sample_ex_factory_dtls_id=b.id and a.status_active=1 and a.entry_form_id=132 and a.sys_number in($all_challan) and c.size_pass_qty>0 group by a.sys_number_prefix_num, a.sys_number,b.sample_development_id, a.company_id,b.sample_name,b.gmts_item_id, a.delivery_basis,a.ex_factory_date,c.color_id  order by a.sys_number_prefix_num";

	$sql_result=sql_select($sql_sample);
	$sample_booking_dtls_id='';
	foreach($sql_result as $row)
	{
		$delivery_basis=$row[csf('delivery_basis')];
			if($delivery_basis==3) //Sample Booking
			{
				$sample_booking_dtls_id.=$row[csf('sample_development_id')].',';
			}
	}
		$sample_booking_dtls_id=rtrim($sample_booking_dtls_id,',');
			if($sample_booking_dtls_id=='') $sample_booking_dtls_id=0;else $sample_booking_dtls_id=$sample_booking_dtls_id;
		$non_sample="select a.buyer_id,b.id,b.style_des, b.booking_no from  wo_non_ord_samp_booking_mst a,wo_non_ord_samp_booking_dtls b where a.booking_no=b.booking_no and b.id in($sample_booking_dtls_id)";
		$sampple_dataArray=sql_select($non_sample);
		foreach($sampple_dataArray as $row)
		{
			$sample_non_ord_arr[$row[csf('id')]]['booking_no']=$row[csf('booking_no')];
			$sample_non_ord_arr[$row[csf('id')]]['buyer_id']=$row[csf('buyer_id')];
			$sample_non_ord_arr[$row[csf('id')]]['style_des']=$row[csf('style_des')];
		}
		
	$tot_qty=0; $noOfCarton=0;
	 $i=1;
	foreach($sql_result as $row)
	{
		if ($i%2==0)  
			$bgcolor="#E9F3FF";
		else
			$bgcolor="#FFFFFF";
			$delivery_basis=$row[csf('delivery_basis')];
			if($delivery_basis==2) //Order
			{
				$job_booking_no=$break_down_data_arr[$row[csf('sample_development_id')]]['job_no'];
				$po_number=$break_down_data_arr[$row[csf('sample_development_id')]]['po_number'];
				$buyer_name=$buyer_library[$break_down_data_arr[$row[csf('sample_development_id')]]['buyer_name']];
				$style_ref=$break_down_data_arr[$row[csf('sample_development_id')]]['style_ref_no'];
			}
			else if($delivery_basis==3)
			{
				$job_booking_no=$sample_non_ord_arr[$row[csf('sample_development_id')]]['booking_no'];
				$style_ref=$sample_non_ord_arr[$row[csf('sample_development_id')]]['style_des'];
				$buyer_name=$buyer_library[$sample_non_ord_arr[$row[csf('sample_development_id')]]['buyer_id']];
				$po_number='';
			}
			?>
			<tr bgcolor="<? echo $bgcolor; ?>">
                <td><? echo $i; ?></td>
                
                <td><?  echo $row[csf('sys_number')]; ?></td>
				 <td><? echo $job_booking_no; ?></td>
				<td><?  echo $buyer_name; ?></td>
                <td><?  echo $style_ref; ?></td>
                <td><?  echo   $po_number; ?></td>
				<td><?  echo $sample_name_library[$row[csf('sample_name')]]; ?></td>
				<td align="center"><? echo $garments_item[$row[csf('gmts_item_id')]]; ?></td>
                <td><?  echo $color_name_arr[$row[csf('color_id')]]; ?></td>
                <td align="right"><? echo number_format($row[csf('quantity')],0,'.',''); ?></td> 
				<td align="right"><b><? echo $row[csf('no_of_bags')];?></b></td> 
				 <td><?  echo $row[csf('remarks')]; ?></td>  
              
			</tr>
		<?php
    	$i++;
		$tot_qty+=$row[csf('quantity')];		
		//$tot_bags+=$row[csf('no_of_bags')];
    }
	
	?>
    <tfoot bgcolor="#CCCCCC">
        <tr>
        <th colspan="9" align="right"> <b> Total</b></th>
        <th align="right"><b><? echo number_format($tot_qty,0);?></b></th>
	 	<th align="right"><b><? echo number_format($tot_bags,0);?></th>
		<th align="right">&nbsp;</th>
        </tr>
		  <tr>
                <th colspan="12"  style="border:1px solid black; text-align: left">
                In Words: <? echo number_to_words(def_number_format($tot_qty,0,"")); ?> Pcs
          </th>
	</tfoot>
	
    <?
	 $width_sign=$width+'200'.'px';
	?>
    </table>

	</div>
	<div>
		<? echo signature_table(114, $data[0], $width_sign,$template_id); ?>
	</div> 
	<script type="text/javascript" src="../../js/jquery.js"></script>
	<script type="text/javascript" src="../../js/jquery.qrcode.min.js"></script>
	<script>
	var main_value='<? echo $data[1]; ?>';
	//alert(main_value);
		$('#qrcode').qrcode(main_value);
	</script>
	<?
	exit();
}

if($action=="print_to_html_report5")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	// print_r ($data); die;
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[2];
	$cbo_location = $data[4];
	// echo $cbo_location; die;
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$lib_item_group_lib=return_library_array( "select id, item_name from  lib_item_group", "id", "item_name");

	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");


	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
	
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to,vhicle_number, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,com_location_id,do_no,mobile_no, security_lock_no,remarks from inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 "; 
	//echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
 	$sent_to=$dataArray[0][csf('sent_to')];
	$shipmode_cartoon=sql_select("select  b.total_carton_qnty,b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no'") ;

	$shipmodes=sql_select("select  b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no' and (b.shiping_mode is not null or b.shiping_mode!=0) ") ;
	/*echo "<pre>";
	print_r($shipmode_cartoon);die;*/

	// echo "Hello-". $basis; die;
	if($basis==1)
	{ 
		if($within_group==1)
		{
			//$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
		else
		{
			//$send_to_company=$dataArray[0][csf('sent_to')];		
		}
	}
	else if($basis==8 || $basis==9 || $basis==27)
	{
		//$send_to_company=$dataArray[0][csf('sent_to')];	
		$no_of_rolls = sql_select("select a.id,b.carton_roll as no_roll from subcon_delivery_mst a ,subcon_delivery_dtls b where a.id=b.mst_id  and a.delivery_no='$challan_no' and a.status_active=1 and a.is_deleted=0  and a.process_id in(2,4,3) ");
	}

	else if($basis==17)
	{
		$no_of_rolls=sql_select("select b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty as cons_quantity,
		b.yarn_lot,b.rate as cons_rate,b.transfer_value as cons_amount,b.brand_id,c.product_name_details,d.no_of_bags,b.roll as no_roll from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c,inv_transaction d 
		where a.id=b.mst_id and c.id=b.from_prod_id and b.from_prod_id=d.prod_id and a.transfer_system_id='$challan_no' and b.item_category=13 
		and b.status_active = '1' and b.is_deleted = '0' and d.no_of_bags is not NULL
		group by  b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty,
		b.yarn_lot,b.rate,b.transfer_value ,b.brand_id,c.product_name_details,d.no_of_bags ,b.roll ");
	}
	else if($basis==11)
	{
		$no_of_rolls=sql_select("select a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity,b.batch_id,roll as no_roll
		from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
		where a.sys_number='$challan_no' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form=54 and b.entry_form=54");
	}
	else if($basis==12)
	{
		//$send_to_company=$supplier_name_library[$dataArray[0][csf('sent_to')]];
	}
	else if($basis==10)
	{
		$no_of_rolls=sql_select("select a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity,b.roll as no_roll
		from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
		where a.sys_number='$challan_no' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.entry_form=53 and b.entry_form=53");
	}

	else if($basis==15) //Finish Fabric Recv Return
	{
		//echo $mst_challan;		
		$no_of_rolls =sql_select("select a.id as issue_id, a.item_category, a.received_id, a.received_mrr_no, b.id as trans_id, b.cons_quantity as cons_quantity,b.cons_uom, b.cons_rate, b.cons_amount, c.product_name_details, c.id as prod_id  ,b.no_of_roll as no_roll 
		from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id
		where a.id=b.mst_id and b.item_category=2 and b.transaction_type=3 and  a.issue_number='$challan_no' order by b.id");		   
	}

	else if($basis==4)
	{
		$no_of_rolls = sql_select("select a.id,a.transaction_type,a.item_category,b.product_name_details,a.cons_rate,a.cons_quantity,a.cons_uom ,a.cons_amount,a.remarks,b.unit_of_measure ,c.no_of_roll as no_roll 
		from inv_transaction a, product_details_master b,inv_finish_fabric_issue_dtls c ,inv_issue_master d,inv_gate_pass_mst e  
		where a.prod_id=b.id and d.id=a.mst_id  and d.id=c.mst_id and a.id=c.trans_id and d.id=e.issue_id and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.issue_number='$challan_no'"); 
 	}

 	else if($basis==22)
	{
		$no_of_rolls = sql_select("select b.roll_no as no_roll from inv_receive_mas_batchroll a,pro_grey_batch_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.recv_number='$challan_no'"); 
 	}
	else
	{
		//echo $within_group.'=='.$basis;
		/*if($basis==2 || $basis==3 || $basis==4 || $basis==5 || $basis==6 || $basis==7  ||  $basis==10 || $basis==13 ||  $basis==14 ||  $basis==11 ||  $basis==15)
		{
			if($within_group==2)
			{
				$send_to_company=$dataArray[0][csf('sent_to')];
			}
			else
			{
				$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
			}
		}
		else
		{
				$send_to_company=$dataArray[0][csf('sent_to')];	
		}*/
		//$send_to_company=$dataArray[0][csf('sent_to')];
	}
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	if($show_item==1)
	{
		$width=1150;
		//$colspan=5;
	}
	else
	{
		$width=1150;
		//$colspan=5;
		$colspan2=2;
	}
	$com_dtls = fnc_company_location_address($company, $location, 2);
	?>
	<div style="width:<? echo $width;?>px;" align="center">
    <table width="<? echo $width;?>" cellspacing="0" align="center" border="0">
        <tr>
            <td align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="45" width="45"></td>
            <td colspan="7" align="center"  style="font-size:xx-large;">
				<strong style="margin-left:100px" ><? echo $com_dtls[0]; ?></strong>
				<div style="float:right;width:34%; text-align:right">
					<div style="float:left; height:5%; width:5%;" id="qrcode"></div> 
					&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
				</div>
            </td>
        </tr>
        <tr class="form_caption">
            <td colspan="8" align="center">
				<?
				echo $com_dtls[1];
				/*$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
					//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
					foreach ($nameArray as $result)
					{ 
						echo $result[csf('plot_no')]; 
						echo $result[csf('level_no')];
						echo $result[csf('road_no')];
						echo $result[csf('block_no')];
						echo $result[csf('city')];
						echo $result[csf('zip_code')];
						echo $result[csf('province')].',';
						echo $country_arr[$result[csf('country_id')]].'<br>'; 
						echo $result[csf('email')]; 
						echo $result[csf('website')];
					}*/
                ?> 
                <div style="width:34%; text-align:center">
               	&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
            	</div>
            </td>
        </tr>
        <tr>
        	<td style="display:none" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
        </tr>
        <tr>
            <td colspan="8" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
        </tr>
        <tr>
            <td width="160"><strong>Gate Pass ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
            <td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
           <?php /*?> <td width="125"><strong>Challan/System No:</strong></td><td width="175px" colspan="2"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td><?php */?>
            <td width="125"><strong>D.O No:</strong></td><td width="175px" colspan="2"><? echo $dataArray[0][csf('do_no')];//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
        </tr>
         <tr>
            
            <td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
            <td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
            <td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
        </tr>
        <tr>
            <td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
            <td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
            <td><strong>Mobile No:</strong></td><td width="175px" colspan="2"><? echo $dataArray[0][csf('mobile_no')]; ?></td>
        </tr>
        <tr>
          	<?
			if($within_group==2)
			{
				$send_to_company_id=$dataArray[0][csf('sent_to')];
				$nameArrays = sql_select("select address_1,web_site,email,country_id from lib_supplier where supplier_name='$send_to_company_id'");
      			// $supp_add = $send_to_company_id;
			  	foreach ($nameArrays as $result) {
					$address = "";
					if ($result != "") $address = $result[csf('address_1')];//.'<br>'.$country_arr[$result['country_id']].'<br>'.$result['email'].'<br>'.$result['web_site']
				}
				unset($nameArrays);
			}
			else
			{
				// $send_to_company_id=$dataArray[0][csf('sent_to')];
				// echo "Hello-". $send_to_company_id; die;
				// $nameArrays = sql_select("select address_1,web_site,email,country_id from lib_supplier where id=$supp_add");
				$address = $location_library[$cbo_location];

			}

	        ?>
          	<td><strong>Address:</strong></td><td width="175px" ><? echo $address; ?></td>
            <td><strong>Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
            <td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>            
        </tr>
         <tr>
        	<td><strong>Date:</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
            <td><strong>Est. Return Date :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
            <td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
            
        </tr>
        <tr>
        	<td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
           <td><strong>Vehicle Number:</strong></td><td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>


           <td><strong>To Location :</strong></td><td><?  if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
        <!-- <tr>
         	   <td><strong>Bar Code:</strong></td><td  colspan="2" id="barcode_img_id"></td> 
               
         </tr>-->
        </tr>
             <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
             <td><strong>Security Lock No:</strong></td><td><? echo $dataArray[0][csf('security_lock_no')]; ?></td> 
             <td><strong>Remarks:</strong></td><td><? echo $dataArray[0][csf('remarks')]; ?></td> 

        <? if ($basis==12)
        {
        	?>
        	<tr>

       	 		<td> <strong> Shipping Mode </strong></td>
       	 		<td colspan="5" align="left"> <?  echo $shipment_mode[$shipmodes[0][csf("shiping_mode")]]; ?> </td>
       	 	</tr>
       		<? 
       	}	
       	?>
    </table>
    <br>
    <? if($basis==5 or $basis==1 or $basis==7 or $basis==38)
	{
		?>
	    <table align="center" cellspacing="0" width="<? echo $width;?>"  border="1" rules="all" class="rpt_table" >
	        <thead bgcolor="#dddddd" align="center">
	            <th width="30">SL</th>
	            <th width="100" align="center">Item Category</th>
	            <th width="100" align="center">Sample</th>
	            <th width="200" align="center">Item Description</th>
	            <th width="100" align="center">Item Group</th>
	            <th width="100" align="center"> Item Sub Group</th>
	            <th width="100" align="center">Brand </th>
	            <th width="50" align="center">UOM</th>
	            <th width="80" align="center">Quantity</th>
	            <? if($basis==12)
	            {
					?>
					<th width="60" align="center">No Of Carton </th>
					<?
	            }
	            else
	            {
					?>
					<th width="60" align="center">No Of Roll </th>
					<?
	            }
	            ?>
	            <th width="60" align="center">No Of Bag/Cone </th>
	            <?
	            if($show_item==1)
				{
					?>
					<th width="60" align="center">Rate</th> 
					<th width="90" align="center">Amount </th>
					<?
				}
				?>
	            <th width="150" align="center">Buyer Order </th>
	            <th align="center">Remarks</th>
	        </thead>
		<?
	

	    $i=1;
		$gate_id=$dataArray[0][csf('id')];
	     $sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags 
		from inv_gate_pass_dtls a where a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 order by a.uom,a.id ";

	   	$sql_sel=sql_select($sql_dtls);
	    foreach($sql_sel as $values)
	    {
	        $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['qty']+=$values[csf("quantity")];

	        $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['item_category_id']=$values[csf("item_category_id")];

	        $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['sample_id']=$values[csf("sample_id")];

	         $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['item_description']=$values[csf("item_description")];


	          $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['quantity']+=$values[csf("quantity")];

	           $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['amount']+=$values[csf("amount")];

	           $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['rate']+=$values[csf("rate")];

	           $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['buyer_order_id'].=$values[csf("buyer_order_id")].",";

	           $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['buyer_order'].=$values[csf("buyer_order")].",";

	           $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['remarks']=$values[csf("remarks")];
			   
	           $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['no_of_bags']=$values[csf("no_of_bags")];
	    }
	   	//echo "<pre>";print_r($general_item_arr);die;


		   $item_data=sql_select("SELECT product_name_details,item_group_id,sub_group_name,brand_name from product_details_master where  status_active=1 and is_deleted=0 and company_id=$company AND entry_form in(0,20)");
		   $item_data_arr=array();
		   foreach($item_data as $row){
			   $item_data_arr[$row[csf("product_name_details")]]['item_group_id']=$row[csf("item_group_id")];
			   $item_data_arr[$row[csf("product_name_details")]]['sub_group_name']=$row[csf("sub_group_name")];
			   $item_data_arr[$row[csf("product_name_details")]]['brand_name']=$row[csf("brand_name")];
		   }
	    $row_span_arr=array();

	    foreach($general_item_arr as $key=>$value)
	    {

	        $row_span=0;
	        foreach($value as $item_description_id=>$row)
	        {
	            $row_span++;
	        }

	        $row_span_arr[$key]=$row_span;
	    }


	    $i=1;
	    foreach($general_item_arr as $key=>$value)
	    {

	        $j=0;
	        foreach($value as $item_description_id=>$row)
	        {
				// echo $item_data_arr[$row["item_description"]]['item_group_id']."__";
				// echo $item_data_arr[$row["item_description"]]['sub_group_name']."__";
				// echo $row['item_description'];
	            ?>

	            <tr>
	        	<td width="40"   align="center"><? echo $i;$i++; ?></td>
	            <td><?  echo $item_category[$row["item_category_id"]]; ?></td>
	            <td><?  echo $sample_library_arr[$row["sample_id"]]; ?></td>
	            <td><?  echo $row['item_description']; ?></td>
				<td><?  echo $lib_item_group_lib[$item_data_arr[$row["item_description"]]['item_group_id']]; ?></td>
	            <td><?  echo $item_data_arr[$row["item_description"]]['sub_group_name']; ?></td>
	            <td><?  echo $item_data_arr[$row["item_description"]]['brand_name']; ?></td>
	            <? if($j==0)
	            {
		
		            ?>
		            <td width="40" rowspan="<? echo $row_span_arr[$key]?>" align="center"><? echo $unit_of_measurement[$key]; ?></td>
		            <?
	            }
	            ?>
	            <td align="right"><? echo number_format($row['quantity'],2,'.',''); ?></td>  
	            <td align="right">&nbsp;</td>  

	             <td align="right"><? echo $row['no_of_bags']; ?></td>
	                 <?
					if($show_item==1)
					{
						?> 
	                    <td align="right"><? $rate=$row['amount']/$row['quantity']; echo number_format($rate,2,'.',''); ?></td>
	                    <td align="right"><? echo number_format($row['amount'],2,'.',''); ?></td>
	                    <?
					}
					?>
	                <td style="word-break:break-all;"><? echo implode(",",array_unique(explode(",",chop($row['buyer_order'],",")))); ?></td>
	                <td><? echo $row['remarks']; ?></td>


	      		<?
	             
	             $j++;
	             $total+=$row[("qty")];
	             $gr_total+=$row[("qty")];
	             $tot_qty +=$row['quantity'];
	             //$tot_bags +=$row['no_of_bags'];
	        }
	        ?>
	        <tr>
	            <td colspan="8" align="right"><b>Sub Total</b></td>
	            <td align="right">  <b><? echo number_format($total,2); $total=0; ?></b></td>
	        </tr>
	        <?
	 	}
		?>

	    <tfoot bgcolor="#CCCCCC">
	        <tr>
	        <td colspan="8" align="right"> <b> Total</b></td>
	        <td align="right"><b><? echo number_format($tot_qty,2);?></b></td> 
	         <?
			if($show_item==1)
			{
			?>      
	        <td align="right"><b><? echo $tot_roll;?></b></td>    
	        <?
			}
			else
			{  
				echo "<td></td>" ;
			}
			?>

			<td align="right"><b><? echo number_format($tot_bags,2);?></b></td>
	        <td></td>
	        <td></td>
	        </tr>
		</tfoot>
	              
	           
	    <?            
		//echo $sql_dtls;
		$uom_check=array();
		$sql_result=sql_select($sql_dtls);
		$tot_qty=0; $tot_amount=0; $tot_amount=0;
		$p=0;
		
		//$tot_check=array();
		if(count($uom_check)==1)
		{
		?>
	    <?
		}
		 $width_sign=$width.'px';
		?>
	    </table>
	    <?
	}
    else 
    {
		$brand_library=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );

	    ?>
	    <table align="center" cellspacing="0" width="<? echo $width+100;?>"  border="1" rules="all" class="rpt_table" >
        <thead bgcolor="#dddddd" align="center">
            <th width="30">SL</th>
            <!--<th width="100" align="center">Item Category</th>
            <th width="100" align="center">Sample</th>-->
            <th width="150" align="center">Challan No</th>
            <th width="100" align="center">Lot</th>
            <th width="100" align="center">Brand</th>
            <th width="200" align="center">Item Description</th>
            <th width="50" align="center">UOM</th>
            <th width="80" align="center">Quantity</th>
            <?php /*?> <? if($basis==12)
            {?>
            <th width="100" align="center">No Of Cartoon </th>
	
            <?
            }
            else
            {
            ?>
            <th width="100" align="center">No Of Roll </th>
            <?
            }
            ?><?php */
            ?>
            <th width="80" align="center">No Of Bag & Cone </th>
            <?
            if($show_item==1)
			{
			?>
          	<th width="50" align="center">Rate</th> 
            <th width="80" align="center">Amount </th>
            <?
			}
			?>
            <th width="80" align="center">Buyer Order </th>
            <th align="center">Remarks</th>
        </thead>
		<?
	    $i=1;
		$gate_id=$dataArray[0][csf('id')];
		$sql_dtls="SELECT a.id, a.item_category_id, a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount, a.buyer_order_id, a.buyer_order, a.remarks, a.no_of_bags, b.challan_no, a.challan_no as trans_id 
		from  inv_gate_pass_dtls a,inv_gate_pass_mst b 
		where b.id=a.mst_id and a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 ";
		//echo $sql_dtls;

		$transIDs="";
		$uom_check=array();
		$sql_result=sql_select($sql_dtls);
		foreach($sql_result as $row)
		{
			$transIDs.=$row[csf('trans_id')].',';
		}
		$transID=chop($transIDs,",");
		if($basis==11)
		{
			$sql_trans=sql_select("select a.id,a.sys_number as issue_number from pro_grey_prod_delivery_mst a,pro_grey_prod_delivery_dtls b where a.id in ($transID) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form=54 and b.entry_form=54");

			$challan_issue_arr=array();
			foreach($sql_trans as $row)
			{
				$challan_issue_arr[$row[csf('id')]]['issue_number']=$row[csf('issue_number')];
				//$challan_issue_arr[$row[csf('id')]]['cone_per_bag']=$row[csf('cone_per_bag')];
			}
		}
		else
		{
			$sql_trans=sql_select("SELECT b.id,a.issue_number,b.cone_per_bag 
			from inv_issue_master a,inv_transaction b 
			where b.id in ($transID) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0");
			$challan_issue_arr=array();
			foreach($sql_trans as $row)
			{
				$challan_issue_arr[$row[csf('id')]]['issue_number']=$row[csf('issue_number')];
				$challan_issue_arr[$row[csf('id')]]['cone_per_bag']=$row[csf('cone_per_bag')];
			}
		}
		
		$chlnNo=$dataArray[0][csf('challan_no')];
		
		$sql_issue = "SELECT b.id,c.lot,a.issue_number,c.brand  
		from inv_issue_master a, inv_transaction b, product_details_master c 
		where b.id in($transID) and a.id=b.mst_id and b.prod_id=c.id and b.transaction_type=2 and b.item_category=1 and a.entry_form=3 and b.status_active=1 and b.is_deleted=0";
		$sql_issue_qry=sql_select($sql_issue);
		foreach($sql_issue_qry as $row)
		{
			$issue_chln_data_arr[$row[csf('id')]]['lot']=$row[csf('lot')];
			$issue_chln_data_arr[$row[csf('id')]]['brand']=$row[csf('brand')];
		}
		
		$tot_qty=0; $tot_amount=0; $tot_amount=0; $noOfCarton=0;
		$tot_roll=0;
		$p=0;
		foreach($sql_result as $row)
		{
			if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";			
			$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
			$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
			//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
			$uom_check[$row[csf('uom')]]=$row[csf('uom')];
			?>
			<tr bgcolor="<? echo $bgcolor; ?>">
                <td><? echo $i; ?></td>
                <?php /*?><td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
                <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td><?php */?>
                <td title="<? echo $row[csf('trans_id')]; ?>"><?  //echo $row[csf('challan_no')]; 
                 echo $challan_issue_arr[$row[csf('trans_id')]]['issue_number']; ?></td>
                <td><?  echo $issue_chln_data_arr[$row[csf('trans_id')]]['lot']; ?></td>
                <td><?  echo $brand_library[$issue_chln_data_arr[$row[csf('trans_id')]]['brand']]; ?></td>
                <td><?  echo $row[csf('item_description')]; ?></td>
                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
                <td align="right"><? echo number_format($row[csf('quantity')],2,'.',''); ?></td>   
               	<?php /*?> <?  if($basis==12)
	                {
	                	?>
	                	<td align="right"><? echo $shipmode_cartoon[$p][csf("total_carton_qnty")]; ?></td>
	                	<?
	                }
	                else
	                {
		                ?>
		                <td align="right"><? if($basis==3){echo $no_of_rolls[$p][csf("no_roll")] =1; } else{echo $no_of_rolls[$p][csf("no_roll")] ;} ?></td>  
		                <?
	                }
                ?><?php */?>
                <td align="right">
				<? 
				echo $row[csf('no_of_bags')];if($challan_issue_arr[$row[csf('trans_id')]]['cone_per_bag']!=""){ echo " & ";} echo $challan_issue_arr[$row[csf('trans_id')]]['cone_per_bag']; 
				?>	                
                </td>
                <?
				if($show_item==1)
				{
				?>
                <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
                <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
                <?
				}
				?>
                <td><? echo $row[csf('buyer_order')]; ?></td>
                <td><? echo $row[csf('remarks')]; ?></td>
			</tr>
			<?php
			$tot_roll +=$no_of_rolls[$p][csf("no_roll")];
			$noOfCarton+=$shipmode_cartoon[$p][csf("total_carton_qnty")];
	    	$i++;
	    	$p++;
			
			$tot_qty+=$row[csf('quantity')];		
			$tot_amount+=$row[csf('amount')];
			$tot_bags+=$row[csf('no_of_bags')];
			$tot_cons+=$challan_issue_arr[$row[csf('trans_id')]]['cone_per_bag'];
	    }
		//$tot_check=array();
		if(count($uom_check)==1)
		{
			?>
		    <tfoot bgcolor="#CCCCCC">
		        <tr>
		        <td colspan="6" align="right"> <b> Total</b></td>
		        <td align="right"><b><? echo number_format($tot_qty,2);?></b></td>
		         <?
				if($show_item==1)
				{
					if($basis==12)
					{
					?>
						<td align="right"><b><? echo $noOfCarton;?></b></td> 
		            <?   
					}
					else
					{
					?>
						 <td align="right"><b><? echo $tot_roll;?></b></td> 
		            <?
					} 
				?>         
		        <?
				}
				else
				{
					if($basis==12)
					{
					?>
						<td align="right"><b><? echo $noOfCarton;?></b></td> 
		        	<?
					}
					else
					{
						//echo "<td></td>" ;
					}
				}
				?>
				<td align="right"><b><? echo $tot_bags; if($tot_cons!="" || $tot_cons==0){ echo " & ";} echo $tot_cons;?></b></td>
		       <!-- <td></td>
		        <td></td>-->
		        <td align="right"> </td>
		        <td colspan="<? echo 4+$colspan2;?>"></td>
		        </tr>
			</tfoot>
		    <?
		}
		$width_sign=$width.'px';
		?>
	    </table>
	    <? 
	}
    ?>


	</div>
	<div>
		<? echo signature_table(114, $data[0], $width_sign,$template_id); ?>
	</div> 
	<script type="text/javascript" src="../../js/jquery.js"></script>
		<!--<script type="text/javascript" src="../../js/jquerybarcode.js"></script>-->
	<script type="text/javascript" src="../../js/jquery.qrcode.min.js"></script>
	<script>
	var main_value='<? echo $data[1]; ?>';
	//alert(main_value);
		$('#qrcode').qrcode(main_value);
	// $('#qrcode').qrcode({width: 420,height: 420, text: main_value});
	//https://larsjung.de/jquery-qrcode/
	
	</script>
	<script>
	/*function generateBarcode( valuess ){
		
			var value = valuess;//$("#barcodeValue").val();
		// alert(value)
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='bmp';// $("input[name=renderer]:checked").val();
			
			var settings = {
			output:renderer,
			bgColor: '#FFFFFF',
			color: '#000000',
			barWidth: 1,
			barHeight: 30,
			moduleSize:5,
			posX: 10,
			posY: 20,
			addQuietZone: 1
			};
			$("#barcode_img_id").html('11');
			value = {code:value, rect: false};
			
			$("#barcode_img_id").show().barcode(value, btype, settings);
		} */
	<?php /*?> generateBarcode('<? echo $data[1]; ?>');<?php */?>
	</script>
	<?
	exit();
}

if($action=="get_out_entry_print22")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//print_r ($data);
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[2];
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");


	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
	
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to,vhicle_number, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,com_location_id,do_no,mobile_no, remarks from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 "; 
	//echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
 	$sent_to=$dataArray[0][csf('sent_to')];
	$shipmode_cartoon=sql_select("select  b.total_carton_qnty,b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no'") ;

	$shipmodes=sql_select("select  b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no' and (b.shiping_mode is not null or b.shiping_mode!=0) ") ;
	/*echo "<pre>";
	print_r($shipmode_cartoon);die;*/
 
	if($basis==1)
	{ 
		if($within_group==1)
		{
			//$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
		else
		{
			//$send_to_company=$dataArray[0][csf('sent_to')];		
		}
	}
	else if($basis==8 || $basis==9 || $basis==27)
	{
		//$send_to_company=$dataArray[0][csf('sent_to')];	
		$no_of_rolls = sql_select("select a.id,b.carton_roll as no_roll from subcon_delivery_mst a ,subcon_delivery_dtls b where a.id=b.mst_id  and a.delivery_no='$challan_no' and a.status_active=1 and a.is_deleted=0  and a.process_id in(2,4,3) ");
	}

	else if($basis==17)
	{
		$no_of_rolls=sql_select("select b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty as cons_quantity,
		b.yarn_lot,b.rate as cons_rate,b.transfer_value as cons_amount,b.brand_id,c.product_name_details,d.no_of_bags,b.roll as no_roll from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c,inv_transaction d 
		where a.id=b.mst_id and c.id=b.from_prod_id and b.from_prod_id=d.prod_id and a.transfer_system_id='$challan_no' and b.item_category=13 
		and b.status_active = '1' and b.is_deleted = '0' and d.no_of_bags is not NULL
		group by  b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty,
		b.yarn_lot,b.rate,b.transfer_value ,b.brand_id,c.product_name_details,d.no_of_bags ,b.roll ");
	}
	else if($basis==11)
	{
		$no_of_rolls=sql_select("select a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity,b.batch_id,roll as no_roll
		from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
		where a.sys_number='$challan_no' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form=54 and b.entry_form=54");
	}
	else if($basis==12)
	{
		//$send_to_company=$supplier_name_library[$dataArray[0][csf('sent_to')]];
	}
	else if($basis==10)
	{
		$no_of_rolls=sql_select("select a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity,b.roll as no_roll
		from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
		where a.sys_number='$challan_no' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.entry_form=53 and b.entry_form=53");
	}

	else if($basis==15) //Finish Fabric Recv Return
	{
		//echo $mst_challan;		
		$no_of_rolls =sql_select("select a.id as issue_id, a.item_category, a.received_id, a.received_mrr_no, b.id as trans_id, b.cons_quantity as cons_quantity,b.cons_uom, b.cons_rate, b.cons_amount, c.product_name_details, c.id as prod_id  ,b.no_of_roll as no_roll 
		from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id
		where a.id=b.mst_id and b.item_category=2 and b.transaction_type=3 and  a.issue_number='$challan_no' order by b.id");		   
	}

	else if($basis==4)
	{
		$no_of_rolls = sql_select("select a.id,a.transaction_type,a.item_category,b.product_name_details,a.cons_rate,a.cons_quantity,a.cons_uom ,a.cons_amount,a.remarks,b.unit_of_measure ,c.no_of_roll as no_roll 
		from inv_transaction a, product_details_master b,inv_finish_fabric_issue_dtls c ,inv_issue_master d,inv_gate_pass_mst e  
		where a.prod_id=b.id and d.id=a.mst_id  and d.id=c.mst_id and a.id=c.trans_id and d.id=e.issue_id and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.issue_number='$challan_no'"); 
 	}

 	else if($basis==22)
	{
		$no_of_rolls = sql_select("select b.roll_no as no_roll from inv_receive_mas_batchroll a,pro_grey_batch_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.recv_number='$challan_no'"); 
 	}
 	else if($basis==23)
	{
		$challan_no_arr  = return_library_array( "select issue_number, challan_no from inv_issue_master", "issue_number", "challan_no");
 	}
	else
	{

		$challan_no_arr  = return_library_array( "select transfer_system_id, challan_no from inv_item_transfer_mst", "transfer_system_id", "challan_no");
		//echo $within_group.'=='.$basis;
		/*if($basis==2 || $basis==3 || $basis==4 || $basis==5 || $basis==6 || $basis==7  ||  $basis==10 || $basis==13 ||  $basis==14 ||  $basis==11 ||  $basis==15)
		{
			if($within_group==2)
			{
				$send_to_company=$dataArray[0][csf('sent_to')];
			}
			else
			{
				$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
			}
		}
		else
		{
				$send_to_company=$dataArray[0][csf('sent_to')];	
		}*/
		//$send_to_company=$dataArray[0][csf('sent_to')];
	}
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	if($show_item==1)
	{
		$width=1150;
		//$colspan=5;
	}
	else
	{
		$width=1150;
		//$colspan=5;
		$colspan2=2;
	}
	$com_dtls = fnc_company_location_address($company, $location, 2);
	?>
	<div style="width:<? echo $width;?>px;" align="center">
    <table width="<? echo $width;?>" cellspacing="0" align="center" border="0">
        <tr>
            <td rowspan="2" align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="70" width="200"></td>
            <td colspan="4" align="center"  style="font-size:xx-large;"><strong style="margin-left:100px" ><? echo $com_dtls[0]; ?></strong>
			</td>
			<td>
			<div style="float:left;width:34%;font-size:xx-large; text-align:right">
                <div style="float:left; height:5%; width:5%;font-size:xx-large;" id="qrcode"></div> 
               	&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
            </div>
			</td>
        </tr>
        <tr class="form_caption">
            <td colspan="4" align="center" style="font-size:xx-large;>
			   <strong ><?
				echo $com_dtls[1];
				/*$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
					//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
					foreach ($nameArray as $result)
					{ 
						echo $result[csf('plot_no')]; 
						echo $result[csf('level_no')];
						echo $result[csf('road_no')];
						echo $result[csf('block_no')];
						echo $result[csf('city')];
						echo $result[csf('zip_code')];
						echo $result[csf('province')].',';
						echo $country_arr[$result[csf('country_id')]].'<br>'; 
						echo $result[csf('email')]; 
						echo $result[csf('website')];
					}*/
                ?> 
                <div style="width:34%; text-align:center">
               	&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
            	</div></strong>
            </td>
        </tr>
        <tr>
        	<td style="display:none" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
        </tr>
        <tr>
            <td colspan="8" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
        </tr>
        <tr>
            <td width="160"><strong>Gate Pass ID:</td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></strong></td>
            <td width="120"><strong>Basis:</td></strong><td width="175px" ><strong><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></strong></td>
           <?php /*?> <td width="125"><strong>Challan/System No:</strong></td><td width="175px" colspan="2"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td><?php */?>
            <td width="125"><strong>D.O No:</strong></td><td width="175px" colspan="2"><? echo $dataArray[0][csf('do_no')];//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
        </tr>
         <tr>
            
            <td><strong>Department:</strong></td><td width="175px"> <strong><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></strong></td>
            <td><strong>Section:</strong></td><td width="175px" ><strong><? echo $section_library[$dataArray[0][csf('section')]]; ?></strong></td>
            <td><strong>Sent By:</strong></td> <td width="175px"><strong><? echo $dataArray[0][csf('sent_by')]; ?></strong></td>
        </tr>
        <tr>
		   <td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><strong><b><? echo $send_to_company; ?></b></strong></td>
            <td><strong>Attention:</strong></td><td width="175px" ><strong><? echo $dataArray[0][csf('attention')]; ?></strong></td>
            <td><strong>Mobile No:</strong></td><td width="175px" colspan="2"><strong><? echo $dataArray[0][csf('mobile_no')]; ?></strong></td>
        </tr>
        <tr>
          	<?
			$send_to_company_id=$dataArray[0][csf('sent_to')];
            $supp_add = $send_to_company_id;

			if($within_group==2)
			{
				$nameArrays = sql_select("select address_1,web_site,email,country_id from lib_supplier where supplier_name='$supp_add'");
            }
			else
			{
				$location=$dataArray[0][csf('location_id')];
				$nameArrays = sql_select("select address as address_1 from lib_location where id=$location and company_id=$supp_add");
            }
			//echo "select address as address_1 from lib_location where id=$location and company_id=$supp_add";
			
			foreach ($nameArrays as $result) {
				$address = "";
				if ($result != "") $address = $result[csf('address_1')];//.'<br>'.$country_arr[$result['country_id']].'<br>'.$result['email'].'<br>'.$result['web_site']
			}
			unset($nameArrays);
	        ?>
			 <td><strong>To Location :</strong></td><td width="175px"><strong><?  if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></strong></td>
            <td><strong>Time:</strong></td><td width="85px" ><strong><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></strong></td>
            <td><strong>Returnable :</strong></td><td width="175px"><strong><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></strong></td>            
        </tr>
         <tr>
        
		   <td><strong>Address:</strong></td><td width="175px" ><strong><? echo $address; ?></strong></td>
           <td><strong>Est. Return Date :</strong></td><td width="175px"><strong><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></strong></td>
            <td><strong>Carried By:</strong></td><td><strong><? echo $dataArray[0][csf('carried_by')]; ?></strong></td>
            
        </tr>
        <tr>
        	<td><strong>Delivery As:</strong></td><td width="175px"><strong><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></strong></td>
           <td><strong>Vehicle Number:</strong></td><td><strong><? echo $dataArray[0][csf('vhicle_number')]; ?></strong></td>


		   <td><strong>Date:</strong></td><td ><strong><? echo change_date_format($dataArray[0][csf('out_date')]); ?></strong></td>
        <!-- <tr>
         	   <td><strong>Bar Code:</strong></td><td  colspan="2" id="barcode_img_id"></td> 
               
         </tr>-->
        </tr>
             <td><strong>Purpose:</strong></td><td><strong><? echo $dataArray[0][csf('issue_purpose')]; ?></strong></td> 

			<? if ($basis==12)
			{
				?>
				<tr>

					<td> <strong> Shipping Mode </strong></td>
					<td colspan="5" align="left"><strong> <?  echo $shipment_mode[$shipmodes[0][csf("shiping_mode")]]; ?></strong> </td>
				</tr>
				<? 
			}	
			?>
		   <td><strong>Remark:</strong></td><td ><strong><? echo $dataArray[0][csf('remarks')]; ?></strong></td>
           <td><strong>Bar Code:</strong></td><td ><div  style=" margin-left:-7px; " id="brcode">
    </table>
    <br>
    <? if($basis==5 or $basis==1 or $basis==7 or $basis==38)
	{
		?>
	    <table align="center" cellspacing="0" width="<? echo $width;?>"  border="1" rules="all" class="rpt_table" >
	        <thead bgcolor="#dddddd" align="center">
	            <th width="30">SL</th>
	            <th width="100" align="center">Item Category</th>
	            <th width="100" align="center">Sample</th>
	            <th width="200" align="center">Item Description</th>
	            <th width="50" align="center">UOM</th>
	            <th width="80" align="center">Quantity</th>
	            <? if($basis==12)
	            {
					?>
					<th width="60" align="center">No Of Carton </th>
					<?
	            }
	            else
	            {
					?>
					<th width="60" align="center">No Of Roll </th>
					<?
	            }
	            ?>
	            <th width="60" align="center">No Of Bag/Cone </th>
	            <?
	            if($show_item==1)
				{
					?>
					<th width="60" align="center">Rate</th> 
					<th width="90" align="center">Amount </th>
					<?
				}
				?>
	            <th width="150" align="center">Buyer Order </th>
	            <th align="center">Remarks</th>
	        </thead>
		<?
	    $i=1;
		$gate_id=$dataArray[0][csf('id')];
		$sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags 
		from inv_gate_pass_dtls a where a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 order by a.uom,a.id ";

	   	$sql_sel=sql_select($sql_dtls);
	    foreach($sql_sel as $values)
	    {
	        $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['qty']+=$values[csf("quantity")];

	        $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['item_category_id']=$values[csf("item_category_id")];

	        $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['sample_id']=$values[csf("sample_id")];

	         $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['item_description']=$values[csf("item_description")];


	          $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['quantity']+=$values[csf("quantity")];

	           $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['amount']+=$values[csf("amount")];

	           $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['rate']+=$values[csf("rate")];

	           $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['buyer_order_id'].=$values[csf("buyer_order_id")].",";

	           $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['buyer_order'].=$values[csf("buyer_order")].",";

	           $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['remarks']=$values[csf("remarks")];
			   
	            $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['no_of_bags']=$values[csf("no_of_bags")];
	    }
	   	//echo "<pre>";print_r($general_item_arr);die;
	    $row_span_arr=array();

	    foreach($general_item_arr as $key=>$value)
	    {

	        $row_span=0;
	        foreach($value as $item_description_id=>$row)
	        {
	            $row_span++;
	        }

	        $row_span_arr[$key]=$row_span;
	    }


	    $i=1;
	    foreach($general_item_arr as $key=>$value)
	    {

	        $j=0;
	        foreach($value as $item_description_id=>$row)
	        {
	            ?>

	            <tr>
	        	<td width="40"   align="center"><strong><? echo $i;$i++; ?></strong></td>
	            <td ><strong><?  echo $item_category[$row["item_category_id"]]; ?></strong></td>
	            <td><strong><?  echo $sample_library_arr[$row["sample_id"]]; ?></strong></td>
	            <td><strong><?  echo $row['item_description']; ?></strong></td>
	            <? if($j==0)
	            {
		
		            ?>
		            <td width="40" rowspan="<? echo $row_span_arr[$key]?>" align="center"><strong><? echo $unit_of_measurement[$key]; ?></strong></td>
		            <?
	            }
	            ?>
	            <td align="right"><strong><? echo number_format($row['quantity'],2,'.',''); ?></strong></td>  
	            <td align="right">&nbsp;</td>  

	             <td align="right"><strong><? echo $row['no_of_bags']; ?></strong></td>
	                 <?
					if($show_item==1)
					{
						?> 
	                    <td align="right"><strong><? $rate=$row['amount']/$row['quantity']; echo number_format($rate,2,'.',''); ?></strong></td>
	                    <td align="right"><strong><? echo number_format($row['amount'],2,'.',''); ?></strong></td>
	                    <?
					}
					?>
	                <td style="word-break:break-all;"><strong><? echo implode(",",array_unique(explode(",",chop($row['buyer_order'],",")))); ?></strong></td>
	                <td><strong><? echo $row['remarks']; ?></strong></td>


	      		<?
	             
	             $j++;
	             $total+=$row[("qty")];
	             $gr_total+=$row[("qty")];
	             $tot_qty +=$row['quantity'];
	             //$tot_bags +=$row['no_of_bags'];
	        }
	        ?>
	        <tr>
	            <td colspan="5" align="right"><b>Sub Total</b></td>
	            <td align="right">  <b><? echo number_format($total,2); $total=0; ?></b></td>
	        </tr>
	        <?
	 	}
		?>

	    <tfoot bgcolor="#CCCCCC">
	        <tr>
	        <td colspan="5" align="right"> <b> Total</b></td>
	        <td align="right"><b><? echo number_format($tot_qty,2);?></b></td> 
	         <?
			if($show_item==1)
			{
			?>      
	        <td align="right"><b><? echo $tot_roll;?></b></td>    
	        <?
			}
			else
			{  
				echo "<td></td>" ;
			}
			?>

			<td align="right"><b><? echo number_format($tot_bags,2);?></b></td>
	        <td></td>
	        <td></td>
	        <td align="right"> </td>
	        <td colspan="<? echo 4+$colspan2;?>"></td>
	        </tr>
		</tfoot>
	              
	           
	    <?            
		//echo $sql_dtls;
		$uom_check=array();
		$sql_result=sql_select($sql_dtls);
		$tot_qty=0; $tot_amount=0; $tot_amount=0;
		$p=0;
		
		//$tot_check=array();
		if(count($uom_check)==1)
		{
		?>
	    <?
		}
		 $width_sign=$width.'px';
		?>
	    </table>
	    <?
	}
    else 
    {
		$brand_library=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );

	    ?>
	    <table align="center" cellspacing="0" width="<? echo $width+100;?>"  border="1" rules="all" class="rpt_table" >
        <thead bgcolor="#dddddd" align="center">
            <th width="30">SL</th>
            <!--<th width="100" align="center">Item Category</th>
            <th width="100" align="center">Sample</th>-->
            <th width="150" align="center">System ID</th>
            <th width="100" align="center">Lot</th>
            <th width="100" align="center">Brand</th>
            <th width="200" align="center">Item Description</th>
            <th width="50" align="center">UOM</th>
            <th width="80" align="center">Quantity</th>
            <?php /*?> <? if($basis==12)
            {?>
            <th width="100" align="center">No Of Cartoon </th>
	
            <?
            }
            else
            {
            ?>
            <th width="100" align="center">No Of Roll </th>
            <?
            }
            ?><?php */
            ?>
            <th width="80" align="center">No Of Bag & Cone </th>
            <?
            if($show_item==1)
			{
			?>
          	<th width="50" align="center">Rate</th> 
            <th width="80" align="center">Amount </th>
            <?
			}
			?>
            <th width="80" align="center">Buyer Order </th>
            <th width="80" align="center">Challan No </th>
            <th align="center">Remarks</th>
        </thead>
		<?
	    $i=1;
		if($basis==11){ $trans_sql=" a.challan_no as trans_id";}
		else{ $trans_sql=" a.challan_details_id as trans_id";}

		$gate_id=$dataArray[0][csf('id')];
		$sql_dtls="SELECT a.id, a.item_category_id, a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount, a.buyer_order_id, a.buyer_order, a.remarks, a.no_of_bags, b.challan_no, $trans_sql
		from  inv_gate_pass_dtls a, inv_gate_pass_mst b 
		where b.id=a.mst_id and a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 ";
		//echo $sql_dtls;

		$transIDs="";
		$uom_check=array();
		$sql_result=sql_select($sql_dtls);
		foreach($sql_result as $row)
		{
			$transIDs.=$row[csf('trans_id')].',';
		}
		$transID=chop($transIDs,",");
		if($basis==11)
		{
			$sql_trans=sql_select("select a.id,a.sys_number as issue_number from pro_grey_prod_delivery_mst a,pro_grey_prod_delivery_dtls b where a.id in ($transID) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form=54 and b.entry_form=54");

			$challan_issue_arr=array();
			foreach($sql_trans as $row)
			{
				$challan_issue_arr[$row[csf('id')]]['issue_number']=$row[csf('issue_number')];
				//$challan_issue_arr[$row[csf('id')]]['cone_per_bag']=$row[csf('cone_per_bag')];
			}
		}
		else
		{
			$sql_trans=sql_select("SELECT b.id,a.issue_number,b.cone_per_bag 
			from inv_issue_master a,inv_transaction b 
			where b.id in ($transID) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0");
			$challan_issue_arr=array();
			foreach($sql_trans as $row)
			{
				$challan_issue_arr[$row[csf('id')]]['issue_number']=$row[csf('issue_number')];
				$challan_issue_arr[$row[csf('id')]]['cone_per_bag']=$row[csf('cone_per_bag')];
			}
		}
		
		$chlnNo=$dataArray[0][csf('challan_no')];
		
		$sql_issue = "SELECT b.id,c.lot,a.issue_number,c.brand  
		from inv_issue_master a, inv_transaction b, product_details_master c 
		where b.id in($transID) and a.id=b.mst_id and b.prod_id=c.id and b.transaction_type=2 and b.item_category=1 and a.entry_form=3 and b.status_active=1 and b.is_deleted=0";
		$sql_issue_qry=sql_select($sql_issue);
		foreach($sql_issue_qry as $row)
		{
			$issue_chln_data_arr[$row[csf('id')]]['lot']=$row[csf('lot')];
			$issue_chln_data_arr[$row[csf('id')]]['brand']=$row[csf('brand')];
		}
		
		$tot_qty=0; $tot_amount=0; $tot_amount=0; $noOfCarton=0;
		$tot_roll=0;
		$p=0;
		foreach($sql_result as $row)
		{
			if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";			
			$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
			$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
			//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
			$uom_check[$row[csf('uom')]]=$row[csf('uom')];
			?>
			<tr bgcolor="<? echo $bgcolor; ?>">
                <td><? echo $i; ?></td>
                <?php /*?><td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
                <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td><?php */?>
                <td title="<? echo $row[csf('trans_id')]; ?>"> <strong> <?  echo $row[csf('challan_no')]; 
                 //echo $challan_issue_arr[$row[csf('trans_id')]]['issue_number']; ?></strong></td>
                <td><strong><?  echo $issue_chln_data_arr[$row[csf('trans_id')]]['lot']; ?></strong></td>
                <td><strong><?  echo $brand_library[$issue_chln_data_arr[$row[csf('trans_id')]]['brand']]; ?></strong></td>
                <td><strong><?  echo $row[csf('item_description')]; ?></strong></td>
                <td align="center"><strong><? echo $unit_of_measurement[$row[csf('uom')]]; ?></strong></td>
                <td align="right"><strong><? echo number_format($row[csf('quantity')],2,'.',''); ?></strong></td>   
               	<?php /*?> <?  if($basis==12)
	                {
	                	?>
	                	<td align="right"><? echo $shipmode_cartoon[$p][csf("total_carton_qnty")]; ?></td>
	                	<?
	                }
	                else
	                {
		                ?>
		                <td align="right"><? if($basis==3){echo $no_of_rolls[$p][csf("no_roll")] =1; } else{echo $no_of_rolls[$p][csf("no_roll")] ;} ?></td>  
		                <?
	                }
                ?><?php */?>
                <td align="right"><strong>
				<? 
				echo $row[csf('no_of_bags')];if($challan_issue_arr[$row[csf('trans_id')]]['cone_per_bag']!=""){ echo " & ";} echo $challan_issue_arr[$row[csf('trans_id')]]['cone_per_bag']; 
				?></strong>	                
                </td>
                <?
				if($show_item==1)
				{
				?>
                <td align="right"><strong><? echo number_format($row[csf('rate')],2,'.',''); ?></strong></td>
                <td align="right"><strong><? echo number_format($row[csf('amount')],2,'.',''); ?></strong></td>
                <?
				}
				?>
                <td><strong><? echo $row[csf('buyer_order')]; ?></strong></td>
                <td><strong><? echo $challan_no_arr[$row[csf('challan_no')]]; ?></strong></td>
                <td><strong><? echo $row[csf('remarks')]; ?></strong></td>
			</tr>
			<?php
			$tot_roll +=$no_of_rolls[$p][csf("no_roll")];
			$noOfCarton+=$shipmode_cartoon[$p][csf("total_carton_qnty")];
	    	$i++;
	    	$p++;
			
			$tot_qty+=$row[csf('quantity')];		
			$tot_amount+=$row[csf('amount')];
			//$tot_bags+=$row[csf('no_of_bags')];
			$tot_cons+=$challan_issue_arr[$row[csf('trans_id')]]['cone_per_bag'];
	    }
		//$tot_check=array();
		if(count($uom_check)==1)
		{
			?>
		    <tfoot bgcolor="#CCCCCC">
		        <tr>
		        <td colspan="6" align="right"> <b> Total</b></td>
		        <td align="right"><b><? echo number_format($tot_qty,2);?></b></td>
		         <?
				if($show_item==1)
				{
					if($basis==12)
					{
					?>
						<td align="right"><b><? echo $noOfCarton;?></b></td> 
		            <?   
					}
					else
					{
					?>
						 <td align="right"><b><? echo $tot_roll;?></b></td> 
		            <?
					} 
				?>         
		        <?
				}
				else
				{
					if($basis==12)
					{
					?>
						<td align="right"><b><? echo $noOfCarton;?></b></td> 
		        	<?
					}
					else
					{
						//echo "<td></td>" ;
					}
				}
				?>
				<td align="right"><b><? echo $tot_bags; if($tot_cons!="" || $tot_cons==0){ echo " & ";} echo $tot_cons;?></b></td>
		       <!-- <td></td>
		        <td></td>-->
		        <td align="right"> </td>
		        <td colspan="<? echo 4+$colspan2;?>"></td>
		        </tr>
			</tfoot>
		    <?
		}
		$width_sign=$width.'px';
		?>
	    </table>
	    <? 
	}
    ?>


	</div>
	<div>
		<? echo signature_table(114, $data[0], $width_sign,$template_id); ?>
	</div> 
	<script type="text/javascript" src="../../js/jquery.js"></script>
		<!--<script type="text/javascript" src="../../js/jquerybarcode.js"></script>-->
	<script type="text/javascript" src="../../js/jquery.qrcode.min.js"></script>
	<script>
	// var main_value='<? //echo $data[1]; ?>';
	// //alert(main_value);
	// 	$('#qrcode').qrcode(main_value);
	// // $('#qrcode').qrcode({width: 420,height: 420, text: main_value});
	// //https://larsjung.de/jquery-qrcode/
	
	</script>

        <script type="text/javascript" src="../../js/jquery.js"></script>
		<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
		<script>

		function generateBarcode( valuess ){
			
				var value = valuess;//$("#barcodeValue").val();
			     // alert(value)
				var btype = 'code39';//$("input[name=btype]:checked").val();
				var renderer ='bmp';// $("input[name=renderer]:checked").val();
				
				var settings = {
				output:renderer,
				bgColor: '#FFFFFF',
				color: '#000000',
				barWidth: 1,
				barHeight: 30,
				moduleSize:5,
				posX: 10,
				posY: 20,
				addQuietZone: 1
				};
				$("#brcode").html('11');
				value = {code:value, rect: false};
				
				$("#brcode").show().barcode(value, btype, settings);
			} 
		generateBarcode('<? echo $data[1]; ?>');
		</script>
	<script>
	/*function generateBarcode( valuess ){
		
			var value = valuess;//$("#barcodeValue").val();
		// alert(value)
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='bmp';// $("input[name=renderer]:checked").val();
			
			var settings = {
			output:renderer,
			bgColor: '#FFFFFF',
			color: '#000000',
			barWidth: 1,
			barHeight: 30,
			moduleSize:5,
			posX: 10,
			posY: 20,
			addQuietZone: 1
			};
			$("#barcode_img_id").html('11');
			value = {code:value, rect: false};
			
			$("#barcode_img_id").show().barcode(value, btype, settings);
		} */
	<?php /*?> generateBarcode('<? echo $data[1]; ?>');<?php */?>
	</script>
	<?
	exit();
}

if($action=="print_to_html_report6")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//print_r ($data);
	$show_item=$data[2];
	$company=$data[0];
	$location=$data[4];
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");
	$color_library=return_library_array( "select id, color_name from lib_color",'id','color_name');
	$size_library=return_library_array( "select id, size_name from lib_size",'id','size_name');

	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );

	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to,vhicle_number, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,com_location_id,do_no,mobile_no from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 "; 
	//echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
 	$sent_to=$dataArray[0][csf('sent_to')];
	$shipmode_cartoon=sql_select("select  b.total_carton_qnty,b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no'") ;

	$shipmodes=sql_select("select  b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no' and (b.shiping_mode is not null or b.shiping_mode!=0) ") ;
	/*echo "<pre>";
	print_r($shipmode_cartoon);die;*/

 
	if($basis==1)
	{ 
		if($within_group==1)
		{
			//$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
		else
		{
			//$send_to_company=$dataArray[0][csf('sent_to')];		
		}
	}
	else if($basis==8 || $basis==9 || $basis==27)
	{
		//$send_to_company=$dataArray[0][csf('sent_to')];	
		$no_of_rolls = sql_select("select a.id,b.carton_roll as no_roll from subcon_delivery_mst a ,subcon_delivery_dtls b where a.id=b.mst_id  and a.delivery_no='$challan_no' and a.status_active=1 and a.is_deleted=0  and a.process_id in(2,4,3) ");
	}

	else if($basis==17)
	{
	$no_of_rolls=sql_select("select b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty as cons_quantity,
	b.yarn_lot,b.rate as cons_rate,b.transfer_value as cons_amount,b.brand_id,c.product_name_details,d.no_of_bags,b.roll as no_roll from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c,inv_transaction d 
	where a.id=b.mst_id and c.id=b.from_prod_id and b.from_prod_id=d.prod_id and a.transfer_system_id='$challan_no' and b.item_category=13 
	and b.status_active = '1' and b.is_deleted = '0' and d.no_of_bags is not NULL
	group by  b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty,
	b.yarn_lot,b.rate,b.transfer_value ,b.brand_id,c.product_name_details,d.no_of_bags ,b.roll ");
	}
	else if($basis==11)
	{
	$no_of_rolls=sql_select("select a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity,b.batch_id,roll as no_roll
				from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
				where a.sys_number='$challan_no' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form=54 and b.entry_form=54");
	}
	else if($basis==12)
	{
		//$send_to_company=$supplier_name_library[$dataArray[0][csf('sent_to')]];
	}
	else if($basis==10)
	{
	$no_of_rolls=sql_select("select a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity,b.roll as no_roll
				from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
				where a.sys_number='$challan_no' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.entry_form=53 and b.entry_form=53");
	}

	else if($basis==15) //Finish Fabric Recv Return
	{
		//echo $mst_challan;
		
		 $no_of_rolls =sql_select("select a.id as issue_id, a.item_category, a.received_id, a.received_mrr_no, b.id as trans_id, b.cons_quantity as cons_quantity,b.cons_uom, b.cons_rate, b.cons_amount, c.product_name_details, c.id as prod_id  ,b.no_of_roll as no_roll 
			from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id
			where a.id=b.mst_id and b.item_category=2 and b.transaction_type=3 and  a.issue_number='$challan_no' order by b.id");
		   
	}

	else if($basis==4)
	{
	$no_of_rolls = sql_select("select a.id,a.transaction_type,a.item_category,b.product_name_details,a.cons_rate,a.cons_quantity,a.cons_uom ,a.cons_amount,a.remarks,b.unit_of_measure ,c.no_of_roll as no_roll from inv_transaction a, product_details_master b,inv_finish_fabric_issue_dtls c ,inv_issue_master d,inv_gate_pass_mst e  where a.prod_id=b.id and d.id=a.mst_id  and d.id=c.mst_id and a.id=c.trans_id and d.id=e.issue_id and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.issue_number='$challan_no'"); 
 	}

 	else if($basis==22)
	{
	$no_of_rolls = sql_select("select b.roll_no as no_roll from inv_receive_mas_batchroll a,pro_grey_batch_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.recv_number='$challan_no'"); 

 	}

 	


	else
	{
			
			//echo $within_group.'=='.$basis;
			/*if($basis==2 || $basis==3 || $basis==4 || $basis==5 || $basis==6 || $basis==7  ||  $basis==10 || $basis==13 ||  $basis==14 ||  $basis==11 ||  $basis==15)
			{
				if($within_group==2)
				{
					$send_to_company=$dataArray[0][csf('sent_to')];
				}
				else
				{
					$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
				}
			}
			else
			{
					$send_to_company=$dataArray[0][csf('sent_to')];	
			}*/
		
		
		
		//$send_to_company=$dataArray[0][csf('sent_to')];
	}
	if($within_group==2)
		{
			$send_to_company=$dataArray[0][csf('sent_to')];
		}
		else
		{
			$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	if($show_item==1)
	{
		$width=1150;
		//$colspan=5;
	}
	else
	{
		$width=1150;
		//$colspan=5;
		$colspan2=2;
	}
	$com_dtls = fnc_company_location_address($company, $location, 2);
	?>
	<div style="width:<? echo $width;?>px;" align="center">
    <table width="<? echo $width;?>" cellspacing="0" align="center" border="0">
        <tr>
          <tr>
            <td  align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="70" width="200"></td>
            <td colspan="7" align="center"  style="font-size:xx-large;"><strong style="margin-left:100px" ><? echo $com_dtls[0]; ?></strong>
             <div style="float:right;width:34%; text-align:right">
             
             
                  <div style="float:left; height:5%; width:5%;" id="qrcode"></div> 

             
             
             
               	&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
            </div>
            </td>
        </tr>
        <tr class="form_caption">
            <td colspan="8" align="center">
				<?
				echo $com_dtls[1];
				/*$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
					//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
					foreach ($nameArray as $result)
					{ 
						echo $result[csf('plot_no')]; 
						echo $result[csf('level_no')];
						echo $result[csf('road_no')];
						echo $result[csf('block_no')];
						echo $result[csf('city')];
						echo $result[csf('zip_code')];
						echo $result[csf('province')].',';
						echo $country_arr[$result[csf('country_id')]].'<br>'; 
						echo $result[csf('email')]; 
						echo $result[csf('website')];
					}*/
                ?> 
                <div style="width:34%; text-align:center">
               	&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
            </div>
            </td>
        </tr>
        <tr>
        	<td style="display:none" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
        </tr>
        <tr>
            <td colspan="8" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
        </tr>
        <tr>
            <td width="160"><strong>Gate Pass ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
            <td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
           <?php /*?> <td width="125"><strong>Challan/System No:</strong></td><td width="175px" colspan="2"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td><?php */?>
            <td width="125"><strong>D.O No:</strong></td><td width="175px" colspan="2"><? echo $dataArray[0][csf('do_no')];//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
        </tr>
         <tr>
            
            <td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
            <td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
            <td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
        </tr>
        <tr>
            <td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
            <td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
            <td><strong>Mobile No:</strong></td><td width="175px" colspan="2"><? echo $dataArray[0][csf('mobile_no')]; ?></td>
        </tr>
        <tr>
          	 <?
			if($within_group==2)
			{
				$send_to_company_id=$dataArray[0][csf('sent_to')];
				$nameArrays = sql_select("select address_1,web_site,email,country_id from lib_supplier where supplier_name='$supp_add'");

			}
			else
			{
				$send_to_company_id=$dataArray[0][csf('sent_to')];
				$nameArrays = sql_select("select address_1,web_site,email,country_id from lib_supplier where id=$supp_add");

			}
	          		$supp_add = $send_to_company_id;
					foreach ($nameArrays as $result) {
						$address = "";
						if ($result != "") $address = $result[csf('address_1')];//.'<br>'.$country_arr[$result['country_id']].'<br>'.$result['email'].'<br>'.$result['web_site']
					}
					unset($nameArrays);
	        ?>
          	<td><strong>Address:</strong></td><td width="175px" ><? echo $address; ?></td>
            <td><strong>Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
            <td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
            
        </tr>
         <tr>
        	<td><strong>Date:</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
            <td><strong>Est. Return Date :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
            <td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
            
        </tr>
        <tr>
        	<td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
           <td><strong>Vehicle Number:</strong></td><td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>


           <td><strong>To Location :</strong></td><td><?  if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
        <!-- <tr>
         	   <td><strong>Bar Code:</strong></td><td  colspan="2" id="barcode_img_id"></td> 
               
         </tr>-->
        </tr>
             <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 

        <? if ($basis==12)
        {
        	?>
        	<tr>

       	 <td> <strong> Shipping Mode </strong></td>
       	 <td colspan="5" align="left"> <?  echo $shipment_mode[$shipmodes[0][csf("shiping_mode")]]; ?> </td>

       	 </tr>

	
       <? }?>
        


    </table>
    <br>
    <? if($basis==5 or $basis==1 or $basis==7 or $basis==38)
    {?>
    <table align="center" cellspacing="0" width="<? echo $width;?>"  border="1" rules="all" class="rpt_table" >
        <thead bgcolor="#dddddd" align="center">
            <th width="30">SL</th>
            <th width="100" align="center">Item Category</th>
            <th width="100" align="center">Sample</th>
            <th width="200" align="center">Item Description</th>
            <th width="50" align="center">UOM</th>
            <th width="80" align="center">Quantity</th>
            <? if($basis==12)
            {
				?>
				<th width="60" align="center">No Of Carton </th>
				<?
            }
            else
            {
				?>
				<th width="60" align="center">No Of Roll </th>
				<?
             }
             ?>
            <th width="60" align="center">No Of Bag/Cone </th>
            <?
            if($show_item==1)
			{
				?>
				<th width="60" align="center">Rate</th> 
				<th width="90" align="center">Amount </th>
				<?
			}
			?>
            <th width="150" align="center">Buyer Order </th>
            <th align="center">Remarks</th>
        </thead>
	<?
    $i=1;
	$gate_id=$dataArray[0][csf('id')];
	 $sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags from  inv_gate_pass_dtls a where a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 order by a.uom,a.id ";

	       $sql_sel=sql_select($sql_dtls);
            foreach($sql_sel as $values)
            {
                $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['qty']+=$values[csf("quantity")];

                $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['item_category_id']=$values[csf("item_category_id")];

                $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['sample_id']=$values[csf("sample_id")];


                 $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['item_description']=$values[csf("item_description")];


                  $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['quantity']+=$values[csf("quantity")];

                   $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['amount']+=$values[csf("amount")];

                   $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['rate']+=$values[csf("rate")];

                   $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['buyer_order_id'].=$values[csf("buyer_order_id")].",";

                   $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['buyer_order'].=$values[csf("buyer_order")].",";

                   $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['remarks']=$values[csf("remarks")];
				   
                    $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['no_of_bags']=$values[csf("no_of_bags")];
            }
           //echo "<pre>";print_r($general_item_arr);die;
            $row_span_arr=array();

            foreach($general_item_arr as $key=>$value)
            {

                $row_span=0;
                foreach($value as $item_description_id=>$row)
                {
                    $row_span++;
                }

                $row_span_arr[$key]=$row_span;
            }


             $i=1;
            foreach($general_item_arr as $key=>$value)
            {

                $j=0;
                foreach($value as $item_description_id=>$row)
                {
                  

                ?>

                 <tr>
        	<td width="40"   align="center"><? echo $i;$i++; ?></td>
            <td><?  echo $item_category[$row["item_category_id"]]; ?></td>
            <td><?  echo $sample_library_arr[$row["sample_id"]]; ?></td>
            <td><?  echo $row['item_description']; ?></td>
            <? if($j==0)
            {
	
            ?>
            <td width="40" rowspan="<? echo $row_span_arr[$key]?>" align="center"><? echo $unit_of_measurement[$key]; ?></td>
            <?
            }
            ?>
            <td align="right"><? echo number_format($row['quantity'],2,'.',''); ?></td>  
            <td align="right">&nbsp;</td>  

             <td align="right"><? echo $row['no_of_bags']; ?></td>
                 <?
				if($show_item==1)
				{
					?> 
                    <td align="right"><? $rate=$row['amount']/$row['quantity']; echo number_format($rate,2,'.',''); ?></td>
                    <td align="right"><? echo number_format($row['amount'],2,'.',''); ?></td>
                    <?
				}
				?>
                <td style="word-break:break-all;"><? echo implode(",",array_unique(explode(",",chop($row['buyer_order'],",")))); ?></td>
                <td><? echo $row['remarks']; ?></td>


      <?
             
             $j++;
             $total+=$row[("qty")];
             $gr_total+=$row[("qty")];
             $tot_qty +=$row['quantity'];
             //$tot_bags +=$row['no_of_bags'];
             }
             ?>
             <tr>
                 <td colspan="5" align="right"><b>Sub Total</b></td>
                 <td align="right">  <b><? echo number_format($total,2); $total=0; ?></b></td>
             </tr>
              <?
         }
         ?>

         <tfoot bgcolor="#CCCCCC">
        <tr>
        <td colspan="5" align="right"> <b> Total</b></td>
        <td align="right"><b><? echo number_format($tot_qty,2);?></b></td> 
         <?
		if($show_item==1)
		{
		?>      
        <td align="right"><b><? echo $tot_roll;?></b></td>    
        <?
		}
		else
		{  
			echo "<td></td>" ;
		}
		?>

		<td align="right"><b><? echo number_format($tot_bags,2);?></b></td>
        <td></td>
        <td></td>
        <td align="right"> </td>
        <td colspan="<? echo 4+$colspan2;?>"></td>
        </tr>
	</tfoot>
              
           
        <?
            
	//echo $sql_dtls;
	$uom_check=array();
	$sql_result=sql_select($sql_dtls);
	$tot_qty=0; $tot_amount=0; $tot_amount=0;
	$p=0;
	
	//$tot_check=array();
	if(count($uom_check)==1)
	{
	?>
   
    <?
	}
	 $width_sign=$width.'px';
	?>
    </table>
    <?
    }
    else 
    {
		$brand_library=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );
			
		
		 $i=1;
	$gate_id=$dataArray[0][csf('id')];
	
  if($db_type==2)
  {
   $sql_dtls_print= "select f.item_category_id, f.item_description, f.uom,f.buyer_order_id,f.buyer_order,d.challan_no as gate_pass_challan,f.challan_no as trans_id,f.buyer_id,d.issue_id, a.id as mst_id,a.challan_no,b.id as dtls_order_id,b.buyer_id, b.po_break_down_id, b.item_number_id,b.cutting_no, b.country_id,
	g.color_number_id,LISTAGG(g.size_number_id,',') WITHIN GROUP (ORDER BY g.size_number_id) as size_number_id,LISTAGG(c.production_qnty,',') WITHIN GROUP (ORDER BY g.size_number_id) as production_qnty_order from pro_cut_delivery_mst a, pro_cut_delivery_order_dtls b, pro_cut_delivery_color_dtls c ,inv_gate_pass_mst d,inv_gate_pass_dtls f,wo_po_color_size_breakdown g 
	where a.id=b.delivery_mst_id and b.id=c.mst_id and d.id=f.mst_id and d.issue_id=a.id and a.sys_number=d.challan_no and b.po_break_down_id=f.buyer_order_id and c.color_size_break_down_id=g.id
	and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.sys_number='$data[3]' and d.sys_number='$data[1]'
	group by f.item_category_id, f.item_description, f.uom,f.buyer_order_id,f.buyer_order,d.challan_no,f.challan_no,f.buyer_id,d.issue_id, a.id,a.challan_no,b.id,b.buyer_id, b.po_break_down_id, b.item_number_id,b.cutting_no, b.country_id,g.color_number_id
	order by a.id,b.id";
  }
  else
  {
	 $sql_dtls_print= "select f.item_category_id, f.item_description, f.uom,f.buyer_order_id,f.buyer_order,d.challan_no as gate_pass_challan,f.challan_no as trans_id,f.buyer_id,d.issue_id, a.id as mst_id,a.challan_no,b.id as dtls_order_id,b.buyer_id, b.po_break_down_id, b.item_number_id,b.cutting_no, b.country_id,
	g.color_number_id,
	group_concat(g.size_number_id ORDER BY g.size_number_id ASC) as size_number_id,
	group_concat(c.production_qnty) as production_qnty,
	group_concat(c.production_qnty ORDER BY g.size_number_id ASC) production_qnty_order
	from pro_cut_delivery_mst a, pro_cut_delivery_order_dtls b, pro_cut_delivery_color_dtls c ,inv_gate_pass_mst d,inv_gate_pass_dtls f,	wo_po_color_size_breakdown g 
	where a.id=b.delivery_mst_id and b.id=c.mst_id and d.id=f.mst_id and d.issue_id=a.id and a.sys_number=d.challan_no and 	b.po_break_down_id=f.buyer_order_id and c.color_size_break_down_id=g.id
	and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and 	a.sys_number='$data[3]' and d.sys_number='$data[1]'
	group by f.item_category_id, f.item_description, f.uom,f.buyer_order_id,f.buyer_order,d.challan_no,f.challan_no,f.buyer_id,	d.issue_id, a.id,a.challan_no,b.id,b.buyer_id, b.po_break_down_id, b.item_number_id,b.cutting_no, b.country_id,g.color_number_id
	order by a.id,b.id,c.id,g.size_number_id"; 
  }
	
	//echo $sql_dtls_print;
	
	$transIDs=""; $issue_ids=""; $buyerOrderId=""; $colorNumId="";$sizeNumId="";$prodQnty="";
	$uom_check=array();
	$sql_result=sql_select($sql_dtls_print);
	foreach($sql_result as $row)
	{
		$transIDs.=$row[csf('trans_id')].',';
		$issue_ids=$row[csf('issue_id')];
		$buyerOrderId.=$row[csf('buyer_order_id')].',';
		$sizeNumId.=$row[csf('size_number_id')].',';
	}
	$transID=chop($transIDs,",");
	$buyerOrderIds=chop($buyerOrderId,",");
	$sizeNumIds=chop($sizeNumId,",");
	$sizeNumIds=array_unique(explode(",",$sizeNumIds));
    ?>
    <table align="center" cellspacing="0" width="<? echo $width+100;?>"  border="1" rules="all" class="rpt_table" >
        <thead bgcolor="#dddddd" align="center">
        	<tr>
            	<th rowspan="2"  width="30" >SL</th>
	            <th rowspan="2"  width="150" align="center">Challan No</th>
	            <th rowspan="2"  width="100" align="center">Buyer</th>
	            <th rowspan="2"  width="100" align="center">Job No</th>
	            <th rowspan="2"  width="200" align="center">Item Description</th>
	            <th rowspan="2"  width="100" align="center">Color</th>
	            <th rowspan="2" width="40" align="center">Dia</th>
	            <th rowspan="2"  width="50" align="center">UOM</th>
                <th colspan="<? echo count($sizeNumIds)+1; ?>"  align="center">Quantity/Size</th>
              	<th rowspan="2"  align="center">Remarks</th>
            </tr>
        	<tr>
            <? 
            //for($iss=1; count($sizeNumIds)>=$iss;$iss++)
           foreach($sizeNumIds as $SizeId)
			//foreach($sql_result as $SizeId)
				{
					?>
                     <th  width="50" align="center"><? echo $size_library[$SizeId]; //echo $size_library[$SizeId]; ?></th>
                    <?
				}
				?>
                <th  width="50" align="center">Total</th>
            </tr>
        </thead>
	<?

	$sqlResult_delv =sql_select("select b.id as issue_id,a.po_break_down_id,a.item_number_id,a.country_id,a.cut_delivery_date,a.cut_delivery_qnty,a.location,b.challan_no,a.buyer_id from  pro_cut_delivery_order_dtls a,  pro_cut_delivery_mst b where a.delivery_mst_id=b.id and  b.id in($issue_ids) and a.status_active=1 and a.is_deleted=0 order by b.id");
	$arr_delvr_data=array(); $poBreakDonID="";
	foreach($sqlResult_delv as $row)
	{
		$poBreakDonID.=$row[csf('po_break_down_id')].',';
		$arr_delvr_data[$row[csf('issue_id')]]['buyer_id']=$row[csf('buyer_id')];
	}
	$buyer_remarks_library=return_library_array( "select id, remark from lib_buyer", "id", "remark"  );
	$poBreakDonIDs=chop($poBreakDonID,",");
	
	$res_data_sql = sql_select("select a.id,a.po_quantity,a.plan_cut, a.po_number,a.po_quantity,b.company_name, b.buyer_name, b.style_ref_no,b.gmts_item_id, b.order_uom, b.job_no,b.location_name,a.shipment_date   from wo_po_break_down a, wo_po_details_master b where a.job_no_mst=b.job_no and a.id in($poBreakDonIDs)"); 
	
	$arr_res_data=array();
	foreach($res_data_sql as $row)
		{
			$arr_res_data[$row[csf('id')]]['job_no']=$row[csf('job_no')];
		}
	
	
	
	$p=0; $totalQnty=0; $grandTotalQnty=0;
	foreach($sql_result as $row)
	{
		if ($i%2==0)  
			$bgcolor="#E9F3FF";
		else
			$bgcolor="#FFFFFF";
			
			$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
			$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
			//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
			$uom_check[$row[csf('uom')]]=$row[csf('uom')];
			?>
			<tr bgcolor="<? echo $bgcolor; ?>">
                <td><? echo $i; ?></td>               
                <td><?  echo $row[csf('gate_pass_challan')]; ?></td>
                <td><?  echo $buyer_remarks_library[$arr_delvr_data[$row[csf('issue_id')]]['buyer_id']]; ?></td>
                <td><?  echo $arr_res_data[$row[csf('buyer_order_id')]]['job_no']; ?></td>
                <td><?  echo $row[csf('item_description')]; ?></td>                
                <td align="center"><? echo $color_library[$row[csf('color_number_id')]]; ?></td>   
                <td align="right"><? echo ''; ?></td>
                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
                <?
				$size_number_ids = explode(",", $row[csf('size_number_id')]);
				$production_qnty_by_size = explode(",", $row[csf('production_qnty_order')]);
				$datas = array_combine($size_number_ids,$production_qnty_by_size);
				foreach($sizeNumIds as $SizeId)
				{
					if($datas[$SizeId] != "")
					{
					?>
					  <td align="center">
					  <? 
					  echo $datas[$SizeId];
					  ?>
                      </td>
                    <?
					}
					else
					{
						?>
                        <td  align="center">--</td>
                        <?
					} 
					$totalQnty+=$datas[$SizeId];
				}				
				?>               
                <td align="center"><? echo  $totalQnty; ?></td>                
                <td><? echo $row[csf('remarks')]; ?></td>
			</tr>
		<?php
		$grandTotalQnty+=$totalQnty;
		unset($totalQnty);
		$i++;
    }
	//$tot_check=array();
	 $width_sign=$width.'px';
	?>
    
    
	<tfoot>
    	<tr>
        	<th colspan="8"></th>
            <?
             foreach($sizeNumIds as $SizeId)
				{
					
					?>
                     <th  width="50" align="center"><? //echo $size_library[$SizeId]; ?></th>
                    <?
					
				}
			?>
               <th><? echo $grandTotalQnty; ?></th>
               <th></th>
              
        </tr>
    	
    </tfoot>
	
    </table>
    <? }
    ?>


	</div>
	<div>
		<? echo signature_table(114, $data[0], $width_sign,$template_id); ?>
	</div> 
	<script type="text/javascript" src="../../js/jquery.js"></script>
		<!--<script type="text/javascript" src="../../js/jquerybarcode.js"></script>-->
	<script type="text/javascript" src="../../js/jquery.qrcode.min.js"></script>
	<script>
	var main_value='<? echo $data[1]; ?>';
	//alert(main_value);
		$('#qrcode').qrcode(main_value);
	</script>

		
		
		
		<script>
		/*function generateBarcode( valuess ){
			
				var value = valuess;//$("#barcodeValue").val();
			// alert(value)
				var btype = 'code39';//$("input[name=btype]:checked").val();
				var renderer ='bmp';// $("input[name=renderer]:checked").val();
				
				var settings = {
				output:renderer,
				bgColor: '#FFFFFF',
				color: '#000000',
				barWidth: 1,
				barHeight: 30,
				moduleSize:5,
				posX: 10,
				posY: 20,
				addQuietZone: 1
				};
				$("#barcode_img_id").html('11');
				value = {code:value, rect: false};
				
				$("#barcode_img_id").show().barcode(value, btype, settings);
			} */
		<?php /*?> generateBarcode('<? echo $data[1]; ?>');<?php */?>
		</script>
	<?
	exit();
}

if($action=="print_to_html_report7")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//print_r ($data);
	$show_item=$data[2];
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");


	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention,issue_id, sent_by,carried_by, sent_to,vhicle_number, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,com_location_id,do_no,mobile_no from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 "; 
	//echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
 	$sent_to=$dataArray[0][csf('sent_to')];
	$issue_ids=$dataArray[0][csf('issue_id')];
	 $all_challan="";
    foreach($challan_no as $cno)
	{
			if($all_challan=="") $all_challan="'".$cno."'"; else $all_challan.=","."'".$cno."'";
	}
	if($basis==12)
	{ 
	if($all_challan!='') $all_challan=$all_challan;else $all_challan=0;
	$shipmode_cartoon=sql_select("select  b.total_carton_qnty,b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number in($all_challan)") ;


	$shipmodes=sql_select("select  b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number in($all_challan) and (b.shiping_mode is not null or b.shiping_mode!=0) ") ;
	}
	
	/*echo "<pre>";
	print_r($shipmode_cartoon);die;*/

 
	if($basis==1)
	{ 
		if($within_group==1)
		{
			//$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
		else
		{
			//$send_to_company=$dataArray[0][csf('sent_to')];		
		}
	}
	else if($basis==8 || $basis==9 || $basis==27)
	{
		//$send_to_company=$dataArray[0][csf('sent_to')];	
		$no_of_rolls = sql_select("select a.id,b.carton_roll as no_roll from subcon_delivery_mst a ,subcon_delivery_dtls b where a.id=b.mst_id  and a.delivery_no in($all_challan) and a.status_active=1 and a.is_deleted=0  and a.process_id in(2,4,3) ");
	}

	else if($basis==17)
	{
	$no_of_rolls=sql_select("select b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty as cons_quantity,
	b.yarn_lot,b.rate as cons_rate,b.transfer_value as cons_amount,b.brand_id,c.product_name_details,d.no_of_bags,b.roll as no_roll 	from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c,inv_transaction d 
	where a.id=b.mst_id and c.id=b.from_prod_id and b.from_prod_id=d.prod_id and a.transfer_system_id='$challan_no' and 	b.item_category=13 
	and b.status_active = '1' and b.is_deleted = '0' and d.no_of_bags is not NULL
	group by  b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty,
	b.yarn_lot,b.rate,b.transfer_value ,b.brand_id,c.product_name_details,d.no_of_bags ,b.roll ");
	}
	else if($basis==11)
	{
	$no_of_rolls=sql_select("select a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity,b.batch_id,roll as no_roll
				from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
				where a.sys_number='$challan_no' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form=54 and b.entry_form=54");
	}
	else if($basis==12)
	{
		//$send_to_company=$supplier_name_library[$dataArray[0][csf('sent_to')]];
	}
	else if($basis==10)
	{
	$no_of_rolls=sql_select("select a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity,b.roll as no_roll
				from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
				where a.sys_number='$challan_no' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.entry_form=53 and b.entry_form=53");
	}

	else if($basis==15) //Finish Fabric Recv Return
	{
		//echo $mst_challan;
		
		 $no_of_rolls =sql_select("select a.id as issue_id, a.item_category, a.received_id, a.received_mrr_no, b.id as trans_id, b.cons_quantity as cons_quantity,b.cons_uom, b.cons_rate, b.cons_amount, c.product_name_details, c.id as prod_id  ,b.no_of_roll as no_roll 
			from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id
			where a.id=b.mst_id and b.item_category=2 and b.transaction_type=3 and  a.issue_number='$challan_no' order by b.id");
		   
	}

	else if($basis==4)
	{
		if($db_type==2)
		{
	$no_of_rolls = sql_select("select a.id,a.transaction_type,a.item_category,b.product_name_details,a.cons_rate,a.cons_quantity,a.cons_uom ,a.cons_amount,a.remarks,b.unit_of_measure ,c.no_of_roll as no_roll from inv_transaction a, product_details_master b,inv_finish_fabric_issue_dtls c ,inv_issue_master d  where a.prod_id=b.id and d.id=a.mst_id  and d.id=c.mst_id and a.id=c.trans_id   and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.id in($issue_ids) ");
	
		}
		else
		{
			//$no_of_rolls = sql_select("select a.id,a.transaction_type,a.item_category,b.product_name_details,a.cons_rate,a.cons_quantity,a.cons_uom ,a.cons_amount,a.remarks,b.unit_of_measure ,c.no_of_roll as no_roll from inv_transaction a, product_details_master b,inv_finish_fabric_issue_dtls c ,inv_issue_master d,inv_gate_pass_mst e  where a.prod_id=b.id and d.id=a.mst_id  and d.id=c.mst_id and a.id=c.trans_id and char(d.id)=e.issue_id and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.issue_number='$challan_no'"); 
			$no_of_rolls = sql_select("select a.id,a.transaction_type,a.item_category,b.product_name_details,a.cons_rate,a.cons_quantity,a.cons_uom ,a.cons_amount,a.remarks,b.unit_of_measure ,c.no_of_roll as no_roll from inv_transaction a, product_details_master b,inv_finish_fabric_issue_dtls c ,inv_issue_master d where a.prod_id=b.id and d.id=a.mst_id  and d.id=c.mst_id and a.id=c.trans_id and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.id in($issue_ids)"); 
		}
	
 	}

 	else if($basis==22)
	{
	$no_of_rolls = sql_select("select b.roll_no as no_roll from inv_receive_mas_batchroll a,pro_grey_batch_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.recv_number='$challan_no'"); 

 	}
	else
	{
			
			//echo $within_group.'=='.$basis;
			/*if($basis==2 || $basis==3 || $basis==4 || $basis==5 || $basis==6 || $basis==7  ||  $basis==10 || $basis==13 ||  $basis==14 ||  $basis==11 ||  $basis==15)
			{
				if($within_group==2)
				{
					$send_to_company=$dataArray[0][csf('sent_to')];
				}
				else
				{
					$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
				}
			}
			else
			{
					$send_to_company=$dataArray[0][csf('sent_to')];	
			}*/
		
		
		
		//$send_to_company=$dataArray[0][csf('sent_to')];
	}
	if($within_group==2)
		{
			$send_to_company=$dataArray[0][csf('sent_to')];
		}
		else
		{
			$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['job_no']=$row[csf('job_no')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	
	}
	
	if($show_item==1)
	{
		$width=1150;
		//$colspan=5;
	}
	else
	{
		$width=1150;
		//$colspan=5;
		$colspan2=2;
	}

    if($basis==4)
 	{
 		$width=$width+100;;
 	}
    ?>
	
	<div style="width:<? echo $width;?>px;" align="center">
    <table width="<? echo $width;?>" cellspacing="0" align="center" border="0">
        <tr>
          <tr>
            <td  align="left"><img src="<?=base_url($image_location); ?>" height="70" width="200"></td>
            <td colspan="7" align="center"  style="font-size:xx-large;"><strong style="margin-left:100px" ><? echo $company_library[$data[0]]; ?></strong>
             <div style="float:right;width:34%; text-align:right">
             
             
                  <div style="float:left; height:5%; width:5%;" id="qrcode"></div> 

             
             
             
               	&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
            </div>
            </td>
        </tr>
        <tr class="form_caption">
            <td colspan="8" align="center">
				<?
				$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
					//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
					foreach ($nameArray as $result)
					{ 
						echo $result[csf('plot_no')]; 
						echo $result[csf('level_no')];
						echo $result[csf('road_no')];
						echo $result[csf('block_no')];
						echo $result[csf('city')];
						echo $result[csf('zip_code')];
						echo $result[csf('province')].',';
						echo $country_arr[$result[csf('country_id')]].'<br>'; 
						echo $result[csf('email')]; 
						echo $result[csf('website')];
					}
                ?> 
                <div style="width:34%; text-align:center">
               	&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
            </div>
            </td>
        </tr>
        <tr>
        	<td style="display:none" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
        </tr>
        <tr>
            <td colspan="8" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
        </tr>
        <tr>
            <td width="160"><strong>Gate Pass ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
            <td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
           <?php /*?> <td width="125"><strong>Challan/System No:</strong></td><td width="175px" colspan="2"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td><?php */?>
            <td width="125"><strong>D.O No:</strong></td><td width="175px" colspan="2"><? echo $dataArray[0][csf('do_no')];//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
        </tr>
         <tr>
            
            <td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
            <td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
            <td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
        </tr>
        <tr>
            <td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
            <td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
            <td><strong>Mobile No:</strong></td><td width="175px" colspan="2"><? echo $dataArray[0][csf('mobile_no')]; ?></td>
        </tr>
        <tr>
          	 <?
			if($within_group==2)
			{
				$send_to_company_id=$dataArray[0][csf('sent_to')];
				$nameArrays = sql_select("select address_1,web_site,email,country_id from lib_supplier where supplier_name='$send_to_company_id'");

			}
			else
			{
				$send_to_company_id=$dataArray[0][csf('sent_to')];
				$nameArrays = sql_select("select address_1,web_site,email,country_id from lib_supplier where id=$send_to_company_id");

			}
	          		$supp_add = $send_to_company_id;
					foreach ($nameArrays as $result) {
						$address = "";
						if ($result != "") $address = $result[csf('address_1')];//.'<br>'.$country_arr[$result['country_id']].'<br>'.$result['email'].'<br>'.$result['web_site']
					}
					unset($nameArrays);
	        ?>
          	<td><strong>Address:</strong></td><td width="175px" ><? echo $address; ?></td>
            <td><strong>Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." : ".$dataArray[0][csf('time_minute')].""; ?></td>
            <td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
            
        </tr>
         <tr>
        	<td><strong>Date:</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
            <td><strong>Est. Return Date :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
            <td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
            
        </tr>
        <tr>
        	<td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
           <td><strong>Vehicle Number:</strong></td><td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>


           <td><strong>To Location :</strong></td><td><?  if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
        <!-- <tr>
         	   <td><strong>Bar Code:</strong></td><td  colspan="2" id="barcode_img_id"></td> 
               
         </tr>-->
        </tr>
             <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 

        <? if ($basis==12)
        {
        	?>
        	<tr>

       	 <td> <strong> Shipping Mode </strong></td>
       	 <td colspan="5" align="left"> <?  echo $shipment_mode[$shipmodes[0][csf("shiping_mode")]]; ?> </td>

       	 </tr>

	
       <? }?>
        


    </table>
    <br>
    <? if($basis==5 or $basis==1 or $basis==7 or $basis==38)
    { ?>
    <table align="center" cellspacing="0" width="<? echo $width;?>"  border="1" rules="all" class="rpt_table" >
        <thead bgcolor="#dddddd" align="center">
            <th width="30">SL</th>
            <th width="100" align="center">Item Category</th>
            <th width="100" align="center">Sample</th>
            <th width="200" align="center">Item Description</th>
            <th width="50" align="center">UOM</th>
            <th width="80" align="center">Quantity</th>
            <? if($basis==12)
            {
				?>
				<th width="60" align="center">No Of Carton </th>
				<?
            }
            else
            {
				?>
				<th width="60" align="center">No Of Roll </th>
				<?
             }
             ?>
            <th width="60" align="center">No Of Bag/Cone </th>
            <?
            if($show_item==1)
			{
				?>
				<th width="60" align="center">Rate</th> 
				<th width="90" align="center">Amount </th>
				<?
			}
			?>
            <th width="150" align="center">Buyer Order </th>
            <th align="center">Remarks</th>
        </thead>
	<?
    $i=1;
	$gate_id=$dataArray[0][csf('id')];
	

	
	 $sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags from  inv_gate_pass_dtls a where a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 order by a.uom,a.id ";

	       $sql_sel=sql_select($sql_dtls);
            foreach($sql_sel as $values)
            {
				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['qty']+=$values[csf("quantity")];

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['item_category_id']=$values[csf("item_category_id")];

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['sample_id']=$values[csf("sample_id")];

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['item_description']=$values[csf("item_description")];


				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['quantity']+=$values[csf("quantity")];

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['amount']+=$values[csf("amount")];

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['rate']+=$values[csf("rate")];

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['buyer_order_id'].=$values[csf("buyer_order_id")].",";

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['buyer_order'].=$values[csf("buyer_order")].",";

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['remarks']=$values[csf("remarks")];

				$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['no_of_bags']=$values[csf("no_of_bags")];
            }
           //echo "<pre>";print_r($general_item_arr);die;
            $row_span_arr=array();

            foreach($general_item_arr as $key=>$value)
            {

                $row_span=0;
                foreach($value as $item_description_id=>$row)
                {
                    $row_span++;
                }

                $row_span_arr[$key]=$row_span;
            }


             $i=1;
            foreach($general_item_arr as $key=>$value)
            {

                $j=0;
                foreach($value as $item_description_id=>$row)
                {
                  

                ?>

                 <tr>
        	<td width="40"   align="center"><? echo $i;$i++; ?></td>
            <td><?  echo $item_category[$row["item_category_id"]]; ?></td>
            <td><?  echo $sample_library_arr[$row["sample_id"]]; ?></td>
            <td><?  echo $row['item_description']; ?></td>
            <? if($j==0)
            {
	
            ?>
            <td width="40" rowspan="<? echo $row_span_arr[$key]?>" align="center"><? echo $unit_of_measurement[$key]; ?></td>
            <?
            }
            ?>
            <td align="right"><? echo number_format($row['quantity'],2,'.',''); ?></td>  
            <td align="right">&nbsp;</td>  

             <td align="right"><? echo $row['no_of_bags']; ?></td>
                 <?
				if($show_item==1)
				{
					?> 
                    <td align="right"><? $rate=$row['amount']/$row['quantity']; echo number_format($rate,2,'.',''); ?></td>
                    <td align="right"><? echo number_format($row['amount'],2,'.',''); ?></td>
                    <?
				}
				?>
                <td style="word-break:break-all;"><? echo implode(",",array_unique(explode(",",chop($row['buyer_order'],",")))); ?></td>
                <td><? echo $row['remarks']; ?></td>


      <?
             
             $j++;
             $total+=$row[("qty")];
             $gr_total+=$row[("qty")];
             $tot_qty +=$row['quantity'];
             //$tot_bags +=$row['no_of_bags'];
             }
             ?>
             <tr>
                 <td colspan="5" align="right"><b>Sub Total</b></td>
                 <td align="right">  <b><? echo number_format($total,2); $total=0; ?></b></td>
             </tr>
              <?
         }
         ?>

         <tfoot bgcolor="#CCCCCC">
        <tr>
        <td colspan="5" align="right"> <b> Total</b></td>
        <td align="right"><b><? echo number_format($tot_qty,2);?></b></td> 
         <?
		if($show_item==1)
		{
		?>      
        <td align="right"><b><? echo $tot_roll;?></b></td>    
        <?
		}
		else
		{  
			echo "<td></td>" ;
		}
		?>

		<td align="right"><b><? echo number_format($tot_bags,2);?></b></td>
        <td></td>
        <td></td>
        <td align="right"> </td>
        <td colspan="<? echo 4+$colspan2;?>"></td>
        </tr>
	</tfoot>
              
           
        <?
            
	//echo $sql_dtls;
	$uom_check=array();
	$sql_result=sql_select($sql_dtls);
	$tot_qty=0; $tot_amount=0; $tot_amount=0;
	$p=0;
	
	//$tot_check=array();
	if(count($uom_check)==1)
	{
	?>
   
    <?
	}
	 $width_sign=$width.'px';
	?>
    </table>
    <?
    }
    else 
    {
		$brand_library=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );

    ?>
    <table align="center" cellspacing="0" width="<? echo $width+100;?>"  border="1" rules="all" class="rpt_table" >
        <thead bgcolor="#dddddd" align="center">
            <th width="30">SL</th>
            <!--<th width="100" align="center">Item Category</th>
            <th width="100" align="center">Sample</th>-->
            <th width="150" align="center">Challan No</th>
            <th width="100" align="center">Buyer</th>
            <th width="100" align="center"><? if($basis==4){echo "Batch No";}else{echo 'Program No';}?></th>
            <?
            if($basis==4)
		 	{
		 		?> <th width="100" align="center">Color</th> <?
		 	}
            ?>
            <th width="120" align="center">Job No</th>
            <th width="200" align="center">Fabric Description</th>
            <th width="50" align="center">UOM</th>
            <th width="80" align="center">Issue Qnty</th>
            <? if($basis==12)
            {?>
             <th width="100" align="center">No Of Carton </th>
	
            <?
            }
            else
            {
            ?>
             <th width="100" align="center">No Of Roll </th>
             <?
             }
             ?>
            <?
            if($show_item==1)
			{
			?>
          	<th width="50" align="center">Rate</th> 
            <th width="80" align="center">Amount </th>
            <?
			}
			?>
            <th align="center">Remarks</th>
        </thead>
	<?
    $i=1;
	$gate_id=$dataArray[0][csf('id')];
	
		/*$sql_dtls_trans = sql_select("select a.id,a.transaction_type,a.item_category as item_category_id,0 as sample_id,b.product_name_details as item_description,a.cons_rate,a.cons_quantity,a.cons_uom ,a.cons_amount,a.remarks,b.unit_of_measure ,c.no_of_roll as no_roll from inv_transaction a, product_details_master b,inv_finish_fabric_issue_dtls c ,inv_issue_master d where a.prod_id=b.id and d.id=a.mst_id  and d.id=c.mst_id and a.id=c.trans_id and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.id in($issue_ids)"); */
		//echo $sql_challan = "select c.issue_number,b.id as prod_id,a.item_category as item_category_id,b.product_name_details,avg(b.avg_rate_per_unit) as cons_rate,sum(a.cons_quantity) as quantity,sum(a.cons_amount) as amount,b.unit_of_measure as uom  from inv_issue_master c ,inv_transaction a, product_details_master b where c.id=a.mst_id  and a.prod_id=b.id and a.mst_id in($issue_ids) and c.entry_form in(16,61) and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.id,c.issue_number,a.item_category,b.product_name_details,b.unit_of_measure order by b.id "; 
		
	 if($basis==3)
	 {	
		if($db_type==2) 
		{
			$trans_group_con="LISTAGG(a.id, ',') WITHIN GROUP (ORDER BY a.id desc) as id";
		}
		else
		{
			$trans_group_con="group_concat(a.id) as id";
		}
	 
	
	 
	 $sql_dtls_gate= " select a.id,a.item_category_id,a.sample_id, a.item_description,sum(a.uom_qty) as uom_qty, sum(a.quantity) as quantity, a.uom, avg(a.rate) as rate, sum(a.amount) as amount ,a.buyer_order_id,a.buyer_order, a.remarks,b.challan_no,a.challan_no as trans_id,b.issue_id,b.company_id, a.no_of_bags as no_of_bags from  inv_gate_pass_dtls a,inv_gate_pass_mst b where b.id=a.mst_id and a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.id,a.item_category_id,a.sample_id, a.item_description, a.uom,a.buyer_order_id,a.buyer_order, a.remarks,b.challan_no,a.challan_no,b.issue_id,b.company_id order by a.challan_no ";
	 $gate_result=sql_select($sql_dtls_gate);
	 $gate_orderIDs="";
	 foreach($gate_result as $row)
	 {
	 	$gate_pass_arr[$row[csf('item_description')]]['po_no']=$row[csf('buyer_order')];
		$gate_pass_arr[$row[csf('item_description')]]['po_id']=$row[csf('buyer_order_id')];
		$gate_pass_arr[$row[csf('item_description')]]['no_of_bags']=$row[csf('no_of_bags')];
		$gate_pass_arr[$row[csf('item_description')]]['remarks']=$row[csf('remarks')];
		$gate_orderIDs.=$row[csf('buyer_order_id')].',';
		
	 }
	  $sql_dtls = "select $trans_group_con,c.company_id, c.issue_number,b.id as prod_id,a.item_category as item_category_id,b.product_name_details as item_description,avg(b.avg_rate_per_unit) as rate,sum(a.cons_quantity) as quantity,sum(a.cons_amount) as amount,b.unit_of_measure as uom  from inv_issue_master c ,inv_transaction a, product_details_master b where c.id=a.mst_id  and a.prod_id=b.id and a.mst_id in($issue_ids) and c.entry_form in(16,61) and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by c.company_id,b.id,c.issue_number,a.item_category,b.product_name_details,b.unit_of_measure order by b.id "; 
	  
	}
	else
	{
		$sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags,b.challan_no,a.challan_no as trans_id,b.issue_id,company_id from  inv_gate_pass_dtls a,inv_gate_pass_mst b where b.id=a.mst_id and a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.challan_no ";
	}
	//echo $sql_dtls;
	$uom_check=array();
	$sql_result=sql_select($sql_dtls);
	$orderIDs="";$issueIDs="";$transIDs="";
	foreach($sql_result as $row)
	{
		$orderIDs.=$row[csf('buyer_order_id')].',';
		$issueIDs.=$row[csf('issue_id')].',';
		$transIDs.=$row[csf('trans_id')].',';
	}
	 if($basis==3)
	 {
		$transID=0;
	 }
	 else
	 {
	 	
		$transID=chop($transIDs,",");
	 }
 	$sql_trans=sql_select("select b.id,a.issue_number,b.cone_per_bag from inv_issue_master a,inv_transaction b where b.id in ($transID) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0");
	//echo "select b.id,a.issue_number,b.cone_per_bag from inv_issue_master a,inv_transaction b where b.id in ($transID) and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$challan_issue_arr=array();
	foreach($sql_trans as $row)
	{
		$challan_issue_arr[$row[csf('id')]]['issue_number']=$row[csf('issue_number')];
		$challan_issue_arr[$row[csf('id')]]['cone_per_bag']=$row[csf('cone_per_bag')];
	}
	
	 if($basis==3)
	 {	
		
		$buyer_poIDs=chop($gate_orderIDs,",");
		//echo $issue_ids.'ff';
		$issuesIDs=$issue_ids;
		$issuesIDs=chop($issuesIDs,",");
	 }
	else
	{
		$buyer_poIDs=chop($orderIDs,",");
		$issuesIDs=$issueIDs;
		$issuesIDs=chop($issuesIDs,",");
	}
	
	
	
	$po_job_sql= sql_select("select a.id,b.buyer_name,a.job_no_mst,b.company_name from wo_po_break_down a, wo_po_details_master b where a.id in($buyer_poIDs) and a.job_no_mst=b.job_no");
	
	foreach($po_job_sql as $row)
	{
		$po_job_arr[$row[csf('id')]][$row[csf('company_name')]]['buyer_name']=$row[csf('buyer_name')];
		$po_job_arr[$row[csf('id')]][$row[csf('company_name')]]['job_no']=$row[csf('job_no_mst')];
	}
  	$buyer_remarks_library=return_library_array( "select id, remark from lib_buyer", "id", "remark"  );
  	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$batch_arr = return_library_array("select id, batch_no from pro_batch_create_mst","id","batch_no");
		if($basis==4)
		{
				$batch_sql=sql_select("select mst_id,trans_id, batch_id, prod_id from inv_finish_fabric_issue_dtls where mst_id in($issuesIDs)");
		}
		else if($basis==3)
		{
				$batch_sql=sql_select("select a.batch_no as batch_id,b.trans_id from inv_grey_fabric_issue_dtls b,inv_issue_master a where a.id=b.mst_id and b.mst_id in($issuesIDs)");
				//echo "select a.batch_no as batch_id,b.trans_id from inv_grey_fabric_issue_dtls b,inv_issue_master a where a.id=b.mst_id and b.mst_id in($issuesIDs)";
		}
		else
		{
			$batch_sql=sql_select("select mst_id,trans_id, batch_id from inv_finish_fabric_issue_dtls where mst_id in($issuesIDs)");
		}
	
	
	//echo "select mst_id, batch_id from inv_finish_fabric_issue_dtls where mst_id in($issuesIDs)";
	$color_arr=return_library_array( "select id, color_name from lib_color where status_active=1",'id','color_name');
	$product_arr=return_library_array( "select id, color from product_details_master where status_active=1",'id','color');
	foreach($batch_sql as $row)
	{
		if($basis==4 || $basis==3)
		{
			if($basis==4)
			{
			 	$batchNo_arr[$row[csf('trans_id')]]['prod_id']=$color_arr[$product_arr[$row[csf('prod_id')]]];
			}
			$batchNo_arr[$row[csf('trans_id')]]['batch_id']=$row[csf('batch_id')];
			
		}
		else
		{
			$batchNo_arr[$row[csf('mst_id')]]['batch_id']=$row[csf('batch_id')];
		}
	}
	 $grey_issue_sql=sql_select("select a.mst_id,a.booking_no,count(a.barcode_no) as no_of_roll,b.trans_id from pro_roll_details a, inv_grey_fabric_issue_dtls b where a.dtls_id=b.id and a.entry_form=61 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.mst_id in($issuesIDs) and is_returned!=1 group by a.mst_id,a.booking_no,b.trans_id");
	// echo "select a.mst_id,a.booking_no,count(a.barcode_no) as no_of_roll,b.trans_id,prod_id from pro_roll_details a, inv_grey_fabric_issue_dtls b where a.dtls_id=b.id and a.entry_form=61 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.mst_id in($issuesIDs) and is_returned!=1 group by a.mst_id,a.booking_no,b.trans_id,prod_id";
	// echo "<pre>";
	// print_r($batchNo_arr);
	foreach($grey_issue_sql as $row)
	{
		$grey_issue_data_arr[$row[csf('mst_id')]]['program_no']=$row[csf('booking_no')];
		$grey_issue_data_arr[$row[csf('mst_id')]]['no_of_roll']=$row[csf('no_of_roll')];
		$grey_issue_data_arr2[$row[csf('trans_id')]]['program_no'].=$row[csf('booking_no')].',';
	}
	$tot_qty=0; $tot_amount=0; $tot_amount=0; $noOfCarton=0;
	$tot_roll=0;
	$p=0;
	foreach($sql_result as $row)
	{
		if ($i%2==0)  
			$bgcolor="#E9F3FF";
		else
			$bgcolor="#FFFFFF";
			
			$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
			$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
			//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
			$uom_check[$row[csf('uom')]]=$row[csf('uom')];
			if($basis==4 || $basis==3)
			{
				$challan_no=$challan_issue_arr[$row[csf('trans_id')]]['issue_number'];
				$batch_no=$batch_arr[$batchNo_arr[$row[csf('issue_id')]]['batch_id']];
				$color=$batchNo_arr[$row[csf('trans_id')]]['prod_id'];
				if($basis==3)
				{
					//$batch_no=$batchNo_arr[$row[csf('trans_id')]]['batch_id'];
					$trans_id=array_unique(explode(",",$row[csf('id')]));
					$batch_no='';
					foreach($trans_id as $tid)
					{
						//echo $tid.'fd';
						if($grey_issue_data_arr2[$tid]['program_no']!='')
						{
							$batch_no=$grey_issue_data_arr2[$tid]['program_no'];
						}
					}
					$batch_no=rtrim($batch_no,',');
					$batch_no=implode(",",array_unique(explode(",",$batch_no)));
					//echo $row[csf('id')].'d';
					$challan_no=$row[csf('issue_number')];
					$row[csf('buyer_order_id')]=$gate_pass_arr[$row[csf('item_description')]]['po_id'];
					$no_of_bags=$gate_pass_arr[$row[csf('item_description')]]['no_of_bags'];
					$row[csf('remarks')]=$gate_pass_arr[$row[csf('item_description')]]['remarks'];
					$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
					$order_array[$row[csf('id')]]['job_no']=$row[csf('job_no')];
		
					//echo $no_of_bags.'='.$row[csf('item_description')].',';
				}
				else
				{
					$batch_no=$batch_arr[$batchNo_arr[$row[csf('trans_id')]]['batch_id']];
				}
				
			}
			else
			{
				$challan_no=$row[csf('challan_no')];
				$batch_no=$batch_arr[$batchNo_arr[$row[csf('issue_id')]]['batch_id']];
			}
			
			?>
			<tr bgcolor="<? echo $bgcolor; ?>">
                <td><? echo $i; ?></td>
                <?php /*?><td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
                <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td><?php */?>
                <td><?  echo $challan_no; ?></td> 
                <?
                if($basis==4)
			 	{
			 		?> <td><?  echo $buyer_library[$po_job_arr[$row[csf('buyer_order_id')]][$row[csf('company_id')]]['buyer_name']]; ?></td> <?
			 	}else{
			 		?> <td><?  echo $buyer_remarks_library[$po_job_arr[$row[csf('buyer_order_id')]][$row[csf('company_id')]]['buyer_name']]; ?></td><?
			 	}
                ?>
                <td><? echo $batch_no;//if($basis==4){echo $batch_arr[$batchNo_arr[$row[csf('issue_id')]]['batch_id']];}else{echo $grey_issue_data_arr[$row[csf('issue_id')]]['program_no'];} ?></td>
                <?
                if($basis==4)
			 	{
			 		?> <td><?  echo $color; ?></td> <?
			 	}
                ?>
                <td><?  echo $po_job_arr[$row[csf('buyer_order_id')]][$row[csf('company_id')]]['job_no']; ?></td>
                <td><?  echo $row[csf('item_description')]; ?></td>
                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
                <td align="right"><? echo number_format($row[csf('quantity')],2,'.',''); ?></td>   
                <?  if($basis==12)             
	                {
	                	?>
	                	<td align="right"><? echo $shipmode_cartoon[$p][csf("total_carton_qnty")]; ?></td>
	                	<?
	                }
	                else
	                {
		                ?>
		                <td align="right"><? 
						if($basis==4){
						echo $no_of_rolls[$p][csf("no_roll")]; $tot_roll +=$no_of_rolls[$p][csf("no_roll")];
						} 
						else if($basis==3){
						echo $no_of_bags; //$tot_roll +=$no_of_bags;
						} 
						else{
						echo $grey_issue_data_arr[$row[csf('issue_id')]]['no_of_roll']; $tot_roll +=$grey_issue_data_arr[$row[csf('issue_id')]]['no_of_roll'];
						} ?>
						
						</td>  
		                <?
	                }
                ?>
                
                </td>
                <?
				if($show_item==1)
				{
				?>
                <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
                <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
                <?
				}
				?>
                <td><? echo $row[csf('remarks')]; ?></td>
			</tr>
		<?php
		
		$noOfCarton+=$shipmode_cartoon[$p][csf("total_carton_qnty")];
    	$i++;
    	$p++;
		
		$tot_qty+=$row[csf('quantity')];		
		$tot_amount+=$row[csf('amount')];
		//$tot_bags+=$row[csf('no_of_bags')];
		$tot_cons+=$challan_issue_arr[$row[csf('trans_id')]]['cone_per_bag'];
    }
	//$tot_check=array();
	if(count($uom_check)==1)
	{
	?>
    <tfoot bgcolor="#CCCCCC">
        <tr>
    	<?
        if($basis==4)
	 	{
	 		?>  <td colspan="8" align="right"> <b> Total</b></td> <?
	 	}else{
	 		?> <td colspan="7" align="right"> <b> Total</b></td><?
	 	}
        ?>
       
        <td align="right"><b><? echo number_format($tot_qty,2);?></b></td>
         <?
		if($show_item==1)
		{
			if($basis==12)
			{
			?>
				<td align="right"><b><? echo $noOfCarton;?></b></td> 
            <?   
			}
			else
			{
			?>
				 <td align="right"><b><? echo $tot_roll;?></b></td> 
            <?
			} 
		?>         
        <?
		}
		else
		{
			if($basis==12)
			{
			?>
				<td align="right"><b><? echo $noOfCarton;?></b></td> 
        	<?
			}
			else
			{
				?>
                <td align="right"><b><? echo $tot_roll;?></b></td> 
                <?
			}
		}
		?>
       <!-- <td></td>
        <td></td>-->
        <td colspan="<? echo 4+$colspan2;?>"></td>
        </tr>
	</tfoot>
    <?
	}
	 $width_sign=$width.'px';
	?>
    </table>
    <? }
    ?>


	</div>
	<div>
		<? echo signature_table(114, $data[0], $width_sign,$template_id); ?>
	</div> 
	<script type="text/javascript" src="../../js/jquery.js"></script>
		<!--<script type="text/javascript" src="../../js/jquerybarcode.js"></script>-->
	<script type="text/javascript" src="../../js/jquery.qrcode.min.js"></script>
	<script>
	var main_value='<? echo $data[1]; ?>';
	//alert(main_value);
		$('#qrcode').qrcode(main_value);
	</script>

		
		
		
		<script>
		/*function generateBarcode( valuess ){
			
				var value = valuess;//$("#barcodeValue").val();
			// alert(value)
				var btype = 'code39';//$("input[name=btype]:checked").val();
				var renderer ='bmp';// $("input[name=renderer]:checked").val();
				
				var settings = {
				output:renderer,
				bgColor: '#FFFFFF',
				color: '#000000',
				barWidth: 1,
				barHeight: 30,
				moduleSize:5,
				posX: 10,
				posY: 20,
				addQuietZone: 1
				};
				$("#barcode_img_id").html('11');
				value = {code:value, rect: false};
				
				$("#barcode_img_id").show().barcode(value, btype, settings);
			} */
		<?php /*?> generateBarcode('<? echo $data[1]; ?>');<?php */?>
		</script>
	<?
	exit();
}

if ($action=="get_out_entry_print8_fashion")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[5];
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");


	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,vhicle_number,com_location_id,do_no,mobile_no from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 ";
	//echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	
	if($within_group==2)
	{
		//echo $dataArray[0][csf('sent_to')].'aaaaaaaaaaaaa';
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	if($show_item==1)
	{
		$width=900;
		$colspan=5;
	}
	else
	{
		$width=900;
		$colspan=5;
		$colspan2=2;
	}
	/*$copy_no=array(1,2,3); //for Dynamic Copy here 
	foreach($copy_no as $cid)
	{*/
		//echo $pid.'<br>';
	$com_dtls = fnc_company_location_address($company, $location, 2);
	?>
	<div style="width:<? echo $width;?>px;" align="center">
    <table width="<? echo $width;?>px" cellspacing="0" align="center" border="0">
        <tr>
          <tr>
            <td   align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="70" width="200"></td>
            <td valign="top" colspan="4" align="center" style="margin-left:-20px;"><strong style="font-size:xx-large;" ><? echo $com_dtls[0]; ?></strong>
            	<br>
            	<?
				echo $com_dtls[1];?>
				<br>
               	&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
            </td>
            <td >
            	 <div  style="float:left; height:3%; width:3%;" id="qrcode"></div>
            </td>          
        </tr>
        <tr>
        	<td style="display:none" colspan="6" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
        </tr>
        <tr>
            <td colspan="5" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
            <td colspan="1"><? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?></td>
        </tr>
        <tr>
            <td width="150"><strong>System ID:</strong></td> <td width="180px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
            <td width="100"><strong>Basis:</strong></td><td ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
            <td width="100"><strong>D.O No:</strong></td><td width="150px" ><? echo $dataArray[0][csf('do_no')];//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
        </tr>
         <tr>
            
            <td><strong>Department:</strong></td> <td ><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
            <td><strong>Section:</strong></td><td  ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
            <td><strong>Sent By:</strong></td> <td ><? echo $dataArray[0][csf('sent_by')]; ?></td>
        </tr>
        <tr>
            <td><strong>Sent To:</strong></td><td  style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
            <td><strong>Attention:</strong></td><td ><? echo $dataArray[0][csf('attention')]; ?></td>
            <td><strong>Date:</strong></td><td ><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
        </tr>
        <tr>
          
           <?
			if($within_group==2)
			{
				$send_to_company_id=$dataArray[0][csf('sent_to')];
				$nameArrays = sql_select("select address_1,web_site,email,country_id from lib_supplier where supplier_name='$send_to_company_id'");
			}
			else
			{
				//$send_to_company_id=$dataArray[0][csf('sent_to')];
				//$nameArrays = sql_select("select address_1,web_site,email,country_id from lib_supplier where id=$supp_add");
			}
	          		$supp_add = $send_to_company_id;
					foreach ($nameArrays as $result) {
						$address = "";
						if ($result != "") $address = $result[csf('address_1')];//.'<br>'.$country_arr[$result['country_id']].'<br>'.$result['email'].'<br>'.$result['web_site']
					}
					unset($nameArrays);
	        ?>
          
            <td><strong>Address:</strong></td><td ><? if($within_group==1){echo $location_library[$dataArray[0][csf('com_location_id')]];}else{echo $address;}  ?></td>
            <td><strong>Returnable :</strong></td><td ><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
            <td><strong>Time:</strong></td><td ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>

        </tr>
         <tr>
            <td><strong>Delivery As:</strong></td><td ><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
            <td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
            <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
            
        </tr>
        <tr>
           <td><strong>Est. Return Date 	 :</strong></td><td><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
           <?php /*?><td><strong>Bar Code:</strong></td><td  colspan="3" id="barcode_img_id_<? echo $cid; ?>"></td> <?php */?>
           <td><strong>To Location:</strong></td><td><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
           <td><strong>Mobile No:</strong></td><td><? echo $dataArray[0][csf('mobile_no')]; ?></td>
        </tr>
        <tr>
        	<td><strong>Vehicle No:</strong></td><td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
			<td><strong>Bar Code:</strong></td><td  colspan="3" id="barcode_img_id"></td> 
        </tr>
       
    </table>
    <br>
    <table align="center" cellspacing="0" width="<? echo $width;?>px;"  border="1" rules="all" class="rpt_table" >
        <thead bgcolor="#dddddd" align="center">
            <th width="30">SL</th>
            <th width="150" align="center">Challan No</th>
            <th width="100" align="center">Item Category</th>
            <th width="300" align="center">Item Description</th>
            <th width="50" align="center">UOM</th>
            <th width="80" align="center">Quantity</th>
            <?
            if($show_item==1)
			{
			?>
            <th width="50" align="center">Rate</th> 
            <th width="80" align="center">Amount </th>
            <?
			}
			?>
            <th width="100" align="center">No of Bag/Roll/Ctn</th>
            <!--<th width="100" align="center">Style</th>
            <th width="80" align="center">Buyer Order </th>-->
            <th align="center">Remarks</th>
        </thead>
	<?
    $i=1;
	$gate_id=$dataArray[0][csf('id')];
	if($data[4]==21) //yarn recv return basis
	{
			$sql_dtls= "select b.no_of_bags,b.id as mst_id,b.challan_no,b.item_category_id,b.sample_id, b.item_description,b.uom_qty, b.quantity, b.uom, b.rate, b.amount,b.buyer_order_id,b.buyer_order, b.remarks 
 from inv_gate_pass_mst a,inv_gate_pass_dtls b where a.id=b.mst_id and  b.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
 
			$sql_yarn_rcv_return=sql_select($sql_dtls);
			$chalIds="";
			foreach($sql_yarn_rcv_return as $row)
			{
				$chalIds.=$row[csf('challan_no')].',';
			}
			$chalId=chop($chalIds,',');
			$inv_issue_qry=sql_select("select id,issue_number from inv_issue_master where id in($chalId) and status_active=1 and is_deleted=0");
			foreach($inv_issue_qry as $row)
			{
				$challan_no_arr[$row[csf('id')]]['issue_number']=$row[csf('issue_number')];
			}
	}
	else
	{
		$sql_dtls= "select a.challan_no as single_challan_no,b.no_of_bags,b.id as mst_id,b.challan_no,b.item_category_id,b.sample_id, b.item_description,b.uom_qty, b.quantity, b.uom, b.rate, b.amount,b.buyer_order_id,b.buyer_order, b.remarks 
 from inv_gate_pass_mst a,inv_gate_pass_dtls b where a.id=b.mst_id and  b.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";

	}
	//echo $sql_dtls;
	$uom_check=array();
	$sql_result=sql_select($sql_dtls);
	$tot_qty=0;$tot_amount=0;
	foreach($sql_result as $row)
	{
		if ($i%2==0)  
			$bgcolor="#E9F3FF";
		else
			$bgcolor="#FFFFFF";
			
			$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
			$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
			//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
			$uom_check[$row[csf('uom')]]=$row[csf('uom')];
			?>
			<tr bgcolor="<? echo $bgcolor; ?>">
                <td><? echo $i; ?></td>

                <td><? 
				
				if($data[4]==21) //yarn recv return basis
				{
				 echo $challan_no_arr[$row[csf('challan_no')]]['issue_number']; 
				}
				else
				{
					echo $row[csf('single_challan_no')];
				}
				 
				 
				 ?></td>
				<td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
                <td><?  echo $row[csf('item_description')]; ?></td>
                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
                <td align="right"><? echo $row[csf('quantity')]; ?></td>
                 <?
				if($show_item==1)
				{
				?>
                <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
                <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
                <?
				}
				?>
                <td align="right"><? echo  $row[csf('no_of_bags')]; ?></td>
               <?php /*?> <td><? echo $style_ref_no; ?></td>
                <td><? echo $row[csf('buyer_order')]; ?></td><?php */?>
                <td><? echo $row[csf('remarks')]; ?></td>
			</tr>
		<?php
    	$i++;
		
		$tot_qty+=$row[csf('quantity')];
		$tot_amount+=$row[csf('amount')];
    }
	//$tot_check=array();
	if(count($uom_check)==1)
	{
	?>
    <tfoot bgcolor="#CCCCCC">
        <tr>
        <td colspan="<? echo $colspan;?>" align="right"> <b> Total</b></td>
        <td align="right"><b><? echo number_format($tot_qty,2);?></b> </td>
          <?
		if($show_item==1)
		{
		?>
        <td> </td>
        <td align="right"><b> <? echo number_format($tot_amount,2);?></b> </td>
        <?
			}
		?>
        <td colspan="<? echo 4+$colspan2;?>"></td>

        </tr>
	</tfoot>
    <?
	}
	$width_sign=$width.'px';
	?>
    </table>
	</div>
	<div style="margin-top:-100px">
		<? echo signature_table(114, $data[0], $width_sign,$template_id); ?>
		<script type="text/javascript" src="../../js/jquery.js"></script>
		<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
		<script type="text/javascript" src="../../js/jquery.qrcode.min.js"></script>
		<script>
		var main_value='<? echo $data[1]; ?>';
		//alert(main_value);
			$('#qrcode').qrcode(main_value);
		</script>
		<script>
			function generateBarcode( valuess )
			{
				var value = valuess;//$("#barcodeValue").val();
				// alert(value)
				var btype = 'code39';//$("input[name=btype]:checked").val();
				var renderer ='bmp';// $("input[name=renderer]:checked").val();
				
				var settings = {
				output:renderer,
				bgColor: '#FFFFFF',
				color: '#000000',
				barWidth: 1,
				barHeight: 30,
				moduleSize:5,
				posX: 10,
				posY: 20,
				addQuietZone: 1
				};
				$("#barcode_img_id").html('11');
				value = {code:value, rect: false};
				
				$("#barcode_img_id").show().barcode(value, btype, settings);
			} 
			generateBarcode('<? echo $data[1]; ?>');
		</script>
	<?
	exit();
	?>
	
	</div>
	<p style="page-break-after:always;"></p>
	<?
	//}
	
	die;
	
	// Down part not used now//this is unneccessary
	?>
	<div style="width:1150px;" align="center">
		<table width="1150" cellspacing="0" align="center" border="0">
			<tr>
			<tr>
				<td  align="center"><img src="../../<? echo $image_location; ?>" height="50" width="60"></td>
				<td colspan="7" align="center"  style="font-size:xx-large;"><strong style="margin-left:180px" ><? echo $company_library[$data[0]]; ?><span style="font-size:x-large; margin-left:200px !important;">2<sup>nd</sup> Copy</span></strong>
				<div style="float:right;width:34%;margin-top:10px; text-align:right">
					&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
				</div>
				</td>
			
			
			
			</tr>
			<tr class="form_caption">
				<td colspan="8" align="center">
					<?
					$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
						//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
						foreach ($nameArray as $result)
						{ 
							echo $result[csf('plot_no')]; 
							echo $result[csf('level_no')];
							echo $result[csf('road_no')];
							echo $result[csf('block_no')];
							echo $result[csf('city')];
							echo $result[csf('zip_code')];
							echo $result[csf('province')].',';
							echo $country_arr[$result[csf('country_id')]].'<br>'; 
							echo $result[csf('email')]; 
							echo $result[csf('website')];
						}
					?> 
					<div style="width:34%; text-align:center">
					&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
				</div>
				</td>
			</tr>
			<tr>
				<td style="display:none" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
			</tr>
			<tr>
				<td colspan="8" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
			</tr>
			<tr>
				<td width="160"><strong>System ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
				<td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
				<td width="125"><strong>Challan/System No:</strong></td><td width="175px" colspan="2"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
			</tr>
			<tr>
				
				<td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
				<td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
				<td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
			</tr>
			<tr>
				<td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
				<td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
				<td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
			</tr>
			<tr>
			
				<td><strong>Out-Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
				<td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
				<td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
			</tr>
			<tr>
				<td><strong>Est. Return Date 	 :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
				<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
				<td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
				
			</tr>
			<tr>
			<td><strong>Bar Code:</strong></td><td  colspan="3" id="barcode_img_id"></td> 
			<td><strong>To Location :</strong></td><td><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]]; else echo $dataArray[0][csf('location_name')];?></td>
			</tr>
		</table>
		<br>
		<table align="center" cellspacing="0" width="1150"  border="1" rules="all" class="rpt_table" >
			<thead bgcolor="#dddddd" align="center">
				<th width="30">SL</th>
				<th width="100" align="center">Item Category</th>
				<th width="100" align="center">Sample</th>
				<th width="200" align="center">Item Description</th>
				<th width="50" align="center">UOM</th>
				<th width="80" align="center">Quantity</th>
				<th width="50" align="center">Rate</th> 
				<th width="80" align="center">Amount </th>
				<th width="100" align="center">Buyer</th>
				<th width="100" align="center">Style</th>
				<th width="80" align="center">Buyer Order </th>
				<th align="center">Remarks</th>
			</thead>
		<?
		$i=1;
		$gate_id=$dataArray[0][csf('id')];
		$sql_dtls= " select id,item_category_id,sample_id, item_description,uom_qty, quantity, uom, rate, amount,buyer_order_id,buyer_order, remarks from  inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 ";
		//echo $sql_dtls;
		$uom_check=array();
		$sql_result=sql_select($sql_dtls);
		$tot_qty=0;$tot_amount=0;
		foreach($sql_result as $row)
		{
			if ($i%2==0)  
				$bgcolor="#E9F3FF";
			else
				$bgcolor="#FFFFFF";
				
				$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
				$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
				//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
				$uom_check[$row[csf('uom')]]=$row[csf('uom')];
				?>
				<tr bgcolor="<? echo $bgcolor; ?>">
					<td><? echo $i; ?></td>
					<td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
					<td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
					<td><?  echo $row[csf('item_description')]; ?></td>
					<td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
					<td align="right"><? echo $row[csf('quantity')]; ?></td>
					<td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
					<td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
					<td><? echo $buyer_library[$buyer]; ?></td>
					<td><? echo $style_ref_no; ?></td>
					<td><? echo $row[csf('buyer_order')]; ?></td>
					<td><? echo $row[csf('remarks')]; ?></td>
				</tr>
			<?php
			$i++;
			
			$tot_qty+=$row[csf('quantity')];
			$tot_amount+=$row[csf('amount')];
		}
		//$tot_check=array();
		if(count($uom_check)==1)
		{
		?>
		<tfoot bgcolor="#CCCCCC">
			<tr>
			<td colspan="5" align="right"> <b> Total</b></td>
			<td align="right"><b><? echo number_format($tot_qty,2);?></b> </td>
			<td> </td>
			<td align="right"><b> <? echo number_format($tot_amount,2);?></b> </td>
			<td colspan="4"></td>
			</tr>
		</tfoot>
		<?
		}
		?>
		</table>
	</div>
	<div>
		<? echo signature_table(114, $data[0], "1150px",$template_id); ?>
	</div> 
	<p style="page-break-after:always;"></p>
	<div style="width:1150px;" align="center">
		<table width="1150" cellspacing="0" align="center" border="0">
			<tr>
			<tr>
				<td  align="center"><img src="../../<? echo $image_location; ?>" height="50" width="60"></td>
				<td colspan="7" align="center"  style="font-size:xx-large;"><strong style="margin-left:180px" ><? echo $company_library[$data[0]]; ?><span style="font-size:x-large; margin-left:200px !important;">3<sup>rd</sup> Copy</span></strong>
				<div style="float:right;width:34%; margin-top:10px; text-align:right">
					&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
				</div>
				</td>
			
			
			
			</tr>
			<tr class="form_caption">
				<td colspan="8" align="center">
					<?
					$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
						//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
						foreach ($nameArray as $result)
						{ 
							echo $result[csf('plot_no')]; 
							echo $result[csf('level_no')];
							echo $result[csf('road_no')];
							echo $result[csf('block_no')];
							echo $result[csf('city')];
							echo $result[csf('zip_code')];
							echo $result[csf('province')].',';
							echo $country_arr[$result[csf('country_id')]].'<br>'; 
							echo $result[csf('email')]; 
							echo $result[csf('website')];
						}
					?> 
					<div style="width:34%; text-align:center">
					&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
				</div>
				</td>
			</tr>
			<tr>
				<td style="display:none" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
			</tr>
			<tr>
				<td colspan="8" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
			</tr>
			<tr>
				<td width="160"><strong>Gate Pass ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
				<td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
				<td width="125"><strong>Challan/System No:</strong></td><td width="175px" colspan="2"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
			</tr>
			<tr>
				
				<td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
				<td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
				<td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
			</tr>
			<tr>
				<td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
				<td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
				<td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
			</tr>
			<tr>
			
				<td><strong>Out-Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
				<td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
				<td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
			</tr>
			<tr>
				<td><strong>Est. Return Date 	 :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
				<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
				<td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
				
			</tr>
			<tr>
			<td><strong>Bar Code:</strong></td><td  colspan="3" id="barcode_img_id"></td> 
			<td><strong>To Location :</strong></td><td><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_id')]; ?></td>
			</tr>
		</table>
		<br>
		<table align="center" cellspacing="0" width="1150"  border="1" rules="all" class="rpt_table" >
			<thead bgcolor="#dddddd" align="center">
				<th width="30">SL</th>
				<th width="100" align="center">Item Category</th>
				<th width="100" align="center">Sample</th>
				<th width="200" align="center">Item Description</th>
				<th width="50" align="center">UOM</th>
				<th width="80" align="center">Quantity</th>
				<th width="50" align="center">Rate</th> 
				<th width="80" align="center">Amount </th>
				<th width="100" align="center">Buyer</th>
				<th width="100" align="center">Style</th>
				<th width="80" align="center">Buyer Order </th>
				<th align="center">Remarks</th>
			</thead>
	<?
		$i=1;
		$gate_id=$dataArray[0][csf('id')];
		$sql_dtls= " select id,item_category_id,sample_id, item_description,uom_qty, quantity, uom, rate, amount,buyer_order_id,buyer_order, remarks from  inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 ";
		//echo $sql_dtls;
		$uom_check=array();
		$sql_result=sql_select($sql_dtls);
		$tot_qty=0;$tot_amount=0;
		foreach($sql_result as $row)
		{
			if ($i%2==0)  
				$bgcolor="#E9F3FF";
			else
				$bgcolor="#FFFFFF";
				
				$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
				$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
				//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
				$uom_check[$row[csf('uom')]]=$row[csf('uom')];
				?>
				<tr bgcolor="<? echo $bgcolor; ?>">
					<td><? echo $i; ?></td>
					<td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
					<td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
					<td><?  echo $row[csf('item_description')]; ?></td>
					<td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
					<td align="right"><? echo $row[csf('quantity')]; ?></td>
					<td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
					<td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
					<td><? echo $buyer_library[$buyer]; ?></td>
					<td><? echo $style_ref_no; ?></td>
					<td><? echo $row[csf('buyer_order')]; ?></td>
					<td><? echo $row[csf('remarks')]; ?></td>
				</tr>
			<?php
			$i++;
			
			$tot_qty+=$row[csf('quantity')];
			$tot_amount+=$row[csf('amount')];
		}
		//$tot_check=array();
		if(count($uom_check)==1)
		{
		?>
		<tfoot bgcolor="#CCCCCC">
			<tr>
			<td colspan="5" align="right"> <b> Total</b></td>
			<td align="right"><b><? echo number_format($tot_qty,2);?></b> </td>
			<td> </td>
			<td align="right"><b> <? echo number_format($tot_amount,2);?></b> </td>
			<td colspan="4"></td>
			</tr>
		</tfoot>
		<?
		}
		?>
		</table>
	</div>
	<div>
		<? echo signature_table(114, $data[0], "1150px",$template_id); ?>
	</div>  
	<script type="text/javascript" src="../../js/jquery.js"></script>
      <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
     <script>

	function generateBarcode( valuess ){
		   
			var value = valuess;//$("#barcodeValue").val();
		 // alert(value)
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='bmp';// $("input[name=renderer]:checked").val();
			 
			var settings = {
			  output:renderer,
			  bgColor: '#FFFFFF',
			  color: '#000000',
			  barWidth: 1,
			  barHeight: 30,
			  moduleSize:5,
			  posX: 10,
			  posY: 20,
			  addQuietZone: 1
			};
			$("#barcode_img_id").html('11');
			 value = {code:value, rect: false};
			
			$("#barcode_img_id").show().barcode(value, btype, settings);
		} 
	 generateBarcode('<? echo $data[1]; ?>');
	 </script>
	<?
	exit();
}
if($action=="print_to_html_report11")
{
	
	extract($_REQUEST);
	$data=explode('*',$data);
	//print_r ($data);
	$show_item=$data[2];
	$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");

	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");
    $color_name_arr = return_library_array("select id, color_name from lib_color", 'id', 'color_name');

	$store_arr = return_library_array("select id, store_name from lib_store_location", 'id', 'store_name');

	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to,vhicle_number, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name, com_location_id, remarks, security_lock_no from inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 "; 
	//echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
 	$sent_to=$dataArray[0][csf('sent_to')];
	$shipmode_cartoon=sql_select("select  b.total_carton_qnty,b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no'") ;

	$shipmodes=sql_select("select  b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no' and (b.shiping_mode is not null or b.shiping_mode!=0) ") ;
	/*echo "<pre>";
	print_r($shipmode_cartoon);die;*/
	$ex_factory_del_data=array();
	if($basis==12)
	{
		 $sql_mst_ex_factory_del=sql_select("select a.sys_number,a.lock_no, a.dl_no,a.mobile_no, a.do_no, a.gp_no,a.remarks,a.truck_no,a.buyer_id,b.po_break_down_id from  pro_ex_factory_delivery_mst a,pro_ex_factory_mst b where a.sys_number='$challan_no' and a.entry_form!=85 and a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0");
	}
	$po_break_down_id="";
	foreach($sql_mst_ex_factory_del as $row)
	{
		$po_break_down_id.=$row[csf('po_break_down_id')].',';
		$ex_factory_del_data[$row[csf('sys_number')]]['lock_no']=$row[csf('lock_no')];
		$ex_factory_del_data[$row[csf('sys_number')]]['dl_no']=$row[csf('dl_no')];
		$ex_factory_del_data[$row[csf('sys_number')]]['mobile_no']=$row[csf('mobile_no')];
		$ex_factory_del_data[$row[csf('sys_number')]]['remarks']=$row[csf('remarks')];
		$ex_factory_del_data[$row[csf('sys_number')]]['truck_no']=$row[csf('truck_no')];
		
	}
	$poBreakDownId =chop($po_break_down_id,',');
	
	$res_breakDown = sql_select("select a.id,a.po_quantity,a.plan_cut, a.po_number,a.po_quantity,b.company_name, b.buyer_name, b.style_ref_no,b.gmts_item_id, b.order_uom, b.job_no,b.location_name,a.shipment_date   from wo_po_break_down a, wo_po_details_master b where a.job_no_mst=b.job_no and a.id in($poBreakDownId)"); 
	$break_down_data_arr=array();
 	foreach($res_breakDown as $row)
	{
		$break_down_data_arr[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$break_down_data_arr[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	if($basis==1)
	{ 
		if($within_group==1)
		{
			//$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
		else
		{
			//$send_to_company=$dataArray[0][csf('sent_to')];		
		}
	}
	
	if($within_group==2)
		{
			$send_to_company=$dataArray[0][csf('sent_to')];
		}
		else
		{
			$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	
	$country_arr = return_library_array("select id, country_name from lib_country", "id", "country_name");

	$width=1150;
	
	?>
    
	<style type="text/css">
		body{
			margin: 0 auto;
			padding:0;			
			background-size:912px 1056px;
            background-repeat: no-repeat;
		}

		.stlinfo{font-size: 22px; height: 70px; border: 2px solid black; text-align:center;}
		.stlinfobody{font-size: 22px; border: 2px solid black;}
	</style>
	<div style="width:<? echo $width+200;?>px;" align="center">
    <table width="<? echo $width+200;?>" cellspacing="0" align="center" border="0" style="font-size:22px;">
        
        <tr>
            <td  align="left"><img src="../../<? echo $image_location; ?>" height="70" width="200"></td>
            <td colspan="7" align="center"  style="font-size:xx-large; text-align:left;"><strong style="margin-left:100px" ><? echo $company_library[$data[0]]; ?></strong>
             <div style="float:right;width:34%; text-align:right">
               	&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
            </div>
            </td>
        </tr>
        <tr class="form_caption">
            <td colspan="8" align="center">
				<?
				$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
					//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
					foreach ($nameArray as $result)
					{ 
						echo $result[csf('city')];?>
						COUNTRY: <? echo $country_arr[$result[csf('country_id')]]; ?><br>
						Email : <? echo $result[csf('email')];?>
						Website : <? echo $result[csf('website')];
						/* echo $result[csf('plot_no')]; 
						echo $result[csf('level_no')];
						echo $result[csf('road_no')];
						echo $result[csf('block_no')];
						echo $result[csf('city')];
						echo $result[csf('zip_code')];
						echo $result[csf('province')].',';
						echo $country_arr[$result[csf('country_id')]].'<br>'; 
						echo $result[csf('email')]; 
						echo $result[csf('website')]; */
					}
                ?> 
                <div style="width:34%; text-align:center">
               	&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
            </div>
            </td>
        </tr>
        <tr>
        	<td style="display:none" colspan="6" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
        </tr>
        <tr>
		
            <td colspan="5" align="center" style="font-size:x-large; padding-bottom: 10px;"><strong><u>Gate Pass</u></strong></td>
			
        </tr>
 	</table>
 </div>
 <div style="width:<? echo $width+200;?>px;" align="center">
    <table width="<? echo $width+200;?>" cellspacing="0" align="center" border="0" style="font-size:22px;">       
        <tr>
            <td style="width:150px;;"><strong>System ID:</strong></td>
            <td style="width:245px; "><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
            <td width="120"><strong>Basis:</strong></td>
            <td width="245px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
            <td width="165"><strong>Challan/System No:</strong></td>
            <td width="155px"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
        </tr>
         <tr>
            <td><strong>Department:</strong></td> <td><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
            <td><strong>Section:</strong></td><td><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
            <td><strong>Sent By:</strong></td> <td><? echo $dataArray[0][csf('sent_by')]; ?></td>
        </tr>
        <tr>
        	<td><strong>Sent To:</strong></td><td width="175px" ><b><? echo $send_to_company; ?></b></td>
        	<td><strong>Attention:</strong></td><td><? echo $dataArray[0][csf('attention')]; ?></td>
            <td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
        </tr>
        <tr>
          <td><strong>Out-Time:</strong></td><td><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
           <td><strong>Returnable :</strong></td><td><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
           <td><strong>Delivery As:</strong></td><td><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
        </tr>
         <tr>
         	<td><strong>Est. Return Date :</strong></td><td><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td> 
         	<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
            <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
        </tr>
         <tr>
         	<td><strong>Bar Code:</strong></td><td  colspan="1" id="barcode_img_id"></td> 
            <td><strong>Vehicle Number:</strong></td><td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
            <td><strong>To Location :</strong></td><td><?  if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
        </tr>
		<tr>
            <td></td><td></td> 
            <td></td><td></td>
            <td><strong>Security Lock No:</strong></td><td><? echo $dataArray[0][csf('security_lock_no')]; ?></td> 
        </tr>
  
      <?php /*?>  <? if ($basis==12)
        {
        	?>
        	<tr>

       	 <td> <strong> Shipping Mode </strong></td>
       	 <td colspan="5" align="left"> <?  echo $shipment_mode[$shipmodes[0][csf("shiping_mode")]]; ?> </td>

       	 </tr>

	
       <? }?><?php */?>
        


    </table>
    <br>
    <table align="center" cellspacing="0" width="<? echo $width+200;?>"  border="1" rules="all" class="rpt_table" >
        <thead bgcolor="#dddddd" >
			<tr>
				<th width="20" class='stlinfo'>SL</th>
				<th width="45" class='stlinfo'>Req. No</th>
				<th width="50" class='stlinfo'>Lot No</th>
				<th width="65" class='stlinfo'>Yarn Type</th>
				<th width="210" class='stlinfo'>Item Details</th>
				<th width="65" class='stlinfo'>Dye. Color</th>
				<th width="100" class='stlinfo'>Supp.</th>
				<th width="60" class='stlinfo'>Issue Qty(kg)</th>
				<th width="60" class='stlinfo'>Rtnbl Qty(kg)</th>
				<th width="80" class='stlinfo'>Bag & Cone</th>
				<th width="80" class='stlinfo'>Store</th>
				<th width="100" class='stlinfo'>Buyer & Job</th>
				<th width="160" class='stlinfo'>Order & Style</th>
				<th class='stlinfo'>Inte. Ref & File</th>
			</tr>
		</thead>
		<?
			$gate_id=$dataArray[0][csf('id')];
			$sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags,b.issue_id from inv_gate_pass_dtls a,inv_gate_pass_mst b  where b.id=a.mst_id and a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 ";
			//echo $sql_dtls;
			$issue_id_all="";
			$sql_result=sql_select($sql_dtls);
			foreach($sql_result as $row)
			{
				$issue_id_all=$row[csf('issue_id')];
			}
			//echo $issue_id_all;

			$wopi_library = return_library_array("select id,pi_number from com_pi_master_details", "id", "pi_number");

			$cond = "";
			if ($issue_id_all != "") $cond .= " and c.id in('$issue_id_all')";

			$po_array = array();
			$job_array = array();
			$costing_sql = sql_select("select a.job_no, b.file_no,b.grouping,a.style_ref_no, a.buyer_name, b.id, b.po_number from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.company_name=$data[0]");
			foreach ($costing_sql as $row) {
				$po_array[$row[csf('id')]]['no'] = $row[csf('po_number')];
				$po_array[$row[csf('id')]]['job_no'] = $row[csf('job_no')];
				$po_array[$row[csf('id')]]['style_ref'] = $row[csf('style_ref_no')];
				$po_array[$row[csf('id')]]['buyer_name'] = $row[csf('buyer_name')];
				$po_array[$row[csf('id')]]['grouping'] = $row[csf('grouping')];
				$po_array[$row[csf('id')]]['file_no'] = $row[csf('file_no')];
				$job_array[$row[csf('job_no')]]['job'] = $row[csf('job_no')];
				$job_array[$row[csf('job_no')]]['buyer'] = $row[csf('buyer_name')];
			}
			unset($costing_sql);

			$job_no_array = array();
			$jobData = sql_select("select id, job_no, style_ref_no, within_group, buyer_id from fabric_sales_order_mst");
			foreach ($jobData as $row) {
				$job_no_array[$row[csf('id')]]['job_no'] = $row[csf('job_no')];
				$job_no_array[$row[csf('id')]]['style_ref'] = $row[csf('style_ref_no')];
				$job_no_array[$row[csf('id')]]['within_group'] = $row[csf('within_group')];
				$job_no_array[$row[csf('id')]]['buyer_id'] = $row[csf('buyer_id')];
			}
				//var_dump($po_array);
			$po_id_req_array = array();
			$is_sales_array = array();
			if ($db_type == 0) {
				$poID = " select c.requisition_no, a.is_sales, group_concat(distinct(a.po_id)) as poid from ppl_planning_entry_plan_dtls a, ppl_planning_info_entry_dtls b, ppl_yarn_requisition_entry c where b.id=a.dtls_id and b.id=c.knit_id group by c.requisition_no, a.is_sales ";
			} else {
				$poID = "select c.requisition_no, a.is_sales, LISTAGG(a.po_id, ',') WITHIN GROUP (ORDER BY a.po_id) as poid from ppl_planning_entry_plan_dtls a, ppl_planning_info_entry_dtls b, ppl_yarn_requisition_entry c where b.id=a.dtls_id and b.id=c.knit_id group by c.requisition_no, a.is_sales ";
			}
			$poID_sql_result = sql_select($poID);
			foreach ($poID_sql_result as $row) {
				$po_id_req_array[$row[csf('requisition_no')]] = $row[csf('poid')];
				$is_sales_array[$row[csf('requisition_no')]] = $row[csf('is_sales')];
			}
			unset($poID_sql_result);

	$i = 1;
	
	if ($db_type == 0) {
		$sql_result = sql_select("select a.id, a.lot,a.color, a.yarn_type, a.product_name_details, a.yarn_count_id,a.yarn_comp_percent1st,a.yarn_comp_type1st, a.detarmination_id, b.dyeing_color_id, b.id, b.requisition_no, b.cons_uom, b.cons_quantity, b.return_qnty as returnable_qnty, b.store_id, b.no_of_bags, b.cone_per_bag, b.weight_per_bag, b.weight_per_cone, c.issue_basis, c.booking_no, c.buyer_id, c.buyer_job_no, a.supplier_id, group_concat(d.po_breakdown_id) as po_id, sum(d.returnable_qnty) as returnable_qnty_pro from product_details_master a, inv_issue_master c, inv_transaction b left join order_wise_pro_details d on b.id=d.trans_id where c.id=b.mst_id and b.prod_id=a.id and b.transaction_type=2 and b.item_category=1 and c.entry_form=3 and b.status_active=1 and b.is_deleted=0 and c.id in($issue_id_all) group by a.id, a.lot,a.color,a.yarn_type, a.product_name_details, a.detarmination_id, a.supplier_id, b.id, b.dyeing_color_id, b.requisition_no, b.cons_uom, b.cons_quantity, b.return_qnty, b.store_id, b.no_of_bags, b.cone_per_bag, b.weight_per_bag, b.weight_per_cone, c.issue_basis, c.booking_no, c.buyer_id, c.buyer_job_no, a.yarn_count_id,a.yarn_comp_percent1st,a.yarn_comp_type1st");
	} else {
		$sql_result = sql_select("select a.id, a.lot,a.color,a.yarn_type, a.product_name_details, a.yarn_count_id,a.yarn_comp_percent1st,a.yarn_comp_type1st, a.detarmination_id, b.dyeing_color_id, b.id, b.requisition_no, b.cons_uom, b.cons_quantity, b.return_qnty as returnable_qnty, b.store_id, b.no_of_bags, b.cone_per_bag, b.weight_per_bag, b.weight_per_cone, c.issue_basis, c.booking_no, c.buyer_id, c.buyer_job_no, a.supplier_id, LISTAGG(d.po_breakdown_id, ',') WITHIN GROUP (ORDER BY d.po_breakdown_id) as po_id, sum(d.returnable_qnty) as returnable_qnty_pro from product_details_master a, inv_issue_master c, inv_transaction b left join order_wise_pro_details d on b.id=d.trans_id where c.id=b.mst_id and b.prod_id=a.id and b.transaction_type=2 and b.item_category=1 and c.entry_form=3 and b.status_active=1 and b.is_deleted=0 and c.id in($issue_id_all) group by a.id, a.lot,a.color, a.yarn_type, a.product_name_details, a.detarmination_id, a.supplier_id, b.id, b.dyeing_color_id, b.requisition_no, b.cons_uom, b.cons_quantity, b.return_qnty, b.store_id, b.no_of_bags, b.cone_per_bag, b.weight_per_bag, b.weight_per_cone, c.issue_basis, c.booking_no, c.buyer_id, c.buyer_job_no, a.yarn_count_id,a.yarn_comp_percent1st,a.yarn_comp_type1st");

	}

		$all_req_no = '';
		$all_prod_id = '';
		$order_qnty_val_sum=$order_amount_val_sum=$no_of_bags_val_sum=0;
		$tot_return_qty = $tot_bag = $tot_cone = $tot_w_bag = $tot_w_cone = 0;
		foreach ($sql_result as $row) {
			//if ($i % 2 == 0) $bgcolor = "#E9F3FF"; else $bgcolor = "#FFFFFF";
			if ($row[csf('requisition_no')] != '') {
				if ($all_req_no == '') $all_req_no = $row[csf('requisition_no')]; else $all_req_no .= ',' . $row[csf('requisition_no')];
				if ($all_prod_id == '') $all_prod_id = $row[csf('po_id')]; else $all_prod_id .= ',' . $row[csf('po_id')];
			}
			$order_qnty_val = $row[csf('cons_quantity')];
			$order_qnty_val_sum += $order_qnty_val;

			$order_amount_val = $row[csf('order_amount')];
			$order_amount_val_sum += $order_amount_val;

			$no_of_bags_val = $row[csf('no_of_bags')];
			$no_of_bags_val_sum += $no_of_bags_val;

			$po_id = explode(",", $row[csf('po_id')]);
			$po_no = '';
			$style_ref = '';
			$job_no = '';
			$buyer = '';
				//$data=explode('*',$data);
			$productdtls = $row[csf('product_name_details')];
			$productArr = explode(' ', $productdtls);

			$proddtls = '';
			if ($productArr[0] != '' && $productArr[1] != '' && $productArr[2] != '' && $productArr[3] != '' && $productArr[4] != '' && $productArr[5] != '') {
				$proddtls = $productArr[0] . ', ' . $productArr[1] . ' ' . $productArr[2] . '%, ' . $productArr[3] . ' ' . $productArr[4] . "%, " . $productArr[5] . ", " . $productArr[6];
			} else if ($productArr[0] != '' && $productArr[1] != '' && $productArr[2] != '' && $productArr[3] != '' && $productArr[4] != '') {
				$proddtls = $productArr[0] . ', ' . $productArr[1] . ' ' . $productArr[2] . ' %, ' . $productArr[3] . ', ' . $productArr[4];
			} else if ($productArr[0] != '' && $productArr[1] != '' && $productArr[2] != '' && $productArr[3] != '') {
				$proddtls = $productArr[0] . ', ' . $productArr[1] . ' ' . $productArr[2] . ' %, ' . $productArr[3];
			} else if ($productArr[0] != '' && $productArr[1] != '' && $productArr[2] != '') {
				$proddtls = $productArr[0] . ', ' . $productArr[1] . ' ' . $productArr[2] . ' %, ';
			} else if ($productArr[0] != '' && $productArr[1] != '') {
				$proddtls = $productArr[0] . ', ' . $productArr[1];
			} else if ($productArr[0] != '') {
				$proddtls = $productArr[0];
			} else {
				$proddtls = '';
			}

			$internal_ref = '';
			$file_no = '';
			if ($row[csf('issue_basis')] == 1 || $row[csf('issue_basis')] == 2) {
				foreach ($po_id as $val) {
					if ($po_no == '') $po_no = $po_array[$val]['no']; else $po_no .= ", " . $po_array[$val]['no'];
					if ($job_no == '') $job_no = $po_array[$val]['job_no'];
					if ($style_ref == '') $style_ref = $po_array[$val]['style_ref'];
					if ($buyer == '') $buyer_name = $po_array[$val]['buyer_name'];

					if ($internal_ref == '') $internal_ref = $po_array[$val]['grouping']; else $internal_ref .= "," . $po_array[$val]['grouping'];
					if ($file_no == '') $file_no = $po_array[$val]['file_no']; else $file_no .= "," . $po_array[$val]['file_no'];
				}
				$job_ref = array_unique(explode(",", rtrim($internal_ref, ", ")));
				$job_file = array_unique(explode(",", rtrim($file_no, ", ")));
				$ref_cond = '';
				foreach ($job_ref as $ref) {
						//$ref_cond.=", ".$ref;
					if ($ref_cond == '') $ref_cond = $ref; else $ref_cond .= ", " . $ref;
				}
				$file_con = '';
				foreach ($job_file as $file) {
					if ($file_con == '') $file_cond = $file; else $file_cond .= ", " . $file;
				}

				$buyer_job = '';
				if ($row[csf('issue_basis')] == 1) {
					if ($dataArray[0][csf('issue_purpose')] == 8) {
						$buyer_job = $buyer_arr[$row[csf('buyer_id')]];
					} else {
						$buyer_job = $buyer_arr[$job_array[$row[csf('buyer_job_no')]]['buyer']];
						if ($row[csf('buyer_job_no')] != "") {
							$buyer_job = $buyer_arr[$job_array[$row[csf('buyer_job_no')]]['buyer']] . ' & ' . $row[csf('buyer_job_no')];
						}
					}
				} else if ($row[csf('issue_basis')] == 2) {
					$buyer_job = '';
				}
			} else if ($row[csf('issue_basis')] == 3) {
					//$ex_data = array_unique(explode(",",$po_id_req_array[$row[csf('requisition_no')]]));
					//print_r($ex_data);

				if ($is_sales_array[$row[csf('requisition_no')]] == 1) {
					$buyer_job = '';
					foreach (array_unique($po_id) as $val) {
						if ($po_no == '') $po_no = $job_no_array[$val]['job_no']; else $po_no .= ", " . $job_no_array[$val]['job_no'];
						if ($style_ref == '') $style_ref = $job_no_array[$val]['style_ref'];

						if ($buyer_job == '') {
							if ($job_no_array[$val]['within_group'] == 1) {
								$buyer_job = $company_library[$job_no_array[$val]['buyer_id']];
							} else {
								$buyer_job = $buyer_arr[$job_no_array[$val]['buyer_id']];
							}
						}
					}
				} else {
					foreach ($po_id as $val) {
						if ($po_no == '') $po_no = $po_array[$val]['no']; else $po_no .= ", " . $po_array[$val]['no'];
						if ($job_no == '') $job_no = $po_array[$val]['job_no'];
						if ($style_ref == '') $style_ref = $po_array[$val]['style_ref'];
						if ($buyer == '') $buyer_name = $po_array[$val]['buyer_name'];

						if ($internal_ref == '') $internal_ref = $po_array[$val]['grouping']; else $internal_ref .= "," . $po_array[$val]['grouping'];
						if ($file_no == '') $file_no = $po_array[$val]['file_no']; else $file_no .= "," . $po_array[$val]['file_no'];
					}

					$job_ref = array_unique(explode(",", rtrim($internal_ref, ", ")));
					$job_file = array_unique(explode(",", rtrim($file_no, ", ")));

					$ref_cond = '';
					foreach ($job_ref as $ref) {
							//$ref_cond.=", ".$ref;
						if ($ref_cond == '') $ref_cond = $ref; else $ref_cond .= ", " . $ref;
					}

					$file_con = '';
					foreach ($job_file as $file) {
						if ($file_con == '') $file_cond = $file; else $file_cond .= ", " . $file;
					}
					if ($job_no != '') {
						$buyer_job = $buyer_arr[$buyer_name] . ' & ' . $job_no;
					} else {
						$buyer_job = $buyer_arr[$buyer_name];
					}
				}
			} else {
				foreach (array_unique($po_id) as $val) {
					if ($po_no == '') $po_no = $job_no_array[$val]['job_no']; else $po_no .= ", " . $job_no_array[$val]['job_no'];
					if ($style_ref == '') $style_ref = $job_no_array[$val]['style_ref'];
					if ($buyer_job == '') {
						if ($job_no_array[$val]['within_group'] == 1) {
							$buyer_job = $company_library[$job_no_array[$val]['buyer_id']];
						} else {
							$buyer_job = $buyer_arr[$job_no_array[$val]['buyer_id']];
						}
					}
				}
			}
			

			$no_bag_cone = "";
			$wt_bag_cone = "";
			if ($row[csf('cone_per_bag')] == "" || $row[csf('cone_per_bag')] == 0) $no_bag_cone = 'N:' . $no_of_bags_val; else $no_bag_cone = 'N:' . $no_of_bags_val . ' & ' . $row[csf('cone_per_bag')];

				if ($row[csf('weight_per_cone')] == "" || $row[csf('weight_per_cone')] == 0) $wt_bag_cone = 'W:' . $row[csf('weight_per_bag')]; else $wt_bag_cone = 'W:' . $row[csf('weight_per_bag')] . ' & ' . $row[csf('weight_per_cone')];
			?>
			<tbody>
			<tr bgcolor="<? echo $bgcolor; ?>" >
				<td width="20" class='stlinfobody'><? echo $i; ?></td>
				<td width="45" class='stlinfobody'>
					<div style="word-wrap:break-word; width:45px"><? if ($row[csf('requisition_no')] != 0) echo $row[csf('requisition_no')]; else echo '&nbsp;'; ?></div>
				</td>
				<td width="50" class='stlinfobody'>
					<div style="word-wrap:break-word; width:50px"><? echo $row[csf('lot')]; ?></div>
				</td>
				<td width="65" class='stlinfobody'>
					<div style="word-wrap:break-word; width:65px"><? echo $yarn_type[$row[csf('yarn_type')]]; ?></div>
				</td>
				<td width="210" class='stlinfobody'>
					<div style="word-wrap:break-word; width:210px">
						<?
                    //echo $proddtls;
						echo $count_arr[$row[csf('yarn_count_id')]]." ".$composition[$row[csf('yarn_comp_type1st')]]." ".$row[csf('yarn_comp_percent1st')]."% ".$yarn_type[$row[csf('yarn_type')]]." ".$color_name_arr[$row[csf('color')]];
						?>
					</div>
				</td>


				<td width="65" class='stlinfobody'>
					<div style="word-wrap:break-word; width:65px"><? echo $color_name_arr[$row[csf('dyeing_color_id')]]; ?>
					&nbsp;</div>
				</td>

				<td width="100" class='stlinfobody'>
					<div style="word-wrap:break-word; width:100px"><? echo $supplier_name_library[$row[csf('supplier_id')]]; ?></div>
				</td>

				<td align="right"
				width="60" class='stlinfobody'><? echo number_format($row[csf('cons_quantity')], 3, '.', ''); ?></td>
				<td align="right"
				width="60" class='stlinfobody'><? echo number_format($row[csf('returnable_qnty')], 2, '.', ''); ?></td>
				<td width="80" class='stlinfobody'>
					<div style="word-wrap:break-word; width:80px"><? echo $no_bag_cone . '<br>' . $wt_bag_cone ?>
					&nbsp;</div>
				</td>
				<td width="80" class='stlinfobody'>
					<div style="word-wrap:break-word; width:80px"><? echo $store_arr[$row[csf('store_id')]]; ?></div>
				</td>
				<td width="100" class='stlinfobody'>
					<div style="word-wrap:break-word; width:100px"><? echo $buyer_job; ?></div>
				</td>
				<td width="160" class='stlinfobody'>
					<div style="word-wrap:break-word; width:160px"><? echo $po_no;
					if ($style_ref != "") echo ' & ' . $style_ref; else echo '&nbsp;'; ?></div>
				</td>
				<td class='stlinfobody'>
					<div style="word-wrap:break-word; width:80px"><? echo ltrim($ref_cond, ", ");
					if ($file_cond != "") echo ' & ' . ltrim($file_cond, ", "); else echo '&nbsp;'; ?></div>
				</td>
			</tr>
			</tbody>
			<?
			$uom_unit = "Kg";
			$uom_gm = "Grams";
			$tot_return_qty += $row[csf('returnable_qnty')];
			$tot_bag += $no_of_bags_val;
			$tot_cone += $row[csf('cone_per_bag')];
			$tot_w_bag += $row[csf('weight_per_bag')];
			$tot_w_cone += $row[csf('weight_per_cone')];
			$req_no = $row[csf('requisition_no')];
			$i++;
		}
		?>
		<tr bgcolor="#CCCCCC" >
			<td align="right" colspan="7" class='stlinfobody'><b>Total&nbsp;</b></td>
			<td align="right" class='stlinfobody'>
				<b><? echo $format_total_amount = number_format($order_qnty_val_sum, 3, '.', ''); ?></b>
			</td>
			<td align="right" class='stlinfobody'><? echo number_format($tot_return_qty, 2, '.', ''); ?></td>
			<td class='stlinfobody'><? echo 'N:' . number_format($tot_bag, 2);
			if ($tot_cone != "") echo ' & ' . number_format($tot_cone, 2);
			echo '<br>W:' . number_format($tot_w_bag, 2);
			if ($tot_w_cone != "") echo ' & ' . number_format($tot_w_cone, 2); ?></td>
			<td align="right" colspan="4" class='stlinfobody'>&nbsp;</td>
		</tr>
		<tr>
			<td colspan="14" align="left" class='stlinfobody'><b>In Word: <? echo number_to_words($format_total_amount, $uom_unit, $uom_gm); ?></b></td>
		</tr>
		
    </table>
   


	</div>
	<div>
	<? echo signature_table(114, $data[0], $width,$template_id,'','','','','font-size:22px;'); ?>
	
	</div> 
 <script type="text/javascript" src="../../js/jquery.js"></script>
      <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
     <script>

	function generateBarcode( valuess ){
		   
			var value = valuess;//$("#barcodeValue").val();
		 // alert(value)
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='bmp';// $("input[name=renderer]:checked").val();
			 
			var settings = {
			  output:renderer,
			  bgColor: '#FFFFFF',
			  color: '#000000',
			  barWidth: 1,
			  barHeight: 30,
			  moduleSize:5,
			  posX: 10,
			  posY: 20,
			  addQuietZone: 1
			};
			$("#barcode_img_id").html('11');
			 value = {code:value, rect: false};
			
			$("#barcode_img_id").show().barcode(value, btype, settings);
		} 
	 generateBarcode('<? echo $data[1]; ?>');
	 </script>
	<?
	exit();
}
if($action=="print_to_html_report20")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	// echo "<pre>"; print_r($data); die;
	$show_item=$data[2];
	$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");

	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");
    $color_name_arr = return_library_array("select id, color_name from lib_color", 'id', 'color_name');

	$store_arr = return_library_array("select id, store_name from lib_store_location", 'id', 'store_name');

	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to,vhicle_number, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name, com_location_id, remarks, security_lock_no from inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 "; 
	//echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
 	$sent_to=$dataArray[0][csf('sent_to')];
	$shipmode_cartoon=sql_select("select  b.total_carton_qnty,b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no'") ;

	$shipmodes=sql_select("select  b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no' and (b.shiping_mode is not null or b.shiping_mode!=0) ") ;
	/*echo "<pre>";
	print_r($shipmode_cartoon);die;*/
	$ex_factory_del_data=array();
	if($basis==12)
	{
		 $sql_mst_ex_factory_del=sql_select("select a.sys_number,a.lock_no, a.dl_no,a.mobile_no, a.do_no, a.gp_no,a.remarks,a.truck_no,a.buyer_id,b.po_break_down_id from  pro_ex_factory_delivery_mst a,pro_ex_factory_mst b where a.sys_number='$challan_no' and a.entry_form!=85 and a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0");
	}
	$po_break_down_id="";
	foreach($sql_mst_ex_factory_del as $row)
	{
		$po_break_down_id.=$row[csf('po_break_down_id')].',';
		$ex_factory_del_data[$row[csf('sys_number')]]['lock_no']=$row[csf('lock_no')];
		$ex_factory_del_data[$row[csf('sys_number')]]['dl_no']=$row[csf('dl_no')];
		$ex_factory_del_data[$row[csf('sys_number')]]['mobile_no']=$row[csf('mobile_no')];
		$ex_factory_del_data[$row[csf('sys_number')]]['remarks']=$row[csf('remarks')];
		$ex_factory_del_data[$row[csf('sys_number')]]['truck_no']=$row[csf('truck_no')];
		
	}
	$poBreakDownId =chop($po_break_down_id,',');
	
	$res_breakDown = sql_select("select a.id,a.po_quantity,a.plan_cut, a.po_number,a.po_quantity,b.company_name, b.buyer_name, b.style_ref_no,b.gmts_item_id, b.order_uom, b.job_no,b.location_name,a.shipment_date   from wo_po_break_down a, wo_po_details_master b where a.job_no_mst=b.job_no and a.id in($poBreakDownId)"); 
	$break_down_data_arr=array();
 	foreach($res_breakDown as $row)
	{
		$break_down_data_arr[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$break_down_data_arr[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	if($basis==1)
	{ 
		if($within_group==1)
		{
			//$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
		else
		{
			//$send_to_company=$dataArray[0][csf('sent_to')];		
		}
	}
	
	if($within_group==2)
		{
			$send_to_company=$dataArray[0][csf('sent_to')];
		}
		else
		{
			$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	
	$country_arr = return_library_array("select id, country_name from lib_country", "id", "country_name");

	$width=1190;
	
	?>
    
	<style type="text/css">
		body{
			margin: 0 auto;
			padding:0;			
			background-size:912px 1056px;
            background-repeat: no-repeat;
		}

		.stlinfo{font-size: 22px; height: 70px; border: 2px solid black; text-align:center;}
		.stlinfobody{font-size: 22px; border: 2px solid black;}
	</style>
	<div style="width:<? echo $width+200;?>px;" align="center">
    <table width="<? echo $width+200;?>" cellspacing="0" align="center" border="0" style="font-size:22px;">
        
        <tr>
            <td  align="left" width="200px"><img src="../../<? echo $image_location; ?>" height="70" width="200"></td>
            <td colspan="6" align="center"  style="font-size:xx-large; text-align:center;">
				<strong align="center"><? echo $company_library[$data[0]]; ?></strong>
				<!-- <div style="float:right;width:34%; text-align:right">
				<div style="float:left; height:5%; width:5%;" id="qrcode"></div>
					&nbsp;<? //if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
				</div> -->
            </td>
			<td  align="left" rowspan="2"><div style="float:left; height:5%; width:5%;" id="qrcode"></div></td>
        </tr>
        <tr class="form_caption">
			<td  align="left">&nbsp;</td>
            <td colspan="6" align="center">
				<?
				$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
					//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
					foreach ($nameArray as $result)
					{ 
						echo $result[csf('city')];?>
						COUNTRY: <? echo $country_arr[$result[csf('country_id')]]; ?><br>
						Email : <? echo $result[csf('email')];?>
						Website : <? echo $result[csf('website')];
						/* echo $result[csf('plot_no')]; 
						echo $result[csf('level_no')];
						echo $result[csf('road_no')];
						echo $result[csf('block_no')];
						echo $result[csf('city')];
						echo $result[csf('zip_code')];
						echo $result[csf('province')].',';
						echo $country_arr[$result[csf('country_id')]].'<br>'; 
						echo $result[csf('email')]; 
						echo $result[csf('website')]; */
					}
                ?> 
                <div style="width:34%; text-align:center">
               		&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
            	</div>
            </td>
        </tr>
        <tr>
        	<td style="display:none" colspan="6" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
        </tr>
        <tr>
            <td colspan="8" align="center" style="font-size:x-large; padding-bottom: 10px;"><strong><u>Gate Pass</u></strong></td>
        </tr>
 	</table>
 </div>
 <div style="width:<? echo $width+200;?>px;" align="center">
    <table width="<? echo $width+200;?>" cellspacing="0" align="center" border="0" style="font-size:22px;">       
        <tr>
            <td style="width:150px;;"><strong>System ID:</strong></td>
            <td style="width:245px; "><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
            <td width="120"><strong>Basis:</strong></td>
            <td width="245px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
            <td width="165"><strong>Challan/System No:</strong></td>
            <td width="155px"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
        </tr>
         <tr>
            <td><strong>Department:</strong></td> <td><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
            <td><strong>Section:</strong></td><td><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
            <td><strong>Sent By:</strong></td> <td><? echo $dataArray[0][csf('sent_by')]; ?></td>
        </tr>
        <tr>
        	<td><strong>Sent To:</strong></td><td width="175px" ><b><? echo $send_to_company; ?></b></td>
        	<td><strong>Attention:</strong></td><td><? echo $dataArray[0][csf('attention')]; ?></td>
            <td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
        </tr>
        <tr>
          <td><strong>Out-Time:</strong></td><td><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
           <td><strong>Returnable :</strong></td><td><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
           <td><strong>Delivery As:</strong></td><td><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
        </tr>
         <tr>
         	<td><strong>Est. Return Date :</strong></td><td><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td> 
         	<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
            <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
        </tr>
         <tr>
         	<!-- <td><strong>Bar Code:</strong></td><td  colspan="1" id="qrcode"></td>  -->
            <td><strong>Vehicle Number:</strong></td><td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
            <td><strong>To Location :</strong></td><td><?  if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
        </tr>
		<tr>
            <td></td><td></td> 
            <td></td><td></td>
            <td><strong>Security Lock No:</strong></td><td><? echo $dataArray[0][csf('security_lock_no')]; ?></td> 
        </tr>
  
      <?php /*?>  <? if ($basis==12)
        {
        	?>
        	<tr>

       	 <td> <strong> Shipping Mode </strong></td>
       	 <td colspan="5" align="left"> <?  echo $shipment_mode[$shipmodes[0][csf("shiping_mode")]]; ?> </td>

       	 </tr>

	
       <? }?><?php */?>
        


    </table>
    <br>
    <table align="center" cellspacing="0" width="<? echo $width+200;?>"  border="1" rules="all" class="rpt_table" >
        <thead bgcolor="#dddddd" >
			<tr>
				<th width="20" class='stlinfo'>SL</th>
				<th width="85" class='stlinfo'>Req. No</th>
				<th width="50" class='stlinfo'>Lot No</th>
				<th width="65" class='stlinfo'>Yarn Type</th>
				<th width="210" class='stlinfo'>Item Details</th>
				<th width="65" class='stlinfo'>Dye. Color</th>
				<th width="100" class='stlinfo'>Supp.</th>
				<th width="60" class='stlinfo'>Issue Qty(kg)</th>
				<th width="60" class='stlinfo'>Rtnbl Qty(kg)</th>
				<th width="80" class='stlinfo'>Bag & Cone</th>
				<th width="80" class='stlinfo'>Store</th>
				<th width="100" class='stlinfo'>Buyer & Job</th>
				<th width="160" class='stlinfo'>Order & Style</th>
				<th class='stlinfo'>Inte. Ref & File</th>
			</tr>
		</thead>
		<?
			$gate_id=$dataArray[0][csf('id')];
			$sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags,b.issue_id from inv_gate_pass_dtls a,inv_gate_pass_mst b  where b.id=a.mst_id and a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 ";
			//echo $sql_dtls;
			$issue_id_all="";
			$sql_result=sql_select($sql_dtls);
			foreach($sql_result as $row)
			{
				$issue_id_all=$row[csf('issue_id')];
			}
			//echo $issue_id_all;

			$wopi_library = return_library_array("select id,pi_number from com_pi_master_details", "id", "pi_number");

			$cond = "";
			if ($issue_id_all != "") $cond .= " and c.id in('$issue_id_all')";

			$po_array = array();
			$job_array = array();
			$costing_sql = sql_select("select a.job_no, b.file_no,b.grouping,a.style_ref_no, a.buyer_name, b.id, b.po_number from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.company_name=$data[0]");
			foreach ($costing_sql as $row) {
				$po_array[$row[csf('id')]]['no'] = $row[csf('po_number')];
				$po_array[$row[csf('id')]]['job_no'] = $row[csf('job_no')];
				$po_array[$row[csf('id')]]['style_ref'] = $row[csf('style_ref_no')];
				$po_array[$row[csf('id')]]['buyer_name'] = $row[csf('buyer_name')];
				$po_array[$row[csf('id')]]['grouping'] = $row[csf('grouping')];
				$po_array[$row[csf('id')]]['file_no'] = $row[csf('file_no')];
				$job_array[$row[csf('job_no')]]['job'] = $row[csf('job_no')];
				$job_array[$row[csf('job_no')]]['buyer'] = $row[csf('buyer_name')];
			}
			unset($costing_sql);

			$job_no_array = array();
			$jobData = sql_select("select id, job_no, style_ref_no, within_group, buyer_id from fabric_sales_order_mst");
			foreach ($jobData as $row) {
				$job_no_array[$row[csf('id')]]['job_no'] = $row[csf('job_no')];
				$job_no_array[$row[csf('id')]]['style_ref'] = $row[csf('style_ref_no')];
				$job_no_array[$row[csf('id')]]['within_group'] = $row[csf('within_group')];
				$job_no_array[$row[csf('id')]]['buyer_id'] = $row[csf('buyer_id')];
			}
				//var_dump($po_array);
			$po_id_req_array = array();
			$is_sales_array = array();
			if ($db_type == 0) {
				$poID = " select c.requisition_no, a.is_sales, group_concat(distinct(a.po_id)) as poid from ppl_planning_entry_plan_dtls a, ppl_planning_info_entry_dtls b, ppl_yarn_requisition_entry c where b.id=a.dtls_id and b.id=c.knit_id group by c.requisition_no, a.is_sales ";
			} else {
				$poID = "select c.requisition_no, a.is_sales, LISTAGG(a.po_id, ',') WITHIN GROUP (ORDER BY a.po_id) as poid from ppl_planning_entry_plan_dtls a, ppl_planning_info_entry_dtls b, ppl_yarn_requisition_entry c where b.id=a.dtls_id and b.id=c.knit_id group by c.requisition_no, a.is_sales ";
			}
			$poID_sql_result = sql_select($poID);
			foreach ($poID_sql_result as $row) {
				$po_id_req_array[$row[csf('requisition_no')]] = $row[csf('poid')];
				$is_sales_array[$row[csf('requisition_no')]] = $row[csf('is_sales')];
			}
			unset($poID_sql_result);

	$i = 1;
	
	if ($db_type == 0) {
		$sql_result = sql_select("select a.id, a.lot,a.color, a.yarn_type, a.product_name_details, a.yarn_count_id,a.yarn_comp_percent1st,a.yarn_comp_type1st, a.detarmination_id, b.dyeing_color_id, b.id, b.requisition_no, b.cons_uom, b.cons_quantity, b.return_qnty as returnable_qnty, b.store_id, b.no_of_bags, b.cone_per_bag, b.weight_per_bag, b.weight_per_cone, c.issue_basis, c.booking_no, c.buyer_id, c.buyer_job_no, a.supplier_id, group_concat(d.po_breakdown_id) as po_id, sum(d.returnable_qnty) as returnable_qnty_pro from product_details_master a, inv_issue_master c, inv_transaction b left join order_wise_pro_details d on b.id=d.trans_id where c.id=b.mst_id and b.prod_id=a.id and b.transaction_type=2 and b.item_category=1 and c.entry_form=3 and b.status_active=1 and b.is_deleted=0 and c.id in($issue_id_all) group by a.id, a.lot,a.color,a.yarn_type, a.product_name_details, a.detarmination_id, a.supplier_id, b.id, b.dyeing_color_id, b.requisition_no, b.cons_uom, b.cons_quantity, b.return_qnty, b.store_id, b.no_of_bags, b.cone_per_bag, b.weight_per_bag, b.weight_per_cone, c.issue_basis, c.booking_no, c.buyer_id, c.buyer_job_no, a.yarn_count_id,a.yarn_comp_percent1st,a.yarn_comp_type1st");
	} else {
		$sql_result = sql_select("select a.id, a.lot,a.color,a.yarn_type, a.product_name_details, a.yarn_count_id,a.yarn_comp_percent1st,a.yarn_comp_type1st, a.detarmination_id, b.dyeing_color_id, b.id, b.requisition_no, b.cons_uom, b.cons_quantity, b.return_qnty as returnable_qnty, b.store_id, b.no_of_bags, b.cone_per_bag, b.weight_per_bag, b.weight_per_cone, c.issue_basis, c.booking_no, c.buyer_id, c.buyer_job_no, a.supplier_id, LISTAGG(d.po_breakdown_id, ',') WITHIN GROUP (ORDER BY d.po_breakdown_id) as po_id, sum(d.returnable_qnty) as returnable_qnty_pro from product_details_master a, inv_issue_master c, inv_transaction b left join order_wise_pro_details d on b.id=d.trans_id where c.id=b.mst_id and b.prod_id=a.id and b.transaction_type=2 and b.item_category=1 and c.entry_form=3 and b.status_active=1 and b.is_deleted=0 and c.id in($issue_id_all) group by a.id, a.lot,a.color, a.yarn_type, a.product_name_details, a.detarmination_id, a.supplier_id, b.id, b.dyeing_color_id, b.requisition_no, b.cons_uom, b.cons_quantity, b.return_qnty, b.store_id, b.no_of_bags, b.cone_per_bag, b.weight_per_bag, b.weight_per_cone, c.issue_basis, c.booking_no, c.buyer_id, c.buyer_job_no, a.yarn_count_id,a.yarn_comp_percent1st,a.yarn_comp_type1st");

	}

		$all_req_no = '';
		$all_prod_id = '';
		$order_qnty_val_sum=$order_amount_val_sum=$no_of_bags_val_sum=0;
		$tot_return_qty = $tot_bag = $tot_cone = $tot_w_bag = $tot_w_cone = 0;
		foreach ($sql_result as $row) {
			//if ($i % 2 == 0) $bgcolor = "#E9F3FF"; else $bgcolor = "#FFFFFF";
			if ($row[csf('requisition_no')] != '') {
				if ($all_req_no == '') $all_req_no = $row[csf('requisition_no')]; else $all_req_no .= ',' . $row[csf('requisition_no')];
				if ($all_prod_id == '') $all_prod_id = $row[csf('po_id')]; else $all_prod_id .= ',' . $row[csf('po_id')];
			}
			$order_qnty_val = $row[csf('cons_quantity')];
			$order_qnty_val_sum += $order_qnty_val;

			$order_amount_val = $row[csf('order_amount')];
			$order_amount_val_sum += $order_amount_val;

			$no_of_bags_val = $row[csf('no_of_bags')];
			$no_of_bags_val_sum += $no_of_bags_val;

			$po_id = explode(",", $row[csf('po_id')]);
			$po_no = '';
			$style_ref = '';
			$job_no = '';
			$buyer = '';
				//$data=explode('*',$data);
			$productdtls = $row[csf('product_name_details')];
			$productArr = explode(' ', $productdtls);

			$proddtls = '';
			if ($productArr[0] != '' && $productArr[1] != '' && $productArr[2] != '' && $productArr[3] != '' && $productArr[4] != '' && $productArr[5] != '') {
				$proddtls = $productArr[0] . ', ' . $productArr[1] . ' ' . $productArr[2] . '%, ' . $productArr[3] . ' ' . $productArr[4] . "%, " . $productArr[5] . ", " . $productArr[6];
			} else if ($productArr[0] != '' && $productArr[1] != '' && $productArr[2] != '' && $productArr[3] != '' && $productArr[4] != '') {
				$proddtls = $productArr[0] . ', ' . $productArr[1] . ' ' . $productArr[2] . ' %, ' . $productArr[3] . ', ' . $productArr[4];
			} else if ($productArr[0] != '' && $productArr[1] != '' && $productArr[2] != '' && $productArr[3] != '') {
				$proddtls = $productArr[0] . ', ' . $productArr[1] . ' ' . $productArr[2] . ' %, ' . $productArr[3];
			} else if ($productArr[0] != '' && $productArr[1] != '' && $productArr[2] != '') {
				$proddtls = $productArr[0] . ', ' . $productArr[1] . ' ' . $productArr[2] . ' %, ';
			} else if ($productArr[0] != '' && $productArr[1] != '') {
				$proddtls = $productArr[0] . ', ' . $productArr[1];
			} else if ($productArr[0] != '') {
				$proddtls = $productArr[0];
			} else {
				$proddtls = '';
			}

			$internal_ref = '';
			$file_no = '';
			if ($row[csf('issue_basis')] == 1 || $row[csf('issue_basis')] == 2) {
				foreach ($po_id as $val) {
					if ($po_no == '') $po_no = $po_array[$val]['no']; else $po_no .= ", " . $po_array[$val]['no'];
					if ($job_no == '') $job_no = $po_array[$val]['job_no'];
					if ($style_ref == '') $style_ref = $po_array[$val]['style_ref'];
					if ($buyer == '') $buyer_name = $po_array[$val]['buyer_name'];

					if ($internal_ref == '') $internal_ref = $po_array[$val]['grouping']; else $internal_ref .= "," . $po_array[$val]['grouping'];
					if ($file_no == '') $file_no = $po_array[$val]['file_no']; else $file_no .= "," . $po_array[$val]['file_no'];
				}
				$job_ref = array_unique(explode(",", rtrim($internal_ref, ", ")));
				$job_file = array_unique(explode(",", rtrim($file_no, ", ")));
				$ref_cond = '';
				foreach ($job_ref as $ref) {
						//$ref_cond.=", ".$ref;
					if ($ref_cond == '') $ref_cond = $ref; else $ref_cond .= ", " . $ref;
				}
				$file_con = '';
				foreach ($job_file as $file) {
					if ($file_con == '') $file_cond = $file; else $file_cond .= ", " . $file;
				}

				$buyer_job = '';
				if ($row[csf('issue_basis')] == 1) {
					if ($dataArray[0][csf('issue_purpose')] == 8) {
						$buyer_job = $buyer_arr[$row[csf('buyer_id')]];
					} else {
						$buyer_job = $buyer_arr[$job_array[$row[csf('buyer_job_no')]]['buyer']];
						if ($row[csf('buyer_job_no')] != "") {
							$buyer_job = $buyer_arr[$job_array[$row[csf('buyer_job_no')]]['buyer']] . ' & ' . $row[csf('buyer_job_no')];
						}
					}
				} else if ($row[csf('issue_basis')] == 2) {
					$buyer_job = '';
				}
			} else if ($row[csf('issue_basis')] == 3) {
					//$ex_data = array_unique(explode(",",$po_id_req_array[$row[csf('requisition_no')]]));
					//print_r($ex_data);

				if ($is_sales_array[$row[csf('requisition_no')]] == 1) {
					$buyer_job = '';
					foreach (array_unique($po_id) as $val) {
						if ($po_no == '') $po_no = $job_no_array[$val]['job_no']; else $po_no .= ", " . $job_no_array[$val]['job_no'];
						if ($style_ref == '') $style_ref = $job_no_array[$val]['style_ref'];

						if ($buyer_job == '') {
							if ($job_no_array[$val]['within_group'] == 1) {
								$buyer_job = $company_library[$job_no_array[$val]['buyer_id']];
							} else {
								$buyer_job = $buyer_arr[$job_no_array[$val]['buyer_id']];
							}
						}
					}
				} else {
					foreach ($po_id as $val) {
						if ($po_no == '') $po_no = $po_array[$val]['no']; else $po_no .= ", " . $po_array[$val]['no'];
						if ($job_no == '') $job_no = $po_array[$val]['job_no'];
						if ($style_ref == '') $style_ref = $po_array[$val]['style_ref'];
						if ($buyer == '') $buyer_name = $po_array[$val]['buyer_name'];

						if ($internal_ref == '') $internal_ref = $po_array[$val]['grouping']; else $internal_ref .= "," . $po_array[$val]['grouping'];
						if ($file_no == '') $file_no = $po_array[$val]['file_no']; else $file_no .= "," . $po_array[$val]['file_no'];
					}

					$job_ref = array_unique(explode(",", rtrim($internal_ref, ", ")));
					$job_file = array_unique(explode(",", rtrim($file_no, ", ")));

					$ref_cond = '';
					foreach ($job_ref as $ref) {
							//$ref_cond.=", ".$ref;
						if ($ref_cond == '') $ref_cond = $ref; else $ref_cond .= ", " . $ref;
					}

					$file_con = '';
					foreach ($job_file as $file) {
						if ($file_con == '') $file_cond = $file; else $file_cond .= ", " . $file;
					}
					if ($job_no != '') {
						$buyer_job = $buyer_arr[$buyer_name] . ' & ' . $job_no;
					} else {
						$buyer_job = $buyer_arr[$buyer_name];
					}
				}
			} else {
				foreach (array_unique($po_id) as $val) {
					if ($po_no == '') $po_no = $job_no_array[$val]['job_no']; else $po_no .= ", " . $job_no_array[$val]['job_no'];
					if ($style_ref == '') $style_ref = $job_no_array[$val]['style_ref'];
					if ($buyer_job == '') {
						if ($job_no_array[$val]['within_group'] == 1) {
							$buyer_job = $company_library[$job_no_array[$val]['buyer_id']];
						} else {
							$buyer_job = $buyer_arr[$job_no_array[$val]['buyer_id']];
						}
					}
				}
			}
			

			$no_bag_cone = "";
			$wt_bag_cone = "";
			if ($row[csf('cone_per_bag')] == "" || $row[csf('cone_per_bag')] == 0) $no_bag_cone = 'N:' . $no_of_bags_val; else $no_bag_cone = 'N:' . $no_of_bags_val . ' & ' . $row[csf('cone_per_bag')];

				if ($row[csf('weight_per_cone')] == "" || $row[csf('weight_per_cone')] == 0) $wt_bag_cone = 'W:' . $row[csf('weight_per_bag')]; else $wt_bag_cone = 'W:' . $row[csf('weight_per_bag')] . ' & ' . $row[csf('weight_per_cone')];
			?>
			<tbody>
			<tr bgcolor="<? echo $bgcolor; ?>" >
				<td width="20" class='stlinfobody'><? echo $i; ?></td>
				<td width="45" class='stlinfobody'>
					<div style="word-wrap:break-word; width:85px"><? if ($row[csf('requisition_no')] != 0) echo $row[csf('requisition_no')]; else echo '&nbsp;'; ?></div>
				</td>
				<td width="50" class='stlinfobody'>
					<div style="word-wrap:break-word; width:50px"><? echo $row[csf('lot')]; ?></div>
				</td>
				<td width="65" class='stlinfobody'>
					<div style="word-wrap:break-word; width:65px"><? echo $yarn_type[$row[csf('yarn_type')]]; ?></div>
				</td>
				<td width="210" class='stlinfobody'>
					<div style="word-wrap:break-word; width:210px">
						<?
                    //echo $proddtls;
						echo $count_arr[$row[csf('yarn_count_id')]]." ".$composition[$row[csf('yarn_comp_type1st')]]." ".$row[csf('yarn_comp_percent1st')]."% ".$yarn_type[$row[csf('yarn_type')]]." ".$color_name_arr[$row[csf('color')]];
						?>
					</div>
				</td>


				<td width="65" class='stlinfobody'>
					<div style="word-wrap:break-word; width:65px"><? echo $color_name_arr[$row[csf('dyeing_color_id')]]; ?>
					&nbsp;</div>
				</td>

				<td width="100" class='stlinfobody'>
					<div style="word-wrap:break-word; width:100px"><? echo $supplier_name_library[$row[csf('supplier_id')]]; ?></div>
				</td>

				<td align="right"
				width="60" class='stlinfobody'><? echo number_format($row[csf('cons_quantity')], 3, '.', ''); ?></td>
				<td align="right"
				width="60" class='stlinfobody'><? echo number_format($row[csf('returnable_qnty')], 2, '.', ''); ?></td>
				<td width="80" class='stlinfobody'>
					<div style="word-wrap:break-word; width:80px"><? echo $no_bag_cone . '<br>' . $wt_bag_cone ?>
					&nbsp;</div>
				</td>
				<td width="80" class='stlinfobody'>
					<div style="word-wrap:break-word; width:80px"><? echo $store_arr[$row[csf('store_id')]]; ?></div>
				</td>
				<td width="100" class='stlinfobody'>
					<div style="word-wrap:break-word; width:100px"><? echo $buyer_job; ?></div>
				</td>
				<td width="160" class='stlinfobody'>
					<div style="word-wrap:break-word; width:160px"><? echo $po_no;
					if ($style_ref != "") echo ' & ' . $style_ref; else echo '&nbsp;'; ?></div>
				</td>
				<td class='stlinfobody'>
					<div style="word-wrap:break-word; width:80px"><? echo ltrim($ref_cond, ", ");
					if ($file_cond != "") echo ' & ' . ltrim($file_cond, ", "); else echo '&nbsp;'; ?></div>
				</td>
			</tr>
			</tbody>
			<?
			$uom_unit = "Kg";
			$uom_gm = "Grams";
			$tot_return_qty += $row[csf('returnable_qnty')];
			$tot_bag += $no_of_bags_val;
			$tot_cone += $row[csf('cone_per_bag')];
			$tot_w_bag += $row[csf('weight_per_bag')];
			$tot_w_cone += $row[csf('weight_per_cone')];
			$req_no = $row[csf('requisition_no')];
			$i++;
		}
		?>
		<tr bgcolor="#CCCCCC" >
			<td align="right" colspan="7" class='stlinfobody'><b>Total&nbsp;</b></td>
			<td align="right" class='stlinfobody'>
				<b><? echo $format_total_amount = number_format($order_qnty_val_sum, 3, '.', ''); ?></b>
			</td>
			<td align="right" class='stlinfobody'><? echo number_format($tot_return_qty, 2, '.', ''); ?></td>
			<td class='stlinfobody'><? echo 'N:' . number_format($tot_bag, 2);
			if ($tot_cone != "") echo ' & ' . number_format($tot_cone, 2);
			echo '<br>W:' . number_format($tot_w_bag, 2);
			if ($tot_w_cone != "") echo ' & ' . number_format($tot_w_cone, 2); ?></td>
			<td align="right" colspan="4" class='stlinfobody'>&nbsp;</td>
		</tr>
		<tr>
			<td colspan="14" align="left" class='stlinfobody'><b>In Word: <? echo number_to_words($format_total_amount, $uom_unit, $uom_gm); ?></b></td>
		</tr>
		
    </table>
   


	</div>
	<div>
	<? echo signature_table(114, $data[0], $width,$template_id,'','','','','font-size:22px;'); ?>
	
	</div> 
 	<script type="text/javascript" src="../../js/jquery.js"></script>
    <!-- <script type="text/javascript" src="../../js/jquerybarcode.js"></script> -->
	<script type="text/javascript" src="../../js/jquery.qrcode.min.js"></script>
	<script>
		var main_value='<? echo $data[1]; ?>';
		$('#qrcode').qrcode(main_value);
	</script>
    <!-- <script>

		function generateBarcode( valuess )
		{
			var value = valuess;//$("#barcodeValue").val();
		 	// alert(value)
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='bmp';// $("input[name=renderer]:checked").val();
			 
			var settings = {
			  output:renderer,
			  bgColor: '#FFFFFF',
			  color: '#000000',
			  barWidth: 1,
			  barHeight: 30,
			  moduleSize:5,
			  posX: 10,
			  posY: 20,
			  addQuietZone: 1
			};
			$("#barcode_img_id").html('11');
			 value = {code:value, rect: false};
			
			$("#barcode_img_id").show().barcode(value, btype, settings);
		} 
	 	generateBarcode('<? //echo $data[1]; ?>');
	</script> -->
	<?
	exit();
}

if($action=="print_to_html_report11_29112022")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//print_r ($data);
	$show_item=$data[2];
	$company=$data[0];
	$location=$data[2];
 //	$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$count_arr=return_library_array( "select id, yarn_count from lib_yarn_count",'id','yarn_count');

	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");
    $color_name_arr = return_library_array("select id, color_name from lib_color", 'id', 'color_name');

	$store_arr = return_library_array("select id, store_name from lib_store_location", 'id', 'store_name');

	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$buyer_arr = return_library_array( "select id, buyer_name from  lib_buyer",'id','buyer_name');
	
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to,vhicle_number, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,com_location_id,remarks, security_lock_no from inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 "; 
	//echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
 	$sent_to=$dataArray[0][csf('sent_to')];
 	$sent_to=$dataArray[0][csf('security_lock_no')];
	$shipmode_cartoon=sql_select("select  b.total_carton_qnty,b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no'") ;

	$shipmodes=sql_select("select  b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no' and (b.shiping_mode is not null or b.shiping_mode!=0) ") ;
	/*echo "<pre>";
	print_r($shipmode_cartoon);die;*/
	$ex_factory_del_data=array();
	if($basis==12)
	{
		 $sql_mst_ex_factory_del=sql_select("select a.sys_number,a.lock_no, a.dl_no,a.mobile_no, a.do_no, a.gp_no,a.remarks,a.truck_no,a.buyer_id,b.po_break_down_id from  pro_ex_factory_delivery_mst a,pro_ex_factory_mst b where a.sys_number='$challan_no' and a.entry_form!=85 and a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0");
	}
	$po_break_down_id="";
	foreach($sql_mst_ex_factory_del as $row)
	{
		$po_break_down_id.=$row[csf('po_break_down_id')].',';
		$ex_factory_del_data[$row[csf('sys_number')]]['lock_no']=$row[csf('lock_no')];
		$ex_factory_del_data[$row[csf('sys_number')]]['dl_no']=$row[csf('dl_no')];
		$ex_factory_del_data[$row[csf('sys_number')]]['mobile_no']=$row[csf('mobile_no')];
		$ex_factory_del_data[$row[csf('sys_number')]]['remarks']=$row[csf('remarks')];
		$ex_factory_del_data[$row[csf('sys_number')]]['truck_no']=$row[csf('truck_no')];
		
	}
	$poBreakDownId =chop($po_break_down_id,',');
	
	$res_breakDown = sql_select("select a.id,a.po_quantity,a.plan_cut, a.po_number,a.po_quantity,b.company_name, b.buyer_name, b.style_ref_no,b.gmts_item_id, b.order_uom, b.job_no,b.location_name,a.shipment_date   from wo_po_break_down a, wo_po_details_master b where a.job_no_mst=b.job_no and a.id in($poBreakDownId)"); 
	$break_down_data_arr=array();
 	foreach($res_breakDown as $row)
	{
		$break_down_data_arr[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$break_down_data_arr[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	if($basis==1)
	{ 
		if($within_group==1)
		{
			//$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
		else
		{
			//$send_to_company=$dataArray[0][csf('sent_to')];		
		}
	}
	
	if($within_group==2)
		{
			$send_to_company=$dataArray[0][csf('sent_to')];
		}
		else
		{
			$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	$width=1150;
	$com_dtls = fnc_company_location_address($company, $location, 2);
	?>
    
  
	<div style="width:<? echo $width+200;?>px;" align="center">
    <table width="<? echo $width+200;?>" cellspacing="0" align="center" border="0">
        
        <tr>
            <td  align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="70" width="200"></td>
            <td colspan="7" align="center"  style="font-size:xx-large; text-align:left;"><strong style="margin-left:100px" ><? echo $com_dtls[0]; ?></strong>
             <div style="float:right;width:34%; text-align:right">
               	&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
            </div>
            </td>
        </tr>
        <tr class="form_caption">
            <td colspan="8" align="center">
				<?
				echo $com_dtls[1];
				/*$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
					//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
					foreach ($nameArray as $result)
					{ 
						echo $result[csf('plot_no')]; 
						echo $result[csf('level_no')];
						echo $result[csf('road_no')];
						echo $result[csf('block_no')];
						echo $result[csf('city')];
						echo $result[csf('zip_code')];
						echo $result[csf('province')].',';
						echo $country_arr[$result[csf('country_id')]].'<br>'; 
						echo $result[csf('email')]; 
						echo $result[csf('website')];
					}*/
                ?> 
                <div style="width:34%; text-align:center">
               	&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
            </div>
            </td>
        </tr>
        <tr>
        	<td style="display:none" colspan="6" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
        </tr>
        <tr>
            <td colspan="5" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
        </tr>
 	</table>
 </div>
 <div style="width:<? echo $width+200;?>px;" align="center">
    <table width="<? echo $width+200;?>" cellspacing="0" align="center" border="0">       
        <tr>
            <td style="width:150px;;"><strong>System ID:</strong></td>
            <td style="width:245px; font-size:20px;"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
            <td width="120"><strong>Basis:</strong></td>
            <td width="245px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
            <td width="165"><strong>Challan/System No:</strong></td>
            <td width="155px"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
        </tr>
         <tr>
            <td><strong>Department:</strong></td> <td><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
            <td><strong>Section:</strong></td><td><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
            <td><strong>Sent By:</strong></td> <td><? echo $dataArray[0][csf('sent_by')]; ?></td>
        </tr>
        <tr>
        	<td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
        	<td><strong>Attention:</strong></td><td><? echo $dataArray[0][csf('attention')]; ?></td>
            <td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
        </tr>
        <tr>
          <td><strong>Out-Time:</strong></td><td><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
           <td><strong>Returnable :</strong></td><td><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
           <td><strong>Delivery As:</strong></td><td><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
        </tr>
         <tr>
         	<td><strong>Est. Return Date :</strong></td><td><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td> 
         	<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
            <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
        </tr>
         <tr>
         	<td><strong>Bar Code:</strong></td><td  colspan="1" id="barcode_img_id"></td> 
            <td><strong>Vehicle Number:</strong></td><td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
            <td><strong>To Location :</strong></td><td><?  if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
        </tr>
		<tr>
            <td></td><td></td> 
            <td></td><td></td>
            <td><strong>Security Lock No:</strong></td><td><? echo $dataArray[0][csf('security_lock_no')]; ?></td> 
        </tr>
  
      <?php /*?>  <? if ($basis==12)
        {
        	?>
        	<tr>

       	 <td> <strong> Shipping Mode </strong></td>
       	 <td colspan="5" align="left"> <?  echo $shipment_mode[$shipmodes[0][csf("shiping_mode")]]; ?> </td>

       	 </tr>

	
       <? }?><?php */?>
        


    </table>
    <br>
    <table align="center" cellspacing="0" width="<? echo $width+200;?>"  border="1" rules="all" class="rpt_table" >
        <thead bgcolor="#dddddd" style="font-size:13px">
			<th width="20">SL</th>
			<th width="45">Req. No</th>
			<th width="50">Lot No</th>
			<th width="65">Y. Type</th>
			<th width="210">Item Details</th>

			<th width="65">Dye. Color</th>
			<th width="100">Supp.</th>
			<th width="60"><b>Issue Qty(kg)</b></th>
			<th width="60">Rtnbl Qty(kg)</th>
			<th width="80">Bag & Cone</th>
			<th width="80">Store</th>
			<th width="100">Buyer & Job</th>
			<th width="160">Order & Style</th>
			<th>Inte. Ref & File</th>
		</thead>
		<?
			$gate_id=$dataArray[0][csf('id')];
			$sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags,b.issue_id from inv_gate_pass_dtls a,inv_gate_pass_mst b  where b.id=a.mst_id and a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 ";
			//echo $sql_dtls;
			$issue_id_all="";
			$sql_result=sql_select($sql_dtls);
			foreach($sql_result as $row)
			{
				$issue_id_all=$row[csf('issue_id')];
			}
			//echo $issue_id_all;

			$wopi_library = return_library_array("select id,pi_number from com_pi_master_details", "id", "pi_number");

			$cond = "";
			if ($issue_id_all != "") $cond .= " and c.id in('$issue_id_all')";

			$po_array = array();
			$job_array = array();
			$costing_sql = sql_select("select a.job_no, b.file_no,b.grouping,a.style_ref_no, a.buyer_name, b.id, b.po_number from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.company_name=$data[0]");
			foreach ($costing_sql as $row) {
				$po_array[$row[csf('id')]]['no'] = $row[csf('po_number')];
				$po_array[$row[csf('id')]]['job_no'] = $row[csf('job_no')];
				$po_array[$row[csf('id')]]['style_ref'] = $row[csf('style_ref_no')];
				$po_array[$row[csf('id')]]['buyer_name'] = $row[csf('buyer_name')];
				$po_array[$row[csf('id')]]['grouping'] = $row[csf('grouping')];
				$po_array[$row[csf('id')]]['file_no'] = $row[csf('file_no')];
				$job_array[$row[csf('job_no')]]['job'] = $row[csf('job_no')];
				$job_array[$row[csf('job_no')]]['buyer'] = $row[csf('buyer_name')];
			}
			unset($costing_sql);

			$job_no_array = array();
			$jobData = sql_select("select id, job_no, style_ref_no, within_group, buyer_id from fabric_sales_order_mst");
			foreach ($jobData as $row) {
				$job_no_array[$row[csf('id')]]['job_no'] = $row[csf('job_no')];
				$job_no_array[$row[csf('id')]]['style_ref'] = $row[csf('style_ref_no')];
				$job_no_array[$row[csf('id')]]['within_group'] = $row[csf('within_group')];
				$job_no_array[$row[csf('id')]]['buyer_id'] = $row[csf('buyer_id')];
			}
				//var_dump($po_array);
			$po_id_req_array = array();
			$is_sales_array = array();
			if ($db_type == 0) {
				$poID = " select c.requisition_no, a.is_sales, group_concat(distinct(a.po_id)) as poid from ppl_planning_entry_plan_dtls a, ppl_planning_info_entry_dtls b, ppl_yarn_requisition_entry c where b.id=a.dtls_id and b.id=c.knit_id group by c.requisition_no, a.is_sales ";
			} else {
				$poID = "select c.requisition_no, a.is_sales, LISTAGG(a.po_id, ',') WITHIN GROUP (ORDER BY a.po_id) as poid from ppl_planning_entry_plan_dtls a, ppl_planning_info_entry_dtls b, ppl_yarn_requisition_entry c where b.id=a.dtls_id and b.id=c.knit_id group by c.requisition_no, a.is_sales ";
			}
			$poID_sql_result = sql_select($poID);
			foreach ($poID_sql_result as $row) {
				$po_id_req_array[$row[csf('requisition_no')]] = $row[csf('poid')];
				$is_sales_array[$row[csf('requisition_no')]] = $row[csf('is_sales')];
			}
			unset($poID_sql_result);

	$i = 1;
	
	if ($db_type == 0) {
		$sql_result = sql_select("select a.id, a.lot,a.color, a.yarn_type, a.product_name_details, a.yarn_count_id,a.yarn_comp_percent1st,a.yarn_comp_type1st, a.detarmination_id, b.dyeing_color_id, b.id, b.requisition_no, b.cons_uom, b.cons_quantity, b.return_qnty as returnable_qnty, b.store_id, b.no_of_bags, b.cone_per_bag, b.weight_per_bag, b.weight_per_cone, c.issue_basis, c.booking_no, c.buyer_id, c.buyer_job_no, a.supplier_id, group_concat(d.po_breakdown_id) as po_id, sum(d.returnable_qnty) as returnable_qnty_pro from product_details_master a, inv_issue_master c, inv_transaction b left join order_wise_pro_details d on b.id=d.trans_id where c.id=b.mst_id and b.prod_id=a.id and b.transaction_type=2 and b.item_category=1 and c.entry_form=3 and b.status_active=1 and b.is_deleted=0 and c.id in($issue_id_all) group by a.id, a.lot,a.color,a.yarn_type, a.product_name_details, a.detarmination_id, a.supplier_id, b.id, b.dyeing_color_id, b.requisition_no, b.cons_uom, b.cons_quantity, b.return_qnty, b.store_id, b.no_of_bags, b.cone_per_bag, b.weight_per_bag, b.weight_per_cone, c.issue_basis, c.booking_no, c.buyer_id, c.buyer_job_no, a.yarn_count_id,a.yarn_comp_percent1st,a.yarn_comp_type1st");
	} else {
		$sql_result = sql_select("select a.id, a.lot,a.color,a.yarn_type, a.product_name_details, a.yarn_count_id,a.yarn_comp_percent1st,a.yarn_comp_type1st, a.detarmination_id, b.dyeing_color_id, b.id, b.requisition_no, b.cons_uom, b.cons_quantity, b.return_qnty as returnable_qnty, b.store_id, b.no_of_bags, b.cone_per_bag, b.weight_per_bag, b.weight_per_cone, c.issue_basis, c.booking_no, c.buyer_id, c.buyer_job_no, a.supplier_id, LISTAGG(d.po_breakdown_id, ',') WITHIN GROUP (ORDER BY d.po_breakdown_id) as po_id, sum(d.returnable_qnty) as returnable_qnty_pro from product_details_master a, inv_issue_master c, inv_transaction b left join order_wise_pro_details d on b.id=d.trans_id where c.id=b.mst_id and b.prod_id=a.id and b.transaction_type=2 and b.item_category=1 and c.entry_form=3 and b.status_active=1 and b.is_deleted=0 and c.id in($issue_id_all) group by a.id, a.lot,a.color, a.yarn_type, a.product_name_details, a.detarmination_id, a.supplier_id, b.id, b.dyeing_color_id, b.requisition_no, b.cons_uom, b.cons_quantity, b.return_qnty, b.store_id, b.no_of_bags, b.cone_per_bag, b.weight_per_bag, b.weight_per_cone, c.issue_basis, c.booking_no, c.buyer_id, c.buyer_job_no, a.yarn_count_id,a.yarn_comp_percent1st,a.yarn_comp_type1st");

	}

		$all_req_no = '';
		$all_prod_id = '';
		$order_qnty_val_sum=$order_amount_val_sum=$no_of_bags_val_sum=0;
		$tot_return_qty = $tot_bag = $tot_cone = $tot_w_bag = $tot_w_cone = 0;
		foreach ($sql_result as $row) {
			if ($i % 2 == 0) $bgcolor = "#E9F3FF"; else $bgcolor = "#FFFFFF";
			if ($row[csf('requisition_no')] != '') {
				if ($all_req_no == '') $all_req_no = $row[csf('requisition_no')]; else $all_req_no .= ',' . $row[csf('requisition_no')];
				if ($all_prod_id == '') $all_prod_id = $row[csf('po_id')]; else $all_prod_id .= ',' . $row[csf('po_id')];
			}
			$order_qnty_val = $row[csf('cons_quantity')];
			$order_qnty_val_sum += $order_qnty_val;

			$order_amount_val = $row[csf('order_amount')];
			$order_amount_val_sum += $order_amount_val;

			$no_of_bags_val = $row[csf('no_of_bags')];
			//$no_of_bags_val_sum += $no_of_bags_val;

			$po_id = explode(",", $row[csf('po_id')]);
			$po_no = '';
			$style_ref = '';
			$job_no = '';
			$buyer = '';
				//$data=explode('*',$data);
			$productdtls = $row[csf('product_name_details')];
			$productArr = explode(' ', $productdtls);

			$proddtls = '';
			if ($productArr[0] != '' && $productArr[1] != '' && $productArr[2] != '' && $productArr[3] != '' && $productArr[4] != '' && $productArr[5] != '') {
				$proddtls = $productArr[0] . ', ' . $productArr[1] . ' ' . $productArr[2] . '%, ' . $productArr[3] . ' ' . $productArr[4] . "%, " . $productArr[5] . ", " . $productArr[6];
			} else if ($productArr[0] != '' && $productArr[1] != '' && $productArr[2] != '' && $productArr[3] != '' && $productArr[4] != '') {
				$proddtls = $productArr[0] . ', ' . $productArr[1] . ' ' . $productArr[2] . ' %, ' . $productArr[3] . ', ' . $productArr[4];
			} else if ($productArr[0] != '' && $productArr[1] != '' && $productArr[2] != '' && $productArr[3] != '') {
				$proddtls = $productArr[0] . ', ' . $productArr[1] . ' ' . $productArr[2] . ' %, ' . $productArr[3];
			} else if ($productArr[0] != '' && $productArr[1] != '' && $productArr[2] != '') {
				$proddtls = $productArr[0] . ', ' . $productArr[1] . ' ' . $productArr[2] . ' %, ';
			} else if ($productArr[0] != '' && $productArr[1] != '') {
				$proddtls = $productArr[0] . ', ' . $productArr[1];
			} else if ($productArr[0] != '') {
				$proddtls = $productArr[0];
			} else {
				$proddtls = '';
			}

			$internal_ref = '';
			$file_no = '';
			if ($row[csf('issue_basis')] == 1 || $row[csf('issue_basis')] == 2) {
				foreach ($po_id as $val) {
					if ($po_no == '') $po_no = $po_array[$val]['no']; else $po_no .= ", " . $po_array[$val]['no'];
					if ($job_no == '') $job_no = $po_array[$val]['job_no'];
					if ($style_ref == '') $style_ref = $po_array[$val]['style_ref'];
					if ($buyer == '') $buyer_name = $po_array[$val]['buyer_name'];

					if ($internal_ref == '') $internal_ref = $po_array[$val]['grouping']; else $internal_ref .= "," . $po_array[$val]['grouping'];
					if ($file_no == '') $file_no = $po_array[$val]['file_no']; else $file_no .= "," . $po_array[$val]['file_no'];
				}
				$job_ref = array_unique(explode(",", rtrim($internal_ref, ", ")));
				$job_file = array_unique(explode(",", rtrim($file_no, ", ")));
				$ref_cond = '';
				foreach ($job_ref as $ref) {
						//$ref_cond.=", ".$ref;
					if ($ref_cond == '') $ref_cond = $ref; else $ref_cond .= ", " . $ref;
				}
				$file_con = '';
				foreach ($job_file as $file) {
					if ($file_con == '') $file_cond = $file; else $file_cond .= ", " . $file;
				}

				$buyer_job = '';
				if ($row[csf('issue_basis')] == 1) {
					if ($dataArray[0][csf('issue_purpose')] == 8) {
						$buyer_job = $buyer_arr[$row[csf('buyer_id')]];
					} else {
						$buyer_job = $buyer_arr[$job_array[$row[csf('buyer_job_no')]]['buyer']];
						if ($row[csf('buyer_job_no')] != "") {
							$buyer_job = $buyer_arr[$job_array[$row[csf('buyer_job_no')]]['buyer']] . ' & ' . $row[csf('buyer_job_no')];
						}
					}
				} else if ($row[csf('issue_basis')] == 2) {
					$buyer_job = '';
				}
			} else if ($row[csf('issue_basis')] == 3) {
					//$ex_data = array_unique(explode(",",$po_id_req_array[$row[csf('requisition_no')]]));
					//print_r($ex_data);

				if ($is_sales_array[$row[csf('requisition_no')]] == 1) {
					$buyer_job = '';
					foreach (array_unique($po_id) as $val) {
						if ($po_no == '') $po_no = $job_no_array[$val]['job_no']; else $po_no .= ", " . $job_no_array[$val]['job_no'];
						if ($style_ref == '') $style_ref = $job_no_array[$val]['style_ref'];

						if ($buyer_job == '') {
							if ($job_no_array[$val]['within_group'] == 1) {
								$buyer_job = $company_library[$job_no_array[$val]['buyer_id']];
							} else {
								$buyer_job = $buyer_arr[$job_no_array[$val]['buyer_id']];
							}
						}
					}
				} else {
					foreach ($po_id as $val) {
						if ($po_no == '') $po_no = $po_array[$val]['no']; else $po_no .= ", " . $po_array[$val]['no'];
						if ($job_no == '') $job_no = $po_array[$val]['job_no'];
						if ($style_ref == '') $style_ref = $po_array[$val]['style_ref'];
						if ($buyer == '') $buyer_name = $po_array[$val]['buyer_name'];

						if ($internal_ref == '') $internal_ref = $po_array[$val]['grouping']; else $internal_ref .= "," . $po_array[$val]['grouping'];
						if ($file_no == '') $file_no = $po_array[$val]['file_no']; else $file_no .= "," . $po_array[$val]['file_no'];
					}

					$job_ref = array_unique(explode(",", rtrim($internal_ref, ", ")));
					$job_file = array_unique(explode(",", rtrim($file_no, ", ")));

					$ref_cond = '';
					foreach ($job_ref as $ref) {
							//$ref_cond.=", ".$ref;
						if ($ref_cond == '') $ref_cond = $ref; else $ref_cond .= ", " . $ref;
					}

					$file_con = '';
					foreach ($job_file as $file) {
						if ($file_con == '') $file_cond = $file; else $file_cond .= ", " . $file;
					}
					if ($job_no != '') {
						$buyer_job = $buyer_arr[$buyer_name] . ' & ' . $job_no;
					} else {
						$buyer_job = $buyer_arr[$buyer_name];
					}
				}
			} else {
				foreach (array_unique($po_id) as $val) {
					if ($po_no == '') $po_no = $job_no_array[$val]['job_no']; else $po_no .= ", " . $job_no_array[$val]['job_no'];
					if ($style_ref == '') $style_ref = $job_no_array[$val]['style_ref'];
					if ($buyer_job == '') {
						if ($job_no_array[$val]['within_group'] == 1) {
							$buyer_job = $company_library[$job_no_array[$val]['buyer_id']];
						} else {
							$buyer_job = $buyer_arr[$job_no_array[$val]['buyer_id']];
						}
					}
				}
			}
			

			$no_bag_cone = "";
			$wt_bag_cone = "";
			if ($row[csf('cone_per_bag')] == "" || $row[csf('cone_per_bag')] == 0) $no_bag_cone = 'N:' . $no_of_bags_val; else $no_bag_cone = 'N:' . $no_of_bags_val . ' & ' . $row[csf('cone_per_bag')];

				if ($row[csf('weight_per_cone')] == "" || $row[csf('weight_per_cone')] == 0) $wt_bag_cone = 'W:' . $row[csf('weight_per_bag')]; else $wt_bag_cone = 'W:' . $row[csf('weight_per_bag')] . ' & ' . $row[csf('weight_per_cone')];
			?>
			<tr bgcolor="<? echo $bgcolor; ?>" style="font-size:13px">
				<td width="20"><? echo $i; ?></td>
				<td width="45">
					<div style="word-wrap:break-word; width:45px"><? if ($row[csf('requisition_no')] != 0) echo $row[csf('requisition_no')]; else echo '&nbsp;'; ?></div>
				</td>
				<td width="50">
					<div style="word-wrap:break-word; width:50px"><? echo $row[csf('lot')]; ?></div>
				</td>
				<td width="65">
					<div style="word-wrap:break-word; width:65px"><? echo $yarn_type[$row[csf('yarn_type')]]; ?></div>
				</td>
				<td width="210">
					<div style="word-wrap:break-word; width:210px">
						<?
                    //echo $proddtls;
						echo $count_arr[$row[csf('yarn_count_id')]]." ".$composition[$row[csf('yarn_comp_type1st')]]." ".$row[csf('yarn_comp_percent1st')]."% ".$yarn_type[$row[csf('yarn_type')]]." ".$color_name_arr[$row[csf('color')]];
						?>
					</div>
				</td>


				<td width="65">
					<div style="word-wrap:break-word; width:65px"><? echo $color_name_arr[$row[csf('dyeing_color_id')]]; ?>
					&nbsp;</div>
				</td>

				<td width="100">
					<div style="word-wrap:break-word; width:100px"><? echo $supplier_name_library[$row[csf('supplier_id')]]; ?></div>
				</td>

				<td align="right"
				width="60"><? echo number_format($row[csf('cons_quantity')], 3, '.', ''); ?></td>
				<td align="right"
				width="60"><? echo number_format($row[csf('returnable_qnty')], 2, '.', ''); ?></td>
				<td width="80">
					<div style="word-wrap:break-word; width:80px"><? echo $no_bag_cone . '<br>' . $wt_bag_cone ?>
					&nbsp;</div>
				</td>
				<td width="80">
					<div style="word-wrap:break-word; width:80px"><? echo $store_arr[$row[csf('store_id')]]; ?></div>
				</td>
				<td width="100">
					<div style="word-wrap:break-word; width:100px"><? echo $buyer_job; ?></div>
				</td>
				<td width="160">
					<div style="word-wrap:break-word; width:160px"><? echo $po_no;
					if ($style_ref != "") echo ' & ' . $style_ref; else echo '&nbsp;'; ?></div>
				</td>
				<td>
					<div style="word-wrap:break-word; width:80px"><? echo ltrim($ref_cond, ", ");
					if ($file_cond != "") echo ' & ' . ltrim($file_cond, ", "); else echo '&nbsp;'; ?></div>
				</td>
			</tr>
			<?

			$uom_unit = "Kg";
			$uom_gm = "Grams";
			$tot_return_qty += $row[csf('returnable_qnty')];
			$tot_bag += $no_of_bags_val;
			$tot_cone += $row[csf('cone_per_bag')];
			$tot_w_bag += $row[csf('weight_per_bag')];
			$tot_w_cone += $row[csf('weight_per_cone')];
			$req_no = $row[csf('requisition_no')];
			$i++;
		}
		?>
		<tr bgcolor="#CCCCCC" style="font-size:13px">
			<td align="right" colspan="7"><b>Total</b></td>
			<td align="right">
				<b><? echo $format_total_amount = number_format($order_qnty_val_sum, 3, '.', ''); ?></b>
			</td>
			<td align="right"><? echo number_format($tot_return_qty, 2, '.', ''); ?></td>
			<td>
				<?
					if($tot_bag && $tot_cone==0){ echo 'N:' . number_format($tot_bag, 2); }
					else if ($tot_bag && $tot_cone) echo 'N:' . number_format($tot_bag, 2).' & ' . number_format($tot_cone, 2);
					if($tot_w_bag && $tot_w_cone==0){ echo 'W:' . number_format($tot_w_bag, 2); }
					else if ($tot_w_bag && $tot_w_cone) echo 'W:' . number_format($tot_w_bag, 2).' & ' . number_format($tot_w_cone, 2);
			?></td>
			<td align="right" colspan="4">&nbsp;</td>
		</tr>
		<tr>
			<td colspan="14" align="left"><b>In Word: <? echo number_to_words($format_total_amount, $uom_unit, $uom_gm); ?></b></td>
		</tr>
		
    </table>
   


	</div>
	<div>
	<? echo signature_table(114, $data[0], $width.'px',$template_id); ?>
	</div> 
 <script type="text/javascript" src="../../js/jquery.js"></script>
      <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
     <script>

	function generateBarcode( valuess ){
		   
			var value = valuess;//$("#barcodeValue").val();
		 // alert(value)
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='bmp';// $("input[name=renderer]:checked").val();
			 
			var settings = {
			  output:renderer,
			  bgColor: '#FFFFFF',
			  color: '#000000',
			  barWidth: 1,
			  barHeight: 30,
			  moduleSize:5,
			  posX: 10,
			  posY: 20,
			  addQuietZone: 1
			};
			$("#barcode_img_id").html('11');
			 value = {code:value, rect: false};
			
			$("#barcode_img_id").show().barcode(value, btype, settings);
		} 
	 generateBarcode('<? echo $data[1]; ?>');
	 </script>
	<?
    exit();
}

if ($action=="get_out_entry_print12")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[5];
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$brand_arr=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");


	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,vhicle_number,com_location_id,mobile_no,issue_id,security_lock_no from inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 ";
	//echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	$issue_id=$dataArray[0][csf('issue_id')];
	$bags_cone_arr=array();
	$prod_id=array();
	$brand_lot_arr=array();
	if($basis==2 || $basis==21)
	{
		if($basis==21)
		{
			$challan_nos =explode(",",$challan_no);
			$challanNos="";
			foreach ($challan_nos as $value) {
				$challanNos.="'".$value."',";
			}
			$challanNos= chop($challanNos,",");
			$sqls = "select a.id,a.issue_number, a.company_id, a.supplier_id, a.issue_date, a.item_category, a.received_id, a.received_mrr_no, b.no_of_bags, b.cone_per_bag, b.cons_quantity, b.cons_uom, b.rcv_rate as cons_rate, b.rcv_amount as cons_amount, c.product_name_details, c.id as prod_id   
			from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id
			where a.id=b.mst_id and b.item_category=1 and b.transaction_type=3 and a.issue_number in($challanNos) and a.status_active=1 and b.status_active=1";
		}
		else
		{
			$sqls="SELECT a.id,a.prod_id,a.no_of_bags,a.cone_per_bag from inv_transaction a,inv_gate_pass_mst b,inv_gate_pass_dtls c where a.id=c.challan_no and b.id=c.mst_id  and b.sys_number='$data[1]' group by a.id,a.prod_id,a.no_of_bags,a.cone_per_bag ";	
		}

		foreach(sql_select($sqls) as $val)
		{
			$bags_cone_arr[$val[csf("id")]]["bags"]=$val[csf("no_of_bags")];
			$bags_cone_arr[$val[csf("id")]]["cone"]=$val[csf("cone_per_bag")];
			$bags_cone_arr[$val[csf("id")]]["prod_id"]=$val[csf("prod_id")];
			$prod_id[$val[csf("prod_id")]]=$val[csf("prod_id")];
		}
		//print_r($bags_cone_arr);
		$prod_ids=0;
		if(count($prod_id)>0)
		{
			$prod_ids=implode(",", $prod_id);
		}

		$sql2="SELECT  id,brand,lot  from product_details_master where  id in($prod_ids) ";
		foreach(sql_select($sql2) as $val)
		{
			$brand_lot_arr[$val[csf("id")]]["brand"]=$brand_arr[$val[csf("brand")]];
			$brand_lot_arr[$val[csf("id")]]["lot"]=$val[csf("lot")];
			 
		}
		//print_r($bags_cone_arr);

	}


	if($within_group==2)
	{
		//echo $dataArray[0][csf('sent_to')].'aaaaaaaaaaaaa';
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	
	$copy_no=array(1,2,3); //for Dynamic Copy here 
	foreach($copy_no as $cid)
	{
		if($show_item==1)
		{
			$width=1150;
			$colspan=5;
		}
		else
		{
			$width=1150;
			$colspan=5;
			$colspan2=2;
		}
		//echo $pid.'<br>';
	$com_dtls = fnc_company_location_address($company, $location, 2);
	?>
	<div style="width:<? echo $width;?>px;" align="center">
		<table width="<? echo $width;?>px" cellspacing="0" align="center" border="0">
			<tr>
			<tr>
				<td  align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="45" width="45"></td>
				<td colspan="7" align="center"  style="font-size:xx-large;"><strong style="margin-left:100px" ><? echo $com_dtls[0]; ?><span style="font-size:x-large; margin-left:200px !important;"><? echo $cid;?><sup><?php if($cid==1) { echo 'st';} elseif($cid==2) { echo  'nd';} else{ echo 'rd';} ?></sup> Copy</span></strong>
				<div style="float:right;width:34%; margin-top:10px; text-align:right">
					&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
				</div>
				</td>
			
			
			
			</tr>
			<tr class="form_caption">
				<td colspan="8" align="center">
					<?
					echo $com_dtls[1];
					/*$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
						//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
						foreach ($nameArray as $result)
						{ 
							echo $result[csf('plot_no')]; 
							echo $result[csf('level_no')];
							echo $result[csf('road_no')];
							echo $result[csf('block_no')];
							echo $result[csf('city')];
							echo $result[csf('zip_code')];
							echo $result[csf('province')].',';
							echo $country_arr[$result[csf('country_id')]]; 
							echo $result[csf('email')]; 
							echo $result[csf('website')];
						}*/
					?> 
					<div style="width:34%; text-align:center">
					&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
				</div>
				</td>
			</tr>
			<tr>
				<td style="display:none" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
			</tr>
			<tr>
				<td colspan="8" align="center" style="font-size:x-large"><strong><u>Gate Pass </u>/<u> Challan</u></strong></td>
			</tr>
			<tr>
				<td width="160"><strong>Sent To:</strong></td><td width="400px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
				<td width="160"><strong>Gate Pass ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
			
			</tr>
			<tr>
				<td><strong>To Location:</strong></td><td><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
				<td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
			</tr>
			<tr>
				<td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
				<td><strong>Out-Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
			</tr>
			<tr>
				<td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
				<td width="125"><strong>Challan/System No:</strong></td><td width="175px" colspan="2"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
			</tr>
			<tr>
				<td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
				<td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>    
			</tr>
			<tr>
				<td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
				<td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>         
			</tr>
			<tr>
				<td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
				<td><strong>Est. Return Date 	 :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
			</tr>
			<tr>
				<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
				<td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
			</tr>
			<tr>
				<td><strong>Vehicle No:</strong></td>
				<td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
			</tr>
			<tr>
				<td><strong>Bar Code:</strong></td><td  id="barcode_img_id_<? echo $cid; ?>"></td> 
				<td><strong>Mobile No:</strong></td><td><? echo $dataArray[0][csf('mobile_no')]; ?></td>
			</tr>
			<tr>
				<td></td><td></td> 
				<td><strong>Security Lock No:</strong></td><td><? echo $dataArray[0][csf('security_lock_no')]; ?></td>
			</tr>

		</table>
		<br>
		<table align="center" cellspacing="0" width="<? echo $width;?>px;"  border="1" rules="all" class="rpt_table" >
			<thead bgcolor="#dddddd" align="center">
				<th width="30">SL</th>
				<th width="100" align="center">Item Category</th>
				<? 
				if($basis==2)
				{
					?>
					<th width="70" align="center">Brand</th>
					<?

				}
				?>
				<th width="100" align="center">Sample</th>
				<th width="200" align="center">Item Description</th>
				<? 
				if($basis==2 || $basis==21)
				{
					?>
					<th width="70" align="center">Lot</th>
					<?

				}
				?>
				<th width="50" align="center">UOM</th>
				<th width="80" align="center">Quantity</th>
				<? 
				if($basis==2 || $basis==21)
				{
					?>
					<th width="70" align="center">No. of Bag/Crtn</th>
					<th width="70" align="center">No.of Cone</th>
					
					<?

				}
				
				if($show_item==1)
				{
				?>
				<th width="50" align="center">Rate</th> 
				<th width="80" align="center">Amount </th>
				<?
				}
				if ($dataArray[0][csf('basis')]==33) 
				{
				?>
					<th width="100" align="center">Customer Buyer</th>
				<?
				}
				else
				{
				?>
					<th width="100" align="center">Buyer</th>
				<?
				}
				?>
				<th width="100" align="center">Style</th>
				<th width="80" align="center">Buyer Order </th>
				<th align="center">Remarks</th>
			</thead>
		<?
		$i=1;
		$gate_id=$dataArray[0][csf('id')];
		$sql_dtls= " SELECT id,item_category_id,sample_id, item_description,uom_qty, quantity, uom, rate, amount,buyer_order_id,buyer_order, remarks,challan_no,no_of_bags from  inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 ";
		if($data[4]==8) //subcon challan (grey fabric)
		{
			$sql_result_subcon_grey=sql_select($sql_dtls);
			$buyer_orderIDs="";
			foreach($sql_result_subcon_grey as $row)
			{
				$buyer_orderIDs.=$row[csf('buyer_order')];
			}
			$buyer_orderID=chop($buyer_orderIDs,',');
			
			$sql_subcon_order_buyer=sql_select("select order_no,cust_buyer from subcon_ord_dtls where order_no in('$buyer_orderID') and status_active=1 and is_deleted=0");
			foreach($sql_subcon_order_buyer as $row)
			{
				$subcon_buyer_arr[$row[csf('order_no')]]['cust_buyer']=$row[csf('cust_buyer')];
			}
		}
		
		//echo $sql_dtls;
		$uom_check=array();
		$sql_result=sql_select($sql_dtls);
		$tot_qty=0;$tot_amount=0;
		foreach($sql_result as $row)
		{
			$ref_id=$row[csf("challan_no")];
			if ($i%2==0)  
				$bgcolor="#E9F3FF";
			else
				$bgcolor="#FFFFFF";
				
				$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
				$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
				//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
				$uom_check[$row[csf('uom')]]=$row[csf('uom')];
				?>
				<tr bgcolor="<? echo $bgcolor; ?>">
					<td><? echo $i; ?></td>
					<td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
					<? 
					if($basis==2)
					{
						?>
						<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["brand"]; ?></td>
						<?

					}
					?>
					<td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
					<td><?  echo $row[csf('item_description')]; ?></td>
					<? 
					if($basis==2 || $basis==21)
					{
						?>
						<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["lot"]; ?></td>
						<?

					}
					?>

					<td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
					<td align="right"><? echo $row[csf('quantity')]; ?></td>
					<? 
					if($basis==2 || $basis==21)
					{
						?>
						<td width="70" align="center"><? if($basis==21){echo $row[csf('no_of_bags')]; $no_of_bags+=$row[csf('no_of_bags')];}else{echo $bags_cone_arr[$ref_id]["bags"]; $no_of_bags+=$bags_cone_arr[$ref_id]["bags"];} ?></td>
						<td width="70" align="center"><? echo $bags_cone_arr[$ref_id]["cone"];?></td>                	 
						<?

					}
					
					if($show_item==1)
					{
					?>
					<td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
					<td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
					<?
					}
					?>
					<td align="center"><? 
					if($data[4]==8)
					{
						echo $subcon_buyer_arr[$row[csf('buyer_order')]]['cust_buyer'];
					}
					else
					{
						echo $buyer_library[$buyer]; 
					}
					?></td>
					<td><? echo $style_ref_no; ?></td>
					<td><? echo $row[csf('buyer_order')]; ?></td>
					<td><? echo $row[csf('remarks')]; ?></td>
				</tr>
			<?php
			$i++;
			
			$tot_qty+=$row[csf('quantity')];
			// $no_of_bags+=$row[csf('no_of_bags')];
			$tot_amount+=$row[csf('amount')];
		}
		//$tot_check=array();
		if($basis==2)$colspan+=2;
		if($basis==21)$colspan+=1;
		if(count($uom_check)==1)
		{

		?>
		<tfoot bgcolor="#CCCCCC">
			<tr>
			<td colspan="<? echo $colspan;?>" align="right"> <b> Total</b></td>
			<td align="right"><b><? echo number_format($tot_qty,2);?></b> </td>
			<?
			if($basis==2 || $basis==21)
			{
				?>
			<td align="right"><b><? echo number_format($no_of_bags,2);?></b> </td>
			<td align="right"><b></b> </td>


				<?
			}
			if($show_item==1)
			{
			?>
			<td> </td>
			<td align="right"><b> <? echo number_format($tot_amount,2);?></b> </td>
			<?
				}
			?>
			<td colspan="<? echo 4+$colspan2;?>"></td>
			</tr>
		</tfoot>
		<?
		}
		$width_sign=$width.'px';
		?>
		</table>
	</div>
	<div>
		<? echo signature_table(114, $data[0], $width_sign,$template_id); ?>
		
		<script type="text/javascript" src="../../js/jquery.js"></script>
		<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
		<script>

		function generateBarcode( valuess ){
			
				var value = valuess;//$("#barcodeValue").val();
			// alert(value)
				var btype = 'code39';//$("input[name=btype]:checked").val();
				var renderer ='bmp';// $("input[name=renderer]:checked").val();
				
				var settings = {
				output:renderer,
				bgColor: '#FFFFFF',
				color: '#000000',
				barWidth: 1,
				barHeight: 30,
				moduleSize:5,
				posX: 10,
				posY: 20,
				addQuietZone: 1
				};
				$("#barcode_img_id_<? echo $cid; ?>").html('11');
				value = {code:value, rect: false};
				
				$("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
			} 
		generateBarcode('<? echo $data[1]; ?>');
		</script>
	</div>
	<p style="page-break-after:always;"></p>
	<?
	}
}

if ($action=="get_out_entry_print21")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[5];
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$brand_arr=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");


	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
	$sql="SELECT id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,vhicle_number,com_location_id,mobile_no,issue_id from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 ";
	//echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	$issue_id=$dataArray[0][csf('issue_id')];
	$bags_cone_arr=array();
	$prod_id=array();
	$brand_lot_arr=array();
	if($basis==2 || $basis==21)
	{
		if($basis==21)
		{
			$challan_nos =explode(",",$challan_no);
			$challanNos="";
			foreach ($challan_nos as $value) {
				$challanNos.="'".$value."',";
			}
			$challanNos= chop($challanNos,",");
			$sqls = "select a.id,a.issue_number, a.company_id, a.supplier_id, a.issue_date, a.item_category, a.received_id, a.received_mrr_no, b.no_of_bags, b.cone_per_bag, b.cons_quantity, b.cons_uom, b.rcv_rate as cons_rate, b.rcv_amount as cons_amount, c.product_name_details, c.id as prod_id   
			from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id
			where a.id=b.mst_id and b.item_category=1 and b.transaction_type=3 and a.issue_number in($challanNos) and a.status_active=1 and b.status_active=1";
		}
		else
		{
			$sqls="SELECT a.id,a.prod_id,a.no_of_bags,a.cone_per_bag from inv_transaction a,inv_gate_pass_mst b,inv_gate_pass_dtls c where a.id=c.challan_no and b.id=c.mst_id  and b.sys_number='$data[1]' group by a.id,a.prod_id,a.no_of_bags,a.cone_per_bag ";	
		}

		foreach(sql_select($sqls) as $val)
		{
			$bags_cone_arr[$val[csf("id")]]["bags"]=$val[csf("no_of_bags")];
			$bags_cone_arr[$val[csf("id")]]["cone"]=$val[csf("cone_per_bag")];
			$bags_cone_arr[$val[csf("id")]]["prod_id"]=$val[csf("prod_id")];
			$prod_id[$val[csf("prod_id")]]=$val[csf("prod_id")];
		}
		//print_r($bags_cone_arr);
		$prod_ids=0;
		if(count($prod_id)>0)
		{
			$prod_ids=implode(",", $prod_id);
		}

		$sql2="SELECT  id,brand,lot  from product_details_master where  id in($prod_ids) ";
		foreach(sql_select($sql2) as $val)
		{
			$brand_lot_arr[$val[csf("id")]]["brand"]=$brand_arr[$val[csf("brand")]];
			$brand_lot_arr[$val[csf("id")]]["lot"]=$val[csf("lot")];
			 
		}
		//print_r($bags_cone_arr);

	}


	if($within_group==2)
	{
		//echo $dataArray[0][csf('sent_to')].'aaaaaaaaaaaaa';
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	
	$copy_no=array(1,2,3); //for Dynamic Copy here 
	foreach($copy_no as $cid)
	{
		if($show_item==1)
		{
			$width=1150;
			$colspan=5;
		}
		else
		{
			$width=1150;
			$colspan=5;
			$colspan2=2;
		}
		//echo $pid.'<br>';
	  $com_dtls = fnc_company_location_address($company, $location, 2);
	 ?>
	 <div style="width:<? echo $width;?>px;" align="center">
		<table width="<? echo $width;?>px" cellspacing="0" align="center" border="0">
		
			<tr>
				<td rowspan="2" align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="70" width="200"></td>
				<td colspan="2" align="center"  style="font-size:xx-large;"><strong style="margin-left:100px" ><? echo $com_dtls[0]; ?></strong>
				<!-- <div style="float:right;width:34%; margin-top:10px; text-align:right">
					&nbsp;<? //if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
				</div> -->
				</td>
				<td rowspan="2">
                  <strong><span style="font-size:x-large; margin-left:50px !important;"><? ?><?php if($cid==1) { echo 'Receiver Copy';} elseif($cid==2) { echo  'Store Copy';} else{ echo 'Gate Copy';} ?></span></strong>
				</td>
			</tr>
			<tr class="form_caption">
				<td colspan="2" align="center">
					<?
					echo $com_dtls[1];
					/*$nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$data[0]");
						//$nameArray=sql_select( "select location_name from lib_location where company_id =$data[0]"); 
						foreach ($nameArray as $result)
						{ 
							echo $result[csf('plot_no')]; 
							echo $result[csf('level_no')];
							echo $result[csf('road_no')];
							echo $result[csf('block_no')];
							echo $result[csf('city')];
							echo $result[csf('zip_code')];
							echo $result[csf('province')].',';
							echo $country_arr[$result[csf('country_id')]]; 
							echo $result[csf('email')]; 
							echo $result[csf('website')];
						}*/
					?> 
					<div style="width:34%; text-align:center">
					&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo $location_library[$dataArray[0][csf('com_location_id')]];?>
				</div>
				</td>
			</tr>
			<tr>
				<td style="display:none" colspan="4" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
			</tr>
			<tr>
				<td colspan="4" align="center" style="font-size:x-large"><strong><u>Gate Pass </u>/<u> Challan</u></strong></td>
			</tr>
			<tr>
				<td width="160"><strong>Sent To:</strong></td><td width="400px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
				<td width="160"><strong>Gate Pass ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
			
			</tr>
			<tr>
				<td><strong>To Location:</strong></td><td><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
				<td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
			</tr>
			<tr>
				<td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
				<td><strong>Out-Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
			</tr>
			<tr>
				<td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
				<td width="125"><strong>Challan/System No:</strong></td><td width="175px" colspan="2"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
			</tr>
			<tr>
				<td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
				<td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>    
			</tr>
			<tr>
				<td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
				<td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>         
			</tr>
			<tr>
				<td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
				<td><strong>Est. Return Date 	 :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
			</tr>
			<tr>
				<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
				<td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
			</tr>
			<tr>
				<td><strong>Vehicle No:</strong></td>
				<td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
			</tr>
			<tr>
				<td><strong>Bar Code:</strong></td><td ><div  style=" margin-left:-7px; " id="barcode_img_id_<? echo $cid; ?>">
					
				</div></td> 
				<td><strong>Mobile No:</strong></td><td><? echo $dataArray[0][csf('mobile_no')]; ?></td>
			</tr>

		</table>
		<br>
		<table align="center" cellspacing="0" width="<? echo $width;?>px;"  border="1" rules="all" class="rpt_table" >
			<thead bgcolor="#dddddd" align="center">
				<th width="30">SL</th>
				<th width="100" align="center">Item Category</th>
				<? 
				if($basis==2)
				{
					?>
					<th width="70" align="center">Brand</th>
					<?

				}
				?>
				<th width="100" align="center">Sample</th>
				<th width="200" align="center">Item Description</th>
				<? 
				if($basis==2 || $basis==21)
				{
					?>
					<th width="70" align="center">Lot</th>
					<?

				}
				?>
				<th width="50" align="center">UOM</th>
				<th width="80" align="center">Quantity</th>
				<? 
				if($basis==2 || $basis==21)
				{
					?>
					<th width="70" align="center">No. of Bag/Crtn</th>
					<th width="70" align="center">No.of Cone</th>
					
					<?

				}
				
				if($show_item==1)
				{
				?>
				<th width="50" align="center">Rate</th> 
				<th width="80" align="center">Amount </th>
				<?
				}
				if ($dataArray[0][csf('basis')]==33) 
				{
				?>
					<th width="100" align="center">Customer Buyer</th>
				<?
				}
				else
				{
				?>
					<th width="100" align="center">Buyer</th>
				<?
				}
				?>
				<th width="100" align="center">Style</th>
				<th width="80" align="center">Buyer Order </th>
				<th align="center">Remarks</th>
			</thead>
		<?
		$i=1;
		$gate_id=$dataArray[0][csf('id')];
		$sql_dtls= " SELECT id,item_category_id,sample_id, item_description,uom_qty, quantity, uom, rate, amount,buyer_order_id,buyer_order, remarks,challan_no,no_of_bags from  inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 ";
		if($data[4]==8) //subcon challan (grey fabric)
		{
			$sql_result_subcon_grey=sql_select($sql_dtls);
			$buyer_orderIDs="";
			foreach($sql_result_subcon_grey as $row)
			{
				$buyer_orderIDs.=$row[csf('buyer_order')];
			}
			$buyer_orderID=chop($buyer_orderIDs,',');
			
			$sql_subcon_order_buyer=sql_select("select order_no,cust_buyer from subcon_ord_dtls where order_no in('$buyer_orderID') and status_active=1 and is_deleted=0");
			foreach($sql_subcon_order_buyer as $row)
			{
				$subcon_buyer_arr[$row[csf('order_no')]]['cust_buyer']=$row[csf('cust_buyer')];
			}
		}
		
		//echo $sql_dtls;
		$uom_check=array();
		$sql_result=sql_select($sql_dtls);
		$tot_qty=0;$tot_amount=0;
		foreach($sql_result as $row)
		{
			$ref_id=$row[csf("challan_no")];
			if ($i%2==0)  
				$bgcolor="#E9F3FF";
			else
				$bgcolor="#FFFFFF";
				
				$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
				$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
				//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
				$uom_check[$row[csf('uom')]]=$row[csf('uom')];
				?>
				<tr bgcolor="<? echo $bgcolor; ?>">
					<td><? echo $i; ?></td>
					<td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
					<? 
					if($basis==2)
					{
						?>
						<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["brand"]; ?></td>
						<?

					}
					?>
					<td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
					<td><?  echo $row[csf('item_description')]; ?></td>
					<? 
					if($basis==2 || $basis==21)
					{
						?>
						<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["lot"]; ?></td>
						<?

					}
					?>

					<td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
					<td align="right"><? echo $row[csf('quantity')]; ?></td>
					<? 
					if($basis==2 || $basis==21)
					{
						?>
						<td width="70" align="center"><? if($basis==21){echo $row[csf('no_of_bags')];}else{echo $bags_cone_arr[$ref_id]["bags"];} ?></td>
						<td width="70" align="center"><? echo $bags_cone_arr[$ref_id]["cone"];?></td>                	 
						<?

					}
					
					if($show_item==1)
					{
					?>
					<td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
					<td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
					<?
					}
					?>
					<td align="center"><? 
					if($data[4]==8)
					{
						echo $subcon_buyer_arr[$row[csf('buyer_order')]]['cust_buyer'];
					}
					else
					{
						echo $buyer_library[$buyer]; 
					}
					?></td>
					<td><? echo $style_ref_no; ?></td>
					<td><? echo $row[csf('buyer_order')]; ?></td>
					<td><? echo $row[csf('remarks')]; ?></td>
				</tr>
			<?php
			$i++;
			
			$tot_qty+=$row[csf('quantity')];
			$tot_amount+=$row[csf('amount')];
		}
		//$tot_check=array();
		if($basis==2)$colspan+=2;
		if($basis==21)$colspan+=1;
		if(count($uom_check)==1)
		{

		?>
		<tfoot bgcolor="#CCCCCC">
			<tr>
			<td colspan="<? echo $colspan;?>" align="right"> <b> Total</b></td>
			<td align="right"><b><? echo number_format($tot_qty,2);?></b> </td>
			<?
			if($basis==2 || $basis==21)
			{
				?>
				<td colspan="2"></td>

				<?
			}
			if($show_item==1)
			{
			?>
			<td> </td>
			<td align="right"><b> <? echo number_format($tot_amount,2);?></b> </td>
			<?
				}
			?>
			<td colspan="<? echo 4+$colspan2;?>"></td>
			</tr>
		</tfoot>
		<?
		}
		$width_sign=$width.'px';
		?>
		</table>
	</div>
	<div>
		<? echo signature_table(114, $data[0], $width_sign,$template_id); ?>
		
		<script type="text/javascript" src="../../js/jquery.js"></script>
		<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
		<script>

		function generateBarcode( valuess ){
			
				var value = valuess;//$("#barcodeValue").val();
			// alert(value)
				var btype = 'code39';//$("input[name=btype]:checked").val();
				var renderer ='bmp';// $("input[name=renderer]:checked").val();
				
				var settings = {
				output:renderer,
				bgColor: '#FFFFFF',
				color: '#000000',
				barWidth: 1,
				barHeight: 30,
				moduleSize:5,
				posX: 10,
				posY: 20,
				addQuietZone: 1
				};
				$("#barcode_img_id_<? echo $cid; ?>").html('11');
				value = {code:value, rect: false};
				
				$("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
			} 
		generateBarcode('<? echo $data[1]; ?>');
		</script>
	</div>
	<p style="page-break-after:always;"></p>
	<?
	}
}

if ($action=="get_out_entry_print14")  // Print
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//echo "<pre>";
	//print_r($data);
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[5];
	//echo $company.'='.$location;die;
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$brand_arr=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");

	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );	
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,vhicle_number,com_location_id,mobile_no,remarks from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 ";
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	$bags_cone_arr=array();
	$prod_id=array();
	$brand_lot_arr=array();
	
	//echo $basis; die;
	
	if($basis==2)
	{
		$sqls="SELECT a.id,a.prod_id,a.no_of_bags,a.cone_per_bag from inv_transaction a,inv_gate_pass_mst b,inv_gate_pass_dtls c where a.id=c.challan_no and b.id=c.mst_id  and b.sys_number='$data[1]' group by a.id,a.prod_id,a.no_of_bags,a.cone_per_bag ";
		foreach(sql_select($sqls) as $val)
		{
			$bags_cone_arr[$val[csf("id")]]["bags"]=$val[csf("no_of_bags")];
			$bags_cone_arr[$val[csf("id")]]["cone"]=$val[csf("cone_per_bag")];
			$bags_cone_arr[$val[csf("id")]]["prod_id"]=$val[csf("prod_id")];
			$prod_id[$val[csf("prod_id")]]=$val[csf("prod_id")];
		}
		$prod_ids=0;
		if(count($prod_id)>0)
		{
			$prod_ids=implode(",", $prod_id);
		}

		$sql2="SELECT  id,brand,lot  from product_details_master where  id in($prod_ids) ";
		foreach(sql_select($sql2) as $val)
		{
			$brand_lot_arr[$val[csf("id")]]["brand"]=$brand_arr[$val[csf("brand")]];
			$brand_lot_arr[$val[csf("id")]]["lot"]=$val[csf("lot")];
			 
		}

	}	
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	/*$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}*/
	$order_array=array();
	
	if($basis==51)
	{
		$order_sql="select a.subcon_job, a.within_group, a.party_id as buyer_name, b.id, b.order_no, b.order_quantity, b.buyer_po_id,b.buyer_po_no, b.buyer_style_ref as style_ref_no, 
   b.buyer_buyer from subcon_ord_mst a, subcon_ord_dtls b where a.subcon_job=b.job_no_mst and a.entry_form=295 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	}
	else
	{
		$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	}
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	//print_r($order_array); 186
	/*$copy_no=array(1,2,3); //for Dynamic Copy here 
	foreach($copy_no as $cid)
	{*/
		if($show_item==1)
		{
			$width=1200;
			$colspan=6;
		}
		else
		{
			$width=1070;
			$colspan=6;			
		}
	$com_dtls = fnc_company_location_address($company, $location, 2);
	?>
	<div style="width:<? echo $width;?>px;" align="center">
	    <table width="<? echo $width;?>px" cellspacing="0" align="center" border="0">
	        <tr>
	            <td  align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="70" width="200"></td>
	            <td colspan="8" style="font-size:xx-large;"><strong ><? echo $com_dtls[0]; ?></strong>
	                <div style="float:right;width:34%; margin-top:10px; text-align:right">
	               	&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>"; ?>
	                </div> 
	            </td>	           
	        </tr>
	        <tr>
	            <td colspan="8" align="right" id="barcode_img_id_<? echo $cid; ?>"></td>         	           
	        </tr>
	        
	        <tr>
	        	<td style="" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
	        </tr>
	        <tr>
	            <td colspan="8" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
	        </tr>
	    </table> 

	    <table width="<? echo $width;?>px" cellspacing="0" align="center" border="1" style="margin-top: 10px;">
	        <tr>
	            <td width="160"><strong>System ID:</strong></td><td width="175px" style="font-size:20px"><? echo $dataArray[0][csf('sys_number')]; ?></td>
	            <td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
	            <td width="125"><strong>Out-Time:</strong></td><td width="175px" colspan="2"><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>	            
	        </tr>
	         <tr>
	            
	            <td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
	            <td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
	            <td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
	        </tr>
	        <tr>
	            <td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><? echo $send_to_company; ?></td>
	            <td><strong>Purpose:</strong></td><td width="175px" ><? echo $dataArray[0][csf('issue_purpose')]; ?></td>	           
	            <td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
	        </tr>
	        <tr>
	          
	            <td><strong>To Location:</strong></td><td width="85px" ><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>	           
	            <td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
	            <td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
	        </tr>
	        <tr>
	            <td><strong>Est. Return Date 	 :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
	            <td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
	            <td><strong>Remarks:</strong></td><td><? echo $dataArray[0][csf('remarks')]; ?></td> 
	            
	        </tr>	        
	        <tr>
		        <td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
		        <td><strong>Mobile No:</strong></td><td><? echo $dataArray[0][csf('mobile_no')]; ?></td>
				<td><strong>Vehicle No:</strong></td><td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
	        </tr>	       			
	    </table>
	    <br>
	    <table align="center" cellspacing="0" width="<? echo $width;?>px;"  border="1" rules="all" class="rpt_table" >
	        <thead bgcolor="#dddddd" align="center">
	            <th width="30">SL</th>
	            <th width="120" align="center">Challan No</th>
	            <th width="100" align="center">Item Category</th>
	            <th width="100" align="center">Sample</th>
	            <th width="250" align="center">Item Description</th>
	            <th width="50" align="center">UOM</th>
	            <th width="80" align="center">Quantity</th>
				<? 
	            if($show_item==1)
				{
					?>
		            <th width="50" align="center">Rate</th> 
		            <th width="80" align="center">Amount</th>
		            <?
				}				
				?>
				<th width="60" align="center">NO of Bags/Rolls/GMT</th>
	            <th width="100" align="center">Buyer Order</th>	            
	            <th align="center">Remarks</th>
	        </thead>
		<?
	    $i=1;
		$gate_id=$dataArray[0][csf('id')];
		$sql_dtls= " SELECT a.challan_no, b.id, b.item_category_id, b.sample_id, b.item_description, b.uom_qty, b.quantity, b.reject_qty, b.uom, b.rate, b.amount, b.buyer_order_id, b.buyer_order, b.remarks, b.no_of_bags from  inv_gate_pass_mst a, inv_gate_pass_dtls b where a.id=b.mst_id and b.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
		if($data[4]==8) //subcon challan (grey fabric)
		{
			$sql_result_subcon_grey=sql_select($sql_dtls);
			$buyer_orderIDs="";
			foreach($sql_result_subcon_grey as $row)
			{
				$buyer_orderIDs.=$row[csf('buyer_order')];
			}
			$buyer_orderID=chop($buyer_orderIDs,',');
			
			$sql_subcon_order_buyer=sql_select("select order_no,cust_buyer from subcon_ord_dtls where order_no in('$buyer_orderID') and status_active=1 and is_deleted=0");
			foreach($sql_subcon_order_buyer as $row)
			{
				$subcon_buyer_arr[$row[csf('order_no')]]['cust_buyer']=$row[csf('cust_buyer')];
			}
		}
		
		//echo $sql_dtls;
		$uom_check=array();
		$sql_result=sql_select($sql_dtls);
		$sql_count=count($sql_result);
		$tot_qty=0;$tot_amount=0;$no_of_bags_total=0;
		foreach($sql_result as $row)
		{
			$ref_id=$row[csf("challan_no")];
			if ($i%2==0) $bgcolor="#E9F3FF";
			else $bgcolor="#FFFFFF";				
			$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
			//echo $buyer; 9
			$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
			//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
			$uom_check[$row[csf('uom')]]=$row[csf('uom')];
			?>
			<tr bgcolor="<? echo $bgcolor; ?>">
                <td><? echo $i; ?></td>
                <td style="font-size: 12px;"><? echo $ref_id; ?></td>
                <td><? echo $item_category[$row[csf('item_category_id')]]; ?></td>	                
                <td><? echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
                <td><? echo $row[csf('item_description')]; ?></td> 
                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
                <td align="right"><? echo $row[csf('quantity')]; ?></td>              
                <? 
				if($show_item==1)
				{
					?>
	                <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
	                <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
	                <?
				}
				?>
				<td align="right"><? echo $row[csf('no_of_bags')]; ?></td>
                <td><? echo $row[csf('buyer_order')]; ?></td>
                <td><? echo $row[csf('remarks')]; ?></td>
			</tr>
			<?
	    	$i++;			
			$tot_qty+=$row[csf('quantity')];
			$tot_amount+=$row[csf('amount')];
			$no_of_bags_total+=$row[csf('no_of_bags')];
			// $inWordTxt=$unit_of_measurement[$row[csf('uom')]];
			$in_word_uom_qnty_arr[$row[csf('uom')]]+=$row[csf('quantity')];
	    }

		if(count($uom_check)==1)
		{
			?>
		    <tfoot bgcolor="#CCCCCC">
		        <tr>
			        <td colspan="<? echo $colspan;?>" align="right"><b>Total</b></td>
			        <td align="right"><b><? echo number_format($tot_qty,2);?></b></td>
			        <?
					if($show_item==1)
					{
						?>
			        	<td></td>
			        	<td align="right"><b><? echo number_format($tot_amount,2); ?></b></td>
			        	<?
					}
					?>
			        <td align="right" ><? echo number_format($no_of_bags_total,2); ?></td>
			        <td ></td>
			        <td ></td>
		        </tr>		        
			</tfoot>
		    <?
		}
		$width_sign=$width.'px';

		$inWordTxt="";
		foreach($in_word_uom_qnty_arr as $key=>$row)
		{
			$inWordTxt.=number_to_words(number_format($row,2),$unit_of_measurement[$key]).', '; 
		}
		?>
	    </table>
	    <span><h4 align="center">In Words : &nbsp;<? echo rtrim($inWordTxt,", ");?></h4></span>
	</div>
	<div>
		<? echo signature_table(114, $data[0], $width_sign,$template_id); ?>	    
	    <script type="text/javascript" src="../../js/jquery.js"></script>
	    <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
	    <script>
		function generateBarcode( valuess ){			   
			var value = valuess;//$("#barcodeValue").val();
		    // alert(value)
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='bmp';// $("input[name=renderer]:checked").val();
			 
			var settings = {
			  output:renderer,
			  bgColor: '#FFFFFF',
			  color: '#000000',
			  barWidth: 1,
			  barHeight: 30,
			  moduleSize:5,
			  posX: 10,
			  posY: 20,
			  addQuietZone: 1
			};
			$("#barcode_img_id_<? echo $cid; ?>").html('11');
			 value = {code:value, rect: false};
			
			$("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
		} 
		generateBarcode('<? echo $data[1]; ?>');
		</script>
	</div>
	<?
	exit();
}

if($action=="print_to_html_report_13") // Print 7
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//print_r ($data);
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[2];
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");

	$name_iso_Array=sql_select( "select iso_no from lib_iso where company_id=$company and status_active=1 and module_id=6 and menu_id=437");

	// echo $name_iso_Array[0]["ISO_NO"];
	
	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
	$sql="SELECT id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to,vhicle_number, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,com_location_id,remarks,mobile_no,delivery_company,returnable_gate_pass_reff, security_lock_no, driver_name from inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 "; 
	//echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
 	$sent_to=$dataArray[0][csf('sent_to')];
 	$delivery_company=$dataArray[0][csf('delivery_company')];
	

	$shipmodes=sql_select("select  b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no' and (b.shiping_mode is not null or b.shiping_mode!=0) ") ;
	 
	//$shipmode_cartoon=sql_select("select  b.total_carton_qnty as total_carton_qnty,b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no'") ;
	
	//print_r($shipmode_cartoon[0][TOTAL_CARTON_QNTY]);die;
	$shipmode_cartoon=sql_select("select  sum(b.total_carton_qnty) as total_carton_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no'") ;

	if($basis==1)
	{ 
		if($within_group==1)
		{
			//$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
		else
		{
			//$send_to_company=$dataArray[0][csf('sent_to')];		
		}
	}
	else if($basis==8 || $basis==9 || $basis==27)
	{
		//$send_to_company=$dataArray[0][csf('sent_to')];	
		$no_of_rolls = sql_select("select a.id,b.carton_roll as no_roll,b.reject_qty from subcon_delivery_mst a ,subcon_delivery_dtls b where a.id=b.mst_id  and a.delivery_no='$challan_no' and a.status_active=1 and a.is_deleted=0  and a.process_id in(2,4,3) ");
	}
	else if($basis==17)
	{
		$no_of_rolls=sql_select("select  b.mst_id,b.from_store, b.to_store, b.from_prod_id,b.to_order_id, b.to_prod_id, sum(b.transfer_qnty) as cons_quantity,
		b.yarn_lot,b.rate as cons_rate,b.transfer_value as cons_amount,b.brand_id,c.product_name_details,d.no_of_bags,b.roll as no_roll from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c,inv_transaction d 
		where a.id=b.mst_id and c.id=b.from_prod_id and b.from_prod_id=d.prod_id and a.transfer_system_id='$challan_no' and b.item_category=13 
		and b.status_active = '1' and b.is_deleted = '0' and d.no_of_bags is not NULL
		group by   b.mst_id,b.from_store, b.to_store, b.from_prod_id,b.to_order_id, b.to_prod_id,
		b.yarn_lot,b.rate,b.transfer_value ,b.brand_id,c.product_name_details,d.no_of_bags ,b.roll ");
	}
	else if($basis==11)
	{
		$no_of_rolls=sql_select("select a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity,b.batch_id,roll as no_roll
		from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
		where a.sys_number='$challan_no' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form=54 and b.entry_form=54");
	}
	else if($basis==12)
	{
		//$send_to_company=$supplier_name_library[$dataArray[0][csf('sent_to')]];
	}
	else if($basis==10)
	{
		$no_of_rolls=sql_select("select a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity,b.roll as no_roll
		from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
		where a.sys_number='$challan_no' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.entry_form=53 and b.entry_form=53");
	}
	else if($basis==15) //Finish Fabric Recv Return
	{
		//echo $mst_challan;
		
		 $no_of_rolls =sql_select("select a.id as issue_id, a.item_category, a.received_id, a.received_mrr_no, b.id as trans_id, b.cons_quantity as cons_quantity,b.cons_uom, b.cons_rate, b.cons_amount, c.product_name_details, c.id as prod_id  ,b.no_of_roll as no_roll 
			from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id
			where a.id=b.mst_id and b.item_category=2 and b.transaction_type=3 and  a.issue_number='$challan_no' order by b.id");	   
	}
	else if($basis==4)
	{
		$no_of_rolls = sql_select("SELECT a.id,a.transaction_type,a.item_category,b.product_name_details,a.cons_rate,a.cons_quantity,a.cons_uom ,a.cons_amount,a.remarks,b.unit_of_measure ,c.no_of_roll as no_roll 
		from inv_transaction a, product_details_master b,inv_finish_fabric_issue_dtls c ,inv_issue_master d,inv_gate_pass_mst e  
		where a.prod_id=b.id and d.id=a.mst_id  and d.id=c.mst_id and a.id=c.trans_id and d.id=e.issue_id and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.issue_number='$challan_no'"); 
 	}
 	else if($basis==22)
	{
		$no_of_rolls = sql_select("select b.roll_no as no_roll 
		from inv_receive_mas_batchroll a,pro_grey_batch_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.recv_number='$challan_no'"); 
 	}
 	else if($basis==28)
	{
		$mst_id=$dataArray[0][csf('id')];
		$buyer_nam_val=return_library_array( "SELECT a.challan_details_id, c.buyer_name as BUYER_NAME  from  inv_gate_pass_dtls a, sample_ex_factory_dtls b, sample_development_mst c where a.mst_id=$mst_id and a.challan_details_id=b.id and b.sample_development_id=c.id and a.status_active=1 and b.status_active=1 and c.status_active=1", "challan_details_id", "buyer_name");
 	}
	else
	{
			
		//echo $within_group.'=='.$basis;
		/*if($basis==2 || $basis==3 || $basis==4 || $basis==5 || $basis==6 || $basis==7  ||  $basis==10 || $basis==13 ||  $basis==14 ||  $basis==11 ||  $basis==15)
		{
			if($within_group==2)
			{
				$send_to_company=$dataArray[0][csf('sent_to')];
			}
			else
			{
				$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
			}
		}
		else
		{
				$send_to_company=$dataArray[0][csf('sent_to')];	
		}*/
		
		
		
		//$send_to_company=$dataArray[0][csf('sent_to')];
	}
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	if($show_item==1)
	{
		$width=1250;
		//$colspan=5;
	}
	else
	{
		$width=1150;
		//$colspan=5;
		$colspan2=2;
	}
	$com_dtls = fnc_company_location_address($company, $location, 2);
	
	for($iii=1;$iii<=3;$iii++)
	{
	
		?>
	    <div class="print_break">
			<div style="width:<? echo $width;?>px;" align="center">
				<table width="<? echo $width;?>" cellspacing="0" align="center" border="0">
					<tr>
					<tr>
						<td  align="left"><img src="<?="../../".$com_dtls[2]; ?>" height="45" width="45"></td>
						<td colspan="5" align="center"  style="font-size:xx-large;">
							<span style="font-weight: bolder;"><? echo "Delivery Company: ". $dataArray[0][csf('delivery_company')]; ?></span><br/>
							<span style="font-weight: bolder;"><? echo "LC Company: ". $com_dtls[0]; ?></span>
						
						</td>
						<td>
							<span style="float: left;"><b><?="ISO Number :".$name_iso_Array[0]["ISO_NO"];?></b></span>
							<span style="font-size: 22px; float: right;">
								<?php echo $iii; ?><sup>
								<?php if ($iii == 1) { echo 'st'; } elseif ($iii == 2) { echo 'nd'; } else { echo 'rd'; } ?></sup> Copy</span><br><br>
							<?php if ($dataArray[0][csf('returnable')] == 1) echo "<span style='border: 1px solid #CCC; background: #EEE; font-size: 30px;'>Returnable</span>"; ?>
						</td>
					</tr>
					<tr class="form_caption">
						<td colspan="8" align="center">
							<?
							echo $com_dtls[1];
							?> 
							<div style="width:34%; text-align:center">
							&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
						</div>
						</td>
					</tr>
					<tr>
						<td style="display:none" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
					</tr>
					<tr>
						<td colspan="8" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
					</tr>
					<tr>
						<td width="160" valign="top"><strong>System ID:</strong></td> <td width="175px" style="font-size:20px" valign="top"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
						<td width="120" valign="top"><strong>Basis:</strong></td><td width="175px" valign="top" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
						<td width="125" valign="top"><strong>Challan/System No:</strong></td><td width="175px" colspan="2" style=" word-break: break-all" valign="top"><? echo $challan_no; ?></td>
					</tr>
					<tr>
						
						<td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
						<td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
						<td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
					</tr>
					<tr>
						<td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
						<td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
						<td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
					</tr>
					<tr>
					
						<td><strong>Out-Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
						<td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
						<td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
					</tr>
					<tr>
						<td><strong>Est. Return Date :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
						<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
						<td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
						
					</tr>
					<tr>
						<td><strong>Vehicle Number:</strong></td><td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>


						<td><strong>To Location :</strong></td><td><?  if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
						<td><strong>Bar Code:</strong></td><td  colspan="2" id="barcode_img_id<?= $iii;?>"></td> 
					</tr>
					<? if ($basis==12)
					{
						?>
						<tr>
							<td> <strong> Shipping Mode </strong></td>
							<td colspan="5" align="left"> <?  echo $shipment_mode[$shipmodes[0][csf("shiping_mode")]]; ?> </td>
						</tr>

					
						<? 
					}
						?>
					<tr>
						<td><strong>Against Returnable GP:</strong></td>
						<td align="left"> <?  echo $dataArray[0][csf("returnable_gate_pass_reff")]; ?> </td>
						<td><strong>Remarks</strong></td>
						<td align="left"> <?  echo $dataArray[0][csf("remarks")]; ?> </td>
						<td><strong>Mobile No</strong></td>
						<td align="left"> <?  echo $dataArray[0][csf("mobile_no")]; ?> </td>
					</tr>

					<tr>
						<td><strong>Security Lock No:</strong></td>
						<td align="left"> <?  echo $dataArray[0][csf("security_lock_no")]; ?> </td>
						<td><strong>Driver Name:</strong></td>
						<td align="left"> <?  echo $dataArray[0][csf("driver_name")]; ?> </td>
					</tr>
				</table>
				<br>
				<? 
				if($basis==5 or $basis==1 or $basis==7 or $basis==38)
				{
					?>
					<table align="center" cellspacing="0" width="<? echo $width;?>"  border="1" rules="all" class="rpt_table" >
						<thead bgcolor="#dddddd" align="center">
							<th width="30">SL</th>
							<th width="100" align="center">Item Category</th>
							<th width="100" align="center">Sample</th>
							<?	
								if($basis==1)
								{
									?>
										<th width="100" >Buyer</th>
									<?
								}
							?>
							<th width="200" align="center">Item Description</th>
							<th width="50" align="center">UOM</th>
							<th width="80" align="center">Quantity</th>
							<th width="50">Reject Qty</th>
							<? if($basis==12)
							{
								?>
								<th width="60" align="center">No Of Cartoon</th>
								<?
							}
							else
							{
								?>
								<th width="60" align="center">No Of Roll </th>
								<?
							}
							?>
							<th width="60" align="center">No Of Bag/Roll/GMT </th>
							<?
							if($show_item==1)
							{
								?>
								<th width="60" align="center">Rate</th> 
								<th width="90" align="center">Amount </th>
								<?
							}
							?>
							<th width="100" align="center">Buyer Order </th>
							<th align="center">Remarks</th>
						</thead>
					<?
					$i=1;
					$gate_id=$dataArray[0][csf('id')];
					$sql_dtls= " SELECT a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags, a.reject_qty from  inv_gate_pass_dtls a where a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 order by a.uom,a.id ";

							$sql_sel=sql_select($sql_dtls);
							foreach($sql_sel as $values)
							{
								$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['qty']+=$values[csf("quantity")];
				
								$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['item_category_id']=$values[csf("item_category_id")];
								
								$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['rej_qnty']=$values[csf("reject_qty")];
				
								$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['sample_id']=$values[csf("sample_id")];
				
								$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['item_description']=$values[csf("item_description")];
				
				
								$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['quantity']+=$values[csf("quantity")];
				
								$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['amount']+=$values[csf("amount")];
				
								$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['rate']+=$values[csf("rate")];
				
								$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['buyer_order_id'].=$values[csf("buyer_order_id")].",";
				
								$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['buyer_order'].=$values[csf("buyer_order")].",";
				
								$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['remarks']=$values[csf("remarks")];
								
								$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['no_of_bags']=$values[csf("no_of_bags")];
							}

							// foreach($sql_sel as $values)
							// {
							// 	$general_item_arr[$values[csf("item_category_id")]][$values[csf("sample_id")]][$values[csf("uom")]][$values[csf("item_description")]]['qty']+=$values[csf("quantity")];
							// 	$general_item_arr[$values[csf("item_category_id")]][$values[csf("sample_id")]][$values[csf("uom")]][$values[csf("item_description")]]['rej_qnty']+=$values[csf("reject_qty")];

							// 	$general_item_arr[$values[csf("item_category_id")]][$values[csf("sample_id")]][$values[csf("uom")]][$values[csf("item_description")]]['item_category_id']=$values[csf("item_category_id")];

							// 	$general_item_arr[$values[csf("item_category_id")]][$values[csf("sample_id")]][$values[csf("uom")]][$values[csf("item_description")]]['sample_id']=$values[csf("sample_id")];

							// 	$general_item_arr[$values[csf("item_category_id")]][$values[csf("sample_id")]][$values[csf("uom")]][$values[csf("item_description")]]['item_description']=$values[csf("item_description")];

							// 	$general_item_arr[$values[csf("item_category_id")]][$values[csf("sample_id")]][$values[csf("uom")]][$values[csf("item_description")]]['quantity']+=$values[csf("quantity")];
							// 	$general_item_arr[$values[csf("item_category_id")]][$values[csf("sample_id")]][$values[csf("uom")]][$values[csf("item_description")]]['amount']+=$values[csf("amount")];
							// 	$general_item_arr[$values[csf("item_category_id")]][$values[csf("sample_id")]][$values[csf("uom")]][$values[csf("item_description")]]['rate']+=$values[csf("rate")];
							// 	$general_item_arr[$values[csf("item_category_id")]][$values[csf("sample_id")]][$values[csf("uom")]][$values[csf("item_description")]]['buyer_order_id'].=$values[csf("buyer_order_id")].",";
							// 	$general_item_arr[$values[csf("item_category_id")]][$values[csf("sample_id")]][$values[csf("uom")]][$values[csf("item_description")]]['buyer_order'].=$values[csf("buyer_order")].",";
							// 	$general_item_arr[$values[csf("item_category_id")]][$values[csf("sample_id")]][$values[csf("uom")]][$values[csf("item_description")]]['remarks']=$values[csf("remarks")];
							// 	$general_item_arr[$values[csf("item_category_id")]][$values[csf("sample_id")]][$values[csf("uom")]][$values[csf("item_description")]]['no_of_bags']=$values[csf("no_of_bags")];
							// }
							//echo "<pre>";print_r($general_item_arr);die;
							$row_span_arr=array();
							// foreach($general_item_arr as $cate_id=>$cate_value)
							// {
							// 	foreach($cate_value as $sample_key=>$sample_value)
							// 	{
							// 		foreach($sample_value as $uom_id=>$value)
							// 		{							
							// 			$row_span=0;
							// 			foreach($value as $item_description_id=>$row)
							// 			{
							// 				$row_span++;
										
							// 			}

							// 			$row_span_arr[$uom_id]=$row_span;
							// 		}
							// 	}
							// }

							foreach($general_item_arr as $key=>$value)
							{
					
								$row_span=0;
								foreach($value as $item_description_id=>$row)
								{
									$row_span++;
								}
					
								$row_span_arr[$key]=$row_span;
							}
					
							$i=1;
							$tot_qty=0; $tot_rej_qnty=0;$tot_amount=0; $tot_bags=0;$tot_amnt=0;
							// foreach($general_item_arr as $cate_id=>$cate_value)
							// {
							// 	foreach($cate_value as $sample_key=>$sample_value)
							// 	{
									// foreach($sample_value as $uom_id=>$value)
									// {

									// 	$j=0;
										
									// 	foreach($value as $item_description_id=>$row)
									// 	{

									$buyer_id_arr=array_unique(explode(",",chop($row['buyer_order_id'],",")));
									$buyer_nam='';
									foreach($buyer_id_arr as $val)
									{
										$buyer_nam.=$buyer_library[$order_array[$val]['buyer_name']].', ';
									}

									$i=1;
									foreach($general_item_arr as $key=>$value)
									{
										$j=0;
										foreach($value as $item_description_id=>$row)
										{
											?>
												<tr>
												<td width="40"   align="center"><? echo $i;$i++; ?></td>
												<td><?  echo $item_category[$row["item_category_id"]]; ?></td>
												<td><?  echo $sample_library_arr[$row["sample_id"]]; ?></td>
												<?
													if($basis==1)
													{
														?>
															<td ><?echo chop($buyer_nam,", ");?></th>
														<?
													}
												?>
												<td><?  echo $row['item_description']; ?></td>
												<? if($j==0)
												{
										
												?>
												<td width="40" rowspan="<? echo $row_span_arr[$key]?>" align="center"><? echo $unit_of_measurement[$key]; ?></td>
												<?
												}
												?>
												<td align="right"><? echo number_format($row['quantity'],2,'.',''); ?></td>  
												<td align="right"><? echo number_format($row['rej_qnty'],2,'.',''); ?></td>  
												<td align="right"><? echo count($no_of_rolls);  ?></td>  
												<td align="right"><? echo $row['no_of_bags']; ?></td>
													<?
													if($show_item==1)
													{
														?> 
														<td align="right"><? $rate=$row['amount']/$row['quantity']; echo number_format($rate,2,'.',''); ?></td>
														<td align="right"><? echo number_format($row['amount'],2,'.',''); ?></td>
														<?
													}
													?>
													<td style="word-break:break-all;"><? echo implode(",",array_unique(explode(",",chop($row['buyer_order'],",")))); ?></td>
													<td><? echo $row['remarks']; ?></td>
												<?
												
												$j++;
												$total+=$row[("qty")];
												$gr_total+=$row[("qty")];
												$tot_qty +=$row['quantity'];
												$tot_rej_qnty +=$row['rej_qnty'];
												$tot_bags +=$row['no_of_bags'];
												$tot_amnt +=$row['amount'];

										}
											
										?>
										<tr>
											<td colspan="6" align="right"><b>Sub Total</b></td>
											<td align="right">  <b><? echo number_format($total,2); $total=0; ?></b></td>
										</tr>
										<?
									}
								//}
							//}
							?>

						<tfoot bgcolor="#CCCCCC">
							<tr>
							<?
								if($basis==1)
								{
									?>
										<td colspan="6" align="right"> <b> Total</b></td>
									<?
								}
								else{
									?>
										<td colspan="5" align="right"> <b> Total</b></td>
									<?
								}
							?>
							<!-- <td colspan="5" align="right"> <b> Total</b></td> -->
							<td align="right"><b><? echo number_format($tot_qty,2);?></b></td> 
							<td align="right"><b><? echo number_format($tot_rej_qnty,2);?></b></td> 
							<?
							if($show_item==1)
							{
							?>      
							<td align="right"><b><? echo $tot_roll;?></b></td>    
							<?
							}
							else
							{  
								echo "<td></td>" ;
							}
							?>
							<td align="right"><b><? echo number_format($tot_bags,2);?></b></td>

							<?
								if($show_item==1)
								{
								?>      
									<td align="right"><b></b></td>    
									<td align="right"><b><? echo number_format($tot_amnt,2);?></b></td>    
								<?
								}
								
							?>
							<td></td>
							<td></td>
							</tr>
							
							<?
								if($show_item==1 && $tot_amnt>0)
								{
								?>   
								<tr>
									<td colspan="14" align="left"><?= "<strong>Amount In Word: </strong>".number_to_words(number_format($tot_amnt,2))?></td>   
								</tr> 
								<?
								}
							?>
								
						</tfoot>	
						<?
							
					//echo $sql_dtls;
					$uom_check=array();
					$sql_result=sql_select($sql_dtls);
					$tot_qty=0; $tot_amount=0; $tot_amount=0;$tot_bags=0;$tot_amnt=0;
					$p=0;
					
					//$tot_check=array();
					if(count($uom_check)==1)
					{
					?>
				
					<?
					}
					$width_sign=$width.'px';
					?>
					</table>
					<?
					unset($general_item_arr);
				}
				else 
				{
				?>
				<table align="center" cellspacing="0" width="<? echo $width;?>"  border="1" rules="all" class="rpt_table" >
					<thead bgcolor="#dddddd" align="center">
						<th width="30">SL</th>
						<th width="100" align="center">Item Category</th>
						<th width="100" align="center">Sample</th>
						<?	
							if($basis==28)
							{
								?>
									<th width="100" >Buyer</th>
								<?
							}
						?>
						<th width="200" align="center">Item Description</th>
						<th width="50" align="center">UOM</th>
						<th width="80" align="center">Quantity</th>
						
						<? if($basis==9 || $basis==8)
						{?>
						<th width="100" align="center">Reject Qty </th>
				
						<?
						}
						else
						{
							?>
							<th width="100" align="center">Reject Qty </th>					
							<?
						}
						?>
						
						<? if($basis==12)
						{?>
						<th width="100" align="center">No Of Carton </th>
				
						<?
						}
						else
						{
							if($basis!=3)
							{
						?>
						<th width="100" align="center">No Of Roll </th>
						<?
							}
						}
						?>
						<th width="80" align="center">No Of Bag/Roll/GMT </th>
						<?
						if($show_item==1)
						{
						?>
						<th width="50" align="center">Rate</th> 
						<th width="80" align="center">Amount </th>
						<?
						}
						?>
						<th width="80" align="center">Buyer Order </th>
						<th align="center">Remarks</th>
					</thead>
				<?
				$inc=1;
				foreach ($no_of_rolls as $row) 
				{
					$rollNo[$row[csf('product_name_details')]][$row[csf('to_order_id')]]['rollNO']=$inc;
					$inc++;
				}
				$i=1;
				$gate_id=$dataArray[0][csf('id')];
				$sql_dtls= " SELECT a.item_category_id,a.sample_id, a.item_description,a.uom_qty, sum(a.quantity) as quantity , sum(a.reject_qty) as reject_qty , a.uom, a.rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, sum(a.no_of_bags) as no_of_bags,count(a.item_description) as item_count, a.challan_details_id  from  inv_gate_pass_dtls a where a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 group by a.item_category_id,a.sample_id, a.item_description,a.uom_qty , a.uom, a.rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.challan_details_id";
				//  echo $sql_dtls;
				$uom_check=array();
				$sql_result=sql_select($sql_dtls);
				$tot_qty=0; $tot_amount=0; $tot_amount=0; $noOfCarton=0; $tot_bags=0;
				$tot_roll=0;$ProductionRejectQty=0; $noOfReject=0;
				$p=0;
				foreach($sql_result as $row)
				{
					if ($i%2==0)  
						$bgcolor="#E9F3FF";
					else
						$bgcolor="#FFFFFF";
						
						$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
						$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
						//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
						$uom_check[$row[csf('uom')]]=$row[csf('uom')];
						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<td><? echo $i; ?></td>
							<td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
							<td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
							<?	
								if($basis==28)
								{
									?>
										<td ><?echo $buyer_library[$buyer_nam_val[$row[csf('challan_details_id')]]];?></th>
									<?
								}
							?>
							<td><?  echo $row[csf('item_description')]; ?></td>
							<td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
							<td align="right"><? echo number_format($row[csf('quantity')],2,'.',''); ?></td> 
							<?  
							if($basis==9 || $basis==8)             
							{
								?>
								<td align="right"><? echo number_format($no_of_rolls[$p][csf("reject_qty")],2); ?></td>
								<?
							}
							else           
							{
								?>
								<td align="right"><? echo number_format($row[csf("reject_qty")],2); ?></td>
								<?
							} 
							if($basis==12)             
							{
								?>
								<td align="right"><? echo $shipmode_cartoon[$p][csf("total_carton_qnty")]; ?></td>
								<?
							}
							else
							{
								if($basis!=3)
								{
								?>
								<td align="right"><? 
								if($basis==3)
								{
									echo $no_of_rolls[$p][csf("no_roll")]=1; 
								} 
								if($basis==18)
								{
									echo ""; 
								}
								else
								{
									//echo $no_of_rolls[$p][csf("no_roll")] ;
									echo  $row[csf('item_count')];
									//echo  $rollNo[$row[csf('item_description')]][$row[csf('buyer_order_id')]]['rollNO'];
									//echo count($no_of_rolls) ;
								} ?></td>  
								<?
								}
							}
							?>
							<td align="right"><? echo $row[csf('no_of_bags')]; ?></td>
							<?
							if($show_item==1)
							{
							?>
							<td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
							<td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
							<?
							}
							?>
							<td><? echo $row[csf('buyer_order')]; ?></td>
							<td><? echo $row[csf('remarks')]; ?></td>
						</tr>
					<?php
					
					if($basis==3){$tot_roll +=$no_of_rolls[$p][csf("no_roll")];}else{$tot_roll +=$row[csf('item_count')];}
					
					$noOfCarton+=$shipmode_cartoon[$p][csf("total_carton_qnty")];
					$noOfReject+=$no_of_rolls[$p][csf("reject_qty")];
					$ProductionRejectQty+=$row[csf("reject_qty")];
					$i++;
					$p++;
					
					$tot_qty+=$row[csf('quantity')];		
					$tot_amount+=$row[csf('amount')];
					$tot_bags+=$row[csf('no_of_bags')];

				}
				
				if(count($uom_check)==1)
				{
				?>
				<tfoot bgcolor="#CCCCCC">
					<tr>
					<td <?php if($basis==28){ $row_colspan = 6; }else{ $row_colspan=5; } ?> colspan="<?php echo $row_colspan; ?>" align="right"> <b> Total</b></td>
					<td align="right"><b><? echo number_format($tot_qty,2);?></b></td>
					<?
					if($basis==9 || $basis==8)
					{
						?>
							<td align="right"><b><? echo number_format($noOfReject,2);?></b></td> 
						<?   
					}
					else
					{
						?>
							<td align="right"><b><? echo number_format($ProductionRejectQty,2);?></b></td> 
						<?
					}
					?>
					
					<?
					if($show_item==1)
					{
						if($basis==12)
						{
						?>
							<td align="right"><b><? echo $noOfCarton;?></b></td> 
						<?   
						}
						if($basis==18)
						{
						?>
							<td align="right"><b><? echo "";?></b></td> 
						<?
						}
						else
						{
							if($basis!=3)
							{
						?>
							<td align="right"><b><? echo $tot_roll;?></b></td> 
						<?
							}
						} 
					 
					}
					else
					{
						if($basis==12)
						{
						?>
							<td align="right"><b><? echo $noOfCarton;?></b></td> 
						<?
						}
						if($basis==18)
						{
						?>
							<td align="right"><b><? echo "";?></b></td> 
						<?
						}
						else
						{
							if($basis!=3)
							{
							echo '<td align="right">'.$tot_roll.'</td>' ;
							}
						}
					}
					?>
					<td align="right"><b><? echo number_format($tot_bags,2);?></b></td>
					<?
					if($show_item==1)
					{
					?>
						<td></td>
						<td align="right"><b><?= number_format($tot_amount,2);?></b></td>
					<? 
					}
					?>
					<td align="right"></td>
					<td colspan="<? echo 4+$colspan2;?>"></td>
					</tr>
					<?
						if($show_item==1 && $tot_amount>0)
						{
						?>   
						<tr>
							<td colspan="13" align="left"><?= "<strong>Amount In Word: </strong>".number_to_words(number_format($tot_amount,2))?></td>   
						</tr> 
						<?
						}
					?>
				</tfoot>
				<?
				}
				$width_sign=$width.'px';
				?>
				</table>
				<? }
				?>


			</div>
			<div>
				<? echo signature_table(114, $data[0], $width_sign,$template_id,0); ?>
			</div>
	    </div>
	    <? 

	} 
	?>
	<style>
		@media print {
			.print_break {page-break-after: always!important;}
		}
	</style>
 	<script type="text/javascript" src="../../js/jquery.js"></script>
	<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
	<script>

	function generateBarcode( valuess,id ){
		   
			var value = valuess;//$("#barcodeValue").val();
		 // alert(value)
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='bmp';// $("input[name=renderer]:checked").val();
			 
			var settings = {
			  output:renderer,
			  bgColor: '#FFFFFF',
			  color: '#000000',
			  barWidth: 2,
			  barHeight: 30,
			  moduleSize:5,
			  posX: 10,
			  posY: 20,
			  addQuietZone: 1
			};
			$("#barcode_img_id"+id).html('11');
			 value = {code:value, rect: false};
			
			$("#barcode_img_id"+id).show().barcode(value, btype, settings);
		} 
	 //generateBarcode('<? echo $data[1]; ?>');
	 </script>
     
   
     
     
    <?

	for($iii=1;$iii<=3;$iii++){ ?>  
		<script> generateBarcode('<?= $data[1]; ?>',<?= $iii;?>); </script>
	<?
    }
    ?>
    <style type="text/css">
    	object{
    		margin-left: -20px !important;
    	}
    </style>
    <?php
    exit();
}

if($action=="print_to_html_report_15")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//print_r ($data);
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[2];
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");
	$item_group_arr=return_library_array( "select id, item_name from lib_item_group where item_category=4 and status_active=1", 'id', 'item_name');


	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$challan_library=return_library_array( "select id, trims_del from  trims_delivery_mst", "id", "trims_del"  );
	
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to,vhicle_number, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,com_location_id,remarks,mobile_no,delivery_company,issue_id from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 "; 
	//echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
 	$sent_to=$dataArray[0][csf('sent_to')];
 	$delivery_company=$dataArray[0][csf('delivery_company')];
	$issue_id=$dataArray[0][csf('issue_id')];
	
	$shipmodes=sql_select("select  b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no' and (b.shiping_mode is not null or b.shiping_mode!=0) ") ;
	 
	$shipmode_cartoon=sql_select("select  sum(b.total_carton_qnty) as total_carton_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no'") ;
	if($within_group==2)
		{
			$send_to_company=$dataArray[0][csf('sent_to')];
		}
		else
		{
			$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	if($show_item==1)
	{
		$width=1150;
		//$colspan=5;
	}
	else
	{
		$width=1150;
		//$colspan=5;
		$colspan2=2;
	}
	$com_dtls = fnc_company_location_address($company, $location, 2);
	
	$gate_id=$dataArray[0][csf('id')];
	/*$sql_dtls= "select a.challan_details_id,a.challan_no,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, sum(a.quantity) as quantity , a.uom, a.rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, sum(a.no_of_bags) as no_of_bags,count(a.item_description) as item_count, b.item_group
	from inv_gate_pass_dtls a, subcon_ord_dtls b
	where a.mst_id=$gate_id and a.buyer_order=b.buyer_po_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.item_category_id,a.sample_id, a.item_description,a.uom_qty , a.uom, a.rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks,a.challan_no,a.challan_details_id, b.item_group";*/
	$sql_dtls= "select a.challan_details_id,a.challan_no,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, sum(a.quantity) as quantity , a.uom, a.rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags as no_of_bags,count(a.item_description) as item_count
	from inv_gate_pass_dtls a
	where a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 group by a.item_category_id,a.sample_id, a.item_description,a.uom_qty , a.uom, a.rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks,a.challan_no,a.challan_details_id";

	$sql_result=sql_select($sql_dtls);
	$buyerPoNos='';
	foreach($sql_result as $row)
	{
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['item_category_id']=$row[csf("item_category_id")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['challan_no']=$row[csf("challan_no")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['sample_id']=$row[csf("sample_id")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['uom']=$row[csf("uom")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['quantity']+=$row[csf("quantity")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['no_roll']=$row[csf("no_roll")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['item_count']=$row[csf("item_count")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['no_of_bags']=$row[csf("no_of_bags")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['rate']=$row[csf("rate")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['amount']=$row[csf("amount")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['buyer_order']=$row[csf("buyer_order")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['remarks']=$row[csf("remarks")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['item_description']=$row[csf("item_description")];

		$buyerPoNos .= "'".$row[csf("buyer_order")] . "',";
	}

	$buyerPoNos = rtrim($buyerPoNos, ',');

	$item_group_result = sql_select("select buyer_po_no, item_group from subcon_ord_dtls where buyer_po_no in($buyerPoNos) and status_active=1");

	$jobItemGroupArr = array();

	foreach ($item_group_result as $row) {
		$jobItemGroupArr[$row[csf('buyer_po_no')]] = $row[csf("item_group")];
	}
	
	//echo "<pre>";
	//print_r($all_data_arr);
				
	for($iii=1;$iii<=3;$iii++)
	{
	
		?>
	    <div class="print_break">
			<div style="width:<? echo $width;?>px;" align="center">
				<table width="<? echo $width;?>" cellspacing="0" align="center" border="0">
					<tr>
					<tr>
						<td  align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="70" width="200"></td>
						<td colspan="5" align="center"  style="font-size:xx-large;">
							<span style="font-weight: bolder;"><? echo "Delivery Company: ". $dataArray[0][csf('delivery_company')]; ?></span><br/>
							<span style="font-weight: bolder;"><? echo "LC Company: ". $com_dtls[0]; ?></span>
						
						</td>
						<td style="text-align:right;">
							<span style='font-size:22px;'>
							<? echo $iii;?><sup><?php if($iii==1) { echo 'st';} elseif($iii==2) { echo  'nd';} else{ echo 'rd';} ?></sup> Copy</span><br><br>
		                    &nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;font-size:30px;'>Returnable</span>";?>
		                	
						</td>
					</tr>
					<tr class="form_caption">
						<td colspan="8" align="center">
							<?
							echo $com_dtls[1];
							?> 
							<div style="width:34%; text-align:center">
							&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
						</div>
						</td>
					</tr>
					<tr>
						<td style="display:none" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
					</tr>
					<tr>
						<td colspan="8" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
					</tr>
					<tr>
						<td width="160"><strong>System ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
						<td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
						<td width="125"><strong>Mobile No:</strong></td><td width="175px" colspan="2"><? echo $dataArray[0][csf("mobile_no")]; ?></td>
					</tr>
					<tr>
						
						<td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
						<td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
						<td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
					</tr>
					<tr>
						<td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
						<td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
						<td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
					</tr>
					<tr>
					
						<td><strong>Out-Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
						<td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
						<td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
					</tr>
					<tr>
						<td><strong>Est. Return Date :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
						<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
						<td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
						
					</tr>
					<tr>
						<td><strong>Vehicle Number:</strong></td><td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>


						<td><strong>To Location :</strong></td><td><?  if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
						<td><strong>Bar Code:</strong></td><td  colspan="2" id="barcode_img_id<?= $iii;?>"></td> 
					</tr>
					<tr>
						<td><strong>Remarks</strong></td>
						<td colspan="3" align="left"> <?  echo $dataArray[0][csf("remarks")]; ?> </td>
					</tr>


				</table>
				<br>
				<table align="center" cellspacing="0" width="<? echo $width;?>"  border="1" rules="all" class="rpt_table" > 
					<thead bgcolor="#dddddd" align="center">
						<th width="30">SL</th>
						<th width="100" align="center">Item Category</th>
                        <th width="125" align="center">Challan/System No:</th>
						<!-- <th width="100" align="center">Sample</th> -->
						<th width="200" align="center">Item Description</th>
						<th width="50" align="center">UOM</th>
						<th width="80" align="center">Quantity</th>
						<!-- <th width="100" align="center">No Of Roll </th> -->
						<th width="80" align="center">No Of Bag/Roll/GMT </th>
						<?
						if($show_item==1)
						{
						?>
						<th width="50" align="center">Rate</th> 
						<th width="80" align="center">Amount </th>
						<?
						}
						?>
						<th width="80" align="center">Buyer Order </th>
						<th align="center">Remarks</th>
					</thead>
				<?
				$inc=1;
				foreach ($no_of_rolls as $row) 
				{
					$rollNo[$row[csf('product_name_details')]][$row[csf('to_order_id')]]['rollNO']=$inc;
					$inc++;
				}
				
				
				
				
				$p=0;
				$i=1;
				foreach($all_data_arr as $trimUOM => $trimUOM_arr)
				{
					$tot_qty=0; $tot_amount=0; $tot_amount=0; $noOfCarton=0;$tot_roll=0; $tot_bags=0;
					foreach($trimUOM_arr as $id => $row)
					{
						if ($i%2==0)  
							$bgcolor="#E9F3FF";
						else
							$bgcolor="#FFFFFF"; //$row['buyer_po_no']
						
						$buyer=$order_array[$row['buyer_order_id']]['buyer_name'];
						$style_ref_no=$order_array[$row['buyer_order_id']]['style_ref_no'];
						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<td><? echo $i; ?></td>
							<td><?  echo $item_category[$row['item_category_id']]; ?></td>
                            <td><?  echo $challan_library[$row['challan_no']]; ?></td>
							<!-- <td><?  // echo $sample_library_arr[$row['sample_id']]; ?></td> -->
							<td><?php echo $item_group_arr[$jobItemGroupArr[$row['buyer_order']]].', '.$row['item_description']; ?></td>
							<td align="center"><? echo $unit_of_measurement[$row['uom']]; ?></td>
							<td align="right"><? echo number_format($row['quantity'],2,'.',''); ?></td> 
                            <!-- <td align="right"><? // if($basis==3){echo $no_of_rolls[$p]["no_roll"] =1; } 
                            // else{ echo  $row['item_count']; } ?></td> -->  
							<td align="right"><? echo $row['no_of_bags']; ?></td>
							<?
							if($show_item==1)
							{
							?>
							<td align="right"><? echo number_format($row['rate'],2,'.',''); ?></td>
							<td align="right"><? echo number_format($row['amount'],2,'.',''); ?></td>
							<?
							}
							?>
							<td><? echo $row['buyer_order']; ?></td>
							<td><? echo $row['remarks']; ?></td>
						</tr>
					<?php
					
					if($basis==3){$tot_roll +=$no_of_rolls[$p]["no_roll"];}else{$tot_roll +=$row['item_count'];}
					$noOfCarton+=$shipmode_cartoon[$p]["total_carton_qnty"];
					$noOfReject+=$no_of_rolls[$p]["reject_qty"];
					$i++;
					$p++;
					
					$tot_qty+=$row['quantity'];		
					$tot_amount+=$row['amount'];
					//$tot_bags+=$row['no_of_bags'];
					
					}
					?>
					<tr>
					<td colspan="5" align="right"> <b> UOM Wise Total:</b></td>
					<td align="right"><b><? echo number_format($tot_qty,2);?></b></td>
				   	<!-- <td align="right"><b><? // echo $tot_roll;?></b></td> --> 
					<td align="right"><b><? echo number_format($tot_bags,2);?></b></td>
					<td align="right"><b><?= $tot_amount;?></b></td>
					<td align="right"></td>
					<td colspan="<? echo 4+$colspan2;?>"></td>
					</tr>
					<?
					//$tot_qty=0;

				}
				$width_sign=$width.'px';
				?>
				</table>
				<? 
				?>


			</div>
			<div>
				<? echo signature_table(114, $data[0], $width_sign,$template_id); ?>
			</div>
	    </div>
	    <? 

	} 
	?>
	<style>
		@media print {
			.print_break {page-break-after: always!important;}
		}
	</style>
 	<script type="text/javascript" src="../../js/jquery.js"></script>
	<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
	<script>

	function generateBarcode( valuess,id ){
		   
			var value = valuess;//$("#barcodeValue").val();
		 // alert(value)
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='bmp';// $("input[name=renderer]:checked").val();
			 
			var settings = {
			  output:renderer,
			  bgColor: '#FFFFFF',
			  color: '#000000',
			  barWidth: 1,
			  barHeight: 30,
			  moduleSize:5,
			  posX: 10,
			  posY: 20,
			  addQuietZone: 1
			};
			$("#barcode_img_id"+id).html('11');
			 value = {code:value, rect: false};
			
			$("#barcode_img_id"+id).show().barcode(value, btype, settings);
		} 
	 //generateBarcode('<? echo $data[1]; ?>');
	 </script>
     
   
     
     
    <?

	for($iii=1;$iii<=3;$iii++){ ?>  
		<script> generateBarcode('<?= $data[1]; ?>',<?= $iii;?>); </script>
	<?
    }

    exit();
}

if($action=="print_to_html_report_15_v2")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//print_r ($data);
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[2];
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");
	$item_group_arr=return_library_array( "select id, item_name from lib_item_group where item_category=4 and status_active=1", 'id', 'item_name');


	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$challan_library=return_library_array( "select id, trims_del from  trims_delivery_mst", "id", "trims_del"  );
	
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to,vhicle_number, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,com_location_id,remarks,mobile_no,delivery_company,issue_id from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 "; 
	//echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
 	$sent_to=$dataArray[0][csf('sent_to')];
 	$delivery_company=$dataArray[0][csf('delivery_company')];
	$issue_id=$dataArray[0][csf('issue_id')];
	
	$shipmodes=sql_select("select  b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no' and (b.shiping_mode is not null or b.shiping_mode!=0) ") ;
	 
	$shipmode_cartoon=sql_select("select  sum(b.total_carton_qnty) as total_carton_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no'") ;
	if($within_group==2)
		{
			$send_to_company=$dataArray[0][csf('sent_to')];
		}
		else
		{
			$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	if($show_item==1)
	{
		$width=1150;
		//$colspan=5;
	}
	else
	{
		$width=1150;
		//$colspan=5;
		$colspan2=2;
	}
	$com_dtls = fnc_company_location_address($company, $location, 2);
	
	$gate_id=$dataArray[0][csf('id')];
	/*$sql_dtls= "select a.challan_details_id,a.challan_no,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, sum(a.quantity) as quantity , a.uom, a.rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, sum(a.no_of_bags) as no_of_bags,count(a.item_description) as item_count, b.item_group
	from inv_gate_pass_dtls a, subcon_ord_dtls b
	where a.mst_id=$gate_id and a.buyer_order=b.buyer_po_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.item_category_id,a.sample_id, a.item_description,a.uom_qty , a.uom, a.rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks,a.challan_no,a.challan_details_id, b.item_group";*/
	$sql_dtls= "select a.challan_details_id,a.challan_no,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, sum(a.quantity) as quantity , a.uom, a.rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags as no_of_bags,count(a.item_description) as item_count
	from inv_gate_pass_dtls a
	where a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 group by a.item_category_id,a.sample_id, a.item_description,a.uom_qty , a.uom, a.rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks,a.challan_no,a.challan_details_id";

	$sql_result=sql_select($sql_dtls);
	$buyerPoNos='';
	foreach($sql_result as $row)
	{
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['item_category_id']=$row[csf("item_category_id")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['challan_no']=$row[csf("challan_no")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['sample_id']=$row[csf("sample_id")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['uom']=$row[csf("uom")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['quantity']+=$row[csf("quantity")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['no_roll']=$row[csf("no_roll")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['item_count']=$row[csf("item_count")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['no_of_bags']=$row[csf("no_of_bags")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['rate']=$row[csf("rate")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['amount']=$row[csf("amount")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['buyer_order']=$row[csf("buyer_order")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['remarks']=$row[csf("remarks")];
		$all_data_arr[$row[csf("uom")]][$row[csf("challan_details_id")]]['item_description']=$row[csf("item_description")];

		$buyerPoNos .= "'".$row[csf("buyer_order")] . "',";
	}

	$buyerPoNos = rtrim($buyerPoNos, ',');

	$item_group_result = sql_select("select buyer_po_no, item_group from subcon_ord_dtls where buyer_po_no in($buyerPoNos) and status_active=1");

	$jobItemGroupArr = array();

	foreach ($item_group_result as $row) {
		$jobItemGroupArr[$row[csf('buyer_po_no')]] = $row[csf("item_group")];
	}
	
	//echo "<pre>";
	//print_r($all_data_arr);
				
	for($iii=1;$iii<=3;$iii++)
	{
	
		?>
	    <div class="print_break">
			<div style="width:<? echo $width;?>px;" align="center">
				<table width="<? echo $width;?>" cellspacing="0" align="center" border="0">
					<tr>
					<tr>
						<td  align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="70" width="200"></td>
						<td colspan="5" align="center"  style="font-size:xx-large;">
							<!-- <span style="font-weight: bolder;"><? //echo "Delivery Company: ". $dataArray[0][csf('delivery_company')]; ?></span><br/> -->
							<span style="font-weight: bolder;"><? echo "LC Company: ". $com_dtls[0]; ?></span>
						
						</td>
						<td style="text-align:right;">
							<span style='font-size:22px;'>
							<? echo $iii;?><sup><?php if($iii==1) { echo 'st';} elseif($iii==2) { echo  'nd';} else{ echo 'rd';} ?></sup> Copy</span><br><br>
		                    &nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;font-size:30px;'>Returnable</span>";?>
		                	
						</td>
					</tr>
					<tr class="form_caption">
						<td colspan="8" align="center">
							<?
							echo $com_dtls[1];
							?> 
							<div style="width:34%; text-align:center">
							&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
						</div>
						</td>
					</tr>
					<tr>
						<td style="display:none" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
					</tr>
					<tr>
						<td colspan="8" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
					</tr>
					<tr>
						<td width="160"><strong>System ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
						<td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
						<td width="125"><strong>Mobile No:</strong></td><td width="175px" colspan="2"><? echo $dataArray[0][csf("mobile_no")]; ?></td>
					</tr>
					<tr>
						
						<td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
						<td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
						<td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
					</tr>
					<tr>
						<td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
						<td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
						<td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
					</tr>
					<tr>
					
						<td><strong>Out-Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
						<td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
						<td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
					</tr>
					<tr>
						<td><strong>Est. Return Date :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
						<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
						<td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
						
					</tr>
					<tr>
						<td><strong>Vehicle Number:</strong></td><td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>


						<td><strong>To Location :</strong></td><td><?  if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
						<td><strong>Bar Code:</strong></td><td  colspan="2" id="barcode_img_id<?= $iii;?>"></td> 
					</tr>
					<tr>
						<td><strong>Remarks</strong></td>
						<td colspan="3" align="left"> <?  echo $dataArray[0][csf("remarks")]; ?> </td>
					</tr>


				</table>
				<br>
				<table align="center" cellspacing="0" width="<? echo $width;?>"  border="1" rules="all" class="rpt_table" > 
					<thead bgcolor="#dddddd" align="center">
						<th width="30">SL</th>
						<th width="100" align="center">Item Category</th>
                        <th width="125" align="center">Challan/System No:</th>
						<!-- <th width="100" align="center">Sample</th> -->
						<th width="200" align="center">Item Description</th>
						<th width="50" align="center">UOM</th>
						<th width="80" align="center">Quantity</th>
						<!-- <th width="100" align="center">No Of Roll </th> -->
						<th width="80" align="center">No Of Bag/Roll/GMT </th>
						<?
						if($show_item==1)
						{
						?>
						<th width="50" align="center">Rate</th> 
						<th width="80" align="center">Amount </th>
						<?
						}
						?>
						<th width="80" align="center">Buyer Order </th>
						<th align="center">Remarks</th>
					</thead>
				<?
				$inc=1;
				foreach ($no_of_rolls as $row) 
				{
					$rollNo[$row[csf('product_name_details')]][$row[csf('to_order_id')]]['rollNO']=$inc;
					$inc++;
				}
				
				
				
				
				$p=0;
				$i=1;
				foreach($all_data_arr as $trimUOM => $trimUOM_arr)
				{
					$tot_qty=0; $tot_amount=0; $tot_amount=0; $noOfCarton=0;$tot_roll=0; $tot_bags=0;
					foreach($trimUOM_arr as $id => $row)
					{
						if ($i%2==0)  
							$bgcolor="#E9F3FF";
						else
							$bgcolor="#FFFFFF"; //$row['buyer_po_no']
						
						$buyer=$order_array[$row['buyer_order_id']]['buyer_name'];
						$style_ref_no=$order_array[$row['buyer_order_id']]['style_ref_no'];
						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<td><? echo $i; ?></td>
							<td><?  echo $item_category[$row['item_category_id']]; ?></td>
                            <td><?  echo $challan_library[$row['challan_no']]; ?></td>
							<!-- <td><?  // echo $sample_library_arr[$row['sample_id']]; ?></td> -->
							<td><?php echo $item_group_arr[$jobItemGroupArr[$row['buyer_order']]].', '.$row['item_description']; ?></td>
							<td align="center"><? echo $unit_of_measurement[$row['uom']]; ?></td>
							<td align="right"><? echo number_format($row['quantity'],2,'.',''); ?></td> 
                            <!-- <td align="right"><? // if($basis==3){echo $no_of_rolls[$p]["no_roll"] =1; } 
                            // else{ echo  $row['item_count']; } ?></td> -->  
							<td align="right"><? echo $row['no_of_bags']; ?></td>
							<?
							if($show_item==1)
							{
							?>
							<td align="right"><? echo number_format($row['rate'],2,'.',''); ?></td>
							<td align="right"><? echo number_format($row['amount'],2,'.',''); ?></td>
							<?
							}
							?>
							<td><? echo $row['buyer_order']; ?></td>
							<td><? echo $row['remarks']; ?></td>
						</tr>
					<?php
					
					if($basis==3){$tot_roll +=$no_of_rolls[$p]["no_roll"];}else{$tot_roll +=$row['item_count'];}
					$noOfCarton+=$shipmode_cartoon[$p]["total_carton_qnty"];
					$noOfReject+=$no_of_rolls[$p]["reject_qty"];
					$i++;
					$p++;
					
					$tot_qty+=$row['quantity'];		
					$tot_amount+=$row['amount'];
					//$tot_bags+=$row['no_of_bags'];
					
					}
					?>
					<tr>
					<td colspan="5" align="right"> <b> UOM Wise Total:</b></td>
					<td align="right"><b><? echo number_format($tot_qty,2);?></b></td>
				   	<!-- <td align="right"><b><? // echo $tot_roll;?></b></td> --> 
					<td align="right"><b><? echo number_format($tot_bags,2);?></b></td>
					<td align="right"><b><?= $tot_amount;?></b></td>
					<td align="right"></td>
					<td colspan="<? echo 4+$colspan2;?>"></td>
					</tr>
					<?
					//$tot_qty=0;

				}
				$width_sign=$width.'px';
				?>
				</table>
				<? 
				?>


			</div>
			<div>
				<? echo signature_table(114, $data[0], $width_sign,$template_id); ?>
			</div>
	    </div>
	    <? 

	} 
	?>
	<style>
		@media print {
			.print_break {page-break-after: always!important;}
		}
	</style>
 	<script type="text/javascript" src="../../js/jquery.js"></script>
	<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
	<script>

	function generateBarcode( valuess,id ){
		   
			var value = valuess;//$("#barcodeValue").val();
		 // alert(value)
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='bmp';// $("input[name=renderer]:checked").val();
			 
			var settings = {
			  output:renderer,
			  bgColor: '#FFFFFF',
			  color: '#000000',
			  barWidth: 1,
			  barHeight: 30,
			  moduleSize:5,
			  posX: 10,
			  posY: 20,
			  addQuietZone: 1
			};
			$("#barcode_img_id"+id).html('11');
			 value = {code:value, rect: false};
			
			$("#barcode_img_id"+id).show().barcode(value, btype, settings);
		} 
	 //generateBarcode('<? echo $data[1]; ?>');
	 </script>
     
   
     
     
    <?

	for($iii=1;$iii<=3;$iii++){ ?>  
		<script> generateBarcode('<?= $data[1]; ?>',<?= $iii;?>); </script>
	<?
    }

    exit();
}

if($action=="print_to_html_report_15_v3")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//print_r ($data);
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[2];
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");
	$item_group_arr=return_library_array( "select id, item_name from lib_item_group where item_category=4 and status_active=1", 'id', 'item_name');


	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$challan_library=return_library_array( "select id, trims_del from  trims_delivery_mst", "id", "trims_del"  );
	
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to,vhicle_number, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,com_location_id,remarks,mobile_no,delivery_company,issue_id from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 "; 
	//echo $sql;
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
 	$sent_to=$dataArray[0][csf('sent_to')];
 	$delivery_company=$dataArray[0][csf('delivery_company')];
	$issue_id=$dataArray[0][csf('issue_id')];
	
	$shipmodes=sql_select("select  b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no' and (b.shiping_mode is not null or b.shiping_mode!=0) ") ;
	 
	$shipmode_cartoon=sql_select("select  sum(b.total_carton_qnty) as total_carton_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no'") ;
	if($within_group==2)
		{
			$send_to_company=$dataArray[0][csf('sent_to')];
		}
		else
		{
			$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	if($show_item==1)
	{
		$width=1130;
		//$colspan=5;
	}
	else
	{
		$width=1130;
		//$colspan=5;
		$colspan2=2;
	}
	$com_dtls = fnc_company_location_address($company, $location, 2);
	
	$gate_id=$dataArray[0][csf('id')];
	//-----------dtls query

	 

	$sql_dtls= "select a.id, a.issue_number, a.item_category, a.fso_no, a.booking_no, b.issue_qnty, b.no_of_roll, c.remarks, c.uom,b.id as fabric_issue_dtls_id
	from inv_issue_master a, inv_finish_fabric_issue_dtls b, inv_gate_pass_dtls c
	where a.id=b.mst_id and a.id in($issue_id) and b.mst_id in($issue_id) and b.order_id=c.buyer_order_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by  a.id, a.issue_number, a.item_category, a.fso_no, a.booking_no, b.issue_qnty, b.no_of_roll, c.remarks, c.uom,b.id order by a.id";
	//pro_roll_details b  //, c.rate, c.amount


	
	//echo $sql_dtls; die;

	$sql_result=sql_select($sql_dtls);
	
	$all_data_arr=array();
	foreach($sql_result as $row)
	{
		$all_data_arr[$row[csf("id")]]['issue_number']=$row[csf("issue_number")];
		$all_data_arr[$row[csf("id")]]['item_category']=$row[csf("item_category")];
		$all_data_arr[$row[csf("id")]]['fso_no']=$row[csf("fso_no")];
		$all_data_arr[$row[csf("id")]]['booking_no']=$row[csf("booking_no")];
		$all_data_arr[$row[csf("id")]]['remarks']=$row[csf("remarks")];
		$all_data_arr[$row[csf("id")]]['uom']=$row[csf("uom")];
		$all_data_arr[$row[csf("id")]]['issue_qnty']+=$row[csf("issue_qnty")];
		$all_data_arr[$row[csf("id")]]['no_of_roll']+=$row[csf("no_of_roll")];
		//$all_data_arr[$row[csf("id")]]['rate']=$row[csf("rate")];
		//$all_data_arr[$row[csf("id")]]['amount']+=$row[csf("amount")];
		
		
	}

	//$buyerPoNos = rtrim($buyerPoNos, ',');

	/*$item_group_result = sql_select("select buyer_po_no, item_group from subcon_ord_dtls where buyer_po_no in($buyerPoNos) and status_active=1");

	$jobItemGroupArr = array();

	foreach ($item_group_result as $row) {
		$jobItemGroupArr[$row[csf('buyer_po_no')]] = $row[csf("item_group")];
	}*/
	
	/*echo "<pre>";
	print_r($all_data_arr);*/
				
	for($iii=1;$iii<=3;$iii++)
	{
	
		?>
	    <div class="print_break">
			<div style="width:<? echo $width;?>px;" align="center">
				<table width="<? echo $width;?>" cellspacing="0" align="center" border="0">
					<tr>
					<tr>
						<td  align="left"><img src="../../<? echo $com_dtls[2]; ?>" height="70" width="200"></td>
						<td colspan="5" align="center"  style="font-size:xx-large;">
							<!-- <span style="font-weight: bolder;"><? //echo "Delivery Company: ". $dataArray[0][csf('delivery_company')]; ?></span><br/> -->
							<span style="font-weight: bolder;"><? echo "LC Company: ". $com_dtls[0]; ?></span>
						
						</td>
						<td style="text-align:right;">
							<span style='font-size:22px;'>
							<? echo $iii;?><sup><?php if($iii==1) { echo 'st';} elseif($iii==2) { echo  'nd';} else{ echo 'rd';} ?></sup> Copy</span><br><br>
		                    &nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;font-size:30px;'>Returnable</span>";?>
		                	
						</td>
					</tr>
					<tr class="form_caption">
						<td colspan="8" align="center">
							<?
							echo $com_dtls[1];
							?> 
							<div style="width:34%; text-align:center">
							&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
						</div>
						</td>
					</tr>
					<tr>
						<td style="display:none" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
					</tr>
					<tr>
						<td colspan="8" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
					</tr>
					<tr>
						<td width="160"><strong>System ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
						<td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
						<td width="125"><strong>Mobile No:</strong></td><td width="175px" colspan="2"><? echo $dataArray[0][csf("mobile_no")]; ?></td>
					</tr>
					<tr>
						
						<td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
						<td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
						<td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
					</tr>
					<tr>
						<td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
						<td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
						<td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
					</tr>
					<tr>
					
						<td><strong>Out-Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
						<td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
						<td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
					</tr>
					<tr>
						<td><strong>Est. Return Date :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
						<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
						<td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
						
					</tr>
					<tr>
						<td><strong>Vehicle Number:</strong></td><td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>


						<td><strong>To Location :</strong></td><td><?  if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
						<td><strong>Bar Code:</strong></td><td  colspan="2" id="barcode_img_id<?= $iii;?>"></td> 
					</tr>
					<tr>
						<td><strong>Remarks</strong></td>
						<td colspan="3" align="left"> <?  echo $dataArray[0][csf("remarks")]; ?> </td>
					</tr>


				</table>
				<br>
				<table align="center" cellspacing="0" width="<? echo $width;?>"  border="1" rules="all" class="rpt_table" > 
					<thead bgcolor="#dddddd" align="center">
						<th width="30">SL</th>
						<th width="180" align="center">Item Category</th>
                        <th width="180" align="center">Challan/System No:</th>
						<th width="180" align="center">FSO No</th>
						<th width="150" align="center">Booking No</th>
						<th width="50" align="center">UOM</th>
						<th width="100" align="center">Quantity</th>
						<th width="80" align="center">Roll </th>
						<!-- <?
						//if($show_item==1)
						{
						?>
						<th width="50" align="center">Rate</th> 
						<th width="80" align="center">Amount </th>
						<?
						}
						?> -->
						<th align="center">Remarks</th>
					</thead>
				<?
				
				
				$p=0;
				$i=1;
				$tot_qty=0; $tot_amount=0; $tot_roll=0; 
				foreach($all_data_arr as $row)
				{
					
					if ($i%2==0)  
						$bgcolor="#E9F3FF";
					else
						$bgcolor="#FFFFFF"; 
					
					
					?>
					<tr bgcolor="<? echo $bgcolor; ?>">
						<td><? echo $i; ?></td>
						<td><?  echo $item_category[$row['item_category']]; ?></td>
                        <td><?  echo $row['issue_number'];?></td>
						<td><?php echo $row['fso_no']; ?></td>
						<td><?php echo $row['booking_no']; ?></td>
						<td align="center"><? echo $unit_of_measurement[$row['uom']]; ?></td>
						<td align="right"><? echo number_format($row['issue_qnty'],2,'.',''); ?></td> 
						<td align="right"><? echo number_format($row['no_of_roll'],0); ?></td>
						<!-- <?
						//if($show_item==1)
						{
						?>
						<td align="right"><? //echo number_format($row['rate'],2,'.',''); ?></td>
						<td align="right"><? //echo number_format($row['amount'],2,'.',''); ?></td>
						<?
						}
						?> -->
						<td><? echo $row['remarks']; ?></td>
					</tr>
					<?php
					
					
					$i++;
					$p++;
					
					$tot_qty+=$row['issue_qnty'];		
					//$tot_amount+=$row['amount'];
					$tot_roll+=$row['no_of_roll'];
				
				}
				?>
				<tr>
				<td colspan="6" align="right"> <b>Total:</b></td>
				<td align="right"><b><? echo number_format($tot_qty,2);?></b></td>
				<td align="right"><b><? echo number_format($tot_roll,0);?></b></td>
				<!-- <?
				//if($show_item==1)
				{
				?>
				<td align="right"></td>
				<td align="right"><b><?= $tot_amount;?></b></td>
				<?
				}
				?> -->
				<td align="right"></td>
				</tr>
				<?
				$width_sign=$width.'px';
				?>
				</table>
				<? 
				?>


			</div>
			<div>
				<? echo signature_table(114, $data[0], $width_sign,$template_id); ?>
			</div>
	    </div>
	    <? 

	} 
	?>
	<style>
		@media print {
			.print_break {page-break-after: always!important;}
		}
	</style>
 	<script type="text/javascript" src="../../js/jquery.js"></script>
	<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
	<script>

	function generateBarcode( valuess,id ){
		   
			var value = valuess;//$("#barcodeValue").val();
		 // alert(value)
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='bmp';// $("input[name=renderer]:checked").val();
			 
			var settings = {
			  output:renderer,
			  bgColor: '#FFFFFF',
			  color: '#000000',
			  barWidth: 1,
			  barHeight: 30,
			  moduleSize:5,
			  posX: 10,
			  posY: 20,
			  addQuietZone: 1
			};
			$("#barcode_img_id"+id).html('11');
			 value = {code:value, rect: false};
			
			$("#barcode_img_id"+id).show().barcode(value, btype, settings);
		} 
	 //generateBarcode('<? echo $data[1]; ?>');
	 </script>
     
   
     
     
    <?

	for($iii=1;$iii<=3;$iii++){ ?>  
		<script> generateBarcode('<?= $data[1]; ?>',<?= $iii;?>); </script>
	<?
    }

    exit();
}

if($action=="print_to_html_report16")
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//print_r ($data); die;
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[2];
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");


	$user_library=return_library_array( "select id, user_full_name from user_passwd", "id", "user_full_name"  );
	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
	$sql="select id, sys_number, company_id, basis, department_id, issue_purpose, within_group, section,attention, sent_by,carried_by, sent_to,vhicle_number, out_date, challan_no, time_hour, time_minute, returnable, delivery_as, est_return_date, location_id, location_name, com_location_id, remarks, mobile_no, returnable_gate_pass_reff, delivery_company, inserted_by,security_lock_no from inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0"; 
	//echo $sql;
	$dataArray=sql_select($sql);

	$gate_id=$dataArray[0][csf('id')];
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
 	$sent_to=$dataArray[0][csf('sent_to')];
 	$prepared_by=$user_library[$dataArray[0][csf('inserted_by')]];

	$shipmode_cartoon=sql_select("select  b.total_carton_qnty,b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no' order by b.id");
	
	$shipmodes=sql_select("select a.lock_no, b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no' and (b.shiping_mode is not null or b.shiping_mode!=0) ");
	/*echo "<pre>";
	print_r($shipmodes);die;*/

	if($basis==5 or $basis==1 or $basis==7 or $basis==38)
    {
		$sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags from  inv_gate_pass_dtls a where a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 order by a.uom,a.id ";

		$sql_sel=sql_select($sql_dtls);
	}
	else
	{
		$sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags,b.issue_id from  inv_gate_pass_dtls a,inv_gate_pass_mst b  where b.id=a.mst_id and a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 ";
		//echo $sql_dtls;
		
		$sql_result=sql_select($sql_dtls);
		
	}
	$buyer_order_id=array();
	foreach ($sql_result as $value)
	{

		if($buyer_order_id[$value[csf("buyer_order_id")]] != $value[csf("buyer_order_id")])
		{	
			$buyer_order_id[$value[csf("buyer_order_id")]] = $value[csf("buyer_order_id")];
		}
	}
	$buyer_order_ids= implode(",", $buyer_order_id);
 
	if($basis==1)
	{ 
		if($within_group==1)
		{
			//$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}
		else
		{
			//$send_to_company=$dataArray[0][csf('sent_to')];		
		}
	}
	else if($basis==8 || $basis==9 || $basis==27)
	{
		//$send_to_company=$dataArray[0][csf('sent_to')];	
		$sql_no_of_roll = "select a.id,b.carton_roll as no_roll,b.reject_qty,b.total_carton_qnty,b.id as dtls_id from subcon_delivery_mst a ,subcon_delivery_dtls b where a.id=b.mst_id  and a.delivery_no='$challan_no' and a.status_active=1 and a.is_deleted=0  and a.process_id in(2,4,3) and b.order_id in( $buyer_order_ids)";
		//echo $sql_no_of_roll;//die;
		$no_of_rolls = sql_select($sql_no_of_roll);
				
	}
	else if($basis==17)
	{
		$no_of_rolls=sql_select("select b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty as cons_quantity,
		b.yarn_lot,b.rate as cons_rate,b.transfer_value as cons_amount,b.brand_id,c.product_name_details,d.no_of_bags,b.roll as no_roll from inv_item_transfer_mst a,inv_item_transfer_dtls b,product_details_master c,inv_transaction d 
		where a.id=b.mst_id and c.id=b.from_prod_id and b.from_prod_id=d.prod_id and a.transfer_system_id='$challan_no' and b.item_category=13 
		and b.status_active = '1' and b.is_deleted = '0' and d.no_of_bags is not NULL
		group by  b.id, b.mst_id,b.from_store, b.to_store, b.from_prod_id, b.to_prod_id, b.transfer_qnty,
		b.yarn_lot,b.rate,b.transfer_value ,b.brand_id,c.product_name_details,d.no_of_bags ,b.roll ");
	}
	else if($basis==11)
	{
		$no_of_rolls=sql_select("select a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity,b.batch_id,roll as no_roll
				from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
				where a.sys_number='$challan_no' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form=54 and b.entry_form=54");
	}
	else if($basis==12)
	{
		//$send_to_company=$supplier_name_library[$dataArray[0][csf('sent_to')]];
	}
	else if($basis==10)
	{
		$no_of_rolls=sql_select("select a.id,b.order_id, b.determination_id, b.gsm, b.dia, b.current_delivery as cons_quantity,b.roll as no_roll
				from  pro_grey_prod_delivery_mst a, pro_grey_prod_delivery_dtls b 
				where a.sys_number='$challan_no' and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.entry_form=53 and b.entry_form=53");
	}
	else if($basis==15) //Finish Fabric Recv Return
	{
		//echo $mst_challan;
		
		 $no_of_rolls =sql_select("select a.id as issue_id, a.item_category, a.received_id, a.received_mrr_no, b.id as trans_id, b.cons_quantity as cons_quantity,b.cons_uom, b.cons_rate, b.cons_amount, c.product_name_details, c.id as prod_id  ,b.no_of_roll as no_roll 
			from inv_issue_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id
			where a.id=b.mst_id and b.item_category=2 and b.transaction_type=3 and  a.issue_number='$challan_no' order by b.id");
		   
	}
	else if($basis==4)
	{
		$no_of_rolls = sql_select("select a.id,a.transaction_type,a.item_category,b.product_name_details,a.cons_rate,a.cons_quantity,a.cons_uom ,a.cons_amount,a.remarks,b.unit_of_measure ,c.no_of_roll as no_roll from inv_transaction a, product_details_master b,inv_finish_fabric_issue_dtls c ,inv_issue_master d,inv_gate_pass_mst e  where a.prod_id=b.id and d.id=a.mst_id  and d.id=c.mst_id and a.id=c.trans_id and d.id=e.issue_id and a.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.issue_number='$challan_no'"); 
 	}
 	else if($basis==22)
	{
	$no_of_rolls = sql_select("select b.roll_no as no_roll from inv_receive_mas_batchroll a,pro_grey_batch_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.recv_number='$challan_no'"); 

 	}
	else
	{
			
			//echo $within_group.'=='.$basis;
			/*if($basis==2 || $basis==3 || $basis==4 || $basis==5 || $basis==6 || $basis==7  ||  $basis==10 || $basis==13 ||  $basis==14 ||  $basis==11 ||  $basis==15)
			{
				if($within_group==2)
				{
					$send_to_company=$dataArray[0][csf('sent_to')];
				}
				else
				{
					$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
				}
			}
			else
			{
					$send_to_company=$dataArray[0][csf('sent_to')];	
			}*/
		
		
		
		//$send_to_company=$dataArray[0][csf('sent_to')];
	}
	
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}
	
	if($show_item==1)
	{
		$width=1150;
		//$colspan=5;
	}
	else
	{
		$width=1150;
		//$colspan=5;
		$colspan2=2;
	}
	$com_dtls = fnc_company_location_address($company, $location, 2);
	?>
	<style type="text/css">
		@media print{
			#signature_bottom{ 
				position:fixed; 
				bottom:-30px;
			}
			tr.page_break { 
				/* display: block; */ 
				page-break-before: always; }
			/*#table_row{
				position: relative;
				bottom: 0;
				height: 1180px!important;
				  overflow:hidden;
			}*/
		}

		@media screen{
		
		}
		
	</style>
    <?
    for($iii=1;$iii<=2;$iii++)
	{
		?>
        <div data-print=section class="print8_data">
        	<div style="width:<? echo $width;?>px;" align="center">
         			<table style="table-layout: fixed; " width="<? echo $width;?>">
					<tr>
						<td rowspan="5" width="300"><img src="<?=base_url($com_dtls[2]); ?>" height="60" width="60"></td>
					</tr>
					<tr style="font-size:xx-large;">
						<td width="500" style="text-align: center;"><strong><? echo $com_dtls[0]; ?></strong></td>
						<td width="200" style="text-align: right; padding-right: 7px">
						<span style="font-size:x-large; font-weight: bold;">
						<? //echo $iii;?> <?php if($iii==1) { echo 'Customer Copy';} elseif($iii==2) { echo 'Gate Copy';} else{ echo 'rd';} ?></span><br/>
						<span>
							<?
								if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;font-size:30px;'>Returnable</span>";
							?>
						</span>
						</td>
					</tr>
                    <tr>				
						<td style="text-align: center;"><?php echo $com_dtls[1]; ?></td>
					</tr>
					<tr>				
						<td style="text-align: center;"><?php if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]]; ?></td>
					</tr>
					<tr>
						<td style="text-align: center; font-size:x-large; text-decoration: underline; font-weight: bold;">Gate Pass</td>
					</tr>
				</table>
                <br>
        
        
        <table width="<? echo $width;?>" cellspacing="0" align="center" border="0">
            <tr>
                <td width="160"><strong>System ID</strong></td>
                <td width="175px" >: <? echo $dataArray[0][csf('sys_number')]; ?></td>
                <td width="120"><strong>Basis</strong></td>
                <td width="175px" >: <? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
                <td><strong>Department</strong></td> <td width="175px">: <? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
            </tr>
            <tr>
                <td width="125"><strong>Challan/System No</strong></td>
                <td colspan="5">: <? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
            </tr>
             <tr>
                <td><strong>Attention</strong></td><td width="175px" >: <? echo $dataArray[0][csf('attention')]; ?></td>
                
                <td><strong>Section</strong></td><td width="175px" >: <? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
                <td><strong>Sent By</strong></td> <td width="175px">: <? echo $dataArray[0][csf('sent_by')]; ?></td>
            </tr>
            <tr>
                <td><strong>Sent To</strong></td><td width="175px">: <? echo $send_to_company; ?></td>
                <td><strong>Out-Time</strong></td><td width="85px" >: <? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
                <td><strong>Out Date</strong></td><td width="175px" colspan="2">: <? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
            </tr>
            <tr>
                <td><strong>Purpose</strong></td><td>: <? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
                
                <td><strong>Returnable </strong></td><td width="175px">: <? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
                <td><strong>Delivery As</strong></td><td width="175px">: <? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
            </tr>
             <tr>
                <td><strong>Est. Return Date</strong></td><td width="175px">: <? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
                <td><strong>Carried By</strong></td><td>: <? echo $dataArray[0][csf('carried_by')]; ?></td>
                <td><strong>Vehicle Number</strong></td><td>: <? echo $dataArray[0][csf('vhicle_number')]; ?></td>
                
            </tr>
            
            
            <tr>
                <td><strong>Against Returnable Gate Pass</strong></td>
                <td>: <?  echo $dataArray[0][csf("returnable_gate_pass_reff")]; ?></td>
                <td><strong>To Location</strong></td><td>: <?  if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
                <td><strong>Bar Code</strong></td><td  colspan="2" id="barcode_img_id<?= $iii; ?>"></td> 
            </tr>
            <? if ($basis==12)
            {
                ?>
                <tr>
                    <td> <strong> Shipping Mode </strong></td>
                    <td align="left"> <?  echo $shipment_mode[$shipmodes[0][csf("shiping_mode")]]; ?> </td>
                    <td> <strong> Lock number </strong></td>
                    <td colspan="4" align="left"> <?  echo $shipmodes[0][csf("lock_no")]; ?> </td>
                </tr>
        
           <? }?>
           <tr>
              <td><strong>Delivery Company</strong></td>
              <td>: <?  echo $dataArray[0][csf("delivery_company")]; ?> </td>
              <td><strong>Mobile No</strong></td>
              <td align="left"> <?  echo $dataArray[0][csf("mobile_no")]; ?> </td>
              <td><strong>Remarks</strong></td>
              <td colspan="3" align="left"><?  echo $dataArray[0][csf("remarks")]; ?> </td>
			  
            </tr>
			<tr>
				<td><strong>Security Lock No</strong></td>
			  	<td colspan="7" align="left">: <?=$dataArray[0][csf("security_lock_no")];?></td>
			</tr>
    
        </table>
        <br>
        <? if($basis==5 or $basis==1 or $basis==7 or $basis==38)
        {
            ?>
            <table align="center" cellspacing="0" width="<? echo $width;?>"  border="1" class="rpt_table" >
                <thead bgcolor="#dddddd" align="center">
                    <th width="30">SL</th>
                    <th width="160" align="center">Item Category</th>
                    <th width="100" align="center">Sample</th>
                    <th width="160" align="center">Item Description</th>
                    <th width="50" align="center">UOM</th>
                    <th width="80" align="center">Quantity</th>
                    <? if($basis==12)
                    {
                        ?>
                        <th width="60" align="center">No Of Carton </th>
                        <?
                    }
                    else
                    {
                        ?>
                        <th width="60" align="center">No Of Roll </th>
                        <?
                     }
                     ?>
                    <th width="60" align="center">No Of Bag/Roll/GMT </th>
                    <?
                    if($show_item==1)
                    {
                        ?>
                        <th width="60" align="center">Rate</th> 
                        <th width="90" align="center">Amount </th>
                        <?
                    }
                    ?>
                    <th width="150" align="center">Buyer Order </th>
                    <th align="center">Remarks</th>
                </thead>
            <?
            $i=1;
            $gate_id=$dataArray[0][csf('id')];
            $sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags from  inv_gate_pass_dtls a where a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 order by a.uom,a.id ";
    
            $sql_sel=sql_select($sql_dtls);
            $general_item_arr=array();
            foreach($sql_sel as $values)
				{
					$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['qty']+=$values[csf("quantity")];
		
					$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['item_category_id']=$values[csf("item_category_id")];
		
					$general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['sample_id']=$values[csf("sample_id")];
    
                    $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['item_description']=$values[csf("item_description")];
    
    
                    $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['quantity']+=$values[csf("quantity")];
    
                    $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['amount']+=$values[csf("amount")];
    
                    $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['rate']+=$values[csf("rate")];
    
                    $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['buyer_order_id'].=$values[csf("buyer_order_id")].",";
    
                    $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['buyer_order'].=$values[csf("buyer_order")].",";
    
                    $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['remarks']=$values[csf("remarks")];
    
                    $general_item_arr[$values[csf("uom")]][$values[csf("item_description")]]['no_of_bags']=$values[csf("no_of_bags")];
            }
                   //echo "<pre>";print_r($general_item_arr);die;
                    $row_span_arr=array();
    
                    foreach($general_item_arr as $key=>$value)
                    {
    
                        $row_span=0;
                        foreach($value as $item_description_id=>$row)
                        {
                            $row_span++;
                        }
    
                        $row_span_arr[$key]=$row_span;
                    }
    
    
                     $i=1;
                    $tot_bags=0;$totAmount=0;
                    foreach($general_item_arr as $key=>$value)
                    {
    
                        $j=0;
                        foreach($value as $item_description_id=>$row)
                        {
                          
                            if($i==27){ $pagebreak = " class='page_break'";} else{ $pagebreak = "";}
                        ?>
    
                         <tr style="height: 45px" <?= $pagebreak;?>>
                            <td width="40"   align="center"><? echo $i;$i++; ?></td>
                            <td><?  echo $item_category[$row["item_category_id"]]; ?></td>
                            <td><?  echo $sample_library_arr[$row["sample_id"]]; ?></td>
                            <td><?  echo $row['item_description']; ?></td>
                            <? if($j==0)
                            {
                    
                            ?>
                            <td width="40" rowspan="<? echo $row_span_arr[$key]?>" align="center"><? echo $unit_of_measurement[$key]; ?></td>
                            <?
                            }
                            ?>
                            <td align="right"><? echo number_format($row['quantity'],2,'.',''); ?></td>  
                            <td align="right">&nbsp;</td>  
    
                        <td align="right"><? echo $row['no_of_bags']; ?></td>
                         <?
                        if($show_item==1)
                        {
                            ?> 
                            <td align="right"><? $rate=$row['amount']/$row['quantity']; echo number_format($rate,2,'.',''); ?></td>
                            <td align="right"><? echo number_format($row['amount'],2,'.',''); ?></td>
                            <?
                        }
                        ?>
                        <td style="word-break:break-all;"><? echo implode(",",array_unique(explode(",",chop($row['buyer_order'],",")))); ?></td>
                        <td><? echo $row['remarks']; ?></td>
    
    
                    <?
                     
                     $j++;
                     $total+=$row[("qty")];
                     $gr_total+=$row[("qty")];
                     $tot_qty +=$row['quantity'];
                     //$tot_bags +=$row['no_of_bags'];
                     $subtotAmount +=$row['amount'];
                     $totAmount +=$row['amount'];
                     }
                     ?>
                     <tr style="height: 45px">
                         <td colspan="5" align="right"><b>Sub Total</b></td>
                         <td align="right">  <b><? echo number_format($total,2); $total=0; ?></b></td>
                         <?
                        if($show_item==1)
                        {
                        ?>
                             <td colspan="3"></td>
                             <td align="right"><b><? echo number_format($subtotAmount,2); $subtotAmount=0; ?></b></td>
                         <?
                         }
                         ?>
                     </tr>
                      <?
                     
                 }
                 ?>
    
                 <tfoot bgcolor="#CCCCCC">
                <tr style="height: 45px">
                <td colspan="5" align="right"> <b> Total</b></td>
                <td align="right"><b><? echo number_format($tot_qty,2);?></b></td> 
                 <?
                if($show_item==1)
                {
                ?>      
                <td align="right"><b><? echo $tot_roll;?></b></td>    
                <?
                }
                else
                {  
                    echo "<td></td>" ;
                }
                ?>
    
                <td align="right"><b><? echo number_format($tot_bags,2);$tot_bags=0;?></b></td>
                  <?
                if($show_item==1)
                {
                ?>      
                <td></td>    
                <td align="right"><b><? echo number_format($totAmount,2); ?></b></td>    
                <?
                }
                
                ?>
                <td align="right"> </td>
                <td colspan="<? echo 4+$colspan2;?>"></td>
                </tr>
            </tfoot>
                      
                   
                <?
                    
            //echo $sql_dtls;
            $uom_check=array();
            $sql_result=sql_select($sql_dtls);
            $tot_qty=0; $tot_amount=0; $tot_amount=0;
            $p=0;
            
            //$tot_check=array();
            if(count($uom_check)==1)
            {
            ?>
           
            <?
            }
             $width_sign=$width.'px';
            ?>
            </table>
            <?
        }
        else 
        {
            ?>
            <table align="center" cellspacing="0" width="<? echo $width;?>"  border="1" class="rpt_table" >
                <thead bgcolor="#dddddd" align="center">
                    <th width="30">SL</th>
                    <th width="100" align="center">Item Category</th>
                    <th width="100" align="center">Sample</th>
                    <th width="220" align="center">Item Description</th>
                    <th width="50" align="center">UOM</th>
                    <th width="80" align="center">Quantity</th>
                    
                    <? if($basis==9 || $basis==8)
                    {?>
                     <th width="100" align="center">Reject Qty </th>
            
                    <?
                    }
                    ?>
                    
                    <? if($basis==12 || $basis==27)
                    {?>
                     <th width="100" align="center">Total Carton Qty </th>
            
                    <?
                    }
                    else
                    {
                    ?>
                     <th width="100" align="center">No Of Roll </th>
                     <?
                     }
                     if($basis!=12 && $basis!=27)
                    {?>
    
                        <th width="80" align="center">No Of Bag/Roll/GMT </th>
                    <?
                    }
                     ?>
    
                    <?
                    if($show_item==1)
                    {
                    ?>
                    <th width="50" align="center">Rate</th> 
                    <th width="80" align="center">Amount </th>
                    <?
                    }
                    ?>
                    <th width="80" align="center">Buyer Order </th>
                    <th align="center">Remarks</th>
                </thead>
            <?
            $i=1;
            $gate_id=$dataArray[0][csf('id')];
            $sql_dtls= " select a.id,a.item_category_id,a.sample_id, a.item_description,a.uom_qty, a.quantity, a.uom, rate, a.amount,a.buyer_order_id,a.buyer_order, a.remarks, a.no_of_bags,b.issue_id from  inv_gate_pass_dtls a,inv_gate_pass_mst b  where b.id=a.mst_id and a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 ";
            //echo $sql_dtls;
            $uom_check=array();
            $sql_result=sql_select($sql_dtls);
            $tot_qty=0; $tot_amount=0; $tot_amount=0; $noOfCarton=0;
            $tot_roll=0;
            $p=0;
            foreach($sql_result as $row)
            {
				//echo $p;
                $gatepass_data_arr[$row[csf('issue_id')]]['buyer_order']=$row[csf('buyer_order')];
                $gatepass_data_arr[$row[csf('issue_id')]]['remarks']=$row[csf('remarks')];
                if ($i%2==0)  
                    $bgcolor="#E9F3FF";
                else
                    $bgcolor="#FFFFFF";
                    
                    $buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
                    $style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
                    //if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
                    $uom_check[$row[csf('uom')]]=$row[csf('uom')];
                    if($i==21){ $pagebreak = " class='page_break'";} else{ $pagebreak = "";}
                    ?>
                    <tr style="height: 45px" bgcolor="<? echo $bgcolor; ?>" <?= $pagebreak; ?>>
                        <td><? echo $i; ?></td>
                        <td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
                        <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
                        <td><?  echo $row[csf('item_description')]; ?></td>
                        <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
                        <td align="right"><? echo number_format($row[csf('quantity')],2,'.',''); ?></td> 
                         <?  if($basis==9 || $basis==8)             
                            {
                                ?>
                                <td align="right"><? echo $no_of_rolls[$p][csf("reject_qty")]; ?></td>
                                <?
                            }
                        ?>
                        
                          
                        <?  if($basis==12)             
                            {
                                ?>
                                <td align="right"><? echo $shipmode_cartoon[$p][csf("total_carton_qnty")]; ?></td>
                                <?
                            }
                            else if ($basis==27) {
                                ?>
                                <td align="right"><? echo $no_of_rolls[$p][csf("total_carton_qnty")]; ?></td>
                                <?
                            }
                            else
                            {
                                ?>
                                <td align="right"><? if($basis==3){echo $no_of_rolls[$p][csf("no_roll")] =1; } else{echo $no_of_rolls[$p][csf("no_roll")] ;} ?></td>  
                                <?
                            }
                       
                         if($basis!=12 && $basis!=27)
                         {?>
                            <td align="right"><? echo$row[csf('no_of_bags')]; ?></td>
                        <?
                        }
                        ?>
                        <?
                        if($show_item==1)
                        {
                        ?>
                        <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
                        <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
                        <?
                        }
                        ?>
                        <td><? echo $row[csf('buyer_order')]; ?></td>
                        <td><? echo $row[csf('remarks')]; ?></td>
                    </tr>
                <?php
                $tot_roll +=$no_of_rolls[$p][csf("no_roll")];
                if ($basis==12) {
                    $noOfCarton+=$shipmode_cartoon[$p][csf("total_carton_qnty")];
                }
                else if ($basis==27) {
                    $noOfCarton+=$no_of_rolls[$p][csf("total_carton_qnty")];
                }
                else
                {
                    $noOfCarton+=$shipmode_cartoon[$p][csf("total_carton_qnty")];
                }
                $noOfReject+=$no_of_rolls[$p][csf("reject_qty")];
                $i++;
                $p++;
                
                $tot_qty+=$row[csf('quantity')];		
                $tot_amount+=$row[csf('amount')];
                //$tot_bags+=$row[csf('no_of_bags')];
                $subtotAmount +=$row['amount'];
                $totAmount +=$row['amount'];
            }
            if($basis==8)
            { 
                if($issueID !='')
                {
                    $sql_result_2=sql_select("select a.id,b.delivery_qty as cons_quantity,b.item_id,b.order_id,b.batch_id,b.reject_qty,b.carton_roll,b.mst_id from subcon_delivery_mst a ,subcon_delivery_dtls b where a.id=b.mst_id and b.mst_id=$issueID and a.status_active=1 and a.is_deleted=0 and a.process_id in(2,4) and b.delivery_qty<=0 ");	
                }
                
                $lib_item_arr=return_library_array( "select id,const_comp from lib_subcon_charge",'id','const_comp');
                foreach($sql_result_2 as $row)
                {
                    if($i==27){ $pagebreak = " class='page_break'";} else{ $pagebreak = "";}
                    ?>
                    <tr style="height: 45px" bgcolor="<? echo $bgcolor; ?>" <?= $pagebreak; ?>>
                        <td><? echo $i; ?></td>
                        <td><?  echo $item_category[13]; ?></td>
                        <td><?  //echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
                        <td><?  echo $lib_item_arr[$row[csf('item_id')]]; ?></td>
                        <td align="center"><? echo $unit_of_measurement[12]; ?></td>
                        <td align="right"><? echo number_format($row[csf('cons_quantity')],2,'.',''); ?></td> 
                        <?
                        if($basis==9 || $basis==8)             
                        {
                            ?>
                            <td align="right"><? echo $row[csf("reject_qty")]; ?></td>
                            <?
                        }
                        if($basis==12)             
                        {
                            ?>
                            <td align="right"><? echo $shipmode_cartoon[$p][csf("total_carton_qnty")]; ?></td>
                            <?
                        }
                        else
                        {
                            ?>
                            <td align="right"><? if($basis==3){echo $no_of_rolls[$p][csf("no_roll")] =1; } else{echo $row[csf("carton_roll")] ;} ?></td>  
                            <?
                        }
                        ?>
                        <td align="right"><? echo $row[csf('no_of_bags')]; ?></td>
                        <?
                        if($show_item==1)
                        {
                        ?>
                        <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
                        <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
                        <?
                        }
                        ?>
                        <td><? echo $gatepass_data_arr[$row[csf('mst_id')]]['buyer_order']; ?></td>
                        <td><? echo $gatepass_data_arr[$row[csf('mst_id')]]['remarks']; ?></td>
                    </tr>
                    <?		
                }
                $tot_roll +=$row[csf("carton_roll")];
                $noOfCarton+=$shipmode_cartoon[$p][csf("total_carton_qnty")];
                $noOfReject+=$row[csf("reject_qty")];
                $subtotAmount +=$row['amount'];
                $totAmount +=$row['amount'];
            }
            //$tot_check=array();
            if(count($uom_check)==1)
            {
            ?>
            <tfoot bgcolor="#CCCCCC">
                <tr style="height: 45px" >
                <td colspan="5" align="right"> <b> Total</b></td>
                <td align="right"><b><? echo number_format($tot_qty,2);?></b></td>
                <?
                if($basis==9 || $basis==8)
                {
                    ?>
                        <td align="right"><b><? echo $noOfReject;?></b></td> 
                    <?   
                }
                ?>
                
                 <?
                if($show_item==1)
                {
                    if($basis==12 || $basis==27)
                    {
                    ?>
                        <td align="right"><b><? echo $noOfCarton;?></b></td> 
                    <?   
                    }
                    else
                    {
                    ?>
                         <td align="right"><b><? echo $tot_roll;?></b></td> 
                    <?
                    } 
                ?>         
                <?
                }
                else
                {
                    if($basis==12 || $basis==27)
                    {
                    ?>
                        <td align="right"><b><? echo $noOfCarton;?></b></td> 
                    <?
                    }
                    else
                    {
                        ?>
                        <!--25.02.2020-->
                        <!--<td></td>-->
                        <td align="right"><b><?php echo $tot_roll; ?></b></td>
                        <?php 
                    }
                }
                
                if($basis!=12 && $basis!=27)
                {
                    ?>
                    <td align="right"><b><? echo number_format($tot_bags,2);$tot_bags=0;?></b></td>
                <?
                }
    
                if($show_item==1)
                {
                ?>
                <td align="right"> </td>
                <td align="right"><strong><? echo number_format($tot_amount,2);?></strong></td>
                <?
                }
                ?>
                <td colspan="<? echo 3+$colspan2;?>"></td>
                </tr>
            </tfoot>
            <?
            }
             $width_sign=$width.'px';
            ?>
            </table>
            <? 
    
        }
            if($show_item==1)
            {
            ?>
                <!-- <span><h4 align="center">In Words : &nbsp;<? //echo number_to_words($totAmount,"");?></h4></span> -->
            <?
            }
        ?>
        </div>
            <?
            

            	echo signature_table(114, $data[0], $width_sign,$template_id, 40, $prepared_by);
            	
            ?>
    	</div> 
		<p style="page-break-after:always;"></p>	
	
    	<? 
		} 
	?>
    <style>
		@media print {
			.print_break {page-break-after: always!important;}
		}
	</style>
 	<script type="text/javascript" src="../../js/jquery.js"></script>
      <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
    <script>

	function generateBarcode( valuess, id ){
		   
			var value = valuess;//$("#barcodeValue").val();
		 // alert(value)
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='bmp';// $("input[name=renderer]:checked").val();
			 
			var settings = {
			  output:renderer,
			  bgColor: '#FFFFFF',
			  color: '#000000',
			  barWidth: 1,
			  barHeight: 30,
			  moduleSize:5,
			  posX: 10,
			  posY: 20,
			  addQuietZone: 1
			};
			$("#barcode_img_id"+id).html('11');
			 value = {code:value, rect: false};
			
			//$("#barcode_img_id").show();
			$("#barcode_img_id"+id).show().barcode(value, btype, settings);
		} 
	 //generateBarcode('<? //echo $data[1]; ?>');
	 </script>
	 <?
		for($iii=1;$iii<=2;$iii++)
		{ 
			?>  
			<script>generateBarcode('<?= $data[1]; ?>',<?= $iii; ?>);</script>
			<?
    	}
    ?>	
     
     <script type="text/javascript">
		var staticHeight = 0;
		var pageHeight = 890;
		$('.print8_data').each(function() {
		    staticHeight += $(this).filter(':visible').outerHeight(true)+70;
		    console.log(staticHeight);
		    console.log(pageHeight);
		     
		    if (staticHeight > pageHeight) {
		        $(this).after( '<p style="page-break-after:always;"></p>');		        
		        staticHeight = 0;
		    }
		    else{
		    	/*$(this).after( '<hr style="border-top: dotted 2px #000">');*/
		    	$(this).css({
					"height": "680px",
					"margin-bottom": "30px"
					});
		    	//$(this).css('height', "680px");
		    	$('.print8_data').addClass("devider");
		    	
		    	
		    }

		});
	</script>
	<style type="text/css">		
		.devider:nth-of-type(2){
			margin-top: 100px;
		}
	</style>
	<?
	
	exit();
}

if($action=="print_to_html_report17")
{
	extract($_REQUEST);
	$ex_data=explode('*',$data);
	$company=$ex_data[0];
	$sys_id=$ex_data[1];
	$location=$ex_data[2];
	$basis=$ex_data[3];
	$challan_no=$ex_data[4];
	$cbo_template_id=$template_id;
	//$update_id=$ex_data[1];
	//echo $cbo_template_id.'**'.$company.'**'.$sys_id.'**'.$location.'**'.$basis.'**'.$challan;
	
	//print_r ($data);
	$imge_arr=return_library_array( "select master_tble_id,image_location from common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name");
	$supplier_library=return_library_array( "select id,supplier_name from lib_supplier", "id","supplier_name");
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name");
	$color_arr=return_library_array( "select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$count_arr=return_library_array( "select id, yarn_count from lib_yarn_count",'id','yarn_count');
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	//$item_arr=return_library_array( "select cons_comp_id, color_name from lib_color", "cons_comp_id", "color_name");
	
	//$color_arr=return_library_array( "select id, color_name from  lib_color", "id", "color_name"  );
	$sql_job_po="select a.id, a.order_no, a.cust_buyer, b.subcon_job, a.process_id from  subcon_ord_dtls a, subcon_ord_mst b where a.job_no_mst=b.subcon_job and b.is_deleted=0 and b.status_active=1 and a.status_active=1 and a.is_deleted=0";
	$job_po_array=array();
	$result_job_po=sql_select($sql_job_po);
	foreach($result_job_po as $row)
	{
		$job_po_array[$row[csf('id')]]['order_no']=$row[csf('order_no')];
		$job_po_array[$row[csf('id')]]['process_id']=$row[csf('process_id')];
		$job_po_array[$row[csf('id')]]['party_id']=$row[csf('party_id')]; 
		$job_po_array[$row[csf('id')]]['subcon_job']=$row[csf('subcon_job')]; 
		$job_po_array[$row[csf('id')]]['cust_buyer']=$row[csf('cust_buyer')]; 
	}
	//var_dump($job_po_array);
	$recChallan_arr=array();
	if($db_type==0)
	{
		$sql_rec="select b.order_id, group_concat(a.chalan_no) as chalan_no from sub_material_mst a, sub_material_dtls b where a.id=b.mst_id and a.trans_type=1 group by b.order_id";
	}
	else if ($db_type==2)
	{
		$sql_rec="select b.order_id, listagg((cast(a.chalan_no as varchar2(4000))),',') within group (order by a.chalan_no) as chalan_no from sub_material_mst a, sub_material_dtls b where a.id=b.mst_id and a.trans_type=1 group by b.order_id";
	}
	$result_sql_rec=sql_select($sql_rec);
	foreach($result_sql_rec as $row)
	{
		$chalan_no=array_unique(explode(",",$row[csf("chalan_no")]));
		$challan='';
		foreach($chalan_no as $val)
		{
			if($challan=="") $challan=$val; else $challan.=", ".$val;
		}

		$recChallan_arr[$row[csf('order_id')]]['chalan_no']=$challan;
	}
	
	$sql="select id, party_id, challan_no, process_id, delivery_date, forwarder, transport_company, vehical_no,delivery_no,inserted_by from subcon_delivery_mst where delivery_no='$challan_no' and company_id='$company' and status_active=1 and is_deleted=0";
	
	$dataArray=sql_select($sql);
	$inserted_by=$dataArray[0][csf('inserted_by')];
	$com_dtls = fnc_company_location_address($company, $location, 2);
    ?>
   <!--  <div style="width:930px;"> -->
    <div style="width:930px;height:8.5in;">
	   	<table width="100%" cellpadding="0" cellspacing="0" >
	       <tr>
	           <td width="200" align="right"> 
	               <img src='<?=base_url($com_dtls[2]); ?>' height='120%' width='120%' />
	           </td>
	           <td>
	                <table width="800" cellspacing="0" align="center">
	                    <tr>
	                        <td align="center" style="font-size:x-large">
	                        	<strong ><? echo $com_dtls[0]; ?></strong>
	                        </td>
	                    </tr>
	                    <tr class="form_caption">
	                        <td  align="center" style="font-size:14px">  
	                            <? echo $com_dtls[1]; ?> 
	                        </td>  
	                    </tr>
	                    <tr>
	                        <td align="center" style="font-size:18px"><strong>SubCon Knitting Delivery Challan</strong></td>
	                    </tr>
	                </table>
	            </td>
	        </tr>
	    </table>
	    <table width="900" cellspacing="0" align="right">
	        <tr><td colspan="6" align="center"><hr></hr></td></tr>
	        <tr>
	        	<td colspan="2">&nbsp;</td>
	        	<td><strong>Delivery No :</strong></td>
	        	<td> <? echo $dataArray[0][csf('delivery_no')] ; ?> </td>
	        	<td colspan="2">&nbsp;</td>
	        </tr>
	        <tr>
				<? 
	                $party_add=$dataArray[0][csf('party_id')];
	                $nameArray=sql_select( "select address_1, web_site, buyer_email, country_id from  lib_buyer where id=$party_add"); 
	                foreach ($nameArray as $result)
	                { 
	                    $address="";
	                    if($result!="")  $address=$result[csf('address_1')];
	                }
	            ?> 
	        	<td width="300" rowspan="4" valign="top" colspan="2" style="font-size:12px"><strong>Party : <? echo $buyer_library[$party_add].'<br>'.$address;  ?></strong>
	            
	        
	            </td>
	            <td width="125" style="font-size:12px"><strong>Challan No :</strong></td><td width="170px"><? echo $dataArray[0][csf('challan_no')]; ?></td>
	            <td width="125" style="font-size:12px"><strong>Delivery Date :</strong></td><td width="170px"><? echo change_date_format($dataArray[0][csf('delivery_date')]); ?></td>
	        </tr>
	        <tr>
	            <td style="font-size:12px"><strong>Transport Com.:</strong></td><td><? echo $dataArray[0][csf('transport_company')]; ?></td>
	            <td style="font-size:12px"><strong>Forwarder:</strong></td><td><? echo $supplier_library[$dataArray[0][csf('forwarder')]]; ?></td>
	        </tr>
	        <tr>
	            <td style="font-size:12px"><strong>Vehicle No:</strong></td><td><? echo $dataArray[0][csf('vehical_no')]; ?></td>
	            <td style="font-size:12px"><strong>D.O No:</strong></td><td><? //echo $supplier_library[$dataArray[0][csf('forwarder')]]; ?></td>
	        </tr>        
	    </table>
	    <!-- <br> -->
        <!-- <div style="width:100%; height:920px"> -->
		<?
		$machine_array=array();
		$mac_sql="Select id, machine_no, dia_width, gauge from  lib_machine_name where status_active=1 and is_deleted=0";
		
		$result_mac_sql=sql_select($mac_sql);
        foreach($result_mac_sql as $row)
        {
			$machine_array[$row[csf('id')]]['machine_no']=$row[csf('machine_no')];
			$machine_array[$row[csf('id')]]['gauge']=$row[csf('gauge')];
			$machine_array[$row[csf('id')]]['dia_width']=$row[csf('dia_width')];
		}
		
        $prod_dia_array=array();
        if($db_type==2)
        {
            $prod_dia_sql="select order_id, cons_comp_id, fabric_description, gsm, dia_width, dia_width_type, color_id, yarn_lot,
            listagg((cast(machine_id as varchar2(4000))),',') within group (order by machine_id) as machine_id,
			listagg((cast(machine_gg as varchar2(4000))),',') within group (order by machine_gg) as machine_gg,
            listagg((cast(machine_dia as varchar2(4000))),',') within group (order by machine_dia) as machine_dias,
            listagg((cast(yrn_count_id as varchar2(4000))),',') within group (order by yrn_count_id) as yrn_count_id,
            listagg((cast(stitch_len as varchar2(4000))),',') within group (order by stitch_len) as stitch_len,
			listagg((cast(brand as varchar2(4000))),',') within group (order by brand) as brand,
            sum(product_qnty) as production_qnty from subcon_production_dtls where product_type=2 and status_active=1 and is_deleted=0 group by order_id, cons_comp_id, fabric_description, gsm, dia_width, dia_width_type, color_id,yarn_lot";
        }
        else if($db_type==0)
        {
            $prod_dia_sql="select order_id, cons_comp_id, fabric_description, gsm, dia_width, dia_width_type, color_id,yarn_lot, 
            group_concat(machine_id) as machine_id,  group_concat(machine_gg) as machine_gg, group_concat(machine_dia) as machine_dias,
            group_concat(yrn_count_id) as yrn_count_id,
            group_concat(stitch_len) as stitch_len,
			group_concat(brand) as brand,
            sum(product_qnty) as production_qnty from subcon_production_dtls where product_type=2 and status_active=1 and is_deleted=0 group by order_id, cons_comp_id, fabric_description, gsm, dia_width, dia_width_type, color_id, yarn_lot";
        }
        //echo $prod_dia_sql;
        $result_prod_dia_sql=sql_select($prod_dia_sql);
        foreach($result_prod_dia_sql as $row)
        {
			$machine_id=array_unique(explode(",",$row[csf('machine_id')]));
			$machine_name=""; $gauge_value=""; $machine_dia="";
			foreach($machine_id as $val)
			{
				if($machine_name=="") $machine_name=$machine_array[$val]['machine_no']; else $machine_name.=", ".$machine_array[$val]['machine_no'];
				if($gauge_value=="") $gauge_value=$machine_array[$val]['gauge']; else $gauge_value.=", ".$machine_array[$val]['gauge'];
				if($machine_dia=="") $machine_dia=$machine_array[$val]['dia_width']; else $machine_dia.=", ".$machine_array[$val]['dia_width'];
			}
			
			if($row[csf('machine_dias')]=="") $machine_dia=$machine_dia; else $machine_dia=implode(",",array_filter(array_unique(explode(",",$row[csf('machine_dias')]))));
			if($row[csf('machine_gg')]=="") $gauge_value=$gauge_value; else $gauge_value=implode(",",array_filter(array_unique(explode(",",$row[csf('machine_gg')]))));
			
			$yarn_count=array_unique(explode(",",$row[csf('yrn_count_id')]));
			$count_name="";
			foreach($yarn_count as $val)
			{
				if($count_name=="") $count_name=$count_arr[$val]; else $count_name.=", ".$count_arr[$val];
			}
			
			$stitch_len_id=array_unique(explode(",",$row[csf('stitch_len')]));
			$stitch_len_name="";
			foreach($stitch_len_id as $val)
			{
				if($stitch_len_name=="") $stitch_len_name=$val; else $stitch_len_name.=", ".$val;
			}
			
			$brand=array_unique(explode(",",$row[csf('brand')]));
			$brand_name="";
			foreach($brand as $val)
			{
				if($brand_name=="") $brand_name=$val; else $brand_name.=", ".$val;
			}
			
            $prod_dia_array[$row[csf('order_id')]][$row[csf('cons_comp_id')]][$row[csf('gsm')]][$row[csf('dia_width')]][$row[csf('dia_width_type')]][$row[csf('color_id')]]['machine_dia']=$machine_dia;
			$prod_dia_array[$row[csf('order_id')]][$row[csf('cons_comp_id')]][$row[csf('gsm')]][$row[csf('dia_width')]][$row[csf('dia_width_type')]][$row[csf('color_id')]]['fabric_description']=$row[csf('fabric_description')];
			$prod_dia_array[$row[csf('order_id')]][$row[csf('cons_comp_id')]][$row[csf('gsm')]][$row[csf('dia_width')]][$row[csf('dia_width_type')]][$row[csf('color_id')]]['gauge']=$gauge_value;
            $prod_dia_array[$row[csf('order_id')]][$row[csf('cons_comp_id')]][$row[csf('gsm')]][$row[csf('dia_width')]][$row[csf('dia_width_type')]][$row[csf('color_id')]]['yrn_count_id']=$count_name;
			$prod_dia_array[$row[csf('order_id')]][$row[csf('cons_comp_id')]][$row[csf('gsm')]][$row[csf('dia_width')]][$row[csf('dia_width_type')]][$row[csf('color_id')]]['stitch_len']=$stitch_len_name;
			$prod_dia_array[$row[csf('order_id')]][$row[csf('cons_comp_id')]][$row[csf('gsm')]][$row[csf('dia_width')]][$row[csf('dia_width_type')]][$row[csf('color_id')]]['brand_name']=$brand_name;
        }
        //var_dump($prod_dia_array);
        
        $mst_id=$dataArray[0][csf('id')];
        
        $sql_kniting="select order_id, item_id, dia, width_dia_type, gsm, color_id, yarn_lot, delivery_qty, delivery_pcs, carton_roll, remarks, collar_cuff,reject_qty from subcon_delivery_dtls where mst_id='$mst_id' and process_id=2 ";
        $sql_kniting_result=sql_select($sql_kniting);
		?>
        <div>
	        <table align="left" cellspacing="0" width="1010"  border="1" rules="all" class="rpt_table" style="margin-top: 10px;">
	                            
				<?
				//die;
				$collar_cuff_arr=array();
				foreach($sql_kniting_result as $row)
	            {
					if($row[csf('collar_cuff')]!="")
					{
						$collar_cuff_arr[]=$row[csf('collar_cuff')];
					}
					$collar_cuff_count=count($collar_cuff_arr);
				}
	            $lib_item_arr=return_library_array( "select id,const_comp from lib_subcon_charge",'id','const_comp');
	            $i=1; $z=1; $collar_cuff_span=0; 
	            foreach($sql_kniting_result as $row)
	            {
					if($z==1)
					{
						?>
		                <thead bgcolor="#dddddd" align="center">
		                    <th width="25">SL</th>
		                    <th width="80">Order No</th>
		                    <th width="80">Job Number</th>
		                    <th width="60">Cust. Buyer</th>
		                    <th width="60">Count</th>                   
		                    <th width="50">Brand  /Lot</th>
		                    <th width="60">M/C Dia /Gauge</th>
		                    <th width="50">F.Dia /F.GSM</th>
		                    <th width="50">Dia Type</th>	                   
		                    <th width="60">Color</th>
		                    <th width="100">Description</th>	                    
		                    <th width="50">Roll   /Bag</th>
		                    <th width="50">Delivery Qty</th>
		                    <th width="50">Rec. Challan No</th>
		                    <th>Remarks</th>
		                </thead>
		                <?
						$z++;
					}

	                if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					
					$fabric_description=$prod_dia_array[$row[csf('order_id')]][$row[csf('item_id')]][$row[csf('gsm')]][$row[csf('dia')]][$row[csf('width_dia_type')]][$row[csf('color_id')]]['fabric_description'];
					$stitch_len=$prod_dia_array[$row[csf('order_id')]][$row[csf('item_id')]][$row[csf('gsm')]][$row[csf('dia')]][$row[csf('width_dia_type')]][$row[csf('color_id')]]['stitch_len'];
					$gauge_val=$prod_dia_array[$row[csf('order_id')]][$row[csf('item_id')]][$row[csf('gsm')]][$row[csf('dia')]][$row[csf('width_dia_type')]][$row[csf('color_id')]]['gauge'];
					$machine_dia_val=$prod_dia_array[$row[csf('order_id')]][$row[csf('item_id')]][$row[csf('gsm')]][$row[csf('dia')]][$row[csf('width_dia_type')]][$row[csf('color_id')]]['machine_dia'];
					$yrn_count_val=$prod_dia_array[$row[csf('order_id')]][$row[csf('item_id')]][$row[csf('gsm')]][$row[csf('dia')]][$row[csf('width_dia_type')]][$row[csf('color_id')]]['yrn_count_id'];
					$brand_name_val=$prod_dia_array[$row[csf('order_id')]][$row[csf('item_id')]][$row[csf('gsm')]][$row[csf('dia')]][$row[csf('width_dia_type')]][$row[csf('color_id')]]['brand_name'];
					$machine_dia_uni=implode(",",array_unique(explode(", ",$machine_dia_val)));
					$gauge_val_uni=implode(",",array_unique(explode(", ",$gauge_val)));
					
	                ?>
	                
	                <tr bgcolor="<? echo $bgcolor; ?>">
	                    <td><? echo $i; ?></td>
	                    <td><p><? echo $job_po_array[$row[csf('order_id')]]['order_no']; ?></p></td>
	                    <td><p><? echo $job_po_array[$row[csf('order_id')]]['subcon_job']; ?></p></td>
	                    <td><p><? echo $job_po_array[$row[csf('order_id')]]['cust_buyer']; ?></p></td>
	                    <td><p><? echo $yrn_count_val; ?></p></td>                
	                    <td><p>B:<? echo $brand_name_val; ?></p><br><p>L:<? echo $row[csf('yarn_lot')]; ?></p></td>
	                    <td><p>D:<? echo $machine_dia_uni; ?></p><br><p>G:<? echo $gauge_val_uni; ?></p></td>
	                    <td><p>D:<? echo $row[csf('dia')]; ?></p><br><p>G:<? echo $row[csf('gsm')]; ?></p></td>                   
	                    <td><p><? echo $fabric_typee[$row[csf('width_dia_type')]]; ?></p></td>
	                    <td><p><? echo $color_arr[$row[csf('color_id')]]; ?></p></td>
	                    <td><p><? echo $fabric_description; ?></p></td>                    
	                    <td align="right"><? echo number_format($row[csf('carton_roll')],2,'.',''); ?></td>
	                    <td align="right"><? echo number_format($row[csf('delivery_qty')],2,'.',''); ?></td>
	                    <td><p><? echo $recChallan_arr[$row[csf('order_id')]]['chalan_no']; ?></p></td>
	                    <td><p><? echo $row[csf('remarks')]; ?></p></td>
	                </tr>
	                <?
	                $grand_tot_roll+=$row[csf('carton_roll')];
	                $grand_tot_finish_qty+=$row[csf('delivery_qty')];
	                $grand_tot_delivery_pcs+=$row[csf('delivery_pcs')];
					$grand_tot_reject_qty+=$row[csf('reject_qty')];				
	                $i++;
	            }
	            ?>
	            <tfoot style="font-size:14px">
	                <th colspan="11" align="right"><strong>Total</strong></th>
	                <th align="right"><? echo number_format($grand_tot_roll,2,'.',''); ?></th>
	                <th align="right"><? echo number_format($grand_tot_finish_qty,2,'.',''); ?></th>
	                <th>&nbsp;</th>
	            </tfoot>
	        </table>
        </div>
       	<?		
        echo signature_table(64, $company, "950px");
        //echo signature_table(64, $company, "950px",$cbo_template_id,70,$user_lib_name[$inserted_by]);	
        ?>
        </div>        
        <?

        $sql="select id, sys_number, company_id, basis, department_id, issue_purpose, within_group, section, attention, sent_by, carried_by,  sent_to, vhicle_number, out_date, challan_no, time_hour, time_minute, returnable, delivery_as, est_return_date, location_id, location_name, com_location_id, remarks, mobile_no, delivery_company, issue_id from inv_gate_pass_mst where company_id='$company' and basis=$basis and sys_number='$sys_id' and status_active=1 and is_deleted=0";
        $dataArray=sql_select($sql);

		$gate_id=$dataArray[0][csf('id')];
		$get_pass_location=$dataArray[0][csf('location_id')];
        $basis=$dataArray[0][csf('basis')];
		$within_group=$dataArray[0][csf('within_group')];
		$challan_no=$dataArray[0][csf('challan_no')];
	 	$sent_to=$dataArray[0][csf('sent_to')];
	 	$delivery_company=$dataArray[0][csf('delivery_company')];
		$issue_id=$dataArray[0][csf('issue_id')];

		$shipmodes=sql_select("select  b.shiping_mode,b.ex_factory_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no' and (b.shiping_mode is not null or b.shiping_mode!=0) ") ;
	 
		$shipmode_cartoon=sql_select("select  sum(b.total_carton_qnty) as total_carton_qnty from pro_ex_factory_delivery_mst  a,pro_ex_factory_mst b where a.id=b.delivery_mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.sys_number='$challan_no'") ;
		if($within_group==2)
		{
			$send_to_company=$dataArray[0][csf('sent_to')];
		}
		else
		{
			$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
		}

		$order_array=array();
		$order_sql="select a.style_ref_no, a.job_no, a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
		$order_sql_result=sql_select($order_sql);
		foreach ($order_sql_result as $row)
		{
			$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
			$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
		}

		$com_dtls = fnc_company_location_address($company, $get_pass_location, 2);

		$sql_dtls= "SELECT a.challan_details_id, a.challan_no, a.item_category_id,a.sample_id, a.item_description, a.uom_qty, a.quantity, a.uom, a.rate, a.amount, a.buyer_order_id, a.buyer_order, a.remarks, a.no_of_bags, a.item_description as item_count from inv_gate_pass_dtls a where a.mst_id=$gate_id and a.status_active=1 and a.is_deleted=0";

		$sql_result=sql_select($sql_dtls);
		$buyerPoNos='';
		foreach($sql_result as $row)
		{
			$all_data_arr[$row[csf("item_description")]]['item_category_id']=$row[csf("item_category_id")];
			$all_data_arr[$row[csf("item_description")]]['challan_no']=$row[csf("challan_no")];
			$all_data_arr[$row[csf("item_description")]]['sample_id']=$row[csf("sample_id")];
			$all_data_arr[$row[csf("item_description")]]['uom']=$row[csf("uom")];
			$all_data_arr[$row[csf("item_description")]]['quantity']+=$row[csf("quantity")];
			$all_data_arr[$row[csf("item_description")]]['no_roll']=$row[csf("no_roll")];
			$all_data_arr[$row[csf("item_description")]]['item_count']=$row[csf("item_count")];
			$all_data_arr[$row[csf("item_description")]]['no_of_bags']=$row[csf("no_of_bags")];
			$all_data_arr[$row[csf("item_description")]]['rate']=$row[csf("rate")];
			$all_data_arr[$row[csf("item_description")]]['amount']=$row[csf("amount")];
			$all_data_arr[$row[csf("item_description")]]['buyer_order']=$row[csf("buyer_order")];
			$all_data_arr[$row[csf("item_description")]]['remarks']=$row[csf("remarks")];
			$all_data_arr[$row[csf("item_description")]]['item_description']=$row[csf("item_description")];

			$buyerPoNos .= "'".$row[csf("buyer_order")] . "',";
		}

		$buyerPoNos = rtrim($buyerPoNos, ',');

		$item_group_result = sql_select("select buyer_po_no, item_group from subcon_ord_dtls where buyer_po_no in($buyerPoNos) and status_active=1");

		$jobItemGroupArr = array();

		foreach ($item_group_result as $row) {
			$jobItemGroupArr[$row[csf('buyer_po_no')]] = $row[csf("item_group")];
		}
		?>
		<div style="width:930px;height:4in;">
		<table width="950" cellspacing="0" align="center" border="0">
			<tr>
				<td  align="left"><img src="../../<? echo $com_dtls[2]; ?>" height="70" width="200"></td>
				<td colspan="6" align="center"  style="font-size:x-large;">
					<span style="font-weight: bolder;"><? echo "Delivery Company: ". $dataArray[0][csf('delivery_company')]; ?></span><br/>
					<span style="font-weight: bolder;"><? echo "LC Company: ". $com_dtls[0]; ?></span>
				
				</td>
				<td style="text-align:right;">
					<? if($dataArray[0][csf('returnable')]==1) echo"<span style='border:1px solid #CCC; background:#EEE;font-size:30px;'>Returnable</span>"; ?>                	
				</td>
			</tr>
			<tr class="form_caption">
				<td colspan="6" align="center">
					<?
					echo $com_dtls[1];
					?> 
					<div style="width:34%; text-align:center">
					&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
				</div>
				</td>
			</tr>
			<tr>
				<td style="display:none" colspan="6" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
			</tr>
			<tr>
				<td colspan="6" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
			</tr>
			<tr>
				<td width="125"><strong>System ID:</strong></td> <td width="175px" style="font-size:18px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
				<td width="125"><strong>Basis:</strong></td><td width="175px"><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
				<td width="125"><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>				
			</tr>
			<tr>
				
				<td><strong>Challan/System No:</strong></td> <td width="175px"><? echo $challan_no; ?></td>
				<td><strong>Out-Time:</strong></td><td width="175px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
				<td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
			</tr>
			<tr>
				<td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
				<td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
				<td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
			</tr>
			<tr>
				<td><strong>Carried By:</strong></td><td width="175px"><? echo $dataArray[0][csf('carried_by')]; ?></td>
				<td><strong>Vehicle Number:</strong></td><td width="175px"><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
				<td><strong>Bar Code:</strong></td><td  colspan="2" id="barcode_img_id"></td>				
			</tr>			
		</table>
		<!-- <br> -->
		<table align="center" cellspacing="0" width="950"  border="1" rules="all" class="rpt_table" > 
			<thead bgcolor="#dddddd" align="center">
				<th width="30">SL</th>
				<th width="150" align="center">Item Category</th>
				<th width="250" align="center">Item Description</th>
				<th width="120" align="center">Quantity</th>
				<th width="120" align="center">No Of Roll</th>
				<th width="120" align="center">Buyer Order</th>
				<th align="center">Remarks</th>
			</thead>
		<?
		$p=0;
		$i=1;
		$tot_qty=0; $tot_bags=0;
		foreach($all_data_arr as $description => $row)
		{
			if ($i%2==0)  
				$bgcolor="#E9F3FF";
			else
				$bgcolor="#FFFFFF"; //$row['buyer_po_no']
			
			$buyer=$order_array[$row['buyer_order_id']]['buyer_name'];
			$style_ref_no=$order_array[$row['buyer_order_id']]['style_ref_no'];
			?>
			<tr bgcolor="<? echo $bgcolor; ?>">
				<td><? echo $i; ?></td>
				<td><? echo $item_category[$row['item_category_id']]; ?></td>
				<td><? //echo $item_group_arr[$jobItemGroupArr[$row['buyer_order']]].', '.$row['item_description']; ?><? echo $row['item_description']; ?></td>
				<td align="right"><? echo number_format($row['quantity'],2,'.',''); ?></td>
				<td align="right"><? echo $row['no_of_bags']; ?></td>
				<td><? echo $row['buyer_order']; ?></td>
				<td><? echo $row['remarks']; ?></td>
			</tr>
			<?		
			$i++;
			$tot_qty+=$row['quantity'];		
			//$tot_bags+=$row['no_of_bags'];
		
		}
		?>
		<tr>
			<td colspan="3" align="right"><b>Total:</b></td>
			<td align="right"><b><? echo number_format($tot_qty,2);?></b></td>
			<td align="right"><b><? echo number_format($tot_bags,2);?></b></td>
			<td align="right">&nbsp;</td>
			<td align="right">&nbsp;</td>
		</tr>
		</table>
		<!-- </br> -->
		<?
		echo signature_table(114, $company, "950px", '', "40px");
		?>
	</div>

		<script type="text/javascript" src="../../js/jquery.js"></script>
		<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
		<script>

		function generateBarcode( valuess,id ){		   
			var value = valuess;//$("#barcodeValue").val();
		 // alert(value)
			var btype = 'code39';//$("input[name=btype]:checked").val();
			var renderer ='bmp';// $("input[name=renderer]:checked").val();
			 
			var settings = {
			  output:renderer,
			  bgColor: '#FFFFFF',
			  color: '#000000',
			  barWidth: 1,
			  barHeight: 30,
			  moduleSize:5,
			  posX: 10,
			  posY: 20,
			  addQuietZone: 1
			};
			$("#barcode_img_id").html('11');
			 value = {code:value, rect: false};
			
			$("#barcode_img_id").show().barcode(value, btype, settings);
		} 
		generateBarcode('<?= $sys_id; ?>');
	 //generateBarcode('<? echo $sys_id; ?>');
	</script>
	<? 
	exit();
}

if ($action=="get_out_entry_print10_bcs")  // Print 10
{
	extract($_REQUEST);
	$data=explode('*',$data);
	//echo "<pre>";
	//print_r($data);
	$show_item=$data[3];
	$company=$data[0];
	$location=$data[5];
	$no_copy=$data[6];
	//echo $company.'='.$location;die;
 //	$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$color_library=return_library_array( "select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name"  );
	$brand_arr=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name"  );
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");

	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );	
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
	$sql="select id, sys_number,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,vhicle_number,com_location_id,mobile_no,remarks,security_lock_no from   inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 ";
	$dataArray=sql_select($sql);

	

	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	$gate_id=$dataArray[0][csf('id')];
	$bags_cone_arr=array();
	$prod_id=array();
	$brand_lot_arr=array();

	$is_gate_out = 0;

	if($gate_id != '')
	{
		$sql_gate_out="SELECT out_date as OUT_DATE, out_time as OUT_TIME from inv_gate_out_scan where status_active = 1 and is_deleted = 0 and inv_gate_pass_mst_id='".$gate_id."'";
		$sql_gate_out_rslt = sql_select($sql_gate_out);
		if(!empty($sql_gate_out_rslt))
		{
			foreach($sql_gate_out_rslt as $row)
			{
				$is_gate_out = 1;
			}
		}
	}
	
	//echo $basis; die;
	
	if($basis==2)
	{
		$sqls="SELECT a.id,a.prod_id,a.no_of_bags,a.cone_per_bag from inv_transaction a,inv_gate_pass_mst b,inv_gate_pass_dtls c where a.id=c.challan_no and b.id=c.mst_id  and b.sys_number='$data[1]' group by a.id,a.prod_id,a.no_of_bags,a.cone_per_bag ";
		foreach(sql_select($sqls) as $val)
		{
			$bags_cone_arr[$val[csf("id")]]["bags"]=$val[csf("no_of_bags")];
			$bags_cone_arr[$val[csf("id")]]["cone"]=$val[csf("cone_per_bag")];
			$bags_cone_arr[$val[csf("id")]]["prod_id"]=$val[csf("prod_id")];
			$prod_id[$val[csf("prod_id")]]=$val[csf("prod_id")];
		}
		$prod_ids=0;
		if(count($prod_id)>0)
		{
			$prod_ids=implode(",", $prod_id);
		}

		$sql2="SELECT  id,brand,lot  from product_details_master where  id in($prod_ids) ";
		foreach(sql_select($sql2) as $val)
		{
			$brand_lot_arr[$val[csf("id")]]["brand"]=$brand_arr[$val[csf("brand")]];
			$brand_lot_arr[$val[csf("id")]]["lot"]=$val[csf("lot")];			 
		}
	}

	if ($within_group==2) $send_to_company=$dataArray[0][csf('sent_to')];
	else $send_to_company=$company_library[$dataArray[0][csf('sent_to')]];


	if ($basis==12)
	{
		$sql_bag_remarks= sql_select(" SELECT buyer_order_id, remarks, no_of_bags from  inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 ");
		$noOfBagsRemarks_arr=array();
		foreach ($sql_bag_remarks as $val) {
			$noOfBagsRemarks_arr[$val[csf('buyer_order_id')]]['no_of_bags']=$val[csf('no_of_bags')];
			$noOfBagsRemarks_arr[$val[csf('buyer_order_id')]]['remarks']=$val[csf('remarks')];
		}
	}
	else if ($basis==51)
	{
		$order_array=array();
		$order_sql="select a.subcon_job, a.within_group, a.party_id as buyer_name, b.id, b.order_no, b.order_quantity, b.buyer_po_id, b.buyer_po_no, b.buyer_style_ref as style_ref_no, b.buyer_buyer from subcon_ord_mst a, subcon_ord_dtls b where a.subcon_job=b.job_no_mst and a.entry_form=295 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
		$order_sql_result=sql_select($order_sql);
		foreach ($order_sql_result as $row)
		{
			$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
			$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
		}
	}
	else
	{
		$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
		$order_sql_result=sql_select($order_sql);
		foreach ($order_sql_result as $row)
		{
			$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
			$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
		}
	}


	if ($basis==12) 
	{
		$garments_delevery_id=return_field_value("id", "pro_ex_factory_delivery_mst", "company_id='$data[0]' and sys_number='$challan_no' and status_active=1 and is_deleted=0");
		//echo $garments_delevery_id;
	
		$sql_dtls="SELECT d.id, a.buyer_name, a.gmts_item_id, a.style_ref_no, b.id as buyer_order_id, b.po_number as buyer_order, c.color_number_id, d.country_id, sum(e.production_qnty) as quantity
		from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c, pro_ex_factory_mst d, pro_ex_factory_dtls e
		where a.id=b.job_id and b.id=d.po_break_down_id and b.id=c.po_break_down_id and a.id=c.job_id and c.id=e.color_size_break_down_id and d.id=e.mst_id and d.delivery_mst_id=$garments_delevery_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and e.status_active=1 and e.is_deleted=0 
		group by d.id, a.buyer_name, a.gmts_item_id, a.style_ref_no, b.id, b.po_number, c.color_number_id, d.country_id
		order by a.style_ref_no";
	}
	else
	{
		$sql_dtls= " SELECT id,item_category_id,sample_id, item_description,uom_qty, quantity, uom, rate, amount,buyer_order_id,buyer_order, remarks, challan_no, no_of_bags, total_carton_qty from  inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 ";
	}

	if($data[4]==8) //subcon challan (grey fabric)
	{
		$sql_result_subcon_grey=sql_select($sql_dtls);
		$buyer_orderIDs="";
		foreach($sql_result_subcon_grey as $row)
		{
			$buyer_orderIDs.=$row[csf('buyer_order')];
		}
		$buyer_orderID=chop($buyer_orderIDs,',');
		
		$sql_subcon_order_buyer=sql_select("select order_no,cust_buyer from subcon_ord_dtls where order_no in('$buyer_orderID') and status_active=1 and is_deleted=0");
		foreach($sql_subcon_order_buyer as $row)
		{
			$subcon_buyer_arr[$row[csf('order_no')]]['cust_buyer']=$row[csf('cust_buyer')];
		}
	}

	//echo $sql_dtls;
	$uom_check=array();
	$sql_result=sql_select($sql_dtls);
	// echo "<pre>"; print_r($sql_result); die;
	$sql_count=count($sql_result);
	// echo $sql_count; die;
	$tot_qty=0;$tot_amount=0; $total_carton=0;
	
	//print_r($order_array); 186
	//$copy_no=array(1,2,3,4); //for Dynamic Copy here 
	// if($no_copy<1 || $no_copy==""){$no_copy=1;}
	// for($cid=1; $cid<=$no_copy; $cid++ )
	// {
		//if ($basis ==12)
		if($show_item==1)
		{
			$width=1150;
			$colspan=5;
		}
		else
		{
			$width=1150;
			$colspan=5;
			$colspan2=0;
		}
		$com_dtls = fnc_company_location_address($company, $location, 2);
		?>
		<div style="width:<? echo $width;?>px;" align="center">
		    <table width="<? echo $width;?>px" cellspacing="0" align="center" border="0">
	            <tr>
	            	<td  align="left"><img src="<?=base_url($com_dtls[2]); ?>" height="45" width="45"></td>
				
	            	<td colspan="7" align="center"  style="font-size:xx-large;"><strong style="margin-left:100px" ><? echo $com_dtls[0]; ?><span style="font-size:x-large; margin-left:200px !important;"><? echo $cid;?><sup><?php if($cid==1) { echo 'st';} elseif($cid==2) { echo  'nd';} elseif($cid==3){ echo 'rd';} else { echo 'th';}?></sup> Copy</span></strong>
					
						<div style="float:right;width:34%; margin-top:10px; text-align:right">
							<p style="font-size: 18px; ">
								<?php echo ($challan_no?"<br><span style=\"color:#F00;font-weight:bold;\">Gate Pass Done</span>":'').($is_gate_out==1?"<br><span style=\"color:#F00;font-weight:bold;\">Gate Out Done</span>":''); ?>
							</p> 
							&nbsp;<? if($dataArray[0][csf('returnable')]==1)echo"<span style='border:1px solid #CCC; background:#EEE;padding:3px;'>Returnable</span>";?>
						</div> 
	            	</td>
	        	</tr>
	        	<tr class="form_caption">
	            	<td colspan="8" align="center">
					<? echo $com_dtls[1]; ?> 
	                <div style="width:34%; text-align:center">
	               	&nbsp;<? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?>
	                </div>
	            	</td>
	        	</tr>
		        <tr>
		        	<td style="display:none" colspan="8" align="center"><strong><? if($dataArray[0][csf('com_location_id')]!=0)echo "Unit: ".$location_library[$dataArray[0][csf('com_location_id')]];?></strong></td>
		        </tr>
		        <tr>
		            <td colspan="8" align="center" style="font-size:x-large"><strong><u>Gate Pass</u></strong></td>
		        </tr>
		        <tr>
		            <td width="160"><strong>System ID:</strong></td> <td width="175px" style="font-size:20px"><b><? echo $dataArray[0][csf('sys_number')]; ?></b></td>
		            <td width="120"><strong>Basis:</strong></td><td width="175px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
		            <td width="125"><strong>Challan/System No:</strong></td><td width="175px" colspan="2"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
		        </tr>
		        <tr>
		            
		            <td><strong>Department:</strong></td> <td width="175px"><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
		            <td><strong>Section:</strong></td><td width="175px" ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
		            <td><strong>Sent By:</strong></td> <td width="175px"><? echo $dataArray[0][csf('sent_by')]; ?></td>
		        </tr>
		        <tr>
		            <td><strong>Sent To:</strong></td><td width="175px" style="font-size:18px"><b><? echo $send_to_company; ?></b></td>
		            <td><strong>Attention:</strong></td><td width="175px" ><? echo $dataArray[0][csf('attention')]; ?></td>
		            <td><strong>Out Date:</strong></td><td width="175px" colspan="2"><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
		        </tr>
		        <tr>
		          
		            <td><strong>Out-Time:</strong></td><td width="85px" ><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
		            <td><strong>Returnable :</strong></td><td width="175px"><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
		            <td><strong>Delivery As:</strong></td><td width="175px"><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
		        </tr>
		        <tr>
		            <td><strong>Est. Return Date 	 :</strong></td><td width="175px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
		            <td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
		            <td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
		            
		        </tr>
		        <tr>
		           <td><strong>Bar Code:</strong></td><td  colspan="3" id="barcode_img_id_<? echo $cid; ?>"></td> 
		           <td><strong>To Location:</strong></td><td><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
		        </tr>
		        <tr>
		        	<td><strong>Mobile No:</strong></td>
					<td><? echo $dataArray[0][csf('mobile_no')]; ?></td>
		        	<td><strong>Security Lock No:</strong></td>
		        	<td><? echo $dataArray[0][csf('security_lock_no')]; ?></td>
					<td><strong>Vehicle No:</strong></td>
					<td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
		        </tr>
				<tr>
					<td><strong>Remarks: </strong></td>
					<td colspan="4"><? echo $dataArray[0][csf('remarks')];?></td>
				</tr>
	    	</table>
		    <br>
		    <table align="center" cellspacing="0" width="<? echo $width;?>px;"  border="1" rules="all" class="rpt_table" >
		        <thead bgcolor="#dddddd" align="center">
		            <th width="30">SL</th>
		            <th width="100" align="center">Item Category</th>
		            <? 
		            if($basis==2)
		            {
		            	?>
		            	<th width="70" align="center">Brand</th>
		            	<?
		            }
		            ?>
		            <th width="100" align="center">Sample</th>
		            <th width="200" align="center">Item Description</th>
		            <? 
		            if ($basis==2)
		            {
		            	?>
		            	<th width="70" align="center">Lot</th>
		            	<?

		            }
		            if ($basis==12)
		            {
		            	?>
		            	<th width="70" align="center">Color</th>
		            	<?
		            }	
		            ?>
		            <th width="50" align="center">UOM</th>
		            <th width="80" align="center">Quantity</th>
		            <? 
		            if ($basis==2)
		            {
		            	?>
		            	<th width="70" align="center">No. of Bag/Crtn</th>
		            	<th width="70" align="center">No.of Cone</th>		            	 
		            	<?
		            }
		            
		            if ($show_item==1)
					{
						?>
		            	<th width="50" align="center">Rate</th> 
		            	<th width="80" align="center">Amount </th>
		            	<?
					}

					if ($dataArray[0][csf('basis')]==33) 
					{
						?>
						<th width="100" align="center">Customer Buyer</th>
						<?
					}
					else
					{
						?>
		            	<th width="100" align="center">Buyer</th>
						<?
					}
					?>
		            <th width="100" align="center">Style</th>
		            <th width="80" align="center">Buyer Order</th>
		            <?php
		            	if ($basis==1)
			            {
			            	?>
			            	<th width="100" align="center">No Of Carton</th>   	 
			            	<?
			            }
		            ?>
		            <th width="60" align="center">NO of Bags/Rolls/GMT</th>
		            <th align="center">Remarks</th>
		        </thead>
				<?
			    $i=1;
			    $tot_qty=0;		
				$no_of_bag=0;
				$tot_amount=0;
				foreach($sql_result as $row)
				{
					$ref_id=$row[csf("challan_no")];
					if ($i%2==0) $bgcolor="#E9F3FF";
					else $bgcolor="#FFFFFF";
					
					
					//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
					if ($basis==12) 
					{
						$item_category_id=30;
						$item_description=$garments_item[$row[csf('gmts_item_id')]];
						$style_ref_no=$row[csf('style_ref_no')];
						$buyer_name=$buyer_library[$row[csf('buyer_name')]];
						$no_of_bags=$noOfBagsRemarks_arr[$row[csf('buyer_order_id')]]['no_of_bags'];
						$remarks=$noOfBagsRemarks_arr[$row[csf('buyer_order_id')]]['remarks'];
						$uom=1;
					}
					else
					{
						$item_category_id=$row[csf('item_category_id')];
						$item_description=$row[csf('item_description')];
						$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
						if($data[4]==8) $buyer_name=$subcon_buyer_arr[$row[csf('buyer_order')]]['cust_buyer'];
						else $buyer_name=$buyer_library[$buyer];
						$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
						$no_of_bags=$row[csf('no_of_bags')];
						$remarks=$row[csf('remarks')];
						$uom=$row[csf('uom')];
					} 
					$uom_check[$uom]=$uom;
					?>
					<tr bgcolor="<? echo $bgcolor; ?>">
		                <td><? echo $i; ?></td>
		                <td><?  echo $item_category[$item_category_id]; ?></td>
		                <? 
		                if($basis==2)
		                {
		                	?>
		                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["brand"]; ?></td>
		                	<?

		                }
		                ?>
		                <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
		                <td><?  echo $item_description; ?></td>
		                <? 
		                if ($basis==2)
		                {
		                	?>
		                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["lot"]; ?></td>
		                	<?
		                }
		                if ($basis==12)
		                {
		                	?>
		                	<td width="70" align="center"><? echo $color_library[$row[csf('color_number_id')]]; ?></td>
		                	<?
		                }	
		                ?>
		                <td align="center"><? echo $unit_of_measurement[$uom]; ?></td>
		                <td align="right"><? echo $row[csf('quantity')]; ?></td>
		                <? 
		                if($basis==2)
		                {
		                	?>
		                	<td width="70" align="center"><? echo $bags_cone_arr[$ref_id]["bags"];?></td>
		                	<td width="70" align="center"><? echo $bags_cone_arr[$ref_id]["cone"];?></td>	                	 
		                	<?
		                }
		                 
						if($show_item==1)
						{
							?>
			                <td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
			                <td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
			                <?
						}
						?>
		                <td align="center"><? echo $buyer_name; ?></td>
		                <td><? echo $style_ref_no; ?></td>
		                <td><? echo $row[csf('buyer_order')]; ?></td>
		                <?php
			            	if ($basis==1)
				            {
				            	?>
				            	<td  align="right"><? echo number_format($row[csf('total_carton_qty')],2,'.',''); ?></td>   	 
				            	<?
				            }
			            ?>
		                <td align="right"><? echo $no_of_bags; $no_of_bag+=$no_of_bags; ?></td>
		                <td><? echo $remarks; ?></td>
					</tr>
					<?
			    	$i++;					
					$tot_qty+=$row[csf('quantity')];
					$tot_amount+=$row[csf('amount')];
					$total_carton+=$row[csf('total_carton_qty')];
					//if($sql_count>1) {$inWordTxt="Quantity";} else{ $inWordTxt=$unit_of_measurement[$row[csf('uom')]];}
					if(count($uom_check)==1)
					{
						$inWordTxt=$unit_of_measurement[$uom];
					}
					else
					{
						$inWordTxt="";
					}
			    }
				//$tot_check=array();
				if($basis==2) $colspan+=2;
				if($basis==12) $colspan+=1;
				if(count($uom_check)==1)
				{
					?>
				    <tfoot bgcolor="#CCCCCC">
				        <tr>
				        <td colspan="<? echo $colspan;?>" align="right"> <b> Total</b></td>
				        <td align="right"><b><? echo number_format($tot_qty,2);?></b> </td>
				        <?
				        if($basis==2)
				        {
				        	?>
				        	<td colspan="2"></td>
				        	<?
				        }
						if($show_item==1)
						{
							?>
					        <td> </td>
					        <td align="right"><b> <? echo number_format($tot_amount,2);?></b> </td>
					        <?
						}
						?>
				        <?php
				        if($basis==1)
					        {
					        	?>
					        	<td colspan="<? echo 3+$colspan2;?>"></td>
					        	<td align="right"><b><? echo number_format($total_carton,2);?><b></td>
					        	
					        	<?php
					        }
					        else
					        {
					        	?>
					        	<td colspan="<? echo 3+$colspan2;?>"></td>
					        	<?
								
					        }
				        ?>
					        	<td align="right"><b><? echo $no_of_bag;?></b></td>
					        	<td align="right"><b></b></td>

				        </tr>				        
					</tfoot>
				    <?
				}
				$width_sign=$width.'px';
				// echo count($uom_check); die;
				?>
		    </table>
		    <span><h4 align="center">In Words : &nbsp;<? echo number_to_words(number_format($tot_qty,2,'.',''),$inWordTxt);?></h4></span>

		</div>
		<div>
			<? echo signature_table(114, $data[0], $width_sign,$template_id); ?>		    
		    <script type="text/javascript" src="../../js/jquery.js"></script>
		    <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
		    <script>
			function generateBarcode( valuess ){
				   
					var value = valuess;//$("#barcodeValue").val();
				    // alert(value)
					var btype = 'code39';//$("input[name=btype]:checked").val();
					var renderer ='bmp';// $("input[name=renderer]:checked").val();
					 
					var settings = {
					  output:renderer,
					  bgColor: '#FFFFFF',
					  color: '#000000',
					  barWidth: 1,
					  barHeight: 30,
					  moduleSize:5,
					  posX: 10,
					  posY: 20,
					  addQuietZone: 1
					};
					$("#barcode_img_id_<? echo $cid; ?>").html('11');
					 value = {code:value, rect: false};
					
					$("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
				} 
			 generateBarcode('<? echo $data[1]; ?>');
			 </script>
		</div>
		<p style="page-break-after:always;"></p>
	    <?
	// }	
	exit();
}


if ($action=="get_out_entry_print16___off") // Print 16
{    
	extract($_REQUEST);
	$data=explode('*',$data);
	// echo "<pre>";
	// print_r($data);	
	$show_item=$data[4];
	$cbo_returnable = $data[6];
	$company=$data[0];
	$location=$data[2];
	
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$brand_arr=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name");
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");

	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );	
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
	$sql="SELECT id, sys_number,approved,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,vhicle_number,com_location_id,mobile_no, security_lock_no,inserted_by from inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 ";
	//echo $sql;die();
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	$inserted_by=$dataArray[0][csf('inserted_by')];
	$is_approved=$dataArray[0][csf('approved')];
	if($is_approved==1){ $approved_status="Full Approved";}
    else if($is_approved==0){ $approved_status="Un Approved";}
    else{ $approved_status="Partial Approved";}
	$bags_cone_arr=array();
	$prod_id=array();
	$brand_lot_arr=array();
	if($basis==2)
	{
		$sqls="SELECT a.id,a.prod_id,a.no_of_bags,a.cone_per_bag from inv_transaction a,inv_gate_pass_mst b,inv_gate_pass_dtls c where a.id=c.challan_no and b.id=c.mst_id  and b.sys_number='$data[1]' group by a.id,a.prod_id,a.no_of_bags,a.cone_per_bag ";
		foreach(sql_select($sqls) as $val)
		{
			$bags_cone_arr[$val[csf("id")]]["bags"]=$val[csf("no_of_bags")];
			$bags_cone_arr[$val[csf("id")]]["cone"]=$val[csf("cone_per_bag")];
			$bags_cone_arr[$val[csf("id")]]["prod_id"]=$val[csf("prod_id")];
			$prod_id[$val[csf("prod_id")]]=$val[csf("prod_id")];
		}
		$prod_ids=0;
		if(count($prod_id)>0)
		{
			$prod_ids=implode(",", $prod_id);
		}

		$sql2="SELECT  id,brand,lot  from product_details_master where  id in($prod_ids) ";
		foreach(sql_select($sql2) as $val)
		{
			$brand_lot_arr[$val[csf("id")]]["brand"]=$brand_arr[$val[csf("brand")]];
			$brand_lot_arr[$val[csf("id")]]["lot"]=$val[csf("lot")];
			 
		}

	}	
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}	

	$copy_no=array(1,2,3); 

	foreach($copy_no as $cid)
	{
		if($show_item==1){
			$width=1150;
			$colspan=5;		
		}
		else{
			$width=1150;
			$colspan=5;
			$colspan2=2;
		}
		$address = "";
		$add_info = "";
		$nameArray=sql_select("select plot_no, level_no, road_no, block_no, country_id, province, city, zip_code, email, website from lib_company where id=$data[0]");
		if($nameArray[0][csf('plot_no')] != ''){
			$address.="Plot# ".$nameArray[0][csf('plot_no')].',';
		}
		if($nameArray[0][csf('level_no')] != ''){
			$address.="Level# ".$nameArray[0][csf('level_no')].',';
		}
		if($nameArray[0][csf('road_no')] != ''){
			$address.="Road# ".$nameArray[0][csf('road_no')].',';
		}
		if($nameArray[0][csf('block_no')] != ''){
			$address.="Block# ".$nameArray[0][csf('block_no')].'<br>';
		}
		if($nameArray[0][csf('city')] != ''){
			$address.=$nameArray[0][csf('city')].',';
		}
		if($nameArray[0][csf('zip_code')] != 0 && $nameArray[0][csf('zip_code')] != ''){
			$address.='-'.$nameArray[0][csf('zip_code')].',';
		}
		if($nameArray[0][csf('province')] != ''){
			$address.=$nameArray[0][csf('province')].','.$country_arr[$nameArray[0][csf('country_id')]];
		}
		if($nameArray[0][csf('email')] != 0){
			$add_info.='Email: '.$nameArray[0][csf('email')].', ';
		}
		if($nameArray[0][csf('website')] != 0){
			$add_info.='Website: '.$nameArray[0][csf('website')].',';
		}
		$com_dtls = fnc_company_location_address($company, $location, 2);
		?>
		<div data-print=section class="print6_data">
			<div style="width:<? echo $width;?>px;" align="center">
			    <table style="table-layout: fixed; " width="<? echo $width;?>">
					<tr>
						<td rowspan="5" width="300"><img src="<?=base_url($com_dtls[2]); ?>" height="60" width="140"></td>
					</tr>
					<tr style="font-size:xx-large;">
						<td width="500" style="text-align: center;"><strong><? echo $com_dtls[0]; ?></strong></td>
						<td width="200" style="text-align: right; padding-right: 7px">
						<span style="font-size:x-large; font-weight: bold;">
						<? echo $cid;?><sup><?php if($cid==1) { echo 'st';} elseif($cid==2) { echo  'nd';} else{ echo 'rd';} ?></sup> Copy</span><br/>
						<span>
							<?
								if($cbo_returnable == 1){
									echo "Returnable";
								}
							?>
						</span>
						</td>
					</tr>
					<tr>				
						<td style="text-align: center;"><?php echo $location_library[$dataArray[0][csf('com_location_id')]]; //echo $com_dtls[1]; ?>
						</td>
						<td style="text-align: right; "><span  id="barcode_img_id_<? echo $cid; ?>" ></span></td>
					</tr>
					<tr>			
						<td style="text-align: center;"><?php echo $add_info ?></td>
					</tr>
					<tr>
						<td style="text-align: center; font-size:x-large; text-decoration: underline; font-weight: bold;">Gate Pass</td>
						<td width="180" align="center" rowspan="5" style="font-size:18px;color:red;"><?=$approved_status;?> </td>
					</tr>
				</table>
				<br>
			    <table border="1" cellpadding="1" cellspacing="1" style="width:1150px" rules="all">
			        <tr>
			            <td width="80"><strong>System ID:</strong></td> <td width="150px"><? echo $dataArray[0][csf('sys_number')]; ?></td>
			            <td width="90"><strong>Basis:</strong></td><td width="150px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
			            <td width="80"><strong>Challan/System No:</strong></td><td width="150px"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
						<td width="90"><strong>Est. Return Date 	 :</strong></td><td width="120px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
						<td width="90"><strong>To Location:</strong></td><td width="150px"><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
			        </tr>
			        <tr>	            
			            <td><strong>Department:</strong></td> <td ><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
			            <td><strong>Section:</strong></td><td  ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
			            <td><strong>Sent By:</strong></td> <td ><? echo $dataArray[0][csf('sent_by')]; ?></td>
						<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
						<td><strong>Mobile No:</strong></td>
						<td><? echo $dataArray[0][csf('mobile_no')]; ?></td>
			        </tr>
			        <tr>
			            <td><strong>Sent To:</strong></td><td ><? echo $send_to_company; ?></td>
			            <td><strong>Attention:</strong></td><td  ><? echo $dataArray[0][csf('attention')]; ?></td>
			            <td><strong>Out Date:</strong></td><td><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
						<td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
						<td><strong>Vehicle No:</strong></td>
						<td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
			        </tr>
			        <tr>		          
			            <td><strong>Out-Time:</strong></td><td><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
			            <td><strong>Returnable :</strong></td><td ><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
			            <td><strong>Delivery As:</strong></td><td ><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
						<td colspan="2"><strong>Security Lock No:</strong></td><td colspan="2"><?echo $dataArray[0][csf('security_lock_no')]; ?></td>
			        </tr>
			    </table>
			    <br>
			    <table align="center" cellspacing="0" width="<? echo $width;?>px;"  border="1" rules="all" class="rpt_table" >
			        <thead bgcolor="#dddddd" align="center">
			            <th width="30">SL</th>
			            <th width="100" align="center">Item Category</th>
			            <? 
			            if($basis==2)
			            {
			            	?>
			            	<th width="70" align="center">Brand</th>
			            	<?
			            }
			            ?>
			            <th width="100" align="center">Sample</th>
			            <th width="200" align="center">Item Description</th>
			            <? 
			            if($basis==2)
			            {
			            	?>
			            	<th width="70" align="center">Lot</th>
			            	<?

			            }
			            ?>
			            <th width="50" align="center">UOM</th>
			            <th width="80" align="center">Quantity</th>
			            <?
			            if($show_item==1)
						{
						?>
			            <th width="50" align="center">Rate</th> 
			            <th width="80" align="center">Amount </th>
			            <?
						}
						if ($dataArray[0][csf('basis')]==33) 
						{
						?>
							<th width="100" align="center">Customer Buyer</th>
						<?
						}
						else
						{
						?>
			            	<th width="100" align="center">Buyer</th>
						<?
						}
						?>
			            <th width="100" align="center">Style</th>
			            <th width="80" align="center">Buyer Order </th>
						<th width="70" align="center">No. of Bags/Roll</th>
						<th width="70" align="center">No. of Carton</th>
			            <th align="center">Remarks</th>
			        </thead>
				<?
			    $i=1;
				$gate_id=$dataArray[0][csf('id')];
				$sql_dtls= " SELECT id,item_category_id,sample_id, item_description,uom_qty, quantity, uom, rate, amount,buyer_order_id,buyer_order, remarks,challan_no,total_carton_qty,no_of_bags from inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 ";
				if($data[4]==8) //subcon challan (grey fabric)
				{
					$sql_result_subcon_grey=sql_select($sql_dtls);
					$buyer_orderIDs="";
					foreach($sql_result_subcon_grey as $row)
					{
						$buyer_orderIDs.=$row[csf('buyer_order')];
					}
					$buyer_orderID=chop($buyer_orderIDs,',');
					
					$sql_subcon_order_buyer=sql_select("select order_no,cust_buyer from subcon_ord_dtls where order_no in('$buyer_orderID') and status_active=1 and is_deleted=0");
					foreach($sql_subcon_order_buyer as $row)
					{
						$subcon_buyer_arr[$row[csf('order_no')]]['cust_buyer']=$row[csf('cust_buyer')];
					}
				}
				
				//echo $sql_dtls;
				$uom_check=array();
				$sql_result=sql_select($sql_dtls);
				$tot_qty=0;$tot_amount=0;
				foreach($sql_result as $row)
				{
					$ref_id=$row[csf("challan_no")];
					if ($i%2==0)  
						$bgcolor="#E9F3FF";
					else
						$bgcolor="#FFFFFF";
						
						$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
						$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
						//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
						$uom_check[$row[csf('uom')]]=$row[csf('uom')];
						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
			                <td><? echo $i; ?></td>
			                <td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
			                <? 
			                if($basis==2)
			                {
			                	?>
			                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["brand"]; ?></td>
			                	<?
			                }
			                ?>
			                <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
			                <td><?  echo $row[csf('item_description')]; ?></td>
			                <? 
			                if($basis==2)
			                {
			                	?>
			                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["lot"]; ?></td>
			                	<?
			                }
			                ?>
			                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
			                <td align="right"><? echo $row[csf('quantity')]; ?></td>
							<?
							if($show_item==1)
							{
								?>
									<td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
									<td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
								<?
							}
							?>
			                <td align="center"><? 
							if($data[4]==8)
							{
								echo $subcon_buyer_arr[$row[csf('buyer_order')]]['cust_buyer'];
							}
							else
							{
								echo $buyer_library[$buyer]; 
							}
							?></td>
			                <td><? echo $style_ref_no; ?></td>
			                <td><? echo $row[csf('buyer_order')]; ?></td>
							<td width="70" align="center"><?=$row[csf('no_of_bags')];?></td>
							<td width="70" align="center"><?=$row[csf('total_carton_qty')];?></td>
			                <td><? echo $row[csf('remarks')]; ?></td>
						</tr>
					<?php
			    	$i++;
					
					$tot_qty+=$row[csf('quantity')];
					$tot_amount+=$row[csf('amount')];
			    }
				//$tot_check=array();
				if($basis==2)$colspan+=2;
				if(count($uom_check)==1)
				{

				?>
			    <tfoot bgcolor="#CCCCCC">
			        <tr>
			        <td colspan="<? echo $colspan;?>" align="right"> <b> Total</b></td>
			        <td align="right"><b><? echo number_format($tot_qty,2);?></b> </td>
			        <?
					if($show_item==1)
					{
					?>
			        <td> </td>
			        <td align="right"><b> <? echo number_format($tot_amount,2);?></b> </td>
			        <?
						}
					?>
			        <td colspan="<? echo 6+$colspan2;?>"></td>
			        </tr>
				</tfoot>
			    <?
				}
				$width_sign=$width.'px';
				?>
			    </table>
			</div>
			<?	

	$signature_arr=return_library_array( "SELECT MASTER_TBLE_ID,IMAGE_LOCATION from COMMON_PHOTO_LIBRARY where FORM_NAME='user_signature' ",'MASTER_TBLE_ID','IMAGE_LOCATION');

	$appSql = "select a.APPROVED_BY, a.APPROVED_DATE,b.USER_FULL_NAME,c.CUSTOM_DESIGNATION from approval_mst a,USER_PASSWD b,LIB_DESIGNATION c where a.mst_id =$gate_id and a.APPROVED_BY=b.id and b.DESIGNATION=c.id and c.STATUS_ACTIVE=1 and c.IS_DELETED=0 and b.STATUS_ACTIVE=1 and b.IS_DELETED=0
	union all
	select b.id as APPROVED_BY, a.INSERT_DATE as APPROVED_DATE,b.USER_FULL_NAME,c.CUSTOM_DESIGNATION from inv_gate_pass_mst a,USER_PASSWD b,LIB_DESIGNATION c where a.id =$gate_id and a.INSERTED_BY=b.id and b.DESIGNATION=c.id and c.STATUS_ACTIVE=1 and c.IS_DELETED=0 and b.STATUS_ACTIVE=1 and b.IS_DELETED=0";
	//echo $appSql;die;
	$appSqlRes=sql_select($appSql);
	$userDtlsArr=array();
	foreach($appSqlRes as $row){
		$userDtlsArr[$row['APPROVED_BY']]=base_url($signature_arr[$row['APPROVED_BY']]);
	}
	// echo "<pre>";
	// print_r($userDtlsArr); 
	//  echo "</pre>";die();
	
	//echo signature_table(25, $company_id, "1200px",$cbo_template_id,50,$inserted_by,$userSignatureArr);
	echo signature_table(114, $data[0],"1200px",$template_id, 50,$inserted_by,$userDtlsArr); 
	?>
	//.........................			
		</div>			    
			<script type="text/javascript" src="../../js/jquery.js"></script>
			<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
			<script>
				function generateBarcode( valuess ){					   
						var value = valuess;
						var btype = 'code39';
						var renderer ='bmp';						 
						var settings = {
						  output:renderer,
						  bgColor: '#FFFFFF',
						  color: '#000000',
						  barWidth: 1,
						  barHeight: 20,
						  moduleSize:5,
						  posX: 10,
						  posY: 20,
						  addQuietZone: 1
						};
						$("#barcode_img_id_<? echo $cid; ?>").html('11');
						 value = {code:value, rect: false};						
						$("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
					} 
				 generateBarcode('<? echo $data[1]; ?>');
			</script>
		<?
	}
	?>	
	<script type="text/javascript">
		var staticHeight = 0;
		var pageHeight = 880;
		$('.print6_data').each(function() {
		    staticHeight += $(this).filter(':visible').outerHeight(true);
		    console.log(staticHeight)
		    if (staticHeight > pageHeight) {
		        // $(this).after( '<p style="page-break-after:always;"></p>');		        
		        staticHeight = 0;
		    }
		    else{
		    	$(this).after( '<hr style="border-top: dotted 2px #000">');
		    	$(this).css({
					"height": "auto",
					"margin-bottom": "2px"
					});
		    	//$(this).css('height', "680px");
		    	$('.print6_data').addClass("devider");
		    }

		});
	</script>
	<style type="text/css">		
		.devider:nth-of-type(2){
			margin-top: 40px;
		}
	</style>
	<?
	exit();
}


if ($action=="get_out_entry_print16") // Print 16
{
	extract($_REQUEST);
	$data=explode('*',$data);
	// echo "<pre>";
	// print_r($data);	
	$show_item=$data[4];
	$cbo_returnable = $data[6];
	$company=$data[0];
	$location=$data[2];
	
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$brand_arr=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name");
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");
	$designation_a=return_library_array("select id,custom_designation from lib_designation","id","custom_designation");

	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );	
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
	$sql="SELECT id, sys_number,approved,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,vhicle_number,com_location_id,mobile_no, security_lock_no,inserted_by from inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 ";
	//echo $sql;die();
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	$inserted_by=$dataArray[0][csf('inserted_by')];
	$is_approved=$dataArray[0][csf('approved')];
	if($is_approved==1){ $approved_status="Full Approved";}
    else if($is_approved==0){ $approved_status="Un Approved";}
    else{ $approved_status="Partial Approved";}
	$bags_cone_arr=array();
	$prod_id=array();
	$brand_lot_arr=array();
	if($basis==2)
	{
		$sqls="SELECT a.id,a.prod_id,a.no_of_bags,a.cone_per_bag from inv_transaction a,inv_gate_pass_mst b,inv_gate_pass_dtls c where a.id=c.challan_no and b.id=c.mst_id  and b.sys_number='$data[1]' group by a.id,a.prod_id,a.no_of_bags,a.cone_per_bag ";
		foreach(sql_select($sqls) as $val)
		{
			$bags_cone_arr[$val[csf("id")]]["bags"]=$val[csf("no_of_bags")];
			$bags_cone_arr[$val[csf("id")]]["cone"]=$val[csf("cone_per_bag")];
			$bags_cone_arr[$val[csf("id")]]["prod_id"]=$val[csf("prod_id")];
			$prod_id[$val[csf("prod_id")]]=$val[csf("prod_id")];
		}
		$prod_ids=0;
		if(count($prod_id)>0)
		{
			$prod_ids=implode(",", $prod_id);
		}

		$sql2="SELECT  id,brand,lot  from product_details_master where  id in($prod_ids) ";
		foreach(sql_select($sql2) as $val)
		{
			$brand_lot_arr[$val[csf("id")]]["brand"]=$brand_arr[$val[csf("brand")]];
			$brand_lot_arr[$val[csf("id")]]["lot"]=$val[csf("lot")];
			 
		}

	}	
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}	

	$copy_no=array(1,2,3); 

	foreach($copy_no as $cid)
	{
		if($show_item==1){
			//$width=1150;
			$width=1250;
			$colspan=5;		
		}
		else{
			$width=1150;
			$colspan=5;
			$colspan2=2;
		}
		$address = "";
		$add_info = "";
		$nameArray=sql_select("select plot_no, level_no, road_no, block_no, country_id, province, city, zip_code, email, website from lib_company where id=$data[0]");
		if($nameArray[0][csf('plot_no')] != ''){
			$address.="Plot# ".$nameArray[0][csf('plot_no')].',';
		}
		if($nameArray[0][csf('level_no')] != ''){
			$address.="Level# ".$nameArray[0][csf('level_no')].',';
		}
		if($nameArray[0][csf('road_no')] != ''){
			$address.="Road# ".$nameArray[0][csf('road_no')].',';
		}
		if($nameArray[0][csf('block_no')] != ''){
			$address.="Block# ".$nameArray[0][csf('block_no')].'<br>';
		}
		if($nameArray[0][csf('city')] != ''){
			$address.=$nameArray[0][csf('city')].',';
		}
		if($nameArray[0][csf('zip_code')] != 0 && $nameArray[0][csf('zip_code')] != ''){
			$address.='-'.$nameArray[0][csf('zip_code')].',';
		}
		if($nameArray[0][csf('province')] != ''){
			$address.=$nameArray[0][csf('province')].','.$country_arr[$nameArray[0][csf('country_id')]];
		}
		if($nameArray[0][csf('email')] != 0){
			$add_info.='Email: '.$nameArray[0][csf('email')].', ';
		}
		if($nameArray[0][csf('website')] != 0){
			$add_info.='Website: '.$nameArray[0][csf('website')].',';
		}
		$com_dtls = fnc_company_location_address($company, $location, 2);
		?>
		<div data-print=section class="print6_data">
			<div style="width:<? echo $width;?>px;" align="center">
			    <table style="table-layout: fixed; " width="<? echo $width;?>">
					<tr>
						<td rowspan="5" width="300"><img src="<?=base_url($com_dtls[2]); ?>" height="50" width="160"></td>
					</tr>
					<tr style="font-size:xx-large;">
						<td width="500" style="text-align: center;"><strong><? echo $com_dtls[0]; ?></strong></td>
						<td width="200" style="text-align: right; padding-right: 7px">
						<span style="font-size:x-large; font-weight: bold;">
						<? echo $cid;?><sup><?php if($cid==1) { echo 'st';} elseif($cid==2) { echo  'nd';} else{ echo 'rd';} ?></sup> Copy</span><br/>
						<span>
							<?
								if($cbo_returnable == 1){
									echo "Returnable";
								}
							?>
						</span>
						</td>
					</tr>
					<tr>				
						<td style="text-align: center;"><?php echo $location_library[$dataArray[0][csf('com_location_id')]]; //echo $com_dtls[1]; ?>
						</td>
						<td style="text-align: right; "><span  id="barcode_img_id_<? echo $cid; ?>" ></span></td>
					</tr>
					<tr>			
						<td style="text-align: center;"><?php echo $add_info ?></td>
					</tr>
					<tr>
						<td style="text-align: center; font-size:x-large; text-decoration: underline; font-weight: bold;">Gate Pass</td>
						<td width="180" align="center" rowspan="5" style="font-size:18px;color:red;"><?=$approved_status;?> </td>
					</tr>
				</table>
				<br>
			    <table border="1" cellpadding="1" cellspacing="1" style="width:<?= $width;?>px" rules="all">
			        <tr>
			            <td><strong>System ID:</strong></td> <td width="150px"><? echo $dataArray[0][csf('sys_number')]; ?></td>
			            <td><strong>Basis:</strong></td><td width="150px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
			            <td><strong>Challan/System No:</strong></td><td width="150px"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
						<td><strong>Est. Return Date 	 :</strong></td><td width="120px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
						<td><strong>To Location:</strong></td><td width="150px"><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
			        </tr>
			        <tr>	            
			            <td><strong>Department:</strong></td> <td ><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
			            <td><strong>Section:</strong></td><td  ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
			            <td><strong>Sent By:</strong></td> <td ><? echo $dataArray[0][csf('sent_by')]; ?></td>
						<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
						<td><strong>Mobile No:</strong></td>
						<td><? echo $dataArray[0][csf('mobile_no')]; ?></td>
			        </tr>
			        <tr>
			            <td><strong>Sent To:</strong></td><td ><? echo $send_to_company; ?></td>
			            <td><strong>Attention:</strong></td><td  ><? echo $dataArray[0][csf('attention')]; ?></td>
			            <td><strong>Out Date:</strong></td><td><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
						<td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
						<td><strong>Vehicle No:</strong></td>
						<td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
			        </tr>
			        <tr>		          
			            <td><strong>Out-Time:</strong></td><td><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
			            <td><strong>Returnable :</strong></td><td ><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
			            <td><strong>Delivery As:</strong></td><td ><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
						<td colspan="2"><strong>Security Lock No:</strong></td><td colspan="2"><?echo $dataArray[0][csf('security_lock_no')]; ?></td>
			        </tr>
			    </table>
			    <br>
			    <table align="center" cellspacing="0" width="<? echo $width;?>px;"  border="1" rules="all" class="rpt_table" >
			        <thead bgcolor="#dddddd" align="center">
			            <th width="30">SL</th>
			            <th width="100" align="center">Item Category</th>
			            <? 
			            if($basis==2)
			            {
			            	?>
			            	<th width="70" align="center">Brand</th>
			            	<?
			            }
			            ?>
			            <th width="100" align="center">Sample</th>
			            <th width="200" align="center">Item Description</th>
			            <? 
			            if($basis==2)
			            {
			            	?>
			            	<th width="70" align="center">Lot</th>
			            	<?

			            }
			            ?>
			            <th width="50" align="center">UOM</th>
			            <th width="80" align="center">Quantity</th>
			            <?
			            if($show_item==1)
						{
						?>
			            <th width="50" align="center">Rate</th> 
			            <th width="80" align="center">Amount </th>
			            <?
						}
						if ($dataArray[0][csf('basis')]==33) 
						{
						?>
							<th width="100" align="center">Customer Buyer</th>
						<?
						}
						else
						{
						?>
			            	<th width="100" align="center">Buyer</th>
						<?
						}
						?>
			            <th width="100" align="center">Style</th>
			            <th width="80" align="center">Buyer Order </th>
						<th width="70" align="center">No. of Bags/Roll</th>
						<th width="70" align="center">No. of Carton</th>
			            <th align="center">Remarks</th>
			        </thead>
				<?
			    $i=1;
				$gate_id=$dataArray[0][csf('id')];
				$sql_dtls= " SELECT id,item_category_id,sample_id, item_description,uom_qty, quantity, uom, rate, amount,buyer_order_id,buyer_order, remarks,challan_no,total_carton_qty,no_of_bags from inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 ";
				if($data[4]==8) //subcon challan (grey fabric)
				{
					$sql_result_subcon_grey=sql_select($sql_dtls);
					$buyer_orderIDs="";
					foreach($sql_result_subcon_grey as $row)
					{
						$buyer_orderIDs.=$row[csf('buyer_order')];
					}
					$buyer_orderID=chop($buyer_orderIDs,',');
					
					$sql_subcon_order_buyer=sql_select("select order_no,cust_buyer from subcon_ord_dtls where order_no in('$buyer_orderID') and status_active=1 and is_deleted=0");
					foreach($sql_subcon_order_buyer as $row)
					{
						$subcon_buyer_arr[$row[csf('order_no')]]['cust_buyer']=$row[csf('cust_buyer')];
					}
				}
				
				//echo $sql_dtls;
				$uom_check=array();
				$sql_result=sql_select($sql_dtls);
				$tot_qty=0;$tot_amount=0;
				foreach($sql_result as $row)
				{
					$ref_id=$row[csf("challan_no")];
					if ($i%2==0)  
						$bgcolor="#E9F3FF";
					else
						$bgcolor="#FFFFFF";
						
						$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
						$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
						//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
						$uom_check[$row[csf('uom')]]=$row[csf('uom')];
						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
			                <td><? echo $i; ?></td>
			                <td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
			                <? 
			                if($basis==2)
			                {
			                	?>
			                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["brand"]; ?></td>
			                	<?
			                }
			                ?>
			                <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
			                <td><?  echo $row[csf('item_description')]; ?></td>
			                <? 
			                if($basis==2)
			                {
			                	?>
			                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["lot"]; ?></td>
			                	<?
			                }
			                ?>
			                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
			                <td align="right"><? echo $row[csf('quantity')]; ?></td>
							<?
							if($show_item==1)
							{
								?>
									<td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
									<td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
								<?
							}
							?>
			                <td align="center"><? 
							if($data[4]==8)
							{
								echo $subcon_buyer_arr[$row[csf('buyer_order')]]['cust_buyer'];
							}
							else
							{
								echo $buyer_library[$buyer]; 
							}
							?></td>
			                <td><? echo $style_ref_no; ?></td>
			                <td><? echo $row[csf('buyer_order')]; ?></td>
							<td width="70" align="center"><?=$row[csf('no_of_bags')];?></td>
							<td width="70" align="center"><?=$row[csf('total_carton_qty')];?></td>
			                <td><? echo $row[csf('remarks')]; ?></td>
						</tr>
					<?php
			    	$i++;
					
					$tot_qty+=$row[csf('quantity')];
					$tot_amount+=$row[csf('amount')];
			    }
				//$tot_check=array();
				if($basis==2)$colspan+=2;
				if(count($uom_check)==1)
				{

				?>
			    <tfoot bgcolor="#CCCCCC">
			        <tr>
			        <td colspan="<? echo $colspan;?>" align="right"> <b> Total</b></td>
			        <td align="right"><b><? echo number_format($tot_qty,2);?></b> </td>
			        <?
					if($show_item==1)
					{
					?>
			        <td> </td>
			        <td align="right"><b> <? echo number_format($tot_amount,2);?></b> </td>
			        <?
						}
					?>
			        <td colspan="<? echo 6+$colspan2;?>"></td>
			        </tr>
				</tfoot>
			    <?
				}
				$width_sign=$width.'px';
				?>
			    </table>
			</div>
  <?php

   $hisSql =  "select MST_ID,APPROVED_BY,APPROVED_DATE, SEQUENCE_NO from APPROVAL_MST where ENTRY_FORM=59 and MST_ID=$gate_id order by sequence_no";
		//echo $hisSql;die();
		$hisSqlRes=sql_select($hisSql);

		foreach($hisSqlRes as $Row)
		{
			$Row['APPROVED_DATE']=strtotime($Row['APPROVED_DATE']);
			
			$sys_id_arr[$Row['APPROVED_BY']]=array(
			'APPROVED_BY'=>$Row['APPROVED_BY'],
			'SEQUENCE_NO'=>$Row['SEQUENCE_NO'],
			'APPROVED_DATE'=>date('d-m-Y h:i:s A',$Row['APPROVED_DATE']),
		);
		$userIdArr[$Row['APPROVED_BY']]=$Row['APPROVED_BY'];
		}
		// 	echo 11;die;
		// 	echo "<pre>";
		// print_r($sys_id_arr); 
		//   echo "</pre>";die();

		$sql="select a.USER_ID,a.DEPARTMENT,b.DESIGNATION,b.USER_FULL_NAME from electronic_approval_setup a,user_passwd b where b.id=a.USER_ID ".where_con_using_array($userIdArr,0,'a.USER_ID')."";
		//echo $sql;die();
		$sql_res=sql_select($sql);

		foreach($sql_res as $roww){
			$userName[$roww['USER_ID']]=$roww['USER_FULL_NAME'];
			$userDeg[$roww['USER_ID']]=$roww['DESIGNATION'];
			if($department_arr[$roww['DEPARTMENT']]!=''){$userDep[$roww['USER_ID']][$roww['DEPARTMENT']]=$department_arr[$roww['DEPARTMENT']];}
		}

		// echo "<pre>";
		// 	print_r($userName); 
		// 	  echo "</pre>";die();

		$hisSql ="select MST_ID,REFUSING_REASON from REFUSING_CAUSE_HISTORY where ENTRY_FORM=59 and MST_ID==$gate_id";
		//echo $hisSql;die();
			$hisSqlRes=sql_select($hisSql);
			$refusing_res_arr = array();
			foreach($hisSqlRes as $key => $prerow){
				$refusing_res_arr[$key+2] = $prerow['REFUSING_REASON'];

			}
		// echo "<pre>";
		// print_r($refusing_res_arr); 
		//   echo "</pre>";die();


		?>
			<table border="1" rules="all">
		<thead><strong>Approval Authority</strong></thead>
		<thead>   
			
			<th>Name</th>
			<th>Designation</th>
			<th>Reason For Unapproval</th>
			<th>Approve Status</th>
			<th>Time/Date</th>
			
		</thead>
		<tbody>
		<?
			 foreach ($sys_id_arr as $row) 
			 {  
			?>
			
			<tr>   
            
				<td><?=$userName[$row['APPROVED_BY']];?></td>
				<td><?=$designation_a[$userDeg[$row['APPROVED_BY']]];?></td>
				<td><?=$refusing_res_arr[$row['SEQUENCE_NO']];?></td>
				<td><? echo "Yes";?></td>
				<td><?=$row[APPROVED_DATE]; ?></td>
				
				
			</tr>
            <?
			
			}
			?>
		</tbody>

	 </table> 
    <? 
	$signature_arr=return_library_array( "SELECT MASTER_TBLE_ID,IMAGE_LOCATION from COMMON_PHOTO_LIBRARY where FORM_NAME='user_signature' ",'MASTER_TBLE_ID','IMAGE_LOCATION');
	$appSql = "select a.APPROVED_BY, a.APPROVED_DATE,b.USER_FULL_NAME,c.CUSTOM_DESIGNATION from approval_mst a,USER_PASSWD b,LIB_DESIGNATION c where a.mst_id =$gate_id and a.APPROVED_BY=b.id and b.DESIGNATION=c.id and c.STATUS_ACTIVE=1 and c.IS_DELETED=0 and b.STATUS_ACTIVE=1 and b.IS_DELETED=0
	union all
	select b.id as APPROVED_BY, a.INSERT_DATE as APPROVED_DATE,b.USER_FULL_NAME,c.CUSTOM_DESIGNATION from inv_gate_pass_mst a,USER_PASSWD b,LIB_DESIGNATION c where a.id =$gate_id and a.INSERTED_BY=b.id and b.DESIGNATION=c.id and c.STATUS_ACTIVE=1 and c.IS_DELETED=0 and b.STATUS_ACTIVE=1 and b.IS_DELETED=0";
	    //echo $appSql;die;
	$appSqlRes=sql_select($appSql);
	$userDtlsArr=array();
	foreach($appSqlRes as $row){
		$userDtlsArr[$row['APPROVED_BY']]=base_url($signature_arr[$row['APPROVED_BY']]);
	}
	// echo "<pre>";
	// print_r($userDtlsArr); 
	//  echo "</pre>";die();
	
	//echo signature_table(25, $company_id, "1200px",$cbo_template_id,50,$inserted_by,$userSignatureArr);
	      echo signature_table(114, $data[0], $width_sign,$template_id, 40,$inserted_by,$userDtlsArr);  ?>			
		</div>			    
			<script type="text/javascript" src="../../js/jquery.js"></script>
			<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
			<script>
				function generateBarcode( valuess ){					   
						var value = valuess;
						var btype = 'code39';
						var renderer ='css';						 
						var settings = {
						  output:renderer,
						  bgColor: '#FFFFFF',
						  color: '#000000',
						  barWidth: 1,
						  barHeight: 40,
						  moduleSize:5,
						  posX: 10,
						  posY: 20,
						  addQuietZone: 1,
						  showHRI: false
						};
						$("#barcode_img_id_<? echo $cid; ?>").html('11');
						 value = {code:value, rect: false};						
						$("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
					} 
				 generateBarcode('<? echo $data[1]; ?>');
			</script>
		<?
	}
	?>	
	<script type="text/javascript">
		var staticHeight = 0;
		var pageHeight = 880;
		$('.print6_data').each(function() {
		    staticHeight += $(this).filter(':visible').outerHeight(true);
		    console.log(staticHeight)
		    if (staticHeight > pageHeight) {
		        // $(this).after( '<p style="page-break-after:always;"></p>');		        
		        staticHeight = 0;
		    }
		    else{
		    	$(this).after( '<hr style="border-top: dotted 2px #000;float:left;width:<?= $width;?>">');
		    	$(this).css({
					"height": "auto",
					"margin-bottom": "2px"
					});
		    	//$(this).css('height', "680px");
		    	$('.print6_data').addClass("devider");
		    }

		});
	</script>
	<style type="text/css">		
		.devider:nth-of-type(2){
			margin-top: 40px;
		}
	</style>
	<?
	exit();
}


if ($action=="get_out_entry_print17") // Print 17
{
	extract($_REQUEST);
	$data=explode('*',$data);
	// echo "<pre>";
	// print_r($data);	
	$show_item=$data[4];
	$cbo_returnable = $data[6];
	$company=$data[0];
	$location=$data[2];
	
	//$basis_arr=array(1=>"Short",2=>"Additional",3=>"Sample",4=>"Bulk");
	$company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
	$brand_arr=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name"  );
	$department_library=return_library_array( "select id,department_name from  lib_department", "id","department_name");
	$country_arr=return_library_array( "select id, country_name from lib_country", "id", "country_name"  );
	$buyer_library=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	$location_library=return_library_array( "select id, location_name from lib_location", "id", "location_name");
	$supplier_name_library=return_library_array( "select id, supplier_name from  lib_supplier", "id", "supplier_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");
	$designation_a=return_library_array("select id,custom_designation from lib_designation","id","custom_designation");

	$section_library=return_library_array( "select id, section_name from  lib_section", "id", "section_name"  );	
	$sample_library_arr=return_library_array( "select id,sample_name   from   lib_sample ", "id", "sample_name"  );
	$sql="SELECT id, sys_number,approved,company_id,basis,department_id,issue_purpose,within_group,section,attention, sent_by,carried_by, sent_to, out_date, challan_no, time_hour, time_minute,returnable,delivery_as,est_return_date,location_id,location_name,vhicle_number,com_location_id,mobile_no, security_lock_no,inserted_by from inv_gate_pass_mst where company_id='$data[0]' and sys_number='$data[1]' and status_active=1 and is_deleted=0 ";
	//echo $sql;die();
	$dataArray=sql_select($sql);
	$basis=$dataArray[0][csf('basis')];
	$within_group=$dataArray[0][csf('within_group')];
	$challan_no=$dataArray[0][csf('challan_no')];
	$sent_to=$dataArray[0][csf('sent_to')];
	$inserted_by=$dataArray[0][csf('inserted_by')];
	$is_approved=$dataArray[0][csf('approved')];
	if($is_approved==1){ $approved_status="Full Approved";}
    else if($is_approved==0){ $approved_status="Un Approved";}
    else{ $approved_status="Partial Approved";}
	$bags_cone_arr=array();
	$prod_id=array();
	$brand_lot_arr=array();
	if($basis==2)
	{
		$sqls="SELECT a.id,a.prod_id,a.no_of_bags,a.cone_per_bag from inv_transaction a,inv_gate_pass_mst b,inv_gate_pass_dtls c where a.id=c.challan_no and b.id=c.mst_id  and b.sys_number='$data[1]' group by a.id,a.prod_id,a.no_of_bags,a.cone_per_bag ";
		foreach(sql_select($sqls) as $val)
		{
			$bags_cone_arr[$val[csf("id")]]["bags"]=$val[csf("no_of_bags")];
			$bags_cone_arr[$val[csf("id")]]["cone"]=$val[csf("cone_per_bag")];
			$bags_cone_arr[$val[csf("id")]]["prod_id"]=$val[csf("prod_id")];
			$prod_id[$val[csf("prod_id")]]=$val[csf("prod_id")];
		}
		$prod_ids=0;
		if(count($prod_id)>0)
		{
			$prod_ids=implode(",", $prod_id);
		}

		$sql2="SELECT  id,brand,lot  from product_details_master where  id in($prod_ids) ";
		foreach(sql_select($sql2) as $val)
		{
			$brand_lot_arr[$val[csf("id")]]["brand"]=$brand_arr[$val[csf("brand")]];
			$brand_lot_arr[$val[csf("id")]]["lot"]=$val[csf("lot")];
			 
		}

	}	
	if($within_group==2)
	{
		$send_to_company=$dataArray[0][csf('sent_to')];
	}
	else
	{
		$send_to_company=$company_library[$dataArray[0][csf('sent_to')]];
	}
	$order_array=array();
	$order_sql="select a.style_ref_no, a.job_no,a.buyer_name, b.id, b.po_number, b.po_quantity from  wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	$order_sql_result=sql_select($order_sql);
	foreach ($order_sql_result as $row)
	{
		$order_array[$row[csf('id')]]['buyer_name']=$row[csf('buyer_name')];
		$order_array[$row[csf('id')]]['style_ref_no']=$row[csf('style_ref_no')];
	}	

	$copy_no=array(1,2,3); 

	foreach($copy_no as $cid)
	{
		if($show_item==1){
			//$width=1150;
			$width=1350;
			$colspan=5;		
		}
		else{
			$width=1250;
			$colspan=5;
			$colspan2=2;
		}
		$address = "";
		$add_info = "";
		$nameArray=sql_select("select plot_no, level_no, road_no, block_no, country_id, province, city, zip_code, email, website from lib_company where id=$data[0]");
		if($nameArray[0][csf('plot_no')] != ''){
			$address.="Plot# ".$nameArray[0][csf('plot_no')].',';
		}
		if($nameArray[0][csf('level_no')] != ''){
			$address.="Level# ".$nameArray[0][csf('level_no')].',';
		}
		if($nameArray[0][csf('road_no')] != ''){
			$address.="Road# ".$nameArray[0][csf('road_no')].',';
		}
		if($nameArray[0][csf('block_no')] != ''){
			$address.="Block# ".$nameArray[0][csf('block_no')].'<br>';
		}
		if($nameArray[0][csf('city')] != ''){
			$address.=$nameArray[0][csf('city')].',';
		}
		if($nameArray[0][csf('zip_code')] != 0 && $nameArray[0][csf('zip_code')] != ''){
			$address.='-'.$nameArray[0][csf('zip_code')].',';
		}
		if($nameArray[0][csf('province')] != ''){
			$address.=$nameArray[0][csf('province')].','.$country_arr[$nameArray[0][csf('country_id')]];
		}
		if($nameArray[0][csf('email')] != 0){
			$add_info.='Email: '.$nameArray[0][csf('email')].', ';
		}
		if($nameArray[0][csf('website')] != 0){
			$add_info.='Website: '.$nameArray[0][csf('website')].',';
		}
		$com_dtls = fnc_company_location_address($company, $location, 2);
		?>
		<div data-print=section class="print6_data">
			<div style="width:<? echo $width;?>px;" align="center">
			    <table style="table-layout: fixed; " width="<? echo $width;?>">
					<tr>
						<td rowspan="5" width="300"><img src="<?=base_url($com_dtls[2]); ?>" height="50" width="160"></td>
					</tr>
					<tr style="font-size:xx-large;">
						<td width="500" style="text-align: center;"><strong><? echo $com_dtls[0]; ?></strong></td>
						<td width="200" style="text-align: right; padding-right: 7px">
						<span style="font-size:x-large; font-weight: bold;">
						<? echo $cid;?><sup><?php if($cid==1) { echo 'st';} elseif($cid==2) { echo  'nd';} else{ echo 'rd';} ?></sup> Copy</span><br/>
						<span>
							<?
								if($cbo_returnable == 1){
									echo "Returnable";
								}
							?>
						</span>
						</td>
					</tr>
					<tr>				
						<td style="text-align: center;"><?php echo $location_library[$dataArray[0][csf('com_location_id')]]; //echo $com_dtls[1]; ?>
						</td>
						<td style="text-align: right; "><span  id="barcode_img_id_<? echo $cid; ?>" ></span></td>
					</tr>
					<tr>			
						<td style="text-align: center;"><?php echo $add_info ?></td>
					</tr>
					<tr>
						<td style="text-align: center; font-size:x-large; text-decoration: underline; font-weight: bold;">Gate Pass</td>
						<td width="180" align="center" rowspan="5" style="font-size:18px;color:red;"><?=$approved_status;?> </td>
					</tr>
				</table>
				<br>
			    <table border="1" cellpadding="1" cellspacing="1" style="width:<?= $width;?>px" rules="all">
			        <tr>
			            <td><strong>System ID:</strong></td> <td width="150px"><? echo $dataArray[0][csf('sys_number')]; ?></td>
			            <td><strong>Basis:</strong></td><td width="150px" ><? echo $get_pass_basis[$dataArray[0][csf('basis')]]; ?></td>
			            <td><strong>Challan/System No:</strong></td><td width="150px"><? echo $challan_no;//$item_category[$dataArray[0][csf('challan_no')]]; ?></td>
						<td><strong>Est. Return Date 	 :</strong></td><td width="120px"><? echo change_date_format($dataArray[0][csf('est_return_date')]); ?></td>
						<td><strong>To Location:</strong></td><td width="150px"><? if($within_group==1) echo $location_library[$dataArray[0][csf('location_id')]];else echo $dataArray[0][csf('location_name')]; ?></td>
			        </tr>
			        <tr>	            
			            <td><strong>Department:</strong></td> <td ><? echo $department_library[$dataArray[0][csf('department_id')]]; ?></td>
			            <td><strong>Section:</strong></td><td  ><? echo $section_library[$dataArray[0][csf('section')]]; ?></td>
			            <td><strong>Sent By:</strong></td> <td ><? echo $dataArray[0][csf('sent_by')]; ?></td>
						<td><strong>Carried By:</strong></td><td><? echo $dataArray[0][csf('carried_by')]; ?></td>
						<td><strong>Mobile No:</strong></td>
						<td><? echo $dataArray[0][csf('mobile_no')]; ?></td>
			        </tr>
			        <tr>
			            <td><strong>Sent To:</strong></td><td ><? echo $send_to_company; ?></td>
			            <td><strong>Attention:</strong></td><td  ><? echo $dataArray[0][csf('attention')]; ?></td>
			            <td><strong>Out Date:</strong></td><td><? echo change_date_format($dataArray[0][csf('out_date')]); ?></td>
						<td><strong>Purpose:</strong></td><td><? echo $dataArray[0][csf('issue_purpose')]; ?></td> 
						<td><strong>Vehicle No:</strong></td>
						<td><? echo $dataArray[0][csf('vhicle_number')]; ?></td>
			        </tr>
			        <tr>		          
			            <td><strong>Out-Time:</strong></td><td><? echo $dataArray[0][csf('time_hour')]." HH".$dataArray[0][csf('time_minute')]." Min"; ?></td>
			            <td><strong>Returnable :</strong></td><td ><? echo $yes_no[$dataArray[0][csf('returnable')]]; ?></td>
			            <td><strong>Delivery As:</strong></td><td ><? echo $basis_arr[$dataArray[0][csf('delivery_as')]]; ?></td>
						<td colspan="2"><strong>Security Lock No:</strong></td><td colspan="2"><?echo $dataArray[0][csf('security_lock_no')]; ?></td>
			        </tr>
			    </table>
			    <br>
			    <table align="center" cellspacing="0" width="<? echo $width;?>px;"  border="1" rules="all" class="rpt_table" >
			        <thead bgcolor="#dddddd" align="center">
			            <th width="30">SL</th>
			            <th width="100" align="center">Item Category</th>
			            <? 
			            if($basis==2)
			            {
			            	?>
			            	<th width="70" align="center">Brand</th>
			            	<?
			            }
			            ?>
			            <th width="100" align="center">Sample</th>
			            <th width="200" align="center">Item Description</th>
			            <? 
			            if($basis==2)
			            {
			            	?>
			            	<th width="70" align="center">Lot</th>
			            	<?

			            }
			            ?>
			            <th width="50" align="center">UOM</th>
			            <th width="80" align="center">Quantity</th>
			            <?
			            if($show_item==1)
						{
						?>
			            <th width="50" align="center">Rate</th> 
			            <th width="80" align="center">Amount </th>
			            <?
						}
						if ($dataArray[0][csf('basis')]==33) 
						{
						?>
							<th width="100" align="center">Customer Buyer</th>
						<?
						}
						else
						{
						?>
			            	<th width="100" align="center">Buyer</th>
						<?
						}
						?>
			            <th width="100" align="center">Style</th>
			            <th width="80" align="center">Buyer Order </th>
						<th width="70" align="center">No. of Bags/Roll</th>
						<th width="70" align="center">No. of Carton</th>
			            <th align="center">Remarks</th>
			        </thead>
				<?
			    $i=1;
				$gate_id=$dataArray[0][csf('id')];
				$sql_dtls= " SELECT id,item_category_id,sample_id, item_description,uom_qty, quantity, uom, rate, amount,buyer_order_id,buyer_order, remarks,challan_no,total_carton_qty,no_of_bags from inv_gate_pass_dtls where mst_id=$gate_id and status_active=1 and is_deleted=0 ";
				if($data[4]==8) //subcon challan (grey fabric)
				{
					$sql_result_subcon_grey=sql_select($sql_dtls);
					$buyer_orderIDs="";
					foreach($sql_result_subcon_grey as $row)
					{
						$buyer_orderIDs.=$row[csf('buyer_order')];
					}
					$buyer_orderID=chop($buyer_orderIDs,',');
					
					$sql_subcon_order_buyer=sql_select("select order_no,cust_buyer from subcon_ord_dtls where order_no in('$buyer_orderID') and status_active=1 and is_deleted=0");
					foreach($sql_subcon_order_buyer as $row)
					{
						$subcon_buyer_arr[$row[csf('order_no')]]['cust_buyer']=$row[csf('cust_buyer')];
					}
				}
				
				//echo $sql_dtls;
				$uom_check=array();
				$sql_result=sql_select($sql_dtls);
				$tot_qty=0;$tot_amount=0;
				foreach($sql_result as $row)
				{
					$ref_id=$row[csf("challan_no")];
					if ($i%2==0)  
						$bgcolor="#E9F3FF";
					else
						$bgcolor="#FFFFFF";
						
						$buyer=$order_array[$row[csf('buyer_order_id')]]['buyer_name'];
						$style_ref_no=$order_array[$row[csf('buyer_order_id')]]['style_ref_no'];
						//if($uom_id==0) $uom_id=$row[csf('uom')];else $uom_id.=",".$row[csf('uom')];
						$uom_check[$row[csf('uom')]]=$row[csf('uom')];
						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
			                <td><? echo $i; ?></td>
			                <td><?  echo $item_category[$row[csf('item_category_id')]]; ?></td>
			                <? 
			                if($basis==2)
			                {
			                	?>
			                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["brand"]; ?></td>
			                	<?
			                }
			                ?>
			                <td><?  echo $sample_library_arr[$row[csf('sample_id')]]; ?></td>
			                <td><?  echo $row[csf('item_description')]; ?></td>
			                <? 
			                if($basis==2)
			                {
			                	?>
			                	<td width="70" align="center"><? echo $brand_lot_arr[$bags_cone_arr[$ref_id]["prod_id"]]["lot"]; ?></td>
			                	<?
			                }
			                ?>
			                <td align="center"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
			                <td align="right"><? echo $row[csf('quantity')]; ?></td>
							<?
							if($show_item==1)
							{
								?>
									<td align="right"><? echo number_format($row[csf('rate')],2,'.',''); ?></td>
									<td align="right"><? echo number_format($row[csf('amount')],2,'.',''); ?></td>
								<?
							}
							?>
			                <td align="center"><? 
							if($data[4]==8)
							{
								echo $subcon_buyer_arr[$row[csf('buyer_order')]]['cust_buyer'];
							}
							else
							{
								echo $buyer_library[$buyer]; 
							}
							?></td>
			                <td><? echo $style_ref_no; ?></td>
			                <td><? echo $row[csf('buyer_order')]; ?></td>
							<td width="70" align="center"><?=$row[csf('no_of_bags')];?></td>
							<td width="70" align="center"><?=$row[csf('total_carton_qty')];?></td>
			                <td><? echo $row[csf('remarks')]; ?></td>
						</tr>
					<?php
			    	$i++;
					
					$tot_qty+=$row[csf('quantity')];
					$tot_amount+=$row[csf('amount')];
			    }
				//$tot_check=array();
				if($basis==2)$colspan+=2;
				if(count($uom_check)==1)
				{

				?>
			    <tfoot bgcolor="#CCCCCC">
			        <tr>
			        <td colspan="<? echo $colspan;?>" align="right"> <b> Total</b></td>
			        <td align="right"><b><? echo number_format($tot_qty,2);?></b> </td>
			        <?
					if($show_item==1)
					{
					?>
			        <td> </td>
			        <td align="right"><b> <? echo number_format($tot_amount,2);?></b> </td>
			        <?
						}
					?>
			        <td colspan="<? echo 6+$colspan2;?>"></td>
			        </tr>
				</tfoot>
			    <?
				}
				$width_sign=$width.'px';
				?>
			    </table>
			</div>
  <?php

   $hisSql =  "select MST_ID,APPROVED_BY,APPROVED_DATE, SEQUENCE_NO from APPROVAL_MST where ENTRY_FORM=59 and MST_ID=$gate_id order by sequence_no";
		//echo $hisSql;die();
		$hisSqlRes=sql_select($hisSql);

		foreach($hisSqlRes as $Row)
		{
			$Row['APPROVED_DATE']=strtotime($Row['APPROVED_DATE']);
			
			$sys_id_arr[$Row['APPROVED_BY']]=array(
			'APPROVED_BY'=>$Row['APPROVED_BY'],
			'SEQUENCE_NO'=>$Row['SEQUENCE_NO'],
			'APPROVED_DATE'=>date('d-m-Y h:i:s A',$Row['APPROVED_DATE']),
		);
		$userIdArr[$Row['APPROVED_BY']]=$Row['APPROVED_BY'];
		}
		// 	echo 11;die;
		// 	echo "<pre>";
		// print_r($sys_id_arr); 
		//   echo "</pre>";die();

		$sql="select a.USER_ID,a.DEPARTMENT,b.DESIGNATION,b.USER_FULL_NAME from electronic_approval_setup a,user_passwd b where b.id=a.USER_ID ".where_con_using_array($userIdArr,0,'a.USER_ID')."";
		//echo $sql;die();
		$sql_res=sql_select($sql);

		foreach($sql_res as $roww){
			$userName[$roww['USER_ID']]=$roww['USER_FULL_NAME'];
			$userDeg[$roww['USER_ID']]=$roww['DESIGNATION'];
			if($department_arr[$roww['DEPARTMENT']]!=''){$userDep[$roww['USER_ID']][$roww['DEPARTMENT']]=$department_arr[$roww['DEPARTMENT']];}
		}

		// echo "<pre>";
		// 	print_r($userName); 
		// 	  echo "</pre>";die();

		$hisSql ="select MST_ID,REFUSING_REASON from REFUSING_CAUSE_HISTORY where ENTRY_FORM=59 and MST_ID=$gate_id";
		//echo $hisSql;die();
			$hisSqlRes=sql_select($hisSql);
			$refusing_res_arr = array();
			foreach($hisSqlRes as $key => $prerow){
				$refusing_res_arr[$key+2] = $prerow['REFUSING_REASON'];

			}
		// echo "<pre>";
		// print_r($refusing_res_arr); 
		//   echo "</pre>";die();


		?>
			<table border="1" rules="all">
		        <thead><strong>Approval Authority</strong></thead>
				<thead>   
					<th>Name</th>
					<th>Designation</th>
					<th>Reason For Unapproval</th>
					<th>Approve Status</th>
					<th>Time/Date</th>
					
				</thead>
		<tbody>
			<?
				foreach ($sys_id_arr as $row) 
				{  
				?>
				
				<tr>   
				
					<td><?=$userName[$row['APPROVED_BY']];?></td>
					<td><?=$designation_a[$userDeg[$row['APPROVED_BY']]];?></td>
					<td><?=$refusing_res_arr[$row['SEQUENCE_NO']];?></td>
					<td><? echo "Yes";?></td>
					<td><?=$row[APPROVED_DATE]; ?></td>
					
					
				</tr>
				<?
				
				}
				?>
		</tbody>

	 </table> 
		<?  $signature_arr=return_library_array( "SELECT MASTER_TBLE_ID,IMAGE_LOCATION from COMMON_PHOTO_LIBRARY where FORM_NAME='user_signature' ",'MASTER_TBLE_ID','IMAGE_LOCATION');
		$appSql = "select a.APPROVED_BY, a.APPROVED_DATE,b.USER_FULL_NAME,c.CUSTOM_DESIGNATION from approval_mst a,USER_PASSWD b,LIB_DESIGNATION c where a.mst_id =$gate_id and a.APPROVED_BY=b.id and b.DESIGNATION=c.id and c.STATUS_ACTIVE=1 and c.IS_DELETED=0 and b.STATUS_ACTIVE=1 and b.IS_DELETED=0
		union all
		select b.id as APPROVED_BY, a.INSERT_DATE as APPROVED_DATE,b.USER_FULL_NAME,c.CUSTOM_DESIGNATION from inv_gate_pass_mst a,USER_PASSWD b,LIB_DESIGNATION c where a.id =$gate_id and a.INSERTED_BY=b.id and b.DESIGNATION=c.id and c.STATUS_ACTIVE=1 and c.IS_DELETED=0 and b.STATUS_ACTIVE=1 and b.IS_DELETED=0";
				//echo $appSql;die;
	$appSqlRes=sql_select($appSql);
	$userDtlsArr=array();
	foreach($appSqlRes as $row){
		$userDtlsArr[$row['APPROVED_BY']]=base_url($signature_arr[$row['APPROVED_BY']]);
	}
	// echo "<pre>";
	// print_r($userDtlsArr); 
	//  echo "</pre>";die();
	
	//echo signature_table(25, $company_id, "1200px",$cbo_template_id,50,$inserted_by,$userSignatureArr);
	      echo signature_table(114, $data[0], $width_sign,$template_id, 1,$inserted_by,$userDtlsArr);  ?>			
		</div>			    
			<script type="text/javascript" src="../../js/jquery.js"></script>
			<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
			<script>
				function generateBarcode( valuess ){					   
						var value = valuess;
						var btype = 'code39';
						var renderer ='css';						 
						var settings = {
						  output:renderer,
						  bgColor: '#FFFFFF',
						  color: '#000000',
						  barWidth: 1,
						  barHeight: 40,
						  moduleSize:5,
						  posX: 10,
						  posY: 20,
						  addQuietZone: 1,
						  showHRI: false
						};
						$("#barcode_img_id_<? echo $cid; ?>").html('11');
						 value = {code:value, rect: false};						
						$("#barcode_img_id_<? echo $cid; ?>").show().barcode(value, btype, settings);
					} 
				 generateBarcode('<? echo $data[1]; ?>');
			</script>
		<?
	}
	?>	
	
	<script type="text/javascript">
		var staticHeight = 0;
		var pageHeight = 900;
		$('.print6_data').each(function() {
		    staticHeight += $(this).filter(':visible').outerHeight(true);
		    //console.log(staticHeight)
		    if (staticHeight > pageHeight) {//<p style="page-break-after:always;"></p>
		        $(this).after( '<p style="page-break-after:always;"></p>');		        
		        staticHeight = 0;
				$('.print6_data').addClass("devider").css({
					'margin-top':"5px",	
					// 'margin-left':"50px",
					'font-size': "16px"	
				});
		    }
		    else{
		    	/*$(this).after( '<hr class="hr" style="border-top: dotted 2px #000">');*/
		    	$(this).after( '<p style="page-break-after:always;"></p>');
		    	$(this).css({
					/*'width':"950px",*/	
					// 'margin-left':"50px",
					'margin-top': "30px",
					'font-size': "16px"	
				});
		    	$('.print6_data').addClass("devider");
		    }

		});
		$(".signature_table_container").css({
			'position' : "relative",
			'top' : "25px",
			'height' : "190px",
			'overflow' : "hidden",
			'width' : "100%",
			'clear' : "both",
			'vertical-align' : "baseline"
		});
	</script>
	<style type="text/css">		
		.devider:nth-of-type(2){
			margin-top: 40px;
		}
	</style>
	<?
	exit();
}
?>


}
?>

