<?
header('Content-type:text/html; charset=utf-8');
session_start();
include('../../../includes/common.php');

$user_id = $_SESSION['logic_erp']["user_id"];
if( $_SESSION['logic_erp']['user_id'] == "" ) { header("location:login.php"); die; }
$permission=$_SESSION['page_permission'];

$data=$_REQUEST['data'];
$action=$_REQUEST['action'];

include ("../../../ext_resource/excel/excel/vendor/autoload.php");
use PhpOffice\PhpSpreadsheet\Spreadsheet;
use PhpOffice\PhpSpreadsheet\IOFactory;
use PhpOffice\PhpSpreadsheet\Writer\Xlsx;
use PhpOffice\PhpSpreadsheet\Style\Border;
use PhpOffice\PhpSpreadsheet\Style\Color;

$select_year="to_char";
$year_con=",'YYYY'";

if($action=="item_process_name_popup")
{
  	echo load_html_head_contents("Item  Name Info","../../../", 1, 1, '','1','');
	extract($_REQUEST);
	?>
	<script>

		$(document).ready(function(e) {
			setFilterGrid('tbl_list_search',-1);
		});

		var selected_id = new Array(); var selected_name = new Array();

		function check_all_data()
		{
			var tbl_row_count = document.getElementById( 'tbl_list_search' ).rows.length;

			tbl_row_count = tbl_row_count-1;
			for( var i = 1; i <= tbl_row_count; i++ ) {
				js_set_value( i );
			}
		}

		function toggle( x, origColor ) {
			var newColor = 'yellow';
			if ( x.style ) {
				x.style.backgroundColor = ( newColor == x.style.backgroundColor )? origColor : newColor;
			}
		}

		function set_all()
		{
			var old=document.getElementById('txt_item_process_row_id').value;
			if(old!="")
			{
				old=old.split(",");
				for(var k=0; k<old.length; k++)
				{
					js_set_value( old[k] )
				}
			}
		}

		function js_set_value( str )
		{

			toggle( document.getElementById( 'search' + str ), '#FFFFCC' );

			if( jQuery.inArray( $('#txt_individual_id' + str).val(), selected_id ) == -1 ) {
				selected_id.push( $('#txt_individual_id' + str).val() );
				selected_name.push( $('#txt_individual' + str).val() );

			}
			else {
				for( var i = 0; i < selected_id.length; i++ ) {
					if( selected_id[i] == $('#txt_individual_id' + str).val() ) break;
				}
				selected_id.splice( i, 1 );
				selected_name.splice( i, 1 );
			}

			var id = ''; var name = '';
			for( var i = 0; i < selected_id.length; i++ ) {
				id += selected_id[i] + ',';
				name += selected_name[i] + ',';
			}

			id = id.substr( 0, id.length - 1 );
			name = name.substr( 0, name.length - 1 );

			$('#hidden_item_process_id').val(id);
			$('#hidden_process_name').val(name);
		}
    </script>

	</head>

	<body>
	<div align="center">
	<fieldset style="width:370px;margin-left:10px">
    	<input type="hidden" name="hidden_item_process_id" id="hidden_item_process_id" class="text_boxes" value="">
        <input type="hidden" name="hidden_process_name" id="hidden_process_name" class="text_boxes" value="">
        <form name="searchprocessfrm_1"  id="searchprocessfrm_1" autocomplete="off">
            <table cellspacing="0" cellpadding="0" border="1" rules="all" width="350" class="rpt_table" >
                <thead>
                    <th width="50">SL</th>
                    <th>Item Category Name</th>
                </thead>
            </table>
            <div style="width:350px; overflow-y:scroll; max-height:280px;" id="buyer_list_view" align="center">
                <table cellspacing="0" cellpadding="0" border="1" rules="all" width="332" class="rpt_table" id="tbl_list_search" >
                <?
                    $i=1; $item_process_row_id=''; $item_process_id_print_array=array(1,2,3,4,13,8,9,10,11,15,16,17,18,19,20,21,22,23,32,34,35,36,37,38,39,33,40,41,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,89,81,85,90,91,92,93,94,99,101,106,107);
					$hidden_item_process_id=explode(",",$cbo_item_cat);
                    foreach($item_category as $id=>$name)
                    {
                            if(in_array($id,$item_process_id_print_array))
                            {
                                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

                                    if(in_array($id,$hidden_item_process_id))
                                    {
                                            if($item_process_row_id=="") $item_process_row_id=$i; else $item_process_row_id.=",".$i;
                                    }
                                    ?>
                                    <tr bgcolor="<? echo $bgcolor; ?>" style="text-decoration:none; cursor:pointer" id="search<? echo $i;?>" onClick="js_set_value(<? echo $i;?>)">
                                            <td width="50" align="center"><?php echo "$i"; ?>
                                                <input type="hidden" name="txt_individual_id" id="txt_individual_id<?php echo $i ?>" value="<? echo $id; ?>"/>
                                                <input type="hidden" name="txt_individual" id="txt_individual<?php echo $i ?>" value="<? echo $name; ?>"/>
                                            </td>
                                            <td><p><? echo $name; ?></p></td>
                                    </tr>
                                    <?
                                    $i++;
                            }
                    }
                ?>
                    <input type="hidden" name="txt_item_process_row_id" id="txt_item_process_row_id" value="<?php echo $item_process_row_id; ?>"/>
                </table>
            </div>
             <table width="350" cellspacing="0" cellpadding="0" style="border:none" align="center">
                <tr>
                    <td align="center" height="30" valign="bottom">
                        <div style="width:100%">
                            <div style="width:50%; float:left" align="left">
                                <input type="checkbox" name="check_all" id="check_all" onClick="check_all_data()" /> Check / Uncheck All
                            </div>
                            <div style="width:50%; float:left" align="left">
                                <input type="button" name="close" onClick="parent.emailwindow.hide();" class="formbutton" value="Close" style="width:100px" />
                            </div>
                        </div>
                    </td>
                </tr>
            </table>
        </form>
    </fieldset>
	</div>
	</body>
	<script src="../../../includes/functions_bottom.js" type="text/javascript"></script>
	<script>
		set_all();
	</script>
	</html>
	<?
	exit();
}

//load drop down Buyer
if ($action=="load_drop_down_buyer")
{
	echo create_drop_down( "cbo_buyer_name", 100, "select buy.id,buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company='$data' and buy.id in (select buyer_id from lib_buyer_party_type where party_type in (1,3,21,90))  $buyer_cond order by buyer_name","id,buyer_name", 1, "-- All Buyer --", $selected, "" ,0);
	exit();
}

if ($action=="load_drop_down_store")
{
	echo create_drop_down( "cbo_store_name", 100, "select a.id,a.store_name from lib_store_location a, lib_store_location_category b where a.id=b.store_location_id  and a.status_active=1 and a.is_deleted=0 and a.company_id='$data' group by a.id,a.store_name order by a.store_name","id,store_name", 1, "-- All Store --", $selected, "" ,0);
	exit();
}

//report generated here--------------------//
if($action=="generate_report")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	$cbo_item_cat=str_replace("'","",$cbo_item_cat);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$cbo_buyer_name=str_replace("'","",$cbo_buyer_name);
	$cbo_store_name=str_replace("'","",$cbo_store_name);
    $sql_cond = "";
	if( trim($cbo_store_name)>0 ) $sql_cond .= " and a.store_id='$cbo_store_name'";
	$cbo_yarn_count=str_replace("'","",$cbo_yarn_count);
	$cbo_based_on=str_replace("'","",$cbo_based_on);
    $txt_mrr_no = str_replace("'","",$txt_mrr_no);
	$txt_date_from=str_replace("'","",$txt_date_from);
	$txt_date_to=str_replace("'","",$txt_date_to);
	$rptType=str_replace("'","",$rptType);
    $cbo_order_type=0;
	if($cbo_item_cat == "")
	{
		$cbo_item_cat = "1,2,3,4,13,8,9,10,11,15,16,17,18,19,20,21,22,23,32,34,35,36,37,38,39,33,40,41,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,89,81,85,90,91,92,93,94,99,101,106,107";
	}

	$return_item_cat = $cbo_item_cat;
	$cbo_item_cat = explode(",",$cbo_item_cat);

    $company_arr=return_library_array("select id, company_name from lib_company",'id','company_name');
	//$buyer_name_arr=return_library_array("select id, buyer_name from  lib_buyer",'id','buyer_name');
	$buyer_short_arr=return_library_array("select id, short_name from lib_buyer",'id','short_name');
	$color_arr=return_library_array("select id, color_name from  lib_color where status_active=1",'id','color_name');
	$supplier_arr=return_library_array("select id, supplier_name from lib_supplier where status_active=1",'id','supplier_name');
	$buyer_name_arr=return_library_array("select id, buyer_name from lib_buyer where status_active=1",'id','buyer_name');
	$store_arr=return_library_array( "select id, store_name from lib_store_location",'id','store_name');
    $user_name_arr=return_library_array("select id, user_name from user_passwd",'id','user_name');
    $department_arr=return_library_array( "select id, department_name from lib_department",'id','department_name');
    $lib_division_arr=return_library_array( "select id, division_name from lib_division",'id','division_name');
	$section_arr=return_library_array( "select id, section_name from lib_section",'id','section_name');
    $brand_arr=return_library_array( "select id,brand_name from  lib_brand",'id','brand_name');

	$trims_booking_report_format_woven_arr = array("183"=>"show_trim_booking_report2","67"=>"show_trim_booking_report","177"=>"show_trim_booking_report4","175"=>"show_trim_booking_report5","235"=>"show_trim_booking_report9","85"=>"print_t","146"=>"print_t7","774"=>"show_trim_booking_report_wg");

    $trims_booking_report_format_sweater_arr = array("67"=>"show_trim_booking_report2","183"=>"show_trim_booking_report3","209"=>"show_trim_booking_report4");

	$print_report_format_rcv=return_field_value("format_id","lib_report_template","template_name ='".$cbo_company_name."' and module_id=6 and report_id=191 and is_deleted=0 and status_active=1");
	$format_rcv_ids=explode(",",$print_report_format_rcv);

	

    $trims_booking_report_format = 	return_field_value("format_id","lib_report_template","template_name ='".$cbo_company_name."' and module_id=2 and report_id = 26 and is_deleted=0 and status_active=1");
    $trims_booking_report_format_ids=explode(",",$trims_booking_report_format);

    $trims_booking_report_format_woven =  return_field_value("format_id","lib_report_template","template_name ='".$cbo_company_name."' and module_id=2 and report_id = 219 and is_deleted=0 and status_active=1");
    $trims_booking_report_format_woven_ids=explode(",",$trims_booking_report_format_woven);

    $trims_booking_report_format_sweater =  return_field_value("format_id","lib_report_template","template_name ='".$cbo_company_name."' and module_id=2 and report_id = 26 and is_deleted=0 and status_active=1");
    $trims_booking_report_format_sweater_ids=explode(",",$trims_booking_report_format_sweater);


    $trim_print_data = "";

    $trim_report_action_woven = "";
    if(count($trims_booking_report_format_woven_ids) > 0) {

        $trim_report_action_woven = $trims_booking_report_format_woven_arr[$trims_booking_report_format_woven_ids[0]];
    }

    $trim_report_action_sweater = "";
    if(count($trims_booking_report_format_sweater_ids) > 0)
    {

        foreach($trims_booking_report_format_sweater_ids as $data)
        {
            if($data==67 || $data==183 || $data==209)
            {
                $trim_report_action_sweater = $trims_booking_report_format_sweater_arr[$data];
                break;
            }
        };
    }

    $trim_report_type = "";
    $trim_report_action = "";
    if(count($trims_booking_report_format_ids) > 0)
    {
        if ($trims_booking_report_format_ids[0] == 67) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report3";
        }elseif ($trims_booking_report_format_ids[0] == 183) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report3";
        }
        elseif ($trims_booking_report_format_ids[0] == 85) {

            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report8";
        }
        elseif ($trims_booking_report_format_ids[0] == 209) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report4";
        }
        elseif ($trims_booking_report_format_ids[0] == 235) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report5";
        }
        elseif ($trims_booking_report_format_ids[0] == 176) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report6";
        }
        elseif ($trims_booking_report_format_ids[0] == 174) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report7";
        }
        elseif ($trims_booking_report_format_ids[0] == 177) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report9";
        }
        elseif ($trims_booking_report_format_ids[0] == 241) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report11";
        }
        elseif ($trims_booking_report_format_ids[0] == 274) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report10";
        }
        elseif ($trims_booking_report_format_ids[0] == 269){
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report12";
        }
        elseif ($trims_booking_report_format_ids[0] == 28) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report13";
        }
        elseif ($trims_booking_report_format_ids[0] == 280) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report14";
        }
        elseif ($trims_booking_report_format_ids[0] == 304) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report15";
        }
        elseif ($trims_booking_report_format_ids[0] == 14) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report16";
        }
        elseif ($trims_booking_report_format_ids[0] == 719) {

            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report17";
        }
        elseif ($trims_booking_report_format_ids[0] == 339) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report12";
        }
        elseif ($trims_booking_report_format_ids[0] == 433) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report19";
        }
    }
    $req_print_report_format_rcv=return_field_value("format_id","lib_report_template","template_name ='".$cbo_company_name."' and module_id=6 and report_id=39 and is_deleted=0 and status_active=1");

    $req_format_rcv_ids=explode(",",$req_print_report_format_rcv);
    $reqReportFormat = 0;
    if(count($req_format_rcv_ids) > 0)
    {
        if($req_format_rcv_ids[0] == 118){  $reqReportFormat = 1;}
        if($req_format_rcv_ids[0] == 119){ $reqReportFormat = 2;}
        if($req_format_rcv_ids[0] == 120){ $reqReportFormat = 3;}
        if($req_format_rcv_ids[0] == 121){ $reqReportFormat =  4;}
        if($req_format_rcv_ids[0] == 122){ $reqReportFormat = 5;}
        if($req_format_rcv_ids[0] == 123){ $reqReportFormat =  6;}
        if($req_format_rcv_ids[0] == 129){ $reqReportFormat =  7;}
        if($req_format_rcv_ids[0] == 169){ $reqReportFormat =  8;}
        if($req_format_rcv_ids[0] == 165){ $reqReportFormat =  9;}
        if($req_format_rcv_ids[0] == 227){ $reqReportFormat =  10;}
        if($req_format_rcv_ids[0] == 241){ $reqReportFormat =  11;}
        if($req_format_rcv_ids[0] == 580){ $reqReportFormat =  12;}
        if($req_format_rcv_ids[0] == 28){ $reqReportFormat =  13;}
        if($req_format_rcv_ids[0] == 280){ $reqReportFormat =  14;}
        if($req_format_rcv_ids[0] == 688){ $reqReportFormat = 15;}
        if($req_format_rcv_ids[0] == 243){ $reqReportFormat =  16;}
        if($req_format_rcv_ids[0] == 310){ $reqReportFormat =  17;}
        if($req_format_rcv_ids[0] == 304){ $reqReportFormat =  18;}
        if($req_format_rcv_ids[0] == 719){ $reqReportFormat =  19;}
        if($req_format_rcv_ids[0] == 723){ $reqReportFormat =  20;}
        if($req_format_rcv_ids[0] == 339){ $reqReportFormat =  21;}
        if($req_format_rcv_ids[0] == 370){ $reqReportFormat =  22;}
        if($req_format_rcv_ids[0] == 235){ $reqReportFormat =  24;}
        if($req_format_rcv_ids[0] == 382){ $reqReportFormat =  23;}
        if($req_format_rcv_ids[0] == 768){ $reqReportFormat =  25;}
        if($req_format_rcv_ids[0] == 425){ $reqReportFormat =  26;}
    }

    $date_cond="";
    if($cbo_based_on==1)
    {
        if( $txt_date_from!="" && $txt_date_to!="" )
        $date_cond="and a.transaction_date between '".date("d-M-Y", strtotime($txt_date_from))."' and '".date("d-M-Y", strtotime($txt_date_to))."'";
    }
    else
    {
        if($txt_date_from!="" && $txt_date_to!="") $date_cond="and a.insert_date between '".date("d-M-Y", strtotime($txt_date_from))."' and '".date("d-M-Y", strtotime($txt_date_to))."  11:59:59 PM'";

    }

    $select_insert_date=" to_char(a.insert_date,'DD-MM-YYYY HH24:MI:SS') as INSERT_DATE";
    $select_insert_time=" to_char(a.insert_date,'HH24:MI:SS')  as INSERT_TIME";

    $con = connect();
    execute_query("delete from gbl_temp_engine where user_id=$user_id and entry_form=33 and ref_from in(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40)");
    oci_commit($con);

	//------------------- For Mrr Search ---------
	$transaction_ids=$transaction_ids_cond_for_mrr="";
	if($txt_mrr_no != "")
	{
		$trasIdsRes = sql_select("SELECT a.id as TRANS_ID, b.RECV_NUMBER, b.RECV_NUMBER_PREFIX_NUM
		from inv_receive_master b, inv_transaction a where b.id = a.mst_id and b.company_id='$cbo_company_name' and b.recv_number_prefix_num = '$txt_mrr_no' $date_cond and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 order by a.id");
        foreach($trasIdsRes as $transRow){
			$transaction_ids .=  $transRow["TRANS_ID"].",";
		}
		$transaction_ids = chop($transaction_ids,",");
		if ($transaction_ids != "") $transaction_ids_cond_for_mrr = " and a.id in ($transaction_ids)";
	}

	//---------------------- End ---------------------

	//echo implode(",",$cbo_item_cat); die;
	// ob_start();
    ?>
        <style>
            .wrd_brk{word-break: break-all;}
        </style>
    <?
    $html="";
    $html.='<table width="2280" border="0" cellpadding="2" cellspacing="0" class="rpt_table" rules="all" id="" align="left" style="border:none;">

        <tr class="form_caption" style="border:none;">
            <td colspan="12" align="center" style="border:none;font-size:16px; font-weight:bold" >
            <div style="text-align:center;" class="search_type">'. create_drop_down( "cbo_string_search_type", 150, $string_search_type,'', 1, "-- Searching Type --","4","","","2,3,4" ) .'</div>
            </td>
        </tr>
         <tr class="form_caption" style="border:none;">
            <td colspan="12" align="center" style="border:none;font-size:16px; font-weight:bold" >Date Wise Item Receive Issue Report </td>
        </tr>
        <tr style="border:none;">
            <td colspan="12" align="center" style="border:none; font-size:14px;">
                Company Name : '.$company_arr[str_replace("'","",$cbo_company_name)].'
            </td>
        </tr>
	</table>';


	if(($key = array_search(4, $cbo_item_cat)) !== false) //if($cbo_item_cat==4)
	{

        unset($cbo_item_cat[$key]); // remove 4 for

		$data_array_file=sql_select("SELECT MASTER_TBLE_ID,IMAGE_LOCATION, REAL_FILE_NAME from common_photo_library where form_name='trims_receive_entry' and is_deleted=0 and file_type=2");
		$chk_file=array();
		foreach($data_array_file as $row)
		{
			$chk_file[$row['MASTER_TBLE_ID']]=$row['MASTER_TBLE_ID'];
		}

        $stationary_print_report_format=return_field_value("format_id","lib_report_template","template_name =".$cbo_company_name." and module_id=5 and report_id=61 and is_deleted=0 and status_active=1");
        $stationary_format_ids=explode(",",$stationary_print_report_format);

		if($cbo_buyer_name!=0) $cbo_buyer_name="and d.buyer_name=$cbo_buyer_name"; else $cbo_buyer_name="";
		if($db_type==2) $issue_cond="and b.issue_basis=(CASE WHEN b.entry_form = 25 THEN 2 ELSE 0 END)"; else if($db_type==0) $issue_cond="and b.issue_basis=(CASE WHEN b.entry_form = 25 THEN '2' ELSE '0' END)";

		if($rptType==1)
		{
            $sql="SELECT
					A.ID AS TRANS_ID,
					B.PO_BREAKDOWN_ID AS ORDER_ID,
					A.TRANSACTION_DATE,
					CASE WHEN B.TRANS_TYPE IN(1,4) THEN B.QUANTITY ELSE 0 END AS RECEIVE_QTY,
					CASE WHEN B.TRANS_TYPE IN(3) THEN B.QUANTITY ELSE 0 END AS RECEIVE_RET_QTY,
					0 AS ISSUE_QTY,
					A.CONS_UOM,
					A.COMPANY_ID,
					D.JOB_NO,
					D.JOB_NO_PREFIX_NUM,
					D.STYLE_REF_NO,
					$SELECT_YEAR(D.INSERT_DATE $YEAR_CON) AS JOB_YEAR,
					D.BUYER_NAME,
					C.PO_NUMBER,
					C.SHIPMENT_DATE,
					B.PROD_ID,
					A.TRANSACTION_TYPE,
					A.MST_ID,
					A.CONS_RATE,
					A.ORDER_RATE,
					A.INSERTED_BY,
                    A.RECEIVE_BASIS,
					$select_insert_date,
					$select_insert_time,
					A.ORDER_QNTY,
					A.STORE_ID,
					P.ITEM_DESCRIPTION,
					P.PRODUCT_NAME_DETAILS,
					P.COLOR,
					P.ITEM_COLOR,
					P.GMTS_SIZE,
					P.ITEM_SIZE,
					P.ITEM_GROUP_ID,
                    NULL AS ISSUE_TO,
					X.REMARKS
				from
					inv_transaction a, order_wise_pro_details b, wo_po_break_down c, wo_po_details_master d, product_details_master p, inv_receive_master x
				where
					a.id=b.trans_id and b.po_breakdown_id=c.id and c.job_id=d.id and  p.id=a.prod_id AND x.id = a.mst_id and a.item_category=4 and A.COMPANY_ID in($cbo_company_name) $cbo_buyer_name $date_cond $sql_cond $transaction_ids_cond_for_mrr and b.trans_type in(1,3,4) and b.entry_form in(24,25,49) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and d.is_deleted=0 and p.is_deleted=0

                union all

                SELECT
					A.ID AS TRANS_ID,
					B.PO_BREAKDOWN_ID AS ORDER_ID,
					A.TRANSACTION_DATE,
					0 AS RECEIVE_QTY,
					CASE WHEN B.TRANS_TYPE IN(2,3) THEN B.QUANTITY ELSE 0 END AS ISSUE_QTY,
					CASE WHEN B.TRANS_TYPE IN(4) THEN B.QUANTITY ELSE 0 END AS ISSUE_RET_QTY,
					A.CONS_UOM,
					A.COMPANY_ID,
					D.JOB_NO,
					D.JOB_NO_PREFIX_NUM,
					D.STYLE_REF_NO,
					$SELECT_YEAR(D.INSERT_DATE $YEAR_CON) AS JOB_YEAR,
					D.BUYER_NAME,
					C.PO_NUMBER,
					C.SHIPMENT_DATE,
					B.PROD_ID,
					A.TRANSACTION_TYPE,
					A.MST_ID,
					A.CONS_RATE,
					A.ORDER_RATE,
					A.INSERTED_BY,
                    A.RECEIVE_BASIS,
					$select_insert_date,
					$select_insert_time,
					A.ORDER_QNTY,
					A.STORE_ID,
					P.ITEM_DESCRIPTION,
					P.PRODUCT_NAME_DETAILS,
					P.COLOR,
					P.ITEM_COLOR,
					P.GMTS_SIZE,
					P.ITEM_SIZE,
					P.ITEM_GROUP_ID,
                    E.KNIT_DYE_COMPANY AS ISSUE_TO,
					x.REMARKS
				from
					inv_transaction a, order_wise_pro_details b, wo_po_break_down c,wo_po_details_master d, product_details_master p,inv_issue_master e, inv_receive_master x
				where
					a.id=b.trans_id and a.mst_id = e.id and b.po_breakdown_id=c.id AND x.id = a.mst_id and c.job_id=d.id and p.id=a.prod_id and a.item_category=4 and b.trans_type in(2,3,4) and A.COMPANY_ID in($cbo_company_name) $cbo_buyer_name $date_cond $sql_cond $transaction_ids_cond_for_mrr and b.entry_form in(25,49,73) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and d.is_deleted=0 and p.is_deleted=0 and e.is_deleted=0";
		}
		else if($rptType==2)
		{
			$sql="SELECT
					A.ID AS TRANS_ID,
					B.PO_BREAKDOWN_ID AS ORDER_ID,
					A.TRANSACTION_DATE,
					CASE WHEN B.TRANS_TYPE IN(1,4) THEN B.QUANTITY ELSE 0 END AS RECEIVE_QTY,
					CASE WHEN B.TRANS_TYPE IN(3) THEN B.QUANTITY ELSE 0 END AS RECEIVE_RET_QTY,
					'' AS ISSUE_QTY,
					A.CONS_UOM,
					A.COMPANY_ID,
					D.JOB_NO,
					D.JOB_NO_PREFIX_NUM,
					D.STYLE_REF_NO,
					$SELECT_YEAR(D.INSERT_DATE $YEAR_CON) AS JOB_YEAR,
					D.BUYER_NAME,
					C.PO_NUMBER,
					C.SHIPMENT_DATE,
					C.GROUPING,
					B.PROD_ID,
					A.TRANSACTION_TYPE,
					A.MST_ID,
					A.CONS_RATE,
					A.ORDER_RATE,
					A.INSERTED_BY,
                    A.RECEIVE_BASIS,
					$select_insert_date,
					$select_insert_time,
					A.ORDER_QNTY,
					A.STORE_ID,
					P.ITEM_DESCRIPTION,
					P.PRODUCT_NAME_DETAILS,
					P.COLOR,
					P.ITEM_COLOR,
					P.GMTS_SIZE,
					P.ITEM_SIZE,
					P.ITEM_GROUP_ID,
					x.REMARKS
				from
					inv_transaction a, order_wise_pro_details b, wo_po_break_down c,wo_po_details_master d, product_details_master p, inv_receive_master x
				where
					a.id=b.trans_id and b.po_breakdown_id=c.id and  c.job_id=d.id AND x.id = a.mst_id and p.id=a.prod_id and a.item_category=4 and A.COMPANY_ID in($cbo_company_name)  $cbo_buyer_name $date_cond $sql_cond $transaction_ids_cond_for_mrr and b.trans_type in(1,4) and b.entry_form in(24,73) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and d.is_deleted=0 and p.is_deleted=0";
		}
		else if($rptType==3)
		{
			$sql="SELECT
					A.ID AS TRANS_ID,
					B.PO_BREAKDOWN_ID AS ORDER_ID,
					A.TRANSACTION_DATE,
					'' AS RECEIVE_QTY,
					CASE WHEN B.TRANS_TYPE IN(2,3) THEN B.QUANTITY ELSE 0 END AS ISSUE_QTY,
					CASE WHEN B.TRANS_TYPE IN(4) THEN B.QUANTITY ELSE 0 END AS ISSUE_RET_QTY,
					A.CONS_UOM,
					A.COMPANY_ID,
					D.JOB_NO,
					D.JOB_NO_PREFIX_NUM,
					D.STYLE_REF_NO,
					$SELECT_YEAR(D.INSERT_DATE $YEAR_CON) AS JOB_YEAR,
					D.BUYER_NAME,
					C.PO_NUMBER,
					C.SHIPMENT_DATE,
					C.GROUPING,
					B.PROD_ID,
					A.TRANSACTION_TYPE,
					A.MST_ID,
					A.CONS_RATE,
					A.ORDER_RATE,
					A.DEPARTMENT_ID,
					A.SECTION_ID,
					A.INSERTED_BY,
					$select_insert_date,
					$select_insert_time,
					A.ORDER_QNTY,
					A.STORE_ID,
					P.ITEM_DESCRIPTION,
					P.PRODUCT_NAME_DETAILS,
					P.COLOR,
					P.ITEM_COLOR,
					P.GMTS_SIZE,
					P.ITEM_SIZE,
					P.ITEM_GROUP_ID,
                    E.KNIT_DYE_COMPANY AS ISSUE_TO
				from
					inv_transaction a, order_wise_pro_details b, wo_po_break_down c,wo_po_details_master d, product_details_master p,inv_issue_master e
				where
					a.id=b.trans_id and a.mst_id = e.id and b.po_breakdown_id=c.id and c.job_id=d.id and p.id=a.prod_id and a.item_category=4 and b.trans_type in(2,3) and A.COMPANY_ID in($cbo_company_name)  $cbo_buyer_name $date_cond $sql_cond $transaction_ids_cond_for_mrr and b.entry_form in(25,49) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and d.is_deleted=0 and p.is_deleted=0 and e.is_deleted=0";
		}

		// echo $sql; die;
		$sql_result=sql_select($sql);

		// echo "<pre>";
		// print_r($sql_result);

		$trms_rasult_arr=array();
        $receive_ids_arr=array();
        $issue_ids_arr=array();
        $transfer_ids_arr=array();
		foreach($sql_result as $row)
		{
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["trans_id"]=$row["TRANS_ID"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["order_id"]=$row["ORDER_ID"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["prod_id"]=$row["PROD_ID"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["transaction_type"]=$row["TRANSACTION_TYPE"];
            $trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["receive_basis"]=$row["RECEIVE_BASIS"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["rec_issue_id"]=$row["MST_ID"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["transaction_date"]=$row["TRANSACTION_DATE"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["job_no"]=$row["JOB_NO"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["style_ref_no"]=$row["STYLE_REF_NO"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["job_no_prefix_num"]=$row["JOB_NO_PREFIX_NUM"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["job_year"]=$row["JOB_YEAR"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["buyer_name"]=$row["BUYER_NAME"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["po_number"]=$row["PO_NUMBER"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["shipment_date"]=$row["SHIPMENT_DATE"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["receive_qty"]+=$row["RECEIVE_QTY"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["issue_qty"]+=$row["ISSUE_QTY"];

			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["receive_ret_qty"]+=$row["RECEIVE_RET_QTY"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["issue_ret_qty"]+=$row["ISSUE_RET_QTY"];


			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["cons_uom"]=$row["CONS_UOM"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["company_id"]=$row["COMPANY_ID"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["cons_rate"]=$row["CONS_RATE"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["inserted_by"]=$row["INSERTED_BY"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["insert_date"]=$row["INSERT_DATE"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["insert_time"]=$row["INSERT_TIME"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["store_id"]=$row["STORE_ID"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["order_qnty"]=$row["ORDER_QNTY"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["order_rate"]=$row["ORDER_RATE"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["item_description"]=$row["ITEM_DESCRIPTION"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["product_name_details"]=$row["PRODUCT_NAME_DETAILS"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["color"]=$row["COLOR"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["item_color"]=$row["ITEM_COLOR"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["gmts_size"]=$row["GMTS_SIZE"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["item_size"]=$row["ITEM_SIZE"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["item_group_id"]=$row["ITEM_GROUP_ID"];
            $trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["issue_to"]=$row["ISSUE_TO"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["department_id"]=$row["DEPARTMENT_ID"];
            $trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["section_id"]=$row["SECTION_ID"];
            $trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["remarks"]=$row["REMARKS"];
            $trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["grouping"]=$row["GROUPING"];

            if ($row["TRANSACTION_TYPE"]==1 || $row["TRANSACTION_TYPE"]==4){
                $receive_ids_arr[$row["MST_ID"]]=$row["MST_ID"];
            } else if ($row["TRANSACTION_TYPE"]==2 || $row["TRANSACTION_TYPE"]==3) {
                $issue_ids_arr[$row["MST_ID"]]=$row["MST_ID"];
            } else $transfer_ids_arr[$row["MST_ID"]]=$row["MST_ID"];
		}
		unset($sql_result);
		//print_r($trms_rasult_arr);die;

		// echo "<pre>";
		// print_r($trms_rasult_arr); die;

		if($rptType==1)
		{
			$sql_non_order="SELECT
					A.ID AS TRANS_ID,
					A.TRANSACTION_DATE,
					A.CONS_QUANTITY AS RECEIVE_QTY,
					0 AS ISSUE_QTY,
					A.CONS_UOM,
					A.COMPANY_ID,
					A.PROD_ID,
					A.TRANSACTION_TYPE,
					A.MST_ID,
					A.CONS_RATE,
					A.STORE_ID,
					A.INSERTED_BY,
					B.BOOKING_NO,
                    B.BOOKING_ID,
                    B.RECEIVE_BASIS,
					$select_insert_date,
					$select_insert_time,
					P.ITEM_DESCRIPTION,
					P.PRODUCT_NAME_DETAILS,
					P.COLOR,
					P.ITEM_COLOR,
					P.GMTS_SIZE,
					P.ITEM_SIZE,
					P.ITEM_GROUP_ID,
					1 as TYPE
				from
					inv_transaction a, inv_receive_master b, product_details_master p
				where
					b.id=a.mst_id and p.id=a.prod_id and a.item_category=4 and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and p.is_deleted=0 and b.entry_form in(20,24,27) and a.transaction_type in(1,4) and b.booking_without_order = (CASE WHEN b.entry_form = 24 THEN '1' ELSE '0' END)

				union all

				SELECT
					A.ID AS TRANS_ID,
					A.TRANSACTION_DATE,
					0 AS RECEIVE_QTY,
					A.CONS_QUANTITY AS ISSUE_QTY,
					A.CONS_UOM,
					A.COMPANY_ID,
					A.PROD_ID,
					A.TRANSACTION_TYPE,
					A.MST_ID,
					A.CONS_RATE,
					A.STORE_ID,
					A.INSERTED_BY,
					NULL AS BOOKING_NO,
				    NULL AS BOOKING_ID,
                    NULL AS RECEIVE_BASIS,
					$select_insert_date,
					$select_insert_time,
					P.ITEM_DESCRIPTION,
					P.PRODUCT_NAME_DETAILS,
					P.COLOR,
					P.ITEM_COLOR,
					P.GMTS_SIZE,
					P.ITEM_SIZE,
					P.ITEM_GROUP_ID,
					2 AS TYPE
				from
					inv_transaction a, inv_issue_master b, product_details_master p
				where
					b.id=a.mst_id and p.id=a.prod_id and a.item_category=4 and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr and a.status_active=1 and a.is_deleted=0 and b.entry_form in(21,25,26) and a.transaction_type in(2,3) and b.is_deleted=0 and p.is_deleted=0";
		}
		else if($rptType==2)
		{
			$sql_non_order="SELECT
					A.ID AS TRANS_ID,
					A.TRANSACTION_DATE,
					A.CONS_QUANTITY AS RECEIVE_QTY,
					0 AS ISSUE_QTY,
					A.CONS_UOM,
					A.COMPANY_ID,
					A.PROD_ID,
					A.TRANSACTION_TYPE,
					A.MST_ID,
					A.CONS_RATE,
					A.STORE_ID,
					A.INSERTED_BY,
					B.BOOKING_NO,
                    B.BOOKING_ID,
                    B.RECEIVE_BASIS,
					$select_insert_date,
					$select_insert_time,
					P.ITEM_DESCRIPTION,
					P.PRODUCT_NAME_DETAILS,
					P.COLOR,
					P.ITEM_COLOR,
					P.GMTS_SIZE,
					P.ITEM_SIZE,
					P.ITEM_GROUP_ID,
					1 AS TYPE
				from
					inv_transaction a, inv_receive_master b, product_details_master p
				where
					b.id=a.mst_id and p.id=a.prod_id and a.item_category=4 and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and p.is_deleted=0 and b.entry_form in(20,24,27) and a.transaction_type in(1,4) and b.booking_without_order = (CASE WHEN b.entry_form = 24 THEN '1' ELSE '0' END)";
		}
		else if($rptType==3)
		{
			// $sql_non_order="SELECT A.ID AS TRANS_ID, A.TRANSACTION_DATE, 0 AS RECEIVE_QTY, A.CONS_QUANTITY AS ISSUE_QTY, A.CONS_UOM, A.COMPANY_ID, A.PROD_ID, A.TRANSACTION_TYPE, A.MST_ID, A.CONS_RATE, A.INSERTED_BY, NULL AS BOOKING_NO, $select_insert_date, $select_insert_time, P.ITEM_DESCRIPTION, P.PRODUCT_NAME_DETAILS, P.COLOR, A.DEPARTMENT_ID, A.SECTION_ID, P.ITEM_COLOR, P.GMTS_SIZE, P.ITEM_SIZE, P.ITEM_GROUP_ID, 2 AS TYPE from inv_transaction a, inv_issue_master b, product_details_master p where b.id=a.mst_id and p.id=a.prod_id and a.item_category=4 and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr and a.status_active=1 and a is_deleted=0 and b.entry_form in(21,25,26) and a.transaction_type in(2,3) and b.is_deleted=0 and p.is_deleted=0";

			$sql_non_order="SELECT A.ID AS TRANS_ID, A.TRANSACTION_DATE, 0 AS RECEIVE_QTY, A.CONS_QUANTITY AS ISSUE_QTY, A.CONS_UOM, A.COMPANY_ID, A.PROD_ID, A.TRANSACTION_TYPE, A.MST_ID, A.CONS_RATE, A.STORE_ID,A.INSERTED_BY, NULL AS BOOKING_NO, $select_insert_date, $select_insert_time, P.ITEM_DESCRIPTION, P.PRODUCT_NAME_DETAILS, P.COLOR, A.DEPARTMENT_ID, A.SECTION_ID, P.ITEM_COLOR, P.GMTS_SIZE, P.ITEM_SIZE, P.ITEM_GROUP_ID, 2 AS TYPE FROM inv_transaction A INNER JOIN inv_issue_master B ON B.id = A.mst_id INNER JOIN product_details_master P ON P.id = A.prod_id WHERE A.item_category = 4 AND A.company_id = $cbo_company_name $date_cond $transaction_ids_cond_for_mrr AND A.status_active = 1 AND A.is_deleted = 0 AND B.entry_form IN (21, 25, 26) AND A.transaction_type IN (2, 3) AND B.is_deleted = 0 AND P.is_deleted = 0 AND A.PROD_ID NOT IN ( SELECT DISTINCT B.PROD_ID FROM inv_transaction A INNER JOIN order_wise_pro_details B ON A.id = B.trans_id INNER JOIN wo_po_break_down C ON B.po_breakdown_id = C.id INNER JOIN wo_po_details_master D ON C.job_id = D.id INNER JOIN product_details_master P ON P.id = A.prod_id INNER JOIN inv_issue_master E ON E.id = A.mst_id WHERE A.item_category = 4 AND B.trans_type IN (2, 3) AND A.company_id IN ($cbo_company_name) $date_cond $transaction_ids_cond_for_mrr AND B.entry_form IN (25, 49) AND A.status_active = 1 AND A.is_deleted = 0 AND B.is_deleted = 0 AND C.is_deleted = 0 AND D.is_deleted = 0 AND P.is_deleted = 0 AND E.is_deleted = 0)";
			// echo "*****".$transaction_ids_cond_for_mrr; die;
		}
		//echo "<br>";
		 //echo $sql_non_order."<br>";die;
		$sql_result_non_order=sql_select($sql_non_order);
		$trms_non_order_arr=array();
        $nonOrderBooking_ids_arr=array();
		foreach($sql_result_non_order as $row)
		{
			$trms_non_order_arr[$row["TRANS_ID"]]["trans_id"]=$row["TRANS_ID"];
			$trms_non_order_arr[$row["TRANS_ID"]]["prod_id"]=$row["PROD_ID"];
			$trms_non_order_arr[$row["TRANS_ID"]]["transaction_type"]=$row["TRANSACTION_TYPE"];
			$trms_non_order_arr[$row["TRANS_ID"]]["rec_issue_id"]=$row["MST_ID"];
			$trms_non_order_arr[$row["TRANS_ID"]]["transaction_date"]=$row["TRANSACTION_DATE"];
			$trms_non_order_arr[$row["TRANS_ID"]]["receive_qty"]+=$row["RECEIVE_QTY"];
			$trms_non_order_arr[$row["TRANS_ID"]]["issue_qty"]+=$row["ISSUE_QTY"];
			$trms_non_order_arr[$row["TRANS_ID"]]["cons_uom"]=$row["CONS_UOM"];
			$trms_non_order_arr[$row["TRANS_ID"]]["company_id"]=$row["COMPANY_ID"];
			$trms_non_order_arr[$row["TRANS_ID"]]["cons_rate"]=$row["CONS_RATE"];
			$trms_non_order_arr[$row["TRANS_ID"]]["inserted_by"]=$row["INSERTED_BY"];
			$trms_non_order_arr[$row["TRANS_ID"]]["insert_date"]=$row["INSERT_DATE"];
			$trms_non_order_arr[$row["TRANS_ID"]]["insert_time"]=$row["INSERT_TIME"];
			$trms_non_order_arr[$row["TRANS_ID"]]["item_description"]=$row["ITEM_DESCRIPTION"];
			$trms_non_order_arr[$row["TRANS_ID"]]["product_name_details"]=$row["PRODUCT_NAME_DETAILS"];
			$trms_non_order_arr[$row["TRANS_ID"]]["color"]=$row["COLOR"];
			$trms_non_order_arr[$row["TRANS_ID"]]["item_color"]=$row["ITEM_COLOR"];
			$trms_non_order_arr[$row["TRANS_ID"]]["gmts_size"]=$row["GMTS_SIZE"];
			$trms_non_order_arr[$row["TRANS_ID"]]["item_size"]=$row["ITEM_SIZE"];
			$trms_non_order_arr[$row["TRANS_ID"]]["item_group_id"]=$row["ITEM_GROUP_ID"];
			$trms_non_order_arr[$row["TRANS_ID"]]["booking_no"]=$row["BOOKING_NO"];
            $trms_non_order_arr[$row["TRANS_ID"]]["booking_id"]=$row["BOOKING_ID"];
            $trms_non_order_arr[$row["TRANS_ID"]]["receive_basis"]=$row["RECEIVE_BASIS"];
			$trms_non_order_arr[$row["TRANS_ID"]]["department_id"]=$row["DEPARTMENT_ID"];
			$trms_non_order_arr[$row["TRANS_ID"]]["section_id"]=$row["SECTION_ID"];
			$trms_non_order_arr[$row["TRANS_ID"]]["store_id"]=$row["STORE_ID"];

            if ($row["TRANSACTION_TYPE"]==1 || $row["TRANSACTION_TYPE"]==4){
                $receive_ids_arr[$row["MST_ID"]]=$row["MST_ID"];
            } else if ($row["TRANSACTION_TYPE"]==2 || $row["TRANSACTION_TYPE"]==3) {
                $issue_ids_arr[$row["MST_ID"]]=$row["MST_ID"];
            } else $transfer_ids_arr[$row["MST_ID"]]=$row["MST_ID"];

            if ($row["BOOKING_ID"]>0) $nonOrderBooking_ids_arr[$row["BOOKING_ID"]]=$row["BOOKING_ID"];
		}
		unset($sql_result_non_order);


        $rcv_arr=array();
        $receive_num_arr=array();
        $booking_ids_arr=array();
        if (count($receive_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 9, $receive_ids_arr, $empty_arr);
            $sql_receive_res=sql_select("SELECT b.ID, b.RECV_NUMBER, b.CHALLAN_NO, b.CHALLAN_DATE, b.SUPPLIER_ID, b.KNITTING_SOURCE, b.KNITTING_COMPANY, b.CURRENCY_ID, b.EXCHANGE_RATE, b.BOOKING_ID, b.BOOKING_NO, b.RECEIVE_BASIS, b.IS_MULTI, b.ENTRY_FORM ,b.PAY_MODE, b.BOOKING_WITHOUT_ORDER from gbl_temp_engine g, inv_receive_master b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=9 and b.item_category=4 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_receive_res as $row)
            {
                $receive_num_arr[$row["ID"]]["id"]=$row["ID"];
                $receive_num_arr[$row["ID"]]["recv_number"]=$row["RECV_NUMBER"];
                $receive_num_arr[$row["ID"]]["challan_no"]=$row["CHALLAN_NO"];
                $receive_num_arr[$row["ID"]]["challan_date"]=$row["CHALLAN_DATE"];
                $receive_num_arr[$row["ID"]]["supplier_id"]=$row["SUPPLIER_ID"];
                $receive_num_arr[$row["ID"]]["knitting_source"]=$row["KNITTING_SOURCE"];
                $receive_num_arr[$row["ID"]]["knitting_company"]=$row["KNITTING_COMPANY"];
                $receive_num_arr[$row["ID"]]["currency_id"]=$row["CURRENCY_ID"];
                $receive_num_arr[$row["ID"]]["exchange_rate"]=$row["EXCHANGE_RATE"];
                $receive_num_arr[$row["ID"]]["booking_id"]=$row["BOOKING_ID"];
                $receive_num_arr[$row["ID"]]["booking_no"]=$row["BOOKING_NO"];
                $receive_num_arr[$row["ID"]]["receive_basis"]=$row["RECEIVE_BASIS"];
                $receive_num_arr[$row["ID"]]["is_multi"]=$row["IS_MULTI"];
                $receive_num_arr[$row["ID"]]["entry_form"]=$row["ENTRY_FORM"];
                $receive_num_arr[$row["ID"]]["pay_mode"]=$row["PAY_MODE"];
                $rcv_arr[$row["ENTRY_FORM"]]="'".$row["RECV_NUMBER"]."'";
                $rcv_arr[$row["ENTRY_FORM"]]="'".$row["RECV_NUMBER"]."'";
                if ($row['BOOKING_WITHOUT_ORDER']==0 && $row["BOOKING_ID"]>0) {
                    $booking_ids_arr[$row["BOOKING_ID"]]=$row["BOOKING_ID"];
                }
            }
            unset($sql_receive_res);
        }



        $issue_num_arr=array();
        if (count($issue_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 10, $issue_ids_arr, $empty_arr);
            $sql_issue_res=sql_select("SELECT b.ID, b.ISSUE_NUMBER, b.CHALLAN_NO, b.REQ_NO, b.KNIT_DYE_SOURCE, b.KNIT_DYE_COMPANY, b.ENTRY_FORM, b.ISSUE_PURPOSE from gbl_temp_engine g, inv_issue_master b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=10 and b.item_category=4 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_issue_res as $row)
            {
                $issue_num_arr[$row["ID"]]["id"]=$row["ID"];
                $issue_num_arr[$row["ID"]]["issue_number"]=$row["ISSUE_NUMBER"];
                $issue_num_arr[$row["ID"]]["challan_no"]=$row["CHALLAN_NO"];
                $issue_num_arr[$row["ID"]]["req_no"]=$row["REQ_NO"];
                $issue_num_arr[$row["ID"]]["knit_dye_source"]=$row["KNIT_DYE_SOURCE"];
                $issue_num_arr[$row["ID"]]["knit_dye_company"]=$row["KNIT_DYE_COMPANY"];
                $issue_num_arr[$row["ID"]]["entry_form"]=$row["ENTRY_FORM"];
                $issue_num_arr[$row["ID"]]["issue_purpose"]=$row["ISSUE_PURPOSE"];
            }
            unset($sql_issue_res);
        }

        $transfer_num_arr=array();
        if (count($transfer_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 11, $transfer_ids_arr, $empty_arr);
            $sql_transfer_res=sql_select("SELECT b.ID, b.TRANSFER_SYSTEM_ID, b.CHALLAN_NO, b.TRANSFER_DATE from gbl_temp_engine g, inv_item_transfer_mst b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=11 and b.item_category=4 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_transfer_res as $row)
            {
                $transfer_num_arr[$row["ID"]]["id"]=$row["ID"];
                $transfer_num_arr[$row["ID"]]["transfer_system_id"]=$row["TRANSFER_SYSTEM_ID"];
                $transfer_num_arr[$row["ID"]]["challan_no"]=$row["CHALLAN_NO"];
                $transfer_num_arr[$row["ID"]]["transfer_date"]=$row["TRANSFER_DATE"];
            }
            unset($sql_transfer_res);
        }


        $non_ord_data_arr=array();
        if (count($nonOrderBooking_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 12, $nonOrderBooking_ids_arr, $empty_arr);
            $sql_nonOrderBooking_res=sql_select("SELECT A.ID, A.COMPANY_NAME, A.WO_NUMBER_PREFIX_NUM, A.WO_NUMBER, A.WO_DATE, A.ATTENTION, A.LOCATION_ID, A.SUPPLIER_ID, A.PAY_MODE, A.SOURCE, A.CURRENCY_ID, A.DELIVERY_DATE, A.WO_BASIS_ID, B.ITEM_CATEGORY_ID from gbl_temp_engine g, wo_non_order_info_mst a, wo_non_order_info_dtls b where g.ref_val=a.id and a.id=b.mst_id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=12 and a.status_active=1 and a.is_deleted=0");//die;
            foreach($sql_nonOrderBooking_res as $val)
            {
                $non_ord_data_arr[$val["ID"]]["COMPANY_NAME"]=$val["COMPANY_NAME"];
                $non_ord_data_arr[$val["ID"]]["WO_NUMBER_PREFIX_NUM"]=$val["WO_NUMBER_PREFIX_NUM"];
                $non_ord_data_arr[$val["ID"]]["WO_NUMBER"]=$val["WO_NUMBER"];
                $non_ord_data_arr[$val["ID"]]["WO_DATE"]=$val["WO_DATE"];
                $non_ord_data_arr[$val["ID"]]["ATTENTION"]=$val["ATTENTION"];
                $non_ord_data_arr[$val["ID"]]["LOCATION_ID"]=$val["LOCATION_ID"];
                $non_ord_data_arr[$val["ID"]]["SUPPLIER_ID"]=$val["SUPPLIER_ID"];
                $non_ord_data_arr[$val["ID"]]["PAY_MODE"]=$val["PAY_MODE"];
                $non_ord_data_arr[$val["ID"]]["SOURCE"]=$val["SOURCE"];
                $non_ord_data_arr[$val["ID"]]["CURRENCY_ID"]=$val["CURRENCY_ID"];
                $non_ord_data_arr[$val["ID"]]["DELIVERY_DATE"]=$val["DELIVERY_DATE"];
                $non_ord_data_arr[$val["ID"]]["WO_BASIS_ID"]=$val["WO_BASIS_ID"];
                $non_ord_data_arr[$val["ID"]]["ITEM_CATEGORY_ID"]=$val["ITEM_CATEGORY_ID"];
            }
            unset($sql_nonOrderBooking_res);
        }


        $req_location_arr=array();
		if (count($booking_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 2, $booking_ids_arr, $empty_arr);
            $sql_req_res=sql_select("SELECT a.ID, a.LOCATION_ID from inv_purchase_requisition_mst a, gbl_temp_engine g where a.id=g.ref_val and a.status_active=1 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=2");
            foreach($sql_req_res as $row){
                $req_location_arr[$row['ID']]=$row['LOCATION_ID'];
            }
            unset($sql_req_res);
        }

		if($rptType==1)
		{
			$table_width=3230;
			$div_width="3250px";
		}
		else if($rptType==2)
		{
			// $table_width=2930;
			// $div_width="2950px";

			$table_width=3100;
			$div_width="3120px";
		}
		else
		{
			// $table_width=2770;
			// $div_width="2790px";

			$table_width=2940;
			$div_width="2960px";
		}

		if($rptType==1)
		{
			$table_width_non_order=1910;
			$div_width_non_order="1930px";
			$col_span_non_order=19;
		}
		elseif($rptType==2)
		{
			$table_width_non_order=1830;
			$div_width_non_order="1850px";
			$col_span_non_order=18;
		}
		else
		{
			//$table_width_non_order=1850;
			$table_width_non_order=2030;
			$div_width_non_order="1970px";
			$col_span_non_order=21;
			//$col_span_non_order=19;
		}
		if($cbo_order_type==2)
		{
			$scroll_div="scroll_body";
			$scroll_div_width="1850px";
			$table_width=1830;
		}
		else
		{
			$scroll_div="";
			$scroll_div_width="";
		}

		$show_html_4 = 1;

		//echo count($trms_rasult_arr)."klass".count($trms_non_order_arr);die;

		if(count($trms_rasult_arr) > 0 || count($trms_non_order_arr) > 0)
		{
			$html.='<div id="'.$scroll_div.'" class="scroll_div_class" style="width:'.$scroll_div_width.'">
				<table width="'.$table_width.'" align="left">
					<tr class="form_caption" style="border:none;">
						<td colspan="19" align="left" style="border:none;font-size:16px; font-weight:bold" > Accessories: </td>
					</tr>
				</table>
				<br />';
				$sql_item_group=sql_select("select id, item_name,conversion_factor from  lib_item_group where status_active=1 and is_deleted =0 and item_category=4");
				foreach($sql_item_group as $row)
				{
					$group_arr[$row[csf("id")]]["item_name"]=$row[csf("item_name")];
					$group_arr[$row[csf("id")]]["conversion_factor"]=$row[csf("conversion_factor")];
				}
				$size_arr=return_library_array( "select id, size_name from lib_size where status_active=1",'id','size_name');

                $trim_sql_data_report_sql=sql_select("SELECT ID, booking_no||'*#*'||company_id||'*#*'||is_approved as BOOKINGDATA, ENTRY_FORM from wo_booking_mst a, gbl_temp_engine g where a.id=g.ref_val and a.booking_type=2 and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=2 ");
				$booking_data_arr=array();
				foreach($trim_sql_data_report_sql as $val)
				{
					$booking_data_arr[$val["ID"]]=$val["BOOKINGDATA"];
                    $booking_entry_form_arr[$val["ID"]]=$val["ENTRY_FORM"];
				}
				unset($trim_sql_data_report_sql);

                $cbo_string_search_type = create_drop_down("cbo_string_search_type", 130, $string_search_type, "", 1, "-- Searching Type --",4);
				if($cbo_order_type==0 || $cbo_order_type==1)
				{
					$html.='<table width="'.$table_width.'" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="table_header_4" align="left">
						<thead>
                            <tr style="display:none;">
                                <th>'.$cbo_string_search_type.'</th>
                            </tr>
							<tr>
								<th width="30" >SL</th>
								<th width="50" >Prod. Id</th>
								<th width="80" >Trans. Date</th>
								<th width="120" >Trans. Ref.</th>';
                                if($rptType==2 || $rptType==1 )
                                {
                                    $html.='<th width="50" >File</th>';
                                }
                                if($rptType==3)
								{
									$html.='<th width="80">Issue Purposed</th>';
								}
								$html.='<th width="100" >Store Name</th>
								<th width="100" >WO/PI</th>
								<th width="40" >Year</th>
								<th width="70" >Job No</th>';
								
								if($rptType==2 || $rptType==3)
								{
									$html.='<th width="70">Int Ref</th>';
								}

								$html.='<th width="100">Style Ref. No</th>
								<th width="90">Buyer</th>
								<th width="100">Order No</th>
								<th width="120">Challan No</th>';
                                if($rptType==2 || $rptType==1 )
                                {
                                    $html.='<th width="80">Challan Date</th>';
                                }
								$html.='<th width="120">Party Name</th>
								<th width="80">Ship Date</th>
								<th width="100">Group Name</th>
								<th width="220">Description</th>
								<th width="80">RMG Color</th>
								<th width="60">RMG Size</th>';
								if($rptType==3)
								{
									$html.='<th width="100">Department</th>
									<th width="100">Section</th>';
								}

								if($rptType==2 || $rptType==1 )
								{
									$html.='<th width="80">Currency</th>
									<th width="80">Exchange Rate</th>
									<th width="80">Actual Rate</th>
									<th width="80">Receive Qty</th>
									<th width="80">Receive Return Qty</th>
									<th width="80">Actual Amt</th>';
								}
								if($rptType==3 || $rptType==1 )
								{
									$html.='<th width="80">Issue Qty</th>
									<th width="80">Issue Return Qty</th>';
								}
								$html.='<th width="80">Rate(TK)</th>
								<th width="100">Amount(TK)</th>
								<th width="50">UOM</th>';
								if($rptType==3 || $rptType==1 ){
									$html.='<th width="155">Issue To</th>';
								}
								$html.='<th width="110">User</th>
								<th width="160">Insert Time</th>
								<th>Remarks</th>
							</tr>
						</thead>
					</table>
					<div style="width:'.$div_width.'; overflow-y: scroll; max-height:230px;" id="scroll_body4">
						<table width="'.$table_width.';" class="rpt_table" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_body_4" align="left">';
							$i=1;
							$total_amount=0;
							// echo "<pre>";
							// print_r($trms_rasult_arr);die;

							foreach($trms_rasult_arr as $trans_key=>$value)
							{
								foreach($value as $order_key=>$val)
								{
									if ($i%2==0) {
                                        $bgcolor = "#E9F3FF";
                                    }else{
									    $bgcolor="#FFFFFF";
                                    }
                                    $booking_no=$booking_id=$trim_sql_data_report=$rcv_iss_num=$rcv_iss_challan=$rcv_iss_challan_date=$rcv_iss_supp="";$booking_entry_form="";
                                    $rcv_issue_qnty=0;
									if($val["transaction_type"]==1 || $val["transaction_type"]==4)
									{
										$mst_id=$receive_num_arr[$val['rec_issue_id']]["id"];
										$rcv_sys_id=$receive_num_arr[$val['rec_issue_id']]["recv_number"];
										$is_multi=$receive_num_arr[$val['rec_issue_id']]["is_multi"];
										$entry_form=$receive_num_arr[$val['rec_issue_id']]["entry_form"];
			                            $booking_no=$receive_num_arr[$val["rec_issue_id"]]["booking_no"];


                                        $booking_id=$receive_num_arr[$val["rec_issue_id"]]["booking_id"];
										$trim_sql_data_report = $booking_data_arr[$booking_id];
                                        $booking_entry_form = $booking_entry_form_arr[$booking_id];
										$remarks = $trms_rasult_arr[$val['trans_id']][$val['order_id']]['remarks'];

                                        $rcv_iss_num=$receive_num_arr[$val['rec_issue_id']]["recv_number"];
                                        $rcv_iss_challan=$receive_num_arr[$val['rec_issue_id']]["challan_no"];
                                        $rcv_iss_challan_date=$receive_num_arr[$val['rec_issue_id']]["challan_date"];
                                        $rcv_iss_supp=$supplier_arr[$receive_num_arr[$val['rec_issue_id']]["supplier_id"]];
                                        $rcv_issue_qnty=$group_arr[$val["item_group_id"]]["conversion_factor"] *$val["receive_qty"];
										$total_receive_qty+=$rcv_issue_qnty;

                                        if($booking_entry_form==87)
                                        {
                                            $trim_report_action = $trim_report_action;
                                        }
                                        else if($booking_entry_form==272)
                                        {
                                            $trim_report_action = $trim_report_action_woven;
                                        }
                                        else if($booking_entry_form==252)
                                        {
                                            $trim_report_action = $trim_report_action_sweater;
                                        }

									}
									else if($val["transaction_type"]==2 || $val["transaction_type"]==3)
									   {
										$mst_id=$issue_num_arr[$val['rec_issue_id']]["id"];
										$entry_form=$issue_num_arr[$val['rec_issue_id']]["entry_form"];
										$is_multi=2;

                                        $rcv_iss_num=$issue_num_arr[$val['rec_issue_id']]["issue_number"];
                                        $rcv_iss_challan=$issue_num_arr[$val['rec_issue_id']]["challan_no"];
                                        if($issue_num_arr[$val['rec_issue_id']]["knit_dye_source"]==1)
                                        {
                                            $rcv_iss_supp=$company_arr[$issue_num_arr[$val['rec_issue_id']]["knit_dye_company"]];
                                        }
                                        else
                                        {
                                            $rcv_iss_supp=$supplier_arr[$issue_num_arr[$val['rec_issue_id']]["knit_dye_company"]];
                                        }
                                        $rcv_issue_qnty=$group_arr[$val["item_group_id"]]["conversion_factor"] *$val["issue_qty"];
										$total_issue_qty+=$rcv_issue_qnty;
									}
									$print_btn='';
									if($entry_form==24)
									{
										$print_btn=$format_rcv_ids[0];
									}
									$html.='<tr bgcolor="'.$bgcolor.'" onClick="change_color(\'tr_'.$i.'\',\''.$bgcolor.'\')" id="tr_'.$i.'">
										<td width="30">'.$i.'</td>
										<td width="50">'.$val["prod_id"].'</td>
										<td width="80" align="center">'.change_date_format($val["transaction_date"]).'</td>
										<td width="120"  align="center"><a href="##" onClick="generate_trims_print_report(\''.$val["transaction_type"].'\',\''.$mst_id.'\',\''.$is_multi.'\',\''.$val["company_id"].'\',\''.$entry_form.'\',\''.$print_btn.'\')">'.$rcv_iss_num.'</a></td>';

                                        if($rptType==2 || $rptType==1 )
                                        {
                                            $html.='<td width="50"  align="center">';
                                                    if($val["transaction_type"]==1)
                                                    {
                                                        if($chk_file[$rcv_sys_id]!='')
                                                        {
                                                            $html.='<a href="##" onClick="openmypage_file(\''.$rcv_sys_id.'\')">File</a>';
                                                        }
                                                    }
                                            $html.='</td>';
                                        }
                                        if($rptType==3)
                                        {
                                            $html.='<td width="80"  class="wrd_brk">';
                                            if($val["transaction_type"]==2)
                                            {
                                                $html.= $yarn_issue_purpose[$issue_num_arr[$val['rec_issue_id']]["issue_purpose"]];
                                            }
                                            $html.='</td>';
                                        }
										$html.='<td width="100">'.$store_arr[$val["store_id"]].'</td>';
										
                                        if($booking_no != "")
                                        {
                                            if( $val["receive_basis"] == 1 ){ //pi
                                                $html.='<td width="100"  class="wrd_brk" align="center"><a href="javascript:void(0)" onClick="pi_report_generate('.$booking_id.')">'.$booking_no.'</a></td>';
                                            }
                                            else if( $val["receive_basis"] == 2){ //wo
                                                $html.='<td width="100"  class="wrd_brk"  align="center"><a href="javascript:void(0)" onClick="generate_trim_report(\''.$trim_sql_data_report.'\', '.$trim_report_type.',\''.$trim_report_action.'\',\''.$booking_entry_form.'\')">'.$booking_no.'</a></td>';
                                            }
                                            else if(  $val["receive_basis"] == 7){ //req
                                                $html.='<td width="100"  class="wrd_brk" align="center"><a href="javascript:void(0)" onClick="req_report_generate('.$reqReportFormat.','.$booking_id.','.str_replace("'","",$cbo_company_name).',\'\',1,'.$req_location_arr[$booking_id].')">'.$booking_no.'</a></td>';
                                            }
                                            else{
                                                $html.='<td width="100"  class="wrd_brk" align="center">'.$booking_no.'</td>';
                                            }
                                        }else{
                                            $html.='<td width="100"  class="wrd_brk" align="center">'.$booking_no.'</td>';
                                        }
                                        $html.='<td width="40" align="center">'.date('Y',strtotime($val["job_year"])).'</td>
										<td width="70" align="center">'.$val["job_no"].'</td>';

										if($rptType==2 || $rptType==3 )
                                        {
                                            $html.='<td width="70" class="wrd_brk">'.$val['grouping'].'</td>';
                                        }

										$html.='<td width="100" class="wrd_brk">'.$val["style_ref_no"].'</td>
										<td width="90">'.$buyer_short_arr[$val["buyer_name"]].'</td>
										<td width="100" class="wrd_brk" align="center">'.$val["po_number"].'</td>
										<td width="120" class="wrd_brk">'.$rcv_iss_challan.'</td>';
                                        if($rptType==2 || $rptType==1 )
                                        {
                                            $html.='<td width="80" class="wrd_brk">'.$rcv_iss_challan_date.'</td>';
                                        }
                                        $html.='<td width="120">'.$rcv_iss_supp.'</td>
										<td width="80" align="center">'.change_date_format($val["shipment_date"]).'</td>
										<td width="100">'.$group_arr[$val["item_group_id"]]["item_name"].'</td>
										<td width="220" class="wrd_brk">'.$val["product_name_details"].'</td>
										<td width="80" class="wrd_brk">'.$color_arr[$val["color"]].'</td>
										<td width="60">'.$size_arr[$val["gmts_size"]].'</td>';
										if($rptType==3)
										{
											$html.='<td width="100" align="center">'.$department_arr[$val["department_id"]].'</td>
											<td width="100" align="center">'.$section_arr[$val["section_id"]].'</td>';
										}
										if($rptType==2 || $rptType==1 )
										{

                                            $rcv_cur=$rcv_ex_rate=$rcv_order_rate='';
                                            $order_amt=0;
                                            if($val["transaction_type"]==1)
                                            {
                                                $rcv_cur= $currency[$receive_num_arr[$val['rec_issue_id']]["currency_id"]];
                                                $rcv_ex_rate= number_format($receive_num_arr[$val['rec_issue_id']]["exchange_rate"],2);
                                                $rcv_order_rate=  number_format($val["order_rate"],2);
                                                $order_amt=$val["receive_qty"]*$val["order_rate"];
                                                $total_order_amt+=$order_amt;
                                            }
                                            $receive_ret_qty = $group_arr[$val["item_group_id"]]["conversion_factor"]*$val["receive_ret_qty"];
											$tot_receive_ret_qty+=$receive_ret_qty;
											$html.='<td width="80" align="center">'.$rcv_cur.'</td>
											<td width="80" align="right">'.$rcv_ex_rate.'</td>
											<td width="80" align="right">'.$rcv_order_rate.'</td>
											<td width="80" align="right">'.number_format($rcv_issue_qnty,2,".","").'</td>
											<td width="80" align="right">'.number_format($receive_ret_qty,2,".","").'</td>
											<td width="80" align="right">'.number_format($order_amt,4,".","").'</td>';
										}
										if($rptType==3 || $rptType==1 )
										{
                                            $issue_ret_qty = $group_arr[$val["item_group_id"]]["conversion_factor"] *$val["issue_ret_qty"];
											$tot_issue_ret_qty+=$issue_ret_qty;
											$html.='<td width="80" align="right">'.number_format($rcv_issue_qnty,2,".","").'</td>
											<td width="80" align="right">'.number_format($issue_ret_qty,2,".","").'</td>';
										}
                                        if($rcv_issue_qnty == 0){
                                            $val["cons_rate"] = 0;
                                        }
                                        $amount=$rcv_issue_qnty*$val["cons_rate"];
										$total_amount=$total_amount+$amount;
										$html.='<td width="80" align="right">'.number_format($val["cons_rate"],4,".","").'</td>
										<td width="100" align="right">'.number_format($amount,2,".","").'</td>
										<td width="50">'.$unit_of_measurement[$val["cons_uom"]].'</td>';
										if($rptType==3 || $rptType==1 )
                                        {
                                            $html.='<td width="155">'.$company_arr[$val["issue_to"]].'</td>';
                                        }
										$html.='<td width="110">'.$user_name_arr[$val["inserted_by"]].'</td>
										<td width="160">'.change_date_format($val["insert_date"])." ".$val["insert_time"].'</td>
										<td>'.$remarks.'</td>
									</tr>';
									$i++;
								}
							}
							$html.='</tbody>
						</table>
					 <table width="'.$table_width.'" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="report_table_footer" align="left">
							<tfoot>
								<tr>
									<th width="30">&nbsp;</th>
									<th width="50">&nbsp;</th>
									<th width="80">&nbsp;</th>
									<th width="120">&nbsp;</th>';
                                    if($rptType==2 || $rptType==1 )
                                    {
										$html.='<th width="50">&nbsp;</th>';
									}
                                    if($rptType==3)
                                    {
										$html.='<th width="80">&nbsp;</th>';
									}
									$html.='<th width="100">&nbsp;</th>
									<th width="100">&nbsp;</th>
									<th width="40">&nbsp;</th>
									<th width="70">&nbsp;</th>';

									if($rptType==2 || $rptType==3 )
									{
										$html.='<th width="70">&nbsp;</th>';
									}
									
									$html.='<th width="100">&nbsp;</th>
									<th width="90">&nbsp;</th>
									<th width="100">&nbsp;</th>
									<th width="120">&nbsp;</th>';
                                    if($rptType==2 || $rptType==1 )
                                    {
                                        $html.='<th width="80">&nbsp;</th>';
                                    }
                                    $html.='<th width="120">&nbsp;</th>
									<th width="80">&nbsp;</th>
									<th width="100">&nbsp;</th>
									<th width="220">&nbsp;</th>
									<th width="80">&nbsp;</th>
									<th width="60">&nbsp; </th>';
									if($rptType==3)
									{
										$html.='<th width="100">&nbsp;</th>
										<th width="100">Total:</th>';
									}
									if($rptType==2 || $rptType==1 )
									{
										$html.='<th width="80" >&nbsp;</th>
										<th width="80" >&nbsp;</th>
										<th width="80" >Total:</th>
										<th width="80" id="value_total_receive_qty_a_overwrite">'.number_format($total_receive_qty,2).'</th>
										<th width="80" align="right" id="val_tot_receive_ret_qty_a_overwrite">'.number_format($tot_receive_ret_qty,2).'</th>
										<th width="80" id="value_total_order_amt_a_overwrite">'.number_format($total_order_amt,2).'</th>';
									}
									if($rptType==3 || $rptType==1 )
									{
										$html.='<th width="80" id="value_total_issue_qty_a_overwrite">'.number_format($total_issue_qty,2).'</th>
										<th width="80" align="right" id="val_tot_issue_ret_qty_a_overwrite">'.number_format($tot_issue_ret_qty,2).'</th>';
									}
									$html.='<th width="80"></th>
									
									<th width="100" id="value_total_amount_a_overwrite">'.number_format($total_amount,2).'</th>
									<th width="50">&nbsp;</th>';
									if($rptType==3 || $rptType==1 )
									{
                                        $html.='<th width="150">&nbsp;</th>';
                                    }
									$html.='<th width="110">&nbsp;</th>
									<th width="160">&nbsp;</th>
									<th>&nbsp;</th>
								</tr>
							</tfoot>
					   </table>
					 </div>
					 <br />';
				}
				if($cbo_order_type==0 || $cbo_order_type==2)
				{
					$html.='<table width="<? echo $table_width_non_order; ?>" id="table_header_3" align="left">
						<tr>
							<td colspan="'.$col_span_non_order.'"> <span style="font-weight:bold; font-size:16px;">Non Order Item</span></td>
						</tr>
					</table>
					<table width="'.$table_width_non_order.'" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="table_header_3" align="left">
						<thead>
							<tr>
								<th width="30" >SL</th>
								<th width="50" >Prod. Id</th>
								<th width="80" >Trans. Date</th>
								<th width="120" >Trans. Ref.</th>
								<th width="100" >Store Name</th>';

                                if($rptType==3)
								{
									$html.='<th width="80">Issue Purposed</th>';
								}


                                $html.='<th width="110">WO Num</th>
								<th width="100">Challan No</th>
								<th width="80">Challan Date</th>
								<th width="120">Party Name</th>
								<th width="100">Group Name</th>
								<th width="220">Description</th>
								<th width="80">RMG Color</th>
								<th width="60">RMG Size</th>';
								if($rptType==3)
								{
									$html.='<th width="100">Department</th>
									<th width="100">Section</th>';
								}
								if($rptType==2 || $rptType==1 )
								{
                                    $html.='<th width="80">Receive Qty</th>';
								}
								if($rptType==3 || $rptType==1 )
								{
                                    $html.='<th width="80">Issue Qty </th>';
								}
                                $html.='<th width="80">Rate(TK)</th>
								<th width="100">Amount(TK)</th>
								<th width="48">UOM</th>
								<th width="110">User</th>
								<th width="160">Insert Time</th>
							</tr>
						</thead>
							<tbody id="filter_grid_1">';
							$j=1;
							$non_order_amount=0;
							foreach($trms_non_order_arr as $trans_key=>$val)
							{
								if ($i%2==0)
								$bgcolor="#E9F3FF";
								else
								$bgcolor="#FFFFFF";
                                $booking_no=$booking_id=$rcv_iss_no=$rcv_iss_challan=$rcv_iss_challan_date=$rcv_iss_supp="";
								if($val["transaction_type"]==1 || $val["transaction_type"]==4)
								{
									$mst_id=$receive_num_arr[$val['rec_issue_id']]["id"];
									$is_multi=$receive_num_arr[$val['rec_issue_id']]["is_multi"];
									$entry_form=$receive_num_arr[$val['rec_issue_id']]["entry_form"];
                                    $booking_no = $val['booking_no'];
                                    $booking_id = $val['booking_id'];
                                    if($val["receive_basis"] == 2)
									{
                                        if ($stationary_format_ids[0] == 66)
										{
                                            $report_data = $cbo_company_name . '*' . $non_ord_data_arr[$booking_id]["WO_NUMBER"] . '*' . $non_ord_data_arr[$booking_id]["ITEM_CATEGORY_ID"] . '*' . $non_ord_data_arr[$booking_id]["SUPPLIER_ID"] . '*' . change_date_format($non_ord_data_arr[$booking_id]["WO_DATE"]) . '*' . $non_ord_data_arr[$booking_id]["CURRENCY_ID"] . '*' . $non_ord_data_arr[$booking_id]["WO_BASIS_ID"] . '*' . $non_ord_data_arr[$booking_id]["PAY_MODE"] . '*' . $non_ord_data_arr[$booking_id]["SOURCE"] . '*' . change_date_format($non_ord_data_arr[$booking_id]["DELIVERY_DATE"]) . '*' . $non_ord_data_arr[$booking_id]["ATTENTION"] . '*****' . $booking_id . '*Stationary Purchase Order*' . $non_ord_data_arr[$booking_id]["LOCATION_ID"] . '*1';
                                            $report_action = "stationary_work_order_print";
                                        } elseif ($stationary_format_ids[0] == 85) {
                                            $report_data = $cbo_company_name . '*' . $non_ord_data_arr[$booking_id]["WO_NUMBER"] . '*' . $non_ord_data_arr[$booking_id]["ITEM_CATEGORY_ID"] . '*' . $non_ord_data_arr[$booking_id]["SUPPLIER_ID"] . '*' . change_date_format($non_ord_data_arr[$booking_id]["WO_DATE"]) . '*' . $non_ord_data_arr[$booking_id]["CURRENCY_ID"] . '*' . $non_ord_data_arr[$booking_id]["WO_BASIS_ID"] . '*' . $non_ord_data_arr[$booking_id]["PAY_MODE"] . '*' . $non_ord_data_arr[$booking_id]["SOURCE"] . '*' . change_date_format($non_ord_data_arr[$booking_id]["DELIVERY_DATE"]) . '*' . $non_ord_data_arr[$booking_id]["ATTENTION"] . '*****' . $booking_id . '*Stationary Purchase Order*' . $non_ord_data_arr[$booking_id]["LOCATION_ID"] . '*1';
                                            $report_action = "stationary_work_order_print3";
                                        } elseif ($stationary_format_ids[0] == 129) {
                                            $report_data = $cbo_company_name . '*' . $non_ord_data_arr[$booking_id]["WO_NUMBER"] . '*' . $non_ord_data_arr[$booking_id]["ITEM_CATEGORY_ID"] . '*' . $non_ord_data_arr[$booking_id]["SUPPLIER_ID"] . '*' . change_date_format($non_ord_data_arr[$booking_id]["WO_DATE"]) . '*' . $non_ord_data_arr[$booking_id]["CURRENCY_ID"] . '*' . $non_ord_data_arr[$booking_id]["WO_BASIS_ID"] . '*' . $non_ord_data_arr[$booking_id]["PAY_MODE"] . '*' . $non_ord_data_arr[$booking_id]["SOURCE"] . '*' . change_date_format($non_ord_data_arr[$booking_id]["DELIVERY_DATE"]) . '*' . $non_ord_data_arr[$booking_id]["ATTENTION"] . '*****' . $booking_id . '*Stationary Purchase Order*' . $non_ord_data_arr[$booking_id]["LOCATION_ID"] . '*1';
                                            $report_action = "stationary_work_order_print5";
                                        } elseif ($stationary_format_ids[0] == 137) {
                                            $report_data = $cbo_company_name . '*' . $non_ord_data_arr[$booking_id]["WO_NUMBER"] . '*' . $non_ord_data_arr[$booking_id]["ITEM_CATEGORY_ID"] . '*' . $non_ord_data_arr[$booking_id]["SUPPLIER_ID"] . '*' . change_date_format($non_ord_data_arr[$booking_id]["WO_DATE"]) . '*' . $non_ord_data_arr[$booking_id]["CURRENCY_ID"] . '*' . $non_ord_data_arr[$booking_id]["WO_BASIS_ID"] . '*' . $non_ord_data_arr[$booking_id]["PAY_MODE"] . '*' . $non_ord_data_arr[$booking_id]["SOURCE"] . '*' . change_date_format($non_ord_data_arr[$booking_id]["DELIVERY_DATE"]) . '*' . $non_ord_data_arr[$booking_id]["ATTENTION"] . '*****' . $booking_id . '*Stationary Purchase Order*' . $non_ord_data_arr[$booking_id]["LOCATION_ID"] . '*1';
                                            $report_action = "stationary_work_order_print4";
                                        } elseif ($stationary_format_ids[0] == 430) {
                                            $report_data = $cbo_company_name . '*' . $booking_id . '*Stationary Purchase Order*' . $non_ord_data_arr[$booking_id]["WO_NUMBER"] . '*1';
                                            $report_action = "stationary_work_order_po_print2";
                                        } elseif ($stationary_format_ids[0] == 732) {
                                            $report_data = $cbo_company_name . '*' . $non_ord_data_arr[$booking_id]["WO_NUMBER"] . '*' . $non_ord_data_arr[$booking_id]["ITEM_CATEGORY_ID"] . '*' . $non_ord_data_arr[$booking_id]["SUPPLIER_ID"] . '*' . change_date_format($non_ord_data_arr[$booking_id]["WO_DATE"]) . '*' . $non_ord_data_arr[$booking_id]["CURRENCY_ID"] . '*' . $non_ord_data_arr[$booking_id]["WO_BASIS_ID"] . '*' . $non_ord_data_arr[$booking_id]["PAY_MODE"] . '*' . $non_ord_data_arr[$booking_id]["SOURCE"] . '*' . change_date_format($non_ord_data_arr[$booking_id]["DELIVERY_DATE"]) . '*' . $non_ord_data_arr[$booking_id]["ATTENTION"] . '*****' . $booking_id . '*Stationary Purchase Order*' . $non_ord_data_arr[$booking_id]["LOCATION_ID"] . '*1';
                                            $report_action = "stationary_work_order_po_print";
                                        } elseif ($stationary_format_ids[0] == 134) {
                                            $report_data = $cbo_company_name . '*' . $non_ord_data_arr[$booking_id]["WO_NUMBER"] . '*' . $non_ord_data_arr[$booking_id]["ITEM_CATEGORY_ID"] . '*' . $non_ord_data_arr[$booking_id]["SUPPLIER_ID"] . '*' . change_date_format($non_ord_data_arr[$booking_id]["WO_DATE"]) . '*' . $non_ord_data_arr[$booking_id]["CURRENCY_ID"] . '*' . $non_ord_data_arr[$booking_id]["WO_BASIS_ID"] . '*' . $non_ord_data_arr[$booking_id]["PAY_MODE"] . '*' . $non_ord_data_arr[$booking_id]["SOURCE"] . '*' . change_date_format($non_ord_data_arr[$booking_id]["DELIVERY_DATE"]) . '*' . $non_ord_data_arr[$booking_id]["ATTENTION"] . '*****' . $booking_id . '*Stationary Purchase Order*' . $non_ord_data_arr[$booking_id]["LOCATION_ID"] . '*1';
                                            $report_action = "stationary_work_print";
                                        } else {
                                            $report_data = $cbo_company_name . '*' . $non_ord_data_arr[$booking_id]["WO_NUMBER"] . '*' . $non_ord_data_arr[$booking_id]["ITEM_CATEGORY_ID"] . '*' . $non_ord_data_arr[$booking_id]["SUPPLIER_ID"] . '*' . change_date_format($non_ord_data_arr[$booking_id]["WO_DATE"]) . '*' . $non_ord_data_arr[$booking_id]["CURRENCY_ID"] . '*' . $non_ord_data_arr[$booking_id]["WO_BASIS_ID"] . '*' . $non_ord_data_arr[$booking_id]["PAY_MODE"] . '*' . $non_ord_data_arr[$booking_id]["SOURCE"] . '*' . change_date_format($non_ord_data_arr[$booking_id]["DELIVERY_DATE"]) . '*' . $non_ord_data_arr[$booking_id]["ATTENTION"] . '*****' . $booking_id . '*Stationary Purchase Order*' . $non_ord_data_arr[$booking_id]["LOCATION_ID"] . '*1';
                                            $report_action = "stationary_work_print";
                                        }

                                        $report_path = "../../commercial/work_order/requires/stationary_work_order_controller";
                                    }

                                    $rcv_iss_no=$receive_num_arr[$val['rec_issue_id']]["recv_number"];
                                    $rcv_iss_challan=$receive_num_arr[$val['rec_issue_id']]["challan_no"];
                                    $rcv_iss_challan_date=$receive_num_arr[$val['rec_issue_id']]["challan_date"];
                                    $rcv_iss_supp=$supplier_arr[$receive_num_arr[$val['rec_issue_id']]["supplier_id"]];
								}
								else if($val["transaction_type"]==2 || $val["transaction_type"]==3)
								{
									$mst_id=$issue_num_arr[$val['rec_issue_id']]["id"];
									$is_multi=2;
									$entry_form=$issue_num_arr[$val['rec_issue_id']]["entry_form"];

                                    $rcv_iss_no=$issue_num_arr[$val['rec_issue_id']]["issue_number"];
                                    $rcv_iss_challan=$issue_num_arr[$val['rec_issue_id']]["challan_no"];
                                    if($issue_num_arr[$val['rec_issue_id']]["knit_dye_source"]==1)
                                    {
                                        $rcv_iss_supp=$company_arr[$issue_num_arr[$val['rec_issue_id']]["knit_dye_company"]];
                                    }
                                    else
                                    {
                                        $rcv_iss_supp=$supplier_arr[$issue_num_arr[$val['rec_issue_id']]["knit_dye_company"]];
                                    }
								}
								$print_btn='';
								if($entry_form==24)
								{
									$print_btn=$format_rcv_ids[0];
								}
								$html.='<tr bgcolor="'.$bgcolor.'" onClick="change_color(\'tr_'.$i.'\',\''.$bgcolor.'\')" id="tr_'.$i.'">
									<td width="30">'.$j.'</td>
									<td width="50">'.$val["prod_id"].'</td>
									<td width="80" align="center">'.change_date_format($val["transaction_date"]).'</td>
									<td width="120" align="center"><a href="##" onClick="generate_trims_print_report(\''.$val["transaction_type"].'\',\''.$mst_id.'\',\''.$is_multi.'\',\''.$val["company_id"].'\',\''.$entry_form.'\',\''.$print_btn.'\')">'.$rcv_iss_no.'</a></td>
									<td width="100">'.$store_arr[$val["store_id"]].'</td>';

									if($rptType==3)
									{
										$html.='<td width="80">';
										// if($val["transaction_type"]==2)
										// {
											$html.= $yarn_issue_purpose[$issue_num_arr[$val['rec_issue_id']]["issue_purpose"]];
										//}
										$html.='</td>';
									}

                                    if($booking_no != ""){
                                        if( $val["receive_basis"] == 1 ){ //pi
                                            $html.='<td width="110"  align="center"><a href="javascript:void(0)" onClick="pi_report_generate('.$booking_id.')">'.$booking_no.'</a></td>';
                                        }
                                        else if( $val["receive_basis"] == 2){ //wo
                                            $html.='<td width="110"  align="center"><a href="javascript:void(0)" onClick="print_report(\''.$report_data.'\',\''.$report_action.'\',\''.$report_path.'\')">'.$booking_no.'</a></td>';
                                        }
                                        else if(  $val["receive_basis"] == 7){ //req
                                            $html.='<td width="110"  align="center"><a href="javascript:void(0)" onClick="req_report_generate('.$reqReportFormat.','.$booking_id.','.str_replace("'","",$cbo_company_name).',\'\',1,'.$req_location_arr[$booking_id].')">'.$booking_no.'</a></td>';
                                        }
                                        else{
                                            $html.='<td width="110" align="center">'.$booking_no.'</td>';
                                        }
                                    }else{
                                        $html.='<td width="110"  align="center">'.$booking_no.'</td>';
                                    }
									$html.='<td width="100">'.$rcv_iss_challan.'</td>
                                    <td width="80">'.$rcv_iss_challan_date.'</td>
									<td width="120">'.$rcv_iss_supp.'</td>
									<td width="100">'.$group_arr[$val["item_group_id"]]["item_name"].'</td>
									<td width="220">'.$val["product_name_details"].'</td>
									<td width="80">'.$color_arr[$val["color"]].'</td>
									<td width="60">'.$size_arr[$val["gmts_size"]].'</td>';
									if($rptType==3)
									{
										$html.='<td width="100" align="center">'.$department_arr[$val["department_id"]].'</td>
										<td width="100" align="center">'.$section_arr[$val["section_id"]].'</td>';
									}
									if($rptType==2 || $rptType==1 )
									{
                                        $rcv_issue_qnty=$val["receive_qty"];
                                        $total_receive_qty_non_order+=$val["receive_qty"];
										$html.='<td width="80" align="right">'.number_format($val["receive_qty"],2,".","").'</td>';
									}
									if($rptType==3 || $rptType==1 )
									{
                                        $rcv_issue_qnty=$val["issue_qty"];
                                        $total_issue_qty_non_order+=$val["issue_qty"];
										$html.='<td width="80" align="right">'.number_format($val["issue_qty"],2,".","").'</td>';
									}
                                    if($rcv_issue_qnty == 0){
                                        $val["cons_rate"] = 0;
                                    }
                                    $amount=$rcv_issue_qnty*$val["cons_rate"];
									$total_amount_non_order+=$amount;
									$html.='<td width="80" align="right">'.number_format($val["cons_rate"],4,".","").'</td>
									<td width="100" align="right">'.number_format($amount,2,".","").'</td>
									<td width="48">'.$unit_of_measurement[$val["cons_uom"]].'</td>
									<td width="110">'.$user_name_arr[$val["inserted_by"]].'</td>
									<td width="160">'.change_date_format($val["insert_date"])." ".$val["insert_time"].'</td>
								</tr>';
								$non_order_amount=$amount+$non_order_amount;
								$i++;$j++;
							}
							$html.='</tbody>
						</table>
					 <table width="'.$table_width_non_order.'" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="report_table_footer" align="left">
							<tfoot>
								<tr>
									<th width="30">&nbsp;</th>
									<th width="50">&nbsp;</th>
									<th width="80">&nbsp;</th>
									<th width="120">&nbsp;</th>
									<th width="100">&nbsp;</th>';
									if($rptType==3)
									{
										$html.='<th width="80">&nbsp;</th>';
									}
				
									$html.='<th width="110">&nbsp;</th>
									<th width="100">&nbsp;</th>
									<th width="80">&nbsp;</th>

									
									<th width="120">&nbsp;</th>
									<th width="100">&nbsp;</th>
									<th width="220">&nbsp;</th>
									<th width="80">&nbsp;</th>
									<th width="60">';
                                    if($rptType==3) $html.='Total:';
                                    $html.='</th>';
									if($rptType==3)
									{
										$html.='<th width="100">&nbsp;</th>
                                        <th width="100">&nbsp;</th>';
									}
									if($rptType==2 || $rptType==1 )
									{
										$html.='<th width="80" id="value_total_receive_qty_non_order">&nbsp;'.number_format($total_receive_qty_non_order,2).'</th>';
									}
									if($rptType==3 || $rptType==1 )
									{
										$html.='<th width="80" id="value_total_issue_qty_non_order">&nbsp'.number_format($total_issue_qty_non_order,2).'</th>';
									}
									$html.='<th width="80"></th>
									<th width="100" id="value_total_amount_non_order">'.number_format($total_amount_non_order,2).'</th>
									<th width="48">&nbsp;</th>
									<th width="110">&nbsp;</th>
									<th width="160">&nbsp;</th>
								</tr>
							</tfoot>
					   </table>';
				}
            $html.='</div>';
		}
		else
		{
			$show_html_4 = 0;
		}
	}

	if(($key = array_search(2, $cbo_item_cat)) !== false) //if($cbo_item_cat==2)
	{
        unset($cbo_item_cat[$key]);
		$composition_arr=array();
		$construction_arr=array();
		$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0";
		$data_array=sql_select($sql_deter);
		if(count($data_array)>0)
		{
			foreach( $data_array as $row )
			{
				if(array_key_exists($row[csf('id')],$construction_arr))
				{
					$construction_arr[$row[csf('id')]]=$construction_arr[$row[csf('id')]];
				}
				else
				{
					$construction_arr[$row[csf('id')]]=$row[csf('construction')];
				}
				if(array_key_exists($row[csf('id')],$composition_arr))
				{
					$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]];
				}
				else
				{
					$composition_arr[$row[csf('id')]]=$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
				}
			}
		}

		if($rptType==3)
		{
			if($cbo_order_type==2)
			{
				$scroll_div="scroll_body";
				$scroll_div_width="1630px";
				$table_width=1610;
			}
			else
			{
				$scroll_div="";
				$scroll_div_width="2100px";
				$table_width=2080;
			}
		}
		else
		{
			if($cbo_order_type==2)
			{
				$scroll_div="scroll_body";
				$scroll_div_width="1430px";
				$table_width=1410;
			}
			else
			{
				$scroll_div="";
				$scroll_div_width="1900px";
				$table_width=1880;
			}
		}

		if($cbo_order_type==0 || $cbo_order_type==1)
		{

			$buyer_cond="";
			if($cbo_buyer_name>0) $buyer_cond=" and a.buyer_name=$cbo_buyer_name";

			if($rptType==1)
			{
				$sql="SELECT a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.pi_wo_batch_no, a.batch_id_from_fissuertn, a.rack,a.STORE_ID,b.quantity,b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, a.batch_lot, a.stitch_length,a.yarn_count, b.is_sales
				from inv_transaction a, order_wise_pro_details b
				where a.id=b.trans_id and a.item_category=2 and a.company_id=$cbo_company_name $date_cond $sql_cond and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.entry_form in (7,14,15,37,18,46,66,68,71,52) $transaction_ids_cond_for_mrr order by a.transaction_date, a.id";
			}
			else if($rptType==2)
			{
				$sql="SELECT a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.pi_wo_batch_no, a.batch_id_from_fissuertn, a.rack,a.STORE_ID, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, a.stitch_length,a.yarn_count, b.is_sales
				from inv_transaction a, order_wise_pro_details b
				where a.id=b.trans_id and a.item_category=2 and a.transaction_type in(1,4,5,3) and b.trans_type in(1,4,5,3) and a.company_id=$cbo_company_name $date_cond $sql_cond and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.entry_form in (7,14,37,15,66,68,46) $transaction_ids_cond_for_mrr order by a.transaction_date, a.id";
			}
			else if($rptType==3)
			{
				$sql="SELECT a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.pi_wo_batch_no, a.batch_id_from_fissuertn, a.rack,a.STORE_ID, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, a.stitch_length,a.yarn_count, b.is_sales, a.department_id, a.section_id
				from inv_transaction a, order_wise_pro_details b
				where a.id=b.trans_id and a.item_category=2 and a.transaction_type in(2,3,6,4) and b.trans_type in(2,3,6,4) and a.company_id=$cbo_company_name $date_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in (15,14,18,46,71,52) $sql_cond $transaction_ids_cond_for_mrr order by a.transaction_date, a.id";
			}
            //			echo $sql;

			$result_2=sql_select($sql);
			$sales_orderids_arr=array();
            $orderids_arr=array();
            $batch_ids_arr=array();
            $prod_ids_arr=array();
            $batch_arr=array();
            $sales_data_arr=array();
            $receive_ids_arr=array();
            $issue_ids_arr=array();
            $transfer_ids_arr=array();
			foreach($result_2 as $rows)
			{
				if($rows[csf("order_id")]>0) {
                    if ($rows[csf("is_sales")]==1) $sales_orderids_arr[$rows[csf("order_id")]]=$rows[csf("order_id")];
                    else $orderids_arr[$rows[csf("order_id")]]=$rows[csf("order_id")];
                }
                if($rows[csf("pi_wo_batch_no")]>0) $batch_ids_arr[$rows[csf("pi_wo_batch_no")]]=$rows[csf("pi_wo_batch_no")];
                if($rows[csf("prod_id")]>0) $prod_ids_arr[$rows[csf("prod_id")]]=$rows[csf("prod_id")];

                if ($rows[csf("transaction_type")]==1 || $rows[csf("transaction_type")]==4){
                    $receive_ids_arr[$rows[csf("mst_id")]]=$rows[csf("mst_id")];
                } else if ($rows[csf("transaction_type")]==2 || $rows[csf("transaction_type")]==3) {
                    $issue_ids_arr[$rows[csf("mst_id")]]=$rows[csf("mst_id")];
                } else $transfer_ids_arr[$rows[csf("mst_id")]]=$rows[csf("mst_id")];

			}

            if (count($sales_orderids_arr)>0)
			{
				if($db_type==0) $selected_year="year(a.insert_date) as job_year";
                else $selected_year="to_char(a.insert_date,'YYYY') as job_year";

                fnc_tempengine("gbl_temp_engine", $user_id, 33, 1, $sales_orderids_arr, $empty_arr);

				$sql_sales_query="SELECT a.id, a.job_no, a.sales_booking_no, a.within_group, a.buyer_id, a.style_ref_no, a.booking_without_order, $selected_year from fabric_sales_order_mst a, gbl_temp_engine g where a.id=g.ref_val and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=1";//die;

				$sql_sales_data=sql_select($sql_sales_query);
				foreach($sql_sales_data as $row)
				{
					$sales_data_arr[$row[csf("id")]]['job_no']=$row[csf("job_no")];
					$sales_data_arr[$row[csf("id")]]['sales_booking_no']=$row[csf("sales_booking_no")];
					$sales_data_arr[$row[csf("id")]]['within_group']=$row[csf("within_group")];
					$sales_data_arr[$row[csf("id")]]['buyer_id']=$row[csf("buyer_id")];
					$sales_data_arr[$row[csf("id")]]['style_ref_no']=$row[csf("style_ref_no")];
					$sales_data_arr[$row[csf("id")]]['job_year']=$row[csf("job_year")];
                }
                unset($sql_sales_data);
			}

            $job_order_data=array();
            if (count($orderids_arr)>0)
			{

                fnc_tempengine("gbl_temp_engine", $user_id, 33, 13, $orderids_arr, $empty_arr);

				$sql_job_query="SELECT a.job_no_prefix_num as JOB_NO, $select_year(a.insert_date $year_con) as JOB_YEAR, a.buyer_name as BUYER_NAME, a.style_ref_no as STYLE_REF_NO, b.id as ID, b.grouping as REF_NO, b.file_no as FILE_NO, b.po_number as PO_NUMBER, b.shipment_date as SHIPMENT_DATE from wo_po_details_master a, wo_po_break_down b, gbl_temp_engine g where a.id=b.job_id and b.id=g.ref_val and a.is_deleted=0 and b.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=13 and a.company_name=$cbo_company_name $buyer_cond";//die;

				$sql_job_data=sql_select($sql_job_query);
				foreach($sql_job_data as $row)
				{
					$job_order_data[$row["ID"]][1]=$row["JOB_NO"];
                    $job_order_data[$row["ID"]][2]=$row["JOB_YEAR"];
                    $job_order_data[$row["ID"]][3]=$row["BUYER_NAME"];
                    $job_order_data[$row["ID"]][4]=$row["PO_NUMBER"];
                    $job_order_data[$row["ID"]][5]=$row["SHIPMENT_DATE"];
                    $job_order_data[$row["ID"]][6]=$row["STYLE_REF_NO"];
                    $job_order_data[$row["ID"]][7]=$row["REF_NO"];
                    $job_order_data[$row["ID"]][8]=$row["FILE_NO"];
                }
                unset($sql_job_data);
			}

            if (count($batch_ids_arr)>0)
			{
                fnc_tempengine("gbl_temp_engine", $user_id, 33, 3, $batch_ids_arr, $empty_arr);
				$sql_batch_res=sql_select("SELECT a.ID, a.BATCH_NO from pro_batch_create_mst a, gbl_temp_engine g where a.id=g.ref_val and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=3");//die;
				foreach($sql_batch_res as $row)
				{
					$batch_arr[$row["ID"]]=$row["BATCH_NO"];
                }
                unset($sql_batch_res);
			}
		}
		if($cbo_order_type==0 || $cbo_order_type==2) // Non Order Item
		{
			if($rptType==1)
			{
					$sql_non_order_2="SELECT a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.rack, a.inserted_by, $select_insert_date, a.cons_quantity as qty, a.prod_id, b.batch_no,a.STORE_ID from pro_batch_create_mst b, inv_transaction a where b.id=case when a.transaction_type in(1,2) then a.pi_wo_batch_no when a.transaction_type in(3,4) then a.batch_id_from_fissuertn end and a.item_category=2 and b.booking_without_order=1 and a.transaction_type in(1,2,3,4) and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr and a.status_active=1 and a.is_deleted=0 order by a.transaction_date, a.id";
			}
			else if($rptType==2)
			{
					$sql_non_order_2="SELECT a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.rack, a.inserted_by, $select_insert_date, a.cons_quantity as qty, a.prod_id, b.batch_no,a.STORE_ID from pro_batch_create_mst b, inv_transaction a where b.id=case when a.transaction_type in(1) then a.pi_wo_batch_no when a.transaction_type in(4) then a.batch_id_from_fissuertn end and a.item_category=2 and b.booking_without_order=1 and a.transaction_type in(1,4) and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr and a.status_active=1 and a.is_deleted=0 order by a.transaction_date, a.id";
			}
			else if($rptType==3)
			{
					$sql_non_order_2="SELECT a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.rack, a.inserted_by, $select_insert_date, a.cons_quantity as qty, a.prod_id, b.batch_no, a.department_id, a.section_id,a.STORE_ID
					from pro_batch_create_mst b, inv_transaction a where b.id=case when a.transaction_type in(2) then a.pi_wo_batch_no when a.transaction_type in(3) then a.batch_id_from_fissuertn end and a.item_category=2 and b.booking_without_order=1 and a.transaction_type in(2,3) and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr and a.status_active=1 and a.is_deleted=0 order by a.transaction_date, a.id";
			}
		}
		//echo $sql;//die;

		$result_non_order_2=sql_select($sql_non_order_2);
        foreach ($result_non_order_2 as $row)
        {
            if ($row[csf('prod_id')]>0) $prod_ids_arr[$row[csf("prod_id")]]=$row[csf("prod_id")];

            if ($row[csf("transaction_type")]==1 || $row[csf("transaction_type")]==4){
                $receive_ids_arr[$row[csf("mst_id")]]=$row[csf("mst_id")];
            } else if ($row[csf("transaction_type")]==2 || $row[csf("transaction_type")]==3) {
                $issue_ids_arr[$row[csf("mst_id")]]=$row[csf("mst_id")];
            } else $transfer_ids_arr[$row[csf("mst_id")]]=$row[csf("mst_id")];
        }

        $product_arr=array();
        if (count($prod_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 4, $prod_ids_arr, $empty_arr);
            $sql_product_res=sql_select("SELECT a.ID, a.DETARMINATION_ID, a.GSM, a.DIA_WIDTH, a.COLOR from product_details_master a, gbl_temp_engine g where a.id=g.ref_val and a.item_category_id=2 and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=4");//die;
            foreach($sql_product_res as $row)
            {
                $product_arr[$row["ID"]][1]=$row['DETARMINATION_ID'];
                $product_arr[$row["ID"]][2]=$row['GSM'];
                $product_arr[$row["ID"]][3]=$row['DIA_WIDTH'];
                $product_arr[$row["ID"]][4]=$row['COLOR'];
            }
            unset($sql_product_res);
        }

        $receive_num_arr=array();
        $nonOrderBooking_ids_arr=array();
        if (count($receive_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 5, $receive_ids_arr, $empty_arr);
            $sql_receive_res=sql_select("SELECT a.id as ID, a.RECV_NUMBER, a.CHALLAN_NO, a.BOOKING_NO, a.BOOKING_ID, a.BOOKING_WITHOUT_ORDER, a.RECEIVE_BASIS, a.ENTRY_FORM, a.KNITTING_SOURCE, a.KNITTING_COMPANY from gbl_temp_engine g, inv_receive_master a where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=5 and a.item_category=2 and a.status_active=1 and a.is_deleted=0");//die;
            foreach($sql_receive_res as $row)
            {
                $receive_num_arr[$row["ID"]][1]=$row["RECV_NUMBER"];
                $receive_num_arr[$row["ID"]][2]=$row["CHALLAN_NO"];
                $receive_num_arr[$row["ID"]][3]=$row["KNITTING_SOURCE"];
                $receive_num_arr[$row["ID"]][4]=$row["KNITTING_COMPANY"];
                $receive_num_arr[$row["ID"]][12]=$row["BOOKING_NO"];
                $receive_num_arr[$row['ID']][13]=$row['BOOKING_ID'];
                $receive_num_arr[$row['ID']][14]=$row['RECEIVE_BASIS'];
                $receive_num_arr[$row['ID']][15]=$row['ENTRY_FORM'];
                if ($row['BOOKING_WITHOUT_ORDER']==1 && $row['BOOKING_ID']>0) {
                    $nonOrderBooking_ids_arr[$row['BOOKING_ID']]=$row['BOOKING_ID'];
                }
            }
            unset($sql_receive_res);
        }

        $issue_num_arr=array();
        if (count($issue_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 6, $issue_ids_arr, $empty_arr);
            $sql_issue_res=sql_select("SELECT a.id as ID, a.ISSUE_NUMBER, a.CHALLAN_NO, a.KNIT_DYE_SOURCE, a.KNIT_DYE_COMPANY, a.RECEIVED_ID,a.ISSUE_PURPOSE from gbl_temp_engine g, inv_issue_master a where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=6 and a.item_category=2 and a.status_active=1 and a.is_deleted=0");//die;
            foreach($sql_issue_res as $row)
            {
                $issue_num_arr[$row["ID"]][1]=$row["ISSUE_NUMBER"];
                $issue_num_arr[$row["ID"]][2]=$row["CHALLAN_NO"];
                $issue_num_arr[$row["ID"]][3]=$row["KNIT_DYE_SOURCE"];
                $issue_num_arr[$row["ID"]][4]=$row["KNIT_DYE_COMPANY"];
                $issue_num_arr[$row["ID"]][5]=$row["RECEIVED_ID"];
				$issue_num_arr[$row["ID"]]["issue_purpose"]=$row["ISSUE_PURPOSE"];
            }
            unset($sql_issue_res);
        }

        $transfer_num_arr=array();
        if (count($transfer_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 7, $transfer_ids_arr, $empty_arr);
            $sql_transfer_res=sql_select("SELECT a.id as ID, a.TRANSFER_SYSTEM_ID, a.CHALLAN_NO from gbl_temp_engine g, inv_item_transfer_mst a where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=7 and a.item_category=2 and a.status_active=1 and a.is_deleted=0");//die;
            foreach($sql_transfer_res as $row)
            {
                $transfer_num_arr[$row["ID"]][1]=$row["TRANSFER_SYSTEM_ID"];
			    $transfer_num_arr[$row["ID"]][2]=$row["CHALLAN_NO"];
            }
            unset($sql_transfer_res);
        }

        $nonOrderBooking_data_arr=array();
        if (count($nonOrderBooking_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 8, $nonOrderBooking_ids_arr, $empty_arr);
            $sql_nonOrderBooking_res=sql_select("SELECT a.ID, a.BOOKING_NO, a.COMPANY_ID, a.IS_APPROVED, a.ITEM_CATEGORY from gbl_temp_engine g, wo_non_ord_samp_booking_mst a where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=8 and a.status_active=1 and a.is_deleted=0");//die;
            foreach($sql_nonOrderBooking_res as $row)
            {
                $nonOrderBooking_data_arr[$row["ID"]]['booking_no']=$row["BOOKING_NO"];
                $nonOrderBooking_data_arr[$row["ID"]]['company_id']=$row["COMPANY_ID"];
                $nonOrderBooking_data_arr[$row["ID"]]['is_approved']=$row["IS_APPROVED"];
                $nonOrderBooking_data_arr[$row["ID"]]['item_category']=$row["ITEM_CATEGORY"];
            }
            unset($sql_nonOrderBooking_res);
        }

		$show_html_2 = 1; // for Blank Result
		if(count($result_2) > 0 || count($result_non_order_2) > 0)
		{
		    $html.='<div style="width:'.$scroll_div_width.'" id="'.$scroll_div.'">
			<table width="'.$table_width.'" id="" align="left">
					<tr class="form_caption" style="border:none;">
						<td colspan="20" align="left" style="border:none;font-size:16px; font-weight:bold" > Knit Finish Fabrics: </td>
					</tr>
					<tr style="border:none;">
					</tr>
			</table>
			<br />';
			if($cbo_order_type==0 || $cbo_order_type==1)
			{
				$html.='<table width="2500" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="table_header_1" align="left">
					<thead>
						<tr>
							<th width="30" >SL</th>
							<th width="50" >Prod. Id</th>
							<th width="60" >Year</th>
							<th width="50" >Job No</th>
                            <th width="100" >Style No</th>
							<th width="70">Buyer</th>
							<th width="120">Order No</th>
                            <th width="60">File No</th>
                            <th width="70">Int Ref</th>
							<th width="80">Ship Date</th>
							<th width="80" >Trans. Date</th>
							<th width="130" >Trans. Ref.</th>
							<th width="100" >Store Name</th>';
							if($rptType==3)
							{
								$html.='<th width="80">Issue Purposed</th>';
							}

							$html.='<th width="70" >WO/PI</th>
							<th width="100">Challan No</th>';
							if($rptType==3)
							{
								$html.='<th width="100">Department</th>
                                <th width="100">Section</th>';
							}
							$html.='<th width="120">Party Name</th>
							<th width="80" >Yarn Lot</th>
							<th width="80" >Yarn Count</th>
							<th width="100">Construction</th>
							<th width="110">Composition</th>
							<th width="80">Color</th>
							<th width="50">GSM</th>
							<th width="50">Dia</th>
							<th width="60">Stitch Lenth</th>
							<th width="80">Receive Qty</th>
							<th width="80">Receive Return Qty</th>
							<th width="80">Issue Qty </th>
                            <th width="80">Issue ReturnQty</th>
                            <th width="100">Batch No</th>
							<th width="110">User</th>
							<th width="160">Insert Date</th>
						</tr>
					</thead>
			   	</table>
               <div style="width:2520px; overflow-y: scroll; max-height:250px;" id="scroll_body2">
				<table width="2500" class="rpt_table" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_body_2" align="left">
					<tbody>';
					$i=1; $total_receive=""; $total_issue="";
					$tot_issue_ret_qty=0;
					foreach($result_2 as $row)
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

						$shipment_date=$job_order_data[$row[csf("order_id")]][5];

						$mst_id=$row[csf("mst_id")]; $dtls_id=$row[csf("dtls_id")];
						$trasRef=''; $challan_no=''; $knitting_source=''; $knitting_company=''; $yarn_lot=''; $yarn_count=''; $stitch_length=''; $color_id='';$bacth_no='';
						$trasRef=$row[csf("rcv_issue_no")];
						$challan_no=$row[csf("challan_no")];
						$knitting_source=$row[csf("knitting_source")];
						if($knitting_source==1)
						{
							$knitting_company=$company_arr[$row[csf("knitting_company")]];
						}
						else if($knitting_source==3)
						{
							$knitting_company=$supplier_arr[$row[csf("knitting_company")]];
						}

						$booking_no = "";
                        $booking_id = "";
                        $basis = "";
                        $entry_form= "";
						if($row[csf("transaction_type")]==1 || $row[csf("transaction_type")]==4)
						{
							$trasRef=$receive_num_arr[$mst_id][1];
							$challan_no=$receive_num_arr[$mst_id][2];
							$knitting_source=$receive_num_arr[$mst_id][3];
							$booking_no=$receive_num_arr[$mst_id][12];
                            $booking_id = $receive_num_arr[$mst_id][13];
                            $basis = $receive_num_arr[$mst_id][14];
                            $entry_form = $receive_num_arr[$mst_id][15];

							$bacth_no=$batch_arr[$row[csf("pi_wo_batch_no")]];
							if($knitting_source==1)
							{
								$knitting_company=$company_arr[$receive_num_arr[$mst_id][4]];
							}
							else if($knitting_source==3)
							{
								$knitting_company=$supplier_arr[$receive_num_arr[$mst_id][4]];
							}
							$yarn_lot=$receive_num_arr[$dtls_id][5];
							$yarn_count=$receive_num_arr[$dtls_id][6];
							$stitch_length=$receive_num_arr[$dtls_id][7];
							$color_id=$receive_num_arr[$dtls_id][8];
						}
						else if($row[csf("transaction_type")]==2 || $row[csf("transaction_type")]==3)
						{
							$trasRef=$issue_num_arr[$mst_id][1];
							$challan_no=$issue_num_arr[$mst_id][2];
							$knitting_source=$issue_num_arr[$mst_id][3];

                            $bacth_no=$batch_arr[$row[csf("pi_wo_batch_no")]];
							if($knitting_source==1)
							{
								$knitting_company=$company_arr[$issue_num_arr[$mst_id][4]];
							}
							else if($knitting_source==3)
							{
								$knitting_company=$supplier_arr[$issue_num_arr[$mst_id][4]];
							}
							$yarn_lot=$issue_num_arr[$dtls_id][5];
							$yarn_count=$issue_num_arr[$dtls_id][6];
							$stitch_length=$issue_num_arr[$dtls_id][7];
							$color_id=$issue_num_arr[$dtls_id][8];
						}
						else
						{
							$trasRef=$transfer_num_arr[$mst_id][1];
							$challan_no=$transfer_num_arr[$mst_id][2];
							$bacth_no=$batch_arr[$row[csf("pi_wo_batch_no")]];
							//$yarn_lot=$transfer_num_arr[$dtls_id][3];
							//$yarn_count=$transfer_num_arr[$dtls_id][4];
							//$stitch_length=$transfer_num_arr[$dtls_id][5];
						}

						$color='';
						$color_ids=explode(",",$color_id);
						foreach($color_ids as $val)
						{
							if($val>0) $color.=$color_arr[$val].",";
						}
						$color=chop($color,',');

						$yarn_count_name='';
						$yarn_counts=explode(",",$yarn_count);
						foreach($yarn_counts as $val)
						{
							if($val>0) $yarn_count_name.=$yarn_count_arr[$val].",";
						}
						$yarn_count_name=chop($yarn_count_name,',');
                        $rcv_qnty=$rcv_ret_qnty=$iss_qnty=$iss_ret_qnty=0;
                        if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4 || $row[csf("transaction_type")]==5)
                        {
                            $rcv_qnty=number_format($row[csf("quantity")],2); $total_receive +=$row[csf("quantity")];
                        }
                        if($row[csf("transaction_type")]==3)
                        { $rcv_ret_qnty=number_format($row[csf("quantity")],2); $total_ret_receive +=$row[csf("quantity")];}

                        if($row[csf("transaction_type")]==2  || $row[csf("transaction_type")]==3 || $row[csf("transaction_type")]==6)
                        { $iss_qnty= number_format($row[csf("quantity")],2); $total_issue +=$row[csf("quantity")];}
                        if($row[csf("transaction_type")]==4)
                        { $iss_ret_qnty=number_format($row[csf("quantity")],2); $total_ret_issue +=$row[csf("quantity")];}

						$html.='<a bgcolor="'.$bgcolor.'" onClick="change_color(\'tr_'.$i.'\',\''.$bgcolor.'\')" id="tr_'.$i.'">
							<td width="30">'.$i.'</td>
							<td width="50">'.$row[csf("prod_id")].'</td>
							<td width="60" align="center" class="wrd_brk">';
							if ($row[csf("is_sales")]==1)
							{
								$html.=$sales_data_arr[$row[csf("order_id")]]['job_year'];
							}
							else
							{
								$html.=$job_order_data[$row[csf("order_id")]][2];
							}
                            $html.='</td>
							<td width="50" align="center" class="wrd_brk">';
							if ($row[csf("is_sales")]!=1)
							{
								$html.=$job_order_data[$row[csf("order_id")]][1];
							}
                            $html.='</td>
                            <td width="100" class="wrd_brk">';
                            if ($row[csf("is_sales")]==1)
							{
								$html.=$sales_data_arr[$row[csf("order_id")]]['style_ref_no'];
							}
							else
							{
								$html.=$job_order_data[$row[csf("order_id")]][6];
							}
							$html.='</td>
							<td width="70" class="wrd_brk">';
							if ($row[csf("is_sales")]==1)
							{
								if($sales_data_arr[$row[csf("order_id")]]['within_group']==2)
								{
									$html.=$buyer_short_arr[$sales_data_arr[$row[csf("order_id")]]['buyer_id']];
								}
								else
								{
									$html.=$company_arr[$sales_data_arr[$row[csf("order_id")]]['buyer_id']];
								}

							}
							else
							{
								$html.=$buyer_short_arr[$job_order_data[$row[csf("order_id")]][3]];
							}
						    $html.='</td>
							<td width="120" class="wrd_brk">';
							if ($row[csf("is_sales")]==1)
							{
								$html.=$sales_data_arr[$row[csf("order_id")]]['job_no'];
							}
							else
							{
								$html.=$job_order_data[$row[csf("order_id")]][4];
							}
							$html.='</td>
                            <td width="60" class="wrd_brk">';
                            if ($row[csf("is_sales")]!=1)
							{
								$html.=$job_order_data[$row[csf("order_id")]][8];
							}
							$html.='</td>
                            <td width="70" class="wrd_brk">';
                            if ($row[csf("is_sales")]!=1)
							{
								$html.=$job_order_data[$row[csf("order_id")]][7];
							}
							$html.='</td>
							<td width="80" align="center" class="wrd_brk">';
							if ($row[csf("is_sales")]!=1)
							{
								if($shipment_date!="0000-00-00" && $shipment_date!=""){ $html.=change_date_format($shipment_date);}
                            }
                            $html.='</td>
							<td width="80" align="center" class="wrd_brk">'.change_date_format($row[csf("transaction_date")]).'</td>
							<td width="130" class="wrd_brk"><a href="##" onClick="openmypage_mrr(\'mrr_popup\',\''.$row[csf("transaction_type")].'\',\''.$row[csf("trans_id")].'\',\''.$cbo_company_name.'\');">'.$trasRef.'</a></td>
							<td width="100">'.$store_arr[$row["STORE_ID"]].'</td>';

							if($rptType==3)
							{
								$html.='<td width="80">';
								if($row[csf("transaction_type")]==2)
								{
									$html.= $yarn_issue_purpose[$issue_num_arr[$mst_id]["issue_purpose"]];
								}
								$html.='</td>';
							}

                            if($basis == 1 && $booking_no != ''){ //pi
                                $html.='<td width="70"  align="center" class="wrd_brk"><a href="javascript:void(0)" onClick="pi_report_generate('.$booking_id.')">'. $booking_no.'</a>></td>';
                            }
                            else if($basis == 9 && $booking_no != ''){
                                $html.='<td width="70"  align="center" class="wrd_brk"><a href="javascript:void(0)" onClick="print_report( \''.$cbo_company_name.'*'.$booking_id.'*'.$booking_no.'*Finish Fabric Production Entry\', \'finish_fab_production_print\', \'../../production/requires/finish_fabric_receive_controller\')">'.$booking_no.'</a></td>';
                            }
                            else if($basis == 14 && $booking_no != ''){
                                $html.='<td width="70"  align="center" class="wrd_brk"><a href="javascript:void(0)" onClick="print_report('.$booking_id.',\'fabric_sales_order_print\', \'requires/date_wise_item_recv_issue_multi_category_report_controller\')">'.$booking_no.'</a></td>';
                            }
                            else if($basis == 11 && $booking_no != ''){
                                $html.='<td width="70"  align="center" class="wrd_brk"><a href="javascript:void(0)" onClick="print_report(\''.$cbo_company_name.'*'.$booking_no.'\',\'show_service_booking_report\', \'requires/date_wise_item_recv_issue_multi_category_report_controller\')">'.$booking_no.'</a></td>';
                            }elseif($basis == 10 && $booking_no != ''){
                                $html.='<td width="70"  align="center" class="wrd_brk"><a href="javascript:void(0)" onClick="print_report( \''.$cbo_company_name.'*'.$booking_id.'*'.$booking_no.'*Finish Fabric Production Entry\', \'finish_fabric_receive_print_2\', \'../finish_fabric/requires/finish_feb_delivery_to_garments_controller\')">'.$booking_no.'</a></td>';
                            }elseif($basis == 2 && $booking_no != ''){
                                $html.='<td width="70"  align="center" class="wrd_brk"><a href="javascript:void(0)" onClick="print_report( \''. $booking_no.'\',\'show_fabric_booking_report\',\'requires/date_wise_item_recv_issue_multi_category_report_controller\')">'.$booking_no.'</a></td>';
                            }
                            else{
                                $html.='<td width="70"  align="center" class="wrd_brk">'. $booking_no.'</td>';
                            }
                            $html.='<td width="100" class="wrd_brk">'.$challan_no.'</td>';
							if($rptType==3)
							{
								$html.='<td width="100" align="center" class="wrd_brk">'.$department_arr[$row[csf("department_id")]].'</td>
                                <td width="100" align="center" class="wrd_brk">'.$section_arr[$row[csf("section_id")]].'</td>';
							}
							$html.='<td width="120" title="'.$receive_num_arr[$mst_id][4].'" class="wrd_brk">'.$knitting_company.'</td>
							<td width="80" class="wrd_brk">'.$yarn_lot.'</td>
							<td width="80" class="wrd_brk">'.$yarn_count_name.'</td>
							<td width="100" class="wrd_brk">'.$construction_arr[$product_arr[$row[csf('prod_id')]][1]].'</td>
							<td width="110" class="wrd_brk">'.$composition_arr[$product_arr[$row[csf('prod_id')]][1]].'</td>
							<td width="80" class="wrd_brk">'.$color_arr[$product_arr[$row[csf('prod_id')]][4]].'</td>
							<td width="50" class="wrd_brk">'.$product_arr[$row[csf('prod_id')]][2].'</td>
							<td width="50" class="wrd_brk">'.$product_arr[$row[csf('prod_id')]][3].'</td>
							<td width="60" class="wrd_brk">'.$stitch_length.'</td>
							<td width="80" align="right" class="wrd_brk">'.$rcv_qnty.'</td>
                            <td width="80" align="right" class="wrd_brk">'.$rcv_ret_qnty.'</td>
							<td align="right" width="80" class="wrd_brk">'.$iss_qnty.'</td>
                            <td width="80" align="right" class="wrd_brk">'.$iss_ret_qnty.'</td>
                            <td width="100" class="wrd_brk">'.$bacth_no.'</td>
							<td width="110" class="wrd_brk">'.$user_name_arr[$row[csf("inserted_by")]].'</td>
							<td width="160" class="wrd_brk">'.$row[csf("insert_date")].'</td>
						</tr>';
						$i++; $tot_issue_ret_qty=$tot_issue_ret_qty+$iss_ret_qnty;
					}
					unset($result);
					$html.='</tbody>
				</table>
				<table width="2500" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="report_table_footer" align="left">
					<tfoot>
						<th width="30">&nbsp;</th>
						<th width="50">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="50">&nbsp;</th>

                        <th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="120">&nbsp;</th>
                        <th width="60">&nbsp;</th>

                        <th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="130">&nbsp;</th>
						<th width="100">&nbsp;</th>';

						if($rptType==3)
						{
							$html.='<th width="80">&nbsp;</th>';
						}

						$html.='<th width="70">&nbsp;</th>

						<th width="100">&nbsp;</th>';
						if($rptType==3)
                        {
                            $html.='<th width="100">&nbsp;</th>
                            <th width="100">&nbsp;</th>';
                        }
						if($rptType==2){
							$html.='<th width="120">&nbsp;</th>
							<th width="80">&nbsp;</th>
							<th width="80">&nbsp;</th>

							<th width="100">&nbsp;</th>
							<th width="110">&nbsp;</th>
							<th width="80">&nbsp;</th>
							<th width="50">&nbsp;</th>

							<th width="50">&nbsp;</th>
							<th width="60">Total:</th>
							<!-- <th width="80" id="value_total_receive_f">'.number_format($total_receive,2).'</th> -->						
							<th width="80" id="value_total_ret_receive_f">'.number_format($total_ret_receive,2).'</th>
							<th width="80" id="value_total_issue_f">'.number_format($total_issue,2).'</th>
							<th width="80" id="value_total_ret_issue_f">'.number_format($total_ret_issue,2).'</th>
							<th width="80" id="value_total_receive_f_overwrite"></th>
							<th width="100">&nbsp;</th>
							<th width="110">&nbsp;</th>';
					    }
						else if($rptType==3){
							$html.='<th width="120">&nbsp;</th>
							<th width="80">&nbsp;</th>
							<th width="80">&nbsp;</th>

							<th width="100">&nbsp;</th>
							<th width="110">&nbsp;</th>
							<th width="80">&nbsp;</th>
							<th width="50">&nbsp;</th>

							<th width="50">&nbsp;</th>
							<th width="60">Total:</th>
							<!-- <th width="80" id="value_total_receive_f">'.number_format($total_receive,2).'</th> -->						
							<th width="80" id="value_total_ret_issue_f_write">'.number_format($total_ret_issue,2).'</th>
							<th width="80" id="value_total_ret_receive_f_write">'.number_format($total_ret_receive,2).'</th>
							<th width="80" id="value_total_issue_f_write">'.number_format($total_issue,2).'</th>
							
							<th width="80" id="">'.number_format($tot_issue_ret_qty,2).'</th>
							<th width="100">&nbsp;</th>
							<th width="110">&nbsp;</th>';
						}
						else{
							$html.='<th width="120">&nbsp;</th>
							<th width="80">&nbsp;</th>
							<th width="80">&nbsp;</th>

							<th width="100">&nbsp;</th>
							<th width="110">&nbsp;</th>
							<th width="80">&nbsp;</th>
							<th width="50">&nbsp;</th>

							<th width="50">&nbsp;</th>
							<th width="60">Total:</th>
							<!-- <th width="80" id="value_total_receive_f">'.number_format($total_receive,2).'</th> -->						
							<th width="80" id="value_total_ret_receive_f">'.number_format($total_ret_receive,2).'</th>
							<th width="80" id="value_total_issue_f">'.number_format($total_issue,2).'</th>
							<th width="80" id="value_total_ret_issue_f">'.number_format($total_ret_issue,2).'</th>
							<th width="80" id="value_total_receive_f_overwrite"></th>
							<th width="100">&nbsp;</th>
							<th width="110">&nbsp;</th>';
						}
						$html.='<th width="160">&nbsp;</th>
					</tfoot>
				</table>
			 	</div>';
			}
			if($cbo_order_type==0 || $cbo_order_type==2) // Non Order Item
			{
				$html.='<table width="1590"  id="table_header_3" align="left">
                    <tr>
                        <td colspan="17"><span style="font-size:16px; font-weight:bold;">Non Order Item</span></td>
                    </tr>
                </table>
                <table width="1590" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="table_header_2" align="left">
					<thead>
						<tr>
							<th width="30" >SL</th>
							<th width="50" >Prod. Id</th>
							<th width="80" >Trans. Date</th>
							<th width="120" >Trans. Ref.</th>
							<th width="100" >Store Name</th>';
							if($rptType==3)
							{
								$html.='<th width="80">Issue Purposed</th>';
							}
                            $html.='<th width="90" >WO/PI</th>
							<th width="80" >Challan No</th>';
							if($rptType==3)
							{
								$html.='<th width="100">Department</th>
                                <th width="100">Section</th>';
							}
							$html.='<th width="120" >Party Name</th>
							<th width="110">Construction</th>
							<th width="110">Composition</th>
							<th width="80">Color</th>
							<th width="50">GSM</th>
							<th width="50">Dia</th>
                            <th width="80">Rack</th>
							<th width="80">Receive Qty</th>
							<th width="80">Issue Qty</th>
							<th width="100">Batch No</th>
							<th width="110">User</th>
							<th>Insert Date</th>
						</tr>
					</thead>
			   	</table>
				<table width="1590" class="rpt_table" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_body2" align="left">
					<tbody>';
					$j=1; $total_receive=""; $total_issue="";
                    $print_report_format_knit_non_order=return_field_value("format_id","lib_report_template","template_name =".$cbo_company_name." and module_id=2 and report_id=4 and is_deleted=0 and status_active=1");
                    $knit_nonorder_printformat = explode(',', $print_report_format_knit_non_order);
                    foreach($result_non_order_2 as $row)
					{
						if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

						$mst_id=$row[csf("mst_id")]; $bacth_no=$row[csf("batch_no")];
						$trasRef=''; $challan_no=''; $knitting_source=''; $knitting_company='';
                        $rcv_non_order_qnty=$iss_non_order_qnty=0;
						if($row[csf("transaction_type")]==1 || $row[csf("transaction_type")]==4)
						{
							$trasRef=$receive_num_arr[$mst_id][1];
							$challan_no=$receive_num_arr[$mst_id][2];
							$knitting_source=$receive_num_arr[$mst_id][3];
                            $booking_no =$receive_num_arr[$mst_id][12];
                            $booking_id =$receive_num_arr[$mst_id][13];
                            $receive_basis =$receive_num_arr[$mst_id][14];

							if($knitting_source==1)
							{
								$knitting_company=$company_arr[$receive_num_arr[$mst_id][4]];
							}
							else if($knitting_source==3)
							{
								$knitting_company=$supplier_arr[$receive_num_arr[$mst_id][4]];
							}

                            $report_data ="";
                            if($knit_nonorder_printformat[0]==34)
                            {
                                $report_data = "show_fabric_booking_report*".$nonOrderBooking_data_arr[$booking_id]['booking_no']."*".$nonOrderBooking_data_arr[$booking_id]['company_id']."*".$nonOrderBooking_data_arr[$booking_id]['is_approved']."*".$nonOrderBooking_data_arr[$booking_id]['item_category'];
                            }
                            if($knit_nonorder_printformat[0]==35)
                            {
                                $report_data = "show_fabric_booking_report2*".$nonOrderBooking_data_arr[$booking_id]['booking_no']."*".$nonOrderBooking_data_arr[$booking_id]['company_id']."*".$nonOrderBooking_data_arr[$booking_id]['is_approved']."*".$nonOrderBooking_data_arr[$booking_id]['item_category'];

                            }
                            if($knit_nonorder_printformat[0]==36)
                            {
                                $report_data = "show_fabric_booking_report3*".$nonOrderBooking_data_arr[$booking_id]['booking_no']."*".$nonOrderBooking_data_arr[$booking_id]['company_id']."*".$nonOrderBooking_data_arr[$booking_id]['is_approved']."*".$nonOrderBooking_data_arr[$booking_id]['item_category'];
                            }
                            if($knit_nonorder_printformat[0]==37)
                            {
                                $report_data = "show_fabric_booking_report4*".$nonOrderBooking_data_arr[$booking_id]['booking_no']."*".$nonOrderBooking_data_arr[$booking_id]['company_id']."*".$nonOrderBooking_data_arr[$booking_id]['is_approved']."*".$nonOrderBooking_data_arr[$booking_id]['item_category'];
                            }
                            if($knit_nonorder_printformat[0]==64)
                            {
                                $report_data = "show_fabric_booking_report5*".$nonOrderBooking_data_arr[$booking_id]['booking_no']."*".$nonOrderBooking_data_arr[$booking_id]['company_id']."*".$nonOrderBooking_data_arr[$booking_id]['is_approved']."*".$nonOrderBooking_data_arr[$booking_id]['item_category'];
                            }
                            if($knit_nonorder_printformat[0]==72)
                            {
                                $report_data = "show_fabric_booking_report6*".$nonOrderBooking_data_arr[$booking_id]['booking_no']."*".$nonOrderBooking_data_arr[$booking_id]['company_id']."*".$nonOrderBooking_data_arr[$booking_id]['is_approved']."*".$nonOrderBooking_data_arr[$booking_id]['item_category'];
                            }
                            if($knit_nonorder_printformat[0]==174)
                            {
                                $report_data = "show_fabric_booking_report7*".$nonOrderBooking_data_arr[$booking_id]['booking_no']."*".$nonOrderBooking_data_arr[$booking_id]['company_id']."*".$nonOrderBooking_data_arr[$booking_id]['is_approved']."*".$nonOrderBooking_data_arr[$booking_id]['item_category'];
                            }

                            $rcv_non_order_qnty= number_format($row[csf("qty")],2);
                            $total_receive_non_order +=$row[csf("qty")];
						}
						else if($row[csf("transaction_type")]==2 || $row[csf("transaction_type")]==3)
						{
							$trasRef=$issue_num_arr[$mst_id][1];
							$challan_no=$issue_num_arr[$mst_id][2];
							$knitting_source=$issue_num_arr[$mst_id][3];

							if($knitting_source==1)
							{
								$knitting_company=$company_arr[$issue_num_arr[$mst_id][4]];
							}
							else if($knitting_source==3)
							{
								$knitting_company=$supplier_arr[$issue_num_arr[$mst_id][4]];
							}
                            $iss_non_order_qnty= number_format($row[csf("qty")],2);
                            $total_issue_non_order +=$row[csf("qty")];
						}

						$html.='<tr bgcolor="'.$bgcolor.'" onClick="change_color(\'tr_\''.$i.'\',\''.$bgcolor.'\')" id="tr_'.$i.'">
							<td width="30">'.$j.'</td>
							<td width="50">'.$row[csf("prod_id")].'</td>
							<td width="80" align="center" class="wrd_brk">'.change_date_format($row[csf("transaction_date")]).'</td>
							<td width="120" class="wrd_brk"><a href="##" onClick="openmypage_mrr(\'mrr_popup\',\''.$row[csf("transaction_type")].'\',\''.$row[csf("trans_id")].'\',\''.$cbo_company_name.'\');">'.$trasRef.'</a></td>
							<td width="100">'.$store_arr[$row["STORE_ID"]].'</td>';

							if($rptType==3)
							{
								$html.='<td width="80">';
								if($row[csf("transaction_type")]==2)
								{
									$html.= $yarn_issue_purpose[$issue_num_arr[$mst_id]["issue_purpose"]];
								}
								$html.='</td>';
							}

							if($receive_basis == 1 && $booking_no != ''){ //pi
                                $html.='<td width="90" align="center" class="wrd_brk"><a href="javascript:void(0)" onClick="pi_report_generate('.$booking_id.')">'.$booking_no.'</a></td>';
                            }
                            else if($receive_basis == 2 && $booking_no != ''){
                                $html.='<td width="90" align="center" class="wrd_brk"><a href="javascript:void(0)" onClick="generate_knit_finish_fabric_nonorder_report(\''.$report_data.'\')">'.$booking_no.'</a></td>';
                            }
                            else{
                                $html.='<td width="90" align="center" class="wrd_brk">'.$booking_no.'</td>';
                            }
                            $html.='<td width="80" class="wrd_brk">'.$challan_no.'</td>';
							if($rptType==3)
							{
								$html.='<td width="100" align="center" class="wrd_brk">'.$department_arr[$row[csf("department_id")]].'</td>
                                <td width="100" align="center" class="wrd_brk">'.$section_arr[$row[csf("section_id")]].'</td>';
							}
							$html.='<td width="120" class="wrd_brk">'.$knitting_company.'</td>
                            <td width="110" class="wrd_brk">'.$construction_arr[$product_arr[$row[csf('prod_id')]][1]].'</td>
							<td width="110" class="wrd_brk">'.$composition_arr[$product_arr[$row[csf('prod_id')]][1]].'</td>
							<td width="80" class="wrd_brk">'.$color_arr[$product_arr[$row[csf('prod_id')]][4]].'</td>
							<td width="50" class="wrd_brk">'.$product_arr[$row[csf('prod_id')]][2].'</td>
							<td width="50" class="wrd_brk">'.$product_arr[$row[csf('prod_id')]][3].'</td>
							<td width="80" class="wrd_brk">'.$row[csf("rack")].'</td>
                            <td width="80" align="right" class="wrd_brk">'.$rcv_non_order_qnty.'</td>
							<td align="right" width="80" class="wrd_brk">'.$iss_non_order_qnty.'</td>
							<td width="100" class="wrd_brk">'.$bacth_no.'</td>
							<td width="110" class="wrd_brk">'.$user_name_arr[$row[csf("inserted_by")]].'</td>
							<td class="wrd_brk">'.$row[csf("insert_date")].'</td>
						</tr>';
						$i++;$j++;
					}
					unset($result);
					$html.='</tbody>
				</table>
				<table width="1590" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="report_table_footer2" align="left">
					<tfoot>
						<th width="30">&nbsp;</th>
						<th width="50">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="120">&nbsp;</th>
						<th width="100">&nbsp;</th>';

						if($rptType==3)
						{
							$html.='<th width="80">&nbsp;</th>';
						}

						$html.='<th width="90">&nbsp;</th>
						<th width="80">&nbsp;</th>';
						if($rptType==3)
						{
							$html.='<th width="100">&nbsp;</th>
							<th width="100">&nbsp;</th>';
						}
						$html.='<th width="120">&nbsp;</th>
						<th width="110">&nbsp;</th>
						<th width="110">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="50">&nbsp;</th>
						<th width="50">&nbsp;</th>
                        <th width="80">Total:</th>
						<th width="80" >'. number_format($total_receive_non_order,2).'</th>
						<th width="80" >'. number_format($total_issue_non_order,2).'</th>
						<th width="100">&nbsp;</th>
						<th width="110">&nbsp;</th>
						<th >&nbsp;</th>

					</tfoot>
				</table>';
			}
        $html.='</div>';
        }
        else{
            $show_html_2 =0;
        }
	} // knit Finish

	if(($key = array_search(3, $cbo_item_cat)) !== false) //if($cbo_item_cat==3)
	{
        unset($cbo_item_cat[$key]);
		$composition_arr=array();
		$construction_arr=array();
		$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0";
		$data_array=sql_select($sql_deter);
		if(count($data_array)>0)
		{
			foreach( $data_array as $row )
			{
				if(array_key_exists($row[csf('id')],$construction_arr))
				{
					$construction_arr[$row[csf('id')]]=$construction_arr[$row[csf('id')]];
				}
				else
				{
					$construction_arr[$row[csf('id')]]=$row[csf('construction')];
				}
				if(array_key_exists($row[csf('id')],$composition_arr))
				{
					$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]];
				}
				else
				{
					$composition_arr[$row[csf('id')]]=$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
				}
			}
		}

		if($rptType==3)
		{
			if($cbo_order_type==2)
			{
				$scroll_div="scroll_body";
				$scroll_div_width="1630px";
				$table_width=1610;
			}
			else
			{
				$scroll_div="";
				$scroll_div_width="2100px";
				$table_width=2080;
			}
		}
		else
		{
			if($cbo_order_type==2)
			{
				$scroll_div="scroll_body";
				$scroll_div_width="1530px";
				$table_width=1510;
			}
			else
			{
				$scroll_div="";
				$scroll_div_width="2000px";
				$table_width=1980;
			}
		}

		$store_library=return_library_array( "select id, store_name from lib_store_location where status_active=1",'id','store_name');


		if($cbo_order_type==0 || $cbo_order_type==1) // Order Item
		{

			if($cbo_buyer_name!=0) $buyer_cond=" and a.buyer_name=$cbo_buyer_name"; else $buyer_cond="";

			if($rptType==1) //All Button
			{
				$sql="SELECT a.id as trans_id, a.transaction_type, a.receive_basis, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.pi_wo_batch_no, a.supplier_id, a.batch_id_from_fissuertn, a.rack, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, a.batch_lot, a.stitch_length, a.yarn_count, a.store_id, a.cons_rate, a.cons_amount,a.cons_uom,a.order_rate
				from inv_transaction a, order_wise_pro_details b
				where a.id=b.trans_id and a.item_category=3 and a.company_id=$cbo_company_name $date_cond $sql_cond and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.entry_form in (7,15,37,18,46,66,68,71,52,134,126,19,202,209,258,17) $transaction_ids_cond_for_mrr
				order by a.transaction_date, a.id";
			}
			else if($rptType==2) // Receive Button
			{
				$sql="SELECT a.id as trans_id, a.transaction_type, a.receive_basis, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.pi_wo_batch_no, a.supplier_id, a.batch_id_from_fissuertn, a.rack, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, a.stitch_length, a.yarn_count, a.store_id, a.cons_rate, a.cons_amount,a.cons_uom,a.order_rate
				from inv_transaction a, order_wise_pro_details b
				where a.id=b.trans_id and a.item_category=3 and a.transaction_type in(1,4,5,3) and b.trans_type in(1,4,5,3) and a.company_id=$cbo_company_name $date_cond $sql_cond and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.entry_form in (7,37,15,66,68,46,134,126,52,209,202,258,17) $transaction_ids_cond_for_mrr
				order by a.transaction_date, a.id";
			}
			else if($rptType==3) // Issue Button
			{
				$sql="SELECT a.id as trans_id, a.transaction_type, a.receive_basis, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.pi_wo_batch_no, a.supplier_id, a.batch_id_from_fissuertn, a.rack, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, a.stitch_length, a.yarn_count, a.store_id, a.cons_rate, a.cons_amount, a.department_id, a.section_id
				from inv_transaction a, order_wise_pro_details b
				where a.id=b.trans_id and a.item_category=3 and a.transaction_type in(2,3,6,4) and b.trans_type in(2,3,6,4) and a.company_id=$cbo_company_name $date_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in (15,18,46,71,52,134,19,202,209) $sql_cond $transaction_ids_cond_for_mrr
				order by a.transaction_date, a.id";
			}
			// echo $sql;

			$result_2=sql_select($sql);
			$orderids_arr = array();
			$prod_ids_arr = array();
            $batch_ids_arr=array();
            $receive_ids_arr=array();
            $issue_ids_arr=array();
            $transfer_ids_arr=array();
			foreach ($result_2 as $val)
			{
				if ($val[csf('order_id')]>0) $orderids_arr[$val[csf("order_id")]]=$val[csf("order_id")];
                if ($val[csf('prod_id')]>0) $prod_ids_arr[$val[csf("prod_id")]]=$val[csf("prod_id")];
                if($val[csf("pi_wo_batch_no")]>0) $batch_ids_arr[$val[csf("pi_wo_batch_no")]]=$val[csf("pi_wo_batch_no")];

                if ($val[csf("transaction_type")]==1 || $val[csf("transaction_type")]==4){
                    $receive_ids_arr[$val[csf("mst_id")]]=$val[csf("mst_id")];
                } else if ($val[csf("transaction_type")]==2 || $val[csf("transaction_type")]==3) {
                    $issue_ids_arr[$val[csf("mst_id")]]=$val[csf("mst_id")];
                } else $transfer_ids_arr[$val[csf("mst_id")]]=$val[csf("mst_id")];
			}
            $job_order_data=array();
            $booking_arr=array();
            if (count($orderids_arr)>0)
			{

                fnc_tempengine("gbl_temp_engine", $user_id, 33, 14, $orderids_arr, $empty_arr);

				$sql_job_data=sql_select("SELECT a.job_no as job_no, $select_year(a.insert_date $year_con) as job_year, a.buyer_name as buyer_name, a.style_ref_no as style_ref_no, b.id as id, b.grouping as ref_no, b.file_no as file_no, b.po_number as po_number, b.shipment_date as shipment_date, b.po_quantity as po_quantity from wo_po_details_master a, wo_po_break_down b, gbl_temp_engine g where a.id=b.job_id and b.id=g.ref_val and g.user_id=$user_id and g.entry_form=33 and g.ref_from=14 and a.is_deleted=0 and b.is_deleted=0 $buyer_cond");//die;

				foreach($sql_job_data as $row)
				{
					$job_order_data[$row[csf('id')]][1]=$row[csf("job_no")];
                    $job_order_data[$row[csf('id')]][2]=$row[csf("job_year")];
                    $job_order_data[$row[csf('id')]][3]=$row[csf("buyer_name")];
                    $job_order_data[$row[csf('id')]][4]=$row[csf("po_number")];
                    $job_order_data[$row[csf('id')]][5]=$row[csf("shipment_date")];
                    $job_order_data[$row[csf('id')]][6]=$row[csf("style_ref_no")];
                    $job_order_data[$row[csf('id')]][7]=$row[csf("ref_no")];
                    $job_order_data[$row[csf('id')]][8]=$row[csf("file_no")];
                    $job_order_data[$row[csf('id')]][9]=$row[csf("po_quantity")];
                }
                unset($sql_job_data);


                $bookingDataArr=sql_select("SELECT a.fabric_source, b.po_break_down_id as order_id,b.booking_no, b.fabric_color_id, b.construction,b.copmposition,b.gsm_weight,b.dia_width,b.gmts_color_id as color_id from wo_booking_mst a, wo_booking_dtls b, gbl_temp_engine g where a.booking_no=b.booking_no and b.po_break_down_id=g.ref_val and a.booking_type in(1,4) and b.status_active=1 and a.status_active=1 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=14 group by a.fabric_source,b.po_break_down_id,b.booking_no, b.fabric_color_id, b.construction,b.copmposition,b.gsm_weight,b.dia_width,b.gmts_color_id");
                foreach($bookingDataArr as $row)
                {
                    $booking_arr[$row[csf('order_id')]][$row[csf('fabric_color_id')]]['booking_no']	= $row[csf('booking_no')];
                    $booking_arr[$row[csf('order_id')]][$row[csf('fabric_color_id')]]['construction']	= $row[csf('construction')];
                    $booking_arr[$row[csf('order_id')]][$row[csf('fabric_color_id')]]['copmposition']	= $row[csf('copmposition')];
                    $booking_arr[$row[csf('order_id')]][$row[csf('fabric_color_id')]]['gsm_weight']	= $row[csf('gsm_weight')];
                    $booking_arr[$row[csf('order_id')]][$row[csf('fabric_color_id')]]['fabric_source']	= $row[csf('fabric_source')];
                }
                unset($bookingDataArr);
			}

            $product_arr=array();
            if (count($prod_ids_arr)>0)
			{

                fnc_tempengine("gbl_temp_engine", $user_id, 33, 15, $prod_ids_arr, $empty_arr);

				$sql_prod_res=sql_select("SELECT a.id, a.detarmination_id, a.gsm, a.dia_width, a.color, a.lot from product_details_master a, gbl_temp_engine g where a.id=g.ref_val and a.item_category_id=3 and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=15");

                foreach($sql_prod_res as $row)
				{
					$product_arr[$row[csf('id')]]['detarmination_id']=$row[csf('detarmination_id')];
                    $product_arr[$row[csf('id')]]['gsm']=$row[csf('gsm')];
                    $product_arr[$row[csf('id')]]['dia_width']=$row[csf('dia_width')];
                    $product_arr[$row[csf('id')]]['color']=$row[csf('color')];
                    $product_arr[$row[csf('id')]]['lot']=$row[csf('lot')];
                }
                unset($sql_prod_res);
			}

            if (count($batch_ids_arr)>0)
			{
                fnc_tempengine("gbl_temp_engine", $user_id, 33, 16, $batch_ids_arr, $empty_arr);
				$sql_batch_res=sql_select("SELECT a.ID, a.BATCH_NO from pro_batch_create_mst a, gbl_temp_engine g where a.id=g.ref_val and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=16");
				foreach($sql_batch_res as $row)
				{
					$batch_arr[$row["ID"]]=$row["BATCH_NO"];
                }
                unset($sql_batch_res);
			}

			if($cbo_order_type==2)
			{
				$scroll_div="scroll_body";
				$scroll_div_width="1430px";
				$table_width=1410;
			}
			else
			{
				$scroll_div="";
				$scroll_div_width="1900px";
				$table_width=1880;
			}
		}
		if($cbo_order_type==0 || $cbo_order_type==2) // Non Order Item query
		{
			if($rptType==1)
			{
				$sql_non_order_2="SELECT a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.rack, a.inserted_by, $select_insert_date, a.cons_quantity as qty, a.prod_id, b.batch_no, a.store_id
				from pro_batch_create_mst b, inv_transaction a
				where b.id=case when a.transaction_type in(1,2) then a.pi_wo_batch_no when a.transaction_type in(3,4) then a.batch_id_from_fissuertn when a.transaction_type in(5,6) then a.pi_wo_batch_no end and a.item_category=3 and b.booking_without_order=1 and a.transaction_type in(1,2,3,4,5,6) and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr $sql_cond and a.status_active=1 and a.is_deleted=0
				order by a.transaction_date, a.id";
			}
			else if($rptType==2)
			{
				$sql_non_order_2="SELECT a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.rack, a.inserted_by, $select_insert_date, a.cons_quantity as qty, a.prod_id, b.batch_no, a.store_id
				from pro_batch_create_mst b, inv_transaction a
				where b.id=case when a.transaction_type in(1) then a.pi_wo_batch_no when a.transaction_type in(4) then a.batch_id_from_fissuertn when a.transaction_type in(5) then a.pi_wo_batch_no end and a.item_category=3 and b.booking_without_order=1 and a.transaction_type in(1,4,5) and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr $sql_cond and a.status_active=1 and a.is_deleted=0
				order by a.transaction_date, a.id";
			}
			else if($rptType==3)
			{
				$sql_non_order_2="SELECT a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.rack, a.inserted_by, $select_insert_date, a.cons_quantity as qty, a.prod_id, b.batch_no, a.store_id, a.department_id, a.section_id
				from pro_batch_create_mst b, inv_transaction a
				where b.id=case when a.transaction_type in(2) then a.pi_wo_batch_no when a.transaction_type in(3) then a.batch_id_from_fissuertn when a.transaction_type in(6) then a.pi_wo_batch_no end and a.item_category=3 and b.booking_without_order=1 and a.transaction_type in(2,3,6) and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr $sql_cond and a.status_active=1 and a.is_deleted=0
				order by a.transaction_date, a.id";
			}
		}
		//echo $sql;//die;


		$result_non_order_2=sql_select($sql_non_order_2);
        foreach ($result_non_order_2 as $row)
        {
            if ($row[csf("transaction_type")]==1 || $row[csf("transaction_type")]==4){
                $receive_ids_arr[$row[csf("mst_id")]]=$row[csf("mst_id")];
            } else if ($row[csf("transaction_type")]==2 || $row[csf("transaction_type")]==3) {
                $issue_ids_arr[$row[csf("mst_id")]]=$row[csf("mst_id")];
            } else $transfer_ids_arr[$row[csf("mst_id")]]=$row[csf("mst_id")];
        }

        $receive_num_arr=array();
        if (count($receive_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 17, $receive_ids_arr, $empty_arr);
            $sql_receive_res=sql_select("SELECT a.id, a.recv_number, a.challan_no, a.challan_date, a.knitting_source, a.knitting_company, a.receive_basis, a.booking_no, a.booking_id, a.supplier_id, a.issue_id from gbl_temp_engine g, inv_receive_master a where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=17 and a.item_category=3 and a.status_active=1 and a.is_deleted=0");
            foreach($sql_receive_res as $row)
            {
                $receive_num_arr[$row[csf('id')]]['id']=$row[csf("id")];//1
                $receive_num_arr[$row[csf('id')]]['recv_number']=$row[csf("recv_number")];//1
                $receive_num_arr[$row[csf('id')]]['challan_no']=$row[csf("challan_no")];//2
                $receive_num_arr[$row[csf('id')]]['challan_date']=$row[csf("challan_date")];//2
                $receive_num_arr[$row[csf('id')]]['knitting_source']=$row[csf("knitting_source")];//3
                $receive_num_arr[$row[csf('id')]]['knitting_company']=$row[csf("knitting_company")];//4
                $receive_num_arr[$row[csf('id')]]['receive_basis']=$row[csf("receive_basis")];//5
                $receive_num_arr[$row[csf('id')]]['booking_no']=$row[csf("booking_no")];//6
                $receive_num_arr[$row[csf('id')]]['booking_id']=$row[csf("booking_id")];
                $receive_num_arr[$row[csf('id')]]['supplier_id']=$row[csf("supplier_id")];
                $receive_num_arr[$row[csf('id')]]['issue_id']=$row[csf("issue_id")];
            }
            unset($sql_receive_res);
        }


        $issue_num_arr=array();
        if (count($issue_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 18, $issue_ids_arr, $empty_arr);
            $sql_issue_res=sql_select("SELECT a.id, a.issue_number, a.issue_purpose, a.challan_no, a.knit_dye_source, a.knit_dye_company, a.received_id from gbl_temp_engine g, inv_issue_master a where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=18 and a.item_category=3 and a.status_active=1 and a.is_deleted=0");//die;
            foreach($sql_issue_res as $row)
            {
                $issue_num_arr[$row[csf('id')]]['id']=$row[csf("id")];
                $issue_num_arr[$row[csf('id')]]['issue_number']=$row[csf("issue_number")];
                $issue_num_arr[$row[csf('id')]]['challan_no']=$row[csf("challan_no")];
                $issue_num_arr[$row[csf('id')]]['knit_dye_source']=$row[csf("knit_dye_source")];
                $issue_num_arr[$row[csf('id')]]['knit_dye_company']=$row[csf("knit_dye_company")];
                $issue_num_arr[$row[csf('id')]]['received_id']=$row[csf("received_id")];
                $issue_num_arr[$row[csf('id')]]['issue_purpose']=$row[csf("issue_purpose")];
            }
            unset($sql_issue_res);
        }

        $transfer_num_arr=array();
        if (count($transfer_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 19, $transfer_ids_arr, $empty_arr);
            $sql_transfer_res=sql_select("SELECT a.id as ID, a.TRANSFER_SYSTEM_ID, a.CHALLAN_NO from gbl_temp_engine g, inv_item_transfer_mst a where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=19 and a.item_category=3 and a.status_active=1 and a.is_deleted=0");//die;
            foreach($sql_transfer_res as $row)
            {
                $transfer_num_arr[$row["ID"]][1]=$row["TRANSFER_SYSTEM_ID"];
			    $transfer_num_arr[$row["ID"]][2]=$row["CHALLAN_NO"];
            }
            unset($sql_transfer_res);
        }


		$print_report_format=sql_select("select format_id, report_id from lib_report_template where template_name=".$cbo_company_name." and module_id=6 and report_id in(125,127,126,129) and status_active=1 and is_deleted=0");
		foreach ($print_report_format as $val) {
			if ($val[csf("report_id")]==125) $print_report_format_rec=explode(",",$val[csf("format_id")]);
			else if ($val[csf("report_id")]==127) $print_report_format_recRtn=explode(",",$val[csf("format_id")]);
			else if ($val[csf("report_id")]==126) $print_report_format_iss=explode(",",$val[csf("format_id")]);
			else if ($val[csf("report_id")]==129) $print_report_format_issRtn=explode(",",$val[csf("format_id")]);

		}
		//ob_start();

		$show_html_2 = 1; // for Blank Result
		if(count($result_2) > 0 || count($result_non_order_2) > 0) // show data
		{
			$html.='<div style="width:'. $scroll_div_width.'" id="'. $scroll_div.'">
				<table width="'. $table_width.'" id="" align="left">
						<tr class="form_caption" style="border:none;">
							<td colspan="20" align="left" style="border:none;font-size:16px; font-weight:bold" >Woven Finish Fabrics: </td>
						</tr>
						<tr style="border:none;">
						</tr>
				</table>
				<br />';
				if($cbo_order_type==0 || $cbo_order_type==1) //All and With Order
				{
					$html.='<table width="4200" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="table_header_1" align="left">
	                    <thead>
	                        <tr>
	                            <th width="30" rowspan="2">SL</th>
	                            <th width="50" rowspan="2">Prod. Id</th>
	                            <th width="100" rowspan="2">Store Name</th>
	                            <th width="40" rowspan="2">Year</th>
	                            <th width="70" rowspan="2">Job No</th>
	                            <th width="100" rowspan="2">Style No</th>
	                            <th width="70" rowspan="2">Buyer</th>
	                            <th width="120" rowspan="2">Order No</th>
	                            <th width="80" rowspan="2">Order Qnty.</th>
	                            <th width="60" rowspan="2">File No</th>
	                            <th width="70" rowspan="2">Int Ref</th>
	                            <th width="80" rowspan="2">Ship Date</th>
	                            <th width="80" rowspan="2">Trans. Date</th>
	                            <th width="130" rowspan="2">Trans. Ref.</th>';

								if($rptType==3)
								{
									$html.='<th width="80" rowspan="2">Issue Purposed</th>';
								}

	                            $html.='<th width="100" rowspan="2">Challan No</th>';
                                if($rptType==1 || $rptType==2)
                                {
                                    $html.='<th width="80" rowspan="2">Challan Date</th>';
                                }
                                if($rptType==3)
                                {
                                    $html.='<th width="100" rowspan="2">Department</th>
                                    <th width="100" rowspan="2">Section</th>';
                                }
                                $html.='<th width="120" rowspan="2">Party Name</th>
	                            <th width="120" rowspan="2">Booking No</th>
	                            <th width="100" rowspan="2">Fab. Source</th>
	                            <th width="100" rowspan="2">Construction</th>
	                            <th width="110" rowspan="2">Composition</th>
	                            <th width="80" rowspan="2">Color</th>
	                            <th width="50" rowspan="2">GSM</th>
	                            <th width="50" rowspan="2">Dia</th>
	                            <th width="60" rowspan="2">Stitch Lenth</th>
	                            <th width="240" colspan="4" class="extraThStyle">Receive</th>
	                            <th width="960" colspan="12" class="extraThStyle">Issue</th>';

                                if($rptType==2 || $rptType==1 )
                                {
                                    $html.='<th width="80" rowspan="2">Currency</th>
                                    <th width="80" rowspan="2">Exchange Rate</th>	
                                    <th width="80" rowspan="2">Actual Rate</th>
                                    <th width="80" rowspan="2">Actual Amt</th>';
                                }

	                            $html.='<th width="100" rowspan="2">Rate</th>
	                            <th width="100" rowspan="2">Amount</th>
	                            <th width="70" rowspan="2">Batch No</th>
	                            <th width="110" rowspan="2">User</th>
	                            <th rowspan="2">Insert Date</th>
	                        </tr>
	                        <tr>
                                <th width="80">Receive Qty</th>
	                            <th width="50">UOM</th>
	                            <th width="80">Issue ReturnQty</th>
	                            <th width="80">Trans. In Qty</th>
	                            <th width="80">Bulk Sewing Prod</th>
	                            <th width="80">Sample With Order</th>
	                            <th width="80">Sample Without Order</th>
	                            <th width="80">Trans. Out Qty</th>
	                            <th width="80">Receive Return Qty</th>
	                            <th width="80">Re-Process</th>
	                            <th width="80">Sales</th>
	                            <th width="80">Fabric Test</th>
	                            <th width="80">Scrap Store</th>
	                            <th width="80">Damage</th>
	                            <th width="80">Adjustment</th>
	                            <th width="80">Stolen</th>
	                        </tr>
	                    </thead>
				   	</table>
				  	<div style="width:4280px; overflow-y: scroll; max-height:250px;" id="scroll_body3">
					<table width="4200" class="rpt_table" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_body_3" align="left">
						<tbody>';
						// echo $sql;die();
						$i=1; $total_receive=""; $total_issue=""; $total_amounts="";

						foreach($result_2 as $row)
						{
							if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

							$shipment_date=$job_order_data[$row[csf("order_id")]][5];

							$mst_id=$row[csf("mst_id")];
							$dtls_id=$row[csf("dtls_id")];
							//echo $mst_id.'**';
							$trasRef=$challan_no=$knitting_source=$knitting_company='';
							$yarn_lot=$yarn_count=$stitch_length=$color_id=$bacth_no='';

							$trasRef=$row[csf("rcv_issue_no")];//die("with tt");
							$challan_no=$row[csf("challan_no")];
							$knitting_source=$row[csf("knitting_source")];
							if($cbo_item_cat==2)
							{
								if($knitting_source==1)
								{
									$knitting_company=$company_arr[$row[csf("knitting_company")]];
								}
								else if($knitting_source==3)
								{
									$knitting_company=$supplier_arr[$row[csf("knitting_company")]];
								}
							}
							else
							{
								$knitting_company=$supplier_arr[$row[csf("supplier_id")]];
							}

							$issue_purpose = "";
							$rcv_booing_no="";
							$rcv_booing_id='';

							if($row[csf("transaction_type")]==1) //Receive
							{
								$trasRef=$receive_num_arr[$mst_id]['recv_number'];
								$challan_no=$receive_num_arr[$mst_id]['challan_no'];
								$challan_date=$receive_num_arr[$mst_id]['challan_date'];
								$knitting_source=$receive_num_arr[$mst_id]['knitting_source'];

								if($receive_num_arr[$mst_id][5]==2) $rcv_booing_no=$receive_num_arr[$mst_id][6];
								$bacth_no=$batch_arr[$row[csf("pi_wo_batch_no")]];
								if($knitting_source==1)
								{
									$knitting_company=$company_arr[$receive_num_arr[$mst_id]['knitting_company']];
								}
								else if($knitting_source==3)
								{
									$knitting_company=$supplier_arr[$receive_num_arr[$mst_id]['knitting_company']];
								}

								/*$yarn_lot=$receive_num_arr[$dtls_id][5];
								$yarn_count=$receive_num_arr[$dtls_id][6];
								$stitch_length=$receive_num_arr[$dtls_id][7];
								$color_id=$receive_num_arr[$dtls_id][8];*/
								$yarn_count = $yarn_count_array[6];
							}
							else if($row[csf("transaction_type")]==4) // issue Return
							{
								$trasRef=$receive_num_arr[$mst_id]['recv_number'];
								$challan_no=$receive_num_arr[$mst_id]['challan_no'];
								$challan_date=$receive_num_arr[$mst_id]['challan_date'];
								$knitting_source=$receive_num_arr[$mst_id]['knitting_source'];

	                            $bacth_no=$batch_arr[$row[csf("batch_id_from_fissuertn")]];
								if($knitting_source==1)
								{
									$knitting_company=$company_arr[$receive_num_arr[$mst_id]['knitting_company']];
								}
								else if($knitting_source==3)
								{
									$knitting_company=$supplier_arr[$receive_num_arr[$mst_id]['knitting_company']];
								}

								$yarn_lot=$row[csf("batch_lot")];
								$yarn_count=$row[csf("yarn_count")];
								$stitch_length=$row[csf("stitch_length")];
							}
							else if($row[csf("transaction_type")]==2) //issue
							{
								$trasRef=$issue_num_arr[$mst_id]['issue_number'];
								$challan_no=$issue_num_arr[$mst_id]['challan_no'];
								$knitting_source=$issue_num_arr[$mst_id]['knit_dye_source'];
                                $issue_purpose=$issue_num_arr[$mst_id]['issue_purpose'];

                                $bacth_no=$batch_arr[$row[csf("pi_wo_batch_no")]];
								if($knitting_source==1)
								{
									$knitting_company=$company_arr[$issue_num_arr[$mst_id]['knit_dye_company']];
								}
								else if($knitting_source==3)
								{
									$knitting_company=$supplier_arr[$issue_num_arr[$mst_id]['knit_dye_company']];
								}

								$yarn_lot=$issue_num_arr[$dtls_id]['received_id'];
								$yarn_count=$issue_num_arr[$dtls_id]['issue_purpose'];
								$stitch_length=$issue_num_arr[$dtls_id][7];
								$color_id=$issue_num_arr[$dtls_id][8];
							}
							else if($row[csf("transaction_type")]==3) //Receive Return
							{
								$trasRef=$issue_num_arr[$mst_id]['issue_number'];
								$challan_no=$issue_num_arr[$mst_id]['challan_no'];

								$bacth_no=$batch_arr[$row[csf("batch_id_from_fissuertn")]];

								$received_id=$issue_num_arr[$mst_id]['received_id'];


								$knitting_source=$receive_num_arr[$received_id]['knitting_source'];
								if($knitting_source==1)
								{
									$knitting_company=$company_arr[$receive_num_arr[$received_id]['knitting_company']];
								}
								else if($knitting_source==3)
								{
									$knitting_company=$supplier_arr[$receive_num_arr[$received_id]['knitting_company']];
								}



								$yarn_lot=$row[csf("batch_lot")];
								$yarn_count=$row[csf("yarn_count")];
								$stitch_length=$row[csf("stitch_length")];
							}
							else
							{
								$trasRef=$transfer_num_arr[$mst_id][1];
								$challan_no=$transfer_num_arr[$mst_id][2];
								//$yarn_lot=$transfer_num_arr[$dtls_id][3];
								//$yarn_count=$transfer_num_arr[$dtls_id][4];
								//$stitch_length=$transfer_num_arr[$dtls_id][5];
							}

							$color='';
							$color_ids=explode(",",$color_id);
							foreach($color_ids as $val)
							{
								if($val>0) $color.=$color_arr[$val].",";
							}
							$color=chop($color,',');

							$yarn_count_name='';
							$yarn_counts=explode(",",$yarn_count);
							foreach($yarn_counts as $val)
							{
								if($val>0) $yarn_count_name.=$yarn_count_arr[$val].",";
							}
							$yarn_count_name=chop($yarn_count_name,',');


							if ($row[csf('entry_form')]==17) //Woven Finish Fabric Receive
							{
								$print_format_id=$print_report_format_rec[0];
								if ($print_format_id==78)  //Print button
								{
									$report_title='Woven Finish Fabric Receive';
									$print_link="<a href='#' onClick=\"print_report('".$cbo_company_name."*".$mst_id."*".$report_title."', 'gwoven_finish_fabric_receive_print', '../../inventory/finish_fabric/requires/woven_finish_fabric_receive_controller')\"> ".$trasRef." <a/>";
								}
								else if ($print_format_id==66)  //Print 2 Button  Only PI Based Receive
								{
									$rcv_booing_id=$receive_num_arr[$mst_id]['booking_id'];
									if($row[csf("transaction_type")]==1 && $row[csf("receive_basis")]==1){
										$report_title='Woven Finish Fabric Receive';
										$print_link="<a href='#' onClick=\"print_report('".$cbo_company_name."*".$mst_id."*".$rcv_booing_id."*".$report_title."', 'gwoven_finish_fabric_receive_print_2', '../../inventory/finish_fabric/requires/woven_finish_fabric_receive_controller')\"> ".$trasRef." <a/>";
									}
									else $print_link=$trasRef;

								}
								else $print_link=$trasRef;
							}
							else if ($row[csf('entry_form')]==19) //Woven Finish Fabric Issue
							{
								$print_format_id=$print_report_format_iss[0];
								if ($print_format_id==78) //Print button
								{
									$report_title='Woven Finish Fabric Issue';
									$print_link="<a href='#' onClick=\"print_report('".$cbo_company_name."*".$mst_id."*".$report_title."', 'woven_finish_fabric_issue_print','../../inventory/finish_fabric/requires/woven_finish_fabric_issue_controller')\"> ".$trasRef." <a/>";
								}
								else $print_link=$trasRef;
							}
							else if ($row[csf('entry_form')]==202) //Woven Finish Fabric Receive Return
							{
								$received_id_rtn=$return_to_supplier='';
								$print_format_id=$print_report_format_recRtn[0];
								$received_id_rtn=$issue_num_arr[$mst_id]['received_id'];
								$return_to_supplier=$receive_num_arr[$received_id_rtn]['supplier_id'];
								if ($print_format_id==78) //Print button
								{
									$report_title='Woven Finish Fabric Receive Return';
									$print_link="<a href='#' onClick=\"print_report('".$cbo_company_name."*".$mst_id."*".$return_to_supplier."*".$report_title."', 'yarn_receive_return_print','../../inventory/finish_fabric/requires/woven_finish_fab_receive_rtn_controller')\"> ".$trasRef." <a/>";
								}
								else $print_link=$trasRef;
							}
							else if ($row[csf('entry_form')]==209) //Woven Finish Fabric Issue Return
							{
								$txt_system_id=$issue_id_rtn='';
								$print_format_id=$print_report_format_issRtn[0];
								$txt_system_id=$receive_num_arr[$mst_id]['recv_number'];
								$issue_id_rtn=$receive_num_arr[$mst_id]['issue_id'];
								if ($print_format_id==78) //Print button
								{
									$report_title='Woven Finish Fabric Issue Return';
                                    $print_link="<a href='#' onClick=\"print_report('".$cbo_company_name."*".$txt_system_id."*".$report_title."*".$mst_id."*".$issue_id_rtn."', 'issue_return_print', '../../inventory/finish_fabric/requires/woven_finish_fabric_issue_return_controller')\"> ".$trasRef." <a/>";
								}
								else $print_link=$trasRef;
							}
							else $print_link=$trasRef;

							$html.='<tr bgcolor="'.$bgcolor.'" onClick="change_color(\'tr_'.$i.'\',\''.$bgcolor.'\')" id="tr_'.$i.'">
								<td width="30">'.$i.'</td>
								<td width="50" align="center">'.$row[csf("prod_id")].'</td>
	                            <td width="100" class="wrd_brk">'.$store_library[$row[csf("store_id")]].'</td>
								<td width="40" align="center" class="wrd_brk">'.date("Y",strtotime($job_order_data[$row[csf("order_id")]][2])).'</td>
								<td width="70" align="center" class="wrd_brk">'.$job_order_data[$row[csf("order_id")]][1].'</td>
	                            <td width="100" class="wrd_brk">'.$job_order_data[$row[csf("order_id")]][6].'</td>
								<td width="70" class="wrd_brk">'.$buyer_short_arr[$job_order_data[$row[csf("order_id")]][3]].'</td>
								<td width="120" class="wrd_brk">'.$job_order_data[$row[csf("order_id")]][4].'</td>
	                            <td width="80" align="right">'.$job_order_data[$row[csf("order_id")]][9].'</td>
	                            <td width="60" align="center" class="wrd_brk">'.$job_order_data[$row[csf("order_id")]][8].'</td>
	                            <td width="70" align="center" class="wrd_brk" >'.$job_order_data[$row[csf("order_id")]][7].'</td>
								<td width="80" align="center">'.change_date_format($shipment_date).'</td>
								<td width="80" align="center">'.change_date_format($row[csf("transaction_date")]).'</td>
								<td width="130" title="'.$dtls_id.'" class="wrd_brk">'.$print_link.'</td>';

								if($rptType==3)
								{
									$html.='<td width="80">';
									if($row[csf("transaction_type")]==2)
									{
										$html.= $yarn_issue_purpose[$issue_num_arr[$mst_id]["issue_purpose"]];
									}
									$html.='</td>';
								}

								$html.='<td width="100" class="wrd_brk">'.$challan_no.'</td>';
                                if($rptType==1 || $rptType==2)
                                {
                                    $html.='<td width="80" align="center" class="wrd_brk">'.$challan_date.'</td>';
                                }
                                if($rptType==3)
                                {
                                    $html.='<td width="100" align="center" class="wrd_brk">'.$department_arr[$row[csf("department_id")]].'</td>
                                    <td width="100" align="center" class="wrd_brk">'.$section_arr[$row[csf("section_id")]].'</td>';
                                }
								$html.='<td width="120" class="wrd_brk" title="'.$receive_num_arr[$mst_id]['knitting_company'].'='.$knitting_source.'">'.$knitting_company.'</td>
	                            <td width="120" class="wrd_brk" title="'.$receive_num_arr[$mst_id][5].'=='.$receive_num_arr[$mst_id][6].'">';
                                if($row[csf("transaction_type")]==1)
                                {
                                    $html.=$booking_arr[$row[csf("order_id")]][trim($product_arr[$row[csf('prod_id')]]['color'])]['booking_no'];
                                }
                                else
                                {
                                    $html.=$rcv_booing_no;
                                }
	                            $html.='</td>
								<td width="100" class="wrd_brk">'.$fabric_source[$booking_arr[$row[csf("order_id")]][$product_arr[$row[csf('prod_id')]]['color']]['fabric_source']].'</td>
								<td width="100" class="wrd_brk">'.$construction_arr[$product_arr[$row[csf('prod_id')]]['detarmination_id']].'</td>
								<td width="110" class="wrd_brk">'.$composition_arr[$product_arr[$row[csf('prod_id')]]['detarmination_id']].'</td>
								<td width="80" class="wrd_brk">'.$color_arr[$product_arr[$row[csf('prod_id')]]['color']].'</td>
								<td width="50" class="wrd_brk">'.$product_arr[$row[csf('prod_id')]]['gsm'].'</td>
								<td width="50" class="wrd_brk">'.$product_arr[$row[csf('prod_id')]]['dia_width'].'</td>
								<td width="60" class="wrd_brk">'.$stitch_length.'</td>
								<td width="80" align="right" class="wrd_brk">';
                                if($row[csf("transaction_type")]==1){ $html.= number_format($row[csf("quantity")],2); $total_receive +=$row[csf("quantity")];}
                                $html.='</td>
                                <td width="50" class="wrd_brk">'.$unit_of_measurement[$row[csf("cons_uom")]].'</td>
                                <td width="80" align="right" class="wrd_brk">';
                                if($row[csf("transaction_type")]==4){ $html.= number_format($row[csf("quantity")],2); $total_issue_return +=$row[csf("quantity")];}
                                $html.='</td><td width="80" align="right" class="wrd_brk">';
                                if($row[csf("transaction_type")]==5){ $html.=number_format($row[csf("quantity")],2); $total_trans_in +=$row[csf("quantity")];}
                                $html.='</td><td width="80" align="right" class="wrd_brk">';
                                 if($row[csf("transaction_type")]==2 && $issue_purpose == 9){ $html.= number_format($row[csf("quantity")],2); $total_issue_bulkSewing +=$row[csf("quantity")];}
                                 $html.='</td><td width="80" align="right" class="wrd_brk">';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 4){ $html.= number_format($row[csf("quantity")],2); $total_issue_sampleWithOrder +=$row[csf("quantity")];}
                                $html.='</td><td width="80" align="right" class="wrd_brk">';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 8){ $html.= number_format($row[csf("quantity")],2); $total_issue_sampleWithOutOrder +=$row[csf("quantity")];}
                                $html.='</td><td width="80" align="right" class="wrd_brk">';
                                if($row[csf("transaction_type")]==6){ $html.= number_format($row[csf("quantity")],2); $total_trans_out +=$row[csf("quantity")];}
                                $html.='</td><td width="80" align="right" class="wrd_brk">';
                                if($row[csf("transaction_type")]==3){ $html.= number_format($row[csf("quantity")],2); $total_rcv_return +=$row[csf("quantity")];}
                                $html.='</td><td width="80" align="right" class="wrd_brk">';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 44){ $html.= number_format($row[csf("quantity")],2); $total_issue_rePocess +=$row[csf("quantity")];}
                                $html.='</td><td width="80" align="right" class="wrd_brk">';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 3){ $html.= number_format($row[csf("quantity")],2);
                                $total_issue_sales +=$row[csf("quantity")];}
                                $html.='</td><td width="80" align="right" class="wrd_brk">';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 10){ $html.= number_format($row[csf("quantity")],2); $total_issue_fabricTest +=$row[csf("quantity")];}
                                $html.='</td><td width="80" align="right" class="wrd_brk">';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 31){ $html.= number_format($row[csf("quantity")],2); $total_issue_scrapStore +=$row[csf("quantity")];}
                                $html.='</td><td width="80" align="right" class="wrd_brk">';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 26){ $html.= number_format($row[csf("quantity")],2); $total_issue_damage +=$row[csf("quantity")];}
                                $html.='</td><td width="80" align="right" class="wrd_brk">';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 30){ $html.= number_format($row[csf("quantity")],2); $total_issue_adjustment +=$row[csf("quantity")];}
                                $html.='</td><td width="80" align="right" class="wrd_brk">';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 29){ $html.= number_format($row[csf("quantity")],2); $total_issue_stolen +=$row[csf("quantity")];}
                                $html.='</td>';

                                if($rptType==2 || $rptType==1 )
                                {
                                    $rcv_cur=$rcv_ex_rate=$rcv_order_rate='';
                                    $order_amt=0;
                                    if($row[csf("transaction_type")]==1)
                                    {
                                        $rcv_cur= $currency[$receive_num_arr[$mst_id]["currency_id"]];
                                        $rcv_ex_rate= number_format($receive_num_arr[$mst_id]["exchange_rate"],2);
                                        $rcv_order_rate= number_format($row[csf("order_rate")],2);
                                        $order_amt=$row[csf("quantity")]*$row[csf("order_rate")];
                                        $total_order_amt+=$order_amt;
                                    }
                                    $html.='<td width="80">'.$rcv_cur.'</td>
                                    <td width="80" align="right">'.$rcv_ex_rate.'</td>
                                    <td width="80" align="right">'.$rcv_order_rate.'</td>
                                    <td width="80" align="right">'.number_format($order_amt,2,".","").'</td>';
                                }


                                $html.='<td width="100" align="right" class="wrd_brk">'.number_format($row[csf("cons_rate")],2).'</td>
	                            <td width="100" align="right">'.number_format($row[csf("quantity")]*$row[csf("cons_rate")],2);
								 $total_amounts +=$row[csf("quantity")]*$row[csf("cons_rate")];
                                $html.='</td><td width="70" class="wrd_brk">'.$bacth_no.'</td>
                                <td width="110" class="wrd_brk">'.$user_name_arr[$row[csf("inserted_by")]].'</td>
                                <td class="wrd_brk">'.$row[csf("insert_date")].'</td>
							</tr>';
							$i++;
						}
						unset($result_2);
						$html.='</tbody>
					</table>
					</div>
					<table width="4200" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="report_table_footer" align="left">
						<tfoot>
							<th width="30">&nbsp;</th>
							<th width="50">&nbsp;</th>
	                        <th width="100">&nbsp;</th>
							<th width="40">&nbsp;</th>
							<th width="70">&nbsp;</th>
	                        <th width="100">&nbsp;</th>
							<th width="70">&nbsp;</th>
							<th width="120">&nbsp;</th>
	                        <th width="80">&nbsp;</th>
	                        <th width="60">&nbsp;</th>
	                        <th width="70">&nbsp;</th>
							<th width="80">&nbsp;</th>
							<th width="80">&nbsp;</th>
							<th width="130">&nbsp;</th>';

							if($rptType==3)
							{
								$html.='<th width="80">&nbsp;</th>';
							}

							$html.='<th width="100">&nbsp;</th>';
							if($rptType==1 || $rptType==2)
							{
								$html.='<th width="80">&nbsp;</th>';
							}
							if($rptType==3)
							{
								$html.='<th width="100">&nbsp;</th>
                                <th width="100">&nbsp;</th>';
							}
							$html.='<th width="120">&nbsp;</th>
	                        <th width="120">&nbsp;</th>
							<th width="100">&nbsp;</th>
							<th width="100">&nbsp;</th>
							<th width="110">&nbsp;</th>
							<th width="80">&nbsp;</th>
							<th width="50">&nbsp;</th>
							<th width="50">&nbsp;</th>
							<th width="60">Total:</th>
	                        <th width="80" align="right" id="value_total_receive_overwrite_wasy">'.number_format($total_receive,2).'</th>
                            <th width="50">&nbsp;</th>
	                        <th width="80" align="right" id="value_total_issue_return">'.number_format($total_issue_return,2).'</th>
	                        <th width="80" align="right" id="value_total_trans_in">'.number_format($total_trans_in,2).'</th>
	                        <th width="80" align="right" id="value_total_issue_bulkSewing_overwrite">'.number_format($total_issue_bulkSewing,2).'</th>
	                        <th width="80" align="right" id="value_total_issue_sampleWithOrder_overwrite">'.number_format($total_issue_sampleWithOrder,2).'</th>
	                        <th width="80" align="right" id="value_total_issue_sampleWithOutOrder_overwrite">'.number_format($total_issue_sampleWithOutOrder,2).'</th>
	                        <th width="80" align="right" id="value_total_trans_out">'.number_format($total_trans_out,2).'</th>
	                        <th width="80" align="right" id="value_total_rcv_return">'.number_format($total_rcv_return,2).'</th>
	                        <th width="80" align="right" id="value_total_issue_rePocess">'.number_format($total_issue_rePocess,2).'</th>
	                        <th width="80" align="right" id="value_total_issue_sales">'.number_format($total_issue_sales,2).'</th>
	                        <th width="80" align="right" id="value_total_issue_fabricTest">'.number_format($total_issue_fabricTest,2).'</th>
	                        <th width="80" align="right" id="value_total_issue_scrapStore">'.number_format($total_issue_scrapStore,2).'</th>
	                        <th width="80" align="right" id="value_total_issue_damage">'.number_format($total_issue_damage,2).'</th>
	                        <th width="80" align="right" id="value_total_issue_adjustment">'.number_format($total_issue_adjustment,2).'</th>
	                        <th width="80" align="right" id="value_total_issue_stolen">'.number_format($total_issue_stolen,2).'</th>';

                            if($rptType==2 || $rptType==1 )
                            {
                                $html.='<th width="80">&nbsp;</th>
                                <th width="80">&nbsp;</th>
                                <th width="80">&nbsp;</th>
                                <th width="80" id="value_total_actual_amt">'.number_format($total_order_amt,2).'</th>';
                            }

                            $html.='
	                        <th width="100" align="right" id="value_total_amounts">'.number_format($total_amounts,2).'</th>
							<th width="100">'.number_format($total_amounts,2).'</th>
	                        <th width="70">&nbsp;</th>
							<th width="110">&nbsp;</th>
							<th>&nbsp;</th>
						</tfoot>
					</table>';
				}
				if($cbo_order_type==0 || $cbo_order_type==2) // Non Order Item
				{
					$html.='<table width="2210"  id="table_header_3" align="left">
	                    <tr>
	                        <td colspan="21"><span style="font-size:16px; font-weight:bold;">Non Order Item</span></td>
	                    </tr>
	                 </table>
	                <table width="2210" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="table_header_2" align="left">
						<thead>
							<tr>
								<th width="30" rowspan="2" >SL</th>
								<th width="50" rowspan="2" >Prod. Id</th>
								<th width="80"  rowspan="2">Trans. Date</th>
								<th width="120" rowspan="2" >Trans. Ref.</th>
								<th width="100" rowspan="2">Store Name</th>';

								if($rptType==3)
								{
									$html.='<th width="80" rowspan="2">Issue Purposed</th>';
								}

								$html.='<th width="100" rowspan="2" >Challan No</th>';
                                if($rptType==3)
                                {
                                    $html.='<th width="100">Department</th>
                                	<th width="100">Section</th>';
                                }
								$html.='<th width="120"  rowspan="2">Party Name</th>
								<th width="160" rowspan="2">Construction</th>
								<th width="130" rowspan="2">Composition</th>
								<th width="80" rowspan="2">Color</th>
								<th width="50" rowspan="2">GSM</th>
								<th width="50" rowspan="2">Dia</th>
	                            <th width="80" rowspan="2">Rack</th>
	                            <th width="240" colspan="3" class="extraThStyle">Receive</th>
	                            <th width="240" colspan="3" class="extraThStyle">Issue</th>
								<th width="70" rowspan="2">Batch No</th>
								<th width="110" rowspan="2">User</th>
								<th rowspan="2">Insert Date</th>
							</tr>
							<tr>
								<th width="80">Receive Qty</th>
	                            <th width="80">Issue ReturnQty</th>
	                            <th width="80">Trans. In Qty</th>
								<th width="80">Issue Qty</th>
	                            <th width="80">Trans. Out Qty</th>
	                            <th width="80">Receive Return Qty</th>
							</tr>
						</thead>
				   	</table>
					<table width="2210" class="rpt_table" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_body23" align="left">
					   	<tbody>';
							$j=1; $total_receive=""; $total_issue="";
							//$result=sql_select($sql);
							foreach($result_non_order_2 as $row)
							{
								if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

								$mst_id=$row[csf("mst_id")]; $bacth_no=$row[csf("batch_no")];
								$trasRef=''; $challan_no=''; $knitting_source=''; $knitting_company='';
								if($row[csf("transaction_type")]==1 || $row[csf("transaction_type")]==4)
								{
									$trasRef=$receive_num_arr[$mst_id]['recv_number'];
									$challan_no=$receive_num_arr[$mst_id]['challan_no'];
									$knitting_source=$receive_num_arr[$mst_id]['knitting_source'];

									if($knitting_source==1)
									{
										$knitting_company=$company_arr[$receive_num_arr[$mst_id]['knitting_company']];
									}
									else if($knitting_source==3)
									{
										$knitting_company=$supplier_arr[$receive_num_arr[$mst_id]['knitting_company']];
									}
								}
								else if($row[csf("transaction_type")]==2 || $row[csf("transaction_type")]==3)
								{
									$trasRef=$issue_num_arr[$mst_id]['issue_number'];
									$challan_no=$issue_num_arr[$mst_id]['challan_no'];
									$knitting_source=$issue_num_arr[$mst_id]['knit_dye_source'];

									if($knitting_source==1)
									{
										$knitting_company=$company_arr[$issue_num_arr[$mst_id]['knit_dye_company']];
									}
									else if($knitting_source==3)
									{
										$knitting_company=$supplier_arr[$issue_num_arr[$mst_id]['knit_dye_company']];
									}
								}

								$html.='<tr bgcolor="'.$bgcolor.'" onClick="change_color(\'tr_'.$i.'\',\''.$bgcolor.'\')" id="tr_'.$i.'">
									<td width="30">'.$j.'</td>
									<td width="50">'.$row[csf("prod_id")].'</td>

									<td width="80" align="center" class="wrd_brk">'.change_date_format($row[csf("transaction_date")]).'</td>
									<td width="120" class="wrd_brk">'.$trasRef.'</td>
									<td width="100">'.$store_arr[$row[csf("store_id")]].'</td>';

									if($rptType==3)
									{
										$html.='<td width="80">';
										if($row[csf("transaction_type")]==2)
										{
											$html.= $yarn_issue_purpose[$issue_num_arr[$mst_id]["issue_purpose"]];
										}
										$html.='</td>';
									}


									$html.='<td width="100" class="wrd_brk">'.$challan_no.'</td>';
                                    if($rptType==3)
                                    {
                                        $html.='<td width="100" align="center" class="wrd_brk">'.$department_arr[$row[csf("department_id")]].'</td>
                                        <td width="100" align="center" class="wrd_brk">'.$section_arr[$row[csf("section_id")]].'</td>';
                                    }
									$html.='<td width="120" class="wrd_brk">'.$knitting_company.'</td>
		                            <td width="160" class="wrd_brk">'.$construction_arr[$product_arr[$row[csf('prod_id')]]['detarmination_id']].'</td>
									<td width="130" class="wrd_brk">'.$composition_arr[$product_arr[$row[csf('prod_id')]]['detarmination_id']].'</td>
									<td width="80" class="wrd_brk">'.$color_arr[$product_arr[$row[csf('prod_id')]]['color']].'</td>
									<td width="50" class="wrd_brk">'.$product_arr[$row[csf('prod_id')]]['gsm'].'</td>
									<td width="50" class="wrd_brk">'.$product_arr[$row[csf('prod_id')]]['dia_width'].'</td>
									<td width="80" class="wrd_brk">'.$row[csf("rack")].'</td>
		                            <td width="80" align="right" class="wrd_brk">';
									if($row[csf("transaction_type")]==1)
                                    { //Receive
                                        $html.=number_format($row[csf("qty")],2);
                                        $total_receive_non_order +=$row[csf("qty")];
                                    }
									$html.='</td>
									<td width="80" class="wrd_brk">';
                                    if($row[csf("transaction_type")]==4){ //Issue Return
                                        $html.= number_format($row[csf("qty")],2);
                                        $total_issue_return_non_order +=$row[csf("qty")];
                                    }
									$html.='</td>
									<td width="80" class="wrd_brk">';
                                    if($row[csf("transaction_type")]==5){ // Transfer In
                                        $html.=number_format($row[csf("qty")],2);
                                        $total_transfer_in_non_order +=$row[csf("qty")];
                                    }
									$html.='</td>
									<td align="right" width="80" class="wrd_brk">';
                                    if($row[csf("transaction_type")]==2){ //Issue
                                        $html.= number_format($row[csf("qty")],2);
                                        $total_issue_non_order +=$row[csf("qty")];
                                    }
									$html.='</td>
									<td width="80" class="wrd_brk">';
                                    if($row[csf("transaction_type")]==3){ //Receive Return
                                        $html.=number_format($row[csf("qty")],2);
                                        $total_receive_return_non_order +=$row[csf("qty")];
                                    }
									$html.='</td>
									<td width="80" class="wrd_brk">';
                                    if($row[csf("transaction_type")]==6){ //Transfer Out
                                        $html.=number_format($row[csf("qty")],2);
                                        $total_transfer_out_non_order +=$row[csf("qty")];
                                    }
									$html.='</td>
									<td width="70" class="wrd_brk">'.$bacth_no.'</td>
									<td width="110" class="wrd_brk">'.$user_name_arr[$row[csf("inserted_by")]].'</td>
									<td class="wrd_brk">'.$row[csf("insert_date")].'</td>
								</tr>';
								$i++;$j++;
							}
							unset($result_non_order_2);
                        $html.='</tbody>
					</table>
					<table width="2110" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="report_table_footer2" align="left">
						<tfoot>
								<th width="30">&nbsp;</th>
								<th width="50">&nbsp;</th>
								<th width="80">&nbsp;</th>
								<th width="120">&nbsp;</th>
								<th width="100">&nbsp;</th>
								';

								if($rptType==3)
								{
									$html.='<th width="80">&nbsp;</th>';
								}

								$html.='<th width="100">&nbsp;</th>';
								if($rptType==3)
								{
									$html.='<th width="100">&nbsp;</th>
                                    <th width="100">&nbsp;</th>';
								}
								$html.='<th width="120">&nbsp;</th>
								<th width="160">&nbsp;</th>
								<th width="130">&nbsp;</th>
								<th width="80">&nbsp;</th>
								<th width="50">&nbsp;</th>
								<th width="50">&nbsp;</th>
		                        <th width="80">Total:</th>
								<th width="80" >'.number_format($total_receive_non_order,2).'</th>
								<th width="80" >'.number_format($total_issue_return_non_order,2).'</th>
								<th width="80" >'.number_format($total_transfer_in_non_order,2).'</th>
								<th width="80" >'.number_format($total_issue_non_order,2).'</th>
								<th width="80" >'.number_format($total_receive_return_non_order,2).'</th>
								<th width="80" >'.number_format($total_transfer_out_non_order,2).';</th>
								<th width="70">&nbsp;</th>
								<th width="110">&nbsp;</th>
								<th >&nbsp;</th>
						</tfoot>
					</table>';
				}
            $html.='</div>';
        }
        else
        {
            $show_html_2 =0;
        }
	} //Woven Finish

	if(($key = array_search(13, $cbo_item_cat)) !== false) // Grey Fabric(Knit)
	{
        unset($cbo_item_cat[$key]);
		$composition_arr=array();
		$construction_arr=array();
		$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0";
		$data_array=sql_select($sql_deter);
		if(count($data_array)>0)
		{
			foreach( $data_array as $row )
			{
				if(array_key_exists($row[csf('id')],$construction_arr))
				{
					$construction_arr[$row[csf('id')]]=$construction_arr[$row[csf('id')]];
				}
				else
				{
					$construction_arr[$row[csf('id')]]=$row[csf('construction')];
				}
				if(array_key_exists($row[csf('id')],$composition_arr))
				{
					$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]];
				}
				else
				{
					$composition_arr[$row[csf('id')]]=$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
				}
			}
		}

		if($cbo_order_type==2)
		{
			$scroll_div="scroll_body";
			$scroll_div_width="1650px";
			$table_width=1630;
		}
		else
		{
			$scroll_div="";
			$scroll_div_width="2130px";
			$table_width=2110;
		}

		$yarn_count_arr=return_library_array( "select id, yarn_count from  lib_yarn_count where status_active=1 and is_deleted=0",'id','yarn_count');

		if($cbo_order_type==0 || $cbo_order_type==1)
		{

			if($cbo_buyer_name!=0) $buyer_cond=" and a.buyer_name=$cbo_buyer_name"; else $buyer_cond="";

			$source_cond_rcv="";
			if($cbo_knitting_source>0) $source_cond_rcv=" and p.knitting_source=$cbo_knitting_source";

			$source_cond_issue="";
			if($cbo_knitting_source>0) $source_cond_issue=" and p.knit_dye_source=$cbo_knitting_source";

			if($rptType==1)
			{
				$sql="SELECT p.id as rece_issue_id, p.recv_number as rcv_issue_no, p.challan_no, p.knitting_source, p.knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 1 as type, b.is_sales, p.booking_no,a.STORE_ID
				from inv_receive_master p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(1,4) and b.trans_type in(1,4) $date_cond $source_cond_rcv $sql_cond $transaction_ids_cond_for_mrr
				union all
				select p.id as rece_issue_id, p.issue_number as rcv_issue_no, p.challan_no, p.knit_dye_source as knitting_source, p.knit_dye_company as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 2 as type, b.is_sales, p.booking_no,a.STORE_ID
				from  inv_issue_master p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(2,3) and b.trans_type in(2,3) $date_cond $source_cond_issue $sql_cond $transaction_ids_cond_for_mrr
				union all
				select p.id as rece_issue_id, p.transfer_system_id as rcv_issue_no, p.challan_no, 0 as knitting_source, 0 as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 3 as type, b.is_sales,null as booking_no,a.STORE_ID
				from  inv_item_transfer_mst p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(5,6) and b.trans_type in(5,6) $date_cond $sql_cond $transaction_ids_cond_for_mrr
				order by transaction_date, trans_id";
				//echo $sql;//die;
			}
			else if($rptType==2)
			{
				$sql="SELECT p.id as rece_issue_id, p.recv_number as rcv_issue_no, p.challan_no, p.knitting_source, p.knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 1 as type, b.is_sales, p.booking_no,a.STORE_ID
				from inv_receive_master p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(1,4) and b.trans_type in(1,4) $date_cond $source_cond_rcv $sql_cond $transaction_ids_cond_for_mrr
				union all
				select p.id as rece_issue_id, p.transfer_system_id as rcv_issue_no, p.challan_no, 0 as knitting_source, 0 as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 3 as type, b.is_sales, null as booking_no,a.STORE_ID
				from  inv_item_transfer_mst p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(5) and b.trans_type in(5) $date_cond $sql_cond $transaction_ids_cond_for_mrr
				union all
				select p.id as rece_issue_id, p.issue_number as rcv_issue_no, p.challan_no, p.knit_dye_source as knitting_source, p.knit_dye_company as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 2 as type, b.is_sales, p.booking_no,a.STORE_ID
				from  inv_issue_master p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and p.entry_form=45 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(3) and b.trans_type in(3) $date_cond $source_cond_issue $sql_cond $transaction_ids_cond_for_mrr
				order by transaction_date, trans_id";
			}
			else if($rptType==3)
			{
				$sql="SELECT p.id as rece_issue_id, p.issue_number as rcv_issue_no, p.challan_no, p.knit_dye_source as knitting_source, p.knit_dye_company as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 2 as type, b.is_sales, a.department_id, a.section_id,p.booking_no,a.STORE_ID
				from  inv_issue_master p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(2,3) and b.trans_type in(2,3) $date_cond $order_propo_cond  $source_cond_issue $sql_cond $transaction_ids_cond_for_mrr
				union all
				select p.id as rece_issue_id, p.transfer_system_id as rcv_issue_no, p.challan_no, 0 as knitting_source, 0 as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 3 as type, b.is_sales, a.department_id, a.section_id, null as booking_no,a.STORE_ID
				from  inv_item_transfer_mst p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(6) and b.trans_type in(6) $date_cond $order_propo_cond $sql_cond $transaction_ids_cond_for_mrr
				union all
				SELECT p.id as rece_issue_id, p.recv_number as rcv_issue_no, p.challan_no, p.knitting_source, p.knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 1 as type, b.is_sales, a.department_id, a.section_id, p.booking_no,a.STORE_ID
				from inv_receive_master p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(1,4) and b.trans_type in(1,4) $date_cond $order_propo_cond $source_cond_rcv $sql_cond $transaction_ids_cond_for_mrr
				order by transaction_date, trans_id";
			}

			$result_13=sql_select($sql);
            $order_ids="";
			$salesorderids_arr=array();
            $orderids_arr=array();
            $prod_ids_arr=array();
            $receive_dtlsids_arr=array();
            $issue_dtlsids_arr=array();
            $transfer_dtlsids_arr=array();
			foreach($result_13 as $rows)
			{
                if ($rows[csf('order_id')]>0) {
                    if($rows[csf("is_sales")]==1) $salesorderids_arr[$rows[csf("order_id")]]=$rows[csf("order_id")];
                    else $orderids_arr[$rows[csf("order_id")]]=$rows[csf("order_id")];
                }
                if ($rows[csf('prod_id')]>0) $prod_ids_arr[$rows[csf("prod_id")]]=$rows[csf("prod_id")];

                if ($rows[csf("dtls_id")] > 0)
                {
                    if ($rows[csf("transaction_type")]==1){
                        $receive_dtlsids_arr[$rows[csf("dtls_id")]]=$rows[csf("dtls_id")];
                    } else if ($rows[csf("transaction_type")]==2) {
                        $issue_dtlsids_arr[$rows[csf("mst_id")]]=$rows[csf("mst_id")];
                    } else if ($rows[csf("transaction_type")]==5 || $rows[csf("transaction_type")]==6) {
                        $transfer_dtlsids_arr[$rows[csf("dtls_id")]]=$rows[csf("dtls_id")];
                    }
                }
			}
		}

        if($db_type==0) $selected_year="year(a.insert_date) as job_year";
        else $selected_year="to_char(a.insert_date,'YYYY') as job_year";

        $sales_data_arr=array();
        if (count($salesorderids_arr)>0)
        {

            fnc_tempengine("gbl_temp_engine", $user_id, 33, 20, $salesorderids_arr, $empty_arr);

            $sql_sales_data=sql_select("SELECT a.id, a.job_no, a.sales_booking_no, a.within_group, a.buyer_id, a.style_ref_no, a.booking_without_order, $selected_year from fabric_sales_order_mst a, gbl_temp_engine g where a.id=g.ref_val and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=20");

            foreach($sql_sales_data as $row)
            {
                $sales_data_arr[$row[csf("id")]]['job_no']=$row[csf("job_no")];
                $sales_data_arr[$row[csf("id")]]['sales_booking_no']=$row[csf("sales_booking_no")];
                $sales_data_arr[$row[csf("id")]]['within_group']=$row[csf("within_group")];
                $sales_data_arr[$row[csf("id")]]['buyer_id']=$row[csf("buyer_id")];
                $sales_data_arr[$row[csf("id")]]['style_ref_no']=$row[csf("style_ref_no")];
                $sales_data_arr[$row[csf("id")]]['job_year']=$row[csf("job_year")];
            }
            unset($sql_sales_data);
        }

        $job_order_data=array();
        if (count($orderids_arr)>0)
        {

            fnc_tempengine("gbl_temp_engine", $user_id, 33, 21, $orderids_arr, $empty_arr);

            $sql_job_data=sql_select("SELECT a.job_no_prefix_num as JOB_NO, $select_year(a.insert_date $year_con) as JOB_YEAR, a.buyer_name as BUYER_NAME, a.style_ref_no as STYLE_REF_NO, b.id as ID, b.grouping as REF_NO,b.file_no as FILE_NO,b.po_number as PO_NUMBER, b.shipment_date as SHIPMENT_DATE from wo_po_details_master a, wo_po_break_down b, gbl_temp_engine g where a.id=b.job_id and b.id=g.ref_val and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=21");

            foreach($sql_job_data as $row)
            {
                $job_order_data[$row["ID"]][1]=$row["JOB_NO"];
                $job_order_data[$row["ID"]][2]=$row["JOB_YEAR"];
                $job_order_data[$row["ID"]][3]=$row["BUYER_NAME"];
                $job_order_data[$row["ID"]][4]=$row["PO_NUMBER"];
                $job_order_data[$row["ID"]][5]=$row["SHIPMENT_DATE"];
                $job_order_data[$row["ID"]][6]=$row["STYLE_REF_NO"];
                $job_order_data[$row["ID"]][7]=$row["REF_NO"];
                $job_order_data[$row["ID"]][8]=$row["FILE_NO"];
            }
            unset($sql_job_data);
        }

        if($cbo_order_type==0 || $cbo_order_type==2)
        {
            $source_cond_rcv="";
            if($cbo_knitting_source>0) $source_cond_rcv=" and b.knitting_source=$cbo_knitting_source";

            $source_cond_issue="";
            if($cbo_knitting_source>0) $source_cond_issue=" and b.knit_dye_source=$cbo_knitting_source";

            if($rptType==1)
            {
				$sql_non_order_13="SELECT b.recv_number as tran_ref, b.challan_no, b.knitting_source as knitting_source, b.knitting_company as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, a.prod_id, a.cons_quantity as qty, a.inserted_by,a.STORE_ID, $select_insert_date from inv_receive_master b, inv_transaction a where b.id=a.mst_id and a.item_category=13 and a.company_id=$cbo_company_name and b.item_category=13 and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and a.booking_without_order=1 and a.transaction_type in(1,4) and b.entry_form in (2,22,51,58) $date_cond $source_cond_rcv $transaction_ids_cond_for_mrr
				union all
				SELECT b.issue_number as tran_ref, b.challan_no, b.knit_dye_source as knitting_source, b.knit_dye_company as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, a.prod_id, a.cons_quantity as qty, a.inserted_by,a.STORE_ID, $select_insert_date from inv_issue_master b, inv_transaction a where b.id=a.mst_id and a.item_category=13 and a.company_id=$cbo_company_name and b.item_category=13 and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.issue_purpose=8 and a.transaction_type in(2,3) and b.entry_form in (16,45,61) $date_cond $source_cond_issue $transaction_ids_cond_for_mrr
				order by transaction_date, trans_id";
            }
            else if($rptType==2)
            {
				$sql_non_order_13="SELECT b.recv_number as tran_ref, b.challan_no, b.knitting_source as knitting_source, b.knitting_company as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, a.prod_id, a.cons_quantity as qty, a.inserted_by,a.STORE_ID, $select_insert_date
				from inv_receive_master b, inv_transaction a
				where b.id=a.mst_id and a.item_category=13 and a.company_id=$cbo_company_name and b.item_category=13 and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and a.booking_without_order=1 and a.transaction_type in(1,4) and b.entry_form in (2,22,51,58) $date_cond $source_cond_rcv $transaction_ids_cond_for_mrr order by a.transaction_date, a.id";
            }
            else if($rptType==3)
            {
				$sql_non_order_13="SELECT b.issue_number as tran_ref, b.challan_no, b.knit_dye_source as knitting_source, b.knit_dye_company as knitting_company,b.issue_purpose, a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, a.prod_id, a.cons_quantity as qty, a.inserted_by,a.STORE_ID, a.department_id, a.section_id, $select_insert_date
				from inv_issue_master b, inv_transaction a
				where b.id=a.mst_id and a.item_category=13 and a.company_id=$cbo_company_name and b.item_category=13 and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.issue_purpose=8 and a.transaction_type in(2,3) and b.entry_form in (16,45,61) $date_cond $source_cond_issue $transaction_ids_cond_for_mrr
				order by a.transaction_date, a.id";
            }
            $result_non_order_13=sql_select($sql_non_order_13);
            foreach($result_non_order_13 as $rows)
			{
                if ($rows[csf('prod_id')]>0) $prod_ids_arr[$rows[csf("prod_id")]]=$rows[csf("prod_id")];
			}
        }

        $product_arr=array();
        if (count($prod_ids_arr)>0)
        {

            fnc_tempengine("gbl_temp_engine", $user_id, 33, 22, $prod_ids_arr, $empty_arr);

            $sql_prod_res=sql_select("SELECT a.id as ID, a.detarmination_id as DETARMINATION_ID, a.gsm as GSM, a.dia_width as DIA_WIDTH from product_details_master a, gbl_temp_engine g where a.id=g.ref_val and a.item_category_id=13 and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=22");

            foreach($sql_prod_res as $row)
            {
                $product_arr[$row["ID"]][1]=$row['DETARMINATION_ID'];
                $product_arr[$row["ID"]][2]=$row['GSM'];
                $product_arr[$row["ID"]][3]=$row['DIA_WIDTH'];
            }
            unset($sql_prod_res);
        }

        $receive_num_arr=array();
        $trans_Id_arr=array();
        if (count($receive_dtlsids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 23, $receive_dtlsids_arr, $empty_arr);
            $sql_receive_res=sql_select("SELECT a.id as ID, a.yarn_lot as YARN_LOT, a.yarn_count as YARN_COUNT, a.stitch_length as STITCH_LENGTH, a.color_id as COLOR_ID, a.trans_id as TRANS_ID from gbl_temp_engine g, pro_grey_prod_entry_dtls a where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=23 and a.status_active=1 and a.is_deleted=0");
            foreach($sql_receive_res as $row)
            {
                $receive_num_arr[$row["ID"]][5]=$row["YARN_LOT"];
                $receive_num_arr[$row["ID"]][6]=$row["YARN_COUNT"];
                $receive_num_arr[$row["ID"]][7]=$row["STITCH_LENGTH"];
                $receive_num_arr[$row["ID"]][8]=$row["COLOR_ID"];
                $trans_Id_arr[$row["TRANS_ID"]][1]=$row["ID"];
            }
            unset($sql_receive_res);
        }

        $issue_num_arr=array();
        if (count($issue_dtlsids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 24, $issue_dtlsids_arr, $empty_arr);
            // $sql_issue_res=sql_select("SELECT a.id as ID, a.yarn_lot as YARN_LOT, a.yarn_count as YARN_COUNT, a.stitch_length as STITCH_LENGTH, a.color_id as COLOR_ID, a.trans_id as TRANS_ID from gbl_temp_engine g, inv_grey_fabric_issue_dtls a  where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=24 and a.status_active=1 and a.is_deleted=0");
			$sql_issue_res=sql_select("SELECT a.id as ID, a.yarn_lot as YARN_LOT, a.yarn_count as YARN_COUNT, a.stitch_length as STITCH_LENGTH, a.color_id as COLOR_ID, a.trans_id as TRANS_ID,b.ISSUE_PURPOSE from gbl_temp_engine g, inv_grey_fabric_issue_dtls a,INV_ISSUE_MASTER b  where g.ref_val=a.id and a.mst_id=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=24 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0");
            foreach($sql_issue_res as $row)
            {
                $issue_num_arr[$row["ID"]][5]=$row["YARN_LOT"];
                $issue_num_arr[$row["ID"]][6]=$row["YARN_COUNT"];
                $issue_num_arr[$row["ID"]][7]=$row["STITCH_LENGTH"];
                $issue_num_arr[$row["ID"]][8]=$row["COLOR_ID"];
                $trans_Id_arr[$row["TRANS_ID"]][2]=$row["ID"];
				$issue_num_arr[$row["ID"]]["issue_purpose"]=$row["ISSUE_PURPOSE"];
            }
            unset($sql_issue_res);
        }

        $transfer_num_arr=array();
        if (count($transfer_dtlsids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 25, $transfer_dtlsids_arr, $empty_arr);
            $sql_transfer_res=sql_select("SELECT a.transfer_system_id as TRANSFER_SYSTEM_ID, a.challan_no as CHALLAN_NO, b.id as ID, b.y_count as Y_COUNT, b.yarn_lot as YARN_LOT, b.stitch_length as STITCH_LENGTH from gbl_temp_engine g, inv_item_transfer_mst a, inv_item_transfer_dtls b where g.ref_val=a.id and a.id=b.mst_id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=25 and b.item_category=13 and a.status_active=1 and a.is_deleted=0");
            foreach($sql_transfer_res as $row)
            {
                $id=$row["ID"];
                $transfer_num_arr[$id][1]=$row["TRANSFER_SYSTEM_ID"];
                $transfer_num_arr[$id][2]=$row["CHALLAN_NO"];
                $transfer_num_arr[$id][3]=$row["Y_COUNT"];
                $transfer_num_arr[$id][3]=$row["YARN_LOT"];
                $transfer_num_arr[$id][3]=$row["STITCH_LENGTH"];
            }
            unset($sql_transfer_res);
        }

        $show_html_13 = 1;
        if(count($result_13) > 0 || count($result_non_order_13) > 0)
        {
			$html.='<div style="width:'.$scroll_div_width.'" id="'.$scroll_div.'">
				<table width="'.$table_width.'" id="" align="left">
					<tr class="form_caption" style="border:none;">
						<td colspan="23" align="left" style="border:none;font-size:16px; font-weight:bold" > Grey Fabric(Knit): </td>
					</tr>
			   </table>
			   <br />';
			if($cbo_order_type==0 || $cbo_order_type==1)
			{
				$html.='<table width="2860" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="table_header_1" align="left">
					<thead>
						<tr>
							<th width="30" >SL</th>
							<th width="50" >Prod. Id</th>
							<th width="60" >Year</th>
							<th width="50" >Job No</th>
                            <th width="100" >Style No</th>
							<th width="70">Buyer</th>
							<th width="120">Order No</th>
                            <th width="60">File No</th>
                            <th width="70">Int Ref</th>
							<th width="80">Ship Date</th>
							<th width="80" >Trans. Date</th>
							<th width="130" >Trans. Ref.</th>
							<th width="100" >Store Name</th>';

							if($rptType==3)
							{
								$html.='<th width="80" >Issue Purposed</th>';
							}

							$html.='<th width="70">WO/PI</th>
							<th width="100">Challan No</th>';
                            if($rptType==3)
							{
								$html.='<th width="100">Department</th>
                                <th width="100">Section</th>';
							}
							$html.='<th width="120">Party Name</th>
							<th width="80" >Yarn Lot</th>
							<th width="80" >Yarn Count</th>
							<th width="100">Construction</th>
							<th width="110">Composition</th>
							<th width="80">Color</th>
							<th width="50">GSM</th>
							<th width="50">Dia</th>
							<th width="60">Stitch Lenth</th>
							<th width="80">Receive Qty</th>
							<th width="80">Receive Return Qty</th>
                            <th width="80">Transfer In Qty</th>
							<th width="80">Issue Qty</th>
                            <th width="80">Issue ReturnQty</th>
                            <th width="80">Transfer Out Qty</th>
							<th width="110">User</th>
							<th width="160">Insert Date</th>
						</tr>
					</thead>
			   	</table>
                <div style="width:2880px; overflow-y: scroll; max-height:250px;" id="scroll_body13" class="scroll_div_class">
				<table width="2860" class="rpt_table" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_body_13" align="left">
					<tbody>';
					$i=1; $total_receive=""; $total_issue="";

					foreach($result_13 as $row)
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

						$shipment_date=$job_order_data[$row[csf("order_id")]][5];

						$mst_id=$row[csf("mst_id")]; $dtls_id=$row[csf("dtls_id")];
						$trasRef=''; $challan_no=''; $knitting_source=''; $knitting_company=''; $yarn_lot=''; $yarn_count=''; $stitch_length=''; $color_id='';
						$trasRef=$row[csf("rcv_issue_no")];
						$booking_no=$row[csf("booking_no")];
						$challan_no=$row[csf("challan_no")];
						$knitting_source=$row[csf("knitting_source")];
						if($knitting_source==1)
						{
							$knitting_company=$company_arr[$row[csf("knitting_company")]];
						}
						else if($knitting_source==3)
						{
							$knitting_company=$supplier_arr[$row[csf("knitting_company")]];
						}

						if($row[csf("transaction_type")]==1)
						{
							$yarn_lot=$receive_num_arr[$dtls_id][5];
							$yarn_count=$receive_num_arr[$dtls_id][6];
							$stitch_length=$receive_num_arr[$dtls_id][7];
							$color_id=$receive_num_arr[$dtls_id][8];
						}
						else if($row[csf("transaction_type")]==4)
						{
							$yarn_lot=$row[csf("batch_lot")];
							$yarn_count=$row[csf("yarn_count")];
							$stitch_length=$row[csf("stitch_length")];
						}
						else if($row[csf("transaction_type")]==2)
						{
							$yarn_lot=$issue_num_arr[$dtls_id][5];
							$yarn_count=$issue_num_arr[$dtls_id][6];
							$stitch_length=$issue_num_arr[$dtls_id][7];
							$color_id=$issue_num_arr[$dtls_id][8];
						}
						else if($row[csf("transaction_type")]==3)
						{
							$yarn_lot=$row[csf("batch_lot")];
							$yarn_count=$row[csf("yarn_count")];
							$stitch_length=$row[csf("stitch_length")];
						}
						else
						{
							$yarn_lot=$transfer_num_arr[$dtls_id][3];
							$yarn_count=$transfer_num_arr[$dtls_id][4];
							$stitch_length=$transfer_num_arr[$dtls_id][5];
						}

						$color='';
						$color_ids=explode(",",$color_id);
						foreach($color_ids as $val)
						{
							if($val>0) $color.=$color_arr[$val].",";
						}
						$color=chop($color,',');

						$yarn_count_name='';
						$yarn_counts=explode(",",$yarn_count);
						foreach($yarn_counts as $val)
						{
							if($val>0) $yarn_count_name.=$yarn_count_arr[$val].",";
						}
						$yarn_count_name=chop($yarn_count_name,',');

						$html.='<tr bgcolor="'.$bgcolor.'" onClick="change_color(\'tr_'.$i.'\',\''.$bgcolor.'\')" id="tr_'.$i.'">
							<td width="30">'.$i.'</td>
							<td width="50">'.$row[csf("prod_id")].'</td>
							<td width="60" align="center" class="wrd_brk">';
							if ($row[csf("is_sales")]==1)
							{
								$html.= $sales_data_arr[$row[csf("order_id")]]['job_year'];
							}
							else
							{
								$html.= $job_order_data[$row[csf("order_id")]][2];
							}
							$html.='</td>
							<td width="50" align="center" class="wrd_brk">';
							if ($row[csf("is_sales")]!=1)
							{
								$html.= $job_order_data[$row[csf("order_id")]][1];
							}
							$html.='</td>
                            <td width="100" class="wrd_brk">';
                            if ($row[csf("is_sales")]==1)
							{
								$html.= $sales_data_arr[$row[csf("order_id")]]['style_ref_no'];
							}
							else
							{
								$html.= $job_order_data[$row[csf("order_id")]][6];
							}
							$html.='</td>
							<td width="70" class="wrd_brk">';
							if ($row[csf("is_sales")]==1)
							{
								if($sales_data_arr[$row[csf("order_id")]]['within_group']==2)
								{
									$html.= $buyer_short_arr[$sales_data_arr[$row[csf("order_id")]]['buyer_id']];
								}
								else
								{
									$html.= $company_arr[$sales_data_arr[$row[csf("order_id")]]['buyer_id']];
								}

							}
							else
							{
								$html.= $buyer_short_arr[$job_order_data[$row[csf("order_id")]][3]];
							}
							$html.='</td>
							<td width="120" class="wrd_brk">';
							if ($row[csf("is_sales")]==1)
							{
								$html.= $sales_data_arr[$row[csf("order_id")]]['job_no'];
							}
							else
							{
								$html.= $job_order_data[$row[csf("order_id")]][4];
							}
							$html.='</td>
                            <td width="60" title="File No" class="wrd_brk">';
                            if ($row[csf("is_sales")]!=1)
							{
								$html.= $job_order_data[$row[csf("order_id")]][8];
							}
							$html.='</td>
                            <td width="70" title="Ref. No" class="wrd_brk">';
                            if ($row[csf("is_sales")]!=1)
							{
								$html.= $job_order_data[$row[csf("order_id")]][7];
							}
							$html.='</td>
							<td width="80" align="center" class="wrd_brk">';
							if ($row[csf("is_sales")]!=1)
							{
								if($shipment_date!="0000-00-00" && $shipment_date!="") $html.= change_date_format($shipment_date);
							}
							$html.='</td>
							<td width="80" align="center" class="wrd_brk">'.change_date_format($row[csf("transaction_date")]).'</td>
							<td width="130" class="wrd_brk"><a href="##" onClick="openmypage_mrr(\'mrr_popup\',\''.$row[csf("transaction_type")].'\',\''.$row[csf("trans_id")].'\',\''.$cbo_company_name.'\');">'.$trasRef.'</a></td>
							<td width="100">'.$store_arr[$row[csf("store_id")]].'</td>';
							
							if($rptType==3)
							{
								$html.='<td width="80">';
								if($row[csf("transaction_type")]==2)
								{
									$html.= $yarn_issue_purpose[$issue_num_arr[$mst_id]["issue_purpose"]];
								}
								$html.='</td>';
							}

							$html.='<td width="70" class="wrd_brk">'.$booking_no.'</td>
							<td width="100" class="wrd_brk">'.$challan_no.'</td>';
                            if($rptType==3)
							{
								$html.='<td width="100" align="center" class="wrd_brk">'.$department_arr[$row[csf("department_id")]].'</td>
                                <td width="100" align="center" class="wrd_brk">'.$section_arr[$row[csf("section_id")]].'</td>';
							}
							$html.='<td width="120" class="wrd_brk">'.$knitting_company.'</td>
							<td width="80" class="wrd_brk">'.$yarn_lot.'</td>
							<td width="80" class="wrd_brk">'.$yarn_count_name.'</td>
							<td width="100" class="wrd_brk">'.$construction_arr[$product_arr[$row[csf('prod_id')]][1]].'</td>
							<td width="110" class="wrd_brk">'.$composition_arr[$product_arr[$row[csf('prod_id')]][1]].'</td>
							<td width="80" class="wrd_brk">'.$color.'</td>
							<td width="50" class="wrd_brk">'.$product_arr[$row[csf('prod_id')]][2].'</td>
							<td width="50" class="wrd_brk">'.$product_arr[$row[csf('prod_id')]][3].'</td>
                            <td width="60" class="wrd_brk">'.$stitch_length.'</td>
							<td width="80" align="right" class="wrd_brk">';
                            if($row[csf("transaction_type")]==1){ $html.= number_format($row[csf("quantity")],2); $total_receive +=$row[csf("quantity")];}
                            $html.='</td><td width="80" align="right" class="wrd_brk">';
                            if($row[csf("transaction_type")]==3){ $html.= number_format($row[csf("quantity")],2); $total_ret_receive +=$row[csf("quantity")];}
                            $html.='</td><td width="80" align="right" class="wrd_brk">';
                            if($row[csf("transaction_type")]==5){ $html.= number_format($row[csf("quantity")],2); $total_trans_in +=$row[csf("quantity")];}
                            $html.='</td><td align="right" width="80" class="wrd_brk">';
							if($row[csf("transaction_type")]==2){ $html.= number_format($row[csf("quantity")],2); $total_issue +=$row[csf("quantity")];}
							$html.='</td><td width="80" align="right" class="wrd_brk">';
                            if($row[csf("transaction_type")]==4){ $html.= number_format($row[csf("quantity")],2); $total_ret_receive +=$row[csf("quantity")];}
                            $html.='</td>
                            <td width="80" align="right" class="wrd_brk">';
                            if($row[csf("transaction_type")]==6){ $html.= number_format($row[csf("quantity")],2); $total_trans_out +=$row[csf("quantity")];}
                            $html.='</td>
							<td width="110" class="wrd_brk">'.$user_name_arr[$row[csf("inserted_by")]].'</td>
							<td width="160" class="wrd_brk">'.$row[csf("insert_date")].'</td>
						</tr>';
						$i++;
					}
					unset($result);
					$html.='</tbody>
				</table>
				<table width="2860" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="report_table_footer" align="left">
					<tfoot>
						<th width="30">&nbsp;</th>
						<th width="50">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="50">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="120">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="130">&nbsp;</th>
						<th width="100">&nbsp;</th>';

						if($rptType==3)
						{
							$html.='<th width="80">&nbsp;</th>';
						}
						
						$html.='<th width="70">&nbsp;</th>
						<th width="100">&nbsp;</th>';
                        if($rptType==3)
						{
							$html.='<th width="100">&nbsp;</th>
                            <th width="100">&nbsp;</th>';
						}

						$html.='<th width="120">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="110">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="50">&nbsp;</th>
						<th width="50">&nbsp;</th>
						<th width="60">Total:</th>
						<th width="80" id="value_total_receive_g">'.number_format($total_receive,2).'</th>
                        <th width="80" id="value_total_ret_receive_g">'.number_format($total_ret_receive,2).'</th>
                        <th width="80" id="value_total_trans_in_g">'.number_format($total_trans_in,2).'</th>
						<th width="80" id="value_total_issue_g">'.number_format($total_issue,2).'</th>
                        <th width="80" id="value_total_ret_issue_g">'.number_format($total_ret_issue,2).'</th>
                        <th width="80" id="value_total_trans_out_g">'.number_format($total_trans_out,2).'</th>
						<th width="110">&nbsp;</th>
						<th width="160">&nbsp;</th>
					</tfoot>
				</table>
			 	</div>';
			}

			if($cbo_order_type==0 || $cbo_order_type==2)
			{

				//echo $sql;
				$html.='<br />
	            <table width="1730" id="table_header_3" align="left">
	                <tr>
	                    <td><span style="font-size:16px; font-weight:bold;">Non Order Item</span></td>
	                </tr>
	            </table>
             	<table width="1930" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="table_header_2" align="left">
                    <thead>
                        <tr>
                            <th width="30">SL</th>
                            <th width="50">Prod. Id</th>
                            <th width="80">Trans. Date</th>
                            <th width="130">Trans. Ref.</th>
							<th width="100" >Store Name</th>';

							if($rptType==3)
							{
								$html.='<th width="80" >Issue Purposed</th>';
							}

                            $html.='<th width="100">Challan No</th>';
                            if($rptType==3)
							{
								$html.='<th width="100">Department</th>
                                <th width="100">Section</th>';
							}
							$html.='<th width="120">Party Name</th>
                            <th width="80">Yarn Lot</th>
                            <th width="80">Yarn Count</th>
                            <th width="100">Construction</th>
                            <th width="110">Composition</th>
                            <th width="80">Color</th>
                            <th width="50">GSM</th>
                            <th width="50">Dia</th>
                            <th width="60">Stitch Lenth</th>
                            <th width="80">Receive Qty</th>
                            <th width="80">Issue Qty</th>
                            <th width="110">User</th>
                            <th>Insert Date</th>
                        </tr>
                    </thead>
               	</table>
                <table width="1930" class="rpt_table" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_body_213" align="left">
                    <tbody>';
                    $j=1; $total_receive_non_order=""; $total_issue_non_order="";

                    foreach($result_non_order_13 as $row)
                    {
                        if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

                       $knitting_company=''; $yarn_lot=''; $yarn_count=''; $stitch_length=''; $color_id='';
                        if($row[csf("knitting_source")]==1)
                        {
                            $knitting_company=$company_arr[$row[csf("knitting_company")]];
                        }
                        else if($row[csf("knitting_source")]==3)
                        {
                            $knitting_company=$supplier_arr[$row[csf("knitting_company")]];
                        }

						if($row[csf("transaction_type")]==1)
						{
							$dtls_id=$trans_Id_arr[$row[csf("trans_id")]][1];
							$yarn_lot=$receive_num_arr[$dtls_id][5];
							$yarn_count=$receive_num_arr[$dtls_id][6];
							$stitch_length=$receive_num_arr[$dtls_id][7];
							$color_id=$receive_num_arr[$dtls_id][8];
						}
						else if($row[csf("transaction_type")]==4)
						{
							$dtls_id=$trans_Id_arr[$row[csf("trans_id")]][1];
							$yarn_lot=$row[csf("batch_lot")];
							$yarn_count=$row[csf("yarn_count")];
							$stitch_length=$row[csf("stitch_length")];
						}
						else if($row[csf("transaction_type")]==2)
						{
							$dtls_id=$trans_Id_arr[$row[csf("trans_id")]][2];
							$yarn_lot=$issue_num_arr[$dtls_id][5];
							$yarn_count=$issue_num_arr[$dtls_id][6];
							$stitch_length=$issue_num_arr[$dtls_id][7];
							$color_id=$issue_num_arr[$dtls_id][8];
						}
						else if($row[csf("transaction_type")]==3)
						{
							$dtls_id=$trans_Id_arr[$row[csf("trans_id")]][2];
							$yarn_lot=$row[csf("batch_lot")];
							$yarn_count=$row[csf("yarn_count")];
							$stitch_length=$row[csf("stitch_length")];
						}

						$color='';
						$color_ids=explode(",",$color_id);
						foreach($color_ids as $val)
						{
							if($val>0) $color.=$color_arr[$val].",";
						}
						$color=chop($color,',');

						$yarn_count_name='';
						$yarn_counts=explode(",",$yarn_count);
						foreach($yarn_counts as $val)
						{
							if($val>0) $yarn_count_name.=$yarn_count_arr[$val].",";
						}
						$yarn_count_name=chop($yarn_count_name,',');

						$mst_id=$row[csf("mst_id")]; 

                        $html.='<tr bgcolor="'.$bgcolor.'" onClick="change_color(\'tr_'.$i.'\',\''.$bgcolor.'\')" id="tr_'.$i.'">
                            <td width="30">'.$j.'</td>
                            <td width="50">'.$row[csf("prod_id")].'</td>
                            <td width="80" align="center" class="wrd_brk">'.change_date_format($row[csf("transaction_date")]).'</td>
                            <td width="130" class="wrd_brk"><a href="##" onClick="openmypage_mrr(\'mrr_popup\',\''.$row[csf("transaction_type")].'\',\''.$row[csf("trans_id")].'\',\''.$cbo_company_name.'\');">'.$row[csf("tran_ref")].'</a></td>
							<td width="100">'.$store_arr[$row[csf("store_id")]].'</td>';

							if($rptType==3)
							{
								$html.='<td width="80">';
								if($row[csf("transaction_type")]==2)
								{
									//$html.= $yarn_issue_purpose[$issue_num_arr[$mst_id]["issue_purpose"]];
									$html.= $yarn_issue_purpose[$row[csf("issue_purpose")]];
								}
								$html.='</td>';
							}



							$html.='<td width="100" class="wrd_brk">'.$row[csf("challan_no")].'</td>';
							if($rptType==3)
							{
								$html.='<td width="100" align="center" class="wrd_brk">'.$department_arr[$row[csf("department_id")]].'</td>
                                <td width="100" align="center" class="wrd_brk">'.$section_arr[$row[csf("section_id")]].'</td>';
							}
							$html.='<td width="120" class="wrd_brk">'.$knitting_company.'</td>
                            <td width="80" class="wrd_brk">'.$yarn_lot.'</td>
							<td width="80" class="wrd_brk">'.$yarn_count_name.'</td>
                            <td width="100" class="wrd_brk">'.$construction_arr[$product_arr[$row[csf('prod_id')]][1]].'</td>
                            <td width="110" class="wrd_brk">'.$composition_arr[$product_arr[$row[csf('prod_id')]][1]].'</td>
                            <td width="80" class="wrd_brk">'.$color.'</td>
                            <td width="50" class="wrd_brk">'.$product_arr[$row[csf('prod_id')]][2].'</td>
                            <td width="50" class="wrd_brk">'.$product_arr[$row[csf('prod_id')]][3].'</td>
                            <td width="60" class="wrd_brk">'.$stitch_length.'</td>
                            <td width="80" align="right" class="wrd_brk">';
                            if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4){ $html.= number_format($row[csf("qty")],2); $total_receive_non_order +=$row[csf("qty")];}
                            $html.='</td>
							<td align="right" width="80" class="wrd_brk">';
                            if($row[csf("transaction_type")]==2  || $row[csf("transaction_type")]==3){ $html.= number_format($row[csf("qty")],2); $total_issue_non_order +=$row[csf("qty")];}
                            $html.='</td>
                            <td width="110" class="wrd_brk">'.$user_name_arr[$row[csf("inserted_by")]].'</td>
                            <td class="wrd_brk">'.$row[csf("insert_date")].'</td>
                        </tr>';
                        $i++;$j++;
                    }
					unset($result);
                    $html.='</tbody>
                </table>
                <table width="1930" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="report_table_footer" align="left">
                    <tfoot>
                        <th width="30">&nbsp;</th>
                        <th width="50">&nbsp;</th>
                        <th width="80">&nbsp;</th>
                        <th width="130">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						';

						if($rptType==3)
						{
							$html.='<th width="80">&nbsp;</th>';
						}

                        $html.='<th width="100">&nbsp;</th>';
                        if($rptType==3)
						{
							$html.='<th width="100">&nbsp;</th>
                            <th width="100">&nbsp;</th>';
						}
						$html.='<th width="120">&nbsp;</th>
                        <th width="80">&nbsp;</th>
                        <th width="80">&nbsp;</th>
                        <th width="100">&nbsp;</th>
                        <th width="110">&nbsp;</th>
                        <th width="80">&nbsp;</th>
                        <th width="50">&nbsp;</th>
                        <th width="50">&nbsp;</th>
                        <th width="60">Total:</th>
                        <th width="80">'.number_format($total_receive_non_order,2).'</th>
                        <th width="80">'.number_format($total_issue_non_order,2).'</th>
                        <th width="110">&nbsp;</th>
                        <th>&nbsp;</th>
                    </tfoot>
                </table>';
			}
            $html.='</div>';
        }
        else{
            $show_html_13 = 0;
        }
	} //Grey fabric

	if(($key = array_search(1, $cbo_item_cat)) !== false) // Yarn
	{
		unset($cbo_item_cat[$key]); //remove 1 for
		$yarn_count_cond="";
		if($cbo_yarn_count!=0) $yarn_count_cond=" and b.yarn_count_id=$cbo_yarn_count";

		//echo $date_cond;die;
		if($rptType==1)
		{

			$sql="SELECT
						B.ID AS PROD_ID,
						A.ID AS TRANS_ID,
						A.RECEIVE_BASIS,
						A.TRANSACTION_TYPE,
						A.MST_ID AS REC_ISSUE_ID,
						A.TRANSACTION_DATE,
						CASE WHEN A.TRANSACTION_TYPE IN(1,4,5) THEN A.CONS_QUANTITY ELSE 0 END AS RECEIVE_QTY ,
						CASE WHEN A.TRANSACTION_TYPE IN(2,3,6) THEN A.CONS_QUANTITY ELSE 0 END AS ISSUE_QTY ,
						CASE WHEN A.TRANSACTION_TYPE IN(2) THEN A.RETURN_QNTY ELSE 0 END AS RETURN_QNTY ,
						CASE WHEN A.TRANSACTION_TYPE IN(3) THEN A.CONS_QUANTITY ELSE 0 END AS RECEIVE_RET_QTY ,
						CASE WHEN A.TRANSACTION_TYPE IN(4) THEN A.CONS_QUANTITY ELSE 0 END AS ISSUE_RET_QTY ,
						A.CONS_UOM,
						A.STORE_ID,
						B.YARN_COMP_TYPE1ST AS YARN_COMP_TYPE1ST,
						B.YARN_COMP_PERCENT1ST AS YARN_COMP_PERCENT1ST,
						B.YARN_COMP_TYPE2ND AS YARN_COMP_TYPE2ND,
						B.YARN_COMP_PERCENT2ND  AS YARN_COMP_PERCENT2ND,
						B.LOT,
						B.BRAND,
						B.SUPPLIER_ID,
						B.YARN_COUNT_ID,
						B.YARN_TYPE,
						B.COLOR,
						A.CONS_RATE,
						A.CONS_AMOUNT,
						A.INSERTED_BY,
						$select_insert_date,
						$select_insert_time,
						A.ORDER_QNTY,
						A.ORDER_RATE, A.REQUISITION_NO, NULL AS BOOKING_NO
				from inv_transaction a, product_details_master b
				where a.prod_id=b.id and a.item_category=1 and a.company_id=$cbo_company_name and a.transaction_type in(1,2,3,4,5,6) and a.cons_quantity>0 and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 $date_cond $yarn_count_cond $sql_cond $transaction_ids_cond_for_mrr order by a.transaction_date, a.id";
		}
		else if($rptType==2)
		{
			$sql="SELECT
						B.ID AS PROD_ID,
						A.ID AS TRANS_ID,
						A.RECEIVE_BASIS,
						A.TRANSACTION_TYPE,
						A.MST_ID AS REC_ISSUE_ID,
						A.TRANSACTION_DATE,
						CASE WHEN A.TRANSACTION_TYPE IN(1,4,5) THEN A.CONS_QUANTITY ELSE 0 END AS RECEIVE_QTY ,
						CASE WHEN A.TRANSACTION_TYPE IN(3) THEN A.CONS_QUANTITY ELSE 0 END AS RECEIVE_RET_QTY,
						A.CONS_UOM,
						A.STORE_ID,
						B.YARN_COMP_TYPE1ST AS YARN_COMP_TYPE1ST,
						B.YARN_COMP_PERCENT1ST AS YARN_COMP_PERCENT1ST,
						B.YARN_COMP_TYPE2ND AS YARN_COMP_TYPE2ND,
						B.YARN_COMP_PERCENT2ND AS YARN_COMP_PERCENT2ND,
						B.LOT,
						B.SUPPLIER_ID,
						B.YARN_COUNT_ID,
						B.YARN_TYPE,
						B.COLOR,
						A.CONS_RATE,
						A.CONS_AMOUNT,
						A.INSERTED_BY,
						$select_insert_date,
						$select_insert_time,
						A.ORDER_QNTY,
						A.ORDER_RATE, A.REQUISITION_NO, NULL AS BOOKING_NO
				from
						inv_transaction a, product_details_master b
				where
						a.prod_id=b.id and a.item_category=1 and a.company_id=$cbo_company_name and a.transaction_type in(1,4,5)  and a.cons_quantity>0 and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 $date_cond $yarn_count_cond $sql_cond $transaction_ids_cond_for_mrr order by a.transaction_date, a.id";
		}
		else if($rptType==3)
		{
			$sql="SELECT B.ID AS PROD_ID, A.ID AS TRANS_ID, A.RECEIVE_BASIS, A.TRANSACTION_TYPE, A.MST_ID AS REC_ISSUE_ID, A.TRANSACTION_DATE, CASE WHEN A.TRANSACTION_TYPE IN(2,3,6) THEN A.CONS_QUANTITY ELSE 0 END AS ISSUE_QTY , A.RETURN_QNTY AS RETURN_QNTY , CASE WHEN A.TRANSACTION_TYPE IN(4) THEN A.CONS_QUANTITY ELSE 0 END AS ISSUE_RET_QTY, A.CONS_UOM, B.YARN_COMP_TYPE1ST AS YARN_COMP_TYPE1ST, B.YARN_COMP_PERCENT1ST AS YARN_COMP_PERCENT1ST, B.YARN_COMP_TYPE2ND AS YARN_COMP_TYPE2ND, B.YARN_COMP_PERCENT2ND AS YARN_COMP_PERCENT2ND, B.LOT, B.SUPPLIER_ID, B.YARN_COUNT_ID, A.DEPARTMENT_ID, A.SECTION_ID, B.YARN_TYPE, B.COLOR, A.CONS_RATE, A.CONS_AMOUNT, A.INSERTED_BY, $select_insert_date, $select_insert_time, A.ORDER_QNTY, A.ORDER_RATE, C.KNIT_DYE_COMPANY, A.STORE_ID, C.IS_APPROVED, A.LOCATION_ID, C.ID AS MST_ID, A.REQUISITION_NO, C.BOOKING_NO, C.BUYER_ID,c.ISSUE_PURPOSE
			from inv_transaction a, product_details_master b, inv_issue_master c
			where a.prod_id=b.id and a.mst_id=c.id and a.item_category=1 and a.company_id=$cbo_company_name and a.transaction_type in(2,3,6) and a.cons_quantity>0 and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 $date_cond $yarn_count_cond $sql_cond $transaction_ids_cond_for_mrr
			order by trans_id desc";
		}

        //echo $sql;
		if($rptType==1)
		{
			$table_width=3450;
			$div_width="3470px";
		}
		else if($rptType==2)
		{
			$table_width=3100;
			$div_width="3120px";
		}
		else
		{
			// $table_width=3105;
			// $div_width="3125px";
			$table_width=3285;
			$div_width="3305px";
		}

		$sql_result=sql_select($sql);

        $receive_ids_arr=array();
        $issue_ids_arr=array();
        $transfer_ids_arr=array();
        foreach($sql_result as $row)
        {
            if ($row["TRANSACTION_TYPE"]==1 || $row["TRANSACTION_TYPE"]==4){
                $receive_ids_arr[$row["REC_ISSUE_ID"]]=$row["REC_ISSUE_ID"];
            } else if ($row["TRANSACTION_TYPE"]==2 || $row["TRANSACTION_TYPE"]==3) {
                $issue_ids_arr[$row["REC_ISSUE_ID"]]=$row["REC_ISSUE_ID"];
            } else $transfer_ids_arr[$row["REC_ISSUE_ID"]]=$row["REC_ISSUE_ID"];
        }

        $receive_data_arr=array();
        $pi_ids_arr=array();
        $yarndyeing_ids_arr=array();
        $yarnwork_ids_arr=array();
        $btblc_ids_arr=array();
        if (count($receive_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 26, $receive_ids_arr, $empty_arr);
            $sql_receive_res=sql_select("SELECT b.ID, b.ENTRY_FORM, b.RECV_NUMBER, b.KNITTING_SOURCE, b.KNITTING_COMPANY, b.RECEIVE_BASIS, b.BOOKING_NO, b.RECEIVE_PURPOSE, b.SUPPLIER_ID, b.BOOKING_ID, b.CURRENCY_ID, b.EXCHANGE_RATE, b.CHALLAN_NO, b.LC_NO, b.REMARKS from gbl_temp_engine g, inv_receive_master b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=26 and b.item_category=1 and b.status_active=1 and b.is_deleted=0");
            foreach($sql_receive_res as $row)
            {
                $receive_data_arr[$row["ID"]]['rec_id']=$row["ID"];
                $receive_data_arr[$row["ID"]]['recv_number']=$row["RECV_NUMBER"];
                $receive_data_arr[$row["ID"]]['receive_basis']=$row["RECEIVE_BASIS"];
                $receive_data_arr[$row["ID"]]['booking_id']=$row["BOOKING_ID"];
                $receive_data_arr[$row["ID"]]['receive_purpose']=$row["RECEIVE_PURPOSE"];
                $receive_data_arr[$row["ID"]]['supplier_id']=$row["SUPPLIER_ID"];
                $receive_data_arr[$row["ID"]]['entry_form']=$row["ENTRY_FORM"];
                $receive_data_arr[$row["ID"]]['currency_id']=$row["CURRENCY_ID"];
                $receive_data_arr[$row["ID"]]['exchange_rate']=$row["EXCHANGE_RATE"];
                $receive_data_arr[$row["ID"]]['challan_no']=$row["CHALLAN_NO"];
                $receive_data_arr[$row["ID"]]['lc_no']=$row["LC_NO"];
                $receive_data_arr[$row["ID"]]['knitting_source']=$row["KNITTING_SOURCE"];
                $receive_data_arr[$row["ID"]]['knitting_company']=$row["KNITTING_COMPANY"];
                $receive_data_arr[$row["ID"]]['remarks']=$row["REMARKS"];
                $receive_data_arr[$row["ID"]]['booking_no']=$row["BOOKING_NO"];
                if ($row["BOOKING_ID"]>0){
                    if ($row["RECEIVE_BASIS"]==1){
                        $pi_ids_arr[$row["BOOKING_ID"]]=$row["BOOKING_ID"];
                    } else if ($row["RECEIVE_BASIS"]==2 && $row["RECEIVE_PURPOSE"]==2) {
                        $yarndyeing_ids_arr[$row["BOOKING_ID"]]=$row["BOOKING_ID"];
                    } else $yarnwork_ids_arr[$row["BOOKING_ID"]]=$row["BOOKING_ID"];
                }
                if ($row["LC_NO"]>0){
                    $btblc_ids_arr[$row["LC_NO"]]=$row["LC_NO"];
                }
            }
            unset($sql_receive_res);
        }

        $issue_data_arr=array();
        if (count($issue_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 27, $issue_ids_arr, $empty_arr);
            $sql_issue_res=sql_select("SELECT b.ID, b.ENTRY_FORM, b.ISSUE_NUMBER, b.ISSUE_BASIS, b.BOOKING_NO, b.ISSUE_PURPOSE, b.SUPPLIER_ID, b.BOOKING_ID, b.REMARKS, b.KNIT_DYE_COMPANY AS ISSUE_TO, b.KNIT_DYE_SOURCE, b.CHALLAN_NO from gbl_temp_engine g, inv_issue_master b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=27 and b.item_category=1 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_issue_res as $row)
            {
                $issue_data_arr[$row["ID"]]['issue_id']=$row["ID"];
                $issue_data_arr[$row["ID"]]['issue_number']=$row["ISSUE_NUMBER"];
                $issue_data_arr[$row["ID"]]['issue_basis']=$row["ISSUE_BASIS"];
                $issue_data_arr[$row["ID"]]['booking_id']=$row["BOOKING_ID"];
                $issue_data_arr[$row["ID"]]['issue_purpose']=$row["ISSUE_PURPOSE"];
                $issue_data_arr[$row["ID"]]['supplier_id']=$row["SUPPLIER_ID"];
                $issue_data_arr[$row["ID"]]['entry_form']=$row["ENTRY_FORM"];
                $issue_data_arr[$row["ID"]]['knit_dye_source']=$row["KNIT_DYE_SOURCE"];
                $issue_data_arr[$row["ID"]]['issue_to']=$row["ISSUE_TO"];
                $issue_data_arr[$row["ID"]]['remarks']=$row["REMARKS"];
                $issue_data_arr[$row["ID"]]['challan_no']=$row["CHALLAN_NO"];
                $issue_data_arr[$row["ID"]]['booking_no']=$row["BOOKING_NO"];
            }
            unset($sql_issue_res);
        }

        $transfer_num_arr=array();
        if (count($transfer_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 28, $transfer_ids_arr, $empty_arr);
            $sql_transfer_res=sql_select("SELECT b.ID, b.TRANSFER_SYSTEM_ID, b.CHALLAN_NO, b.TRANSFER_DATE from gbl_temp_engine g, inv_item_transfer_mst b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=28 and b.item_category=1 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_transfer_res as $row)
            {
                $transfer_num_arr[$row["ID"]]["id"]=$row["ID"];
                $transfer_num_arr[$row["ID"]]["transfer_system_id"]=$row["TRANSFER_SYSTEM_ID"];
                $transfer_num_arr[$row["ID"]]["challan_no"]=$row["CHALLAN_NO"];
                $transfer_num_arr[$row["ID"]]["transfer_date"]=$row["TRANSFER_DATE"];
            }
            unset($sql_transfer_res);
        }

        $yarn_pi_num_arr=array();
        if (count($pi_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 29, $pi_ids_arr, $empty_arr);
            $sql_pi_res=sql_select("SELECT b.ID, b.PI_NUMBER from gbl_temp_engine g, com_pi_master_details b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=29 and b.item_category_id=1 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_pi_res as $row)
            {
                $yarn_pi_num_arr[$row["ID"]]=$row["PI_NUMBER"];
            }
            unset($sql_pi_res);
        }

        $yarn_dyeing_wo_arr=array();
        if (count($yarndyeing_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 30, $yarndyeing_ids_arr, $empty_arr);
            $sql_yarn_dyeing_res=sql_select("SELECT b.ID, b.YDW_NO from gbl_temp_engine g, wo_yarn_dyeing_mst b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=30 and b.item_category_id=24 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_yarn_dyeing_res as $row)
            {
                $yarn_dyeing_wo_arr[$row["ID"]]=$row["YDW_NO"];
            }
            unset($sql_yarn_dyeing_res);
        }

        $yarn_work_order_arr=array();
        if (count($yarnwork_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 31, $yarnwork_ids_arr, $empty_arr);
            $sql_yarn_work_res=sql_select("SELECT b.ID, b.WO_NUMBER from gbl_temp_engine g, wo_non_order_info_mst b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=31 and b.item_category=1 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_yarn_work_res as $row)
            {
                $yarn_work_order_arr[$row["ID"]]=$row["WO_NUMBER"];
            }
            unset($sql_yarn_work_res);
        }

        $btb_lc_arr=array();
        if (count($btblc_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 32, $btblc_ids_arr, $empty_arr);
            $sql_btb_lc_res=sql_select("SELECT b.ID, b.LC_NUMBER from gbl_temp_engine g, com_btb_lc_master_details b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=32 and b.pi_entry_form=165 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_btb_lc_res as $row)
            {
                $btb_lc_arr[$row["ID"]]=$row["LC_NUMBER"];
            }
            unset($sql_btb_lc_res);
        }

        $show_html_1 = 1;
        if(count($sql_result) > 0)
        {
			$html.='<br>
			<div style="width:'.$div_width.'">
	        <fieldset style="width:'.$div_width.';">
				<table width="'.$table_width.'" border="1" cellpadding="2" cellspacing="0" class="rpt_table" rules="all" id="" align="left">
						<tr class="form_caption" style="border:none;">
							<td colspan="14" align="left" style="border:none;font-size:16px; font-weight:bold" > Yarn: </td>
						</tr>
				</table>
				<br />
				<table width="'.$table_width.'" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="table_header_1" align="left">
					<thead>
						<tr>
							<th width="30" >SL</th>
							<th width="60" >Prod. Id</th>
							<th width="70" >Trans. Date</th>
							<th width="130" >Trans. Ref.</th>
							<th width="100" >Store Name</th>';

							if($rptType==3)
							{
								$html.='<th width="80" >Issue Purposed</th>';
							}

	                        $html.='<th width="120" >WO/PI</th>
	                        <th width="100" >Buyer</th>
	                        <th width="100" >Challan No</th>';
	                        if($rptType==3)
							{
								$html.='<th width="100">Department</th>
	                            <th width="100">Section</th>';
							}
							$html.='<th width="120" >';
                            $html.= $caption = ($rptType==3)?" Supplier Name ":" Party Name ";
                            $html.='</th>';
							if($rptType==1)
							{
								$html.='<th width="100">Brand</th>';
							}
	                        $html.='<th width="100" >Yarn Lot</th>
	                        <th width="100" >Yarn Count</th>
							<th width="150">Composition</th>
							<th width="90">Yarn Type</th>
							<th width="100">Color</th>
	                        <th width="100">Basis</th>
	                        <th width="100">WO/PI NO.</th>
	                        <th width="100">BTB LC NO.</th>
	                        <th width="120">Purpose</th>';

	                        if($rptType==3) {
                                $html.='<th width="145">Issue To</th>';
	                        }
							if($rptType==2 || $rptType==1 )
							{
								$html.='<th width="80">Currency</th>
	                            <th width="80">Exchange Rate</th>
	                            <th width="80">Actual Rate</th>
								<th width="80">Receive Qty</th>
								<th width="80">Receive Return Qty</th>
	                            <th width="80">Actual Amt</th>';
							}
							if($rptType==3 || $rptType==1 )
							{
								$html.='<th width="80">Issue Qty</th>
	                            <th width="80">Issue Return Qty</th>
	                            <th width="80">Returnable Qty</th>';
							}
							$html.='<th width="80">Rate(TK)</th>
	                        <th width="100">Amount(TK)</th>
                            <th width="80">Rate(USD)</th>
	                        <th width="100">Amount(USD)</th>
	                        <th width="110">User</th>
	                        <th width="140">Insert Date</th>
	                        <th>Remarks</th>
						</tr>
					</thead>
			   	</table>
				<div style="width:'.$div_width.'; overflow-y: scroll; max-height:250px;" id="scroll_body1"  class="scroll_div_class">
					<table width="'.$table_width.'" class="rpt_table" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_body_1" align="left">
						<tbody>';
						$yarn_count_arr=return_library_array( "select id, yarn_count from  lib_yarn_count where status_active=1",'id','yarn_count');
						$current_date=date("d-m-Y");
						$p=1;
						$queryText = sql_select("select ID, COMPANY_ID, CON_DATE, CONVERSION_RATE from currency_conversion_rate where currency=2 and status_active=1 and is_deleted=0 and COMPANY_ID>0 order by COMPANY_ID, ID");
						$company_wise_data=array();
						foreach($queryText as $row)
						{
							$company_wise_data[$row["COMPANY_ID"]]++;
						}
						//echo "<pre>";print_r($company_wise_data);die;
						//echo "select ID, COMPANY_ID, CON_DATE, CONVERSION_RATE from currency_conversion_rate where currency=2 and status_active=1 and is_deleted=0 and COMPANY_ID>0 order by COMPANY_ID, ID";die;
						//echo count($queryText);die;
						$conversion_data_arr=array();$previous_date="";$company_check_arr=array();
						foreach($queryText as $val)
						{
							if($company_check_arr[$val["COMPANY_ID"]]=="")
							{
								$company_check_arr[$val["COMPANY_ID"]]=$val["COMPANY_ID"];
								$conversion_data_arr[$val["COMPANY_ID"]][change_date_format($val["CON_DATE"])]=$val["CONVERSION_RATE"];
								$sStartDate = date("Y-m-d", strtotime($val["CON_DATE"]));
								$sCurrentDate = $sStartDate;
								$sEndDate = $sStartDate;
								$previous_date=$sStartDate;
								$previous_rate=$val["CONVERSION_RATE"];
								//echo $sCurrentDate."=".$sEndDate."=".$val["CONVERSION_RATE"]."<br>";

								$sStartDate=date("Y-m-d", strtotime("+1 day", strtotime($val["CON_DATE"])));
								$sEndDate = date("Y-m-d", strtotime($current_date));
								$sCurrentDate = $sStartDate;
								//echo $sCurrentDate."=".$sEndDate."=".$val["CONVERSION_RATE"]."<br>";
								while ($sCurrentDate <= $sEndDate) {

									$conversion_data_arr[$val["COMPANY_ID"]][change_date_format($sCurrentDate)]=$val["CONVERSION_RATE"];
									$sCurrentDate = date("Y-m-d", strtotime("+1 day", strtotime($sCurrentDate)));
								}
								$q=1;
							}
							else
							{
								$q++;
								$sStartDate = date("Y-m-d", strtotime($previous_date));
								if($company_wise_data[$val["COMPANY_ID"]]==$q)
								{
									$sEndDate = gmdate("Y-m-d", strtotime($val["CON_DATE"]));
									$sCurrentDate = $sStartDate;
									//echo $sCurrentDate."=".$sEndDate."=".$previous_rate."<br>";
									while ($sCurrentDate <= $sEndDate) {
										$conversion_data_arr[$val["COMPANY_ID"]][change_date_format($sCurrentDate)]=$previous_rate;
										$sCurrentDate = date("Y-m-d", strtotime("+1 day", strtotime($sCurrentDate)));
									}

									$sStartDate=date("Y-m-d", strtotime("+1 day", strtotime($sEndDate)));
									$sEndDate = date("Y-m-d", strtotime($current_date));
									$sCurrentDate = $sStartDate;
									//echo $sCurrentDate."=".$sEndDate."=".$val["CONVERSION_RATE"]."<br>";
									while ($sCurrentDate <= $sEndDate) {

										$conversion_data_arr[$val["COMPANY_ID"]][change_date_format($sCurrentDate)]=$val["CONVERSION_RATE"];
										$sCurrentDate = date("Y-m-d", strtotime("+1 day", strtotime($sCurrentDate)));
									}
									$previous_date=$val["CON_DATE"];
									$previous_rate=$val["CONVERSION_RATE"];
								}
								else
								{
									$sEndDate = gmdate("Y-m-d", strtotime($val["CON_DATE"]));
									$sCurrentDate = $sStartDate;
									//echo $sCurrentDate."=".$sEndDate."=".$previous_rate."<br>";
									while ($sCurrentDate <= $sEndDate) {
										$conversion_data_arr[$val["COMPANY_ID"]][change_date_format($sCurrentDate)]=$previous_rate;
										$sCurrentDate = date("Y-m-d", strtotime("+1 day", strtotime($sCurrentDate)));
									}
									$previous_date=$val["CON_DATE"];
									$previous_rate=$val["CONVERSION_RATE"];
								}
							}
							$p++;
						}
						unset($queryText);
						//echo "<pre>";print_r($conversion_data_arr);die;
						$i=1;$total_receive="";$total_issue="";
						foreach($sql_result as $val)
						{
	                        //var_dump($val);
							if ($i%2==0)
							$bgcolor="#E9F3FF";
							else
							$bgcolor="#FFFFFF";
							$html.='<tr bgcolor="'.$bgcolor.'" onClick="change_color(\'tr_'.$i.'\',\''.$bgcolor.'\')" id="tr_'.$i.'">
								<td width="30">'.$i.'</td>
								<td width="60" align="center">'.$val["PROD_ID"].'</td>
								<td width="70" align="center" class="wrd_brk">'.change_date_format($val["TRANSACTION_DATE"]).'</td>
								<td width="130"  align="center" class="wrd_brk"><a href="##" onClick="openmypage_mrr(\'mrr_popup\',\''.$val["TRANSACTION_TYPE"].'\',\''.$val["TRANS_ID"].'\',\''.$cbo_company_name.'\');">';
									if($val["TRANSACTION_TYPE"]==1  || $val["TRANSACTION_TYPE"]==4 )
									{
										$html.= $receive_data_arr[$val['REC_ISSUE_ID']]["recv_number"];
										$remarks=$receive_data_arr[$val['REC_ISSUE_ID']]["remarks"];
									}
									else if($val["TRANSACTION_TYPE"]==2  || $val["TRANSACTION_TYPE"]==3)
									{
										$html.= $issue_data_arr[$val['REC_ISSUE_ID']]["issue_number"];
										$remarks=$issue_data_arr[$val['REC_ISSUE_ID']]["remarks"];
										//echo $val['REC_ISSUE_ID'];
									}
									else if($val["TRANSACTION_TYPE"]==5  || $val["TRANSACTION_TYPE"]==6)
									{
										$html.= $transfer_num_arr[$val['REC_ISSUE_ID']]["transfer_system_id"];
									}
									//echo $val["TRANSACTION_TYPE"];

                                    $html.='</a></td>
									<td width="100">'.$store_arr[$val[csf("store_id")]].'</td>';

									if($rptType==3)
									{
										$html.='<td width="80">';
										if($val[csf("transaction_type")]==2)
										{
											$html.= $yarn_issue_purpose[$val['ISSUE_PURPOSE']];
										}
										$html.='</td>';
									}

                                    $basis = $booking_no = $booking_id = "";
									if($val["TRANSACTION_TYPE"]==1  || $val["TRANSACTION_TYPE"]==4 )
									{
                                        $basis = $receive_data_arr[$val['REC_ISSUE_ID']]['receive_basis'];
                                        $booking_no = $receive_data_arr[$val['REC_ISSUE_ID']]["booking_no"];
                                        $booking_id = $receive_data_arr[$val['REC_ISSUE_ID']]["booking_id"];
                                        if($basis == 1 && $booking_no != ''){ //pi
                                            $html.='<td width="120" align="center" class="wrd_brk"><a href="javascript:void(0)" onClick="pi_report_generate('.$booking_id.')">'.$booking_no.'</a></td>';
                                        }
                                        else if($basis == 2 && $booking_no != ''){
                                            $html.='<td width="120" align="center" class="wrd_brk"><a href="javascript:void(0)" onClick="print_report( '.$booking_id.',\'yarn_work_order_print\',\'requires/date_wise_item_recv_issue_multi_category_report_controller\')">'.$booking_no.'</a></td>';
                                        }
                                        else if($basis == 14 && $booking_no != ''){
                                            $html.='<td width="120" align="center" class="wrd_brk"><a href="javascript:void(0)" onClick="print_report( '.$booking_id.',\'fabric_sales_order_print\',\'requires/date_wise_item_recv_issue_multi_category_report_controller\')">'.$booking_no.'</a></td>';
                                        }else{
                                            $html.='<td width="120" align="center" class="wrd_brk">'. $booking_no.'</td>';
                                        }
									}
									else if($val["TRANSACTION_TYPE"]==2  || $val["TRANSACTION_TYPE"]==3)
									{
                                        $basis = $issue_data_arr[$val['REC_ISSUE_ID']]['issue_basis'];
                                        $booking_no = $issue_data_arr[$val['REC_ISSUE_ID']]["booking_no"];
                                        $booking_id = $issue_data_arr[$val['REC_ISSUE_ID']]["booking_id"];
                                        if($basis == 1 && $booking_no != ''){ //pi
                                            $html.='<td width="120" align="center" class="wrd_brk"><a href="javascript:void(0)" onClick="print_report( '.$booking_id.',\'show_print_booking_report\',\'requires/date_wise_item_recv_issue_multi_category_report_controller\')">'. $booking_no.'</a></td>';
                                        }else{
                                            $html.='<td width="120" align="center" class="wrd_brk">'.$booking_no.'</td>';
                                        }
									}else{
                                        $html.='<td width="120" class="wrd_brk"></td>';
                                    }
                                    $html.='<td width="100" align="center" class="wrd_brk">'. $buyer_name_arr[$val["BUYER_ID"]].'</td>
	                            <td width="100" class="wrd_brk">';

									if($val["TRANSACTION_TYPE"]==1  || $val["TRANSACTION_TYPE"]==4 )
									{
										$html.= $receive_data_arr[$val['REC_ISSUE_ID']]["challan_no"];
									}
									else if($val["TRANSACTION_TYPE"]==2  || $val["TRANSACTION_TYPE"]==3)
									{
										$html.= $issue_data_arr[$val['REC_ISSUE_ID']]["challan_no"];
										//echo $val['REC_ISSUE_ID'];
									}


									else if($val["TRANSACTION_TYPE"]==5  || $val["TRANSACTION_TYPE"]==6)
									{
										$html.= $transfer_num_arr[$val['REC_ISSUE_ID']]["challan_no"];
										//echo $val['REC_ISSUE_ID'];
									}

                                $html.='</td>';
								if($rptType==3)
								{
									$html.='<td width="100" align="center" class="wrd_brk">'. $department_arr[$val["DEPARTMENT_ID"]].'</td>
	                                <td width="100" align="center" class="wrd_brk">'. $section_arr[$val["SECTION_ID"]].'</td>';
								}
								$html.='<td width="120" align="center" class="wrd_brk">'.$supplier_arr[$val["SUPPLIER_ID"]].'</td>';
								if($rptType==1)
								{
									$html.='<td width="100" align="center" class="wrd_brk">'. $brand_arr[$val["BRAND"]].'</td>';
								}
	                            $html.='<td width="100" align="center" class="wrd_brk">'. $val["LOT"].'</td>
	                            <td width="100" align="center" class="wrd_brk">'. $yarn_count_arr[$val["YARN_COUNT_ID"]].'</td>
	                            <td width="150" class="wrd_brk">';
								if($val["YARN_COMP_PERCENT1ST"]!=0) {$parcent1st=$val["YARN_COMP_PERCENT1ST"]."%";} else {$parcent1st="";}
								if($val["YARN_COMP_PERCENT2ND"]!=0 ){ $parcent2nd=$val["YARN_COMP_PERCENT2ND"]."%";} else {$parcent2nd="";}
                                $html.= $composition[$val["YARN_COMP_TYPE1ST"]].' '.$parcent1st.' '.$composition[$val["YARN_COMP_TYPE2ND"]].' '.$parcent2nd;
                                $html.='</td>
	                            <td width="90" class="wrd_brk">'. $yarn_type[$val["YARN_TYPE"]].'</td>
	                            <td width="100" class="wrd_brk">'. $color_arr[$val["COLOR"]].'</td>';
								if($val["TRANSACTION_TYPE"]==1 || $val["TRANSACTION_TYPE"]==4 )
								{
									$html.='<td width="100">';
									if($receive_data_arr[$val['REC_ISSUE_ID']]['entry_form']!=9)
									{
										if($receive_data_arr[$val['REC_ISSUE_ID']]['receive_basis']!=3)
										{
											$html.= $receive_basis_arr[$receive_data_arr[$val['REC_ISSUE_ID']]['receive_basis']];
										}

									}
									$html.='</td>
									<td width="100" class="wrd_brk">';
									$knitting_soucre=$receive_data_arr[$val['REC_ISSUE_ID']]['knitting_source'];
									$knitting_company=$receive_data_arr[$val['REC_ISSUE_ID']]['knitting_company'];
									if($receive_data_arr[$val['REC_ISSUE_ID']]['entry_form']==9)
									{
										 if($knitting_soucre==1)
										 {
											$supplier_name=$company_arr[$knitting_company];
										 }
										 else
										 {
											$supplier_name=$supplier_arr[$knitting_company];
										 }

										 $html.= "Issue Return".'('.$supplier_name.')';
									 }
									 else
									 {
										 if($val["RECEIVE_BASIS"]==1) $html.= $yarn_pi_num_arr[$receive_data_arr[$val['REC_ISSUE_ID']]['booking_id']];
										 if($val["RECEIVE_BASIS"]==2){ if($receive_data_arr[$val['REC_ISSUE_ID']]['receive_purpose']==2) $html.= $yarn_dyeing_wo_arr[$receive_data_arr[$val['REC_ISSUE_ID']]['booking_id']];  else  $html.= $yarn_work_order_arr[$receive_data_arr[$val['REC_ISSUE_ID']]['booking_id']];}
									 }
                                     $html.='</td>
									<td width="100" class="wrd_brk">'. $btb_lc_arr[$receive_data_arr[$val['REC_ISSUE_ID']]['lc_no']].'</td>
	                                <td width="120" class="wrd_brk">'. $yarn_issue_purpose[$receive_data_arr[$val['REC_ISSUE_ID']]['receive_purpose']].'</td>';
								}
								else if($val["TRANSACTION_TYPE"]==2 || $val["TRANSACTION_TYPE"]==3 )
								{
									$html.='<td width="100" class="wrd_brk">'. $issue_basis[$issue_data_arr[$val['REC_ISSUE_ID']]['issue_basis']].'</td>
									<td width="100" class="wrd_brk"></td>
	                                <td width="100" class="wrd_brk">&nbsp;</td>
									<td width="120" class="wrd_brk">'. $yarn_issue_purpose[$issue_data_arr[$val['REC_ISSUE_ID']]['issue_purpose']].'</td>';
								}
								else if($val["TRANSACTION_TYPE"]==5 || $val["TRANSACTION_TYPE"]==6 )
								{
									$html.='<td width="100" class="wrd_brk">Item Transfer</td>
									<td width="100" class="wrd_brk">&nbsp;</td>
	                                <td width="100" class="wrd_brk">&nbsp;</td>
									<td width="120" class="wrd_brk">Item Transfer</td>';
								}

								if($rptType==2 || $rptType==1 )
								{
									$html.='<td width="80" align="center" class="wrd_brk">';
									if($val["TRANSACTION_TYPE"]==1)
									{
										$html.= $currency[$receive_data_arr[$val['REC_ISSUE_ID']]["currency_id"]];
									}
									else if($val["TRANSACTION_TYPE"]==5)
									{
										$html.= $currency[1];
									}
									$html.='</td>
	                                <td width="80" align="right" class="wrd_brk">';
									if($val["TRANSACTION_TYPE"]==1)
									{
										$html.= number_format($receive_data_arr[$val['REC_ISSUE_ID']]["exchange_rate"],2);
									}
									else if($val["TRANSACTION_TYPE"]==5)
									{
										$html.= "1";
									}
									else $html.= "0";
									$html.='</td>
	                                <td width="80" align="right" class="wrd_brk">';

									if($val["TRANSACTION_TYPE"]==1) $html.= number_format($val["ORDER_RATE"],4);
									else if($val["TRANSACTION_TYPE"]==5) $html.= number_format($val["CONS_RATE"],4);
									else $html.= number_format(0,4);
                                    $total_receive +=$val["RECEIVE_QTY"];
                                    $tot_receive_ret_qty +=$val["RECEIVE_RET_QTY"];
									$html.='</td>
									<td width="80" align="right" class="wrd_brk">'.number_format($val["RECEIVE_QTY"],2,".","").'</td>
	                                <td width="80" align="right" class="wrd_brk">'.number_format($val["RECEIVE_RET_QTY"],2,".","").'</td>
	                                <td width="80" align="right" class="wrd_brk">';
									if($val["TRANSACTION_TYPE"]==1)
									{
										$order_amt=$val["ORDER_QNTY"]*$val["ORDER_RATE"];
										$html.= number_format($order_amt,4); $total_order_amt+=$order_amt; $order_amt=0;
									}
									else if($val["TRANSACTION_TYPE"]==5) $html.= number_format($val["CONS_AMOUNT"],4);
									else $html.= number_format(0,4);
									$html.='</td>';
								}

	                            if($rptType==3)
	                            {
                                    $html.='<td align="left"  width="145" class="wrd_brk">';
	                               if($company_arr[$issue_data_arr[$val['REC_ISSUE_ID']]['issue_to']] =='')
	                               {
	                                    $html.= $supplier_arr[$val["KNIT_DYE_COMPANY"]];
	                               }
	                               else
                                   {
	                                    $html.= $company_arr[$issue_data_arr[$val['REC_ISSUE_ID']]['issue_to']];
	                               }
	                               $html.='</td>';
                                }

								if($rptType==3 || $rptType==1 )
								{
									$html.='<td align="right"  width="80" class="wrd_brk">'.number_format($val["ISSUE_QTY"],2,".","").'</td>
	                                <td width="80" align="right" class="wrd_brk">'. number_format($val["ISSUE_RET_QTY"],2,".","").'</td>
	                                <td align="right"  width="80" class="wrd_brk">'. number_format($val["RETURN_QNTY"],2,".","").'</td>';
                                    $total_issue +=$val["ISSUE_QTY"];
                                    $tot_issue_ret_qty +=$val["ISSUE_RET_QTY"];
                                    $total_return +=$val["RETURN_QNTY"];
                                    if($val["ISSUE_QTY"] == 0){
                                        $val["CONS_RATE"] = 0;
                                        $val["CONS_AMOUNT"] = 0;
                                    }
								}
                                $rate_usd=$val["CONS_RATE"]/$conversion_data_arr[str_replace("'","",$cbo_company_name)][change_date_format($val["TRANSACTION_DATE"])];
                                $amount_usd=$val["CONS_AMOUNT"]/$conversion_data_arr[str_replace("'","",$cbo_company_name)][change_date_format($val["TRANSACTION_DATE"])];
								$html.='<td align="right"  width="80">'. number_format($val["CONS_RATE"],2,".","").'</td>
	                            <td align="right" width="100" class="wrd_brk">'. number_format($val["CONS_AMOUNT"],2,".","").'</td>
                                <td align="right"  width="80" class="wrd_brk">'.number_format($rate_usd,3,".","").'</td>
	                            <td align="right" width="100" class="wrd_brk">'.number_format($amount_usd,3,".","").'</td>
	                            <td width="110" align="center" class="wrd_brk">'. $user_name_arr[$val["INSERTED_BY"]].'</td>
	                            <td width="140" class="wrd_brk">'.change_date_format($val["INSERT_DATE"]).' '.$val["INSERT_TIME"].'</td>
	                            <td class="wrd_brk">'. $remarks .'</td>
							</tr>';
							$totla_amount +=$val["CONS_AMOUNT"];
                            $total_amount_usd +=$amount_usd;
							$i++;
						}
						$html.='</tbody>
					</table>
	                <table width="'.$table_width.'" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="report_table_footer" align="left">
	                    <tfoot>
	                    	<th width="30">&nbsp;</th>
	                        <th width="60">&nbsp;</th>
	                        <th width="70">&nbsp;</th>
	                        <th width="130">&nbsp;</th>
	                        <th width="100">&nbsp;</th>
							';
							if($rptType==3)
							{
								$html.='<th width="80">&nbsp;</th>';
							}
	                        $html.='<th width="120">&nbsp;</th>
	                        <th width="100">&nbsp;</th>
	                        <th width="100">&nbsp;</th>';
							if($rptType==3)
							{
								$html.='<th width="100">&nbsp;</th>
								<th width="100">&nbsp;</th>';
							}
							$html.='<th width="120">&nbsp;</th>
	                        <th width="100">&nbsp;</th>';
							if($rptType==1)
							{
								$html.='<th width="100">&nbsp;</th>';
							}

	                        $html.='<th width="100">&nbsp;</th>
	                        <th width="150">&nbsp;</th>
	                        <th width="90">&nbsp;</th>
	                        <th width="100">&nbsp;</th>
	                        <th width="100">&nbsp;</th>
	                        <th width="100">&nbsp;</th>
	                        <th width="100">&nbsp;</th>';
	                        if($rptType==3){
                                $html.='<th width="145">&nbsp;</th>';
	                        }
	                        $html.='<th width="120">';
                            if($rptType==3) $html.= 'Total:';
                            $html.='</th>';
	                        if($rptType==2 || $rptType==1 )
							{
								$html.='<th width="80" >&nbsp;</th>
	                            <th width="80" >&nbsp;</th>
	                            <th width="80" >Total:</th>
	                        	<th width="80" id="value_total_receive_y">'.number_format($total_receive,2).'</th>
	                            <th width="80" id="val_tot_receive_ret_qty_y">'.number_format($tot_receive_ret_qty,2).'</th>
	                            <th width="80" id="value_total_order_amt_y">'.number_format($total_order_amt,2).'</th>';
							}
							if($rptType==3 || $rptType==1 )
							{
								$html.='<th width="80" id="value_total_issue_y">'.number_format($total_issue,2).'</th>
	                            <th width="80" id="val_tot_issue_ret_qty_y">'.number_format($tot_issue_ret_qty,2).'</th>
	                            <th width="80" id="value_total_return_y">'.number_format($total_return,2).'</th>';
							}
							$html.='<th width="80">&nbsp;</th>
	                        <th id="value_totla_amount_y" width="100">'.number_format($totla_amount,2).'</th>
                            <th width="80">&nbsp;</th>
	                        <th id="value_totla_amount_usd" width="100">'.number_format($total_amount_usd,2).'</th>
	                        <th width="110">&nbsp;</th>
	                        <th width="140">&nbsp;</th>
	                        <th>&nbsp;</th>
	                    </tfoot>
	                </table>
				</div>
	        </fieldset>
			</div>';
        }
        else
        {
        	$show_html_1 = 0;
        }
	} //yarn

    if(count($cbo_item_cat) > 0)  // Others Categorys
	{
        $cbo_item_cat = implode(",",$cbo_item_cat);

        $stationary_print_report_format=return_field_value("format_id","lib_report_template","template_name =".$cbo_company_name." and module_id=5 and report_id=61 and is_deleted=0 and status_active=1");
        $stationary_format_ids=explode(",",$stationary_print_report_format);
        $spare_print_report_format=return_field_value("format_id","lib_report_template","template_name =".$cbo_company_name." and module_id=5 and report_id=30 and is_deleted=0 and status_active=1");
        $spare_format_ids=explode(",",$spare_print_report_format);
        $dnc_print_report_format=return_field_value("format_id","lib_report_template","template_name =".$cbo_company_name." and module_id=5 and report_id=132 and is_deleted=0 and status_active=1");
        $dnc_format_ids=explode(",",$dnc_print_report_format);


		if($cbo_item_cat != "") $item_cond=" and a.item_category in ($cbo_item_cat) and b.item_category_id in ($cbo_item_cat)";
		$use_for_cond="";
		if($cbo_use_for>0) $use_for_cond=" and a.use_for=$cbo_use_for";
		if($rptType==1)
		{
			$sql="SELECT
					a.id as trans_id,
					a.transaction_type,
					a.mst_id as rec_issue_id,
					a.transaction_date,
					case when a.transaction_type in(1,4,5) then a.cons_quantity else 0 end as receive_qty,
					case when a.transaction_type in(2,3,6) then a.cons_quantity else 0 end as issue_qty,
					a.cons_uom,
					a.item_category,
					a.supplier_id,
					b.id as prod_id,
					b.item_group_id,
					b.sub_group_name,
					b.item_description,
					a.department_id,
					b.item_code,
					b.item_size,
					a.cons_rate,
					a.cons_amount,
					a.inserted_by,
					$select_insert_date,
					$select_insert_time,
					a.order_qnty,
					a.order_rate,
					a.machine_category,
					a.machine_id,
					a.floor_id,
                    a.production_floor,
					a.use_for,
					a.STORE_ID,
					a.item_return_qty as return_qnty
				from
					inv_transaction a, product_details_master b
				where
					a.prod_id=b.id and a.company_id=$cbo_company_name and a.transaction_type in(1,2,3,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $item_cond $date_cond $sql_cond $transaction_ids_cond_for_mrr
				order by a.transaction_date, a.id";
		}
		else if($rptType==2)
		{
			$sql="SELECT
					a.id as trans_id,
					a.transaction_type,
					a.mst_id as rec_issue_id,
					a.transaction_date,
					a.cons_quantity as receive_qty,
					'' as issue_qty,
					a.cons_uom,
					a.item_category,
					a.supplier_id,
					b.id as prod_id,
					b.item_group_id,
					b.sub_group_name,
					b.item_description,
					b.item_code,
					b.item_size,
					a.cons_rate,
					a.cons_amount,
					c.receive_basis,
					c.booking_id,
					c.booking_no,
					a.inserted_by,
					$select_insert_date,
					$select_insert_time,
					a.order_qnty,
					a.order_rate,
					a.machine_category,
					a.machine_id,
					a.floor_id,
					a.use_for,
					a.STORE_ID,
					a.item_return_qty as return_qnty,
					a.remarks
				from
					inv_transaction a, product_details_master b, inv_receive_master c
				where
					a.mst_id=c.id and a.prod_id=b.id and a.company_id=$cbo_company_name and a.transaction_type in(1,4,5) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $item_cond $date_cond $sql_cond $transaction_ids_cond_for_mrr
				order by a.transaction_date, a.id";
		}
		else if($rptType==3)
		{
			$sql="SELECT
					a.id as trans_id,
					a.transaction_type,
					a.mst_id as rec_issue_id,
					a.transaction_date,
					'' as receive_qty,
					a.cons_quantity as issue_qty,
					a.cons_uom,
					a.item_category,
					a.supplier_id,
					b.id as prod_id,
					b.item_group_id,
					b.sub_group_name,
					b.item_description,
					b.item_code,
					b.item_size,
					a.cons_rate,
					a.cons_amount,
					a.department_id,
					a.division_id,
					a.section_id,
					a.inserted_by,
					$select_insert_date,
					$select_insert_time,
					a.order_qnty,
					a.order_rate,
					a.machine_category,
					a.machine_id,
					a.floor_id,
                    a.production_floor,
					a.use_for,
					a.STORE_ID,
					a.item_return_qty as return_qnty,
					a.remarks
				from
					inv_transaction a, product_details_master b
				where
					a.prod_id=b.id and a.company_id=$cbo_company_name and a.transaction_type in(2,3,6) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $item_cond $date_cond $use_for_cond $sql_cond $transaction_ids_cond_for_mrr
				    order by a.transaction_date, a.id";
		}
		//echo $sql;//die;
		if($rptType==1)
		{
			$table_width=2840;
			$div_width="2880px";
		}
		else if($rptType==2)
		{
			$table_width=2640;
			$div_width="2660px";
		}
		else if($rptType==3)
		{
			$table_width=2930;
			$div_width="2940px";
		}

		$sql_result=sql_select($sql);
        $receive_ids_arr=array();
        $issue_ids_arr=array();
        $transfer_ids_arr=array();
        foreach($sql_result as $row)
        {
            if ($row[csf("transaction_type")]==1 || $row[csf("transaction_type")]==4){
                $receive_ids_arr[$row[csf("rec_issue_id")]]=$row[csf("rec_issue_id")];
            } else if ($row[csf("transaction_type")]==2 || $row[csf("transaction_type")]==3) {
                $issue_ids_arr[$row[csf("rec_issue_id")]]=$row[csf("rec_issue_id")];
            } else $transfer_ids_arr[$row[csf("rec_issue_id")]]=$row[csf("rec_issue_id")];
        }

        $receive_num_arr=array();
        $pi_ids_arr=array();
        $booking_ids_arr=array();
        $requ_ids_arr=array();
        if (count($receive_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 33, $receive_ids_arr, $empty_arr);
            $sql_receive_res=sql_select("SELECT a.id, a.recv_number, a.challan_no, a.challan_date, a.supplier_id,a.knitting_source, a.knitting_company, a.currency_id, a.exchange_rate, a.booking_id, a.booking_no, a.receive_basis,a.booking_no, b.item_category from gbl_temp_engine g, inv_receive_master a, inv_transaction b where g.ref_val=a.id and a.id=b.mst_id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=33 and b.item_category in($cbo_item_cat) and b.transaction_type in(1,4) and a.status_active=1 and b.status_active=1 and b.is_deleted=0");
            foreach($sql_receive_res as $row)
            {
                $receive_num_arr[$row[csf("id")]]["id"]=$row[csf("id")];
			    $receive_num_arr[$row[csf("id")]]["recv_number"]=$row[csf("recv_number")];
                $receive_num_arr[$row[csf("id")]]["challan_no"]=$row[csf("challan_no")];
                $receive_num_arr[$row[csf("id")]]["challan_date"]=$row[csf("challan_date")];
                $receive_num_arr[$row[csf("id")]]["supplier_id"]=$row[csf("supplier_id")];
                $receive_num_arr[$row[csf("id")]]["knitting_source"]=$row[csf("knitting_source")];
                $receive_num_arr[$row[csf("id")]]["knitting_company"]=$row[csf("knitting_company")];
                $receive_num_arr[$row[csf("id")]]["currency_id"]=$row[csf("currency_id")];
                $receive_num_arr[$row[csf("id")]]["exchange_rate"]=$row[csf("exchange_rate")];
                $receive_num_arr[$row[csf("id")]]["booking_id"]=$row[csf("booking_id")];
                $receive_num_arr[$row[csf("id")]]["booking_no"]=$row[csf("booking_no")];
                $receive_num_arr[$row[csf("id")]]["receive_basis"]=$row[csf("receive_basis")];
                $receive_num_arr[$row[csf("booking_id")]]["receive_basis"]=$row[csf("receive_basis")];
                $receive_num_arr[$row[csf("id")]]["item_category"]=$row[csf("item_category")];

                if ($row[csf("booking_id")]>0){
                    if ($row[csf("receive_basis")]==1){
                        $pi_ids_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
                    } else if ($row[csf("receive_basis")]==2) {
                        $booking_ids_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
                    } else if ($row[csf("receive_basis")]==7) {
                        $requ_ids_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
                    }
                }

            }
            unset($sql_receive_res);
        }

        $issue_num_arr=$rtn_qry_arr=array();
        if (count($issue_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 34, $issue_ids_arr, $empty_arr);
            $sql_issue_res=sql_select("SELECT a.id, a.issue_number, a.challan_no, a.req_no, a.knit_dye_source, a.knit_dye_company, b.remarks, a.booking_no, a.booking_id, b.item_category, a.issue_purpose, c.rtn_qnty, c.product_id from gbl_temp_engine g, inv_issue_master a left join inv_itemissue_requisition_dtls c on a.req_id = c.mst_id, inv_transaction b  where g.ref_val=a.id and a.id=b.mst_id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=34 and b.item_category in($cbo_item_cat) and b.transaction_type in(2,3) and a.status_active=1 and b.status_active=1 and b.is_deleted=0");//die;

            foreach($sql_issue_res as $row)
            {
                $issue_num_arr[$row[csf("id")]]["id"]=$row[csf("id")];
                $issue_num_arr[$row[csf("id")]]["issue_number"]=$row[csf("issue_number")];
                $issue_num_arr[$row[csf("id")]]["challan_no"]=$row[csf("challan_no")];
                $issue_num_arr[$row[csf("id")]]["req_no"]=$row[csf("req_no")];
                $issue_num_arr[$row[csf("id")]]["knit_dye_source"]=$row[csf("knit_dye_source")];
                $issue_num_arr[$row[csf("id")]]["knit_dye_company"]=$row[csf("knit_dye_company")];
                $issue_num_arr[$row[csf("id")]]["remarks"]=$row[csf("remarks")];
                $issue_num_arr[$row[csf("id")]]["booking_no"]=$row[csf("booking_no")];
                $issue_num_arr[$row[csf("id")]]["booking_id"]=$row[csf("booking_id")];
                $issue_num_arr[$row[csf("id")]]["item_category"]=$row[csf("item_category")];
                $issue_num_arr[$row[csf("id")]]["issue_purpose"]=$row["ISSUE_PURPOSE"];
                $rtn_qry_arr[$row[csf("id")]][$row[csf("product_id")]]["RTN_QNTY"]=$row["RTN_QNTY"];
                if ($row[csf("booking_id")]>0) $booking_ids_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
            }

			// echo "<pre>";
			// print_r($issue_num_arr);
            unset($sql_issue_res);
        }

        $transfer_num_arr=array();
        if (count($transfer_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 35, $transfer_ids_arr, $empty_arr);
            $sql_transfer_res=sql_select("SELECT a.id, a.transfer_system_id, a.challan_no, a.transfer_date from gbl_temp_engine g, inv_item_transfer_mst a, inv_transaction b where g.ref_val=a.id and a.id=b.mst_id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=35 and b.item_category in($cbo_item_cat) and b.transaction_type in(5,6) and a.status_active=1 and b.status_active=1 and b.is_deleted=0");
            foreach($sql_transfer_res as $row)
            {
                $transfer_num_arr[$row[csf("id")]]["id"]=$row[csf("id")];
                $transfer_num_arr[$row[csf("id")]]["transfer_system_id"]=$row[csf("transfer_system_id")];
                $transfer_num_arr[$row[csf("id")]]["challan_no"]=$row[csf("challan_no")];
                $transfer_num_arr[$row[csf("id")]]["transfer_date"]=$row[csf("transfer_date")];
            }
            unset($sql_transfer_res);
        }

        $pi_num_arr=array();
        if (count($pi_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 36, $pi_ids_arr, $empty_arr);
            $sql_pi_res=sql_select("SELECT b.ID, b.PI_NUMBER from gbl_temp_engine g, com_pi_master_details b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=36 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_pi_res as $row)
            {
                $pi_num_arr[$row["ID"]]=$row["PI_NUMBER"];
            }
            unset($sql_pi_res);
        }

        $wo_arr=array();
        $select_non_order_report_data=array();
        if (count($booking_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 37, $booking_ids_arr, $empty_arr);
            $sql_wo_res=sql_select("SELECT a.id, a.company_name, a.wo_number_prefix_num, a.requisition_no, a.wo_number, a.wo_date, a.attention, a.location_id, a.supplier_id, a.pay_mode, a.source, a.currency_id, a.delivery_date, a.wo_basis_id, b.item_category_id from gbl_temp_engine g, wo_non_order_info_mst a, wo_non_order_info_dtls b where g.ref_val=a.id and a.id=b.mst_id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=37 and a.status_active=1 and b.status_active=1");//die;
            foreach($sql_wo_res as $row)
            {
                $wo_arr[$row[csf("id")]]['wo_number']=$row[csf("wo_number")];
				$wo_arr[$row[csf("id")]]['requ_no']=$row[csf("requisition_no")];

                $select_non_order_report_data[$row[csf("id")]]['id']=$row[csf("id")];
                $select_non_order_report_data[$row[csf("id")]]['company_name']=$row[csf("company_name")];
                $select_non_order_report_data[$row[csf("id")]]['wo_number_prefix_num']=$row[csf("wo_number_prefix_num")];
                $select_non_order_report_data[$row[csf("id")]]['wo_number']=$row[csf("wo_number")];
                $select_non_order_report_data[$row[csf("id")]]['wo_date']=$row[csf("wo_date")];
                $select_non_order_report_data[$row[csf("id")]]['attention']=$row[csf("attention")];
                $select_non_order_report_data[$row[csf("id")]]['location_id']=$row[csf("location_id")];
                $select_non_order_report_data[$row[csf("id")]]['supplier_id']=$row[csf("supplier_id")];
                $select_non_order_report_data[$row[csf("id")]]['pay_mode']=$row[csf("pay_mode")];
                $select_non_order_report_data[$row[csf("id")]]['source']=$row[csf("source")];
                $select_non_order_report_data[$row[csf("id")]]['currency_id']=$row[csf("currency_id")];
                $select_non_order_report_data[$row[csf("id")]]['delivery_date']=$row[csf("delivery_date")];
                $select_non_order_report_data[$row[csf("id")]]['wo_basis_id']=$row[csf("wo_basis_id")];
                $select_non_order_report_data[$row[csf("id")]]['item_category_id']=$row[csf("item_category_id")];
            }
            unset($sql_wo_res);
        }

        $req_location_arr=array();
        $requisiton_arr=array();
        if (count($requ_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 38, $requ_ids_arr, $empty_arr);
            $sql_requ_res=sql_select("SELECT b.ID, b.LOCATION_ID, b.REQU_PREFIX_NUM from gbl_temp_engine g, inv_purchase_requisition_mst b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=38 ");//die;
            foreach($sql_requ_res as $row)
            {
                $req_location_arr[$row["ID"]]=$row["LOCATION_ID"];
                $requisiton_arr[$row["ID"]]=$row["REQU_PREFIX_NUM"];
            }
            unset($sql_requ_res);
        }

        foreach($sql_result as $row)
        {
            $requ_no=$wo_arr[$receive_num_arr[$row[csf('rec_issue_id')]]["booking_id"]]['requ_no'];
            $reqs=explode(",", rtrim($requ_no,','));
            $req_book_no='';
            foreach($reqs as $val)
            {
               $req_ids .= $val.",";
            }
        }
        $all_req_id = ltrim(implode(",", array_unique(explode(",", chop($req_ids, ",")))), ',');

        $req_sql=sql_select("SELECT a.id, a.requ_no from inv_purchase_requisition_mst a, inv_purchase_requisition_dtls b where a.id=b.mst_id and a.id in($all_req_id) and a.is_deleted=0 and b.is_deleted=0");
		$reqisition_data=array();
		foreach ($req_sql as $row)
		{
			$reqisition_data[$row[csf('id')]]['requ_no']=$row[csf('requ_no')];
		}

        $group_arr=return_library_array( "select id, item_name from  lib_item_group",'id','item_name');
        $machine_arr=return_library_array( "select id, machine_no from lib_machine_name",'id','machine_no');
        if($rptType==1 || $rptType==3)
        {
            $floor_arr=return_library_array( "select floor_room_rack_id, floor_room_rack_name from  lib_floor_room_rack_mst",'floor_room_rack_id','floor_room_rack_name');
            $iss_floor_arr=return_library_array( "SELECT id, floor_name from  lib_prod_floor",'id','floor_name');
        }

		$show_html_other = 1;
		if(count($sql_result) > 0)
		{

			$html.='<br>
			<div style="width:'.$div_width.'">
			<fieldset style="width:'.$div_width.'">
					<table width="'.$table_width.'" border="0" cellpadding="2" cellspacing="0" class="rpt_table" rules="all" id="" align="left">
							<tr class="form_caption" style="border:none;">
								<td colspan="16" align="left" style="border:none;font-size:16px; font-weight:bold" > Others : </td>
							</tr>
					   </table>
					   <br />
					<table width="'.$table_width.'" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="table_header_1" align="left">
						<thead>
							<tr>
								<th width="30" >SL</th>
								<th width="70" >Prod. Id</th>
								<th width="100" >Trans. Date</th>
								<th width="130" >Trans. Ref.</th>
								<th width="100" >Store Name</th>';
                                if($rptType==3)
								{
									$html.='<th width="80">Issue Purposed</th>';
								}
                                $html.='<th width="70" >WO/PI</th>
								<th width="100" >Category</th>
								<th width="100" >Supplier</th>
								<th width="100" >Challan No</th>';
								if($rptType==1 || $rptType==2)
								{
									$html.='<th width="80">Challan Date</th>';
								}
								if($rptType==2)
								{
									$html.='<th width="80">Receive Basis</th>';
								}
								$html.='<th width="100">Pur. Reqsn/<br /> Book. No/<br />Store Reqsn</th>';
								if($rptType==2)
								{
									$html.='<th width="100">WO/PI No.</th>';
								}
								else if($rptType==3)
								{
									$html.='<th width="100">Division</th>
									<th width="100">Department</th>
									<th width="100">Section</th>';
								}
								$html.='<th width="130">Item Group</th>
								<th width="70">UOM</th>
								<th width="100">Item Sub-Group</th>
								<th width="120">Item Description</th>
								<th width="100">Item Code</th>';
								if($rptType==3 || $rptType==1 )
								{
									$html.='<th width="100">Machine Category</th>
									<th width="100">Stock Floor</th>
									<th width="100">Issue To Floor</th>
									<th width="100">Machine No</th>';
								}
								$html.='<th width="80">Size</th>';
								if($rptType==2 || $rptType==1 )
								{
									$html.='<th width="80">Currency</th>
									<th width="80">Exchange Rate</th>
									<th width="80">Actual Rate</th>
									<th width="80">Receive Qty</th>
									<th width="80">Actual Amt</th>';
								}
								if($rptType==3 || $rptType==1 )
								{
									$html.='<th  width="80">Issue Qty</th>
									<th  width="80">Replace Qty</th>';
								}
								$html.='<th  width="80">Rate(TK)</th>
								<th  width="100">Amount(TK)</th>';
								 if($rptType==3 || $rptType==1 )
								 { $html.='<th width="100">Issue To</th>'; }
								 $html.='<th  width="110">User</th>
								<th  width="160">Insert Date</th>';
								if($rptType==2 )
								{ $html.='<th width="100">Comments</th>'; }
								if($rptType==3)
								{
									$html.='<th width="100">Use For</th>
									<th width="120">Remarks</th>';
								}
								$html.='</tr>
						</thead>
				   </table>
				   <br />
				  <div style="width:'.$div_width.'; overflow-y: scroll; max-height:250px;" id="scroll_body">
					<table width="'.$table_width.'" class="rpt_table" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_body_0" align="left">
						<tbody>';
						$group_arr=return_library_array( "select id, item_name from  lib_item_group",'id','item_name');
						$i=1;$total_receive="";$total_issue="";$others_total_amount2=0;
						foreach($sql_result as $row)
						{
							if ($i%2==0)
							$bgcolor="#E9F3FF";
							else
							$bgcolor="#FFFFFF";
							$html.='<tr bgcolor="'.$bgcolor.'" onClick="change_color(\'tr_'.$i.'\',\''.$bgcolor.'\')" id="tr_'.$i.'">
								<td width="30">'.$i.'</td>
								<td width="70" align="center" class="wrd_brk">'.$row[csf("prod_id")].'</td>
								<td width="100" align="center" class="wrd_brk">'.change_date_format($row[csf("transaction_date")]).'</ td>
								<td width="130"  class="wrd_brk" align="center" title="'.$row[csf("transaction_type")].'_'.$row[csf('rec_issue_id')].'">
								<a href="##" onClick="openmypage_mrr(\'mrr_popup\',\''.$row[csf("transaction_type")].'\',\''.$row[csf('trans_id')].'\',\''.$cbo_company_name.'\');">';
								if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4)
								{
									$html.= $receive_num_arr[$row[csf('rec_issue_id')]]["recv_number"];
								}
								else if($row[csf("transaction_type")]==2  || $row[csf("transaction_type")]==3)
								{
									$html.= $issue_num_arr[$row[csf('rec_issue_id')]]["issue_number"];
								}
								else if( $row[csf("transaction_type")]==5 || $row[csf("transaction_type")]==6)
								{
									$html.= $transfer_num_arr[$row[csf('rec_issue_id')]]["transfer_system_id"];
								}
								$html.='</a>
								</td>
								<td width="100">'.$store_arr[$row[csf("store_id")]].'</td>
								';

                                if($rptType==3)
                                {
                                    $html.='<td width="80">';
                                    if($row[csf("transaction_type")]==2)
                                    {
                                        $html.=$general_issue_purpose[$issue_num_arr[$row[csf('rec_issue_id')]]["issue_purpose"]];
                                    }
                                    $html.='</td>';
                                }
								   if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4)
								   {
										$basis = $receive_num_arr[$row[csf('rec_issue_id')]]['receive_basis'];
										$booking_no = $receive_num_arr[$row[csf('rec_issue_id')]]["booking_no"];
										$booking_id = $receive_num_arr[$row[csf('rec_issue_id')]]["booking_id"];
										if($basis == 1 && $booking_no != ''){ //pi
											$html.='<td width="70"  class="wrd_brk" align="center"><a href="javascript:void(0)" onClick="pi_report_generate('.$booking_id.')">'. $booking_no.'</a></td>';
										}
										elseif($basis == 2 && $booking_no != ''){
											if($row[csf('item_category')] == 11 || $row[csf('item_category')] == 4) {
												if ($stationary_format_ids[0] == 66) {
													$report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
													$report_action = "stationary_work_order_print";
												} elseif ($stationary_format_ids[0] == 85) {
													$report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
													$report_action = "stationary_work_order_print3";
												} elseif ($stationary_format_ids[0] == 129) {
													$report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
													$report_action = "stationary_work_order_print5";
												} elseif ($stationary_format_ids[0] == 137) {
													$report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
													$report_action = "stationary_work_order_print4";
												} elseif ($stationary_format_ids[0] == 430) {
													$report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*1';
													$report_action = "stationary_work_order_po_print2";
												} elseif ($stationary_format_ids[$booking_id] == 732) {
													$report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
													$report_action = "stationary_work_order_po_print";
												} elseif ($stationary_format_ids[0] == 134) {
													$report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
													$report_action = "stationary_work_print";
												} else {
													$report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
													$report_action = "stationary_work_print";
												}
												$report_path = "../../commercial/work_order/requires/stationary_work_order_controller";
											}
											else if(in_array($row[csf('item_category')], explode(',', '8,9,10,15,16,17,18,19,20,21,22,32,34,36,35,37,38,39,33,40,41,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,89,90,91,92,93,94')))
											{
												if($spare_format_ids[0]==84)
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"];
													$report_action="spare_parts_work_order_print2";
												}
												elseif($spare_format_ids[0]==85)
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
													$report_action="spare_parts_work_order_print3";
												}
												elseif($spare_format_ids[0]==732)
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
													$report_action="spare_parts_work_order_po_print";
												}
												elseif($spare_format_ids[0]==137)
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"].'*5';
													$report_action="spare_parts_work_print";
												}
												elseif($spare_format_ids[0]==129)
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"].'*6';
													$report_action="spare_parts_work_print";
												}
												elseif($spare_format_ids[0]==134)
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
													$report_action="spare_parts_work_order_po_print";
												}
												elseif($spare_format_ids[0]==191)
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"].'*7';
													$report_action="spare_parts_work_print_urmi";
												}
												elseif($spare_format_ids[0]==227)
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"].'*7';
													$report_action="spare_parts_work_order_print8";
												}
												elseif($spare_format_ids[0]==235)
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
													$report_action="spare_parts_work_order_print9";
												}
												elseif($spare_format_ids[0]==274)
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
													$report_action="spare_parts_work_order_print10";
												}
												elseif($spare_format_ids[0]==354)
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"];
													$report_action="spare_parts_work_print_8";
												}
												elseif($spare_format_ids[0]==430)
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"];
													$report_action="spare_parts_work_order_po_print2";
												}
												else
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"];
													$report_action="spare_parts_work_print";
												}
												$report_path="../../commercial/work_order/requires/spare_parts_work_order_controller";
											}
											else if(in_array($row[csf('item_category')], explode(',', '5,6,7,23')))
											{
												if($dnc_format_ids[0]==78)
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Dyes And Chemical Purchase Order*1';
													$report_action="dyes_chemical_work_print";
												}
												elseif($dnc_format_ids[0]==84)
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Dyes And Chemical Purchase Order*1';
													$report_action="dyes_chemical_work_print2";
												}
												elseif($dnc_format_ids[0]==732)
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Dyes And Chemical Purchase Order*1';
													$report_action="dyes_chemical_work_po_print";
												}
												elseif($dnc_format_ids[0]==85)
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Dyes And Chemical Purchase Order*1';
													$report_action="dyes_chemical_work_print3";
												}
												elseif($dnc_format_ids[0]==430)
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Dyes And Chemical Purchase Order*1';
													$report_action="dyes_chemical_work_po_print2";
												}
												else
												{
													$report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Dyes And Chemical Purchase Order*1';
													$report_action="dyes_chemical_work_print";
												}
												$report_path="../../commercial/work_order/requires/dyes_and_chemical_work_order_controller";
											}
											$html.='<td width="70"  class="wrd_brk" align="center"><a href="javascript:void(0)" onClick="print_report(\''.$report_data.'\',\''.$report_action.'\',\''.$report_path.'\')">'.$booking_no.'</a></td>';
										}elseif($basis == 7){ //req
											$html.='<td width="70"  class="wrd_brk" align="center"><a href="javascript:void(0)" onClick="req_report_generate('.$reqReportFormat.','.$booking_id.','.str_replace("'","",$cbo_company_name).',\'\',1,'.$req_location_arr[$booking_id].')">'.$booking_no.'</a></td>';
										}else{
											$html.='<td width="70"  class="wrd_brk" align="center">'.$booking_no.'</td>';
										}
								   }
								   else if($row[csf("transaction_type")]==2  || $row[csf("transaction_type")]==3)
								   {
									   if($issue_num_arr[$row[csf('rec_issue_id')]]["booking_id"] != ''){
										   $basis = $receive_num_arr[$issue_num_arr[$row[csf('rec_issue_id')]]["booking_id"]]['receive_basis'];
										   $booking_no = $issue_num_arr[$row[csf('rec_issue_id')]]["booking_no"];
										   $booking_id = $issue_num_arr[$row[csf('rec_issue_id')]]["booking_id"];
										   if($basis == 1 && $booking_no != ''){ //pi
											$html.='<td width="70"  class="wrd_brk" align="center"><a href="javascript:void(0)" onClick="pi_report_generate('.$booking_id.')">'.$booking_no.'</a></td>';
										   }
										   elseif($basis == 2 && $booking_no != ''){
											   if($row[csf('item_category')] == 11 || $row[csf('item_category')] == 4) {
                                                    if ($stationary_format_ids[0] == 66) {
                                                        $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
                                                        $report_action = "stationary_work_order_print";
                                                    } elseif ($stationary_format_ids[0] == 85) {
                                                        $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
                                                        $report_action = "stationary_work_order_print3";
                                                    } elseif ($stationary_format_ids[0] == 129) {
                                                        $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
                                                        $report_action = "stationary_work_order_print5";
                                                    } elseif ($stationary_format_ids[0] == 137) {
                                                        $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
                                                        $report_action = "stationary_work_order_print4";
                                                    } elseif ($stationary_format_ids[0] == 430) {
                                                        $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*1';
                                                        $report_action = "stationary_work_order_po_print2";
                                                    } elseif ($stationary_format_ids[0] == 732) {
                                                        $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
                                                        $report_action = "stationary_work_order_po_print";
                                                    } elseif ($stationary_format_ids[0] == 134) {
                                                        $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
                                                        $report_action = "stationary_work_print";
                                                    } else {
                                                        $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
                                                        $report_action = "stationary_work_print";
                                                    }
												   $report_path = "../../commercial/work_order/requires/stationary_work_order_controller";
											   }
											   else if(in_array($row[csf('item_category')], explode(',', '8,9,10,15,16,17,18,19,20,21,22,32,34,36,35,37,38,39,33,40,41,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,89,90,91,92,93,94')))
											   {
                                                    if($spare_format_ids[0]==84)
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"];
                                                        $report_action="spare_parts_work_order_print2";
                                                    }
                                                    elseif($spare_format_ids[0]==85)
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
                                                        $report_action="spare_parts_work_order_print3";
                                                    }
                                                    elseif($spare_format_ids[0]==732)
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
                                                        $report_action="spare_parts_work_order_po_print";
                                                    }
                                                    elseif($spare_format_ids[0]==137)
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"].'*5';
                                                        $report_action="spare_parts_work_print";
                                                    }
                                                    elseif($spare_format_ids[0]==129)
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"].'*6';
                                                        $report_action="spare_parts_work_print";
                                                    }
                                                    elseif($spare_format_ids[0]==134)
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
                                                        $report_action="spare_parts_work_order_po_print";
                                                    }
                                                    elseif($spare_format_ids[0]==191)
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"].'*7';
                                                        $report_action="spare_parts_work_print_urmi";
                                                    }
                                                    elseif($spare_format_ids[0]==227)
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"].'*7';
                                                        $report_action="spare_parts_work_order_print8";
                                                    }
                                                    elseif($spare_format_ids[0]==235)
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
                                                        $report_action="spare_parts_work_order_print9";
                                                    }
                                                    elseif($spare_format_ids[0]==274)
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
                                                        $report_action="spare_parts_work_order_print10";
                                                    }
                                                    elseif($spare_format_ids[0]==354)
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"];
                                                        $report_action="spare_parts_work_print_8";
                                                    }
                                                    elseif($spare_format_ids[0]==430)
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"];
                                                        $report_action="spare_parts_work_order_po_print2";
                                                    }
                                                    else
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"];
                                                        $report_action="spare_parts_work_print";
                                                    }
												   $report_path="../../commercial/work_order/requires/spare_parts_work_order_controller";
											   }
											   else if(in_array($row[csf('item_category')], explode(',', '5,6,7,23')))
											   {
                                                    if($dnc_format_ids[0]==78)
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Dyes And Chemical Purchase Order*1';
                                                        $report_action="dyes_chemical_work_print";
                                                    }
                                                    elseif($dnc_format_ids[0]==84)
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Dyes And Chemical Purchase Order*1';
                                                        $report_action="dyes_chemical_work_print2";
                                                    }
                                                    elseif($dnc_format_ids[0]==732)
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Dyes And Chemical Purchase Order*1';
                                                        $report_action="dyes_chemical_work_po_print";
                                                    }
                                                    elseif($dnc_format_ids[0]==85)
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Dyes And Chemical Purchase Order*1';
                                                        $report_action="dyes_chemical_work_print3";
                                                    }
                                                    elseif($dnc_format_ids[0]==430)
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Dyes And Chemical Purchase Order*1';
                                                        $report_action="dyes_chemical_work_po_print2";
                                                    }
                                                    else
                                                    {
                                                        $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Dyes And Chemical Purchase Order*1';
                                                        $report_action="dyes_chemical_work_print";
                                                    }
												   $report_path="../../commercial/work_order/requires/dyes_and_chemical_work_order_controller";
											   }
											   $html.='<td width="70"  class="wrd_brk"  align="center"><a href="javascript:void(0)" onClick="print_report(\''.$report_data.'\',\''.$report_action.'\',\''.$report_path.'\')">'.$booking_no.'</a></td>';
										   }elseif($basis == 7){ //req
											$html.='<td width="70"  class="wrd_brk"  align="center"><a href="javascript:void(0)" onClick="req_report_generate('.$reqReportFormat.','.$booking_id.','.str_replace("'","",$cbo_company_name).',\'\',1,'.$req_location_arr[$booking_id].')">'.$booking_no.'</a></td>';
										   }else{
											$html.='<td width="70"  class="wrd_brk"  align="center">'.$booking_no.'</td>';
										   }
									   }else{
										$html.= "<td width='70'  class='wrd_brk'>".$issue_num_arr[$row[csf('rec_issue_id')]]["booking_no"]."</td>";
									   }
								   }else{
									$html.= "<td width='70'></td>";
								   }
								$html.='<td width="100" class="wrd_brk">'.$item_category[$row[csf("item_category")]].'</td>
								<td width="100" class="wrd_brk">'.$supplier_arr[$row[csf("supplier_id")]].'</td>
								<td width="100" class="wrd_brk">';
								if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4)
								{
									$html.= $receive_num_arr[$row[csf('rec_issue_id')]]["challan_no"];
								}
								else if($row[csf("transaction_type")]==2  || $row[csf("transaction_type")]==3)
								{
									$html.= $issue_num_arr[$row[csf('rec_issue_id')]]["challan_no"];
								}
								else if($row[csf("transaction_type")]==5 || $row[csf("transaction_type")]==6)
								{
									$html.= $transfer_num_arr[$row[csf('rec_issue_id')]]["challan_no"];
								}
								$html.='</td>';
								if($rptType==1 || $rptType==2)
								{
									$html.='<td width="80" class="wrd_brk">';
                                    $receive_num_arr[$row[csf('rec_issue_id')]]["challan_date"];
                                    if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4)
                                    {
                                        $html.= $receive_num_arr[$row[csf('rec_issue_id')]]["challan_date"];
                                    }
                                    $html.= '</td>';
								}
								if($rptType==2)
								{
									$html.='<td width="80" class="wrd_brk">'.$receive_basis_arr[$row[csf("receive_basis")]].'</td>';
								}
								$html.='<td width="100" class="wrd_brk">';
								if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4)
								{
									//$req_book_no=$row[csf('rec_issue_id')];
									if($receive_num_arr[$row[csf('rec_issue_id')]]["receive_basis"]==7)
									{
										$req_book_no=$requisiton_arr[$receive_num_arr[$row[csf('rec_issue_id')]]["booking_id"]];
									}
									else if ($receive_num_arr[$row[csf('rec_issue_id')]]["receive_basis"]==2)
									{
										//$req_book_no=$receive_num_arr[$row[csf('rec_issue_id')]]["booking_no"];
										//$req_book_no=$wo_arr[$receive_num_arr[$row[csf('rec_issue_id')]]["booking_id"]]['wo_number'];

                                        //$requ_no=$wo_arr[$row[csf("booking_id")]]['requ_no'];
                                        $requ_no=$wo_arr[$receive_num_arr[$row[csf('rec_issue_id')]]["booking_id"]]['requ_no'];
                                        $reqs=explode(",", rtrim($requ_no,','));
                                        //print_r($reqs);
                                        $req_book_no='';
                                        foreach($reqs as $val)
                                        {
                                            $req_book_no.=$reqisition_data[$val]['requ_no'].", ";
                                        }
                                        $req_book_no=rtrim($req_book_no,', ');

									}
									else
									{
										$req_book_no="";
									}
								}
								else if($row[csf("transaction_type")]==2  || $row[csf("transaction_type")]==3)
								{
									$req_book_no=$issue_num_arr[$row[csf('rec_issue_id')]]["req_no"];
								}
								else if($row[csf("transaction_type")]==5  || $row[csf("transaction_type")]==6)
								{
									$req_book_no=$transfer_num_arr[$row[csf('rec_issue_id')]]["req_no"]."_";
								}
								$html.= $req_book_no.'</td>';
								if($rptType==2)
								{
									$html.='<td width="100" align="center">';
									if($row[csf("receive_basis")]==1)
									{
										$html.= $pi_num_arr[$row[csf("booking_id")]];
									}
									else if($row[csf("receive_basis")]==2)
									{
										$html.= $wo_arr[$row[csf("booking_id")]]['wo_number'];
										//requ_no
									}
									$html.='</td>';
								}
								else if($rptType==3)
								{
									$html.='<td width="100" align="center" class="wrd_brk">'.$lib_division_arr[$row[csf("division_id")]].'</td>
									<td width="100" align="center" class="wrd_brk">'.$department_arr[$row[csf("department_id")]].'</td>
									<td width="100" align="center" class="wrd_brk">'.$section_arr[$row[csf("section_id")]].'</td>';
								}

								$html.='<td width="130" class="wrd_brk" >'.$group_arr[$row[csf('item_group_id')]].'</td>
								<td width="70" align="center" class="wrd_brk">'. $unit_of_measurement[$row[csf("cons_uom")]].'</td>
								<td width="100" class="wrd_brk" >'.$row[csf('sub_group_name')].'</td>
								<td width="120" class="wrd_brk">'.$row[csf('item_description')].'</td>
								<td width="100" class="wrd_brk" >'.$row[csf('item_code')].'</td>';
								if($rptType==3 || $rptType==1 )
								{
									$html.='<td width="100" class="wrd_brk" >'.$machine_category[$row[csf('machine_category')]].'</td>
									<td width="100" class="wrd_brk" >'.$floor_arr[$row[csf('floor_id')]].'</td>
									<td width="100" class="wrd_brk" >'.$iss_floor_arr[$row[csf('production_floor')]].'</td>
									<td width="100" class="wrd_brk">'.$machine_arr[$row[csf('machine_id')]].'</td>';
								}
								$html.='<td width="80" class="wrd_brk">'.$row[csf('item_size')].'</td>';
								if($rptType==2 || $rptType==1 )
								{
									$html.='<td width="80" align="center" class="wrd_brk">';
									if($row[csf("transaction_type")]==1) $html.= $currency[$receive_num_arr[$row[csf('rec_issue_id')]]["currency_id"]];
									$html.='</td><td width="80" align="right" class="wrd_brk">';
									if($row[csf("transaction_type")]==1) $html.= number_format($receive_num_arr[$row[csf('rec_issue_id')]]["exchange_rate"],2);
									$html.='</td><td width="80" align="right" class="wrd_brk">';
									if($row[csf("transaction_type")]==1) $html.= number_format($row[csf('order_rate')],2);
									$html.='</td><td width="80" align="right">';
									$html.= number_format($row[csf("receive_qty")],2); $total_receive +=$row[csf("receive_qty")];
									$html.='</td><td width="80" align="right" class="wrd_brk">';
									if($row[csf("transaction_type")]==1) $order_amt=$row[csf('order_qnty')]*$row[csf('order_rate')]; $html.= number_format($order_amt,4); $total_order_amt+=$order_amt; $order_amt=0;
									$html.='</td>';
								}
								if($rptType==3 || $rptType==1 )
								{
									$html.='<td width="80" align="right" class="wrd_brk">'.number_format($row[csf("issue_qty")],2).'</td>
									<td width="80" align="right" class="wrd_brk">'.number_format($rtn_qry_arr[$row[csf("rec_issue_id")]][$row[csf("prod_id")]]["RTN_QNTY"],2).'</td>';
									$total_issue +=$row[csf("issue_qty")];
									$total_return_qnty +=$rtn_qry_arr[$row[csf("rec_issue_id")]][$row[csf("prod_id")]]["RTN_QNTY"];
									//$row[csf("return_qnty")];
									if($row[csf("issue_qty")] == 0){
										$row[csf("cons_rate")] = 0;
										$row[csf("cons_amount")] = 0;
									}
								}
								$html.='<td width="80" align="right" class="wrd_brk">'.number_format($row[csf("cons_rate")],2).'</td>
								<td align="right" class="wrd_brk" width="100" style="padding-right:3px">'.number_format($row[csf("cons_amount")],2); $total_amount +=$row[csf("cons_amount")]; $others_total_amount2=$others_total_amount2+$row[csf("cons_amount")]; 
								if($rptType==3 || $rptType==1 )
								{
									$html.='<td width="100" class="wrd_brk">'.$department_arr[$row[csf("department_id")]].'</td>';
								}
								$html.='<td width="107" class="wrd_brk">'.$user_name_arr[$row[csf("inserted_by")]].'</td>
								<td width="160" class="wrd_brk">'.change_date_format($row[csf("insert_date")]).' '.$row[csf("insert_time")].'</td>';
								if($rptType==2)
								{
									$html.='<td width="100" class="wrd_brk">'.$row[csf("remarks")].'</td>';
								}
								if($rptType==3)
								{
									$html.='<td width="100" class="wrd_brk">'.$use_for[$row[csf("use_for")]].'</td>
									<td width="120" class="wrd_brk">'.$row[csf("remarks")].'</td>';
								}
								$html.='</tr>';
							$item_wise_qty_arr[$row[csf('item_group_id')]][$row[csf('item_description')]]['recv']+=$row[csf("receive_qty")];
							$item_wise_qty_arr[$row[csf('item_group_id')]][$row[csf('item_description')]]['recv_amt']+=$row[csf('order_qnty')]*$row[csf('order_rate')];
							$item_wise_qty_arr[$row[csf('item_group_id')]][$row[csf('item_description')]]['issue']+=$row[csf("issue_qty")];
							$item_wise_qty_arr[$row[csf('item_group_id')]][$row[csf('item_description')]]['issue_amt']+=$row[csf("cons_amount")];
							$i++;
						}
						//print_r($item_wise_qty_arr);
						$html.='</tbody>
					</table>
					<table width="'.$table_width.'" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="report_table_footer" align="left">
						<tfoot>
							<tr>
								<th width="30">&nbsp;</th>
								<th width="70">&nbsp;</th>
								<th width="100">&nbsp;</th>
								<th width="130">&nbsp;</th>
								<th width="100">&nbsp;</th>
								';
                                if($rptType==3)
								{
									$html.='<th width="80">&nbsp;</th>';
								}
								$html.='<th width="70">&nbsp;</th>
								<th width="100">&nbsp;</th>
								<th width="100">&nbsp;</th>
								<th width="100">&nbsp;</th>';
								if($rptType==1 || $rptType==2)
								{
									$html.='<th width="80">&nbsp;</th>';
								}
								if($rptType==2)
								{
									$html.='<th width="80">&nbsp;</th>';
								}
								$html.='<th width="100">&nbsp;</th>';
								if($rptType==2)
								{
									$html.='<th width="100">&nbsp;</th>';
								}
								else if($rptType==3)
								{
									$html.='<th width="100">&nbsp;</th>
									<th width="100">&nbsp;</th>
									<th width="100">&nbsp;</th>';
								}

								$html.='<th width="130">&nbsp;</th>
								<th width="70">&nbsp;</th>
								<th width="100">&nbsp;</th>
								<th width="120">&nbsp;</th>
								<th width="100">&nbsp;</th>';
								if($rptType==3 || $rptType==1 )
								{
									$html.='<th width="100" >&nbsp;</th>
									<th width="100" >&nbsp;</th>
									<th width="100" >&nbsp;</th>
									<th width="100" >&nbsp;</th>';
								}
								$html.='<th width="80">';
								if($rptType==3) $html.= "Total:";
								$html.='</th>';
								if($rptType==2 || $rptType==1 )
								{
									$html.='<th width="80" >&nbsp;</th>									
									<th width="80" >Total:</th>
									<th width="80" id="value_total_receive">
									'.number_format($total_receive,2).'</th>
									<th width="80"  id="value_total_order_amt">'.number_format($total_order_amt,2).'</th>
									<th width="80" >&nbsp;</th>';
								}
								if($rptType==3 || $rptType==1 )
								{
									$html.='<th width="80" id="value_total_issue_overwrite">'.number_format($total_issue,2).'</th>
									<th width="80" id="value_total_issue_overwrite">'.number_format($total_return_qnty,2).'</th>';
								}
								$html.='<th width="80" >&nbsp;</th>
								<th id="value_total_amount_overwrite"  width="100">'.number_format($others_total_amount2,2).'</th>';
								if($rptType==3 || $rptType==1 )
								{
									$html.='<th width="100"></th>';
								}
								$html.='<th width="107" >&nbsp;</th>
								<th width="160" >&nbsp;</th>';
								if($rptType==2)
								{
									$html.='<th width="100"></th>';
								}
								if($rptType==3)
								{
									$html.='<th width="100" >&nbsp;</th>
									<th width="120" >&nbsp;</th>';
								}
								$html.='</tr>
						</tfoot>
					</table>
				 </div>
			</fieldset>
			<br>';
			if($cbo_item_cat==11)
			{
				$html.='<table width="650" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all"  align="left">
				<caption> <strong> Item Summary</strong></caption>
				<thead>
					<tr>
					<th width="30" >SL</th>
					<th width="100" >Item Group</th>
					<th width="120" >Item Desc.</th>';
					if($rptType==2 || $rptType==1 )
					{
						$html.='<th width="70" >Rcv Qty</th>
						<th width="50" >Rate(TK)</th>
						<th width="80" >Amount</th>';
					}
					if($rptType==3 || $rptType==1 )
					{
						$html.='<th width="70" >Issue Qty</th>
						<th width="50" >Rate(TK)</th>
						<th width="" >Amount</th>';
					}
					$html.='</tr>
				</thead>';
				$k=1;$total_rec_qty=0;$total_rec_amt=0;$total_issue_qty=0;$total_issue_amt=0;
				foreach($item_wise_qty_arr as $item_key=>$item_data)
				{
					foreach($item_data as $desc_key=>$desc_value)
					{
						$html.='<tr>
							<td width="30">'.$k.'</td>
							<td width="100" class="wrd_brk"> '.$group_arr[$item_key].'</td>
							<td width="120" class="wrd_brk" >'.$desc_key.'</td>';
							if($rptType==2 || $rptType==1 )
							{
								$html.='<td width="70" align="right" class="wrd_brk">'.number_format($desc_value['recv'],2).' </td>
								<td width="50" class="wrd_brk"> '.number_format($desc_value['recv_amt']/$desc_value['recv'],2).'</td>
								<td width="80"  class="wrd_brk" align="right">'.number_format($desc_value['recv_amt'],2).' </td>';
							}
							if($rptType==3 || $rptType==1 )
							{

								$html.='<td width="70"  align="right" class="wrd_brk">'.$desc_value['issue'].' </td>
								<td width="50" class="wrd_brk">'.number_format($desc_value['issue_amt']/$desc_value['issue'],2).' </td>
								<td  class="wrd_brk"  align="right">'.number_format($desc_value['issue_amt'],2).' </td>';
							}
						$html.='</tr>';
						$total_rec_qty+=$desc_value['recv'];
						$total_rec_amt+=$desc_value['recv_amt'];
						$total_issue_qty+=$desc_value['issue'];
						$total_issue_amt+=$desc_value['issue_amt'];
						$k++;
					}
				}
				$html.='<tfoot bgcolor="#D2D2D2">
					<td colspan="3"> </td>';
					if($rptType==2 || $rptType==1 )
					{
						$html.='<td width="70" align="right">'.number_format($total_rec_qty,2).'</td>
						<td width="50"  align="right">  </td>
						<td width="80"  align="right">'.number_format($total_rec_amt,2).'</td>';
					}
					if($rptType==3 || $rptType==1 )
					{
						$html.='<td width="70"  align="right">'.number_format($total_issue_qty,2).'</td>
						<td width="50"> </td>
						<td width=""  align="right">'.number_format($total_issue_amt,2).'</td>';
					}
					$html.='</tfoot>
				</table>';
			}
			$html.='</div>';
		}else{
			$show_html_other = 0;
		}
	}

	if($show_html_other==0 && $show_html_1==0 && $show_html_13==0 && $show_html_2==0 && $show_html_4 ==0)
	{
		$html.='<table class="rpt_table" rules="all" id="" style="border:none;" width="2280" cellspacing="0" cellpadding="2" border="0" align="left">
		<tbody>
		<tr class="form_caption" style="border:none;">
			<td colspan="12" style="border:nonex;font-size:13px; font-weight:bold; color:red;" align="center">No Data Found </td>
		</tr>
		</tbody>
		</table>';
	}

    // execute_query("delete from gbl_temp_engine where user_id=$user_id and entry_form=33 and ref_from in(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40)");
    // oci_commit($con); disconnect($con);

	foreach (glob($user_id."*.xls") as $filename) {
	if( @filemtime($filename) < (time()-$seconds_old) )
	@unlink($filename);
	}
	//---------end------------//
	$name=time();
	$filename=$user_id."_".$name.".xls";
	$create_new_doc = fopen($filename, 'w');
	// $is_created = fwrite($create_new_doc,ob_get_contents());
	$is_created = fwrite($create_new_doc,$html);
	//echo "$html**$filename**$cbo_item_cat**$rptType";
    echo "$html####$filename####$return_item_cat####$rptType";
    disconnect($con);
	exit();
}

//report generated here--------------------//
if($action=="generate_report_excel")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	$cbo_item_cat=str_replace("'","",$cbo_item_cat);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$cbo_buyer_name=str_replace("'","",$cbo_buyer_name);
	$cbo_store_name=str_replace("'","",$cbo_store_name);
    $sql_cond = "";
	if( trim($cbo_store_name)>0 ) $sql_cond .= " and a.store_id='$cbo_store_name'";
	$cbo_yarn_count=str_replace("'","",$cbo_yarn_count);
	$cbo_based_on=str_replace("'","",$cbo_based_on);
    $txt_mrr_no = str_replace("'","",$txt_mrr_no);
	$txt_date_from=str_replace("'","",$txt_date_from);
	$txt_date_to=str_replace("'","",$txt_date_to);
	$rptType=str_replace("'","",$rptType);
    $cbo_order_type=0;
	if($cbo_item_cat == "")
	{
		$cbo_item_cat = "1,2,3,4,13,8,9,10,11,15,16,17,18,19,20,21,22,23,32,34,35,36,37,38,39,33,40,41,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,89,81,85,90,91,92,93,94,99,101,106,107";
	}

	$return_item_cat = $cbo_item_cat;
	$cbo_item_cat = explode(",",$cbo_item_cat);

    $company_arr=return_library_array("select id, company_name from lib_company",'id','company_name');
	//$buyer_name_arr=return_library_array("select id, buyer_name from  lib_buyer",'id','buyer_name');
	$buyer_short_arr=return_library_array("select id, short_name from lib_buyer",'id','short_name');
	$color_arr=return_library_array("select id, color_name from  lib_color where status_active=1",'id','color_name');
	$supplier_arr=return_library_array("select id, supplier_name from lib_supplier where status_active=1",'id','supplier_name');
	$buyer_name_arr=return_library_array("select id, buyer_name from lib_buyer where status_active=1",'id','buyer_name');
    $user_name_arr=return_library_array("select id, user_name from user_passwd",'id','user_name');
    $department_arr=return_library_array( "select id, department_name from lib_department",'id','department_name');
	$section_arr=return_library_array( "select id, section_name from lib_section",'id','section_name');

	$trims_booking_report_format_woven_arr = array("183"=>"show_trim_booking_report2","67"=>"show_trim_booking_report","177"=>"show_trim_booking_report4","175"=>"show_trim_booking_report5","235"=>"show_trim_booking_report9","85"=>"print_t","146"=>"print_t7","774"=>"show_trim_booking_report_wg");

    $trims_booking_report_format_sweater_arr = array("67"=>"show_trim_booking_report2","183"=>"show_trim_booking_report3","209"=>"show_trim_booking_report4");

	$print_report_format_rcv=return_field_value("format_id","lib_report_template","template_name ='".$cbo_company_name."' and module_id=6 and report_id=191 and is_deleted=0 and status_active=1");
	$format_rcv_ids=explode(",",$print_report_format_rcv);

    $trims_booking_report_format = 	return_field_value("format_id","lib_report_template","template_name ='".$cbo_company_name."' and module_id=2 and report_id = 26 and is_deleted=0 and status_active=1");
    $trims_booking_report_format_ids=explode(",",$trims_booking_report_format);

    $trims_booking_report_format_woven =  return_field_value("format_id","lib_report_template","template_name ='".$cbo_company_name."' and module_id=2 and report_id = 219 and is_deleted=0 and status_active=1");
    $trims_booking_report_format_woven_ids=explode(",",$trims_booking_report_format_woven);

    $trims_booking_report_format_sweater =  return_field_value("format_id","lib_report_template","template_name ='".$cbo_company_name."' and module_id=2 and report_id = 26 and is_deleted=0 and status_active=1");
    $trims_booking_report_format_sweater_ids=explode(",",$trims_booking_report_format_sweater);


    $trim_print_data = "";

    $trim_report_action_woven = "";
    if(count($trims_booking_report_format_woven_ids) > 0) {

        $trim_report_action_woven = $trims_booking_report_format_woven_arr[$trims_booking_report_format_woven_ids[0]];
    }

    $trim_report_action_sweater = "";
    if(count($trims_booking_report_format_sweater_ids) > 0)
    {

        foreach($trims_booking_report_format_sweater_ids as $data)
        {
            if($data==67 || $data==183 || $data==209)
            {
                $trim_report_action_sweater = $trims_booking_report_format_sweater_arr[$data];
                break;
            }
        };
    }

    $trim_report_type = "";
    $trim_report_action = "";
    if(count($trims_booking_report_format_ids) > 0)
    {
        if ($trims_booking_report_format_ids[0] == 67) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report3";
        }elseif ($trims_booking_report_format_ids[0] == 183) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report3";
        }
        elseif ($trims_booking_report_format_ids[0] == 85) {

            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report8";
        }
        elseif ($trims_booking_report_format_ids[0] == 209) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report4";
        }
        elseif ($trims_booking_report_format_ids[0] == 235) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report5";
        }
        elseif ($trims_booking_report_format_ids[0] == 176) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report6";
        }
        elseif ($trims_booking_report_format_ids[0] == 174) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report7";
        }
        elseif ($trims_booking_report_format_ids[0] == 177) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report9";
        }
        elseif ($trims_booking_report_format_ids[0] == 241) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report11";
        }
        elseif ($trims_booking_report_format_ids[0] == 274) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report10";
        }
        elseif ($trims_booking_report_format_ids[0] == 269){
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report12";
        }
        elseif ($trims_booking_report_format_ids[0] == 28) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report13";
        }
        elseif ($trims_booking_report_format_ids[0] == 280) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report14";
        }
        elseif ($trims_booking_report_format_ids[0] == 304) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report15";
        }
        elseif ($trims_booking_report_format_ids[0] == 14) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report16";
        }
        elseif ($trims_booking_report_format_ids[0] == 719) {

            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report17";
        }
        elseif ($trims_booking_report_format_ids[0] == 339) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report12";
        }
        elseif ($trims_booking_report_format_ids[0] == 433) {
            $trim_report_type = 1;
            $trim_report_action = "show_trim_booking_report19";
        }
    }
    $req_print_report_format_rcv=return_field_value("format_id","lib_report_template","template_name ='".$cbo_company_name."' and module_id=6 and report_id=39 and is_deleted=0 and status_active=1");

    $req_format_rcv_ids=explode(",",$req_print_report_format_rcv);
    $reqReportFormat = 0;
    if(count($req_format_rcv_ids) > 0)
    {
        if($req_format_rcv_ids[0] == 118){  $reqReportFormat = 1;}
        if($req_format_rcv_ids[0] == 119){ $reqReportFormat = 2;}
        if($req_format_rcv_ids[0] == 120){ $reqReportFormat = 3;}
        if($req_format_rcv_ids[0] == 121){ $reqReportFormat =  4;}
        if($req_format_rcv_ids[0] == 122){ $reqReportFormat = 5;}
        if($req_format_rcv_ids[0] == 123){ $reqReportFormat =  6;}
        if($req_format_rcv_ids[0] == 129){ $reqReportFormat =  7;}
        if($req_format_rcv_ids[0] == 169){ $reqReportFormat =  8;}
        if($req_format_rcv_ids[0] == 165){ $reqReportFormat =  9;}
        if($req_format_rcv_ids[0] == 227){ $reqReportFormat =  10;}
        if($req_format_rcv_ids[0] == 241){ $reqReportFormat =  11;}
        if($req_format_rcv_ids[0] == 580){ $reqReportFormat =  12;}
        if($req_format_rcv_ids[0] == 28){ $reqReportFormat =  13;}
        if($req_format_rcv_ids[0] == 280){ $reqReportFormat =  14;}
        if($req_format_rcv_ids[0] == 688){ $reqReportFormat = 15;}
        if($req_format_rcv_ids[0] == 243){ $reqReportFormat =  16;}
        if($req_format_rcv_ids[0] == 310){ $reqReportFormat =  17;}
        if($req_format_rcv_ids[0] == 304){ $reqReportFormat =  18;}
        if($req_format_rcv_ids[0] == 719){ $reqReportFormat =  19;}
        if($req_format_rcv_ids[0] == 723){ $reqReportFormat =  20;}
        if($req_format_rcv_ids[0] == 339){ $reqReportFormat =  21;}
        if($req_format_rcv_ids[0] == 370){ $reqReportFormat =  22;}
        if($req_format_rcv_ids[0] == 235){ $reqReportFormat =  24;}
        if($req_format_rcv_ids[0] == 382){ $reqReportFormat =  23;}
        if($req_format_rcv_ids[0] == 768){ $reqReportFormat =  25;}
        if($req_format_rcv_ids[0] == 425){ $reqReportFormat =  26;}
    }

    $date_cond="";
    if($cbo_based_on==1)
    {
        if( $txt_date_from!="" && $txt_date_to!="" )
        $date_cond="and a.transaction_date between '".date("d-M-Y", strtotime($txt_date_from))."' and '".date("d-M-Y", strtotime($txt_date_to))."'";
    }
    else
    {
        if($txt_date_from!="" && $txt_date_to!="") $date_cond="and a.insert_date between '".date("d-M-Y", strtotime($txt_date_from))."' and '".date("d-M-Y", strtotime($txt_date_to))."  11:59:59 PM'";

    }

    $select_insert_date=" to_char(a.insert_date,'DD-MM-YYYY HH24:MI:SS') as INSERT_DATE";
    $select_insert_time=" to_char(a.insert_date,'HH24:MI:SS')  as INSERT_TIME";

    $con = connect();
    execute_query("delete from gbl_temp_engine where user_id=$user_id and entry_form=33 and ref_from in(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40)");
    oci_commit($con);

	//------------------- For Mrr Search ---------
	$transaction_ids=$transaction_ids_cond_for_mrr="";
	if($txt_mrr_no != "")
	{
		$trasIdsRes = sql_select("SELECT a.id as TRANS_ID, b.RECV_NUMBER, b.RECV_NUMBER_PREFIX_NUM
		from inv_receive_master b, inv_transaction a where b.id = a.mst_id and b.company_id='$cbo_company_name' and b.recv_number_prefix_num = '$txt_mrr_no' $date_cond and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 order by a.id");
        foreach($trasIdsRes as $transRow){
			$transaction_ids .=  $transRow["TRANS_ID"].",";
		}
		$transaction_ids = chop($transaction_ids,",");
		if ($transaction_ids != "") $transaction_ids_cond_for_mrr = " and a.id in ($transaction_ids)";
	}

	//---------------------- End ---------------------

	//echo implode(",",$cbo_item_cat); die;
	// ob_start();
    ?>
        <style>
            .wrd_brk{word-break: break-all;}
        </style>
    <?
    $html="";
    $html.='<table>
         <tr>
            <td>Date Wise Item Receive Issue Report </td>
        </tr>
        <tr>
            <td>
                Company Name : '.$company_arr[str_replace("'","",$cbo_company_name)].'
            </td>
        </tr>
	</table>';


	if(($key = array_search(4, $cbo_item_cat)) !== false) //if($cbo_item_cat==4)
	{

        unset($cbo_item_cat[$key]); // remove 4 for

		if($cbo_buyer_name!=0) $cbo_buyer_name="and d.buyer_name=$cbo_buyer_name"; else $cbo_buyer_name="";
		if($db_type==2) $issue_cond="and b.issue_basis=(CASE WHEN b.entry_form = 25 THEN 2 ELSE 0 END)"; else if($db_type==0) $issue_cond="and b.issue_basis=(CASE WHEN b.entry_form = 25 THEN '2' ELSE '0' END)";

		if($rptType==1)
		{
            $sql="SELECT
					A.ID AS TRANS_ID,
					B.PO_BREAKDOWN_ID AS ORDER_ID,
					A.TRANSACTION_DATE,
					CASE WHEN B.TRANS_TYPE IN(1,4) THEN B.QUANTITY ELSE 0 END AS RECEIVE_QTY,
					CASE WHEN B.TRANS_TYPE IN(3) THEN B.QUANTITY ELSE 0 END AS RECEIVE_RET_QTY,
					0 AS ISSUE_QTY,
					A.CONS_UOM,
					A.COMPANY_ID,
					D.JOB_NO,
					D.JOB_NO_PREFIX_NUM,
					D.STYLE_REF_NO,
					$SELECT_YEAR(D.INSERT_DATE $YEAR_CON) AS JOB_YEAR,
					D.BUYER_NAME,
					C.PO_NUMBER,
					C.SHIPMENT_DATE,
					B.PROD_ID,
					A.TRANSACTION_TYPE,
					A.MST_ID,
					A.CONS_RATE,
					A.ORDER_RATE,
					A.INSERTED_BY,
                    A.RECEIVE_BASIS,
					$select_insert_date,
					$select_insert_time,
					A.ORDER_QNTY,
					P.ITEM_DESCRIPTION,
					P.PRODUCT_NAME_DETAILS,
					P.COLOR,
					P.ITEM_COLOR,
					P.GMTS_SIZE,
					P.ITEM_SIZE,
					P.ITEM_GROUP_ID,
                    NULL AS ISSUE_TO
				from
					inv_transaction a, order_wise_pro_details b, wo_po_break_down c, wo_po_details_master d, product_details_master p
				where
					a.id=b.trans_id and b.po_breakdown_id=c.id and c.job_id=d.id and p.id=a.prod_id and a.item_category=4 and A.COMPANY_ID in($cbo_company_name) $cbo_buyer_name $date_cond $sql_cond $transaction_ids_cond_for_mrr and b.trans_type in(1,3,4) and b.entry_form in(24,25,49) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and d.is_deleted=0 and p.is_deleted=0

                union all

                SELECT
					A.ID AS TRANS_ID,
					B.PO_BREAKDOWN_ID AS ORDER_ID,
					A.TRANSACTION_DATE,
					0 AS RECEIVE_QTY,
					CASE WHEN B.TRANS_TYPE IN(2,3) THEN B.QUANTITY ELSE 0 END AS ISSUE_QTY,
					CASE WHEN B.TRANS_TYPE IN(4) THEN B.QUANTITY ELSE 0 END AS ISSUE_RET_QTY,
					A.CONS_UOM,
					A.COMPANY_ID,
					D.JOB_NO,
					D.JOB_NO_PREFIX_NUM,
					D.STYLE_REF_NO,
					$SELECT_YEAR(D.INSERT_DATE $YEAR_CON) AS JOB_YEAR,
					D.BUYER_NAME,
					C.PO_NUMBER,
					C.SHIPMENT_DATE,
					B.PROD_ID,
					A.TRANSACTION_TYPE,
					A.MST_ID,
					A.CONS_RATE,
					A.ORDER_RATE,
					A.INSERTED_BY,
                    A.RECEIVE_BASIS,
					$select_insert_date,
					$select_insert_time,
					A.ORDER_QNTY,
					P.ITEM_DESCRIPTION,
					P.PRODUCT_NAME_DETAILS,
					P.COLOR,
					P.ITEM_COLOR,
					P.GMTS_SIZE,
					P.ITEM_SIZE,
					P.ITEM_GROUP_ID,
                    E.KNIT_DYE_COMPANY AS ISSUE_TO
				from
					inv_transaction a, order_wise_pro_details b, wo_po_break_down c,wo_po_details_master d, product_details_master p,inv_issue_master e
				where
					a.id=b.trans_id and a.mst_id = e.id and b.po_breakdown_id=c.id and c.job_id=d.id and p.id=a.prod_id and a.item_category=4 and b.trans_type in(2,3,4) and A.COMPANY_ID in($cbo_company_name) $cbo_buyer_name $date_cond $sql_cond $transaction_ids_cond_for_mrr and b.entry_form in(25,49,73) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and d.is_deleted=0 and p.is_deleted=0 and e.is_deleted=0";
		}
		else if($rptType==2)
		{
			$sql="SELECT
					A.ID AS TRANS_ID,
					B.PO_BREAKDOWN_ID AS ORDER_ID,
					A.TRANSACTION_DATE,
					CASE WHEN B.TRANS_TYPE IN(1,4) THEN B.QUANTITY ELSE 0 END AS RECEIVE_QTY,
					CASE WHEN B.TRANS_TYPE IN(3) THEN B.QUANTITY ELSE 0 END AS RECEIVE_RET_QTY,
					'' AS ISSUE_QTY,
					A.CONS_UOM,
					A.COMPANY_ID,
					D.JOB_NO,
					D.JOB_NO_PREFIX_NUM,
					D.STYLE_REF_NO,
					$SELECT_YEAR(D.INSERT_DATE $YEAR_CON) AS JOB_YEAR,
					D.BUYER_NAME,
					C.PO_NUMBER,
					C.SHIPMENT_DATE,
					C.GROUPING,
					B.PROD_ID,
					A.TRANSACTION_TYPE,
					A.MST_ID,
					A.CONS_RATE,
					A.ORDER_RATE,
					A.INSERTED_BY,
                    A.RECEIVE_BASIS,
					$select_insert_date,
					$select_insert_time,
					A.ORDER_QNTY,
					P.ITEM_DESCRIPTION,
					P.PRODUCT_NAME_DETAILS,
					P.COLOR,
					P.ITEM_COLOR,
					P.GMTS_SIZE,
					P.ITEM_SIZE,
					P.ITEM_GROUP_ID
				from
					inv_transaction a, order_wise_pro_details b, wo_po_break_down c,wo_po_details_master d, product_details_master p
				where
					a.id=b.trans_id and b.po_breakdown_id=c.id and c.job_id=d.id and p.id=a.prod_id and a.item_category=4 and A.COMPANY_ID in($cbo_company_name)  $cbo_buyer_name $date_cond $sql_cond $transaction_ids_cond_for_mrr and b.trans_type in(1,4) and b.entry_form in(24,73) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and d.is_deleted=0 and p.is_deleted=0";
		}
		else if($rptType==3)
		{
			$sql="SELECT
					A.ID AS TRANS_ID,
					B.PO_BREAKDOWN_ID AS ORDER_ID,
					A.TRANSACTION_DATE,
					'' AS RECEIVE_QTY,
					CASE WHEN B.TRANS_TYPE IN(2,3) THEN B.QUANTITY ELSE 0 END AS ISSUE_QTY,
					CASE WHEN B.TRANS_TYPE IN(4) THEN B.QUANTITY ELSE 0 END AS ISSUE_RET_QTY,
					A.CONS_UOM,
					A.COMPANY_ID,
					D.JOB_NO,
					D.JOB_NO_PREFIX_NUM,
					D.STYLE_REF_NO,
					$SELECT_YEAR(D.INSERT_DATE $YEAR_CON) AS JOB_YEAR,
					D.BUYER_NAME,
					C.PO_NUMBER,
					C.SHIPMENT_DATE,
					C.GROUPING,
					B.PROD_ID,
					A.TRANSACTION_TYPE,
					A.MST_ID,
					A.CONS_RATE,
					A.ORDER_RATE,
					A.DEPARTMENT_ID,
					A.SECTION_ID,
					A.INSERTED_BY,
					$select_insert_date,
					$select_insert_time,
					A.ORDER_QNTY,
					P.ITEM_DESCRIPTION,
					P.PRODUCT_NAME_DETAILS,
					P.COLOR,
					P.ITEM_COLOR,
					P.GMTS_SIZE,
					P.ITEM_SIZE,
					P.ITEM_GROUP_ID,
                    E.KNIT_DYE_COMPANY AS ISSUE_TO
				from
					inv_transaction a, order_wise_pro_details b, wo_po_break_down c,wo_po_details_master d, product_details_master p,inv_issue_master e
				where
					a.id=b.trans_id and a.mst_id = e.id and b.po_breakdown_id=c.id and c.job_id=d.id and p.id=a.prod_id and a.item_category=4 and b.trans_type in(2,3) and A.COMPANY_ID in($cbo_company_name)  $cbo_buyer_name $date_cond $sql_cond $transaction_ids_cond_for_mrr and b.entry_form in(25,49) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and d.is_deleted=0 and p.is_deleted=0 and e.is_deleted=0";
		}

		// echo $sql; die;
		$sql_result=sql_select($sql);
		$trms_rasult_arr=array();
        $receive_ids_arr=array();
        $issue_ids_arr=array();
        $transfer_ids_arr=array();
		foreach($sql_result as $row)
		{
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["trans_id"]=$row["TRANS_ID"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["order_id"]=$row["ORDER_ID"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["prod_id"]=$row["PROD_ID"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["transaction_type"]=$row["TRANSACTION_TYPE"];
            $trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["receive_basis"]=$row["RECEIVE_BASIS"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["rec_issue_id"]=$row["MST_ID"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["transaction_date"]=$row["TRANSACTION_DATE"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["job_no"]=$row["JOB_NO"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["style_ref_no"]=$row["STYLE_REF_NO"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["job_no_prefix_num"]=$row["JOB_NO_PREFIX_NUM"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["job_year"]=$row["JOB_YEAR"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["buyer_name"]=$row["BUYER_NAME"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["po_number"]=$row["PO_NUMBER"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["shipment_date"]=$row["SHIPMENT_DATE"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["receive_qty"]+=$row["RECEIVE_QTY"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["issue_qty"]+=$row["ISSUE_QTY"];

			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["receive_ret_qty"]+=$row["RECEIVE_RET_QTY"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["issue_ret_qty"]+=$row["ISSUE_RET_QTY"];


			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["cons_uom"]=$row["CONS_UOM"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["company_id"]=$row["COMPANY_ID"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["cons_rate"]=$row["CONS_RATE"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["inserted_by"]=$row["INSERTED_BY"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["insert_date"]=$row["INSERT_DATE"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["insert_time"]=$row["INSERT_TIME"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["order_qnty"]=$row["ORDER_QNTY"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["order_rate"]=$row["ORDER_RATE"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["item_description"]=$row["ITEM_DESCRIPTION"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["product_name_details"]=$row["PRODUCT_NAME_DETAILS"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["color"]=$row["COLOR"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["item_color"]=$row["ITEM_COLOR"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["gmts_size"]=$row["GMTS_SIZE"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["item_size"]=$row["ITEM_SIZE"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["item_group_id"]=$row["ITEM_GROUP_ID"];
            $trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["issue_to"]=$row["ISSUE_TO"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["department_id"]=$row["DEPARTMENT_ID"];
            $trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["section_id"]=$row["SECTION_ID"];
			$trms_rasult_arr[$row["TRANS_ID"]][$row["ORDER_ID"]]["grouping"]=$row["GROUPING"];

            if ($row["TRANSACTION_TYPE"]==1 || $row["TRANSACTION_TYPE"]==4){
                $receive_ids_arr[$row["MST_ID"]]=$row["MST_ID"];
            } else if ($row["TRANSACTION_TYPE"]==2 || $row["TRANSACTION_TYPE"]==3) {
                $issue_ids_arr[$row["MST_ID"]]=$row["MST_ID"];
            } else $transfer_ids_arr[$row["MST_ID"]]=$row["MST_ID"];
		}
		unset($sql_result);
		//print_r($trms_rasult_arr);die;

		if($rptType==1)
		{
			$sql_non_order="SELECT
					A.ID AS TRANS_ID,
					A.TRANSACTION_DATE,
					A.CONS_QUANTITY AS RECEIVE_QTY,
					0 AS ISSUE_QTY,
					A.CONS_UOM,
					A.COMPANY_ID,
					A.PROD_ID,
					A.TRANSACTION_TYPE,
					A.MST_ID,
					A.CONS_RATE,
					A.INSERTED_BY,
					B.BOOKING_NO,
                    B.BOOKING_ID,
                    B.RECEIVE_BASIS,
					$select_insert_date,
					$select_insert_time,
					P.ITEM_DESCRIPTION,
					P.PRODUCT_NAME_DETAILS,
					P.COLOR,
					P.ITEM_COLOR,
					P.GMTS_SIZE,
					P.ITEM_SIZE,
					P.ITEM_GROUP_ID,
					1 as TYPE
				from
					inv_transaction a, inv_receive_master b, product_details_master p
				where
					b.id=a.mst_id and p.id=a.prod_id and a.item_category=4 and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and p.is_deleted=0 and b.entry_form in(20,24,27) and a.transaction_type in(1,4) and b.booking_without_order = (CASE WHEN b.entry_form = 24 THEN '1' ELSE '0' END)

				union all

				SELECT
					A.ID AS TRANS_ID,
					A.TRANSACTION_DATE,
					0 AS RECEIVE_QTY,
					A.CONS_QUANTITY AS ISSUE_QTY,
					A.CONS_UOM,
					A.COMPANY_ID,
					A.PROD_ID,
					A.TRANSACTION_TYPE,
					A.MST_ID,
					A.CONS_RATE,
					A.INSERTED_BY,
					NULL AS BOOKING_NO,
				    NULL AS BOOKING_ID,
                    NULL AS RECEIVE_BASIS,
					$select_insert_date,
					$select_insert_time,
					P.ITEM_DESCRIPTION,
					P.PRODUCT_NAME_DETAILS,
					P.COLOR,
					P.ITEM_COLOR,
					P.GMTS_SIZE,
					P.ITEM_SIZE,
					P.ITEM_GROUP_ID,
					2 AS TYPE
				from
					inv_transaction a, inv_issue_master b, product_details_master p
				where
					b.id=a.mst_id and p.id=a.prod_id and a.item_category=4 and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr and a.status_active=1 and a.is_deleted=0 and b.entry_form in(21,25,26) and a.transaction_type in(2,3) and b.is_deleted=0 and p.is_deleted=0";
		}
		else if($rptType==2)
		{
			$sql_non_order="SELECT
					A.ID AS TRANS_ID,
					A.TRANSACTION_DATE,
					A.CONS_QUANTITY AS RECEIVE_QTY,
					0 AS ISSUE_QTY,
					A.CONS_UOM,
					A.COMPANY_ID,
					A.PROD_ID,
					A.TRANSACTION_TYPE,
					A.MST_ID,
					A.CONS_RATE,
					A.INSERTED_BY,
					B.BOOKING_NO,
                    B.BOOKING_ID,
                    B.RECEIVE_BASIS,
					$select_insert_date,
					$select_insert_time,
					P.ITEM_DESCRIPTION,
					P.PRODUCT_NAME_DETAILS,
					P.COLOR,
					P.ITEM_COLOR,
					P.GMTS_SIZE,
					P.ITEM_SIZE,
					P.ITEM_GROUP_ID,
					1 AS TYPE
				from
					inv_transaction a, inv_receive_master b, product_details_master p
				where
					b.id=a.mst_id and p.id=a.prod_id and a.item_category=4 and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and p.is_deleted=0 and b.entry_form in(20,24,27) and a.transaction_type in(1,4) and b.booking_without_order = (CASE WHEN b.entry_form = 24 THEN '1' ELSE '0' END)";
		}
		else if($rptType==3)
		{
			$sql_non_order="SELECT A.ID AS TRANS_ID, A.TRANSACTION_DATE, 0 AS RECEIVE_QTY, A.CONS_QUANTITY AS ISSUE_QTY, A.CONS_UOM, A.COMPANY_ID, A.PROD_ID, A.TRANSACTION_TYPE, A.MST_ID, A.CONS_RATE, A.STORE_ID,A.INSERTED_BY, NULL AS BOOKING_NO, $select_insert_date, $select_insert_time, P.ITEM_DESCRIPTION, P.PRODUCT_NAME_DETAILS, P.COLOR, A.DEPARTMENT_ID, A.SECTION_ID, P.ITEM_COLOR, P.GMTS_SIZE, P.ITEM_SIZE, P.ITEM_GROUP_ID, 2 AS TYPE FROM inv_transaction A INNER JOIN inv_issue_master B ON B.id = A.mst_id INNER JOIN product_details_master P ON P.id = A.prod_id WHERE A.item_category = 4 AND A.company_id = $cbo_company_name $date_cond $transaction_ids_cond_for_mrr AND A.status_active = 1 AND A.is_deleted = 0 AND B.entry_form IN (21, 25, 26) AND A.transaction_type IN (2, 3) AND B.is_deleted = 0 AND P.is_deleted = 0 AND A.PROD_ID NOT IN ( SELECT DISTINCT B.PROD_ID FROM inv_transaction A INNER JOIN order_wise_pro_details B ON A.id = B.trans_id INNER JOIN wo_po_break_down C ON B.po_breakdown_id = C.id INNER JOIN wo_po_details_master D ON C.job_id = D.id INNER JOIN product_details_master P ON P.id = A.prod_id INNER JOIN inv_issue_master E ON E.id = A.mst_id WHERE A.item_category = 4 AND B.trans_type IN (2, 3) AND A.company_id IN ($cbo_company_name) $date_cond $transaction_ids_cond_for_mrr AND B.entry_form IN (25, 49) AND A.status_active = 1 AND A.is_deleted = 0 AND B.is_deleted = 0 AND C.is_deleted = 0 AND D.is_deleted = 0 AND P.is_deleted = 0 AND E.is_deleted = 0)";	
		}
		//echo "<br>";
		//echo $sql_non_order."<br>";die;
		$sql_result_non_order=sql_select($sql_non_order);
		$trms_non_order_arr=array();
        $nonOrderBooking_ids_arr=array();
		foreach($sql_result_non_order as $row)
		{
			$trms_non_order_arr[$row["TRANS_ID"]]["trans_id"]=$row["TRANS_ID"];
			$trms_non_order_arr[$row["TRANS_ID"]]["prod_id"]=$row["PROD_ID"];
			$trms_non_order_arr[$row["TRANS_ID"]]["transaction_type"]=$row["TRANSACTION_TYPE"];
			$trms_non_order_arr[$row["TRANS_ID"]]["rec_issue_id"]=$row["MST_ID"];
			$trms_non_order_arr[$row["TRANS_ID"]]["transaction_date"]=$row["TRANSACTION_DATE"];
			$trms_non_order_arr[$row["TRANS_ID"]]["receive_qty"]+=$row["RECEIVE_QTY"];
			$trms_non_order_arr[$row["TRANS_ID"]]["issue_qty"]+=$row["ISSUE_QTY"];
			$trms_non_order_arr[$row["TRANS_ID"]]["cons_uom"]=$row["CONS_UOM"];
			$trms_non_order_arr[$row["TRANS_ID"]]["company_id"]=$row["COMPANY_ID"];
			$trms_non_order_arr[$row["TRANS_ID"]]["cons_rate"]=$row["CONS_RATE"];
			$trms_non_order_arr[$row["TRANS_ID"]]["inserted_by"]=$row["INSERTED_BY"];
			$trms_non_order_arr[$row["TRANS_ID"]]["insert_date"]=$row["INSERT_DATE"];
			$trms_non_order_arr[$row["TRANS_ID"]]["insert_time"]=$row["INSERT_TIME"];
			$trms_non_order_arr[$row["TRANS_ID"]]["item_description"]=$row["ITEM_DESCRIPTION"];
			$trms_non_order_arr[$row["TRANS_ID"]]["product_name_details"]=$row["PRODUCT_NAME_DETAILS"];
			$trms_non_order_arr[$row["TRANS_ID"]]["color"]=$row["COLOR"];
			$trms_non_order_arr[$row["TRANS_ID"]]["item_color"]=$row["ITEM_COLOR"];
			$trms_non_order_arr[$row["TRANS_ID"]]["gmts_size"]=$row["GMTS_SIZE"];
			$trms_non_order_arr[$row["TRANS_ID"]]["item_size"]=$row["ITEM_SIZE"];
			$trms_non_order_arr[$row["TRANS_ID"]]["item_group_id"]=$row["ITEM_GROUP_ID"];
			$trms_non_order_arr[$row["TRANS_ID"]]["booking_no"]=$row["BOOKING_NO"];
            $trms_non_order_arr[$row["TRANS_ID"]]["booking_id"]=$row["BOOKING_ID"];
            $trms_non_order_arr[$row["TRANS_ID"]]["receive_basis"]=$row["RECEIVE_BASIS"];
			$trms_non_order_arr[$row["TRANS_ID"]]["department_id"]=$row["DEPARTMENT_ID"];
			$trms_non_order_arr[$row["TRANS_ID"]]["section_id"]=$row["SECTION_ID"];

            if ($row["TRANSACTION_TYPE"]==1 || $row["TRANSACTION_TYPE"]==4){
                $receive_ids_arr[$row["MST_ID"]]=$row["MST_ID"];
            } else if ($row["TRANSACTION_TYPE"]==2 || $row["TRANSACTION_TYPE"]==3) {
                $issue_ids_arr[$row["MST_ID"]]=$row["MST_ID"];
            } else $transfer_ids_arr[$row["MST_ID"]]=$row["MST_ID"];

            if ($row["BOOKING_ID"]>0) $nonOrderBooking_ids_arr[$row["BOOKING_ID"]]=$row["BOOKING_ID"];
		}
		unset($sql_result_non_order);


        $rcv_arr=array();
        $receive_num_arr=array();
        $booking_ids_arr=array();
        if (count($receive_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 9, $receive_ids_arr, $empty_arr);
            $sql_receive_res=sql_select("SELECT b.ID, b.RECV_NUMBER, b.CHALLAN_NO, b.CHALLAN_DATE, b.SUPPLIER_ID, b.KNITTING_SOURCE, b.KNITTING_COMPANY, b.CURRENCY_ID, b.EXCHANGE_RATE, b.BOOKING_ID, b.BOOKING_NO, b.RECEIVE_BASIS, b.IS_MULTI, b.ENTRY_FORM ,b.PAY_MODE, b.BOOKING_WITHOUT_ORDER from gbl_temp_engine g, inv_receive_master b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=9 and b.item_category=4 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_receive_res as $row)
            {
                $receive_num_arr[$row["ID"]]["id"]=$row["ID"];
                $receive_num_arr[$row["ID"]]["recv_number"]=$row["RECV_NUMBER"];
                $receive_num_arr[$row["ID"]]["challan_no"]=$row["CHALLAN_NO"];
                $receive_num_arr[$row["ID"]]["challan_date"]=$row["CHALLAN_DATE"];
                $receive_num_arr[$row["ID"]]["supplier_id"]=$row["SUPPLIER_ID"];
                $receive_num_arr[$row["ID"]]["knitting_source"]=$row["KNITTING_SOURCE"];
                $receive_num_arr[$row["ID"]]["knitting_company"]=$row["KNITTING_COMPANY"];
                $receive_num_arr[$row["ID"]]["currency_id"]=$row["CURRENCY_ID"];
                $receive_num_arr[$row["ID"]]["exchange_rate"]=$row["EXCHANGE_RATE"];
                $receive_num_arr[$row["ID"]]["booking_id"]=$row["BOOKING_ID"];
                $receive_num_arr[$row["ID"]]["booking_no"]=$row["BOOKING_NO"];
                $receive_num_arr[$row["ID"]]["receive_basis"]=$row["RECEIVE_BASIS"];
                $receive_num_arr[$row["ID"]]["is_multi"]=$row["IS_MULTI"];
                $receive_num_arr[$row["ID"]]["entry_form"]=$row["ENTRY_FORM"];
                $receive_num_arr[$row["ID"]]["pay_mode"]=$row["PAY_MODE"];
                $rcv_arr[$row["ENTRY_FORM"]]="'".$row["RECV_NUMBER"]."'";
                $rcv_arr[$row["ENTRY_FORM"]]="'".$row["RECV_NUMBER"]."'";
                if ($row['BOOKING_WITHOUT_ORDER']==0 && $row["BOOKING_ID"]>0) {
                    $booking_ids_arr[$row["BOOKING_ID"]]=$row["BOOKING_ID"];
                }
            }
            unset($sql_receive_res);
        }

        $issue_num_arr=array();
        if (count($issue_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 10, $issue_ids_arr, $empty_arr);
            $sql_issue_res=sql_select("SELECT b.ID, b.ISSUE_NUMBER, b.CHALLAN_NO, b.REQ_NO, b.KNIT_DYE_SOURCE, b.KNIT_DYE_COMPANY, b.ENTRY_FORM, b.ISSUE_PURPOSE from gbl_temp_engine g, inv_issue_master b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=10 and b.item_category=4 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_issue_res as $row)
            {
                $issue_num_arr[$row["ID"]]["id"]=$row["ID"];
                $issue_num_arr[$row["ID"]]["issue_number"]=$row["ISSUE_NUMBER"];
                $issue_num_arr[$row["ID"]]["challan_no"]=$row["CHALLAN_NO"];
                $issue_num_arr[$row["ID"]]["req_no"]=$row["REQ_NO"];
                $issue_num_arr[$row["ID"]]["knit_dye_source"]=$row["KNIT_DYE_SOURCE"];
                $issue_num_arr[$row["ID"]]["knit_dye_company"]=$row["KNIT_DYE_COMPANY"];
                $issue_num_arr[$row["ID"]]["entry_form"]=$row["ENTRY_FORM"];
                $issue_num_arr[$row["ID"]]["issue_purpose"]=$row["ISSUE_PURPOSE"];
            }
            unset($sql_issue_res);
        }

        $transfer_num_arr=array();
        if (count($transfer_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 11, $transfer_ids_arr, $empty_arr);
            $sql_transfer_res=sql_select("SELECT b.ID, b.TRANSFER_SYSTEM_ID, b.CHALLAN_NO, b.TRANSFER_DATE from gbl_temp_engine g, inv_item_transfer_mst b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=11 and b.item_category=4 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_transfer_res as $row)
            {
                $transfer_num_arr[$row["ID"]]["id"]=$row["ID"];
                $transfer_num_arr[$row["ID"]]["transfer_system_id"]=$row["TRANSFER_SYSTEM_ID"];
                $transfer_num_arr[$row["ID"]]["challan_no"]=$row["CHALLAN_NO"];
                $transfer_num_arr[$row["ID"]]["transfer_date"]=$row["TRANSFER_DATE"];
            }
            unset($sql_transfer_res);
        }


        $non_ord_data_arr=array();
        if (count($nonOrderBooking_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 12, $nonOrderBooking_ids_arr, $empty_arr);
            $sql_nonOrderBooking_res=sql_select("SELECT A.ID, A.COMPANY_NAME, A.WO_NUMBER_PREFIX_NUM, A.WO_NUMBER, A.WO_DATE, A.ATTENTION, A.LOCATION_ID, A.SUPPLIER_ID, A.PAY_MODE, A.SOURCE, A.CURRENCY_ID, A.DELIVERY_DATE, A.WO_BASIS_ID, B.ITEM_CATEGORY_ID from gbl_temp_engine g, wo_non_order_info_mst a, wo_non_order_info_dtls b where g.ref_val=a.id and a.id=b.mst_id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=12 and a.status_active=1 and a.is_deleted=0");//die;
            foreach($sql_nonOrderBooking_res as $val)
            {
                $non_ord_data_arr[$val["ID"]]["COMPANY_NAME"]=$val["COMPANY_NAME"];
                $non_ord_data_arr[$val["ID"]]["WO_NUMBER_PREFIX_NUM"]=$val["WO_NUMBER_PREFIX_NUM"];
                $non_ord_data_arr[$val["ID"]]["WO_NUMBER"]=$val["WO_NUMBER"];
                $non_ord_data_arr[$val["ID"]]["WO_DATE"]=$val["WO_DATE"];
                $non_ord_data_arr[$val["ID"]]["ATTENTION"]=$val["ATTENTION"];
                $non_ord_data_arr[$val["ID"]]["LOCATION_ID"]=$val["LOCATION_ID"];
                $non_ord_data_arr[$val["ID"]]["SUPPLIER_ID"]=$val["SUPPLIER_ID"];
                $non_ord_data_arr[$val["ID"]]["PAY_MODE"]=$val["PAY_MODE"];
                $non_ord_data_arr[$val["ID"]]["SOURCE"]=$val["SOURCE"];
                $non_ord_data_arr[$val["ID"]]["CURRENCY_ID"]=$val["CURRENCY_ID"];
                $non_ord_data_arr[$val["ID"]]["DELIVERY_DATE"]=$val["DELIVERY_DATE"];
                $non_ord_data_arr[$val["ID"]]["WO_BASIS_ID"]=$val["WO_BASIS_ID"];
                $non_ord_data_arr[$val["ID"]]["ITEM_CATEGORY_ID"]=$val["ITEM_CATEGORY_ID"];
            }
            unset($sql_nonOrderBooking_res);
        }


        $req_location_arr=array();
		if (count($booking_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 2, $booking_ids_arr, $empty_arr);
            $sql_req_res=sql_select("SELECT a.ID, a.LOCATION_ID from inv_purchase_requisition_mst a, gbl_temp_engine g where a.id=g.ref_val and a.status_active=1 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=2");
            foreach($sql_req_res as $row){
                $req_location_arr[$row['ID']]=$row['LOCATION_ID'];
            }
            unset($sql_req_res);
        }


		$show_html_4 = 1;

		//echo count($trms_rasult_arr)."klass".count($trms_non_order_arr);die;

		if(count($trms_rasult_arr) > 0 || count($trms_non_order_arr) > 0)
		{
			$html.='<div>
				<table>
					<tr>
						<td>Accessories: </td>
					</tr>
				</table>';
				$sql_item_group=sql_select("select id, item_name,conversion_factor from  lib_item_group where status_active=1 and is_deleted =0 and item_category=4");
				foreach($sql_item_group as $row)
				{
					$group_arr[$row[csf("id")]]["item_name"]=$row[csf("item_name")];
					$group_arr[$row[csf("id")]]["conversion_factor"]=$row[csf("conversion_factor")];
				}
				$size_arr=return_library_array( "select id, size_name from lib_size where status_active=1",'id','size_name');

                $trim_sql_data_report_sql=sql_select("SELECT ID, booking_no||'*#*'||company_id||'*#*'||is_approved as BOOKINGDATA, ENTRY_FORM from wo_booking_mst a, gbl_temp_engine g where a.id=g.ref_val and a.booking_type=2 and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=2 ");
				$booking_data_arr=array();
				foreach($trim_sql_data_report_sql as $val)
				{
					$booking_data_arr[$val["ID"]]=$val["BOOKINGDATA"];
                    $booking_entry_form_arr[$val["ID"]]=$val["ENTRY_FORM"];
				}
				unset($trim_sql_data_report_sql);

				if($cbo_order_type==0 || $cbo_order_type==1)
				{
					$html.='<table>
						<thead>
							<tr>
								<th>SL</th>
								<th>Prod. Id</th>
								<th>Trans. Date</th>
								<th>Trans. Ref.</th>
                                <th>File</th>';

                                if($rptType==3)
								{
									$html.='<th>Issue Purposed</th>';
								}
								$html.='<th>WO/PI</th>
								<th>Year</th>
								<th>Job No</th>';
								if($rptType==3 || $rptType==2)
								{
									$html.='<th>Int Ref</th>';
								}
								$html.='
								<th>Style Ref. No</th>
								<th>Buyer</th>
								<th>Order No</th>
								<th>Challan No</th>';
                                if($rptType==2 || $rptType==1 )
                                {
                                    $html.='<th>Challan Date</th>';
                                }
								$html.='<th>Party Name</th>
								<th>Ship Date</th>
								<th>Group Name</th>
								<th>Description</th>
								<th>RMG Color</th>
								<th>RMG Size</th>';
								if($rptType==3)
								{
									$html.='<th>Department</th>
									<th>Section</th>';
								}

								if($rptType==2 || $rptType==1 )
								{
									$html.='<th>Currency</th>
									<th>Exchange Rate</th>
									<th>Actual Rate</th>
									<th>Receive Qty</th>
									<th>Receive Return Qty</th>
									<th>Actual Amt</th>';
								}
								if($rptType==3 || $rptType==1 )
								{
									$html.='<th>Issue Qty</th>
									<th>Issue Return Qty</th>';
								}
								$html.='<th>Rate(TK)</th>
								<th>Amount(TK)</th>
								<th>UOM</th>';
								if($rptType==3 || $rptType==1 ){
									$html.='<th>Issue To</th>';
								}
								$html.='<th>User</th>
								<th>Insert Time</th>
								<th>Remarks</th>
							</tr>
						</thead>
					</table>
					<div>
						<table>';
							$i=1;
							foreach($trms_rasult_arr as $trans_key=>$value)
							{
								foreach($value as $order_key=>$val)
								{
									if ($i%2==0) {
                                        $bgcolor = "#E9F3FF";
                                    }else{
									    $bgcolor="#FFFFFF";
                                    }
                                    $booking_no=$booking_id=$trim_sql_data_report=$rcv_iss_num=$rcv_iss_challan=$rcv_iss_challan_date=$rcv_iss_supp="";$booking_entry_form="";
                                    $rcv_issue_qnty=0;
									if($val["transaction_type"]==1 || $val["transaction_type"]==4)
									{
										$mst_id=$receive_num_arr[$val['rec_issue_id']]["id"];
										$rcv_sys_id=$receive_num_arr[$val['rec_issue_id']]["recv_number"];
										$is_multi=$receive_num_arr[$val['rec_issue_id']]["is_multi"];
										$entry_form=$receive_num_arr[$val['rec_issue_id']]["entry_form"];
			                            $booking_no=$receive_num_arr[$val["rec_issue_id"]]["booking_no"];
                                        $booking_id=$receive_num_arr[$val["rec_issue_id"]]["booking_id"];
										$trim_sql_data_report = $booking_data_arr[$booking_id];
                                        $booking_entry_form = $booking_entry_form_arr[$booking_id];

                                        $rcv_iss_num=$receive_num_arr[$val['rec_issue_id']]["recv_number"];
                                        $rcv_iss_challan=$receive_num_arr[$val['rec_issue_id']]["challan_no"];
                                        $rcv_iss_challan_date=$receive_num_arr[$val['rec_issue_id']]["challan_date"];
                                        $rcv_iss_supp=$supplier_arr[$receive_num_arr[$val['rec_issue_id']]["supplier_id"]];
                                        $rcv_issue_qnty=$group_arr[$val["item_group_id"]]["conversion_factor"] *$val["receive_qty"];
										$total_receive_qty+=$rcv_issue_qnty;


									}
									else if($val["transaction_type"]==2 || $val["transaction_type"]==3)
									{
										$mst_id=$issue_num_arr[$val['rec_issue_id']]["id"];
										$entry_form=$issue_num_arr[$val['rec_issue_id']]["entry_form"];
										$is_multi=2;

                                        $rcv_iss_num=$issue_num_arr[$val['rec_issue_id']]["issue_number"];
                                        $rcv_iss_challan=$issue_num_arr[$val['rec_issue_id']]["challan_no"];
                                        if($issue_num_arr[$val['rec_issue_id']]["knit_dye_source"]==1)
                                        {
                                            $rcv_iss_supp=$company_arr[$issue_num_arr[$val['rec_issue_id']]["knit_dye_company"]];
                                        }
                                        else
                                        {
                                            $rcv_iss_supp=$supplier_arr[$issue_num_arr[$val['rec_issue_id']]["knit_dye_company"]];
                                        }
                                        $rcv_issue_qnty=$group_arr[$val["item_group_id"]]["conversion_factor"] *$val["issue_qty"];
										$total_issue_qty+=$rcv_issue_qnty;
									}

									$html.='<tr>
										<td>'.$i.'</td>
										<td>'.$val["prod_id"].'</td>
										<td>'.change_date_format($val["transaction_date"]).'</td>
										<td>'.$rcv_iss_num.'</td>';
                                        $html.='<td></td>';
                                        if($rptType==3)
                                        {
                                            $html.='<td>';
                                            if($val["transaction_type"]==2)
                                            {
                                                $html.= $yarn_issue_purpose[$issue_num_arr[$val['rec_issue_id']]["issue_purpose"]];
                                            }
                                            $html.='</td>';
                                        }
                                        $html.='<td>'.$booking_no.'</td>';
                                        $html.='<td>'.date('Y',strtotime($val["job_year"])).'</td>
										<td>'.$val["job_no"].'</td>';
										if($rptType==3 || $rptType==2){
											$html.='<td style="text-align:center;">'.$val["grouping"].'</td>';		
										}
										$html.='<td>'.$val["style_ref_no"].'</td>
										<td>'.$buyer_short_arr[$val["buyer_name"]].'</td>
										<td>'.$val["po_number"].'</td>
										<td>'.$rcv_iss_challan.'</td>';
                                        if($rptType==2 || $rptType==1 )
                                        {
                                            $html.='<td>'.$rcv_iss_challan_date.'</td>';
                                        }
                                        $html.='<td>'.$rcv_iss_supp.'</td>
										<td>'.change_date_format($val["shipment_date"]).'</td>
										<td>'.$group_arr[$val["item_group_id"]]["item_name"].'</td>
										<td>'.$val["product_name_details"].'</td>
										<td>'.$color_arr[$val["color"]].'</td>
										<td>'.$size_arr[$val["gmts_size"]].'</td>';
										if($rptType==3)
										{
											$html.='<td>'.$department_arr[$val["department_id"]].'</td>
											<td>'.$section_arr[$val["section_id"]].'</td>';
										}
										if($rptType==2 || $rptType==1 )
										{

                                            $rcv_cur=$rcv_ex_rate=$rcv_order_rate='';
                                            $order_amt=0;
                                            if($val["transaction_type"]==1)
                                            {
                                                $rcv_cur= $currency[$receive_num_arr[$val['rec_issue_id']]["currency_id"]];
                                                $rcv_ex_rate= number_format($receive_num_arr[$val['rec_issue_id']]["exchange_rate"],2);
                                                $rcv_order_rate=  number_format($val["order_rate"],2);
                                                $order_amt=$val["receive_qty"]*$val["order_rate"];
                                                $total_order_amt+=$order_amt;
                                            }
                                            $receive_ret_qty = $group_arr[$val["item_group_id"]]["conversion_factor"]*$val["receive_ret_qty"];
											$tot_receive_ret_qty+=$receive_ret_qty;
											$html.='<td>'.$rcv_cur.'</td>
											<td>'.$rcv_ex_rate.'</td>
											<td>'.$rcv_order_rate.'</td>
											<td>'.number_format($rcv_issue_qnty,2,".","").'</td>
											<td>'.number_format($receive_ret_qty,2,".","").'</td>
											<td>'.number_format($order_amt,4,".","").'</td>';
										}
										if($rptType==3 || $rptType==1 )
										{
                                            $issue_ret_qty = $group_arr[$val["item_group_id"]]["conversion_factor"] *$val["issue_ret_qty"];
											$tot_issue_ret_qty+=$issue_ret_qty;
											$html.='<td>'.number_format($rcv_issue_qnty,2,".","").'</td>
											<td>'.number_format($issue_ret_qty,2,".","").'</td>';
										}
                                        if($rcv_issue_qnty == 0){
                                            $val["cons_rate"] = 0;
                                        }
                                        $amount=$rcv_issue_qnty*$val["cons_rate"];
										$total_amount+=$amount;
										$html.='<td>'.number_format($val["cons_rate"],4,".","").'</td>
										<td>'.number_format($amount,2,".","").'</td>
										<td>'.$unit_of_measurement[$val["cons_uom"]].'</td>';
										if($rptType==3 || $rptType==1 )
                                        {
                                            $html.='<td>'.$company_arr[$val["issue_to"]].'</td>';
                                        }
										$html.='<td>'.$user_name_arr[$val["inserted_by"]].'</td>
										<td>'.change_date_format($val["insert_date"])." ".$val["insert_time"].'</td>
										<td>'.$remarks.' bangla</td>
									</tr>';
									$i++;
								}
							}
							$html.='</tbody>
						</table>
					 <table>
							<tfoot>
								<tr>
									<th></th>
									<th></th>
									<th></th>
                                    <th></th>
									<th></th>';
                                    if($rptType==3)
                                    {
										$html.='<th></th>';
									}
									$html.='<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th></th>';
                                    if($rptType==2 || $rptType==1 )
                                    {
                                        $html.='<th></th>';
                                    }
                                    $html.='<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th></th>';
									if($rptType==3)
									{
										$html.='<th></th>
										<th></th>
										<th>Total:</th>';
									}
									if($rptType==2 || $rptType==1 )
									{
										$html.='<th></th>
										<th></th>
										<th></th>
										<th>Total:</th>
										<th>'.number_format($total_receive_qty,2).'</th>
										<th>'.number_format($tot_receive_ret_qty,2).'</th>
										<th>'.number_format($total_order_amt,2).'</th>';
									}
									if($rptType==3 || $rptType==1 )
									{
										$html.='<th>'.number_format($total_issue_qty,2).'</th>
										<th>'.number_format($tot_issue_ret_qty,2).'</th>';
									}
									$html.='<th></th>
									<th>'.number_format($total_amount,2).'</th>
									';
									if(/*$rptType==3 ||*/ $rptType==1 )
									{
                                        $html.='<th></th>';
                                    }
									$html.='<th></th>
									<th></th>
									<th></th>
								</tr>
							</tfoot>
					   </table>
					 </div>
					 <br />';
				}
				if($cbo_order_type==0 || $cbo_order_type==2)
				{
					$html.='<table>
						<tr>
							<td>Non Order Item</td>
						</tr>
					</table>
					<table>
						<thead>
							<tr>
								<th>SL</th>
								<th>Prod. Id</th>
								<th>Trans. Date</th>
								<th>Trans. Ref.</th>
                                <th>WO Num</th>
								<th>Challan No</th>
								<th>Challan Date</th>
								<th>Party Name</th>
								<th>Group Name</th>
								<th>Description</th>
								<th>RMG Color</th>
								<th>RMG Size</th>';
								if($rptType==3)
								{
									$html.='<th>Department</th>
									<th>Section</th>';
								}
								if($rptType==2 || $rptType==1 )
								{
                                    $html.='<th>Receive Qty</th>';
								}
								if($rptType==3 || $rptType==1 )
								{
                                    $html.='<th>Issue Qty </th>';
								}
                                $html.='<th>Rate(TK)</th>
								<th>Amount(TK)</th>
								<th>UOM</th>
								<th>User</th>
								<th>Insert Time</th>
							</tr>
						</thead>
							<tbody>';
							$j=1;

							foreach($trms_non_order_arr as $trans_key=>$val)
							{
								if ($i%2==0)
								$bgcolor="#E9F3FF";
								else
								$bgcolor="#FFFFFF";
                                $booking_no=$booking_id=$rcv_iss_no=$rcv_iss_challan=$rcv_iss_challan_date=$rcv_iss_supp="";
								if($val["transaction_type"]==1 || $val["transaction_type"]==4)
								{
									$mst_id=$receive_num_arr[$val['rec_issue_id']]["id"];
									$is_multi=$receive_num_arr[$val['rec_issue_id']]["is_multi"];
									$entry_form=$receive_num_arr[$val['rec_issue_id']]["entry_form"];
                                    $booking_no = $val['booking_no'];
                                    $booking_id = $val['booking_id'];

                                    $rcv_iss_no=$receive_num_arr[$val['rec_issue_id']]["recv_number"];
                                    $rcv_iss_challan=$receive_num_arr[$val['rec_issue_id']]["challan_no"];
                                    $rcv_iss_challan_date=$receive_num_arr[$val['rec_issue_id']]["challan_date"];
                                    $rcv_iss_supp=$supplier_arr[$receive_num_arr[$val['rec_issue_id']]["supplier_id"]];
								}
								else if($val["transaction_type"]==2 || $val["transaction_type"]==3)
								{
									$mst_id=$issue_num_arr[$val['rec_issue_id']]["id"];
									$is_multi=2;
									$entry_form=$issue_num_arr[$val['rec_issue_id']]["entry_form"];

                                    $rcv_iss_no=$issue_num_arr[$val['rec_issue_id']]["issue_number"];
                                    $rcv_iss_challan=$issue_num_arr[$val['rec_issue_id']]["challan_no"];
                                    if($issue_num_arr[$val['rec_issue_id']]["knit_dye_source"]==1)
                                    {
                                        $rcv_iss_supp=$company_arr[$issue_num_arr[$val['rec_issue_id']]["knit_dye_company"]];
                                    }
                                    else
                                    {
                                        $rcv_iss_supp=$supplier_arr[$issue_num_arr[$val['rec_issue_id']]["knit_dye_company"]];
                                    }
								}

								$html.='<tr>
									<td>'.$j.'</td>
									<td>'.$val["prod_id"].'</td>
									<td>'.change_date_format($val["transaction_date"]).'</td>
									<td>'.$rcv_iss_no.'</td>';
                                    $html.='<td>'.$booking_no.'</td>';
									$html.='<td>'.$rcv_iss_challan.'</td>
                                    <td>'.$rcv_iss_challan_date.'</td>
									<td>'.$rcv_iss_supp.'</td>
									<td>'.$group_arr[$val["item_group_id"]]["item_name"].'</td>
									<td>'.$val["product_name_details"].'</td>
									<td>'.$color_arr[$val["color"]].'</td>
									<td>'.$size_arr[$val["gmts_size"]].'</td>';
									if($rptType==3)
									{
										$html.='<td>'.$department_arr[$val["department_id"]].'</td>
										<td>'.$section_arr[$val["section_id"]].'</td>';
									}
									if($rptType==2 || $rptType==1 )
									{
                                        $rcv_issue_qnty=$val["receive_qty"];
                                        $total_receive_qty_non_order+=$val["receive_qty"];
										$html.='<td>'.number_format($val["receive_qty"],2,".","").'</td>';
									}
									if($rptType==3 || $rptType==1 )
									{
                                        $rcv_issue_qnty=$val["issue_qty"];
                                        $total_issue_qty_non_order+=$val["issue_qty"];
										$html.='<td>'.number_format($val["issue_qty"],2,".","").'</td>';
									}
                                    if($rcv_issue_qnty == 0){
                                        $val["cons_rate"] = 0;
                                    }
                                    $amount=$rcv_issue_qnty*$val["cons_rate"];
									$total_amount_non_order+=$amount;
									$html.='<td>'.number_format($val["cons_rate"],4,".","").'</td>
									<td>'.number_format($amount,2,".","").'</td>
									<td>'.$unit_of_measurement[$val["cons_uom"]].'</td>
									<td>'.$user_name_arr[$val["inserted_by"]].'</td>
									<td>'.change_date_format($val["insert_date"])." ".$val["insert_time"].'</td>
								</tr>';
								$i++;$j++;
							}
							$html.='</tbody>
						</table>
					 <table>
							<tfoot>
								<tr>
									<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th>';
                                    if($rptType==3) $html.='Total:';
                                    $html.='</th>';
									if($rptType==3)
									{
										$html.='<th></th>
                                        <th></th>';
									}
									if($rptType==2 || $rptType==1 )
									{
										$html.='<th>'.number_format($total_receive_qty_non_order,2).'</th>';
									}
									if($rptType==3 || $rptType==1 )
									{
										$html.='<th>'.number_format($total_issue_qty_non_order,2).'</th>';
									}
									$html.='<th></th>
									<th>'. number_format($total_amount_non_order,2).'</th>
									<th></th>
									<th></th>
									<th></th>
								</tr>
							</tfoot>
					   </table>';
				}
            $html.='</div>';
		}
		else
		{
			$show_html_4 = 0;
		}
	}

	if(($key = array_search(2, $cbo_item_cat)) !== false) //if($cbo_item_cat==2)
	{
        unset($cbo_item_cat[$key]);
		$composition_arr=array();
		$construction_arr=array();
		$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0";
		$data_array=sql_select($sql_deter);
		if(count($data_array)>0)
		{
			foreach( $data_array as $row )
			{
				if(array_key_exists($row[csf('id')],$construction_arr))
				{
					$construction_arr[$row[csf('id')]]=$construction_arr[$row[csf('id')]];
				}
				else
				{
					$construction_arr[$row[csf('id')]]=$row[csf('construction')];
				}
				if(array_key_exists($row[csf('id')],$composition_arr))
				{
					$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]];
				}
				else
				{
					$composition_arr[$row[csf('id')]]=$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
				}
			}
		}



		if($cbo_order_type==0 || $cbo_order_type==1)
		{

			$buyer_cond="";
			if($cbo_buyer_name>0) $buyer_cond=" and a.buyer_name=$cbo_buyer_name";

			if($rptType==1)
			{
				$sql="SELECT a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.pi_wo_batch_no, a.batch_id_from_fissuertn, a.rack,b.quantity,b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, a.batch_lot, a.stitch_length,a.yarn_count, b.is_sales
				from inv_transaction a, order_wise_pro_details b
				where a.id=b.trans_id and a.item_category=2 and a.company_id=$cbo_company_name $date_cond $sql_cond and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.entry_form in (7,14,15,37,18,46,66,68,71,52) $transaction_ids_cond_for_mrr order by a.transaction_date, a.id";
			}
			else if($rptType==2)
			{
				$sql="SELECT a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.pi_wo_batch_no, a.batch_id_from_fissuertn, a.rack, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, a.stitch_length,a.yarn_count, b.is_sales
				from inv_transaction a, order_wise_pro_details b
				where a.id=b.trans_id and a.item_category=2 and a.transaction_type in(1,4,5,3) and b.trans_type in(1,4,5,3) and a.company_id=$cbo_company_name $date_cond $sql_cond and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.entry_form in (7,14,37,15,66,68,46) $transaction_ids_cond_for_mrr order by a.transaction_date, a.id";
			}
			else if($rptType==3)
			{
				$sql="SELECT a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.pi_wo_batch_no, a.batch_id_from_fissuertn, a.rack, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, a.stitch_length,a.yarn_count, b.is_sales, a.department_id, a.section_id
				from inv_transaction a, order_wise_pro_details b
				where a.id=b.trans_id and a.item_category=2 and a.transaction_type in(2,3,6,4) and b.trans_type in(2,3,6,4) and a.company_id=$cbo_company_name $date_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in (15,14,18,46,71,52) $sql_cond $transaction_ids_cond_for_mrr order by a.transaction_date, a.id";
			}
            //			echo $sql;

			$result_2=sql_select($sql);
			$sales_orderids_arr=array();
            $orderids_arr=array();
            $batch_ids_arr=array();
            $prod_ids_arr=array();
            $batch_arr=array();
            $sales_data_arr=array();
            $receive_ids_arr=array();
            $issue_ids_arr=array();
            $transfer_ids_arr=array();
			foreach($result_2 as $rows)
			{
				if($rows[csf("order_id")]>0) {
                    if ($rows[csf("is_sales")]==1) $sales_orderids_arr[$rows[csf("order_id")]]=$rows[csf("order_id")];
                    else $orderids_arr[$rows[csf("order_id")]]=$rows[csf("order_id")];
                }
                if($rows[csf("pi_wo_batch_no")]>0) $batch_ids_arr[$rows[csf("pi_wo_batch_no")]]=$rows[csf("pi_wo_batch_no")];
                if($rows[csf("prod_id")]>0) $prod_ids_arr[$rows[csf("prod_id")]]=$rows[csf("prod_id")];

                if ($rows[csf("transaction_type")]==1 || $rows[csf("transaction_type")]==4){
                    $receive_ids_arr[$rows[csf("mst_id")]]=$rows[csf("mst_id")];
                } else if ($rows[csf("transaction_type")]==2 || $rows[csf("transaction_type")]==3) {
                    $issue_ids_arr[$rows[csf("mst_id")]]=$rows[csf("mst_id")];
                } else $transfer_ids_arr[$rows[csf("mst_id")]]=$rows[csf("mst_id")];

			}

            if (count($sales_orderids_arr)>0)
			{
				if($db_type==0) $selected_year="year(a.insert_date) as job_year";
                else $selected_year="to_char(a.insert_date,'YYYY') as job_year";

                fnc_tempengine("gbl_temp_engine", $user_id, 33, 1, $sales_orderids_arr, $empty_arr);

				$sql_sales_query="SELECT a.id, a.job_no, a.sales_booking_no, a.within_group, a.buyer_id, a.style_ref_no, a.booking_without_order, $selected_year from fabric_sales_order_mst a, gbl_temp_engine g where a.id=g.ref_val and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=1";//die;

				$sql_sales_data=sql_select($sql_sales_query);
				foreach($sql_sales_data as $row)
				{
					$sales_data_arr[$row[csf("id")]]['job_no']=$row[csf("job_no")];
					$sales_data_arr[$row[csf("id")]]['sales_booking_no']=$row[csf("sales_booking_no")];
					$sales_data_arr[$row[csf("id")]]['within_group']=$row[csf("within_group")];
					$sales_data_arr[$row[csf("id")]]['buyer_id']=$row[csf("buyer_id")];
					$sales_data_arr[$row[csf("id")]]['style_ref_no']=$row[csf("style_ref_no")];
					$sales_data_arr[$row[csf("id")]]['job_year']=$row[csf("job_year")];
                }
                unset($sql_sales_data);
			}

            $job_order_data=array();
            if (count($orderids_arr)>0)
			{

                fnc_tempengine("gbl_temp_engine", $user_id, 33, 13, $orderids_arr, $empty_arr);

				$sql_job_query="SELECT a.job_no_prefix_num as JOB_NO, $select_year(a.insert_date $year_con) as JOB_YEAR, a.buyer_name as BUYER_NAME, a.style_ref_no as STYLE_REF_NO, b.id as ID, b.grouping as REF_NO, b.file_no as FILE_NO, b.po_number as PO_NUMBER, b.shipment_date as SHIPMENT_DATE from wo_po_details_master a, wo_po_break_down b, gbl_temp_engine g where a.id=b.job_id and b.id=g.ref_val and a.is_deleted=0 and b.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=13 and a.company_name=$cbo_company_name $buyer_cond";//die;

				$sql_job_data=sql_select($sql_job_query);
				foreach($sql_job_data as $row)
				{
					$job_order_data[$row["ID"]][1]=$row["JOB_NO"];
                    $job_order_data[$row["ID"]][2]=$row["JOB_YEAR"];
                    $job_order_data[$row["ID"]][3]=$row["BUYER_NAME"];
                    $job_order_data[$row["ID"]][4]=$row["PO_NUMBER"];
                    $job_order_data[$row["ID"]][5]=$row["SHIPMENT_DATE"];
                    $job_order_data[$row["ID"]][6]=$row["STYLE_REF_NO"];
                    $job_order_data[$row["ID"]][7]=$row["REF_NO"];
                    $job_order_data[$row["ID"]][8]=$row["FILE_NO"];
                }
                unset($sql_job_data);
			}

            if (count($batch_ids_arr)>0)
			{
                fnc_tempengine("gbl_temp_engine", $user_id, 33, 3, $batch_ids_arr, $empty_arr);
				$sql_batch_res=sql_select("SELECT a.ID, a.BATCH_NO from pro_batch_create_mst a, gbl_temp_engine g where a.id=g.ref_val and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=3");//die;
				foreach($sql_batch_res as $row)
				{
					$batch_arr[$row["ID"]]=$row["BATCH_NO"];
                }
                unset($sql_batch_res);
			}
		}
		if($cbo_order_type==0 || $cbo_order_type==2) // Non Order Item
		{
			if($rptType==1)
			{
					$sql_non_order_2="SELECT a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.rack, a.inserted_by, $select_insert_date, a.cons_quantity as qty, a.prod_id, b.batch_no from pro_batch_create_mst b, inv_transaction a where b.id=case when a.transaction_type in(1,2) then a.pi_wo_batch_no when a.transaction_type in(3,4) then a.batch_id_from_fissuertn end and a.item_category=2 and b.booking_without_order=1 and a.transaction_type in(1,2,3,4) and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr and a.status_active=1 and a.is_deleted=0 order by a.transaction_date, a.id";
			}
			else if($rptType==2)
			{
					$sql_non_order_2="SELECT a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.rack, a.inserted_by, $select_insert_date, a.cons_quantity as qty, a.prod_id, b.batch_no from pro_batch_create_mst b, inv_transaction a where b.id=case when a.transaction_type in(1) then a.pi_wo_batch_no when a.transaction_type in(4) then a.batch_id_from_fissuertn end and a.item_category=2 and b.booking_without_order=1 and a.transaction_type in(1,4) and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr and a.status_active=1 and a.is_deleted=0 order by a.transaction_date, a.id";
			}
			else if($rptType==3)
			{
					$sql_non_order_2="SELECT a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.rack, a.inserted_by, $select_insert_date, a.cons_quantity as qty, a.prod_id, b.batch_no, a.department_id, a.section_id
					from pro_batch_create_mst b, inv_transaction a where b.id=case when a.transaction_type in(2) then a.pi_wo_batch_no when a.transaction_type in(3) then a.batch_id_from_fissuertn end and a.item_category=2 and b.booking_without_order=1 and a.transaction_type in(2,3) and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr and a.status_active=1 and a.is_deleted=0 order by a.transaction_date, a.id";
			}
		}
		//echo $sql;//die;

		$result_non_order_2=sql_select($sql_non_order_2);
        foreach ($result_non_order_2 as $row)
        {
            if ($row[csf('prod_id')]>0) $prod_ids_arr[$row[csf("prod_id")]]=$row[csf("prod_id")];

            if ($row[csf("transaction_type")]==1 || $row[csf("transaction_type")]==4){
                $receive_ids_arr[$row[csf("mst_id")]]=$row[csf("mst_id")];
            } else if ($row[csf("transaction_type")]==2 || $row[csf("transaction_type")]==3) {
                $issue_ids_arr[$row[csf("mst_id")]]=$row[csf("mst_id")];
            } else $transfer_ids_arr[$row[csf("mst_id")]]=$row[csf("mst_id")];
        }

        $product_arr=array();
        if (count($prod_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 4, $prod_ids_arr, $empty_arr);
            $sql_product_res=sql_select("SELECT a.ID, a.DETARMINATION_ID, a.GSM, a.DIA_WIDTH, a.COLOR from product_details_master a, gbl_temp_engine g where a.id=g.ref_val and a.item_category_id=2 and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=4");//die;
            foreach($sql_product_res as $row)
            {
                $product_arr[$row["ID"]][1]=$row['DETARMINATION_ID'];
                $product_arr[$row["ID"]][2]=$row['GSM'];
                $product_arr[$row["ID"]][3]=$row['DIA_WIDTH'];
                $product_arr[$row["ID"]][4]=$row['COLOR'];
            }
            unset($sql_product_res);
        }

        $receive_num_arr=array();
        $nonOrderBooking_ids_arr=array();
        if (count($receive_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 5, $receive_ids_arr, $empty_arr);
            $sql_receive_res=sql_select("SELECT a.id as ID, a.RECV_NUMBER, a.CHALLAN_NO, a.BOOKING_NO, a.BOOKING_ID, a.BOOKING_WITHOUT_ORDER, a.RECEIVE_BASIS, a.ENTRY_FORM, a.KNITTING_SOURCE, a.KNITTING_COMPANY from gbl_temp_engine g, inv_receive_master a where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=5 and a.item_category=2 and a.status_active=1 and a.is_deleted=0");//die;
            foreach($sql_receive_res as $row)
            {
                $receive_num_arr[$row["ID"]][1]=$row["RECV_NUMBER"];
                $receive_num_arr[$row["ID"]][2]=$row["CHALLAN_NO"];
                $receive_num_arr[$row["ID"]][3]=$row["KNITTING_SOURCE"];
                $receive_num_arr[$row["ID"]][4]=$row["KNITTING_COMPANY"];
                $receive_num_arr[$row["ID"]][12]=$row["BOOKING_NO"];
                $receive_num_arr[$row['ID']][13]=$row['BOOKING_ID'];
                $receive_num_arr[$row['ID']][14]=$row['RECEIVE_BASIS'];
                $receive_num_arr[$row['ID']][15]=$row['ENTRY_FORM'];
                if ($row['BOOKING_WITHOUT_ORDER']==1 && $row['BOOKING_ID']>0) {
                    $nonOrderBooking_ids_arr[$row['BOOKING_ID']]=$row['BOOKING_ID'];
                }
            }
            unset($sql_receive_res);
        }

        $issue_num_arr=array();
        if (count($issue_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 6, $issue_ids_arr, $empty_arr);
            $sql_issue_res=sql_select("SELECT a.id as ID, a.ISSUE_NUMBER, a.CHALLAN_NO, a.KNIT_DYE_SOURCE, a.KNIT_DYE_COMPANY, a.RECEIVED_ID from gbl_temp_engine g, inv_issue_master a where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=6 and a.item_category=2 and a.status_active=1 and a.is_deleted=0");//die;
            foreach($sql_issue_res as $row)
            {
                $issue_num_arr[$row["ID"]][1]=$row["ISSUE_NUMBER"];
                $issue_num_arr[$row["ID"]][2]=$row["CHALLAN_NO"];
                $issue_num_arr[$row["ID"]][3]=$row["KNIT_DYE_SOURCE"];
                $issue_num_arr[$row["ID"]][4]=$row["KNIT_DYE_COMPANY"];
                $issue_num_arr[$row["ID"]][5]=$row["RECEIVED_ID"];
            }
            unset($sql_issue_res);
        }

        $transfer_num_arr=array();
        if (count($transfer_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 7, $transfer_ids_arr, $empty_arr);
            $sql_transfer_res=sql_select("SELECT a.id as ID, a.TRANSFER_SYSTEM_ID, a.CHALLAN_NO from gbl_temp_engine g, inv_item_transfer_mst a where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=7 and a.item_category=2 and a.status_active=1 and a.is_deleted=0");//die;
            foreach($sql_transfer_res as $row)
            {
                $transfer_num_arr[$row["ID"]][1]=$row["TRANSFER_SYSTEM_ID"];
			    $transfer_num_arr[$row["ID"]][2]=$row["CHALLAN_NO"];
            }
            unset($sql_transfer_res);
        }

        $nonOrderBooking_data_arr=array();
        if (count($nonOrderBooking_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 8, $nonOrderBooking_ids_arr, $empty_arr);
            $sql_nonOrderBooking_res=sql_select("SELECT a.ID, a.BOOKING_NO, a.COMPANY_ID, a.IS_APPROVED, a.ITEM_CATEGORY from gbl_temp_engine g, wo_non_ord_samp_booking_mst a where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=8 and a.status_active=1 and a.is_deleted=0");//die;
            foreach($sql_nonOrderBooking_res as $row)
            {
                $nonOrderBooking_data_arr[$row["ID"]]['booking_no']=$row["BOOKING_NO"];
                $nonOrderBooking_data_arr[$row["ID"]]['company_id']=$row["COMPANY_ID"];
                $nonOrderBooking_data_arr[$row["ID"]]['is_approved']=$row["IS_APPROVED"];
                $nonOrderBooking_data_arr[$row["ID"]]['item_category']=$row["ITEM_CATEGORY"];
            }
            unset($sql_nonOrderBooking_res);
        }

		$show_html_2 = 1; // for Blank Result
		if(count($result_2) > 0 || count($result_non_order_2) > 0)
		{
		    $html.='<div>
			<table>
					<tr>
						<td> Knit Finish Fabrics: </td>
					</tr>
					<tr></tr>
			</table>';
			if($cbo_order_type==0 || $cbo_order_type==1)
			{
				$html.='<table>
					<thead>
						<tr>
							<th>SL</th>
							<th>Prod. Id</th>
							<th>Year</th>
							<th>Job No</th>
                            <th>Style No</th>
							<th>Buyer</th>
							<th>Order No</th>
                            <th>File No</th>
                            <th>Ref. No</th>
							<th>Ship Date</th>
							<th>Trans. Date</th>
							<th>Trans. Ref.</th>
							<th>WO/PI</th>
							<th>Challan No</th>';
							if($rptType==3)
							{
								$html.='<th>Department</th>
                                <th>Section</th>';
							}
							$html.='<th>Party Name</th>
							<th>Yarn Lot</th>

							<th>Yarn Count</th>
							<th>Construction</th>
							<th>Composition</th>
							<th>Color</th>
							<th>GSM</th>
							<th>Dia</th>
							<th>Stitch Lenth</th>
							<th>Receive Qty</th>
							<th>Receive Return Qty</th>
							<th>Issue Qty </th>
                            <th>Issue ReturnQty</th>
                            <th>Batch No</th>
							<th>User</th>
							<th>Insert Date</th>
						</tr>
					</thead>
			   	</table>
               <div>
				<table>
					<tbody>';
					$i=1; $total_receive=""; $total_issue="";

					foreach($result_2 as $row)
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

						$shipment_date=$job_order_data[$row[csf("order_id")]][5];

						$mst_id=$row[csf("mst_id")]; $dtls_id=$row[csf("dtls_id")];
						$trasRef=''; $challan_no=''; $knitting_source=''; $knitting_company=''; $yarn_lot=''; $yarn_count=''; $stitch_length=''; $color_id='';$bacth_no='';
						$trasRef=$row[csf("rcv_issue_no")];
						$challan_no=$row[csf("challan_no")];
						$knitting_source=$row[csf("knitting_source")];
						if($knitting_source==1)
						{
							$knitting_company=$company_arr[$row[csf("knitting_company")]];
						}
						else if($knitting_source==3)
						{
							$knitting_company=$supplier_arr[$row[csf("knitting_company")]];
						}

						$booking_no = "";
                        $booking_id = "";
                        $basis = "";
                        $entry_form= "";
						if($row[csf("transaction_type")]==1 || $row[csf("transaction_type")]==4)
						{
							$trasRef=$receive_num_arr[$mst_id][1];
							$challan_no=$receive_num_arr[$mst_id][2];
							$knitting_source=$receive_num_arr[$mst_id][3];
							$booking_no=$receive_num_arr[$mst_id][12];
                            $booking_id = $receive_num_arr[$mst_id][13];
                            $basis = $receive_num_arr[$mst_id][14];
                            $entry_form = $receive_num_arr[$mst_id][15];

							$bacth_no=$batch_arr[$row[csf("pi_wo_batch_no")]];
							if($knitting_source==1)
							{
								$knitting_company=$company_arr[$receive_num_arr[$mst_id][4]];
							}
							else if($knitting_source==3)
							{
								$knitting_company=$supplier_arr[$receive_num_arr[$mst_id][4]];
							}
							$yarn_lot=$receive_num_arr[$dtls_id][5];
							$yarn_count=$receive_num_arr[$dtls_id][6];
							$stitch_length=$receive_num_arr[$dtls_id][7];
							$color_id=$receive_num_arr[$dtls_id][8];
						}
						else if($row[csf("transaction_type")]==2 || $row[csf("transaction_type")]==3)
						{
							$trasRef=$issue_num_arr[$mst_id][1];
							$challan_no=$issue_num_arr[$mst_id][2];
							$knitting_source=$issue_num_arr[$mst_id][3];

                            $bacth_no=$batch_arr[$row[csf("pi_wo_batch_no")]];
							if($knitting_source==1)
							{
								$knitting_company=$company_arr[$issue_num_arr[$mst_id][4]];
							}
							else if($knitting_source==3)
							{
								$knitting_company=$supplier_arr[$issue_num_arr[$mst_id][4]];
							}
							$yarn_lot=$issue_num_arr[$dtls_id][5];
							$yarn_count=$issue_num_arr[$dtls_id][6];
							$stitch_length=$issue_num_arr[$dtls_id][7];
							$color_id=$issue_num_arr[$dtls_id][8];
						}
						else
						{
							$trasRef=$transfer_num_arr[$mst_id][1];
							$challan_no=$transfer_num_arr[$mst_id][2];
							$bacth_no=$batch_arr[$row[csf("pi_wo_batch_no")]];
						}

						$color='';
						$color_ids=explode(",",$color_id);
						foreach($color_ids as $val)
						{
							if($val>0) $color.=$color_arr[$val].",";
						}
						$color=chop($color,',');

						$yarn_count_name='';
						$yarn_counts=explode(",",$yarn_count);
						foreach($yarn_counts as $val)
						{
							if($val>0) $yarn_count_name.=$yarn_count_arr[$val].",";
						}
						$yarn_count_name=chop($yarn_count_name,',');
                        $rcv_qnty=$rcv_ret_qnty=$iss_qnty=$iss_ret_qnty=0;
                        if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4 || $row[csf("transaction_type")]==5)
                        {
                            $rcv_qnty=number_format($row[csf("quantity")],2); $total_receive +=$row[csf("quantity")];
                        }
                        if($row[csf("transaction_type")]==3)
                        { $rcv_ret_qnty=number_format($row[csf("quantity")],2); $total_ret_receive +=$row[csf("quantity")];}

                        if($row[csf("transaction_type")]==2  || $row[csf("transaction_type")]==3 || $row[csf("transaction_type")]==6)
                        { $iss_qnty= number_format($row[csf("quantity")],2); $total_issue +=$row[csf("quantity")];}
                        if($row[csf("transaction_type")]==4)
                        { $iss_ret_qnty=number_format($row[csf("quantity")],2); $total_ret_issue +=$row[csf("quantity")];}

						$html.='<tr>
							<td>'.$i.'</td>
							<td>'.$row[csf("prod_id")].'</td>
							<td>';
							if ($row[csf("is_sales")]==1)
							{
								$html.=$sales_data_arr[$row[csf("order_id")]]['job_year'];
							}
							else
							{
								$html.=$job_order_data[$row[csf("order_id")]][2];
							}
                            $html.='</td>
							<td>';
							if ($row[csf("is_sales")]!=1)
							{
								$html.=$job_order_data[$row[csf("order_id")]][1];
							}
                            $html.='</td>
                            <td>';
                            if ($row[csf("is_sales")]==1)
							{
								$html.=$sales_data_arr[$row[csf("order_id")]]['style_ref_no'];
							}
							else
							{
								$html.=$job_order_data[$row[csf("order_id")]][6];
							}
							$html.='</td>
							<td>';
							if ($row[csf("is_sales")]==1)
							{
								if($sales_data_arr[$row[csf("order_id")]]['within_group']==2)
								{
									$html.=$buyer_short_arr[$sales_data_arr[$row[csf("order_id")]]['buyer_id']];
								}
								else
								{
									$html.=$company_arr[$sales_data_arr[$row[csf("order_id")]]['buyer_id']];
								}

							}
							else
							{
								$html.=$buyer_short_arr[$job_order_data[$row[csf("order_id")]][3]];
							}
						    $html.='</td>
							<td>';
							if ($row[csf("is_sales")]==1)
							{
								$html.=$sales_data_arr[$row[csf("order_id")]]['job_no'];
							}
							else
							{
								$html.=$job_order_data[$row[csf("order_id")]][4];
							}
							$html.='</td>
                            <td>';
                            if ($row[csf("is_sales")]!=1)
							{
								$html.=$job_order_data[$row[csf("order_id")]][8];
							}
							$html.='</td>
                            <td>';
                            if ($row[csf("is_sales")]!=1)
							{
								$html.=$job_order_data[$row[csf("order_id")]][7];
							}
							$html.='</td>
							<td>';
							if ($row[csf("is_sales")]!=1)
							{
								if($shipment_date!="0000-00-00" && $shipment_date!=""){ $html.=change_date_format($shipment_date);}
                            }
                            $html.='</td>
							<td>'.change_date_format($row[csf("transaction_date")]).'</td>
							<td>'.$trasRef.'</td>';

                            $html.='<td>'.$booking_no.'</td>';
                            $html.='<td>'.$challan_no.'</td>';
							if($rptType==3)
							{
								$html.='<td>'.$department_arr[$row[csf("department_id")]].'</td>
                                <td>'.$section_arr[$row[csf("section_id")]].'</td>';
							}
							$html.='<td>'.$knitting_company.'</td>
							<td>'.$yarn_lot.'</td>
							<td>'.$yarn_count_name.'</td>
							<td>'.$construction_arr[$product_arr[$row[csf('prod_id')]][1]].'</td>
							<td>'.$composition_arr[$product_arr[$row[csf('prod_id')]][1]].'</td>
							<td>'.$color_arr[$product_arr[$row[csf('prod_id')]][4]].'</td>
							<td>'.$product_arr[$row[csf('prod_id')]][2].'</td>
							<td>'.$product_arr[$row[csf('prod_id')]][3].'</td>
							<td>'.$stitch_length.'</td>
							<td>'.$rcv_qnty.'</td>
                            <td>'.$rcv_ret_qnty.'</td>
							<td>'.$iss_qnty.'</td>
                            <td>'.$iss_ret_qnty.'</td>
                            <td>'.$bacth_no.'</td>
							<td>'.$user_name_arr[$row[csf("inserted_by")]].'</td>
							<td>'.$row[csf("insert_date")].'</td>
						</tr>';
						$i++;
					}
					unset($result);
					$html.='</tbody>
				</table>
				<table>
					<tfoot>
						<th></th>
						<th></th>
						<th></th>
						<th></th>

                        <th></th>
						<th></th>
						<th></th>
                        <th></th>

                        <th></th>
						<th></th>
						<th></th>
						<th></th>
						<th></th>
						<th></th>';
						if($rptType==3)
                        {
                            $html.='<th></th>
                            <th></th>';
                        }
						$html.='<th></th>
						<th></th>
						<th></th>

						<th></th>
						<th></th>
						<th></th>
						<th></th>

						<th></th>
						<th>Total:</th>
						<th>'.number_format($total_receive,2).'</th>
                        <th>'.number_format($total_ret_receive,2).'</th>
						<th>'.number_format($total_issue,2).'</th>
                        <th>'.number_format($total_ret_issue,2).'</th>
                        <th></th>
						<th></th>
						<th></th>
					</tfoot>
				</table>
			 	</div>';
			}
			if($cbo_order_type==0 || $cbo_order_type==2) // Non Order Item
			{
				$html.='<table>
                    <tr>
                        <td>Non Order Item</td>
                    </tr>
                </table>
                <table>
					<thead>
						<tr>
							<th>SL</th>
							<th>Prod. Id</th>
							<th>Trans. Date</th>
							<th>Trans. Ref.</th>
                            <th>WO/PI</th>
							<th>Challan No</th>';
							if($rptType==3)
							{
								$html.='<th>Department</th>
                                <th>Section</th>';
							}
							$html.='<th>Party Name</th>
							<th>Construction</th>
							<th>Composition</th>
							<th>Color</th>
							<th>GSM</th>
							<th>Dia</th>
                            <th>Rack</th>
							<th>Receive Qty</th>
							<th>Issue Qty</th>
							<th>Batch No</th>
							<th>User</th>
							<th>Insert Date</th>
						</tr>
					</thead>
			   	</table>
				<table>
					<tbody>';
					$j=1; $total_receive=""; $total_issue="";
                    foreach($result_non_order_2 as $row)
					{
						if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

						$mst_id=$row[csf("mst_id")]; $bacth_no=$row[csf("batch_no")];
						$trasRef=''; $challan_no=''; $knitting_source=''; $knitting_company='';
                        $rcv_non_order_qnty=$iss_non_order_qnty=0;
						if($row[csf("transaction_type")]==1 || $row[csf("transaction_type")]==4)
						{
							$trasRef=$receive_num_arr[$mst_id][1];
							$challan_no=$receive_num_arr[$mst_id][2];
							$knitting_source=$receive_num_arr[$mst_id][3];
                            $booking_no =$receive_num_arr[$mst_id][12];
                            $booking_id =$receive_num_arr[$mst_id][13];
                            $receive_basis =$receive_num_arr[$mst_id][14];

							if($knitting_source==1)
							{
								$knitting_company=$company_arr[$receive_num_arr[$mst_id][4]];
							}
							else if($knitting_source==3)
							{
								$knitting_company=$supplier_arr[$receive_num_arr[$mst_id][4]];
							}


                            $rcv_non_order_qnty= number_format($row[csf("qty")],2);
                            $total_receive_non_order +=$row[csf("qty")];
						}
						else if($row[csf("transaction_type")]==2 || $row[csf("transaction_type")]==3)
						{
							$trasRef=$issue_num_arr[$mst_id][1];
							$challan_no=$issue_num_arr[$mst_id][2];
							$knitting_source=$issue_num_arr[$mst_id][3];

							if($knitting_source==1)
							{
								$knitting_company=$company_arr[$issue_num_arr[$mst_id][4]];
							}
							else if($knitting_source==3)
							{
								$knitting_company=$supplier_arr[$issue_num_arr[$mst_id][4]];
							}
                            $iss_non_order_qnty= number_format($row[csf("qty")],2);
                            $total_issue_non_order +=$row[csf("qty")];
						}

						$html.='<tr>
							<td>'.$j.'</td>
							<td>'.$row[csf("prod_id")].'</td>
							<td>'.change_date_format($row[csf("transaction_date")]).'</td>
							<td>'.$trasRef.'</td>';

							$html.='<td>'.$booking_no.'</td>';
                            $html.='<td>'.$challan_no.'</td>';
							if($rptType==3)
							{
								$html.='<td>'.$department_arr[$row[csf("department_id")]].'</td>
                                <td>'.$section_arr[$row[csf("section_id")]].'</td>';
							}
							$html.='<td>'.$knitting_company.'</td>
                            <td>'.$construction_arr[$product_arr[$row[csf('prod_id')]][1]].'</td>
							<td>'.$composition_arr[$product_arr[$row[csf('prod_id')]][1]].'</td>
							<td>'.$color_arr[$product_arr[$row[csf('prod_id')]][4]].'</td>
							<td>'.$product_arr[$row[csf('prod_id')]][2].'</td>
							<td>'.$product_arr[$row[csf('prod_id')]][3].'</td>
							<td>'.$row[csf("rack")].'</td>
                            <td>'.$rcv_non_order_qnty.'</td>
							<td>'.$iss_non_order_qnty.'</td>
							<td>'.$bacth_no.'</td>
							<td>'.$user_name_arr[$row[csf("inserted_by")]].'</td>
							<td>'.$row[csf("insert_date")].'</td>
						</tr>';
						$i++;$j++;
					}
					unset($result);
					$html.='</tbody>
				</table>
				<table>
					<tfoot>
						<th></th>
						<th></th>
						<th></th>
						<th></th>
                        <th></th>
						<th></th>';
						if($rptType==3)
						{
							$html.='<th></th>
							<th></th>';
						}
						$html.='<th></th>
						<th></th>
						<th></th>
						<th></th>
						<th></th>
						<th></th>
                        <th>Total:</th>
						<th>'. number_format($total_receive_non_order,2).'</th>
						<th>'. number_format($total_issue_non_order,2).'</th>
						<th></th>
						<th></th>
						<th></th>
					</tfoot>
				</table>';
			}
        $html.='</div>';
        }
        else{
            $show_html_2 =0;
        }
	}

	if(($key = array_search(3, $cbo_item_cat)) !== false) //if($cbo_item_cat==3)
	{
        unset($cbo_item_cat[$key]);
		$composition_arr=array();
		$construction_arr=array();
		$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0";
		$data_array=sql_select($sql_deter);
		if(count($data_array)>0)
		{
			foreach( $data_array as $row )
			{
				if(array_key_exists($row[csf('id')],$construction_arr))
				{
					$construction_arr[$row[csf('id')]]=$construction_arr[$row[csf('id')]];
				}
				else
				{
					$construction_arr[$row[csf('id')]]=$row[csf('construction')];
				}
				if(array_key_exists($row[csf('id')],$composition_arr))
				{
					$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]];
				}
				else
				{
					$composition_arr[$row[csf('id')]]=$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
				}
			}
		}


		$store_library=return_library_array( "select id, store_name from lib_store_location where status_active=1",'id','store_name');


		if($cbo_order_type==0 || $cbo_order_type==1) // Order Item
		{

			if($cbo_buyer_name!=0) $buyer_cond=" and a.buyer_name=$cbo_buyer_name"; else $buyer_cond="";

			if($rptType==1) //All Button
			{
				$sql="SELECT a.id as trans_id, a.transaction_type, a.receive_basis, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.pi_wo_batch_no, a.supplier_id, a.batch_id_from_fissuertn, a.rack, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, a.batch_lot, a.stitch_length, a.yarn_count, a.store_id, a.cons_rate, a.cons_amount,a.cons_uom,a.order_rate
				from inv_transaction a, order_wise_pro_details b
				where a.id=b.trans_id and a.item_category=3 and a.company_id=$cbo_company_name $date_cond $sql_cond and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.entry_form in (7,15,37,18,46,66,68,71,52,134,126,19,202,209,258,17) $transaction_ids_cond_for_mrr
				order by a.transaction_date, a.id";
			}
			else if($rptType==2) // Receive Button
			{
				$sql="SELECT a.id as trans_id, a.transaction_type, a.receive_basis, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.pi_wo_batch_no, a.supplier_id, a.batch_id_from_fissuertn, a.rack, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, a.stitch_length, a.yarn_count, a.store_id, a.cons_rate, a.cons_amount,a.cons_uom,a.order_rate
				from inv_transaction a, order_wise_pro_details b
				where a.id=b.trans_id and a.item_category=3 and a.transaction_type in(1,4,5,3) and b.trans_type in(1,4,5,3) and a.company_id=$cbo_company_name $date_cond $sql_cond and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.entry_form in (7,37,15,66,68,46,134,126,52,209,202,258,17) $transaction_ids_cond_for_mrr
				order by a.transaction_date, a.id";
			}
			else if($rptType==3) // Issue Button
			{
				$sql="SELECT a.id as trans_id, a.transaction_type, a.receive_basis, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.pi_wo_batch_no, a.supplier_id, a.batch_id_from_fissuertn, a.rack, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, a.stitch_length, a.yarn_count, a.store_id, a.cons_rate, a.cons_amount, a.department_id, a.section_id
				from inv_transaction a, order_wise_pro_details b
				where a.id=b.trans_id and a.item_category=3 and a.transaction_type in(2,3,6,4) and b.trans_type in(2,3,6,4) and a.company_id=$cbo_company_name $date_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in (15,18,46,71,52,134,19,202,209) $sql_cond $transaction_ids_cond_for_mrr
				order by a.transaction_date, a.id";
			}
			// echo $sql;

			$result_2=sql_select($sql);
			$orderids_arr = array();
			$prod_ids_arr = array();
            $batch_ids_arr=array();
            $receive_ids_arr=array();
            $issue_ids_arr=array();
            $transfer_ids_arr=array();
			foreach ($result_2 as $val)
			{
				if ($val[csf('order_id')]>0) $orderids_arr[$val[csf("order_id")]]=$val[csf("order_id")];
                if ($val[csf('prod_id')]>0) $prod_ids_arr[$val[csf("prod_id")]]=$val[csf("prod_id")];
                if($val[csf("pi_wo_batch_no")]>0) $batch_ids_arr[$val[csf("pi_wo_batch_no")]]=$val[csf("pi_wo_batch_no")];

                if ($val[csf("transaction_type")]==1 || $val[csf("transaction_type")]==4){
                    $receive_ids_arr[$val[csf("mst_id")]]=$val[csf("mst_id")];
                } else if ($val[csf("transaction_type")]==2 || $val[csf("transaction_type")]==3) {
                    $issue_ids_arr[$val[csf("mst_id")]]=$val[csf("mst_id")];
                } else $transfer_ids_arr[$val[csf("mst_id")]]=$val[csf("mst_id")];
			}
            $job_order_data=array();
            $booking_arr=array();
            if (count($orderids_arr)>0)
			{

                fnc_tempengine("gbl_temp_engine", $user_id, 33, 14, $orderids_arr, $empty_arr);

				$sql_job_data=sql_select("SELECT a.job_no as job_no, $select_year(a.insert_date $year_con) as job_year, a.buyer_name as buyer_name, a.style_ref_no as style_ref_no, b.id as id, b.grouping as ref_no, b.file_no as file_no, b.po_number as po_number, b.shipment_date as shipment_date, b.po_quantity as po_quantity from wo_po_details_master a, wo_po_break_down b, gbl_temp_engine g where a.id=b.job_id and b.id=g.ref_val and g.user_id=$user_id and g.entry_form=33 and g.ref_from=14 and a.is_deleted=0 and b.is_deleted=0 $buyer_cond");//die;

				foreach($sql_job_data as $row)
				{
					$job_order_data[$row[csf('id')]][1]=$row[csf("job_no")];
                    $job_order_data[$row[csf('id')]][2]=$row[csf("job_year")];
                    $job_order_data[$row[csf('id')]][3]=$row[csf("buyer_name")];
                    $job_order_data[$row[csf('id')]][4]=$row[csf("po_number")];
                    $job_order_data[$row[csf('id')]][5]=$row[csf("shipment_date")];
                    $job_order_data[$row[csf('id')]][6]=$row[csf("style_ref_no")];
                    $job_order_data[$row[csf('id')]][7]=$row[csf("ref_no")];
                    $job_order_data[$row[csf('id')]][8]=$row[csf("file_no")];
                    $job_order_data[$row[csf('id')]][9]=$row[csf("po_quantity")];
                }
                unset($sql_job_data);


                $bookingDataArr=sql_select("SELECT a.fabric_source, b.po_break_down_id as order_id,b.booking_no, b.fabric_color_id, b.construction,b.copmposition,b.gsm_weight,b.dia_width,b.gmts_color_id as color_id from wo_booking_mst a, wo_booking_dtls b, gbl_temp_engine g where a.booking_no=b.booking_no and b.po_break_down_id=g.ref_val and a.booking_type in(1,4) and b.status_active=1 and a.status_active=1 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=14 group by a.fabric_source,b.po_break_down_id,b.booking_no, b.fabric_color_id, b.construction,b.copmposition,b.gsm_weight,b.dia_width,b.gmts_color_id");
                foreach($bookingDataArr as $row)
                {
                    $booking_arr[$row[csf('order_id')]][$row[csf('fabric_color_id')]]['booking_no']	= $row[csf('booking_no')];
                    $booking_arr[$row[csf('order_id')]][$row[csf('fabric_color_id')]]['construction']	= $row[csf('construction')];
                    $booking_arr[$row[csf('order_id')]][$row[csf('fabric_color_id')]]['copmposition']	= $row[csf('copmposition')];
                    $booking_arr[$row[csf('order_id')]][$row[csf('fabric_color_id')]]['gsm_weight']	= $row[csf('gsm_weight')];
                    $booking_arr[$row[csf('order_id')]][$row[csf('fabric_color_id')]]['fabric_source']	= $row[csf('fabric_source')];
                }
                unset($bookingDataArr);
			}

            $product_arr=array();
            if (count($prod_ids_arr)>0)
			{

                fnc_tempengine("gbl_temp_engine", $user_id, 33, 15, $prod_ids_arr, $empty_arr);

				$sql_prod_res=sql_select("SELECT a.id, a.detarmination_id, a.gsm, a.dia_width, a.color, a.lot from product_details_master a, gbl_temp_engine g where a.id=g.ref_val and a.item_category_id=3 and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=15");

                foreach($sql_prod_res as $row)
				{
					$product_arr[$row[csf('id')]]['detarmination_id']=$row[csf('detarmination_id')];
                    $product_arr[$row[csf('id')]]['gsm']=$row[csf('gsm')];
                    $product_arr[$row[csf('id')]]['dia_width']=$row[csf('dia_width')];
                    $product_arr[$row[csf('id')]]['color']=$row[csf('color')];
                    $product_arr[$row[csf('id')]]['lot']=$row[csf('lot')];
                }
                unset($sql_prod_res);
			}

            if (count($batch_ids_arr)>0)
			{
                fnc_tempengine("gbl_temp_engine", $user_id, 33, 16, $batch_ids_arr, $empty_arr);
				$sql_batch_res=sql_select("SELECT a.ID, a.BATCH_NO from pro_batch_create_mst a, gbl_temp_engine g where a.id=g.ref_val and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=16");
				foreach($sql_batch_res as $row)
				{
					$batch_arr[$row["ID"]]=$row["BATCH_NO"];
                }
                unset($sql_batch_res);
			}
		}
		if($cbo_order_type==0 || $cbo_order_type==2) // Non Order Item query
		{
			if($rptType==1)
			{
				$sql_non_order_2="SELECT a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.rack, a.inserted_by, $select_insert_date, a.cons_quantity as qty, a.prod_id, b.batch_no, a.store_id
				from pro_batch_create_mst b, inv_transaction a
				where b.id=case when a.transaction_type in(1,2) then a.pi_wo_batch_no when a.transaction_type in(3,4) then a.batch_id_from_fissuertn when a.transaction_type in(5,6) then a.pi_wo_batch_no end and a.item_category=3 and b.booking_without_order=1 and a.transaction_type in(1,2,3,4,5,6) and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr $sql_cond and a.status_active=1 and a.is_deleted=0
				order by a.transaction_date, a.id";
			}
			else if($rptType==2)
			{
				$sql_non_order_2="SELECT a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.rack, a.inserted_by, $select_insert_date, a.cons_quantity as qty, a.prod_id, b.batch_no, a.store_id
				from pro_batch_create_mst b, inv_transaction a
				where b.id=case when a.transaction_type in(1) then a.pi_wo_batch_no when a.transaction_type in(4) then a.batch_id_from_fissuertn when a.transaction_type in(5) then a.pi_wo_batch_no end and a.item_category=3 and b.booking_without_order=1 and a.transaction_type in(1,4,5) and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr $sql_cond and a.status_active=1 and a.is_deleted=0
				order by a.transaction_date, a.id";
			}
			else if($rptType==3)
			{
				$sql_non_order_2="SELECT a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.rack, a.inserted_by, $select_insert_date, a.cons_quantity as qty, a.prod_id, b.batch_no, a.store_id, a.department_id, a.section_id
				from pro_batch_create_mst b, inv_transaction a
				where b.id=case when a.transaction_type in(2) then a.pi_wo_batch_no when a.transaction_type in(3) then a.batch_id_from_fissuertn when a.transaction_type in(6) then a.pi_wo_batch_no end and a.item_category=3 and b.booking_without_order=1 and a.transaction_type in(2,3,6) and a.company_id=$cbo_company_name $date_cond $transaction_ids_cond_for_mrr $sql_cond and a.status_active=1 and a.is_deleted=0
				order by a.transaction_date, a.id";
			}
		}
		//echo $sql;//die;


		$result_non_order_2=sql_select($sql_non_order_2);
        foreach ($result_non_order_2 as $row)
        {
            if ($row[csf("transaction_type")]==1 || $row[csf("transaction_type")]==4){
                $receive_ids_arr[$row[csf("mst_id")]]=$row[csf("mst_id")];
            } else if ($row[csf("transaction_type")]==2 || $row[csf("transaction_type")]==3) {
                $issue_ids_arr[$row[csf("mst_id")]]=$row[csf("mst_id")];
            } else $transfer_ids_arr[$row[csf("mst_id")]]=$row[csf("mst_id")];
        }

        $receive_num_arr=array();
        if (count($receive_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 17, $receive_ids_arr, $empty_arr);
            $sql_receive_res=sql_select("SELECT a.id, a.recv_number, a.challan_no, a.challan_date, a.knitting_source, a.knitting_company, a.receive_basis, a.booking_no, a.booking_id, a.supplier_id, a.issue_id from gbl_temp_engine g, inv_receive_master a where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=17 and a.item_category=3 and a.status_active=1 and a.is_deleted=0");
            foreach($sql_receive_res as $row)
            {
                $receive_num_arr[$row[csf('id')]]['id']=$row[csf("id")];//1
                $receive_num_arr[$row[csf('id')]]['recv_number']=$row[csf("recv_number")];//1
                $receive_num_arr[$row[csf('id')]]['challan_no']=$row[csf("challan_no")];//2
                $receive_num_arr[$row[csf('id')]]['challan_date']=$row[csf("challan_date")];//2
                $receive_num_arr[$row[csf('id')]]['knitting_source']=$row[csf("knitting_source")];//3
                $receive_num_arr[$row[csf('id')]]['knitting_company']=$row[csf("knitting_company")];//4
                $receive_num_arr[$row[csf('id')]]['receive_basis']=$row[csf("receive_basis")];//5
                $receive_num_arr[$row[csf('id')]]['booking_no']=$row[csf("booking_no")];//6
                $receive_num_arr[$row[csf('id')]]['booking_id']=$row[csf("booking_id")];
                $receive_num_arr[$row[csf('id')]]['supplier_id']=$row[csf("supplier_id")];
                $receive_num_arr[$row[csf('id')]]['issue_id']=$row[csf("issue_id")];
            }
            unset($sql_receive_res);
        }


        $issue_num_arr=array();
        if (count($issue_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 18, $issue_ids_arr, $empty_arr);
            $sql_issue_res=sql_select("SELECT a.id, a.issue_number, a.issue_purpose, a.challan_no, a.knit_dye_source, a.knit_dye_company, a.received_id from gbl_temp_engine g, inv_issue_master a where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=18 and a.item_category=3 and a.status_active=1 and a.is_deleted=0");//die;
            foreach($sql_issue_res as $row)
            {
                $issue_num_arr[$row[csf('id')]]['id']=$row[csf("id")];
                $issue_num_arr[$row[csf('id')]]['issue_number']=$row[csf("issue_number")];
                $issue_num_arr[$row[csf('id')]]['challan_no']=$row[csf("challan_no")];
                $issue_num_arr[$row[csf('id')]]['knit_dye_source']=$row[csf("knit_dye_source")];
                $issue_num_arr[$row[csf('id')]]['knit_dye_company']=$row[csf("knit_dye_company")];
                $issue_num_arr[$row[csf('id')]]['received_id']=$row[csf("received_id")];
                $issue_num_arr[$row[csf('id')]]['issue_purpose']=$row[csf("issue_purpose")];
            }
            unset($sql_issue_res);
        }

        $transfer_num_arr=array();
        if (count($transfer_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 19, $transfer_ids_arr, $empty_arr);
            $sql_transfer_res=sql_select("SELECT a.id as ID, a.TRANSFER_SYSTEM_ID, a.CHALLAN_NO from gbl_temp_engine g, inv_item_transfer_mst a where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=19 and a.item_category=3 and a.status_active=1 and a.is_deleted=0");//die;
            foreach($sql_transfer_res as $row)
            {
                $transfer_num_arr[$row["ID"]][1]=$row["TRANSFER_SYSTEM_ID"];
			    $transfer_num_arr[$row["ID"]][2]=$row["CHALLAN_NO"];
            }
            unset($sql_transfer_res);
        }


		$print_report_format=sql_select("select format_id, report_id from lib_report_template where template_name=".$cbo_company_name." and module_id=6 and report_id in(125,127,126,129) and status_active=1 and is_deleted=0");
		foreach ($print_report_format as $val) {
			if ($val[csf("report_id")]==125) $print_report_format_rec=explode(",",$val[csf("format_id")]);
			else if ($val[csf("report_id")]==127) $print_report_format_recRtn=explode(",",$val[csf("format_id")]);
			else if ($val[csf("report_id")]==126) $print_report_format_iss=explode(",",$val[csf("format_id")]);
			else if ($val[csf("report_id")]==129) $print_report_format_issRtn=explode(",",$val[csf("format_id")]);

		}
		//ob_start();

		$show_html_2 = 1; // for Blank Result
		if(count($result_2) > 0 || count($result_non_order_2) > 0) // show data
		{
			$html.='<div>
				<table>
						<tr>
							<td>Woven Finish Fabrics: </td>
						</tr>
						<tr></tr>
				</table>
				<br />';
				if($cbo_order_type==0 || $cbo_order_type==1) //All and With Order
				{
					$html.='<table>
	                    <thead>
	                        <tr>
	                            <th rowspan="2">SL</th>
	                            <th rowspan="2">Prod. Id</th>
	                            <th rowspan="2">Store Name</th>
	                            <th rowspan="2">Year</th>
	                            <th rowspan="2">Job No</th>
	                            <th rowspan="2">Style No</th>
	                            <th rowspan="2">Buyer</th>
	                            <th rowspan="2">Order No</th>
	                            <th rowspan="2">Order Qnty.</th>
	                            <th rowspan="2">File No</th>
	                            <th rowspan="2">Ref. No</th>
	                            <th rowspan="2">Ship Date</th>
	                            <th rowspan="2">Trans. Date</th>
	                            <th rowspan="2">Trans. Ref.</th>
	                            <th rowspan="2">Challan No</th>';
                                if($rptType==1 || $rptType==2)
                                {
                                    $html.='<th rowspan="2">Challan Date</th>';
                                }
                                if($rptType==3)
                                {
                                    $html.='<th rowspan="2">Department</th>
                                    <th rowspan="2">Section</th>';
                                }
                                $html.='<th rowspan="2">Party Name</th>
	                            <th rowspan="2">Booking No</th>
	                            <th rowspan="2">Fab. Source</th>
	                            <th rowspan="2">Construction</th>
	                            <th rowspan="2">Composition</th>
	                            <th rowspan="2">Color</th>
	                            <th rowspan="2">GSM</th>
	                            <th rowspan="2">Dia</th>
	                            <th rowspan="2">Stitch Lenth</th>
	                            <th colspan="4" style="text-align:center;">Receive</th>
	                            <th colspan="12" style="text-align:center;">Issue</th>';

                                if($rptType==2 || $rptType==1 )
                                {
                                    $html.='<th rowspan="2">Currency</th>
                                    <th rowspan="2">Exchange Rate</th>
                                    <th rowspan="2">Actual Rate</th>
                                    <th rowspan="2">Actual Amt</th>';
                                }

	                            $html.='<th rowspan="2">Rate</th>
	                            <th rowspan="2">Amount</th>
	                            <th rowspan="2">Batch No</th>
	                            <th rowspan="2">User</th>
	                            <th rowspan="2">Insert Date</th>
	                        </tr>
	                        <tr>
                                <th>Receive Qty</th>
	                            <th>UOM</th>
	                            <th>Issue ReturnQty</th>
	                            <th>Trans. In Qty</th>
	                            <th>Bulk Sewing Prod</th>
	                            <th>Sample With Order</th>
	                            <th>Sample Without Order</th>
	                            <th>Trans. Out Qty</th>
	                            <th>Receive Return Qty</th>
	                            <th>Re-Process</th>
	                            <th>Sales</th>
	                            <th>Fabric Test</th>
	                            <th>Scrap Store</th>
	                            <th>Damage</th>
	                            <th>Adjustment</th>
	                            <th>Stolen</th>
	                        </tr>
	                    </thead>
				   	</table>
				  	<div>
					<table>
						<tbody>';
						// echo $sql;die();
						$i=1; $total_receive=""; $total_issue=""; $total_amounts="";

						foreach($result_2 as $row)
						{
							if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

							$shipment_date=$job_order_data[$row[csf("order_id")]][5];

							$mst_id=$row[csf("mst_id")];
							$dtls_id=$row[csf("dtls_id")];
							//echo $mst_id.'**';
							$trasRef=$challan_no=$knitting_source=$knitting_company='';
							$yarn_lot=$yarn_count=$stitch_length=$color_id=$bacth_no='';

							$trasRef=$row[csf("rcv_issue_no")];//die("with tt");
							$challan_no=$row[csf("challan_no")];
							$knitting_source=$row[csf("knitting_source")];
							if($cbo_item_cat==2)
							{
								if($knitting_source==1)
								{
									$knitting_company=$company_arr[$row[csf("knitting_company")]];
								}
								else if($knitting_source==3)
								{
									$knitting_company=$supplier_arr[$row[csf("knitting_company")]];
								}
							}
							else
							{
								$knitting_company=$supplier_arr[$row[csf("supplier_id")]];
							}

							$issue_purpose = "";
							$rcv_booing_no="";
							$rcv_booing_id='';

							if($row[csf("transaction_type")]==1) //Receive
							{
								$trasRef=$receive_num_arr[$mst_id]['recv_number'];
								$challan_no=$receive_num_arr[$mst_id]['challan_no'];
								$challan_date=$receive_num_arr[$mst_id]['challan_date'];
								$knitting_source=$receive_num_arr[$mst_id]['knitting_source'];

								if($receive_num_arr[$mst_id][5]==2) $rcv_booing_no=$receive_num_arr[$mst_id][6];
								$bacth_no=$batch_arr[$row[csf("pi_wo_batch_no")]];
								if($knitting_source==1)
								{
									$knitting_company=$company_arr[$receive_num_arr[$mst_id]['knitting_company']];
								}
								else if($knitting_source==3)
								{
									$knitting_company=$supplier_arr[$receive_num_arr[$mst_id]['knitting_company']];
								}


								$yarn_count = $yarn_count_array[6];
							}
							else if($row[csf("transaction_type")]==4) // issue Return
							{
								$trasRef=$receive_num_arr[$mst_id]['recv_number'];
								$challan_no=$receive_num_arr[$mst_id]['challan_no'];
								$challan_date=$receive_num_arr[$mst_id]['challan_date'];
								$knitting_source=$receive_num_arr[$mst_id]['knitting_source'];

	                            $bacth_no=$batch_arr[$row[csf("batch_id_from_fissuertn")]];
								if($knitting_source==1)
								{
									$knitting_company=$company_arr[$receive_num_arr[$mst_id]['knitting_company']];
								}
								else if($knitting_source==3)
								{
									$knitting_company=$supplier_arr[$receive_num_arr[$mst_id]['knitting_company']];
								}

								$yarn_lot=$row[csf("batch_lot")];
								$yarn_count=$row[csf("yarn_count")];
								$stitch_length=$row[csf("stitch_length")];
							}
							else if($row[csf("transaction_type")]==2) //issue
							{
								$trasRef=$issue_num_arr[$mst_id]['issue_number'];
								$challan_no=$issue_num_arr[$mst_id]['challan_no'];
								$knitting_source=$issue_num_arr[$mst_id]['knit_dye_source'];
                                $issue_purpose=$issue_num_arr[$mst_id]['issue_purpose'];

                                $bacth_no=$batch_arr[$row[csf("pi_wo_batch_no")]];
								if($knitting_source==1)
								{
									$knitting_company=$company_arr[$issue_num_arr[$mst_id]['knit_dye_company']];
								}
								else if($knitting_source==3)
								{
									$knitting_company=$supplier_arr[$issue_num_arr[$mst_id]['knit_dye_company']];
								}

								$yarn_lot=$issue_num_arr[$dtls_id]['received_id'];
								$yarn_count=$issue_num_arr[$dtls_id]['issue_purpose'];
								$stitch_length=$issue_num_arr[$dtls_id][7];
								$color_id=$issue_num_arr[$dtls_id][8];
							}
							else if($row[csf("transaction_type")]==3) //Receive Return
							{
								$trasRef=$issue_num_arr[$mst_id]['issue_number'];
								$challan_no=$issue_num_arr[$mst_id]['challan_no'];

								$bacth_no=$batch_arr[$row[csf("batch_id_from_fissuertn")]];

								$received_id=$issue_num_arr[$mst_id]['received_id'];


								$knitting_source=$receive_num_arr[$received_id]['knitting_source'];
								if($knitting_source==1)
								{
									$knitting_company=$company_arr[$receive_num_arr[$received_id]['knitting_company']];
								}
								else if($knitting_source==3)
								{
									$knitting_company=$supplier_arr[$receive_num_arr[$received_id]['knitting_company']];
								}



								$yarn_lot=$row[csf("batch_lot")];
								$yarn_count=$row[csf("yarn_count")];
								$stitch_length=$row[csf("stitch_length")];
							}
							else
							{
								$trasRef=$transfer_num_arr[$mst_id][1];
								$challan_no=$transfer_num_arr[$mst_id][2];
							}

							$color='';
							$color_ids=explode(",",$color_id);
							foreach($color_ids as $val)
							{
								if($val>0) $color.=$color_arr[$val].",";
							}
							$color=chop($color,',');

							$yarn_count_name='';
							$yarn_counts=explode(",",$yarn_count);
							foreach($yarn_counts as $val)
							{
								if($val>0) $yarn_count_name.=$yarn_count_arr[$val].",";
							}
							$yarn_count_name=chop($yarn_count_name,',');

							$html.='<tr>
								<td>'.$i.'</td>
								<td>'.$row[csf("prod_id")].'</td>
	                            <td>'.$store_library[$row[csf("store_id")]].'</td>
								<td>'.date("Y",strtotime($job_order_data[$row[csf("order_id")]][2])).'</td>
								<td>'.$job_order_data[$row[csf("order_id")]][1].'</td>
	                            <td>'.$job_order_data[$row[csf("order_id")]][6].'</td>
								<td>'.$buyer_short_arr[$job_order_data[$row[csf("order_id")]][3]].'</td>
								<td>'.$job_order_data[$row[csf("order_id")]][4].'</td>
	                            <td>'.$job_order_data[$row[csf("order_id")]][9].'</td>
	                            <td>'.$job_order_data[$row[csf("order_id")]][8].'</td>
	                            <td>'.$job_order_data[$row[csf("order_id")]][7].'</td>
								<td>'.change_date_format($shipment_date).'</td>
								<td>'.change_date_format($row[csf("transaction_date")]).'</td>
								<td>'.$print_link.'</td>
								<td>'.$challan_no.'</td>';
                                if($rptType==1 || $rptType==2)
                                {
                                    $html.='<td>'.$challan_date.'</td>';
                                }
                                if($rptType==3)
                                {
                                    $html.='<td>'.$department_arr[$row[csf("department_id")]].'</td>
                                    <td>'.$section_arr[$row[csf("section_id")]].'</td>';
                                }
								$html.='<td>'.$knitting_company.'</td>
	                            <td>';
                                if($row[csf("transaction_type")]==1)
                                {
                                    $html.=$booking_arr[$row[csf("order_id")]][trim($product_arr[$row[csf('prod_id')]]['color'])]['booking_no'];
                                }
                                else
                                {
                                    $html.=$rcv_booing_no;
                                }
	                            $html.='</td>
								<td>'.$fabric_source[$booking_arr[$row[csf("order_id")]][$product_arr[$row[csf('prod_id')]]['color']]['fabric_source']].'</td>
								<td>'.$construction_arr[$product_arr[$row[csf('prod_id')]]['detarmination_id']].'</td>
								<td>'.$composition_arr[$product_arr[$row[csf('prod_id')]]['detarmination_id']].'</td>
								<td>'.$color_arr[$product_arr[$row[csf('prod_id')]]['color']].'</td>
								<td>'.$product_arr[$row[csf('prod_id')]]['gsm'].'</td>
								<td>'.$product_arr[$row[csf('prod_id')]]['dia_width'].'</td>
								<td>'.$stitch_length.'</td>
								<td>';
                                if($row[csf("transaction_type")]==1){ $html.= number_format($row[csf("quantity")],2); $total_receive +=$row[csf("quantity")];}
                                $html.='</td>
                                <td>'.$unit_of_measurement[$row[csf("cons_uom")]].'</td>
                                <td>';
                                if($row[csf("transaction_type")]==4){ $html.= number_format($row[csf("quantity")],2); $total_issue_return +=$row[csf("quantity")];}
                                $html.='</td><td>';
                                if($row[csf("transaction_type")]==5){ $html.=number_format($row[csf("quantity")],2); $total_trans_in +=$row[csf("quantity")];}
                                $html.='</td><td>';
                                 if($row[csf("transaction_type")]==2 && $issue_purpose == 9){ $html.= number_format($row[csf("quantity")],2); $total_issue_bulkSewing +=$row[csf("quantity")];}
                                 $html.='</td><td>';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 4){ $html.= number_format($row[csf("quantity")],2); $total_issue_sampleWithOrder +=$row[csf("quantity")];}
                                $html.='</td><td>';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 8){ $html.= number_format($row[csf("quantity")],2); $total_issue_sampleWithOutOrder +=$row[csf("quantity")];}
                                $html.='</td><td>';
                                if($row[csf("transaction_type")]==6){ $html.= number_format($row[csf("quantity")],2); $total_trans_out +=$row[csf("quantity")];}
                                $html.='</td><td>';
                                if($row[csf("transaction_type")]==3){ $html.= number_format($row[csf("quantity")],2); $total_rcv_return +=$row[csf("quantity")];}
                                $html.='</td><td>';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 44){ $html.= number_format($row[csf("quantity")],2); $total_issue_rePocess +=$row[csf("quantity")];}
                                $html.='</td><td>';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 3){ $html.= number_format($row[csf("quantity")],2);
                                $total_issue_sales +=$row[csf("quantity")];}
                                $html.='</td><td>';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 10){ $html.= number_format($row[csf("quantity")],2); $total_issue_fabricTest +=$row[csf("quantity")];}
                                $html.='</td><td>';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 31){ $html.= number_format($row[csf("quantity")],2); $total_issue_scrapStore +=$row[csf("quantity")];}
                                $html.='</td><td>';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 26){ $html.= number_format($row[csf("quantity")],2); $total_issue_damage +=$row[csf("quantity")];}
                                $html.='</td><td>';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 30){ $html.= number_format($row[csf("quantity")],2); $total_issue_adjustment +=$row[csf("quantity")];}
                                $html.='</td><td>';
                                if($row[csf("transaction_type")]==2 && $issue_purpose == 29){ $html.= number_format($row[csf("quantity")],2); $total_issue_stolen +=$row[csf("quantity")];}
                                $html.='</td>';

                                if($rptType==2 || $rptType==1 )
                                {
                                    $rcv_cur=$rcv_ex_rate=$rcv_order_rate='';
                                    $order_amt=0;
                                    if($row[csf("transaction_type")]==1)
                                    {
                                        $rcv_cur= $currency[$receive_num_arr[$mst_id]["currency_id"]];
                                        $rcv_ex_rate= number_format($receive_num_arr[$mst_id]["exchange_rate"],2);
                                        $rcv_order_rate= number_format($row[csf("order_rate")],2);
                                        $order_amt=$row[csf("quantity")]*$row[csf("order_rate")];
                                        $total_order_amt+=$order_amt;
                                    }
                                    $html.='<td>'.$rcv_cur.'</td>
                                    <td>'.$rcv_ex_rate.'</td>
                                    <td>'.$rcv_order_rate.'</td>
                                    <td>'.number_format($order_amt,2,".","").'</td>';
									$total_order_amt2=$total_order_amt2+$order_amt;
                                }


                                $html.='<td>'.number_format($row[csf("cons_rate")],2).'</td>
	                            <td>'.number_format($row[csf("quantity")]*$row[csf("cons_rate")],2); $total_amounts +=$row[csf("quantity")]*$row[csf("cons_rate")];
                                $html.='</td><td>'.$bacth_no.'</td>
                                <td>'.$user_name_arr[$row[csf("inserted_by")]].'</td>
                                <td>'.$row[csf("insert_date")].'</td>
							</tr>';
							$i++;
						}
						 
						unset($result_2);
						$html.='</tbody>
					</table>
					</div>
					<table>
						<tfoot>
							<th></th>
							<th></th>
	                        <th></th>
							<th></th>
							<th></th>
	                        <th></th>
							<th></th>
							<th></th>
	                        <th></th>
	                        <th></th>
	                        <th></th>
							<th></th>
							<th></th>
							<th></th>
							<th></th>';
							if($rptType==1 || $rptType==2)
							{
								$html.='<th></th>';
							}
							if($rptType==3)
							{
								$html.='<th></th>
                                <th></th>';
							}
							$html.='<th></th>
	                        <th></th>
							<th></th>
							<th></th>
							<th></th>
							<th></th>
							<th></th>
							<th></th>
							<th></th>
	                        <th>'.number_format($total_receive,2).'</th>
                            <th></th>
	                        <th>'.number_format($total_issue_return,2).'</th>
	                        <th>'.number_format($total_trans_in,2).'</th>
	                        <th>'.number_format($total_issue_bulkSewing,2).'</th>
	                        <th>'.number_format($total_issue_sampleWithOrder,2).'</th>
	                        <th>'.number_format($total_issue_sampleWithOutOrder,2).'</th>
	                        <th>'.number_format($total_trans_out,2).'</th>
	                        <th>'.number_format($total_rcv_return,2).'</th>
	                        <th>'.number_format($total_issue_rePocess,2).'</th>
	                        <th>'.number_format($total_issue_sales,2).'</th>
	                        <th>'.number_format($total_issue_fabricTest,2).'</th>
	                        <th>'.number_format($total_issue_scrapStore,2).'</th>
	                        <th>'.number_format($total_issue_damage,2).'</th>
	                        <th>'.number_format($total_issue_adjustment,2).'</th>
	                        <th>'.number_format($total_issue_stolen,2).'</th>';

                            if($rptType==2 || $rptType==1 )
                            {
                                $html.='<th></th>
                                <th></th>
                                <th></th>
                                <th>'.number_format($total_order_amt2,2).'</th>';
                            }

                            $html.='<th></th>
	                        <th>'.number_format($total_amounts,2).'</th>
	                        <th></th>
							<th></th>
							<th></th>
						</tfoot>
					</table>';
				}
				if($cbo_order_type==0 || $cbo_order_type==2) // Non Order Item
				{
					$html.='<table>
	                    <tr>
	                        <td>Non Order Item</td>
	                    </tr>
	                 </table>
	                <table>
						<thead>
							<tr>
								<th rowspan="2">SL</th>
								<th rowspan="2">Prod. Id</th>
								<th rowspan="2">Trans. Date</th>
								<th rowspan="2">Trans. Ref.</th>
								<th rowspan="2">Challan No</th>';
                                if($rptType==3)
                                {
                                    $html.='<th>Department</th>
                                	<th>Section</th>';
                                }
								$html.='<th rowspan="2">Party Name</th>
								<th rowspan="2">Construction</th>
								<th rowspan="2">Composition</th>
								<th rowspan="2">Color</th>
								<th rowspan="2">GSM</th>
								<th rowspan="2">Dia</th>
	                            <th rowspan="2">Rack</th>
	                            <th colspan="3" style="text-align:center;">Receive</th>
	                            <th>Issue</th>
								<th>Batch No</th>
								<th>User</th>
								<th>Insert Date</th>
							</tr>
							<tr>
								<th>Receive Qty</th>
	                            <th>Issue ReturnQty</th>
	                            <th>Trans. In Qty</th>
								<th>Issue Qty</th>
	                            <th>Trans. Out Qty</th>
	                            <th>Receive Return Qty</th>
							</tr>
						</thead>
				   	</table>
					<table>
					   	<tbody>';
							$j=1; $total_receive=""; $total_issue="";
							//$result=sql_select($sql);
							foreach($result_non_order_2 as $row)
							{
								if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

								$mst_id=$row[csf("mst_id")]; $bacth_no=$row[csf("batch_no")];
								$trasRef=''; $challan_no=''; $knitting_source=''; $knitting_company='';
								if($row[csf("transaction_type")]==1 || $row[csf("transaction_type")]==4)
								{
									$trasRef=$receive_num_arr[$mst_id]['recv_number'];
									$challan_no=$receive_num_arr[$mst_id]['challan_no'];
									$knitting_source=$receive_num_arr[$mst_id]['knitting_source'];

									if($knitting_source==1)
									{
										$knitting_company=$company_arr[$receive_num_arr[$mst_id]['knitting_company']];
									}
									else if($knitting_source==3)
									{
										$knitting_company=$supplier_arr[$receive_num_arr[$mst_id]['knitting_company']];
									}
								}
								else if($row[csf("transaction_type")]==2 || $row[csf("transaction_type")]==3)
								{
									$trasRef=$issue_num_arr[$mst_id]['issue_number'];
									$challan_no=$issue_num_arr[$mst_id]['challan_no'];
									$knitting_source=$issue_num_arr[$mst_id]['knit_dye_source'];

									if($knitting_source==1)
									{
										$knitting_company=$company_arr[$issue_num_arr[$mst_id]['knit_dye_company']];
									}
									else if($knitting_source==3)
									{
										$knitting_company=$supplier_arr[$issue_num_arr[$mst_id]['knit_dye_company']];
									}
								}

								$html.='<tr>
									<td>'.$j.'</td>
									<td>'.$row[csf("prod_id")].'</td>

									<td>'.change_date_format($row[csf("transaction_date")]).'</td>
									<td>'.$trasRef.'</td>
									<td>'.$challan_no.'</td>';
                                    if($rptType==3)
                                    {
                                        $html.='<td>'.$department_arr[$row[csf("department_id")]].'</td>
                                        <td>'.$section_arr[$row[csf("section_id")]].'</td>';
                                    }
									$html.='<td>'.$knitting_company.'</td>
		                            <td>'.$construction_arr[$product_arr[$row[csf('prod_id')]]['detarmination_id']].'</td>
									<td>'.$composition_arr[$product_arr[$row[csf('prod_id')]]['detarmination_id']].'</td>
									<td>'.$color_arr[$product_arr[$row[csf('prod_id')]]['color']].'</td>
									<td>'.$product_arr[$row[csf('prod_id')]]['gsm'].'</td>
									<td>'.$product_arr[$row[csf('prod_id')]]['dia_width'].'</td>
									<td>'.$row[csf("rack")].'</td>
		                            <td>';
									if($row[csf("transaction_type")]==1)
                                    { //Receive
                                        $html.=number_format($row[csf("qty")],2);
                                        $total_receive_non_order +=$row[csf("qty")];
                                    }
									$html.='</td>
									<td>';
                                    if($row[csf("transaction_type")]==4){ //Issue Return
                                        $html.= number_format($row[csf("qty")],2);
                                        $total_issue_return_non_order +=$row[csf("qty")];
                                    }
									$html.='</td>
									<td>';
                                    if($row[csf("transaction_type")]==5){ // Transfer In
                                        $html.=number_format($row[csf("qty")],2);
                                        $total_transfer_in_non_order +=$row[csf("qty")];
                                    }
									$html.='</td>
									<td>';
                                    if($row[csf("transaction_type")]==2){ //Issue
                                        $html.= number_format($row[csf("qty")],2);
                                        $total_issue_non_order +=$row[csf("qty")];
                                    }
									$html.='</td>
									<td>';
                                    if($row[csf("transaction_type")]==3){ //Receive Return
                                        $html.=number_format($row[csf("qty")],2);
                                        $total_receive_return_non_order +=$row[csf("qty")];
                                    }
									$html.='</td>
									<td>';
                                    if($row[csf("transaction_type")]==6){ //Transfer Out
                                        $html.=number_format($row[csf("qty")],2);
                                        $total_transfer_out_non_order +=$row[csf("qty")];
                                    }
									$html.='</td>
									<td>'.$bacth_no.'</td>
									<td>'.$user_name_arr[$row[csf("inserted_by")]].'</td>
									<td>'.$row[csf("insert_date")].'</td>
								</tr>';
								$i++;$j++;
							}
							unset($result_non_order_2);
                        $html.='</tbody>
					</table>
					<table>
						<tfoot>
								<th></th>
								<th></th>
								<th></th>
								<th></th>
								<th></th>';
								if($rptType==3)
								{
									$html.='<th></th>
                                    <th></th>';
								}
								$html.='<th></th>
								<th></th>
								<th></th>
								<th></th>
								<th></th>
								<th></th>
		                        <th></th>
								<th>'.number_format($total_receive_non_order,2).'</th>
								<th>'.number_format($total_issue_return_non_order,2).'</th>
								<th>'.number_format($total_transfer_in_non_order,2).'</th>
								<th>'.number_format($total_issue_non_order,2).'</th>
								<th>'.number_format($total_receive_return_non_order,2).'</th>
								<th>'.number_format($total_transfer_out_non_order,2).';</th>
								<th></th>
								<th></th>
								<th></th>
						</tfoot>
					</table>';
				}
            $html.='</div>';
        }
        else
        {
            $show_html_2 =0;
        }
	} //Woven Finish

	if(($key = array_search(13, $cbo_item_cat)) !== false) // Grey Fabric(Knit)
	{
        unset($cbo_item_cat[$key]);
		$composition_arr=array();
		$construction_arr=array();
		$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0";
		$data_array=sql_select($sql_deter);
		if(count($data_array)>0)
		{
			foreach( $data_array as $row )
			{
				if(array_key_exists($row[csf('id')],$construction_arr))
				{
					$construction_arr[$row[csf('id')]]=$construction_arr[$row[csf('id')]];
				}
				else
				{
					$construction_arr[$row[csf('id')]]=$row[csf('construction')];
				}
				if(array_key_exists($row[csf('id')],$composition_arr))
				{
					$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]];
				}
				else
				{
					$composition_arr[$row[csf('id')]]=$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
				}
			}
		}


		$yarn_count_arr=return_library_array( "select id, yarn_count from  lib_yarn_count where status_active=1 and is_deleted=0",'id','yarn_count');

		if($cbo_order_type==0 || $cbo_order_type==1)
		{

			if($cbo_buyer_name!=0) $buyer_cond=" and a.buyer_name=$cbo_buyer_name"; else $buyer_cond="";

			$source_cond_rcv="";
			if($cbo_knitting_source>0) $source_cond_rcv=" and p.knitting_source=$cbo_knitting_source";

			$source_cond_issue="";
			if($cbo_knitting_source>0) $source_cond_issue=" and p.knit_dye_source=$cbo_knitting_source";

			if($rptType==1)
			{
				$sql="SELECT p.id as rece_issue_id, p.recv_number as rcv_issue_no, p.challan_no, p.knitting_source, p.knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 1 as type, b.is_sales, p.booking_no
				from inv_receive_master p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(1,4) and b.trans_type in(1,4) $date_cond $source_cond_rcv $sql_cond $transaction_ids_cond_for_mrr
				union all
				select p.id as rece_issue_id, p.issue_number as rcv_issue_no, p.challan_no, p.knit_dye_source as knitting_source, p.knit_dye_company as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 2 as type, b.is_sales, p.booking_no
				from  inv_issue_master p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(2,3) and b.trans_type in(2,3) $date_cond $source_cond_issue $sql_cond $transaction_ids_cond_for_mrr
				union all
				select p.id as rece_issue_id, p.transfer_system_id as rcv_issue_no, p.challan_no, 0 as knitting_source, 0 as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 3 as type, b.is_sales,null as booking_no
				from  inv_item_transfer_mst p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(5,6) and b.trans_type in(5,6) $date_cond $sql_cond $transaction_ids_cond_for_mrr
				order by transaction_date, trans_id";
				//echo $sql;//die;
			}
			else if($rptType==2)
			{
				$sql="SELECT p.id as rece_issue_id, p.recv_number as rcv_issue_no, p.challan_no, p.knitting_source, p.knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 1 as type, b.is_sales, p.booking_no
				from inv_receive_master p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(1,4) and b.trans_type in(1,4) $date_cond $source_cond_rcv $sql_cond $transaction_ids_cond_for_mrr
				union all
				select p.id as rece_issue_id, p.transfer_system_id as rcv_issue_no, p.challan_no, 0 as knitting_source, 0 as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 3 as type, b.is_sales, null as booking_no
				from  inv_item_transfer_mst p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(5) and b.trans_type in(5) $date_cond $sql_cond $transaction_ids_cond_for_mrr
				union all
				select p.id as rece_issue_id, p.issue_number as rcv_issue_no, p.challan_no, p.knit_dye_source as knitting_source, p.knit_dye_company as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 2 as type, b.is_sales, p.booking_no
				from  inv_issue_master p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and p.entry_form=45 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(3) and b.trans_type in(3) $date_cond $source_cond_issue $sql_cond $transaction_ids_cond_for_mrr
				order by transaction_date, trans_id";
			}
			else if($rptType==3)
			{
				$sql="SELECT p.id as rece_issue_id, p.issue_number as rcv_issue_no, p.challan_no, p.knit_dye_source as knitting_source, p.knit_dye_company as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 2 as type, b.is_sales, a.department_id, a.section_id,p.booking_no
				from  inv_issue_master p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(2,3) and b.trans_type in(2,3) $date_cond $order_propo_cond  $source_cond_issue $sql_cond $transaction_ids_cond_for_mrr
				union all
				select p.id as rece_issue_id, p.transfer_system_id as rcv_issue_no, p.challan_no, 0 as knitting_source, 0 as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 3 as type, b.is_sales, a.department_id, a.section_id, null as booking_no
				from  inv_item_transfer_mst p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(6) and b.trans_type in(6) $date_cond $order_propo_cond $sql_cond $transaction_ids_cond_for_mrr
				union all
				SELECT p.id as rece_issue_id, p.recv_number as rcv_issue_no, p.challan_no, p.knitting_source, p.knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, b.po_breakdown_id as order_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, b.quantity, b.prod_id, a.inserted_by, $select_insert_date, b.entry_form, b.dtls_id, 1 as type, b.is_sales, a.department_id, a.section_id, p.booking_no
				from inv_receive_master p, inv_transaction a, order_wise_pro_details b
				where p.id=a.mst_id and a.id=b.trans_id and a.item_category=13 and a.company_id=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and p.is_deleted=0 and b.is_deleted=0 and a.transaction_type in(1,4) and b.trans_type in(1,4) $date_cond $order_propo_cond $source_cond_rcv $sql_cond $transaction_ids_cond_for_mrr
				order by transaction_date, trans_id";
			}

			$result_13=sql_select($sql);
            $order_ids="";
			$salesorderids_arr=array();
            $orderids_arr=array();
            $prod_ids_arr=array();
            $receive_dtlsids_arr=array();
            $issue_dtlsids_arr=array();
            $transfer_dtlsids_arr=array();
			foreach($result_13 as $rows)
			{
                if ($rows[csf('order_id')]>0) {
                    if($rows[csf("is_sales")]==1) $salesorderids_arr[$rows[csf("order_id")]]=$rows[csf("order_id")];
                    else $orderids_arr[$rows[csf("order_id")]]=$rows[csf("order_id")];
                }
                if ($rows[csf('prod_id')]>0) $prod_ids_arr[$rows[csf("prod_id")]]=$rows[csf("prod_id")];

                if ($rows[csf("dtls_id")] > 0)
                {
                    if ($rows[csf("transaction_type")]==1){
                        $receive_dtlsids_arr[$rows[csf("dtls_id")]]=$rows[csf("dtls_id")];
                    } else if ($rows[csf("transaction_type")]==2) {
                        $issue_dtlsids_arr[$rows[csf("mst_id")]]=$rows[csf("mst_id")];
                    } else if ($rows[csf("transaction_type")]==5 || $rows[csf("transaction_type")]==6) {
                        $transfer_dtlsids_arr[$rows[csf("dtls_id")]]=$rows[csf("dtls_id")];
                    }
                }
			}
		}

        if($db_type==0) $selected_year="year(a.insert_date) as job_year";
        else $selected_year="to_char(a.insert_date,'YYYY') as job_year";

        $sales_data_arr=array();
        if (count($salesorderids_arr)>0)
        {

            fnc_tempengine("gbl_temp_engine", $user_id, 33, 20, $salesorderids_arr, $empty_arr);

            $sql_sales_data=sql_select("SELECT a.id, a.job_no, a.sales_booking_no, a.within_group, a.buyer_id, a.style_ref_no, a.booking_without_order, $selected_year from fabric_sales_order_mst a, gbl_temp_engine g where a.id=g.ref_val and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=20");

            foreach($sql_sales_data as $row)
            {
                $sales_data_arr[$row[csf("id")]]['job_no']=$row[csf("job_no")];
                $sales_data_arr[$row[csf("id")]]['sales_booking_no']=$row[csf("sales_booking_no")];
                $sales_data_arr[$row[csf("id")]]['within_group']=$row[csf("within_group")];
                $sales_data_arr[$row[csf("id")]]['buyer_id']=$row[csf("buyer_id")];
                $sales_data_arr[$row[csf("id")]]['style_ref_no']=$row[csf("style_ref_no")];
                $sales_data_arr[$row[csf("id")]]['job_year']=$row[csf("job_year")];
            }
            unset($sql_sales_data);
        }

        $job_order_data=array();
        if (count($orderids_arr)>0)
        {

            fnc_tempengine("gbl_temp_engine", $user_id, 33, 21, $orderids_arr, $empty_arr);

            $sql_job_data=sql_select("SELECT a.job_no_prefix_num as JOB_NO, $select_year(a.insert_date $year_con) as JOB_YEAR, a.buyer_name as BUYER_NAME, a.style_ref_no as STYLE_REF_NO, b.id as ID, b.grouping as REF_NO,b.file_no as FILE_NO,b.po_number as PO_NUMBER, b.shipment_date as SHIPMENT_DATE from wo_po_details_master a, wo_po_break_down b, gbl_temp_engine g where a.id=b.job_id and b.id=g.ref_val and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=21");

            foreach($sql_job_data as $row)
            {
                $job_order_data[$row["ID"]][1]=$row["JOB_NO"];
                $job_order_data[$row["ID"]][2]=$row["JOB_YEAR"];
                $job_order_data[$row["ID"]][3]=$row["BUYER_NAME"];
                $job_order_data[$row["ID"]][4]=$row["PO_NUMBER"];
                $job_order_data[$row["ID"]][5]=$row["SHIPMENT_DATE"];
                $job_order_data[$row["ID"]][6]=$row["STYLE_REF_NO"];
                $job_order_data[$row["ID"]][7]=$row["REF_NO"];
                $job_order_data[$row["ID"]][8]=$row["FILE_NO"];
            }
            unset($sql_job_data);
        }

        if($cbo_order_type==0 || $cbo_order_type==2)
        {
            $source_cond_rcv="";
            if($cbo_knitting_source>0) $source_cond_rcv=" and b.knitting_source=$cbo_knitting_source";

            $source_cond_issue="";
            if($cbo_knitting_source>0) $source_cond_issue=" and b.knit_dye_source=$cbo_knitting_source";

            if($rptType==1)
            {
				$sql_non_order_13="SELECT b.recv_number as tran_ref, b.challan_no, b.knitting_source as knitting_source, b.knitting_company as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, a.prod_id, a.cons_quantity as qty, a.inserted_by, $select_insert_date from inv_receive_master b, inv_transaction a where b.id=a.mst_id and a.item_category=13 and a.company_id=$cbo_company_name and b.item_category=13 and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and a.booking_without_order=1 and a.transaction_type in(1,4) and b.entry_form in (2,22,51,58) $date_cond $source_cond_rcv $transaction_ids_cond_for_mrr
				union all
				SELECT b.issue_number as tran_ref, b.challan_no, b.knit_dye_source as knitting_source, b.knit_dye_company as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, a.prod_id, a.cons_quantity as qty, a.inserted_by, $select_insert_date from inv_issue_master b, inv_transaction a where b.id=a.mst_id and a.item_category=13 and a.company_id=$cbo_company_name and b.item_category=13 and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.issue_purpose=8 and a.transaction_type in(2,3) and b.entry_form in (16,45,61) $date_cond $source_cond_issue $transaction_ids_cond_for_mrr
				order by transaction_date, trans_id";
            }
            else if($rptType==2)
            {
				$sql_non_order_13="SELECT b.recv_number as tran_ref, b.challan_no, b.knitting_source as knitting_source, b.knitting_company as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, a.prod_id, a.cons_quantity as qty, a.inserted_by, $select_insert_date
				from inv_receive_master b, inv_transaction a
				where b.id=a.mst_id and a.item_category=13 and a.company_id=$cbo_company_name and b.item_category=13 and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and a.booking_without_order=1 and a.transaction_type in(1,4) and b.entry_form in (2,22,51,58) $date_cond $source_cond_rcv $transaction_ids_cond_for_mrr order by a.transaction_date, a.id";
            }
            else if($rptType==3)
            {
				$sql_non_order_13="SELECT b.issue_number as tran_ref, b.challan_no, b.knit_dye_source as knitting_source, b.knit_dye_company as knitting_company, a.id as trans_id, a.transaction_type, a.mst_id, a.transaction_date, a.batch_lot, a.yarn_count, a.stitch_length, a.prod_id, a.cons_quantity as qty, a.inserted_by, a.department_id, a.section_id, $select_insert_date
				from inv_issue_master b, inv_transaction a
				where b.id=a.mst_id and a.item_category=13 and a.company_id=$cbo_company_name and b.item_category=13 and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.issue_purpose=8 and a.transaction_type in(2,3) and b.entry_form in (16,45,61) $date_cond $source_cond_issue $transaction_ids_cond_for_mrr
				order by a.transaction_date, a.id";
            }

            $result_non_order_13=sql_select($sql_non_order_13);
            foreach($result_non_order_13 as $rows)
			{
                if ($rows[csf('prod_id')]>0) $prod_ids_arr[$rows[csf("prod_id")]]=$rows[csf("prod_id")];
			}
        }

        $product_arr=array();
        if (count($prod_ids_arr)>0)
        {

            fnc_tempengine("gbl_temp_engine", $user_id, 33, 22, $prod_ids_arr, $empty_arr);

            $sql_prod_res=sql_select("SELECT a.id as ID, a.detarmination_id as DETARMINATION_ID, a.gsm as GSM, a.dia_width as DIA_WIDTH from product_details_master a, gbl_temp_engine g where a.id=g.ref_val and a.item_category_id=13 and a.status_active=1 and a.is_deleted=0 and g.user_id=$user_id and g.entry_form=33 and g.ref_from=22");

            foreach($sql_prod_res as $row)
            {
                $product_arr[$row["ID"]][1]=$row['DETARMINATION_ID'];
                $product_arr[$row["ID"]][2]=$row['GSM'];
                $product_arr[$row["ID"]][3]=$row['DIA_WIDTH'];
            }
            unset($sql_prod_res);
        }

        $receive_num_arr=array();
        $trans_Id_arr=array();
        if (count($receive_dtlsids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 23, $receive_dtlsids_arr, $empty_arr);
            $sql_receive_res=sql_select("SELECT a.id as ID, a.yarn_lot as YARN_LOT, a.yarn_count as YARN_COUNT, a.stitch_length as STITCH_LENGTH, a.color_id as COLOR_ID, a.trans_id as TRANS_ID from gbl_temp_engine g, pro_grey_prod_entry_dtls a where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=23 and a.status_active=1 and a.is_deleted=0");
            foreach($sql_receive_res as $row)
            {
                $receive_num_arr[$row["ID"]][5]=$row["YARN_LOT"];
                $receive_num_arr[$row["ID"]][6]=$row["YARN_COUNT"];
                $receive_num_arr[$row["ID"]][7]=$row["STITCH_LENGTH"];
                $receive_num_arr[$row["ID"]][8]=$row["COLOR_ID"];
                $trans_Id_arr[$row["TRANS_ID"]][1]=$row["ID"];
            }
            unset($sql_receive_res);
        }

        $issue_num_arr=array();
        if (count($issue_dtlsids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 24, $issue_dtlsids_arr, $empty_arr);
            $sql_issue_res=sql_select("SELECT a.id as ID, a.yarn_lot as YARN_LOT, a.yarn_count as YARN_COUNT, a.stitch_length as STITCH_LENGTH, a.color_id as COLOR_ID, a.trans_id as TRANS_ID from gbl_temp_engine g, inv_grey_fabric_issue_dtls a where g.ref_val=a.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=24 and a.status_active=1 and a.is_deleted=0");
            foreach($sql_issue_res as $row)
            {
                $issue_num_arr[$row["ID"]][5]=$row["YARN_LOT"];
                $issue_num_arr[$row["ID"]][6]=$row["YARN_COUNT"];
                $issue_num_arr[$row["ID"]][7]=$row["STITCH_LENGTH"];
                $issue_num_arr[$row["ID"]][8]=$row["COLOR_ID"];
                $trans_Id_arr[$row["TRANS_ID"]][2]=$row["ID"];
            }
            unset($sql_issue_res);
        }

        $transfer_num_arr=array();
        if (count($transfer_dtlsids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 25, $transfer_dtlsids_arr, $empty_arr);
            $sql_transfer_res=sql_select("SELECT a.transfer_system_id as TRANSFER_SYSTEM_ID, a.challan_no as CHALLAN_NO, b.id as ID, b.y_count as Y_COUNT, b.yarn_lot as YARN_LOT, b.stitch_length as STITCH_LENGTH from gbl_temp_engine g, inv_item_transfer_mst a, inv_item_transfer_dtls b where g.ref_val=a.id and a.id=b.mst_id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=25 and b.item_category=13 and a.status_active=1 and a.is_deleted=0");
            foreach($sql_transfer_res as $row)
            {
                $id=$row["ID"];
                $transfer_num_arr[$id][1]=$row["TRANSFER_SYSTEM_ID"];
                $transfer_num_arr[$id][2]=$row["CHALLAN_NO"];
                $transfer_num_arr[$id][3]=$row["Y_COUNT"];
                $transfer_num_arr[$id][3]=$row["YARN_LOT"];
                $transfer_num_arr[$id][3]=$row["STITCH_LENGTH"];
            }
            unset($sql_transfer_res);
        }

        $show_html_13 = 1;
        if(count($result_13) > 0 || count($result_non_order_13) > 0)
        {
			$html.='<div>
				<table>
					<tr>
						<td> Grey Fabric(Knit): </td>
					</tr>
			   </table>
			   <br />';
			if($cbo_order_type==0 || $cbo_order_type==1)
			{
				$html.='<table>
					<thead>
						<tr>
							<th>SL</th>
							<th>Prod. Id</th>
							<th>Year</th>
							<th>Job No</th>
                            <th>Style No</th>
							<th>Buyer</th>
							<th>Order No</th>
                            <th>File No</th>
                            <th>Ref. No</th>
							<th>Ship Date</th>
							<th>Trans. Date</th>
							<th>Trans. Ref.</th>
							<th>WO/PI</th>
							<th>Challan No</th>';
                            if($rptType==3)
							{
								$html.='<th>Department</th>
                                <th>Section</th>';
							}
							$html.='<th>Party Name</th>
							<th>Yarn Lot</th>
							<th>Yarn Count</th>
							<th>Construction</th>
							<th>Composition</th>
							<th>Color</th>
							<th>GSM</th>
							<th>Dia</th>
							<th>Stitch Lenth</th>
							<th>Receive Qty</th>
							<th>Receive Return Qty</th>
                            <th>Transfer In Qty</th>
							<th>Issue Qty</th>
                            <th>Issue ReturnQty</th>
                            <th>Transfer Out Qty</th>
							<th>User</th>
							<th>Insert Date</th>
						</tr>
					</thead>
			   	</table>
                <div>
				<table>
					<tbody>';
					$i=1; $total_receive=""; $total_issue="";

					foreach($result_13 as $row)
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

						$shipment_date=$job_order_data[$row[csf("order_id")]][5];

						$mst_id=$row[csf("mst_id")]; $dtls_id=$row[csf("dtls_id")];
						$trasRef=''; $challan_no=''; $knitting_source=''; $knitting_company=''; $yarn_lot=''; $yarn_count=''; $stitch_length=''; $color_id='';
						$trasRef=$row[csf("rcv_issue_no")];
						$booking_no=$row[csf("booking_no")];
						$challan_no=$row[csf("challan_no")];
						$knitting_source=$row[csf("knitting_source")];
						if($knitting_source==1)
						{
							$knitting_company=$company_arr[$row[csf("knitting_company")]];
						}
						else if($knitting_source==3)
						{
							$knitting_company=$supplier_arr[$row[csf("knitting_company")]];
						}

						if($row[csf("transaction_type")]==1)
						{
							$yarn_lot=$receive_num_arr[$dtls_id][5];
							$yarn_count=$receive_num_arr[$dtls_id][6];
							$stitch_length=$receive_num_arr[$dtls_id][7];
							$color_id=$receive_num_arr[$dtls_id][8];
						}
						else if($row[csf("transaction_type")]==4)
						{
							$yarn_lot=$row[csf("batch_lot")];
							$yarn_count=$row[csf("yarn_count")];
							$stitch_length=$row[csf("stitch_length")];
						}
						else if($row[csf("transaction_type")]==2)
						{
							$yarn_lot=$issue_num_arr[$dtls_id][5];
							$yarn_count=$issue_num_arr[$dtls_id][6];
							$stitch_length=$issue_num_arr[$dtls_id][7];
							$color_id=$issue_num_arr[$dtls_id][8];
						}
						else if($row[csf("transaction_type")]==3)
						{
							$yarn_lot=$row[csf("batch_lot")];
							$yarn_count=$row[csf("yarn_count")];
							$stitch_length=$row[csf("stitch_length")];
						}
						else
						{
							$yarn_lot=$transfer_num_arr[$dtls_id][3];
							$yarn_count=$transfer_num_arr[$dtls_id][4];
							$stitch_length=$transfer_num_arr[$dtls_id][5];
						}

						$color='';
						$color_ids=explode(",",$color_id);
						foreach($color_ids as $val)
						{
							if($val>0) $color.=$color_arr[$val].",";
						}
						$color=chop($color,',');

						$yarn_count_name='';
						$yarn_counts=explode(",",$yarn_count);
						foreach($yarn_counts as $val)
						{
							if($val>0) $yarn_count_name.=$yarn_count_arr[$val].",";
						}
						$yarn_count_name=chop($yarn_count_name,',');

						$html.='<tr>
							<td>'.$i.'</td>
							<td>'.$row[csf("prod_id")].'</td>
							<td>';
							if ($row[csf("is_sales")]==1)
							{
								$html.= $sales_data_arr[$row[csf("order_id")]]['job_year'];
							}
							else
							{
								$html.= $job_order_data[$row[csf("order_id")]][2];
							}
							$html.='</td>
							<td>';
							if ($row[csf("is_sales")]!=1)
							{
								$html.= $job_order_data[$row[csf("order_id")]][1];
							}
							$html.='</td>
                            <td>';
                            if ($row[csf("is_sales")]==1)
							{
								$html.= $sales_data_arr[$row[csf("order_id")]]['style_ref_no'];
							}
							else
							{
								$html.= $job_order_data[$row[csf("order_id")]][6];
							}
							$html.='</td>
							<td>';
							if ($row[csf("is_sales")]==1)
							{
								if($sales_data_arr[$row[csf("order_id")]]['within_group']==2)
								{
									$html.= $buyer_short_arr[$sales_data_arr[$row[csf("order_id")]]['buyer_id']];
								}
								else
								{
									$html.= $company_arr[$sales_data_arr[$row[csf("order_id")]]['buyer_id']];
								}

							}
							else
							{
								$html.= $buyer_short_arr[$job_order_data[$row[csf("order_id")]][3]];
							}
							$html.='</td>
							<td>';
							if ($row[csf("is_sales")]==1)
							{
								$html.= $sales_data_arr[$row[csf("order_id")]]['job_no'];
							}
							else
							{
								$html.= $job_order_data[$row[csf("order_id")]][4];
							}
							$html.='</td>
                            <td>';
                            if ($row[csf("is_sales")]!=1)
							{
								$html.= $job_order_data[$row[csf("order_id")]][8];
							}
							$html.='</td>
                            <td>';
                            if ($row[csf("is_sales")]!=1)
							{
								$html.= $job_order_data[$row[csf("order_id")]][7];
							}
							$html.='</td>
							<td>';
							if ($row[csf("is_sales")]!=1)
							{
								if($shipment_date!="0000-00-00" && $shipment_date!="") $html.= change_date_format($shipment_date);
							}
							$html.='</td>
							<td>'.change_date_format($row[csf("transaction_date")]).'</td>
							<td>'.$trasRef.'</td>
							<td>'.$booking_no.'</td>
							<td>'.$challan_no.'</td>';
                            if($rptType==3)
							{
								$html.='<td>'.$department_arr[$row[csf("department_id")]].'</td>
                                <td>'.$section_arr[$row[csf("section_id")]].'</td>';
							}
							$html.='<td>'.$knitting_company.'</td>
							<td>'.$yarn_lot.'</td>
							<td>'.$yarn_count_name.'</td>
							<td>'.$construction_arr[$product_arr[$row[csf('prod_id')]][1]].'</td>
							<td>'.$composition_arr[$product_arr[$row[csf('prod_id')]][1]].'</td>
							<td>'.$color.'</td>
							<td>'.$product_arr[$row[csf('prod_id')]][2].'</td>
							<td>'.$product_arr[$row[csf('prod_id')]][3].'</td>
                            <td>'.$stitch_length.'</td>
							<td>';
                            if($row[csf("transaction_type")]==1){ $html.= number_format($row[csf("quantity")],2); $total_receive +=$row[csf("quantity")];}
                            $html.='</td><td>';
                            if($row[csf("transaction_type")]==3){ $html.= number_format($row[csf("quantity")],2); $total_ret_receive +=$row[csf("quantity")];}
                            $html.='</td><td>';
                            if($row[csf("transaction_type")]==5){ $html.= number_format($row[csf("quantity")],2); $total_trans_in +=$row[csf("quantity")];}
                            $html.='</td><td>';
							if($row[csf("transaction_type")]==2){ $html.= number_format($row[csf("quantity")],2); $total_issue +=$row[csf("quantity")];}
							$html.='</td><td>';
                            if($row[csf("transaction_type")]==4){ $html.= number_format($row[csf("quantity")],2); $total_ret_receive +=$row[csf("quantity")];}
                            $html.='</td>
                            <td>';
                            if($row[csf("transaction_type")]==6){ $html.= number_format($row[csf("quantity")],2); $total_trans_out +=$row[csf("quantity")];}
                            $html.='</td>
							<td>'.$user_name_arr[$row[csf("inserted_by")]].'</td>
							<td>'.$row[csf("insert_date")].'</td>
						</tr>';
						$i++;
					}
					unset($result);
					$html.='</tbody>
				</table>
				<table>
					<tfoot>
						<th></th>
						<th></th>
						<th></th>
						<th></th>
                        <th></th>
						<th></th>
						<th></th>
                        <th></th>
                        <th></th>
						<th></th>
						<th></th>
						<th></th>
						<th></th>
						<th></th>';
                        if($rptType==3)
						{
							$html.='<th></th>
                            <th></th>';
						}

						$html.='<th></th>
						<th></th>
						<th></th>
						<th></th>
						<th></th>
						<th></th>
						<th></th>
						<th></th>
						<th>Total:</th>
						<th>'.number_format($total_receive,2).'</th>
                        <th>'.number_format($total_ret_receive,2).'</th>
                        <th>'.number_format($total_trans_in,2).'</th>
						<th>'.number_format($total_issue,2).'</th>
                        <th>'.number_format($total_ret_issue,2).'</th>
                        <th>'.number_format($total_trans_out,2).'</th>
						<th></th>
						<th></th>
					</tfoot>
				</table>
			 	</div>';
			}

			if($cbo_order_type==0 || $cbo_order_type==2)
			{

				//echo $sql;
				$html.='<table>
	                <tr>
	                    <td>Non Order Item</td>
	                </tr>
	            </table>
             	<table>
                    <thead>
                        <tr>
                            <th>SL</th>
                            <th>Prod. Id</th>
                            <th>Trans. Date</th>
                            <th>Trans. Ref.</th>
                            <th>Challan No</th>';
                            if($rptType==3)
							{
								$html.='<th>Department</th>
                                <th>Section</th>';
							}
							$html.='<th>Party Name</th>
                            <th>Yarn Lot</th>
                            <th>Yarn Count</th>
                            <th>Construction</th>
                            <th>Composition</th>
                            <th>Color</th>
                            <th>GSM</th>
                            <th>Dia</th>
                            <th>Stitch Lenth</th>
                            <th>Receive Qty</th>
                            <th>Issue Qty</th>
                            <th>User</th>
                            <th>Insert Date</th>
                        </tr>
                    </thead>
               	</table>
                <table>
                    <tbody>';
                    $j=1; $total_receive_non_order=""; $total_issue_non_order="";

                    foreach($result_non_order_13 as $row)
                    {
                        if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

                       $knitting_company=''; $yarn_lot=''; $yarn_count=''; $stitch_length=''; $color_id='';
                        if($row[csf("knitting_source")]==1)
                        {
                            $knitting_company=$company_arr[$row[csf("knitting_company")]];
                        }
                        else if($row[csf("knitting_source")]==3)
                        {
                            $knitting_company=$supplier_arr[$row[csf("knitting_company")]];
                        }

						if($row[csf("transaction_type")]==1)
						{
							$dtls_id=$trans_Id_arr[$row[csf("trans_id")]][1];
							$yarn_lot=$receive_num_arr[$dtls_id][5];
							$yarn_count=$receive_num_arr[$dtls_id][6];
							$stitch_length=$receive_num_arr[$dtls_id][7];
							$color_id=$receive_num_arr[$dtls_id][8];
						}
						else if($row[csf("transaction_type")]==4)
						{
							$dtls_id=$trans_Id_arr[$row[csf("trans_id")]][1];
							$yarn_lot=$row[csf("batch_lot")];
							$yarn_count=$row[csf("yarn_count")];
							$stitch_length=$row[csf("stitch_length")];
						}
						else if($row[csf("transaction_type")]==2)
						{
							$dtls_id=$trans_Id_arr[$row[csf("trans_id")]][2];
							$yarn_lot=$issue_num_arr[$dtls_id][5];
							$yarn_count=$issue_num_arr[$dtls_id][6];
							$stitch_length=$issue_num_arr[$dtls_id][7];
							$color_id=$issue_num_arr[$dtls_id][8];
						}
						else if($row[csf("transaction_type")]==3)
						{
							$dtls_id=$trans_Id_arr[$row[csf("trans_id")]][2];
							$yarn_lot=$row[csf("batch_lot")];
							$yarn_count=$row[csf("yarn_count")];
							$stitch_length=$row[csf("stitch_length")];
						}

						$color='';
						$color_ids=explode(",",$color_id);
						foreach($color_ids as $val)
						{
							if($val>0) $color.=$color_arr[$val].",";
						}
						$color=chop($color,',');

						$yarn_count_name='';
						$yarn_counts=explode(",",$yarn_count);
						foreach($yarn_counts as $val)
						{
							if($val>0) $yarn_count_name.=$yarn_count_arr[$val].",";
						}
						$yarn_count_name=chop($yarn_count_name,',');

                        $html.='<tr>
                            <td>'.$j.'</td>
                            <td>'.$row[csf("prod_id")].'</td>
                            <td>'.change_date_format($row[csf("transaction_date")]).'</td>
                            <td>'.$row[csf("tran_ref")].'</td>
                            <td>'.$row[csf("challan_no")].'</td>';
							if($rptType==3)
							{
								$html.='<td>'.$department_arr[$row[csf("department_id")]].'</td>
                                <td>'.$section_arr[$row[csf("section_id")]].'</td>';
							}
							$html.='<td>'.$knitting_company.'</td>
                            <td>'.$yarn_lot.'</td>
							<td>'.$yarn_count_name.'</td>
                            <td>'.$construction_arr[$product_arr[$row[csf('prod_id')]][1]].'</td>
                            <td>'.$composition_arr[$product_arr[$row[csf('prod_id')]][1]].'</td>
                            <td>'.$color.'</td>
                            <td>'.$product_arr[$row[csf('prod_id')]][2].'</td>
                            <td>'.$product_arr[$row[csf('prod_id')]][3].'</td>
                            <td>'.$stitch_length.'</td>
                            <td>';
                            if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4){ $html.= number_format($row[csf("qty")],2); $total_receive_non_order +=$row[csf("qty")];}
                            $html.='</td>
							<td>';
                            if($row[csf("transaction_type")]==2  || $row[csf("transaction_type")]==3){ $html.= number_format($row[csf("qty")],2); $total_issue_non_order +=$row[csf("qty")];}
                            $html.='</td>
                            <td>'.$user_name_arr[$row[csf("inserted_by")]].'</td>
                            <td>'.$row[csf("insert_date")].'</td>
                        </tr>';
                        $i++;$j++;
                    }
					unset($result);
                    $html.='</tbody>
                </table>
                <table>
                    <tfoot>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>';
                        if($rptType==3)
						{
							$html.='<th></th>
                            <th></th>';
						}
						$html.='<th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th>'.number_format($total_receive_non_order,2).'</th>
                        <th>'.number_format($total_issue_non_order,2).'</th>
                        <th></th>
                        <th></th>
                    </tfoot>
                </table>';
			}
            $html.='</div>';
        }
        else{
            $show_html_13 = 0;
        }
	} //Grey fabric

	if(($key = array_search(1, $cbo_item_cat)) !== false) // Yarn
	{
		unset($cbo_item_cat[$key]); //remove 1 for
		$yarn_count_cond="";
		if($cbo_yarn_count!=0) $yarn_count_cond=" and b.yarn_count_id=$cbo_yarn_count";

		//echo $date_cond;die;
		if($rptType==1)
		{

			$sql="SELECT
						B.ID AS PROD_ID,
						A.ID AS TRANS_ID,
						A.RECEIVE_BASIS,
						A.TRANSACTION_TYPE,
						A.MST_ID AS REC_ISSUE_ID,
						A.TRANSACTION_DATE,
						CASE WHEN A.TRANSACTION_TYPE IN(1,4,5) THEN A.CONS_QUANTITY ELSE 0 END AS RECEIVE_QTY ,
						CASE WHEN A.TRANSACTION_TYPE IN(2,3,6) THEN A.CONS_QUANTITY ELSE 0 END AS ISSUE_QTY ,
						CASE WHEN A.TRANSACTION_TYPE IN(2) THEN A.RETURN_QNTY ELSE 0 END AS RETURN_QNTY ,
						CASE WHEN A.TRANSACTION_TYPE IN(3) THEN A.CONS_QUANTITY ELSE 0 END AS RECEIVE_RET_QTY ,
						CASE WHEN A.TRANSACTION_TYPE IN(4) THEN A.CONS_QUANTITY ELSE 0 END AS ISSUE_RET_QTY ,
						A.CONS_UOM,
						B.YARN_COMP_TYPE1ST AS YARN_COMP_TYPE1ST,
						B.YARN_COMP_PERCENT1ST AS YARN_COMP_PERCENT1ST,
						B.YARN_COMP_TYPE2ND AS YARN_COMP_TYPE2ND,
						B.YARN_COMP_PERCENT2ND  AS YARN_COMP_PERCENT2ND,
						B.LOT,
						B.SUPPLIER_ID,
						B.YARN_COUNT_ID,
						B.YARN_TYPE,
						B.COLOR,
						A.CONS_RATE,
						A.CONS_AMOUNT,
						A.INSERTED_BY,
						$select_insert_date,
						$select_insert_time,
						A.ORDER_QNTY,
						A.ORDER_RATE, A.REQUISITION_NO, NULL AS BOOKING_NO
				from inv_transaction a, product_details_master b
				where a.prod_id=b.id and a.item_category=1 and a.company_id=$cbo_company_name and a.transaction_type in(1,2,3,4,5,6) and a.cons_quantity>0 and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 $date_cond $yarn_count_cond $sql_cond $transaction_ids_cond_for_mrr order by a.transaction_date, a.id";
		}
		else if($rptType==2)
		{
			$sql="SELECT
						B.ID AS PROD_ID,
						A.ID AS TRANS_ID,
						A.RECEIVE_BASIS,
						A.TRANSACTION_TYPE,
						A.MST_ID AS REC_ISSUE_ID,
						A.TRANSACTION_DATE,
						CASE WHEN A.TRANSACTION_TYPE IN(1,4,5) THEN A.CONS_QUANTITY ELSE 0 END AS RECEIVE_QTY ,
						CASE WHEN A.TRANSACTION_TYPE IN(3) THEN A.CONS_QUANTITY ELSE 0 END AS RECEIVE_RET_QTY,
						A.CONS_UOM,
						B.YARN_COMP_TYPE1ST AS YARN_COMP_TYPE1ST,
						B.YARN_COMP_PERCENT1ST AS YARN_COMP_PERCENT1ST,
						B.YARN_COMP_TYPE2ND AS YARN_COMP_TYPE2ND,
						B.YARN_COMP_PERCENT2ND AS YARN_COMP_PERCENT2ND,
						B.LOT,
						B.SUPPLIER_ID,
						B.YARN_COUNT_ID,
						B.YARN_TYPE,
						B.COLOR,
						A.CONS_RATE,
						A.CONS_AMOUNT,
						A.INSERTED_BY,
						$select_insert_date,
						$select_insert_time,
						A.ORDER_QNTY,
						A.ORDER_RATE, A.REQUISITION_NO, NULL AS BOOKING_NO
				from
						inv_transaction a, product_details_master b
				where
						a.prod_id=b.id and a.item_category=1 and a.company_id=$cbo_company_name and a.transaction_type in(1,4,5)  and a.cons_quantity>0 and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 $date_cond $yarn_count_cond $sql_cond $transaction_ids_cond_for_mrr order by a.transaction_date, a.id";
		}
		else if($rptType==3)
		{
			$sql="SELECT B.ID AS PROD_ID, A.ID AS TRANS_ID, A.RECEIVE_BASIS, A.TRANSACTION_TYPE, A.MST_ID AS REC_ISSUE_ID, A.TRANSACTION_DATE, CASE WHEN A.TRANSACTION_TYPE IN(2,3,6) THEN A.CONS_QUANTITY ELSE 0 END AS ISSUE_QTY , A.RETURN_QNTY AS RETURN_QNTY , CASE WHEN A.TRANSACTION_TYPE IN(4) THEN A.CONS_QUANTITY ELSE 0 END AS ISSUE_RET_QTY, A.CONS_UOM, B.YARN_COMP_TYPE1ST AS YARN_COMP_TYPE1ST, B.YARN_COMP_PERCENT1ST AS YARN_COMP_PERCENT1ST, B.YARN_COMP_TYPE2ND AS YARN_COMP_TYPE2ND, B.YARN_COMP_PERCENT2ND AS YARN_COMP_PERCENT2ND, B.LOT, B.SUPPLIER_ID, B.YARN_COUNT_ID, A.DEPARTMENT_ID, A.SECTION_ID, B.YARN_TYPE, B.COLOR, A.CONS_RATE, A.CONS_AMOUNT, A.INSERTED_BY, $select_insert_date, $select_insert_time, A.ORDER_QNTY, A.ORDER_RATE, C.KNIT_DYE_COMPANY, A.STORE_ID, C.IS_APPROVED, A.LOCATION_ID, C.ID AS MST_ID, A.REQUISITION_NO, C.BOOKING_NO, C.BUYER_ID
			from inv_transaction a, product_details_master b, inv_issue_master c
			where a.prod_id=b.id and a.mst_id=c.id and a.item_category=1 and a.company_id=$cbo_company_name and a.transaction_type in(2,3,6) and a.cons_quantity>0 and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 $date_cond $yarn_count_cond $sql_cond $transaction_ids_cond_for_mrr
			order by trans_id desc";
		}

		$sql_result=sql_select($sql);

        $receive_ids_arr=array();
        $issue_ids_arr=array();
        $transfer_ids_arr=array();
        foreach($sql_result as $row)
        {
            if ($row["TRANSACTION_TYPE"]==1 || $row["TRANSACTION_TYPE"]==4){
                $receive_ids_arr[$row["REC_ISSUE_ID"]]=$row["REC_ISSUE_ID"];
            } else if ($row["TRANSACTION_TYPE"]==2 || $row["TRANSACTION_TYPE"]==3) {
                $issue_ids_arr[$row["REC_ISSUE_ID"]]=$row["REC_ISSUE_ID"];
            } else $transfer_ids_arr[$row["REC_ISSUE_ID"]]=$row["REC_ISSUE_ID"];
        }

        $receive_data_arr=array();
        $pi_ids_arr=array();
        $yarndyeing_ids_arr=array();
        $yarnwork_ids_arr=array();
        $btblc_ids_arr=array();
        if (count($receive_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 26, $receive_ids_arr, $empty_arr);
            $sql_receive_res=sql_select("SELECT b.ID, b.ENTRY_FORM, b.RECV_NUMBER, b.KNITTING_SOURCE, b.KNITTING_COMPANY, b.RECEIVE_BASIS, b.BOOKING_NO, b.RECEIVE_PURPOSE, b.SUPPLIER_ID, b.BOOKING_ID, b.CURRENCY_ID, b.EXCHANGE_RATE, b.CHALLAN_NO, b.LC_NO, b.REMARKS from gbl_temp_engine g, inv_receive_master b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=26 and b.item_category=1 and b.status_active=1 and b.is_deleted=0");
            foreach($sql_receive_res as $row)
            {
                $receive_data_arr[$row["ID"]]['rec_id']=$row["ID"];
                $receive_data_arr[$row["ID"]]['recv_number']=$row["RECV_NUMBER"];
                $receive_data_arr[$row["ID"]]['receive_basis']=$row["RECEIVE_BASIS"];
                $receive_data_arr[$row["ID"]]['booking_id']=$row["BOOKING_ID"];
                $receive_data_arr[$row["ID"]]['receive_purpose']=$row["RECEIVE_PURPOSE"];
                $receive_data_arr[$row["ID"]]['supplier_id']=$row["SUPPLIER_ID"];
                $receive_data_arr[$row["ID"]]['entry_form']=$row["ENTRY_FORM"];
                $receive_data_arr[$row["ID"]]['currency_id']=$row["CURRENCY_ID"];
                $receive_data_arr[$row["ID"]]['exchange_rate']=$row["EXCHANGE_RATE"];
                $receive_data_arr[$row["ID"]]['challan_no']=$row["CHALLAN_NO"];
                $receive_data_arr[$row["ID"]]['lc_no']=$row["LC_NO"];
                $receive_data_arr[$row["ID"]]['knitting_source']=$row["KNITTING_SOURCE"];
                $receive_data_arr[$row["ID"]]['knitting_company']=$row["KNITTING_COMPANY"];
                $receive_data_arr[$row["ID"]]['remarks']=$row["REMARKS"];
                $receive_data_arr[$row["ID"]]['booking_no']=$row["BOOKING_NO"];
                if ($row["BOOKING_ID"]>0){
                    if ($row["RECEIVE_BASIS"]==1){
                        $pi_ids_arr[$row["BOOKING_ID"]]=$row["BOOKING_ID"];
                    } else if ($row["RECEIVE_BASIS"]==2 && $row["RECEIVE_PURPOSE"]==2) {
                        $yarndyeing_ids_arr[$row["BOOKING_ID"]]=$row["BOOKING_ID"];
                    } else $yarnwork_ids_arr[$row["BOOKING_ID"]]=$row["BOOKING_ID"];
                }
                if ($row["LC_NO"]>0){
                    $btblc_ids_arr[$row["LC_NO"]]=$row["LC_NO"];
                }
            }
            unset($sql_receive_res);
        }

        $issue_data_arr=array();
        if (count($issue_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 27, $issue_ids_arr, $empty_arr);
            $sql_issue_res=sql_select("SELECT b.ID, b.ENTRY_FORM, b.ISSUE_NUMBER, b.ISSUE_BASIS, b.BOOKING_NO, b.ISSUE_PURPOSE, b.SUPPLIER_ID, b.BOOKING_ID, b.REMARKS, b.KNIT_DYE_COMPANY AS ISSUE_TO, b.KNIT_DYE_SOURCE, b.CHALLAN_NO from gbl_temp_engine g, inv_issue_master b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=27 and b.item_category=1 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_issue_res as $row)
            {
                $issue_data_arr[$row["ID"]]['issue_id']=$row["ID"];
                $issue_data_arr[$row["ID"]]['issue_number']=$row["ISSUE_NUMBER"];
                $issue_data_arr[$row["ID"]]['issue_basis']=$row["ISSUE_BASIS"];
                $issue_data_arr[$row["ID"]]['booking_id']=$row["BOOKING_ID"];
                $issue_data_arr[$row["ID"]]['issue_purpose']=$row["ISSUE_PURPOSE"];
                $issue_data_arr[$row["ID"]]['supplier_id']=$row["SUPPLIER_ID"];
                $issue_data_arr[$row["ID"]]['entry_form']=$row["ENTRY_FORM"];
                $issue_data_arr[$row["ID"]]['knit_dye_source']=$row["KNIT_DYE_SOURCE"];
                $issue_data_arr[$row["ID"]]['issue_to']=$row["ISSUE_TO"];
                $issue_data_arr[$row["ID"]]['remarks']=$row["REMARKS"];
                $issue_data_arr[$row["ID"]]['challan_no']=$row["CHALLAN_NO"];
                $issue_data_arr[$row["ID"]]['booking_no']=$row["BOOKING_NO"];
            }
            unset($sql_issue_res);
        }

        $transfer_num_arr=array();
        if (count($transfer_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 28, $transfer_ids_arr, $empty_arr);
            $sql_transfer_res=sql_select("SELECT b.ID, b.TRANSFER_SYSTEM_ID, b.CHALLAN_NO, b.TRANSFER_DATE from gbl_temp_engine g, inv_item_transfer_mst b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=28 and b.item_category=1 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_transfer_res as $row)
            {
                $transfer_num_arr[$row["ID"]]["id"]=$row["ID"];
                $transfer_num_arr[$row["ID"]]["transfer_system_id"]=$row["TRANSFER_SYSTEM_ID"];
                $transfer_num_arr[$row["ID"]]["challan_no"]=$row["CHALLAN_NO"];
                $transfer_num_arr[$row["ID"]]["transfer_date"]=$row["TRANSFER_DATE"];
            }
            unset($sql_transfer_res);
        }

        $yarn_pi_num_arr=array();
        if (count($pi_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 29, $pi_ids_arr, $empty_arr);
            $sql_pi_res=sql_select("SELECT b.ID, b.PI_NUMBER from gbl_temp_engine g, com_pi_master_details b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=29 and b.item_category_id=1 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_pi_res as $row)
            {
                $yarn_pi_num_arr[$row["ID"]]=$row["PI_NUMBER"];
            }
            unset($sql_pi_res);
        }

        $yarn_dyeing_wo_arr=array();
        if (count($yarndyeing_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 30, $yarndyeing_ids_arr, $empty_arr);
            $sql_yarn_dyeing_res=sql_select("SELECT b.ID, b.YDW_NO from gbl_temp_engine g, wo_yarn_dyeing_mst b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=30 and b.item_category_id=24 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_yarn_dyeing_res as $row)
            {
                $yarn_dyeing_wo_arr[$row["ID"]]=$row["YDW_NO"];
            }
            unset($sql_yarn_dyeing_res);
        }

        $yarn_work_order_arr=array();
        if (count($yarnwork_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 31, $yarnwork_ids_arr, $empty_arr);
            $sql_yarn_work_res=sql_select("SELECT b.ID, b.WO_NUMBER from gbl_temp_engine g, wo_non_order_info_mst b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=31 and b.item_category=1 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_yarn_work_res as $row)
            {
                $yarn_work_order_arr[$row["ID"]]=$row["WO_NUMBER"];
            }
            unset($sql_yarn_work_res);
        }

        $btb_lc_arr=array();
        if (count($btblc_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 32, $btblc_ids_arr, $empty_arr);
            $sql_btb_lc_res=sql_select("SELECT b.ID, b.LC_NUMBER from gbl_temp_engine g, com_btb_lc_master_details b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=32 and b.pi_entry_form=165 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_btb_lc_res as $row)
            {
                $btb_lc_arr[$row["ID"]]=$row["LC_NUMBER"];
            }
            unset($sql_btb_lc_res);
        }

        $show_html_1 = 1;
        if(count($sql_result) > 0)
        {
			$html.='<div>
				<table>
						<tr>
							<td> Yarn: </td>
						</tr>
				</table>
				<br />
				<table>
					<thead>
						<tr>
							<th>SL</th>
							<th>Prod. Id</th>
							<th>Trans. Date</th>
							<th>Trans. Ref.</th>
	                        <th>WO/PI</th>
	                        <th>Buyer</th>
	                        <th>Challan No</th>';
	                        if($rptType==3)
							{
								$html.='<th>Department</th>
	                            <th>Section</th>';
							}
							$html.='<th>';
                            $html.= $caption = ($rptType==3)?" Supplier Name ":" Party Name ";
                            $html.='</th>
	                        <th>Yarn Lot</th>
	                        <th>Yarn Count</th>
							<th>Composition</th>
							<th>Yarn Type</th>
							<th>Color</th>
	                        <th>Basis</th>
	                        <th>WO/PI NO.</th>
	                        <th>BTB LC NO.</th>
	                        <th>Purpose</th>';

	                        if($rptType==3) {
                                $html.='<th>Issue To</th>';
	                        }
							if($rptType==2 || $rptType==1 )
							{
								$html.='<th>Currency</th>
	                            <th>Exchange Rate</th>
	                            <th>Actual Rate</th>
								<th>Receive Qty</th>
								<th>Receive Return Qty</th>
	                            <th>Actual Amt</th>';
							}
							if($rptType==3 || $rptType==1 )
							{
								$html.='<th>Issue Qty</th>
	                            <th>Issue Return Qty</th>
	                            <th>Returnable Qty</th>';
							}
							$html.='<th>Rate(TK)</th>
	                        <th>Amount(TK)</th>
                            <th>Rate(USD)</th>
	                        <th>Amount(USD)</th>
	                        <th>User</th>
	                        <th>Insert Date</th>
	                        <th>Remarks</th>
						</tr>
					</thead>
			   	</table>
				<div>
					<table>
						<tbody>';
						$yarn_count_arr=return_library_array( "select id, yarn_count from  lib_yarn_count where status_active=1",'id','yarn_count');
						$current_date=date("d-m-Y");
						$p=1;
						$queryText = sql_select("select ID, COMPANY_ID, CON_DATE, CONVERSION_RATE from currency_conversion_rate where currency=2 and status_active=1 and is_deleted=0 order by ID");
						//echo count($queryText);die;
						$conversion_data_arr=array();$previous_date="";
						foreach($queryText as $val)
						{
							if($p==1)
							{
								$conversion_data_arr[$val["COMPANY_ID"]][change_date_format($val["CON_DATE"])]=$val["CONVERSION_RATE"];
								$sStartDate = date("Y-m-d", strtotime($val["CON_DATE"]));
								$sCurrentDate = $sStartDate;
								$sEndDate = $sStartDate;
								$previous_date=$sStartDate;
								$previous_rate=$val["CONVERSION_RATE"];
								//echo $sCurrentDate."=".$sEndDate."=".$val["CONVERSION_RATE"]."<br>";
							}
							else
							{
								$sStartDate = date("Y-m-d", strtotime($previous_date));
								if(count($queryText)==$p)
								{
									$sEndDate = gmdate("Y-m-d", strtotime($val["CON_DATE"]));
									$sCurrentDate = $sStartDate;
									//echo $sCurrentDate."=".$sEndDate."=".$previous_rate."<br>";
									while ($sCurrentDate <= $sEndDate) {
										$conversion_data_arr[$val["COMPANY_ID"]][change_date_format($sCurrentDate)]=$previous_rate;
										$sCurrentDate = date("Y-m-d", strtotime("+1 day", strtotime($sCurrentDate)));
									}

									$sStartDate=date("Y-m-d", strtotime("+1 day", strtotime($sEndDate)));
									$sEndDate = date("Y-m-d", strtotime($current_date));
									$sCurrentDate = $sStartDate;
									//echo $sCurrentDate."=".$sEndDate."=".$val["CONVERSION_RATE"]."<br>";
									while ($sCurrentDate <= $sEndDate) {

										$conversion_data_arr[$val["COMPANY_ID"]][change_date_format($sCurrentDate)]=$val["CONVERSION_RATE"];
										$sCurrentDate = date("Y-m-d", strtotime("+1 day", strtotime($sCurrentDate)));
									}
									$previous_date=$val["CON_DATE"];
									$previous_rate=$val["CONVERSION_RATE"];
								}
								else
								{
									$sEndDate = gmdate("Y-m-d", strtotime($val["CON_DATE"]));
									$sCurrentDate = $sStartDate;
									//echo $sCurrentDate."=".$sEndDate."=".$previous_rate."<br>";
									while ($sCurrentDate <= $sEndDate) {
										$conversion_data_arr[$val["COMPANY_ID"]][change_date_format($sCurrentDate)]=$previous_rate;
										$sCurrentDate = date("Y-m-d", strtotime("+1 day", strtotime($sCurrentDate)));
									}
									$previous_date=$val["CON_DATE"];
									$previous_rate=$val["CONVERSION_RATE"];
								}
							}
							$p++;
						}
						unset($queryText);
						//echo "<pre>";print_r($conversion_data_arr);die;
						$i=1;$total_receive="";$total_issue="";
						foreach($sql_result as $val)
						{
	                        //var_dump($val);
							if ($i%2==0)
							$bgcolor="#E9F3FF";
							else
							$bgcolor="#FFFFFF";
							$html.='<tr>
								<td>'.$i.'</td>
								<td>'.$val["PROD_ID"].'</td>
								<td>'.change_date_format($val["TRANSACTION_DATE"]).'</td>
								<td>';
									if($val["TRANSACTION_TYPE"]==1  || $val["TRANSACTION_TYPE"]==4 )
									{
										$html.= $receive_data_arr[$val['REC_ISSUE_ID']]["recv_number"];
										$remarks=$receive_data_arr[$val['REC_ISSUE_ID']]["remarks"];
									}
									else if($val["TRANSACTION_TYPE"]==2  || $val["TRANSACTION_TYPE"]==3)
									{
										$html.= $issue_data_arr[$val['REC_ISSUE_ID']]["issue_number"];
										$remarks=$issue_data_arr[$val['REC_ISSUE_ID']]["remarks"];
										//echo $val['REC_ISSUE_ID'];
									}
									else if($val["TRANSACTION_TYPE"]==5  || $val["TRANSACTION_TYPE"]==6)
									{
										$html.= $transfer_num_arr[$val['REC_ISSUE_ID']]["transfer_system_id"];
									}
									//echo $val["TRANSACTION_TYPE"];

                                    $html.='</td>';
                                    $basis = $booking_no = $booking_id = "";
									if($val["TRANSACTION_TYPE"]==1  || $val["TRANSACTION_TYPE"]==4 )
									{
                                        $basis = $receive_data_arr[$val['REC_ISSUE_ID']]['receive_basis'];
                                        $booking_no = $receive_data_arr[$val['REC_ISSUE_ID']]["booking_no"];
                                        $booking_id = $receive_data_arr[$val['REC_ISSUE_ID']]["booking_id"];
                                        $html.='<td>'.$booking_no.'</td>';
									}
									else if($val["TRANSACTION_TYPE"]==2  || $val["TRANSACTION_TYPE"]==3)
									{
                                        $basis = $issue_data_arr[$val['REC_ISSUE_ID']]['issue_basis'];
                                        $booking_no = $issue_data_arr[$val['REC_ISSUE_ID']]["booking_no"];
                                        $booking_id = $issue_data_arr[$val['REC_ISSUE_ID']]["booking_id"];
                                        $html.='<td>'.$booking_no.'</td>';
									}else{
                                        $html.='<td></td>';
                                    }
                                $html.='<td>'. $buyer_name_arr[$val["BUYER_ID"]].'</td>
	                            <td>';

									if($val["TRANSACTION_TYPE"]==1  || $val["TRANSACTION_TYPE"]==4 )
									{
										$html.= $receive_data_arr[$val['REC_ISSUE_ID']]["challan_no"];
									}
									else if($val["TRANSACTION_TYPE"]==2  || $val["TRANSACTION_TYPE"]==3)
									{
										$html.= $issue_data_arr[$val['REC_ISSUE_ID']]["challan_no"];
										//echo $val['REC_ISSUE_ID'];
									}


									else if($val["TRANSACTION_TYPE"]==5  || $val["TRANSACTION_TYPE"]==6)
									{
										$html.= $transfer_num_arr[$val['REC_ISSUE_ID']]["challan_no"];
										//echo $val['REC_ISSUE_ID'];
									}

                                $html.='</td>';
								if($rptType==3)
								{
									$html.='<td>'. $department_arr[$val["DEPARTMENT_ID"]].'</td>
	                                <td>'. $section_arr[$val["SECTION_ID"]].'</td>';
								}
								$html.='<td>'.$supplier_arr[$val["SUPPLIER_ID"]].'</td>
	                            <td>'. $val["LOT"].'</td>
	                            <td>'. $yarn_count_arr[$val["YARN_COUNT_ID"]].'</td>
	                            <td>';
								if($val["YARN_COMP_PERCENT1ST"]!=0) {$parcent1st=$val["YARN_COMP_PERCENT1ST"]."%";} else {$parcent1st="";}
								if($val["YARN_COMP_PERCENT2ND"]!=0 ){ $parcent2nd=$val["YARN_COMP_PERCENT2ND"]."%";} else {$parcent2nd="";}
                                $html.= $composition[$val["YARN_COMP_TYPE1ST"]].' '.$parcent1st.' '.$composition[$val["YARN_COMP_TYPE2ND"]].' '.$parcent2nd;
                                $html.='</td>
	                            <td>'. $yarn_type[$val["YARN_TYPE"]].'</td>
	                            <td>'. $color_arr[$val["COLOR"]].'</td>';
								if($val["TRANSACTION_TYPE"]==1 || $val["TRANSACTION_TYPE"]==4 )
								{
									$html.='<td>';
									if($receive_data_arr[$val['REC_ISSUE_ID']]['entry_form']!=9)
									{
										if($receive_data_arr[$val['REC_ISSUE_ID']]['receive_basis']!=3)
										{
											$html.= $receive_basis_arr[$receive_data_arr[$val['REC_ISSUE_ID']]['receive_basis']];
										}

									}
									$html.='</td>
									<td>';
									$knitting_soucre=$receive_data_arr[$val['REC_ISSUE_ID']]['knitting_source'];
									$knitting_company=$receive_data_arr[$val['REC_ISSUE_ID']]['knitting_company'];
									if($receive_data_arr[$val['REC_ISSUE_ID']]['entry_form']==9)
									{
										 if($knitting_soucre==1)
										 {
											$supplier_name=$company_arr[$knitting_company];
										 }
										 else
										 {
											$supplier_name=$supplier_arr[$knitting_company];
										 }

										 $html.= "Issue Return".'('.$supplier_name.')';
									 }
									 else
									 {
										 if($val["RECEIVE_BASIS"]==1) $html.= $yarn_pi_num_arr[$receive_data_arr[$val['REC_ISSUE_ID']]['booking_id']];
										 if($val["RECEIVE_BASIS"]==2){ if($receive_data_arr[$val['REC_ISSUE_ID']]['receive_purpose']==2) $html.= $yarn_dyeing_wo_arr[$receive_data_arr[$val['REC_ISSUE_ID']]['booking_id']];  else  $html.= $yarn_work_order_arr[$receive_data_arr[$val['REC_ISSUE_ID']]['booking_id']];}
									 }
                                     $html.='</td>
									<td>'. $btb_lc_arr[$receive_data_arr[$val['REC_ISSUE_ID']]['lc_no']].'</td>
	                                <td>'. $yarn_issue_purpose[$receive_data_arr[$val['REC_ISSUE_ID']]['receive_purpose']].'</td>';
								}
								else if($val["TRANSACTION_TYPE"]==2 || $val["TRANSACTION_TYPE"]==3 )
								{
									$html.='<td>'. $issue_basis[$issue_data_arr[$val['REC_ISSUE_ID']]['issue_basis']].'</td>
									<td></td>
	                                <td></td>
									<td>'. $yarn_issue_purpose[$issue_data_arr[$val['REC_ISSUE_ID']]['issue_purpose']].'</td>';
								}
								else if($val["TRANSACTION_TYPE"]==5 || $val["TRANSACTION_TYPE"]==6 )
								{
									$html.='<td>Item Transfer</td>
									<td></td>
	                                <td></td>
									<td>Item Transfer</td>';
								}

								if($rptType==2 || $rptType==1 )
								{
									$html.='<td width="80" align="center" class="wrd_brk">';
									if($val["TRANSACTION_TYPE"]==1)
									{
										$html.= $currency[$receive_data_arr[$val['REC_ISSUE_ID']]["currency_id"]];
									}
									else if($val["TRANSACTION_TYPE"]==5)
									{
										$html.= $currency[1];
									}
									$html.='</td>
	                                <td>';
									if($val["TRANSACTION_TYPE"]==1)
									{
										$html.= number_format($receive_data_arr[$val['REC_ISSUE_ID']]["exchange_rate"],2);
									}
									else if($val["TRANSACTION_TYPE"]==5)
									{
										$html.= "1";
									}
									else $html.= "0";
									$html.='</td>
	                                <td>';

									if($val["TRANSACTION_TYPE"]==1) $html.= number_format($val["ORDER_RATE"],4);
									else if($val["TRANSACTION_TYPE"]==5) $html.= number_format($val["CONS_RATE"],4);
									else $html.= number_format(0,4);
                                    $total_receive +=$val["RECEIVE_QTY"];
                                    $tot_receive_ret_qty +=$val["RECEIVE_RET_QTY"];
									$html.='</td>
									<td>'.number_format($val["RECEIVE_QTY"],2,".","").'</td>
	                                <td>'.number_format($val["RECEIVE_RET_QTY"],2,".","").'</td>
	                                <td>';
									if($val["TRANSACTION_TYPE"]==1)
									{
										$order_amt=$val["ORDER_QNTY"]*$val["ORDER_RATE"];
										$html.= number_format($order_amt,4); $total_order_amt+=$order_amt; $order_amt=0;
									}
									else if($val["TRANSACTION_TYPE"]==5) $html.= number_format($val["CONS_AMOUNT"],4);
									else $html.= number_format(0,4);
									$html.='</td>';
								}

	                            if($rptType==3)
	                            {
                                    $html.='<td>';
	                               if($company_arr[$issue_data_arr[$val['REC_ISSUE_ID']]['issue_to']] =='')
	                               {
	                                    $html.= $supplier_arr[$val["KNIT_DYE_COMPANY"]];
	                               }
	                               else
                                   {
	                                    $html.= $company_arr[$issue_data_arr[$val['REC_ISSUE_ID']]['issue_to']];
	                               }
	                               $html.='</td>';
                                }

								if($rptType==3 || $rptType==1 )
								{
									$html.='<td>'.number_format($val["ISSUE_QTY"],2,".","").'</td>
	                                <td>'. number_format($val["ISSUE_RET_QTY"],2,".","").'</td>
	                                <td>'. number_format($val["RETURN_QNTY"],2,".","").'</td>';
                                    $total_issue +=$val["ISSUE_QTY"];
                                    $tot_issue_ret_qty +=$val["ISSUE_RET_QTY"];
                                    $total_return +=$val["RETURN_QNTY"];
                                    if($val["ISSUE_QTY"] == 0){
                                        $val["CONS_RATE"] = 0;
                                        $val["CONS_AMOUNT"] = 0;
                                    }
								}
                                $rate_usd=$val["CONS_RATE"]/$conversion_data_arr[str_replace("'","",$cbo_company_name)][change_date_format($val["TRANSACTION_DATE"])];
                                $amount_usd=$val["CONS_AMOUNT"]/$conversion_data_arr[str_replace("'","",$cbo_company_name)][change_date_format($val["TRANSACTION_DATE"])];
								$html.='<td>'. number_format($val["CONS_RATE"],2,".","").'</td>
	                            <td>'. number_format($val["CONS_AMOUNT"],2,".","").'</td>
                                <td>'.number_format($rate_usd,3,".","").'</td>
	                            <td>'.number_format($amount_usd,3,".","").'</td>
	                            <td>'. $user_name_arr[$val["INSERTED_BY"]].'</td>
	                            <td>'.change_date_format($val["INSERT_DATE"]).' '.$val["INSERT_TIME"].'</td>
	                            <td>'. $remarks .'</td>
							</tr>';
							$totla_amount +=$val["CONS_AMOUNT"];
                            $total_amount_usd +=$amount_usd;
							$i++;
						}
						$html.='</tbody>
					</table>
	                <table>
	                    <tfoot>
	                    	<th></th>
	                        <th></th>
	                        <th></th>
	                        <th></th>
	                        <th></th>
	                        <th></th>
	                        <th></th>';
							if($rptType==3)
							{
								$html.='<th></th>
								<th></th>';
							}
							$html.='<th></th>
	                        <th></th>
	                        <th></th>
	                        <th></th>
	                        <th></th>
	                        <th></th>
	                        <th></th>
	                        <th></th>
	                        <th></th>';
	                        if($rptType==3){
                                $html.='<th></th>';
	                        }
	                        $html.='<th></th>';
                            if($rptType==3) $html.= 'Total:';
                            $html.='</th>';
	                        if($rptType==2 || $rptType==1 )
							{
								$html.='<th></th>
	                            <th></th>
	                            <th>Total:</th>
	                        	<th>'.number_format($total_receive,2).'</th>
	                            <th>'.number_format($tot_receive_ret_qty,2).'</th>
	                            <th>'.number_format($total_order_amt,2).'</th>';
							}
							if($rptType==3 || $rptType==1 )
							{
								$html.='<th>'.number_format($total_issue,2).'</th>
	                            <th>'.number_format($tot_issue_ret_qty,2).'</th>
	                            <th>'.number_format($total_return,2).'</th>';
							}
							$html.='<th></th>
	                        <th>'.number_format($totla_amount,2).'</th>
                            <th></th>
	                        <th>'.number_format($total_amount_usd,2).'</th>
	                        <th></th>
	                        <th></th>
	                        <th></th>
	                    </tfoot>
	                </table>
				</div>
			</div>';
        }
        else
        {
        	$show_html_1 = 0;
        }
	}

    if(count($cbo_item_cat) > 0)  // Others Categorys
	{
        $cbo_item_cat = implode(",",$cbo_item_cat);

        $stationary_print_report_format=return_field_value("format_id","lib_report_template","template_name =".$cbo_company_name." and module_id=5 and report_id=61 and is_deleted=0 and status_active=1");
        $stationary_format_ids=explode(",",$stationary_print_report_format);
        $spare_print_report_format=return_field_value("format_id","lib_report_template","template_name =".$cbo_company_name." and module_id=5 and report_id=30 and is_deleted=0 and status_active=1");
        $spare_format_ids=explode(",",$spare_print_report_format);
        $dnc_print_report_format=return_field_value("format_id","lib_report_template","template_name =".$cbo_company_name." and module_id=5 and report_id=132 and is_deleted=0 and status_active=1");
        $dnc_format_ids=explode(",",$dnc_print_report_format);


		if($cbo_item_cat != "") $item_cond=" and a.item_category in ($cbo_item_cat) and b.item_category_id in ($cbo_item_cat)";
		$use_for_cond="";
		if($cbo_use_for>0) $use_for_cond=" and a.use_for=$cbo_use_for";
		if($rptType==1)
		{
			$sql="SELECT
					a.id as trans_id,
					a.transaction_type,
					a.mst_id as rec_issue_id,
					a.transaction_date,
					case when a.transaction_type in(1,4,5) then a.cons_quantity else 0 end as receive_qty,
					case when a.transaction_type in(2,3,6) then a.cons_quantity else 0 end as issue_qty,
					a.cons_uom,
					a.item_category,
					a.supplier_id,
					b.id as prod_id,
					b.item_group_id,
					b.sub_group_name,
					b.item_description,
					a.department_id,
					b.item_code,
					b.item_size,
					a.cons_rate,
					a.cons_amount,
					a.inserted_by,
					$select_insert_date,
					$select_insert_time,
					a.order_qnty,
					a.order_rate,
					a.machine_category,
					a.machine_id,
					a.floor_id,
                    a.production_floor,
					a.use_for,
					a.item_return_qty as return_qnty
				from
					inv_transaction a, product_details_master b
				where
					a.prod_id=b.id and a.company_id=$cbo_company_name and a.transaction_type in(1,2,3,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $item_cond $date_cond $sql_cond $transaction_ids_cond_for_mrr
				order by a.transaction_date, a.id";
		}
		else if($rptType==2)
		{
			$sql="SELECT
					a.id as trans_id,
					a.transaction_type,
					a.mst_id as rec_issue_id,
					a.transaction_date,
					a.cons_quantity as receive_qty,
					'' as issue_qty,
					a.cons_uom,
					a.item_category,
					a.supplier_id,
					b.id as prod_id,
					b.item_group_id,
					b.sub_group_name,
					b.item_description,
					b.item_code,
					b.item_size,
					a.cons_rate,
					a.cons_amount,
					c.receive_basis,
					c.booking_id,
					c.booking_no,
					a.inserted_by,
					$select_insert_date,
					$select_insert_time,
					a.order_qnty,
					a.order_rate,
					a.machine_category,
					a.machine_id,
					a.floor_id,
					a.use_for,
					a.item_return_qty as return_qnty
				from
					inv_transaction a, product_details_master b, inv_receive_master c
				where
					a.mst_id=c.id and a.prod_id=b.id and a.company_id=$cbo_company_name and a.transaction_type in(1,4,5) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $item_cond $date_cond $sql_cond $transaction_ids_cond_for_mrr
				order by a.transaction_date, a.id";
		}
		else if($rptType==3)
		{
			$sql="SELECT
					a.id as trans_id,
					a.transaction_type,
					a.mst_id as rec_issue_id,
					a.transaction_date,
					'' as receive_qty,
					a.cons_quantity as issue_qty,
					a.cons_uom,
					a.item_category,
					a.supplier_id,
					b.id as prod_id,
					b.item_group_id,
					b.sub_group_name,
					b.item_description,
					b.item_code,
					b.item_size,
					a.cons_rate,
					a.cons_amount,
					a.department_id,
					a.section_id,
					a.inserted_by,
					$select_insert_date,
					$select_insert_time,
					a.order_qnty,
					a.order_rate,
					a.machine_category,
					a.machine_id,
					a.floor_id,
                    a.production_floor,
					a.use_for,
					a.item_return_qty as return_qnty,
					a.remarks
				from
					inv_transaction a, product_details_master b
				where
					a.prod_id=b.id and a.company_id=$cbo_company_name and a.transaction_type in(2,3,6) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $item_cond $date_cond $use_for_cond $sql_cond $transaction_ids_cond_for_mrr
				    order by a.transaction_date, a.id";
		}
		//echo $sql;//die;

		$sql_result=sql_select($sql);
        $receive_ids_arr=array();
        $issue_ids_arr=array();
        $transfer_ids_arr=array();
        foreach($sql_result as $row)
        {
            if ($row[csf("transaction_type")]==1 || $row[csf("transaction_type")]==4){
                $receive_ids_arr[$row[csf("rec_issue_id")]]=$row[csf("rec_issue_id")];
            } else if ($row[csf("transaction_type")]==2 || $row[csf("transaction_type")]==3) {
                $issue_ids_arr[$row[csf("rec_issue_id")]]=$row[csf("rec_issue_id")];
            } else $transfer_ids_arr[$row[csf("rec_issue_id")]]=$row[csf("rec_issue_id")];
        }

        $receive_num_arr=array();
        $pi_ids_arr=array();
        $booking_ids_arr=array();
        $requ_ids_arr=array();
        if (count($receive_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 33, $receive_ids_arr, $empty_arr);
            $sql_receive_res=sql_select("SELECT a.id, a.recv_number, a.challan_no, a.challan_date, a.supplier_id,a.knitting_source, a.knitting_company, a.currency_id, a.exchange_rate, a.booking_id, a.booking_no, a.receive_basis,a.booking_no, b.item_category from gbl_temp_engine g, inv_receive_master a, inv_transaction b where g.ref_val=a.id and a.id=b.mst_id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=33 and b.item_category in($cbo_item_cat) and b.transaction_type in(1,4) and a.status_active=1 and b.status_active=1 and b.is_deleted=0");
            foreach($sql_receive_res as $row)
            {
                $receive_num_arr[$row[csf("id")]]["id"]=$row[csf("id")];
			    $receive_num_arr[$row[csf("id")]]["recv_number"]=$row[csf("recv_number")];
                $receive_num_arr[$row[csf("id")]]["challan_no"]=$row[csf("challan_no")];
                $receive_num_arr[$row[csf("id")]]["challan_date"]=$row[csf("challan_date")];
                $receive_num_arr[$row[csf("id")]]["supplier_id"]=$row[csf("supplier_id")];
                $receive_num_arr[$row[csf("id")]]["knitting_source"]=$row[csf("knitting_source")];
                $receive_num_arr[$row[csf("id")]]["knitting_company"]=$row[csf("knitting_company")];
                $receive_num_arr[$row[csf("id")]]["currency_id"]=$row[csf("currency_id")];
                $receive_num_arr[$row[csf("id")]]["exchange_rate"]=$row[csf("exchange_rate")];
                $receive_num_arr[$row[csf("id")]]["booking_id"]=$row[csf("booking_id")];
                $receive_num_arr[$row[csf("id")]]["booking_no"]=$row[csf("booking_no")];
                $receive_num_arr[$row[csf("id")]]["receive_basis"]=$row[csf("receive_basis")];
                $receive_num_arr[$row[csf("booking_id")]]["receive_basis"]=$row[csf("receive_basis")];
                $receive_num_arr[$row[csf("id")]]["item_category"]=$row[csf("item_category")];

                if ($row[csf("booking_id")]>0){
                    if ($row[csf("receive_basis")]==1){
                        $pi_ids_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
                    } else if ($row[csf("receive_basis")]==2) {
                        $booking_ids_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
                    } else if ($row[csf("receive_basis")]==7) {
                        $requ_ids_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
                    }
                }

            }
            unset($sql_receive_res);
        }

        $issue_num_arr=array();
        if (count($issue_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 34, $issue_ids_arr, $empty_arr);
            $sql_issue_res=sql_select("SELECT a.id, a.issue_number, a.challan_no, a.req_no, a.knit_dye_source, a.knit_dye_company, b.remarks,a.booking_no,a.booking_id, b.item_category,a.ISSUE_PURPOSE from gbl_temp_engine g, inv_issue_master a, inv_transaction b where g.ref_val=a.id and a.id=b.mst_id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=34 and b.item_category in($cbo_item_cat) and b.transaction_type in(2,3) and a.status_active=1 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_issue_res as $row)
            {
                $issue_num_arr[$row[csf("id")]]["id"]=$row[csf("id")];
                $issue_num_arr[$row[csf("id")]]["issue_number"]=$row[csf("issue_number")];
                $issue_num_arr[$row[csf("id")]]["challan_no"]=$row[csf("challan_no")];
                $issue_num_arr[$row[csf("id")]]["req_no"]=$row[csf("req_no")];
                $issue_num_arr[$row[csf("id")]]["knit_dye_source"]=$row[csf("knit_dye_source")];
                $issue_num_arr[$row[csf("id")]]["knit_dye_company"]=$row[csf("knit_dye_company")];
                $issue_num_arr[$row[csf("id")]]["remarks"]=$row[csf("remarks")];
                $issue_num_arr[$row[csf("id")]]["booking_no"]=$row[csf("booking_no")];
                $issue_num_arr[$row[csf("id")]]["booking_id"]=$row[csf("booking_id")];
                $issue_num_arr[$row[csf("id")]]["item_category"]=$row[csf("item_category")];
                $issue_num_arr[$row[csf("id")]]["issue_purpose"]=$row["ISSUE_PURPOSE"];
                if ($row[csf("booking_id")]>0) $booking_ids_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
            }
            unset($sql_issue_res);
        }

        $transfer_num_arr=array();
        if (count($transfer_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 35, $transfer_ids_arr, $empty_arr);
            $sql_transfer_res=sql_select("SELECT a.id, a.transfer_system_id, a.challan_no, a.transfer_date from gbl_temp_engine g, inv_item_transfer_mst a, inv_transaction b where g.ref_val=a.id and a.id=b.mst_id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=35 and b.item_category in($cbo_item_cat) and b.transaction_type in(5,6) and a.status_active=1 and b.status_active=1 and b.is_deleted=0");
            foreach($sql_transfer_res as $row)
            {
                $transfer_num_arr[$row[csf("id")]]["id"]=$row[csf("id")];
                $transfer_num_arr[$row[csf("id")]]["transfer_system_id"]=$row[csf("transfer_system_id")];
                $transfer_num_arr[$row[csf("id")]]["challan_no"]=$row[csf("challan_no")];
                $transfer_num_arr[$row[csf("id")]]["transfer_date"]=$row[csf("transfer_date")];
            }
            unset($sql_transfer_res);
        }

        $pi_num_arr=array();
        if (count($pi_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 36, $pi_ids_arr, $empty_arr);
            $sql_pi_res=sql_select("SELECT b.ID, b.PI_NUMBER from gbl_temp_engine g, com_pi_master_details b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=36 and b.status_active=1 and b.is_deleted=0");//die;
            foreach($sql_pi_res as $row)
            {
                $pi_num_arr[$row["ID"]]=$row["PI_NUMBER"];
            }
            unset($sql_pi_res);
        }

        $wo_arr=array();
        $select_non_order_report_data=array();
        if (count($booking_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 37, $booking_ids_arr, $empty_arr);
            $sql_wo_res=sql_select("SELECT a.id, a.company_name, a.wo_number_prefix_num, a.requisition_no, a.wo_number, a.wo_date, a.attention, a.location_id, a.supplier_id, a.pay_mode, a.source, a.currency_id, a.delivery_date, a.wo_basis_id, b.item_category_id from gbl_temp_engine g, wo_non_order_info_mst a, wo_non_order_info_dtls b where g.ref_val=a.id and a.id=b.mst_id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=37 and a.status_active=1 and b.status_active=1");//die;
            foreach($sql_wo_res as $row)
            {
                $wo_arr[$row[csf("id")]]['wo_number']=$row[csf("wo_number")];
				$wo_arr[$row[csf("id")]]['requ_no']=$row[csf("requisition_no")];

                $select_non_order_report_data[$row[csf("id")]]['id']=$row[csf("id")];
                $select_non_order_report_data[$row[csf("id")]]['company_name']=$row[csf("company_name")];
                $select_non_order_report_data[$row[csf("id")]]['wo_number_prefix_num']=$row[csf("wo_number_prefix_num")];
                $select_non_order_report_data[$row[csf("id")]]['wo_number']=$row[csf("wo_number")];
                $select_non_order_report_data[$row[csf("id")]]['wo_date']=$row[csf("wo_date")];
                $select_non_order_report_data[$row[csf("id")]]['attention']=$row[csf("attention")];
                $select_non_order_report_data[$row[csf("id")]]['location_id']=$row[csf("location_id")];
                $select_non_order_report_data[$row[csf("id")]]['supplier_id']=$row[csf("supplier_id")];
                $select_non_order_report_data[$row[csf("id")]]['pay_mode']=$row[csf("pay_mode")];
                $select_non_order_report_data[$row[csf("id")]]['source']=$row[csf("source")];
                $select_non_order_report_data[$row[csf("id")]]['currency_id']=$row[csf("currency_id")];
                $select_non_order_report_data[$row[csf("id")]]['delivery_date']=$row[csf("delivery_date")];
                $select_non_order_report_data[$row[csf("id")]]['wo_basis_id']=$row[csf("wo_basis_id")];
                $select_non_order_report_data[$row[csf("id")]]['item_category_id']=$row[csf("item_category_id")];
            }
            unset($sql_wo_res);
        }

        $req_location_arr=array();
        $requisiton_arr=array();
        if (count($requ_ids_arr)>0)
        {
            fnc_tempengine("gbl_temp_engine", $user_id, 33, 38, $requ_ids_arr, $empty_arr);
            $sql_requ_res=sql_select("SELECT b.ID, b.LOCATION_ID, b.REQU_PREFIX_NUM from gbl_temp_engine g, inv_purchase_requisition_mst b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=38 ");//die;
            foreach($sql_requ_res as $row)
            {
                $req_location_arr[$row["ID"]]=$row["LOCATION_ID"];
                $requisiton_arr[$row["ID"]]=$row["REQU_PREFIX_NUM"];
            }
            unset($sql_requ_res);
        }

        foreach($sql_result as $row)
        {
            $requ_no=$wo_arr[$receive_num_arr[$row[csf('rec_issue_id')]]["booking_id"]]['requ_no'];
            $reqs=explode(",", rtrim($requ_no,','));
            $req_book_no='';
            foreach($reqs as $val)
            {
               $req_ids .= $val.",";
            }
        }
        $all_req_id = ltrim(implode(",", array_unique(explode(",", chop($req_ids, ",")))), ',');

        $req_sql=sql_select("SELECT a.id, a.requ_no from inv_purchase_requisition_mst a, inv_purchase_requisition_dtls b where a.id=b.mst_id and a.id in($all_req_id) and a.is_deleted=0 and b.is_deleted=0");
		$reqisition_data=array();
		foreach ($req_sql as $row)
		{
			$reqisition_data[$row[csf('id')]]['requ_no']=$row[csf('requ_no')];
		}

        $group_arr=return_library_array( "select id, item_name from  lib_item_group",'id','item_name');
        $machine_arr=return_library_array( "select id, machine_no from lib_machine_name",'id','machine_no');
        if($rptType==1 || $rptType==3)
        {
            $floor_arr=return_library_array( "select floor_room_rack_id, floor_room_rack_name from  lib_floor_room_rack_mst",'floor_room_rack_id','floor_room_rack_name');
            $iss_floor_arr=return_library_array( "SELECT id, floor_name from  lib_prod_floor",'id','floor_name');
        }

		$show_html_other = 1;
		if(count($sql_result) > 0)
		{

			$html.='<div>
					<table>
							<tr>
								<td> Others : </td>
							</tr>
					   </table>
					   <br />
					   <table width="'.$table_width.'" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="table_header_1" align="left">
					   <thead>
						   <tr>
							   <th  >SL</th>
							   <th  >Prod. Id</th>
							   <th  >Trans. Date</th>
							   <th  >Trans. Ref.</th>
							   <th  >Store Name</th>';
							   if($rptType==3)
							   {
								   $html.='<th >Issue Purposed</th>';
							   }
							   $html.='<th  >WO/PI</th>
							   <th  >Category</th>
							   <th  >Supplier</th>
							   <th  >Challan No</th>';
							   if($rptType==1 || $rptType==2)
							   {
								   $html.='<th >Challan Date</th>';
							   }
							   if($rptType==2)
							   {
								   $html.='<th >Receive Basis</th>';
							   }
							   $html.='<th >Pur. Reqsn/<br /> Book. No/<br />Store Reqsn</th>';
							   if($rptType==2)
							   {
								   $html.='<th >WO/PI No.</th>';
							   }
							   else if($rptType==3)
							   {
								   $html.='<th >Division</th>
								   <th >Department</th>
								   <th >Section</th>';
							   }
							   $html.='<th >Item Group</th>
							   <th >UOM</th>
							   <th >Item Sub-Group</th>
							   <th >Item Description</th>
							   <th  >Item Code</th>';
							   if($rptType==3 || $rptType==1 )
							   {
								   $html.='<th >Machine Category</th>
								   <th >Stock Floor</th>
								   <th >Issue To Floor</th>
								   <th  >Machine No</th>';
							   }
							   $html.='<th >Size</th>';
							   if($rptType==2 || $rptType==1 )
							   {
								   $html.='<th >Currency</th>
								   <th >Exchange Rate</th>
								   <th  >Actual Rate</th>
								   <th  >Receive Qty</th>
								   <th  >Actual Amt</th>';
							   }
							   if($rptType==3 || $rptType==1 )
							   {
								   $html.='<th  >Issue Qty</th>
								   <th  >Replace Qty</th>';
							   }
							   $html.='<th  >Rate(TK)</th>
							   <th  >Amount(TK)</th>';
								if($rptType==3 || $rptType==1 )
								{ $html.='<th >Issue To</th>'; }
								$html.='<th  >User</th>
							   <th  >Insert Date</th>';
							   if($rptType==2 )
							   { $html.='<th >Comments</th>'; }
							   if($rptType==3)
							   {
								   $html.='<th >Use For</th>
								   <th >Remarks</th>';
							   }
							   $html.='</tr>
					   </thead>
				  </table>
				   <br />
				  <div>
				<table>
				  <tbody>';
				  $group_arr=return_library_array( "select id, item_name from  lib_item_group",'id','item_name');
				  $i=1;$total_receive="";$total_issue="";$others_total_amount2=0;$tot_rate=0;
				  foreach($sql_result as $row)
				  {
					  if ($i%2==0)
					  $bgcolor="#E9F3FF";
					  else
					  $bgcolor="#FFFFFF";
					  $html.='<tr bgcolor="'.$bgcolor.'" onClick="change_color(\'tr_'.$i.'\',\''.$bgcolor.'\')" id="tr_'.$i.'">
						  <td >'.$i.'</td>
						  <td align="center" class="wrd_brk">'.$row[csf("prod_id")].'</td>
						  <td  align="center" class="wrd_brk">'.change_date_format($row[csf("transaction_date")]).'</ td>
						  <td   class="wrd_brk" align="center" title="'.$row[csf("transaction_type")].'_'.$row[csf('rec_issue_id')].'">
						   ';
						  if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4)
						  {
							  $html.= $receive_num_arr[$row[csf('rec_issue_id')]]["recv_number"];
						  }
						  else if($row[csf("transaction_type")]==2  || $row[csf("transaction_type")]==3)
						  {
							  $html.= $issue_num_arr[$row[csf('rec_issue_id')]]["issue_number"];
						  }
						  else if( $row[csf("transaction_type")]==5 || $row[csf("transaction_type")]==6)
						  {
							  $html.= $transfer_num_arr[$row[csf('rec_issue_id')]]["transfer_system_id"];
						  }
						  $html.='
						  </td>
						  <td >'.$store_arr[$row[csf("store_id")]].'</td>
						  ';

						  if($rptType==3)
						  {
							  $html.='<td >';
							  if($row[csf("transaction_type")]==2)
							  {
								  $html.=$general_issue_purpose[$issue_num_arr[$row[csf('rec_issue_id')]]["issue_purpose"]];
							  }
							  $html.='</td>';
						  }
							 if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4)
							 {
								  $basis = $receive_num_arr[$row[csf('rec_issue_id')]]['receive_basis'];
								  $booking_no = $receive_num_arr[$row[csf('rec_issue_id')]]["booking_no"];
								  $booking_id = $receive_num_arr[$row[csf('rec_issue_id')]]["booking_id"];
								  if($basis == 1 && $booking_no != ''){ //pi
									  $html.='<td   class="wrd_brk" align="center">'. $booking_no.'</td>';
								  }
								  elseif($basis == 2 && $booking_no != ''){
									  if($row[csf('item_category')] == 11 || $row[csf('item_category')] == 4) {
										  if ($stationary_format_ids[0] == 66) {
											  $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
											  $report_action = "stationary_work_order_print";
										  } elseif ($stationary_format_ids[0] == 85) {
											  $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
											  $report_action = "stationary_work_order_print3";
										  } elseif ($stationary_format_ids[0] == 129) {
											  $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
											  $report_action = "stationary_work_order_print5";
										  } elseif ($stationary_format_ids[0] == 137) {
											  $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
											  $report_action = "stationary_work_order_print4";
										  } elseif ($stationary_format_ids[0] == 430) {
											  $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*1';
											  $report_action = "stationary_work_order_po_print2";
										  } elseif ($stationary_format_ids[$booking_id] == 732) {
											  $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
											  $report_action = "stationary_work_order_po_print";
										  } elseif ($stationary_format_ids[0] == 134) {
											  $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
											  $report_action = "stationary_work_print";
										  } else {
											  $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
											  $report_action = "stationary_work_print";
										  }
										  $report_path = "../../commercial/work_order/requires/stationary_work_order_controller";
									  }
									  else if(in_array($row[csf('item_category')], explode(',', '8,9,10,15,16,17,18,19,20,21,22,32,34,36,35,37,38,39,33,40,41,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,89,90,91,92,93,94')))
									  {
										  if($spare_format_ids[0]==84)
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"];
											  $report_action="spare_parts_work_order_print2";
										  }
										  elseif($spare_format_ids[0]==85)
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
											  $report_action="spare_parts_work_order_print3";
										  }
										  elseif($spare_format_ids[0]==732)
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
											  $report_action="spare_parts_work_order_po_print";
										  }
										  elseif($spare_format_ids[0]==137)
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"].'*5';
											  $report_action="spare_parts_work_print";
										  }
										  elseif($spare_format_ids[0]==129)
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"].'*6';
											  $report_action="spare_parts_work_print";
										  }
										  elseif($spare_format_ids[0]==134)
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
											  $report_action="spare_parts_work_order_po_print";
										  }
										  elseif($spare_format_ids[0]==191)
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"].'*7';
											  $report_action="spare_parts_work_print_urmi";
										  }
										  elseif($spare_format_ids[0]==227)
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"].'*7';
											  $report_action="spare_parts_work_order_print8";
										  }
										  elseif($spare_format_ids[0]==235)
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
											  $report_action="spare_parts_work_order_print9";
										  }
										  elseif($spare_format_ids[0]==274)
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
											  $report_action="spare_parts_work_order_print10";
										  }
										  elseif($spare_format_ids[0]==354)
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"];
											  $report_action="spare_parts_work_print_8";
										  }
										  elseif($spare_format_ids[0]==430)
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"];
											  $report_action="spare_parts_work_order_po_print2";
										  }
										  else
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"];
											  $report_action="spare_parts_work_print";
										  }
										  $report_path="../../commercial/work_order/requires/spare_parts_work_order_controller";
									  }
									  else if(in_array($row[csf('item_category')], explode(',', '5,6,7,23')))
									  {
										  if($dnc_format_ids[0]==78)
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Dyes And Chemical Purchase Order*1';
											  $report_action="dyes_chemical_work_print";
										  }
										  elseif($dnc_format_ids[0]==84)
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Dyes And Chemical Purchase Order*1';
											  $report_action="dyes_chemical_work_print2";
										  }
										  elseif($dnc_format_ids[0]==732)
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Dyes And Chemical Purchase Order*1';
											  $report_action="dyes_chemical_work_po_print";
										  }
										  elseif($dnc_format_ids[0]==85)
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Dyes And Chemical Purchase Order*1';
											  $report_action="dyes_chemical_work_print3";
										  }
										  elseif($dnc_format_ids[0]==430)
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Dyes And Chemical Purchase Order*1';
											  $report_action="dyes_chemical_work_po_print2";
										  }
										  else
										  {
											  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Dyes And Chemical Purchase Order*1';
											  $report_action="dyes_chemical_work_print";
										  }
										  $report_path="../../commercial/work_order/requires/dyes_and_chemical_work_order_controller";
									  }
									  $html.='<td   class="wrd_brk" align="center"> '.$booking_no.'</td>';
								  }elseif($basis == 7){ //req
									  $html.='<td  class="wrd_brk" align="center"> '.$booking_no.'</td>';
								  }else{
									  $html.='<td   class="wrd_brk" align="center">'.$booking_no.'</td>';
								  }
							 }
							 else if($row[csf("transaction_type")]==2  || $row[csf("transaction_type")]==3)
							 {
								 if($issue_num_arr[$row[csf('rec_issue_id')]]["booking_id"] != ''){
									 $basis = $receive_num_arr[$issue_num_arr[$row[csf('rec_issue_id')]]["booking_id"]]['receive_basis'];
									 $booking_no = $issue_num_arr[$row[csf('rec_issue_id')]]["booking_no"];
									 $booking_id = $issue_num_arr[$row[csf('rec_issue_id')]]["booking_id"];
									 if($basis == 1 && $booking_no != ''){ //pi
									  $html.='<td   class="wrd_brk" align="center"><a href="javascript:void(0)" onClick="pi_report_generate('.$booking_id.')">'.$booking_no.'</a></td>';
									 }
									 elseif($basis == 2 && $booking_no != ''){
										 if($row[csf('item_category')] == 11 || $row[csf('item_category')] == 4) {
											  if ($stationary_format_ids[0] == 66) {
												  $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
												  $report_action = "stationary_work_order_print";
											  } elseif ($stationary_format_ids[0] == 85) {
												  $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
												  $report_action = "stationary_work_order_print3";
											  } elseif ($stationary_format_ids[0] == 129) {
												  $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
												  $report_action = "stationary_work_order_print5";
											  } elseif ($stationary_format_ids[0] == 137) {
												  $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
												  $report_action = "stationary_work_order_print4";
											  } elseif ($stationary_format_ids[0] == 430) {
												  $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*1';
												  $report_action = "stationary_work_order_po_print2";
											  } elseif ($stationary_format_ids[0] == 732) {
												  $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
												  $report_action = "stationary_work_order_po_print";
											  } elseif ($stationary_format_ids[0] == 134) {
												  $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
												  $report_action = "stationary_work_print";
											  } else {
												  $report_data = $cbo_company_name . '*' . $select_non_order_report_data[$booking_id]["wo_number"] . '*' . $select_non_order_report_data[$booking_id]["item_category_id"] . '*' . $select_non_order_report_data[$booking_id]["supplier_id"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["wo_date"]) . '*' . $select_non_order_report_data[$booking_id]['currency_id'] . '*' . $select_non_order_report_data[$booking_id]["wo_basis_id"] . '*' . $select_non_order_report_data[$booking_id]["pay_mode"] . '*' . $select_non_order_report_data[$booking_id]["source"] . '*' . change_date_format($select_non_order_report_data[$booking_id]["delivery_date"]) . '*' . $select_non_order_report_data[$booking_id]["attention"] . '*****' . $select_non_order_report_data[$booking_id]["id"] . '*Stationary Purchase Order*' . $select_non_order_report_data[$booking_id]["location_id"] . '*1';
												  $report_action = "stationary_work_print";
											  }
											 $report_path = "../../commercial/work_order/requires/stationary_work_order_controller";
										 }
										 else if(in_array($row[csf('item_category')], explode(',', '8,9,10,15,16,17,18,19,20,21,22,32,34,36,35,37,38,39,33,40,41,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,89,90,91,92,93,94')))
										 {
											  if($spare_format_ids[0]==84)
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"];
												  $report_action="spare_parts_work_order_print2";
											  }
											  elseif($spare_format_ids[0]==85)
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
												  $report_action="spare_parts_work_order_print3";
											  }
											  elseif($spare_format_ids[0]==732)
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
												  $report_action="spare_parts_work_order_po_print";
											  }
											  elseif($spare_format_ids[0]==137)
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"].'*5';
												  $report_action="spare_parts_work_print";
											  }
											  elseif($spare_format_ids[0]==129)
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"].'*6';
												  $report_action="spare_parts_work_print";
											  }
											  elseif($spare_format_ids[0]==134)
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
												  $report_action="spare_parts_work_order_po_print";
											  }
											  elseif($spare_format_ids[0]==191)
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"].'*7';
												  $report_action="spare_parts_work_print_urmi";
											  }
											  elseif($spare_format_ids[0]==227)
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"].'*7';
												  $report_action="spare_parts_work_order_print8";
											  }
											  elseif($spare_format_ids[0]==235)
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
												  $report_action="spare_parts_work_order_print9";
											  }
											  elseif($spare_format_ids[0]==274)
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Others Purchase Order*'.$select_non_order_report_data[$booking_id]["wo_number"].'*'.$select_non_order_report_data[$booking_id]["wo_date"].'*'.$select_non_order_report_data[$booking_id]["location_id"];
												  $report_action="spare_parts_work_order_print10";
											  }
											  elseif($spare_format_ids[0]==354)
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"];
												  $report_action="spare_parts_work_print_8";
											  }
											  elseif($spare_format_ids[0]==430)
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"];
												  $report_action="spare_parts_work_order_po_print2";
											  }
											  else
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Others Purchase Order*'.$select_non_order_report_data[$booking_id]["location_id"];
												  $report_action="spare_parts_work_print";
											  }
											 $report_path="../../commercial/work_order/requires/spare_parts_work_order_controller";
										 }
										 else if(in_array($row[csf('item_category')], explode(',', '5,6,7,23')))
										 {
											  if($dnc_format_ids[0]==78)
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Dyes And Chemical Purchase Order*1';
												  $report_action="dyes_chemical_work_print";
											  }
											  elseif($dnc_format_ids[0]==84)
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Dyes And Chemical Purchase Order*1';
												  $report_action="dyes_chemical_work_print2";
											  }
											  elseif($dnc_format_ids[0]==732)
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Dyes And Chemical Purchase Order*1';
												  $report_action="dyes_chemical_work_po_print";
											  }
											  elseif($dnc_format_ids[0]==85)
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Dyes And Chemical Purchase Order*1';
												  $report_action="dyes_chemical_work_print3";
											  }
											  elseif($dnc_format_ids[0]==430)
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'**Dyes And Chemical Purchase Order*1';
												  $report_action="dyes_chemical_work_po_print2";
											  }
											  else
											  {
												  $report_data= $cbo_company_name.'*'.$select_non_order_report_data[$booking_id]["id"].'*Dyes And Chemical Purchase Order*1';
												  $report_action="dyes_chemical_work_print";
											  }
											 $report_path="../../commercial/work_order/requires/dyes_and_chemical_work_order_controller";
										 }
										 $html.='<td   class="wrd_brk"  align="center"><a href="javascript:void(0)" onClick="print_report(\''.$report_data.'\',\''.$report_action.'\',\''.$report_path.'\')">'.$booking_no.'</a></td>';
									 }elseif($basis == 7){ //req
									  $html.='<td   class="wrd_brk"  align="center"><a href="javascript:void(0)" onClick="req_report_generate('.$reqReportFormat.','.$booking_id.','.str_replace("'","",$cbo_company_name).',\'\',1,'.$req_location_arr[$booking_id].')">'.$booking_no.'</a></td>';
									 }else{
									  $html.='  class="wrd_brk"  align="center">'.$booking_no.'</td>';
									 }
								 }else{
								  $html.= "<td   class='wrd_brk'>".$issue_num_arr[$row[csf('rec_issue_id')]]["booking_no"]."</td>";
								 }
							 }else{
							  $html.= "<td></td>";
							 }
						  $html.='<td  class="wrd_brk">'.$item_category[$row[csf("item_category")]].'</td>
						  <td  class="wrd_brk">'.$supplier_arr[$row[csf("supplier_id")]].'</td>
						  <td  class="wrd_brk">';
						  if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4)
						  {
							  $html.= $receive_num_arr[$row[csf('rec_issue_id')]]["challan_no"];
						  }
						  else if($row[csf("transaction_type")]==2  || $row[csf("transaction_type")]==3)
						  {
							  $html.= $issue_num_arr[$row[csf('rec_issue_id')]]["challan_no"];
						  }
						  else if($row[csf("transaction_type")]==5 || $row[csf("transaction_type")]==6)
						  {
							  $html.= $transfer_num_arr[$row[csf('rec_issue_id')]]["challan_no"];
						  }
						  $html.='</td>';
						  if($rptType==1 || $rptType==2)
						  {
							  $html.='<td  class="wrd_brk">';
							  $receive_num_arr[$row[csf('rec_issue_id')]]["challan_date"];
							  if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4)
							  {
								  $html.= $receive_num_arr[$row[csf('rec_issue_id')]]["challan_date"];
							  }
							  $html.= '</td>';
						  }
						  if($rptType==2)
						  {
							  $html.='<td  class="wrd_brk">'.$receive_basis_arr[$row[csf("receive_basis")]].'</td>';
						  }
						  $html.='<td  class="wrd_brk">';
						  if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4)
						  {
							  //$req_book_no=$row[csf('rec_issue_id')];
							  if($receive_num_arr[$row[csf('rec_issue_id')]]["receive_basis"]==7)
							  {
								  $req_book_no=$requisiton_arr[$receive_num_arr[$row[csf('rec_issue_id')]]["booking_id"]];
							  }
							  else if ($receive_num_arr[$row[csf('rec_issue_id')]]["receive_basis"]==2)
							  {
								  //$req_book_no=$receive_num_arr[$row[csf('rec_issue_id')]]["booking_no"];
								  //$req_book_no=$wo_arr[$receive_num_arr[$row[csf('rec_issue_id')]]["booking_id"]]['wo_number'];

								  //$requ_no=$wo_arr[$row[csf("booking_id")]]['requ_no'];
								  $requ_no=$wo_arr[$receive_num_arr[$row[csf('rec_issue_id')]]["booking_id"]]['requ_no'];
								  $reqs=explode(",", rtrim($requ_no,','));
								  //print_r($reqs);
								  $req_book_no='';
								  foreach($reqs as $val)
								  {
									  $req_book_no.=$reqisition_data[$val]['requ_no'].", ";
								  }
								  $req_book_no=rtrim($req_book_no,', ');

							  }
							  else
							  {
								  $req_book_no="";
							  }
						  }
						  else if($row[csf("transaction_type")]==2  || $row[csf("transaction_type")]==3)
						  {
							  $req_book_no=$issue_num_arr[$row[csf('rec_issue_id')]]["req_no"];
						  }
						  else if($row[csf("transaction_type")]==5  || $row[csf("transaction_type")]==6)
						  {
							  $req_book_no=$transfer_num_arr[$row[csf('rec_issue_id')]]["req_no"]."_";
						  }
						  $html.= $req_book_no.'</td>';
						  if($rptType==2)
						  {
							  $html.='<td  align="center">';
							  if($row[csf("receive_basis")]==1)
							  {
								  $html.= $pi_num_arr[$row[csf("booking_id")]];
							  }
							  else if($row[csf("receive_basis")]==2)
							  {
								  $html.= $wo_arr[$row[csf("booking_id")]]['wo_number'];
								  //requ_no
							  }
							  $html.='</td>';
						  }
						  else if($rptType==3)
						  {
							  $html.='<td  align="center" class="wrd_brk">'.$lib_division_arr[$row[csf("division_id")]].'</td>
							  <td  align="center" class="wrd_brk">'.$department_arr[$row[csf("department_id")]].'</td>
							  <td  align="center" class="wrd_brk">'.$section_arr[$row[csf("section_id")]].'</td>';
						  }

						  $html.='<td  class="wrd_brk" >'.$group_arr[$row[csf('item_group_id')]].'</td>
						  <td  align="center" class="wrd_brk">'. $unit_of_measurement[$row[csf("cons_uom")]].'</td>
						  <td class="wrd_brk" >'.$row[csf('sub_group_name')].'</td>
						  <td  class="wrd_brk">'.$row[csf('item_description')].'</td>
						  <td  class="wrd_brk" >'.$row[csf('item_code')].'</td>';
						  if($rptType==3 || $rptType==1 )
						  {
							  $html.='<td  class="wrd_brk" >'.$machine_category[$row[csf('machine_category')]].'</td>
							  <td  class="wrd_brk" >'.$floor_arr[$row[csf('floor_id')]].'</td>
							  <td  class="wrd_brk" >'.$iss_floor_arr[$row[csf('production_floor')]].'</td>
							  <td  class="wrd_brk">'.$machine_arr[$row[csf('machine_id')]].'</td>';
						  }
						  $html.='<td  class="wrd_brk">'.$row[csf('item_size')].'</td>';
						  if($rptType==2 || $rptType==1 )
						  {
							  $html.='<td  align="center" class="wrd_brk">';
							  if($row[csf("transaction_type")]==1) $html.= $currency[$receive_num_arr[$row[csf('rec_issue_id')]]["currency_id"]];
							  $html.='</td><td  align="right" class="wrd_brk">';
							  if($row[csf("transaction_type")]==1) $html.= number_format($receive_num_arr[$row[csf('rec_issue_id')]]["exchange_rate"],2);
							  $html.='</td><td  align="right" class="wrd_brk">';
							  if($row[csf("transaction_type")]==1) $html.= number_format($row[csf('order_rate')],2);
							  $html.='</td><td align="right">'; $tot_rate=$tot_rate+$row[csf('order_rate')];
							  $html.= number_format($row[csf("receive_qty")],2); $total_receive +=$row[csf("receive_qty")];
							  $html.='</td><td  align="right" class="wrd_brk">';
							  if($row[csf("transaction_type")]==1) $order_amt=$row[csf('order_qnty')]*$row[csf('order_rate')]; $html.= "was".number_format($order_amt,4); $total_order_amt+=$order_amt; $order_amt=0;
							  $html.='</td>';
						  }
						  if($rptType==3 || $rptType==1 )
						  {
							  $html.='<td  align="right" class="wrd_brk">'.number_format($row[csf("issue_qty")],2).'</td>
							  <td  align="right" class="wrd_brk">'.number_format($rtn_qry_arr[$row[csf("rec_issue_id")]][$row[csf("prod_id")]]["RTN_QNTY"],2).'</td>';
							  $total_issue +=$row[csf("issue_qty")];
							  $total_return_qnty +=$rtn_qry_arr[$row[csf("rec_issue_id")]][$row[csf("prod_id")]]["RTN_QNTY"];
							  //$row[csf("return_qnty")];
							  if($row[csf("issue_qty")] == 0){
								  $row[csf("cons_rate")] = 0;
								  $row[csf("cons_amount")] = 0;
							  }
						  }
						  $html.='<td  align="right" class="wrd_brk">'.number_format($row[csf("cons_rate")],2).'</td>
						  <td align="right" class="wrd_brk"  style="padding-right:3px">'.number_format($row[csf("cons_amount")],2); $total_amount +=$row[csf("cons_amount")]; $others_total_amount2=$others_total_amount2+$row[csf("cons_amount")]; 
						  if($rptType==3 || $rptType==1 )
						  {
							  $html.='<td  class="wrd_brk">'.$department_arr[$row[csf("department_id")]].'</td>';
						  }
						  $html.='<td  class="wrd_brk">'.$user_name_arr[$row[csf("inserted_by")]].'</td>
						  <td class="wrd_brk">'.change_date_format($row[csf("insert_date")]).' '.$row[csf("insert_time")].'</td>';
						  if($rptType==2)
						  {
							  $html.='<td  class="wrd_brk">'.$row[csf("remarks")].'</td>';
						  }
						  if($rptType==3)
						  {
							  $html.='<td  class="wrd_brk">'.$use_for[$row[csf("use_for")]].'</td>
							  <td  class="wrd_brk">'.$row[csf("remarks")].'</td>';
						  }
						  $html.='</tr>';
					  $item_wise_qty_arr[$row[csf('item_group_id')]][$row[csf('item_description')]]['recv']+=$row[csf("receive_qty")];
					  $item_wise_qty_arr[$row[csf('item_group_id')]][$row[csf('item_description')]]['recv_amt']+=$row[csf('order_qnty')]*$row[csf('order_rate')];
					  $item_wise_qty_arr[$row[csf('item_group_id')]][$row[csf('item_description')]]['issue']+=$row[csf("issue_qty")];
					  $item_wise_qty_arr[$row[csf('item_group_id')]][$row[csf('item_description')]]['issue_amt']+=$row[csf("cons_amount")];
					  $i++;
				  }
				  //print_r($item_wise_qty_arr);
				  $html.='</tbody>
			  </table>

			<table>
						<tfoot>
							<tr>
								<th ></th>
								<th ></th>
								<th ></th>
								<th ></th>
								<th ></th>
								';
                                if($rptType==3)
								{
									$html.='<th ></th>';
								}
								$html.='<th  ></th>
								<th  "></th>
								<th  ></th>
								<th  ></th>';
								if($rptType==1 || $rptType==2)
								{
									$html.='<th  ></th>';
								}
								if($rptType==2)
								{
									$html.='<th  ></th>';
								}
								$html.='<th  ></th>';
								if($rptType==2)
								{
									$html.='<th  "></th>';
								}
								else if($rptType==3)
								{
									$html.='<th></th>
									<th></th>
									<th></th>';
								}

								$html.='<th></th>
								<th></th>
								<th></th>
								<th></th>
								<th></th>';
								if($rptType==3 || $rptType==1 )
								{
									$html.='<th></th>
									<th></th>
									<th></th>
									<th></th>';
								}
								$html.='<th>';
								if($rptType==3) $html.= "Total:";
								$html.='</th>';
								if($rptType==2 || $rptType==1 )
								{
									$html.='<th></th>									
									<th>Total:</th>
									<th>
									'.number_format($tot_rate,2).'</th>
									<th>'.number_format($total_receive,2).'</th>
									<th >&nbsp;</th>';
								}
								if($rptType==3 || $rptType==1 )
								{
									$html.='<th>'.number_format($total_issue,2).'</th>
									<th>'.number_format($total_return_qnty,2).'</th>';
								}
								$html.='<th></th>
								<th>'.number_format($others_total_amount2,2).'</th>';
								if($rptType==3 || $rptType==1 )
								{
									$html.='<th></th>';
								}
								$html.='<th></th>
								<th></th>';
								if($rptType==2)
								{
									$html.='<th></th>';
								}
								if($rptType==3)
								{
									$html.='<th></th>
									<th></th>';
								}
								$html.='</tr>
						</tfoot>
			</table>
					 
				 </div>';
			if($cbo_item_cat==11)
			{
				$html.='<table>
				<caption>Item Summary</caption>
				<thead>
					<tr>
					<th>SL</th>
					<th>Item Group</th>
					<th>Item Desc.</th>';
					if($rptType==2 || $rptType==1 )
					{
						$html.='<th>Rcv Qty</th>
						<th>Rate(TK)</th>
						<th>Amount</th>';
					}
					if($rptType==3 || $rptType==1 )
					{
						$html.='<th>Issue Qty</th>
						<th>Rate(TK)</th>
						<th>Amount</th>';
					}
					$html.='</tr>
				</thead>';
				$k=1;$total_rec_qty=0;$total_rec_amt=0;$total_issue_qty=0;$total_issue_amt=0;
				foreach($item_wise_qty_arr as $item_key=>$item_data)
				{
					foreach($item_data as $desc_key=>$desc_value)
					{
						$html.='<tr>
							<td>'.$k.'</td>
							<td> '.$group_arr[$item_key].'</td>
							<td>'.$desc_key.'</td>';
							if($rptType==2 || $rptType==1 )
							{
								$html.='<td>'.number_format($desc_value['recv'],2).' </td>
								<td> '.number_format($desc_value['recv_amt']/$desc_value['recv'],2).'</td>
								<td>'.number_format($desc_value['recv_amt'],2).' </td>';
							}
							if($rptType==3 || $rptType==1 )
							{

								$html.='<td>'.$desc_value['issue'].' </td>
								<td>'.number_format($desc_value['issue_amt']/$desc_value['issue'],2).' </td>
								<td>'.number_format($desc_value['issue_amt'],2).' </td>';
							}
						$html.='</tr>';
						$total_rec_qty+=$desc_value['recv'];
						$total_rec_amt+=$desc_value['recv_amt'];
						$total_issue_qty+=$desc_value['issue'];
						$total_issue_amt+=$desc_value['issue_amt'];
						$k++;
					}
				}
				$html.='<tfoot>
					<td> </td>
					<td> </td>
					<td> </td>';
					if($rptType==2 || $rptType==1 )
					{
						$html.='<td>'.number_format($total_rec_qty,2).'</td>
						<td>  </td>
						<td>'.number_format($total_rec_amt,2).'</td>';
					}
					if($rptType==3 || $rptType==1 )
					{
						$html.='<td>'.number_format($total_issue_qty,2).'</td>
						<td> </td>
						<td>'.number_format($total_issue_amt,2).'</td>';
					}
					$html.='</tfoot>
				</table>';
			}
			$html.='</div>';
		}else{
			$show_html_other = 0;
		}
	}

	if($show_html_other==0 && $show_html_1==0 && $show_html_13==0 && $show_html_2==0 && $show_html_4 ==0)
	{
		$html.='<table>
		<tbody>
		<tr>
			<td>No Data Found </td>
		</tr>
		</tbody>
		</table>';
	}

    // execute_query("delete from gbl_temp_engine where user_id=$user_id and entry_form=33 and ref_from in(1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40)");
    // oci_commit($con); disconnect($con);

	foreach (glob("bwffsr_$user_id*.xlsx") as $filename) {
		@unlink($filename);
	}
	$name=time();
	$filename='bwffsr_'.$user_id."_".$name.".xlsx";
	//echo "$html2####$filename"; die;
	//echo $filename;die;

	$reader = new \PhpOffice\PhpSpreadsheet\Reader\Html();
	$spreadsheet = $reader->loadFromString($html);

	$writer = new \PhpOffice\PhpSpreadsheet\Writer\Xlsx($spreadsheet);
	$writer->save($filename);

	//header('Content-Type: application/x-www-form-urlencoded');
	//header('Content-Transfer-Encoding: Binary');
	//header("Content-disposition: attachment; filename=\"".$filename."\"");

    echo "$html####$filename####$return_item_cat####$rptType";
    disconnect($con);
	exit();
}

if($action=="pi_print_report")
{
    $getPiDetails = sql_select("select id, item_category_id, importer_id, entry_form from com_pi_master_details where id = $data");
    if(count($getPiDetails) > 0){
        $data = $getPiDetails[0][csf("importer_id")]."*".$getPiDetails[0][csf("id")]."*".$getPiDetails[0][csf("entry_form")]."*".$getPiDetails[0][csf("item_category_id")]."*";
    }else{
       die();
    }
    $data = explode('*',$data);
    $entryForm=$data[2];
    $cbo_item_category_id=$data[3];
    $is_mail_send=$data[4];
    $company_id=$data[0];

    //echo $is_mail_send;die;
    //print_r($data); die;
    ob_start();

    if($data[3] == 'PI Approval New'){
        echo load_html_head_contents($data[3],"../", 1, 1, $unicode,'','');
    }else{
        echo load_html_head_contents($data[3],"../../", 1, 1, $unicode,'','');
    }
    $country_arr=return_library_array( "select id,country_name from lib_country", "id", "country_name");
    $sql_company = sql_select("SELECT * FROM lib_company WHERE id=$data[0] and is_deleted=0 and status_active=1");
    $supplier_name_library = return_library_array('SELECT id,supplier_name FROM lib_supplier','id','supplier_name');
    $importer_name_library = return_library_array('SELECT id,company_name FROM lib_company','id','company_name');
    foreach($sql_company as $company_data)
    {
        if($company_data[csf('plot_no')]!='')$plot_no = 'Plot No.#'.$company_data[csf('plot_no')].','.' ';else $plot_no='';
        if($company_data[csf('level_no')]!='')$level_no = 'Level No.#'.$company_data[csf('level_no')].','.' ';else $level_no='';
        if($company_data[csf('road_no')]!='')$road_no = 'Road No.#'.$company_data[csf('road_no')].','.' ';else $road_no='';
        if($company_data[csf('block_no')]!='')$block_no = 'Block No.#'.$company_data[csf('block_no')].','.' ';else $block_no='';
        if($company_data[csf('city')]!='')$city = $company_data[csf('city')].','.' ';else $city='';
        if($company_data[csf('zip_code')]!='')$zip_code = '-'.$company_data[csf('zip_code')].','.' ';else $zip_code='';
        if($company_data[csf('country_id')]!=0)$country = $country_arr[$company_data[csf('country_id')]].','.' ';else $country='';

        $company_address = $plot_no.$level_no.$road_no.$block_no.$city.$zip_code.$country;
    }
    $approvedBy_arr = return_library_array("select mst_id, approved_by from approval_history where mst_id=$data[1] and entry_form in(21,27) ORDER BY id ASC","mst_id","approved_by");
    $userName_arr = return_library_array("select id, user_full_name from user_passwd","id","user_full_name");
    $user_library=return_library_array( "select id,user_full_name from user_passwd", "id", "user_full_name" );
    $buyer_library_arr=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name" );



    ?>
    <div style="width:1000px">
        <?
        $cbo_pi_basis_id='';
        $sql_mst = sql_select("select id, item_category_id, importer_id, supplier_id, pi_number, pi_date, last_shipment_date, pi_validity_date, currency_id, source, hs_code, internal_file_no, intendor_name, pi_basis_id, remarks, import_pi, within_group, approved, total_amount, upcharge, discount, net_total_amount,inserted_by, goods_rcv_status, pay_term, tenor, location_id, pi_for from com_pi_master_details where id= $data[1]");
    //        echo "select id, item_category_id, importer_id, supplier_id, pi_number, pi_date, last_shipment_date, pi_validity_date, currency_id, source, hs_code, internal_file_no, intendor_name, pi_basis_id, remarks, import_pi, within_group, approved, total_amount, upcharge, discount, net_total_amount,inserted_by, goods_rcv_status, pay_term, tenor, location_id, pi_for from com_pi_master_details where id= $data[1]";
        $total_amount=$sql_mst[0][csf("total_amount")];
        $upcharge=$sql_mst[0][csf("upcharge")];
        $discount=$sql_mst[0][csf("discount")];
        $goods_rcv_status=$sql_mst[0][csf("goods_rcv_status")];
        $net_total_amount=$sql_mst[0][csf("net_total_amount")];
        $pi_basis_id=$sql_mst[0][csf("pi_basis_id")];
        $pi_location_name=return_field_value("location_name","lib_location","id='".$sql_mst[0][csf("location_id")]."'");
        $inserted_by=$sql_mst[0][csf("inserted_by")];

        $i = 0; $total_ammount = 0;

        //  echo $sql_mst[0][csf('import_pi')]; die;
        if($sql_mst[0][csf('import_pi')]==1)
        {
            ?>
            <div style="margin-left:10px">
                <table width="100%">
                    <tr>
                        <td style="font-size:20px;" align="center" colspan="6">
                            <strong>
                                <?
                                if($sql_mst[0][csf('within_group')]==1)
                                {
                                    $buyer=$importer_name_library[$sql_mst[0][csf('importer_id')]];
                                    $address=$company_address;
                                }
                                else
                                {
                                    $buyer=return_field_value("buyer_name","lib_buyer","id='".$sql_mst[0][csf('importer_id')]."'");
                                    $buyerData=sql_select("select buyer_name, address_1 from lib_buyer where id='".$sql_mst[0][csf('importer_id')]."'");

                                    $buyer=$buyerData[0][csf('buyer_name')];
                                    $address=$buyerData[0][csf('address_1')];
                                }
                                echo $buyer;
                                ?>
                            </strong>
                        </td>
                    </tr>
                    <tr>
                        <td width="100" align="right">From</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td width="200"><? echo $importer_name_library[$sql_mst[0][csf('supplier_id')]]; ?></td>
                        <td width="100">PI No:</td>
                        <td width="250"><? echo $sql_mst[0][csf('pi_number')];?></td>
                        <td width="150">Within Group:</td>
                        <td><? echo $yes_no[$sql_mst[0][csf('within_group')]];?></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td rowspan="3"><? echo $address ;?></td>
                        <td>PI Date:</td>
                        <td><? echo change_date_format($sql_mst[0][csf('pi_date')]);?></td>
                        <td>Last Shipment Date:</td>
                        <td><? echo change_date_format($sql_mst[0][csf('last_shipment_date')]);?></td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>Currency:</td>
                        <td><? echo $currency[$sql_mst[0][csf('currency_id')]];?></td>
                        <td>Validity:</td>
                        <td><? echo change_date_format($sql_mst[0][csf('pi_validity_date')]);?></td>
                    </tr>
                    <tr>
                        <td>Pay Term</td>
                        <td><? echo $sql_mst[0][csf('pay_term')];?></td>
                        <td>Tenor</td>
                        <td><? echo $sql_mst[0][csf('tenor')];?></td>
                    </tr>
                    <tr>
                        <td>Insert By:</td>
                        <td><? echo $user_library[$sql_mst[0][csf('inserted_by')]];?></td>
                        <td>Remarks</td>
                        <td><? echo $sql_mst[0][csf('remarks')];?></td>
                    </tr>
                    <tr>
                        <td colspan="5" style="text-align:center; color:#FF0000; font-weight:bold; font-size:16px;"><? if($sql_mst[0][csf('approved')]==1) echo "Approved"; elseif($sql_mst[0][csf('approved')]==3) echo "Partial Approved"; else echo "&nbsp;"; ?></td>
                    </tr>
                </table>
                <br>
                <table class="rpt_table" width="100%" cellspacing="1" rules="all" border="1">
                    <thead>
                    <th style="width: 150px;">Job No</th>
                    <th style="width: 150px;">Construction</th>
                    <th style="width: 150px;">Composition</th>
                    <th style="width: 100px;">Color</th>
                    <th style="width: 50px;">GSM</th>
                    <th style="width: 80px;">Dia/Width</th>
                    <th style="width: 100px;">Item Size</th>
                    <th style="width: 50px;">UOM</th>
                    <th style="width: 100px;">Quantity</th>
                    <th style="width: 70px;">Rate</th>
                    <th>Amount</th>
                    </thead>
                    <tbody>
                    <?
                    $color_library=return_library_array( "select id,color_name from lib_color", "id", "color_name" ); $total_ammount = 0; $total_quantity=0;
                    if($goods_rcv_status==2)
                    {
                        $sql = "select id, work_order_no, color_id, fabric_construction as construction, fabric_composition as composition, gsm, dia_width, uom, quantity, rate, amount, item_prod_id,item_size from com_pi_item_details where pi_id='$data[1]' and quantity>0 and status_active=1 and is_deleted=0";
                    }
                    else
                    {
                        if($db_type==0)
                        {
                            $sql = "select group_concat(id) as id, work_order_no, color_id, fabric_construction as construction, fabric_composition as composition, gsm, dia_width, uom, sum(quantity) as quantity, avg(rate) as rate, sum(amount) as amount, item_prod_id ,item_size from com_pi_item_details where pi_id='$data[1]' and quantity>0 and status_active=1 and is_deleted=0 group by work_order_no, color_id, fabric_construction, fabric_composition, gsm, dia_width, uom, item_prod_id ,item_size";
                        }
                        else
                        {
                            $sql = "select rtrim(xmlagg(xmlelement(e,id,',').extract('//text()') order by id).GetClobVal(),',') AS id , work_order_no, color_id, fabric_construction as construction, fabric_composition as composition, gsm, dia_width, uom, sum(quantity) as quantity, avg(rate) as rate, sum(amount) as amount, item_prod_id ,item_size  from com_pi_item_details where pi_id='$data[1]' and quantity>0 and status_active=1 and is_deleted=0 group by work_order_no, color_id, fabric_construction, fabric_composition, gsm, dia_width, uom, item_prod_id,item_size";
                        }
                    }
                    // echo $sql;
                    $data_array=sql_select($sql);
                    foreach($data_array as $row)
                    {
                        ?>
                        <tr>
                            <td style="word-break: break-all;"><? echo $row[csf('work_order_no')]; ?></td>
                            <td style="word-break: break-all;"><? echo $row[csf('construction')]; ?></td>
                            <td style="word-break: break-all;"><? echo $row[csf('composition')]; ?></td>
                            <td style="word-break: break-all;"><? echo $color_library[$row[csf('color_id')]]; ?></td>
                            <td style="word-break: break-all;"><? echo $row[csf('gsm')]; ?></td>
                            <td style="word-break: break-all;"><? echo $row[csf('dia_width')]; ?></td>
                            <td style="word-break: break-all;"><? echo $row[csf('item_size')]; ?></td>
                            <td style="word-break: break-all;"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
                            <td style="word-break: break-all;" align="right"><? echo number_format($row[csf('quantity')],2); $total_quantity += $row[csf('quantity')]; ?></td>
                            <td style="word-break: break-all;" align="right"><? echo number_format($row[csf('rate')],4); ?></td>
                            <td style="word-break: break-all;" align="right"><? echo number_format($row[csf('amount')],4); $total_ammount += $row[csf('amount')];  ?></td>
                        </tr>
                        <?
                    }
                    ?>
                    <tr class="tbl_bottom" height="25">
                        <td align="right" colspan="8">Sum</td>
                        <td align="right"><? echo number_format($total_quantity,4); ?></td>
                        <td>&nbsp;</td>
                        <td align="right"><? echo number_format($total_ammount,4); ?></td>
                    </tr>

                    <tr class="tbl_bottom" height="25">
                        <td  colspan = "10" align="right">Upcharge</td>
                        <td><? echo number_format($upcharge,4); ?></td>
                    </tr>
                    <tr class="tbl_bottom" height="25">
                        <td  colspan = "10" align="right">Discount</td>
                        <td><? echo number_format($discount,4); ?></td>
                    </tr>
                    <tr class="tbl_bottom" height="25">
                        <td  colspan = "10" align="right">Net Total</td>
                        <td><? echo number_format($net_total_amount,4); ?></td>
                    </tr>
                    </tbody>
                </table>
                <table>
                    <tr height="20"><td></td></tr>
                    <tr>
                        <td valign="top"><strong>In-Words: </strong></td>
                        <td><?

                            if($sql_mst[0][csf('currency_id')]*1==1)
                            {
                                echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Poisa');

                            }
                            else
                            {
                                echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Cent');
                            }
                            ?></td>
                    </tr>
                    <tr height="50"><td></td></tr>
                </table>
                <?
                $approved_sql=sql_select("SELECT  mst_id, approved_by ,min(approved_date) as approved_date  from approval_history where entry_form in(21,27) AND  mst_id =".$data[1]."  group by mst_id, approved_by order by  approved_by ");
                $approved_his_sql=sql_select("SELECT  mst_id, approved_by ,approved_date,un_approved_reason,un_approved_date,approved_no  from approval_history where entry_form in(21,27) AND  mst_id =".$data[1]." order by  approved_no,approved_date");
                $user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
                $user_lib_desg=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
                $designation_lib=return_library_array("SELECT id,custom_designation from lib_designation", "id", "custom_designation");


                ?>
                <? if(count($approved_sql)>0)
                {
                    $sl=1;
                    ?>
                    <div style="margin-top:15px">
                        <table class="rpt_table" border="1" cellpadding="0" cellspacing="0" style="width:850px;text-align:center;" rules="all">
                            <label><b>Pro Forma Invoice Approval Status </b></label>
                            <thead>
                            <tr style="font-weight:bold">
                                <th width="20">SL</th>
                                <th width="250">Name</th>
                                <th width="200">Designation</th>
                                <th width="100">Approval Date</th>
                            </tr>
                            </thead>
                            <? foreach ($approved_sql as $key => $value)
                            {
                                ?>
                                <tr>
                                    <td width="20"><? echo $sl; ?></td>
                                    <td width="250"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                    <td width="200"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                    <td width="100"><? $approved_date=explode(" ",$value[csf("approved_date")]);

                                        echo change_date_format($approved_date[0])." ".$approved_date[1];  ?></td>
                                </tr>
                                <?
                                $sl++;
                            }
                            ?>
                        </table>
                    </div>
                    <?
                }
                ?>
                <? if(count($approved_his_sql) > 0)
                {
                    $sl=1;
                    ?>
                    <div style="margin-top:15px">
                        <table class="rpt_table" border="1" cellpadding="0" cellspacing="0" style="width:850px;text-align:center;" rules="all">
                            <label><b>Pro Forma Invoice Approval / Un-Approval History </b></label>
                            <thead>
                            <tr style="font-weight:bold">
                                <th width="20">SL</th>
                                <th width="150">Approved / Un-Approved</th>
                                <th width="150">Designation</th>
                                <th width="50">Approval Status</th>
                                <th width="150">Reason for Un-Approval</th>
                                <th width="150">Date</th>
                            </tr>
                            </thead>
                            <? foreach ($approved_his_sql as $key => $value)
                            {
                                if($sl%2==0)$bgcolor="#E9F3FF";  else $bgcolor="#FFFFFF";
                                ?>
                                <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                    <td width="20"><? echo $sl; ?></td>
                                    <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                    <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                    <td width="50">Yes</td>
                                    <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                    <td width="150"><? $approved_date=explode(" ",$value[csf("approved_date")]);

                                        echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                </tr>

                                <?
                                $sl++;
                                if($value[csf("un_approved_date")] !='0000-00-00 00:00:00' && $value[csf("un_approved_date")] !='')
                                {
                                    ?>
                                    <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                        <td width="20"><? echo $sl; ?></td>
                                        <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                        <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                        <td width="50">No</td>
                                        <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                        <td width="150"><? $approved_date=explode(" ",$value[csf("un_approved_date")]);

                                            echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                    </tr>
                                    <?
                                    $sl++;
                                }
                            }
                            ?>
                        </table>
                    </div>
                    <?
                }
                ?>
                <!-- //approved status end-->
                <br/>
                <?
                //signature_table($report_id, $company, $width, $template_id,$padding_top=70)

                echo signature_table(147, $data[0],"900px",$data[18]);
                ?>

            </div>
            <?
        }
        else
        {
            //echo $entryForm;die;
            $pi_order_sql=="";$pi_wo_data=array();$pi_wo_check=0;
            if($entryForm==165)//yarn
            {
                $pi_order_sql="select c.id as PO_ID from com_pi_item_details a, wo_non_order_info_dtls b, wo_po_break_down c where a.work_order_dtls_id=b.id and b.job_no=c.job_no_mst and a.item_category_id=1 and b.job_id>0 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.pi_id=$data[1] group by c.id";

                $pi_wo_sql="select a.pi_id, b.id as wo_dtls_id, b.supplier_order_quantity as wo_qnty, b.rate as rate, b.amount as wo_amount from com_pi_item_details a, wo_non_order_info_dtls b where a.work_order_dtls_id=b.id and a.item_category_id=1 and b.job_id>0 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.pi_id=$data[1]";
            }
            else if($entryForm==169) // Services - Yarn Dyeing
            {
                $pi_order_sql="select c.id as PO_ID from com_pi_item_details a, wo_yarn_dyeing_dtls b, wo_po_break_down c where a.work_order_dtls_id=b.id and b.job_no=c.job_no_mst and a.item_category_id=24 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.pi_id=$data[1] group by c.id";

                $pi_wo_sql="select a.pi_id, b.id as wo_dtls_id, b.yarn_wo_qty as wo_qnty, b.dyeing_charge as rate, b.amount as wo_amount from com_pi_item_details a, wo_yarn_dyeing_dtls b where a.work_order_dtls_id=b.id and a.item_category_id=24 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.pi_id=$data[1] ";
            }
            if($entryForm==170) // Services - Embroidery, Services - Printing, Services - Wash
            {
                $pi_order_sql="select b.po_break_down_id as PO_ID from com_pi_item_details a, wo_booking_dtls b where a.work_order_dtls_id=b.id and a.item_category_id=25 and b.booking_type=6 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.pi_id=$data[1] group by b.po_break_down_id ";
                $pi_wo_sql="select a.pi_id, b.id as wo_dtls_id, b.wo_qnty as wo_qnty, b.rate as rate, b.amount as wo_amount from com_pi_item_details a, wo_booking_dtls b where a.work_order_dtls_id=b.id and a.item_category_id=25 and b.booking_type=6 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.pi_id=$data[1] ";
            }
            elseif($entryForm==166) // Knit Finish Fabrics, Woven Fabrics, Grey Fabric(Knit), Grey Fabric(woven)
            {
                $pi_order_sql="select b.po_break_down_id as PO_ID from com_pi_item_details a, wo_booking_dtls b where a.work_order_no=b.booking_no and a.item_category_id in(2,3,13,14) and b.booking_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.pi_id=$data[1] group by b.po_break_down_id ";
                if($cbo_item_category_id==3)
                {
                    //$prev_pi_qty_arr[$row[csf('booking_no')]][$row[csf('body_part_id')]][$row[csf('lib_yarn_count_deter_id')]][$row[csf('fabric_color_id')]][$row[csf('construction')]][$row[csf('copmposition')]][$row[csf('weight')]][$row[csf('fab_weight_type')]][$row[csf('dia_or_width')]][$row[csf('width')]][$row[csf('cutable_width')]][$row[csf('uom')]]
                    $pi_wo_sql="SELECT a.pi_id, b.booking_no, c.body_part_id, c.lib_yarn_count_deter_id, b.fabric_color_id, b.construction, b.copmposition, b.gsm_weight, c.gsm_weight_type, b.dia_width, c.width_dia_type, c.uom, b.id as wo_dtls_id, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as wo_qnty, b.rate as rate, b.amount as wo_amount from com_pi_item_details a, wo_booking_dtls b, wo_pre_cost_fabric_cost_dtls c where a.work_order_no=b.booking_no and b.pre_cost_fabric_cost_dtls_id=c.id and a.item_category_id in(2,3,13,14) and b.booking_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.pi_id=$data[1] group by a.pi_id, b.booking_no, c.body_part_id, c.lib_yarn_count_deter_id, b.fabric_color_id, b.construction, b.copmposition, b.gsm_weight, c.gsm_weight_type, b.dia_width, c.width_dia_type, c.uom, b.id, b.fin_fab_qnty, b.grey_fab_qnty , b.rate, b.amount ";
                    //group by a.id, a.booking_no, b.fabric_color_id, c.construction, c.composition, b.gsm_weight, c.gsm_weight_type, c.width_dia_type, b.dia_width, b.item_size, c.lib_yarn_count_deter_id, c.body_part_id, c.uom
                    //echo $pi_wo_sql;die;
                    $pi_wo_sql_result=sql_select($pi_wo_sql);
                    if(count($pi_wo_sql_result)>0) $pi_wo_check=1;
                    foreach($pi_wo_sql_result as $row)
                    {
                        $pi_wo_data[$row[csf('booking_no')]][$row[csf('body_part_id')]][$row[csf('lib_yarn_count_deter_id')]][$row[csf('fabric_color_id')]][$row[csf('construction')]][$row[csf('copmposition')]][$row[csf('gsm_weight')]][$row[csf('gsm_weight_type')]][$row[csf('dia_width')]][$row[csf('width_dia_type')]][$row[csf('uom')]]['fin_fab_qnty']+=$row[csf('fin_fab_qnty')];
                        $pi_wo_data[$row[csf('booking_no')]][$row[csf('body_part_id')]][$row[csf('lib_yarn_count_deter_id')]][$row[csf('fabric_color_id')]][$row[csf('construction')]][$row[csf('copmposition')]][$row[csf('gsm_weight')]][$row[csf('gsm_weight_type')]][$row[csf('dia_width')]][$row[csf('width_dia_type')]][$row[csf('uom')]]['wo_qnty']+=$row[csf('wo_qnty')];
                        $pi_wo_data[$row[csf('booking_no')]][$row[csf('body_part_id')]][$row[csf('lib_yarn_count_deter_id')]][$row[csf('fabric_color_id')]][$row[csf('construction')]][$row[csf('copmposition')]][$row[csf('gsm_weight')]][$row[csf('gsm_weight_type')]][$row[csf('dia_width')]][$row[csf('width_dia_type')]][$row[csf('uom')]]['wo_amount']+=$row[csf('wo_amount')];
                    }

                }
                else
                {
                    //$prev_pi_qty_arr[$row[csf('booking_no')]][$row[csf('lib_yarn_count_deter_id')]][$row[csf('fabric_color_id')]][$row[csf('construction')]][$row[csf('copmposition')]][$row[csf('gsm_weight')]][$row[csf('dia_width')]][$row[csf('uom')]]
                    $pi_wo_sql="select a.pi_id, b.booking_no, c.lib_yarn_count_deter_id, b.fabric_color_id, b.construction, b.copmposition, b.gsm_weight, b.dia_width, c.uom, b.id as wo_dtls_id, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as wo_qnty, b.rate as rate, b.amount as wo_amount from com_pi_item_details a, wo_booking_dtls b, wo_pre_cost_fabric_cost_dtls c where a.work_order_no=b.booking_no and b.pre_cost_fabric_cost_dtls_id=c.id and a.item_category_id in(2,3,13,14) and b.booking_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.pi_id=$data[1] ";
                    $pi_wo_sql_result=sql_select($pi_wo_sql);
                    if(count($pi_wo_sql_result)>0) $pi_wo_check=1;
                    foreach($pi_wo_sql_result as $row)
                    {
                        $pi_wo_data[$row[csf('booking_no')]][$row[csf('lib_yarn_count_deter_id')]][$row[csf('fabric_color_id')]][$row[csf('construction')]][$row[csf('copmposition')]][$row[csf('gsm_weight')]][$row[csf('dia_width')]][$row[csf('uom')]]['wo_qnty']+=$row[csf('wo_qnty')];
                        $pi_wo_data[$row[csf('booking_no')]][$row[csf('lib_yarn_count_deter_id')]][$row[csf('fabric_color_id')]][$row[csf('construction')]][$row[csf('copmposition')]][$row[csf('gsm_weight')]][$row[csf('dia_width')]][$row[csf('uom')]]['wo_amount']+=$row[csf('wo_amount')];
                    }
                }

            }
            elseif($entryForm==167)//Accessories
            {
                /*$sql_trims=("select a.id, a.booking_no, b.id as dtls_id, b.trim_group, b.uom, c.description, c.rate, c.color_number_id, c.item_color, c.gmts_sizes as size_id, c.item_size, c.brand_supplier, sum(c.cons) as qnty from wo_booking_mst a, wo_booking_dtls b, wo_trim_book_con_dtls c where a.booking_no=b.booking_no and b.id=c.wo_trim_booking_dtls_id $booking_ids_cond and c.cons>0 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and  c.is_deleted=0
                group by a.id, a.booking_no, b.id, b.trim_group, b.uom, c.description, c.rate, c.color_number_id, c.item_color, c.gmts_sizes, c.item_size, c.brand_supplier");*/

                $pi_order_sql="select b.po_break_down_id as PO_ID from com_pi_item_details a, wo_booking_dtls b where a.work_order_dtls_id=b.id and a.item_category_id=4 and b.booking_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.pi_id=$data[1] group by b.po_break_down_id ";

                $pi_wo_sql="select a.pi_id, b.id as wo_dtls_id, b.trim_group, b.uom, c.description, c.rate, c.color_number_id, c.item_color, c.gmts_sizes as size_id, c.item_size, c.brand_supplier, c.cons as wo_qnty, c.rate as rate, c.amount as wo_amount from com_pi_item_details a, wo_booking_dtls b, wo_trim_book_con_dtls c where a.work_order_dtls_id=b.id and b.id=c.wo_trim_booking_dtls_id and c.cons>0 and a.item_category_id=4 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.pi_id=$data[1]";
                $pi_wo_sql_result=sql_select($pi_wo_sql);
                if (count($pi_wo_sql_result)>0) $pi_wo_check=1;
                foreach($pi_wo_sql_result as $row)
                {
                    $pi_wo_data[$row[csf('wo_dtls_id')]][$row[csf('trim_group')]][$row[csf('description')]][$row[csf('color_number_id')]][$row[csf('item_color')]][$row[csf('size_id')]][$row[csf('item_size')]][$row[csf('brand_supplier')]]['wo_qnty']+=$row[csf('wo_qnty')];
                    $pi_wo_data[$row[csf('wo_dtls_id')]][$row[csf('trim_group')]][$row[csf('description')]][$row[csf('color_number_id')]][$row[csf('item_color')]][$row[csf('size_id')]][$row[csf('item_size')]][$row[csf('brand_supplier')]]['wo_amount']+=$row[csf('wo_amount')];
                }
                //echo '<pre>';print_r($pi_wo_data);die;

            }
            elseif($entryForm==171) // Services Lab Test
            {
                $pi_order_sql="select c.id as PO_ID from com_pi_item_details a, wo_labtest_dtls b, wo_po_break_down c where a.work_order_dtls_id=b.id and b.job_no=c.job_no_mst and a.item_category_id=31 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.pi_id=$data[1] group by c.id";

                $pi_wo_sql="select a.pi_id, b.id as wo_dtls_id, b.wo_value as wo_qnty, b.labtest_charge as rate, b.amount as wo_amount from com_pi_item_details a, wo_labtest_dtls b where a.work_order_dtls_id=b.id and a.item_category_id=31 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.pi_id=$data[1]";
            }

            if($entryForm != 167 && $entryForm != 166)
            {
                $pi_wo_sql_result=sql_select($pi_wo_sql);
                if(count($pi_wo_sql_result)>0) $pi_wo_check=1;
                foreach($pi_wo_sql_result as $row)
                {
                    $pi_wo_data[$row[csf('wo_dtls_id')]]['wo_qnty']+=$row[csf('wo_qnty')];
                    $pi_wo_data[$row[csf('wo_dtls_id')]]['wo_amount']+=$row[csf('wo_amount')];
                }
            }



            //echo $pi_order_sql;die;
            if($pi_order_sql!="")
            {
                $sql_lc_sc="select b.wo_po_break_down_id as PO_ID, a.export_lc_no as LC_SC_NO, a.internal_file_no as FILE_NO
				from com_export_lc a, com_export_lc_order_info b
				where a.id=b.com_export_lc_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.beneficiary_name=$data[0] and b.wo_po_break_down_id in($pi_order_sql)
				union all
				select b.wo_po_break_down_id as PO_ID, a.contract_no as LC_SC_NO, a.internal_file_no as FILE_NO
				from com_sales_contract a, com_sales_contract_order_info b
				where a.id=b.com_sales_contract_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.beneficiary_name=$data[0] and b.wo_po_break_down_id in($pi_order_sql)";
            }

            //echo $sql_lc_sc;die;
            $lc_sc_no=$ls_sc_file="";
            $sql_lc_sc_result=sql_select($sql_lc_sc);
            $lc_sc_data=array();
            foreach($sql_lc_sc_result as $row)
            {
                if($lc_sc_check[$row["LC_SC_NO"]]=="")
                {
                    $lc_sc_check[$row["LC_SC_NO"]]=$row["LC_SC_NO"];
                    $lc_sc_no.=$row["LC_SC_NO"].",";
                }
                if($file_check[$row["FILE_NO"]]=="")
                {
                    $file_check[$row["FILE_NO"]]=$row["FILE_NO"];
                    $ls_sc_file.=$row["FILE_NO"].",";
                }
            }
            //print_r($lc_sc_data);die;
            unset($sql_lc_sc_result);
            $lc_sc_no=chop($lc_sc_no,",");
            $ls_sc_file=chop($ls_sc_file,",");
            if($db_type==0)
            {
                $approval_cause=return_field_value("group_concat(approval_cause) as approval_cause","fabric_booking_approval_cause","booking_id=$data[1]","approval_cause");
            }
            else
            {
                $approval_cause=return_field_value("listagg(cast(approval_cause as varchar(4000)),',') within group(order by id) as approval_cause","fabric_booking_approval_cause","booking_id=$data[1]","approval_cause");
            }
            ?>
            <style>
                .wrd_brk{word-break: break-all;}
                .left{text-align: left;}
                .center{text-align: center;}
                .right{text-align: right;}
            </style>
            <div style="width:100%">
                <table width="100%">
                    <?
                    foreach($sql_mst as $row_mst)
                    {
                        $i++;
                        $supplier_id=$row_mst[csf('supplier_id')];
                        $sql_supplier=sql_select("SELECT id,supplier_name,country_id,web_site,email,address_1,address_2,address_3,address_4 FROM lib_supplier WHERE id=$supplier_id");
                        foreach($sql_supplier as $supplier_data)
                        {
                            if($supplier_data[csf('address_1')]!='')$address_1 = $supplier_data[csf('address_1')].','.' ';else $address_1='';
                            if($supplier_data[csf('address_2')]!='')$address_2 = $supplier_data[csf('address_2')].','.' ';else $address_2='';
                            if($supplier_data[csf('address_3')]!='')$address_3 = $supplier_data[csf('address_3')].','.' ';else $address_3='';
                            if($supplier_data[csf('address_4')]!='')$address_4 = $supplier_data[csf('address_4')].','.' ';else $address_4='';
                            if($supplier_data[csf('web_site')]!='')$web_site = $supplier_data[csf('web_site')].','.' ';else $web_site='';
                            if($supplier_data[csf('email')]!='')$email = $supplier_data[csf('email')].','.' ';else $email='';
                            if($supplier_data[csf('country_id')]!=0)$country = $country_arr[$supplier_data[csf('country_id')]].','.' ';else $country='';

                            $supplier_address = $address_1.$address_2.$address_3.$address_4.$web_site.$email.$country;
                        }
                        ?>
                        <tr>
                            <td style="font-size:20px;" align="center" colspan="6"><strong><? echo $supplier_name_library[$row_mst[csf('supplier_id')]]; ?></strong></td>
                        </tr>
                        <tr>
                            <td style="font-size:12px;" align="center" colspan="6"><strong><? echo $supplier_address; ?></strong></td>
                        </tr>
                        <tr>
                            <td width="100" align="right">To</td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td width="200"><? echo $importer_name_library[$row_mst[csf('importer_id')]];?></td>
                            <td width="100">Pi No:</td>
                            <td width="250"><? echo $row_mst[csf('pi_number')];?></td>
                            <td width="150">HS Code:</td>
                            <td><? echo $row_mst[csf('hs_code')];?></td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td rowspan="3"><? echo $company_address ;?></td>
                            <td>Pi Date:</td>
                            <td><? echo change_date_format($row_mst[csf('pi_date')]);?></td>
                            <td>Last Shipment Date:</td>
                            <td><? echo change_date_format($row_mst[csf('last_shipment_date')]);?></td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>Currency:</td>
                            <td><? echo $currency[$row_mst[csf('currency_id')]];?></td>
                            <td>Validity:</td>
                            <td><? echo change_date_format($row_mst[csf('pi_validity_date')]);?></td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>Indentor:</td>
                            <td><? echo $supplier_name_library[$row_mst[csf('intendor_name')]];?></td>
                            <td>System ID:</td>
                            <td><? echo $row_mst[csf('id')];?></td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>Pay Term</td>
                            <td><? echo $pay_term[$sql_mst[0][csf("pay_term")]];?></td>
                            <td>Tenor:</td>
                            <td><? echo $sql_mst[0][csf("tenor")];?></td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>LS/SC No:</td>
                            <td><? echo $lc_sc_no;?></td>
                            <td>File No:</td>
                            <td><? echo $ls_sc_file;?></td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>Insert By: </td>
                            <td><? echo $user_library[$row_mst[csf('inserted_by')]]; ?></td>
                            <td>Location:</td>
                            <td><? echo $pi_location_name;?></td>
                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>Remarks:</td>
                            <td><? echo $sql_mst[0][csf("remarks")];?></td>
                            <td> <b>Pi For:</b></td>
                            <td> <b><? $piFor_array=array(1=>"BTB",2=>"Margin LC",3=>"Fund Buildup",4=>"TT/Pay Order",5=>"FTT",6=>"FDD");
                                    echo $piFor_array[$row_mst[csf('pi_for')]];
                                    ?></b></td>

                        </tr>
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td style="text-align:center; color:#FF0000; font-size:22px;" colspan="2"><? if($sql_mst[0][csf('approved')]==1) echo "Approved"; elseif($sql_mst[0][csf('approved')]==3) echo "Partial Approved";  else echo "Not Approved"; ?></td>
                        </tr>
                        <?
                        $cbo_pi_basis_id=$row_mst[csf('pi_basis_id')];
                    }
                    ?>
                </table>
            </div>
            <div style="width:1000px; margin-left:10px">
                <?
                //echo $entryForm;die;

                if($entryForm==165) // Yarn
                {
                    //echo "SELECT a.id, work_order_no, a.color_id, a.count_name, a.yarn_composition_item1, a.yarn_composition_percentage1, a.yarn_composition_item2, a.yarn_composition_percentage2, a.yarn_type, a.uom, a.quantity, a.rate, a.amount, a.hs_code, a.work_order_dtls_id FROM com_pi_item_details a WHERE a.pi_id = $data[1] and a.status_active=1 and a.is_deleted=0 ORDER BY a.id ASC";
                    $data_array=sql_select("SELECT a.id, work_order_no, a.color_id, a.count_name, a.yarn_composition_item1, a.yarn_composition_percentage1, a.yarn_composition_item2, a.yarn_composition_percentage2, a.yarn_type, a.uom, a.quantity, a.rate, a.amount, a.hs_code, a.work_order_dtls_id FROM com_pi_item_details a WHERE a.pi_id = $data[1] and a.status_active=1 and a.is_deleted=0 ORDER BY a.id ASC");
                    $work_order_no=$data_array[0][csf("work_order_no")];
                    if($pi_basis_id==1)
                    {
                        /*echo "select p.id as pi_dtls_id, max(a.id) as wo_id, max(a.wo_basis_id) as wo_basis_id, sum(b.supplier_order_quantity) as wo_qnty, sum(b.amount) as amount from com_pi_item_details p, wo_non_order_info_mst a, wo_non_order_info_dtls b
                        where p.work_order_dtls_id=b.id and a.id=b.mst_id and a.pi_id = $data[1] group by p.id";*/
                        $wo_sql=sql_select("select p.id as pi_dtls_id, max(a.id) as wo_id, max(a.wo_basis_id) as wo_basis_id, sum(b.supplier_order_quantity) as wo_qnty, sum(b.amount) as amount from com_pi_item_details p, wo_non_order_info_mst a, wo_non_order_info_dtls b
					where p.work_order_dtls_id=b.id and a.id=b.mst_id and p.pi_id = $data[1] group by p.id");
                        $wo_data=array();
                        foreach($wo_sql as $row)
                        {
                            $wo_data[$row[csf("pi_dtls_id")]]["pi_dtls_id"]=$row[csf("pi_dtls_id")];
                            $wo_data[$row[csf("pi_dtls_id")]]["wo_id"]=$row[csf("wo_id")];
                            $wo_data[$row[csf("pi_dtls_id")]]["wo_qnty"]=$row[csf("wo_qnty")];
                            $wo_data[$row[csf("pi_dtls_id")]]["amount"]=$row[csf("amount")];
                            $wo_basis_id=$row[csf("wo_basis_id")];
                        }
                        $work_order_no=$wo_basis_array[0][csf("wo_basis_id")];
                    }

                    //echo $wo_basis_id.test;die;
                    if ($wo_basis_id==1 || $wo_basis_id==2) // requ
                    {
                        $buyer_style_sql=" SELECT a.id, a.job_no, a.style_ref_no, a.buyer_name, c.id as wo_dtls_id from wo_po_details_master a, wo_non_order_info_dtls c
					where a.job_no=c.job_no and a.status_active=1 and a.is_deleted=0 and c.status_active=1 and c.is_deleted=0 group by a.id, a.job_no, a.style_ref_no, a.buyer_name, c.id";

                        $buyer_style_data_array=sql_select($buyer_style_sql);
                        $buyer_style_array=array();
                        foreach($buyer_style_data_array as $row)
                        {
                            $buyer_style_array[$row[csf('wo_dtls_id')]]['buyer_name']=$row[csf('buyer_name')];
                            $buyer_style_array[$row[csf('wo_dtls_id')]]['style_ref_no']=$row[csf('style_ref_no')];
                        }
                        /*echo "<pre>";
                        print_r($buyer_style_array);*/
                    }
                    elseif ($wo_basis_id==3) // buyer po
                    {
                        $buyer_style_sql="SELECT a.id, a.job_no, a.style_ref_no, a.buyer_name,b.id as po_id, b.po_number, c.id as wo_dtls_id
					from wo_po_details_master a, wo_po_break_down b, wo_non_order_info_dtls c
					where a.job_no=b.job_no_mst and b.id=c.po_breakdown_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0
					group by a.id, a.job_no, a.style_ref_no, a.buyer_name,b.id, b.po_number, c.id";
                        //and a.job_no in('og-20-00236','og-20-00207')
                        $buyer_style_data_array=sql_select($buyer_style_sql);
                        $buyer_style_array=array();
                        foreach($buyer_style_data_array as $row)
                        {
                            $buyer_style_array[$row[csf('wo_dtls_id')]]['buyer_name']=$row[csf('buyer_name')];
                            $buyer_style_array[$row[csf('wo_dtls_id')]]['style_ref_no']=$row[csf('style_ref_no')];
                        }
                        /*echo "<pre>";
                        print_r($buyer_style_array);*/
                    }
                    else // Independent
                    {

                    }

                    /*echo "<pre>";
                    print_r($buyer_style_array);*/

                    $yarn_count = return_library_array('SELECT id,yarn_count FROM lib_yarn_count','id','yarn_count');
                    $color_name = return_library_array('SELECT id,color_name FROM lib_color','id','color_name');
                    $buyer_arr=return_library_array( "select id, short_name from lib_buyer",'id','short_name');

                    ?>
                    <table class="rpt_table" width="100%" cellspacing="1"  border="1" rules="all">
                        <thead>
                        <tr>
                            <?
                            if( $cbo_pi_basis_id == 1 )
                            {
                                ?>
                                <th style="min-width: 80px;">WO</th>
                                <th style="min-width: 80px;">Buyer</th>
                                <th style="min-width: 100px;">Style Ref.</th>
                                <?
                            }
                            ?>
                            <th style="min-width: 60px;">HS Code</th>
                            <th style="min-width: 60px;">Color</th>
                            <th style="min-width: 50px;">Count</th>
                            <th colspan="4" style="min-width: 120px;">Composition</th>
                            <th style="min-width: 60px;">Yarn Type</th>
                            <th style="min-width: 30px;">UOM</th>
                            <?
                            if($pi_basis_id==1 && $pi_wo_check==1)
                            {
                                ?>
                                <th style="min-width: 60px;">WO Qnty</th>
                                <th style="min-width: 60px;">WO Rate</th>
                                <th style="min-width: 60px;">WO Amount</th>
                                <?
                            }
                            ?>
                            <th style="min-width: 60px;">Quantity</th>
                            <th style="min-width: 60px;">Rate</th>
                            <th style="min-width: 60px;">Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <?
                        $i = 0;
                        $total_quantity = 0;
                        $total_ammount = 0;
                        foreach($data_array as $row)
                        {
                            $i++;
                            if( $i % 2 == 0 ) $bgcolor="#E9F3FF";
                            else $bgcolor = "#FFFFFF";//get_php_form_data( theemail.value, "populate_data_from_search_popup", "requires/pi_controller" );
                            $buyer_name=$buyer_arr[$buyer_style_array[$row[csf('work_order_dtls_id')]]['buyer_name']];
                            $style_no=$buyer_style_array[$row[csf('work_order_dtls_id')]]['style_ref_no'];
                            ?>
                            <tr bgcolor="<? echo $bgcolor; ?>"  height="25" >
                                <?
                                if( $cbo_pi_basis_id  == 1 )
                                {
                                    ?>
                                    <td class="wrd_brk"><? echo $row[csf('work_order_no')]; ?></td>
                                    <td class="wrd_brk"><? echo $buyer_name; ?></td>
                                    <td class="wrd_brk"><? echo $style_no; ?></td>
                                    <?
                                }
                                ?>
                                <td class="wrd_brk"><? echo $row[csf('hs_code')]; ?></td>
                                <td class="wrd_brk"><? echo $color_name[$row[csf('color_id')]]; ?></td>
                                <td class="wrd_brk"><? echo $yarn_count[$row[csf('count_name')]]; ?></td>
                                <td class="wrd_brk"><? echo $composition[$row[csf('yarn_composition_item1')]]; ?></td>
                                <td class="wrd_brk"><? echo $row[csf('yarn_composition_percentage1')]; ?>%</td>
                                <td class="wrd_brk"><? echo $composition[$row[csf('yarn_composition_item2')]]; ?></td>
                                <td class="wrd_brk"><? echo $row[csf('yarn_composition_percentage2')]; ?>%</td>
                                <td class="wrd_brk">
                                    <? if( $row[csf('yarn_type')] != 0 ) echo $yarn_type[$row[csf('yarn_type')]]; ?>
                                </td>
                                <td class="wrd_brk">
                                    <? if( $row[csf('uom')] != 0 ) echo $unit_of_measurement[$row[csf('uom')]]; ?>
                                </td>
                                <?
                                if($pi_basis_id==1 && $pi_wo_check==1)
                                {
                                    $wo_rate=$wo_data[$row[csf("id")]]["amount"]/$wo_data[$row[csf("id")]]["wo_qnty"];
                                    ?>
                                    <td class="wrd_brk" align="right"><? echo number_format($wo_data[$row[csf("id")]]["wo_qnty"],2);  $tot_wo_quantity += $wo_data[$row[csf("id")]]["wo_qnty"];?></td>
                                    <td class="wrd_brk" align="right"><? echo number_format($wo_rate,4); ?></td>
                                    <td class="wrd_brk" align="right"><? echo number_format($wo_data[$row[csf("id")]]["amount"],4);  $tot_wo_amt += $wo_data[$row[csf("id")]]["amount"];?></td>
                                    <?
                                }
                                ?>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('quantity')],2);  $total_quantity += $row[csf('quantity')];?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('rate')],4); ?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('amount')],4);  $total_ammount += $row[csf('amount')];?></td>
                            </tr>
                            <?
                        }
                        ?>

                        <tr class="tbl_bottom" height="25">
                            <?
                            if($pi_basis_id==1)
                            {if($pi_wo_check==1) $colspan="15"; else $colspan="12";}
                            else $colspan="9";

                            ?>
                            <td colspan="<? echo $colspan; ?>">Sum</td>
                            <td><? echo number_format($total_quantity,2);?></td>
                            <td></td>
                            <td><? echo number_format($total_ammount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Upcharge</td>
                            <td><? echo number_format($upcharge,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Discount</td>
                            <td><? echo number_format($discount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Net Total</td>
                            <td><? echo number_format($net_total_amount,4); ?></td>
                        </tr>
                        </tbody>
                    </table>
                    <table>
                        <tr height="20"></tr>
                        <tr>
                            <td valign="top"><strong>In-Words: </strong></td>
                            <td><?

                                if($sql_mst[0][csf('currency_id')]*1==1)
                                {
                                    echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Poisa');

                                }
                                else
                                {
                                    echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Cent');
                                }
                                ?></td>
                        </tr>
                        <tr>
                        <tr height="50"></tr>
                    </table>
                    <?
                    $approved_sql=sql_select("SELECT  mst_id, approved_by ,min(approved_date) as approved_date  from approval_history where entry_form in(21,27) AND  mst_id =".$data[1]."  group by mst_id, approved_by  order by  approved_by");
                    $approved_his_sql=sql_select("SELECT  mst_id, approved_by ,approved_date,un_approved_reason,un_approved_date,approved_no  from approval_history where entry_form in(21,27) AND  mst_id =".$data[1]." order by  approved_no,approved_date");
                    $user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
                    $user_lib_desg=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
                    $designation_lib=return_library_array("SELECT id,custom_designation from lib_designation", "id", "custom_designation");

                    if(count($approved_sql)>0)
                    {
                        $sl=1;
                        ?>
                        <div style="margin-top:15px">
                            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:900px;text-align:center;" rules="all">
                                <label><b>Pro Forma Invoice Approval Status </b></label>
                                <thead>
                                <tr style="font-weight:bold">
                                    <th width="20">SL</th>
                                    <th width="150">Name</th>
                                    <th width="150">Designation</th>
                                    <th width="50">Approval Status</th>
                                    <th width="100">Approval Date</th>

                                </tr>
                                </thead>
                                <?
                                foreach ($approved_sql as $key => $value)
                                {
                                    ?>
                                    <tr>
                                        <td width="20"><? echo $sl; ?></td>
                                        <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                        <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                        <td width="50">Yes</td>
                                        <td width="100"><? $approved_date=explode(" ",$value[csf("approved_date")]);
                                            echo change_date_format($approved_date[0])." ".$approved_date[1];  ?></td>

                                    </tr>
                                    <?
                                    $sl++;
                                }
                                ?>
                            </table>
                        </div>
                        <?
                    }
                    ?>
                    <? if(count($approved_his_sql) > 0)
                {
                    $sl=1;
                    ?>
                    <div style="margin-top:15px">
                        <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                            <label><b>Pro Forma Invoice Approval / Un-Approval History </b></label>
                            <thead>
                            <tr style="font-weight:bold">
                                <th width="20">SL</th>
                                <th width="150">Approved / Un-Approved</th>
                                <th width="150">Designation</th>
                                <th width="50">Approval Status</th>
                                <th width="150">Reason for Un-Approval</th>
                                <th width="150">Date</th>
                            </tr>
                            </thead>
                            <? foreach ($approved_his_sql as $key => $value)
                            {
                                if($sl%2==0)$bgcolor="#E9F3FF";  else $bgcolor="#FFFFFF";
                                ?>
                                <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                    <td width="20"><? echo $sl; ?></td>
                                    <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                    <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                    <td width="50">Yes</td>
                                    <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                    <td width="150"><? $approved_date=explode(" ",$value[csf("approved_date")]);

                                        echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                </tr>

                                <?
                                $sl++;
                                if($value[csf("un_approved_date")] !='0000-00-00 00:00:00' && $value[csf("un_approved_date")] !='')
                                {
                                    ?>
                                    <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                        <td width="20"><? echo $sl; ?></td>
                                        <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                        <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                        <td width="50">No</td>
                                        <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                        <td width="150"><? $approved_date=explode(" ",$value[csf("un_approved_date")]);

                                            echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                    </tr>

                                    <?
                                    $sl++;

                                }

                            }
                            ?>
                        </table>
                    </div>
                    <?
                }
                    ?>
                    <!-- //approved status end-->
                    <br/>
                    <?
                    echo signature_table(147, $data[0],"900px",$data[18]);

                }
                else if($entryForm==166) // Knit Finish Fabrics, Woven Fabrics, Grey Fabric(Knit), Grey Fabric(woven)
                {
                    //echo $pi_basis_id."=".$pi_wo_check;die;
                    ?>
                    <table class="rpt_table" width="100%" cellspacing="1"  border="1" rules="all">
                        <thead>
                        <tr>
                            <? if( $cbo_pi_basis_id == 1 ) { ?>
                                <th style="min-width: 60px;">WO</th>
                                <th style="min-width: 60px;">Buyer</th>
                                <th style="min-width: 90px; max-width: 200px;">Style Ref.</th>
                            <? } ?>
                            <th style="min-width: 50px;">HS Code</th>
                            <th style="min-width: 50px;">Fabric Type</th>
                            <th style="min-width: 100px;">Construction</th>
                            <th style="min-width: 100px;">Composition</th>
                            <th style="min-width: 50px;">Color</th>
                            <th style="min-width: 30px;">GSM</th>
                            <th style="min-width: 40px;">Dia/Width</th>
                            <th style="min-width: 30px;">UOM</th>
                            <?
                            if($pi_basis_id==1 && $pi_wo_check==1)
                            {
                                ?>
                                <th style="min-width: 60px;">WO Qnty</th>
                                <th style="min-width: 50px;">WO Rate</th>
                                <th style="min-width: 60px;">WO Amount</th>
                                <?
                            }
                            ?>
                            <th style="min-width: 60px;">Quantity</th>
                            <th style="min-width: 50px;">Rate</th>
                            <th style="min-width: 60px;">Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <?
                        $dtls_sql="SELECT a.id, a.pi_id, a.work_order_no, a.work_order_id, a.determination_id, a.color_id, a.fabric_construction, a.fabric_composition, a.gsm, a.dia_width, a.uom, a.quantity, a.rate, a.amount, a.service_type, a.status_active, a.hs_code, a.work_order_dtls_id, a.body_part_id, a.fab_weight, a.fab_weight_type, a.width_dia_type
					from com_pi_item_details a WHERE a.pi_id = $data[1] and a.status_active=1 and a.is_deleted=0 ORDER BY a.id ASC";
                        //echo $dtls_sql;die;
                        $data_array=sql_select($dtls_sql);

                        $buyer_style_sql="SELECT a.work_order_dtls_id, c.buyer_name, c.style_ref_no, c.job_no
					from com_pi_item_details a, wo_booking_dtls b, wo_po_details_master c
                    where a.work_order_no=b.booking_no and b.job_no=c.job_no and a.is_deleted=0 and a.status_active=1
                    and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 and a.item_category_id = 3 and a.pi_id = $data[1]
                    group by a.work_order_dtls_id, c.buyer_name, c.style_ref_no, c.job_no";

                        $buyer_style_data_array=sql_select($buyer_style_sql);
                        $buyer_style_array=array();
                        foreach($buyer_style_data_array as $row)
                        {
                            if($buyer_style_array[$row[csf("work_order_dtls_id")]][$row[csf("buyer_name")]]=="")
                            {
                                $buyer_style_array[$row[csf("work_order_dtls_id")]][$row[csf("buyer_name")]]=$row[csf("buyer_name")];
                                $buyer_style_array[$row[csf("work_order_dtls_id")]]["buyer_name"].=$row[csf("buyer_name")].',';
                            }
                            if($buyer_style_array[$row[csf("work_order_dtls_id")]][$row[csf("style_ref_no")]]=="")
                            {
                                $buyer_style_array[$row[csf("work_order_dtls_id")]][$row[csf("style_ref_no")]]=$row[csf("style_ref_no")];
                                $buyer_style_array[$row[csf("work_order_dtls_id")]]["style_ref_no"].=$row[csf("style_ref_no")].',';
                            }
                        }
                        /*echo "<pre>";
                        print_r($buyer_style_array);*/

                        $color_name = return_library_array('SELECT id,color_name FROM lib_color','id','color_name');
                        $total_ammount = 0; $i = 0; $total_quantity=0;  $all_uom='';
                        foreach($data_array as $row)
                        {
                            $i++;
                            if( $i % 2 == 0 ) $bgcolor="#E9F3FF";
                            else $bgcolor = "#FFFFFF";//get_php_form_data( theemail.value, "populate_data_from_search_popup", "requires/pi_controller" );

                            $buyer_id=chop($buyer_style_array[$row[csf("work_order_dtls_id")]]['buyer_name'],',');
                            $buyer_name=array_unique(explode(',', $buyer_id));
                            $comma_separate_buyer="";
                            foreach ($buyer_name as $key => $value)
                            {
                                if ($comma_separate_buyer=="")
                                {
                                    $comma_separate_buyer.=$buyer_library_arr[$value];
                                }
                                else
                                {
                                    $comma_separate_buyer.=','.$buyer_library_arr[$value];
                                }
                            }
                            //echo $comma_separate_buyer;
                            $style_ref=chop($buyer_style_array[$row[csf("work_order_dtls_id")]]['style_ref_no'],',');
                            $style_ref_arr=array_unique(explode(',', $style_ref));
                            $comma_separate_style="";
                            foreach ($style_ref_arr as $key => $value)
                            {
                                if ($comma_separate_style=="")
                                {
                                    $comma_separate_style.=$value;
                                }
                                else
                                {
                                    $comma_separate_style.=','.$value;
                                }
                            }
                            ?>
                            <tr bgcolor="<? echo $bgcolor; ?>">
                                <? if( $cbo_pi_basis_id  == 1 ) { ?>
                                    <td class="wrd_brk"><? echo $row[csf('work_order_no')]; ?></td>
                                    <td class="wrd_brk"><? echo $comma_separate_buyer ; ?></td>
                                    <td class="wrd_brk"><? echo $comma_separate_style;//$buyer_style_array[$row[csf('work_order_dtls_id')]]['style_ref_no']; ?></td>
                                <? } ?>
                                <td class="wrd_brk"><? echo $row[csf('hs_code')]; ?></td>
                                <td class="wrd_brk"><? echo $row[csf('fabric_type')]; ?></td>
                                <td class="wrd_brk"><? echo $row[csf('fabric_construction')]; ?></td>
                                <td class="wrd_brk"><? echo chop($row[csf('fabric_composition')],","); ?></td>
                                <td class="wrd_brk"><? echo $color_name[$row[csf('color_id')]]; ?></td>
                                <td class="wrd_brk"><? echo $row[csf('gsm')]; ?></td>
                                <td class="wrd_brk"><? echo $row[csf('dia_width')]; ?></td>
                                <td class="wrd_brk"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
                                <?
                                if($pi_basis_id==1 && $pi_wo_check==1)
                                {
                                    if($cbo_item_category_id==3)
                                    {
                                        //if($i==1) { echo "<pre>";print_r($pi_wo_data);}
                                        //echo $row[csf('work_order_no')]."=".$row[csf('body_part_id')]."=".$row[csf('determination_id')]."=".$row[csf('color_id')]."=".$row[csf('fabric_construction')]."=".$row[csf('fabric_composition')]."=".$row[csf('fab_weight')]."=".$row[csf('fab_weight_type')]."test=".$row[csf('dia_width')]."=".$row[csf('width_dia_type')]."=".$row[csf('uom')]."<br>";
                                        $wo_qnty=$pi_wo_data[$row[csf('work_order_no')]][$row[csf('body_part_id')]][$row[csf('determination_id')]][$row[csf('color_id')]][$row[csf('fabric_construction')]][$row[csf('fabric_composition')]][$row[csf('fab_weight')]][$row[csf('fab_weight_type')]][$row[csf('dia_width')]][$row[csf('width_dia_type')]][$row[csf('uom')]]['fin_fab_qnty'];
                                        $wo_amt=$pi_wo_data[$row[csf('work_order_no')]][$row[csf('body_part_id')]][$row[csf('determination_id')]][$row[csf('color_id')]][$row[csf('fabric_construction')]][$row[csf('fabric_composition')]][$row[csf('fab_weight')]][$row[csf('fab_weight_type')]][$row[csf('dia_width')]][$row[csf('width_dia_type')]][$row[csf('uom')]]['wo_amount'];
                                    }
                                    else
                                    {
                                        $wo_qnty=$pi_wo_data[$row[csf('work_order_no')]][$row[csf('determination_id')]][$row[csf('color_id')]][$row[csf('fabric_construction')]][$row[csf('fabric_composition')]][$row[csf('gsm')]][$row[csf('dia_width')]][$row[csf('uom')]]['wo_qnty'];
                                        $wo_amt=$pi_wo_data[$row[csf('work_order_no')]][$row[csf('determination_id')]][$row[csf('color_id')]][$row[csf('fabric_construction')]][$row[csf('fabric_composition')]][$row[csf('gsm')]][$row[csf('dia_width')]][$row[csf('uom')]]['wo_amount'];
                                    }
                                    $wo_rate=0;
                                    if($wo_amt>0 && $wo_qnty>0) $wo_rate=$wo_amt/$wo_qnty;
                                    ?>
                                    <td class="wrd_brk" align="right"><? echo number_format($wo_qnty,2);  $tot_wo_quantity += $wo_qnty;?></td>
                                    <td class="wrd_brk" align="right"><? echo number_format($wo_rate,4); ?></td>
                                    <td class="wrd_brk" align="right"><? echo number_format($wo_amt,4);  $tot_wo_amt += $wo_amt;?></td>
                                    <?
                                }
                                ?>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('quantity')],2); $total_quantity += $row[csf('quantity')]; ?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('rate')],4); ?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('amount')],4); $total_ammount += $row[csf('amount')];  ?></td>
                            </tr>
                            <?
                            $all_uom.=$row[csf('uom')].',';
                        }
                        $all_uom=array_unique(explode(",",chop($all_uom,',')));
                        ?>
                        <tr class="tbl_bottom">
                            <?
                            if( $cbo_pi_basis_id == 1) {if($pi_wo_check)$colspan="14"; else $colspan="11";} else $colspan="8";
                            ?>
                            <td colspan="<? echo $colspan; ?>">Sum</td>
                            <td class="right"><? if(count($all_uom)==1){echo number_format($total_quantity,2);}?></td>
                            <td>&nbsp;</td>
                            <td class="right"><? echo number_format($total_ammount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Upcharge</td>
                            <td><? echo number_format($upcharge,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Discount</td>
                            <td><? echo number_format($discount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Net Total</td>
                            <td><? echo number_format($net_total_amount,4); ?></td>
                        </tr>
                        </tbody>
                    </table>
                    <table>
                        <tr height="20"></tr>
                        <tr>
                            <td valign="top"><strong>In-Words: </strong></td>
                            <td><?

                                if($sql_mst[0][csf('currency_id')]*1==1)
                                {
                                    echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Poisa');

                                }
                                else
                                {
                                    echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Cent');
                                }
                                ?>
                            </td>
                        </tr>
                        <tr>
                        <tr height="50"></tr>
                    </table>
                    <?
                    $approved_sql=sql_select("SELECT  mst_id, approved_by ,min(approved_date) as approved_date  from approval_history where entry_form in(21,27) AND  mst_id =".$data[1]."  group by mst_id, approved_by order by  approved_by");
                    $approved_his_sql=sql_select("SELECT  mst_id, approved_by ,approved_date,un_approved_reason,un_approved_date,approved_no  from approval_history where entry_form in(21,27) AND  mst_id =".$data[1]." order by  approved_no,approved_date");
                    $user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
                    $user_lib_desg=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
                    $designation_lib=return_library_array("SELECT id,custom_designation from lib_designation", "id", "custom_designation");

                    if(count($approved_sql)>0)
                    {
                        $sl=1;
                        ?>
                        <div style="margin-top:15px">
                            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:900px;text-align:center;" rules="all">
                                <label><b>Pro Forma Invoice Approval Status </b></label>
                                <thead>
                                <tr style="font-weight:bold">
                                    <th width="20">SL</th>
                                    <th width="150">Name</th>
                                    <th width="150">Designation</th>
                                    <th width="50">Approval Status</th>
                                    <th width="100">Approval Date</th>

                                </tr>
                                </thead>
                                <? foreach ($approved_sql as $key => $value)
                                {
                                    ?>
                                    <tr>
                                        <td width="20"><? echo $sl; ?></td>
                                        <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                        <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                        <td width="50">Yes</td>
                                        <td width="100"><? $approved_date=explode(" ",$value[csf("approved_date")]);
                                            echo change_date_format($approved_date[0])." ".$approved_date[1];  ?></td>

                                    </tr>
                                    <?
                                    $sl++;
                                }
                                ?>
                            </table>
                        </div>
                        <?
                    }

                    if(count($approved_his_sql) > 0)
                    {
                        $sl=1;
                        ?>
                        <div style="margin-top:15px">
                            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                                <label><b>Pro Forma Invoice Approval / Un-Approval History </b></label>
                                <thead>
                                <tr style="font-weight:bold">
                                    <th width="20">SL</th>
                                    <th width="150">Approved / Un-Approved</th>
                                    <th width="150">Designation</th>
                                    <th width="50">Approval Status</th>
                                    <th width="150">Reason for Un-Approval</th>
                                    <th width="150">Date</th>
                                </tr>
                                </thead>
                                <? foreach ($approved_his_sql as $key => $value)
                                {
                                    if($sl%2==0)$bgcolor="#E9F3FF";  else $bgcolor="#FFFFFF";
                                    ?>
                                    <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                        <td width="20"><? echo $sl; ?></td>
                                        <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                        <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                        <td width="50">Yes</td>
                                        <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                        <td width="150"><? $approved_date=explode(" ",$value[csf("approved_date")]);

                                            echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                    </tr>

                                    <?
                                    $sl++;
                                    if($value[csf("un_approved_date")] !='0000-00-00 00:00:00' && $value[csf("un_approved_date")] !='')
                                    {
                                        ?>
                                        <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                            <td width="20"><? echo $sl; ?></td>
                                            <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                            <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                            <td width="50">No</td>
                                            <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                            <td width="150"><? $approved_date=explode(" ",$value[csf("un_approved_date")]);


                                                echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                        </tr>

                                        <?
                                        $sl++;

                                    }

                                }
                                ?>
                            </table>
                        </div>
                        <?
                    }
                    ?>
                    <!-- //approved status end-->
                    <br/>
                    <?
                    //signature_table($report_id, $company, $width, $template_id,$padding_top=70)

                    echo signature_table(147, $data[0],"900px",$data[18]);
                }
                else if($entryForm==167)//Accessories
                {
                    //echo $goods_rcv_status;die;
                    ?>
                    <table class="rpt_table" width="100%" cellspacing="1"  border="1" rules="all">
                        <thead>
                        <tr>
                            <? if( $cbo_pi_basis_id == 1 ) { ?>
                                <th class="header" style="min-width: 60px;">WO</th>
                            <? } ?>
                            <th style="min-width: 60px;">Buyer</th>
                            <th style="min-width: 100px;">Style Ref.</th>
                            <th style="min-width: 50px;">HS Code</th>
                            <th style="min-width: 60px;">Item Group</th>
                            <th style="min-width: 100px;">Item Description</th>
                            <th style="min-width: 50px;">Gmts Color</th>
                            <th style="min-width: 50px;">Gmts Size</th>
                            <th style="min-width: 50px;">Item Color</th>
                            <th style="min-width: 50px;">Item Size</th>
                            <th style="min-width: 30px;">UOM</th>
                            <?
                            if($pi_basis_id==1 && $pi_wo_check==1)
                            {
                                ?>
                                <th style="min-width: 60px;">WO Qnty</th>
                                <th style="min-width: 50px;">WO Rate</th>
                                <th style="min-width: 60px;">WO Amount</th>
                                <?
                            }
                            ?>
                            <th style="min-width: 60px;">Quantity</th>
                            <th style="min-width: 50px;">Rate</th>
                            <th style="min-width: 60px;">Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <?
                        if($goods_rcv_status==2)
                        {
                            $data_array=sql_select("SELECT a.id, a.pi_id, a.work_order_no, a.work_order_dtls_id, a.color_id, a.size_id, a.item_color, a.item_size, a.item_group, a.item_description, a.gsm, a.dia_width, a.uom, a.quantity, a.rate, a.amount, a.service_type, a.status_active, a.item_prod_id, a.hs_code, a.brand_supplier FROM com_pi_item_details a WHERE a.pi_id = $data[1] and a.status_active=1 and a.is_deleted=0 ORDER BY a.id ASC");
                        }
                        else
                        {
                            /*if($db_type==0)
                            {
                                $sql = "SELECT group_concat(id) as id, work_order_no, color_id, fabric_construction as construction, fabric_composition as composition, gsm, dia_width, uom, sum(quantity) as quantity, avg(rate) as rate, sum(amount) as amount, item_prod_id, hs_code from com_pi_item_details where pi_id='$data[1]' and quantity>0 and status_active=1 and is_deleted=0 group by work_order_no, color_id, fabric_construction as construction, fabric_composition as composition, gsm, dia_width, uom, item_prod_id, hs_code";

                            }
                            else
                            {
                                $sql = "SELECT rtrim(xmlagg(xmlelement(e,id,',').extract('//text()') order by id).GetClobVal(),',') AS id , work_order_no, color_id, fabric_construction as construction, fabric_composition as composition, gsm, dia_width, uom, sum(quantity) as quantity, avg(rate) as rate, sum(amount) as amount, item_prod_id, hs_code from com_pi_item_details where pi_id='$data[1]' and quantity>0 and status_active=1 and is_deleted=0 group by work_order_no, color_id, fabric_construction as construction, fabric_composition as composition, gsm, dia_width, uom, item_prod_id, hs_code";
                            }*/

                            if($db_type==0)
                            {
                                $data_array=sql_select("SELECT group_concat(a.id) as id, a.pi_id, a.work_order_no, a.work_order_dtls_id, a.color_id, a.size_id, a.item_color, a.item_size, a.item_group, a.item_description, a.gsm, a.dia_width, a.uom, sum(a.quantity) as quantity, avg(a.rate) as rate, sum(a.amount) as amount, a.service_type, a.status_active, item_prod_id, a.hs_code, a.brand_supplier FROM com_pi_item_details a WHERE a.pi_id = $data[1] and a.status_active=1 and a.is_deleted=0
							group by a.pi_id, a.work_order_no, a.work_order_dtls_id, a.color_id, a.size_id, a.item_color, a.item_size, a.item_group, a.item_description, a.gsm, a.dia_width, a.uom, a.service_type, a.status_active, item_prod_id, a.hs_code, a.brand_supplier
							ORDER BY a.id ASC");
                            }
                            else
                            {

                                $data_array=sql_select("SELECT rtrim(xmlagg(xmlelement(e,id,',').extract('//text()') order by id).GetClobVal(),',') AS id , a.pi_id, a.work_order_no, a.work_order_dtls_id, a.color_id, a.size_id, a.item_color, a.item_size, a.item_group, a.item_description, a.gsm, a.dia_width, a.uom, sum(a.quantity) as quantity, avg(a.rate) as rate, sum(a.amount) as amount, a.service_type, a.status_active, item_prod_id, a.hs_code, a.brand_supplier FROM com_pi_item_details a WHERE a.pi_id = $data[1] and a.status_active=1 and a.is_deleted=0
							group by a.pi_id, a.work_order_no, a.work_order_dtls_id, a.color_id, a.size_id, a.item_color, a.item_size, a.item_group, a.item_description, a.gsm, a.dia_width, a.uom, a.service_type, a.status_active, item_prod_id, a.hs_code, a.brand_supplier");
                            }

                        }

                        $wo_po=sql_select("SELECT a.id as booking_dtlsid, a.booking_no, a.trim_group, b.style_ref_no, b.buyer_name FROM wo_booking_dtls a, wo_po_details_master b where a.job_no=b.job_no and b.company_name=$data[0] and a.status_active=1");
                        $wo_ord_arr=array(); //$wo_ord_buyer_arr=array();
                        foreach($wo_po as $row)
                        {
                            $wo_ord_arr[$row[csf('booking_dtlsid')]]['style_ref_no'].=$row[csf('style_ref_no')].',';
                            $wo_ord_arr[$row[csf('booking_dtlsid')]]['buyer_name'].=$buyer_library_arr[$row[csf('buyer_name')]].',';
                            //$wo_ord_buyer_arr[$row[csf('booking_no')]][$row[csf('trim_group')]].=$buyer_library_arr[$row[csf('buyer_name')]].',';
                        }
                        /*echo "<pre>";
                        print_r($wo_ord_buyer_arr);die;*/
                        if($db_type==0) $style_grpCond="group_concat(style_des)";
                        else if($db_type==2) $style_grpCond="listagg(cast(style_des as varchar(4000)),',') within group (order by style_des)";

                        $wo_nonOrd_arr = return_library_array('SELECT booking_no, $style_grpCond as style_ref FROM wo_non_ord_samp_booking_dtls where status_active=1 group by booking_no','booking_no','style_ref');

                        $wo_nonPo=sql_select("SELECT a.booking_no, b.style_des, a.buyer_id FROM  wo_non_ord_samp_booking_mst a, wo_non_ord_samp_booking_dtls b where a.booking_no=b.booking_no and a.company_id=$data[0] and a.status_active=1 ");
                        $wo_nonOrd_buyer_arr=array();
                        foreach($wo_nonPo as $row)
                        {
                            $wo_nonOrd_buyer_arr[$row[csf('booking_no')]].=$buyer_library_arr[$row[csf('buyer_id')]].',';
                        }
                        /*echo "<pre>";
                        print_r($wo_nonOrd_buyer_arr);die;*/


                        $item_group_library = return_library_array('SELECT id, item_name FROM lib_item_group','id','item_name');
                        $i = 0;
                        $total_ammount = 0;
                        foreach($data_array as $row)
                        {
                            if($db_type==2 && $goods_rcv_status !=2) $row[csf('id')] = $row[csf('id')]->load();
                            $wo_style_no=''; $wo_buyer_name='';

                            if($row[csf('booking_without_order')]==1)
                            {
                                $wo_style_no=implode(",",array_unique(explode(",",$wo_nonOrd_arr[$row[csf('work_order_no')]])));
                                $wo_buyer_name=implode(",",array_unique(explode(",",$wo_nonOrd_buyer_arr[$row[csf('work_order_no')]])));
                            }
                            else
                            {
                                $wo_style_no=implode(",",array_unique(explode(",",$wo_ord_arr[$row[csf('work_order_dtls_id')]]['style_ref_no'])));
                                $wo_buyer_name=implode(",",array_unique(explode(",",$wo_ord_arr[$row[csf('work_order_dtls_id')]]['buyer_name'])));
                            }
                            ?>
                            <tr bgcolor="<? echo $bgcolor; ?>">
                                <? if( $cbo_pi_basis_id == 1 ) { ?>
                                    <td class="wrd_brk"><? echo $row[csf('work_order_no')]; ?></td>
                                <? } ?>
                                <td class="wrd_brk"><? //echo $arrayName[$wo_ord_buyer_arr[$row[csf('work_order_no')]]];
                                    echo rtrim($wo_buyer_name,','); ?></td>
                                <td class="wrd_brk"><? echo rtrim($wo_style_no,','); ?></td>
                                <td class="wrd_brk"><? echo $row[csf('hs_code')]; ?></td>
                                <td class="wrd_brk"><? echo $item_group_library[$row[csf('item_group')]]; ?></td>
                                <td class="wrd_brk"><? echo $row[csf('item_description')]; ?></td>
                                <td class="wrd_brk"><? echo $color_library[$row[csf('color_id')]]; ?></td>
                                <td class="wrd_brk"><? echo $size_library[$row[csf('size_id')]]; ?></td>
                                <td class="wrd_brk"><? echo $color_library[$row[csf('item_color')]]; ?></td>
                                <td class="wrd_brk"><? echo $row[csf('item_size')]; ?></td>
                                <td class="wrd_brk"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
                                <?
                                if($pi_basis_id==1 && $pi_wo_check==1)
                                {
                                    $wo_qnty=$pi_wo_data[$row[csf('work_order_dtls_id')]][$row[csf('item_group')]][$row[csf('item_description')]][$row[csf('color_id')]][$row[csf('item_color')]][$row[csf('size_id')]][$row[csf('item_size')]][$row[csf('brand_supplier')]]['wo_qnty'];
                                    $wo_amt=$pi_wo_data[$row[csf('work_order_dtls_id')]][$row[csf('item_group')]][$row[csf('item_description')]][$row[csf('color_id')]][$row[csf('item_color')]][$row[csf('size_id')]][$row[csf('item_size')]][$row[csf('brand_supplier')]]['wo_amount'];

                                    $wo_rate=$wo_amt/$wo_qnty;
                                    ?>
                                    <td class="wrd_brk"  align="right"><? echo number_format($wo_qnty,2);  $tot_wo_quantity += $wo_qnty;?></td>
                                    <td class="wrd_brk" align="right"><? echo number_format($wo_rate,4); ?></td>
                                    <td class="wrd_brk" align="right"><? echo number_format($wo_amt,4);  $tot_wo_amt += $wo_amt;?></td>
                                    <?
                                }
                                ?>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('quantity')],2); $total_quantity += $row[csf('quantity')];?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('rate')],4); ?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('amount')],4); $total_ammount += $row[csf('amount')]; ?></td>
                            </tr>
                            <?
                        }
                        ?>
                        <tr class="tbl_bottom">
                            <?
                            if( $cbo_pi_basis_id == 1) {if ($pi_wo_check) $colspan="14"; else $colspan="11";} else $colspan="10";
                            ?>
                            <td  colspan = "<? echo $colspan; ?>" align="right">Sum</td>
                            <td><? echo number_format($total_quantity,2); $total_quantity = 0;?></td>
                            <td></td>
                            <td><? echo number_format($total_ammount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Upcharge</td>
                            <td><? echo number_format($upcharge,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Discount</td>
                            <td><? echo number_format($discount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Net Total</td>
                            <td><? echo number_format($net_total_amount,4); ?></td>
                        </tr>
                        </tbody>
                    </table>
                    <table>
                        <tr height="20"></tr>
                        <tr>
                            <td valign="top"><strong>In-Words: </strong></td>
                            <td><?

                                if($sql_mst[0][csf('currency_id')]*1==1)
                                {
                                    echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Poisa');

                                }
                                else
                                {
                                    echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Cent');
                                }
                                ?>
                            </td>
                        </tr>
                        <tr>
                        <tr height="50"></tr>
                    </table>
                    <?
                    $approved_sql=sql_select("SELECT  mst_id, approved_by ,approved_date   from approval_history where entry_form in (21,27) AND  mst_id =".$data[1]."  group by mst_id, approved_by,approved_date  order by  approved_by");
                    $approved_his_sql=sql_select("SELECT  mst_id, approved_by ,approved_date,un_approved_reason,un_approved_date,approved_no  from approval_history where entry_form in(21,27) AND  mst_id =".$data[1]." order by  approved_no,approved_date");
                    $user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
                    $user_lib_desg=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
                    $designation_lib=return_library_array("SELECT id,custom_designation from lib_designation", "id", "custom_designation");

                    if(count($approved_sql)>0)
                    {
                        $sl=1;
                        ?>
                        <div style="margin-top:15px">
                            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:900px;text-align:center;" rules="all">
                                <label><b>Pro Forma Invoice Approval Status </b></label>
                                <thead>
                                <tr style="font-weight:bold">
                                    <th width="20">SL</th>
                                    <th width="150">Name</th>
                                    <th width="150">Designation</th>
                                    <th width="50">Approval Status</th>
                                    <th width="100">Approval Date</th>

                                </tr>
                                </thead>
                                <? foreach ($approved_sql as $key => $value)
                                {
                                    ?>
                                    <tr>
                                        <td width="20"><? echo $sl; ?></td>
                                        <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                        <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                        <td width="50">Yes</td>
                                        <td width="100"><? $approved_date=explode(" ",$value[csf("approved_date")]);
                                            echo change_date_format($approved_date[0])." ".$approved_date[1];  ?></td>

                                    </tr>
                                    <?
                                    $sl++;
                                }
                                ?>
                            </table>
                        </div>
                        <?
                    }

                    if(count($approved_his_sql) > 0)
                    {
                        $sl=1;
                        ?>
                        <div style="margin-top:15px">
                            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                                <label><b>Pro Forma Invoice Approval / Un-Approval History </b></label>
                                <thead>
                                <tr style="font-weight:bold">
                                    <th width="20">SL</th>
                                    <th width="150">Approved / Un-Approved</th>
                                    <th width="150">Designation</th>
                                    <th width="50">Approval Status</th>
                                    <th width="150">Reason for Un-Approval</th>
                                    <th width="150">Date</th>
                                </tr>
                                </thead>
                                <? foreach ($approved_his_sql as $key => $value)
                                {
                                    if($sl%2==0)$bgcolor="#E9F3FF";  else $bgcolor="#FFFFFF";
                                    ?>
                                    <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                        <td width="20"><? echo $sl; ?></td>
                                        <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                        <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                        <td width="50">Yes</td>
                                        <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                        <td width="150"><? $approved_date=explode(" ",$value[csf("approved_date")]);

                                            echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                    </tr>

                                    <?
                                    $sl++;
                                    if($value[csf("un_approved_date")] !='0000-00-00 00:00:00' && $value[csf("un_approved_date")] !='')
                                    {
                                        ?>
                                        <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                            <td width="20"><? echo $sl; ?></td>
                                            <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                            <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                            <td width="50">No</td>
                                            <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                            <td width="150"><? $approved_date=explode(" ",$value[csf("un_approved_date")]);

                                                echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                        </tr>

                                        <?
                                        $sl++;

                                    }

                                }
                                ?>
                            </table>
                        </div>
                        <?
                    }
                    ?>
                    <!-- //approved status end-->
                    <br/>
                    <?
                    //signature_table($report_id, $company, $width, $template_id,$padding_top=70)

                    echo signature_table(147, $data[0],"900px",$data[18]);

                }
                else if($entryForm==168) //Services - Fabric
                {
                    ?>
                    <table class="rpt_table" width="100%" cellspacing="1"  border="1" rules="all">
                        <thead>
                        <tr>
                            <? if( $cbo_pi_basis_id == 1 ) { ?>
                                <th style="min-width: 150px;">WO</th>
                            <? } ?>
                            <th style="min-width: 100px;">HS Code</th>
                            <th style="min-width: 100px;">Service Type</th>
                            <th style="min-width: 250px;">Item Description</th>
                            <th style="min-width: 100px;">UOM</th>
                            <th style="min-width: 100px;">Quantity</th>
                            <th style="min-width: 100px;">Rate</th>
                            <th style="min-width: 100px;">Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <?
                        $data_array=sql_select("SELECT a.id,a.pi_id,a.work_order_no,a.item_description,a.uom,a.quantity,a.rate,amount,a.service_type,a.status_active, a.hs_code FROM com_pi_item_details a WHERE  a.pi_id = $data[1] and a.status_active=1 and a.is_deleted=0 ORDER BY a.id ASC");


                        $i = 0;
                        $total_ammount = 0;
                        foreach($data_array as $row)
                        {
                            ?>
                            <tr bgcolor="<? echo $bgcolor; ?>">
                                <? if( $cbo_pi_basis_id == 1 ) { $colspan=5; ?>
                                    <td class="wrd_brk"><? echo $row[csf('work_order_no')]; ?></td>
                                <? } else $colspan=4; ?>
                                <td class="wrd_brk"><? echo $row[csf('hs_code')]; ?></td>
                                <!-- <td class="wrd_brk"><? echo $service_type[$row[csf('service_type')]]; ?></td> -->
                                <td class="wrd_brk"><? echo $conversion_cost_head_array[$row[csf('service_type')]]; ?></td>
                                <td class="wrd_brk"><? echo ($row[csf('item_description')]); ?></td>
                                <td><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('quantity')],2);  $total_quantity += $row[csf('quantity')];?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('rate')],4); ?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('amount')],4);  $total_ammount += $row[csf('amount')];  ?></td>
                            </tr>
                            <?
                        }
                        ?>

                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan; ?>" align="right">Sum</td>
                            <td><? echo number_format($total_quantity,2); $total_quantity = 0;?></td>
                            <td></td>
                            <td><? echo number_format($total_ammount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Upcharge</td>
                            <td><? echo number_format($upcharge,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Discount</td>
                            <td><? echo number_format($discount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Net Total</td>
                            <td><? echo number_format($net_total_amount,4); ?></td>
                        </tr>
                        </tbody>
                    </table>
                    <table>
                        <tr height="20"></tr>
                        <tr>
                            <td valign="top"><strong>In-Words: </strong></td>
                            <td><?

                                if($sql_mst[0][csf('currency_id')]*1==1)
                                {
                                    echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Poisa');

                                }
                                else
                                {
                                    echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Cent');
                                }
                                ?></td>
                        </tr>
                        <tr>
                        <tr height="50"></tr>
                    </table>
                    <?



                    $approved_sql=sql_select("SELECT  mst_id, approved_by ,min(approved_date) as approved_date  from approval_history where entry_form in(21,27) AND  mst_id =".$data[1]."  group by mst_id, approved_by order by  approved_by");
                    $approved_his_sql=sql_select("SELECT  mst_id, approved_by ,approved_date,un_approved_reason,un_approved_date,approved_no  from approval_history where entry_form in(21,27) AND  mst_id =".$data[1]." order by  approved_no,approved_date");
                    $user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
                    $user_lib_desg=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
                    $designation_lib=return_library_array("SELECT id,custom_designation from lib_designation", "id", "custom_designation");


                    ?>
                    <? if(count($approved_sql)>0)
                {
                    $sl=1;
                    ?>
                    <div style="margin-top:15px">
                        <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:900px;text-align:center;" rules="all">
                            <label><b>Pro Forma Invoice Approval Status </b></label>
                            <thead>
                            <tr style="font-weight:bold">
                                <th width="20">SL</th>
                                <th width="250">Name</th>
                                <th width="200">Designation</th>
                                <th width="50">Approval Status</th>
                                <th width="100">Approval Date</th>
                            </tr>
                            </thead>
                            <? foreach ($approved_sql as $key => $value)
                            {
                                ?>
                                <tr>
                                    <td width="20"><? echo $sl; ?></td>
                                    <td width="250"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                    <td width="200"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                    <td width="50">Yes</td>
                                    <td width="100"><? $approved_date=explode(" ",$value[csf("approved_date")]);

                                        echo change_date_format($approved_date[0])." ".$approved_date[1];  ?></td>
                                </tr>
                                <?
                                $sl++;
                            }
                            ?>
                        </table>
                    </div>
                    <?
                }
                    ?>
                    <? if(count($approved_his_sql) > 0)
                {
                    $sl=1;
                    ?>
                    <div style="margin-top:15px">
                        <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                            <label><b>Pro Forma Invoice Approval / Un-Approval History </b></label>
                            <thead>
                            <tr style="font-weight:bold">
                                <th width="20">SL</th>
                                <th width="150">Approved / Un-Approved</th>
                                <th width="150">Designation</th>
                                <th width="50">Approval Status</th>
                                <th width="150">Reason for Un-Approval</th>
                                <th width="150">Date</th>
                            </tr>
                            </thead>
                            <? foreach ($approved_his_sql as $key => $value)
                            {
                                if($sl%2==0)$bgcolor="#E9F3FF";  else $bgcolor="#FFFFFF";
                                ?>
                                <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                    <td width="20"><? echo $sl; ?></td>
                                    <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                    <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                    <td width="50">Yes</td>
                                    <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                    <td width="150"><? $approved_date=explode(" ",$value[csf("approved_date")]);

                                        echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                </tr>

                                <?
                                $sl++;
                                if($value[csf("un_approved_date")] !='0000-00-00 00:00:00' && $value[csf("un_approved_date")] !='')
                                {
                                    ?>
                                    <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                        <td width="20"><? echo $sl; ?></td>
                                        <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                        <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                        <td width="50">No</td>
                                        <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                        <td width="150"><? $approved_date=explode(" ",$value[csf("un_approved_date")]);

                                            echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                    </tr>

                                    <?
                                    $sl++;

                                }

                            }
                            ?>
                        </table>
                    </div>
                    <?
                }
                    ?>
                    <!-- //approved status end-->
                    <br/>
                    <?
                    //signature_table($report_id, $company, $width, $template_id,$padding_top=70)

                    echo signature_table(147, $data[0],"900px",$data[18]);

                }
                else if($entryForm==169) // Services - Yarn Dyeing
                {
                    $yarn_count = return_library_array('SELECT id,yarn_count FROM lib_yarn_count','id','yarn_count');
                    $color_name = return_library_array('SELECT id,color_name FROM lib_color','id','color_name');
                    ?>
                    <table class="rpt_table" width="100%" cellspacing="1"  border="1" rules="all">
                        <thead>
                        <tr>
                            <? if( $cbo_pi_basis_id == 1 ) { ?>
                                <th style="min-width: 90px;">WO</th>
                                <th style="min-width: 90px;">Buyer</th>
                                <th style="min-width: 100px;">Style Ref.</th>
                            <? } ?>
                            <th style="min-width: 50px;">HS Code</th>
                            <th style="min-width: 50px;">Lot</th>
                            <th style="min-width: 50px;">Count</th>
                            <th style="min-width: 100px;">Yarn Description</th>
                            <th style="min-width: 50px;">Yarn Color</th>
                            <th style="min-width: 50px;">Color Range</th>
                            <th style="min-width: 30px;">UOM</th>
                            <?
                            if($pi_basis_id==1 && $pi_wo_check==1)
                            {
                                ?>
                                <th style="min-width: 60px;">WO Qnty</th>
                                <th style="min-width: 50px;">WO Rate</th>
                                <th style="min-width: 60px;">WO Amount</th>
                                <?
                            }
                            ?>
                            <th style="min-width: 60px;">Quantity</th>
                            <th style="min-width: 50px;">Rate</th>
                            <th style="min-width: 60px;">Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <?
                        $data_array=sql_select("SELECT work_order_no, lot_no, count_name, item_description, yarn_color, color_range, uom,quantity, rate, amount, hs_code, work_order_dtls_id
					FROM com_pi_item_details
					WHERE  pi_id = $data[1] and status_active=1 and is_deleted=0
					ORDER BY id ASC");

                        $buyer_style_sql="SELECT a.work_order_dtls_id, c.buyer_name, c.style_ref_no, c.job_no from com_pi_item_details a, wo_yarn_dyeing_dtls b, wo_po_details_master c
					where a.work_order_dtls_id=b.id and b.job_no=c.job_no and a.pi_id = $data[1] and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1
					and a.item_category_id = 24
					group by a.work_order_dtls_id, c.buyer_name, c.style_ref_no, c.job_no";

                        $buyer_style_data_array=sql_select($buyer_style_sql);
                        $buyer_style_array=array();
                        foreach($buyer_style_data_array as $row)
                        {
                            $buyer_style_array[$row[csf('work_order_dtls_id')]]['buyer_name']=$row[csf('buyer_name')];
                            $buyer_style_array[$row[csf('work_order_dtls_id')]]['style_ref_no']=$row[csf('style_ref_no')];
                        }
                        /*echo "<pre>";
                        print_r($buyer_style_array);*/

                        $i = 0; $total_ammount = 0; $total_quantity=0;
                        foreach($data_array as $row)
                        {
                            ?>
                            <tr bgcolor="<? echo $bgcolor; ?>" >
                                <?
                                if( $cbo_pi_basis_id == 1 )
                                {
                                    {if($pi_wo_check)$colspan="13"; else $colspan="9";}
                                    ?>
                                    <td class="wrd_brk"><? echo $row[csf('work_order_no')]; ?></td>
                                    <td class="wrd_brk"><? echo $buyer_library_arr[$buyer_style_array[$row[csf('work_order_dtls_id')]]['buyer_name']]; ?></td>
                                    <td class="wrd_brk"><? echo $buyer_style_array[$row[csf('work_order_dtls_id')]]['style_ref_no']; ?></td>
                                    <?
                                } else $colspan=7;
                                ?>
                                <td class="wrd_brk"><? echo $row[csf('hs_code')]; ?></td>
                                <td class="wrd_brk"><? echo $row[csf('lot_no')]; ?></td>
                                <td class="wrd_brk"><? echo $yarn_count[$row[csf('count_name')]]; ?></td>
                                <td class="wrd_brk"><? echo $row[csf('item_description')]; ?></td>
                                <td class="wrd_brk"><? echo $color_name[$row[csf('yarn_color')]]; ?></td>
                                <td class="wrd_brk"><? echo $color_range[$row[csf('color_range')]]; ?></td>
                                <td class="wrd_brk"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
                                <?
                                if($pi_basis_id==1 && $pi_wo_check==1)
                                {
                                    $wo_qnty=$pi_wo_data[$row[csf('work_order_dtls_id')]]['wo_qnty'];
                                    $wo_amt=$pi_wo_data[$row[csf('work_order_dtls_id')]]['wo_amount'];

                                    $wo_rate=$wo_amt/$wo_qnty;
                                    ?>
                                    <td class="wrd_brk" align="right"><? echo number_format($wo_qnty,2);  $tot_wo_quantity += $wo_qnty;?></td>
                                    <td class="wrd_brk" align="right"><? echo number_format($wo_rate,4); ?></td>
                                    <td class="wrd_brk" align="right"><? echo number_format($wo_amt,4);  $tot_wo_amt += $wo_amt;?></td>
                                    <?
                                }
                                ?>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('quantity')],2);  $total_quantity += $row[csf('quantity')];?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('rate')],4); ?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('amount')],4);  $total_ammount += $row[csf('amount')];  ?></td>
                            </tr>
                            <?
                        }
                        ?>
                        <tr class="tbl_bottom" height="25">
                            <td colspan="<? echo $colspan; ?>" align="right">Sum</td>
                            <td><? echo number_format($total_quantity,2); ?></td>
                            <td></td>
                            <td><? echo number_format($total_ammount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Upcharge</td>
                            <td><? echo number_format($upcharge,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Discount</td>
                            <td><? echo number_format($discount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Net Total</td>
                            <td><? echo number_format($net_total_amount,4); ?></td>
                        </tr>
                        </tbody>
                    </table>
                    <table>
                        <tr height="20"></tr>
                        <tr>
                            <td valign="top"><strong>In-Words: </strong></td>
                            <td><?

                                if($sql_mst[0][csf('currency_id')]*1==1)
                                {
                                    echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Poisa');

                                }
                                else
                                {
                                    echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Cent');
                                }
                                ?></td>
                        </tr>
                        <tr>
                        <tr height="50"></tr>
                    </table>
                    <?



                    $approved_sql=sql_select("SELECT  mst_id, approved_by ,min(approved_date) as approved_date  from approval_history where entry_form in (21,27) AND  mst_id =".$data[1]."  group by mst_id, approved_by order by  approved_by");
                    $approved_his_sql=sql_select("SELECT  mst_id, approved_by ,approved_date,un_approved_reason,un_approved_date,approved_no  from approval_history where entry_form in(21,27) AND  mst_id =".$data[1]." order by  approved_no,approved_date");
                    $user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
                    $user_lib_desg=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
                    $designation_lib=return_library_array("SELECT id,custom_designation from lib_designation", "id", "custom_designation");

                    if(count($approved_sql)>0)
                    {
                        $sl=1;
                        ?>
                        <div style="margin-top:15px">
                            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:900px;text-align:center;" rules="all">
                                <label><b>Pro Forma Invoice Approval Status </b></label>
                                <thead>
                                <tr style="font-weight:bold">
                                    <th width="20">SL</th>
                                    <th width="150">Name</th>
                                    <th width="150">Designation</th>
                                    <th width="50">Approval Status</th>
                                    <th width="100">Approval Date</th>

                                </tr>
                                </thead>
                                <? foreach ($approved_sql as $key => $value)
                                {
                                    ?>
                                    <tr>
                                        <td width="20"><? echo $sl; ?></td>
                                        <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                        <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                        <td width="50">Yes</td>
                                        <td width="100"><? $approved_date=explode(" ",$value[csf("approved_date")]);
                                            echo change_date_format($approved_date[0])." ".$approved_date[1];  ?></td>

                                    </tr>
                                    <?
                                    $sl++;
                                }
                                ?>
                            </table>
                        </div>
                        <?
                    }

                    if(count($approved_his_sql) > 0)
                    {
                        $sl=1;
                        ?>
                        <div style="margin-top:15px">
                            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                                <label><b>Pro Forma Invoice Approval / Un-Approval History </b></label>
                                <thead>
                                <tr style="font-weight:bold">
                                    <th width="20">SL</th>
                                    <th width="150">Approved / Un-Approved</th>
                                    <th width="150">Designation</th>
                                    <th width="50">Approval Status</th>
                                    <th width="150">Reason for Un-Approval</th>
                                    <th width="150">Date</th>
                                </tr>
                                </thead>
                                <? foreach ($approved_his_sql as $key => $value)
                                {
                                    if($sl%2==0)$bgcolor="#E9F3FF";  else $bgcolor="#FFFFFF";
                                    ?>
                                    <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                        <td width="20"><? echo $sl; ?></td>
                                        <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                        <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                        <td width="50">Yes</td>
                                        <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                        <td width="150"><? $approved_date=explode(" ",$value[csf("approved_date")]);

                                            echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                    </tr>

                                    <?
                                    $sl++;
                                    if($value[csf("un_approved_date")] !='0000-00-00 00:00:00' && $value[csf("un_approved_date")] !='')
                                    {
                                        ?>
                                        <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                            <td width="20"><? echo $sl; ?></td>
                                            <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                            <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                            <td width="50">No</td>
                                            <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                            <td width="150"><? $approved_date=explode(" ",$value[csf("un_approved_date")]);

                                                echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                        </tr>

                                        <?
                                        $sl++;

                                    }

                                }
                                ?>
                            </table>
                        </div>
                        <?
                    }
                    ?>
                    <!-- //approved status end-->
                    <br/>
                    <?
                    //signature_table($report_id, $company, $width, $template_id,$padding_top=70)

                    echo signature_table(147, $data[0],"900px",$data[18]);
                }
                else if($entryForm==170) // Services - Embroidery, Services - Printing, Services - Wash
                {
                    $color_name = return_library_array('SELECT id,color_name FROM lib_color','id','color_name');
                    ?>
                    <table class="rpt_table" width="100%" cellspacing="1"  border="1" rules="all">
                        <thead>
                        <tr>
                            <? if( $cbo_pi_basis_id == 1 ) { ?>
                                <th style="min-width: 90px;">WO</th>
                                <th style="min-width: 90px;">Buyer</th>
                                <th style="min-width: 100px;">Style Ref.</th>
                            <? } ?>
                            <th style="min-width: 60px;">HS Code</th>
                            <th style="min-width: 60px;">Gmts Item</th>
                            <th style="min-width: 80px;">Embellishment Name</th>
                            <th style="min-width: 80px;">Embellishment Type</th>
                            <th style="min-width: 60px;">Gmts Color</th>
                            <th style="min-width: 40px;">UOM</th>
                            <?
                            if($pi_basis_id==1 && $pi_wo_check==1)
                            {
                                ?>
                                <th style="min-width: 60px;">WO Qnty</th>
                                <th style="min-width: 50px;">WO Rate</th>
                                <th style="min-width: 60px;">WO Amount</th>
                                <?
                            }
                            ?>
                            <th style="min-width: 60px;">Quantity</th>
                            <th style="min-width: 50px;">Rate</th>
                            <th style="min-width: 60px;">Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <?
                        $data_array=sql_select("SELECT work_order_no, gmts_item_id, embell_name, embell_type, color_id, uom, quantity, rate, amount, hs_code, work_order_dtls_id FROM com_pi_item_details WHERE  pi_id = $data[1] and status_active=1 and is_deleted=0 ORDER BY id ASC");

                        $buyer_style_sql="SELECT a.work_order_dtls_id, c.buyer_name, c.style_ref_no, c.job_no, 3 as type
					from com_pi_item_details a, wo_booking_dtls b, wo_po_details_master c
					where a.work_order_dtls_id = b.id and b.job_no = c.job_no and a.pi_id = $data[1] and a.is_deleted = 0 and a.status_active = 1 and b.is_deleted = 0 and b.status_active = 1 and c.is_deleted = 0 and c.status_active = 1
					and a.item_category_id in(25) group by a.work_order_dtls_id, c.buyer_name, c.style_ref_no, c.job_no";

                        $buyer_style_data_array=sql_select($buyer_style_sql);
                        $buyer_style_array=array();
                        foreach($buyer_style_data_array as $row)
                        {
                            $buyer_style_array[$row[csf('work_order_dtls_id')]]['buyer_name']=$row[csf('buyer_name')];
                            $buyer_style_array[$row[csf('work_order_dtls_id')]]['style_ref_no']=$row[csf('style_ref_no')];
                        }
                        /*echo "<pre>";
                        print_r($buyer_style_array);*/


                        $i = 0; $total_ammount = 0; $total_quantity=0;
                        foreach($data_array as $row)
                        {
                            $emb_arr=array();
                            if($row[csf('embell_name')]==1) $emb_arr=$emblishment_print_type;
                            else if($row[csf('embell_name')]==2) $emb_arr=$emblishment_embroy_type;
                            else if($row[csf('embell_name')]==3) $emb_arr=$emblishment_wash_type;
                            else if($row[csf('embell_name')]==4) $emb_arr=$emblishment_spwork_type;
                            else $emb_arr=$blank_array;
                            ?>
                            <tr bgcolor="<? echo $bgcolor; ?>" >
                                <? if( $cbo_pi_basis_id == 1 )
                                {
                                    if ($pi_wo_check) $colspan="12"; else $colspan="9";
                                    ?>
                                    <td class="wrd_brk"><? echo $row[csf('work_order_no')]; ?></td>
                                    <td class="wrd_brk"><? echo $buyer_library_arr[$buyer_style_array[$row[csf('work_order_dtls_id')]]['buyer_name']]; ?></td>
                                    <td class="wrd_brk"><? echo $buyer_style_array[$row[csf('work_order_dtls_id')]]['style_ref_no']; ?></td>
                                    <?
                                } else $colspan=6; ?>
                                <td class="wrd_brk"><? echo $garments_item[$row[csf('hs_code')]]; ?></td>
                                <td class="wrd_brk"><? echo $garments_item[$row[csf('gmts_item_id')]]; ?></td>
                                <td class="wrd_brk"><? echo $emblishment_name_array[$row[csf('embell_name')]]; ?></td>
                                <td class="wrd_brk"><? echo $emb_arr[$row[csf('embell_type')]]; ?></td>
                                <td class="wrd_brk"><? echo $color_name[$row[csf('color_id')]]; ?></td>
                                <td class="wrd_brk"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
                                <?
                                if($pi_basis_id==1 && $pi_wo_check==1)
                                {
                                    $wo_qnty=$pi_wo_data[$row[csf('work_order_dtls_id')]]['wo_qnty'];
                                    $wo_amt=$pi_wo_data[$row[csf('work_order_dtls_id')]]['wo_amount'];

                                    $wo_rate=$wo_amt/$wo_qnty;
                                    ?>
                                    <td class="wrd_brk" align="right"><? echo number_format($wo_qnty,2);  $tot_wo_quantity += $wo_qnty;?></td>
                                    <td class="wrd_brk" align="right"><? echo number_format($wo_rate,4); ?></td>
                                    <td class="wrd_brk" align="right"><? echo number_format($wo_amt,4);  $tot_wo_amt += $wo_amt;?></td>
                                    <?
                                }
                                ?>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('quantity')],2);  $total_quantity += $row[csf('quantity')];?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('rate')],4); ?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('amount')],4);  $total_ammount += $row[csf('amount')];  ?></td>
                            </tr>
                            <?
                        }
                        ?>
                        <tr class="tbl_bottom" height="25">
                            <td colspan="<? echo $colspan; ?>" align="right">Sum</td>
                            <td><? echo number_format($total_quantity,2); ?></td>
                            <td></td>
                            <td><? echo number_format($total_ammount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Upcharge</td>
                            <td><? echo number_format($upcharge,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Discount</td>
                            <td><? echo number_format($discount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Net Total</td>
                            <td><? echo number_format($net_total_amount,4); ?></td>
                        </tr>
                        </tbody>
                    </table>
                    <table>
                        <tr height="20"></tr>
                        <tr>
                            <td valign="top"><strong>In-Words: </strong></td>
                            <td><?

                                if($sql_mst[0][csf('currency_id')]*1==1)
                                {
                                    echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Poisa');

                                }
                                else
                                {
                                    echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Cent');
                                }
                                ?></td>
                        </tr>
                        <tr>
                        <tr height="50"></tr>
                    </table>
                    <?



                    $approved_sql=sql_select("SELECT  mst_id, approved_by ,min(approved_date) as approved_date  from approval_history where entry_form in (21,27) AND  mst_id =".$data[1]."  group by mst_id, approved_by order by  approved_by");
                    $approved_his_sql=sql_select("SELECT  mst_id, approved_by ,approved_date,un_approved_reason,un_approved_date,approved_no  from approval_history where entry_form in(21,27) AND  mst_id =".$data[1]." order by  approved_no,approved_date");
                    $user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
                    $user_lib_desg=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
                    $designation_lib=return_library_array("SELECT id,custom_designation from lib_designation", "id", "custom_designation");

                    if(count($approved_sql)>0)
                    {
                        $sl=1;
                        ?>
                        <div style="margin-top:15px">
                            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:900px;text-align:center;" rules="all">
                                <label><b>Pro Forma Invoice Approval Status </b></label>
                                <thead>
                                <tr style="font-weight:bold">
                                    <th width="20">SL</th>
                                    <th width="150">Name</th>
                                    <th width="150">Designation</th>
                                    <th width="50">Approval Status</th>
                                    <th width="100">Approval Date</th>

                                </tr>
                                </thead>
                                <? foreach ($approved_sql as $key => $value)
                                {
                                    ?>
                                    <tr>
                                        <td width="20"><? echo $sl; ?></td>
                                        <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                        <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                        <td width="50">Yes</td>
                                        <td width="100"><? $approved_date=explode(" ",$value[csf("approved_date")]);
                                            echo change_date_format($approved_date[0])." ".$approved_date[1];  ?></td>

                                    </tr>
                                    <?
                                    $sl++;
                                }
                                ?>
                            </table>
                        </div>
                        <?
                    }

                    if(count($approved_his_sql) > 0)
                    {
                        $sl=1;
                        ?>
                        <div style="margin-top:15px">
                            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                                <label><b>Pro Forma Invoice Approval / Un-Approval History </b></label>
                                <thead>
                                <tr style="font-weight:bold">
                                    <th width="20">SL</th>
                                    <th width="150">Approved / Un-Approved</th>
                                    <th width="150">Designation</th>
                                    <th width="50">Approval Status</th>
                                    <th width="150">Reason for Un-Approval</th>
                                    <th width="150">Date</th>
                                </tr>
                                </thead>
                                <? foreach ($approved_his_sql as $key => $value)
                                {
                                    if($sl%2==0)$bgcolor="#E9F3FF";  else $bgcolor="#FFFFFF";
                                    ?>
                                    <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                        <td width="20"><? echo $sl; ?></td>
                                        <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                        <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                        <td width="50">Yes</td>
                                        <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                        <td width="150"><? $approved_date=explode(" ",$value[csf("approved_date")]);

                                            echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                    </tr>

                                    <?
                                    $sl++;
                                    if($value[csf("un_approved_date")] !='0000-00-00 00:00:00' && $value[csf("un_approved_date")] !='')
                                    {
                                        ?>
                                        <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                            <td width="20"><? echo $sl; ?></td>
                                            <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                            <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                            <td width="50">No</td>
                                            <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                            <td width="150"><? $approved_date=explode(" ",$value[csf("un_approved_date")]);

                                                echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                        </tr>

                                        <?
                                        $sl++;

                                    }

                                }
                                ?>
                            </table>
                        </div>
                        <?
                    }
                    ?>
                    <!-- //approved status end-->
                    <br/>
                    <?
                    //signature_table($report_id, $company, $width, $template_id,$padding_top=70)

                    echo signature_table(147, $data[0],"900px",$data[18]);
                    ?>
                    <?
                }
                else if($entryForm==171) // Services Lab Test
                {
                    $color_name = return_library_array('SELECT id,color_name FROM lib_color','id','color_name');
                    $test_item_arr=return_library_array( "SELECT id,test_item FROM lib_lab_test_rate_chart",'id','test_item');
                    $buyer_arr=return_library_array( "SELECT id,buyer_name FROM lib_buyer",'id','buyer_name');

                    ?>
                    <table class="rpt_table" width="100%" cellspacing="1"  border="1" rules="all">
                        <thead>
                        <tr>
                            <?
                            if ( $cbo_pi_basis_id == 1) $colspan=9;
                            else if ( $cbo_pi_basis_id == 2) $colspan=6;
                            else $colspan=7;
                            if( $cbo_pi_basis_id == 1 ) {  ?>
                                <th style="min-width: 100px;">WO</th>
                                <th style="min-width: 100px;">Buyer</th>
                            <? } ?>
                            <th style="min-width: 100px;">HS Code</th>
                            <th style="min-width: 100px;">Style Ref.</th>
                            <th style="min-width: 100px;">Test For</th>
                            <th style="min-width: 100px;">Remarks</th>
                            <th style="min-width: 100px;">Color</th>
                            <th style="min-width: 100px;">Test Item</th>
                            <?
                            if($pi_basis_id==1 && $pi_wo_check==1)
                            {
                                ?>
                                <th style="min-width: 100px;">WO Amount</th>
                                <?
                            }
                            ?>
                            <th style="min-width: 100px;">Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <?
                        if( $cbo_pi_basis_id == 2 )  //Independent
                        {
                            $data_array=sql_select("SELECT a.work_order_no, a.test_for, a.test_item_id, a.remarks, a.color_id, a.amount, a.hs_code FROM com_pi_item_details a WHERE a.pi_id = $data[1] and a.status_active=1 and a.is_deleted=0 ORDER BY a.id ASC");
                        }
                        else
                        {
                            $data_array=sql_select("SELECT b.id as labtest_mst_id,  a.work_order_no, a.test_for, a.test_item_id, a.remarks, a.color_id, a.amount, a.hs_code, a.work_order_dtls_id FROM com_pi_item_details a,WO_LABTEST_MST b WHERE a.work_order_no=b.labtest_no and  a.pi_id = $data[1] and a.status_active=1 and a.is_deleted=0 ORDER BY a.id ASC");
                        }

                        $i = 0; $total_ammount = 0;
                        foreach($data_array as $row)
                        {
                            $mst_id=$row[csf('labtest_mst_id')];
                            if ($mst_id != ''){
                                $job_no_sql=sql_select("SELECT job_no FROM  WO_LABTEST_DTLS where mst_id='$mst_id'");
                            }

                            //echo "SELECT job_no FROM  WO_LABTEST_DTLS where mst_id='$mst_id'";
                            $style_ref_no=''; $buyerName='';
                            $unique_data=array(); $buyer_unique_data=array();
                            foreach($job_no_sql as $job_no_value)
                            {
                                $job_no=$job_no_value[csf('job_no')];
                                if ($job_no !=''){
                                    $style_ref_no_sql=sql_select("SELECT style_ref_no, buyer_name FROM  WO_PO_DETAILS_MASTER  where job_no='$job_no'");
                                }


                                $style_ref_no_get=$style_ref_no_sql[0][csf('style_ref_no')];
                                $buyer_name_get=$buyer_arr[$style_ref_no_sql[0][csf('buyer_name')]];
                                if(!in_array($style_ref_no_get,$unique_data))
                                {
                                    array_push($unique_data,$style_ref_no_get);
                                    $style_ref_no.=$style_ref_no_get.',';
                                }
                                if(!in_array($buyer_name_get,$buyer_unique_data))
                                {
                                    array_push($buyer_unique_data,$buyer_name_get);
                                    $buyerName.=$buyer_name_get.',';
                                }
                            }
                            //echo "SELECT style_ref_no FROM  WO_PO_DETAILS_MASTER  where job_no='$job_no'";
                            $test_item='';
                            $test_item_ids=array_unique(explode(",",$row[csf('test_item_id')]));
                            foreach($test_item_ids as $test_item_id)
                            {
                                $test_item.=$test_item_arr[$test_item_id].",";
                            }
                            $test_item=chop($test_item,',');
                            ?>
                            <tr bgcolor="<? echo $bgcolor; ?>" >
                                <? if( $cbo_pi_basis_id == 1 ) { ?>
                                    <td class="wrd_brk"><? echo $row[csf('work_order_no')]; ?></td>
                                    <td class="wrd_brk"><? echo chop($buyerName,','); ?></td>
                                <? } ?>
                                <td class="wrd_brk"><? echo $row[csf('hs_code')]; ?></td>
                                <td class="wrd_brk"><? echo $style_ref_no; ?></td>
                                <td class="wrd_brk"><? echo $test_for[$row[csf('test_for')]]; ?></td>
                                <td class="wrd_brk"><? echo $row[csf('remarks')]; ?></td>
                                <td class="wrd_brk"><? echo $color_name[$row[csf('color_id')]]; ?></td>
                                <td class="wrd_brk"><? echo $test_item; ?></td>
                                <?
                                if($pi_basis_id==1 && $pi_wo_check==1)
                                {
                                    $wo_amt=$pi_wo_data[$row[csf('work_order_dtls_id')]]['wo_amount'];
                                    ?>
                                    <td class="wrd_brk" align="right"><? echo number_format($wo_amt,4);  $tot_wo_amt += $wo_amt;?></td>
                                    <?
                                }
                                ?>
                                <td  class="wrd_brk" align="right"><? echo number_format($row[csf('amount')],4);  $total_ammount += $row[csf('amount')];  ?></td>
                            </tr>
                            <?
                        }
                        ?>
                        <tr class="tbl_bottom" height="25">
                            <td colspan="<? echo $colspan; ?>" align="right">Sum</td>
                            <td colspan="2"><? echo number_format($total_ammount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan; ?>" align="right">Upcharge</td>
                            <td colspan="2"><? echo number_format($upcharge,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan; ?>" align="right">Discount</td>
                            <td colspan="2"><? echo number_format($discount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan; ?>" align="right">Net Total</td>
                            <td colspan="2"><? echo number_format($net_total_amount,4); ?></td>
                        </tr>
                        </tbody>
                    </table>
                    <table>
                        <tr height="20"></tr>
                        <tr>
                            <td valign="top"><strong>In-Words: </strong></td>
                            <td><?
                                if($sql_mst[0][csf('currency_id')]*1==1)
                                {
                                    echo number_to_words(number_format($net_total_amount,2),$currency[$sql_mst[0][csf('currency_id')]],'Poisa');

                                }
                                else
                                {
                                    echo number_to_words(number_format($net_total_amount,2),$currency[$sql_mst[0][csf('currency_id')]],'Cent');
                                }
                                ?>
                            </td>
                        </tr>
                        <tr>
                        <tr height="50"></tr>
                    </table>
                    <?

                    $approved_sql=sql_select("SELECT  mst_id, approved_by ,min(approved_date) as approved_date  from approval_history where entry_form in (21,27) AND  mst_id =".$data[1]."  group by mst_id, approved_by order by  approved_by");
                    $approved_his_sql=sql_select("SELECT  mst_id, approved_by ,approved_date,un_approved_reason,un_approved_date,approved_no  from approval_history where entry_form in(21,27) AND  mst_id =".$data[1]." order by  approved_no,approved_date");
                    $user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
                    $user_lib_desg=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
                    $designation_lib=return_library_array("SELECT id,custom_designation from lib_designation", "id", "custom_designation");

                    if(count($approved_sql)>0)
                    {
                        $sl=1;
                        ?>
                        <div style="margin-top:15px">
                            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:900px;text-align:center;" rules="all">
                                <label><b>Pro Forma Invoice Approval Status </b></label>
                                <thead>
                                <tr style="font-weight:bold">
                                    <th width="20">SL</th>
                                    <th width="150">Name</th>
                                    <th width="150">Designation</th>
                                    <th width="50">Approval Status</th>
                                    <th width="100">Approval Date</th>

                                </tr>
                                </thead>
                                <? foreach ($approved_sql as $key => $value)
                                {
                                    ?>
                                    <tr>
                                        <td width="20"><? echo $sl; ?></td>
                                        <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                        <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                        <td width="50">Yes</td>
                                        <td width="100"><? $approved_date=explode(" ",$value[csf("approved_date")]);
                                            echo change_date_format($approved_date[0])." ".$approved_date[1];  ?></td>

                                    </tr>
                                    <?
                                    $sl++;
                                }
                                ?>
                            </table>
                        </div>
                        <?
                    }

                    if(count($approved_his_sql) > 0)
                    {
                        $sl=1;
                        ?>
                        <div style="margin-top:15px">
                            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                                <label><b>Pro Forma Invoice Approval / Un-Approval History </b></label>
                                <thead>
                                <tr style="font-weight:bold">
                                    <th width="20">SL</th>
                                    <th width="150">Approved / Un-Approved</th>
                                    <th width="150">Designation</th>
                                    <th width="50">Approval Status</th>
                                    <th width="150">Reason for Un-Approval</th>
                                    <th width="150">Date</th>
                                </tr>
                                </thead>
                                <? foreach ($approved_his_sql as $key => $value)
                                {
                                    if($sl%2==0)$bgcolor="#E9F3FF";  else $bgcolor="#FFFFFF";
                                    ?>
                                    <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                        <td width="20"><? echo $sl; ?></td>
                                        <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                        <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                        <td width="50">Yes</td>
                                        <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                        <td width="150"><? $approved_date=explode(" ",$value[csf("approved_date")]);

                                            echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                    </tr>

                                    <?
                                    $sl++;
                                    if($value[csf("un_approved_date")] !='0000-00-00 00:00:00' && $value[csf("un_approved_date")] !='')
                                    {
                                        ?>
                                        <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                            <td width="20"><? echo $sl; ?></td>
                                            <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                            <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                            <td width="50">No</td>
                                            <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                            <td width="150"><? $approved_date=explode(" ",$value[csf("un_approved_date")]);

                                                echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                        </tr>

                                        <?
                                        $sl++;

                                    }

                                }
                                ?>
                            </table>
                        </div>
                        <?
                    }
                    ?>
                    <!-- //approved status end-->
                    <br/>
                    <?
                    //signature_table($report_id, $company, $width, $template_id,$padding_top=70)

                    echo signature_table(147, $data[0],"900px",$data[18]);
                    ?>
                    <?
                }
                else if($entryForm==227) // Chemicals, Dyes, Auxilary Chemicals, Dyes Chemicals & Auxilary Chemicals
                {


                    ?>
                    <table class="rpt_table" width="100%" cellspacing="1"  border="1" rules="all">
                        <thead>
                        <tr>
                            <? if( $cbo_pi_basis_id == 1 ) { ?>
                                <th class="header" style="min-width: 100px;">WO</th>
                            <? } ?>
                            <th class="header" style="min-width: 100px;">HS Code</th>
                            <th class="header" style="min-width: 140px;">Item Group</th>
                            <th class="header" style="min-width: 200px;">Item Description</th>
                            <th class="header" style="min-width: 100px;">Item Size</th>
                            <th class="header" style="min-width: 60px;">UOM</th>
                            <th class="header" style="min-width: 100px;">Quantity</th>
                            <th class="header" style="min-width: 100px;">Rate</th>
                            <th class="header" style="min-width: 100px;">Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <?
                        $data_array=sql_select("SELECT a.id,a.pi_id, a.work_order_no, a.color_id, a.item_group, a.item_description, a.gsm,a.dia_width,a.uom,a.quantity,a.rate,amount,a.service_type,a.status_active,a.item_size, a.hs_code FROM com_pi_item_details a WHERE a.pi_id = $data[1] and a.status_active=1 and a.is_deleted=0 ORDER BY a.id ASC");

                        $item_group_library = return_library_array('SELECT id, item_name FROM lib_item_group','id','item_name');

                        $i = 0;
                        $total_ammount = 0;
                        foreach($data_array as $row)
                        {
                            ?>
                            <tr bgcolor="<? echo $bgcolor; ?>"  height="25" >
                                <? if( $cbo_pi_basis_id == 1 ) { ?>
                                    <td class="wrd_brk"><? echo $row[csf('work_order_no')]; ?></td>
                                <? } ?>
                                <td class="wrd_brk"><? echo $row[csf('hs_code')]; ?></td>
                                <td class="wrd_brk"><? echo $item_group_library[$row[csf('item_group')]]; ?></td>
                                <td class="wrd_brk"><? echo $row[csf('item_description')]; ?></td>
                                <td class="wrd_brk"><? echo $row[csf('item_size')]; ?></td>
                                <td class="wrd_brk"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('quantity')],2);  $total_quantity += $row[csf('quantity')];?></td>
                                <td class="wrd_brk" align="right"><? echo $row[csf('rate')]; ?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('amount')],4);  $total_ammount += $row[csf('amount')]; ?></td>
                            </tr>
                            <?
                        }
                        ?>
                        <tr class="tbl_bottom" height="25">
                            <?
                            if( $cbo_pi_basis_id == 1) $colspan="6"; else $colspan="5";
                            ?>
                            <td  colspan = "<? echo $colspan; ?>" align="right">Sum</td>
                            <td><? echo number_format($total_quantity,2); $total_quantity = 0;?></td>
                            <td></td>
                            <td><? echo number_format($total_ammount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Upcharge</td>
                            <td><? echo number_format($upcharge,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Discount</td>
                            <td><? echo number_format($discount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Net Total</td>
                            <td><? echo number_format($net_total_amount,4); ?></td>
                        </tr>
                        </tbody>
                    </table>
                    <table>
                        <tr height="20"></tr>
                        <tr>
                            <td valign="top"><strong>In-Words: </strong></td>
                            <td><?

                                if($sql_mst[0][csf('currency_id')]*1==1)
                                {
                                    echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Poisa');

                                }
                                else
                                {
                                    echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Cent');
                                }
                                ?></td>
                        </tr>
                        <tr>
                        <tr height="50"></tr>
                    </table>
                    <?



                    $approved_sql=sql_select("SELECT  mst_id, approved_by ,min(approved_date) as approved_date  from approval_history where entry_form in (21,27) AND  mst_id =".$data[1]."  group by mst_id, approved_by order by  approved_by ");
                    $approved_his_sql=sql_select("SELECT  mst_id, approved_by ,approved_date,un_approved_reason,un_approved_date,approved_no  from approval_history where entry_form in(21,27) AND  mst_id =".$data[1]." order by  approved_no,approved_date");
                    $user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
                    $user_lib_desg=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
                    $designation_lib=return_library_array("SELECT id,custom_designation from lib_designation", "id", "custom_designation");


                    ?>
                    <? if(count($approved_sql)>0)
                {
                    $sl=1;
                    ?>
                    <div style="margin-top:15px">
                        <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:900px;text-align:center;" rules="all">
                            <label><b>Pro Forma Invoice Approval Status </b></label>
                            <thead>
                            <tr style="font-weight:bold">
                                <th width="20">SL</th>
                                <th width="250">Name</th>
                                <th width="200">Designation</th>
                                <th width="50">Approval Status</th>
                                <th width="100">Approval Date</th>
                            </tr>
                            </thead>
                            <? foreach ($approved_sql as $key => $value)
                            {
                                ?>
                                <tr>
                                    <td width="20"><? echo $sl; ?></td>
                                    <td width="250"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                    <td width="200"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                    <td width="50">Yes</td>
                                    <td width="100"><? $approved_date=explode(" ",$value[csf("approved_date")]);

                                        echo change_date_format($approved_date[0])." ".$approved_date[1];  ?></td>
                                </tr>
                                <?
                                $sl++;
                            }
                            ?>
                        </table>
                    </div>
                    <?
                }
                    ?>
                    <? if(count($approved_his_sql) > 0)
                {
                    $sl=1;
                    ?>
                    <div style="margin-top:15px">
                        <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                            <label><b>Pro Forma Invoice Approval / Un-Approval History </b></label>
                            <thead>
                            <tr style="font-weight:bold">
                                <th width="20">SL</th>
                                <th width="150">Approved / Un-Approved</th>
                                <th width="150">Designation</th>
                                <th width="50">Approval Status</th>
                                <th width="150">Reason for Un-Approval</th>
                                <th width="150">Date</th>
                            </tr>
                            </thead>
                            <? foreach ($approved_his_sql as $key => $value)
                            {
                                if($sl%2==0)$bgcolor="#E9F3FF";  else $bgcolor="#FFFFFF";
                                ?>
                                <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                    <td width="20"><? echo $sl; ?></td>
                                    <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                    <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                    <td width="50">Yes</td>
                                    <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                    <td width="150"><? $approved_date=explode(" ",$value[csf("approved_date")]);

                                        echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                </tr>

                                <?
                                $sl++;
                                if($value[csf("un_approved_date")] !='0000-00-00 00:00:00' && $value[csf("un_approved_date")] !='')
                                {
                                    ?>
                                    <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                        <td width="20"><? echo $sl; ?></td>
                                        <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                        <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                        <td width="50">No</td>
                                        <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                        <td width="150"><? $approved_date=explode(" ",$value[csf("un_approved_date")]);

                                            echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                    </tr>

                                    <?
                                    $sl++;

                                }

                            }
                            ?>
                        </table>
                    </div>
                    <?
                }
                    ?>
                    <!-- //approved status end-->
                    <br/>
                    <?
                    //signature_table($report_id, $company, $width, $template_id,$padding_top=70)

                    echo signature_table(147, $data[0],"900px",$data[18]);
                    ?>
                    <?
                }
                else // Others
                {
                    ?>
                    <table class="rpt_table" width="100%" cellspacing="1"  border="1" rules="all">
                        <thead>
                        <tr>
                            <? if( $cbo_pi_basis_id == 1 ) { ?>
                                <th style="min-width: 100px;">WO</th>
                            <? }?>
                            <th style="min-width: 100px;">HS Code</th>
                            <th style="min-width: 150px;">Item Group</th>
                            <th style="min-width: 200px;">Item Description</th>
                            <th style="min-width: 100px;">Item Size</th>
                            <th style="min-width: 50px;">UOM</th>
                            <th style="min-width: 100px;">Quantity</th>
                            <th style="min-width: 100px;">Rate</th>
                            <th style="min-width: 100px;">Amount</th>
                        </tr>
                        </thead>
                        <tbody>
                        <?
                        $data_array=sql_select("SELECT a.id,a.pi_id,a.work_order_no,a.color_id,a.item_group,a.item_description,a.gsm,a.dia_width,a.uom,a.quantity,a.rate,amount,a.service_type,a.status_active,a.item_size, a.hs_code FROM com_pi_item_details a WHERE a.pi_id = $data[1] and a.status_active=1 and a.is_deleted=0 ORDER BY a.id ASC");

                        $item_group_library = return_library_array('SELECT id, item_name FROM lib_item_group','id','item_name');
                        $i = 0;
                        $total_ammount = 0;
                        foreach($data_array as $row)
                        {
                            ?>
                            <tr bgcolor="<? echo $bgcolor; ?>" height="25" >
                                <? if( $cbo_pi_basis_id == 1 ) { ?>
                                    <td class="wrd_brk"><? echo $row[csf('work_order_no')]; ?></td>
                                <? }  ?>
                                <td class="wrd_brk"><? echo $row[csf('hs_code')]; ?></td>
                                <td class="wrd_brk"><? echo $item_group_library[$row[csf('item_group')]]; ?></td>
                                <td class="wrd_brk"><? echo $row[csf('item_description')]; ?></td>
                                <td class="wrd_brk"><? echo $row[csf('item_size')]; ?></td>
                                <td class="wrd_brk"><? echo $unit_of_measurement[$row[csf('uom')]]; ?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('quantity')],2); $total_quantity += $row[csf('quantity')];?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('rate')],4); ?></td>
                                <td class="wrd_brk" align="right"><? echo number_format($row[csf('amount')],4); $total_ammount += $row[csf('amount')]; ?></td>
                            </tr>
                            <?
                        }
                        ?>
                        <tr class="tbl_bottom" height="25">
                            <?
                            if( $cbo_pi_basis_id == 1) $colspan="6"; else $colspan="5";
                            ?>
                            <td  colspan = "<? echo $colspan; ?>" align="right">Sum</td>
                            <td><? echo number_format($total_quantity,2); $total_quantity = 0;?></td>
                            <td></td>
                            <td><? echo number_format($total_ammount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Upcharge</td>
                            <td><? echo number_format($upcharge,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Discount</td>
                            <td><? echo number_format($discount,4); ?></td>
                        </tr>
                        <tr class="tbl_bottom" height="25">
                            <td  colspan = "<? echo $colspan+2; ?>" align="right">Net Total</td>
                            <td><? echo number_format($net_total_amount,4); ?></td>
                        </tr>
                        </tbody>
                    </table>
                    <table>
                        <tr height="20"></tr>
                        <tr>
                            <td valign="top"><strong>In-Words: </strong></td>
                            <td><?

                                if($sql_mst[0][csf('currency_id')]*1==1)
                                {
                                    echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Poisa');

                                }
                                else
                                {
                                    echo number_to_words(number_format($net_total_amount,2, '.', ''),$currency[$sql_mst[0][csf('currency_id')]],'Cent');
                                }
                                ?></td>
                        </tr>
                        <tr>
                        <tr height="50"></tr>
                    </table>
                    <?



                    $approved_sql=sql_select("SELECT  mst_id, approved_by ,min(approved_date) as approved_date  from approval_history where entry_form in (21,27) AND  mst_id =".$data[1]."  group by mst_id, approved_by order by  approved_by");
                    $approved_his_sql=sql_select("SELECT  mst_id, approved_by ,approved_date,un_approved_reason,un_approved_date,approved_no  from approval_history where entry_form in(21,27) AND  mst_id =".$data[1]." order by  approved_no,approved_date");
                    $user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
                    $user_lib_desg=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
                    $designation_lib=return_library_array("SELECT id,custom_designation from lib_designation", "id", "custom_designation");


                    ?>
                    <? if(count($approved_sql)>0)
                {
                    $sl=1;
                    ?>
                    <div style="margin-top:15px">
                        <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:900px;text-align:center;" rules="all">
                            <label><b>Pro Forma Invoice Approval Status </b></label>
                            <thead>
                            <tr style="font-weight:bold">
                                <th width="20">SL</th>
                                <th width="250">Name</th>
                                <th width="200">Designation</th>
                                <th width="50">Approval Status</th>
                                <th width="100">Approval Date</th>
                            </tr>
                            </thead>
                            <? foreach ($approved_sql as $key => $value)
                            {
                                ?>
                                <tr>
                                    <td width="20"><? echo $sl; ?></td>
                                    <td width="250"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                    <td width="200"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                    <td width="50">Yes</td>
                                    <td width="100"><? $approved_date=explode(" ",$value[csf("approved_date")]);

                                        echo change_date_format($approved_date[0])." ".$approved_date[1];  ?></td>
                                </tr>
                                <?
                                $sl++;
                            }
                            ?>
                        </table>
                    </div>
                    <?
                }
                    ?>
                    <? if(count($approved_his_sql) > 0)
                {
                    $sl=1;
                    ?>
                    <div style="margin-top:15px">
                        <table class="rpt_table" border="1" cellpadding="0" cellspacing="0" style="width:850px;text-align:center;" rules="all">
                            <label><b>Pro Forma Invoice Approval / Un-Approval History </b></label>
                            <thead>
                            <tr style="font-weight:bold">
                                <th width="20">SL</th>
                                <th width="150">Approved / Un-Approved</th>
                                <th width="150">Designation</th>
                                <th width="50">Approval Status</th>
                                <th width="150">Reason for Un-Approval</th>
                                <th width="150">Date</th>
                            </tr>
                            </thead>
                            <? foreach ($approved_his_sql as $key => $value)
                            {
                                if($sl%2==0)$bgcolor="#E9F3FF";  else $bgcolor="#FFFFFF";
                                ?>
                                <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                    <td width="20"><? echo $sl; ?></td>
                                    <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                    <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                    <td width="50">Yes</td>
                                    <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                    <td width="150"><? $approved_date=explode(" ",$value[csf("approved_date")]);

                                        echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                </tr>

                                <?
                                $sl++;
                                if($value[csf("un_approved_date")] !='0000-00-00 00:00:00' && $value[csf("un_approved_date")] !='')
                                {
                                    ?>
                                    <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                        <td width="20"><? echo $sl; ?></td>
                                        <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                        <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                        <td width="50">No</td>
                                        <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                        <td width="150"><? $approved_date=explode(" ",$value[csf("un_approved_date")]);

                                            echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                    </tr>

                                    <?
                                    $sl++;

                                }

                            }
                            ?>
                        </table>
                    </div>
                    <?
                }
                    ?>
                    <!-- //approved status end-->
                    <br/>
                    <?
                    //signature_table($report_id, $company, $width, $template_id,$padding_top=70)

                    echo signature_table(147, $data[0],"900px",$data[18]);
                    ?>

                    <?
                }
                ?>
            </div>
            <?
        }
        ?>
    </div>
    <?

    $html=ob_get_contents();
    ob_clean();
    if($is_mail_send==1){

        require_once('../../../mailer/class.phpmailer.php');
        require_once('../../../auto_mail/setting/mail_setting.php');

        $WORK_ORDER_NO_ARR=array();
        foreach($data_array as $row){
            $WORK_ORDER_NO_ARR[$row[WORK_ORDER_NO]]=$row[WORK_ORDER_NO];
        }

        $team_leader_arr = return_library_array("select id,TEAM_LEADER_EMAIL from lib_marketing_team where project_type=1 and team_type in (0,1) and status_active =1 and is_deleted=0 order by TEAM_LEADER_EMAIL",'id','TEAM_LEADER_EMAIL');

        $team_member_arr = return_library_array("select id,TEAM_MEMBER_EMAIL from lib_mkt_team_member_info where status_active =1 and is_deleted=0 order by TEAM_MEMBER_EMAIL",'id','TEAM_MEMBER_EMAIL');

        $sql_team_mail="
		SELECT b.TEAM_LEADER,b.DEALING_MARCHANT  FROM WO_BOOKING_DTLS a,  WO_PO_DETAILS_MASTER b WHERE a.JOB_NO = b.JOB_NO and a.STATUS_ACTIVE=1 and a.IS_DELETED=0 and b.STATUS_ACTIVE=1 and b.IS_DELETED=0 ".where_con_using_array($WORK_ORDER_NO_ARR,1,'a.BOOKING_NO')."";
        $sql_team_mail_result=sql_select($sql_team_mail);
        $toArr=array();
        foreach($sql_team_mail_result as $rows){
            if($team_leader_arr[$rows[TEAM_LEADER]]){$toArr[]=$team_leader_arr[$rows[TEAM_LEADER]];}
            if($team_member_arr[$rows[DEALING_MARCHANT]]){$toArr[]=$team_member_arr[$rows[DEALING_MARCHANT]];}

        }


        $elcetronicSql = "SELECT a.BUYER_ID,a.SEQUENCE_NO,a.BYPASS,b.USER_EMAIL  from electronic_approval_setup a join user_passwd b on a.user_id=b.id where b.valid=1  AND a.ENTRY_FORM in(21,27) and a.company_id=$company_id order by a.SEQUENCE_NO";
        $elcetronicSqlRes=sql_select($elcetronicSql);
        foreach($elcetronicSqlRes as $rows){
            if($rows[BUYER_ID]!=''){
                foreach(explode(',',$rows[BUYER_ID]) as $bi){
                    if($rows[USER_EMAIL]!='' && $bi==$buyer_name_id){$toArr[]=$rows[USER_EMAIL];}
                    if($rows[BYPASS]==2){break;}
                }
            }
            else{
                if($rows[USER_EMAIL]){$toArr[]=$rows[USER_EMAIL];}
                if($rows[BYPASS]==2){break;}
            }

        }


        //echo implode(',',($toArr));die;

        $to = implode(',',array_unique($toArr));
        //echo $to;die;


        $subject="Pro Forma Invoice";
        $header=mailHeader();
        if($to!=""){
            echo sendMailMailer( $to, $subject, $html, $from_mail,$att_file_arr );
        }

    }
    else{echo $html;}
    exit();
}

if($action=="trim_booking_report")
{
    $data = explode('*', $data);
    $cbo_company_name = $data[1];
    $txt_booking_no = "'".$data[0]."'";
    $id_approved_id = 0;
    $report_title = "Multiple Job Wise Trims Booking V2";
    $show_comment = 1;
    $report_type = 1;


    $color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
    $company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
    $trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
    $imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
    $country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
    $supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
    $supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
    $buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
    $order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
    $deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
    $season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");
    ?>
    <div style="width:1333px" align="center">
        <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black">
            <tr>
                <td width="100">
                    <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
                </td>
                <td width="1000">
                    <table width="100%" cellpadding="0" cellspacing="0" >
                        <tr>
                            <td align="center" style="font-size:20px;">
                                <?php
                                echo $company_library[$cbo_company_name];
                                ?>
                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:14px">
                                <?
                                $nameArray=sql_select( "select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                                foreach ($nameArray as $result){
                                    ?>
                                    Plot No: <? echo $result[csf('plot_no')]; ?>
                                    Level No: <? echo $result[csf('level_no')]?>
                                    Road No: <? echo $result[csf('road_no')]; ?>
                                    Block No: <? echo $result[csf('block_no')];?>
                                    City No: <? echo $result[csf('city')];?>
                                    Zip Code: <? echo $result[csf('zip_code')]; ?>
                                    Province No: <?php echo $result[csf('province')]; ?>
                                    Country: <? echo $country_arr[$result[csf('country_id')]]; ?><br>
                                    Email Address: <? echo $result[csf('email')];?>
                                    Website No: <? echo $result[csf('website')];
                                }
                                ?>
                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:20px">
                                <strong>
                                    <?
                                    if(str_replace("'","",$cbo_isshort)==2){
                                        $isshort="";
                                    }
                                    if(str_replace("'","",$cbo_isshort)==1){
                                        $isshort="[Short]";
                                    }
                                    if ($report_title !=""){
                                        echo $report_title." ".$isshort;
                                    }
                                    else{
                                        echo "Main Trims Booking ".$isshort;
                                    }
                                    //echo str_replace("'","",$id_approved_id).'aziz';
                                    ?>
                                    &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                    <font style="color:#F00"> <? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </font>
                                </strong>
                            </td>
                        </tr>
                    </table>
                </td>
                <td width="250" id="barcode_img_id">

                </td>
            </tr>
        </table>
        <?

        $booking_grand_total=0;
        $currency_id="";


        $buyer_string=array();
        $style_owner=array();
        $job_no=array();
        $style_ref=array();
        $all_dealing_marcent=array();
        $season=array();

        $nameArray_buyer=sql_select( "select  a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant,a.season,a.season_matrix,a.order_repeat_no   from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no=$txt_booking_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0");
        foreach ($nameArray_buyer as $result_buy){
            $buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];

            $style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
            $job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
            $style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
            $all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
            $season[$result_buy[csf('job_no')]]=$season_arr[$result_buy[csf('season_matrix')]];
            $order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];
        }


        $po_no=array();
        $file_no=array();
        $ref_no=array();
        $po_quantity=array();

        $nameArray_job=sql_select( "select b.id, b.po_number,b.grouping, b.file_no, b.po_quantity  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no=$txt_booking_no");
        foreach ($nameArray_job as $result_job){
            $po_no[$result_job[csf('id')]]=$result_job[csf('po_number')];
            $file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
            $ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
            $po_quantity[$result_job[csf('id')]]=$result_job[csf('po_quantity')];
        }

        $nameArray=sql_select( "select a.booking_no,a.booking_date,a.pay_mode,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.delivery_date,a.source,a.remarks  from wo_booking_mst a where  a.booking_no=$txt_booking_no");
        foreach ($nameArray as $result)
        {
            $varcode_booking_no=$result[csf('booking_no')];
            ?>
            <table width="100%" style="border:1px solid black;table-layout: fixed;">
                <tr>
                    <td colspan="6" valign="top"></td>
                </tr>
                <tr>
                    <td width="100" style="font-size:12px"><b>Booking No </b>   </td>
                    <td width="110">:&nbsp;<? echo $result[csf('booking_no')];?> </td>
                    <td width="100" style="font-size:12px"><b>Booking Date</b></td>
                    <td width="110">:&nbsp;<? echo change_date_format($result[csf('booking_date')],'dd-mm-yyyy','-');?>&nbsp;&nbsp;&nbsp;</td>
                    <td width="100"><span style="font-size:12px"><b>Delivery Date</b></span></td>
                    <td width="110">:&nbsp;<? echo change_date_format($result[csf('delivery_date')],'dd-mm-yyyy','-');?></td>
                </tr>
                <tr>
                    <td width="100" style="font-size:12px"><b>Currency</b></td>
                    <td width="110">:&nbsp;<? $currency_id=$result[csf('currency_id')]; echo $currency[$result[csf('currency_id')]]; ?></td>
                    <td  width="100" style="font-size:12px"><b>Conversion Rate</b></td>
                    <td  width="110" >:&nbsp;<? echo $result[csf('exchange_rate')]; ?></td>
                    <td  width="100" style="font-size:12px"><b>Source</b></td>
                    <td  width="110" >:&nbsp;<? echo $source[$result[csf('source')]]; ?></td>
                </tr>
                <tr>
                    <td width="100" style="font-size:12px"><b>Supplier Name</b>   </td>
                    <td width="110">:&nbsp;<?
                        if($result[csf('pay_mode')]==5 || $result[csf('pay_mode')]==3){
                            echo $company_library[$result[csf('supplier_id')]];
                        }
                        else{
                            echo $supplier_name_arr[$result[csf('supplier_id')]];
                        }
                        //echo $supplier_name_arr[$result[csf('supplier_id')]];?>    </td>
                    <td width="100" style="font-size:12px"><b>Supplier Address</b></td>
                    <td  colspan="3">:&nbsp;<? echo $supplier_address_arr[$result[csf('supplier_id')]];?></td>

                </tr>
                <tr>
                    <td width="100" style="font-size:12px"><b>Buyer</b>   </td>
                    <td width="110">:&nbsp;
                        <?
                        echo implode(",",array_unique($buyer_string));
                        ?>
                    </td>
                    <td width="110" style="font-size:12px"><b>Style</b> </td>
                    <td  width="100" style="font-size:12px">:&nbsp;<? echo $style_sting=implode(",",array_unique($style_ref)); ?> </td>
                    <td width="100" style="font-size:12px"><b>Job No</b>   </td>
                    <td  style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
                        <?
                        echo $job_no=implode(",",$job_no);
                        ?>
                    </td>
                </tr>
                <tr>
                    <td style="font-size:12px"><b>PO No</b> </td>
                    <td style="font-size:12px;overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" colspan="5">:&nbsp;<? echo implode(",",array_unique($po_no)); ?> </td>
                </tr>
                <tr>
                    <td width="100" style="font-size:12px"><b>Remarks</b>   </td>
                    <td width="110" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" colspan="3">:&nbsp;
                        <?
                        echo $result[csf('remarks')];
                        ?>
                    </td>
                    <td width="100" style="font-size:12px"><b>Order Repeat No</b>   </td>
                    <td width="110" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
                        <?
                        $order_repeat=implode(",",array_unique($order_repeat_no));
                        if($order_repeat){
                            echo $order_repeat;
                        }
                        ?>
                    </td>
                </tr>
                <tr>
                    <td style="font-size:12px"><b>Attention</b>   </td>
                    <td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" colspan="5">:&nbsp;
                        <?
                        echo $result[csf('attention')];
                        ?>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight:bold;">Delivery To</td>
                    <td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;" colspan="2">:&nbsp;
                        <?
                        echo implode(",",array_unique($style_owner));
                        ?>
                    </td>
                    <td style="font-weight:bold;">Dealing Merchant</td>
                    <td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;" colspan="2">:&nbsp;
                        <?
                        echo implode(",",array_unique($all_dealing_marcent));
                        ?>
                    </td>
                </tr>
                <tr>
                    <td style="font-weight:bold;">Po Qty</td>
                    <td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;" colspan="2">:&nbsp;
                        <?
                        echo array_sum($po_quantity);
                        ?>
                    </td>
                    <td style="font-weight:bold;">Season</td>
                    <td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;" colspan="2">:&nbsp;
                        <?
                        echo implode(",",array_unique($season));
                        ?>
                    </td>
                </tr>
            </table>
            <br/>
            <?
        }
        ?>
        <!--==============================================AS PER GMTS COLOR START=========================================  -->
        <?
        $precost_arr=array();
        $trims_qtyPerUnit_arr=array();
        $precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no=$txt_booking_no and b.status_active=1 and a.id=b.pre_cost_fabric_cost_dtls_id");
        $calUom="";
        foreach($precost_sql as $precost_row){
            if($precost_row[csf('cal_parameter')]==1){
                $calUom="Mtr";
                $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
                $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
            }
            else if($precost_row[csf('cal_parameter')]==2){
                $calUom="Pcs";
            }
            else if($precost_row[csf('cal_parameter')]==3){
                $calUom="Pcs";
            }
            else if($precost_row[csf('cal_parameter')]==4){
                $calUom="Pcs";
            }
            else if($precost_row[csf('cal_parameter')]==5){
                $calUom="Yds";
                $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
                $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
            }
            else if($precost_row[csf('cal_parameter')]==6){
                $calUom="Yds";
                $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
                $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
            }
            else if($precost_row[csf('cal_parameter')]==7){
                $calUom="Pcs";
                $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
                $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
            }
            else if($precost_row[csf('cal_parameter')]==8){
                $calUom="Yds";
                $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
                $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
            }
            else{
                $calUom=0;
            }
            //$precost_arr[$precost_row[csf('job_no')]][$precost_row[csf('trim_group')]]['calculatorstring']=$precost_row[csf('calculatorstring')];
            //$precost_arr[$precost_row[csf('job_no')]][$precost_row[csf('trim_group')]]['cal_parameter_uom']=$calUom;

            //$trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
            //$trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
        }
        $booking_country_arr=array();
        $nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,sensitivity,country_id_string from wo_booking_dtls  where booking_no=$txt_booking_no");
        foreach($nameArray_booking_country as $nameArray_booking_country_row){
            $country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
            $tocu=count($country_id_string);
            for($cu=0;$cu<$tocu;$cu++){
                $booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
            }
        }

        $nameArray_job_po=sql_select( "select job_no from wo_booking_dtls  where booking_no=$txt_booking_no group by job_no order by job_no ");
        foreach($nameArray_job_po as $nameArray_job_po_row){
            $nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."'   and sensitivity=1 and status_active=1 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
            if(count($nameArray_item)>0){
                ?>
                &nbsp;
                <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >

                    <tr>
                        <td colspan="9" align="">
                            <strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')]; ?>)</strong>
                        </td>
                    </tr>
                    <tr>
                        <td style="border:1px solid black"><strong>Sl</strong> </td>
                        <td style="border:1px solid black"><strong>Item Group</strong> </td>
                        <td style="border:1px solid black"><strong>Item Description</strong> </td>
                        <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                        <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                        <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                        <td style="border:1px solid black" align="center"><strong>WO Qty</strong></td>
                        <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                        <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                        <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                    </tr>

                    <?
                    $i=0;
                    $grand_total_as_per_gmts_color=0;
                    foreach($nameArray_item as $result_item){
                        $i++;
                        $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_color,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.status_active=1 and b.requirment !=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color order by bid ");
                        ?>
                        <tr>
                        <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                            <? echo $i; ?>
                        </td>
                        <td align="center"  style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                            <?
                            echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
                            echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
                            ?>
                        </td>
                        <?
                        $item_desctiption_total=0;
                        $total_amount_as_per_gmts_color=0;
                        foreach($nameArray_item_description as $result_itemdescription){
                            ?>
                            <td style="border:1px solid black"><?  if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                            <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                            <td style="border:1px solid black; text-align:left">
                                <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                            </td>
                            <td style="border:1px solid black; text-align:left">
                                <?
                                $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
                                $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
                                if($calUom && end($calQty)){
                                    echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
                                }
                                ?>
                            </td>
                            <td style="border:1px solid black; text-align:right">
                                <?
                                echo number_format($result_itemdescription[csf('cons')],4);
                                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
                                ?>
                            </td>
                            <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                            <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                            <td style="border:1px solid black; text-align:right">
                                <?
                                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
                                echo number_format($amount_as_per_gmts_color,4);
                                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                                ?>
                            </td>
                            </tr>
                            <?
                        }
                        ?>
                        <tr>
                            <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                            <td style="border:1px solid black;  text-align:right"><? echo number_format($item_desctiption_total ,4);  ?></td>
                            <td style="border:1px solid black;  text-align:right"></td>
                            <td style="border:1px solid black; text-align:right"></td>
                            <td style="border:1px solid black; text-align:right">
                                <?
                                echo number_format($total_amount_as_per_gmts_color,4);
                                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                                ?>
                            </td>
                        </tr>
                        <?
                    }
                    ?>
                    <tr>
                        <td align="right" style="border:1px solid black"  colspan="9"><strong>Total</strong></td>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,4); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                    </tr>
                </table>
                <br/>
                <?
            }
            ?>
            <!--==============================================AS PER GMTS COLOR END=========================================  -->


            <!--==============================================Size Sensitive START=========================================  -->
            <?
            $nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=2 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
            if(count($nameArray_item)>0)
            {
                ?>

                <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
                    <tr>
                        <td colspan="10" align="">
                            <strong>Size Sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>)</strong>
                        </td>
                    </tr>
                    <tr>
                        <td style="border:1px solid black"><strong>Sl</strong> </td>
                        <td style="border:1px solid black"><strong>Item Group</strong> </td>
                        <td style="border:1px solid black"><strong>Item Description</strong> </td>
                        <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                        <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                        <td align="center" style="border:1px solid black"><strong>Article Number</strong></td>
                        <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                        <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                        <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                        <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                        <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                    </tr>
                    <?
                    $i=0;
                    $grand_total_as_per_gmts_color=0;
                    foreach($nameArray_item as $result_item)
                    {
                        $i++;
                        $nameArray_item_description=sql_select( "SELECT a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount, b.gmts_sizes as gmt_size_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.status_active=1 and b.requirment !=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size, b.gmts_sizes order by bid");

                        $article_number_data=sql_select( "SELECT c.size_number_id, c.article_number
			from wo_booking_dtls a, wo_trim_book_con_dtls b, wo_po_color_size_breakdown c
			where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and a.sensitivity=2 and c.job_no_mst=a.job_no  and c.job_no_mst=b.job_no and b.po_break_down_id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0
			group by c.size_number_id, c.article_number");

                        $article_numberArr=array();
                        foreach ($article_number_data as $value)
                        {
                            $article_numberArr[$value[csf('size_number_id')]]['article_number']=$value[csf('article_number')];
                        }
                        ?>
                        <tr>
                        <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                            <? echo $i ; ?>
                        </td>
                        <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                            <?
                            echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
                            echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][2]);
                            ?>
                        </td>
                        <?
                        $item_desctiption_total=0;
                        $total_amount_as_per_gmts_color=0;
                        foreach($nameArray_item_description as $result_itemdescription)
                        {

                            ?>
                            <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>

                            <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                            <td style="border:1px solid black; text-align:left">
                                <? echo $result_itemdescription[csf('item_size')];?>
                            </td>
                            <td style="border:1px solid black; text-align:left">
                                <?
                                $art_no=$article_numberArr[$result_itemdescription[csf('gmt_size_id')]]['article_number'];
                                if($art_no!='no article') { echo $art_no;}?>
                            </td>
                            <td style="border:1px solid black; text-align:left">
                                <?
                                $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
                                $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
                                if($calUom && end($calQty)){
                                    echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
                                }
                                ?>
                            </td>


                            <td style="border:1px solid black; text-align:right">
                                <?
                                echo number_format($result_itemdescription[csf('cons')],4);
                                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
                                ?>
                            </td>
                            <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                            <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                            <td style="border:1px solid black; text-align:right">

                                <?
                                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
                                echo number_format($amount_as_per_gmts_color,4);
                                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                                ?>
                            </td>
                            </tr>
                            <?
                        }
                        ?>
                        <tr>
                            <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                            <td style="border:1px solid black;  text-align:right"><? echo number_format($item_desctiption_total,4);  ?></td>
                            <td style="border:1px solid black;  text-align:right"></td>
                            <td style="border:1px solid black; text-align:right"></td>
                            <td style="border:1px solid black; text-align:right">
                                <?
                                echo number_format($total_amount_as_per_gmts_color,4);
                                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                                ?>
                            </td>
                        </tr>
                        <?
                    }
                    ?>
                    <tr>
                        <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,4); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                    </tr>
                </table>
                <br/>
                <?
            }
            ?>

            <!--==============================================Size Sensitive END=========================================  -->

            <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
            <?
            $nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=3 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
            if(count($nameArray_item)>0)
            {
                ?>
                <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
                    <tr>
                        <td colspan="10" align="">
                            <strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>)</strong>
                        </td>
                    </tr>
                    <tr>
                        <td style="border:1px solid black"><strong>Sl</strong> </td>
                        <td style="border:1px solid black"><strong>Item Group</strong> </td>
                        <td style="border:1px solid black"><strong>Item Description</strong> </td>
                        <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                        <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                        <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                        <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                        <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                        <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                        <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                        <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                    </tr>
                    <?
                    $i=0;
                    $grand_total_as_per_gmts_color=0;
                    foreach($nameArray_item as $result_item)
                    {
                        $i++;
                        $gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.status_active=1 and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0  order by trim_group ", "item_color", "color_number_id"  );

                        $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.status_active=1  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,b.color_number_id order by bid ");
                        ?>
                        <tr>
                        <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                            <? echo $i; ?>
                        </td>
                        <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                            <?
                            echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
                            echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
                            ?>
                        </td>
                        <?
                        $item_desctiption_total=0;
                        $total_amount_as_per_gmts_color=0;
                        foreach($nameArray_item_description as $result_itemdescription)
                        {

                            ?>
                            <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                            <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                            <td style="border:1px solid black; text-align:right">
                                <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                            </td>
                            <td style="border:1px solid black; text-align:left">
                                <?
                                echo $color_library[$result_itemdescription[csf('color_number_id')]];
                                ?>
                            </td>
                            <td style="border:1px solid black; text-align:left">
                                <?
                                // $calUom=$precost_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf('trim_group')]]['cal_parameter_uom'];
                                //$calQty=explode("_",$precost_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf('trim_group')]]['calculatorstring']);

                                $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
                                $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
                                // print_r($calQty);
                                if($calUom && end($calQty)){
                                    echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
                                }
                                ?>
                            </td>

                            <td style="border:1px solid black; text-align:right">
                                <?
                                echo number_format($result_itemdescription[csf('cons')],4);
                                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
                                ?>
                            </td>
                            <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                            <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                            <td style="border:1px solid black; text-align:right">
                                <?
                                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                                ?>
                            </td>
                            </tr>
                            <?
                        }
                        ?>
                        <tr>
                            <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                            <td style="border:1px solid black;  text-align:right"><? echo number_format($item_desctiption_total,4);  ?></td>
                            <td style="border:1px solid black;text-align:center"></td>
                            <td style="border:1px solid black; text-align:right"><? //echo number_format(round($color_total),0); ?></td>
                            <td style="border:1px solid black; text-align:right">
                                <?
                                echo number_format($total_amount_as_per_gmts_color,4);
                                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                                ?>
                            </td>
                        </tr>
                        <?
                    }
                    ?>
                    <tr>
                        <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,4); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                    </tr>
                </table>
                <br/>
                <?
            }
            ?>

            <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

            <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
            <?
            $nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and b.status_active=1 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group");
            if(count($nameArray_item)>0)
            {
                ?>

                <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
                    <tr>
                        <td colspan="12" align="">
                            <strong>Color & size sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>)</strong>
                        </td>
                    </tr>
                    <tr>
                        <td style="border:1px solid black"><strong>Sl</strong> </td>
                        <td style="border:1px solid black"><strong>Item Group</strong> </td>


                        <td style="border:1px solid black"><strong>Item Description</strong> </td>
                        <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                        <td style="border:1px solid black"><strong>Item Color</strong> </td>
                        <td style="border:1px solid black"><strong>Gmts Color</strong> </td>

                        <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                        <td align="center" style="border:1px solid black"><strong>Article Number</strong></td>
                        <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                        <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                        <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                        <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                        <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                    </tr>
                    <?
                    $i=0;
                    $grand_total_as_per_gmts_color=0;
                    foreach($nameArray_item as $result_item)
                    {
                        $i++;
                        $gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and b.status_active=1  order by trim_group ", "item_color", "color_number_id"  );

                        $nameArray_color=sql_select( "SELECT a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.item_color as color_number_id,b.item_size, b.gmts_sizes as gmt_size_id,b.description, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.status_active=1 and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=4 and b.requirment !=0 group by a.pre_cost_fabric_cost_dtls_id, b.item_color,b.item_size, b.gmts_sizes,b.description, b.brand_supplier order by bid ");

                        $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]." and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]."  and status_active=1 order by trim_group ");

                        $article_number_data=sql_select( "SELECT c.size_number_id, c.article_number
			from wo_booking_dtls a, wo_trim_book_con_dtls b, wo_po_color_size_breakdown c
			where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=4 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and a.sensitivity=4 and c.job_no_mst=a.job_no  and c.job_no_mst=b.job_no and b.po_break_down_id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0
			group by c.size_number_id, c.article_number");

                        $article_numberArr=array();
                        foreach ($article_number_data as $value)
                        {
                            $article_numberArr[$value[csf('size_number_id')]]['article_number']=$value[csf('article_number')];
                        }
                        ?>
                        <tr>
                        <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                            <? echo $i ; ?>
                        </td>
                        <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
                            <?
                            echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
                            echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][4]);
                            ?>
                        </td>
                        <?



                        $item_desctiption_total=0;
                        $total_amount_as_per_gmts_color=0;
                        foreach($nameArray_color as $result_color)
                        {

                            ?>

                            <td style="border:1px solid black" ><? if($result_color[csf('description')]){echo $result_color[csf('description')];} ?> </td>
                            <td style="border:1px solid black" ><? if($result_color[csf('brand_supplier')]){echo $result_color[csf('brand_supplier')]; }?> </td>
                            <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                            <td style="border:1px solid black"><? echo $color_library[$gmtcolor_library[$result_color[csf('color_number_id')]]]; ?> </td>
                            <td style="border:1px solid black; text-align:left">
                                <? echo $result_color[csf('item_size')]; ?>
                            </td>
                            <td style="border:1px solid black; text-align:left">
                                <? echo $article_numberArr[$result_itemdescription[csf('gmt_size_id')]]['article_number'];?>
                            </td>
                            <td style="border:1px solid black; text-align:left">
                                <?
                                //$calUom=$precost_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf('trim_group')]]['cal_parameter_uom'];
                                //$calQty=explode("_",$precost_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf('trim_group')]]['calculatorstring']);

                                $calUom=$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][2];
                                $calQty=explode("_",$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][1]);
                                if($calUom && end($calQty)){
                                    echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
                                }
                                ?>
                            </td>

                            <td style="border:1px solid black; text-align:right">
                                <?
                                echo number_format($result_color[csf('cons')],4);
                                $item_desctiption_total += $result_color[csf('cons')] ;
                                //echo number_format($item_desctiption_total,2);
                                ?>
                            </td>
                            <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                            <td style="border:1px solid black; text-align:right">
                                <?
                                echo number_format($result_color[csf('rate')],4);
                                /*$rate =$result_color[csf('amount')]/$result_color[csf('cons')];
                                echo number_format($rate,4); */
                                ?>
                            </td>
                            <td style="border:1px solid black; text-align:right">
                                <?
                                //$amount_as_per_gmts_color = $item_desctiption_total*  $result_color[csf('rate')];
                                $amount_as_per_gmts_color =$result_color[csf('amount')];
                                echo number_format($amount_as_per_gmts_color,4);
                                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                                ?>
                            </td>
                            </tr>
                            <?
                        }
                        ?>
                        <tr>
                            <td style="border:1px solid black;  text-align:right" colspan="9"><strong> Item Total</strong></td>
                            <td style="border:1px solid black;  text-align:right"><? echo number_format($item_desctiption_total,4);  ?></td>
                            <td style="border:1px solid black;  text-align:right"><? //echo number_format(array_sum($color_tatal),2);  ?></td>
                            <td style="border:1px solid black; text-align:right"><? //echo number_format(round($color_total),0); ?></td>
                            <td style="border:1px solid black; text-align:right">
                                <?
                                echo number_format($total_amount_as_per_gmts_color,4);
                                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                                ?>
                            </td>
                        </tr>
                        <?
                    }

                    ?>
                    <tr>
                        <td align="right" style="border:1px solid black"  colspan="12"><strong>Total</strong></td>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,4); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                    </tr>
                </table>
                <br/>
                <?
            }
            ?>
            <!--==============================================AS PER Color & SIZE  END=========================================  -->



            <!--==============================================NO NENSITIBITY START=========================================  -->
            <?
            //$nameArray_item=sql_select( "select distinct trim_group from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and sensitivity=0 order by trim_group ");
            $nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
            //$nameArray_color=sql_select( "select distinct b.color_number_id from wo_trims_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=$txt_booking_no and a.sensitivity=1");
            //$nameArray_color= array();
            if(count($nameArray_item)>0)
            {
                ?>
                <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
                    <tr>
                        <td colspan="8" align="">
                            <strong>No Sensitivity  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) </strong>
                        </td>
                    </tr>
                    <tr>
                        <td style="border:1px solid black"><strong>Sl</strong> </td>
                        <td style="border:1px solid black"><strong>Item Group</strong> </td>
                        <td style="border:1px solid black"><strong>Item Description</strong> </td>
                        <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                        <td style="border:1px solid black"><strong>Item Color</strong> </td>
                        <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                        <td align="center" style="border:1px solid black"><strong> Qnty</strong></td>
                        <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                        <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                        <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                    </tr>
                    <?
                    $i=0;
                    $grand_total_as_per_gmts_color=0;
                    foreach($nameArray_item as $result_item)
                    {
                        $i++;

                        $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and a.status_active=1 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color");

                        //$nameArray_item_description=sql_select( "select distinct description,brand_supplier,rate,uom from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=0 and trim_group=".$result_item[csf('trim_group')]." order by trim_group ");
                        ?>
                        <tr>
                        <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                            <? echo $i; ?>
                        </td>
                        <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">

                            <?
                            echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
                            echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);

                            ?>
                        </td>
                        <?
                        $color_tatal=0;
                        $total_amount_as_per_gmts_color=0;
                        foreach($nameArray_item_description as $result_itemdescription)
                        {
                            $item_desctiption_total=0;
                            ?>
                            <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                            <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                            <td style="border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
                            <td style="border:1px solid black; text-align:left">
                                <?
                                //$calUom=$precost_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf('trim_group')]]['cal_parameter_uom'];
                                //$calQty=explode("_",$precost_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf('trim_group')]]['calculatorstring']);

                                $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
                                $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
                                if($calUom && end($calQty)){
                                    echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
                                }
                                ?>
                            </td>
                            <?
                            if($db_type==0)
                            {
                                $nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0  and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and a.status_active=1 and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
                            }
                            if($db_type==2)
                            {
                                $nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and a.status_active=1 and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
                            }

                            foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                            {
                                ?>
                                <td style="border:1px solid black; text-align:right">
                                    <?
                                    if($result_color_size_qnty[csf('cons')]!= "")
                                    {
                                        echo number_format($result_color_size_qnty[csf('cons')],4);
                                        $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                                        $color_tatal+=$result_color_size_qnty[csf('cons')];
                                    }
                                    else echo "";
                                    ?>
                                </td>
                                <?
                            }
                            ?>

                            <td style="border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                            <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                            <td style="border:1px solid black; text-align:right">
                                <?
                                $amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                                ?>
                            </td>
                            </tr>
                            <?
                        }
                        ?>
                        <tr>
                            <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                            <td style="border:1px solid black;  text-align:right">
                                <?
                                if($color_tatal !='')
                                {
                                    echo number_format($color_tatal,4);
                                }
                                ?>
                            </td>
                            <td style="border:1px solid black;"></td>
                            <td style="border:1px solid black; text-align:right"></td>
                            <td style="border:1px solid black; text-align:right">
                                <?
                                echo number_format($total_amount_as_per_gmts_color,4);
                                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                                ?>
                            </td>
                        </tr>
                        <?
                    }
                    ?>
                    <tr>
                        <td align="right" style="border:1px solid black"  colspan="9"><strong>Total</strong></td>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,4); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                    </tr>
                </table>
                <?
                //print_r($color_tatal);
            }
        }
        ?>
        <!--==============================================NO NENSITIBITY END=========================================  -->
        &nbsp;
        <?
        $mcurrency="";
        $dcurrency="";
        if($currency_id==1)
        {
            $mcurrency='Taka';
            $dcurrency='Paisa';
        }
        if($currency_id==2)
        {
            $mcurrency='USD';
            $dcurrency='CENTS';
        }
        if($currency_id==3)
        {
            $mcurrency='EURO';
            $dcurrency='CENTS';
        }
        ?>
        <table  width="100%" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
            <tr style="border:1px solid black;">
                <th width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</th><td width="70%" style="border:1px solid black; text-align:left"><? echo number_format($booking_grand_total,2);?></td>
            </tr>
            <tr style="border:1px solid black;">
                <th width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</th><td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
            </tr>
        </table>
        &nbsp;
        <table width="100%">
            <tr>
                <td width="49%">
                    <?
                    echo get_spacial_instruction($txt_booking_no);
                    ?>
                    <!--<table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
        <thead>
            <tr style="border:1px solid black;">
                <th width="3%" style="border:1px solid black;">Sl</th><th width="97%" style="border:1px solid black;">Special Instruction</th>
            </tr>
        </thead>
        <tbody>
        <?
                    /*$data_array=sql_select("select id, terms from  wo_booking_terms_condition where booking_no=$txt_booking_no");// quotation_id='$data'
                    if ( count($data_array)>0)
                    {
                        $i=0;
                        foreach( $data_array as $row )
                        {
                            $i++;
                            ?>
                                <tr id="settr_1" align="" style="border:1px solid black;">
                                    <td style="border:1px solid black;">
                                    <? echo $i;?>
                                    </td>
                                    <td style="border:1px solid black;">
                                    <? echo $row[csf('terms')]; ?>
                                    </td>
                                </tr>
                            <?
                        }
                    }
                    else
                    {
                        $i=0;
                        $data_array=sql_select("select id, terms from lib_terms_condition where is_default=1");// quotation_id='$data'
                        foreach( $data_array as $row )
                        {
                            $i++;
                                ?>
                                <tr id="settr_1" align="" style="border:1px solid black;">
                                    <td style="border:1px solid black;">
                                    <? echo $i;?>
                                    </td>
                                    <td style="border:1px solid black;">
                                    <? echo $row[csf('terms')]; ?>
                                    </td>

                                </tr>
                    <?
                        }
                    }*/
                    ?>
    </tbody>
    </table>-->
                </td>
                <td width="2%"></td>
                <?
                $data_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no=$txt_booking_no and b.entry_form=8");
                ?>
                <td width="49%">
                    <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
                        <thead>
                        <tr style="border:1px solid black;">
                            <th colspan="3" style="border:1px solid black;">Approval Status</th>
                        </tr>
                        <tr style="border:1px solid black;">
                            <th width="3%" style="border:1px solid black;">Sl</th><th width="50%" style="border:1px solid black;">Name</th><th width="27%" style="border:1px solid black;">Approval Date</th><th width="20%" style="border:1px solid black;">Approval No</th>
                        </tr>
                        </thead>
                        <tbody>
                        <?
                        $i;
                        foreach($data_array as $row){
                            ?>
                            <tr style="border:1px solid black;">
                                <td width="3%" style="border:1px solid black;"><? echo $i;?></td><td width="50%" style="border:1px solid black;"><? echo $row[csf('user_full_name')];?></td><td width="27%" style="border:1px solid black;"><? echo change_date_format($row[csf('approved_date')],"dd-mm-yyyy","-");?></td><td width="20%" style="border:1px solid black;"><? echo $row[csf('approved_no')];?></td>
                            </tr>
                            <?
                            $i++;
                        }
                        ?>
                        </tbody>
                    </table>
                </td>
            </tr>
        </table>

    </div>
    <div>
        <?
        echo signature_table(2, $cbo_company_name, "1330px");
    //        echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>

    <script type="text/javascript" src="../../js/jquery.js"></script>
    <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
    <script>
        fnc_generate_Barcode('<? echo $varcode_booking_no; ?>','barcode_img_id');

    </script>
    <?
    exit();
}

if ($action == 'fabric_sales_order_print')
{
    $getFsoe = sql_select("select id, company_id, booking_id, sales_booking_no, job_no from fabric_sales_order_mst where id = $data");
   if(count($getFsoe) > 0){
        $data = $getFsoe[0][csf("company_id")]."*".$getFsoe[0][csf("booking_id")]."*".$getFsoe[0][csf("sales_booking_no")]."*".$getFsoe[0][csf("job_no")]."*Fabric Sales Order Entry";
    }else{
        die();
    }
    list($companyId, $bookingId, $bookingNo, $salesOrderNo, $formCaption) = explode('*', $data);
    $companyArr = return_library_array("select id,company_name from lib_company", 'id', 'company_name');
    $addressArr = return_library_array("select id,city from lib_company where id=$companyId", 'id', 'city');
    $buyerArr = return_library_array("select id,buyer_name from lib_buyer", 'id', 'buyer_name');
    $departmentArr = return_library_array("select id,department_name from lib_department", 'id', 'department_name');
    $dealing_marArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info", 'id', 'team_member_name');
    $color_library = return_library_array("select id,color_name from lib_color  where status_active=1 and is_deleted=0", "id", "color_name");
    $supplier_arr = return_library_array("select c.supplier_name,c.id from lib_supplier_tag_company a,lib_supplier_party_type b, lib_supplier c where c.id=b.supplier_id and a.supplier_id = b.supplier_id and a.tag_company='$companyId' and b.party_type =2 and c.status_active=1 and c.is_deleted=0 group by c.id, c.supplier_name order by supplier_name", "id", "supplier_name");
    $yarnCount_arr = return_library_array("select id, yarn_count from lib_yarn_count order by yarn_count", 'id', 'yarn_count');

    $season_arr = return_library_array("select id, season_name from lib_buyer_season where status_active=1 and is_deleted=0", 'id', 'season_name');
    $update_serial = sql_select("select a.id, a.update_sl,a.booking_approval_date,a.revise_no from fabric_sales_order_mst a where a.sales_booking_no = '" . $bookingNo . "'");

    /*$sql = "SELECT a.attention,b.job_no as wo_job_no,b.order_repeat_no,d.id as sales_id,cast(a.fabric_composition as nvarchar2(200)) fabric_composition,a.booking_no, d.booking_date, a.company_id, a.delivery_date, a.currency_id, a.po_break_down_id,b.style_description,b.dealing_marchant,min(c.pub_shipment_date) as shipment_date,max(c.pub_shipment_date) as max_shipment_date,min(c.po_received_date) as po_received_date,sum(c.po_quantity*b.total_set_qnty) as po_quantity, d.job_no,b.buyer_name,b.gmts_item_id, b.style_ref_no,b.team_leader, b.dealing_marchant, b.season_matrix as season, b.product_dept,b.style_owner,d.currency_id,d.remarks,d.delivery_date FROM wo_booking_mst a, wo_po_details_master b,wo_po_break_down c,fabric_sales_order_mst d WHERE a.id=d.booking_id and a.job_no=b.job_no and b.job_no=c.job_no_mst and a.pay_mode=5 and a.fabric_source in(1,2) and a.supplier_id=$companyId and a.status_active =1 and a.is_deleted =0 and a.item_category=2 and a.booking_no='$bookingNo' group by a.booking_no, d.booking_date, a.company_id, a.delivery_date, a.currency_id, a.po_break_down_id,b.style_description, d.job_no,b.buyer_name,b.gmts_item_id, b.style_ref_no, b.dealing_marchant, b.season_matrix, b.product_dept,d.currency_id,b.team_leader,d.remarks,d.delivery_date,d.id,b.style_owner,a.fabric_composition,b.job_no,b.order_repeat_no,a.attention
    union all
    select a.attention,null as job_no,null as order_repeat_no,c.id as sales_id,b.composition fabric_composition,a.booking_no, c.booking_date, a.company_id, a.delivery_date, a.currency_id, a.po_break_down_id,null as style_description,null as dealing_marchant,null as pub_shipment_date,null as pub_shipment_date,null as po_received_date,null as po_quantity, c.job_no,a.buyer_id,null as gmts_item_id,null as style_ref_no,null as team_leader,null as dealing_marchant,null as season_matrix, null as product_dept,null as style_owner,c.currency_id,c.remarks,c.delivery_date from wo_non_ord_samp_booking_mst a left join wo_non_ord_samp_booking_dtls b on a.booking_no=b.booking_no left join fabric_sales_order_mst c on a.booking_no=c.sales_booking_no where a.booking_no='$bookingNo' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.grey_fabric>0 group by a.attention,c.id,b.composition,a.booking_no, c.booking_date, a.company_id, a.delivery_date, a.currency_id, a.po_break_down_id,c.job_no,a.buyer_id,c.currency_id,c.remarks,c.delivery_date";*/
    if ($db_type == 0)
    {
        $fabric_composition = "a.fabric_composition as fabric_composition";
        $po_break_down_id = "a.po_break_down_id as po_break_down_id";
        $style_description = "b.style_des as style_description";
        $group_concat = "group_concat(e.po_break_down_id) as po_break_down_id";

    }
    else
    {
        $fabric_composition = "cast(a.fabric_composition as nvarchar2(200)) as fabric_composition";
        $po_break_down_id = "cast(a.po_break_down_id as varchar2(4000)) as po_break_down_id";
        $style_description = "CAST (b.style_des AS NVARCHAR2 (200)) AS style_description";
        $group_concat = "listagg(e.po_break_down_id, ',') within group (order by e.po_break_down_id) as po_break_down_id";
    }
    $sql = "SELECT a.attention,b.job_no as wo_job_no,b.order_repeat_no,d.id as sales_id, $fabric_composition, a.booking_no, d.booking_date, a.company_id, a.delivery_date, a.currency_id, $po_break_down_id, b.style_description,b.dealing_marchant,min(c.pub_shipment_date) as shipment_date,max(c.pub_shipment_date) as max_shipment_date,min(c.po_received_date) as po_received_date,sum(c.po_quantity*b.total_set_qnty) as po_quantity, d.job_no,b.buyer_name,b.gmts_item_id, b.style_ref_no,b.team_leader, b.dealing_marchant, b.season_matrix as season, b.product_dept,b.style_owner,d.currency_id,d.remarks,d.delivery_date,d.booking_approval_date,d.attention as sales_attention,d.fabric_composition as sales_fab_comp, 0 as booking_without_order FROM wo_booking_mst a, wo_po_details_master b,wo_po_break_down c,fabric_sales_order_mst d WHERE a.id=d.booking_id and a.job_no=b.job_no and b.job_no=c.job_no_mst and a.pay_mode=5 and a.fabric_source in(1,2) and a.supplier_id=$companyId and a.status_active =1 and a.is_deleted =0 and a.item_category=2 and a.booking_no='$bookingNo' group by a.booking_no, d.booking_date, a.company_id, a.delivery_date, a.currency_id, a.po_break_down_id,b.style_description, d.job_no,b.buyer_name,b.gmts_item_id, b.style_ref_no, b.dealing_marchant, b.season_matrix, b.product_dept,d.currency_id,b.team_leader,d.remarks,d.delivery_date,d.id,b.style_owner,a.fabric_composition,b.job_no,b.order_repeat_no,a.attention,d.booking_approval_date,d.attention,d.fabric_composition
	union all
	select a.attention,null as job_no,null as order_repeat_no,c.id as sales_id, b.composition as fabric_composition,a.booking_no, c.booking_date, a.company_id, a.delivery_date, a.currency_id, $po_break_down_id, $style_description,a.dealing_marchant,null as pub_shipment_date,null as pub_shipment_date,null as po_received_date,null as po_quantity, c.job_no,a.buyer_id,null as gmts_item_id, c.style_ref_no,null as team_leader,a.dealing_marchant,null as season_matrix, null as product_dept,null as style_owner,c.currency_id,c.remarks,c.delivery_date,c.booking_approval_date,c.attention as sales_attention,c.fabric_composition as sales_fab_comp, 1 as booking_without_order from wo_non_ord_samp_booking_mst a left join wo_non_ord_samp_booking_dtls b on a.booking_no=b.booking_no left join fabric_sales_order_mst c on a.booking_no=c.sales_booking_no where a.booking_no='$bookingNo' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.grey_fabric>0 group by a.attention,a.dealing_marchant,c.id,b.composition, b.style_des,a.booking_no, c.booking_date, a.company_id, a.delivery_date, a.currency_id, a.po_break_down_id,c.job_no,a.buyer_id,c.currency_id,c.remarks,c.delivery_date,c.booking_approval_date,c.attention,c.fabric_composition, c.style_ref_no";


    $partial_sql = "SELECT a.attention,b.job_no as wo_job_no,b.order_repeat_no,d.id as sales_id,a.fabric_composition,a.booking_no, d.booking_date, a.company_id, a.delivery_date, a.currency_id, $group_concat,b.style_description,b.dealing_marchant,min(c.pub_shipment_date) as shipment_date,max(c.pub_shipment_date) as max_shipment_date,min(c.po_received_date) as po_received_date,sum(c.po_quantity*b.total_set_qnty) as po_quantity, d.job_no,b.buyer_name,b.gmts_item_id, b.style_ref_no,b.team_leader, b.dealing_marchant, b.season_matrix as season, b.product_dept,b.style_owner,d.currency_id,d.remarks,d.delivery_date,d.attention as sales_attention,d.fabric_composition as sales_fab_comp FROM wo_booking_mst a, wo_po_details_master b,	wo_po_break_down c,	fabric_sales_order_mst d, wo_booking_dtls e
	WHERE
	a.booking_no=e.booking_no and e.po_break_down_id=c.id and a.id=d.booking_id and e.job_no=b.job_no and b.job_no=c.job_no_mst and a.pay_mode=5 and a.fabric_source in(1,2) and a.supplier_id=$companyId and a.status_active =1 and a.is_deleted =0 and a.item_category=2 and a.booking_no='$bookingNo' and a.entry_form in(108,271)
	group by a.attention,b.job_no,b.order_repeat_no,d.id,a.fabric_composition,a.booking_no, d.booking_date, a.company_id, a.delivery_date, a.currency_id,b.style_description,b.dealing_marchant,d.job_no,b.buyer_name,b.gmts_item_id, b.style_ref_no,b.team_leader, b.dealing_marchant, b.season_matrix, b.product_dept,b.style_owner,d.currency_id,d.remarks,d.delivery_date,d.attention,d.fabric_composition";

    $mst_data = sql_select($sql);
    $mst_data = array_change_key_case($mst_data[0], CASE_LOWER);
    extract($mst_data);
    // echo $booking_no.'==';
    // echo "<br>"; print_r($mst_data);die;

    if ($sales_id == '') {
        $mst_data = sql_select($partial_sql);
        $mst_data = array_change_key_case($mst_data[0], CASE_LOWER);
        extract($mst_data);
    }
    $po_break_down_id = implode(",", array_unique(explode(",", $mst_data['po_break_down_id'])));
    if ($sales_id == '') {
        $mst_data = sql_select($partial_sql);
        $mst_data = array_change_key_case($mst_data[0], CASE_LOWER);
        extract($mst_data);
    }
    $po_break_down_id = implode(",", array_unique(explode(",", $mst_data['po_break_down_id'])));
    if ($po_break_down_id != ""){
        $po_quantity = return_field_value("sum(po_quantity)", "wo_po_break_down", "id in($po_break_down_id)");
        $sql_po = "select po_number,MIN(pub_shipment_date) pub_shipment_date from  wo_po_break_down  where id in($po_break_down_id) group by po_number";
        $data_array_po = sql_select($sql_po);
        $po_no = '';
        foreach ($data_array_po as $row_po) {
            $po_no .= $row_po[csf('po_number')] . ", ";
        }
    }
    if ($sales_id != ""){
        $image_locationArr = return_library_array("select id,image_location from common_photo_library where form_name ='fabric_sales_order_entry' and master_tble_id='$sales_id' and file_type=1", 'id', 'image_location');
    }

    if (count($image_locationArr) == 0) {
        if ($wo_job_no != ""){
            $image_locationArr = return_library_array("select id,image_location from common_photo_library where form_name ='knit_order_entry' and master_tble_id='$wo_job_no' and file_type=1", 'id', 'image_location');
        }
    }

    //$lead_time = datediff("d", $po_received_date, date('d-M-Y', time()));
    $lead_time = datediff("d", $booking_approval_date,$delivery_date);

    $gmts_item_id_arr = explode(',', $gmts_item_id);
    foreach ($gmts_item_id_arr as $item_id) {
        if ($item_string == '') {
            $item_string = $garments_item[$item_id];
        } else {
            $item_string .= ',' . $garments_item[$item_id];
        }
    }
    $max_shipment_date . 'wew';
    $update_serial_yarn = return_field_value("update_sl", "FABRIC_SALES_ORDER_YARN", "mst_id='" . $update_serial[0][csf("id")] . "'");

    ?>
    <table width="100%" border="0" cellpadding="3" cellspacing="0"
           style="font: 12px tahoma; border-bottom: 1px solid #999; margin-bottom: 2px;">
        <tr>
            <td colspan="5" align="center"><strong style="font-size:20px;"><? echo $companyArr[$companyId]; ?></strong>
            </td>
        </tr>
        <tr>
            <td colspan="5" align="center"><strong><? echo $addressArr[$companyId]; ?></strong></td>
        </tr>
        <tr>
            <td colspan="5" align="center"><strong><? echo $formCaption; ?></strong></td>
        </tr>
    </table>
    <table width="100%" border="1" cellpadding="3" rules="all" style="font: 12px tahoma;">
        <tr>
            <td width="135"><strong>Buyer/Agent Name</strong></td>
            <td><? echo $buyerArr[$buyer_name]; ?></td>

            <td width="135"><strong>Dept.</strong></td>
            <td><? echo $departmentArr[$product_dept]; ?></td>
            <td width="135"><strong>Garments Item</strong></td>
            <td><? echo $item_string; ?></td>
            <td><strong>Sales Order No: <? echo $salesOrderNo; ?></strong></td>
        </tr>
        <tr>
            <td><strong>Style Ref.</strong></td>
            <td><? echo $style_ref_no; ?></td>
            <td><strong>Season</strong></td>
            <td><? echo $season_arr[$season]; ?></td>
            <td><strong>Order Qnty</strong></td>
            <td><? echo $po_quantity; ?></td>
            <td rowspan="10" valign="top" width="205"><? foreach ($image_locationArr as $path) { ?><img
                    src="../../<? echo $path; ?>" height="100" width="100"><? } ?></td>
        </tr>
        <tr>
            <td><strong>Style Des.</strong></td>
            <td><? echo $style_description; ?></td>
            <td><strong>Lead Time</strong></td>
            <td><? echo $lead_time; ?></td>
            <td><strong>Job No</strong></td>
            <td><? echo $wo_job_no; ?></td>
        </tr>
        <tr>
            <td><strong>Order No</strong></td>
            <td style="overflow:hidden;text-overflow: ellipsis;word-break: break-all;;"
                colspan="3"><? echo rtrim($po_no, ','); ?></td>
            <td><strong>Booking No</strong></td>
            <td><? echo $booking_no; ?></td>
        </tr>
        <tr>
            <td><strong>Repeat No</strong></td>
            <td><? echo $order_repeat_no; ?></td>
            <td><strong>Shipment Date</strong></td>
            <td><? echo 'First:' . change_date_format($shipment_date) . ',' . 'Last:' . change_date_format($max_shipment_date); ?></td>
            <td><strong>Booking Date</strong></td>
            <td><? echo change_date_format($booking_date); ?></td>
        </tr>
        <tr>
            <td><strong>Po Received Date</strong></td>
            <td><? echo change_date_format($po_received_date); ?></td>
            <td><strong>WO Prepared After</strong></td>
            <td><? echo $row[csf('')]; ?></td>
            <td><strong>Dealing Merchant</strong></td>
            <td><? echo ($booking_without_order==0) ? $dealing_marArr[$dealing_marchant] : $dealing_marArr[$dealing_marchant]; //echo $dealing_marArr[$dealing_marchant]; ?></td>
        </tr>
        <tr>
            <td><strong>Currency</strong></td>
            <td><? echo $currency[$currency_id]; ?></td>
            <td><strong>Quality Label</strong></td>
            <td><? echo $row[csf('')]; ?></td>
            <td><strong>Style Owner</strong></td>
            <td><? echo $companyArr[$style_owner]; ?></td>
        </tr>
        <tr>
            <td><strong>Attention</strong></td>
            <td colspan="3"><? echo $sales_attention; ?></td>
            <td><strong>Delivery Date</strong></td>
            <td><? echo change_date_format($delivery_date); ?></td>
        </tr>
        <tr>
            <td><strong>Fabric Composition</strong></td>
            <td colspan="3"><? echo $sales_fab_comp; ?></td>
            <td><strong>Revised No</strong></td>
            <td><?
                $nameArray_approved = sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='" . $booking_no . "' and b.entry_form=7");
                echo ($update_serial[0][csf("revise_no")] > 0)?$update_serial[0][csf("revise_no")]:""; ?></td>
        </tr>
        <tr>
            <td rowspan="2"><strong>Remarks</strong></td>
            <td rowspan="2" colspan="3"><? echo $remarks; ?></td>
            <td><strong>Receive Date</strong></td>
            <td><? echo change_date_format($update_serial[0][csf("booking_approval_date")]); ?></td>
        </tr>
        <tr>
            <td><strong>Update Serial</strong></td>
            <td>
                Fabric: <? echo ($update_serial[0][csf("update_sl")] == "") ? 0 : $update_serial[0][csf("update_sl")]; ?>
                ,
                Yarn: <? echo ($update_serial_yarn == "") ? 0 : $update_serial_yarn; ?>
            </td>
        </tr>
    </table>

    <br>

    <?

    $uom_wise_sql="SELECT  b.cons_uom, sum(b.grey_qnty_by_uom) as grey_qnty_by_uom, sum(b.grey_qty) as grey_qty
 	from fabric_sales_order_mst a, fabric_sales_order_dtls b
	where a.id=$sales_id and a.sales_booking_no ='$booking_no' and a.id=b.mst_id and a.status_active=1 and b.is_deleted=0 group by b.cons_uom order by b.cons_uom";
    // echo $uom_wise_sql;die;
    $uom_wise_sql_data = sql_select($uom_wise_sql);
    $uom_wise_arr=array();
    foreach ($uom_wise_sql_data as $row)
    {
        $uom_wise_arr[$row[csf('cons_uom')]]['cons_uom']=$row[csf('cons_uom')];
        $uom_wise_arr[$row[csf('cons_uom')]]['grey_qnty_by_uom']+=$row[csf('grey_qnty_by_uom')];
        $uom_wise_arr[$row[csf('cons_uom')]]['grey_qty']+=$row[csf('grey_qty')];
    }

    ?>

    <div> <!-- UOM Wise Summary -->
        <strong style="font: bold 12px tahoma;">UOM Wise Summary</strong>
        <table border="1" rules="all" cellpadding="3" style="font: 12px tahoma;">
            <tr bgcolor="#CCCCCC">
                <td align="center"><strong>UOM</strong></td>
                <td align="center"><strong>Booking Qty.</strong></td>
                <td align="center"><strong>Grey Qty. (Kg)</strong></td>
            </tr>
            <?
            $i = 1;
            foreach ($uom_wise_arr as $row)
            {
                ?>
                <tr>
                    <td><? echo $unit_of_measurement[$row['cons_uom']].' To Kg'; ?></td>
                    <td><? echo number_format($row['grey_qnty_by_uom'],2); ?></td>
                    <td><p><? echo number_format($row['grey_qty'],2); ?></p></td>
                </tr>
                <?
                $i++;
            }
            ?>
        </table>
    </div>

    <br/>


    <?
    //$dtls_sql = "select b.width_dia_type,b.pre_cost_remarks,b.body_part_id, b.color_type_id,b.fabric_desc,b.gsm_weight, b.dia, b.color_id, sum(b.finish_qty) finish_qty, b.process_loss, b.grey_qty,sum(b.rmg_qty) as rmg_qty, c.item_number_id,b.pre_cost_fabric_cost_dtls_id,b.process_id from fabric_sales_order_mst a,fabric_sales_order_dtls b,wo_pre_cost_fabric_cost_dtls c where a.id=$sales_id and a.sales_booking_no ='$booking_no' and a.id=b.mst_id and b.pre_cost_fabric_cost_dtls_id=c.id and a.status_active=1 and b.is_deleted=0 group by b.body_part_id,b.color_type_id,b.fabric_desc, b.gsm_weight,b.width_dia_type, b.dia, b.process_loss, b.grey_qty,b.color_id,b.pre_cost_remarks, c.item_number_id, b.pre_cost_fabric_cost_dtls_id,b.process_id order by b.body_part_id";
    $dtls_sql = "select b.width_dia_type,b.pre_cost_remarks,b.body_part_id, b.color_type_id,b.fabric_desc,b.gsm_weight, b.dia, b.color_id, sum(b.finish_qty) finish_qty, b.process_loss, b.grey_qty,sum(b.rmg_qty) as rmg_qty, c.item_number_id,b.pre_cost_fabric_cost_dtls_id,b.process_id from fabric_sales_order_mst a,fabric_sales_order_dtls b
	left join wo_pre_cost_fabric_cost_dtls c on b.pre_cost_fabric_cost_dtls_id=c.id
	where a.id=$sales_id and a.sales_booking_no ='$booking_no' and a.id=b.mst_id and a.status_active=1 and b.is_deleted=0 group by b.body_part_id,b.color_type_id,b.fabric_desc, b.gsm_weight,b.width_dia_type, b.dia, b.process_loss, b.grey_qty,b.color_id,b.pre_cost_remarks, c.item_number_id, b.pre_cost_fabric_cost_dtls_id,b.process_id order by b.body_part_id";

    $dtls_sql_data = sql_select($dtls_sql);
    foreach ($dtls_sql_data as $rows) {
        $key = $rows[csf('body_part_id')] . '_' . $rows[csf('color_type_id')] . '_' . $rows[csf('fabric_desc')] . '_' . $rows[csf('gsm_weight')] . '_' . $rows[csf('dia')] . '_' . $rows[csf('pre_cost_remarks')]. '_' . $rows[csf('item_number_id')];

        $colorArr[$rows[csf('color_id')]] = $rows[csf('color_id')];

        $finish_qty_arr[$key][$rows[csf('color_id')]] += $rows[csf('finish_qty')];
        $grey_qty_arr[$key][$rows[csf('color_id')]] += $rows[csf('grey_qty')];
        $process_loss_arr[$key][$rows[csf('color_id')]] += $rows[csf('process_loss')];

        $tot_finish_qty_arr += $rows[csf('finish_qty')];
        $tot_grey_qty_arr += $rows[csf('grey_qty')];

        list($construction, $compositions) = explode(',', $rows[csf('fabric_desc')]);
        $body_part_data[$key] = $rows[csf('body_part_id')];
        $item_number_id[$key] = $rows[csf('item_number_id')];
        $color_type_id_arr[$key] = $rows[csf('color_type_id')];
        $constructions_arr[$key] = $construction;
        $compositions_arr[$key] = $compositions;

        $gsm_weight_arr[$key] = $rows[csf('gsm_weight')];
        $dia_arr[$key] = $rows[csf('dia')] . ',' . $fabric_typee[$rows[csf('width_dia_type')]];
        $remarks_arr[$key] = $rows[csf('pre_cost_remarks')];
        $rmg_qty_arr[$key] += $rows[csf('rmg_qty')];
        $fin_qty_arr[$key] += $rows[csf('finish_qty')];

        if($rows[csf('process_id')]!=""){$process_count+=1;}
        $process_name = '';
        $process_id_array = explode(",", $rows[csf("process_id")]);
        foreach ($process_id_array as $val) {
            if ($process_name == "") $process_name = $conversion_cost_head_array[$val]; else $process_name .= "," . $conversion_cost_head_array[$val];
        }
        $process_name_arr[$key] = $process_name;
    }

    $costing_per = "";
    $costing_per_qnty = 0;
    $costing_per_id = return_field_value("costing_per", "wo_pre_cost_mst", "job_no ='$wo_job_no'");
    if ($costing_per_id == 1) {
        $costing_per = "1 Dzn";
        $costing_per_qnty = 12;
    } elseif ($costing_per_id == 2) {
        $costing_per = "1 Pcs";
        $costing_per_qnty = 1;
    } elseif ($costing_per_id == 3) {
        $costing_per = "2 Dzn";
        $costing_per_qnty = 24;
    } elseif ($costing_per_id == 4) {
        $costing_per = "3 Dzn";
        $costing_per_qnty = 36;
    } elseif ($costing_per_id == 5) {
        $costing_per = "4 Dzn";
        $costing_per_qnty = 48;
    }


    $gmt_color_data = sql_select("select gmts_color_id,contrast_color_id FROM wo_pre_cos_fab_co_color_dtls WHERE job_no ='$wo_job_no'");
    foreach ($gmt_color_data as $gmt_color_row) {
        $gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]] = $color_library[$gmt_color_row[csf("gmts_color_id")]];
    }

    ?>
    <table width="100%" border="1" cellpadding="3" rules="all" style="font: 12px tahoma;">
        <tr>
            <td colspan="3"><strong>Item Name</strong></td>

            <?
            foreach ($item_number_id as $result_fabric_description) {
                if ($result_fabric_description == "")
                    echo "<td colspan='3'>&nbsp</td>";
                else
                    echo "<td colspan='3' align='center'>" . $garments_item[$result_fabric_description] . "</td>";
            }
            ?>
            <td rowspan="10"><strong>Total Finish</strong></td>
            <td rowspan="10"><strong>Total Grey</strong></td>
        </tr>
        <tr>
            <td colspan="3"><strong>Body Part</strong></td>
            <? foreach ($body_part_data as $val) {
                echo '<td colspan="3" align="center">' . $body_part[$val] . '</td>';
            } ?>
        </tr>
        <tr>
            <td colspan="3"><strong>Color Type</strong></td>
            <? foreach ($color_type_id_arr as $val) {
                echo '<td colspan="3" align="center">' . $color_type[$val] . '</td>';
            } ?>
        </tr>
        <tr>
            <td colspan="3"><strong>Fabric Construction </strong></td>
            <? foreach ($constructions_arr as $val) {
                echo '<td colspan="3" align="center">' . $val . '</td>';
            } ?>
        </tr>
        <tr>
            <td colspan="3"><strong>Yarn Composition</strong></td>
            <? foreach ($compositions_arr as $val) {
                echo '<td colspan="3" align="center">' . $val . '</td>';
            } ?>
        </tr>
        <tr>
            <td colspan="3"><strong>GSM </strong></td>
            <? foreach ($gsm_weight_arr as $val) {
                echo '<td colspan="3" align="center">' . $val . '</td>';
            } ?>
        </tr>
        <tr>
            <td colspan="3"><strong>Dia/Width (Inch)</strong></td>
            <? foreach ($dia_arr as $val) {
                echo '<td colspan="3" align="center">' . $val . '</td>';
            } ?>
        </tr>
        <tr>
            <td colspan="3"><strong>Consumption For <? echo $costing_per; ?></strong></td>
            <? foreach ($body_part_data as $key_ids => $val) {
                //$tot_consumption_arr+=$val;echo '<td colspan="3">'.number_format($val,2).'</td>';

                list($body_part_id, $color_type_id, $fabric_desc, $gsm_weight, $dia, $pre_cost_remarks) = explode('_', $key_ids);
                if ($pre_cost_remarks == "") {
                    $pre_cost_remarks = 0;
                }
                if ($dia != "") {
                    $dia_con = " and b.dia_width='$dia'";
                } else {
                    $dia_con = " and b.dia_width is null";
                }
                list($constrac_str, $compo_str) = explode(',', $fabric_desc);

                $sql = "select avg(b.cons) as cons from
				wo_pre_cost_fabric_cost_dtls a,
				wo_po_color_size_breakdown c,
				wo_pre_cos_fab_co_avg_con_dtls b,
				wo_booking_dtls d
				where a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				b.po_break_down_id=d.po_break_down_id and
				c.id=b.color_size_table_id and
				b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no ='$booking_no' and

				d.status_active=1 and
				d.is_deleted=0 and
				b.cons>0  and
				a.body_part_id='$body_part_id' and
				a.color_type_id='$color_type_id' and
				a.construction='$constrac_str' and
				a.composition='" . trim($compo_str) . "'  and

				a.gsm_weight='$gsm_weight' and
				b.remarks='$pre_cost_remarks'
				$dia_con
				";
                //if($rmg_qty_arr[$key_ids]==0){
                $con_sql_data = sql_select($sql);
                $conQTY = $con_sql_data[0][csf('cons')];
                //}
                //else
                //{
                //$conQTY=($fin_qty_arr[$key_ids]/$rmg_qty_arr[$key_ids])*$costing_per_qnty;
                //}


                $tot_consumption_arr += $conQTY;
                echo '<td colspan="3" align="center">' . number_format($conQTY, 2) . '</td>';
                //if($conQTY<1){echo $sql.'**';die;}
            }
            ?>
        </tr>
        <?
        if($process_count>0){
            ?>
            <tr>
                <td colspan="3"><strong>Process</strong></td>
                <? foreach ($process_name_arr as $val) {
                    echo '<td colspan="3" align="center">' . $val . '</td>';
                } ?>
            </tr>

            <?
        }
        ?>
        <tr>
            <td colspan="3"><strong>Remarks</strong></td>
            <? foreach ($remarks_arr as $val) {
                echo '<td colspan="3" align="center">' . $val . '</td>';
            } ?>
        </tr>
        <tr bgcolor="#CCCCCC">
            <td align="center"><strong>Fabric Color</strong></td>
            <td align="center"><strong>Body Color</strong></td>
            <td align="center"><strong>Lab Dip No</strong></td>
            <?
            foreach ($body_part_data as $val) {
                echo '<td align="center"><strong>Finish Fab. Qty</strong></td>';
                echo '<td align="center"><strong>Pro. Loss %</strong></td>';
                echo '<td align="center"><strong>Grey Fab. Qty</strong></td>';
            }
            ?>
        </tr>
        <? foreach ($colorArr as $colorVal) {
            $i++;
            $bgcolor = ($i % 2 == 0) ? "#E9F3FF" : "#FFFFFF";
            ?>
            <tr bgcolor="<? echo $bgcolor; ?>">
                <td align="center"><? echo $color_library[$colorVal]; ?></td>
                <td align="center"><? echo implode(",", $gmt_color_library[$colorVal]);; ?></td>
                <td align="center"><? echo return_field_value("lapdip_no", "wo_po_lapdip_approval_info", "job_no_mst='" . $wo_job_no . "' and approval_status=3 and color_name_id=" . $colorVal . ""); ?></td>
                <? foreach ($body_part_data as $key_id => $val) {
                    $color_wise_finish_tot_qty[$colorVal] += $finish_qty_arr[$key_id][$colorVal];
                    $color_wise_grey_tot_qty[$colorVal] += $grey_qty_arr[$key_id][$colorVal];
                    $all_color_finish_tot_qty[$key_id] += $finish_qty_arr[$key_id][$colorVal];
                    $all_color_grey_tot_qty[$key_id] += $grey_qty_arr[$key_id][$colorVal];

                    if (is_null($finish_qty_arr[$key_id][$colorVal]) || $finish_qty_arr[$key_id][$colorVal] == 0) {
                        echo '<td align="right"></td>';
                    } else {
                        echo '<td align="right">' . number_format($finish_qty_arr[$key_id][$colorVal], 2) . '</td>';
                    }
                    if (is_null($process_loss_arr[$key_id][$colorVal]) || $process_loss_arr[$key_id][$colorVal] == 0) {
                        echo '<td align="right"></td>';
                    } else {
                        echo '<td align="right">' . number_format($process_loss_arr[$key_id][$colorVal], 2) . '</td>';
                    }
                    if (is_null($grey_qty_arr[$key_id][$colorVal]) || $grey_qty_arr[$key_id][$colorVal] == 0) {
                        echo '<td align="right"></td>';
                    } else {
                        echo '<td align="right">' . number_format($grey_qty_arr[$key_id][$colorVal], 2) . '</td>';
                    }
                }
                ?>
                <td align="right"><strong><? echo number_format($color_wise_finish_tot_qty[$colorVal], 2); ?></strong>
                </td>
                <td align="right"><strong><? echo number_format($color_wise_grey_tot_qty[$colorVal], 2); ?></strong>
                </td>
            </tr>
            <?
        }
        ?>

        <tr bgcolor="#EEEEEE">
            <td align="center"></td>
            <td align="center">Total</td>
            <td align="center"></td>
            <? foreach ($body_part_data as $key_id => $val) {
                $grand_all_color_finish_tot_qty += $all_color_finish_tot_qty[$key_id];
                $grand_all_color_grey_tot_qty += $all_color_grey_tot_qty[$key_id];
                echo '<td align="right">' . number_format($all_color_finish_tot_qty[$key_id], 2) . '</td>';
                echo '<td></td>';
                echo '<td align="right">' . number_format($all_color_grey_tot_qty[$key_id], 2) . '</td>';
            }
            ?>
            <td align="right"><strong><? echo number_format($grand_all_color_finish_tot_qty, 2); ?></strong></td>
            <td align="right"><strong><? echo number_format($grand_all_color_grey_tot_qty, 2); ?></strong></td>
        </tr>

        <tr>
            <td align="center"></td>
            <td align="center"><strong>Consumption For <? echo $costing_per; ?></strong></td>
            <td align="center"></td>
            <? foreach ($body_part_data as $val) {
                echo '<td></td>';
                echo '<td></td>';
                echo '<td></td>';
            }
            ?>
            <td align="right"><strong><? echo number_format($tot_consumption_arr, 2); ?></strong></td>
            <td align="right"><strong></strong></td>
        </tr>

    </table>
    <br>
    <?
    $yarn_dtls_sql = "select yarn_count_id,color_id,composition_id,composition_perc,yarn_type,sum(cons_qty) as cons_qty,brand_id, supplier_id from fabric_sales_order_yarn_dtls where mst_id=$sales_id and status_active=1 and is_deleted=0 group by yarn_count_id,color_id,composition_id,composition_perc,brand_id,yarn_type,supplier_id";
    $yarn_dtls_sql_data = sql_select($yarn_dtls_sql);


    /*echo '<pre>';
    print_r($uom_wise_arr);die;*/
    ?>
    <div style="display: inline-flex;">
        <div style="float: left; margin-right: 20px;">
            <strong style="font: bold 12px tahoma;">Yarn Required Summary</strong>
            <table border="1" rules="all" cellpadding="3" style="font: 12px tahoma;">
                <tr bgcolor="#CCCCCC">
                    <td align="center"><strong>Sl No</strong></td>
                    <td align="center"><strong>Count</strong></td>
                    <td align="center"><strong>Composition</strong></td>
                    <td align="center"><strong>Color</strong></td>
                    <td align="center"><strong>Type</strong></td>
                    <td align="center"><strong>Req. Qty.</strong></td>
                    <td align="center"><strong>Supplier</strong></td>
                    <td align="center"><strong>Brand</strong></td>
                </tr>
                <?
                $i = 1;
                foreach ($yarn_dtls_sql_data as $rows)
                {
                    ?>
                    <tr>
                        <td align="center"><? echo $i; ?></td>
                        <td><? echo $yarnCount_arr[$rows[csf(yarn_count_id)]]; ?></td>
                        <td><? echo $composition[$rows[csf(composition_id)]]; ?></td>
                        <td><p><? echo $color_library[$rows[csf(color_id)]]; ?></p></td>
                        <td><p><? echo $yarn_type[$rows[csf(yarn_type)]]; ?></p></td>
                        <td align="right"><p><? echo $rows[csf(cons_qty)];
                                $tot_cons_qty += $rows[csf(cons_qty)]; ?></p></td>
                        <td><p><? echo $supplier_arr[$rows[csf(supplier_id)]]; ?></p></td>
                        <td><p><? echo $brand_arr[$rows[csf(brand_id)]]; ?></p></td>
                    </tr>
                    <?
                    $i++;
                }
                ?>
                <tr>
                    <td align="center"><strong></strong></td>
                    <td align="center"><strong></strong></td>
                    <td align="center"><strong>Total Grey</strong></td>
                    <td align="center"><strong></strong></td>
                    <td align="center"><strong></strong></td>
                    <td align="right"><strong><? echo number_format($tot_cons_qty, 2); ?></strong></td>
                    <td align="center"><strong></strong></td>
                    <td align="center"><strong></strong></td>
                </tr>
            </table>
        </div>


    </div>
    <br>
    <br>

    <?
    echo get_spacial_instruction($salesOrderNo);

    // ============================== Approval Status Start =============
    $approved_sql=sql_select("SELECT mst_id, approved_by ,approved_date as approved_date
	from approval_history where entry_form=24 and mst_id=$sales_id and un_approved_by=0 order by id");
    $user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
    $user_lib_desg=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
    $designation_lib=return_library_array("SELECT id,custom_designation from lib_designation", "id", "custom_designation");
    /*if(count($approved_sql)>0)
    {*/
    $sl=1;
    ?>
    <div style="margin-top:15px">
        <table border="1" rules="all" cellpadding="3" style="font: 12px tahoma; width:630px;" rules="all">
            <strong style="font: bold 12px tahoma;">Approval Status</strong>
            <thead>
            <tr bgcolor="#CCCCCC">
                <th width="20">SL</th>
                <th width="150">Name/Designation</th>
                <th width="80">Approval Date</th>
                <th width="30">Approval No</th>
            </tr>
            </thead>
            <? foreach ($approved_sql as $key => $value)
            {
                $approved_by=$user_lib_name[$value[csf("approved_by")]];
                $designation=$designation_lib[$user_lib_desg[$value[csf("approved_by")]]];
                $approved_date=explode(" ",$value[csf("approved_date")]);
                $am_pm=$approved_date[2];
                $approved_date=change_date_format($approved_date[0])." ".$approved_date[1];
                ?>
                <tr>
                    <td width="20"><? echo $sl; ?></td>
                    <td width="150"><? echo $approved_by.'/'.$designation; ?></td>
                    <td width="80"><? echo $approved_date ?></td>
                    <td width="30"><? echo $sl; ?></td>
                </tr>
                <?
                $sl++;
            }
            ?>
        </table>
    </div>
    <?
    //}
    // ============================== Approval Status End =============

    // ============================== Entry Status Start ==============
    $entry_status_sql=sql_select("SELECT  id, inserted_by, insert_date, updated_by, update_date
		from fabric_sales_order_mst where entry_form=109 and id=$sales_id and sales_booking_no ='$booking_no' order by  inserted_by");
    $user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
    $user_lib_desg=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
    $designation_lib=return_library_array("SELECT id,custom_designation from lib_designation", "id", "custom_designation");
    if(count($entry_status_sql)>0)
    {
        $sl=1;
        ?>
        <div style="margin-top:15px">
            <table border="1" rules="all" cellpadding="3" style="font: 12px tahoma; width:630px;" rules="all">
                <strong style="font: bold 12px tahoma;">Entry Status</strong>
                <thead>
                <tr bgcolor="#CCCCCC">
                    <th width="20">SL</th>
                    <th width="150">Name/Designation</th>
                    <th width="80">Insert Date and Time</th>
                    <th width="30">Insert and Update No</th>
                </tr>
                </thead>
                <? foreach ($entry_status_sql as $key => $value)
                {
                    $inserted_by=$user_lib_name[$value[csf("inserted_by")]];
                    $insert_designation=$designation_lib[$user_lib_desg[$value[csf("inserted_by")]]];
                    $insert_date=explode(" ",$value[csf("insert_date")]);
                    $insert_date=change_date_format($insert_date[0])." ".$insert_date[1];

                    $updated_by=$user_lib_name[$value[csf("updated_by")]];
                    $updated_designation=$designation_lib[$user_lib_desg[$value[csf("updated_by")]]];
                    $update_date=explode(" ",$value[csf("update_date")]);
                    $update_date=change_date_format($update_date[0])." ".$update_date[1];
                    ?>
                    <tr>
                        <td width="20"><? echo $sl; ?></td>
                        <td width="150"><? echo $inserted_by.'/'.$insert_designation; ?></td>
                        <td width="80"><? echo $insert_date ?></td>
                        <td width="30"><? echo 1; ?></td>
                    </tr>
                    <?
                    $sl++;
                    if($value[csf("update_date")] !='0000-00-00 00:00:00' && $value[csf("update_date")] !='')
                    {
                        ?>
                        <tr>
                            <td width="20"><? echo $sl; ?></td>
                            <td width="150"><? echo $updated_by.'/'.$updated_designation; ?></td>
                            <td width="80"><? echo $update_date ?></td>
                            <td width="30"><? echo 2; ?></td>
                        </tr>

                        <?
                        $sl++;
                    }
                }
                ?>
            </table>
        </div>
        <?
    }
    // ============================== Entry Status End ===============

    echo "<br><br><br><br><br>";
    echo signature_table(176, $data[0], "1000px","","10");

    exit();
}

if($action=="show_service_booking_report")
{
    $data = explode('*', $data);
    $cbo_company_name=str_replace("'","",$data[0]);
    $txt_booking_no = "'".$data[1]."'";

    $imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
    $country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
    $supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
    $supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
    $company_address_arr=return_library_array( "select id,city from   lib_company",'id','city');
    $buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
    //$po_qnty_tot=return_field_value( "sum(plan_cut)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
    ?>
    <div style="width:1333px" align="center">
        <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black">
            <tr>
                <td width="100">
                    <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
                </td>
                <td width="1000">
                    <table width="100%" cellpadding="0" cellspacing="0" >
                        <tr>
                            <td align="center" style="font-size:18px;"><?=$company_library[$cbo_company_name]; ?></td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:14px">
                                <?
                                $nameArray=sql_select( "select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                                foreach ($nameArray as $result)
                                {
                                    ?>
                                    Plot No: <? echo $result[csf('plot_no')]; ?>
                                    Level No: <? echo $result[csf('level_no')]?>
                                    Road No: <? echo $result[csf('road_no')]; ?>
                                    Block No: <? echo $result[csf('block_no')];?>
                                    City No: <? echo $result[csf('city')];?>
                                    Zip Code: <? echo $result[csf('zip_code')]; ?>
                                    Province No: <?php echo $result[csf('province')]; ?>
                                    Country: <? echo $country_arr[$result[csf('country_id')]]; ?><br>
                                    Email Address: <? echo $result[csf('email')];?>
                                    Website No: <? echo $result[csf('website')];
                                }
                                ?>
                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:20px">
                                <strong>Service Booking Sheet</strong>
                            </td>
                        </tr>
                    </table>
                </td>
                <td width="250" id="barcode_img_id"></td>
            </tr>
        </table>
        <?
        $booking_grand_total=0; $job_no=""; $currency_id=""; $po_no=""; $$style_ref="";
        $sqljobBooking="select c.job_no, c.style_ref_no, c.buyer_name as buyer_id, d.po_number from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d where a.booking_no=b.booking_no and b.po_break_down_id=d.id and c.job_no=d.job_no_mst and b.job_no=c.job_no and a.booking_no=$txt_booking_no";
        $nameArray_job=sql_select($sqljobBooking);
        $buyer_name=$nameArray_job[0][csf('buyer_id')];
        foreach ($nameArray_job as $result_job)
        {
            $job_no.=$result_job[csf('job_no')].",";
            $po_no.=$result_job[csf('po_number')].",";
            $style_ref.=$result_job[csf('style_ref_no')].",";
        }
        $job_no=implode(",",array_filter(array_unique(explode(',',$job_no))));
        $po_no=implode(",",array_filter(array_unique(explode(',',$po_no))));
        $style_ref=implode(",",array_filter(array_unique(explode(',',$style_ref))));

        $nameArray=sql_select( "select a.booking_no, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.source, a.pay_mode  from wo_booking_mst a where a.booking_no=$txt_booking_no");
        foreach ($nameArray as $result)
        {
            $varcode_booking_no=$result[csf('booking_no')];
            ?>
            <table width="100%" style="border:1px solid black">
                <tr>
                    <td colspan="6" valign="top"></td>
                </tr>
                <tr>
                    <td width="100" style="font-size:12px"><b>Booking No </b>   </td>
                    <td width="110">:&nbsp;<? echo $result[csf('booking_no')];?> </td>
                    <td width="100" style="font-size:12px"><b>Booking Date</b></td>
                    <td width="110">:&nbsp;<? echo change_date_format($result[csf('booking_date')],'dd-mm-yyyy','-');?>&nbsp;&nbsp;&nbsp;</td>
                    <td width="100"><span style="font-size:12px"><b>Delivery Date</b></span></td>
                    <td width="110">:&nbsp;<? echo change_date_format($result[csf('delivery_date')],'dd-mm-yyyy','-');?></td>
                </tr>
                <tr>
                    <td style="font-size:12px"><b>Currency</b></td>
                    <td>:&nbsp;<? $currency_id=$result[csf('currency_id')];echo $currency[$result[csf('currency_id')]]; ?></td>
                    <td style="font-size:12px"><b>Conversion Rate</b></td>
                    <td>:&nbsp;<? echo $result[csf('exchange_rate')]; ?></td>
                    <td style="font-size:12px"><b>Source</b></td>
                    <td>:&nbsp;<? echo $source[$result[csf('source')]]; ?></td>
                </tr>
                <tr>
                    <td style="font-size:12px"><b>Supplier Name</b>   </td>
                    <td>:&nbsp;<?
                        if($result[csf("pay_mode")]!=3 && $result[csf("pay_mode")]!=5)
                        {
                            echo $supplier_name_arr[$result[csf('supplier_id')]];
                        }
                        else
                        {
                            echo $company_library[$result[csf('supplier_id')]];
                        }
                        ?>    </td>
                    <td style="font-size:12px"><b>Supplier Address</b></td>
                    <td>:&nbsp;<?
                        if($result[csf("pay_mode")]!=3 && $result[csf("pay_mode")]!=5)
                        {
                            echo $supplier_address_arr[$result[csf('supplier_id')]];
                        }
                        else
                        {
                            echo $company_address_arr[$result[csf('supplier_id')]];
                        }
                        ?></td>
                    <td style="font-size:12px"><b>Attention</b></td>
                    <td>:&nbsp;<? echo $result[csf('attention')]; ?></td>
                </tr>
                <tr>
                    <td style="font-size:12px"><b>Job No</b>   </td>
                    <td>:&nbsp;<?=$job_no; ?></td>
                    <td style="font-size:12px"><b>PO No</b> </td>
                    <td style="font-size:12px" >:&nbsp;<?=$po_no; ?> </td>
                    <td style="font-size:12px"><b>Buyer Name</b>   </td>
                    <td>:&nbsp;<?=$buyer_name_arr[$buyer_name]; ?></td>
                </tr>
                <tr>
                    <td style="font-size:12px"><b>Style Ref:</b></td>
                    <td>&nbsp;<?=$style_ref; ?></td>
                    <td style="font-size:12px">&nbsp;</td>
                    <td style="font-size:12px">&nbsp;</td>
                    <td style="font-size:12px"><b>&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
            </table>
            <?
        }
        ?>
        <!--==============================================AS PER GMTS COLOR START=========================================  -->
        <?
        //========================================
        $fabric_description_array=array();
        $wo_pre_cost_fab_conv_cost_dtls_id=sql_select("select id,fabric_description,cons_process from wo_pre_cost_fab_conv_cost_dtls  where job_no='".rtrim($job_no,", ")."'");
        foreach( $wo_pre_cost_fab_conv_cost_dtls_id as $row_wo_pre_cost_fab_conv_cost_dtls_id)
        {
            if($row_wo_pre_cost_fab_conv_cost_dtls_id[csf("fabric_description")]!=0)
            {
                $fabric_description=sql_select("select id,body_part_id,color_type_id,fabric_description,gsm_weight from  wo_pre_cost_fabric_cost_dtls  where  id='".$row_wo_pre_cost_fab_conv_cost_dtls_id[csf("fabric_description")]."'");//gsm_weight
                list($fabric_description_row)=$fabric_description;
                $fabric_description_array[$row_wo_pre_cost_fab_conv_cost_dtls_id[csf("id")]]=$body_part[$fabric_description_row[csf("body_part_id")]].', '.$color_type[$fabric_description_row[csf("color_type_id")]].', '.$fabric_description_row[csf("fabric_description")].', '.$fabric_description_row[csf("gsm_weight")];//.', '.$fabric_description_row[csf("gsm_weight")]
            }
            if($row_wo_pre_cost_fab_conv_cost_dtls_id[csf("fabric_description")]==0)
            {
                //echo "select id,body_part_id,color_type_id,fabric_description from  wo_pre_cost_fabric_cost_dtls  where  job_no='$data'";
                $fabric_description=sql_select("select id,body_part_id,color_type_id,fabric_description,gsm_weight from  wo_pre_cost_fabric_cost_dtls  where  job_no='".rtrim($job_no,", ")."'");//gsm_weight
                //list($fabric_description_row)=$fabric_description;
                foreach( $fabric_description as $fabric_description_row)
                {
                    $fabric_description_array[$row_wo_pre_cost_fab_conv_cost_dtls_id[csf("id")]].=$body_part[$fabric_description_row[csf("body_part_id")]].', '.$color_type[$fabric_description_row[csf("color_type_id")]].', '.$fabric_description_row[csf("fabric_description")].", ".$fabric_description_row[csf("gsm_weight")];
                }
            }
        }
        //print_r($fabric_description_array);
        //=================================================
        $nameArray_item=sql_select( "select distinct process from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=1 and wo_qnty !=0 and status_active=1 ");
        //echo "select distinct process from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=1";
        $nameArray_color=sql_select( "select distinct fabric_color_id from wo_booking_dtls   where  booking_no=$txt_booking_no and sensitivity=1 and wo_qnty !=0 and status_active=1 " );
        if(count($nameArray_color)>0)
        {
            ?>
            <table border="0" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" >
                <tr>
                    <td colspan="<? echo count($nameArray_color)+8; ?>" align="">
                        <strong>As Per Garments Color</strong>
                    </td>
                </tr>
                <tr>
                    <td style="border:1px solid black"><strong>Sl</strong> </td>
                    <td style="border:1px solid black"><strong>Service Type</strong> </td>
                    <td style="border:1px solid black"><strong>Item Description</strong> </td>
                    <td style="border:1px solid black"><strong>Item Color</strong> </td>
                    <?
                    foreach($nameArray_color  as $result_color)
                    {	     ?>
                        <td align="center" style="border:1px solid black"><strong><? echo $color_library[$result_color[csf('fabric_color_id')]];?></strong></td>
                    <?	}    ?>
                    <td style="border:1px solid black" align="center"><strong>Total</strong></td>
                    <td style="border:1px solid black" align="center"><strong>Fin Dia</strong></td>
                    <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                    <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                    <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                </tr>
                <?
                $i=0;
                $grand_total_as_per_gmts_color=0;
                foreach($nameArray_item as $result_item)
                {
                    $i++;
                    $nameArray_item_description=sql_select("select distinct description,rate,uom,dia_width from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=1 and process=".$result_item[csf('process')]." and wo_qnty !=0 and status_active=1");
                    //echo "select distinct description,rate,uom,dia_width from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=1 and process=".$result_item[csf('process')]." and wo_qnty !=0 and status_active=1"; die;
                    ?>
                    <tr>
                    <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                        <? echo $i; ?>
                    </td>
                    <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                        <? echo $conversion_cost_head_array[$result_item[csf('process')]]; ?>
                    </td>
                    <?
                    $color_tatal=array();
                    $total_amount_as_per_gmts_color=0;

                    foreach($nameArray_item_description as $result_itemdescription)
                    {
                        $item_desctiption_total=0;
                        ?>
                        <td style="border:1px solid black"><? echo rtrim($fabric_description_array[$result_itemdescription[csf('description')]],", "); ?> </td>
                        <td style="border:1px solid black">Booking Qty.</td>
                        <?
                        foreach($nameArray_color  as $result_color)
                        {
                            if($result_itemdescription[csf('dia_width')] !=''){
                                $dia_con="and dia_width='".$result_itemdescription[csf('dia_width')]."'";
                            }
                            else{
                                $dia_con="and dia_width is null";
                            }
                            $nameArray_color_size_qnty=sql_select("select sum(wo_qnty) as cons from wo_booking_dtls   where   booking_no=$txt_booking_no and sensitivity=1 and status_active=1  and process=". $result_item[csf('process')]." and description='". $result_itemdescription[csf('description')]."' and rate='". $result_itemdescription[csf('rate')]."' and uom='". $result_itemdescription[csf('uom')]."' $dia_con and fabric_color_id=".$result_color[csf('fabric_color_id')]."");

                            foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                            {
                                ?>
                                <td style="border:1px solid black; text-align:right">
                                    <?
                                    if($result_color_size_qnty[csf('cons')]!= "")
                                    {
                                        echo number_format($result_color_size_qnty[csf('cons')],2);
                                        $item_desctiption_total+=$result_color_size_qnty[csf('cons')] ;
                                        if (array_key_exists($result_color[csf('fabric_color_id')], $color_tatal))
                                        {
                                            $color_tatal[$result_color[csf('fabric_color_id')]]+=$result_color_size_qnty[csf('cons')];
                                        }
                                        else
                                        {
                                            $color_tatal[$result_color[csf('fabric_color_id')]]=$result_color_size_qnty[csf('cons')];
                                        }
                                    }
                                    else echo "";
                                    ?>
                                </td>
                                <?
                            }
                        }
                        ?>

                        <td style="border:1px solid black; text-align:right"><? echo number_format($item_desctiption_total,2); ?></td>
                        <td style="border:1px solid black;text-align:center"><? echo $result_itemdescription[csf('dia_width')]; ?></td>
                        <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$result_itemdescription[csf('uom')]]; ?></td>
                        <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                        <td style="border:1px solid black; text-align:right">
                            <?
                            $amount_as_per_gmts_color = $item_desctiption_total*$result_itemdescription[csf('rate')];
                            echo number_format($amount_as_per_gmts_color,4);
                            $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                            ?>
                        </td>
                        </tr>
                        <?
                    }
                    ?>
                    <tr>
                        <td style="border:1px solid black;  text-align:right" colspan="2"><strong> Item Total</strong></td>
                        <?
                        foreach($nameArray_color  as $result_color)
                        {

                            ?>
                            <td style="border:1px solid black;  text-align:right">
                                <?
                                if($color_tatal[$result_color[fabric_color_id]] !='')
                                {
                                    echo number_format($color_tatal[$result_color[fabric_color_id]],2);
                                }
                                ?>
                            </td>
                            <?
                        }
                        ?>
                        <td style="border:1px solid black;  text-align:right"><? echo number_format(array_sum($color_tatal),2);  ?></td>
                        <td style="border:1px solid black;  text-align:right"><? //echo number_format(array_sum($color_tatal),2);  ?></td>
                        <td style="border:1px solid black;  text-align:right"><? //echo number_format(array_sum($color_tatal),2);  ?></td>
                        <td style="border:1px solid black; text-align:right"><? //echo number_format(round($color_total),0); ?></td>
                        <td style="border:1px solid black; text-align:right">
                            <?
                            echo number_format($total_amount_as_per_gmts_color,4);
                            $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                            ?>
                        </td>
                    </tr>
                    <?
                }
                ?>
                <tr>
                    <td align="right" style="border:1px solid black"  colspan="<? echo count($nameArray_color)+8; ?>"><strong>Total</strong></td>
                    <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                </tr>
            </table>
            <br/>
            <?
        }
        ?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->

        <!--==============================================AS PER GMTS SIZE START=========================================  -->
        <?
        //$nameArray_item=sql_select( "select distinct process from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=1");
        //echo "select distinct process from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=1";
        // $nameArray_color=sql_select( "select distinct fabric_color_id from wo_booking_dtls   where  booking_no=$txt_booking_no and sensitivity=1");


        $nameArray_item=sql_select( "select distinct process from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=2 and wo_qnty !=0 and status_active=1 ");
        $nameArray_size=sql_select( "select distinct  item_size  as gmts_sizes from wo_booking_dtls   where booking_no=$txt_booking_no and sensitivity=2 and wo_qnty !=0 and status_active=1 ");
        if(count($nameArray_size)>0)
        {
            ?>

            <table border="0" align="left" cellpadding="0" width="100%" cellspacing="0" >
                <tr>
                    <td colspan="<? echo count($nameArray_size)+8; ?>" align="">
                        <strong>As Per Garments Size </strong>
                    </td>
                </tr>
                <tr>
                    <td style="border:1px solid black"><strong>Sl</strong> </td>
                    <td style="border:1px solid black"><strong>Service Type</strong> </td>
                    <td style="border:1px solid black"><strong>Item Description</strong> </td>
                    <td style="border:1px solid black"><strong>Item size</strong> </td>
                    <?
                    foreach($nameArray_size  as $result_size)
                    {	     ?>
                        <td align="center" style="border:1px solid black"><strong><? echo $result_size[csf('gmts_sizes')];?></strong></td>
                    <?	}    ?>
                    <td style="border:1px solid black" align="center"><strong>Total</strong></td>
                    <td style="border:1px solid black" align="center"><strong>Fin Dia</strong></td>
                    <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                    <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                    <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                </tr>
                <?
                $i=0;
                $grand_total_as_per_gmts_color=0;
                foreach($nameArray_item as $result_item)
                {
                    $i++;
                    $nameArray_item_description=sql_select( "select distinct description,rate,uom,dia_width from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=2 and process=".$result_item[csf('process')]." and wo_qnty !=0 and status_active=1 ");
                    ?>
                    <tr>
                    <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                        <? echo $i ; ?>
                    </td>
                    <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                        <? echo $conversion_cost_head_array[$result_item[csf('process')]]; ?>
                    </td>
                    <?
                    $color_tatal=array();
                    $total_amount_as_per_gmts_color=0;
                    foreach($nameArray_item_description as $result_itemdescription)
                    {
                        $item_desctiption_total=0;
                        ?>
                        <td style="border:1px solid black"><? echo $fabric_description_array[$result_itemdescription[csf('description')]]; ?> </td>
                        <td style="border:1px solid black"><? //echo $result_itemdescription['brand_supplier']; ?> Booking Qnty  </td>
                        <?
                        foreach($nameArray_size  as $result_size)
                        {
                            $nameArray_size_size_qnty=sql_select( "select sum(wo_qnty) as cons from wo_booking_dtls   where   booking_no=$txt_booking_no and sensitivity=2 and process=". $result_item[csf('process')]." and description='". $result_itemdescription[csf('description')]."' and rate='". $result_itemdescription[csf('rate')]."' and uom='". $result_itemdescription[csf('uom')]."' and dia_width='". $result_itemdescription[csf('dia_width')]."' and item_size='".$result_size[csf('gmts_sizes')]."' and status_active=1 ");

                            foreach($nameArray_size_size_qnty as $result_size_size_qnty)
                            {
                                ?>
                                <td style="border:1px solid black; text-align:right">
                                    <?
                                    if($result_size_size_qnty[csf('cons')]!= "")
                                    {
                                        echo number_format($result_size_size_qnty[csf('cons')],2);
                                        $item_desctiption_total += $result_size_size_qnty[csf('cons')] ;
                                        if (array_key_exists($result_size[csf('gmts_sizes')], $color_tatal))
                                        {
                                            $color_tatal[$result_size[csf('gmts_sizes')]]+=$result_size_size_qnty[csf('cons')];
                                        }
                                        else
                                        {
                                            $color_tatal[$result_size[csf('gmts_sizes')]]=$result_size_size_qnty[csf('cons')];
                                        }
                                    }
                                    else echo "";
                                    ?>
                                </td>
                                <?
                            }
                        }
                        ?>

                        <td style="border:1px solid black; text-align:right"><? echo number_format($item_desctiption_total,2); ?></td>
                        <td style="border:1px solid black;text-align:center"><? echo $result_itemdescription[csf('dia_width')]; ?></td>
                        <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$result_itemdescription[csf('uom')]]; ?></td>
                        <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                        <td style="border:1px solid black; text-align:right">
                            <?
                            $amount_as_per_gmts_color = $item_desctiption_total*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                            $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                            ?>
                        </td>
                        </tr>
                        <?
                    }
                    ?>
                    <tr>
                        <td style="border:1px solid black;  text-align:right" colspan="2"><strong> Item Total</strong></td>
                        <?
                        foreach($nameArray_size  as $result_size)
                        {

                            ?>
                            <td style="border:1px solid black;  text-align:right">
                                <?
                                if($color_tatal[$result_size[gmts_sizes]] !='')
                                {
                                    echo number_format($color_tatal[$result_size[gmts_sizes]],2);
                                }
                                ?>
                            </td>
                            <?
                        }
                        ?>
                        <td style="border:1px solid black;  text-align:right"><? echo number_format(array_sum($color_tatal),2);  ?></td>
                        <td style="border:1px solid black;  text-align:right"><? //echo number_format(array_sum($color_tatal),2);  ?></td>
                        <td style="border:1px solid black;  text-align:right"><? //echo number_format(array_sum($color_tatal),2);  ?></td>
                        <td style="border:1px solid black; text-align:right"><? //echo number_format(round($color_total),0); ?></td>
                        <td style="border:1px solid black; text-align:right">
                            <?
                            echo number_format($total_amount_as_per_gmts_color,4);
                            $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                            ?>
                        </td>
                    </tr>
                    <?
                }
                ?>
                <tr>
                    <td align="right" style="border:1px solid black"  colspan="<? echo count($nameArray_size)+8; ?>"><strong>Total</strong></td>
                    <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,4); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                </tr>
            </table>
            <br/>
            <?
        }
        ?>
        <!--==============================================AS PER SIZE  END=========================================  -->

        <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
        <?
        //$nameArray_item=sql_select( "select distinct process from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=2");
        // $nameArray_size=sql_select( "select distinct  item_size  as gmts_sizes from wo_booking_dtls   where booking_no=$txt_booking_no and sensitivity=2");

        $nameArray_item=sql_select( "select distinct process from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=3 and wo_qnty !=0 and status_active=1 ");
        $nameArray_color=sql_select( "select distinct fabric_color_id as color_number_id from wo_booking_dtls   where booking_no=$txt_booking_no and sensitivity=3 and wo_qnty !=0 and status_active=1 ");
        if(count($nameArray_color)>0)
        {
            ?>
            <table border="0" align="left" cellpadding="0" width="100%" cellspacing="0" >
                <tr>
                    <td colspan="<? echo count($nameArray_color)+8; ?>" align="">
                        <strong>Contrast Color</strong>
                    </td>
                </tr>
                <tr>
                    <td style="border:1px solid black"><strong>Sl</strong> </td>
                    <td style="border:1px solid black"><strong>Service Type</strong> </td>
                    <td style="border:1px solid black"><strong>Item Description</strong> </td>
                    <td style="border:1px solid black"><strong>Item Color</strong> </td>
                    <?
                    foreach($nameArray_color  as $result_color)
                    {	     ?>
                        <td align="center" style="border:1px solid black"><strong><? echo $color_library[$result_color[csf('color_number_id')]];?></strong></td>
                    <?	}    ?>
                    <td style="border:1px solid black" align="center"><strong>Total</strong></td>
                    <td style="border:1px solid black" align="center"><strong>Fin Dia</strong></td>
                    <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                    <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                    <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                </tr>
                <?
                $i=0;
                $grand_total_as_per_gmts_color=0;
                foreach($nameArray_item as $result_item)
                {
                    $i++;
                    //echo "select distinct description,rate,uom,dia_width from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=3 and process=".$result_item[csf('process')]." and wo_qnty !=0 ";
                    $nameArray_item_description=sql_select( "select distinct description,rate,uom,dia_width from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=3 and process=".$result_item[csf('process')]." and wo_qnty !=0 and status_active=1 ");
                    ?>
                    <tr>
                    <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                        <? echo $i; ?>
                    </td>
                    <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                        <? echo $conversion_cost_head_array[$result_item[csf('process')]]; ?>
                    </td>
                    <?
                    $color_tatal=array();
                    $total_amount_as_per_gmts_color=0;
                    foreach($nameArray_item_description as $result_itemdescription)
                    {
                        $item_desctiption_total=0;
                        ?>
                        <td style="border:1px solid black"><? echo $fabric_description_array[$result_itemdescription[csf('description')]]; ?> </td>
                        <td style="border:1px solid black"><? //echo $result_itemdescription['brand_supplier']; ?> Booking Qnty  </td>
                        <?
                        foreach($nameArray_color  as $result_color)
                        {
                            $nameArray_color_size_qnty=sql_select( "select sum(wo_qnty) as cons from wo_booking_dtls    where   booking_no=$txt_booking_no and sensitivity=3 and process=". $result_item[csf('process')]." and description='". $result_itemdescription[csf('description')]."' and rate='". $result_itemdescription[csf('rate')]."' and uom='". $result_itemdescription[csf('uom')]."' and dia_width='". $result_itemdescription[csf('dia_width')]."' and fabric_color_id=".$result_color[csf('color_number_id')]." and status_active=1 ");
                            foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                            {
                                ?>
                                <td style="border:1px solid black; text-align:right">
                                    <?
                                    if($result_color_size_qnty[csf('cons')]!= "")
                                    {
                                        echo number_format($result_color_size_qnty[csf('cons')],2);
                                        $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                                        if (array_key_exists($result_color[csf('color_number_id')], $color_tatal))
                                        {
                                            $color_tatal[$result_color[csf('color_number_id')]]+=$result_color_size_qnty[csf('cons')];
                                        }
                                        else
                                        {
                                            $color_tatal[$result_color[csf('color_number_id')]]=$result_color_size_qnty[csf('cons')];
                                        }
                                    }
                                    else echo "";
                                    ?>
                                </td>
                                <?
                            }
                        }
                        ?>
                        <td style="border:1px solid black; text-align:right"><? echo number_format($item_desctiption_total,2); ?></td>
                        <td style="border:1px solid black; text-align:center"><? echo $result_itemdescription[csf('dia_width')]; ?></td>
                        <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$result_itemdescription[csf('uom')]]; ?></td>
                        <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                        <td style="border:1px solid black; text-align:right">
                            <?
                            $amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                            $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                            ?>
                        </td>
                        </tr>
                        <?
                    }
                    ?>
                    <tr>
                        <td style="border:1px solid black;  text-align:right" colspan="2"><strong> Item Total</strong></td>
                        <?
                        foreach($nameArray_color  as $result_color)
                        {

                            ?>
                            <td style="border:1px solid black;  text-align:right">
                                <?
                                if($color_tatal[$result_color[csf('color_number_id')]] !='')
                                {
                                    echo number_format($color_tatal[$result_color[csf('color_number_id')]],2);
                                }
                                ?>
                            </td>
                            <?
                        }
                        ?>
                        <td style="border:1px solid black;  text-align:right"><? echo number_format(array_sum($color_tatal),2);  ?></td>
                        <td style="border:1px solid black;text-align:center"></td>
                        <td style="border:1px solid black;text-align:center"></td>
                        <td style="border:1px solid black; text-align:right"><? //echo number_format(round($color_total),0); ?></td>
                        <td style="border:1px solid black; text-align:right">
                            <?
                            echo number_format($total_amount_as_per_gmts_color,4);
                            $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                            ?>
                        </td>
                    </tr>
                    <?
                }
                ?>
                <tr>
                    <td align="right" style="border:1px solid black"  colspan="<? echo count($nameArray_color)+8; ?>"><strong>Total</strong></td>
                    <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                </tr>
            </table>
            <br/>
            <?
        }
        ?>
        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
        <?
        //$nameArray_item=sql_select( "select distinct process from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=2");
        // $nameArray_size=sql_select( "select distinct  item_size  as gmts_sizes from wo_booking_dtls   where booking_no=$txt_booking_no and sensitivity=2");
        //$nameArray_color=sql_select( "select distinct fabric_color_id as color_number_id from wo_booking_dtls   where booking_no=$txt_booking_no and sensitivity=3");

        $nameArray_item=sql_select( "select distinct process from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=4 and wo_qnty !=0 and status_active=1 ");
        $nameArray_size=sql_select( "select distinct item_size  as gmts_sizes from wo_booking_dtls   where booking_no=$txt_booking_no and sensitivity=4 and wo_qnty !=0 and status_active=1 ");
        $nameArray_color=sql_select( "select distinct fabric_color_id as color_number_id from wo_booking_dtls   where booking_no=$txt_booking_no and sensitivity=4 and wo_qnty !=0 and status_active=1 ");

        if(count($nameArray_size)>0)
        {
            ?>

            <table border="0" align="left" cellpadding="0" width="100%" cellspacing="0" >
                <tr>
                    <td colspan="<? echo count($nameArray_size)+8; ?>" align="">
                        <strong>Color & size sensitive </strong>
                    </td>
                </tr>
                <tr>
                    <td style="border:1px solid black"><strong>Sl</strong> </td>
                    <td style="border:1px solid black"><strong>Service Type</strong> </td>
                    <td style="border:1px solid black"><strong>Item Description</strong> </td>
                    <td style="border:1px solid black"><strong></strong> </td>
                    <td style="border:1px solid black"><strong>Item Color</strong> </td>
                    <?
                    foreach($nameArray_size  as $result_size)
                    {	     ?>
                        <td align="center" style="border:1px solid black"><strong><? echo $result_size[csf('gmts_sizes')];?></strong></td>
                    <?	}    ?>
                    <td style="border:1px solid black" align="center"><strong>Total</strong></td>
                    <td style="border:1px solid black" align="center"><strong>Fin Dia</strong></td>
                    <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                    <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                    <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                </tr>
                <?
                $i=0;
                $grand_total_as_per_gmts_color=0;
                foreach($nameArray_item as $result_item)
                {
                    $i++;
                    $nameArray_item_description=sql_select( "select distinct description,rate,uom,dia_width from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=4 and process=".$result_item[csf('process')]." and wo_qnty !=0 and status_active=1 ");
                    ?>
                    <tr>
                    <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                        <? echo $i ; ?>
                    </td>
                    <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
                        <? echo $conversion_cost_head_array[$result_item[csf('process')]]; ?>
                    </td>
                    <?
                    $color_tatal=array();
                    $total_amount_as_per_gmts_color=0;
                    foreach($nameArray_item_description as $result_itemdescription)
                    {
                        ?>
                        <td style="border:1px solid black" rowspan="<? echo count($nameArray_color); ?>"><? echo $fabric_description_array[$result_itemdescription[csf('description')]]; ?> </td>
                        <td style="border:1px solid black" rowspan="<? echo count($nameArray_color); ?>"><? //echo $result_itemdescription['brand_supplier']; ?>Booking Qnty </td>
                        <?
                        //$item_desctiption_total=0;
                        foreach($nameArray_color as $result_color)
                        {
                            $item_desctiption_total=0;
                            ?>

                            <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                            <?
                            foreach($nameArray_size  as $result_size)
                            {
                                $nameArray_size_size_qnty=sql_select( "select sum(wo_qnty) as cons from wo_booking_dtls   where booking_no=$txt_booking_no and sensitivity=4 and process=". $result_item[csf('process')]." and  description='". $result_itemdescription[csf('description')]."' and  item_size='".$result_size[csf('gmts_sizes')]."' and rate='". $result_itemdescription[csf('rate')]."' and uom='". $result_itemdescription[csf('uom')]."' and dia_width='". $result_itemdescription[csf('dia_width')]."' and fabric_color_id=".$result_color[csf('color_number_id')]." and status_active=1 ");
                                foreach($nameArray_size_size_qnty as $result_size_size_qnty)
                                {
                                    ?>
                                    <td style="border:1px solid black; text-align:right">
                                        <?
                                        if($result_size_size_qnty[csf('cons')]!= "")
                                        {
                                            echo number_format($result_size_size_qnty[csf('cons')],2);
                                            $item_desctiption_total += $result_size_size_qnty[csf('cons')] ;
                                            if (array_key_exists($result_size[csf('color_number_id')], $color_tatal))
                                            {
                                                $color_tatal[$result_size[csf('color_number_id')]]+=$result_size_size_qnty[csf('cons')];
                                            }
                                            else
                                            {
                                                $color_tatal[$result_size[csf('color_number_id')]]=$result_size_size_qnty[csf('cons')];
                                            }
                                        }
                                        else echo "";
                                        ?>
                                    </td>
                                    <?
                                }
                            }
                            ?>

                            <td style="border:1px solid black; text-align:right"><? echo number_format($item_desctiption_total,2); ?></td>
                            <td style="border:1px solid black;text-align:center"><? echo $result_itemdescription[csf('dia_width')]; ?></td>
                            <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$result_itemdescription[csf('uom')]]; ?></td>
                            <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                            <td style="border:1px solid black; text-align:right">
                                <?
                                $amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                                ?>
                            </td>
                            </tr>
                            <?
                        }
                    }
                    ?>
                    <tr>
                        <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                        <?
                        foreach($nameArray_size  as $result_size)
                        {

                            ?>
                            <td style="border:1px solid black;  text-align:right">
                                <?
                                if($color_tatal[$result_size[csf('gmts_sizes')]] !='')
                                {
                                    echo number_format($color_tatal[$result_size[csf('gmts_sizes')]],2);
                                }
                                ?>
                            </td>
                            <?
                        }
                        ?>
                        <td style="border:1px solid black;  text-align:right"><? echo number_format(array_sum($color_tatal),2);  ?></td>
                        <td style="border:1px solid black;  text-align:right"><? //echo number_format(array_sum($color_tatal),2);  ?></td>
                        <td style="border:1px solid black;  text-align:right"><? //echo number_format(array_sum($color_tatal),2);  ?></td>
                        <td style="border:1px solid black; text-align:right"><? //echo number_format(round($color_total),0); ?></td>
                        <td style="border:1px solid black; text-align:right">
                            <?
                            echo number_format($total_amount_as_per_gmts_color,4);
                            $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                            ?>
                        </td>
                    </tr>
                    <?
                }
                ?>
                <tr>
                    <td align="right" style="border:1px solid black"  colspan="<? echo count($nameArray_size)+9; ?>"><strong>Total</strong></td>
                    <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                </tr>
            </table>
            <br/>
            <?
        }
        ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->


        <!--==============================================NO NENSITIBITY START=========================================  -->
        <?
        $nameArray_item=sql_select( "select distinct process from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=0 and wo_qnty !=0 and status_active=1 ");
        //$nameArray_color=sql_select( "select distinct b.color_number_id from wo_trims_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=$txt_booking_no and a.sensitivity=1");
        $nameArray_color= array();
        if(count($nameArray_item)>0)
        {
            ?>
            <table border="0" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" >
                <tr>
                    <td colspan="7" align="">
                        <strong>No Sensitivity</strong>
                    </td>
                </tr>
                <tr>
                    <td style="border:1px solid black"><strong>Sl</strong> </td>
                    <td style="border:1px solid black"><strong>Service Type</strong> </td>
                    <td style="border:1px solid black"><strong>Item Description</strong> </td>
                    <td style="border:1px solid black"><strong></strong> </td>
                    <td align="center" style="border:1px solid black"><strong> Qnty</strong></td>
                    <td style="border:1px solid black" align="center"><strong>Fin Dia</strong></td>
                    <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                    <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                    <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                </tr>
                <?
                $i=0;
                $grand_total_as_per_gmts_color=0;
                foreach($nameArray_item as $result_item)
                {
                    $i++;
                    $nameArray_item_description=sql_select( "select distinct description,rate,uom,dia_width from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=0 and process=".$result_item[csf('process')]." and wo_qnty !=0 and status_active=1 ");
                    ?>
                    <tr>
                    <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                        <? echo $i; ?>
                    </td>
                    <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                        <? echo $conversion_cost_head_array[$result_item[csf('process')]]; ?>
                    </td>
                    <?
                    $color_tatal=0;
                    $total_amount_as_per_gmts_color=0;
                    foreach($nameArray_item_description as $result_itemdescription)
                    {
                        $item_desctiption_total=0;
                        ?>
                        <td style="border:1px solid black"><? echo $fabric_description_array[$result_itemdescription[csf('description')]]; ?> </td>
                        <td style="border:1px solid black"><? //echo $result_itemdescription['brand_supplier']; ?>Booking Qnty  </td>
                        <?
                        if($result_itemdescription[csf("dia_width")]=="") $dia_width_cond=" and dia_width is null";else $dia_width_cond=" and dia_width='".$result_itemdescription[csf("dia_width")]."'";
                        $nameArray_color_size_qnty=sql_select( "select sum(wo_qnty) as cons from wo_booking_dtls where    booking_no=$txt_booking_no and sensitivity=0 and process=". $result_item[csf('process')]." and  description='". $result_itemdescription[csf('description')]."'and rate='". $result_itemdescription[csf('rate')]."' and uom='". $result_itemdescription[csf('uom')]."' $dia_width_cond and status_active=1 ");
                        foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                        {
                            ?>
                            <td style="border:1px solid black; text-align:right">
                                <?
                                if($result_color_size_qnty[csf('cons')]!= "")
                                {
                                    echo number_format($result_color_size_qnty[csf('cons')],2);
                                    $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                                    $color_tatal+=$result_color_size_qnty[csf('cons')];
                                }
                                else echo "";
                                ?>
                            </td>
                            <?
                        }
                        ?>
                        <td style="border:1px solid black; text-align:center "><? echo $result_itemdescription[csf('dia_width')]; ?></td>
                        <td style="border:1px solid black; text-align:center "><? echo $unit_of_measurement[$result_itemdescription[csf('uom')]]; ?></td>
                        <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                        <td style="border:1px solid black; text-align:right">
                            <?
                            $amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                            $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                            ?>
                        </td>
                        </tr>
                        <?
                    }
                    ?>
                    <tr>
                        <td style="border:1px solid black;  text-align:right" colspan="2"><strong> Item Total</strong></td>
                        <td style="border:1px solid black;  text-align:right">
                            <?
                            if($color_tatal !='')
                            {
                                echo number_format($color_tatal,2);
                            }
                            ?>
                        </td>
                        <td style="border:1px solid black;"></td>
                        <td style="border:1px solid black;"></td>
                        <td style="border:1px solid black; text-align:right"></td>
                        <td style="border:1px solid black; text-align:right">
                            <?
                            echo number_format($total_amount_as_per_gmts_color,4);
                            $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                            ?>
                        </td>

                    </tr>
                    <?
                }
                ?>
                <tr>
                    <td align="right" style="border:1px solid black"  colspan="8"><strong>Total</strong></td>
                    <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                </tr>
            </table>
            <?
            //print_r($color_tatal);
        }
        ?>
        <!--==============================================NO NENSITIBITY END=========================================  -->
        &nbsp;
        <?
        $mcurrency="";
        $dcurrency="";
        if($currency_id==1)
        {
            $mcurrency='Taka';
            $dcurrency='Paisa';
        }
        if($currency_id==2)
        {
            $mcurrency='USD';
            $dcurrency='CENTS';
        }
        if($currency_id==3)
        {
            $mcurrency='EURO';
            $dcurrency='CENTS';
        }
        ?>
        <table  width="100%" class="rpt_table" style="border:1px solid black;"   border="0" cellpadding="0" cellspacing="0">
            <tr style="border:1px solid black;">
                <th width="70%" style="border:1px solid black; text-align:right">Total Booking Amount</th><td width="30%" style="border:1px solid black; text-align:right"><? echo number_format($booking_grand_total,2);?></td>
            </tr>
            <tr style="border:1px solid black;">
                <th width="70%" style="border:1px solid black; text-align:right">Total Booking Amount (in word)</th><td width="30%" style="border:1px solid black;"><? echo number_to_words(number_format($booking_grand_total,2),$mcurrency, $dcurrency);?></td>
            </tr>
        </table>
        &nbsp;
        <table  width="100%" class="rpt_table" style="border:1px solid black;"   border="0" cellpadding="0" cellspacing="0">
            <thead>
            <tr style="border:1px solid black;">
                <th width="3%" style="border:1px solid black;">Sl</th><th width="97%" style="border:1px solid black;">Spacial Instruction</th>
            </tr>
            </thead>
            <tbody>
            <?
            $data_array=sql_select("select id, terms from  wo_booking_terms_condition where booking_no=$txt_booking_no");// quotation_id='$data'
            if ( count($data_array)>0)
            {
                $i=0;
                foreach( $data_array as $row )
                {
                    $i++;
                    ?>
                    <tr id="settr_1" align="" style="border:1px solid black;">
                        <td style="border:1px solid black;">
                            <? echo $i;?>
                        </td>
                        <td style="border:1px solid black;">
                            <? echo $row[csf('terms')]; ?>
                        </td>
                    </tr>
                    <?
                }
            }
            else
            {
                $i=0;
                $data_array=sql_select("select id, terms from  lib_terms_condition where is_default=1 and page_id=176");// quotation_id='$data'
                foreach( $data_array as $row )
                {
                    $i++;
                    ?>
                    <tr id="settr_1" align="" style="border:1px solid black;">
                        <td style="border:1px solid black;">
                            <? echo $i;?>
                        </td>
                        <td style="border:1px solid black;">
                            <? echo $row[csf('terms')]; ?>
                        </td>

                    </tr>
                    <?
                }
            }
            ?>
            </tbody>
        </table>

        <br/>

        <?
        echo signature_table(53, $cbo_company_name, "1313px");
        echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>
    <script type="text/javascript" src="../../js/jquery.js"></script>
    <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
    <script>
        fnc_generate_Barcode('<? echo $varcode_booking_no; ?>','barcode_img_id');
    </script>
    <?
}

if($action=="show_fabric_booking_report")
{
    $getFb = sql_select("select id, booking_no, booking_date, company_id, buyer_id, po_break_down_id, job_no, item_category, fabric_source, is_approved, ready_to_approved, uom from wo_booking_mst where booking_no='$data'");

    //    echo "select id, booking_no, booking_date, company_id, buyer_id, po_break_down_id, job_no, item_category, fabric_source, is_approved, ready_to_approved, uom from wo_booking_mst where booking_no='$data'";
    if(count($getFb) > 0){
        if($db_type==2) {
            $group_concat_all = "listagg(cast(b.po_number as varchar2(4000)),',') within group (order by b.po_number) as po_number";
        }else{
            $group_concat_all="group_concat(b.po_number) as po_number";
        }
        $po_no="";
        $data_array3 = sql_select("select a.job_no, $group_concat_all from wo_po_details_master a, wo_po_break_down b where b.id in (".$getFb[0][csf("po_break_down_id")].") and a.job_no=b.job_no_mst group by a.job_no");
        if(count($data_array3) >  0) {
            $po_no = implode(",", array_unique(explode(",", $data_array3[0][csf("po_number")])));
            $po_no_id = implode(",", array_unique(explode(",", $data_array3[0][csf("po_id")])));
        }
        $data = $getFb[0][csf("company_id")]."*".$getFb[0][csf("booking_no")]."*".$getFb[0][csf("po_break_down_id")]."*".$getFb[0][csf("item_category")]."*".$getFb[0][csf("fabric_source")]."*".$getFb[0][csf("is_approved")]."*".$getFb[0][csf("job_no")]."*".$getFb[0][csf("uom")];
    }else{
        die();
    }
    //    echo $data;
    $data = explode('*', $data);
    //    print_r($data);
    $cbo_company_name=str_replace("'","",$data[0]);
    $txt_booking_no = "'".$data[1]."'";
    $txt_order_no_id = "'".$data[2]."'";
    $cbo_fabric_natu = "'".$data[3]."'";
    $cbo_fabric_source = "'".$data[4]."'";
    $id_approved_id = "'".$data[5]."'";
    $txt_job_no = "'".$data[6]."'";
    $cbouom = "'".$data[7]."'";
    $report_type= 1;
    $show_yarn_rate = 1;
    $report_title = "Fabric Booking";
    $imge_arr=return_library_array( "select master_tble_id,image_location from common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
    $country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
    $supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
    $season_arr=return_library_array( "select id,season_name from lib_buyer_season",'id','season_name');
    $marchentrArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info ","id","team_member_name");
    $buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
    $po_qnty_tot=return_field_value( "sum(plan_cut)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
    $po_qnty_tot1=return_field_value( "sum(po_quantity)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
    $pro_sub_dept_array=return_library_array( "select id,sub_department_name from lib_pro_sub_deparatment",'id','sub_department_name');
    $company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");

    $mainBookingNo="";

    $sqlMainBooking=sql_select("select booking_no from wo_booking_dtls where po_break_down_id in (".str_replace("'","",$txt_order_no_id).") and status_active=1 and is_deleted=0 and booking_type=1 and is_short=2 group by booking_no");
    foreach($sqlMainBooking as $row)
    {
        if($mainBookingNo=="") $mainBookingNo=$row[csf('booking_no')]; else $mainBookingNo.=','.$row[csf('booking_no')];
    }
    unset($sqlMainBooking)

    ?>

    <div style="width:1330px" align="center">
        <!--    Header Company Information         -->
        <?php
        $nameArray_approved = sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=12");
        list($nameArray_approved_row) = $nameArray_approved;
        $nameArray_approved_date = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=12 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
        list($nameArray_approved_date_row) = $nameArray_approved_date;
        $nameArray_approved_comments = sql_select("select b.comments as comments from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=12 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
        list($nameArray_approved_comments_row) = $nameArray_approved_comments;
        $path = str_replace("'", "", $path);
        if ($path == "") {
            $path = '../../';
        }
        ?>
        <table width="1330" cellpadding="0" cellspacing="0" style="border:1px solid black">
            <tr>
                <td width="100">
                    <?
                    if($report_type==1)
                    {
                        ?><img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' /><?
                    }
                    else if($report_type==2)
                    {
                        ?><img  src='../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' /><?
                    }
                    else
                    {
                        ?><img  src='<? echo $path.$imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' /><?
                    }
                    ?>
                </td>
                <td>
                    <table width="980" cellpadding="0" cellspacing="0">
                        <tr>
                            <td align="center" style="font-size:20px;"><?php echo $company_library[$cbo_company_name]; ?></td>
                            <td rowspan="2" width="400" valign="top">
    <!--                            <span style="font-size:16px">&nbsp;&nbsp;&nbsp;&nbsp;<b>Job No:&nbsp;--><?// echo trim($txt_job_no,"'"); ?><!--</b><br>-->
    <!--                            <font style="word-break:break-all">&nbsp;&nbsp;&nbsp;&nbsp;Main Booking No:&nbsp;--><?//=trim($mainBookingNo,"'"); ?><!--</font><br>-->
                                <?
                                if($nameArray_approved_row[csf('approved_no')]>1)
                                {
                                    ?>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  <strong> Revised No: &nbsp;<? echo $nameArray_approved_row[csf('approved_no')]-1; ?></strong><?
                                }
                                ?>
                            </span>
                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:14px">
                                <?
                                $nameArray=sql_select( "select plot_no, level_no, road_no, block_no, country_id, province, city, zip_code, email, website from lib_company where id=$cbo_company_name");
                                foreach ($nameArray as $result)
                                {
                                    ?>
                                    Plot No: <? echo $result[csf('plot_no')]; ?>
                                    Level No: <? echo $result[csf('level_no')]?>
                                    Road No: <? echo $result[csf('road_no')]; ?>
                                    Block No: <? echo $result[csf('block_no')];?>
                                    City No: <? echo $result[csf('city')];?>
                                    Zip Code: <? echo $result[csf('zip_code')]; ?>
                                    Province No: <?php echo $result[csf('province')]; ?>
                                    Country: <? echo $country_arr[$result[csf('country_id')]]; ?><br>
                                    Email Address: <? echo $result[csf('email')];?>
                                    Website No: <? echo $result[csf('website')];?>
                                    <?
                                }
                                ?>
                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:16px">
                                <strong><? if($report_type==1) echo str_replace("'","",$report_title);else echo 'Short Fabric Booking';?> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style="color:#F00"><? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}if(str_replace("'","",$id_approved_id) ==3){ echo "(Partial Approved)";}; ?> </font></strong>
                            </td>
                            <td width="400"style="font-size:20px"></td>
                        </tr>
                    </table>
                </td>
                <td width="250" id="barcode_img_id"></td>
            </tr>
        </table>

        <?
        $job_no=''; $total_set_qnty=0; $colar_excess_percent=0; $cuff_excess_percent=0;
        $nameArray=sql_select( "select a.booking_no, a.booking_date, a.supplier_id, a.pay_mode, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.po_break_down_id, a.colar_excess_percent, a.cuff_excess_percent, a.delivery_date, a.is_apply_last_update, a.fabric_source, a.remarks, b.job_no, b.buyer_name, b.style_ref_no, b.gmts_item_id, b.order_uom, b.total_set_qnty, b.style_description, b.season_buyer_wise as season, b.product_dept, b.product_code, b.pro_sub_dep, b.dealing_marchant, b.factory_marchant from wo_booking_mst a, wo_po_details_master b where  a.job_no=b.job_no and a.booking_no=$txt_booking_no");
        foreach ($nameArray as $result)
        {
            $total_set_qnty=$result[csf('total_set_qnty')];
            $colar_excess_percent=$result[csf('colar_excess_percent')];
            $cuff_excess_percent=$result[csf('cuff_excess_percent')];
            $po_no="";
            $shipment_date="";	$internal_ref="";	$file_no="";
            $sql_po= "select po_number,grouping,file_no,MIN(pub_shipment_date) pub_shipment_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by po_number,grouping,file_no";
            $data_array_po=sql_select($sql_po);
            foreach ($data_array_po as $row_po)
            {
                $po_no.=$row_po[csf('po_number')].", ";
                $shipment_date.=change_date_format($row_po[csf('pub_shipment_date')],'dd-mm-yyyy','-').", ";
                $internal_ref.=$row_po[csf('grouping')].", ";
                $file_no.=$row_po[csf('file_no')].", ";
            }

            $lead_time="";
            if($db_type==0)
            {
                $sql_lead_time= "select DATEDIFF(pub_shipment_date,po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
            }

            if($db_type==2)
            {
                $sql_lead_time= "select (pub_shipment_date-po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
            }
            $data_array_lead_time=sql_select($sql_lead_time);
            foreach ($data_array_lead_time as $row_lead_time)
            {
                $lead_time.=$row_lead_time[csf('date_diff')].",";
                //$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
            }

            $po_received_date="";
            $sql_po_received_date= "select MIN(po_received_date) as po_received_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
            $data_array_po_received_date=sql_select($sql_po_received_date);
            foreach ($data_array_po_received_date as $row_po_received_date)
            {
                $po_received_date=change_date_format($row_po_received_date[csf('po_received_date')],'dd-mm-yyyy','-');
                //$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
            }
            $sql_po= "select po_number,MIN(pub_shipment_date) pub_shipment_date, MIN(insert_date) as insert_date,shiping_status from wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by po_number,shiping_status";
            $data_array_po=sql_select($sql_po);
            foreach ($data_array_po as $rows)
            {
                $daysInHand.=(datediff('d',date('d-m-Y',time()),$rows[csf('pub_shipment_date')])-1).",";
                $booking_date=$result[csf('update_date')];
                if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
                {
                    $booking_date=$result[csf('insert_date')];
                }
                $WOPreparedAfter.=(datediff('d',$rows[csf('insert_date')],$booking_date)-1).",";

                if($rows[csf('shiping_status')]==1)
                {
                    $shiping_status.= "FP".",";
                }
                else if($rows[csf('shiping_status')]==2)
                {
                    $shiping_status.= "PS".",";
                }
                else if($rows[csf('shiping_status')]==3)
                {
                    $shiping_status.= "FS".",";
                }
            }

            $file=rtrim($file_no,", ");//rtrim($po_no,", ")
            $file_all=array_unique(explode(",",$file));

            $file='';
            foreach($file_all as $file_id)
            {
                if($file=="") $file_cond=$file_id; else $file_cond.=", ".$file_id;
            }

            $varcode_booking_no=$result[csf('booking_no')];

            ?>
            <table width="100%" style="border:1px solid black" >
                <tr>
                    <td colspan="6" valign="top" style="font-size:18px; color:#F00"><? if($result[csf('is_apply_last_update')]==2){echo "Booking Info not synchronized with order entry and pre-costing. order entry or pre-costing has updated after booking entry.  Contact to ".$marchentrArr[$result[csf('dealing_marchant')]]; } else{ echo "";} ?></td>
                </tr>
                <tr>
                    <td width="110"><span style="font-size:18px"><b>Buyer/Agent Name</b></span></td>
                    <td width="130">:&nbsp;<span style="font-size:18px"><b><? echo $buyer_name_arr[$result[csf('buyer_name')]]; ?></b></span></td>
                    <td width="110"><span style="font-size:12px"><b>Dept.</b></span></td>
                    <td width="130">:&nbsp;<? echo $product_dept[$result[csf('product_dept')]] ; if($result[csf('product_code')] !=""){ echo " (".$result[csf('product_code')].")";} if($result[csf('pro_sub_dep')] !=0){ echo " (".$pro_sub_dept_array[$result[csf('pro_sub_dep')]].")";}?></td>
                    <td width="110"><span style="font-size:12px"><b>Order Qty.</b></span></td>
                    <td width="130">:&nbsp;<? echo $po_qnty_tot1." ".$unit_of_measurement[$result[csf('order_uom')]] ; ?></td>
                </tr>
                <tr>
                    <td style="font-size:12px"><b>Garments Item</b></td>
                    <td>:&nbsp;
                        <?
                        $gmts_item_name="";
                        $gmts_item=explode(',',$result[csf('gmts_item_id')]);
                        for($g=0;$g<=count($gmts_item); $g++)
                        {
                            $gmts_item_name.= $garments_item[$gmts_item[$g]].",";
                        }
                        echo rtrim($gmts_item_name,',');
                        ?>
                    </td>
                    <td style="font-size:12px"><b>Booking Date</b></td>
                    <td>:&nbsp;<? echo change_date_format($result[csf('booking_date')],'dd-mm-yyyy','-');?>&nbsp;&nbsp;&nbsp;</td>
                    <td style="font-size:18px"><b>Style Ref.</b>   </td>
                    <td style="font-size:18px">:&nbsp;<b><? echo $style_sting=$result[csf('style_ref_no')];?> </b>   </td>
                </tr>
                <tr>
                    <td style="font-size:12px"><b>Style Des.</b></td>
                    <td>:&nbsp;<? echo $result[csf('style_description')]; $job_no= $result[csf('job_no')];?></td>
                    <td style="font-size:12px"><b>Lead Time </b>   </td>
                    <td>:&nbsp;<?=implode(",",array_filter(array_unique(explode(",",$lead_time)))); ?> </td>
                    <td style="font-size:12px"><b>Factory Merchandiser</b></td>
                    <td>:&nbsp;<? echo $marchentrArr[$result[csf('factory_marchant')]]; ?></td>
                </tr>

                <tr>
                    <td style="font-size:18px"><b>Supplier Name</b>   </td>
                    <td style="font-size:18px">:&nbsp; <b><?
                            if($result[csf('pay_mode')]==5 || $result[csf('pay_mode')]==3){
                                echo $company_library[$result[csf('supplier_id')]];
                            }
                            else{
                                echo $supplier_name_arr[$result[csf('supplier_id')]];
                            }
                            //echo $supplier_name_arr[$result[csf('supplier_id')]];?></b>    </td>
                    <td style="font-size:12px"><b>Delivery Date</b></td>
                    <td>:&nbsp;<? echo change_date_format( $result[csf('delivery_date')],'dd-mm-yyyy','-');?></td>
                    <td style="font-size:18px"><b>Booking No </b>   </td>
                    <td style="font-size:18px">:&nbsp;<b><? echo $result[csf('booking_no')];?></b><? echo "(".$fabric_source[$result[csf('fabric_source')]].")"?></td>
                </tr>
                <tr>
                    <td style="font-size:12px"><b>Season</b></td>
                    <td>:&nbsp;<? echo $season_arr[$result[csf('season')]]; ?></td>
                    <td style="font-size:12px"><b>Attention</b></td>
                    <td>:&nbsp;<? echo $result[csf('attention')]; ?></td>
                    <td style="font-size:12px"><b>Po Received Date</b></td>
                    <td>:&nbsp;<? echo $po_received_date; ?></td>
                </tr>
                <tr>
                    <td style="font-size:18px"><b>Order No</b></td>
                    <td style="font-size:18px" colspan="3">:&nbsp;<b><?=implode(",",array_filter(array_unique(explode(",",$po_no)))); ?></b></td>
                    <td style="font-size:17px"><b>Internal Ref</b></td>
                    <td style="font-size:16px">:&nbsp;<b><?=implode(",",array_filter(array_unique(explode(",",$internal_ref)))); ?></b></td>
                </tr>
                <tr>
                    <td style="font-size:12px"><b>Shipment Date</b></td>
                    <td colspan="3"> :&nbsp;<?=implode(",",array_filter(array_unique(explode(",",$shipment_date)))); ?></td>
                    <td style="font-size:17px"><b>File No</b></td>
                    <td style="font-size:16px">:&nbsp;<b><?=implode(",",array_filter(array_unique(explode(",",$file_cond)))); ?></b></td>
                </tr>
                <tr>
                    <td style="font-size:12px"><b>WO Prepared After</b></td>
                    <td> :&nbsp;<?=implode(",",array_filter(array_unique(explode(",",$WOPreparedAfter)))).' Days' ?></td>

                    <td style="font-size:12px"><b>Ship.days in Hand</b></td>
                    <td> :&nbsp;<?=implode(",",array_filter(array_unique(explode(",",$daysInHand)))).' Days'?></td>

                    <td style="font-size:12px"><b>Ex-factory status</b></td>
                    <td> :&nbsp;<?=implode(",",array_filter(array_unique(explode(",",$shiping_status)))); ?></td>
                </tr>
                <tr>
                    <td style="font-size:12px"><b>Remarks</b></td>
                    <td colspan="5"> :&nbsp;<? echo $result[csf('remarks')]; ?></td>
                </tr>
            </table>
            <?
        }
        ?>

        <br/>   									 <!--  Here will be the main portion  -->

        <?
        $costing_per="";
        $costing_per_qnty=0;
        $costing_per_id=return_field_value( "costing_per", "wo_pre_cost_mst","job_no ='$job_no'");
        if($costing_per_id==1)
        {
            $costing_per="1 Dzn";
            $costing_per_qnty=12;

        }
        if($costing_per_id==2)
        {
            $costing_per="1 Pcs";
            $costing_per_qnty=1;

        }
        if($costing_per_id==3)
        {
            $costing_per="2 Dzn";
            $costing_per_qnty=24;

        }
        if($costing_per_id==4)
        {
            $costing_per="3 Dzn";
            $costing_per_qnty=36;

        }
        if($costing_per_id==5)
        {
            $costing_per="4 Dzn";
            $costing_per_qnty=48;

        }
        $process_loss_method=return_field_value( "process_loss_method", "wo_pre_cost_fabric_cost_dtls","job_no='$job_no'");;
        //echo $process_loss_method."gggg";
        ?>
        <?
        if(str_replace("'","",$cbo_fabric_source)==1 || str_replace("'","",$cbo_fabric_source)==3 )
        {
            $nameArray_fabric_description= sql_select("SELECT  a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width,avg(b.process_loss_percent) as process_loss_percent,avg(rmg_qty) as rmg_qty FROM wo_pre_cost_fabric_cost_dtls a,wo_booking_dtls b where b.booking_no =$txt_booking_no and a.id=b.pre_cost_fabric_cost_dtls_id  and b.status_active=1 and
    b.is_deleted=0  and b.grey_fab_qnty>0 group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by a.body_part_id");
            ?>
            <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
                <tr align="center"><th colspan="4" align="left">Body Part</th>
                    <?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
                        if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
                        else         		               echo "<td  colspan='2'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
                    }
                    ?>
                    <td  rowspan="9" width="50"><p>Total  Finish Fabric <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
                    <td  rowspan="9" width="50"><p>Total Grey Fabric <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
                    <td  rowspan="9" width="50"><p>Process Loss % </p></td>
                </tr>
                <tr align="center"><th colspan="4" align="left">Color Type</th>
                    <?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
                        if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
                        else         		               echo "<td  colspan='2'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
                    }
                    ?>
                </tr>
                <tr align="center"><th colspan="4" align="left">Construction</th>
                    <?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
                        if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='2'>&nbsp</td>";
                        else         		               echo "<td  colspan='2'>". $result_fabric_description[csf('construction')]."</td>";
                    }
                    ?>


                </tr>
                <tr align="center"><th   colspan="4" align="left">Composition</th>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
                        if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='2' >&nbsp</td>";
                        else         		               echo "<td colspan='2' >".$result_fabric_description[csf('composition')]."</td>";
                    }
                    ?>

                </tr>
                <tr align="center"><th  colspan="4" align="left">GSM</th>
                    <?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
                        if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='2'>&nbsp</td>";
                        else         		       echo "<td colspan='2' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
                    }
                    ?>

                </tr>
                <tr align="center"><th   colspan="4" align="left">Dia/Width</th>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
                        if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='2'>&nbsp</td>";
                        else         		              echo "<td colspan='2' align='center'>". $result_fabric_description[csf('dia_width')]."</td>";
                    }
                    ?>

                </tr>
                <tr align="center"><th   colspan="4" align="left">RMG Qty</th>
                    <?
                    $tot_rmg_qty=0;
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
                        $tot_rmg_qty+=$result_fabric_description[csf('rmg_qty')];
                        if( $result_fabric_description[csf('rmg_qty')] == "")   echo "<td colspan='2'>&nbsp</td>";
                        else         		              echo "<td colspan='2' align='center'>". $result_fabric_description[csf('rmg_qty')]."</td>";
                    }
                    ?>

                </tr>
                <tr>
                    <th  colspan="<? echo  count($nameArray_fabric_description)*2+3; ?>" align="left" style="height:30px">&nbsp;</th>
                </tr>
                <tr>
                    <th width="100" align="left">Fabric Color</th>
                    <th width="100" align="left"> Body Color</th>
                    <th width="100" align="left">Article No</th>
                    <th width="80" align="left">Lab Dip No</th>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
                        echo "<th width='50'>Finish</th><th width='50' >Gray</th>";
                    }
                    ?>

                </tr>
                <?
                /*$gmt_color_library=return_library_array( "select gmts_color_id,fabric_color_id
                FROM
                wo_booking_dtls
                WHERE
                job_no ='$job_no'
                group by gmts_color_id", "fabric_color_id", "gmts_color_id");*/
                $articalNoArr=array();
                $articalNo=sql_select("select color_number_id, article_number from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and status_active=1 and is_deleted=0 group by color_number_id, article_number");
                foreach($articalNo as $row)
                {
                    $articalNoArr[$row[csf("color_number_id")]].=$row[csf("article_number")]."," ;
                }
                unset($articalNo);

                // return_field_value( "sum(plan_cut)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");

                $color_library=return_library_array( "select id,color_name from lib_color where status_active =1 and is_deleted=0", "id", "color_name");
                $gmt_color_library=array();
                $gmt_color_data=sql_select("select gmts_color_id, fabric_color_id FROM wo_booking_dtls WHERE booking_no =$txt_booking_no and status_active=1 and is_deleted=0");
                foreach( $gmt_color_data as $gmt_color_row)
                {
                    $gmt_color_library[$gmt_color_row[csf("fabric_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
                }
                $grand_total_fin_fab_qnty=0; $grand_total_grey_fab_qnty=0; $grand_totalcons_per_finish=0; $grand_totalcons_per_grey=0;
                $color_wise_wo_sql=sql_select("select fabric_color_id, gmts_color_id FROM wo_booking_dtls WHERE booking_no =$txt_booking_no and status_active=1 and is_deleted=0 group by fabric_color_id,gmts_color_id");
                foreach($color_wise_wo_sql as $color_wise_wo_result)
                {
                    ?>
                    <tr>
                        <td  width="100" align="left"><? echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]]; ?></td>
                        <td width="100" align="left"><? echo  $color_library[$color_wise_wo_result[csf('gmts_color_id')]]; ?> </td>
                        <td width="100" align="left"><? echo implode(",",array_filter(array_unique(explode(",",$articalNoArr[$color_wise_wo_result[csf('gmts_color_id')]])))); ?></td>
                        <td width="80" align="left">
                            <?
                            $lapdip_no="";
                            $lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
                            if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
                            ?>
                        </td>
                        <?
                        $total_fin_fab_qnty=0;
                        $total_grey_fab_qnty=0;

                        foreach($nameArray_fabric_description as $result_fabric_description)
                        {



                            if($db_type==2)
                            {
                                $color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  wo_pre_cost_fabric_cost_dtls a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.id=b.pre_cost_fabric_cost_dtls_id and
												   nvl(a.body_part_id,0)=nvl('".$result_fabric_description[csf('body_part_id')]."',0) and
												   nvl(a.color_type_id,0)=nvl('".$result_fabric_description[csf('color_type_id')]."',0) and
												   nvl(a.construction,0)=nvl('".$result_fabric_description[csf('construction')]."',0) and
												   nvl(a.composition,0)=nvl('".$result_fabric_description[csf('composition')]."',0) and
												   nvl(a.gsm_weight,0)=nvl('".$result_fabric_description[csf('gsm_weight')]."',0) and
												   nvl(b.dia_width,0)=nvl('".$result_fabric_description[csf('dia_width')]."',0) and
												   nvl(b.fabric_color_id,0)=nvl(".$color_wise_wo_result[csf('fabric_color_id')].",0) and
												   nvl(b.gmts_color_id,0)=nvl(".$color_wise_wo_result[csf('gmts_color_id')].",0) and

												  b.status_active=1 and
												  b.is_deleted=0 and b.grey_fab_qnty>0");
                            }

                            if($db_type==0)
                            {
                                $color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  wo_pre_cost_fabric_cost_dtls a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.id=b.pre_cost_fabric_cost_dtls_id and
												   a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												   a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												   a.construction='".$result_fabric_description[csf('construction')]."' and
												   a.composition='".$result_fabric_description[csf('composition')]."' and
												   a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												   b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												   b.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
												   b.gmts_color_id=".$color_wise_wo_result[csf('gmts_color_id')]." and
												  b.status_active=1 and
												  b.is_deleted=0 and b.grey_fab_qnty>0");
                            }


                            list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

                            ?>
                            <td width='50' align='right'>
                                <?
                                if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
                                {
                                    echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;
                                    $total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('fin_fab_qnty')];
                                }
                                ?>
                            </td>
                            <td width='50' align='right' >
                                <?
                                if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
                                {
                                    echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2);
                                    $total_grey_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
                                }
                                ?>
                            </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
                        <td align="right"><? echo number_format($total_grey_fab_qnty,2); $grand_total_grey_fab_qnty+=$total_grey_fab_qnty;?></td>

                        <td align="right">
                            <?
                            if($process_loss_method==1)
                            {
                                $process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_fin_fab_qnty)*100;
                            }

                            if($process_loss_method==2)
                            {
                                $process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_grey_fab_qnty)*100;
                            }
                            echo number_format($process_percent,2);

                            ?>
                        </td>
                    </tr>
                    <?
                }
                ?>
                <tr>
                    <td  width="100" align="left">&nbsp;</td>
                    <td  width="100" align="left">&nbsp;</td>

                    <td  width="100" align="left">&nbsp;</td>
                    <td  width="80" align="left"><strong>Total</strong></td>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
                        if($db_type==2)
                        {
                            $color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  wo_pre_cost_fabric_cost_dtls a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.id=b.pre_cost_fabric_cost_dtls_id and
												  nvl(a.body_part_id,0)=nvl('".$result_fabric_description[csf('body_part_id')]."',0) and
												  nvl(a.color_type_id,0)=nvl('".$result_fabric_description[csf('color_type_id')]."',0) and
												  nvl(a.construction,0)=nvl('".$result_fabric_description[csf('construction')]."',0) and
												  nvl(a.composition,0)=nvl('".$result_fabric_description[csf('composition')]."',0) and
												  nvl(a.gsm_weight,0)=nvl('".$result_fabric_description[csf('gsm_weight')]."',0) and
												  nvl(b.dia_width,0)=nvl('".$result_fabric_description[csf('dia_width')]."',0) and
												  b.status_active=1 and
												  b.is_deleted=0 and b.grey_fab_qnty>0
												  ");
                        }

                        if($db_type==0)
                        {
                            $color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  wo_pre_cost_fabric_cost_dtls a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.id=b.pre_cost_fabric_cost_dtls_id and
												  a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												  a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												  a.construction='".$result_fabric_description[csf('construction')]."' and
												  a.composition='".$result_fabric_description[csf('composition')]."' and
												  a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												  b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												  b.status_active=1 and
												  b.is_deleted=0 and b.grey_fab_qnty>0
												  ");
                        }
                        list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
                        ?>
                        <td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;?></td><td width='50' align='right' > <? echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2);?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($grand_total_fin_fab_qnty,2);?></td>
                    <td align="right"><? echo number_format($grand_total_grey_fab_qnty,2);?></td>
                    <td align="right">
                        <?
                        if($process_loss_method==1)
                        {
                            $totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_grey_fab_qnty)*100;
                        }

                        if($process_loss_method==2)
                        {
                            $totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_grey_fab_qnty)*100;
                        }
                        echo number_format($totalprocess_percent,2);
                        ?>
                    </td>
                </tr>
            </table>

            <br/>
            <?
        }
        ?>





        <?

        if(str_replace("'","",$cbo_fabric_source)==2)
        {

            $nameArray_fabric_description= sql_select("SELECT  a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width,avg(b.process_loss_percent) as process_loss_percent,avg(rmg_qty) as rmg_qty FROM wo_pre_cost_fabric_cost_dtls a,wo_booking_dtls b where b.booking_no =$txt_booking_no and a.id=b.pre_cost_fabric_cost_dtls_id  and b.status_active=1 and
    b.is_deleted=0 and b.grey_fab_qnty>0 group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by a.body_part_id");
            ?>
            <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
                <tr align="center"><th colspan="3" align="left">Body Part</th>
                    <?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
                        if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
                        else         		               echo "<td  colspan='3'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
                    }
                    ?>
                    <!-- <td  rowspan="9" width="50"><p>Total Fabric <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td> -->
                    <td  rowspan="9" width="50"><p>Total Fabric (<?=$unit_of_measurement[trim($cbouom ,"'")]; ?>)</p></td>
                    <td  rowspan="9" width="50"><p>Rate</p></td>
                    <td  rowspan="9" width="50"><p>Amount </p></td>
                </tr>
                <tr align="center"><th colspan="3" align="left">Color Type</th>
                    <?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
                        if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
                        else         		               echo "<td  colspan='3'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
                    }
                    ?>
                </tr>
                <tr align="center"><th colspan="3" align="left">Construction</th>
                    <?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
                        if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='3'>&nbsp</td>";
                        else         		               echo "<td  colspan='3'>". $result_fabric_description[csf('construction')]."</td>";
                    }
                    ?>


                </tr>
                <tr align="center"><th   colspan="3" align="left">Composition</th>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
                        if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='3' >&nbsp</td>";
                        else         		               echo "<td colspan='3' >".$result_fabric_description[csf('composition')]."</td>";
                    }
                    ?>

                </tr>
                <tr align="center"><th  colspan="3" align="left">GSM</th>
                    <?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
                        if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='3'>&nbsp</td>";
                        else         		       echo "<td colspan='3' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
                    }
                    ?>

                </tr>
                <tr align="center"><th   colspan="3" align="left">Dia/Width</th>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
                        if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='3'>&nbsp</td>";
                        else         		              echo "<td colspan='3' align='center'>". $result_fabric_description[csf('dia_width')]."</td>";
                    }
                    ?>

                </tr>
                <tr align="center"><th   colspan="3" align="left">RMG Qty</th>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
                        if( $result_fabric_description[csf('rmg_qty')] == "")   echo "<td colspan='3'>&nbsp</td>";
                        else         		              echo "<td colspan='3' align='center'>". $result_fabric_description[csf('rmg_qty')]."</td>";
                    }
                    ?>

                </tr>
                <tr>
                    <th  colspan="<? echo  count($nameArray_fabric_description)*3+3; ?>" align="left" style="height:30px">&nbsp;</th>
                </tr>
                <tr>
                    <th  width="120" align="left">Fabric Color</th>
                    <th  width="120" align="left"> Body Color</th>
                    <th  width="120" align="left">Lab Dip No</th>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
                        echo "<th width='50'>Fab Qty</th><th width='50' >Rate</th><th width='50' >Amount</th>";
                    }
                    ?>

                </tr>
                <?
                /*$gmt_color_library=return_library_array( "select gmts_color_id,fabric_color_id
                FROM
                wo_booking_dtls
                WHERE
                job_no ='$job_no'
                group by gmts_color_id", "fabric_color_id", "gmts_color_id");*/
                $color_library=return_library_array( "select id,color_name from lib_color where status_active =1 and is_deleted=0", "id", "color_name");
                $gmt_color_library=array();
                $gmt_color_data=sql_select("select gmts_color_id,fabric_color_id
		  FROM
		  wo_booking_dtls
		  WHERE
		  booking_no =$txt_booking_no");
                foreach( $gmt_color_data as $gmt_color_row)
                {
                    $gmt_color_library[$gmt_color_row[csf("fabric_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
                }

                $grand_total_fin_fab_qnty=0;
                $grand_total_grey_fab_qnty=0;
                $grand_totalcons_per_finish=0;
                $grand_totalcons_per_grey=0;
                $color_wise_wo_sql=sql_select("select fabric_color_id
										  FROM
										  wo_booking_dtls
										  WHERE
										  booking_no =$txt_booking_no and
										  status_active=1 and
                                          is_deleted=0
										  group by fabric_color_id");
                foreach($color_wise_wo_sql as $color_wise_wo_result)
                {
                    ?>
                    <tr>
                        <td  width="120" align="left">
                            <?

                            echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];

                            ?></td>
                        <td  width="120" align="left">
                            <?
                            //echo $gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]];
                            echo rtrim($gmt_color_library[$color_wise_wo_result['fabric_color_id']],",");
                            ?>
                        </td>
                        <td  width="120" align="left">
                            <?
                            $lapdip_no="";
                            $lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
                            if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
                            ?>
                        </td>
                        <?
                        $total_fin_fab_qnty=0;
                        $total_grey_fab_qnty=0;
                        $total_amount=0;
                        foreach($nameArray_fabric_description as $result_fabric_description)
                        {



                            if($db_type==2)
                            {
                                $color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty, avg(b.rate) as rate
												  FROM
												  wo_pre_cost_fabric_cost_dtls a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.id=b.pre_cost_fabric_cost_dtls_id and
												   nvl(a.body_part_id,0)=nvl('".$result_fabric_description[csf('body_part_id')]."',0) and
												   nvl(a.color_type_id,0)=nvl('".$result_fabric_description[csf('color_type_id')]."',0) and
												   nvl(a.construction,0)=nvl('".$result_fabric_description[csf('construction')]."',0) and
												   nvl(a.composition,0)=nvl('".$result_fabric_description[csf('composition')]."',0) and
												   nvl(a.gsm_weight,0)=nvl('".$result_fabric_description[csf('gsm_weight')]."',0) and
												   nvl(b.dia_width,0)=nvl('".$result_fabric_description[csf('dia_width')]."',0) and
												   nvl(b.fabric_color_id,0)=nvl(".$color_wise_wo_result[csf('fabric_color_id')].",0) and
												  b.status_active=1 and
												  b.is_deleted=0 and b.fin_fab_qnty>0");
                            }

                            if($db_type==0)
                            {
                                $color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty, avg(b.rate) as rate
												  FROM
												  wo_pre_cost_fabric_cost_dtls a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.id=b.pre_cost_fabric_cost_dtls_id and
												  a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												  a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												  a.construction='".$result_fabric_description[csf('construction')]."' and
												  a.composition='".$result_fabric_description[csf('composition')]."' and
												  a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												  b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												  b.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
												  b.status_active=1 and
												  b.is_deleted=0 and b.fin_fab_qnty>0");
                            }


                            list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

                            ?>
                            <td width='50' align='right'>
                                <?
                                if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
                                {
                                    echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2) ;
                                    $total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
                                }
                                ?>
                            </td>
                            <td width='50' align='right' >
                                <?
                                if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
                                {
                                    echo number_format($color_wise_wo_result_qnty[csf('rate')],2);
                                    //$total_grey_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
                                }
                                ?>
                            </td>
                            <td width='50' align='right' >
                                <?
                                $amount=$color_wise_wo_result_qnty[csf('grey_fab_qnty')]*$color_wise_wo_result_qnty[csf('rate')];
                                if($amount!="")
                                {
                                    echo number_format($amount,2);
                                    $total_amount+=$amount;
                                }

                                /*if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
                                {
                                echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')]*$color_wise_wo_result_qnty[csf('rate')],2);
                                }*/
                                ?>
                            </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
                        <td align="right"><? echo number_format($total_amount/$total_fin_fab_qnty,2); $grand_total_amount+=$total_amount;?></td>
                        <td align="right"><? echo number_format($total_amount,2);?></td>
                    </tr>
                    <?
                }
                ?>
                <tr>
                    <td  width="120" align="left">&nbsp;</td>
                    <td  width="120" align="left">&nbsp;</td>
                    <td  width="120" align="left"><strong>Total</strong></td>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
                        if($db_type==2)
                        {
                            $color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty, avg(b.rate) as rate
												  FROM
												  wo_pre_cost_fabric_cost_dtls a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.id=b.pre_cost_fabric_cost_dtls_id and
												  nvl(a.body_part_id,0)=nvl('".$result_fabric_description[csf('body_part_id')]."',0) and
												  nvl(a.color_type_id,0)=nvl('".$result_fabric_description[csf('color_type_id')]."',0) and
												  nvl(a.construction,0)=nvl('".$result_fabric_description[csf('construction')]."',0) and
												  nvl(a.composition,0)=nvl('".$result_fabric_description[csf('composition')]."',0) and
												  nvl(a.gsm_weight,0)=nvl('".$result_fabric_description[csf('gsm_weight')]."',0) and
												  nvl(b.dia_width,0)=nvl('".$result_fabric_description[csf('dia_width')]."',0) and
												  b.status_active=1 and
												  b.is_deleted=0 and b.fin_fab_qnty>0
												  ");
                        }

                        if($db_type==0)
                        {
                            $color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty, avg(b.rate) as rate
												  FROM
												  wo_pre_cost_fabric_cost_dtls a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.id=b.pre_cost_fabric_cost_dtls_id and
												  a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												  a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												  a.construction='".$result_fabric_description[csf('construction')]."' and
												  a.composition='".$result_fabric_description[csf('composition')]."' and
												  a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												  b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												  b.status_active=1 and
												  b.is_deleted=0 and b.fin_fab_qnty>0
												  ");
                        }
                        list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
                        ?>
                        <td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;?></td>
                        <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2);?></td>
                        <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2);?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($grand_total_fin_fab_qnty,2);?></td>
                    <td align="right"><? echo number_format($grand_total_amount/$grand_total_fin_fab_qnty,2);?></td>
                    <td align="right">
                        <?
                        echo number_format($grand_total_amount,2);
                        ?>
                    </td>
                </tr>
            </table>

            <br/>
            <?
        }
        ?>



        <?
        if(str_replace("'","",$cbo_fabric_source)==1 || str_replace("'","",$cbo_fabric_source)==3 )
        {
            $yarn_count_arr=return_library_array( "select id,yarn_count from lib_yarn_count",'id','yarn_count');
            $yarn_sql_array=sql_select("SELECT min(id) as id,count_id, copm_one_id, percent_one,copm_two_id, percent_two, type_id, sum(cons_qnty) as yarn_required, AVG(rate) as rate from wo_pre_cost_fab_yarn_cost_dtls where job_no='$job_no' and  status_active=1 and is_deleted=0 group by count_id,copm_one_id,percent_one, copm_two_id,percent_two,type_id order by id");
            ?>
            <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
                <tr>
                    <td width="49%" valign="top">
                        <!--<table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td colspan="7"><b>Yarn Required Summary (Pre Cost)</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Yarn Description</td>
                    <td>Brand</td>
                    <td>Lot</td>
                    <?
                        //if($show_yarn_rate==1)
                        //{
                        ?>
                    <td>Rate</td>
                    <?
                        //}
                        ?>
                    <td>Cons for <? //echo $costing_per; ?> Gmts</td>
                    <td>Total (KG)</td>
                    </tr>
                    <?
                        //$i=0;
                        //$total_yarn=0;
                        //foreach($yarn_sql_array  as $row)
                        //{

                        //$i++;
                        ?>
                    <tr align="center">
                    <td><? //echo $i; ?></td>
                    <td>
					<?
                        //$yarn_des=$yarn_count_arr[$row[csf('count_id')]]." ".$composition[$row[csf('copm_one_id')]]." ".$row[csf('percent_one')]."%  ";
                        //if($row['copm_two_id'] !=0)
                        //{
                        //$yarn_des.=$composition[$row[csf('copm_two_id')]]." ".$row[csf('percent_two')]."%";
                        //}
                        //$yarn_des.=$yarn_type[$row[csf('type_id')]];
                        //echo $yarn_count_arr[$row['count_id']]." ".$composition[$row['copm_one_id']]." ".$row['percent_one']."%  ".$composition[$row['copm_two_id']]." ".$row['percent_two']."%  ".$yarn_type[$row['type_id']];
                        //echo $yarn_des;
                        ?>
                    </td>
                    <td></td>
                    <td></td>
                    <?
                        //if($show_yarn_rate==1)
                        //{
                        ?>
                     <td><? //echo number_format($row[csf('rate')],4); ?></td>
                     <?
                        //}
                        ?>
                    <td><? //echo number_format($row[csf('yarn_required')],4); ?></td>

                    <td align="right"><? //echo number_format($row['yarn_required'],2); $total_yarn+=$row['yarn_required']; ?></td>
                    </tr>
                    <?
                        //}
                        ?>
                    <tr align="center">
                    <td>Total</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <?
                        //if($show_yarn_rate==1)
                        //{
                        ?>
                    <td></td>
                    <?
                        //}
                        ?>
                    <td></td>
                    <td align="right"><? //echo number_format($total_yarn,2); ?></td>
                    </tr>
                    </table>-->
                    </td>
                    <td width="2%">
                    </td>
                    <td width="49%" valign="top" align="center">
                        <?
                        $yarn_sql_array=sql_select("SELECT min(a.id) as id, a.item_id, sum(a.qnty) as qnty ,min(b.supplier_id) as supplier_id,min(b.lot) as lot from inv_material_allocation_dtls a,product_details_master b where a.item_id=b.id and a.booking_no=$txt_booking_no and  a.status_active=1 and a.is_deleted=0 group by a.item_id order by a.id");
                        if(count($yarn_sql_array)>0)
                        {
                            ?>
                            <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                                <tr align="center">
                                    <td colspan="7"><b>Allocated Yarn</b></td>

                                </tr>
                                <tr align="center">
                                    <td>Sl</td>
                                    <td>Yarn Description</td>
                                    <td>Brand</td>
                                    <td>Lot</td>


                                    <td>Allocated Qty (Kg)</td>
                                </tr>
                                <?
                                $total_allo=0;
                                $item=return_library_array( "select id, product_name_details from   product_details_master",'id','product_name_details');
                                $supplier=return_library_array( "select id, short_name from   lib_supplier",'id','short_name');
                                //$yarn_sql_array=sql_select("SELECT a.item_id, a.qnty,b.supplier_id,b.lot from inv_material_allocation_dtls a,product_details_master b where a.item_id=b.id and a.booking_no=$txt_booking_no and  a.status_active=1 and a.is_deleted=0");
                                $i=0;
                                $total_yarn=0;
                                foreach($yarn_sql_array  as $row)
                                {

                                    $i++;
                                    ?>
                                    <tr align="center">
                                        <td><? echo $i; ?></td>
                                        <td>
                                            <?

                                            echo $item[$row[csf('item_id')]];
                                            ?>
                                        </td>
                                        <td>
                                            <?

                                            echo $supplier[$row[csf('supplier_id')]];
                                            ?>
                                        </td>
                                        <td>
                                            <?

                                            echo $row[csf('lot')];
                                            ?>
                                        </td>
                                        <td align="right"><? echo number_format($row[csf('qnty')],4); $total_allo+= $row[csf('qnty')];?></td>
                                    </tr>
                                    <?
                                }
                                ?>
                                <tr align="center">
                                    <td>Total</td>
                                    <td></td>


                                    <td></td>
                                    <td></td>
                                    <td align="right"><? echo number_format($total_allo,4); ?></td>
                                </tr>
                            </table>
                            <?
                        }
                        else
                        {
                            $is_yarn_allocated=return_field_value("allocation", "variable_settings_inventory", "company_name=$cbo_company_name and variable_list=18 and item_category_id=1");
                            if($is_yarn_allocated==1)
                            {
                                ?>
                                <font style=" font-size:30px"><b> Draft</b></font>
                                <?
                            }
                            else
                            {
                                echo "";
                            }
                        }
                        ?>
                    </td>
                </tr>
            </table>
            <br/>
            <?
        }
        ?>


        <?
        $sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
        ?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
            <tr>
                <td width="49%" valign="top">
                    <?
                    if(count($sql_embelishment)>0)
                    {
                        ?>
                        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                            <tr align="center">
                                <td colspan="7"><b>Embelishment (Pre Cost)</b></td>

                            </tr>
                            <tr align="center">
                                <td>Sl</td>
                                <td>Embelishment Name</td>
                                <td>Embelishment Type</td>
                                <td>Cons <? echo $costing_per; ?> Gmts</td>
                                <td>Rate</td>
                                <td>Amount</td>

                            </tr>
                            <?
                            $sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
                            $i=0;
                            //$total_yarn=0;
                            foreach($sql_embelishment  as $row_embelishment)
                            {

                                $i++;
                                ?>
                                <tr align="center">
                                    <td><? echo $i; ?></td>
                                    <td>
                                        <?
                                        echo $emblishment_name_array[$row_embelishment[csf('emb_name')]];
                                        ?>
                                    </td>
                                    <td>
                                        <?
                                        if($row_embelishment[csf('emb_name')]==1)
                                        {
                                            echo $emblishment_print_type[$row_embelishment[csf('emb_type')]];
                                        }
                                        if($row_embelishment[csf('emb_name')]==2)
                                        {
                                            echo $emblishment_embroy_type[$row_embelishment[csf('emb_type')]];
                                        }
                                        if($row_embelishment[csf('emb_name')]==3)
                                        {
                                            echo $emblishment_wash_type[$row_embelishment[csf('emb_type')]];
                                        }
                                        if($row_embelishment[csf('emb_name')]==4)
                                        {
                                            echo $emblishment_spwork_type[$row_embelishment[csf('emb_type')]];
                                        }
                                        if($row_embelishment[csf('emb_name')]==5)
                                        {
                                            echo $row_embelishment[csf('emb_type')];
                                        }
                                        ?>

                                    </td>
                                    <td>
                                        <?
                                        echo $row_embelishment[csf('cons_dzn_gmts')];
                                        ?>
                                    </td>
                                    <td>
                                        <?
                                        echo $row_embelishment[csf('rate')];
                                        ?>
                                    </td>

                                    <td>
                                        <?
                                        echo $row_embelishment[csf('amount')];
                                        ?>
                                    </td>


                                </tr>
                                <?
                            }
                            ?>
                            <!--   <tr align="center">
                               <td>Total</td>
                               <td></td>
                               <td></td>
                               <td></td>

                               <td></td>

                               <td></td>

                               </tr>-->
                        </table>
                        <?
                    }
                    ?>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top" align="center">
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                        <tr align="center">
                            <td><b>Approved Instructions</b></td>

                        </tr>
                        <tr>
                            <td>
                                <?  echo $nameArray_approved_comments_row[csf('comments')];  ?>
                            </td>
                        </tr>
                    </table>

                </td>
            </tr>
        </table>
        <br/>
        <!--New Start here-->
        <div style="width:1330px; float:left">

            <?
            // Body Part type used only Cuff and Flat Knit
            $colar_percent_size_wise_array=return_library_array( "select a.colar_cuff_per,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and a.booking_no=$txt_booking_no and a.booking_type=1 and c.body_part_type in(40,50) and a.status_active=1 and a.is_deleted=0", "gmts_sizes", "colar_cuff_per");

            //	echo  "select a.body_part_type,a.body_part_id,sum(d.rmg_qty) as rmg_qty,d.gmts_size,d.gmts_color_id FROM wo_pre_cost_fabric_cost_dtls a, wo_booking_dtls d WHERE a.job_no=d.job_no and d.booking_no =$txt_booking_no and  a.id=d.pre_cost_fabric_cost_dtls_id  and d.status_active=1 and d.is_deleted=0 and d.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.body_part_type in(40,50) group by a.body_part_type,a.body_part_id,d.gmts_size,d.gmts_color_id order by a.body_part_id";

            $nameArray_body_part=sql_select( "select a.body_part_type,a.body_part_id,sum(d.rmg_qty) as rmg_qty,d.gmts_size,d.gmts_color_id FROM wo_pre_cost_fabric_cost_dtls a, wo_booking_dtls d WHERE a.job_no=d.job_no and d.booking_no =$txt_booking_no and  a.id=d.pre_cost_fabric_cost_dtls_id  and d.status_active=1 and d.is_deleted=0 and d.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.body_part_type in(40,50) group by a.body_part_type,a.body_part_id,d.gmts_size,d.gmts_color_id order by a.body_part_id");



            $row_count=count($nameArray_body_part);
            //if($row_count==0) echo " <p style='color:#f00; text-align:center; font-size:15px;'> Body part type is  used only Flat Knit and Cuff.</p> ";
            foreach($nameArray_body_part as $row)
            {
                $body_part_arr[$row[csf('body_part_id')]]['bpart_type']=$row[csf('body_part_type')];
                $body_part_rmg_qty_arr[$row[csf('body_part_id')]][$row[csf('gmts_size')]][$row[csf('gmts_color_id')]]['rmg_qty']+=$row[csf('rmg_qty')];
            }
            //print_r($body_part_arr);
            $tbl_row_count=count($body_part_arr);
            //echo $tbl_row_count.'Dx';
            ?>


            <?
            $k=1;
            foreach($body_part_arr as $body_id=>$val)
            {
                $k++;

                $bpart_type_id=$val['bpart_type'];
                $nameArray_item_size=sql_select( "select min(c.id) as id,b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=$body_id  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id  and d.status_active=1 and d.is_deleted=0 and a.body_part_type in(40,50) group by b.item_size,c.size_number_id order by id");
                ?>

                <div style="max-height:1330px; width:660px; overflow:auto; float:left; padding-top:20px; margin-left:5px; margin-bottom:5px; position: relative;">
                    <table  width="100%" align="left"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                        <tr>
                            <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b><? echo $body_part[$body_id];?> -  Colour Size Breakedown in Pcs</b></td>
                        </tr>
                        <tr>
                            <td width="70">Size</td>

                            <?

                            /*$nameArray_item_size=sql_select( "select b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by c.size_number_id,b.item_size order by c.size_number_id");*/
                            foreach($nameArray_item_size  as $result_size)
                            {
                                ?>
                                <td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
                                <?
                            }
                            ?>
                            <td rowspan="2" align="center"><strong>Total</strong></td>

                        </tr>
                        <tr>
                            <td>Collar Size</td>

                            <?
                            foreach($nameArray_item_size  as $result_item_size)
                            {
                                ?>
                                <td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
                                <?
                            }
                            ?>
                            <?
                            $color_library=return_library_array( "select id,color_name from lib_color where status_active =1 and is_deleted=0", "id", "color_name");
                            $color_wise_wo_sql=sql_select("select a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id,sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=$body_id  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 and a.body_part_type in(40,50) group by c.color_number_id,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method order by a.id
    ");
                            foreach($color_wise_wo_sql as $color_wise_wo_result)
                            {
                            $color_total_collar=0;
                            $color_total_collar_order_qnty=0;
                            $process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
                            $constrast_color_arr=array();
                            if($color_wise_wo_result[csf("color_size_sensitive")]==3)
                            {
                                $constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
                                for($i=0;$i<count($constrast_color);$i++)
                                {
                                    $constrast_color2=explode('_',$constrast_color[$i]);
                                    $constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
                                }
                            }
                            ?>
                        <tr>
                            <td>
                                <?
                                if($color_wise_wo_result[csf("color_size_sensitive")]==3)
                                {
                                    echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]) ;
                                    $lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
                                }
                                else
                                {
                                    echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
                                    $lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
                                }
                                ?>

                            </td>
                            <?
                            foreach($nameArray_item_size  as $result_size)
                            {
                                ?>
                                <td align="center" style="border:1px solid black">

                                    <?
                                    $rmg_qty=$body_part_rmg_qty_arr[$body_id][$result_size[csf('size_number_id')]][$color_wise_wo_result[csf('color_number_id')]]['rmg_qty'];
                                    //echo $bpart_type_id.'=';
                                    if($bpart_type_id==50)//Cuff
                                    {
                                        $fab_rmg_qty=$rmg_qty*2;
                                    }
                                    else //Flat Knit
                                    {
                                        $fab_rmg_qty=$rmg_qty;
                                    }
                                    //$color_wise_wo_sql_qnty=sql_select("select c.color_number_id,sum(c.order_quantity) as order_quantity, sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 and c.color_number_id='".$color_wise_wo_result['color_number_id']."' and c.size_number_id='".$result_size['size_number_id']."'");
                                    /*$color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0");

                                    list($plan_cut_qnty)=$color_wise_wo_sql_qnty;*/
                                    //$plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
                                    //$colar_excess_per=($plan_cut*$colar_excess_percent)/100;
                                    echo number_format($fab_rmg_qty,0);
                                    $color_total_collar+=$fab_rmg_qty;
                                    $color_total_collar_order_qnty+=$fab_rmg_qty;
                                    $grand_total_collar+=$fab_rmg_qty;
                                    $grand_total_collar_order_qnty+=$fab_rmg_qty;

                                    $size_tatal[$result_size[csf('size_number_id')]]+=$fab_rmg_qty;
                                    ?>
                                </td>
                                <?
                            }
                            ?>

                            <td align="center"><? echo number_format($color_total_collar,0); ?></td>

                        </tr>
                        <?
                        }
                        ?>
                        <tr>
                            <td>Size Total</td>

                            <?
                            foreach($nameArray_item_size  as $result_size)
                            {
                                //$colar_excess_pers=($size_tatal[$result_size[csf('size_number_id')]]*$colar_excess_percent)/100;
                                $tot_size_tatal=$size_tatal[$result_size[csf('size_number_id')]];
                                //$size_tatal[$result_size[csf('size_number_id')]]=0;
                                ?>
                                <td style="border:1px solid black;  text-align:center"><?  echo number_format($size_tatal[$result_size[csf('size_number_id')]],0);$size_tatal[$result_size[csf('size_number_id')]]=0; ?></td>
                                <?
                            }
                            ?>
                            <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_collar,0);$grand_total_collar=0; ?></td>

                        </tr>
                    </table>
                    <br/>
                </div>


                <?
            }

            ?>


            <!--End here-->
        </div>
        <?
        // die;

        ?>
        <br>
        <table style="display:none"    width="100%"  border="0" cellpadding="0" cellspacing="0" >
            <tr>
                <?
                //echo "select min(c.id) as id,b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id  and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by id";
                $colar_percent_size_wise_array=return_library_array( "select a.colar_cuff_per,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id    and a.booking_no=$txt_booking_no and a.booking_type=1 and c.body_part_id in(2) and a.status_active=1 and a.is_deleted=0", "gmts_sizes", "colar_cuff_per");
                //print_r($colar_percent_size_wise_array);
                $nameArray_item_size=sql_select( "select min(c.id) as id,b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id  and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by id");
                if(count($nameArray_item_size)>0)
                {
                    ?>
                    <td width="49%">
                        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                            <tr>
                                <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Collar -  Colour Size Brakedown in Pcs</b></td>
                            </tr>
                            <tr>
                                <td width="70">Size</td>

                                <?

                                /*$nameArray_item_size=sql_select( "select b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by c.size_number_id,b.item_size order by c.size_number_id");*/
                                foreach($nameArray_item_size  as $result_size)
                                {
                                    ?>
                                    <td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
                                    <?
                                }
                                ?>
                                <td rowspan="2" align="center"><strong>Total</strong></td>
                                <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
                            </tr>
                            <tr>
                                <td>Collar Size</td>

                                <?
                                foreach($nameArray_item_size  as $result_item_size)
                                {
                                    ?>
                                    <td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
                                    <?
                                }
                                ?>
                                <?
                                $color_library=return_library_array( "select id,color_name from lib_color where status_active =1 and is_deleted=0", "id", "color_name");
                                $color_wise_wo_sql=sql_select("select a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id,sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by c.color_number_id,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method order by a.id
    ");
                                foreach($color_wise_wo_sql as $color_wise_wo_result)
                                {
                                $color_total_collar=0;
                                $color_total_collar_order_qnty=0;
                                $process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
                                $constrast_color_arr=array();
                                if($color_wise_wo_result[csf("color_size_sensitive")]==3)
                                {
                                    $constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
                                    for($i=0;$i<count($constrast_color);$i++)
                                    {
                                        $constrast_color2=explode('_',$constrast_color[$i]);
                                        $constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
                                    }
                                }
                                ?>
                            <tr>
                                <td>
                                    <?
                                    if($color_wise_wo_result[csf("color_size_sensitive")]==3)
                                    {
                                        echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]) ;
                                        $lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
                                    }
                                    else
                                    {
                                        echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
                                        $lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
                                    }
                                    ?>

                                </td>
                                <?
                                foreach($nameArray_item_size  as $result_size)
                                {
                                    ?>
                                    <td align="center" style="border:1px solid black">

                                        <?
                                        //$color_wise_wo_sql_qnty=sql_select("select c.color_number_id,sum(c.order_quantity) as order_quantity, sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 and c.color_number_id='".$color_wise_wo_result['color_number_id']."' and c.size_number_id='".$result_size['size_number_id']."'");
                                        $color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0");

                                        list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
                                        $plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
                                        $colar_excess_per=($plan_cut*$colar_excess_percent)/100;
                                        echo number_format($plan_cut+$colar_excess_per,0);
                                        $color_total_collar+=$plan_cut+$colar_excess_per;
                                        $color_total_collar_order_qnty+=$plan_cut;
                                        $grand_total_collar+=$plan_cut+$colar_excess_per;
                                        $grand_total_collar_order_qnty+=$plan_cut;

                                        $size_tatal[$result_size[csf('size_number_id')]]+=$plan_cut+$colar_excess_per;
                                        ?>
                                    </td>
                                    <?
                                }
                                ?>

                                <td align="center"><? echo number_format($color_total_collar,0); ?></td>
                                <td align="center"><? echo number_format((($color_total_collar-$color_total_collar_order_qnty)/$color_total_collar_order_qnty)*100,2); ?></td>
                            </tr>
                            <?
                            }
                            ?>
                            <tr>
                                <td>Size Total</td>

                                <?
                                foreach($nameArray_item_size  as $result_size)
                                {
                                    ?>
                                    <td style="border:1px solid black;  text-align:center"><? $colar_excess_pers=($size_tatal[$result_size[csf('size_number_id')]]*$colar_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]+$colar_excess_pers,0); ?></td>
                                    <?
                                }
                                ?>
                                <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_collar,0); ?></td>
                                <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_collar-$grand_total_collar_order_qnty)/$grand_total_collar_order_qnty)*100,2); ?></td>
                            </tr>
                        </table>
                    </td>
                    <td width="2%">
                    </td>
                    <?
                }
                ?>

                <?
                $cuff_percent_size_wise_array=return_library_array( "select a.colar_cuff_per,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id    and a.booking_no=$txt_booking_no and a.booking_type=1 and c.body_part_id in(3) and a.status_active=1 and a.is_deleted=0", "gmts_sizes", "colar_cuff_per");
                //print_r($cuff_percent_size_wise_array);
                $nameArray_item_size=sql_select( "select min(c.id) as id, b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=3  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by id");

                if(count($nameArray_item_size)>0)
                {
                    ?>
                    <td width="49%">
                        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                            <tr>
                                <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Cuff -  Colour Size Brakedown in Pcs</b></td>
                            </tr>
                            <tr>
                                <td width="70">Size</td>

                                <?
                                foreach($nameArray_item_size  as $result_size)
                                {
                                    ?>
                                    <td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
                                    <?
                                }
                                ?>
                                <td rowspan="2" align="center"><strong>Total</strong></td>
                                <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
                            </tr>
                            <tr>
                                <td>Cuff Size</td>

                                <?
                                foreach($nameArray_item_size  as $result_item_size)
                                {
                                    ?>
                                    <td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
                                    <?
                                }
                                ?>
                                <?

                                $color_wise_wo_sql=sql_select("select a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id,sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=3  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id and  d.status_active=1 and d.is_deleted=0 group by c.color_number_id ,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method order by a.id
    ");
                                foreach($color_wise_wo_sql as $color_wise_wo_result)
                                {
                                $color_total_cuff=0;
                                $color_total_cuff_order_qnty=0;
                                $process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
                                $constrast_color_arr=array();
                                if($color_wise_wo_result[csf("color_size_sensitive")]==3)
                                {
                                    $constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
                                    for($i=0;$i<count($constrast_color);$i++)
                                    {
                                        $constrast_color2=explode('_',$constrast_color[$i]);
                                        $constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
                                    }
                                }
                                //print_r($constrast_color_arr);
                                ?>
                            <tr>
                                <td>
                                    <?
                                    if($color_wise_wo_result[csf("color_size_sensitive")]==3)
                                    {
                                        ///echo $color_wise_wo_result[csf('color_number_id')];
                                        echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]);
                                        $lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
                                    }
                                    else
                                    {
                                        echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
                                        $lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
                                    }
                                    ?>

                                </td>
                                <?
                                foreach($nameArray_item_size  as $result_size)
                                {
                                    ?>
                                    <td align="center" style="border:1px solid black">

                                        <?
                                        /*$color_wise_wo_sql_qnty=sql_select("select c.color_number_id,sum(c.order_quantity) as order_quantity, sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=3 and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 and c.color_number_id='".$color_wise_wo_result['color_number_id']."' and c.size_number_id='".$result_size['size_number_id']."'");*/
                                        $color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0");

                                        list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
                                        $plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
                                        $cuff_excess_per=(($plan_cut*2)*$cuff_excess_percent)/100;
                                        echo number_format($plan_cut*2+$cuff_excess_per,0);
                                        $color_total_cuff+=$plan_cut*2+$cuff_excess_per;
                                        $color_total_cuff_order_qnty+=$plan_cut*2;
                                        $grand_total_cuff+=$plan_cut*2+$cuff_excess_per;
                                        $grand_total_cuff_order_qnty+=$plan_cut*2;
                                        $size_tatal[$result_size[csf('size_number_id')]]+=$plan_cut*2+$cuff_excess_per;
                                        /*$cuff_excess_per=(($plan_cut_qnty[csf('plan_cut_qnty')]*2)*$cuff_excess_percent)/100;
                                        echo number_format($plan_cut_qnty[csf('plan_cut_qnty')]*2+$cuff_excess_per,0);
                                        $color_total_cuff+=$plan_cut_qnty[csf('plan_cut_qnty')]*2+$cuff_excess_per;
                                        $color_total_cuff_order_qnty+=$plan_cut_qnty[csf('order_quantity')]*2;
                                        $grand_total_cuff+=$plan_cut_qnty[csf('plan_cut_qnty')]*2+$cuff_excess_per;
                                        $grand_total_cuff_order_qnty+=$plan_cut_qnty[csf('order_quantity')]*2;*/

                                        ?>

                                    </td>
                                    <?
                                }
                                ?>

                                <td align="center"><? echo number_format($color_total_cuff,0); ?></td>
                                <td align="center"><? echo number_format((($color_total_cuff-$color_total_cuff_order_qnty)/$color_total_cuff_order_qnty)*100,2); ?></td>
                            </tr>
                            <?
                            }
                            ?>
                            <tr>
                                <td>Size Total</td>

                                <?
                                foreach($nameArray_item_size  as $result_size)
                                {
                                    /* $nameArray_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =$result_size[size_number_id]  and status_active=1 and is_deleted =0 order by id");
                                 foreach($nameArray_size_qnty as $result_size_qnty)
                                 {*/
                                    ?>
                                    <td style="border:1px solid black;  text-align:center"><? $cuff_excess_pers=(($size_tatal[$result_size[csf('size_number_id')]]*2)*$cuff_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]*2+$cuff_excess_pers,0); ?></td>
                                    <?
                                    //}
                                }
                                ?>
                                <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_cuff,0); ?></td>
                                <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_cuff-$grand_total_cuff_order_qnty)/$grand_total_cuff_order_qnty)*100,2); ?></td>
                            </tr>
                        </table>
                    </td>
                    <?
                }
                ?>
            </tr>
        </table>
        <br/>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
            <tr>
                <?

                //echo "select a.colar_cuff_per,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id    and a.booking_no=$txt_booking_no and a.booking_type=1 c.body_part_id in(2) and a.status_active=1 and a.is_deleted=0";
                //$colar_percent_size_wise_array=return_library_array( "select a.colar_cuff_per,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id    and a.booking_no=$txt_booking_no and a.booking_type=1 and c.body_part_id in(2) and a.status_active=1 and a.is_deleted=0", "gmts_sizes", "colar_cuff_per");


                $colar_percent_size_wise_array=array();
                $colar_tipping_percent_size_wise_sql=sql_select( "select a.colar_cuff_per,b.color_number_id,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id    and a.booking_no=$txt_booking_no and a.booking_type=1 and c.body_part_id in(172) and a.status_active=1 and a.is_deleted=0");

                $colar_tipping_excess_percent_arr=array();
                foreach($colar_tipping_percent_size_wise_sql as $colar_percent_size_wise_row)
                {
                    $colar_tipping_excess_percent_arr[$colar_percent_size_wise_row[csf('color_number_id')]][$colar_percent_size_wise_row[csf('gmts_sizes')]]=$colar_percent_size_wise_row[csf('colar_cuff_per')];
                    //$colar_excess_percent_arr[$colar_percent_size_wise_row[csf('gmts_sizes')]]+=$colar_percent_size_wise_row[csf('colar_cuff_per')];

                }

                //print_r($colar_tipping_excess_percent_arr);
                $nameArray_item_size=sql_select( "select min(c.id) as id,b.item_size,c.size_number_id,	min(c.size_order) as size_order FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=172  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id  and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by size_order");


                if(count($nameArray_item_size)>0)
                {
                    ?>
                    <td width="49%">
                        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                            <tr>
                                <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Collar Tipping -  Colour Size Brakedown in Pcs</b></td>
                            </tr>
                            <tr>
                                <td width="70">Size</td>

                                <?

                                /*$nameArray_item_size=sql_select( "select b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by c.size_number_id,b.item_size order by c.size_number_id");*/
                                foreach($nameArray_item_size  as $result_size)
                                {
                                    ?>
                                    <td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
                                    <?
                                }
                                ?>
                                <td rowspan="2" align="center"><strong>Total</strong></td>
                                <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
                            </tr>
                            <tr>
                                <td>Collar Size</td>

                                <?
                                foreach($nameArray_item_size  as $result_item_size)
                                {
                                    ?>
                                    <td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
                                    <?
                                }

                                $color_wise_wo_sql=sql_select("select a.id, a.job_no, a.color_size_sensitive, a.color_break_down, a.process_loss_method, c.color_number_id , c.color_order, sum(c.plan_cut_qnty) as plan_cut_qnty
		FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c, wo_booking_dtls d
		WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=172 and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 and c.status_active=1 and c.is_deleted=0
		group by c.color_number_id, c.color_order, a.id, a.job_no, a.color_size_sensitive,a.color_break_down, a.process_loss_method
		order by c.color_order ");

                                foreach($color_wise_wo_sql as $color_wise_wo_result)
                                {
                                $color_total_collar=0;
                                $color_total_collar_order_qnty=0;
                                $process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
                                $constrast_color_arr=array();
                                if($color_wise_wo_result[csf("color_size_sensitive")]==3)
                                {
                                    $constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
                                    for($i=0;$i<count($constrast_color);$i++)
                                    {
                                        $constrast_color2=explode('_',$constrast_color[$i]);
                                        $constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
                                    }
                                }
                                ?>
                            <tr>
                                <td>
                                    <?
                                    if($color_wise_wo_result[csf("color_size_sensitive")]==3)
                                    {
                                        echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]) ;
                                        $lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
                                    }
                                    else
                                    {
                                        echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
                                        $lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
                                    }
                                    ?>

                                </td>
                                <?
                                foreach($nameArray_item_size  as $result_size)
                                {
                                    ?>
                                    <td align="center" style="border:1px solid black">
                                        <?

                                        $color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0 ");




                                        list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
                                        $plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
                                        $colar_tipping_excess_per=($plan_cut*$colar_tipping_excess_percent_arr[$color_wise_wo_result[csf('color_number_id')]][$result_size[csf('size_number_id')]])/100;
                                        echo number_format($plan_cut+$colar_tipping_excess_per,0);
                                        $collar_tiff_size_total_arr[$result_size[csf('size_number_id')]]+=number_format($plan_cut+$colar_tipping_excess_per,0,'','');
                                        $color_tipping_total_collar+=$plan_cut+$colar_tipping_excess_per;
                                        $color_tipping_total_collar_order_qnty+=$plan_cut;
                                        $grand_total_collar_tipping+=$plan_cut+$colar_tipping_excess_per;
                                        $grand_total_collar_tipping_order_qnty+=$plan_cut;



                                        ?>
                                    </td>
                                    <?
                                }
                                ?>

                                <td align="center"><? echo number_format($color_tipping_total_collar,0); ?></td>
                                <td align="center"><? echo number_format((($color_tipping_total_collar-$color_tipping_total_collar_order_qnty)/$color_tipping_total_collar_order_qnty)*100,2); ?></td>
                            </tr>
                            <?
                            }
                            ?>
                            <tr>
                                <td>Size Total</td>

                                <?
                                foreach($nameArray_item_size  as $result_size)
                                {
                                    ?>
                                    <td style="border:1px solid black;  text-align:center">
                                        <?
                                        //$colar_excess_pers=($size_tatal[$result_size[csf('size_number_id')]]*$colar_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]+$colar_excess_pers,0);
                                        echo number_format($collar_tiff_size_total_arr[$result_size[csf('size_number_id')]],0);

                                        ?></td>
                                    <?
                                }
                                ?>
                                <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_collar_tipping,0); ?></td>
                                <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_collar_tipping-$grand_total_collar_tipping_order_qnty)/$grand_total_collar_tipping_order_qnty)*100,2); ?></td>
                            </tr>
                        </table>
                    </td>
                    <td width="2%">
                    </td>
                    <?
                }

                $cuff_tipping_percent_size_wise_array=$cuff_size_total=array();
                $cuff_tipping_percent_size_wise_sql=sql_select( "select a.colar_cuff_per,b.color_number_id,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id  and a.booking_no=$txt_booking_no and a.booking_type=1 and c.body_part_id in(214) and a.status_active=1 and a.is_deleted=0");
                foreach($cuff_tipping_percent_size_wise_sql as $cuff_percent_size_wise_row)
                {
                    $cuff_tipping_percent_size_wise_array[$cuff_percent_size_wise_row[csf('color_number_id')]][$cuff_percent_size_wise_row[csf('gmts_sizes')]]=$cuff_percent_size_wise_row[csf('colar_cuff_per')];
                }


                $nameArray_item_size=sql_select( "select min(c.id) as id, b.item_size,c.size_number_id,	min(c.size_order) as size_order FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=214  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by size_order");


                if(count($nameArray_item_size)>0)
                {
                    ?>
                    <td width="49%">
                        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                            <tr>
                                <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Cuff Tipping-  Colour Size Brakedown in Pcs</b></td>
                            </tr>
                            <tr>
                                <td width="70">Size</td>

                                <?
                                foreach($nameArray_item_size  as $result_size)
                                {
                                    ?>
                                    <td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
                                    <?
                                }
                                ?>
                                <td rowspan="2" align="center"><strong>Total</strong></td>
                                <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
                            </tr>
                            <tr>
                                <td>Cuff Size</td>

                                <?
                                foreach($nameArray_item_size  as $result_item_size)
                                {
                                    ?>
                                    <td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
                                    <?
                                }
                                ?>
                                <?

                                $color_wise_wo_sql=sql_select("select a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id, c.color_order, sum(c.plan_cut_qnty) as plan_cut_qnty
			FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d
			WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=214  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id and  d.status_active=1 and d.is_deleted=0
			group by c.color_number_id, c.color_order ,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method
			order by c.color_order");
                                foreach($color_wise_wo_sql as $color_wise_wo_result)
                                {
                                $color_total_cuff=0;
                                $color_total_cuff_order_qnty=0;
                                $process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
                                $constrast_color_arr=array();
                                if($color_wise_wo_result[csf("color_size_sensitive")]==3)
                                {
                                    $constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
                                    for($i=0;$i<count($constrast_color);$i++)
                                    {
                                        $constrast_color2=explode('_',$constrast_color[$i]);
                                        $constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
                                    }
                                }
                                ?>
                            <tr>
                                <td>
                                    <?
                                    if($color_wise_wo_result[csf("color_size_sensitive")]==3)
                                    {
                                        echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]);
                                        $lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
                                    }
                                    else
                                    {
                                        echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
                                        $lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
                                    }
                                    ?>

                                </td>
                                <?
                                foreach($nameArray_item_size  as $result_size)
                                {
                                    ?>
                                    <td align="center" style="border:1px solid black">

                                        <?


                                        $color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0");



                                        list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
                                        $plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
                                        $cuff_tipping_excess_per=(($plan_cut*2)*$cuff_tipping_percent_size_wise_array[$color_wise_wo_result[csf('color_number_id')]][$result_size[csf('size_number_id')]])/100;
                                        echo number_format($plan_cut*2+$cuff_tipping_excess_per,0);
                                        $cuff_tiffing_size_total[$result_size[csf('size_number_id')]]+=number_format($plan_cut*2+$cuff_tipping_excess_per,0,'','');
                                        //echo $cuff_tipping_percent_size_wise_array[$color_wise_wo_result[csf('color_number_id')]][$result_size[csf('size_number_id')]];
                                        $color_total_cuff_tiffing+=$plan_cut*2+$cuff_tipping_excess_per;
                                        $color_total_cuff_tiffing_order_qnty+=$plan_cut*2;
                                        $grand_total_cuff_tiffing+=$plan_cut*2+$cuff_tipping_excess_per;
                                        $grand_total_cuff_tiffing_order_qnty+=$plan_cut*2;
                                        ?>

                                    </td>
                                    <?
                                }
                                ?>

                                <td align="center"><? echo number_format($color_total_cuff_tiffing,0); ?></td>
                                <td align="center"><? echo number_format((($color_total_cuff_tiffing-$color_total_cuff_tiffing_order_qnty)/$color_total_cuff_tiffing_order_qnty)*100,2);  ?></td>
                            </tr>
                            <?
                            }
                            ?>
                            <tr>
                                <td>Size Total</td>

                                <?
                                foreach($nameArray_item_size  as $result_size)
                                {
                                    /* $nameArray_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =$result_size[size_number_id]  and status_active=1 and is_deleted =0 order by id");
                                 foreach($nameArray_size_qnty as $result_size_qnty)
                                 {*/
                                    ?>
                                    <td style="border:1px solid black;  text-align:center">
                                        <?
                                        //$cuff_excess_pers=(($size_tatal[$result_size[csf('size_number_id')]]*2)*$cuff_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]*2+$cuff_excess_pers,0);
                                        echo number_format($cuff_tiffing_size_total[$result_size[csf('size_number_id')]],0);
                                        ?></td>
                                    <?
                                    //}
                                }
                                ?>
                                <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_cuff_tiffing,0); ?></td>
                                <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_cuff_tiffing-$grand_total_cuff_tiffing_order_qnty)/$grand_total_cuff_tiffing_order_qnty)*100,2); ?></td>
                            </tr>
                        </table>
                    </td>
                    <?
                }
                ?>
            </tr>
        </table>

        <table  width="100%"  border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td width="49%" style="border:solid; border-color:#000; border-width:thin" valign="top">
                    <?php echo get_spacial_instruction($txt_booking_no); ?>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top">
                    <?
                    if(str_replace("'","",$cbo_fabric_source)==1 || str_replace("'","",$cbo_fabric_source)==2 || str_replace("'","",$cbo_fabric_source)==3 )
                    {
                        ?>
                        <table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                            <tr align="center">
                                <td colspan="10"><b>Comments</b></td>

                            </tr>
                            <tr align="center">
                                <td>Sl</td>
                                <td>Po NO</td>
                                <td>Ship Date</td>
                                <td>Pre-Cost Qty</td>
                                <td>Mn.Book Qty</td>
                                <td>Sht.Book Qty</td>
                                <td>Smp.Book Qty</td>
                                <td>Tot.Book Qty</td>
                                <td>Balance</td>
                                <td>Comments</td>
                            </tr>
                            <?
                            $cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
                            $cbo_fabric_natu_id=str_replace("'","",$cbo_fabric_natu);
                            $cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
                            if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
                            if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
                            //$paln_cut_qnty_array=return_library_array( "select min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_mst_id,size_mst_id,item_mst_id", "id", "plan_cut_qnty");

                            $paln_cut_qnty_array=return_library_array( "select min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id,size_number_id,item_number_id,po_break_down_id", "id", "plan_cut_qnty");

                            $item_ratio_array=return_library_array( "select gmts_item_id,set_item_ratio from wo_po_details_mas_set_details  where job_no =$txt_job_no", "gmts_item_id", "set_item_ratio");
                            $nameArray=sql_select("
	select
	a.id,
	a.item_number_id,
	a.costing_per,
	b.po_break_down_id,
	b.color_size_table_id,
	b.requirment,
	c.po_number
    FROM
	wo_pre_cost_fabric_cost_dtls a,
	wo_pre_cos_fab_co_avg_con_dtls b,
	wo_po_break_down c
    WHERE
	a.job_no=b.job_no and
	a.job_no=c.job_no_mst and
    a.id=b.pre_cost_fabric_cost_dtls_id and
	b.po_break_down_id=c.id and
	b.po_break_down_id in (".str_replace("'","",$txt_order_no_id).")  $cbo_fabric_natu $cbo_fabric_source_cond and a.status_active=1 and a.is_deleted=0
	order by a.id");
                            $count=0;
                            $tot_grey_req_as_pre_cost_arr=array();
                            foreach ($nameArray as $result)
                            {
                                if (count($nameArray)>0 )
                                {
                                    if($result[csf("costing_per")]==1)
                                    {
                                        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(12*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
                                    }
                                    if($result[csf("costing_per")]==2)
                                    {
                                        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(1*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
                                    }
                                    if($result[csf("costing_per")]==3)
                                    {
                                        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(24*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
                                    }
                                    if($result[csf("costing_per")]==4)
                                    {
                                        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(36*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
                                    }
                                    if($result[csf("costing_per")]==5)
                                    {
                                        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(48*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
                                    }
                                    $tot_grey_req_as_pre_cost_arr[$result[csf("po_number")]]+=$tot_grey_req_as_pre_cost;
                                }
                            }
                            $total_pre_cost=0;
                            $total_booking_qnty_main=0;
                            $total_booking_qnty_short=0;
                            $total_booking_qnty_sample=0;
                            $total_tot_bok_qty=0;
                            $tot_balance=0;
                            /*$booking_qnty=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and booking_type in(1,4)  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by a.po_break_down_id", "po_break_down_id", "grey_fab_qnty");*/
                            $booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and a.is_short=2 and c.item_category in(".$cbo_fabric_natu_id.") and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

                            $booking_qnty_short=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and c.item_category in(2,3) and a.is_short=1 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
                            $booking_qnty_sample=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c  where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =4 and c.fabric_source=$cbo_fabric_source and c.item_category in(2,3)  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

                            $sql_data=sql_select( "select max(a.id) as id,  a.po_number,max(a.pub_shipment_date) as pub_shipment_date,sum(a.plan_cut) as plan_cut  from wo_po_break_down a,wo_pre_cost_sum_dtls b,wo_pre_cost_mst c where a.job_no_mst=b.job_no and a.job_no_mst=c.job_no and a.id in(".str_replace("'","",$txt_order_no_id).") group by a.po_number order by id");
                            foreach($sql_data  as $row)
                            {
                                $col++;
                                ?>
                                <tr align="center">
                                    <td><? echo $col; ?></td>
                                    <td><? echo $row[csf("po_number")]; ?></td>
                                    <td><? echo change_date_format($row[csf("pub_shipment_date")],"dd-mm-yyyy",'-'); ?></td>
                                    <td align="right"><? echo number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]],2); $total_pre_cost+=$tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]; ?></td>
                                    <td align="right"><? echo number_format($booking_qnty_main[$row[csf("id")]],2); $total_booking_qnty_main+=$booking_qnty_main[$row[csf("id")]];?></td>
                                    <td align="right"><? echo number_format($booking_qnty_short[$row[csf("id")]],2); $total_booking_qnty_short+=$booking_qnty_short[$row[csf("id")]];?></td>
                                    <td align="right"><? echo number_format($booking_qnty_sample[$row[csf("id")]],2); $total_booking_qnty_sample+=$booking_qnty_sample[$row[csf("id")]];?></td>
                                    <td align="right"><? $tot_bok_qty=$booking_qnty_main[$row[csf("id")]]+$booking_qnty_short[$row[csf("id")]]+$booking_qnty_sample[$row[csf("id")]]; echo number_format($tot_bok_qty,2); $total_tot_bok_qty+=$tot_bok_qty;?></td>
                                    <td align="right">
                                        <? $balance= def_number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]-$tot_bok_qty,2,""); echo number_format($balance,2); $tot_balance+= $balance?>
                                    </td>
                                    <td>
                                        <?
                                        if( $balance>0)
                                        {
                                            echo "Less Booking";
                                        }
                                        else if ($balance<0)
                                        {
                                            echo "Extra Booking";
                                        }
                                        else
                                        {
                                            echo "";
                                        }
                                        ?>
                                    </td>
                                </tr>
                                <?
                            }
                            ?>
                            <tfoot>

                            <tr>
                                <td colspan="3">Total:</td>

                                <td align="right"><? echo number_format($total_pre_cost,2); ?></td>
                                <td align="right"><? echo number_format($total_booking_qnty_main,2); ?></td>
                                <td align="right"><? echo number_format($total_booking_qnty_short,2); ?></td>
                                <td align="right"><? echo number_format($total_booking_qnty_sample,2); ?></td>
                                <td align="right"><? echo number_format($total_tot_bok_qty,2); ?></td>
                                <td align="right"><? echo number_format($tot_balance,2); ?></td>
                                <td></td>
                            </tr>
                            </tfoot>
                        </table>
                        <?
                    }
                    ?>
                </td>

            </tr>
        </table>
        <br/>
        <?
        //echo "select responsible_dept,	responsible_person,	reason from wo_booking_dtls where booking_no =$txt_booking_no";
        //"select id,department_name from  lib_department where status_active=1 and is_deleted=0 order by  department_name"
        $department_name_library=return_library_array( "select id,department_name from  lib_department where status_active=1 and is_deleted=0 order by  department_name", "id", "department_name"  );

        $sql_responsible= sql_select("select responsible_dept,	responsible_person,	reason from wo_booking_dtls where booking_no =$txt_booking_no and fin_fab_qnty>0  and status_active=1 ");
        if(count($sql_responsible)>0)
        {
            ?>
            <table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                <tr>
                    <td>
                        #
                    </td>
                    <td>
                        Responsible Dept.
                    </td>
                    <td>
                        Responsible person
                    </td>
                    <td>
                        Reason
                    </td>
                </tr>
                <?
                $ir=1;
                foreach($sql_responsible as $sql_responsible_row)
                {
                    ?>
                    <tr>
                        <td>
                            <?  echo $ir; ?>
                        </td>
                        <td>
                            <?
                            $responsible_dept_st="";
                            $responsible_dept_arr=explode( ",",$sql_responsible_row[csf('responsible_dept')]);
                            foreach($responsible_dept_arr as $key => $value)
                            {
                                $responsible_dept_st.= $department_name_library[$value].", ";
                            }
                            echo rtrim($responsible_dept_st,", ");
                            ?>
                        </td>
                        <td>
                            <?  echo $sql_responsible_row[csf('responsible_person')]; ?>
                        </td>
                        <td>
                            <?  echo $sql_responsible_row[csf('reason')]; ?>
                        </td>
                    </tr>
                    <?
                    $ir++;

                }
                ?>
            </table>
            <?
        }
        ?>
        <br/>
        <table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" style="font-family:Arial Narrow;">
            <caption> <strong style="float:left"> Stripe Details</strong></caption>
            <?
            // and a.id in(".str_replace("'","",$txt_order_no_id).")
            $color_name_arr=return_library_array( "select id,color_name from lib_color where status_active=1 and is_deleted=0",'id','color_name');
            $sql_stripe=("select c.id,c.composition,c.construction,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,sum(b.grey_fab_qnty) as fab_qty,b.dia_width,d.color_number_id as color_number_id,d.id as did,d.stripe_color,d.fabreqtotkg as fabreqtotkg ,d.measurement as measurement ,d.yarn_dyed,d.uom  from wo_booking_dtls b, wo_pre_cost_fabric_cost_dtls c,wo_pre_stripe_color d where c.id=b.pre_cost_fabric_cost_dtls_id and c.job_no=b.job_no and d.pre_cost_fabric_cost_dtls_id=c.id and d.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and b.job_no=d.job_no and b.job_no='$job_no'  and b.booking_no=$txt_booking_no  and c.color_type_id in (2,3,4,6,32,33,34)  and b.status_active=1  and c.is_deleted=0 and c.status_active=1  and d.is_deleted=0 and d.status_active=1  and 	b.is_deleted=0  group by c.id,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,d.color_number_id,d.id,d.stripe_color,d.yarn_dyed,d.fabreqtotkg ,d.measurement,d.uom,c.composition,c.construction,b.dia_width order by d.id ");
            $result_data=sql_select($sql_stripe);
            foreach($result_data as $row){
                $stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['stripe_color'][$row[csf('did')]]=$row[csf('stripe_color')];
                $stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['measurement'][$row[csf('did')]]=$row[csf('measurement')];
                $stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['uom'][$row[csf('did')]]=$row[csf('uom')];
                $stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['fabreqtotkg'][$row[csf('did')]]=$row[csf('fabreqtotkg')];
                $stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['yarn_dyed'][$row[csf('did')]]=$row[csf('yarn_dyed')];

                $stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['composition']=$row[csf('composition')];
                $stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['construction']=$row[csf('construction')];
                $stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['gsm_weight']=$row[csf('gsm_weight')];
                $stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['color_type_id']=$row[csf('color_type_id')];
                $stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['dia_width']=$row[csf('dia_width')];
                $stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['fabreqtotkg']+=$row[csf('fabreqtotkg')];
            }
            ?>

            <tr>
                <th width="30"> SL</th>
                <th width="100"> Body Part</th>
                <th width="80"> Fabric Color</th>
                <th width="70"> Fabric Qty(KG)</th>
                <th width="70"> Stripe Color</th>
                <th width="70"> Stripe Measurement</th>
                <th width="70"> Stripe Uom</th>
                <th  width="70"> Qty.(KG)</th>
                <th  width="70"> Y/D Req.</th>
            </tr>
            <?
            //if($db_type==0) $color_cond="d.fabric_color_id='".$color_id."'";
            //else if($db_type==2) $color_cond="nvl(d.fabric_color_id,0)=nvl('".$color_id."',0)";
            //else if($db_type==2) $color_cond="nvl(d.fabric_color_id,0)=nvl('".$color_id."',0)";


            $i=1;$total_fab_qty=0;$total_fabreqtotkg=0;$fab_data_array=array();
            foreach($stripe_arr as $body_id=>$body_data){
                foreach($body_data as $color_id=>$color_val){
                    $rowspan=count($color_val['stripe_color']);
                    $composition=$stripe_arr2[$body_id][$color_id]['composition'];
                    $construction=$stripe_arr2[$body_id][$color_id]['construction'];
                    $gsm_weight=$stripe_arr2[$body_id][$color_id]['gsm_weight'];
                    $color_type_id=$stripe_arr2[$body_id][$color_id]['color_type_id'];
                    $dia_width=$stripe_arr2[$body_id][$color_id]['dia_width'];

                    /*if($db_type==0) $color_cond="d.fabric_color_id='".$color_id."'";
                    else if($db_type==2) $color_cond="nvl(d.fabric_color_id,0)=nvl('".$color_id."',0)";

                    $color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
                        WHERE a.job_no=b.job_no and
                        a.id=b.pre_cost_fabric_cost_dtls_id and
                        c.job_no_mst=a.job_no and
                        c.id=b.color_size_table_id and
                        b.po_break_down_id=d.po_break_down_id and
                        b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
                        d.booking_no =$txt_booking_no and
                        a.body_part_id='".$body_id."' and
                        a.color_type_id='".$color_type_id."' and
                        a.construction='".$construction."' and
                        a.composition='".$composition."' and
                        a.gsm_weight='".$gsm_weight."' and
                        $color_cond and
                        d.status_active=1 and
                        d.is_deleted=0
                        ");
                        list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty;*/
                    ?>
                    <tr>
                    <?
                    //$color_qty=$stripe_arr2[$body_id][$color_id]['fabreqtotkg'];//$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
                    $color_qty= array_sum($stripe_arr[$body_id][$color_id]['fabreqtotkg']);
                    ?>
                    <td rowspan="<? echo $rowspan;?>"> <? echo $i; ?></td>
                    <td rowspan="<? echo $rowspan;?>"> <? echo $body_part[$body_id]; ?></td>
                    <td rowspan="<? echo $rowspan;?>"> <? echo $color_name_arr[$color_id]; ?></td>
                    <td rowspan="<? echo $rowspan;?>" align="right"> <? echo number_format($color_qty,2); ?></td>
                    <?
                    $total_fab_qty+=$color_qty;
                    foreach($color_val['stripe_color'] as $strip_color_id=>$s_color_val)
                    {
                        $measurement=$color_val['measurement'][$strip_color_id];
                        $uom=$color_val['uom'][$strip_color_id];
                        $fabreqtotkg=$color_val['fabreqtotkg'][$strip_color_id];
                        $yarn_dyed=$color_val['yarn_dyed'][$strip_color_id];
                        ?>
                        <td><?  echo  $color_name_arr[$s_color_val]; ?></td>
                        <td align="right"> <? echo  number_format($measurement,2); ?></td>
                        <td> <? echo  $unit_of_measurement[$uom]; ?></td>
                        <td align="right"> <? echo  number_format($fabreqtotkg,2); ?></td>
                        <td> <? echo  $yes_no[$yarn_dyed]; ?></td>
                        </tr>
                        <?
                        $total_fabreqtotkg+=$fabreqtotkg;
                    }
                    $i++;
                }
            }
            ?>
            <tfoot>
            <tr>
                <td colspan="3">Total </td>
                <td align="right">  <? echo  number_format($total_fab_qty,2); ?> </td>
                <td></td>
                <td></td>
                <td>   </td>
                <td align="right"><? echo  number_format($total_fabreqtotkg,2); ?> </td>
            </tr>
            </tfoot>
        </table>

        <?
        $lib_designation_arr=return_library_array(" select id,custom_designation from lib_designation","id","custom_designation");
        $user_lib_designation_arr=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
        $user_lib_name_arr=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");

        $mst_id=return_field_value("id as mst_id","wo_booking_mst","booking_no=$txt_booking_no","mst_id");
        //echo $mst_id.'ssD';
        //and b.un_approved_date is null
        $approve_data_array=sql_select("select b.approved_by,min(b.approved_date) as approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=12  group by  b.approved_by order by b.approved_by asc");
        //echo "select b.approved_by,min(b.approved_date) as approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=13  group by  b.approved_by order by b.approved_by asc";
        $unapprove_data_array=sql_select("select b.approved_by,b.approved_date,b.un_approved_reason,b.un_approved_date,b.approved_no from   approval_history b where b.mst_id=$mst_id and b.entry_form=12  order by b.approved_date,b.approved_by");

        ?>
        <td width="49%" valign="top">
            <?
            if(count($approve_data_array)>0)
            {
                ?>
                <table  width="850" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
                    <thead>
                    <tr style="border:1px solid black;">
                        <th colspan="5" style="border:1px solid black;">Approval Status</th>
                    </tr>
                    <tr style="border:1px solid black;">
                        <th width="3%" style="border:1px solid black;">Sl</th>
                        <th width="40%" style="border:1px solid black;">Name</th>
                        <th width="30%" style="border:1px solid black;">Designation</th>
                        <th width="27%" style="border:1px solid black;">Approval Date</th>

                    </tr>
                    </thead>
                    <tbody>
                    <?
                    $i=1;
                    foreach($approve_data_array as $row){


                        ?>
                        <tr style="border:1px solid black;">
                            <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
                            <td width="40%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
                            <td width="30%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
                            <td width="27%" style="border:1px solid black;text-align:center"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')]));?></td>

                        </tr>
                        <?
                        $i++;
                    }
                    ?>
                    </tbody>
                </table>
                <?
            }
            ?>
            <br>
            <?
            if(count($unapprove_data_array)>0)
            {
                //and approval_type=2
                $sql_unapproved=sql_select("select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=12 and is_deleted=0 and status_active=1 and booking_id=$mst_id");
                //echo "select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=13 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id=$mst_id";
                $unapproved_request_arr=array();
                foreach($sql_unapproved as $rowu)
                {
                    $unapproved_request_arr[$rowu[csf('booking_id')]]=$rowu[csf('approval_cause')];
                }
                ?>
                <table  width="850" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
                    <thead>
                    <tr style="border:1px solid black;">
                        <th colspan="6" style="border:1px solid black;">Approval/Un Approval History</th>
                    </tr>
                    <tr style="border:1px solid black;">
                        <th width="3%" style="border:1px solid black;">Sl</th>
                        <th width="30%" style="border:1px solid black;">Name</th>
                        <th width="20%" style="border:1px solid black;">Designation</th>
                        <th width="5%" style="border:1px solid black;">Approval Status</th>
                        <th width="20%" style="border:1px solid black;">Reason For Un Approval</th>
                        <th width="22%" style="border:1px solid black;"> Date</th>

                    </tr>
                    </thead>
                    <tbody>
                    <?
                    $i=1;
                    foreach($unapprove_data_array as $row){

                        ?>
                        <tr style="border:1px solid black;">
                            <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
                            <td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
                            <td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
                            <td width="5%" style="border:1px solid black; text-align:center"><? echo 'Yes';?></td>
                            <td width="20%" style="border:1px solid black;"><? echo '';?></td>
                            <td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); else echo "";?></td>
                        </tr>
                        <?
                        $i++;
                        $un_approved_date= explode(" ",$row[csf('un_approved_date')]);
                        $un_approved_date=$un_approved_date[0];
                        if($db_type==0) //Mysql
                        {
                            if($un_approved_date=="" || $un_approved_date=="0000-00-00") $un_approved_date="";else $un_approved_date=$un_approved_date;
                        }
                        else
                        {
                            if($un_approved_date=="") $un_approved_date="";else $un_approved_date=$un_approved_date;
                        }

                        if($un_approved_date!="")
                        {
                            ?>
                            <tr style="border:1px solid black;">
                                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
                                <td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
                                <td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
                                <td width="5%" style="border:1px solid black;text-align:center;"><? echo 'No';?></td>
                                <td width="20%" style="border:1px solid black;text-align:center"><? echo $unapproved_request_arr[$mst_id];?></td>
                                <td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('un_approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('un_approved_date')])); else echo "";?></td>
                            </tr>

                            <?
                            $i++;
                        }

                    }
                    ?>
                    </tbody>
                </table>
                <?
            }
            ?>


            <?
            echo signature_table(4, $cbo_company_name, "1330px");
    //            echo "****".custom_file_name($txt_booking_no,$style_sting,$txt_job_no);
            ?>
    </div>
    <script type="text/javascript" src="../../js/jquery.js"></script>
    <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
    <script>
        fnc_generate_Barcode('<? echo $varcode_booking_no; ?>','barcode_img_id');
    </script>
    <?
    exit();
}

if ($action=="yarn_work_order_print")
{
    extract($_REQUEST);
    $getYWO = sql_select("SELECT id, company_name, pay_mode, ref_closing_status, is_approved FROM  wo_non_order_info_mst WHERE id = $data");
    if(count($getYWO) > 0){
        $data = $getYWO[0][csf("company_name")]."*".$getYWO[0][csf("id")]."*Yarn Purchase Order*".$getYWO[0][csf("ref_closing_status")]."*".$getYWO[0][csf("pay_mode")]."*".$getYWO[0][csf("is_approved")];
    }else{
        die();
    }
    $data=explode('*',$data);
    // print_r($rate_amount);die;
    if($data[6] == 6){
        echo load_html_head_contents($data[2],"../../../", 1, 1, $unicode,'','');
    } else if ($data[6] == 'YarnPurchaseOrderPrintButton'){
        echo load_html_head_contents($data[2],"../../../", 1, 1, $unicode,'','');
    } else {
        echo load_html_head_contents($data[2],"../../", 1, 1, $unicode,'','');
    }

    //print_r ($data);
    /*if($db_type==0)
    {
        $sql=" select a.id, a.wo_number, a.supplier_id, a.wo_date, a.wo_basis_id, a.delivery_date, a.source, a.attention, a.terms_and_condition, $group_concat(b.po_breakdown_id) as po_breakdown, a.buyer_name, a.style, a.do_no, a.remarks  from wo_non_order_info_mst a, wo_non_order_info_dtls b where a.id=b.mst_id and a.id= '$data[1]' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.id";
    }
    // LISTAGG(b.po_breakdown_id, ',') WITHIN GROUP (ORDER BY po_breakdown_id)
    else
    {
        $sql=" select a.id, a.wo_number, a.supplier_id, a.wo_date, a.wo_basis_id, a.delivery_date, a.source, a.attention, a.terms_and_condition, LISTAGG(CAST (b.po_breakdown_id as varchar(4000) ), ',')  WITHIN GROUP (ORDER BY b.po_breakdown_id) as po_breakdown, a.buyer_name, a.style, a.do_no, a.remarks from wo_non_order_info_mst a, wo_non_order_info_dtls b where a.id=b.mst_id and a.id= $data[1] and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.id, a.wo_number, a.supplier_id, a.wo_date, a.wo_basis_id, a.delivery_date, a.source, a.attention, a.terms_and_condition, a.buyer_name, a.style, a.do_no, a.remarks";
    }*/

    $user_level_library=return_library_array( "select id, user_level from user_passwd where id=$user_id", "id", "user_level"  );
    $bin_no=return_field_value("bin_no as bin_no","lib_company","id=$data[0]",'bin_no');
    //if(($data[3]==1 || $data[3]==0) && $user_level_library[$user_id]==2)
    if(($data[3]==1 && $user_level_library[$user_id]==2) || ($data[3]==0))
    {

        $company_library=return_library_array( "select id, company_name from lib_company", "id", "company_name"  );
        $location=return_field_value("city","lib_company","id=$data[0]" );
        $address=return_field_value("address","lib_location","id=$data[0]");
        $lib_country_arr=return_library_array( "select id,country_name from lib_country","id", "country_name"  );
        $item_name_arr=return_library_array("select id,item_name from lib_item_group", "id","item_name");
        $supplier_name_library = return_library_array('SELECT id,supplier_name FROM lib_supplier','id','supplier_name');
        $lib_terms_condition=return_library_array( "select id, terms from lib_terms_condition",'id','terms');
        $color_arr=return_library_array( "select id, color_name from lib_color",'id','color_name');
        $count_arr=return_library_array( "select id, yarn_count from lib_yarn_count",'id','yarn_count');
        $buyer_arr=return_library_array( "select id, short_name from lib_buyer",'id','short_name');


        $sql_data = sql_select("SELECT id, wo_number_prefix_num, wo_number, buyer_po, requisition_no, delivery_place, wo_date, currency_id, supplier_id, attention, buyer_name, style, wo_basis_id, item_category, delivery_date, source, pay_mode, remarks,do_no, insert_date  FROM  wo_non_order_info_mst WHERE id = $data[1]");
        foreach($sql_data as $row)
        {
            $work_order_no=$row[csf("wo_number")];
            $item_category_id=$row[csf("item_category")];
            $supplier_id=$row[csf("supplier_id")];
            $work_order_date=$row[csf("wo_date")];
            $currency_id=$row[csf("currency_id")];
            $buyer_name=$row[csf("buyer_name")];
            $style=$row[csf("style")];
            $wo_basis_id=$row[csf("wo_basis_id")];
            $pay_mode_id=$row[csf("pay_mode")];
            $source=$row[csf("source")];
            $delivery_date=$row[csf("delivery_date")];
            $attention=$row[csf("attention")];
            $requisition_no=$row[csf("requisition_no")];
            $delivery_place=$row[csf("delivery_place")];
            $do_no=$row[csf("do_no")];
            $remarks=$row[csf("remarks")];
            $insert_date=$row[csf("insert_date")];
        }

        $sql_job=sql_select("select a.id, a.job_no, a.style_ref_no, a.buyer_name,b.id as po_id, b.po_number from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0");
        foreach($sql_job as $row)
        {
            $buyer_job_arr[$row[csf("po_id")]]["po_id"]=$row[csf("po_id")];
            $buyer_job_arr[$row[csf("po_id")]]["po_number"]=$row[csf("po_number")];
            $buyer_job_arr[$row[csf("po_id")]]["buyer_name"]=$row[csf("buyer_name")];
            $buyer_job_arr[$row[csf("po_id")]]["job_no"]=$row[csf("job_no")];
            $buyer_job_arr[$row[csf("po_id")]]["style_ref_no"]=$row[csf("style_ref_no")];
        }


        $sql_supplier = sql_select("SELECT id,supplier_name,contact_no,country_id,web_site,email,address_1,address_2,address_3,address_4 FROM  lib_supplier WHERE id = $supplier_id");

        foreach($sql_supplier as $supplier_data)
        {//contact_no
            $row_mst[csf('supplier_id')];

            if($supplier_data[csf('address_1')]!='')$address_1 = $supplier_data[csf('address_1')].','.' ';else $address_1='';
            if($supplier_data[csf('address_2')]!='')$address_2 = $supplier_data[csf('address_2')].','.' ';else $address_2='';
            if($supplier_data[csf('address_3')]!='')$address_3 = $supplier_data[csf('address_3')].','.' ';else $address_3='';
            if($supplier_data[csf('address_4')]!='')$address_4 = $supplier_data[csf('address_4')].','.' ';else $address_4='';
            if($supplier_data[csf('contact_no')]!='')$contact_no = $supplier_data[csf('contact_no')].','.' ';else $contact_no='';
            if($supplier_data[csf('web_site')]!='')$web_site = $supplier_data[csf('web_site')].','.' ';else $web_site='';
            if($supplier_data[csf('email')]!='')$email = $supplier_data[csf('email')].','.' ';else $email='';
            //if($supplier_data[csf('country_id')]!=0)$country = $supplier_data[csf('country_id')].','.' ';else $country='';
            $country = $supplier_data['country_id'];

            $supplier_address = $address_1;
            $supplier_country =$country;
            $supplier_phone =$contact_no;
            $supplier_email = $email;
        }
        $image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$data[0]'","image_location");
        //echo "select image_location from common_photo_library where  file_type=1 and form_name='company_details' and master_tble_id='$data[0]'";
        $varcode_booking_no=$work_order_no;

        ?>
        <div style="width:930px;">
            <table width="900" cellspacing="0" align="center">
                <tr>
                    <td rowspan="3" width="70">
                        <? if($data[6] == 6){ ?>
                            <img src="../../../<? echo $image_location; ?>" height="70" width="200">
                        <? }else if ($data[6] =='YarnPurchaseOrderPrintButton') { ?>
                            <img src="../../../<? echo $image_location; ?>" height="70" width="200">
                        <? }else{ ?>
                            <img src="../../<? echo $image_location; ?>" height="70" width="200">
                        <? }
                        ?></td>
                    <td colspan="2" style="font-size:xx-large;" align="center"><strong><? echo $company_library[$data[0]]; ?></strong></td>
                    <td rowspan="3" id="barcode_img_id"></td>
                </tr>
                <tr class="form_caption">
                    <td colspan="2" align="center" style="font-size:14px">
                        <?
                        $nameArray = sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id='$data[0]'");

                        foreach ($nameArray as $result) {
                            ?>
                            <? echo $result[csf('plot_no')]; ?>
                            <? echo $result[csf('level_no')] ?>
                            <? echo $result[csf('road_no')]; ?>
                            <? echo $result[csf('block_no')]; ?>
                            <? echo $result[csf('city')]; ?>
                            <? echo $result[csf('zip_code')]; ?>
                            <? echo $result[csf('province')]; ?>
                            <? echo $country_arr[$result[csf('country_id')]]; ?>
                            <? echo $result[csf('email')]; ?>
                            <? echo $result[csf('website')];
                        }
                        //echo $location; ?>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" align="center" style="font-size:x-large"><strong><? echo $data[2] ; ?></strong></td>
                </tr>

                <tr>
                    <?
                    if($db_type==0)
                    {
                        $approval_status="select approval_need from approval_setup_dtls where mst_id=(select id from approval_setup_mst where company_id='$data[0]' and setup_date=(select max(setup_date) from approval_setup_mst where setup_date <= '".change_date_format($insert_date,'yyyy-mm-dd')."' and company_id='$data[0]')) and page_id=15 and status_active=1 and is_deleted=0";
                    }
                    else
                    {
                        $approval_status="select approval_need from approval_setup_dtls where mst_id=(select id from approval_setup_mst where company_id='$data[0]' and setup_date=(select max(setup_date) from approval_setup_mst where setup_date <= '".change_date_format($insert_date, "", "",1)."' and company_id='$data[0]')) and page_id=15 and status_active=1 and is_deleted=0";
                    }
                    $approval_status=sql_select($approval_status);
                    $draft = '';
                    if($approval_status[0][csf('approval_need')] == 1)
                    {
                        if($data[5] != 1){
                            $draft = 'Draft';
                        }
                    }

                    ?>
                    <td colspan="2" align="center" style="font-size:x-large"><strong>&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;&nbsp;<font style="color:#F00"><? if($data[5]==1){ echo "(Approved)";}else{echo $draft;}; ?> </font></strong></td>
                </tr>
            </table>
            <table width="900" cellspacing="0" align="center">
                <tr>
                    <td width="300" align="left" style="font-size:16px;"><strong>To</strong>,&nbsp;<? echo $attention; ?></td>
                    <td width="150" style="font-size:16px;"><strong>WO Number:</strong></td>
                    <td width="150" align="left" style="font-size:16px;"><b><? echo $work_order_no; ?></b></td>
                    <td><strong>Currency:</strong></td>
                    <td align="left"><? echo $currency[$currency_id];
                        //echo $pay_mode[$data[4]];
                        ?></td>
                </tr>
                <tr>
                    <td rowspan="4" style="font-size:16px;"><? echo "<strong>".$supplier_name_library[$supplier_id]."</strong>"; echo "<br>"; echo $supplier_address;  echo  $lib_country_arr[$country]; echo "<br>"; echo "Cell :".$supplier_phone; echo "<br>"; echo "Email :".$supplier_email; echo "<br>"; echo "Remarks :".$remarks; ?></td>
                    <td width="150" align="left" ><strong>WO Date :</strong></td>
                    <td width="150" align="left"><? echo change_date_format($work_order_date); ?></td>
                    <td align="left" ><strong>WO Basis:</strong></td>
                    <td align="left" ><? echo $wo_basis[$wo_basis_id]; ?></td>
                </tr>

                <tr>
                    <td ><strong>Delivery Date :</strong></td>
                    <td><? echo change_date_format($delivery_date); ?></td>
                    <td align="left"><strong>D/O No.</strong></td>
                    <td align="left" ><? echo $do_no; ?></td>
                </tr>
                <tr>
                    <td ><strong>Pay Mode :</strong></td>
                    <td><? echo $pay_mode[$pay_mode_id]; ?></td>
                    <td ><strong><? if($bin_no) echo 'BIN'; ?>  :</strong></td>
                    <td><? if($bin_no) echo $bin_no; ?></td>
                </tr>

                <tr>
                    <td align="right" colspan="5" >Print Date: <? $pc_day_time=explode(" ",$pc_date_time); echo change_date_format($pc_day_time[0]); echo " ".$pc_day_time[1]." ".$pc_day_time[2]; ?></td>
                </tr>
                <tr>
                    <td align="right" colspan="5" >Insert Date: <? $insert_day_time=explode(" ",$insert_date); echo change_date_format($insert_day_time[0]); echo " ".$insert_day_time[1]." ".$insert_day_time[2]; ?></td>
                </tr>
            </table>
            <br>
            <?
            if($wo_basis_id==3)
            {
                $buy_job_sty="Buyer Job Style";
            }
            else if($wo_basis_id==2)
            {
                $buy_job_sty="Buyer Style";
            }
            else if($wo_basis_id==1)
            {

                $buy_job_sty="Buyer Job Style";
            }
            ?>
            <table align="center" cellspacing="0" width="900"  border="1" rules="all" class="rpt_table" >
                <thead bgcolor="#dddddd" align="center">
                <th width="30">SL</th>
                <? if($wo_basis_id!=1){ ?><th width="90">PO No</th><? } ?>
                <th width="140"><? echo $buy_job_sty; ?></th>
                <th width="70">Color</th>
                <th width="60">Count</th>
                <th width="250">Item Description</th>
                <th width="50" >UOM</th>
                <th width="70">Quantity </th>
                <th width="60">Rate</th>
                <th >Amount</th>
                </thead>
                <tbody>
                <?
                $store_arr=return_library_array( "select id, store_name from lib_store_location",'id','store_name');

                $i=1; $buy_job_sty_val="";
                $mst_id=$dataArray[0][csf('id')];

                $sql_dtls="Select a.id, a.job_no,a.buyer_id,a.style_no, a.po_breakdown_id, a.color_name, a.yarn_count, a.yarn_comp_type1st, a.yarn_comp_percent1st, a.yarn_comp_type2nd, a.yarn_comp_percent2nd, a.yarn_type, a.uom, a.supplier_order_quantity, a.rate, a.amount, b.currency_id from wo_non_order_info_dtls a, wo_non_order_info_mst b  where a.mst_id=b.id and a.mst_id='$data[1]' and a.status_active=1 and a.is_deleted=0";
                //echo $sql_dtls;
                $sql_result = sql_select($sql_dtls);
                foreach($sql_result as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

                    $order_quantity+=$row[csf('supplier_order_quantity')];
                    $amount += $row[csf('amount')];
                    if($wo_basis_id==2)
                    {
                        $buyer_name_val="";
                        $buyer_id=explode(',',$buyer_name);
                        foreach($buyer_id as $val)
                        {
                            if($buyer_name_val=="") $buyer_name_val=$buyer_arr[$val]; else $buyer_name_val.=', '.$buyer_arr[$val];
                        }

                        $buy_job_sty_val=$buyer_name_val."<br>".$style;
                    }
                    else if($wo_basis_id==3)
                    {
                        if($row[csf("po_breakdown_id")]!="" && $row[csf("po_breakdown_id")]!=0)
                        {
                            $buyer_name_val=$buyer_arr[$buyer_job_arr[$row[csf("po_breakdown_id")]]["buyer_name"]]."<br>".$buyer_job_arr[$row[csf("po_breakdown_id")]]["job_no"]."<br>".$buyer_job_arr[$row[csf("po_breakdown_id")]]["style_ref_no"]."<br>";
                        }
                        $buy_job_sty_val=$buyer_name_val;
                    }
                    else if($wo_basis_id==1)
                    {
                        if($row[csf("job_no")]!="")
                        {
                            $buyer_name_val=$buyer_arr[$row[csf("buyer_id")]]."<br>".$row[csf("job_no")]."<br>".$row[csf("style_no")]."<br>";
                        }
                        $buy_job_sty_val=$buyer_name_val;
                    }



                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <?
                        $feb_des='';
                        if($row[csf("yarn_comp_type2nd")]==0)
                        {
                            $feb_des=$composition[$row[csf("yarn_comp_type1st")]].' '.$row[csf("yarn_comp_percent1st")].' %, '.$yarn_type[$row[csf("yarn_type")]];
                        }
                        else if( $row[csf("yarn_comp_type2nd")]!=0)
                        {
                            $feb_des=$composition[$row[csf("yarn_comp_type1st")]].' '.$row[csf("yarn_comp_percent1st")].' %,'.$composition[$row[csf("yarn_comp_type2nd")]].' '.$row[csf("yarn_comp_percent2nd")].' %, '.$yarn_type[$row[csf("yarn_type")]];
                        }

                        ?>
                        <? if($wo_basis_id!=1){ ?><td><p><? echo $buyer_job_arr[$row[csf("po_breakdown_id")]]["po_number"]; ?>&nbsp;</p></td><? }?>
                        <td><p><? echo $buy_job_sty_val; ?>&nbsp;</p></td>
                        <td align="center"><p><? echo $color_arr[$row[csf("color_name")]]; ?></p></td>
                        <td align="center"><p><? echo $count_arr[$row[csf("yarn_count")]]; ?></p></td>
                        <td align="center"><p><? echo $feb_des; ?></p></td>
                        <td align="center"><p><? echo $unit_of_measurement[$row[csf("uom")]]; ?></p></td>
                        <td align="right"><p><? echo number_format($row[csf("supplier_order_quantity")],2); ?></p></td>
                        <td align="right"><p><? echo number_format($row[csf("rate")],4,".",""); ?></p></td>
                        <td align="right"><p><? echo number_format($row[csf("amount")],2,".",""); $carrency_id=$row[csf('currency_id')]; if($carrency_id==1){$paysa_sent="Paisa";} else if($carrency_id==2){$paysa_sent="CENTS";}  ?></p></td>
                    </tr>
                    <? $i++;
                } ?>
                </tbody>
                <tfoot>
                <th colspan="<? echo ($wo_basis_id==1)?6:7;?>" align="right">Total </th>
                <th align="right"><? echo number_format($order_quantity,0); ?></th>
                <th>&nbsp;</th>
                <th align="right"><? echo $word_amount=number_format($amount,2,".",""); ?></th>
                </tfoot>
            </table>
            <table width="900" align="center">
                <tr>
                    <td colspan="11">&nbsp;  </td>
                </tr>
                <tr>
                    <td colspan="11"> Amount in words:<? echo number_to_words($word_amount,$currency[$carrency_id],$paysa_sent); ?> </td>
                </tr>
                <tr>
                    <td colspan="11">&nbsp;   </td>
                </tr>
                <tr>
                    <td colspan="11">&nbsp;   </td>
                </tr>
            </table>
            <br>
            <h2>Summery</h2>
            <br>
            <table  width="900" class="rpt_table" border="1" cellpadding="0" cellspacing="0" align="center" rules="all">
                <thead>
                <tr>
                    <th width="3%">Sl</th>
                    <th width="25%">Composition</th>
                    <th width="27%">Color</th>
                    <th width="15%">Yarn type</th>
                    <th width="15%">Count</th>
                    <th>Yarn Qty</th>
                </tr>
                </thead>
                <tbody>

                <?php
                $i = 1;
                $sql_summary= "Select a.yarn_count, a.yarn_comp_type1st, a.color_name,a.yarn_type, sum(a.supplier_order_quantity) as yarn_group_total from  wo_non_order_info_dtls a where a.mst_id='$data[1]' and a.status_active=1 and a.is_deleted=0 group by a.yarn_count, a.yarn_comp_type1st,a.color_name,a.yarn_type";
                //echo $sql_dtls;//die;
                $sql_result_summary = sql_select($sql_summary);
                $tot_qnty = 0;
                foreach ($sql_result_summary as $row) {
                    ?>
                    <tr>
                        <td align="center"><? echo $i++; ?></td>
                        <td align="center" ><p><? echo $composition[$row[csf("yarn_comp_type1st")]]; ?></p></td>
                        <td align="center" ><p><? echo $color_arr[$row[csf("color_name")]]; ?></p></td>
                        <td align="center" ><? echo $yarn_type[$row[csf("yarn_type")]]; ?></td>
                        <td align="center"><p><? echo $count_arr[$row[csf("yarn_count")]]; ?>&nbsp;</p></td>
                        <td align="center"><p><? echo number_format($row[csf("yarn_group_total")],2); $tot_qnty+=$row[csf("yarn_group_total")]; ?>&nbsp;</p></td>
                    </tr>
                    <?php
                }
                ?>

                </tbody>
                <tfoot>
                <tr>
                    <th colspan="5" align="center">Total</th>
                    <th align="center"><? echo number_format($tot_qnty,0); ?></th>
                </tr>
                </tfoot>
            </table>





            <?

            $approved_sql=sql_select("SELECT  mst_id, approved_by ,min(approved_date) as approved_date  from approval_history where entry_form=2 AND  mst_id ='$data[1]'  group by mst_id, approved_by order by  approved_by");
            $approved_his_sql=sql_select("SELECT  mst_id, approved_by ,approved_date,un_approved_reason,un_approved_date,approved_no  from approval_history where entry_form=2 AND  mst_id ='$data[1]' order by  approved_no,approved_date");
            $user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
            $user_lib_desg=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
            $designation_lib=return_library_array("SELECT id,custom_designation from lib_designation", "id", "custom_designation");

            ?>
            <? if(count($approved_sql)>0)
            {
                $sl=1;
                ?>
                <div style="margin-top:15px">
                    <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                        <label><b>Yarn Work Order Approval Status </b></label>
                        <thead>
                        <tr style="font-weight:bold">
                            <th width="20">SL</th>
                            <th width="250">Name</th>
                            <th width="200">Designation</th>
                            <th width="100">Approval Date</th>
                        </tr>
                        </thead>
                        <? foreach ($approved_sql as $key => $value)
                        {
                            ?>
                            <tr>
                                <td width="20"><? echo $sl; ?></td>
                                <td width="250"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                <td width="200"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                <td width="100"><? $approved_date=explode(" ",$value[csf("approved_date")]);

                                    echo change_date_format($approved_date[0])." ".$approved_date[1];  ?></td>
                            </tr>
                            <?
                            $sl++;
                        }
                        ?>
                    </table>
                </div>
                <?
            }
            else{
                echo "<div style='text-align:center;font-size:xx-large; font-style:italic; margin-top:20px; color:#FF0000;'>".$draft."</div>";
            }
            ?>
            <? if(count($approved_his_sql) > 0)
            {
                $sl=1;
                ?>
                <div style="margin-top:15px">
                    <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                        <label><b>Yarn Work Order Approval / Un-Approval History </b></label>
                        <thead>
                        <tr style="font-weight:bold">
                            <th width="20">SL</th>
                            <th width="150">Approved / Un-Approved</th>
                            <th width="150">Designation</th>
                            <th width="50">Approval Status</th>
                            <th width="150">Reason for Un-Approval</th>
                            <th width="150">Date</th>
                        </tr>
                        </thead>
                        <? foreach ($approved_his_sql as $key => $value)
                        {
                            if($sl%2==0)$bgcolor="#E9F3FF";  else $bgcolor="#FFFFFF";
                            ?>
                            <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                <td width="20"><? echo $sl; ?></td>
                                <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                <td width="50">Yes</td>
                                <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                <td width="150"><? $approved_date=explode(" ",$value[csf("approved_date")]);

                                    echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                            </tr>

                            <?
                            $sl++;
                            $un_approved_date= explode(" ",$value[csf('un_approved_date')]);
                            $un_approved_date=$un_approved_date[0];
                            if($db_type==0) //Mysql
                            {
                                if($un_approved_date=="" || $un_approved_date=="0000-00-00") $un_approved_date="";else $un_approved_date=$un_approved_date;
                            }
                            else
                            {
                                if($un_approved_date=="") $un_approved_date="";else $un_approved_date=$un_approved_date;
                            }

                            if($un_approved_date!="")
                            {
                                ?>
                                <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $sl; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $sl; ?>">
                                    <td width="20"><? echo $sl; ?></td>
                                    <td width="150"><? echo $user_lib_name[$value[csf("approved_by")]]; ?></td>
                                    <td width="150"><? echo $designation_lib[$user_lib_desg[$value[csf("approved_by")]]]; ?></td>
                                    <td width="50">No</td>
                                    <td width="150"><? echo $value[csf("un_approved_reason")] ?></td>
                                    <td width="150"><? $approved_date=explode(" ",$value[csf("un_approved_date")]);

                                        echo change_date_format($approved_date[0])." ".$approved_date[1]; ?></td>
                                </tr>

                                <?
                                $sl++;

                            }

                        }
                        ?>
                    </table>
                </div>
                <?
            }
            ?>

            <!-- //approved status end-->
            <br/>
            <br>

            <?

            echo get_spacial_instruction($work_order_no,"900px",144);
            echo signature_table(42, $data[0], "900px");
            ?>
        </div>
        ?>


        <? if($data[6] == 6){ ?>
        <script type="text/javascript" src="../../../js/jquery.js"></script>
        <script type="text/javascript" src="../../../js/jquerybarcode.js"></script>
    <? }else{ ?>
        <script type="text/javascript" src="../../js/jquery.js"></script>
        <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
    <? } ?>
        <script>
            fnc_generate_Barcode('<? echo $varcode_booking_no; ?>','barcode_img_id');
        </script>
        <?
        exit();
    }
    else{}
}

if($action=="show_print_booking_report")
{

    $getFb = sql_select("select  a.id, a.ydw_no, a.company_id, a.supplier_id, a.pay_mode from wo_yarn_dyeing_mst a where a.id=$data");
    if(count($getFb) > 0){
        $data = $getFb[0][csf("ydw_no")]."*".$getFb[0][csf("company_id")]."*".$getFb[0][csf("id")]."*".$getFb[0][csf("supplier_id")]."*".$getFb[0][csf("pay_mode")];
    }else{
        die();
    }
    $data = explode('*', $data);

    $cbo_company_name=str_replace("'","",$data[1]);
    $txt_booking_no = "'".$data[0]."'";
    $update_id = "'".$data[2]."'";
    $cbo_supplier_name = "'".$data[3]."'";
    $cbo_pay_mode = "'".$data[4]."'";
    $form_name = "Yarn Dyeing Work Order";

    $company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name"  );
    $supplier_name=return_library_array("select id,supplier_name from  lib_supplier", "id", "supplier_name");
    $pay_mode = str_replace("'","",$cbo_pay_mode);
    $new_supplier_name = str_replace("'","",$cbo_supplier_name);

    $buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
    $brand_arr=return_library_array( "select id,brand_name from  lib_brand",'id','brand_name');
    $job_quantity_arr=return_library_array( "select job_no,job_quantity from wo_po_details_master",'job_no','job_quantity');
    //$po_qnty_tot=return_field_value( "sum(plan_cut)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
    //echo $show_comment;

    $nameArray=sql_select( "select a.id, a.ydw_no,a.booking_date,a.supplier_id,a.pay_mode,a.attention,a.delivery_date,a.delivery_date_end,a.dy_delivery_date_start,a.dy_delivery_date_end,a.currency,a.ecchange_rate, a.is_short from wo_yarn_dyeing_mst a where a.id=$update_id");
    foreach ($nameArray as $result)
    {
        $work_order=$result[csf('ydw_no')];
        $supplier_id=$result[csf('supplier_id')];
        $booking_date=$result[csf('booking_date')];
        $attention=$result[csf('attention')];
        $delivery_date=$result[csf('delivery_date')];
        $delivery_date_end=$result[csf('delivery_date_end')];
        $dy_delivery_start=$result[csf('dy_delivery_date_start')];
        $dy_delivery_end=$result[csf('dy_delivery_date_end')];
        $currency_id=$result[csf('currency')];
        $pay_mode_id=$result[csf('pay_mode')];
        $exchange_rate=$result[csf('ecchange_rate')];
        $is_short=$result[csf('is_short')];
    }

    $varcode_work_order_no=$work_order;


    ?>
    <div style="width:1000px" align="center">
        <table width="100%" cellpadding="0" cellspacing="0" border="0" align="center">
            <tr>
                <td width="700">
                    <table width="100%" cellpadding="0" cellspacing="0" >
                        <tr>
                            <td align="center" style="font-size:20px;">
                                <?php
                                echo $company_library[$cbo_company_name];
                                ?>
                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:14px">
                                <?
                                $nameArray=sql_select( "select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                                foreach ($nameArray as $result)
                                {
                                    ?>

                                    Email Address: <? echo $result[csf('email')];?>
                                    Website No: <? echo $result[csf('website')];
                                }

                                ?>
                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:20px">
                                <strong>Yarn Dyeing Work Order <? if($is_short==1) echo " (Short) "; ?> </strong>
                            </td>
                        </tr>
                    </table>
                </td>
                <td width="250" id="barcode_img_id">

                </td>
            </tr>
        </table>
        <?
        //echo "select a.id, a.ydw_no,a.booking_date,a.supplier_id,a.attention  from wo_yarn_dyeing_mst a where a.id=$update_id";die;


        ?>
        <table width="950" style="" align="center">
            <tr>
                <td width="350"  style="font-size:12px">
                    <table width="350" style="" align="left">
                        <tr  >
                            <td   width="120"><b>To</b>   </td>
                            <td width="230">:&nbsp;&nbsp;<?
                                if($pay_mode==3 || $pay_mode==5)
                                {
                                    echo $company_library[$new_supplier_name];
                                }
                                else
                                {
                                    echo $supplier_name[$new_supplier_name];
                                }
                                // if($pay_mode_id==5 || $pay_mode_id==3){
                                // 	echo $company_library[$supplier_id];
                                // }
                                // else{
                                // 	echo $supplier_name_arr[$supplier_id];
                                // }
                                ?></td>
                        </tr>

                        <tr>
                            <td  ><b>Wo No.</b>   </td>
                            <td  >:&nbsp;&nbsp;<? echo $work_order;?>    </td>
                        </tr>

                        <tr>
                            <td style="font-size:12px"><b>Attention</b></td>
                            <td >:&nbsp;&nbsp;<? echo $attention; ?></td>
                        </tr>

                        <tr>
                            <td style="font-size:12px"><b>Booking Date</b></td>
                            <td >:&nbsp;&nbsp;<? if($booking_date!="0000-00-00" || $booking_date!="") echo change_date_format($booking_date); else echo ""; ?></td>
                        </tr>
                        <tr>
                            <td style="font-size:12px"><b>Currency</b></td>
                            <td >:&nbsp;&nbsp;<? echo $currency[$currency_id]; ?></td>
                        </tr>
                    </table>
                </td>
                <td width="350"  style="font-size:12px">
                    <table width="350" style="" align="left">
                        <tr>
                            <td  width="120"><b>G/Y Issue Start</b>   </td>
                            <td width="230" >:&nbsp;&nbsp;<? if($delivery_date!="0000-00-00" || $delivery_date!="") echo change_date_format($delivery_date); else echo "";?>    </td>
                        </tr>
                        <tr>
                            <td style="font-size:12px"><b>G/Y Issue End</b></td>
                            <td >:&nbsp;&nbsp;<? if($delivery_date_end!="0000-00-00" || $delivery_date_end!="") echo change_date_format($delivery_date_end);  else echo ""; ?></td>
                        </tr>
                        <tr>
                            <td style="font-size:12px"><b>D/Y Delivery Start </b></td>
                            <td >:&nbsp;&nbsp;<? if($dy_delivery_start!="0000-00-00" || $dy_delivery_start!="") echo change_date_format($dy_delivery_start); else echo ""; ?></td>
                        </tr>
                        <tr>
                            <td style="font-size:12px"><b>D/Y Delivery End</b></td>
                            <td >:&nbsp;&nbsp;<? if($dy_delivery_end!="0000-00-00" || $dy_delivery_end!="") echo change_date_format($dy_delivery_end); else echo "";?></td>
                        </tr>
                    </table>
                </td>
                <td width="250"  style="font-size:12px">
                    <?
                    $image_location=return_field_value("image_location","common_photo_library","master_tble_id='$update_id' and form_name='$form_name'","image_location");
                    ?>
                    <img src="<? echo '../../'.$image_location; ?>" width="120" height="100" border="2" />
                </td>
            </tr>
        </table>
        </br>

        <?
        /*$multi_job_arr=array();
      $style_no=sql_select("select a.style_ref_no,a.job_no,b.pub_shipment_date,a.buyer_name,b.po_number,b.po_quantity from wo_po_details_master a,wo_po_break_down b where a.job_no=b.job_no_mst and  b.status_active=1 and b.is_deleted=0");

      foreach($style_no as $row_s)
      {
          $multi_job_arr[$row_s[csf('job_no')]]['style_ref_no']=$row_s[csf('style_ref_no')];
          $multi_job_arr[$row_s[csf('job_no')]]['buyer']=$row_s[csf('buyer_name')];
          $multi_job_arr[$row_s[csf('job_no')]]['po_no'].=$row_s[csf('po_number')].",";
          $multi_job_arr[$row_s[csf('job_no')]]['ship'].=$row_s[csf('pub_shipment_date')].",";
          $multi_job_arr[$row_s[csf('job_no')]]['po_quantity']+=$row_s[csf('po_quantity')];

      }
    $sql="select a.id, a.ydw_no,b.job_no,b.yarn_color,b.id as dtls_id
    from
            wo_yarn_dyeing_mst a, wo_yarn_dyeing_dtls b
    where
            a.status_active=1 and a.is_deleted=0 and b.status_active=1 and a.id=b.mst_id and a.id=$update_id";
            //echo $sql;
    $sql_result=sql_select($sql);$total_qty=0;$total_amount=0;$i=1;$buyer=0;$order_no="";$tot_job_no="";$total_buyer="";$total_order_no="";$total_dtls_id=0;$style_all="";
    $total_order_qty=0;
    foreach($sql_result as $row)
    {
    if($total_dtls_id==0) $total_dtls_id=$row[csf("dtls_id")]; else $total_dtls_id=$total_dtls_id.",".$row[csf("dtls_id")];

    if($tot_job_no=="") $tot_job_no=$row[csf("job_no")]; else $tot_job_no=$tot_job_no.",".$row[csf("job_no")];
    if($style_all=="") $style_all=$multi_job_arr[$row[csf('job_no')]]['style_ref_no']; else $style_all=$style_all.",".$multi_job_arr[$row[csf('job_no')]]['style_ref_no'];
    $bayer=$multi_job_arr[$row[csf('job_no')]]['buyer'];
    if($total_buyer=="") $total_buyer=$bayer; else $total_buyer=$total_buyer.",".$bayer;
    $order_no=$multi_job_arr[$row[csf('job_no')]]['po_no'];
    if($total_order_no=="") $total_order_no=$order_no; else $total_order_no=$total_order_no.",".$order_no;


    }
    $total_order_no=substr($total_order_no,0,-1);
    //var_dump($total_dtls_id);
    //die;*/

        $style_no="select a.style_ref_no, a.job_no, a.buyer_name, b.id as po_id,b.po_number, b.file_no, b.grouping as inter_ref_no, b.po_quantity, p.id as dtls_id
		from wo_yarn_dyeing_dtls p, wo_po_details_master a, wo_po_break_down b
		where p.job_no_id=a.id and a.job_no=b.job_no_mst and p.mst_id=$update_id and  p.status_active=1 and p.is_deleted=0";
        $sql_result=sql_select($style_no);
        $style_all=$total_dtls_id=$tot_job_no=$total_buyer=$total_order_no=$all_file=$all_inter_ref="";//$total_order_qty=0;
        $po_ids='';
        foreach($sql_result as $row)
        {
            $total_dtls_id.=$row[csf("dtls_id")].",";
            $style_all.=$row[csf("style_ref_no")].",";
            $tot_job_no.=$row[csf("job_no")].",";
            $total_buyer.=$row[csf("buyer_name")].",";
            $total_order_no.=$row[csf("po_number")].",";
            $all_file.=$row[csf("file_no")].",";
            $all_inter_ref.=$row[csf("inter_ref_no")].",";
            //$total_order_qty+=$row[csf("po_quantity")];
            if($po_ids=='') $po_ids=$row[csf("po_id")];else $po_ids.=",".$row[csf("po_id")];
        }
        $total_dtls_id=chop($total_dtls_id," , ");$style_all=chop($style_all," , ");$tot_job_no=chop($tot_job_no," , ");$total_buyer=chop($total_buyer," , ");$total_order_no=chop($total_order_no," , ");$all_file=chop($all_file," , ");$all_inter_ref=chop($all_inter_ref," , ");

        $fab_wo_no_arr=array();
        $fabric_booking=sql_select("select a.booking_no,a.job_no from wo_booking_dtls a,wo_po_break_down b where a.po_break_down_id=b.id and a.booking_type=1 and  a.status_active=1 and a.is_deleted=0 and  b.status_active=1 and b.is_deleted=0 and  b.id in($po_ids) group by a.booking_no,a.job_no");
        $booking_nos='';
        foreach($fabric_booking as $row)
        {
            if($booking_nos=='') $booking_nos=$row[csf('booking_no')];else $booking_nos.=",".$row[csf('booking_no')];
        }
        $style_po="select a.job_no, sum(distinct b.po_quantity) as po_quantity
		from wo_yarn_dyeing_dtls p, wo_po_details_master a, wo_po_break_down b
		where p.job_no_id=a.id and a.job_no=b.job_no_mst and p.mst_id=$update_id and  p.status_active=1 and p.is_deleted=0 group by a.job_no";
        $sql_po=sql_select($style_po);
        $total_order_qty=0;
        foreach($sql_po as $row)
        {
            $total_order_qty+=$row[csf('po_quantity')];
        }

        ?>

        <table width="350" align="left" style="margin-left: 25px;">

            <tr  style="font-size:12px">
                <td  width="120"><b>Job No </b></td>
                <td width="230">:&nbsp;&nbsp;
                    <?
                    $all_job_arr=array_unique(explode(",",$tot_job_no));
                    $all_job="";
                    foreach($all_job_arr as $row)
                    {
                        $all_job.=$row.",";
                    }
                    $all_job=chop($all_job," , ");
                    echo $all_job;
                    ?>
                </td>
            </tr>

            <tr style="font-size:12px">
                <td  width="120"><b>Order No</b></td>
                <td  width="230">:&nbsp;&nbsp;
                    <?
                    $all_order_arr=array_unique(explode(",",$total_order_no));
                    $all_order="";
                    foreach($all_order_arr as $row)
                    {
                        $all_order.=$row.",";
                    }
                    $all_order=chop($all_order," , ");
                    echo $all_order;
                    ?>
                </td>
            </tr>

            <tr style="font-size:12px">
                <td width="120"><b>Order Qty.</b></td>
                <td  width="230">:&nbsp;&nbsp;
                    <?
                    echo $total_order_qty;

                    ?>
                </td>
            </tr>
            <tr style="font-size:12px">
                <td width="120"><b>Fabric Booking No.</b></td>
                <td  width="230">:&nbsp;&nbsp;;
                    <?
                    echo $booking_nos;
                    ?>
                </td>
            </tr>
        </table>


        <table width="1000"  align="center" border="1"  cellpadding="0" cellspacing="0" rules="all" class="rpt_table">
            <thead>
            <tr>
                <th width="30" align="center">Sl</th>
                <th width="70" align="center">Color</th>
                <th width="80" align="center">Color Range</th>
                <th  align="center" width="50">Ref No.</th>
                <th width="60" align="center">File No</th>
                <th width="60" align="center">Internal Ref. No</th>
                <th width="30" align="center">Yarn Count</th>
                <th width="160" align="center">Yarn Description</th>
                <th width="50" align="center">Brand</th>
                <th width="50" align="center">Lot</th>
                <th width="50" align="center">UOM</th>
                <th width="60" align="center">WO Qty</th>
                <th width="50" align="center">Dyeing Rate</th>
                <th width="70" align="center">Amount</th>
                <th  align="center" width="50" >Min Req. Cone</th>
                <th  align="center" >Remarks/ Shade</th>
            </tr>
            </thead>
            <?
            $sql_color="select id,product_id,job_no,job_no_id,yarn_color,yarn_description,count,color_range,yarn_wo_qty as yarn_wo_qty,dyeing_charge,amount as amount,min_require_cone,referance_no, remarks, file_no, internal_ref_no
			from
			wo_yarn_dyeing_dtls
			where
			status_active=1 and id in($total_dtls_id)";
            //echo $sql_color;die;
            $sql_result=sql_select($sql_color);$total_qty=0;$total_amount=0;$i=1;$buyer=0;$order_no="";$job_strip_color=array();
            foreach($sql_result as $row)
            {
                $product_id=$row[csf("product_id")];
                //var_dump($product_id);
                $job_strip_color[$row[csf("job_no")]].=$row[csf("yarn_color")].",";
                $all_stripe_color.=$row[csf("yarn_color")].",";
                if($product_id)
                {
                    $sql_brand=sql_select("select lot,brand from product_details_master where id in($product_id)");
                    foreach($sql_brand as $row_barand)
                    {
                        $lot_amt=$row_barand[csf("lot")];
                        $brand=$row_barand[csf("brand")];
                    }
                }

                //$yarn_count_des=explode(" ",$row[csf("yarn_description")]);

                if ($i%2==0)
                    $bgcolor="#E9F3FF";
                else
                    $bgcolor="#FFFFFF";


                ?>
                <tr bgcolor="<? echo $bgcolor; ?>">
                    <td align="center"><p><? echo $i; ?></p></td>
                    <td><p><? echo $color_arr[$row[csf("yarn_color")]]; ?></p></td>
                    <td><p><? echo $color_range[$row[csf("color_range")]]; ?></p></td>
                    <td align="center"><p><? echo $row[csf("referance_no")]; ?></p></td>
                    <td><p><? echo $row[csf("file_no")]; ?></p></td>
                    <td><p><? echo $row[csf("internal_ref_no")]; ?></p></td>
                    <td align="center"><p><? echo $count_arr[$row[csf("count")]]; //$count_arr[$row[csf("count")]]; ?></p></td>
                    <td><p> <?  echo $row[csf("yarn_description")]; ?></p></td>
                    <td><p><? echo $brand_arr[$brand]; ?></p></td>
                    <td align="center"><p><? echo $lot_amt; ?></p></td>
                    <td align="center"><p><? echo "KG"; ?></p></td>
                    <td align="right"><? echo $row[csf("yarn_wo_qty")]; $total_qty+=$row[csf("yarn_wo_qty")]; ?>&nbsp;</td>
                    <td align="right"><? echo $row[csf("dyeing_charge")]; ?>&nbsp;</td>
                    <td align="right"><? echo number_format($row[csf("amount")],2);  $total_amount+=$row[csf("amount")];?></td>
                    <td align="center"><p><? echo $row[csf("min_require_cone")]; ?></p></td>
                    <td align="center"><p><? echo $row[csf("remarks")]; ?></p></td>
                </tr>
                <?
                $i++;
                $yarn_count_des="";
                $style_no="";
            }
            ?>
            <tr>
                <td colspan="11" align="right"><strong>Total:</strong>&nbsp;&nbsp;</td>
                <td align="right" ><b><? echo $total_qty; ?></b></td>
                <td align="right">&nbsp;</td>
                <td align="right"><b><? echo number_format($total_amount,2); ?></b></td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
            </tr>
            <?
            $mcurrency="";
            $dcurrency="";
            if($currency_id==1)
            {
                $mcurrency='Taka';
                $dcurrency='Paisa';
            }
            if($currency_id==2)
            {
                $mcurrency='USD';
                $dcurrency='CENTS';
            }
            if($currency_id==3)
            {
                $mcurrency='EURO';
                $dcurrency='CENTS';
            }
            ?>
            <tr>
                <td colspan="16" align="center">Total Dyeing Amount (in word): &nbsp;<?  echo number_to_words(def_number_format($total_amount,2,""),$mcurrency, $dcurrency);?> </td>
            </tr>
        </table>

        <?  echo get_spacial_instruction($txt_booking_no);?>

        <br> <br>
        <?
        if($show_comment==1)
        {
            $job_cond_arr=array_unique(explode(",",$tot_job_no));
            foreach($job_cond_arr as $job_no_st)
            {
                $job_cond_string.="'".$job_no_st."',";
            }
            $job_cond_string=chop($job_cond_string,",");
            //echo $job_cond_string.jahid;die;
            $condition= new condition();
            if(str_replace("'","",$job_cond_string) !=''){
                $condition->job_no(" in($job_cond_string)");
            }
            $condition->init();
            $conversion= new conversion($condition);
            $conversion_costing_arr_process=$conversion->getAmountArray_by_jobAndProcess();
            //echo $conversion->getQuery();die;
            //print_r($conversion_costing_arr_process);
            //echo "jahid";die;
            //getAmountArray_by_jobAndProcess
            ?>
            <table cellspacing="0" cellpadding="0" border="1" rules="all" width="1000" class="rpt_table" >
                <thead>
                <tr>
                    <th colspan="9" align="center"><b> Comments</b> </th>
                </tr>
                <tr>
                    <th width="30">SL</th>
                    <th width="120">Job No</th>
                    <th width="180">PO No</th>
                    <th width="150">Ship Date</th>
                    <th width="80">Pre-Cost Value</th>
                    <th width="80">WO Value</th>
                    <th width="80">Short WO Value</th>
                    <th width="80">Balance</th>
                    <th>Comments </th>
                </tr>
                </thead>
                <tbody>
                <?
                $all_stripe_color=implode(",",array_unique(explode(",",chop($all_stripe_color,","))));

                //print_r($job_strip_color);
                if($db_type==0)
                {
                    $job_po_sql=sql_select("select job_no_mst, group_concat(po_number) as po_number, group_concat(shipment_date) as shipment_date from wo_po_break_down where job_no_mst in('".implode($job_cond_arr,"','")."') and status_active=1 and is_deleted=0 group by job_no_mst");
                }
                else
                {
                    $job_po_sql=sql_select("select job_no_mst, listagg(cast(po_number as varchar(4000)),',') within group(order by po_number) as po_number, listagg(cast(shipment_date as varchar(4000)),',') within group(order by shipment_date) as shipment_date from wo_po_break_down where job_no_mst in('".implode($job_cond_arr,"','")."') and status_active=1 and is_deleted=0 group by job_no_mst");
                }
                $job_po_data=array();
                foreach($job_po_sql as $row)
                {
                    $job_po_data[$row[csf("job_no_mst")]]["po_number"]=$row[csf("po_number")];
                    $job_po_data[$row[csf("job_no_mst")]]["shipment_date"]=$row[csf("shipment_date")];
                }

                /*$sql_stripe_required=sql_select("select job_no, stripe_color, sum(fabreqtotkg) as fabreqtotkg from wo_pre_stripe_color where job_no in('".implode($job_cond_arr,"','")."') and status_active=1 and is_deleted=0 group by job_no, stripe_color");
                 $strip_req_data=array();
                 foreach($sql_stripe_required as $row)
                 {
                     $strip_req_data[$row[csf("job_no")]][$row[csf("stripe_color")]]=$row[csf("fabreqtotkg")];
                 }
                 $sql_strip_rate=sql_select("select job_no, color_break_down from wo_pre_cost_fab_conv_cost_dtls where job_no in('".implode($job_cond_arr,"','")."') and status_active=1 and is_deleted=0 and cons_process=30");
                 $strip_req_rate=array();
                 foreach($sql_strip_rate as $row)
                 {
                     $color_data=explode("__",$row[csf("color_break_down")]);
                     foreach($color_data as $color_rate)
                     {
                         $color_rate_ref=explode("_",$color_rate);
                         if($color_rate_ref[1]>0)
                         {
                             $strip_req_rate[$row[csf("job_no")]][$color_rate_ref[0]]=$color_rate_ref[1]*1;
                         }

                     }
                 }

                 //var_dump($strip_req_rate);

                 $job_wise_badge_val=array();
                 foreach($job_strip_color as $job_no=>$strip_color)
                 {
                     $strip_color_arr=array_unique(explode(",",chop($strip_color,",")));
                     foreach($strip_color_arr as $strip_color_id)
                     {
                         $job_wise_badge_val[$job_no]+=$strip_req_data[$job_no][$strip_color_id]*$strip_req_rate[$job_no][$strip_color_id];
                     }
                 }*/
                //var_dump($job_wise_badge_val);die;
                $total_dtls_id=implode(",",array_unique(explode(",",$total_dtls_id)));
                $prev_wo_data=sql_select("select b.job_no_id, b.yarn_color,
            	sum(case when a.is_short<>1 then b.amount else 0 end) as amount,
            	sum(case when a.is_short=1 then b.amount else 0 end) as short_amount
            	from wo_yarn_dyeing_mst a, wo_yarn_dyeing_dtls b where a.id=b.mst_id and a.entry_form=41 and b.status_active=1 and b.is_deleted=0 and b.job_no in('".implode($job_cond_arr,"','")."') and b.id not in($total_dtls_id) group by b.job_no_id, b.yarn_color");
                foreach($prev_wo_data as $row)
                {
                    /*$prev_job_entry[$row[csf("job_no_id")]][$row[csf("yarn_color")]]+=$row[csf("amount")];
                    $prev_job_short_entry[$row[csf("job_no_id")]][$row[csf("yarn_color")]]+=$row[csf("short_amount")];*/

                    $prev_job_entry[$row[csf("job_no_id")]]+=$row[csf("amount")];
                    $prev_job_short_entry[$row[csf("job_no_id")]]+=$row[csf("short_amount")];
                }
                //$prev_job_entry=return_library_array( "select b.job_no_id, sum(b.amount) as job_amt from wo_yarn_dyeing_mst a, wo_yarn_dyeing_dtls b where a.id=b.mst_id and a.entry_form=41 and b.status_active=1 and b.is_deleted=0 and b.job_no in('".implode($job_cond_arr,"','")."') and b.id not in($total_dtls_id) and b.yarn_color in($all_stripe_color)  group by b.job_no_id", "job_no_id", "job_amt");//
                if($db_type==0)
                {
                    $yarn_data="select b.job_no_id, max(a.currency) as currency, b.job_no,
				sum(case when a.is_short<>1 then b.amount else 0 end) as amount,
				sum(case when a.is_short=1 then b.amount else 0 end) as short_amount, group_concat(b.yarn_color) as yarn_color
				from wo_yarn_dyeing_dtls b, wo_yarn_dyeing_mst a
				where a.id=b.mst_id and b.id in($total_dtls_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0
				group by b.job_no_id, b.job_no";
                }
                else
                {
                    $yarn_data="select b.job_no_id, max(a.currency) as currency, b.job_no,
				sum(case when a.is_short<>1 then b.amount else 0 end) as amount,
				sum(case when a.is_short=1 then b.amount else 0 end) as short_amount,
				listagg( cast(b.yarn_color as varchar(4000)),',') within group (order by b.yarn_color) as yarn_color
				from wo_yarn_dyeing_dtls b, wo_yarn_dyeing_mst a
				where a.id=b.mst_id and b.id in($total_dtls_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0
				group by b.job_no_id, b.job_no";
                }


                //echo $yarn_data."<br>";

                $nameArray=sql_select( $yarn_data );
                foreach ($nameArray as $selectResult)
                {
                    //$prev_qnty=0;
                    $prev_qnty=$prev_job_entry[$selectResult[csf("job_no_id")]];
                    $prev_short_qnty=$prev_job_short_entry[$selectResult[csf("job_no_id")]];
                    /*$strip_color_arr=array_unique(explode(",",$selectResult[csf("yarn_color")]));
                    foreach($strip_color_arr as $strip_id)
                    {
                        $prev_qnty+=$prev_job_entry[$selectResult[csf("job_no_id")]][$strip_id];
                        $prev_short_qnty+=$prev_job_short_entry[$selectResult[csf("job_no_id")]][$strip_id];

                    }*/

                    if($selectResult[csf("currency")]==2)
                    {
                        $tot_yarn_dyeing=$selectResult[csf("amount")]+$prev_qnty;
                        $tot_yarn_dyeing_short=$selectResult[csf("short_amount")]+$prev_short_qnty;
                    }
                    else
                    {
                        $current_date=date("Y-m-d");
                        $currency_rate=set_conversion_rate(2, $current_date );
                        $tot_yarn_dyeing=$selectResult[csf("amount")]+$prev_qnty;
                        $tot_yarn_dyeing=$tot_yarn_dyeing/$currency_rate;

                        $tot_yarn_dyeing_short=$selectResult[csf("short_amount")]+$prev_short_qnty;
                        $tot_yarn_dyeing_short=$tot_yarn_dyeing_short/$currency_rate;
                    }
                    //echo $convamount;
                    $po_no=$job_po_data[$selectResult[csf('job_no')]]['po_number'];
                    $shipment_date=array_unique(explode(",",$job_po_data[$selectResult[csf('job_no')]]['shipment_date']));
                    $ship_date="";
                    foreach ($shipment_date as $date_row)
                    {
                        if($ship_date=='') $ship_date=change_date_format($date_row); else $ship_date.=",".change_date_format($date_row);
                    }
                    $pre_cost_yarn_deying=$conversion_costing_arr_process[$selectResult[csf('job_no')]][30];
                    //$job_wise_badge_val[$selectResult[csf('job_no')]];
                    ?>
                    <tr>
                        <td align="center"><? echo $i;?></td>
                        <td><p><? echo $selectResult[csf('job_no')];?> &nbsp;</p></td>
                        <td><p><? echo $po_no;?>&nbsp;</p></td>
                        <td><p><? echo $ship_date;?>&nbsp;</p></td>
                        <td align="right"><? echo number_format($pre_cost_yarn_deying,2); ?></td>
                        <td align="right"><? echo number_format($tot_yarn_dyeing,2); ?> </td>
                        <td align="right"><? echo number_format($tot_yarn_dyeing_short,2); ?> </td>
                        <td align="right"><? $tot_balance=$pre_cost_yarn_deying-$tot_yarn_dyeing; echo number_format($tot_balance,2); ?></td>
                        <td>
                            <?
                            if( $pre_cost_yarn_deying>$tot_yarn_dyeing)
                            {
                                echo "Less Booking";
                            }
                            else if ($pre_cost_yarn_deying<$tot_yarn_dyeing)
                            {
                                echo "Over Booking";
                            }
                            else if ($pre_cost_yarn_deying==$tot_yarn_dyeing)
                            {
                                echo "As Per";
                            }
                            else
                            {
                                echo "&nbsp;";
                            }
                            ?>
                        </td>
                    </tr>
                    <?
                    $tot_pre_yarn_dyeing+=$pre_cost_yarn_deying;
                    $total_yarn_dyeing+=$tot_yarn_dyeing;
                    $total_yarn_dyeing_short+=$tot_yarn_dyeing_short;
                    $tot_balance_yarn_dyeing+=$tot_balance;
                    $i++;
                }
                ?>
                </tbody>
                <tfoot>
                <tr>
                    <th colspan="4" align="right">  <b>Total</b></th>
                    <th align="right"><? echo number_format($tot_pre_yarn_dyeing,2); ?></th>
                    <th align="right"><? echo number_format($total_yarn_dyeing,2); ?></th>
                    <th align="right"><? echo number_format($total_yarn_dyeing_short,2); ?></th>
                    <th align="right"><? echo number_format($tot_balance_yarn_dyeing,2); ?></th>
                    <th></th>
                </tr>
                </tfoot>
            </table>
            <?
        }
        ?>
    </div>
    <div>
        <?

        $lib_designation_arr=return_library_array(" select id,custom_designation from lib_designation","id","custom_designation");
        $user_lib_designation_arr=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
        $user_lib_name_arr=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");

        $mst_id=return_field_value("id as mst_id","wo_yarn_dyeing_mst","id=$wo_ord_id","mst_id");
        //echo $mst_id.'ssD';
        //and b.un_approved_date is null
        $approve_data_array=sql_select("select b.approved_by,min(b.approved_date) as approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=30  group by  b.approved_by order by b.approved_by asc");

        $unapprove_data_array=sql_select("select b.id,b.approved_by,b.approved_date,b.un_approved_reason,b.un_approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=30  order by b.approved_date,b.approved_by");

        if(count($approve_data_array)>0)
        {
            ?>
            <table  width="850" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
                <thead>
                <tr style="border:1px solid black;">
                    <th colspan="5" style="border:1px solid black;">Approval Status</th>
                </tr>
                <tr style="border:1px solid black;">
                    <th width="3%" style="border:1px solid black;">Sl</th>
                    <th width="40%" style="border:1px solid black;">Name</th>
                    <th width="30%" style="border:1px solid black;">Designation</th>
                    <th width="27%" style="border:1px solid black;">Approval Date</th>

                </tr>
                </thead>
                <tbody>
                <?
                $i=1;
                foreach($approve_data_array as $row){
                    ?>
                    <tr style="border:1px solid black;">
                        <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
                        <td width="40%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
                        <td width="30%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
                        <td width="27%" style="border:1px solid black;text-align:center"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')]));?></td>

                    </tr>
                    <?
                    $i++;
                }
                ?>
                </tbody>
            </table>
            <?
        }
        ?>
        <br>
        <?
        if(count($unapprove_data_array)>0)
        {
            $sql_unapproved=sql_select("select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=29 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id=$mst_id");
            $unapproved_request_arr=array();
            foreach($sql_unapproved as $rowu)
            {
                $unapproved_request_arr[$rowu[csf('booking_id')]]=$rowu[csf('approval_cause')];
            }
            ?>
            <table  width="850" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
                <thead>
                <tr style="border:1px solid black;">
                    <th colspan="6" style="border:1px solid black;">Approval/Un Approval History</th>
                </tr>
                <tr style="border:1px solid black;">
                    <th width="3%" style="border:1px solid black;">Sl</th>
                    <th width="30%" style="border:1px solid black;">Name</th>
                    <th width="20%" style="border:1px solid black;">Designation</th>
                    <th width="5%" style="border:1px solid black;">Approval Status</th>
                    <th width="20%" style="border:1px solid black;">Reason For Un Approval</th>
                    <th width="22%" style="border:1px solid black;"> Date</th>

                </tr>
                </thead>
                <tbody>
                <?
                $i=1;
                foreach($unapprove_data_array as $row){

                    ?>
                    <tr style="border:1px solid black;">
                        <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
                        <td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
                        <td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
                        <td width="5%" style="border:1px solid black; text-align:center"><? echo 'Yes';?></td>
                        <td width="20%" style="border:1px solid black;"><? echo '';?></td>
                        <td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); else echo "";?></td>
                    </tr>
                    <?
                    $i++;
                    if($row[csf('un_approved_date')]!="")
                    {
                        ?>
                        <tr style="border:1px solid black;">
                            <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
                            <td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
                            <td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
                            <td width="5%" style="border:1px solid black;text-align:center;"><? echo 'No';?></td>
                            <td width="20%" style="border:1px solid black;text-align:center"><? echo $unapproved_request_arr[$mst_id];?></td>
                            <td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('un_approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('un_approved_date')])); else echo "";?></td>
                        </tr>

                        <?
                        $i++;
                    }

                }
                ?>
                </tbody>
            </table>
            <?
        }
        ?>
        <br/>
        <?
        echo signature_table(43, $cbo_company_name, "1000px");
        echo "****".custom_file_name($txt_booking_no,$all_style,$all_job);
        ?>
    </div>
    <script type="text/javascript" src="../../js/jquery.js"></script>
    <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
    <script>
        fnc_generate_Barcode('<? echo $varcode_work_order_no; ?>','barcode_img_id');
    </script>
    <?
}

//report generated here--------------------//
if($action=="generate_report_raw_material")
{

	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	$cbo_item_cat=str_replace("'","",$cbo_item_cat);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$cbo_buyer_name=str_replace("'","",$cbo_buyer_name);
	$cbo_store_name=str_replace("'","",$cbo_store_name);
    $sql_cond = "";
	if( trim($cbo_store_name)>0 ) $sql_cond .= " and a.store_id='$cbo_store_name'";
	$cbo_yarn_count=str_replace("'","",$cbo_yarn_count);
	$cbo_based_on=str_replace("'","",$cbo_based_on);
    $txt_mrr_no = str_replace("'","",$txt_mrr_no);
	$txt_date_from=str_replace("'","",$txt_date_from);
	$txt_date_to=str_replace("'","",$txt_date_to);
	$rptType=str_replace("'","",$rptType);

	$print_report_format_rcv=return_field_value("format_id","lib_report_template","template_name ='".$cbo_company_name."' and module_id=6 and report_id=191 and is_deleted=0 and status_active=1");
	$format_rcv_ids=explode(",",$print_report_format_rcv);

	$date_cond="";
    if($cbo_based_on==1)
    {
        if( $txt_date_from!="" && $txt_date_to!="" )
        $date_cond="and a.transaction_date between '".date("d-M-Y", strtotime($txt_date_from))."' and '".date("d-M-Y", strtotime($txt_date_to))."'";
    }
    else
    {
        if($txt_date_from!="" && $txt_date_to!="") $date_cond="and a.insert_date between '".date("d-M-Y", strtotime($txt_date_from))."' and '".date("d-M-Y", strtotime($txt_date_to))."  11:59:59 PM'";

    }

    $select_insert_date=" to_char(a.insert_date,'DD-MM-YYYY HH24:MI:SS')  as insert_date";//HH24:MI:SS
	$select_insert_time=" to_char(a.insert_date,'HH24:MI:SS')  as insert_time";

    $con = connect();
    execute_query("delete from gbl_temp_engine where user_id=$user_id and entry_form=33 and ref_from in(101,102,103,104,105)");
    oci_commit($con);

	//------------------- For Mrr Search ---------
	$transaction_ids = "";
	if($txt_mrr_no != "")
	{
        $trasIdsRes = sql_select("SELECT a.id as TRANS_ID, b.RECV_NUMBER, b.RECV_NUMBER_PREFIX_NUM
		from inv_receive_master b, inv_transaction a where b.id = a.mst_id and b.company_id='$cbo_company_name' and b.recv_number_prefix_num = '$txt_mrr_no' $date_cond and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 order by a.id");
        foreach($trasIdsRes as $transRow){
			$transaction_ids .=  $transRow["TRANS_ID"].",";
		}
		$transaction_ids = chop($transaction_ids,",");
		if ($transaction_ids != "") $transaction_ids_cond_for_mrr = " and a.id in ($transaction_ids)";
        unset($trasIdsRes);
	}

	$store_library=return_library_array( "select id, store_name from lib_store_location where is_deleted=0",'id','store_name');
	$location_library=return_library_array( "select id, location_name from lib_location where is_deleted=0",'id','location_name');
	$department_arr=return_library_array( "select id, department_name from lib_department",'id','department_name');
	$section_Arr=return_library_array( "select id, section_name from lib_section",'id','section_name');
	$floor_arr=return_library_array( "select id, floor_name from  lib_prod_floor where is_deleted=0",'id','floor_name');
	$machine_arr=return_library_array( "select id, machine_no from lib_machine_name where is_deleted=0",'id','machine_no');
	$company_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$buyer_short_arr=return_library_array( "select id, short_name from lib_buyer where is_deleted=0",'id','short_name');
	$color_arr=return_library_array( "select id, color_name from  lib_color where is_deleted=0",'id','color_name');
	$supplier_arr=return_library_array( "select id, supplier_name from  lib_supplier where is_deleted=0",'id','supplier_name');
	$buyer_name_arr=return_library_array( "select id, buyer_name from lib_buyer where is_deleted=0",'id','buyer_name');
	$user_name_arr=return_library_array( "select id, user_name from user_passwd",'id','user_name');

	ob_start();
    ?>
    <table width="2280" border="0" cellpadding="2" cellspacing="0" class="rpt_table" rules="all" id="" align="left"style="border:none;">
        <tr class="form_caption" style="border:none;">
            <td colspan="12" align="center" style="border:none;font-size:16px; font-weight:bold" >Date Wise Item Receive Issue Report </td>
        </tr>
        <tr style="border:none;">
            <td colspan="12" align="center" style="border:none; font-size:14px;">
                Company Name : <? echo $company_arr[str_replace("'","",$cbo_company_name)]; ?>
            </td>
        </tr>
	</table>
    <?
    $trims_order_sql=sql_select("select a.requisition_no, b.trims_job, b.order_no from trims_raw_mat_requisition_mst a, trims_job_card_mst b where a.job_id=b.id and a.status_active=1 and a.is_deleted=0 and b.entry_form=257");
	$trims_order_num_arr=array();
	foreach($trims_order_sql as $row)
	{
		$trims_order_num_arr[$row[csf("requisition_no")]]["trims_order_no"]=$row[csf("order_no")];
		$trims_order_num_arr[$row[csf("trims_job")]]["trims_order_no"]=$row[csf("order_no")];
	}

	$use_for_cond="";
	if($cbo_use_for>0) $use_for_cond=" and a.use_for=$cbo_use_for";

	$sql="SELECT a.id as trans_id, a.transaction_type, a.mst_id as rec_issue_id, a.transaction_date, '' as receive_qty, a.cons_quantity as issue_qty, a.cons_uom, a.item_category, a.supplier_id, b.id as prod_id, b.item_group_id, b.sub_group_name, b.item_description, b.item_code, b.item_size, a.cons_rate, a.cons_amount, a.department_id, a.section_id, a.inserted_by, $select_insert_date, $select_insert_time, a.order_qnty, a.order_rate, a.machine_category, a.machine_id, a.floor_id, a.use_for, a.item_return_qty as return_qnty, a.remarks, a.store_id, a.location_id
    from inv_transaction a, product_details_master b
    where a.prod_id=b.id and a.company_id=$cbo_company_name and a.item_category=101 and b.item_category_id=101 and a.transaction_type in(2,3,6) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $date_cond $use_for_cond $sql_cond $transaction_ids_cond_for_mrr
    order by a.transaction_date, a.id";
	//echo $sql;//die;
	$table_width=2660;
	$div_width="2680px";
	$sql_result=sql_select($sql);

    $receive_ids_arr=array();
    $issue_ids_arr=array();
    $transfer_ids_arr=array();
    foreach($sql_result as $row)
    {
        if ($row[csf("transaction_type")]==1 || $row[csf("transaction_type")]==4){
            $receive_ids_arr[$row[csf("rec_issue_id")]]=$row[csf("rec_issue_id")];
        } else if ($row[csf("transaction_type")]==2 || $row[csf("transaction_type")]==3) {
            $issue_ids_arr[$row[csf("rec_issue_id")]]=$row[csf("rec_issue_id")];
        } else $transfer_ids_arr[$row[csf("rec_issue_id")]]=$row[csf("rec_issue_id")];
    }

    $receive_num_arr=array();
    $pi_ids_arr=array();
    $booking_ids_arr=array();
    $requ_ids_arr=array();
    if (count($receive_ids_arr)>0)
    {
        fnc_tempengine("gbl_temp_engine", $user_id, 33, 101, $receive_ids_arr, $empty_arr);
        $sql_receive_res=sql_select("SELECT a.id, a.recv_number, a.challan_no, a.supplier_id,a.knitting_source, a.knitting_company, a.currency_id, a.exchange_rate,  a.booking_id, a.booking_no, a.receive_basis from gbl_temp_engine g, inv_receive_master a,  inv_transaction b where g.ref_val=a.id and a.id=b.mst_id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=1 and b.item_category=101 and b.transaction_type in(1,4) and b.status_active=1 and b.is_deleted=0 and a.status_active=1");
        foreach($sql_receive_res as $row)
        {
            $receive_num_arr[$row[csf("id")]]["id"]=$row[csf("id")];
            $receive_num_arr[$row[csf("id")]]["recv_number"]=$row[csf("recv_number")];
            $receive_num_arr[$row[csf("id")]]["challan_no"]=$row[csf("challan_no")];
            $receive_num_arr[$row[csf("id")]]["supplier_id"]=$row[csf("supplier_id")];
            $receive_num_arr[$row[csf("id")]]["knitting_source"]=$row[csf("knitting_source")];
            $receive_num_arr[$row[csf("id")]]["knitting_company"]=$row[csf("knitting_company")];
            $receive_num_arr[$row[csf("id")]]["currency_id"]=$row[csf("currency_id")];
            $receive_num_arr[$row[csf("id")]]["exchange_rate"]=$row[csf("exchange_rate")];
            $receive_num_arr[$row[csf("id")]]["booking_id"]=$row[csf("booking_id")];
            $receive_num_arr[$row[csf("id")]]["booking_no"]=$row[csf("booking_no")];
            $receive_num_arr[$row[csf("id")]]["receive_basis"]=$row[csf("receive_basis")];
            if ($row[csf("booking_id")]>0){
                if ($row[csf("receive_basis")]==1){
                    $pi_ids_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
                } else if ($row[csf("receive_basis")]==2) {
                    $booking_ids_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
                } else if ($row[csf("receive_basis")]==7) {
                    $requ_ids_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
                }
            }
        }
        unset($sql_receive_res);
    }

    $issue_num_arr=array();
    if (count($issue_ids_arr)>0)
    {
        fnc_tempengine("gbl_temp_engine", $user_id, 33, 102, $issue_ids_arr, $empty_arr);
        $sql_issue_res=sql_select("SELECT a.id, a.issue_number, a.challan_no, a.req_no, a.knit_dye_source, a.knit_dye_company, b.remarks from gbl_temp_engine g, inv_issue_master a, inv_transaction b where g.ref_val=a.id and a.id=b.mst_id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=2 and b.item_category=101 and b.transaction_type in(2,3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1");//die;
        foreach($sql_issue_res as $row)
        {
            $issue_num_arr[$row[csf("id")]]["id"]=$row[csf("id")];
            $issue_num_arr[$row[csf("id")]]["issue_number"]=$row[csf("issue_number")];
            $issue_num_arr[$row[csf("id")]]["challan_no"]=$row[csf("challan_no")];
            $issue_num_arr[$row[csf("id")]]["req_no"]=$row[csf("req_no")];
            $issue_num_arr[$row[csf("id")]]["knit_dye_source"]=$row[csf("knit_dye_source")];
            $issue_num_arr[$row[csf("id")]]["issue_to"]=$row[csf("knit_dye_company")];
            $issue_num_arr[$row[csf("id")]]["remarks"]=$row[csf("remarks")];
        }
        unset($sql_issue_res);
    }

    $transfer_num_arr=array();
    if (count($transfer_ids_arr)>0)
    {
        fnc_tempengine("gbl_temp_engine", $user_id, 33, 103, $transfer_ids_arr, $empty_arr);
        $sql_transfer_res=sql_select("SELECT a.id, a.transfer_system_id, a.challan_no, a.transfer_date from gbl_temp_engine g, inv_item_transfer_mst a, inv_transaction b where g.ref_val=a.id and a.id=b.mst_id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=3 and b.item_category=101 and b.transaction_type in(5,6) and b.status_active=1 and b.is_deleted=0 and a.status_active=1");
        foreach($sql_transfer_res as $row)
        {
            $transfer_num_arr[$row[csf("id")]]["id"]=$row[csf("id")];
            $transfer_num_arr[$row[csf("id")]]["transfer_system_id"]=$row[csf("transfer_system_id")];
            $transfer_num_arr[$row[csf("id")]]["challan_no"]=$row[csf("challan_no")];
            $transfer_num_arr[$row[csf("id")]]["transfer_date"]=$row[csf("transfer_date")];
        }
        unset($sql_transfer_res);
    }

    $wo_arr=array();
    if (count($booking_ids_arr)>0)
    {
        fnc_tempengine("gbl_temp_engine", $user_id, 33, 104, $booking_ids_arr, $empty_arr);
        $sql_wo_res=sql_select("SELECT id, wo_number_prefix_num, requisition_no, wo_number from gbl_temp_engine g, wo_non_order_info_mst b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=4 and b.status_active=1 and b.is_deleted=0");//die;
        foreach($sql_wo_res as $row)
        {
            $wo_arr[$row[csf("id")]]['wo_number']=$row[csf("wo_number")];
			$wo_arr[$row[csf("id")]]['requ_no']=$row[csf("requisition_no")];
        }
        unset($sql_wo_res);
    }

    $requisiton_arr=array();
    if (count($requ_ids_arr)>0)
    {
        fnc_tempengine("gbl_temp_engine", $user_id, 33, 105, $requ_ids_arr, $empty_arr);
        $sql_requ_res=sql_select("SELECT id, requ_prefix_num from gbl_temp_engine g, inv_purchase_requisition_mst b where g.ref_val=b.id and g.user_id=$user_id and g.entry_form=33 and g.ref_from=5 and b.status_active=1 and b.is_deleted=0");//die;
        foreach($sql_requ_res as $row)
        {
            $requisiton_arr[$row[csf("id")]]=$row[csf("requ_prefix_num")];
        }
        unset($sql_requ_res);
    }

	$show_html_other = 1;
	if(count($sql_result) > 0)
	{
		?>
		<br>
		<div style="width:<? echo $div_width; ?>">
	    	<fieldset style="width:<? echo $div_width; ?>">
				<table width="<? echo $table_width; ?>" border="0" cellpadding="2" cellspacing="0" class="rpt_table" rules="all" id="" align="left">
						<tr class="form_caption" style="border:none;">
							<td colspan="16" align="left" style="border:none;font-size:16px; font-weight:bold" > Raw Material : </td>
						</tr>
				   </table>
				   <br />
				<table width="<? echo $table_width; ?>" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="table_header_1" align="left">
					<thead>
						<tr>
							<th width="30">SL</th>
							<th width="70">Prod. Id</th>
							<th width="100">Store Name</th>
							<th width="100">Location</th>
							<th width="100">Trans. Date</th>
							<th width="130">Trans. Ref.</th>
	                        <th width="100">WO No</th>
	                        <th width="100">Supplier</th>
	                        <th width="100">Challan No</th>
	                        <th width="120">Pur. Reqsn/<br /> Book. No/<br />Store Reqsn</th>
							<th width="130">Item Group</th>
	                        <th width="70">UOM</th>
	                        <th width="120">Item Description</th>
							<th  width="80">Issue Qty</th>
	                        <th  width="80">Rate(TK)</th>
	                        <th  width="100">Amount(TK)</th>
	                        <th width="120">Remarks</th>
	                        <th  width="110">User</th>
	                        <th  width="160">Insert Date</th>
	                        <th width="100">Department</th>
	                        <th width="100">Section</th>
	                        <th width="100">Item Code</th>
	                        <th width="100">Machine Category</th>
	                        <th width="100">Floor</th>
	                        <th width="100">Machine No</th>
	                        <th width="80">Size</th>
	                        <th width="100">Issue To</th>
						</tr>
					</thead>
			   </table>
	           <br />
			  	<div style="width:<? echo $div_width; ?>; overflow-y: scroll; max-height:250px;" id="scroll_body">
					<table width="<? echo $table_width; ?>" class="rpt_table" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_body_raw_material" align="left">
						<tbody>
						<?
						$group_arr=return_library_array( "select id, item_name from  lib_item_group",'id','item_name');
						$i=1;$total_receive="";$total_issue="";
						foreach($sql_result as $row)
						{
							if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4)
							{
								if($receive_num_arr[$row[csf('rec_issue_id')]]["receive_basis"]==7)
								{
									$req_book_no=$requisiton_arr[$receive_num_arr[$row[csf('rec_issue_id')]]["booking_id"]];
								}
								else if ($receive_num_arr[$row[csf('rec_issue_id')]]["receive_basis"]==2)
								{
									$req_book_no=$wo_arr[$receive_num_arr[$row[csf('rec_issue_id')]]["booking_id"]]['wo_number'];
								}
								else
								{
									$req_book_no="";
								}
							}
							else if($row[csf("transaction_type")]==2  || $row[csf("transaction_type")]==3)
							{
								$req_book_no=$issue_num_arr[$row[csf('rec_issue_id')]]["req_no"];
							}
							else if($row[csf("transaction_type")]==5  || $row[csf("transaction_type")]==6)
							{
								$req_book_no=$transfer_num_arr[$row[csf('rec_issue_id')]]["req_no"];
							}

							if ($i%2==0)
							$bgcolor="#E9F3FF";
							else
							$bgcolor="#FFFFFF";
							?>
							<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $i; ?>">
								<td width="30"><p><? echo $i; ?>&nbsp;</p></td>
								<td width="70" align="center"><p><? echo $row[csf("prod_id")]; ?>&nbsp;</p></td>
								<td width="100"><p><? echo $store_library[$row[csf("store_id")]]; ?>&nbsp;</p></td>
								<td width="100"><p><? echo $location_library[$row[csf("location_id")]]; ?>&nbsp;</p></td>
								<td width="100" align="center"><p><? if($row[csf("transaction_date")]!="0000-00-00") echo change_date_format($row[csf("transaction_date")]); else echo ""; ?>&nbsp;</p></td>
		                        <td width="130" align="center" title="<? echo $row[csf("transaction_type")]."_".$row[csf('rec_issue_id')];?>"><p>
		                        <a href="##" onClick="openmypage_mrr('mrr_popup','<? echo $row[csf("transaction_type")];?>','<? echo $row[csf('trans_id')];?>','<? echo $cbo_company_name;?>');">
								<?
								if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4)
								{
									echo $receive_num_arr[$row[csf('rec_issue_id')]]["recv_number"];
								}
								else if($row[csf("transaction_type")]==2  || $row[csf("transaction_type")]==3)
								{
									echo $issue_num_arr[$row[csf('rec_issue_id')]]["issue_number"];
								}
								else if( $row[csf("transaction_type")]==5 || $row[csf("transaction_type")]==6)
								{
									echo $transfer_num_arr[$row[csf('rec_issue_id')]]["transfer_system_id"];
								}
								?>&nbsp;
								</a></p>
		                        </td>
		                        <td width="100"><p><? echo $trims_order_num_arr[$req_book_no]["trims_order_no"];?>&nbsp;</p></td>
		                        <td width="100"><p><?  echo $supplier_arr[$row[csf("supplier_id")]];?>&nbsp;</p></td>
		                        <td width="100"><p>
								<?
								if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4)
								{
									echo $receive_num_arr[$row[csf('rec_issue_id')]]["challan_no"];
								}
								else if($row[csf("transaction_type")]==2  || $row[csf("transaction_type")]==3)
								{
									echo $issue_num_arr[$row[csf('rec_issue_id')]]["challan_no"];
								}
								else if($row[csf("transaction_type")]==5 || $row[csf("transaction_type")]==6)
								{
									echo $transfer_num_arr[$row[csf('rec_issue_id')]]["challan_no"];
								}
								?>&nbsp;
								</p>
		                        </td>
		                        <td width="120"><p>
		                        <? echo $req_book_no; ?>&nbsp;</p></td>
		                        <td width="130" ><p><? echo $group_arr[$row[csf('item_group_id')]]; ?>&nbsp;</p></td>
		                        <td width="70" align="center"><p><?  echo $unit_of_measurement[$row[csf("cons_uom")]];?>&nbsp;</p></td>
		                        <td width="120"><p><? echo $row[csf('item_description')]; ?>&nbsp;</p></td>
								<td width="80" align="right"><p><? echo number_format($row[csf("issue_qty")],2); $total_issue +=$row[csf("issue_qty")]; ?></p></td>
		                        <td width="80" align="right"><p><? echo number_format($row[csf("cons_rate")],2); ?></p></td>
		                        <td align="right" width="100" style="padding-right:3px"><p><? echo number_format($row[csf("cons_amount")],2); $total_amount +=$row[csf("cons_amount")]; ?></p></td>
		                        <td width="120"><p><? echo $row[csf("remarks")]; ?>&nbsp;</p></td>
		                        <td width="110"><p><? echo $user_name_arr[$row[csf("inserted_by")]]; ?>&nbsp;</p></td>
		                        <td width="160"><p><? echo change_date_format($row[csf("insert_date")])." ".$row[csf("insert_time")]; ?>&nbsp;</p></td>
		                        <td width="100" align="center"><p><? echo $department_arr[$row[csf("department_id")]]; ?>&nbsp;</p></td>
		                        <td width="100" align="center"><p><? echo $section_Arr[$row[csf("section_id")]]; ?>&nbsp;</p></td>
		                        <td width="100" ><p><? echo $row[csf('item_code')]; ?>&nbsp;</p></td>
		                        <td width="100" ><p><? echo $machine_category[$row[csf('machine_category')]]; ?>&nbsp;</p></td>
		                        <td width="100" ><p><? echo $floor_arr[$row[csf('floor_id')]]; ?>&nbsp;</p></td>
		                        <td width="100"><p><? echo $machine_arr[$row[csf('machine_id')]]; ?>&nbsp;</p></td>
		                        <td width="80"><p><? echo $row[csf('item_size')]; ?>&nbsp;</p></td>
		                        <td width="100"><p>
		                        	<?
									if($row[csf("transaction_type")]==1  || $row[csf("transaction_type")]==4)
									{
										//echo $receive_num_arr[$row[csf('rec_issue_id')]]["recv_number"];
									}
									else if($row[csf("transaction_type")]==2  || $row[csf("transaction_type")]==3)
									{
										echo $company_arr[$issue_num_arr[$row[csf('rec_issue_id')]]["issue_to"]];
									}
									else if( $row[csf("transaction_type")]==5 || $row[csf("transaction_type")]==6)
									{
										//echo $transfer_num_arr[$row[csf('rec_issue_id')]]["transfer_system_id"];
									}
									?>&nbsp;
		                        </p></td>
							</tr>
							<?
							$item_wise_qty_arr[$row[csf('item_group_id')]][$row[csf('item_description')]]['recv']+=$row[csf("receive_qty")];
							$item_wise_qty_arr[$row[csf('item_group_id')]][$row[csf('item_description')]]['recv_amt']+=$row[csf('order_qnty')]*$row[csf('order_rate')];
							$item_wise_qty_arr[$row[csf('item_group_id')]][$row[csf('item_description')]]['issue']+=$row[csf("issue_qty")];
							$item_wise_qty_arr[$row[csf('item_group_id')]][$row[csf('item_description')]]['issue_amt']+=$row[csf("cons_amount")];
							$i++;
						}
						//print_r($item_wise_qty_arr);
						?>
						</tbody>
					</table>
		            <table width="<? echo $table_width; ?>" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" id="report_table_footer" align="left">
		                <tfoot>
		                	<tr>
		                        <th width="30">&nbsp;</th>
		                        <th width="70">&nbsp;</th>
		                        <th width="100">&nbsp;</th>
		                        <th width="100">&nbsp;</th>
		                        <th width="100">&nbsp;</th>
		                        <th width="130">&nbsp;</th>
		                        <th width="100">&nbsp;</th>
		                        <th width="100">&nbsp;</th>
		                        <th width="100">&nbsp;</th>
		                        <th width="120">&nbsp;</th>
		                        <th width="130">&nbsp;</th>
		                        <th width="70">&nbsp;</th>
		                        <th width="120">Total:</th>
		                        <th width="80" id="value_total_issue"><? echo number_format($total_issue,2); ?></th>
		                        <th width="80" >&nbsp;</th>
		                        <th id="value_total_amount"  width="100"><? echo number_format($total_amount,2); ?></th>
		                        <th width="120" >&nbsp;</th>
		                        <th width="110" >&nbsp;</th>
		                        <th width="160" >&nbsp;</th>
		                        <th width="100">&nbsp;</th>
		                        <th width="100">&nbsp;</th>
		                        <th width="100">&nbsp;</th>
		                        <th width="100" >&nbsp;</th>
		                        <th width="100" >&nbsp;</th>
		                        <th width="100" >&nbsp;</th>
		                        <th width="80">&nbsp;</th>
		                        <th width="100">&nbsp;</th>
		                    </tr>
		                </tfoot>
		            </table>
			 	</div>
	    	</fieldset>
		</div>
		<?
	}
	else
	{
		$show_html_other = 0;
	}


	if($show_html_other==0 && $show_html_1==0 && $show_html_13==0 && $show_html_2==0 && $show_html_4 ==0)
	{
		?>
		<table class="rpt_table" rules="all" id="" style="border:none;" width="2280" cellspacing="0" cellpadding="2" border="0" align="left">
		<tbody>
		<tr class="form_caption" style="border:none;">
			<td colspan="12" style="border:nonex;font-size:13px; font-weight:bold; color:red;" align="center">No Data Found </td>
		</tr>
		</tbody>
		</table>
		<?
	}

    execute_query("delete from gbl_temp_engine where user_id=$user_id and entry_form=33 and ref_from in(101,102,103,104,105)");
    oci_commit($con); disconnect($con);

	foreach (glob($user_id."*.xls") as $filename) {
	if( @filemtime($filename) < (time()-$seconds_old) )
	@unlink($filename);
	}
	//---------end------------//
	$name=time();
	$filename=$user_id."_".$name.".xls";
	$create_new_doc = fopen($filename, 'w');
	$is_created = fwrite($create_new_doc,ob_get_contents());
	//echo "$html**$filename**$cbo_item_cat**$rptType";
    echo "$html**$filename**$return_item_cat**$rptType";
    disconnect($con);
	exit();

}

if($action == "mrr_popup")
{
    extract($_REQUEST);
    $data=explode('**',$data);
    $trans_type = $data[0];
    $trans_id = $data[1];
    $result = sql_select("select mst_id, transaction_type, item_category, requisition_no from inv_transaction where id = '$trans_id' and transaction_type = '$trans_type'");
    $transaction_type =  $result[0][csf("transaction_type")];
    $requisition_no =  $result[0][csf("requisition_no")];
    $mrr_id =  $result[0][csf("mst_id")];
    if($transaction_type == 1) // Receive
    {
        $mrr_info = sql_select("select id,recv_number,entry_form, receive_date, company_id, store_id, location_id, knitting_source, knitting_location_id from inv_receive_master where id = '$mrr_id'");
        if ($mrr_info[0][csf("entry_form")]==1) // Yarn Receive
        {
        	echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("recv_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type;
        }
        else if ($mrr_info[0][csf("entry_form")]==58) // Knit Grey Fabric roll Receive
		{
			$print_report_format=return_field_value('format_id', 'lib_report_template', "template_name =".$mrr_info[0][csf("company_id")]." and module_id=6 and report_id=171 and is_deleted=0 and status_active=1");
	        $format_ids=explode(',', $print_report_format);
	        // echo $print_report_format;
	        switch ($format_ids[0]) {
	        	case 86: // Print
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("recv_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("location_id")]."##".$mrr_info[0][csf("store_id")]."##1";
					break;
				case 84: // Print2
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("recv_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("location_id")]."##".$mrr_info[0][csf("store_id")]."##2";
					break;
				case 85: // Print3
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("recv_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("knitting_location_id")]."##".$mrr_info[0][csf("knitting_source")]."##3";
					break;
				case 68: // Print Barcode
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("recv_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("knitting_location_id")]."##".$mrr_info[0][csf("knitting_source")]."##4";
					break;
				case 69: // Fabric Details
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("recv_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("knitting_location_id")]."##".$mrr_info[0][csf("knitting_source")]."##5";
					break;

				default: // 86 Print
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("recv_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("location_id")]."##".$mrr_info[0][csf("store_id")]."##1";
					break;
			}
		}
        else if ($mrr_info[0][csf("entry_form")]==68) // Knit Finish Fabric roll Receive
		{
			$print_report_format=return_field_value('format_id', 'lib_report_template', "template_name =".$mrr_info[0][csf("company_id")]." and module_id=6 and report_id=172 and is_deleted=0 and status_active=1");
	        $format_ids=explode(',', $print_report_format);
	        // echo $print_report_format;
	        switch ($format_ids[0]) {
	        	case 86: // Print
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("recv_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("receive_date")]."##1";
					break;
				case 69: // Fabric Details
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("recv_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("receive_date")]."##2";
					break;

				default: // 78 Print 1
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("recv_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("receive_date")]."##1";
					break;
			}
		}
        else
        {
        	echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("recv_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type;
        }
    }
    if($transaction_type == 4 )
    {
        $mrr_info = sql_select("select id,recv_number,entry_form from inv_receive_master where id = '$mrr_id'");
        echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("recv_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type;
    }
    if($transaction_type == 2) // Issue
    {
        $mrr_info = sql_select("select id,issue_number,entry_form,is_approved,booking_id, company_id, issue_basis,knit_dye_source, knit_dye_company,location_id,store_id,buyer_id from inv_issue_master where id = '$mrr_id'");
        if ($mrr_info[0][csf("entry_form")]==3) // Yarn Issue
        {
	        $print_report_format=return_field_value('format_id', 'lib_report_template', "template_name =".$mrr_info[0][csf("company_id")]." and module_id=6 and report_id=37 and is_deleted=0 and status_active=1");
	        $format_ids=explode(',', $print_report_format);
	        // echo $print_report_format;
	        //89,109,110,111,112,113,114,129,161,172,184,227,230,235,241,274
	        //109 110 111 227 112 89 113 114 172 235 241 129 161 274
	        switch ($format_ids[0]) {
	        	case 109: // Print
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##1";
					break;
				case 89: // Print4
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##2";
					break;
				case 110: // Print2
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##3";
					break;
				case 111: // Print3
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##4";
					break;
				case 112: // Print With VAT
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##5";
					break;
				case 113: // Requisition Details
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##6"."##".$requisition_no;
					break;
				case 114: // Without Program
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##7";
					break;
				case 129: // Print7
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##8";
					break;
				case 161: // Print 6
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##9";
					break;
				case 172: // Print Outbound
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##10";
					break;
				case 184: // Composition wise lot ??
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##11";
					break;
				case 227: // print 8
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##12";
					break;
				case 230: // print 7 ??
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##13";
					break;
				case 235: // print 9
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##14";
					break;
				case 241: // print 11
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##15";
					break;

				case 274: // 274 Print 10
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##16";
					break;
				case 304: // 304 print 15
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##17";
					break;
				default: // 846 print 18
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##18##".$mrr_info[0][csf("location_id")]."##".$mrr_info[0][csf("store_id")]."##".$mrr_info[0][csf("buyer_id")]."##".$mrr_info[0][csf("issue_basis")];
					break;
			}
		}
		else if ($mrr_info[0][csf("entry_form")]==61) // Knit Grey Fabric roll Issue
		{
			$print_report_format=return_field_value('format_id', 'lib_report_template', "template_name =".$mrr_info[0][csf("company_id")]." and module_id=6 and report_id=27 and is_deleted=0 and status_active=1");
	        $format_ids=explode(',', $print_report_format);
	        // echo $print_report_format;
	        switch ($format_ids[0]) {
	        	case 68: // Print Barcode
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##1";
					break;
				case 69: // Fabric Details
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##2";
					break;
				case 70: // GIN3-MC
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##3";
					break;
				case 71: // GIN4
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##4";
					break;
				case 181: // GIN5
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##5";
					break;
				case 236: // Print With Collar Cuff
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##6"."##".$requisition_no;
					break;
				case 325: // GIN2
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##7";
					break;
				case 326: // Sales Wise Issue
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##8";
					break;
				case 327: // GIN1
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##9";
					break;
				case 78: // Print 1
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("knit_dye_source")]."##".$mrr_info[0][csf("is_approved")]."##10"."##".$mrr_info[0][csf("knit_dye_company")];
					break;

				default: // 78 Print 1
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##11";
					break;
			}
		}
		else if ($mrr_info[0][csf("entry_form")]==71) // Knit Finish Fabric roll Issue
		{
			$print_report_format=return_field_value('format_id', 'lib_report_template', "template_name =".$mrr_info[0][csf("company_id")]." and module_id=6 and report_id=164 and is_deleted=0 and status_active=1");
	        $format_ids=explode(',', $print_report_format);
	        // echo $print_report_format;
	        switch ($format_ids[0]) {
	        	case 86: // Print1
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##1";
					break;
				case 66: // Print2
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##2";
					break;
				case 85: // Print3
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##3";
					break;
				case 89: // Print4
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##4";
					break;
				case 129: // Print5
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##5";
					break;
				case 68: // Print Barcode
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##6";
					break;
				case 69: // Fabric Details
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##7";
					break;

				default: // 69 Fabric Details
					echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")]."##8";
					break;
			}
		}
		else
		{
			echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")];
		}
    }
    if($transaction_type == 3 ) // Receive Return
    {
        $mrr_info = sql_select("select id,issue_number,entry_form,is_approved,booking_id from inv_issue_master where id = '$mrr_id'");
        echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("issue_number")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type."##".$mrr_info[0][csf("booking_id")]."##".$mrr_info[0][csf("is_approved")];
    }
    if($transaction_type == 5 || $transaction_type == 6 )
    {
        $mrr_info = sql_select("select id,transfer_system_id,entry_form from inv_item_transfer_mst where id = '$mrr_id'");
        echo $mrr_info[0][csf("id")]."##".$mrr_info[0][csf("transfer_system_id")]."##".$mrr_info[0][csf("entry_form")]."##".$transaction_type;
    }

}
if($action=="show_file")
{
    echo load_html_head_contents("Invoice File","../../../", 1, 1, $unicode);
    extract($_REQUEST);
	$data_array_rcv=sql_select("SELECT IMAGE_LOCATION, REAL_FILE_NAME from common_photo_library where master_tble_id='$rcv_sys_id' and form_name='trims_receive_entry' and is_deleted=0 and file_type=2");

    ?>
    <style type="text/css">
        li { list-style: none; font-size: 9pt; margin-top: 0px; margin-left: 7px; float: left; width: 89px;}
    </style>
    <table width="100%">
        <tr><td style="font-size: 13px;">Trims Receive Entry Attached File</td></tr>
        <tr>
            <td width="100%" height="128" style="vertical-align: top;">
            <?
            foreach ($data_array_rcv as $row)
            {
                ?>
                <li>
                    <a href="../../../<? echo $row['IMAGE_LOCATION']; ?>" target="_new">
                    <img src="../../../file_upload/blank_file.png" height="60" width="70"></a>
                    <br>
                    <p style="width: 70px; word-break: break-all; margin-top: 1px; font-size: 11px;"><? echo $row['REAL_FILE_NAME']; ?></p>
                </li>
                <?
            }
            ?>
            </td>
        </tr>
    </table>
    <?
}


?>
