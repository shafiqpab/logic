<?
header('Content-type:text/html; charset=utf-8');
session_start();
include('../includes/common.php');
$con=connect();
//die;

  $job_ids="32776, 32777, 32781, 32782, 32783, 32784, 32785, 32786, 32787, 32788, 32789, 32790, 32791, 32792, 32793, 32794, 32795, 32796, 32797, 32798, 32799, 32800, 32801, 32802, 32803, 32804, 32805, 32806, 32807, 32808, 32810, 32811, 32812, 32813, 32814, 32815, 32816, 32817, 32818, 32819, 32820, 32821, 32822, 32823, 32824, 32825, 32826, 32827, 32828, 32829, 32830, 32831, 32832, 32834, 32835, 32836, 32837, 32838, 32839, 32840, 32841, 32842, 32843, 32844, 32845, 32846, 32847, 32848, 32849, 32850, 32851, 32852, 32853, 32854, 32855, 32858, 32859, 32860, 32861, 32862, 32863, 32864, 32865, 32866, 32867, 32868, 32869, 32870, 32871, 32872, 32873, 32874, 32875, 32876, 32877, 32878, 32879, 32880, 32881, 32882, 32883, 32884, 32885, 32886, 32887, 32888, 32889, 32890, 32891, 32892, 32893, 32894, 32895, 32896, 32897, 32898, 32899, 32900, 32901, 32902, 32903, 32904, 32905, 32906, 32907, 32908, 32909, 32910, 32911, 32912, 32913, 32914, 32915, 32916, 32917, 32918, 32919, 32920, 32921, 32922, 32923, 32924, 32925, 32926, 32927, 32929, 32930, 32931, 32932, 32933, 32934, 32935, 32936, 32937, 32938, 32939, 32940, 32941, 32942, 32943, 32944, 32945, 32946, 32947, 32948, 32949, 32950, 32951, 32952, 32953, 32954, 32955, 32956, 32957, 32958, 32959, 32960, 32961, 32962, 32963, 32964, 32965, 32966, 32967, 32968, 32971, 32972, 32973, 32974, 32975, 32976, 32977, 32978, 32979, 32980, 32981, 32982, 32983, 32984, 32985, 32986, 32987, 32988, 32989, 32990, 32992, 32994, 32995, 32996, 32997, 32998, 32999, 33000, 33001, 33002, 33003, 33004, 33005, 33006, 33007, 33008, 33009, 33010, 33011, 33012, 33013, 33014, 33015, 33016, 33017, 33018, 33019, 33020, 33021, 33022, 33023, 33024, 33025, 33026, 33027, 33028, 33029, 33030, 33031, 33032, 33033, 33034, 33035, 33036, 33037, 33038, 33040, 33041, 33042, 33043, 33044, 33045, 33046, 33047, 33048, 33049, 33050, 33051, 33052, 33053, 33054, 33055, 33056, 33057, 33058, 33059, 33060, 33061, 33062, 33063, 33064, 33065, 33066, 33067, 33068, 33069, 33070, 33071, 33072, 33073, 33074, 33075, 33076, 33077, 33078, 33079, 33080, 33081, 33082, 33083, 33084, 33085, 33086, 33087, 33088, 33089, 33090, 33091, 33092, 33093, 33094, 33095, 33096, 33097, 33098, 33099, 33100, 33101, 33102, 33103, 33104, 33105, 33106, 33107, 33108, 33109, 33110, 33111, 33112, 33113, 33114, 33115, 33116, 33117, 33118, 33119, 33120, 33121, 33122, 33123, 33124, 33125, 33126, 33127, 33128, 33129, 33130, 33131, 33132, 33134, 33135, 33136, 33137, 33138, 33139, 33140, 33141, 33142, 33143, 33144, 33145, 33146, 33147, 33148, 33149, 33150, 33151, 33152, 33153, 33154, 33155, 33156, 33157, 33158, 33159, 33160, 33161, 33163, 33164, 33165, 33166, 33168, 33170, 33171, 33172, 33173, 33174, 33175, 33176, 33177, 33178, 33179, 33180, 33181, 33183, 33184, 33185, 33186, 33187, 33188, 33189, 33190, 33191, 33192, 33193, 33194, 33197, 33198, 33199, 33200, 33202, 33203, 33204, 33206, 33207, 33208, 33214, 33216, 33219, 33225, 33228, 33229, 33230, 33231, 33232, 33241, 33242, 33243, 33246, 33247, 33248, 33249, 33250, 33251, 33253, 33259, 33263, 33266, 33269, 33272, 33274, 33277, 33280, 33283, 33290,33296";
$job_conv_arr=sql_select( "select a.id,a.job_no,a.job_id,a.fabric_description,a.color_break_down from  wo_pre_cost_fab_conv_cost_dtls a, wo_pre_cost_mst b where a.job_id=b.job_id  and a.color_break_down is not null and a.job_id in($job_ids) and b.costing_date between '01-Jan-2023' and '01-Dec-2023' and a.status_active=1 and b.status_active=1   order by a.job_id,a.id asc");//and b.costing_date between '01-Jan-2023' and '01-Dec-2023'
//print_r($job_smv_arr);die;and a.job_no='FAL-20-00285' and a.job_no like 'FFL-20-%'
 
$i=0; 
$add_comma=0;
	$id1=return_next_id( "id", "wo_pre_cos_conv_color_dtls", 1);
	$field_array_dtls="id, job_id,job_no,fabric_cost_dtls_id,conv_cost_dtls_id,convchargelibraryid,gmts_color_id,fabric_color_id ,cons,unit_charge,inserted_by, insert_date, status_active, is_deleted";
foreach($job_conv_arr as $row)
{
	$consbreckdown_array=explode('__',str_replace("'",'',$row[csf('color_break_down')]));
	$counter=0;
	for($c=0;$c < count($consbreckdown_array);$c++)
	{
		$counter++;
		$consbreckdownarr=explode('_',$consbreckdown_array[$c]);
		$fabric_cost_dtls_id=$row[csf('fabric_description')];
		$job_no=$row[csf('job_no')];
		$job_id=$row[csf('job_id')];
		$conv_id=$row[csf('id')];
		 

		//$data_array_dtls.="INTO wo_pre_cos_conv_color_dtls (".$field_array_dtls.") VALUES(".$id1.",'".$job_id."','".$job_no."',".$fabric_cost_dtls_id.",'".$conv_id."','".$consbreckdownarr[2]."','".$consbreckdownarr[0]."','".$consbreckdownarr[3]."','".$consbreckdownarr[4]."','".$consbreckdownarr[1]."',".$_SESSION['logic_erp']['user_id'].",'".$pc_date_time."',1,0)";

		$i++;
		$id1=$id1+1;
		$add_comma++;
	}
		
	
}
  echo "10**=insert into wo_pre_cos_conv_color_dtls (".$field_array_dtls.") values ".$data_array_dtls;die;

if($data_array_dtls!="")
{
	$queryconv="INSERT ALL ".$data_array_dtls." SELECT * FROM dual";
	$rID1=execute_query($queryconv);
	if($rID1==1) $flag=1; else $flag=0;

//$rID2=sql_insert("wo_pre_cos_conv_color_dtls",$field_array_dtls,$data_array_dtls,0,"");
}

//echo $rID1.'='.$flag.'='.$i; die;

 
if($flag==1)
{
	oci_commit($con); 
	echo "Success=".$i;
}
else{
	oci_rollback($con);
echo "Success=".$i;
}


 
?>