<?php
/*-------------------------------------------- Comments -----------------------
Purpose			         : 	This Form Will Create Garments Pre Cost Entry report.
Functionality	         :
JS Functions	         :
Created by		         :	Zakaria Joy
Creation date 	         : 	15-09-2022
QC Performed BY	         :
QC Date			         :
Comments		         : This Page only Use for Pre-cost entry page report 
-------------------------------------------------------------------------------*/
header('Content-type:text/html; charset=utf-8');
session_start();
if ($_SESSION['logic_erp']['user_id'] == "") header("location:login.php");
include('../../../includes/common.php');
include('../../../includes/class4/class.conditions.php');
include('../../../includes/class4/class.reports.php');
include('../../../includes/class4/class.fabrics.php');
include('../../../includes/class4/class.yarns.php');
include('../../../includes/class4/class.conversions.php');
include('../../../includes/class4/class.trims.php');
include('../../../includes/class4/class.emblishments.php');
include('../../../includes/class4/class.washes.php');
include('../../../includes/class4/class.commercials.php');
include('../../../includes/class4/class.commisions.php');
include('../../../includes/class4/class.others.php');

$data = $_REQUEST['data'];
$action = $_REQUEST['action'];
$type = $_REQUEST['type'];
$permission = $_SESSION['page_permission'];
ini_set('precision', 8);
if ($action == "preCostRpt7") {
	$process = array(&$_POST);

	extract(check_magic_quote_gpc($process));
	if ($txt_job_no == "") $job_no = '';
	else $job_no = " and a.job_no=" . $txt_job_no . "";
	$txt_costing_date = change_date_format(str_replace("'", "", $txt_costing_date), 'yyyy-mm-dd', '-');
	$txt_costingdate = change_date_format(str_replace("'", "", $txt_costing_date), 'yyyy-mm-dd', '-');
	if ($db_type == 0) {
		$costing_date = change_date_format($txt_costing_date, "yyyy-mm-dd", "-");
	}
	if ($db_type == 2) {
		$costing_date = change_date_format($txt_costing_date, "yyyy-mm-dd", "-", 1);
	}
	if ($cbo_company_name == "") $company_name = '';
	else $company_name = " and a.company_name=" . $cbo_company_name . "";
	if ($cbo_buyer_name == "") $cbo_buyer_name = '';
	else $cbo_buyer_name = " and a.buyer_name=" . $cbo_buyer_name . "";
	if ($txt_style_ref == "") $txt_style_ref = '';
	else $txt_style_ref = " and a.style_ref_no=" . $txt_style_ref . "";
	if ($txt_costing_date == "") $txt_costing_date = '';
	else $txt_costing_date = " and b.costing_date='" . $txt_costing_date . "'";
	$buyer_arr = return_library_array("select id, buyer_name from lib_buyer", 'id', 'buyer_name');
	$comp = return_library_array("select id, company_name from lib_company", 'id', 'company_name');
	$color_library = return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");

	if ($db_type == 0) {
		$sqlcpm = sql_select("select cost_per_minute from lib_standard_cm_entry where company_id=$cbo_company_name and '$costing_date' between applying_period_date and applying_period_to_date  and status_active=1 and is_deleted=0 LIMIT 1");
	}
	if ($db_type == 2) {
		$sqlcpm = sql_select("select cost_per_minute from lib_standard_cm_entry where company_id=$cbo_company_name and '$costing_date' between applying_period_date and applying_period_to_date and status_active=1 and is_deleted=0");
	}

	$cpm = '';
	foreach ($sqlcpm as $sqlcpmrow) {
		$cpm = $sqlcpmrow[csf('cost_per_minute')];
	}
	if ($db_type == 0) $group_gsm = "group_concat( distinct b.gsm_weight) AS gsm_weight";
	if ($db_type == 2) $group_gsm = "listagg(b.gsm_weight ,',') within group (order by b.gsm_weight) AS gsm_weight";

	$gsm_weight_top = return_field_value("$group_gsm", "lib_body_part a,wo_pre_cost_fabric_cost_dtls b", "a.id=b.body_part_id and b.job_no=$txt_job_no and a.body_part_type=1 and b.status_active=1 and b.is_deleted=0", "gsm_weight");
	$gsm_weight_bottom = return_field_value("$group_gsm", "lib_body_part a,wo_pre_cost_fabric_cost_dtls b", "a.id=b.body_part_id and b.job_no=$txt_job_no and a.body_part_type=20 and b.status_active=1 and b.is_deleted=0", "gsm_weight");
	$po_qty = 0;
	$po_plun_cut_qty = 0;
	$total_set_qnty = 0;
	$sql_po = "select a.job_no,a.total_set_qnty,b.id,b.PUB_SHIPMENT_DATE,c.item_number_id,c.country_id,c.color_number_id,c.size_number_id,c.order_quantity ,c.plan_cut_qnty  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst   and b.id=c.po_break_down_id  and a.job_no =" . $txt_job_no . "   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 order by b.id";
	$sql_po_data = sql_select($sql_po);
	$pulish_ship_date_arr = array();
	foreach ($sql_po_data as $sql_po_row) {
		$po_qty += $sql_po_row[csf('order_quantity')];
		$po_plun_cut_qty += $sql_po_row[csf('plan_cut_qnty')];
		$total_set_qnty = $sql_po_row[csf('total_set_qnty')];
		$pulish_ship_date_arr[$sql_po_row[PUB_SHIPMENT_DATE]] = $sql_po_row[PUB_SHIPMENT_DATE];
	}
	$fab_knit_req_kg_avg = 0;
	$fab_woven_req_yds_avg = 0;

	if ($db_type == 0) {
		$sql = "select a.job_no,b.id,a.company_name,a.buyer_name,a.style_ref_no,a.gmts_item_id,a.order_uom,a.job_quantity,a.avg_unit_price,b.costing_per,b.budget_minute,b.approved,b.sew_smv,b.exchange_rate,b.sew_effi_percent,c.fab_knit_req_kg,c.fab_knit_fin_req_kg,c.fab_woven_req_yds,c.fab_woven_fin_req_yds,c.fab_yarn_req_kg,a.remarks from wo_po_details_master a, wo_pre_cost_mst b left join wo_pre_cost_sum_dtls c on   b.job_no=c.job_no where a.job_no=b.job_no  and a.status_active=1 $job_no $company_name $cbo_buyer_name  $txt_costing_date order by a.job_no";
	}
	if ($db_type == 2) {
		$sql = "select a.job_no,b.id,a.company_name,a.buyer_name,a.style_ref_no,a.gmts_item_id,a.order_uom,a.job_quantity,a.avg_unit_price,b.costing_per,b.budget_minute,b.approved,b.sew_smv,b.exchange_rate,b.sew_effi_percent,c.fab_knit_req_kg,c.fab_knit_fin_req_kg,c.fab_woven_req_yds,c.fab_woven_fin_req_yds,c.fab_yarn_req_kg,b.remarks from wo_po_details_master a, wo_pre_cost_mst b left join wo_pre_cost_sum_dtls c on   b.job_no=c.job_no where a.job_no=b.job_no and a.status_active=1 $job_no $company_name $cbo_buyer_name  order by a.job_no";
	}


	$data_array = sql_select($sql);

	ob_start();
	$uom = "";
	$sew_effi_percent = 0;
	$sew_smv = 0;
	$exchange_rate = 0;
	$remarks = "";
	$mst_id = 0;
	foreach ($data_array as $row) {
		$order_price_per_dzn = 0;
		$order_job_qnty = 0;
		$avg_unit_price = 0;
		$sew_effi_percent = $row[csf("sew_effi_percent")];
		$sew_smv = $row[csf("sew_smv")];
		$exchange_rate = $row[csf("exchange_rate")];
		$remarks = $row[csf("remarks")];
		$mst_id = $row[csf("id")];


		$order_values = $row[csf("job_quantity")] * $row[csf("avg_unit_price")];
		$result = sql_select("select po_number,grouping,file_no,pub_shipment_date from wo_po_break_down where job_no_mst=$txt_job_no and status_active=1 and is_deleted=0 order by pub_shipment_date DESC");
		$job_in_orders = '';
		$pulich_ship_date = '';
		$job_in_file = '';
		$job_in_ref = '';
		foreach ($result as $val) {
			$job_in_orders .= $val[csf('po_number')] . ", ";
			$pulich_ship_date = $val[csf('pub_shipment_date')];
			$job_in_ref .= $val[csf('grouping')] . ",";
			$job_in_file .= $val[csf('file_no')] . ",";
		}
		$job_in_orders = substr(trim($job_in_orders), 0, -1);

		$job_ref = array_unique(explode(",", rtrim($job_in_ref, ", ")));
		$job_file = array_unique(explode(",", rtrim($job_in_file, ", ")));

		foreach ($job_ref as $ref) {
			$ref_cond .= ", " . $ref;
		}
		$file_con = '';
		foreach ($job_file as $file) {
			if ($file_con == '') $file_cond = $file;
			else $file_cond .= ", " . $file;
		}

		$img_path = (str_replace("'", "", $path)) ? str_replace("'", "", $path) : '../';

?>
		<table style="width:850px">
			<tr>
				<td colspan="6" align="center">
					<?
					$image_location = return_field_value("image_location", "common_photo_library", "file_type=1 and form_name='company_details' and master_tble_id=$cbo_company_name", "image_location");
					?>
					<img src='<?= $img_path ?><? echo $image_location; ?>' height='70' align="left" />
					<b style="font-size:25px;"><? echo $comp[str_replace("'", "", $cbo_company_name)]; ?></b><br>
					<b style="font-size:14px;">Budget </b>
				</td>
			</tr>
		</table>


		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px" rules="all">
			<tr>
				<td width="80">Job Number</td>
				<td width="80"><b><? echo $row[csf("job_no")]; ?></b></td>
				<td width="90">Buyer</td>
				<td width="100"><b><? echo $buyer_arr[$row[csf("buyer_name")]]; ?></b></td>
				<td width="80">Garments Item</td>
				<?
				$grmnt_items = "";
				if ($garments_item[$row[csf("gmts_item_id")]] == "") {

					$grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no=$txt_job_no");
					foreach ($grmts_sql as $key => $val) {
						$grmnt_items .= $garments_item[$val[csf("gmts_item_id")]] . ", ";
					}
					$grmnt_items = substr_replace($grmnt_items, "", -1, 1);
				} else {
					$grmnt_items = $garments_item[$row[csf("gmts_item_id")]];
				}

				?>
				<td width="100"><b><? echo $grmnt_items; ?></b></td>
			</tr>
			<tr>
				<td>Style Ref. No </td>
				<td colspan="3"><b><? echo $row[csf("style_ref_no")]; ?></b></td>

				<td>Job Qnty</td>
				<td><b><? $uom = $row[csf("order_uom")];
						echo $row[csf("job_quantity")] . " " . $unit_of_measurement[$row[csf("order_uom")]]; ?></b></td>
			</tr>
			<tr>
				<td>Order Numbers</td>
				<td colspan="3"><? echo $job_in_orders; ?></td>
				<td>Plan Cut Qnty</td>
				<td><b><? $uom = $row[csf("order_uom")];
						echo $po_plun_cut_qty / $total_set_qnty . " " . $unit_of_measurement[$row[csf("order_uom")]]; ?></b></td>
			</tr>
			<tr>
				<td>Knit Fabric Cons</td>
				<td><b><? echo $row[csf("fab_knit_req_kg")];
						$fab_knit_req_kg_avg += $row[csf("fab_knit_req_kg")]; ?> (Kg)</b></td>

				<td>Woven Fabric Cons</td>
				<td><b><? echo $row[csf("fab_woven_req_yds")];
						$fab_woven_req_yds_avg += $row[csf("fab_woven_req_yds")]; ?> (Yds)</b></td>
				<td>Price Per Unit</td>
				<td><b><? echo $row[csf("avg_unit_price")]; ?> USD</b></td>
			</tr>
			<tr>
				<td>Avg Yarn Req</td>
				<td><b><? echo $row[csf("fab_yarn_req_kg")] ?> (Kg)</b></td>
				<td>Costing Per</td>
				<td><b><? echo $costing_per[$row[csf("costing_per")]]; ?></b></td>
				<td>Shipment Date </td>
				<td><b><? echo change_date_format($pulich_ship_date); ?></b></td>
			</tr>
			<tr>
				<td>Knit Fin Fabric Cons</td>
				<td><b><? echo $row[csf("fab_knit_fin_req_kg")] ?> (Kg)</b></td>
				<td>Woven Fin Fabric Cons</td>
				<td><b><? echo $row[csf("fab_woven_fin_req_yds")]; ?>(Yds)</b></td>
				<td>GSM </td>
				<td><b><? //echo $gsm_weight_top.",".$gsm_weight_bottom

						$gsm_weights_top = implode(",", array_unique(explode(",", $gsm_weight_top)));
						$gsm_weight_bottom = implode(",", array_unique(explode(",", $gsm_weight_bottom)));
						if ($gsm_weights_top != '') $gsm_weightTop = $gsm_weights_top;
						else $gsm_weightTop = '';
						if ($gsm_weight_bottom != '' && $gsm_weights_top != '') $gsm_weightBottom = " ," . $gsm_weight_bottom;
						else if ($gsm_weight_bottom != '' && $gsm_weights_top == '') $gsm_weightBottom = $gsm_weight_bottom;
						else $gsm_weightBottom = '';
						echo $gsm_weightTop . $gsm_weightBottom;
						?></b></td>

			</tr>
			<tr>
				<td>SMV</td>
				<td><b><? echo number_format($row[csf("sew_smv")], 2); ?> </b></td>
				<td>CPM</td>
				<td><b><? echo $cpm; ?> </b></td>
				<td>Budget Minute</td>
				<td><b><? echo $row[csf("budget_minute")] ?> </b></td>
			</tr>

			<tr>
				<td>Efficiency</td>
				<td colspan="1"><b><? echo $row[csf("sew_effi_percent")] ?> </b></td>
				<td>Internal Ref</td>
				<td colspan="1"><b><? echo ltrim($ref_cond, ", "); ?> </b></td>
				<?
				$amount = $row[csf("job_quantity")] * $row[csf("avg_unit_price")];
				?>
				<td>Amount</td>
				<td colspan="1"><b><? echo fn_number_format($amount, 2); ?></b></td>
			</tr>
			<tr>
				<td align="center" height="10" colspan="6" valign="top" id="app_sms" style="font-size:18px;">
					<font color="#FF0000"><?



											$ap_msg = "";
											if ($row[csf("approved")] == 1) {
												$ap_msg = "This Job Is Full Approved.";
											} else if ($row[csf("approved")] == 3) {
												$approval_allow = sql_select("select b.id, b.page_id, b.approval_need, b.allow_partial, b.validate_page,a.setup_date from approval_setup_mst a,approval_setup_dtls b where a.id=b.mst_id and a.company_id='$company_id' and a.status_active=1 and b.page_id=25 and b.status_active=1 and b.is_deleted=0 order by b.id desc ");
												if ($approval_allow[0][csf("approval_need")] == 1 && $approval_allow[0][csf("allow_partial")] == 1) {
													$ap_msg = "This Job Is Approved.";
												} else {
													$ap_msg = "This Job Partially Approved.";
												}
											} else {
												$ap_msg = " ";
											}
											echo $ap_msg;


											?> </font>
				</td>
			</tr>
		</table>
		<?
		if ($row[csf("costing_per")] == 1) {
			$order_price_per_dzn = 12;
			$costing_for = " DZN";
		} else if ($row[csf("costing_per")] == 2) {
			$order_price_per_dzn = 1;
			$costing_for = " PCS";
		} else if ($row[csf("costing_per")] == 3) {
			$order_price_per_dzn = 24;
			$costing_for = " 2 DZN";
		} else if ($row[csf("costing_per")] == 4) {
			$order_price_per_dzn = 36;
			$costing_for = " 3 DZN";
		} else if ($row[csf("costing_per")] == 5) {
			$order_price_per_dzn = 48;
			$costing_for = " 4 DZN";
		}
		$order_job_qnty = $row[csf("job_quantity")];
		$avg_unit_price = $row[csf("avg_unit_price")];
	} //end first foearch


	$lib_designation_arr = return_library_array(" select id,custom_designation from lib_designation", "id", "custom_designation");
	$user_lib_designation_arr = return_library_array("SELECT id,designation from user_passwd", "id", "designation");
	$user_lib_name_arr = return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
	// $mst_id=return_field_value("id as mst_id","wo_pre_cost_mst","id=$mst_id","mst_id");

	$approve_data_array = sql_select("select b.approved_by,min(b.approved_date) as approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=15  group by  b.approved_by order by b.approved_by asc");
	$unapprove_data_array = sql_select("select b.approved_by,b.approved_date,b.un_approved_reason,b.un_approved_date,b.approved_no from   approval_history b where b.mst_id=$mst_id and b.entry_form=15  order by b.approved_date,b.approved_by");


	if (count($approve_data_array) > 0) {
		?>
		<table width="850" class="rpt_table" border="1" cellpadding="0" cellspacing="0" rules="all">
			<thead>
				<tr style="border:1px solid black;">
					<th colspan="5" style="border:1px solid black;">Approval Status</th>
				</tr>
				<tr style="border:1px solid black;">
					<th width="3%" style="border:1px solid black;">Sl</th>
					<th width="40%" style="border:1px solid black;">Name</th>
					<th width="30%" style="border:1px solid black;">Designation</th>
					<th width="27%" style="border:1px solid black;">Approval Date</th>

				</tr>
			</thead>
			<tbody>
				<?
				$i = 1;
				foreach ($approve_data_array as $row) {


				?>
					<tr style="border:1px solid black;">
						<td width="3%" style="border:1px solid black;"><? echo $i; ?></td>
						<td width="40%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]]; ?></td>
						<td width="30%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]]; ?></td>
						<td width="27%" style="border:1px solid black;text-align:center"><? echo date("d-m-Y h:i:s", strtotime($row[csf('approved_date')])); ?></td>

					</tr>
				<?
					$i++;
				}
				?>
			</tbody>
		</table>
	<?
	}
	?>
	<br />
	<?
	$sql_unapproved = sql_select("select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=15 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id=$mst_id");
	//	echo  "select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=15 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id=$mst_id";
	$unapproved_request_arr = array();
	foreach ($sql_unapproved as $rowu) {
		$unapproved_request_arr[$rowu[csf('booking_id')]] = $rowu[csf('approval_cause')];
	}

	if (count($unapprove_data_array) > 0) {
	?>
		<table width="850" class="rpt_table" border="1" cellpadding="0" cellspacing="0" rules="all">
			<thead>
				<tr style="border:1px solid black;">
					<th colspan="6" style="border:1px solid black;">Approval/Un Approval History</th>
				</tr>
				<tr style="border:1px solid black;">
					<th width="3%" style="border:1px solid black;">Sl</th>
					<th width="30%" style="border:1px solid black;">Name</th>
					<th width="20%" style="border:1px solid black;">Designation</th>
					<th width="5%" style="border:1px solid black;">Approval Status</th>
					<th width="20%" style="border:1px solid black;">Reason For Un Approval</th>
					<th width="22%" style="border:1px solid black;"> Date</th>
				</tr>
			</thead>
			<tbody>
				<?
				$i = 1;
				foreach ($unapprove_data_array as $row) {

				?>
					<tr style="border:1px solid black;">
						<td width="3%" style="border:1px solid black;"><? echo $i; ?></td>
						<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]]; ?></td>
						<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]]; ?></td>
						<td width="5%" style="border:1px solid black; text-align:center"><? echo 'Yes'; ?></td>
						<td width="20%" style="border:1px solid black;"><? echo ''; ?></td>
						<td width="22%" style="border:1px solid black;text-align:center"><? if ($row[csf('approved_date')] != "") echo date("d-m-Y h:i:s", strtotime($row[csf('approved_date')]));
																							else echo ""; ?></td>
					</tr>
					<?
					$i++;
					$un_approved_date = explode(" ", $row[csf('un_approved_date')]);
					$un_approved_date = $un_approved_date[0];
					if ($db_type == 0) //Mysql
					{
						if ($un_approved_date == "" || $un_approved_date == "0000-00-00") $un_approved_date = "";
						else $un_approved_date = $un_approved_date;
					} else {
						if ($un_approved_date == "") $un_approved_date = "";
						else $un_approved_date = $un_approved_date;
					}

					if ($un_approved_date != "") {
					?>
						<tr style="border:1px solid black;">
							<td width="3%" style="border:1px solid black;"><? echo $i; ?></td>
							<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]]; ?></td>
							<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]]; ?></td>
							<td width="5%" style="border:1px solid black;text-align:center;"><? echo 'No'; ?></td>
							<td width="20%" style="border:1px solid black;text-align:center"><? echo $row[csf('un_approved_reason')]; //$unapproved_request_arr[$mst_id];
																								?></td>
							<td width="22%" style="border:1px solid black;text-align:center"><? if ($row[csf('un_approved_date')] != "") echo date("d-m-Y h:i:s", strtotime($row[csf('un_approved_date')]));
																								else echo ""; ?></td>
						</tr>

				<?
						$i++;
					}
				}
				?>
			</tbody>
		</table>
	<?
	}
	?>
	<br>


	<?

	//start	all summary report here -------------------------------------------
	$sql = "select fabric_cost,fabric_cost_percent,trims_cost,trims_cost_percent,embel_cost,embel_cost_percent,wash_cost,wash_cost_percent,comm_cost,comm_cost_percent,commission,commission_percent, lab_test,lab_test_percent,inspection,inspection_percent,cm_cost,cm_cost_percent,freight,freight_percent,currier_pre_cost,currier_percent,certificate_pre_cost,certificate_percent,common_oh,common_oh_percent,total_cost ,total_cost_percent,price_dzn,price_dzn_percent,margin_dzn,margin_dzn_percent,price_pcs_or_set,price_pcs_or_set_percent,margin_pcs_set, margin_pcs_set_percent,cm_for_sipment_sche,design_cost,design_percent, studio_cost, studio_percent, common_oh, common_oh_percent, depr_amor_pre_cost, depr_amor_po_price,interest_cost, interest_percent, incometax_cost, incometax_percent,margin_pcs_bom, margin_bom_per,incentives_pre_cost,incentives_pre_cost_per from wo_pre_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";

	//echo $sql;

	$data_array = sql_select($sql);
	$others_cost_value = 0;
	$fabric_cost = 0;
	$trims_cost = 0;
	$embel_cost = 0;
	$comm_cost = 0;
	$commission = 0;
	$lab_test = 0;
	$inspection = 0;
	$cm_cost = 0;
	$freight = 0;
	$currier_pre_cost = 0;
	$certificate_pre_cost = 0;
	$common_oh = 0;
	$margin_pcs_bom = 0;
	$margin_bom_per = 0;
	?>

	<div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
			<tr style="font-weight:bold">
				<td width="80">SL</td>
				<td width="300">Particulars</td>
				<td width="100">Cost</td>
				<td width="100">Amount (USD)</td>
				<td width="180">% to Ord. Value</td>
			</tr>
			<?
			$price_dzn = 0;
			$sl = 0;
			foreach ($data_array as $row) {
				$fabric_cost = $row[csf("fabric_cost")];
				$trims_cost = $row[csf("trims_cost")];
				$embel_cost = $row[csf("embel_cost")];
				$comm_cost = $row[csf("comm_cost")];
				$commission = $row[csf("commission")];
				$lab_test = $row[csf("lab_test")];
				$inspection = $row[csf("inspection")];
				$cm_cost = $row[csf("cm_cost")];
				$freight = $row[csf("freight")];
				$currier_pre_cost = $row[csf("currier_pre_cost")];
				$certificate_pre_cost = $row[csf("certificate_pre_cost")];
				$common_oh = $row[csf("common_oh")];
				$margin_pcs_bom = $row[csf("margin_pcs_bom")];
				$margin_bom_per = $row[csf("margin_bom_per")];
				$sl = $sl + 1;
				$others_cost_value = $row[csf("total_cost")] - $row[csf("cm_cost")] - $row[csf("freight")] - $row[csf("comm_cost")] - $row[csf("commission")];
				if ($zero_value == 1) {

			?>
					<tr>
						<td><? echo $sl; ?></td>
						<td align="left"><b>Order Price</b></td>
						<td></td>
						<td align="right"><b><? echo fn_number_format($row[csf("price_dzn")], 4);
												$price_dzn = $row[csf("price_dzn")]; //$avg_unit_price*$order_price_per_dzn 
												?></b></td>
						<td align="center"><? echo ""; ?></td>
					</tr>
					<tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left"><b>Less Commision/<? echo $costing_for; ?></b></td>
						<td></td>
						<td align="right"><b><? echo fn_number_format($commission, 4); //$avg_unit_price*$order_price_per_dzn 
												?></b></td>
						<td align="center"><? echo ""; ?></td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left"><b>Net Order Price/<? echo $costing_for; ?></b></td>
						<td></td>
						<td align="right"><b><?
												$net_order = $row[csf("price_dzn")] - $commission;
												echo fn_number_format($row[csf("price_dzn")] - $commission, 4);
												$price_dzn = $row[csf("price_dzn")];
												$net_order_price = $row[csf("price_dzn")]; ?></b></td>
						<td align="center"><? echo "100.00%"; ?></td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">All Fabric Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("fabric_cost")], 4); ?></td>
						<td align="right" rowspan="13">&nbsp;</td>
						<td align="center"><? echo fn_number_format(($row[csf("fabric_cost")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>

					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Trims Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("trims_cost")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("trims_cost")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Embellishment Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("embel_cost")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("embel_cost")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Gmts Wash</td>
						<td align="right"><? echo fn_number_format($row[csf("wash_cost")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("wash_cost")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Commercial Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("comm_cost")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("comm_cost")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Lab Test</td>
						<td align="right"><? echo fn_number_format($row[csf("lab_test")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("lab_test")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Inspection Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("inspection")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("inspection")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">CM Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("cm_cost")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("cm_cost")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Freight Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("freight")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("freight")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Currier Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("currier_pre_cost")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("currier_pre_cost")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>

					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Certificate Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("certificate_pre_cost")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("certificate_pre_cost")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>

					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Design Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("design_cost")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("design_cost")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Studio Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("studio_cost")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("studio_cost")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Operating Expenses </td>
						<td align="right"><? echo fn_number_format($row[csf("common_oh")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("common_oh")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Deprec. & Amort.</td>
						<td align="right"><? echo fn_number_format($row[csf("depr_amor_pre_cost")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("depr_amor_pre_cost")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Interest</td>
						<td align="right"><? echo fn_number_format($row[csf("interest_cost")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("interest_cost")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Income Tax </td>
						<td align="right"><? echo fn_number_format($row[csf("incometax_cost")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("incometax_cost")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Office OH </td>
						<td align="right"><? echo fn_number_format($row[csf("common_oh")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("common_oh")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Incentives Missing Cost </td>
						<td align="right"><? echo fn_number_format($row[csf("incentives_pre_cost")], 4); ?></td>
						<td align="center"><? echo fn_number_format(($row[csf("incentives_pre_cost")] / $net_order_price) * 100, 2); ?>%</td>
					</tr>

					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left"><b>Total Cost (4:21)</b></td>
						<td>&nbsp;</td>
						<td align="right"><b><? echo fn_number_format($row[csf("total_cost")], 4); ?></b></td>
						<td align="center"><b><? $total_cost_per = $row[csf("total_cost")];
												echo fn_number_format(($total_cost_per / $net_order_price) * 100, 2); ?>%</b></td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Margin/<? echo $costing_for; ?> (3-22)</td>
						<td>&nbsp;</td>
						<td align="right"><? echo fn_number_format($row[csf("margin_dzn")], 4); ?></td>
						<td align="center"><b><? $margin_dzn_percent = ($row[csf("margin_dzn")] / $net_order_price) * 100;
												echo fn_number_format($margin_dzn_percent, 2); ?>%</b></td>
					</tr>

					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Price /<? echo $costing_for; ?></td>
						<td>&nbsp;</td>
						<td align="right"><? echo fn_number_format($row[csf("price_pcs_or_set")], 4); ?></td>
						<td align="right"></td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Cost /<? echo $costing_for; ?></td>
						<td>&nbsp;</td>
						<td align="right"><? echo fn_number_format($row[csf("total_cost")] / $order_price_per_dzn, 4); ?></td>
						<td align="center"></td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Margin/<? echo $costing_for; ?></td>
						<td>&nbsp;</td>
						<td align="right"><? echo fn_number_format($row[csf("margin_pcs_set")], 4); ?></td>
						<td align="right"></td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">BOM Margin/<? echo $costing_for; ?></td>
						<td>&nbsp;</td>
						<td align="right"><? echo fn_number_format($margin_pcs_bom, 4); ?></td>
						<td align="right"><? //echo fn_number_format($margin_bom_per,2); 
											?></td>
					</tr>

				<?
				} else {
				?>
					<tr>
						<td><? echo $sl; ?></td>
						<td align="left"><b>Order Price/<? echo $costing_for; ?></b></td>
						<td></td>
						<td align="right"><b><? echo fn_number_format($row[csf("price_dzn")], 4); //$avg_unit_price*$order_price_per_dzn 
												?></b></td>
						<td align="center"><? echo "100.00%"; ?></td>
					</tr>
					<?
					if ($row[csf("fabric_cost")] != 0) {
					?>
						<tr>
							<td><? echo ++$sl; ?></td>
							<td align="left">All Fabric Cost</td>
							<td align="right"><? echo fn_number_format($row[csf("fabric_cost")], 4); ?></td>
							<td align="right">&nbsp;</td>
							<td align="center"><? echo fn_number_format($row[csf("fabric_cost_percent")], 2); ?>%</td>
						</tr>
					<?
					}
					if ($row[csf("trims_cost")] != 0) {
					?>

						<tr>
							<td><? echo ++$sl; ?></td>
							<td align="left">Trims Cost</td>
							<td align="right"><? echo fn_number_format($row[csf("trims_cost")], 4); ?></td>
							<td align="right">&nbsp;</td>
							<td align="center"><? echo fn_number_format($row[csf("trims_cost_percent")], 2); ?>%</td>
						</tr>
					<?
					}
					if ($row[csf("embel_cost")] != 0) {
					?>
						<tr>
							<td><? echo ++$sl; ?></td>
							<td align="left">Embellishment Cost</td>
							<td align="right"><? echo fn_number_format($row[csf("embel_cost")], 4); ?></td>
							<td align="right">&nbsp;</td>
							<td align="center"><? echo fn_number_format($row[csf("embel_cost_percent")], 2); ?>%</td>
						</tr>
					<?
					}
					if ($row[csf("wash_cost")] != 0) {
					?>
						<tr>
							<td><? echo ++$sl; ?></td>
							<td align="left">Gmts Wash</td>
							<td align="right"><? echo fn_number_format($row[csf("wash_cost")], 4); ?></td>
							<td align="center"><? echo fn_number_format($row[csf("wash_cost_percent")], 2); ?>%</td>
						</tr>

					<?
					}
					if ($row[csf("comm_cost")] != 0) {
					?>
						<tr>
							<td><? echo ++$sl; ?></td>
							<td align="left">Commercial Cost</td>
							<td align="right"><? echo fn_number_format($row[csf("comm_cost")], 4); ?></td>
							<td align="right">&nbsp;</td>
							<td align="center"><? echo fn_number_format($row[csf("comm_cost_percent")], 2); ?>%</td>
						</tr>
					<?
					}
					if ($row[csf("commission")] != 0) {
					?>
						<tr>
							<td><? echo ++$sl; ?></td>
							<td align="left">Commission Cost</td>
							<td align="right"><? echo fn_number_format($row[csf("commission")], 4); ?></td>
							<td align="right">&nbsp;</td>
							<td align="center"><? echo fn_number_format($row[csf("commission_percent")], 2); ?>%</td>
						</tr>
					<?
					}
					if ($row[csf("lab_test")] != 0) {
					?>
						<tr>
							<td><? echo ++$sl; ?></td>
							<td align="left">Lab Test</td>
							<td align="right"><? echo fn_number_format($row[csf("lab_test")], 4); ?></td>
							<td align="right">&nbsp;</td>
							<td align="center"><? echo fn_number_format($row[csf("lab_test_percent")], 2); ?>%</td>
						</tr>
					<?
					}
					if ($row[csf("inspection")] != 0) {
					?>
						<tr>
							<td><? echo ++$sl; ?></td>
							<td align="left">Inspection Cost</td>
							<td align="right"><? echo fn_number_format($row[csf("inspection")], 4); ?></td>
							<td align="right">&nbsp;</td>
							<td align="center"><? echo fn_number_format($row[csf("inspection_percent")], 2); ?>%</td>
						</tr>
					<?
					}
					if ($row[csf("cm_cost")] != 0) {
					?>
						<tr>
							<td><? echo ++$sl; ?></td>
							<td align="left">CM Cost</td>
							<td align="right"><? echo fn_number_format($row[csf("cm_cost")], 4); ?></td>
							<td align="right">&nbsp;</td>
							<td align="center"><? echo fn_number_format($row[csf("cm_cost_percent")], 2); ?>%</td>
						</tr>
					<?
					}
					if ($row[csf("freight")] != 0) {
					?>
						<tr>
							<td><? echo ++$sl; ?></td>
							<td align="left">Freight Cost</td>
							<td align="right"><? echo fn_number_format($row[csf("freight")], 4); ?></td>
							<td align="right">&nbsp;</td>
							<td align="center"><? echo fn_number_format($row[csf("freight_percent")], 2); ?>%</td>
						</tr>
					<?
					}
					if ($row[csf("common_oh")] != 0) {
					?>
						<tr>
							<td><? echo ++$sl; ?></td>
							<td align="left">Office OH </td>
							<td align="right"><? echo fn_number_format($row[csf("common_oh")], 4); ?></td>
							<td align="right">&nbsp;</td>
							<td align="center"><? echo fn_number_format($row[csf("common_oh_percent")], 2); ?>%</td>
						</tr>
					<?
					}
					if ($row[csf("incentives_pre_cost")] != 0) {
					?>
						<tr>
							<td><? echo ++$sl; ?></td>
							<td align="left">Incentives Missing Cost </td>
							<td align="right"><? echo fn_number_format($row[csf("incentives_pre_cost")], 4); ?></td>
							<td align="center"><? echo fn_number_format($row[csf("incentives_pre_cost_per")], 2); ?>%</td>
						</tr>
					<?
					}
					?>

					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left"><b>Total Cost (2:<? echo $sl - 1; ?>)</b></td>
						<td>&nbsp;</td>
						<td align="right"><b><? echo fn_number_format($row[csf("total_cost")], 4); ?></b></td>
						<td align="center"><b><? echo fn_number_format($row[csf("total_cost_percent")], 2); ?>%</b></td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Margin/<? echo $costing_for; ?> (1-<? echo $sl - 1; ?>)</td>
						<td>&nbsp;</td>
						<td align="right"><? echo fn_number_format($row[csf("margin_dzn")], 4); ?></td>
						<td align="center"><b><? $margin_dzn_percent = ($row[csf("margin_dzn")] / $row[csf("price_dzn")]) * 100;
												echo fn_number_format($margin_dzn_percent, 2); ?>%</b></td>
					</tr>

					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Price / <? echo $costing_for; ?></td>
						<td>&nbsp;</td>
						<td align="right"><? echo fn_number_format($row[csf("price_pcs_or_set")], 4); ?></td>
						<td align="right"></td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Cost /<? echo $costing_for; ?></td>
						<td>&nbsp;</td>
						<td align="right"><? echo fn_number_format($row[csf("total_cost")] / $order_price_per_dzn, 4); ?></td>
						<td align="center"></td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">Margin/<? echo $costing_for; ?></td>
						<td>&nbsp;</td>
						<td align="right"><? echo fn_number_format($row[csf("margin_pcs_set")], 4); ?></td>
						<td align="right"></td>
					</tr>
					<tr>
						<td><? echo ++$sl; ?></td>
						<td align="left">BOM Margin/<? echo $costing_for; ?></td>
						<td>&nbsp;</td>
						<td align="right"><? echo fn_number_format($margin_pcs_bom, 4); ?></td>
						<td align="right"><? //echo fn_number_format($margin_bom_per,2); 
											?></td>
					</tr>
			<?
				}
			}
			?>
		</table>
	</div>
	<?
	//End all summary report here -------------------------------------------

	$process_loss_data = sql_select("select id, po_break_down_id, color_number_id, gmts_sizes, dia_width, item_size, cons, process_loss_percent, requirment, pcs, color_size_table_id, rate, amount, remarks,pre_cost_fabric_cost_dtls_id,job_no from wo_pre_cos_fab_co_avg_con_dtls where job_no=" . $txt_job_no . "  order by id ");

	foreach ($process_loss_data as $row) {
		$process_loss_arr[$row[csf("pre_cost_fabric_cost_dtls_id")]][$row[csf("job_no")]]['avg_process_loss'] = $row[csf("process_loss_percent")];
	}

	$lib_yarn_count_deter_id = return_library_array("select id,fabric_composition_id from lib_yarn_count_determina_mst where status_active=1", "id", "fabric_composition_id");
	$lib_fabric_composition = return_library_array("select id,fabric_composition_name from lib_fabric_composition where status_active=1", "id", "fabric_composition_name");

	$sql = "select id, job_no, body_part_id, fab_nature_id, color_type_id, fabric_description,uom, avg_cons,avg_cons_yarn, fabric_source,gsm_weight, rate, amount,avg_finish_cons,status_active,lib_yarn_count_deter_id,avg_process_loss   from wo_pre_cost_fabric_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";

	$data_array = sql_select($sql);
	$knit_fab = "";
	$woven_fab = "";
	$knit_subtotal_avg_cons = 0;
	$knit_subtotal_amount = 0;
	$woven_subtotal_avg_cons = 0;
	$woven_subtotal_amount = 0;
	$grand_total_amount = 0;
	$i = 3;
	$j = 2;
	foreach ($data_array as $row) {
		$uom = $unit_of_measurement[$row[csf("uom")]];
		$fab_composition_id = $lib_yarn_count_deter_id[$row[csf("lib_yarn_count_deter_id")]];
		$fab_composition = $lib_fabric_composition[$fab_composition_id];
		// $avg_process_loss=$process_loss_arr[$row[csf("id")]][$row[csf("job_no")]]['avg_process_loss'];
		if ($row[csf("fab_nature_id")] == 2) //knit fabrics
		{
			$item_descrition = $body_part[$row[csf("body_part_id")]] . ", " . $color_type[$row[csf("color_type_id")]] . ", " . $row[csf("fabric_description")] . ", " . $row[csf("gsm_weight")];
			if ($row[csf("fabric_source")] != 2) {
				$amount = $row[csf("avg_finish_cons")] * $row[csf("rate")];
			} else {
				$amount = $row[csf("avg_cons")] * $row[csf("rate")];
			}
			$percent_to_order_value = $amount / $price_dzn * 100;
			//echo $amount.'='.$price_dzn;
			$i++;
			$knit_fab .= '<tr>
				<td align="left">' . $item_descrition . '</td>
				<td align="left">' . $fab_composition . '</td>
				<td align="left">' . $fabric_source[$row[csf("fabric_source")]] . '</td>
				<td align="right">' . fn_number_format($row[csf("avg_cons")], 4) . '</td>				
				 <td align="right">' . fn_number_format($row[csf("avg_finish_cons")], 4) . '</td>
				 <td align="right">' . fn_number_format($row[csf("avg_process_loss")], 4) . '</td>
				  <td align="left">' . $uom . '</td>
				<td align="right">' . fn_number_format($row[csf("rate")], 4) . '</td>
				<td align="right">' . fn_number_format($amount, 4) . '</td>
				<td align="right">' . fn_number_format($percent_to_order_value, 2) . '%</td>
			</tr>';
			if ($row[csf("uom")] == 12) {
				$knit_subtotal_avg_cons += $row[csf("avg_cons")];
				$knit_subtotal_avg_cons_yarn += $row[csf("avg_finish_cons")];
				if ($row[csf("fabric_source")] != 2) {
					$knit_subtotal_amount += $row[csf("avg_finish_cons")] * $row[csf("rate")];
				} else {
					$knit_subtotal_amount += $row[csf("avg_cons")] * $row[csf("rate")];
				}
			}
			if ($row[csf("uom")] == 27) {
				$knit_subtotal_avg_cons_yds += $row[csf("avg_cons")];
				$knit_subtotal_avg_cons_yarn_yds += $row[csf("avg_finish_cons")];
				if ($row[csf("fabric_source")] != 2) {
					$knit_subtotal_amount_yds += $row[csf("avg_finish_cons")] * $row[csf("rate")];
				} else {
					$knit_subtotal_amount_yds += $row[csf("avg_cons")] * $row[csf("rate")];
				}
			}
		}

		if ($row[csf("fab_nature_id")] == 3) //woven fabrics
		{
			$item_descrition = $body_part[$row[csf("body_part_id")]] . ", " . $color_type[$row[csf("color_type_id")]] . ", " . $row[csf("fabric_description")] . ", " . $row[csf("gsm_weight")];
			$amount = $row[csf("avg_finish_cons")] * $row[csf("rate")];
			$percent_to_order_value = $amount / $price_dzn * 100;
			$j++;
			$woven_fab .= '<tr>
				<td align="left">' . $item_descrition . '</td>
				<td align="left">' . $fab_composition . '</td>
				<td align="left">' . $fabric_source[$row[csf("fabric_source")]] . '</td>
				<td align="right">' . fn_number_format($row[csf("avg_cons")], 4) . '</td>					
				<td align="right">' . fn_number_format($row[csf("avg_finish_cons")], 4) . '</td>
				<td align="right">' . fn_number_format($row[csf("avg_process_loss")], 4) . '</td>
				 <td align="left">' . $uom . '</td>
				<td align="right">' . fn_number_format($row[csf("rate")], 4) . '</td>
				<td align="right">' . fn_number_format($amount, 4) . '</td>
				<td align="right">' . fn_number_format($percent_to_order_value, 2) . '%</td>
			</tr>';

			$woven_subtotal_avg_cons += $row[csf("avg_cons")];
			$woven_subtotal_avg_cons_yarn += $row[csf("avg_finish_cons")];
			$woven_subtotal_amount += $row[csf("avg_finish_cons")] * $row[csf("rate")];
		}
	}

	$knit_fab = '<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<label><b>All Fabric Cost  </b></label>
					<tr style="font-weight:bold"  align="center">
						<td width="80" rowspan="' . $i . '" ><div class="verticalText"><b>Knit Fabric</b></div></td>
						<td width="350">Description</td>
						<td width="350">Fabric Composition</td>
						<td width="100">Source</td>
						<td width="100">Fab. Cons/' . $costing_for . '</td>
						<td width="100">Avg. Fab. Cons/' . $costing_for . '</td>
						<td width="100">Avg. Process Loss</td>
						<td width="100">UOM</td>
						<td width="100">Rate [USD]</td>
						<td width="100">Amount [USD]</td>
						<td width="100">% to Ord. Value</td>
					</tr>' . $knit_fab;
	$woven_fab = '<tr><td colspan="10">&nbsp;</td></tr><tr>
					<td width="80" rowspan="' . $j . '"><div class="verticalText"><b>Woven Fabric</b></div></td></tr>' . $woven_fab;

	//knit fabrics table here
	$fab_knit_req_kg_avg_amount = $knit_subtotal_amount / $knit_subtotal_avg_cons * $fab_knit_req_kg_avg;
	$knit_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="3" align="left">Sub Total [Kg]</td>
					<td align="right">' . fn_number_format($knit_subtotal_avg_cons, 4) . '</td>
					<td align="right">' . fn_number_format($knit_subtotal_avg_cons_yarn, 4) . '</td>
					<td></td>
					<td></td>
					<td></td>
					<td align="right">' . fn_number_format($knit_subtotal_amount, 4) . '</td>
					<td align="right">' . fn_number_format($knit_subtotal_amount / $price_dzn * 100, 2) . '%</td>
				</tr>';
	$knit_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="3" align="left">Sub Total[Yds]</td>
					<td align="right">' . fn_number_format($knit_subtotal_avg_cons_yds, 4) . '</td>
					<td align="right">' . fn_number_format($knit_subtotal_avg_cons_yarn_yds, 4) . '</td>
					<td></td>
					<td></td>
					<td></td>
					<td align="right">' . fn_number_format($knit_subtotal_amount_yds, 4) . '</td>
					<td align="right">' . fn_number_format($knit_subtotal_amount_yds / $price_dzn * 100, 2) . '%</td>
				</tr>';
	/*$knit_fab .='<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="2" align="left">Sub Total (Avg)</td>
					<td align="right">'.fn_number_format($fab_knit_req_kg_avg,4).'</td>
					<td align="right">'.fn_number_format($fab_knit_req_kg_avg,4).'</td>
					<td></td>
					<td align="right">'.fn_number_format($fab_knit_req_kg_avg_amount,4).'</td>
				</tr>';*/
	if ($zero_value == 1) {
		echo $knit_fab;
	} else {
		if ($row[csf("avg_cons")] > 0) {
			echo $knit_fab;
		} else {
			echo "";
		}
	}

	//woven fabrics table here
	$fab_woven_req_yds_avg_amount = $woven_subtotal_amount / $woven_subtotal_avg_cons * $fab_woven_req_yds_avg;
	$woven_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="3" align="left">Sub Total</td>
						<td align="right">' . fn_number_format($woven_subtotal_avg_cons, 4) . '</td>
						<td align="right">' . fn_number_format($woven_subtotal_avg_cons_yarn, 4) . '</td>
						<td></td>
						<td></td>
						<td></td>
						<td align="right">' . fn_number_format($woven_subtotal_amount, 4) . '</td>
						<td align="right">' . fn_number_format($woven_subtotal_amount / $price_dzn * 100, 2) . '%</td>
					</tr>';
	/*$woven_fab .='<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="2" align="left">Sub Total (Avg)</td>
						<td align="right">'.fn_number_format($fab_woven_req_yds_avg,4).'</td>
						<td align="right">'.fn_number_format($fab_woven_req_yds_avg,4).'</td>
						<td></td>
						<td align="right">'.fn_number_format($fab_woven_req_yds_avg_amount,4).'</td>
					</tr>';*/
	$woven_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="5" align="left">Total</td>
						<td align="right"></td>
						<td></td>
						<td></td>
						<td></td>
						<td align="right">' . fn_number_format(($woven_subtotal_amount + $knit_subtotal_amount + $knit_subtotal_amount_yds), 4) . '</td>
						<td align="right">' . fn_number_format((($woven_subtotal_amount + $knit_subtotal_amount + $knit_subtotal_amount_yds) / $price_dzn * 100), 2) . '%</td>
					</tr></table></div>';
	/*$woven_fab .='<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="4" align="left">Total (Avg)</td>
						<td align="right"></td>
						<td></td>
						<td align="right">'.fn_number_format(($fab_woven_req_yds_avg_amount+$fab_knit_req_kg_avg_amount),4).'</td>
					</tr></table></div>';*/
	// echo $woven_fab;
	if ($zero_value == 1) {
		echo $woven_fab;
	} else {
		if ($row[csf("avg_cons")] > 0) {
			echo $woven_fab;
		} else {
			echo "";
		}
	}
	$grand_total_amount = $knit_subtotal_amount + $woven_subtotal_amount + $knit_subtotal_amount_yds;
	//end 	All Fabric Cost part report-------------------------------------------

	//Start	Yarn Cost part report here -------------------------------------------
	$lib_yarn_count = return_library_array("select yarn_count,id from lib_yarn_count", "id", "yarn_count");
	//mysql
	/*$sql = "select id, count_id, copm_one_id, percent_one, copm_two_id, percent_two, type_id, cons_ratio, sum(cons_qnty) as cons_qnty, rate, sum(amount) as amount
				from wo_pre_cost_fab_yarn_cost_dtls
				where job_no=".$txt_job_no." group by count_id, copm_one_id, percent_one, copm_two_id, percent_two, type_id, rate";*/
	//oracle
	$sql = "select min(id) as id, count_id, copm_one_id, percent_one, copm_two_id, percent_two,color,type_id, min(cons_ratio) as cons_ratio , sum(cons_qnty) as cons_qnty,sum(avg_cons_qnty) as avg_cons_qnty, rate, sum(amount) as amount	from wo_pre_cost_fab_yarn_cost_dtls	where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0 group by count_id, copm_one_id, percent_one, copm_two_id, percent_two,color, type_id, rate";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
	?>
		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<tr style="font-weight:bold">
					<td width="70" rowspan="<?= count($data_array) + 2; ?>">
						<div class="verticalText"><b>Yarn Cost</b></div>
					</td>
					<td width="350">Yarn Desc</td>
					<td width="100">Yarn Qty</td>
					<td width="100">Avg.Yarn Qty</td>
					<td width="100">Rate [USD]</td>
					<td width="100">Amount [USD]</td>
					<td width="100">% to Ord. Value</td>
				</tr>
				<?
				$total_qnty = 0;
				$total_avg_qnty = 0;
				$total_amount = 0;
				foreach ($data_array as $row) {
					if ($row[csf("percent_one")] == 100)
						$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];
					else
						$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $composition[$row[csf("copm_two_id")]] . " " . $row[csf("percent_two")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];

				?>
					<tr>
						<td align="left"><? echo $item_descrition; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("cons_qnty")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("avg_cons_qnty")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")] / $price_dzn * 100, 2); ?>%</td>
					</tr>
				<?
					$total_qnty += $row[csf("cons_qnty")];
					$total_avg_qnty += $row[csf("avg_cons_qnty")];
					$total_amount += $row[csf("amount")];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td>Total</td>
					<td align="right"><? echo fn_number_format($total_qnty, 4); ?></td>
					<td align="right"><? echo fn_number_format($total_avg_qnty, 4); ?></td>
					<td></td>
					<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
					<td align="right"><? echo fn_number_format($total_amount / $price_dzn * 100, 2); ?>%</td>
				</tr>
			</table>
		</div>
		<?
		$grand_total_amount += $total_amount;
	} else {
		if ($fabric_cost > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<tr style="font-weight:bold">
						<td width="70" rowspan="<? echo count($data_array) + 2; ?>">
							<div class="verticalText"><b>Yarn Cost</b></div>
						</td>
						<td width="350">Yarn Desc</td>
						<td width="100">Yarn Qnty</td>
						<td width="100">Avg.Yarn Qnty</td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)</td>
						<td width="100">% to Ord. Value</td>
					</tr>
					<?
					$total_qnty = 0;
					$total_amount = 0;
					foreach ($data_array as $row) {
						if ($row[csf("percent_one")] == 100)
							$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];
						else
							$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $composition[$row[csf("copm_two_id")]] . " " . $row[csf("percent_two")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];

					?>
						<tr>
							<td align="left"><? echo $item_descrition; ?></td>
							<td align="right"><? echo fn_number_format($row[csf("cons_qnty")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("avg_cons_qnty")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")] / $price_dzn * 100, 2); ?>%</td>
						</tr>
					<?
						$total_qnty += $row[csf("cons_qnty")];
						$total_avg_qnty += $row[csf("avg_cons_qnty")];
						$total_amount += $row[csf("amount")];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td>Total</td>
						<td align="right"><? echo fn_number_format($total_qnty, 4); ?></td>
						<td align="right"><? echo fn_number_format($total_avg_qnty, 4); ?></td>
						<td></td>
						<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
						<td align="right"><? echo fn_number_format($total_amount / $price_dzn * 100, 2); ?>%</td>
					</tr>
				</table>
			</div>
		<?
			$grand_total_amount += $total_amount;
		} else {
			echo "";
		}
	}
	//End Yarn Cost part report here -------------------------------------------

	//start	Conversion Cost to Fabric report here -------------------------------------------
	$sql = "select a.id,a.fabric_description as fabric_description_id, a.job_no, a.cons_process, a.req_qnty,a.avg_req_qnty, a.charge_unit, a.amount, a.status_active,b.body_part_id,b.fab_nature_id,b.color_type_id,b.fabric_description
			from wo_pre_cost_fab_conv_cost_dtls a left join wo_pre_cost_fabric_cost_dtls b on a.job_no=b.job_no and a.fabric_description=b.id and b.status_active=1 and b.is_deleted=0
			where a.job_no=" . $txt_job_no . " and a.status_active=1 and a.is_deleted=0";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
		?>
		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<tr style="font-weight:bold">
					<td width="80" rowspan="<? echo count($data_array) + 3; ?>">
						<div class="verticalText"><b>Conversion Cost to Fabric</b></div>
					</td>
					<td width="350">Particulars</td>
					<td width="100">Process</td>
					<td width="100">Cons/<? echo $costing_for; ?></td>
					<td width="100">Avg. Cons/<? echo $costing_for; ?></td>
					<td width="100">Rate (USD)</td>
					<td width="100">Amount (USD)</td>
					<td width="100">% to Ord. Value</td>
				</tr>
				<?
				$total_amount = 0;
				foreach ($data_array as $row) {
					if ($row[csf("fabric_description_id")] != 0) {
						$item_descrition = $body_part[$row[csf("body_part_id")]] . ", " . $color_type[$row[csf("color_type_id")]] . ", " . $row[csf("fabric_description")];
					} else {
						$item_descrition = "All Fabrics";
					}
				?>
					<tr>
						<td align="left"><? echo $item_descrition; ?></td>
						<td align="left"><? echo $conversion_cost_head_array[$row[csf("cons_process")]]; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("req_qnty")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("avg_req_qnty")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("charge_unit")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")] / $price_dzn * 100, 2); ?>%</td>
					</tr>
				<?
					$total_amount += $row[csf("amount")];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="5">Total</td>
					<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
					<td align="right"><? echo  fn_number_format($total_amount / $price_dzn * 100, 2); ?>%</td>
				</tr>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td align="left" colspan="5">Total Fabric Cost</td>
					<td align="right"><? echo fn_number_format(($grand_total_amount + $total_amount), 4); ?></td>
					<td align="right"><? echo fn_number_format((($grand_total_amount + $total_amount) / $price_dzn * 100), 2); ?>%</td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($fabric_cost > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<tr style="font-weight:bold">
						<td width="80" rowspan="<? echo count($data_array) + 3; ?>">
							<div class="verticalText"><b>Conversion Cost to Fabric</b></div>
						</td>
						<td width="350">Particulars</td>
						<td width="100">Process</td>
						<td width="100">Cons/<? echo $costing_for; ?></td>
						<td width="100">Avg. Cons/<? echo $costing_for; ?></td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)</td>
						<td width="100">% to Ord. Value</td>
					</tr>
					<?
					$total_amount = 0;
					foreach ($data_array as $row) {
						if ($row[csf("fabric_description_id")] != 0) {
							$item_descrition = $body_part[$row[csf("body_part_id")]] . ", " . $color_type[$row[csf("color_type_id")]] . ", " . $row[csf("fabric_description")];
						} else {
							$item_descrition = "All Fabrics";
						}
					?>
						<tr>
							<td align="left"><? echo $item_descrition; ?></td>
							<td align="left"><? echo $conversion_cost_head_array[$row[csf("cons_process")]]; ?></td>
							<td align="right"><? echo fn_number_format($row[csf("req_qnty")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("avg_req_qnty")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("charge_unit")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")] / $price_dzn * 100, 2); ?>%</td>
						</tr>
					<?
						$total_amount += $row[csf("amount")];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="5">Total</td>
						<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
						<td align="right"><? echo fn_number_format($total_amount / $price_dzn * 100, 2); ?>%</td>
					</tr>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td align="left" colspan="5">Total Fabric Cost</td>
						<td align="right"><? echo fn_number_format(($grand_total_amount + $total_amount), 4); ?></td>
						<td align="right"><? echo fn_number_format((($grand_total_amount + $total_amount) / $price_dzn * 100), 2); ?>%</td>
					</tr>
				</table>
			</div>
		<?
		} else {
			echo "";
		}
	}
	//End Conversion Cost to Fabric report here -------------------------------------------
	//start	Trims Cost part report here -------------------------------------------
	$sql = "select id, job_no, trim_group,description,brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp,status_active,seq
			from wo_pre_cost_trim_cost_dtls
			where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0 order by seq";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
		?>
		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<label><b>Trims Cost</b></label>
				<tr style="font-weight:bold">
					<td width="150">Item Group</td>
					<td width="150">Description</td>
					<td width="150">Brand/Supp Ref</td>
					<td width="100">UOM</td>
					<td width="100">Cons/<? echo $costing_for; ?></td>
					<td width="100">Rate (USD)</td>
					<td width="100">Amount (USD)</td>
					<td width="100">% to Ord. Value</td>
				</tr>
				<?
				$total_amount = 0;
				foreach ($data_array as $row) {
					$trim_group = return_library_array("select item_name,id from  lib_item_group where id=" . $row[csf("trim_group")], "id", "item_name");

				?>
					<tr>
						<td align="left"><? echo $trim_group[$row[csf("trim_group")]]; ?></td>
						<td align="left"><? echo $row[csf("description")]; ?></td>
						<td align="left"><? echo $row[csf("brand_sup_ref")]; ?></td>
						<td align="left"><? echo $unit_of_measurement[$row[csf("cons_uom")]]; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("cons_dzn_gmts")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")] / $price_dzn * 100, 2); ?>%</td>
					</tr>
				<?
					$total_amount += $row[csf("amount")];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="6">Total</td>
					<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
					<td align="right"><? echo fn_number_format($total_amount / $price_dzn * 100, 2); ?>%</td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($trims_cost > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<label><b>Trims Cost</b></label>
					<tr style="font-weight:bold">
						<td width="150">Item Group</td>
						<td width="150">Description</td>
						<td width="150">Brand/Supp Ref</td>
						<td width="100">UOM</td>
						<td width="100">Cons/<? echo $costing_for; ?></td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)</td>
						<td width="100">% to Ord. Value</td>
					</tr>
					<?
					$total_amount = 0;
					foreach ($data_array as $row) {
						$trim_group = return_library_array("select item_name,id from  lib_item_group where id=" . $row[csf("trim_group")], "id", "item_name");

					?>
						<tr>
							<td align="left"><? echo $trim_group[$row[csf("trim_group")]]; ?></td>
							<td align="left"><? echo $row[csf("description")]; ?></td>
							<td align="left"><? echo $row[csf("brand_sup_ref")]; ?></td>
							<td align="left"><? echo $unit_of_measurement[$row[csf("cons_uom")]]; ?></td>
							<td align="right"><? echo fn_number_format($row[csf("cons_dzn_gmts")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")] / $price_dzn * 100, 2); ?>%</td>
						</tr>
					<?
						$total_amount += $row[csf("amount")];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="6">Total</td>
						<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
						<td align="right"><? echo fn_number_format($total_amount / $price_dzn * 100, 2); ?>%</td>
					</tr>
				</table>
			</div>
		<?
		} else {
			echo "";
		}
	}
	//End Trims Cost Part report here -------------------------------------------
	//start	Embellishment Details part report here -------------------------------------------
	$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active
			from wo_pre_cost_embe_cost_dtls
			where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
		?>
		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<label><b>Embellishment Details</b></label>
				<tr style="font-weight:bold">
					<td width="150">Particulars</td>
					<td width="150">Type</td>
					<td width="150">Cons/<? echo $costing_for; ?></td>
					<td width="100">Rate (USD)</td>
					<td width="100">Amount (USD)</td>
					<td width="100">% to Ord. Value</td>
				</tr>
				<?
				$total_amount = 0;
				foreach ($data_array as $row) {
					$em_type = "";
					//$emblishment_name_array=array(1=>"Printing",2=>"Embroidery",3=>"Wash",4=>"Special Works",5=>"Others");
					if ($row[csf("emb_name")] == 1) $em_type = $emblishment_print_type[$row[csf("emb_type")]];
					else if ($row[csf("emb_name")] == 2) $em_type = $emblishment_embroy_type[$row[csf("emb_type")]];
					else if ($row[csf("emb_name")] == 3) $em_type = $emblishment_wash_type[$row[csf("emb_type")]];
					else if ($row[csf("emb_name")] == 4) $em_type = $emblishment_spwork_type[$row[csf("emb_type")]];
					else if ($row[csf("emb_name")] == 5) $em_type = $emblishment_gmts_type[$row[csf("emb_type")]];
				?>
					<tr>
						<td align="left"><? echo $emblishment_name_array[$row[csf("emb_name")]]; ?></td>
						<td align="left"><? echo $em_type; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("cons_dzn_gmts")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")] / $price_dzn * 100, 2); ?>%</td>
					</tr>
				<?
					$total_amount += $row[csf("amount")];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="4">Total</td>
					<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
					<td align="right"><? echo fn_number_format($total_amount / $price_dzn * 100, 2); ?>%</td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($embel_cost > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<label><b>Embellishment Details</b></label>
					<tr style="font-weight:bold">
						<td width="150">Particulars</td>
						<td width="150">Type</td>
						<td width="150">Cons/<? echo $costing_for; ?></td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)</td>
						<td width="100">% to Ord. Value</td>
					</tr>
					<?
					$total_amount = 0;
					foreach ($data_array as $row) {
						$em_type = "";
						//$emblishment_name_array=array(1=>"Printing",2=>"Embroidery",3=>"Wash",4=>"Special Works",5=>"Others");
						if ($row[csf("emb_name")] == 1) $em_type = $emblishment_print_type[$row[csf("emb_type")]];
						else if ($row[csf("emb_name")] == 2) $em_type = $emblishment_embroy_type[$row[csf("emb_type")]];
						else if ($row[csf("emb_name")] == 3) $em_type = $emblishment_wash_type[$row[csf("emb_type")]];
						else if ($row[csf("emb_name")] == 4) $em_type = $emblishment_spwork_type[$row[csf("emb_type")]];
						else if ($row[csf("emb_name")] == 5) $em_type = $emblishment_gmts_type[$row[csf("emb_type")]];
					?>
						<tr>
							<td align="left"><? echo $emblishment_name_array[$row[csf("emb_name")]]; ?></td>
							<td align="left"><? echo $em_type; ?></td>
							<td align="right"><? echo fn_number_format($row[csf("cons_dzn_gmts")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")] / $price_dzn * 100, 2); ?>%</td>
						</tr>
					<?
						$total_amount += $row[csf("amount")];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="4">Total</td>
						<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
						<td align="right"><? echo fn_number_format($total_amount / $price_dzn * 100, 2); ?>%</td>
					</tr>
				</table>
			</div>
		<?
		} else {
			echo "";
		}
	}
	//End Embellishment Details Part report here -------------------------------------------


	//start	Commercial Cost part report here -------------------------------------------
	$sql = "select id, job_no, item_id, rate, amount, status_active
			from  wo_pre_cost_comarci_cost_dtls
			where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
		?>

		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<label><b>Commercial Cost</b></label>
				<tr style="font-weight:bold">
					<td width="150">Particulars</td>
					<td width="100">Rate In %</td>
					<td width="100">Amount (USD)</td>
				</tr>
				<?
				$total_amount = 0;
				foreach ($data_array as $row) {
				?>
					<tr>
						<td align="left"><? echo $camarcial_items[$row[csf("item_id")]]; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
					</tr>
				<?
					$total_amount += $row[csf("amount")];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="2">Total</td>
					<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($comm_cost > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<label><b>Commercial Cost</b></label>
					<tr style="font-weight:bold">
						<td width="150">Particulars</td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)</td>
					</tr>
					<?
					$total_amount = 0;
					foreach ($data_array as $row) {
					?>
						<tr>
							<td align="left"><? echo $camarcial_items[$row[csf("item_id")]]; ?></td>
							<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
						</tr>
					<?
						$total_amount += $row[csf("amount")];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="2">Total</td>
						<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
					</tr>
				</table>
			</div>
		<?
		} else {
			echo "";
		}
	}
	//End Commercial Cost Part report here -------------------------------------------


	//start	Commission Cost part report here -------------------------------------------
	$sql = "select id,job_no,particulars_id,commission_base_id,commision_rate,commission_amount, status_active
			from  wo_pre_cost_commiss_cost_dtls
			where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
		?>


		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<label><b>Commission Cost</b></label>
				<tr style="font-weight:bold">
					<td width="150">Particulars</td>
					<td width="150">Commission Basis</td>
					<td width="100">Rate (USD)</td>
					<td width="100">Amount (USD)</td>
				</tr>
				<?
				$total_amount = 0;
				foreach ($data_array as $row) {
				?>
					<tr>
						<td align="left"><? echo $commission_particulars[$row[csf("particulars_id")]]; ?></td>
						<td align="left"><? echo $commission_base_array[$row[csf("commission_base_id")]]; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("commision_rate")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("commission_amount")], 4); ?></td>
					</tr>
				<?
					$total_amount += $row[csf("commission_amount")];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="3">Total</td>
					<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($commission > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<label><b>Commission Cost</b></label>
					<tr style="font-weight:bold">
						<td width="150">Particulars</td>
						<td width="150">Commission Basis</td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)</td>
					</tr>
					<?
					$total_amount = 0;
					foreach ($data_array as $row) {
					?>
						<tr>
							<td align="left"><? echo $commission_particulars[$row[csf("particulars_id")]]; ?></td>
							<td align="left"><? echo $commission_base_array[$row[csf("commission_base_id")]]; ?></td>
							<td align="right"><? echo fn_number_format($row[csf("commision_rate")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("commission_amount")], 4); ?></td>
						</tr>
					<?
						$total_amount += $row[csf("commission_amount")];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="3">Total</td>
						<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
					</tr>
				</table>
			</div>
		<?
		} else {
			echo "";
		}
	}
	//End Commission Cost Part report here -------------------------------------------


	//start	Other Components part report here -------------------------------------------

	$sql = "select fabric_cost,fabric_cost_percent,trims_cost,trims_cost_percent,embel_cost,embel_cost_percent,wash_cost,wash_cost_percent,comm_cost,comm_cost_percent,commission,commission_percent, lab_test,lab_test_percent,inspection,inspection_percent,cm_cost,cm_cost_percent,freight,freight_percent,currier_pre_cost,currier_percent,certificate_pre_cost,certificate_percent,common_oh,common_oh_percent,total_cost ,total_cost_percent,price_dzn,price_dzn_percent,margin_dzn,margin_dzn_percent,price_pcs_or_set,price_pcs_or_set_percent,margin_pcs_set, margin_pcs_set_percent,cm_for_sipment_sche,design_cost,design_percent, studio_cost, studio_percent, common_oh, common_oh_percent, depr_amor_pre_cost, depr_amor_po_price,interest_cost, interest_percent, incometax_cost, incometax_percent from wo_pre_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
		?>

		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<label><b>Others Components</b></label>
				<tr style="font-weight:bold">
					<td width="150">Particulars</td>
					<td width="100">Amount (USD)</td>
				</tr>
				<?
				$total_amount = 0;
				foreach ($data_array as $row) {
				?>

					<tr>
						<td align="left" s>Lab Test </td>
						<td align="right"><? echo fn_number_format($row[csf("lab_test")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Inspection Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("inspection")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">CM Cost - IE</td>
						<td align="right"><? echo fn_number_format($row[csf("cm_cost")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Freight Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("freight")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Office OH</td>
						<td align="right"><? echo fn_number_format($row[csf("common_oh")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Currier Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("currier_pre_cost")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Certificate Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("certificate_pre_cost")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Design Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("design_cost")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Studio Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("studio_cost")], 4); ?></td>
					</tr>

					<tr>
						<td align="left">Deprec. & Amort.</td>
						<td align="right"><? echo fn_number_format($row[csf("depr_amor_pre_cost")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Interest</td>
						<td align="right"><? echo fn_number_format($row[csf("interest_cost")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Income Tax </td>
						<td align="right"><? echo fn_number_format($row[csf("incometax_cost")], 4); ?></td>
					</tr>
				<?
					$total_amount += $row[csf("lab_test")] + $row[csf("inspection")] + $row[csf("cm_cost")] + $row[csf("freight")] + $row[csf("common_oh")] + $row[csf("currier_pre_cost")] + $row[csf("certificate_pre_cost")] + $row[csf("design_cost")] + $row[csf("studio_cost")] + $row[csf("depr_amor_pre_cost")] + $row[csf("interest_cost")] + $row[csf("incometax_cost")];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td>Total</td>
					<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($lab_test > 0 || $inspection > 0 || $cm_cost > 0 || $freight > 0 || $common_oh > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<label><b>Others Components</b></label>
					<tr style="font-weight:bold">
						<td width="150">Particulars</td>
						<td width="100">Amount (USD)</td>
					</tr>
					<?
					$total_amount = 0;
					foreach ($data_array as $row) {
						if ($row[csf("lab_test")] > 0) {
					?>


							<tr>
								<td align="left" s>Lab Test </td>
								<td align="right"><? echo fn_number_format($row[csf("lab_test")], 4); ?></td>
							</tr>
						<?
						}
						if ($row[csf("inspection")] > 0) {
						?>
							<tr>
								<td align="left">Inspection Cost</td>
								<td align="right"><? echo fn_number_format($row[csf("inspection")], 4); ?></td>
							</tr>
						<?
						}
						if ($row[csf("cm_cost")] > 0) {
						?>
							<tr>
								<td align="left">CM Cost - IE</td>
								<td align="right"><? echo fn_number_format($row[csf("cm_cost")], 4); ?></td>
							</tr>
						<?
						}
						if ($row[csf("freight")] > 0) {
						?>
							<tr>
								<td align="left">Freight Cost</td>
								<td align="right"><? echo fn_number_format($row[csf("freight")], 4); ?></td>
							</tr>
						<?
						}
						if ($row[csf("common_oh")] > 0) {
						?>
							<tr>
								<td align="left">Office OH</td>
								<td align="right"><? echo fn_number_format($row[csf("common_oh")], 4); ?></td>
							</tr>
					<?
						}
						$total_amount += $row[csf("lab_test")] + $row[csf("inspection")] + $row[csf("cm_cost")] + $row[csf("freight")] + $row[csf("common_oh")];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td>Total</td>
						<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
					</tr>
				</table>
			</div>
	<?
		} else {
			echo "";
		}
	}


	$first_day_this_month = date('01-m-Y', strtotime($txt_costingdate));
	$last_date  = date("t-m-Y", strtotime($txt_costingdate));
	if ($db_type == 0) {
		$start_date = change_date_format(str_replace("'", "", $first_day_this_month), "yyyy-mm-dd", "");
		$end_date = change_date_format(str_replace("'", "", $last_date), "yyyy-mm-dd", "");
	} else if ($db_type == 2) {
		$start_date = change_date_format(str_replace("'", "", $first_day_this_month), "", "", 1);
		$end_date = change_date_format(str_replace("'", "", $last_date), "", "", 1);
	}
	$date_quote_cond = " and applying_period_to_date between '$start_date' and '$end_date'";

	$cpm_cpm_sql = "select id,company_id,cost_per_minute from lib_standard_cm_entry where status_active=1 and is_deleted=0 and company_id=$cbo_company_name $date_quote_cond order by id desc";

	$cpm_cpm = sql_select($cpm_cpm_sql);
	foreach ($cpm_cpm as $row) {
		$tot_cost_per_minute = $row[csf('cost_per_minute')];
	} //var_dump($asking_profit_arr);
	//End Other Components  Part report here -------------------------------------------
	?>
	<div style="clear:both"></div>
	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:300px;text-align:center;float:left;width:30%" rules="all">

		<tr style="font-weight:bold">
			<td colspan="3">CM Details</td>
		</tr>
		<tr style="font-weight:bold">
			<td width="150">CPM</td>
			<td width="50">SMV </td>
			<td width="100"> Eff%</td>
		</tr>
		<tr>
			<td><? echo number_format($tot_cost_per_minute, 4);; ?></td>
			<td><? echo number_format($sew_smv, 2);; ?></td>
			<td><? echo $sew_effi_percent; ?></td>
		</tr>
	</table>
	<table style="float:left;width:65%">
		<tr>

			<td>
				<?
				// image show here  -------------------------------------------
				$sql = "select id,master_tble_id,image_location	from common_photo_library where master_tble_id=" . $txt_job_no . "";
				//  echo $sql;die();
				$data_array = sql_select($sql);

				?>
				<div>
					<? foreach ($data_array as $inf) { ?>
						<img src='<?= $img_path ?><? echo $inf[csf("image_location")]; ?>' height='97' width='89' />
					<?  } ?>
				</div>
			</td>
		</tr>

	</table>

	</div>

	<?
	// Issue-id=5729
	//echo "<br /><b>Note:".$smg." ".$smg2.".</b>"; 

	if ($ws_id != '') {
		$wsids = explode(',', $ws_id);
		$ids = "'" . implode("', '", $wsids) . "'";

		$sql = "SELECT a.id, a.system_no, a.extention_no, a.style_ref, a.operation_count, a.gmts_item_id, b.operator_smv, b.helper_smv, b.body_part_id, b.lib_sewing_id, c.department_code from ppl_gsd_entry_mst a, ppl_gsd_entry_dtls b, lib_sewing_operation_entry c where a.id=b.mst_id and b.lib_sewing_id=c.id and a.approved=1 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and a.id in ($ids) and c.department_code =8 order by a.id DESC";
		//echo $sql; die;
		$sql_result = sql_select($sql);
		$k = array();
		foreach ($sql_result as $row) {
			$smv += $row[csf('operator_smv')] + $row[csf('helper_smv')];
			$k[$row[csf('id')]] = $row[csf('id')];
		}
		$efficiency_data = sql_select("SELECT efficiency from ppl_balancing_mst_entry where gsd_mst_id in ($ids) and efficiency>0 and status_active=1 and is_deleted=0");
		$j = 0;
		foreach ($efficiency_data as $row) {
			$eff += $row[csf('efficiency')];
			$j++;
		}
	?>
		<div style="margin-top:5px; margin-bottom: 5px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:400px;text-align:center;" rules="all">
				<tr>
					<td colspan="3" style="font-size: 20px; font-weight: bold;">CM Cost Details</td>
				</tr>
				<tr>
					<th>Particular</th>
					<th>IE</th>
					<th>Budget</th>
				</tr>
				<tr>
					<td>SMV</td>
					<td><? echo number_format($smv / count($k), 2); ?></td>
					<td><? echo fn_number_format($sew_smv, 2); ?></td>
				</tr>
				<tr>
					<td>Efficiency %</td>
					<td><? echo number_format($eff / $j, 2); ?> %</td>
					<td><? echo number_format($sew_effi_percent, 2); ?> %</td>
				</tr>
				<tr>
					<td>CPM (BDT)</td>
					<td colspan="2"><? echo $tot_cost_per_minute ?></td>
				</tr>
				<tr>
					<td>CPM (USD)</td>
					<td colspan="2"><? echo fn_number_format($tot_cost_per_minute / $exchange_rate, 7) ?></td>
				</tr>
				<tr>
					<td>Exchange Rate</td>
					<td colspan="2"><? echo $exchange_rate; ?></td>
				</tr>
				<tr>
					<td>CM Cost (USD)</td>
					<td><? echo $cm_cost ?></td>
					<td>Per <? echo $unit_of_measurement[$order_uom] ?></td>
				</tr>
			</table>
		</div>
	<? } else { ?>
		<div style="margin-top:5px; margin-bottom: 5px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:400px;text-align:center;" rules="all">
				<tr>
					<td colspan="3" style="font-size: 20px; font-weight: bold;">CM Cost Details</td>
				</tr>
				<tr>
					<th>Particular</th>
					<th width="100">IE</th>
					<th>Budget </th>
				</tr>
				<tr>
					<td>SMV</td>
					<td width="100"></td>
					<td><?= number_format($sew_smv, 2);; ?></td>
				</tr>
				<tr>
					<td>Efficiency %</td>
					<td width="100"></td>
					<td><?= number_format($sew_effi_percent, 2);; ?></td>
				</tr>
				<tr>
					<td>CPM (BDT)</td>
					<td width="100"></td>
					<td colspan="2"><? echo $tot_cost_per_minute ?></td>
				</tr>
				<tr>
					<td>CPM (USD)</td>
					<td width="100"></td>
					<td colspan="2"><? echo number_format($tot_cost_per_minute / $exchange_rate, 4) ?></td>
				</tr>
				<tr>
					<td>Exchange Rate</td>
					<td width="100"></td>
					<td colspan="2"><? echo $exchange_rate; ?></td>
				</tr>
				<tr>
					<td>CM Cost (USD)</td>
					<td width="100"> </td>
					<td><? echo $cm_cost ?></td>
				</tr>
			</table>
		</div>
	<? }




	?>


	<div style="clear:both"></div>
	</div>
	<!--End CM on Net Order Value Part report here -->
	<? echo '<b>Note: &nbsp;' . $remarks; ?></b><br /><br />
	<br />
	<?
	echo signature_table(109, $cbo_company_name, "860px");

	$mailBody = ob_get_contents();
	ob_clean();


	//Mail send------------------------------------------
	list($msil_address, $is_mail_send) = explode('**', $mail_data);
	if ($is_mail_send == 1) {


		$data_array = sql_select("select b.id, b.job_no, b.fabric_cost, b.fabric_cost_percent, b.trims_cost, b.trims_cost_percent, b.embel_cost, b.embel_cost_percent, b.wash_cost, b.wash_cost_percent, b.comm_cost, b.comm_cost_percent, b.commission, b.commission_percent, b.lab_test, b.lab_test_percent, b.inspection, b.inspection_percent, b.cm_cost,  b.freight,  b.currier_pre_cost, b.certificate_pre_cost, b.certificate_percent, b.common_oh, b.depr_amor_pre_cost, b.depr_amor_po_price, b.total_cost, b.total_cost_percent, b.price_dzn, b.price_dzn_percent, b.margin_dzn, b.margin_dzn_percent, b.cost_pcs_set,  b.price_pcs_or_set,  b.margin_pcs_set, b.cm_for_sipment_sche, b.deffdlc_cost,  b.interest_cost,  b.incometax_cost, b.design_cost, b.design_percent, b.studio_cost, c.job_no_prefix_num, c.buyer_name, c.style_ref_no,c.job_quantity, c.quotation_id from wo_pre_cost_mst a ,wo_pre_cost_dtls b,wo_po_details_master c where a.job_no=b.job_no and  a.job_no=c.job_no and a.job_no=" . $txt_job_no . "  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0");



		$material_cost = $data_array[0][csf('fabric_cost')] + $data_array[0][csf('trims_cost')];
		$other_cost = $data_array[0]['LAB_TEST'] + $data_array[0]['INSPECTION'] + $data_array[0]['FREIGHT'] + $data_array[0]['CURRIER_PRE_COST'] + $data_array[0]['CERTIFICATE_PRE_COST'] + $data_array[0]['DESIGN_COST'] + $data_array[0]['STUDIO_COST'] + $data_array[0]['DEPR_AMOR_PRE_COST'] + $data_array[0]['INTEREST_COST'] + $data_array[0]['INCOMETAX_COST'] + $data_array[0]['COMMON_OH'];
		$quotation_id = $data_array[0][csf('quotation_id')];





		$bodymail = "
			<p>Dear Sir</p> 
			<p>Attached Please Find the cost break ups</p> 
		<table>
			<tr>	
				<td><b>Job No</b></td>
				<td>:" . $data_array[0][csf('job_no')] . "</td>
        	</tr>
			<tr>	
				<td><b>Buyer Name</b></td>
				<td>:" . $buyer_arr[$data_array[0][csf('buyer_name')]] . "</td>
        	</tr>
			<tr>	
				<td><b>Style Ref</b></td>
				<td>:" . $data_array[0][csf('style_ref_no')] . "</td>
        	</tr>
			<tr>	
				<td><b>Style Qty. (Pcs)</b></td>
				<td>:" . $data_array[0][csf('job_quantity')] . "</td>
        	</tr>
			<tr>	
				<td><b>Delivery</b></td>
				<td>:" . change_date_format(max($pulish_ship_date_arr)) . "</td>
        	</tr>
			<tr>	
				<td><b>Material Cost</b></td>
				<td>:" . number_format($material_cost, 4, '.', '') . "</td>
        	</tr>
			<tr>	
				<td><b>Embellishment Cost</b></td>
				<td>:" . number_format($data_array[0][csf('embel_cost')], 4, '.', '') . "</td>
        	</tr>
			<tr>	
				<td><b>Wash Cost</b></td>
				<td>:" . number_format($data_array[0][csf('wash_cost')], 4, '.', '') . "</td>
        	</tr>
			<tr>	
				<td><b>Other Cost</b></td>
				<td>:" . number_format($other_cost, 4, '.', '') . "</td>
        	</tr>
			<tr>	
				<td><b>CM Cost</b></td>
				<td>:" . number_format($data_array[0][csf('cm_cost')], 4, '.', '') . "</td>
        	</tr>
			<tr>	
				<td><b>Total Cost</b></td>
				<td>:" . number_format($data_array[0][csf('total_cost')], 4, '.', '') . "</td>
        	</tr>
			<tr>	
				<td><b>FOB Price /Dzn	</b></td>
				<td>:" . number_format($data_array[0][csf('price_dzn')], 4, '.', '') . "</td>
        	</tr>
			<tr>	
				<td><b>Margin Value /Dzn</b></td>
				<td>:" . number_format($data_array[0][csf('margin_dzn')], 4, '.', '') . "</td>
        	</tr>
			<tr>	
				<td><b>Margin Value  (%) /Dzn</b></td>
				<td>:" . number_format($data_array[0][csf('margin_dzn_percent')], 2, '.', '') . "</td>
        	</tr>
	    </table>
		<p>kindly review and advise approval please</p> 
		";

		echo "mail_sent";

		require_once('../../../mailer/class.phpmailer.php');
		require_once('../../../auto_mail/setting/mail_setting.php');

		$mailBody = preg_replace("/<img[^>]+\>/i", " ", $mailBody);
		$mailToArr = array();
		if ($msil_address) {
			$mailToArr[] = $msil_address;
		}


		$sql = "SELECT a.BRAND_IDS,a.BUYER_IDS,c.email_address as MAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id  and a.mail_item=b.MAIL_ITEM_MST and a.mail_item=89 and b.mail_user_setup_id=c.id and a.company_id =" . $cbo_company_name . "  and   A.IS_DELETED=0 and A.STATUS_ACTIVE=1  and b.IS_DELETED=0 and b.STATUS_ACTIVE=1  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
		$mail_sql = sql_select($sql);
		$receverMailArr = array();
		foreach ($mail_sql as $row) {
			$mailToArr[] = $row[MAIL];
		}


		$elcetronicSql = "SELECT a.BUYER_ID,a.SEQUENCE_NO,a.BYPASS,b.USER_EMAIL  from electronic_approval_setup a join user_passwd b on a.user_id=b.id where b.valid=1  AND a.entry_form=15 and a.company_id=$cbo_company_name order by a.SEQUENCE_NO";
		//echo $elcetronicSql;die;

		$elcetronicSqlRes = sql_select($elcetronicSql);
		foreach ($elcetronicSqlRes as $rows) {

			if ($rows[BUYER_ID] != '') {
				foreach (explode(',', $rows[BUYER_ID]) as $bi) {
					if ($rows[USER_EMAIL] != '' && $bi == $buyer_name_id) {
						$mailToArr[] = $rows[USER_EMAIL];
					}
					if ($rows[BYPASS] == 2) {
						break;
					}
				}
			} else {
				if ($rows[USER_EMAIL]) {
					$mailToArr[] = $rows[USER_EMAIL];
				}
				if ($rows[BYPASS] == 2) {
					break;
				}
			}
		}


		$to = implode(',', array_unique($mailToArr));
		//echo $to;die;


		/*		//Att file....
			$imgSql="select IMAGE_LOCATION,REAL_FILE_NAME from common_photo_library where is_deleted=0  and MASTER_TBLE_ID=$txt_job_no and file_type=1";
			$imgSqlResult=sql_select($imgSql);
			foreach($imgSqlResult as $rows){
				$att_file_arr[]='../../../'.$rows[IMAGE_LOCATION].'**'.$rows[REAL_FILE_NAME];
			}
	*/
		$mailBody = $bodymail;
		$subject = "Pre Cost Entry Report";
		$header = mailHeader();
		echo sendMailMailer($to, $subject, $mailBody, $from_mail, $att_file_arr) . $to;
	} else {
		echo $mailBody;
	}

	//------------------------------------End;
}

if ($action == "preCostRpt8") //md mamun 11-05-2022-Cost Rpt8 button
{
	$process = array(&$_POST);
	extract(check_magic_quote_gpc($process));
	$txt_costing_date = change_date_format(str_replace("'", "", $txt_costing_date), 'yyyy-mm-dd', '-');
	if ($txt_job_no == "") $job_no = '';
	else $job_no = " and a.job_no=" . $txt_job_no . "";
	if ($cbo_company_name == "") $company_name = '';
	else $company_name = " and a.company_name=" . $cbo_company_name . "";
	if ($cbo_buyer_name == "") $cbo_buyer_name = '';
	else $cbo_buyer_name = " and a.buyer_name=" . $cbo_buyer_name . "";
	if ($txt_style_ref == "") $txt_style_ref = '';
	else $txt_style_ref = " and a.style_ref_no=" . $txt_style_ref . "";
	if ($txt_costing_date == "") $txt_costing_date = '';
	else $txt_costing_date = " and c.costing_date='" . $txt_costing_date . "'";
	$path = str_replace("'", "", $path);
	if ($path == 1) $path = "../../";



	if (str_replace("'", '', $txt_po_breack_down_id) == "") {
		$txt_po_breack_down_id_cond = '';
		$txt_po_breack_down_id_cond1 = '';
		$txt_po_breack_down_id_cond2 = '';
		$txt_po_breack_down_id_cond3 = '';
	} else {
		$txt_po_breack_down_id_cond = " and b.id in(" . $txt_po_breack_down_id . ")";
		$txt_po_breack_down_id_cond1 = " and id in(" . $txt_po_breack_down_id . ")";
		$txt_po_breack_down_id_cond2 = " and po_break_down_id in(" . $txt_po_breack_down_id . ")";
		$txt_po_breack_down_id_cond3 = " and b.id in(" . $txt_po_breack_down_id . ")";
	}

	$buyer_arr = return_library_array("select id, buyer_name from lib_buyer", 'id', 'buyer_name');
	$comp = return_library_array("select id, company_name from lib_company", 'id', 'company_name');
	$supplier_name_arr = return_library_array("select id, supplier_name from  lib_supplier", 'id', 'supplier_name');
	$color_library = return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	if ($db_type == 0) $group_gsm = "group_concat( distinct b.gsm_weight) AS gsm_weight";
	if ($db_type == 2) $group_gsm = "listagg(b.gsm_weight ,',') within group (order by b.gsm_weight) AS gsm_weight";
	$gsm_weight_top = return_field_value("$group_gsm", "lib_body_part a,wo_pre_cost_fabric_cost_dtls b", "a.id=b.body_part_id and b.job_no=$txt_job_no and a.body_part_type=1", "gsm_weight");
	$gsm_weight_bottom = return_field_value("$group_gsm", "lib_body_part a,wo_pre_cost_fabric_cost_dtls b", "a.id=b.body_part_id and b.job_no=$txt_job_no and a.body_part_type=20 ", "gsm_weight");
	$costing_per_arr = return_library_array("select job_no,costing_per from wo_pre_cost_mst where job_no =" . $txt_job_no . "", "job_no", "costing_per");


	$result = sql_select("select id,po_number,pub_shipment_date,po_received_date,file_no,grouping from wo_po_break_down where job_no_mst=$txt_job_no $txt_po_breack_down_id_cond1 and status_active=1 and is_deleted=0 order by pub_shipment_date DESC");
	$job_in_orders = array();
	$pulich_ship_date = '';
	$job_in_ref = array();
	$job_in_file = array();
	foreach ($result as $val) {
		$job_in_orders[$val[csf('id')]] = $val[csf('po_number')];
		$pulich_ship_date = $val[csf('pub_shipment_date')];
		$job_in_ref[$val[csf('id')]] = $val[csf('grouping')];
		$job_in_file[$val[csf('id')]] = $val[csf('file_no')];
	}
	$ref_cond = implode(",", array_unique($job_in_ref));

	$file_cond = implode(",", array_unique($job_in_file));
	$job_in_orders = implode(", ", $job_in_orders);

	$gmtsitem_ratio_array = array();
	$grmnt_items = "";
	$grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no=$txt_job_no");
	foreach ($grmts_sql as $key => $val) {
		$grmnt_items .= $garments_item[$val[csf("gmts_item_id")]] . ",";
		$gmtsitem_ratio_array[$val[csf('job_no')]][$val[csf('gmts_item_id')]] = $val[csf('set_item_ratio')];
	}
	$grmnt_items = rtrim($grmnt_items, ",");


	$po_qty = 0;
	$po_plun_cut_qty = 0;
	$total_set_qnty = 0;
	$sql_po = "select a.job_no,a.total_set_qnty,b.id,c.item_number_id,c.country_id,c.color_number_id,c.size_number_id,c.order_quantity ,c.plan_cut_qnty  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst   and b.id=c.po_break_down_id  and a.job_no =" . $txt_job_no . "   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 order by b.id";
	$sql_po_data = sql_select($sql_po);
	foreach ($sql_po_data as $sql_po_row) {
		$po_qty += $sql_po_row[csf('order_quantity')];
		$po_plun_cut_qty += $sql_po_row[csf('plan_cut_qnty')];
		$total_set_qnty = $sql_po_row[csf('total_set_qnty')];
	}





	if ($db_type == 0) {
		$sql = "select a.job_no,a.company_name, a.buyer_name,a.style_ref_no,a.ship_mode, a.gmts_item_id,a.order_uom, a.avg_unit_price,a.order_repeat_no,a.quotation_id,sum(b.plan_cut) as plan_cut_qnty,sum(b.po_quantity) as ord_qty,c.costing_date,c.costing_per,c.budget_minute,c.approved,   d.fab_knit_req_kg, d.fab_knit_fin_req_kg, d.fab_woven_req_yds, d.fab_woven_fin_req_yds, d.fab_yarn_req_kg,a.location_name,c.costing_date,c.sew_smv, c.cut_smv, c.sew_effi_percent, c.cut_effi_percent,a.job_quantity,a.style_description from wo_po_details_master a, wo_po_break_down b, wo_pre_cost_mst c left join wo_pre_cost_sum_dtls d on   c.job_no=d.job_no and d.status_active=1 and d.is_deleted=0 where a.job_no=b.job_no_mst and b.job_no_mst=c.job_no  and a.status_active=1 and a.is_deleted =0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $job_no $txt_po_breack_down_id_cond $company_name $cbo_buyer_name  $txt_costing_date group by a.job_no,a.company_name, a.buyer_name,a.style_ref_no, a.ship_mode,a.gmts_item_id,a.order_uom, a.avg_unit_price,a.order_repeat_no,a.quotation_id,c.costing_date,c.costing_per,c.approved,c.budget_minute, d.fab_knit_req_kg, d.fab_knit_fin_req_kg, d.fab_woven_req_yds, d.fab_woven_fin_req_yds, d.fab_yarn_req_kg,a.location_name,c.costing_date,c.sew_smv, c.cut_smv, c.sew_effi_percent, c.cut_effi_percent,a.job_quantity,a.style_description order by a.job_no";
	}
	if ($db_type == 2) {
		$sql = "select a.job_no,a.company_name, a.buyer_name,a.style_ref_no,a.ship_mode, a.gmts_item_id,a.order_uom, a.avg_unit_price,a.order_repeat_no,a.quotation_id,sum(b.plan_cut) as plan_cut_qnty,sum(b.po_quantity) as ord_qty,c.costing_date,c.costing_per,c.budget_minute,c.approved,d.fab_knit_req_kg, d.fab_knit_fin_req_kg, d.fab_woven_req_yds, d.fab_woven_fin_req_yds, d.fab_yarn_req_kg,a.location_name,c.costing_date,c.sew_smv, c.cut_smv, c.sew_effi_percent, c.cut_effi_percent,a.job_quantity,a.style_description,c.remarks from wo_po_details_master a,wo_po_break_down b, wo_pre_cost_mst c left join  wo_pre_cost_sum_dtls d on  c.job_no=d.job_no and d.status_active=1 and d.is_deleted=0 where a.job_no=b.job_no_mst and b.job_no_mst=c.job_no  and a.status_active=1 and a.is_deleted =0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $job_no $txt_po_breack_down_id_cond $company_name $cbo_buyer_name  group by a.job_no,a.company_name, a.buyer_name,a.style_ref_no, a.gmts_item_id,a.order_uom,a.ship_mode,a.order_repeat_no, a.quotation_id,a.avg_unit_price,c.costing_date, c.costing_per,c.approved,c.budget_minute, d.fab_knit_req_kg, d.fab_knit_fin_req_kg, d.fab_woven_req_yds, d.fab_woven_fin_req_yds, d.fab_yarn_req_kg,a.location_name,c.costing_date,c.sew_smv, c.cut_smv, c.sew_effi_percent, c.cut_effi_percent,a.job_quantity,a.style_description,c.remarks  order by a.job_no";
	}

	//echo $sql;
	$data_array = sql_select($sql);
	?>
	<!--<div style="width:852px; margin:0 auto">
    <div style="width:850px; font-size:20px; font-weight:bold" align="center">< ? echo $comp[str_replace("'","",$cbo_company_name)]; ?></div>
    <div style="width:850px; font-size:14px; font-weight:bold" align="center">BOM Report</div>-->
	<?

	$order_job_qnty = 0;
	$ord_qty = 0;
	$avg_unit_price = 0;
	$order_values = 0;
	$order_price_per_dzn = 0;
	$costing_for = '';
	foreach ($data_array as $row) {

		$order_job_qnty = $row[csf("job_quantity")];
		$ord_qty = $row[csf("ord_qty")];
		$avg_unit_price = $row[csf("avg_unit_price")];
		$order_values = $row[csf("job_quantity")] * $row[csf("avg_unit_price")];
		$location_name_id = $row[csf('location_name')];

		$sew_smv = $row[csf("sew_smv")];
		$cut_smv = $row[csf("cut_smv")];
		$costing_date = $row[csf("costing_date")];
		$sew_effi_percent = $row[csf("sew_effi_percent")];
		$cut_effi_percent = $row[csf("cut_effi_percent")];

		if ($row[csf("costing_per")] == 1) {
			$order_price_per_dzn = 12;
			$costing_for = " DZN";
		} else if ($row[csf("costing_per")] == 2) {
			$order_price_per_dzn = 1;
			$costing_for = " PCS";
		} else if ($row[csf("costing_per")] == 3) {
			$order_price_per_dzn = 24;
			$costing_for = " 2 DZN";
		} else if ($row[csf("costing_per")] == 4) {
			$order_price_per_dzn = 36;
			$costing_for = " 3 DZN";
		} else if ($row[csf("costing_per")] == 5) {
			$order_price_per_dzn = 48;
			$costing_for = " 4 DZN";
		}

		$img_path = (str_replace("'", "", $path)) ? str_replace("'", "", $path) : '../';
		$path = str_replace("'", "", $path);
		if ($path != "") {
			$path = $path;
		} else {
			$path = "../../";
		}

	?>
		<table style="width:850px">
			<tr>
				<td colspan="6" align="center">

					<?
					$image_location = return_field_value("image_location", "common_photo_library", "file_type=1 and form_name='company_details' and master_tble_id=$cbo_company_name", "image_location");
					?>
					<img src='<?= $img_path ?><? echo $image_location; ?>' height='70' align="left" />
					<b style="font-size:25px;"><? echo $comp[str_replace("'", "", $cbo_company_name)]; ?></b><br>
					<b style="font-size:14px;">Pre- Costing</b>
				</td>
			</tr>
		</table>

		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;" rules="all">
			<tr>
				<td width="150">Job Number</td>
				<td width="150"><b><? echo $row[csf("job_no")]; ?></b></td>
				<td width="150">Buyer</td>
				<td width="150"><b><? echo $buyer_arr[$row[csf("buyer_name")]]; ?></b></td>
				<td colspan="2" rowspan="6" width="210">
					<? $nameArray_imge = sql_select("SELECT image_location FROM common_photo_library where master_tble_id=$txt_job_no and file_type=1");
					?>
					<div id="div_size_color_matrix" style="float:left;">
						<fieldset id="" width="210">
							<legend>Image </legend>
							<table width="208">
								<tr>
									<?
									$img_counter = 0;
									foreach ($nameArray_imge as $result_imge) {
										if ($path == "") $path = '../../';
									?>
										<td><img src="<? echo $path . $result_imge[csf('image_location')]; ?>" width="200" height="200" border="2" /></td>
									<?
										$img_counter++;
									}
									?>
								</tr>
							</table>
						</fieldset>
					</div>
				</td>
			</tr>
			<tr>

				<td>Style Ref. No</td>
				<td><b><? echo $row[csf("style_ref_no")]; ?></b></td>
				<td>Internal Ref</td>
				<td style="word-break:break-all"><b><? echo ltrim($ref_cond, ", "); ?></b></td>

			</tr>
			<tr>
				<td>Order Numbers</td>
				<td colspan="3"><? echo $job_in_orders; ?></td>

			</tr>
			<tr>
				<td>Knit Fabric Cons</td>
				<td><b><? echo $row[csf("fab_knit_req_kg")]; ?>(Kg)</b></td>
				<td>Woven Fabric Cons</td>
				<td><b><? echo $row[csf("fab_woven_req_yds")];
						$fab_woven_req_yds_avg += $row[csf("fab_woven_req_yds")]; ?> (Yds)</b></td>

			</tr>
			<tr>
				<td>Knit Fin Fabric Cons</td>
				<td><b><? echo $row[csf("fab_knit_fin_req_kg")]; ?>(Kg)</b></td>
				<td>Costing Per</td>
				<td><b><?= $costing_per[$row[csf("costing_per")]]; ?></b> </td>

			</tr>
			<tr>
				<td>Avg Yarn Req</td>
				<td><b> <? echo $row[csf("fab_yarn_req_kg")] ?> (Kg)</b></td>
				<td>Woven Fin Fabric Cons</td>
				<td><b><? echo $row[csf("fab_woven_fin_req_yds")]; ?>(Yds)</b> </td>

			</tr>
			<tr>

				<td>Sc/Lc No</td>
				<td><b></b></td>
				<td>Style Description</td>
				<td><b><?= $row[csf("style_description")]; ?></b></td>
				<td>Costing Date</td>
				<td><b><? echo change_date_format($row[csf("costing_date")]); ?></b></td>
			</tr>
			<tr>

				<td width="100">Garments Item</td>
				<td width="100"><b><? echo $grmnt_items; ?></b></td>
				<td>Job Qnty</td>
				<td><b><? echo $row[csf("job_quantity")] . " " . $unit_of_measurement[$row[csf("order_uom")]]; ?></b></td>
				<td>Plan Cut Qnty</td>
				<td><b><? echo $row[csf("plan_cut_qnty")] . " " . $unit_of_measurement[$row[csf("order_uom")]];; ?></b></td>
			</tr>
			<tr>

				<td>Price Per Unit</td>
				<td><b><? echo $row[csf("avg_unit_price")]; ?></b></td>
				<td>Shipment Date</td>
				<td><b><? echo change_date_format($pulich_ship_date); ?></b></td>
				<td>GSM</td>
				<td><b><?php
						$gsm_weights_top = implode(",", array_unique(explode(",", $gsm_weight_top)));
						$gsm_weight_bottom = implode(",", array_unique(explode(",", $gsm_weight_bottom)));
						if ($gsm_weights_top != '') $gsm_weightTop = $gsm_weights_top;
						else $gsm_weightTop = '';
						if ($gsm_weight_bottom != '' && $gsm_weights_top != '') $gsm_weightBottom = " ," . $gsm_weight_bottom;
						else if ($gsm_weight_bottom != '' && $gsm_weights_top == '') $gsm_weightBottom = $gsm_weight_bottom;
						else $gsm_weightBottom = '';
						echo $gsm_weightTop . $gsm_weightBottom;
						?></b></td>
			</tr>
			<tr>

			<tr>
				<td>Remarks</td>
				<td colspan="3"><? echo $row[csf("remarks")]; ?></td>
				<td></td>
				<td><b></b></td>
			</tr>

		</table>
	<?
	} //end first foearch
	$cm_cost_method_based_on = return_field_value("cm_cost_method_based_on", "variable_order_tracking", "company_name=" . $cbo_company_name . "  and variable_list=22 and status_active=1 and is_deleted=0");
	if ($cm_cost_method_based_on == "") $cm_cost_method_based_on = 1;


	$location_cpm_cost = 0;
	$cm_min_variable = return_field_value("yarn_iss_with_serv_app as cost_per_minute", "variable_order_tracking", "company_name =" . $cbo_company_name . " and variable_list=67 and is_deleted=0 and status_active=1", "cost_per_minute");
	if ($cm_min_variable == "" || $cm_min_variable == 0) $location_cpm_cost = 0;
	else $location_cpm_cost = $cm_min_variable;



	$cm_cost_based_on_date = "";
	if ($cm_cost_method_based_on == 1) {
		if ($db_type == 0) $cm_cost_based_on_date = change_date_format($costing_date, "yyyy-mm-dd", "-");
		if ($db_type == 2) $cm_cost_based_on_date = change_date_format($costing_date, "yyyy-mm-dd", "-", 1);
	} else if ($cm_cost_method_based_on == 2) {
		$min_shipment_sql = sql_select("select job_no_mst, min(shipment_date) as min_shipment_date from wo_po_break_down where job_no_mst=" . $txt_job_no . " $txt_po_breack_down_id_cond1 and status_active=1 and is_deleted=0 group by job_no_mst");
		$min_shipment_date = "";
		foreach ($min_shipment_sql as $row) {
			$min_shipment_date = $row[csf('min_shipment_date')];
		}

		if ($db_type == 0) $cm_cost_based_on_date = change_date_format($min_shipment_date, "yyyy-mm-dd", "-");
		if ($db_type == 2) $cm_cost_based_on_date = change_date_format($min_shipment_date, "yyyy-mm-dd", "-", 1);
	} else if ($cm_cost_method_based_on == 3) {
		$max_shipment_sql = sql_select("select job_no_mst, max(shipment_date) as max_shipment_date from wo_po_break_down where job_no_mst=" . $txt_job_no . " and status_active=1 and is_deleted=0 $txt_po_breack_down_id_cond1 group by job_no_mst");
		$max_shipment_date = "";
		foreach ($max_shipment_sql as $row) {
			$max_shipment_date = $row[csf('max_shipment_date')];
		}

		if ($db_type == 0) $cm_cost_based_on_date = change_date_format($max_shipment_date, "yyyy-mm-dd", "-");
		if ($db_type == 2) $cm_cost_based_on_date = change_date_format($max_shipment_date, "yyyy-mm-dd", "-", 1);
	} else if ($cm_cost_method_based_on == 4) {

		$max_shipment_sql = sql_select("select job_no_mst, min(pub_shipment_date) as min_pub_shipment_date from wo_po_break_down where job_no_mst=" . $txt_job_no . " and status_active=1 and is_deleted=0 $txt_po_breack_down_id_cond1 group by job_no_mst");
		$min_pub_shipment_date = "";
		foreach ($max_shipment_sql as $row) {
			$min_pub_shipment_date = $row[csf('min_pub_shipment_date')];
		}

		if ($db_type == 0) $cm_cost_based_on_date = change_date_format($min_pub_shipment_date, "yyyy-mm-dd", "-");
		if ($db_type == 2) $cm_cost_based_on_date = change_date_format($min_pub_shipment_date, "yyyy-mm-dd", "-", 1);
	} else if ($cm_cost_method_based_on == 5) {
		$max_shipment_sql = sql_select("select job_no_mst, max(pub_shipment_date) as max_pub_shipment_date from wo_po_break_down where job_no_mst=" . $txt_job_no . " and status_active=1 and is_deleted=0 $txt_po_breack_down_id_cond1 group by job_no_mst");
		$max_pub_shipment_date = "";
		foreach ($max_shipment_sql as $row) {
			$max_pub_shipment_date = $row[csf('max_pub_shipment_date')];
		}

		if ($db_type == 0) $cm_cost_based_on_date = change_date_format($max_pub_shipment_date, "yyyy-mm-dd", "-");
		if ($db_type == 2) $cm_cost_based_on_date = change_date_format($max_pub_shipment_date, "yyyy-mm-dd", "-", 1);
	}


	$financial_para = array();

	if ($location_cpm_cost != 1) {
		$sql_std_para = sql_select("select interest_expense, income_tax, cost_per_minute, applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$cbo_company_name and status_active=1 and is_deleted=0 order by id");

		foreach ($sql_std_para as $row) {
			$applying_period_date = change_date_format($row[csf('applying_period_date')], '', '', 1);
			$applying_period_to_date = change_date_format($row[csf('applying_period_to_date')], '', '', 1);
			$diff = datediff('d', $applying_period_date, $applying_period_to_date);
			for ($j = 0; $j < $diff; $j++) {
				//$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);
				$date_all = add_date(str_replace("'", "", $applying_period_date), $j);
				$newdate = change_date_format($date_all, '', '', 1);
				$financial_para[$newdate][interest_expense] = $row[csf('interest_expense')];
				$financial_para[$newdate][income_tax] = $row[csf('income_tax')];
				$financial_para[$newdate][cost_per_minute] = $row[csf('cost_per_minute')];
			}
		}
	} else {
		$sql_std_para = sql_select("select a.id, b.id as dtls_id, b.location_id, b.applying_period_date, b.applying_period_to_date, b.monthly_cm_expense, b.no_factory_machine, b.working_hour, b.cost_per_minute from lib_standard_cm_entry a, lib_standard_cm_entry_dtls b where a.id=b.mst_id and b.location_id=$location_name_id and a.company_id=$cbo_company_name");
		foreach ($sql_std_para as $row) {
			$applying_period_date = change_date_format($row[csf('applying_period_date')], '', '', 1);
			$applying_period_to_date = change_date_format($row[csf('applying_period_to_date')], '', '', 1);
			$diff = datediff('d', $applying_period_date, $applying_period_to_date);
			for ($j = 0; $j < $diff; $j++) {
				$date_all = add_date(str_replace("'", "", $applying_period_date), $j);
				$newdate = change_date_format($date_all, '', '', 1);
				$financial_para[$newdate][interest_expense] = $row[csf('interest_expense')];
				$financial_para[$newdate][income_tax] = $row[csf('income_tax')];
				$financial_para[$newdate][cost_per_minute] = $row[csf('cost_per_minute')];
			}
		}
	}








	//order Profitability===================================================================

	$condition = new condition();
	if (str_replace("'", "", $txt_job_no) != '') {
		$condition->job_no("=$txt_job_no");
	}
	if (str_replace("'", '', $txt_po_breack_down_id) != "") {
		$condition->po_id("in($selected_po_breack_down_id)");
	}

	$condition->init();
	$fabric = new fabric($condition);

	$yarn = new yarn($condition);
	$conversion = new conversion($condition);
	$trim = new trims($condition);
	$emblishment = new emblishment($condition);
	$wash = new wash($condition);
	$other = new other($condition);
	$other_cost = $other->getAmountArray_by_job();
	//$trims_cost_arr=$trim->getQtyArray_by_orderAndItemidTypeid();
	//print_r($trims_cost_arr);
	$commercial = new commercial($condition);
	$commision = new commision($condition);



	$sql_new = "select job_no, fabric_cost, fabric_cost_percent, trims_cost, trims_cost_percent, embel_cost, embel_cost_percent, wash_cost, wash_cost_percent, comm_cost, comm_cost_percent, commission, commission_percent, lab_test, lab_test_percent, inspection, inspection_percent, cm_cost, cm_cost_percent, freight, freight_percent, currier_pre_cost, currier_percent, certificate_pre_cost, certificate_percent, common_oh, common_oh_percent, depr_amor_pre_cost, total_cost, total_cost_percent, price_dzn, price_dzn_percent, margin_dzn, margin_dzn_percent, price_pcs_or_set, price_pcs_or_set_percent, margin_pcs_set, margin_pcs_set_percent, cm_for_sipment_sche, design_cost, design_percent, studio_cost, studio_percent from wo_pre_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array_new = sql_select($sql_new);


	foreach ($data_array_new as $row_new) {
		$summary_data[price_dzn] = $row_new[csf("price_dzn")];
		// $summary_data[price_dzn_job]=$total_fob_value;//($po_qty/($total_set_qnty*$order_price_per_dzn))*$row_new[csf("price_dzn")];
		$summary_data[price_dzn_job] = ($po_qty / ($total_set_qnty * $order_price_per_dzn)) * $row_new[csf("price_dzn")];
		$summary_data[commission] = $row_new[csf("commission")];
		//$summary_data[fabric_cost]=$row_new[csf("fabric_cost")];
		$summary_data[trims_cost] = $row_new[csf("trims_cost")];
		$summary_data[emb_cost] = $row_new[csf("embel_cost")];
		$summary_data[lab_test] = $row_new[csf("lab_test")];
		$summary_data[lab_test_job] = $other_cost[$row_new[csf("job_no")]]['lab_test'];
		$summary_data[inspection] = $row_new[csf("inspection")];
		$summary_data[inspection_job] = $other_cost[$row_new[csf("job_no")]]['inspection'];
		$summary_data[freight] = $row_new[csf("freight")];
		$summary_data[freight_job] = $other_cost[$row_new[csf("job_no")]]['freight'];
		$summary_data[design] = $row_new[csf("design_cost")];
		$summary_data[design_job] = $other_cost[$row_new[csf("job_no")]]['design_cost'];
		//	$summary_data[design_job]=$row_new[csf("design_cost")]/$order_price_per_dzn*$po_qty;
		$summary_data[studio_job] = $other_cost[$row_new[csf("job_no")]]['studio_cost'];
		$summary_data[studio] = $row_new[csf("studio_cost")];
		//$summary_data[studio_job]=$row_new[csf("studio_cost")]/$order_price_per_dzn*$po_qty;
		$summary_data[currier_pre_cost] = $row_new[csf("currier_pre_cost")];
		$summary_data[currier_pre_cost_job] = $other_cost[$row_new[csf("job_no")]]['currier_pre_cost'];
		$summary_data[certificate_pre_cost] = $row_new[csf("certificate_pre_cost")];
		$summary_data[certificate_pre_cost_job] = $other_cost[$row_new[csf("job_no")]]['certificate_pre_cost'];
		$summary_data[wash_cost] = $row_new[csf("wash_cost")];
		$summary_data[OtherDirectExpenses] = $row_new[csf("lab_test")] + $row_new[csf("inspection")] + $row_new[csf("design_cost")] + $row_new[csf("studio_cost")] + $row_new[csf("freight")] + $row_new[csf("currier_pre_cost")] + $row_new[csf("certificate_pre_cost")] + $row_new[csf("wash_cost")];
		$summary_data[OtherDirectExpenses_job] = $summary_data[lab_test_job] + $summary_data[inspection_job] + $summary_data[design_job] + $summary_data[studio_job] + $summary_data[freight_job] + $summary_data[currier_pre_cost_job] + $summary_data[certificate_pre_cost_job];

		$summary_data[cm_cost] = $row_new[csf("cm_cost")];
		$summary_data[cm_cost_job] = $other_cost[$row_new[csf("job_no")]]['cm_cost'];
		$summary_data[comm_cost] = $row_new[csf("comm_cost")];
		$summary_data[common_oh] = $row_new[csf("common_oh")];
		$summary_data[common_oh_job] = $other_cost[$row_new[csf("job_no")]]['common_oh'];
		$summary_data[depr_amor_pre_cost] = $row_new[csf("depr_amor_pre_cost")];
		$summary_data[depr_amor_pre_cost_job] = $other_cost[$row_new[csf("job_no")]]['depr_amor_pre_cost'];
	}
	//==================Fabric===========================
	$fabric_qty = $fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
	$fabric_amount = $fabric->getAmountArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
	$sql_fabric = "select id, job_no, body_part_id, fab_nature_id, color_type_id, fabric_description,uom, avg_cons,avg_cons_yarn, fabric_source,gsm_weight, rate, amount, avg_finish_cons, status_active  from wo_pre_cost_fabric_cost_dtls where job_no=" . $txt_job_no . " and is_deleted=0 and status_active=1";
	$data_arr_fabric = sql_select($sql_fabric);
	foreach ($data_arr_fabric as $fab_row) {
		if ($fab_row[csf("amount")] > 0) {
			$summary_data[fabric_cost][$fab_row[csf("id")]] = $fab_row[csf("amount")];
			$summary_data[fabric_cost_job] += $fabric_amount['knit']['grey'][$fab_row[csf("id")]][$fab_row[csf("uom")]];
			$summary_data[fabric_cost_job] += $fabric_amount['woven']['grey'][$fab_row[csf("id")]][$fab_row[csf("uom")]];
		}
	}
	unset($data_arr_fabric);

	//=============Yarn===========================
	$totYarn = 0;
	$YarnData = array();
	$yarn_data_array = $yarn->get_By_Precostdtlsid_YarnQtyAmountArray();
	$sql_yarn = "select f.id as yarn_id, f.cons_ratio, f.cons_qnty, f.avg_cons_qnty, f.rate, f.amount, count_id, copm_one_id, percent_one, color, type_id from wo_pre_cost_fab_yarn_cost_dtls f where f.job_no =" . $txt_job_no . " and f.is_deleted=0 and f.status_active=1  order by f.id";
	$data_arr_yarn = sql_select($sql_yarn);
	foreach ($data_arr_yarn as $yarn_row) {
		$yarnrate = $yarn_row[csf("rate")];
		$summary_data[yarn_cost][$yarn_row[csf("yarn_id")]] = $yarn_row[csf("amount")];
		$summary_data[yarn_cost_job] += $yarn_data_array[$yarn_row[csf("yarn_id")]]['amount'];
		$index = "'" . $yarn_row[csf("count_id")] . "_" . $yarn_row[csf("copm_one_id")] . "_" . $yarn_row[csf("percent_one")] . "_" . $yarn_row[csf("type_id")] . "_" . $yarn_row[csf("color")] . "_" . $yarnrate . "'";
		$YarnData[$index]['qty'] += $yarn_data_array[$yarn_row[csf("yarn_id")]]['qty'];
		$YarnData[$index]['amount'] += $yarn_data_array[$yarn_row[csf("yarn_id")]]['amount'];
		$YarnData[$index]['dznqty'] += $yarn_row[csf("cons_qnty")];
		$YarnData[$index]['dznamount'] += $yarn_row[csf("amount")];
		$totYarn += $yarn_data_array[$yarn_row[csf("yarn_id")]]['qty'];
	}
	//Yarn End============================

	//start	Trims Cost part report here -------------------------------------------
	$sql_trim = "select id, job_no, trim_group,description,brand_sup_ref,remark, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp,status_active,seq
		from wo_pre_cost_trim_cost_dtls
		where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0 order by seq";
	$data_array_trim = sql_select($sql_trim);
	$trim_amount_arr = $trim->getAmountArray_precostdtlsid();
	$trim_qty_arr = $trim->getQtyArray_by_precostdtlsid();
	//$trim_type_qty_arr=$trim->getQtyArray_by_orderAndTrimsTypeid();
	//print_r($trim_type_qty_arr);
	$totTrim = 0;
	$TrimData = array();
	foreach ($data_array_trim as $row_trim) {
		$trim_qty = $trim_qty_arr[$row_trim[csf("id")]];
		$trim_amount = $trim_amount_arr[$row_trim[csf("id")]];
		$summary_data[trims_cost_job] += $trim_amount;
		$TrimData[$row_trim[csf('id')]]['trim_group'] = $row_trim[csf('trim_group')];
		$TrimData[$row_trim[csf('id')]]['description'] = $row_trim[csf('description')];
		$TrimData[$row_trim[csf('id')]]['brand_sup_ref'] = $row_trim[csf('brand_sup_ref')];
		$TrimData[$row_trim[csf('id')]]['remark'] = $row_trim[csf('remark')];
		$TrimData[$row_trim[csf('id')]]['cons_uom'] = $row_trim[csf('cons_uom')];
		$TrimData[$row_trim[csf('id')]]['cons_dzn_gmts'] = $row_trim[csf('cons_dzn_gmts')];
		$TrimData[$row_trim[csf('id')]]['rate'] = $row_trim[csf('rate')];
		$TrimData[$row_trim[csf('id')]]['amount'] = $row_trim[csf('amount')];
		$TrimData[$row_trim[csf('id')]]['apvl_req'] = $row_trim[csf('apvl_req')];
		$TrimData[$row_trim[csf('id')]]['nominated_supp'] = $row_trim[csf('nominated_supp')];
		$TrimData[$row_trim[csf('id')]]['tot_cons'] = $trim_qty;
		$TrimData[$row_trim[csf('id')]]['tot_amount'] = $trim_amount;
		$totTrim += $row_trim[csf('cons_dzn_gmts')];
	}
	//End	Trims Cost part report here -------------------------------------------


	//Conversion
	$totConv = 0;
	$ConvData = array();
	$conv_data = array();
	$conv_amount_arr = $conversion->getAmountArray_by_conversionid();
	$conv_qty_arr = $conversion->getQtyArray_by_conversionid();
	$sql_conv = "select a.id as con_id, a.fabric_description as fabric_description_id, a.job_no, a.cons_process, a.req_qnty,a.avg_req_qnty, a.charge_unit, a.amount, a.status_active,b.body_part_id,b.fab_nature_id,b.color_type_id,b.fabric_description,b.uom  from wo_pre_cost_fab_conv_cost_dtls a left join wo_pre_cost_fabric_cost_dtls b on a.job_no=b.job_no and a.fabric_description=b.id and b.status_active=1 and b.is_deleted=0 where a.job_no=" . $txt_job_no . "  and a.id>0 and a.is_deleted =0 and a.status_active=1 ";
	$data_arr_conv = sql_select($sql_conv);
	foreach ($data_arr_conv as $conv_row) {
		$convamount = array_sum($conv_amount_arr[$conv_row[csf('con_id')]]);
		$convQty = array_sum($conv_qty_arr[$conv_row[csf('con_id')]]);
		$conv_data[cons_process][$conv_row[csf('con_id')]] = $conv_row[csf('cons_process')];
		$conv_data[amount][$conv_row[csf('con_id')]] = $conv_row[csf('amount')];
		$conv_data[amount_job][$conv_row[csf('con_id')]] += $convamount;
		$summary_data[conver_cost_job] += $convamount;

		$index = $conv_row[csf('con_id')];
		$ConvData[$index]['item_descrition'] = $body_part[$conv_row[csf("body_part_id")]] . ", " . $color_type[$conv_row[csf("color_type_id")]] . ", " . $conv_row[csf("fabric_description")];
		$ConvData[$index]['cons_process'] = $conv_row[csf("cons_process")];
		$ConvData[$index]['req_qnty'] = $conv_row[csf("req_qnty")];
		$ConvData[$index]['uom'] = $conv_row[csf("uom")];
		$ConvData[$index]['charge_unit'] = $conv_row[csf("charge_unit")];
		$ConvData[$index]['amount'] = $conv_row[csf("amount")];
		$ConvData[$index]['tot_req_qnty'] = $convQty;
		$ConvData[$index]['tot_amount'] = $convamount;
		$totConv += $conv_row[csf("req_qnty")];
	}
	//Conversion End


	//Emb cost Cost part report here -------------------------------------------

	$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pre_cost_embe_cost_dtls where job_no=" . $txt_job_no . " and emb_name in(1,2,4,5) and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	$emblishment_qty = $emblishment->getQtyArray_by_jobAndEmblishmentid();
	$emblishment_amount = $emblishment->getAmountArray_by_jobAndEmblishmentid();
	$totEmb = 0;
	$EmbData = array();

	foreach ($data_array as $row) {
		$embqty = $emblishment_qty[$row[csf("job_no")]][$row[csf("id")]];
		$embamount = $emblishment_amount[$row[csf("job_no")]][$row[csf("id")]];
		$summary_data[emb_cost_job] += $embamount;
		$EmbData[$row[csf("id")]]['emb_name'] = $row[csf("emb_name")];
		$EmbData[$row[csf("id")]]['emb_type'] = $row[csf("emb_type")];
		$EmbData[$row[csf("id")]]['cons_dzn_gmts'] = $row[csf("cons_dzn_gmts")];
		$EmbData[$row[csf("id")]]['rate'] = $row[csf("rate")];
		$EmbData[$row[csf("id")]]['amount'] = $row[csf("amount")];
		$EmbData[$row[csf("id")]]['tot_cons'] = $embqty;
		$EmbData[$row[csf("id")]]['tot_amount'] = $embamount;
		$totEmb += $row[csf("cons_dzn_gmts")];
	}
	//End Emb cost Cost part report here -------------------------------------------
	//Wash cost Cost part report here -------------------------------------------
	$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pre_cost_embe_cost_dtls where job_no=" . $txt_job_no . " and emb_name =3 and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	$wash_qty = $wash->getQtyArray_by_jobAndEmblishmentid();
	$wash_amount = $wash->getAmountArray_by_jobAndEmblishmentid();
	foreach ($data_array as $row) {
		$washqty = $wash_qty[$row[csf("job_no")]][$row[csf("id")]];
		$washamount = $wash_amount[$row[csf("job_no")]][$row[csf("id")]];
		$summary_data[wash_cost_job] += $washamount;
		$summary_data[OtherDirectExpenses_job] += $washamount;
		$EmbData[$row[csf("id")]]['emb_name'] = $row[csf("emb_name")];
		$EmbData[$row[csf("id")]]['emb_type'] = $row[csf("emb_type")];
		$EmbData[$row[csf("id")]]['cons_dzn_gmts'] = $row[csf("cons_dzn_gmts")];
		$EmbData[$row[csf("id")]]['rate'] = $row[csf("rate")];
		$EmbData[$row[csf("id")]]['amount'] = $row[csf("amount")];
		$EmbData[$row[csf("id")]]['tot_cons'] = $washqty;
		$EmbData[$row[csf("id")]]['tot_amount'] = $washamount;
		$totEmb += $row[csf("cons_dzn_gmts")];
	}
	//End Wash cost Cost part report here -------------------------------------------
	//Commision cost Cost part report here -------------------------------------------
	$sql = "select id,job_no,particulars_id,commission_base_id,commision_rate,commission_amount, status_active from wo_pre_cost_commiss_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	$commision_amount = $commision->getAmountArray_by_jobAndPrecostdtlsid();
	$totCommi = 0;
	$CommiData = array();
	foreach ($data_array as $row) {
		$commisionamount = $commision_amount[$row[csf("job_no")]][$row[csf("id")]];
		$summary_data[commission_job] += $commisionamount;
		$CommiData[$row[csf("id")]]['particulars_id'] = $row[csf("particulars_id")];
		$CommiData[$row[csf("id")]]['commission_base_id'] = $row[csf("commission_base_id")];
		$CommiData[$row[csf("id")]]['commision_rate'] = $row[csf("commision_rate")];
		$CommiData[$row[csf("id")]]['commission_amount'] = $row[csf("commission_amount")];
		$CommiData[$row[csf("id")]]['tot_commission_amount'] = $commisionamount;
		$totCommi += $row[csf("commission_amount")];
	}
	//End Commision cost Cost part report here -------------------------------------------
	//Commarcial cost Cost part report here -------------------------------------------
	$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls  where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	$commarcial_amount = $commercial->getAmountArray_by_jobAndPrecostdtlsid();

	$totCommar = 0;
	$CommarData = array();
	foreach ($data_array as $row) {
		$commarcialamount = $commarcial_amount[$row[csf("job_no")]][$row[csf("id")]];
		$summary_data[comm_cost_job] += $commarcialamount;
		$CommarData[$row[csf("id")]]['item_id'] = $row[csf("item_id")];
		$CommarData[$row[csf("id")]]['rate'] = $row[csf("rate")];
		$CommarData[$row[csf("id")]]['amount'] = $row[csf("amount")];
		$CommarData[$row[csf("id")]]['tot_amount'] = $commarcialamount;
		$totCommar += $row[csf("amount")];
	}
	//End Commarcial cost Cost part report here -------------------------------------------












	?>
	<div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;" rules="all">
			<tr style="font-weight:bold">
				<td align="center" width="850" colspan="5">Order Profitability </td>
			</tr>
			<tr style="font-weight:bold">
				<td align="center" width="80">Line Items</td>
				<td width="400">Particulars</td>
				<td width="120">Amount (USD)/<? echo $costing_for; ?></td>
				<td width="120">Total Value</td>
				<td>%</td>
			</tr>
			<tr>
				<td align="center">1</td>
				<td style="font-weight:bold">Gross FOB Value</td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[price_dzn], 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[price_dzn_job], 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[price_dzn_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">2</td>
				<td style=" padding-left:15px">Less: commission</td>
				<td align="right"><? echo fn_number_format($summary_data[commission], 4); ?></td>
				<td align="right"><? echo fn_number_format($summary_data[commission_job], 4); ?></td>
				<td align="right"><? echo fn_number_format(($summary_data[commission_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">3</td>
				<?
				$NetFOBValue = $summary_data[price_dzn] - $summary_data[commission];
				$NetFOBValue_job = $summary_data[price_dzn_job] - $summary_data[commission_job];
				?>
				<td style="font-weight:bold"><b>Net FOB Value (1-2)</b></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($NetFOBValue, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($NetFOBValue_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($NetFOBValue_job / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">4</td>
				<td style="font-weight:bold"><b>Less: Cost of Material & Services (5+6+7+8+9) </b></td>
				<?
				$Less_Cost_Material_Services = array_sum($summary_data[yarn_cost]) + array_sum($summary_data[fabric_cost]) + array_sum($conv_data[amount]) + $summary_data[trims_cost] + $summary_data[emb_cost] + $summary_data[lab_test] + $summary_data[inspection] + $summary_data[design] + $summary_data[studio] + $summary_data[freight] + $summary_data[currier_pre_cost] + $summary_data[certificate_pre_cost] + $summary_data[wash_cost];

				$Less_Cost_Material_Services_job = $summary_data[yarn_cost_job] + $summary_data[fabric_cost_job] + $summary_data[conver_cost_job] + $summary_data[trims_cost_job] + $summary_data[emb_cost_job] + $summary_data[OtherDirectExpenses_job];
				//$Less_Cost_Material_Services_job=array_sum($summary_data[yarn_cost])+array_sum($summary_data[fabric_cost])+array_sum($conv_data[amount])+$summary_data[trims_cost]+$summary_data[emb_cost]+$summary_data[OtherDirectExpenses_dzn];
				?>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format($Less_Cost_Material_Services, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($Less_Cost_Material_Services_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($Less_Cost_Material_Services_job / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center" rowspan="2">5</td>
				<td style=" padding-left:100px;font-weight:bold">Fabric Purchase Cost</td>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format(array_sum($summary_data[fabric_cost]), 4); ?></td>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format($summary_data[fabric_cost_job], 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[fabric_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td style=" padding-left:100px;font-weight:bold">Yarn Cost</td>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format(array_sum($summary_data[yarn_cost]), 4); ?></td>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format($summary_data[yarn_cost_job], 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[yarn_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center" valign="top">6</td>
				<td width="400" style=" padding-left:100px">
					<table>
						<tr>
							<td style="font-weight:bold">Conversion Cost</td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<? foreach ($conv_data[cons_process] as $key => $value) { ?>
							<tr>
								<td align="left"><? echo $conversion_cost_head_array[$conv_data[cons_process][$key]]; ?></td>
							</tr>
						<? } ?>
					</table>
				</td>
				<td align="right" valign="top">
					<table>
						<tr>
							<td align="right" style="font-weight:bold"><? echo fn_number_format(array_sum($conv_data[amount]), 4); ?></td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<? foreach ($conv_data[cons_process] as $key => $value) { ?>
							<tr>
								<td align="right"><? echo fn_number_format($conv_data[amount][$key], 4); ?></td>
							</tr>
						<? } ?>
					</table>
				</td>
				<td align="right" valign="top">
					<table>
						<tr>
							<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[conver_cost_job], 4); ?></td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<? foreach ($conv_data[cons_process] as $key => $value) { ?>
							<tr>
								<td align="right"><? echo fn_number_format($conv_data[amount_job][$key], 4); ?></td>
							</tr>
						<? } ?>
					</table>
				</td>
				<td align="right" valign="top">
					<table>
						<tr>
							<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[conver_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<? foreach ($conv_data[cons_process] as $key => $value) { ?>
							<tr>
								<td align="right"><? echo fn_number_format(($conv_data[amount_job][$key] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
							</tr>
						<? } ?>
					</table>
				</td>
			</tr>
			<tr>
				<td align="center">7</td>
				<td style="padding-left:100px;font-weight:bold"><b>Trim Cost </b></td>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format($summary_data[trims_cost], 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[trims_cost_job], 4) ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[trims_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">8</td>
				<td style=" padding-left:100px;font-weight:bold"><b>Embelishment Cost </b></td>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format($summary_data[emb_cost], 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[emb_cost_job], 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[emb_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center" valign="top">9</td>
				<td style="padding-left:100px">
					<table>
						<tr>
							<td style="font-weight:bold">Other Direct Expenses</td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<tr>
							<td>Lab Test</td>
						</tr>
						<tr>
							<td>Inspection</td>
						</tr>
						<tr>
							<td>Design Cost</td>
						</tr>
						<tr>
							<td>Studio Cost</td>
						</tr>
						<tr>
							<td>Freight Cost</td>
						</tr>
						<tr>
							<td>Courier Cost</td>
						</tr>
						<tr>
							<td>Certificate Cost</td>
						</tr>
						<tr>
							<td>Garments Wash Cost</td>
						</tr>
					</table>
				</td>
				<td align="right" valign="top">
					<table>
						<tr>
							<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[OtherDirectExpenses], 4); ?></td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[lab_test], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[inspection], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[design], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[studio], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[freight], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[currier_pre_cost], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[certificate_pre_cost], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[wash_cost], 4); ?></td>
						</tr>
					</table>
				</td>
				<td align="right" valign="top">
					<table>
						<tr>
							<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[OtherDirectExpenses_job], 4); ?></td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[lab_test_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[inspection_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[design_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[studio_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[freight_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[currier_pre_cost_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[certificate_pre_cost_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[wash_cost_job], 4); ?></td>
						</tr>
					</table>
				</td>
				<td align="right" valign="top">
					<table>
						<tr>
							<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[OtherDirectExpenses_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[lab_test_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[inspection_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[design_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[studio_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[freight_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[currier_pre_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[certificate_pre_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
						<tr>
							<td align="right" title="<?= $summary_data[wash_cost] . '=' . $summary_data[price_dzn]; ?>"><? echo fn_number_format(($summary_data[wash_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td align="center">10</td>
				<td style="font-weight:bold">Contributions/Value Additions (3-4)</td>
				<?
				$Contribution_Margin = $NetFOBValue - $Less_Cost_Material_Services;
				$Contribution_Margin_job = $NetFOBValue_job - $Less_Cost_Material_Services_job;
				?>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format($Contribution_Margin, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($Contribution_Margin_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($Contribution_Margin_job / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">11</td>
				<td style=" padding-left:15px">Less: CM Cost </td>
				<td align="right"><? echo fn_number_format($summary_data[cm_cost], 4); ?> </td>
				<td align="right"><? echo fn_number_format($summary_data[cm_cost_job], 4); ?></td>
				<td align="right"><? echo fn_number_format(($summary_data[cm_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">12</td>
				<td style="font-weight:bold">Gross Profit (10-11)</td>
				<?
				$Gross_Profit = $Contribution_Margin - $summary_data[cm_cost];
				$Gross_Profit_job = $Contribution_Margin_job - $summary_data[cm_cost_job];
				?>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format($Gross_Profit, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($Gross_Profit_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($Gross_Profit_job / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">13</td>
				<td style=" padding-left:15px">Less: Commercial Cost</td>
				<td align="right"> <? echo fn_number_format($summary_data[comm_cost], 4); ?></td>
				<td align="right"><? echo fn_number_format($summary_data[comm_cost_job], 4); ?></td>
				<td align="right"><? echo fn_number_format(($summary_data[comm_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">14</td>
				<td style=" padding-left:15px">Less: Operating Expensees</td>
				<td align="right"><? echo fn_number_format($summary_data[common_oh], 4); ?> </td>
				<td align="right"><? echo fn_number_format($summary_data[common_oh_job], 4); ?> </td>
				<td align="right"><? echo fn_number_format(($summary_data[common_oh_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">15</td>
				<td style="font-weight:bold">Operating Profit/ Loss (12-(13+14))</td>
				<?
				$OperatingProfitLoss = $Gross_Profit - ($summary_data[comm_cost] + $summary_data[common_oh]);
				$OperatingProfitLoss_job = $Gross_Profit_job - ($summary_data[comm_cost_job] + $summary_data[common_oh_job]);
				?>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format($OperatingProfitLoss, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($OperatingProfitLoss_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($OperatingProfitLoss_job / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">16</td>
				<td style=" padding-left:15px">Less: Depreciation & Amortization </td>

				<td align="right"> <? echo fn_number_format($summary_data[depr_amor_pre_cost], 4); ?></td>
				<td align="right"><? echo fn_number_format($summary_data[depr_amor_pre_cost_job], 4); ?></td>
				<td align="right"><? echo fn_number_format(($summary_data[depr_amor_pre_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<?
				$pre_costing_date = change_date_format($costing_date, '', '', 1);
				$interest_expense = $NetFOBValue * $financial_para[$pre_costing_date][interest_expense] / 100;
				$income_tax = $NetFOBValue * $financial_para[$pre_costing_date][income_tax] / 100;
				$interest_expense_job = $NetFOBValue_job * $financial_para[$pre_costing_date][interest_expense] / 100;
				$income_tax_job = $NetFOBValue_job * $financial_para[$pre_costing_date][income_tax] / 100;
				?>
				<td align="center">17</td>
				<td style=" padding-left:15px">Less: Interest </td>

				<td align="right"> <? echo fn_number_format($interest_expense, 4); ?></td>
				<td align="right"><? echo fn_number_format($interest_expense_job, 4); ?></td>
				<td align="right"><? echo fn_number_format(($interest_expense_job / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">18</td>
				<td style=" padding-left:15px">Less: Income Tax</td>

				<td align="right"> <? echo fn_number_format($income_tax, 4); ?></td>
				<td align="right"><? echo fn_number_format($income_tax_job, 4); ?></td>
				<td align="right"><? echo fn_number_format(($income_tax_job / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<?
				$Netprofit = $OperatingProfitLoss - ($summary_data[depr_amor_pre_cost] + $interest_expense + $income_tax);
				$Netprofit_job = $OperatingProfitLoss_job - ($summary_data[depr_amor_pre_cost_job] + $interest_expense_job + $income_tax_job);
				?>
				<td align="center">19</td>
				<td style="font-weight:bold">Net Profit/Loss (15-(16+17+18))</td>

				<td align="right" style="font-weight:bold"><? echo fn_number_format($Netprofit, 4); ?> </td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($Netprofit_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($Netprofit_job / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
		</table>
	</div>
	<?




	//2 Fabric Cost part here-------------------------------------------
	$condition = new condition();
	if (str_replace("'", "", $txt_job_no) != '') {
		$condition->job_no("=$txt_job_no");
	}
	if (str_replace("'", '', $txt_po_breack_down_id) != "") {
		$condition->po_id("in($txt_po_breack_down_id)");
	}
	$condition->init();
	$fabric = new fabric($condition);  //echo $fabric->getQuery();
	$fabric_qty = $fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
	$fabric_amount = $fabric->getAmountArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
	$yarn = new yarn($condition);
	$conversion = new conversion($condition);
	$trim = new trims($condition);
	$emblishment = new emblishment($condition);
	$wash = new wash($condition);
	$commercial = new commercial($condition);





	//2	All Fabric Cost part here-------------------------------------------
	$sql = "select id, job_no, body_part_id, fab_nature_id, color_type_id, fabric_description, uom, avg_cons, avg_cons_yarn, fabric_source, gsm_weight, rate, amount, avg_finish_cons, status_active from wo_pre_cost_fabric_cost_dtls where job_no=" . $txt_job_no . "  and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);

	$knit_fab = "";
	$woven_fab = "";
	$knit_subtotal_avg_cons = 0;
	$knit_subtotal_amount = 0;
	$woven_subtotal_avg_cons = 0;
	$woven_subtotal_amount = 0;
	$grand_total_amount = 0;

	$i = 1;
	$j = 1;
	foreach ($data_array as $row) {


		$knit_cost_dzn = $row[csf("amount")];
		$woven_cost_dzn = $row[csf("amount")];

		$uom = $unit_of_measurement[$row[csf("uom")]];
		$item_descrition = $body_part[$row[csf("body_part_id")]] . ", " . $color_type[$row[csf("color_type_id")]] . ", " . $row[csf("fabric_description")] . ", " . $row[csf("gsm_weight")];

		if ($row[csf("fab_nature_id")] == 2) { //knit fabrics
			$i++;
			$totalConsKnit = $fabric_qty['knit']['grey'][$row[csf("id")]][$row[csf("uom")]];
			$totalAmountKnit = $fabric_amount['knit']['grey'][$row[csf("id")]][$row[csf("uom")]];
			$amount = $row[csf("avg_cons")] * $row[csf("rate")];

			$fincons = $fabric_qty['knit']['finish'][$row[csf("id")]][$row[csf("uom")]];
			$greycons = $fabric_qty['knit']['grey'][$row[csf("id")]][$row[csf("uom")]];



			$knit_fab .= '<tr>
				<td align="left">' . $item_descrition . '</td>
				<td align="left">' . $fabric_source[$row[csf("fabric_source")]] . '</td>
				<td align="right">' . fn_number_format($row[csf("avg_cons")], 4) . '</td>
				<td align="right">' . fn_number_format($totalConsKnit, 4) . '</td>
				<td align="left">' . $uom . '</td>
				<td align="right">' . fn_number_format($row[csf("rate")], 4) . '</td>
				<td align="right">' . fn_number_format($amount, 4) . '</td>
				<td align="right">' . fn_number_format($totalAmountKnit, 4) . '</td>
			</tr>';
			if ($row[csf("uom")] == 1) {
				$DznConsKnitSubTotalPcs += $row[csf("avg_cons")];
				$TotalConsKnitSubTotalPcs += $totalConsKnit;
				$DznAmountKnitSubTotalPcs += $amount;
				$TotalAmountKnitSubTotalPcs += $totalAmountKnit;



				$knit_subtotal_amount_dzn_pcs += $amount;
				$knit_subtotal_amount_pcs += $totalAmountKnit;
				$knit_subtotal_avg_cons_pcs += $totalAmountKnit;;
			}
			if ($row[csf("uom")] == 12) {
				$DznConsKnitSubTotalKg += $row[csf("avg_cons")];
				$TotalConsKnitSubTotalKg += $totalConsKnit;
				$DznAmountKnitSubTotalKg += $amount;
				$TotalAmountKnitSubTotalKg += $totalAmountKnit;


				$knit_subtotal_avg_cons += $greycons;
				$knit_subtotal_avg_finish_cons += $fincons;
				$knit_subtotal_amount += $totalAmountKnit;
				$knit_subtotal_amount_dzn += $knit_cost_dzn;
				if ($knit_subtotal_amount_dzn > 0) {
					$knit_subtotal_amount_kg = $knit_subtotal_amount / $knit_subtotal_avg_cons;
				} else {
					$knit_subtotal_amount_kg = 0;
				}
			}
			if ($row[csf("uom")] == 23) {
				$DznConsKnitSubTotalMtr += $row[csf("avg_cons")];
				$TotalConsKnitSubTotalMtr += $totalConsKnit;
				$DznAmountKnitSubTotalMtr += $amount;
				$TotalAmountKnitSubTotalMtr += $totalAmountKnit;


				$knit_subtotal_amount_dzn_mtr += $amount;
				$knit_subtotal_amount_mtr += $totalAmountKnit;
				$knit_subtotal_avg_cons_mtr += $totalAmountKnit;;
			}
			if ($row[csf("uom")] == 27) {
				$DznConsKnitSubTotalYds += $row[csf("avg_cons")];
				$TotalConsKnitSubTotalYds += $totalConsKnit;
				$DznAmountKnitSubTotalYds += $amount;
				$TotalAmountKnitSubTotalYds += $totalAmountKnit;

				$knit_subtotal_amount_dzn_yds += $amount;
				$knit_subtotal_amount_yds += $totalAmountKnit;
				$knit_subtotal_avg_cons_yds += $totalAmountKnit;;
			}
			$GrandtotalDznAmount += $amount;
			$GrandtotalAmount += $totalAmountKnit;

			$GrandTotalFabricDznAmount += $amount;
			$GrandTotalFabricAmount += $totalAmountKnit;
		}

		if ($row[csf("fab_nature_id")] == 3) { //woven fabrics
			$j++;
			$totalConsWoven = $fabric_qty['woven']['grey'][$row[csf("id")]][$row[csf("uom")]];
			$totalAmountWoven = $fabric_amount['woven']['grey'][$row[csf("id")]][$row[csf("uom")]];
			$amount = $row[csf("avg_cons")] * $row[csf("rate")];
			$woven_fab .= '<tr>
				<td align="left">' . $item_descrition . '</td>
				<td align="left">' . $fabric_source[$row[csf("fabric_source")]] . '</td>
				<td align="right">' . fn_number_format($row[csf("avg_cons")], 4) . '</td>
				<td align="right">' . fn_number_format($totalConsWoven, 4) . '</td>
				<td align="left">' . $uom . '</td>
				<td align="right">' . fn_number_format($row[csf("rate")], 4) . '</td>
				<td align="right">' . fn_number_format($amount, 4) . '</td>
				<td align="right">' . fn_number_format($totalAmountWoven, 4) . '</td>
			</tr>';

			if ($row[csf("uom")] == 1) {
				$DznConsWovenSubTotalPcs += $row[csf("avg_cons")];
				$TotalConsWovenSubTotalPcs += $totalConsWoven;
				$DznAmountWovenSubTotalPcs += $amount;
				$TotalAmountWovenSubTotalPcs += $totalAmountWoven;
			}
			if ($row[csf("uom")] == 12) {
				$DznConsWovenSubTotalKg += $row[csf("avg_cons")];
				$TotalConsWovenSubTotalKg += $totalConsWoven;
				$DznAmountWovenSubTotalKg += $amount;
				$TotalAmountWovenSubTotalKg += $totalAmountWoven;
			}
			if ($row[csf("uom")] == 23) {
				$DznConsWovenSubTotalMtr += $row[csf("avg_cons")];
				$TotalConsWovenSubTotalMtr += $totalConsWoven;
				$DznAmountWovenSubTotalMtr += $amount;
				$TotalAmountWovenSubTotalMtr += $totalAmountWoven;
			}
			if ($row[csf("uom")] == 27) {
				$DznConsWovenSubTotalYds += $row[csf("avg_cons")];
				$TotalConsWovenSubTotalYds += $totalConsWoven;
				$DznAmountWovenSubTotalYds += $amount;
				$TotalAmountWovenSubTotalYds += $totalAmountWoven;
			}
			$GrandtotalDznAmount += $amount;
			$GrandtotalAmount += $totalAmountWoven;

			$GrandTotalFabricDznAmount += $amount;
			$GrandTotalFabricAmount += $totalAmountWoven;


			$woven_subtotal_avg_cons += $row[csf("avg_cons")];

			$woven_subtotal_amount += $totalAmountWoven;
			$woven_subtotal_amount_dzn += $amount;
			$woven_subtotal_amount_kg = $woven_subtotal_amount / $woven_subtotal_amount_dzn;
		}
	}

	if ($DznConsKnitSubTotalPcs > 0) $i++;
	if ($DznConsKnitSubTotalKg > 0) $i++;
	if ($DznConsKnitSubTotalMtr > 0) $i++;
	if ($DznConsKnitSubTotalYds > 0) $i++;
	if ($DznConsWovenSubTotalPcs > 0) $j++;
	if ($DznConsWovenSubTotalKg > 0) $j++;
	if ($DznConsWovenSubTotalMtr > 0) $j++;
	if ($DznConsWovenSubTotalYds > 0) $j++;

	$knit_fab = '<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<label><b>All Fabric Cost  </b></label>
					<tr style="font-weight:bold"  align="center">
						<td width="80" rowspan="' . $i . '" ><div class="verticalText"><b>Knit Fabric</b></div></td>
						<td width="350">Description</td>
						<td width="100">Source</td>
						<td width="100">Fab. Cons/' . $costing_for . '</td>
						<td width="100">Total Cons</td>
						<td width="100">UOM</td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)/' . $costing_for . '</td>
						<td width="100">Tot.Amount (USD)</td>
					</tr>' . $knit_fab;
	if ($DznConsWovenSubTotalPcs > 0 || $DznConsWovenSubTotalKg > 0 || $DznConsWovenSubTotalMtr > 0 || $DznConsWovenSubTotalYds > 0) {
		$woven_fab = '<tr><td colspan="9">&nbsp;</td></tr><tr>
					<td width="80" rowspan="' . $j . '"><div class="verticalText"><b>Woven Fabric</b></div></td></tr>' . $woven_fab;
	}

	//knit fabrics table here
	if ($DznConsKnitSubTotalPcs > 0) {
		$knit_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="2" align="left">Sub Total(Pcs)</td>
						<td align="right">' . fn_number_format($DznConsKnitSubTotalPcs, 4) . '</td>
						<td align="right">' . fn_number_format($TotalConsKnitSubTotalPcs, 4) . '</td>
						<td></td>
						<td></td>
						<td align="right">' . fn_number_format($DznAmountKnitSubTotalPcs, 4) . '</td>
						<td align="right">' . fn_number_format($TotalAmountKnitSubTotalPcs, 4) . '</td>
					</tr>';
	}
	if ($DznConsKnitSubTotalKg > 0) {
		$knit_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="2" align="left">Sub Total(Kg)</td>
						<td align="right">' . fn_number_format($DznConsKnitSubTotalKg, 4) . '</td>
						<td align="right">' . fn_number_format($TotalConsKnitSubTotalKg, 4) . '</td>
						<td></td>
						<td></td>
						<td align="right">' . fn_number_format($DznAmountKnitSubTotalKg, 4) . '</td>
						<td align="right">' . fn_number_format($TotalAmountKnitSubTotalKg, 4) . '</td>
					</tr>';
	}
	if ($DznConsKnitSubTotalMtr > 0) {
		$knit_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="2" align="left">Sub Total(Mtr)</td>
						<td align="right">' . fn_number_format($DznConsKnitSubTotalMtr, 4) . '</td>
						<td align="right">' . fn_number_format($TotalConsKnitSubTotalMtr, 4) . '</td>
						<td></td>
						<td></td>
						<td align="right">' . fn_number_format($DznAmountKnitSubTotalMtr, 4) . '</td>
						<td align="right">' . fn_number_format($TotalAmountKnitSubTotalMtr, 4) . '</td>
					</tr>';
	}
	if ($DznConsKnitSubTotalYds > 0) {
		$knit_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="2" align="left">Sub Total(Yds)</td>
						<td align="right">' . fn_number_format($DznConsKnitSubTotalYds, 4) . '</td>
						<td align="right">' . fn_number_format($TotalConsKnitSubTotalYds, 4) . '</td>
						<td></td>
						<td></td>
						<td align="right">' . fn_number_format($DznAmountKnitSubTotalYds, 4) . '</td>
						<td align="right">' . fn_number_format($TotalAmountKnitSubTotalYds, 4) . '</td>
					</tr>';
	}

	if ($zero_value == 1) echo $knit_fab;
	else {
		if ($row[csf("avg_cons")] > 0) echo $knit_fab;
		else echo "";
	}

	//woven fabrics table here
	if ($DznConsWovenSubTotalPcs > 0) {
		$woven_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="2" align="left">Sub Total(Pcs)</td>
					<td align="right">' . fn_number_format($DznConsWovenSubTotalPcs, 4) . '</td>
					<td align="right">' . fn_number_format($TotalConsWovenSubTotalPcs, 4) . '</td>
					<td></td>
					<td></td>
					<td align="right">' . fn_number_format($DznAmountWovenSubTotalPcs, 4) . '</td>
					<td align="right">' . fn_number_format($TotalAmountWovenSubTotalPcs, 4) . '</td>
				</tr>';
	}
	if ($DznConsWovenSubTotalKg > 0) {
		$woven_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="2" align="left">Sub Total(Kg)</td>
					<td align="right">' . fn_number_format($DznConsWovenSubTotalKg, 4) . '</td>
					<td align="right">' . fn_number_format($TotalConsWovenSubTotalKg, 4) . '</td>
					<td></td>
					<td></td>
					<td align="right">' . fn_number_format($DznAmountWovenSubTotalKg, 4) . '</td>
					<td align="right">' . fn_number_format($TotalAmountWovenSubTotalKg, 4) . '</td>
				</tr>';
	}
	if ($DznConsWovenSubTotalMtr > 0) {
		$woven_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="2" align="left">Sub Total(Mtr)</td>
					<td align="right">' . fn_number_format($DznConsWovenSubTotalMtr, 4) . '</td>
					<td align="right">' . fn_number_format($TotalConsWovenSubTotalMtr, 4) . '</td>
					<td></td>
					<td></td>
					<td align="right">' . fn_number_format($DznAmountWovenSubTotalMtr, 4) . '</td>
					<td align="right">' . fn_number_format($TotalAmountWovenSubTotalMtr, 4) . '</td>
				</tr>';
	}
	if ($DznConsWovenSubTotalYds > 0) {
		$woven_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="2" align="left">Sub Total(Yds)</td>
					<td align="right">' . fn_number_format($DznConsWovenSubTotalYds, 4) . '</td>
					<td align="right">' . fn_number_format($TotalAmountWovenSubTotalYds, 4) . '</td>
					<td></td>
					<td></td>
					<td align="right">' . fn_number_format($DznAmountWovenSubTotalYds, 4) . '</td>
					<td align="right">' . fn_number_format($DznAmountWovenSubTotalYds, 4) . '</td>
				</tr>';
	}

	$woven_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="4" align="left">Total</td>
					<td align="right"></td>
					<td></td>
					<td></td>
					<td align="right">' . fn_number_format(($GrandtotalDznAmount), 4) . '</td>
					<td align="right">' . fn_number_format(($GrandtotalAmount), 4) . '</td>
				</tr></table></div>';
	if ($zero_value == 1) echo $woven_fab;
	else {
		if ($row[csf("avg_cons")] > 0) echo $woven_fab;
		else echo "";
	}
	//end 	All Fabric Cost part report-------------------------------------------


	//Start	Yarn Cost part report here -------------------------------------------
	$lib_yarn_count = return_library_array("select yarn_count,id from lib_yarn_count", "id", "yarn_count");
	if ($zero_value == 1) {
	?>
		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<tr style="font-weight:bold">
					<td width="70" rowspan="<? echo count($YarnData) + 2; ?>">
						<div class="verticalText"><b>Yarn Cost</b></div>
					</td>
					<td width="350">Yarn Desc</td>
					<td width="100">Yarn Qty</td>
					<td width="100">Total Qty</td>
					<td width="100">Rate (USD)</td>
					<td width="100">Amount (USD)/<? echo $costing_for; ?></td>
					<td width="100">Tot.Amount (USD)</td>
				</tr>
				<?
				$TotalDznQty = 0;
				$TotalQty = 0;
				$TotalDznAmount = 0;
				$TotalAmount = 0;
				$total_yarn_cost_dzn = 0;
				$total_yarn_cost_kg = 0;
				foreach ($YarnData as $index => $row) {
					$des = explode("_", str_replace("'", "", $index));
					$item_descrition = $lib_yarn_count[$des[0]] . " " . $composition[$des[1]] . " " . $des[2] . "% " . $color_library[$des[4]] . " " . $yarn_type[$des[3]];
				?>
					<tr>
						<td align="left"><? echo $item_descrition; ?></td>
						<td align="right"><? echo fn_number_format($row["dznqty"], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["qty"], 4); ?></td>
						<td align="right"><? echo fn_number_format($des[5], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["dznamount"], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["amount"], 4); ?></td>
					</tr>
				<?
					$TotalDznQty += $row["dznqty"];
					$TotalQty += $row["qty"];
					$TotalDznAmount += $row["dznamount"];
					$TotalAmount += $row["amount"];

					$GrandTotalFabricDznAmount += $row["dznamount"];
					$GrandTotalFabricAmount += $row["amount"];

					$total_avg_yarn_qty += $TotalDznQty;
					$total_yarn_amount += $row["amount"];
					$total_yarn_cost_dzn += $row["dznamount"];
					$total_yarn_cost_kg = $TotalDznAmount / $TotalDznQty;
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td align="left">Total</td>
					<td align="right"><? echo fn_number_format($TotalDznQty, 4); ?></td>
					<td align="right"><? echo fn_number_format($TotalQty, 4); ?></td>
					<td></td>
					<td align="right"><? echo fn_number_format($TotalDznAmount, 4); ?></td>
					<td align="right"><? echo fn_number_format($TotalAmount, 4); ?></td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($totYarn > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<tr style="font-weight:bold">
						<td width="70" rowspan="<? echo count($YarnData) + 2; ?>">
							<div class="verticalText"><b>Yarn Cost</b></div>
						</td>
						<td width="350">Yarn Desc</td>
						<td width="100">Yarn Qty</td>
						<td width="100">Avg.Yarn Qty</td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)/<? echo $costing_for; ?></td>
						<td width="100">Tot.Amount (USD)</td>
					</tr>
					<?
					$TotalDznQty = 0;
					$TotalQty = 0;
					$TotalDznAmount = 0;
					$TotalAmount = 0;
					foreach ($YarnData as $index => $row) {
						$des = explode("_", str_replace("'", "", $index));
						$item_descrition = $lib_yarn_count[$des[0]] . " " . $composition[$des[1]] . " " . $des[2] . "% " . $color_library[$des[4]] . " " . $yarn_type[$des[3]];
					?>
						<tr>
							<td align="left"><? echo $item_descrition; ?></td>
							<td align="right"><? echo fn_number_format($row["dznqty"], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["qty"], 4); ?></td>
							<td align="right"><? echo fn_number_format($des[5], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["dznamount"], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["amount"], 4); ?></td>
						</tr>
					<?
						$TotalDznQty += $row["dznqty"];
						$TotalQty += $row["qty"];
						$TotalDznAmount += $row["dznamount"];
						$TotalAmount += $row["amount"];

						$GrandTotalFabricDznAmount += $row["dznamount"];
						$GrandTotalFabricAmount += $row["amount"];

						$total_yarn_cost_dzn += $row["dznamount"];
						$total_yarn_cost_kg = $total_yarn_amount / $TotalDznQty;
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td align="left">Total</td>
						<td align="right"><? echo fn_number_format($TotalDznQty, 4); ?></td>
						<td align="right"><? echo fn_number_format($TotalQty, 4); ?></td>
						<td></td>
						<td align="right"><? echo fn_number_format($TotalDznAmount, 4); ?></td>
						<td align="right"><? echo fn_number_format($TotalAmount, 4); ?></td>
					</tr>
				</table>
			</div>
		<?
		} else echo "";
	}
	//End Yarn Cost part report here -------------------------------------------


	//start	Conversion Cost to Fabric report here -------------------------------------------
	if ($zero_value == 1) {
		?>
		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<tr style="font-weight:bold">
					<td width="80" rowspan="<? echo count($ConvData) + 3; ?>">
						<div class="verticalText"><b>Conversion Cost to Fabric</b></div>
					</td>
					<td width="350">Particulars</td>
					<td width="100">Process</td>
					<td width="100">Cons/<? echo $costing_for; ?></td>
					<td width="100">Total Cons</td>
					<td width="100">Uom</td>
					<td width="100">Rate (USD)</td>
					<td width="100">Amount (USD)/<? echo $costing_for; ?></td>
					<td width="100">Total Amount (USD)</td>
				</tr>
				<?
				$TotalDznAmount = 0;
				$TotalAmount = 0;
				foreach ($ConvData as $index => $row) {
				?>
					<tr>
						<td align="left"><? echo $row['item_descrition']; ?></td>
						<td align="left"><? echo $conversion_cost_head_array[$row["cons_process"]]; ?></td>
						<td align="right"><? echo fn_number_format($row["req_qnty"], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["tot_req_qnty"], 4); ?></td>
						<td align=""><? echo $unit_of_measurement[$row["uom"]]; ?></td>
						<td align="right"><? echo fn_number_format($row["charge_unit"], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["amount"], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["tot_amount"], 4); ?></td>
					</tr>
				<?
					$TotalDznAmount += $row["amount"];
					$TotalAmount += $row["tot_amount"];
					$Total_charge_int+=$row["charge_unit"];
					$GrandTotalFabricDznAmount += $row["amount"];
					$GrandTotalFabricAmount += $row["tot_amount"];
					$total_conversion_cost_dzn += $row['amount'];
					$total_conversion_cost_kg += $row["tot_amount"];
					$total_avg_yarn_qty += $row["tot_req_qnty"];
					$grand_total_conversion_cost += $row["tot_amount"];;
					if ($total_avg_yarn_qty > 0) {
						$total_conversion_cost_kg = $grand_total_conversion_cost / $total_avg_yarn_qty;
					} else {
						$total_conversion_cost_kg = 0;
					}
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td align="left" colspan="6">Total</td>
					<td align="right"><? echo fn_number_format($TotalDznAmount, 4); ?></td>
					<td align="right"><? echo fn_number_format($TotalAmount, 4); ?></td>
				</tr>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td align="left" colspan="6">Total Fabric Cost</td>
					<td align="right"><? echo fn_number_format($GrandTotalFabricDznAmount, 4); ?></td>
					<td align="right"><? echo fn_number_format($GrandTotalFabricAmount, 4); ?></td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($totConv > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<tr style="font-weight:bold">
						<td width="80" rowspan="<? echo count($ConvData) + 3; ?>">
							<div class="verticalText"><b>Conversion Cost to Fabric</b></div>
						</td>
						<td width="350">Particulars</td>
						<td width="100">Process</td>
						<td width="100">Cons/<? echo $costing_for; ?></td>
						<td width="100">Total Cons</td>
						<td width="100">Uom</td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)/<? echo $costing_for; ?></td>
						<td width="100">Total Amount (USD)</td>
					</tr>
					<?
					$TotalDznAmount = 0;
					$TotalAmount = 0;
					foreach ($ConvData as $index => $row) {
					?>
						<tr>
							<td align="left"><? echo $row['item_descrition']; ?></td>
							<td align="left"><? echo $conversion_cost_head_array[$row["cons_process"]]; ?></td>
							<td align="right"><? echo fn_number_format($row["req_qnty"], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["tot_req_qnty"], 4); ?></td>
							<td align=""><? echo $unit_of_measurement[$row["uom"]]; ?></td>
							<td align="right"><? echo fn_number_format($row["charge_unit"], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["amount"], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["tot_amount"], 4); ?></td>
						</tr>
					<?
						$TotalDznAmount += $row["amount"];
						$TotalAmount += $row["tot_amount"];
						$Total_charge_int+=$row["charge_unit"];
						$GrandTotalFabricDznAmount += $row["amount"];
						$GrandTotalFabricAmount += $row["tot_amount"];

						$total_conversion_cost_dzn += $row['amount'];
						$grand_total_conversion_cost += $row["amount"];;
						if ($total_avg_yarn_qty > 0) {
							$total_conversion_cost_kg = $grand_total_conversion_cost / $total_avg_yarn_qty;
						} else {
							$total_conversion_cost_kg = 0;
						}
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td align="left" colspan="6">Total</td>
						<td align="right"><? echo fn_number_format($TotalDznAmount, 4); ?></td>
						<td align="right"><? echo fn_number_format($TotalAmount, 4); ?></td>
					</tr>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td align="left" colspan="6">Total Fabric Cost</td>
						<td align="right"><? echo fn_number_format($GrandTotalFabricDznAmount, 4); ?></td>
						<td align="right"><? echo fn_number_format($GrandTotalFabricAmount, 4); ?></td>
					</tr>
				</table>
			</div>
		<?
		} else echo "";
	}
	//End Conversion Cost to Fabric report here -------------------------------------------
	//start	Trims Cost part report here -------------------------------------------
	$trim_group = return_library_array("select item_name,id from  lib_item_group", "id", "item_name");
	if ($zero_value == 1) {
		?>
		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<label><b>Trims Cost</b></label>
				<tr style="font-weight:bold">
					<td width="150">Item Group</td>
					<td width="150">Description</td>
					<td width="150">Brand/Supp Ref</td>
					<td width="150">Remarks</td>
					<td width="100">UOM</td>
					<td width="100">Cons/<? echo $costing_for; ?></td>
					<td width="100">Tot. Cons</td>
					<td width="100">Rate (USD)</td>
					<td width="100">Amount (USD)/<? echo $costing_for; ?></td>
					<td width="100">Tot. Amount</td>
				</tr>
				<?
				$TotalDznAmount = 0;
				$TotalAmount = 0;
				foreach ($TrimData as $index => $row) {
				?>
					<tr>
						<td align="left"><? echo $trim_group[$row["trim_group"]]; ?></td>
						<td align="left"><? echo $row["description"]; ?></td>
						<td align="left"><? echo $row["brand_sup_ref"]; ?></td>
						<td align="left"><? echo $row["remark"]; ?></td>
						<td align="left"><? echo $unit_of_measurement[$row["cons_uom"]]; ?></td>
						<td align="right"><? echo fn_number_format($row["cons_dzn_gmts"], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["tot_cons"], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["rate"], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["amount"], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["tot_amount"], 4); ?></td>
					</tr>
				<?
					$TotalDznAmount += $row["amount"];
					$TotalAmount += $row["tot_amount"];
					$total_trims_cost += $row["tot_amount"];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="8" align="left">Total</td>
					<td align="right"><? echo fn_number_format($TotalDznAmount, 4); ?></td>
					<td align="right"><? echo fn_number_format($TotalAmount, 4); ?></td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($totTrim > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<label><b>Trims Cost</b></label>
					<tr style="font-weight:bold">
						<td width="150">Item Group</td>
						<td width="150">Description</td>
						<td width="150">Brand/Supp Ref</td>
						<td width="150">Remarks</td>
						<td width="100">UOM</td>
						<td width="100">Cons/<? echo $costing_for; ?></td>
						<td width="100">Tot. Cons</td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)/<? echo $costing_for; ?></td>
						<td width="100">Tot. Amount</td>
					</tr>
					<?
					$TotalDznAmount = 0;
					$TotalAmount = 0;
					foreach ($TrimData as $index => $row) {
					?>
						<tr>
							<td align="left"><? echo $trim_group[$row["trim_group"]]; ?></td>
							<td align="left"><? echo $row["description"]; ?></td>
							<td align="left"><? echo $row["brand_sup_ref"]; ?></td>
							<td align="left"><? echo $row["remark"]; ?></td>
							<td align="left"><? echo $unit_of_measurement[$row["cons_uom"]]; ?></td>
							<td align="right"><? echo fn_number_format($row["cons_dzn_gmts"], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["tot_cons"], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["rate"], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["amount"], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["tot_amount"], 4); ?></td>
						</tr>
					<?
						$TotalDznAmount += $row["amount"];
						$TotalAmount += $row["tot_amount"];
						$total_trims_cost += $row["tot_amount"];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="8" align="left">Total</td>
						<td align="right"><? echo fn_number_format($TotalDznAmount, 4); ?></td>
						<td align="right"><? echo fn_number_format($TotalAmount, 4); ?></td>
					</tr>
				</table>
			</div>
		<?
		} else echo "";
	}
	//End Trims Cost Part report here -------------------------------------------
	//start	Embellishment Details part report here -------------------------------------------
	if ($zero_value == 1) {
		?>
		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="
				1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<label><b>Embellishment Details</b></label>
				<tr style="font-weight:bold">
					<td width="150">Particulars</td>
					<td width="150">Type</td>
					<td width="150">Cons/<? echo $costing_for; ?></td>
					<td width="150">Tot.Cons</td>
					<td width="100">Rate (USD)</td>
					<td width="100">Amount (USD)/<? echo $costing_for; ?></td>
					<td width="100">Tot. Amount</td>
				</tr>
				<?
				$TotalDznAmount = 0;
				$TotalAmount = 0;
				$total_embellishment_amt = 0;
				$total_embellishment_amt_dzn = 0;
				foreach ($EmbData as $index => $row) {
					$em_type = "";
					$total_embellishment_amt_dzn += $row["amount"];
					//$emblishment_name_array=array(1=>"Printing",2=>"Embroidery",3=>"Wash",4=>"Special Works",5=>"Others");
					if ($row["emb_name"] == 1) $em_type = $emblishment_print_type[$row["emb_type"]];
					else if ($row["emb_name"] == 2) $em_type = $emblishment_embroy_type[$row["emb_type"]];
					else if ($row["emb_name"] == 3) $em_type = $emblishment_wash_type[$row["emb_type"]];
					else if ($row["emb_name"] == 4) $em_type = $emblishment_spwork_type[$row["emb_type"]];
					else if ($row["emb_name"] == 5) $em_type = $emblishment_gmts_type[$row["emb_type"]];
				?>
					<tr>
						<td align="left"><? echo $emblishment_name_array[$row["emb_name"]]; ?></td>
						<td align="left"><? echo $em_type; ?></td>
						<td align="right"><? echo fn_number_format($row["cons_dzn_gmts"], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["tot_cons"], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["rate"], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["amount"], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["tot_amount"], 4); ?></td>
					</tr>
				<?
					$TotalDznAmount += $row["amount"];
					$TotalAmount += $row["tot_amount"];

					$total_embellishment_amt += $row["tot_amount"];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="5" align="left">Total</td>
					<td align="right"><? echo fn_number_format($TotalDznAmount, 4); ?></td>
					<td align="right"><? echo fn_number_format($TotalAmount, 4); ?></td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($totEmb > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<label><b>Embellishment Details</b></label>
					<tr style="font-weight:bold">
						<td width="150">Particulars</td>
						<td width="150">Type</td>
						<td width="150">Cons/<? echo $costing_for; ?></td>
						<td width="150">Tot.Cons/<? echo $costing_for; ?></td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)/<? echo $costing_for; ?></td>
						<td width="100">Tot. Amount</td>
					</tr>
					<?
					$TotalDznAmount = 0;
					$TotalAmount = 0;
					foreach ($EmbData as $index => $row) {
						$em_type = "";
						//$emblishment_name_array=array(1=>"Printing",2=>"Embroidery",3=>"Wash",4=>"Special Works",5=>"Others");
						if ($row["emb_name"] == 1) $em_type = $emblishment_print_type[$row["emb_type"]];
						else if ($row["emb_name"] == 2) $em_type = $emblishment_embroy_type[$row["emb_type"]];
						else if ($row["emb_name"] == 3) $em_type = $emblishment_wash_type[$row["emb_type"]];
						else if ($row["emb_name"] == 4) $em_type = $emblishment_spwork_type[$row["emb_type"]];
						else if ($row["emb_name"] == 5) $em_type = $emblishment_gmts_type[$row["emb_type"]];
					?>
						<tr>
							<td align="left"><? echo $emblishment_name_array[$row["emb_name"]]; ?></td>
							<td align="left"><? echo $em_type; ?></td>
							<td align="right"><? echo fn_number_format($row["cons_dzn_gmts"], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["tot_cons"], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["rate"], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["amount"], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["tot_amount"], 4); ?></td>
						</tr>
					<?
						$TotalDznAmount += $row["amount"];
						$TotalAmount += $row["tot_amount"];
						$total_embellishment_amt_dzn += $row["amount"];
						$total_embellishment_amt += $row["tot_amount"];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="5" align="left">Total</td>
						<td align="right"><? echo fn_number_format($TotalDznAmount, 4); ?></td>
						<td align="right"><? echo fn_number_format($TotalAmount, 4); ?></td>
					</tr>
				</table>
			</div>
		<?
		} else echo "";
	}
	//End Embellishment Details Part report here -------------------------------------------



	//start	Commercial Cost part report here -------------------------------------------
	if ($zero_value == 1) {
		?>
		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<label><b>Commercial Cost</b></label>
				<tr style="font-weight:bold">
					<td width="150">Particulars</td>
					<td width="100">Rate In %</td>
					<td width="100">Amount (USD)/<? echo $costing_for; ?></td>
					<td width="100">Tot.Amount</td>
				</tr>
				<?
				$TotalDznAount = 0;
				$TotalAount = 0;
				$total_commercial_cost_dzn = 0;
				foreach ($CommarData as $index => $row) {
					$total_commercial_cost_dzn += $row["amount"];
				?>
					<tr>
						<td align="left"><? echo $camarcial_items[$row["item_id"]]; ?></td>
						<td align="right"><? echo fn_number_format($row["rate"], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["amount"], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["tot_amount"], 4); ?></td>
					</tr>
				<?
					$TotalDznAount += $row["amount"];
					$TotalAount += $row["tot_amount"];
					$total_commercial_cost += $row["tot_amount"];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="2" align="left">Total</td>
					<td align="right"><? echo fn_number_format($TotalDznAount, 4); ?></td>
					<td align="right"><? echo fn_number_format($TotalAount, 4); ?></td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($totCommar > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<label><b>Commercial Cost</b></label>
					<tr style="font-weight:bold">
						<td width="150">Particulars</td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)/<? echo $costing_for; ?></td>
						<td width="100">Tot.Amount</td>
					</tr>
					<?
					$TotalDznAount = 0;
					$TotalAount = 0;
					foreach ($CommarData as $index => $row) {
					?>
						<tr>
							<td align="left"><? echo $camarcial_items[$row["item_id"]]; ?></td>
							<td align="right"><? echo fn_number_format($row["rate"], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["amount"], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["tot_amount"], 4); ?></td>
						</tr>
					<?
						$TotalDznAount += $row["amount"];
						$TotalAount += $row["tot_amount"];
						$total_commercial_cost_dzn += $row["amount"];
						$total_commercial_cost += $row["tot_amount"];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="2" align="left">Total</td>
						<td align="right"><? echo fn_number_format($TotalDznAount, 4); ?></td>
						<td align="right"><? echo fn_number_format($TotalAount, 4); ?></td>
					</tr>
				</table>
			</div>
		<?
		} else echo "";
	}
	//End Commercial Cost Part report here -------------------------------------------
	//start	Commission Cost part report here -------------------------------------------
	if ($zero_value == 1) {
		?>
		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<label><b>Commission Cost</b></label>
				<tr style="font-weight:bold">
					<td width="150">Particulars</td>
					<td width="150">Commission Basis</td>
					<td width="100">Rate (USD)</td>
					<td width="100">Amount (USD)/<? echo $costing_for; ?></td>
					<td width="100">Tot. Amount</td>
				</tr>
				<?
				$TotalDznAount = 0;
				$TotalAount = 0;
				foreach ($CommiData as $index => $row) {
				?>
					<tr>
						<td align="left"><? echo $commission_particulars[$row["particulars_id"]]; ?></td>
						<td align="left"><? echo $commission_base_array[$row["commission_base_id"]]; ?></td>
						<td align="right"><? echo fn_number_format($row["commision_rate"], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["commission_amount"], 4); ?></td>
						<td align="right"><? echo fn_number_format($row["tot_commission_amount"], 4); ?></td>
					</tr>
				<?
					$TotalDznAount += $row["commission_amount"];
					$TotalAount += $row["tot_commission_amount"];
					$total_commission_cost += $row["tot_commission_amount"];;
					$total_commission_cost_dzn += $row["commission_amount"];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="3" align="left">Total</td>
					<td align="right"><? echo fn_number_format($TotalDznAount, 4); ?></td>
					<td align="right"><? echo fn_number_format($TotalAount, 4); ?></td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($totCommi > 0) {
			$TotalDznAount = 0;
			$TotalAount = 0;
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<label><b>Commission Cost</b></label>
					<tr style="font-weight:bold">
						<td width="150">Particulars</td>
						<td width="150">Commission Basis</td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)/<? echo $costing_for; ?></td>
						<td width="100">Tot. Amount</td>
					</tr>
					<?
					$total_amount = 0;
					foreach ($CommiData as $index => $row) {
					?>
						<tr>
							<td align="left"><? echo $commission_particulars[$row["particulars_id"]]; ?></td>
							<td align="left"><? echo $commission_base_array[$row["commission_base_id"]]; ?></td>
							<td align="right"><? echo fn_number_format($row["commision_rate"], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["commission_amount"], 4); ?></td>
							<td align="right"><? echo fn_number_format($row["tot_commission_amount"], 4); ?></td>
						</tr>
					<?
						$TotalDznAount += $row["commission_amount"];
						$TotalAount += $row["tot_commission_amount"];
						$total_commission_cost += $row["tot_commission_amount"];;
						$total_commission_cost_dzn += $row["commission_amount"];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="3" align="left">Total</td>
						<td align="right"><? echo fn_number_format($TotalDznAount, 4); ?></td>
						<td align="right"><? echo fn_number_format($TotalAount, 4); ?></td>
					</tr>
				</table>
			</div>
	<?
		} else echo "";
	}
	//End Commission Cost Part report here -------------------------------------------
	?>

	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:300px;" rules="all">
		<label><b>CM Details</b></label>
		<tr>
			<td width="150">CPM (TK)</td>
			<td width="150"><? echo fn_number_format($financial_para[$cm_cost_based_on_date][cost_per_minute], 4); ?></td>
		</tr>
		<tr>
			<td>SMV</td>
			<td title="Sew and Cut Smv"><?
										if ($sew_smv > 0 && $cut_smv > 0) echo $sew_smv . ',' . $cut_smv;
										else if ($sew_smv > 0 && $cut_smv == 0) echo   $sew_smv;
										else if ($sew_smv == 0 && $cut_smv > 0) echo   $cut_smv;
										else echo ""; ?></td>
		</tr>
		<tr>
			<td>EFF %</td>
			<td title="Sew and Cut Smv %">
				<? if ($sew_effi_percent > 0 && $cut_effi_percent > 0) echo $sew_effi_percent . ',' . $cut_effi_percent;
				else if ($sew_effi_percent > 0 && $cut_effi_percent == 0) echo   $sew_effi_percent;
				else if ($sew_effi_percent == 0 && $cut_effi_percent > 0) echo   $cut_effi_percent;
				else echo ""; ?>
			</td>
		</tr>
	</table>
	<br />



	<?
	//End Commission Cost Part report here -------------------------------------------


	//start	Other Components part report here -------------------------------------------
	$sql = "select id,job_no,costing_per_id,order_uom_id,fabric_cost,fabric_cost_percent,trims_cost,trims_cost_percent,embel_cost,embel_cost_percent,comm_cost,comm_cost_percent,commission,commission_percent,lab_test,lab_test_percent,inspection,inspection_percent,cm_cost,cm_cost_percent,freight,freight_percent,common_oh,common_oh_percent,currier_pre_cost, currier_percent, 	certificate_pre_cost, certificate_percent, total_cost, total_cost_percent, price_dzn, price_dzn_percent, margin_dzn, margin_dzn_percent, price_pcs_or_set, price_pcs_or_set_percent, margin_pcs_set,margin_pcs_set_percent,cm_for_sipment_sche  from wo_pre_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	$total_other_components = 0;
	$lab_test_dzn = 0;
	$lab_test = 0;
	$inspection = 0;
	$cm_cost = 0;
	$freight = 0;
	$common_oh = 0;
	foreach ($data_array as $row) {
		$lab_test = $row[csf("lab_test")] / $order_price_per_dzn * $ord_qty;
		$inspection = $row[csf("inspection")] / $order_price_per_dzn * $ord_qty;
		$cm_cost = $row[csf("cm_cost")] / $order_price_per_dzn * $ord_qty;
		$freight = $row[csf("freight")] / $order_price_per_dzn * $ord_qty;
		$common_oh = $row[csf("common_oh")] / $order_price_per_dzn * $ord_qty;
		$currier_pre_cost = $row[csf("currier_pre_cost")] / $order_price_per_dzn * $ord_qty;
		$certificate_pre_cost = $row[csf("certificate_pre_cost")] / $order_price_per_dzn * $ord_qty;
		$lab_test_dzn = $row[csf("lab_test")];
		$inspection_dzn = $row[csf("inspection")];
		$cm_cost_dzn = $row[csf("cm_cost")];
		$common_oh_dzn = $row[csf("common_oh")];
		$freight_dzn = $row[csf("freight")];
		$currier_pre_cost_dzn = $row[csf("currier_pre_cost")];
		$certificate_pre_cost_dzn = $row[csf("certificate_pre_cost")];
		$total_trims_cost_dzn = $row[csf("trims_cost")];
	}
	?>

	<div style="margin-top:15px">

		<td valign="top" rowspan="2">

			<?
			// image show here  -------------------------------------------
			$sql = "select id,master_tble_id,image_location
				from common_photo_library
				where master_tble_id=$txt_job_no limit 1";
			$data_array = sql_select($sql);
			$path = ($path) ? $path : '../../';
			?>
			<div style="margin:15px 5px;float:right;width:500px">
				<? foreach ($data_array as $inf) { ?>
					<img src='<? echo $path . $inf[csf("image_location")]; ?>' height='400' width='300' />
				<?  } ?>
			</div>
		</td>
		</tr>
		<tr>
			<td>
				<?
				$total_summary_amount = 0;
				$total_summary_amount = $knit_subtotal_amount + $knit_subtotal_amount_yds + $knit_subtotal_amount_pcs + $knit_subtotal_amount_mtr + $woven_subtotal_amount + $total_yarn_amount + $grand_total_conversion_cost + $grand_total_conversion_cost_yds + $total_trims_cost + $total_embellishment_amt + $total_commercial_cost + $total_commission_cost + $lab_test + $inspection + $cm_cost + $freight + $currier_pre_cost + $certificate_pre_cost + $common_oh;
				?>
				<div style="margin-top:15px">
					<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:500px;text-align:center" rules="all">
						<label><b>Summary</b></label>
						<tr style="font-weight:bold">
							<td width="150">Cost Summary</td>
							<td width="100">Cost/DZN</td>
							<td width="100">Cost/Kg</td>
							<td width="100">Total</td>
						</tr>
						<tr>
							<td align="left">Knit Fabric (Purchase) (kg) </td>
							<td align="right"><? echo fn_number_format($knit_subtotal_amount_dzn, 4); ?></td>
							<td align="right"><? echo fn_number_format($knit_subtotal_amount / $knit_subtotal_avg_cons, 4); ?></td>
							<td align="right"><? echo fn_number_format($knit_subtotal_amount, 4); ?></td>
						</tr>
						<tr>
							<td align="left">Knit Fabric (Purchase) (Yds)</td>
							<td align="right"><? echo fn_number_format($knit_subtotal_amount_dzn_yds, 4); ?></td>
							<td align="right"><? echo fn_number_format($knit_subtotal_amount_yds / $knit_subtotal_avg_cons_yds, 4); ?></td>
							<td align="right"><? echo fn_number_format($knit_subtotal_amount_yds, 4); ?></td>
						</tr>
						<tr>
							<td align="left">Knit Fabric (Purchase) (Pcs)</td>
							<td align="right"><? echo fn_number_format($knit_subtotal_amount_dzn_pcs, 4); ?></td>
							<td align="right"><? echo fn_number_format($knit_subtotal_amount_pcs / $knit_subtotal_avg_cons_pcs, 4); ?></td>
							<td align="right"><? echo fn_number_format($knit_subtotal_amount_pcs, 4); ?></td>
						</tr>
						<tr>
							<td align="left">Knit Fabric (Purchase) (Mtr)</td>
							<td align="right"><? echo fn_number_format($knit_subtotal_amount_dzn_mtr, 4); ?></td>
							<td align="right"><? echo fn_number_format($knit_subtotal_amount_mtr / $knit_subtotal_avg_cons_mtr, 4); ?></td>
							<td align="right"><? echo fn_number_format($knit_subtotal_amount_mtr, 4); ?></td>
						</tr>
						<tr>
							<td align="left">Woven Fabric (Purchase)</td>
							<td align="right"><? echo fn_number_format($woven_subtotal_amount_dzn, 4); ?></td>
							<td align="right"><? echo fn_number_format($woven_subtotal_amount_kg, 4); ?></td>
							<td align="right"><? echo fn_number_format($woven_subtotal_amount, 4); ?></td>
						</tr>
						<tr>
							<td align="left">Yarn</td>
							<td align="right"><? echo fn_number_format($total_yarn_cost_dzn, 4); ?></td>
							<td align="right"><? echo fn_number_format($total_yarn_cost_kg, 4); ?></td>
							<td align="right"><? echo fn_number_format($total_yarn_amount, 4); ?></td>
						</tr>
						<tr>
							<td align="left">Conversion to Fabric (Kg)</td>
							<td align="right"><? echo fn_number_format($total_conversion_cost_dzn, 4); ?></td>
							<td align="right"><? echo fn_number_format($Total_charge_int, 4); ?></td>
							<td align="right"><? echo fn_number_format($grand_total_conversion_cost, 4); ?></td>
						</tr>
						<tr>
							<td align="left">Conversion to Fabric (Yds)</td>
							<td align="right"><? echo fn_number_format($total_conversion_cost_dzn_yds, 4); ?></td>
							<td align="right"><? echo fn_number_format($total_conversion_cost_kg_yds, 4); ?></td>
							<td align="right"><? echo fn_number_format($grand_total_conversion_cost_yds, 4); ?></td>
						</tr>
						<tr>
							<td align="left">Trims</td>
							<td align="right"><? echo fn_number_format($total_trims_cost_dzn, 4); ?></td>
							<td align="right" rowspan="11"><? //echo fn_number_format($total_trims_cost_kg,4); 
															?></td>
							<td align="right"><? echo fn_number_format($total_trims_cost, 4); ?></td>
						</tr>
						<tr>
							<td align="left">Embellishment</td>
							<td align="right"><? echo fn_number_format($total_embellishment_amt_dzn, 4); ?></td>
							<td align="right"><? echo fn_number_format($total_embellishment_amt, 4); ?></td>
						</tr>
						<tr>
							<td align="left">Commercial</td>
							<td align="right"><? echo fn_number_format($total_commercial_cost_dzn, 4); ?></td>
							<td align="right"><? echo fn_number_format($total_commercial_cost, 4); ?></td>
						</tr>
						<tr>
							<td align="left">Commission</td>
							<td align="right"><? echo fn_number_format($total_commission_cost_dzn, 4); ?></td>
							<td align="right"><? echo fn_number_format($total_commission_cost, 4); ?></td>
						</tr>
						<tr>
							<td align="left">Lab Test</td>
							<td align="right"><? echo fn_number_format($lab_test_dzn, 4); ?></td>
							<td align="right"><? echo fn_number_format($lab_test, 4); ?></td>
						</tr>
						<tr>
							<td align="left">Inspection Cost</td>
							<td align="right"><? echo fn_number_format($inspection_dzn, 4); ?></td>
							<td align="right"><? echo fn_number_format($inspection, 4); ?></td>
						</tr>
						<tr>
							<td align="left">CM Cost - IE</td>
							<td align="right"><? echo fn_number_format($cm_cost_dzn, 4); ?></td>
							<td align="right"><? echo fn_number_format($cm_cost, 4); ?></td>
						</tr>
						<tr>
							<td align="left">Freight Cost</td>
							<td align="right"><? echo fn_number_format($freight_dzn, 4); ?></td>
							<td align="right"><? echo fn_number_format($freight, 4); ?></td>
						</tr>

						<tr>
							<td align="left">Currier Cost </td>
							<td align="right"><? echo fn_number_format($currier_pre_cost_dzn, 4); ?></td>
							<td align="right"><? echo fn_number_format($currier_pre_cost, 4); ?></td>
						</tr>

						<tr>
							<td align="left">Certificate Cost </td>
							<td align="right"><? echo fn_number_format($certificate_pre_cost_dzn, 4); ?></td>
							<td align="right"><? echo fn_number_format($certificate_pre_cost, 4); ?></td>
						</tr>
						<tr>
							<td align="left">Office OH</td>
							<td align="right"><? echo fn_number_format($common_oh_dzn, 4); ?></td>
							<td align="right"><? echo fn_number_format($common_oh, 4); ?></td>
						</tr>
						<tr class="rpt_bottom" style="font-weight:bold">
							<td align="right" colspan="3">Total</td>
							<td align="right"><? echo fn_number_format($total_summary_amount, 4); ?></td>
						</tr>
					</table>
			</td>
		</tr>
		</table>
	</div>
	<!--End CM on Net Order Value Part report here -->
	<br />
	<? echo signature_table(109, $cbo_company_name, "850px"); ?>
	</div>
	<?
	exit();
}

if ($action == "trims_check_list") // md mamun =>08-06-2022=>12811
{
	///extract($_REQUEST);
	$process = array(&$_POST);
	extract(check_magic_quote_gpc($process));
	$txt_costing_date = change_date_format(str_replace("'", "", $txt_costing_date), 'yyyy-mm-dd', '-');
	if ($txt_job_no == "") $job_no = '';
	else $job_no = " and a.job_no=" . $txt_job_no . "";
	if ($cbo_company_name == "") $company_name = '';
	else $company_name = " and a.company_name=" . $cbo_company_name . "";
	if ($cbo_buyer_name == "") $cbo_buyer_name = '';
	else $cbo_buyer_name = " and a.buyer_name=" . $cbo_buyer_name . "";
	if ($txt_style_ref == "") $txt_style_ref = '';
	else $txt_style_ref = " and a.style_ref_no=" . $txt_style_ref . "";
	if ($txt_costing_date == "") $txt_costing_date = '';
	else $txt_costing_date = " and c.costing_date='" . $txt_costing_date . "'";
	$txt_po_breack_down_id = str_replace("'", '', $txt_po_breack_down_id);
	if (str_replace("'", '', $txt_po_breack_down_id) == "") {
		$txt_po_breack_down_id_cond = '';
		$txt_po_breack_down_id_cond1 = '';
		$txt_po_breack_down_id_cond2 = '';
		$txt_po_breack_down_id_cond3 = '';
	} else {
		$txt_po_breack_down_id_cond = " and b.id in(" . $txt_po_breack_down_id . ")";
		$txt_po_breack_down_id_cond1 = " and id in(" . $txt_po_breack_down_id . ")";
		$txt_po_breack_down_id_cond2 = " and po_break_down_id in(" . $txt_po_breack_down_id . ")";
		$txt_po_breack_down_id_cond3 = " and b.id in(" . $txt_po_breack_down_id . ")";
	}

	//array for display name
	$buyer_arr = return_library_array("select id, buyer_name from lib_buyer", 'id', 'buyer_name');
	$comp = return_library_array("select id, company_name from lib_company", 'id', 'company_name');
	$imge_arr = return_library_array("select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1", 'master_tble_id', 'image_location');
	$color_library = return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$brand_arr = return_library_array("select id, brand_name from lib_buyer_brand", 'id', 'brand_name');

	if ($db_type == 0) $group_gsm = "group_concat( distinct b.gsm_weight) AS gsm_weight";
	if ($db_type == 2) $group_gsm = "listagg(b.gsm_weight ,',') within group (order by b.gsm_weight) AS gsm_weight";

	$gsm_weight_top = return_field_value("$group_gsm", "lib_body_part a,wo_pre_cost_fabric_cost_dtls b", "a.id=b.body_part_id and b.job_no=$txt_job_no and b.status_active=1 and b.is_deleted=0 and a.body_part_type in(1,20)", "gsm_weight");
	//$gsm_weight_bottom=return_field_value("$group_gsm", "lib_body_part a,wo_pre_cost_fabric_cost_dtls b", "a.id=b.body_part_id and b.job_no=$txt_job_no and a.body_part_type=20 ","gsm_weight");
	//echo $gsm_weight_bottom.'DD';
	$gmtsitem_ratio_array = array();
	$grmnt_items = "";
	$grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no=$txt_job_no");

	foreach ($grmts_sql as $key => $val) {
		$grmnt_items .= $garments_item[$val[csf("gmts_item_id")]] . ",";
		$gmtsitem_ratio_array[$val[csf('job_no')]][$val[csf('gmts_item_id')]] = $val[csf('set_item_ratio')];
	}
	$grmnt_items = rtrim($grmnt_items, ",");

	$set_order = 0;
	if (count($grmts_sql) > 1) {
		$set_order = 1;
	}

	if ($db_type == 0) ///fab_knit_fin_req_kg,fab_knit_req_kg
	{
		$sql = "SELECT a.job_no,a.total_set_qnty,a.company_name, a.buyer_name,a.style_ref_no,a.ship_mode, a.gmts_item_id,a.order_uom, a.avg_unit_price,sum(b.plan_cut) as job_quantity,sum(b.po_quantity) as ord_qty,  c.costing_per,c.budget_minute,c.costing_date,c.approved,c.exchange_rate ,a.quotation_id,c.incoterm,c.sew_effi_percent,group_concat(b.sc_lc) as sc_lc, d.fab_knit_req_kg,d.fab_knit_fin_req_kg, d.fab_woven_req_yds,d.fab_woven_fin_req_yds, d.fab_yarn_req_kg,c.sew_smv,a.brand_id
			from wo_po_details_master a,wo_po_break_down b, wo_pre_cost_mst c left join wo_pre_cost_sum_dtls d on   c.job_no=d.job_no and d.status_active=1 and d.is_deleted=0
			where a.job_no=b.job_no_mst and b.job_no_mst=c.job_no  and a.status_active=1 and a.is_deleted =0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $job_no $txt_po_breack_down_id_cond $company_name $cbo_buyer_name $txt_style_ref $txt_costing_date group by a.job_no,a.total_set_qnty,a.company_name, a.buyer_name,a.style_ref_no, a.gmts_item_id,a.order_uom, a.avg_unit_price, c.costing_per,c.approved,c.budget_minute,c.incoterm,c.sew_effi_percent, d.fab_knit_req_kg, d.fab_woven_req_yds,d.fab_knit_fin_req_kg,d.fab_woven_fin_req_yds, d.fab_yarn_req_kg,c.sew_smv,a.brand_id order by a.job_no";
	} else if ($db_type == 2) {
		$sql = "SELECT a.job_no,a.total_set_qnty,a.company_name, a.buyer_name,a.ship_mode,a.style_ref_no, a.gmts_item_id,a.order_uom, a.avg_unit_price,sum(b.plan_cut) as job_quantity, sum(b.po_quantity) as ord_qty, listagg(cast(b.sc_lc as varchar2(4000)),',') within group (order by b.sc_lc) as sc_lc, c.costing_per,c.costing_date,c.budget_minute,c.approved,a.quotation_id,c.exchange_rate ,c.incoterm,c.sew_effi_percent,d.fab_knit_fin_req_kg, d.fab_knit_req_kg, d.fab_woven_req_yds,d.fab_woven_fin_req_yds, d.fab_yarn_req_kg,c.sew_smv,a.brand_id
		from wo_po_details_master a, wo_po_break_down b, wo_pre_cost_mst c left join  wo_pre_cost_sum_dtls d on  c.job_no=d.job_no and d.status_active=1 and d.is_deleted=0
		where a.job_no=b.job_no_mst and b.job_no_mst=c.job_no  and a.status_active=1 and a.is_deleted =0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $job_no $txt_po_breack_down_id_cond $company_name $cbo_buyer_name $txt_style_ref group by a.job_no,a.total_set_qnty,a.company_name, a.buyer_name,a.style_ref_no, a.gmts_item_id,a.order_uom,a.ship_mode, a.avg_unit_price, c.incoterm,c.costing_date,c.exchange_rate ,a.quotation_id,c.costing_per,c.sew_effi_percent,c.approved,c.budget_minute, d.fab_knit_req_kg, d.fab_woven_req_yds,d.fab_knit_fin_req_kg,d.fab_woven_fin_req_yds, d.fab_yarn_req_kg,c.sew_smv,a.brand_id  order by a.job_no"; //a.job_quantity as job_quantity,
	}
	//echo $sql;die;
	$data_array = sql_select($sql);
	$plan_cut_qty = $data_array[0][csf('job_quantity')];
	$exchange_rate = $data_array[0][csf('exchange_rate')];
	$pre_costing_smv = $data_array[0][csf('sew_smv')];
	$total_set_qnty = $data_array[0][csf('total_set_qnty')];






	foreach ($data_array as $row) {
		$order_price_per_dzn = 0;
		$order_job_qnty = 0;
		$ord_qty = 0;
		$avg_unit_price = 0;
		$order_values = $row[csf("ord_qty")] * $row[csf("avg_unit_price")];
		$result = sql_select("select po_number,pub_shipment_date,file_no,excess_cut,grouping,po_quantity,grouping from wo_po_break_down where job_no_mst=$txt_job_no $txt_po_breack_down_id_cond1 and status_active=1 and is_deleted=0 order by pub_shipment_date DESC");
		//$tot_row=count($result);
		$job_in_orders = '';
		$pulich_ship_date = '';
		$job_in_ref = '';
		$job_in_file = '';
		$tot_excess_cut = 0;
		$tot_row = 0;
		foreach ($result as $val) {
			$job_in_orders .= $val[csf('po_number')] . ", ";
			$job_in_ref .= $val[csf('grouping')] . ",";
			$pulich_ship_date = $val[csf('pub_shipment_date')];
			$order_qnty += $val[csf('po_quantity')] * $total_set_qnty;
			if ($val[csf('excess_cut')] > 0) {
				$tot_row++;
			}
			$tot_excess_cut += $val[csf('excess_cut')];

			//$job_in_ref .= $val[csf('grouping')].", ";
			//$job_in_file .= $val[csf('file_no')].", ";
			//	if($job_in_ref=='') $job_in_ref= $val[csf('grouping')]; else $job_in_ref.=",". $val[csf('grouping')];
			//	if($job_in_file=='') $job_in_file= $val[csf('file_no')]; else $job_in_file.=",". $val[csf('file_no')];
		}
		$job_in_orders = substr(trim($job_in_orders), 0, -1);
		$job_ref = array_unique(explode(",", rtrim($job_in_ref, ", ")));
		foreach ($job_ref as $ref) {
			$ref_cond .= ", " . $ref;
		}
		//$sew_effi_percent=$row[csf("sew_effi_percent")];

	?>
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px" rules="all">
			<caption><? if ($row[csf("approved")] == 1) echo "<font color='red' style=' font-size:15px; font-weight:bold'>THIS JOB IS APPROVED</font>";
						else ""; ?> </caption>
			<tr>
				<td colspan="3" align="center"><b><? echo $comp[str_replace("'", "", $cbo_company_name)]; ?></b></td>
				<td colspan="4" align="center"><b>Order wise Accessories Check List</b></td>
				<td align="center"><b><? echo date("d/m/Y"); ?></b></td>
			</tr>
			<tr>
				<td>Job No</td>
				<td colspan="3"><b><? echo $row[csf("job_no")]; ?></b></td>
				<td>Buyer</td>
				<td><b><? echo $buyer_arr[$row[csf("buyer_name")]]; ?></b></td>

				<td>Brand</td>
				<td><b><? echo $brand_arr[$row[csf("brand_id")]]; ?></b></td>
			</tr>
			<tr>
				<td>Style Ref. No</td>
				<td colspan="3"><b><? echo $row[csf("style_ref_no")]; ?></b></td>
				<td>Int Ref</td>
				<td><b><? echo ltrim($ref_cond, ", "); ?></b></td>

				<td>Garments Item</td>
				<td><b><? echo $grmnt_items; ?></b></td>
			</tr>
			<tr>
				<td>PO NO</td>
				<td colspan="7"><b><? echo $job_in_orders; ?></b></td>
			</tr>
			<tr>
				<td>Order Quantity(pcs)</td>
				<td colspan="3"><b><? echo $order_qnty; ?></b></td>
				<td>Order Quantity(DZN)</td>
				<td colspan="3"><b><? echo fn_number_format($order_qnty / 12, 2); ?></b></td>
			</tr>
		</table>

	<?
		if ($row[csf("costing_per")] == 1) {
			$order_price_per_dzn = 12;
			$costing_for = "1 DZN";
		} else if ($row[csf("costing_per")] == 2) {
			$order_price_per_dzn = 1;
			$costing_for = "1 PCS";
		} else if ($row[csf("costing_per")] == 3) {
			$order_price_per_dzn = 24;
			$costing_for = "2 DZN";
		} else if ($row[csf("costing_per")] == 4) {
			$order_price_per_dzn = 36;
			$costing_for = "3 DZN";
		} else if ($row[csf("costing_per")] == 5) {
			$order_price_per_dzn = 48;
			$costing_for = "4 DZN";
		} else {
			$order_price_per_dzn = 0;
			$costing_for = "DZN";
		}
		$order_job_qnty = $row[csf("job_quantity")];
		$avg_unit_price = $row[csf("avg_unit_price")];
		$ord_qty = $row[csf("ord_qty")];
	} //end first foearch

	?>
	<br />

	<br />

	<?
	$po_no = str_replace("'", "", $txt_po_breack_down_id);
	$condition = new condition();
	if (str_replace("'", "", $txt_job_no) != '') {
		$condition->job_no("=$txt_job_no");
	}

	if (str_replace("'", "", $txt_po_breack_down_id) != '') {
		$condition->po_id("in($po_no)");
	}
	$condition->init();
	//$yarn= new yarn($condition);


	$fabric = new fabric($condition);
	//echo $fabric->getQuery(); die;
	//$fabric_costing_arr=$fabric->getQtyArray_by_job_knitAndwoven_greyAndfinish_production();
	$yarn = new yarn($condition);
	$yarn_costing_arr = $yarn->getJobWiseYarnAmountArray();
	$fabric = new fabric($condition);
	$fabric_costing_arr2 = $fabric->getAmountArray_by_job_knitAndwoven_greyAndfinish();

	$fabric_qty_arr = $fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
	$fabric_amount_arr = $fabric->getAmountArray_by_Fabriccostid_knitAndwoven_greyAndfinish();

	$conversion = new conversion($condition);
	$conversion_costing_arr_process = $conversion->getAmountArray_by_job();
	$trims = new trims($condition);
	//echo $trims->getQuery(); die;
	$trims_costing_arr = $trims->getAmountArray_by_job();
	$emblishment = new emblishment($condition);
	$emblishment_costing_arr = $emblishment->getAmountArray_by_job();
	$wash = new wash($condition);
	//echo $wash->getQuery(); die;
	$emblishment_costing_arr_wash = $wash->getAmountArray_by_job();
	$commercial = new commercial($condition);
	$commercial_costing_arr = $commercial->getAmountArray_by_job();
	$commission = new commision($condition);
	$commission_costing_arr = $commission->getAmountArray_by_job();
	$other = new other($condition);
	$other_costing_arr = $other->getAmountArray_by_job();

	$job_no = str_replace("'", "", $txt_job_no);
	//All Cost start here...
	///----------------AAA---------

	?>



	<?
	//End Yarn Cost part report here -------------------------------------------




	//start	Trims Cost part report here -------------------------------------------
	$supplier_library_fabric = return_library_array("select a.id, a.supplier_name from lib_supplier a where a.is_deleted=0  and a.status_active=1 group by a.id,a.supplier_name order by a.supplier_name", "id", "supplier_name");

	$sql = "select id, job_no, trim_group,description,brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp_multi, status_active,remark,ex_per from wo_pre_cost_trim_cost_dtls  where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";

	$data_array = sql_select($sql);
	?>
	<div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px;text-align:center;" rules="all">


			<tr style="float:left;background:#CCCCCC;">
				<td width="100" colspan="9"><b>Trims Cost</b> </td>
			</tr>
			<tr style="font-weight:bold">
				<td width="110">Item Group</td>
				<td width="150">Description</td>
				<td width="60">UOM</td>
				<td width="80">Excess %</td>
				<td width="100">Req. Qty</td>
				<td width="80">Unit Price [USD]</td>
				<td width="80">Total Price [USD]</td>
				<td width="100">Supplier Name</td>
				<td width="60">Remarks</td>
			</tr>
			<?
			$trim_qty_arr = $trims->getQtyArray_by_precostdtlsid();
			//print_r($trim_qty);
			$trim_amount_arr = $trims->getAmountArray_precostdtlsid();
			$total_trims_cost = 0;
			$total_trims_qty = $total_trims_cost_dzn = 0;
			$total_trims_cost_dzn = 0;
			$total_trims_cost_kg = 0;
			foreach ($data_array as $row) {
				$id = $row[csf("id")];
				$excess_per = return_field_value("excess_per", "wo_pre_cost_trim_co_cons_dtls", "job_no=$txt_job_no and wo_pre_cost_trim_cost_dtls_id=$id and status_active=1 and is_deleted=0");


				$trim_group = return_library_array("select item_name,id from  lib_item_group where id=" . $row[csf("trim_group")], "id", "item_name");
				$cons_dzn_gmts = $row[csf("cons_dzn_gmts")];
				$amount_dzn = $row[csf("amount")];
				$pre_trims_qty = $trim_qty_arr[$row[csf("id")]];
				$pre_trims_amount = $trim_amount_arr[$row[csf("id")]];

				$nominated_supp_str = "";
				$exsupp = explode(",", $row[csf("nominated_supp_multi")]);
				foreach ($exsupp as $sid) {
					if ($nominated_supp_str == "") $nominated_supp_str = $supplier_library_fabric[$sid];
					else $nominated_supp_str .= ',' . $supplier_library_fabric[$sid];
				}
			?>
				<tr>
					<td align="left"><? echo $trim_group[$row[csf("trim_group")]]; ?></td>
					<td align="left"><? echo $row[csf("description")]; ?></td>
					<td align="left"><? echo $unit_of_measurement[$row[csf("cons_uom")]]; ?></td>
					<td align="right"><? echo $excess_per; ?></td>
					<td align="right"><? echo fn_number_format($pre_trims_qty, 4); ?></td>
					<td align="right"><? echo fn_number_format($row[csf("rate")], 6); ?></td>
					<td align="right"><? echo fn_number_format($pre_trims_amount, 2); ?></td>
					<td align="left"><?= $nominated_supp_str; ?></td>
					<td align="right"><? echo $row[csf("remark")]; ?></td>
				</tr>
			<?
				$total_trims_cost += $pre_trims_amount;
				$total_trims_cost_dzn += $amount_dzn;
				$total_trims_qty += $pre_trims_qty;
			}
			?>
			<tr class="rpt_bottom" style="font-weight:bold">

				<td colspan="4" style="background:#F9F">Trims Total</td>
				<td align="right"><? echo fn_number_format($total_trims_qty, 4); ?></td>
				<td align="right"><? //echo fn_number_format($total_trims_cost_dzn,4); 
									?></td>
				<td align="right"><? echo fn_number_format($total_trims_cost, 2); ?></td>
				<td align="right">Dzn Price [USD]</td>
				<td align="right"><? echo fn_number_format($total_trims_cost / ($order_qnty / 12), 2); ?> </td>
			</tr>
		</table>
	</div>
	</br>
	</br>
	<? echo signature_table(109, $cbo_company_name, "970px"); ?>

	</div>






<?
	//End Trims Cost Part report here -------------------------------------------	







	disconnect($con);
	exit();
}

if ($action == "budgetsheet2") // Shariar id-17701
{
	///extract($_REQUEST);
	$process = array(&$_POST);
	extract(check_magic_quote_gpc($process));
	$txt_costing_date = change_date_format(str_replace("'", "", $txt_costing_date), 'yyyy-mm-dd', '-');
	if ($txt_job_no == "") $job_no = '';
	else $job_no = " and a.job_no=" . $txt_job_no . "";
	if ($cbo_company_name == "") $company_name = '';
	else $company_name = " and a.company_name=" . $cbo_company_name . "";
	if ($cbo_buyer_name == "") $cbo_buyer_name = '';
	else $cbo_buyer_name = " and a.buyer_name=" . $cbo_buyer_name . "";
	if ($txt_style_ref == "") $txt_style_ref = '';
	else $txt_style_ref = " and a.style_ref_no=" . $txt_style_ref . "";
	if ($txt_costing_date == "") $txt_costing_date = '';
	else $txt_costing_date = " and c.costing_date='" . $txt_costing_date . "'";
	$txt_po_breack_down_id = str_replace("'", '', $txt_po_breack_down_id);
	if (str_replace("'", '', $txt_po_breack_down_id) == "") {
		$txt_po_breack_down_id_cond = '';
		$txt_po_breack_down_id_cond1 = '';
		$txt_po_breack_down_id_cond2 = '';
		$txt_po_breack_down_id_cond3 = '';
	} else {
		$txt_po_breack_down_id_cond = " and b.id in(" . $txt_po_breack_down_id . ")";
		$txt_po_breack_down_id_cond1 = " and id in(" . $txt_po_breack_down_id . ")";
		$txt_po_breack_down_id_cond2 = " and po_break_down_id in(" . $txt_po_breack_down_id . ")";
		$txt_po_breack_down_id_cond3 = " and b.id in(" . $txt_po_breack_down_id . ")";
	}

	//array for display name
	$buyer_arr = return_library_array("select id, buyer_name from lib_buyer", 'id', 'buyer_name');
	$sesson_arr = return_library_array("select id, season_name from lib_buyer_season", 'id', 'season_name');
	$brand_arr = return_library_array("select id, brand_name from lib_buyer_brand", 'id', 'brand_name');
	$comp = return_library_array("select id, company_name from lib_company", 'id', 'company_name');
	$color_library = return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$fabric_composition_arr = return_library_array("select id, fabric_composition_name from lib_fabric_composition", 'id', 'fabric_composition_name');
	$photo_data_array = sql_select("SELECT id,master_tble_id,image_location from common_photo_library where master_tble_id=$txt_job_no and file_type=1  and rownum=1");

	if ($db_type == 0) $group_gsm = "group_concat( distinct b.gsm_weight) AS gsm_weight";
	if ($db_type == 2) $group_gsm = "listagg(b.gsm_weight ,',') within group (order by b.gsm_weight) AS gsm_weight";

	$gsm_weight_top = return_field_value("$group_gsm", "lib_body_part a,wo_pre_cost_fabric_cost_dtls b", "a.id=b.body_part_id and b.job_no=$txt_job_no and b.status_active=1 and b.is_deleted=0 and a.body_part_type in(1,20)", "gsm_weight");
	$gmtsitem_ratio_array = array();
	$grmnt_items = "";
	$grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no=$txt_job_no");
	foreach ($grmts_sql as $key => $val) {
		$grmnt_items .= $garments_item[$val[csf("gmts_item_id")]] . ",";
		$gmtsitem_ratio_array[$val[csf('job_no')]][$val[csf('gmts_item_id')]] = $val[csf('set_item_ratio')];
		$set_item_ratio += $val[csf('set_item_ratio')];
	}
	$grmnt_items = rtrim($grmnt_items, ",");

	if ($db_type == 0) ///fab_knit_fin_req_kg,fab_knit_req_kg
	{
		$sql = "SELECT a.job_no,a.company_name, a.buyer_name,a.total_set_qnty,a.style_ref_no,a.ship_mode, a.gmts_item_id,a.order_uom, a.avg_unit_price,sum(b.plan_cut) as job_quantity,sum(b.po_quantity) as ord_qty ,   c.costing_per,c.budget_minute,c.costing_date,c.approved,c.exchange_rate ,a.quotation_id,c.incoterm,c.sew_effi_percent,group_concat(b.sc_lc) as sc_lc, d.fab_knit_req_kg,d.fab_knit_fin_req_kg, d.fab_woven_req_yds,d.fab_woven_fin_req_yds, d.fab_yarn_req_kg
			from wo_po_details_master a,wo_po_break_down b, wo_pre_cost_mst c left join wo_pre_cost_sum_dtls d on   c.job_no=d.job_no and d.status_active=1 and d.is_deleted=0
			where a.job_no=b.job_no_mst and b.job_no_mst=c.job_no  and a.status_active=1 and a.is_deleted =0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $job_no $txt_po_breack_down_id_cond $company_name $cbo_buyer_name $txt_style_ref $txt_costing_date group by a.job_no,a.company_name, a.buyer_name,a.style_ref_no, a.gmts_item_id,a.order_uom, a.avg_unit_price, c.costing_per,c.approved,c.budget_minute,c.incoterm,c.sew_effi_percent, d.fab_knit_req_kg, d.fab_woven_req_yds,d.fab_knit_fin_req_kg,d.fab_woven_fin_req_yds, d.fab_yarn_req_kg order by a.job_no";
	} else if ($db_type == 2) {
		$sql = "SELECT a.job_no,a.company_name, a.buyer_name,a.ship_mode,a.total_set_qnty,a.style_ref_no, a.gmts_item_id,a.order_uom, a.avg_unit_price, a.product_dept, a.season_buyer_wise, a.brand_id, a.style_description, a.job_quantity as job_qty, sum(b.plan_cut) as job_quantity, sum(b.po_quantity) as ord_qty, listagg(cast(b.sc_lc as varchar2(4000)),',') within group (order by b.sc_lc) as sc_lc, c.costing_per,c.costing_date,c.budget_minute,c.approved,a.quotation_id,c.exchange_rate ,c.incoterm,c.sew_effi_percent, c.remarks,c.sew_smv, c.refusing_cause, d.fab_knit_fin_req_kg, d.fab_knit_req_kg, d.fab_woven_req_yds,d.fab_woven_fin_req_yds, d.fab_yarn_req_kg
		from wo_po_details_master a, wo_po_break_down b,wo_pre_cost_mst c left join  wo_pre_cost_sum_dtls d on  c.job_no=d.job_no and d.status_active=1 and d.is_deleted=0
		where a.job_no=b.job_no_mst and b.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted =0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $job_no $txt_po_breack_down_id_cond $company_name $cbo_buyer_name $txt_style_ref group by a.job_no,a.company_name, a.buyer_name,a.style_ref_no, a.gmts_item_id,a.order_uom,a.ship_mode, a.avg_unit_price, a.product_dept, c.incoterm,c.costing_date,c.exchange_rate ,a.quotation_id,c.costing_per,c.sew_effi_percent,c.approved,c.budget_minute, d.fab_knit_req_kg, d.fab_woven_req_yds,d.fab_knit_fin_req_kg,d.fab_woven_fin_req_yds, d.fab_yarn_req_kg,a.job_quantity,a.season_buyer_wise, a.brand_id, a.total_set_qnty,a.style_description, c.remarks, c.refusing_cause,c.sew_smv order by a.job_no"; //a.job_quantity as job_quantity,
	}
	//echo $sql;die;
	// $job_in_sew_pcs = '';
	// foreach ($sql as $val)
	// 	{
	// 		$job_in_sew_pcs.=$val[csf('smv_pcs')].",";			
	// 	}
	// 	$job_sew=array_unique(explode(",",rtrim($job_in_sew_pcs,", ")));
	// 	$sew_con='';
	// 	foreach ($job_sew as $sew)
	// 	{
	// 		if($sew_con=='') $sew_con=$file; else $sew_con.=", ".$sew;
	// 	}
	//echo $sql;die;
	$data_array = sql_select($sql);
	$plan_cut_qty = $data_array[0][csf('job_quantity')];
	$total_set_qnty = $data_array[0][csf('total_set_qnty')];
	$job_qnty = $data_array[0][csf('job_qty')];
	$exchange_rate = $data_array[0][csf('exchange_rate')];
	$is_approved = $data_array[0][csf('approved')];

	$preCost_histry = sql_select("SELECT min(a.sew_smv) as sew_smv,min(a.sew_effi_percent) as sew_effi_percent,min(b.margin_dzn_percent) as margin_dzn_percent ,min(b.fabric_cost_percent) as  fabric_cost_percent,min(b.trims_cost_percent ) as trims_cost_percent,min(b.embel_cost_percent) as embel_cost_percent,min(b.wash_cost_percent) as wash_cost_percent ,min(b.comm_cost_percent) as comm_cost_percent ,min(b.commission_percent) as commission_percent,min(b.lab_test_percent) as lab_test_percent,min(b.inspection_percent) as inspection_percent,min(b.cm_cost_percent) as cm_cost_percent,min(b.freight_percent) as freight_percent,min(b.currier_percent) as currier_percent,min(b.certificate_percent) as certificate_percent,min(b.common_oh_percent) as common_oh_percent    from  wo_pre_cost_mst_histry a,wo_pre_cost_dtls_histry b where a.job_no=b.job_no and a.job_no=$txt_job_no");

	list($preCost_histry_row) = $preCost_histry;
	$opert_profitloss_percent = $preCost_histry_row[csf('margin_dzn_percent')];
	$fabric_cost_percent = $preCost_histry_row[csf('fabric_cost_percent')];
	$trims_cost_percent = $preCost_histry_row[csf('trims_cost_percent')];
	$embel_cost_percent = $preCost_histry_row[csf('embel_cost_percent')];
	$wash_cost_percent = $preCost_histry_row[csf('wash_cost_percent')];
	$comm_cost_percent = $preCost_histry_row[csf('comm_cost_percent')];
	$commission_percent = $preCost_histry_row[csf('commission_percent')];
	$common_oh_percent = $preCost_histry_row[csf('common_oh_percent')];

	$lab_test_percent = $preCost_histry_row[csf('lab_test_percent')];
	$inspection_percent = $preCost_histry_row[csf('inspection_percent')];
	$cm_cost_percent = $preCost_histry_row[csf('cm_cost_percent')];
	$freight_percent = $preCost_histry_row[csf('freight_percent')];
	$currier_percent = $preCost_histry_row[csf('currier_percent')];
	$certificate_percent = $preCost_histry_row[csf('certificate_percent')];
	//$currier_percent=$preCost_histry_row[csf('currier_percent')];
	$sew_effi_percent = $data_array[0][csf('sew_effi_percent')]; //
	$hissew_effi_percent = $preCost_histry_row[csf('sew_effi_percent')];
	//$sew_smv=$preCost_histry_row[csf('sew_smv')];
	$first_app_date = "";
	$last_app_date = "";
	$revised_no = 0;
	$preCost_approved = sql_select("SELECT max(b.approved_no) as approved_no, min(b.approved_date) as first_app_date, max(b.approved_date) as last_app_date,a.id from wo_pre_cost_mst a, approval_history b where   a.id=b.mst_id and a.job_no=$txt_job_no and b.entry_form=15 group by a.id");
	if (count($preCost_approved) > 0) {
		foreach ($preCost_approved as $preCost_approved_row) {
			$approved_no_row = $preCost_approved_row[csf('approved_no')];
			$fst_date = $preCost_approved_row[csf('first_app_date')];
			$fstapp_date = $fst_date[0];

			$last_date = $preCost_approved_row[csf('last_app_date')];
			$lstapp_date = $last_date[0];
			$precost_id = $preCost_approved_row[csf('id')];
			//if($approved_no_row>1){
			$revised_no = $approved_no_row - 1;
			//}
		}
	}
	if ($last_date) {
		$last_date = date('d-M-y', strtotime($last_date));
	} else {
		$last_date = "";
	}

	//$img_path = (str_replace("'", "", $img_path))? str_replace("'", "", $img_path):'../../';
	$img_path = (str_replace("'", "", $path)) ? str_replace("'", "", $path) : '../';

	//echo $img_path;


	$costing_date = $data_array[0][csf('costing_date')];
	if (is_infinite($costing_date) || is_nan($costing_date)) {
		$costing_date = 0;
	}

	$pre_cost_dtls = "SELECT id,job_no,costing_per_id,order_uom_id,fabric_cost,fabric_cost_percent,trims_cost,trims_cost_percent,embel_cost,embel_cost_percent,comm_cost,comm_cost_percent,commission,commission_percent,lab_test,lab_test_percent,inspection,inspection_percent,cm_cost,cm_cost_percent,freight,freight_percent,common_oh,common_oh_percent,total_cost,total_cost_percent,price_dzn,price_dzn_percent,margin_dzn,margin_dzn_percent,price_pcs_or_set,price_pcs_or_set_percent,margin_pcs_set,margin_pcs_set_percent,cm_for_sipment_sche from wo_pre_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$pre_cost_dtls_arr = sql_select($pre_cost_dtls);
	foreach ($pre_cost_dtls_arr as $row) {
		$total_cost = $row[csf("total_cost")];
		$price_dzn = $row[csf("price_dzn")];
		$embel_cost_dzn = $row[csf("embel_cost")];
	}
	$approval_allow = sql_select("select b.id, b.page_id, b.approval_need, b.allow_partial, b.validate_page,a.setup_date from approval_setup_mst a,approval_setup_dtls b 
			where a.id=b.mst_id and a.company_id=$cbo_company_name and a.status_active=1 and b.page_id=25 and b.status_active=1 and b.is_deleted=0 order by b.id desc ");
?>
	<div style="width:972px; margin:0 auto; font-family: 'Arial Narrow', Arial, sans-serif;">

		<div style="width:970px; font-size:20px; font-weight:bold">

			<b style="float: left"><? echo $comp[str_replace("'", "", $cbo_company_name)]; ?><br>Budget Sheet</b>
			<? if ($is_approved == 1) { ?> <b style="left: 50%; margin-left: 240px; color: green;"> This Budget is Approved </b> <? } elseif ($is_approved == 3) {
																																	if ($approval_allow[0][csf("approval_need")] == 1 && $approval_allow[0][csf("allow_partial")] == 1) {
																																		$ap_msg = "<b style='left: 50%; margin-left: 240px; color: green;'>This Budget is Approved </b>";
																																	} else {
																																		$ap_msg = "<b style='left: 50%; margin-left: 240px; color: green;'>This Budget is Partially Approved </b>";
																																	}
																																	echo $ap_msg;
																																} else { ?><b style="left: 50%; margin-left: 240px; color: red;">
					This Budget is Not Approved

				</b> <? } ?>
			<b style="float:right;"> <? echo 'Budget Date: '; ?><? echo  date('d-M-y', strtotime($costing_date)); ?> <br><? echo 'Revised No:' . $revised_no; ?> <br><? echo 'Last Revised Date:' . $last_date; ?> </b>
		</div>

		<div style="width:970px; font-size:18px; font-weight:bold">
			<b style="float: left"></b>
			<b style="float:right; font-size:18px; font-weight:bold"> &nbsp; </b>
		</div>

		<?
		$result = sql_select("SELECT id,po_number,pub_shipment_date,grouping,file_no,excess_cut,po_received_date, plan_cut from wo_po_break_down where job_no_mst=$txt_job_no $txt_po_breack_down_id_cond1 and status_active=1 and is_deleted=0 order by po_received_date DESC");
		$job_in_orders = '';
		$public_ship_date = '';
		$job_in_ref = '';
		$job_in_file = '';
		$tot_excess_cut = 0;
		$tot_row = 0;
		foreach ($result as $val) {
			$job_in_orders .= $val[csf('po_number')] . ", ";
			$public_ship_date = $val[csf('pub_shipment_date')];
			$po_received_date = $val[csf('po_received_date')];
			$job_in_ref .= $val[csf('grouping')] . ",";
			$job_in_file .= $val[csf('file_no')] . ",";
			$txt_order_no_arr[$val[csf('id')]] = $val[csf('id')];
			if ($val[csf('excess_cut')] > 0) {
				$tot_row++;
			}
			$tot_excess_cut += $val[csf('excess_cut')];
			$plancutqty += $val[csf('plan_cut')];
		}
		$txt_order_no_id = implode(",", $txt_order_no_arr);
		$job_ref = array_unique(explode(",", rtrim($job_in_ref, ", ")));
		$job_file = array_unique(explode(",", rtrim($job_in_file, ", ")));

		foreach ($job_ref as $ref) {
			$ref_cond .= ", " . $ref;
		}
		$file_con = '';
		foreach ($job_file as $file) {
			if ($file_con == '') $file_cond = $file;
			else $file_cond .= ", " . $file;
		}

		foreach ($data_array as $row) {
			$order_price_per_dzn = 0;
			$order_job_qnty = 0;
			$ord_qty = 0;
			$avg_unit_price = 0;
			$uom = $row[csf("order_uom")];
			$sew_smv = $row[csf("sew_smv")];
			$order_values = $row[csf("job_qty")] * $row[csf("avg_unit_price")];

			$job_in_orders = substr(trim($job_in_orders), 0, -1);
			if ($row[csf("costing_per")] == 1) {
				$order_price_per_dzn = 12;
				$costing_for = "1 DZN";
			} else if ($row[csf("costing_per")] == 2) {
				$order_price_per_dzn = 1;
				$costing_for = "1 PCS";
			} else if ($row[csf("costing_per")] == 3) {
				$order_price_per_dzn = 24;
				$costing_for = "2 DZN";
			} else if ($row[csf("costing_per")] == 4) {
				$order_price_per_dzn = 36;
				$costing_for = "3 DZN";
			} else if ($row[csf("costing_per")] == 5) {
				$order_price_per_dzn = 48;
				$costing_for = "4 DZN";
			} else {
				$order_price_per_dzn = 0;
				$costing_for = "DZN";
			}
			$order_job_qnty = $row[csf("job_qty")];
			//$order_qty = $row[csf("job_qty")]*$set_item_ratio;
			$po_no = str_replace("'", "", $txt_po_breack_down_id);
			$condition = new condition();
			if (str_replace("'", "", $txt_job_no) != '') {
				$condition->job_no("=$txt_job_no");
			}

			if (str_replace("'", "", $txt_po_breack_down_id) != '') {
				$condition->po_id("in($po_no)");
			}
			$condition->init();
			$fabric = new fabric($condition);
			$yarn = new yarn($condition);
			$yarn_costing_arr = $yarn->getJobWiseYarnAmountArray();
			$yarn_qty_amount_arr = $yarn->getJobWiseYarnQtyAndAmountArray();

			$yarnDataWithFabricidArr = $yarn->get_By_Precostfabricdtlsid_YarnQtyAmountArray();

			$fabric = new fabric($condition);
			$fabricAmoutByFabricSource = $fabric->getAmountArray_by_job_knitAndwoven_greyAndfinish();
			$fabricQtyByFabricSource = $fabric->getQtyArray_by_job_knitAndwoven_greyAndfinish_purchase();

			$fabric_qty_arr = $fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
			$fabric_amount_arr = $fabric->getAmountArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
			$conversion = new conversion($condition);
			//echo $conversion->getQuery(); die;
			$conversion_costing_arr_process = $conversion->getAmountArray_by_job();
			$conv_qty_job_process = $conversion->getQtyArray_by_jobAndProcess();
			$conv_amount_job_process = $conversion->getAmountArray_by_jobAndProcess();
			$con_qty_fabric_process = $conversion->getQtyArray_by_fabricAndProcess();
			$con_amount_fabric_process = $conversion->getAmountArray_by_fabricAndProcess();

			$trims = new trims($condition);
			$trims_costing_arr = $trims->getAmountArray_by_job();
			$trims_qty_arr = $trims->getQtyArray_by_job();

			$emblishment = new emblishment($condition);
			$emblishment_costing_arr = $emblishment->getAmountArray_by_job();
			$emb_qty_job_name_arr = $emblishment->getQtyArray_by_jobAndEmbname();
			$emb_amount_job_name_arr = $emblishment->getAmountArray_by_jobAndEmbname();

			$wash = new wash($condition);
			$emblishment_costing_arr_wash = $wash->getAmountArray_by_job();
			$wash_qty_job_name_arr = $wash->getQtyArray_by_jobAndEmbname();
			$wash_amount_job_name_arr = $wash->getAmountArray_by_jobAndEmbname();


			$commercial = new commercial($condition);
			$commercial_costing_arr = $commercial->getAmountArray_by_job();
			$commission = new commision($condition);
			$commission_costing_arr = $commission->getAmountArray_by_job();
			$other = new other($condition);
			$other_costing_arr = $other->getAmountArray_by_job();
			/* echo '<pre>';
		print_r($con_amount_fabric_process); die; */
			$job_no = str_replace("'", "", $txt_job_no);
			// $finishing_arr = array('209','165','33','94','63','171','65','170','156','179','200','208','127','125','84','68','128','190','242','240','192','172','90','218','67','197','73','66','185','142','193','265');


			$finishing_arr = array(
				'2', '3', '4', '25', '26', '32', '33', '34', '36', '37', '38', '39', '40', '60', '61', '62', '63', '64', '65', '66', '67', '68', '69', '70', '71', '72', '73', '74', '75', '76', '77', '78', '79', '80', '81', '82', '83', '84', '85', '86', '87', '88', '89', '90', '91', '92', '93', '94', '100', '101', '120', '121', '122', '123', '124', '125', '127', '128', '129', '130', '131', '132', '133', '134', '135', '136', '137', '138', '139', '140', '141', '142', '143', '144', '145', '146', '147', '148', '149', '150', '151', '152', '153', '154', '155', '156', '157', '158', '159', '160', '161', '162', '163', '164', '165', '166', '167', '168', '169', '170', '171', '172', '173', '174', '175', '176', '177', '178', '179', '180', '181', '182', '183', '184', '185', '186', '187', '188', '189', '190', '191', '192', '193', '194', '195', '196', '197', '198', '199', '200', '201', '202', '203', '204', '205', '206', '207', '208', '209', '210', '211', '212', '213', '214', '215', '216', '217', '218', '219', '220', '221', '222', '223', '224', '225', '226', '227', '228', '229', '230', '231', '232', '233', '234', '235', '236', '237', '238', '239', '240', '241', '242', '243', '244', '245', '246', '247', '248', '249', '250', '251', '252', '253', '254', '255', '256', '257', '258', '259', '260', '261', '262', '263', '264', '265', '266', '267', '268', '269', '270', '271', '272', '273', '274', '275', '276', '277', '278', '279', '280', '281', '282', '283', '284', '285', '286', '287', '288', '289', '290', '291', '292', '293', '294', '295', '296', '297', '298', '299', '300', '303', '304', '305', '306', '307', '308', '309', '310', '311', '312', '313', '314', '315', '316', '317', '318', '319', '320', '321', '322', '323', '324', '325', '326', '327', '328', '329', '330', '331', '332', '333', '334', '335', '336', '337', '338', '339', '340', '341', '342', '343', '344', '345', '346', '347', '348', '349', '350', '351', '352', '353', '354', '355', '356', '357', '358', '359', '360', '361', '362', '363', '364', '365', '366', '367', '368', '369', '370', '371', '372', '373', '374', '375', '376', '377', '378', '379', '380', '381', '382', '383', '384', '385', '386', '387', '388', '389', '390', '391', '392', '393', '394', '395', '396', '397', '398', '399', '400', '401', '402', '403', '404', '405', '406', '407', '408', '409', '410', '411'
			);



			$total_finishing_amount = 0;
			$total_finishing_qty = 0;
			$other_cost_attr = array('inspection', 'freight', 'certificate_pre_cost', 'deffdlc_cost', 'design_cost', 'studio_cost', 'common_oh', 'interest_cost', 'incometax_cost', 'depr_amor_pre_cost');
			$total_other_cost = 0;
			foreach ($other_cost_attr as $attr) {
				$total_other_cost += $other_costing_arr[$job_no][$attr];
			}
			$misc_cost = $other_costing_arr[$job_no]['lab_test'] + $other_costing_arr[$job_no]['currier_pre_cost'] + $commercial_costing_arr[$job_no] + $commission_costing_arr[$job_no] + $total_other_cost;


			foreach ($finishing_arr as $fid) {

				$total_finishing_amount += array_sum($conv_amount_job_process[$job_no][$fid]);
				$total_finishing_qty += array_sum($conv_qty_job_process[$job_no][$fid]);
				//echo array_sum($conv_amount_job_process[$job_no][$fid]).'='.$fid.'<br>';
			}

			$total_fabic_cost = 0;
			if (count($conv_amount_job_process[$job_no][31]) > 0) {
				$total_fabic_cost += array_sum($conv_amount_job_process[$job_no][31]) / array_sum($conv_qty_job_process[$job_no][31]);
			}
			$total_fabric_amount += array_sum($conv_amount_job_process[$job_no][31]);
			$total_fabric_per += array_sum($conv_amount_job_process[$job_no][31]) / $order_values * 100;
			if (count($conv_amount_job_process[$job_no][30]) > 0) {
				$total_fabic_cost += array_sum($conv_amount_job_process[$job_no][30]) / array_sum($conv_qty_job_process[$job_no][30]);
			}
			if ($yarn_qty_amount_arr[$job_no]['amount'] != '') {
				$total_fabic_cost += $yarn_qty_amount_arr[$job_no]['amount'] / $yarn_qty_amount_arr[$job_no]['qty'];
			}
			$total_fabric_amount += $yarn_qty_amount_arr[$job_no]['amount'];
			$total_fabric_per += $yarn_qty_amount_arr[$job_no]['amount'] / $order_values * 100;
			if ($total_finishing_amount != 0) {
				$total_fabic_cost += $total_finishing_amount / $total_finishing_qty;
			}
			$total_fabric_amount += $total_finishing_amount;
			$total_fabric_per += $total_finishing_amount / $order_values * 100;
			$total_fabric_amount += array_sum($conv_amount_job_process[$job_no][30]);
			$total_fabric_per += array_sum($conv_amount_job_process[$job_no][30]) / $order_values * 100;
			if (count($conv_amount_job_process[$job_no][35]) > 0) {
				$total_fabic_cost += array_sum($conv_amount_job_process[$job_no][35]) / array_sum($conv_qty_job_process[$job_no][35]);
			}
			$total_fabric_amount += array_sum($conv_amount_job_process[$job_no][35]);
			$total_fabric_per += array_sum($conv_amount_job_process[$job_no][35]) / $order_values * 100;
			if (count($conv_amount_job_process[$job_no][1]) > 0) {
				$total_fabic_cost += array_sum($conv_amount_job_process[$job_no][1]) / array_sum($conv_qty_job_process[$job_no][1]);
			}
			$total_fabric_amount += array_sum($conv_amount_job_process[$job_no][1]);
			$total_fabric_per += array_sum($conv_amount_job_process[$job_no][1]) / $order_values * 100;

			$purchase_amount = array_sum($fabricAmoutByFabricSource['knit']['grey'][$job_no]) + array_sum($fabricAmoutByFabricSource['woven']['grey'][$job_no]);
			$purchase_qty = array_sum($fabricQtyByFabricSource['knit']['grey'][$job_no]) + array_sum($fabricQtyByFabricSource['woven']['grey'][$job_no]);

			$ather_emb_attr = array(4, 5, 6, 99);
			foreach ($ather_emb_attr as $att) {
				$others_emb_amount += $emb_amount_job_name_arr[$job_no][$att];
				$others_emb_qty += $emb_qty_job_name_arr[$job_no][$att];
			}
			$knitting_amount_summ = '';
			$dyeing_amount_summ = '';
			$yds_amount_summ = '';
			$aop_amount_summ = '';
			if (count($conv_amount_job_process[$job_no][1]) > 0) {
				$knitting_amount_summ = fn_number_format(array_sum($conv_amount_job_process[$job_no][1]), 2);
			}
			$yarn_amount_summ = $yarn_qty_amount_arr[$job_no]['amount'];
			$print_amount_summ = $emb_amount_job_name_arr[$job_no][1];
			$emb_amount_summ = $emb_amount_job_name_arr[$job_no][2];
			$wash_amount_summ = $wash_amount_job_name_arr[$job_no][3];
			if (count($conv_amount_job_process[$job_no][31]) > 0) {
				$dyeing_amount_summ =  array_sum($conv_amount_job_process[$job_no][31]);
			}
			if (count($conv_amount_job_process[$job_no][30]) > 0) {
				$yds_amount_summ = array_sum($conv_amount_job_process[$job_no][30]);
			}
			if (count($conv_amount_job_process[$job_no][35]) > 0) {
				$aop_amount_summ = array_sum($conv_amount_job_process[$job_no][35]);
			}
			/*echo '<pre>';
		print_r($conv_amount_job_process); die;*/

			$total_budget_value = $yarn_amount_summ + $total_finishing_amount + $print_amount_summ + $trims_costing_arr[$job_no] + $yds_amount_summ + $aop_amount_summ + $emb_amount_summ + $knitting_amount_summ + $purchase_amount + $wash_amount_summ + $other_costing_arr[$job_no]['cm_cost'] + $dyeing_amount_summ + $others_emb_amount + $misc_cost;

		?>
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px; font-family: 'Arial Narrow', Arial, sans-serif;" rules="all">

				<tr>
					<th rowspan="7">
						<? foreach ($photo_data_array as $inf) { ?>
							<?
							$image_location = return_field_value("image_location", "common_photo_library", "file_type=1 and form_name='company_details' and master_tble_id=$cbo_company_name", "image_location");
							?>

							<img src='<?= $img_path ?><? echo $inf[csf("image_location")]; ?>' height='100px' width='100px' />
						<? } ?>
					</th>
					<th style="background: #D7ECD9">Job No</th>
					<th><? echo $row[csf("job_no")]; ?></th>
					<th style="background: #D7ECD9">OR. Rcv Date</th>
					<th><? echo  date('d-M-y', strtotime($po_received_date)); ?></th>
					<th style="background: #D7ECD9">Order Quantity</th>
					<th style="background: yellow; color: #8B0000;">Price/Pcs</th>
					<th align="right" style="background: yellow; color: #8B0000;">&#36; <? echo $row[csf("avg_unit_price")]; ?> </th>
				</tr>
				<tr>
					<th style="background: #D7ECD9">Buyer</th>
					<th><? echo $buyer_arr[$row[csf("buyer_name")]]; ?></th>
					<th style="background: #D7ECD9">Ship. Date</th>
					<th><? echo  date('d-M-y', strtotime($public_ship_date)); ?></th>
					<th align="center" style="color: #8B0000"><? echo $row[csf("job_qty")]; ?> <? echo $unit_of_measurement[$row[csf("order_uom")]]; ?></th>
					<th style="background: yellow; color: #8B0000;">Order Value</th>
					<th align="right" style="background: yellow; color: #8B0000;">&#36; <?= number_format($order_values, 2);  ?></th>
				</tr>
				<tr>
					<th style="background: #D7ECD9">Prod. Dept</th>
					<th><? echo $product_dept[$row[csf("product_dept")]]; ?></th>
					<th style="background: #D7ECD9">Garments Item</th>
					<th>
						<?
						$grmnt_items = "";
						if ($garments_item[$row[csf("gmts_item_id")]] == "") {

							$grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no=$txt_job_no");
							foreach ($grmts_sql as $key => $val) {
								$grmnt_items .= $garments_item[$val[csf("gmts_item_id")]] . ", ";
								$gmts_item[] = $val[csf("gmts_item_id")];
							}
							$grmnt_items = substr_replace($grmnt_items, "", -1, 1);
						} else {
							$gmts_item = explode(',', $row[csf("gmts_item_id")]);
							$grmnt_items = $garments_item[$row[csf("gmts_item_id")]];
						}
						echo $grmnt_items;
						?>
					</th>
					<th align="center" style="color: #8B0000"><?= $row[csf("job_qty")] * $set_item_ratio . ' Pcs' ?></th>
					<!-- <th style="background: yellow; color: #8B0000;"> <? if ($zero_value == 0) echo "Budget Value"; ?></th>                      
                <th align="right" style="background: yellow; color: #8B0000;"><? if ($zero_value == 0) { ?>
                <? if ($total_budget_value > 0) {
																						echo '&dollar;' . fn_number_format($total_budget_value, 2);
																					} ?><br/>
                <? if ($total_budget_value > 0) {
																						echo fn_number_format($total_budget_value / $order_values * 100, 2) . '%';
																					} ?>
                <? } ?>
                </th>  -->
					<th style="background: #D7ECD9">File No</th>
					<th><? echo $file_cond; ?></th>
				</tr>
				<tr>
					<th style="background: #D7ECD9">Season / Brand</th>
					<th><? echo $sesson_arr[$row[csf("season_buyer_wise")]] . '&nbsp' . $brand_arr[$row[csf("brand_id")]]; ?></th>
					<th>Costing Per: <br><?= $costing_for;  ?></th>
					<th style="background: #D7ECD9">Plan Cut quantity (<? echo fn_number_format((($plan_cut_qty - $job_qnty) / $job_qnty) * 100, 2) . '%' ?>) </td>
					<th align="center" style="color: #8B0000"><?= $row[csf("job_quantity")] * $total_set_qnty . ' Pcs'; //." ". $unit_of_measurement[$row[csf("order_uom")]]; 
																?></th>
					<!-- <th rowspan="2" style="background: yellow; color: #8B0000;"><? if ($zero_value == 0) echo "Open Value %"; ?></th>                      
                <th rowspan="2" align="right" style="background: yellow; color: #8B0000;"><? if ($zero_value == 0) { ?> &#36;<?
																																$margin_val = $order_values - $total_budget_value;
																																echo fn_number_format($margin_val, 2) . '<br>' . fn_number_format($margin_val / $order_values * 100, 2) . '%';
																															}
																																?></th> -->
					<th style="background: #D7ECD9">Ref No</th>
					<th><? echo ltrim($ref_cond, ", "); ?></th>
				</tr>
				<tr>
					<th style="background: #D7ECD9">Style No</th>
					<th><? $style_no = $row[csf("style_ref_no")];
						echo $row[csf("style_ref_no")]; ?></th>
					<th style="background: #D7ECD9">App. Status</th>
					<th colspan="2"><? if ($row[csf("approved")] == 1) {
										echo "This Budget is Approved ";
									} elseif ($row[csf("approved")] == 3) {
										echo "This Budget is partial Approved";
									} else {
										echo "This Budget is Not  Approved";
									} ?></th>
					<th style="background: #D7ECD9">SMV</th>
					<th>
						<?


						$sews_pcs_sql = sql_select("select gmts_item_id,smv_pcs from wo_po_details_mas_set_details where job_no=$txt_job_no");
						foreach ($sews_pcs_sql as $key => $val) {
							$sew_pcs[$val[csf("gmts_item_id")]] = $val[csf("smv_pcs")];
						}


						echo implode(',', $sew_pcs);
						?>
					</th>
				</tr>
				<tr>
					<th rowspan="2" style="background: #D7ECD9">Style Description</th>
					<th rowspan="2" colspan="2"><? echo $row[csf("style_description")]; ?></th>
					<th style="background: #D7ECD9">Remarks</th>
					<th colspan="3"><? echo $row[csf("remarks")]; ?></th>
				</tr>
				<tr>
					<th style="background: #D7ECD9">Refusing Cause</th>
					<th colspan="3"><? echo $row[csf("refusing_cause")]; ?></th>
				</tr>
			</table>

		<?
			$avg_unit_price = $row[csf("avg_unit_price")];
			$ord_qty = $row[csf("ord_qty")];
		} //end first foearch
		/*echo '<pre>';
	print_r($conv_amount_job_process); die;*/

		$yarnPer = $yarn_qty_amount_arr[$job_no]['amount'] / $yarn_qty_amount_arr[$job_no]['qty'];
		$finishPer = $total_finishing_amount / $total_finishing_qty;
		$ydsPer = array_sum($conv_amount_job_process[$job_no][30]) / array_sum($conv_qty_job_process[$job_no][30]);
		$aopPer = array_sum($conv_amount_job_process[$job_no][35]) / array_sum($conv_qty_job_process[$job_no][35]);
		$knitPer = array_sum($conv_amount_job_process[$job_no][1]) / array_sum($conv_qty_job_process[$job_no][1]);
		$purchPer = $purchase_qty / $purchase_amount;
		$dyePer = array_sum($conv_amount_job_process[$job_no][31]) / array_sum($conv_qty_job_process[$job_no][31]);

		$totFabPer = $yarnPer + $finishPer + $ydsPer + $aopPer + $knitPer + $purchPer + $dyePer;

		//echo $yarnPer.'='.$finishPer.'='.$ydsPer.'='.$aopPer.'='.$knitPer.'='.$purchPer.'='.$dyePer.'='.$totFabPer;
		//echo $other_costing_arr[$job_no]['cm_cost'].'='.$plancutqty.'='.$set_item_ratio;


		?>
		<br>
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px; margin-top: 10px; font-family: 'Arial Narrow', Arial, sans-serif;" rules="all">
			<label style="float:left;background:#CCCCCC; font-size:larger;"><b>Summary </b> </label>
			<tr style="background: #D7ECD9">
				<th colspan="8" width="320">Fabric </th>
				<th colspan="4" width="160">Embellishment</th>
				<th colspan="4" width="160">Trims + CM + Misc + Mrg</th>
				<th style="background: yellow">TTL COST &dollar;</th>
			</tr>
			<tr style="background: #D7ECD9">
				<th align="center">Item</th>
				<th align="center">Cost/Uom</th>
				<th align="center">Amount</th>
				<th align="center">&percnt;</th>
				<th align="center">Item</th>
				<th align="center">Cost/Uom</th>
				<th align="center">Amount</th>
				<th align="center">&percnt;</th>
				<th align="center">Item</th>
				<th align="center">Cost/Dz</th>
				<th align="center">Amount</th>
				<th align="center">&percnt;</th>
				<th align="center">Item</th>
				<th align="center">Cost/Dz</th>
				<th align="center">Amount</th>
				<th align="center">&percnt;</th>
				<th rowspan="5" align="right" style="background: yellow; color: #8B0000"><b>
						<? if ($total_budget_value > o) {
							echo fn_number_format($total_budget_value, 2, '', '');
						} ?><br /><br />
						<? if ($total_budget_value > o) {
							echo fn_number_format($total_budget_value / $order_values * 100, 2) . '%';
						} ?></b>
				</th>
			</tr>
			<tr>
				<th align="center">Yarn</th>
				<td align="center"><? if ($yarn_amount_summ > 0) {
										echo fn_number_format($yarn_qty_amount_arr[$job_no]['amount'] / $yarn_qty_amount_arr[$job_no]['qty'], 2);
									} ?></td>
				<td align="right" style="color: #8B0000"><? if ($yarn_amount_summ > 0) {
																echo '&dollar;' . fn_number_format($yarn_amount_summ, 2);
															} ?></td>
				<td align="right"><? if ($yarn_amount_summ > 0) {
										echo fn_number_format($yarn_qty_amount_arr[$job_no]['amount'] / $order_values * 100, 2) . '%';
									}; ?></td>

				<th align="center">Finishing</th>
				<td align="center" title="<?= $total_finishing_amount . '=' . $total_finishing_qty; ?>"><? if ($total_finishing_amount > 0) {
																											echo fn_number_format($total_finishing_amount / $total_finishing_qty, 2);
																										} ?></td>
				<td align="right" style="color: #8B0000"><? if ($total_finishing_amount > 0) {
																echo '&dollar;' . fn_number_format($total_finishing_amount, 2);
															} ?></td>
				<td align="right"><? if ($total_finishing_amount > 0) {
										echo fn_number_format($total_finishing_amount / $order_values * 100, 2) . '%';
									} ?></td>
				<?
				$print_amt = $emb_amount_job_name_arr[$job_no][1];
				$print_qty = $emb_qty_job_name_arr[$job_no][1];
				?>
				<th align="center">Print</th>
				<td align="center" title="Amt=<? echo $print_amt; ?>/Qty=<? echo $print_qty; ?>">
					<? if ($print_amount_summ > 0) {
						//echo fn_number_format($emb_amount_job_name_arr[$job_no][1]/$emb_qty_job_name_arr[$job_no][1],2);
						//echo fn_number_format($embel_cost_dzn,2);
						echo fn_number_format($print_amt / $print_qty, 2);
					}  ?></td>
				<td align="right" style="color: #8B0000"><? if ($print_amount_summ > 0) {
																echo '&dollar;' . fn_number_format($print_amount_summ, 2);
															}  ?></td>
				<td align="right"><? if ($print_amount_summ > 0) {
										echo fn_number_format($emb_amount_job_name_arr[$job_no][1] / $order_values * 100, 2) . '%';
									} ?></td>

				<th align="center">Trim</th>
				<td align="center"><? if ($trims_costing_arr[$job_no] > 0) {
										echo fn_number_format($trims_costing_arr[$job_no] / $order_job_qnty, 2);
									} ?></td>
				<td align="right" style="color: #8B0000"><? if ($trims_costing_arr[$job_no] > 0) {
																echo '&dollar;' . fn_number_format($trims_costing_arr[$job_no], 2);
															} ?></td>
				<td align="right"><? if ($trims_costing_arr[$job_no] > 0) {
										echo fn_number_format($trims_costing_arr[$job_no] / $order_values * 100, 2) . '%';
									} ?></td>
			</tr>
			<tr>
				<th align="center">Yds</th>
				<td align="center"><? if ($yds_amount_summ > 0) {
										echo fn_number_format(array_sum($conv_amount_job_process[$job_no][30]) / array_sum($conv_qty_job_process[$job_no][30]), 2);
									} ?></td>
				<td align="right" style="color: #8B0000"><? if ($yds_amount_summ > 0) {
																echo '&dollar;' . fn_number_format($yds_amount_summ, 2);
															} ?></td>
				<td align="right"><? if ($yds_amount_summ > 0) {
										echo fn_number_format(array_sum($conv_amount_job_process[$job_no][30]) / $order_values * 100, 2) . '%';
									} ?></td>

				<th align="center">AOP</th>
				<td align="center"><? if ($aop_amount_summ > 0) {
										echo fn_number_format(array_sum($conv_amount_job_process[$job_no][35]) / array_sum($conv_qty_job_process[$job_no][35]), 2);
									} ?></td>
				<td align="right" style="color: #8B0000"><? if ($aop_amount_summ > 0) {
																echo '&dollar;' . fn_number_format($aop_amount_summ, 2);
															} ?></td>
				<td align="right"><? if ($aop_amount_summ > 0) {
										echo fn_number_format(array_sum($conv_amount_job_process[$job_no][35]) / $order_values * 100, 2) . '%';
									} ?></td>

				<th align="center">EMB</th>
				<td align="center"><? if ($emb_amount_summ > 0) {
										echo fn_number_format($emb_amount_job_name_arr[$job_no][2] / $emb_qty_job_name_arr[$job_no][2], 2);
									}  ?></td>
				<td align="right" style="color: #8B0000"><? if ($emb_amount_summ > 0) {
																echo '&dollar;' . fn_number_format($emb_amount_summ, 2);
															}  ?></td>
				<td align="right"><? if ($emb_amount_summ > 0) {
										echo fn_number_format($emb_amount_job_name_arr[$job_no][2] / $order_values * 100, 2) . '%';
									} ?></td>
				<th align="center">MISC</th>
				<td align="center"><? if ($misc_cost > 0) {
										echo fn_number_format($misc_cost / $order_job_qnty * 12, 2);
									} ?></td>
				<td align="right" style="color: #8B0000"><? if ($misc_cost > 0) {
																echo '&dollar;' . fn_number_format($misc_cost, 2);
															}  ?></td>
				<td align="right"><? if ($misc_cost > 0) {
										echo fn_number_format($misc_cost / $order_values * 100, 2) . '%';
									} ?></td>
			</tr>
			<tr>
				<th align="center">Knitting</th>
				<td align="center"><? if ($knitting_amount_summ != '') {
										echo fn_number_format(array_sum($conv_amount_job_process[$job_no][1]) / array_sum($conv_qty_job_process[$job_no][1]), 2);
									} ?></td>
				<td align="right" style="color: #8B0000"><? if ($knitting_amount_summ != '') {
																echo  '&dollar;' . $knitting_amount_summ;
															}   ?></td>
				<td align="right"><? if ($knitting_amount_summ != '') {
										echo fn_number_format(array_sum($conv_amount_job_process[$job_no][1]) / $order_values * 100, 2) . '%';
									} ?></td>

				<th align="center">P. Fabric</th>
				<td align="center"><? $total_fabic_cost += $purchase_qty / $purchase_amount;
									if ($purchase_qty > 0 && $purchase_amount > 0) {
										echo fn_number_format($purchase_qty / $purchase_amount, 2);
									} ?></td>
				<td align="right"><? $total_fabric_amount += $purchase_amount;
									if ($purchase_amount) {
										echo '&dollar;' . fn_number_format($purchase_amount, 2);
									} ?></td>
				<td align="right"><? $total_fabric_per += $purchase_amount / $order_values * 100;
									if ($purchase_amount > 0) {
										echo fn_number_format($purchase_amount / $order_values * 100, 2) . '%';
									}  ?></td>

				<th align="center">Wash</th>
				<td align="center"><? if ($wash_amount_summ > 0) {
										echo fn_number_format($wash_amount_job_name_arr[$job_no][3] / $wash_qty_job_name_arr[$job_no][3], 2);
									};  ?></td>
				<td align="right" style="color: #8B0000"><? if ($wash_amount_summ > 0) {
																echo '&dollar;' . fn_number_format($wash_amount_summ, 2);
															}  ?></td>
				<td align="right"><? if ($wash_amount_summ > 0) {
										echo fn_number_format($wash_amount_job_name_arr[$job_no][3] / $order_values * 100, 2) . '%';
									} ?></td>

				<th align="center" style="color: #8B0000">F.CM</th>
				<td align="center" style="color: #8B0000" title="(CM Cost/Order Qty Pcs)x12"><? if ($other_costing_arr[$job_no]['cm_cost'] > 0) {
																									echo fn_number_format(($other_costing_arr[$job_no]['cm_cost'] / ($plancutqty * $set_item_ratio)) * 12, 2);
																								} ?></td>
				<td align="right" style="color: #8B0000"><? if ($other_costing_arr[$job_no]['cm_cost'] > 0) {
																echo fn_number_format($other_costing_arr[$job_no]['cm_cost'], 2);
															} ?></td>
				<td align="right"><? if ($other_costing_arr[$job_no]['cm_cost'] > 0) {
										echo fn_number_format($other_costing_arr[$job_no]['cm_cost'] / $order_values * 100, 2) . '%';
									} ?></td>
			</tr>
			<tr>
				<th align="center">Dyeing</th>
				<td align="center"><? if ($dyeing_amount_summ > 0) {
										echo fn_number_format(array_sum($conv_amount_job_process[$job_no][31]) / array_sum($conv_qty_job_process[$job_no][31]), 2);
									} ?></td>
				<td align="right" style="color: #8B0000"><? if ($dyeing_amount_summ > 0) {
																echo '&dollar;' . fn_number_format($dyeing_amount_summ, 2);
															} ?></td>
				<td align="right"><? if ($dyeing_amount_summ > 0) {
										echo fn_number_format(array_sum($conv_amount_job_process[$job_no][31]) / $order_values * 100, 2) . '%';
									} ?></td>

				<th align="center" style="color: #8B0000">TOTAL</th>
				<th align="center" style="color: #8B0000"><? if ($total_fabic_cost > 0) {
																echo fn_number_format($total_fabic_cost, 2);
															} ?></th>
				<th align="right" style="color: #8B0000"><? if ($total_fabric_amount > 0) {
																echo '&dollar;' . fn_number_format($total_fabric_amount, 2);
															}  ?></th>
				<th align="right" style="color: #8B0000"><? if ($total_fabric_per > 0) {
																echo fn_number_format($total_fabric_per, 2);
															}  ?></th>

				<th align="center" title="Special works, Garments dyeing, UV print and others.">Others</th>
				<td align="center"><? if ($others_emb_amount > 0) {
										echo fn_number_format($others_emb_amount / $others_emb_qty, 2);
									} ?></td>
				<td align="right"><? if ($others_emb_amount > 0) {
										echo '&dollar;' . fn_number_format($others_emb_amount, 2);
									}  ?></td>
				<td align="right"><? if ($others_emb_amount > 0) {
										echo fn_number_format($others_emb_amount / $order_values * 100, 2);
									}  ?></td>
				<th align="center">Mrg</th>
				<?
				$total_margin_val = $order_values - $total_budget_value;
				?>
				<td align="right" style="color: #8B0000"><?
															echo fn_number_format($total_margin_val / $order_job_qnty * 12, 2);

															?></td>
				<td align="right" style="color: #8B0000"><? echo '&dollar;' . fn_number_format($total_margin_val, 2); ?></td>
				<td align="right" style="color: #8B0000"><?
															$cv = ($total_margin_val / $order_values * 100);
															if (is_infinite($cv) || is_nan($cv)) {
																$cv = 0;
															}
															echo fn_number_format($cv, 2) . '%';  ?></td>
			</tr>
		</table>
		<?
		$location_cpm_cost = 0;
		$cm_min_variable = return_field_value("yarn_iss_with_serv_app as cost_per_minute", "variable_order_tracking", "company_name =" . $cbo_company_name . " and variable_list=67 and is_deleted=0 and status_active=1", "cost_per_minute");
		if ($cm_min_variable == "" || $cm_min_variable == 0) $location_cpm_cost = 0;
		else $location_cpm_cost = $cm_min_variable;
		if ($location_cpm_cost != 1) {
			$sql_std_para = sql_select("select interest_expense, income_tax, cost_per_minute, applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$cbo_company_name and status_active=1 and is_deleted=0 order by id");

			foreach ($sql_std_para as $row) {
				$applying_period_date = change_date_format($row[csf('applying_period_date')], '', '', 1);
				$applying_period_to_date = change_date_format($row[csf('applying_period_to_date')], '', '', 1);
				$diff = datediff('d', $applying_period_date, $applying_period_to_date);
				for ($j = 0; $j < $diff; $j++) {
					//$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);
					$date_all = add_date(str_replace("'", "", $applying_period_date), $j);
					$newdate = change_date_format($date_all, '', '', 1);
					$financial_para[$newdate][interest_expense] = $row[csf('interest_expense')];
					$financial_para[$newdate][income_tax] = $row[csf('income_tax')];
					$financial_para[$newdate][cost_per_minute] = $row[csf('cost_per_minute')];
				}
			}
		} else {
			$sql_std_para = sql_select("select a.id, b.id as dtls_id, b.location_id, b.applying_period_date, b.applying_period_to_date, b.monthly_cm_expense, b.no_factory_machine, b.working_hour, b.cost_per_minute from lib_standard_cm_entry a, lib_standard_cm_entry_dtls b where a.id=b.mst_id and b.location_id=$location_name_id and a.company_id=$cbo_company_name");
			foreach ($sql_std_para as $row) {
				$applying_period_date = change_date_format($row[csf('applying_period_date')], '', '', 1);
				$applying_period_to_date = change_date_format($row[csf('applying_period_to_date')], '', '', 1);
				$diff = datediff('d', $applying_period_date, $applying_period_to_date);
				for ($j = 0; $j < $diff; $j++) {
					$date_all = add_date(str_replace("'", "", $applying_period_date), $j);
					$newdate = change_date_format($date_all, '', '', 1);
					$financial_para[$newdate][interest_expense] = $row[csf('interest_expense')];
					$financial_para[$newdate][income_tax] = $row[csf('income_tax')];
					$financial_para[$newdate][cost_per_minute] = $row[csf('cost_per_minute')];
				}
			}
		}

		$pre_costing_date = change_date_format($costing_date, '', '', 1);
		?>
		<? if ($zero_value == 0) { ?>
			<br />
			<label style="text-align:left; background:#CCCCCC; font-size:larger;"><b>CM Details </b> </label>
			<div style="width:970px; margin-top: 10px; font-family: 'Arial Narrow', Arial, sans-serif;">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:720px;float: left;" rules="all">
					<tr>
						<th colspan="13">&nbsp;</th>
					</tr>
					<tr style="background: #D7ECD9">
						<th>Style NO.</th>
						<th>MC</th>
						<th>Prd/Hr</th>
						<th>SMV</th>
						<th>BCM</th>
						<th>F.CM</th>
						<th>TTL Min</th>
						<th align="center">CPM</th>
						<th>RL</th>
						<th>RD</th>
						<th>A Eff%</th>
						<th>Layout No</th>
						<th>Alloc Qty</th>
					</tr>
					<tr align="center">
						<td><?= $style_no  ?></td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td><?= $sew_smv ?></td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&#36; <? echo fn_number_format($financial_para[$pre_costing_date][cost_per_minute], 4); ?></td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
					</tr>
					<tr>
						<th>Grand Total</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th><?= $sew_smv ?></th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th>&#36; <? echo fn_number_format($financial_para[$pre_costing_date][cost_per_minute], 4); ?></th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
				</table>
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:248px; margin-left: 2px; float: right;" rules="all">
					<tr>
						<th colspan="3" bgcolor="yellow">Embellishment[DZN]</th>
					</tr>
					<tr>
						<th>Print Qty</th>
						<th>Emb Qty</th>
						<th>Wash Qty</th>
					</tr>
					<tr align="center">
						<td><? if ($emb_qty_job_name_arr[$job_no][1] > 0) {
								echo fn_number_format($emb_qty_job_name_arr[$job_no][1], 2);
							} else {
								echo '&nbsp;';
							} ?></td>
						<td><? if ($emb_qty_job_name_arr[$job_no][2] > 0) {
								echo fn_number_format($emb_qty_job_name_arr[$job_no][2], 2);
							} else {
								echo '&nbsp;';
							} ?></td>
						<td><? if ($emb_qty_job_name_arr[$job_no][3] > 0) {
								echo fn_number_format($wash_qty_job_name_arr[$job_no][3], 2);
							} else {
								echo '&nbsp;';
							} ?></td>
					</tr>
					<tr>
						<th><? if ($emb_qty_job_name_arr[$job_no][1] > 0) {
								echo fn_number_format($emb_qty_job_name_arr[$job_no][1], 2);
							} else {
								echo '&nbsp;';
							} ?></th>
						<th><? if ($emb_qty_job_name_arr[$job_no][2] > 0) {
								echo fn_number_format($emb_qty_job_name_arr[$job_no][2], 2);
							} else {
								echo '&nbsp;';
							} ?></th>
						<th><? if ($emb_qty_job_name_arr[$job_no][3] > 0) {
								echo fn_number_format($wash_qty_job_name_arr[$job_no][3], 2);
							} else {
								echo '&nbsp;';
							} ?></th>
					</tr>
				</table>
			</div>
			<br>
		<? } ?>
		<?
		$nameArray_fabric_description = sql_select("SELECT (a.id) as fabric_cost_dtls_id,a.item_number_id, max(a.lib_yarn_count_deter_id) as determin_id,a.body_part_id,a.uom,a.color_type_id,a.fabric_source, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type, b.dia_width,avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent , a.fab_nature_id,  avg(b.requirment) as requirment, d.fabric_composition_id FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, lib_yarn_count_determina_mst d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and  c.id=b.color_size_table_id and a.lib_yarn_count_deter_id=d.id and c.status_active=1 and c.is_deleted=0  and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and a.job_no =$txt_job_no and  b.cons>0 group by a.body_part_id,a.uom,a.id,a.item_number_id,a.color_type_id,a.fabric_source,a.construction,a.composition,a.gsm_weight,b.dia_width,a.fab_nature_id, d.fabric_composition_id order by fabric_cost_dtls_id,a.body_part_id,b.dia_width");

		//a.fabric_source=1 and
		foreach ($nameArray_fabric_description as $row) {
			$fabric_id = $row[csf('fabric_cost_dtls_id')];
			$yarn_amount = $yarnDataWithFabricidArr[$fabric_id]['amount'];
			$yarn_qty = $yarnDataWithFabricidArr[$fabric_id]['qty'];

			$yds_amount = array_sum($con_amount_fabric_process[$fabric_id][30]);
			$yds_qty = array_sum($con_qty_fabric_process[$fabric_id][30]);

			$knitting_amount = array_sum($con_amount_fabric_process[$fabric_id][1]);
			$knitting_qty = array_sum($con_qty_fabric_process[$fabric_id][1]);
			$dyeing_amount = array_sum($con_amount_fabric_process[$fabric_id][31]);
			$dyeing_qty = array_sum($con_qty_fabric_process[$fabric_id][31]);
			$aop_amount = array_sum($con_amount_fabric_process[$fabric_id][35]);
			$aop_qty = array_sum($con_qty_fabric_process[$fabric_id][35]);

			$total_finishing_amount = 0;
			$total_finishing_qty = 0;
			foreach ($finishing_arr as $fid) {
				$total_finishing_amount += array_sum($con_amount_fabric_process[$fabric_id][$fid]);
				$total_finishing_qty += array_sum($con_qty_fabric_process[$fabric_id][$fid]);
			}

			$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['body_part_id'] = $row[csf('body_part_id')];
			$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['description'] = $row[csf('construction')] . ', ' . $fabric_composition_arr[$row[csf('fabric_composition_id')]];
			if ($row[csf('fab_nature_id')] == 2) {
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['fqty'] = array_sum($fabric_qty_arr['knit']['finish'][$row[csf('fabric_cost_dtls_id')]]);
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['gqty'] = array_sum($fabric_qty_arr['knit']['grey'][$row[csf('fabric_cost_dtls_id')]]);
			}
			if ($row[csf('fab_nature_id')] == 3) {
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['fqty'] = array_sum($fabric_qty_arr['woven']['finish'][$row[csf('fabric_cost_dtls_id')]]);
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['gqty'] = array_sum($fabric_qty_arr['woven']['grey'][$row[csf('fabric_cost_dtls_id')]]);
			}

			$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['funit'] = $row[csf('uom')];
			$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['cons'] = $row[csf('cons')];

			$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['process_loss'] = $row[csf('process_loss_percent')];
			$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['yarn_amount'] = $yarn_amount;
			$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['yarn_per'] = $yarn_amount / $yarn_qty;

			$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['yds_amount'] = $yds_amount;
			$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['yds_per'] = $yds_amount / $yds_qty;
			$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['knitting_amount'] = $knitting_amount;
			$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['knitting_per'] = $knitting_amount / $knitting_qty;
			$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['dyeing_amount'] = $dyeing_amount;
			$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['dyeing_per'] = $dyeing_amount / $dyeing_qty;
			$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['aop_amount'] = $aop_amount;
			$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['aop_per'] = $aop_amount / $aop_qty;
			$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['finishing_amount'] = $total_finishing_amount;
			$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['finishing_per'] = $total_finishing_amount / $total_finishing_qty;
			if ($row[csf('fabric_source')] == 1) {
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['ttl_cost'] = $yarn_amount + $yds_amount + $knitting_amount + $dyeing_amount + $aop_amount + $total_finishing_amount;
			}
			if ($row[csf('fabric_source')] == 2) {
				if ($row[csf('fab_nature_id')] == 2) {
					$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['ttl_cost'] = array_sum($fabric_amount_arr['knit']['grey'][$row[csf('fabric_cost_dtls_id')]]);
				}
				if ($row[csf('fab_nature_id')] == 3) {
					$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['ttl_cost'] = array_sum($fabric_amount_arr['woven']['grey'][$row[csf('fabric_cost_dtls_id')]]);
				}
			}
		}
		/* echo '<pre>';
			print_r($fabric_data_arr); die; */
		$total_finishing_amount = 0;
		?>
		<? if ($zero_value == 0) { ?>
			<br>
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px; margin-top: 10px; font-family: 'Arial Narrow', Arial, sans-serif;" rules="all">
				<label style="float:left;background:#CCCCCC; font-size:larger;"><b>Fabric Details </b> </label>
				<tr style="background: #D7ECD9">
					<th rowspan="2">Garments Part Name</th>
					<th rowspan="2">Fabric Details</th>
					<th rowspan="2">Con</th>
					<th>F. QTY</th>
					<th rowspan="2">Process Loss</th>
					<th>G. QTY</th>
					<th colspan="7">Cost/Uom (Fabric)</th>
					<th rowspan="2">Cost/Dz</th>
					<th rowspan="2" style="background: yellow;">TTL Cost $</th>
				</tr>
				<tr style="background: #D7ECD9">
					<th>Unit</th>
					<th>Unit</th>
					<th>Yarn</th>
					<th>Yds</th>
					<th>Knitting</th>
					<th>Dyeing</th>
					<th>AOP</th>
					<th>Finishing</th>
					<th>Cost/Uom</th>
				</tr>
				<?
				foreach ($fabric_data_arr as $value) { ?>
					<tr>
						<td rowspan="2"><?= $body_part[$value['body_part_id']] ?></td>
						<td rowspan="2"><?= $value['description'] ?></td>
						<td rowspan="2" align="center"><?= fn_number_format($value['cons'], 2); ?></td>
						<td align="center"><? $total_fqty += $value['fqty'];
											echo fn_number_format($value['fqty'], 2); ?></td>
						<td rowspan="2" align="center"><? if ($value['process_loss'] > 0) {
															echo fn_number_format($value['process_loss'], 2);
														} ?></td>
						<td align="center"><? $total_gqty += $value['gqty'];
											echo fn_number_format($value['gqty'], 2) ?></td>
						<td rowspan="2" align="right"><? $total_yarn_amount += $value['yarn_amount'];
														if ($value['yarn_amount'] > 0) {
															echo fn_number_format($value['yarn_per'], 2);
														} ?><br><? if ($value['yarn_amount'] > 0) {
																	echo fn_number_format($value['yarn_amount'], 2);
																} ?></td>
						<td rowspan="2" align="right"><? $total_yds_amount += $value['yds_amount'];
														if ($value['yds_per'] > 0) {
															echo fn_number_format($value['yds_per'], 2);
														} ?><br><? if ($value['yds_amount'] > 0) {
																	echo fn_number_format($value['yds_amount'], 2);
																} ?></td>
						<td rowspan="2" align="right"><? $total_knitting_amount += $value['knitting_amount'];
														if ($value['knitting_per'] > 0) {
															echo fn_number_format($value['knitting_per'], 2);
														} ?><br><? if ($value['knitting_amount'] > 0) {
																	echo fn_number_format($value['knitting_amount'], 2);
																} ?></td>
						<td rowspan="2" align="right"><? $total_dyeing_amount += $value['dyeing_amount'];
														if ($value['dyeing_per'] > 0) {
															echo fn_number_format($value['dyeing_per'], 2);
														} ?><br><? if ($value['dyeing_amount'] > 0) {
																	echo fn_number_format($value['dyeing_amount'], 2);
																} ?></td>
						<td rowspan="2" align="right"><? $total_aop_amount += $value['aop_amount'];
														if ($value['aop_per'] > 0) {
															echo fn_number_format($value['aop_per'], 2);
														} ?><br><? if ($value['aop_amount'] > 0) {
																	echo fn_number_format($value['aop_amount'], 2);
																} ?></td>
						<td rowspan="2" align="right"><? $total_finishing_amount += $value['finishing_amount'];
														if ($value['finishing_per'] > 0) {
															echo fn_number_format($value['finishing_per'], 2);
														} ?><br><? if ($value['finishing_amount'] > 0) {
																	echo fn_number_format($value['finishing_amount'], 2);
																} ?></td>
						<td rowspan="2" align="right" title="TTL Cost/Finish Quantity"><?= fn_number_format($value['ttl_cost'] / $value['fqty'], 2) ?></td>
						<td rowspan="2" align="right"><?= fn_number_format($value['ttl_cost'] / $order_job_qnty * 12, 2) ?></td>
						<th rowspan="2" style="background: yellow;" align="right"><? $total_ttl_cost += $value['ttl_cost'];
																					echo fn_number_format($value['ttl_cost'], 2) ?></th>
					</tr>
					<tr>
						<td align="center"><?= $unit_of_measurement[$value['funit']] ?></td>
						<td align="center"><?= $unit_of_measurement[$value['funit']] ?></td>
					</tr>
				<? }
				?>
				<tr>
					<th colspan="2">Fabric Total</th>
					<td></td>
					<th align="center"><? if ($total_fqty > 0) {
											echo fn_number_format($total_fqty, 2);
										} ?></th>
					<td></td>
					<th align="right"><? if ($total_gqty) {
											echo fn_number_format($total_gqty, 2);
										} ?></th>
					<th align="right"><? if ($total_yarn_amount) {
											echo fn_number_format($total_yarn_amount, 2);
										} ?></th>
					<th align="right"><? if ($total_yds_amount) {
											echo fn_number_format($total_yds_amount, 2);
										} ?></th>
					<th align="right"><? if ($total_knitting_amount) {
											echo fn_number_format($total_knitting_amount, 2);
										} ?></th>
					<th align="right"><? if ($total_dyeing_amount) {
											echo fn_number_format($total_dyeing_amount, 2);
										} ?></th>
					<th align="right"><? if ($total_aop_amount) {
											echo fn_number_format($total_aop_amount, 2);
										} ?></th>
					<th align="right"><? if ($total_finishing_amount) {
											echo fn_number_format($total_finishing_amount, 2);
										} ?></th>
					<th></th>
					<th></th>
					<th style="background: yellow;" align="right"><? if ($total_ttl_cost) {
																		echo '&dollar;' . fn_number_format($total_ttl_cost, 2);
																	} ?> <br><? if ($total_ttl_cost) {
																					echo fn_number_format($total_ttl_cost / $order_values * 100, 2) . '%';
																				} ?></th>
				</tr>
			</table>
		<? } ?>
		<?

		//end 	All Fabric Cost part report-------------------------------------------
		$lib_yarn_count = return_library_array("select yarn_count,id from lib_yarn_count", "id", "yarn_count");
		$sql = "select min(id) as id, count_id, copm_one_id, percent_one, copm_two_id, percent_two, color,type_id, min(cons_ratio) as cons_ratio, sum(cons_qnty) as cons_qnty, rate, sum(amount) as amount from wo_pre_cost_fab_yarn_cost_dtls where job_no=" . $txt_job_no . "  and status_active=1 and is_deleted=0 group by count_id, copm_one_id, percent_one, copm_two_id, percent_two, color,type_id, rate";

		$data_array = sql_select($sql);
		$yarn_data_array = $yarn->getCountCompositionPercentTypeColorAndRateWiseYarnQtyAndAmountArray();
		//print_r($yarn_data_array);

		?>
		<br>
		<div style="margin-top:15px; font-family: 'Arial Narrow', Arial, sans-serif;">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px;text-align:center;" rules="all">

				<label style="float:left;background:#CCCCCC; font-size:larger;"><b>Yarn Details </b> </label>
				<tr style="font-weight:bold;">

					<td width="540" style="background: #D7ECD9">Yarn Description</td>
					<td width="80" style="background: #D7ECD9">Yarn Qty/<?= $costing_for; ?></td>
					<td width="80" style="background: #D7ECD9">TTL Yarn Qty</td>
					<td width="80" style="background: #D7ECD9">Rate &#36;</td>
					<td width="80" style="background: yellow">Amount &#36;</td>
					<td width="80" style="background: #D7ECD9">% to Ord. Value</td>
				</tr>
				<?
				$total_yarn_qty = 0;
				$total_yarn_amount = 0;
				$total_yarn_cost_dzn = $total_yarn_qty_dzn = 0;
				$total_yarn_cost_kg = 0;
				$total_yarn_avg_cons_qty = 0;
				foreach ($data_array as $row) {
					if ($row[csf("percent_one")] == 100)
						$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];
					else
						$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $composition[$row[csf("copm_two_id")]] . " " . $row[csf("percent_two")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];
					$rowcons_qnty = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['qty'];
					$rowavgcons_qnty = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['qty'];
					$rowamount = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['amount'];
					if (is_infinite($rowamount) || is_nan($rowamount)) {
						$rowamount = 0;
					}
				?>
					<tr>
						<td align="left"><? echo $item_descrition; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("cons_qnty")], 3); ?></td>
						<td align="right"><? echo fn_number_format($rowcons_qnty, 2); ?></td>

						<td align="right"><? if ($row[csf("rate")] > 0) {
												echo fn_number_format($row[csf("rate")], 3);
											} ?></td>
						<td align="right" style="background: yellow"><? if ($rowamount > 0) {
																			echo fn_number_format($rowamount, 2);
																		} ?></td>
						<td align="right"><?
											$cv = ($row[csf("amount")] / $price_dzn) * 100;
											if (is_infinite($cv) || is_nan($cv)) {
												$cv = 0;
											}
											if ($cv > 0) {
												echo fn_number_format($cv, 2);
											}
											?></td>
					</tr>
				<?
					$total_yarn_qty += $rowcons_qnty;
					$total_yarn_qty_dzn += $row[csf("cons_qnty")];
					$total_avg_yarn_qty += $rowavgcons_qnty;
					$total_yarn_amount += $rowamount;
					$total_yarn_cost_dzn += $row[csf("amount")];
					$total_yarn_avg_cons_qty += $rowavgcons_qnty;
					$total_yarn_cost_kg = $total_yarn_amount / $total_yarn_qty;
					if (is_infinite($total_yarn_cost_kg) || is_nan($total_yarn_cost_kg)) {
						$total_yarn_cost_kg = 0;
					}
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td>Yarn Total</td>
					<td align="right"><? if ($total_yarn_qty_dzn > 0) {
											echo fn_number_format($total_yarn_qty_dzn, 4);
										} ?></td>
					<td align="right"><? if ($total_yarn_qty > 0) {
											echo fn_number_format($total_yarn_qty, 2);
										} ?></td>
					<td></td>
					<td align="right" bgcolor="yellow"><? if ($total_yarn_amount > 0) {
															echo '&dollar;' . fn_number_format($total_yarn_amount, 2);
														} ?></td>
					<td align="right"><?
										$cv = ($total_yarn_cost_dzn / $price_dzn) * 100;
										if (is_infinite($cv) || is_nan($cv)) {
											$cv = 0;
										}
										if ($cv > 0) {
											echo fn_number_format($cv, 2) . ' %';
										}
										?></td>
				</tr>
			</table>
		</div>
		<!-- End Yarn Cost part report here ------------------------------------------- -->

		<table width="100%" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" style="font-family:Arial Narrow;">
			<caption> <strong style="float:left"> Stripe Details</strong></caption>
			<?
			$sql_cov_stripe = "select  b.id,b.conv_cost_dtls_id,b.fabric_cost_dtls_id,b.gmts_color_id,b.fabric_color_id,b.cons,b.unit_charge,c.stripe_color,d.body_part_id ,c.color_number_id,c.id as did
			from wo_pre_cost_fab_conv_cost_dtls a, wo_pre_cos_conv_color_dtls b ,wo_pre_stripe_color c ,wo_pre_cost_fabric_cost_dtls d
			where a.id=b.conv_cost_dtls_id and a.fabric_description=b.fabric_cost_dtls_id and a.fabric_description=c.pre_cost_fabric_cost_dtls_id and b.fabric_cost_dtls_id=c.pre_cost_fabric_cost_dtls_id  and b.gmts_color_id=c.color_number_id and b.fabric_color_id=c.stripe_color and d.id=c.pre_cost_fabric_cost_dtls_id and b.job_no='$job_no'  and a.status_active=1 and b.status_active=1 and c.status_active=1  order by b.id";
			$cov_stripe_data = sql_select($sql_cov_stripe);
			foreach ($cov_stripe_data as $row) {

				$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['unit_charge'][$row[csf('did')]] = $row[csf('unit_charge')];
			}
			$color_name_arr = return_library_array("select id,color_name from lib_color where status_active=1 and is_deleted=0", 'id', 'color_name');
			$sql_stripe = "SELECT c.id,c.composition,c.construction,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,sum(b.grey_fab_qnty) as fab_qty,b.dia_width,d.color_number_id as color_number_id,d.id as did,d.stripe_color,d.fabreqtotkg as fabreqtotkg ,d.measurement as measurement ,d.yarn_dyed,d.uom,avg(b.rate) as  rate from wo_booking_dtls b, wo_pre_cost_fabric_cost_dtls c,wo_pre_stripe_color d where c.id=b.pre_cost_fabric_cost_dtls_id and c.job_no=b.job_no and d.pre_cost_fabric_cost_dtls_id=c.id and d.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and b.job_no=d.job_no and b.job_no='$job_no'  and d.job_no='$job_no'   and c.color_type_id in (2,3,4,6,32,33,34)  and b.status_active=1  and c.is_deleted=0 and c.status_active=1  and d.is_deleted=0 and d.status_active=1  and 	b.is_deleted=0  group by c.id,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,d.color_number_id,d.id,d.stripe_color,d.yarn_dyed,d.fabreqtotkg ,d.measurement,d.uom,c.composition,c.construction,b.dia_width order by d.id ";
			//echo $sql_stripe; die;
			$result_data = sql_select($sql_stripe);
			foreach ($result_data as $row) {
				$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['stripe_color'][$row[csf('did')]] = $row[csf('stripe_color')];
				$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['measurement'][$row[csf('did')]] = $row[csf('measurement')];
				$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['uom'][$row[csf('did')]] = $row[csf('uom')];
				$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['fabreqtotkg'][$row[csf('did')]] = $row[csf('fabreqtotkg')];
				$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['rate'][$row[csf('did')]] = $row[csf('rate')];
				$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['yarn_dyed'][$row[csf('did')]] = $row[csf('yarn_dyed')];

				$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['composition'] = $row[csf('composition')];
				$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['construction'] = $row[csf('construction')];
				$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['gsm_weight'] = $row[csf('gsm_weight')];
				$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['color_type_id'] = $row[csf('color_type_id')];
				$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['dia_width'] = $row[csf('dia_width')];
				$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['fabreqtotkg'] += $row[csf('fabreqtotkg')];
			}
			?>

			<tr>
				<th width="30"> SL</th>
				<th width="100"> Body Part</th>
				<th width="80"> Fabric Color</th>
				<th width="70"> Fabric Qty(KG)</th>
				<th width="70"> Stripe Color</th>
				<th width="70"> Stripe Measurement</th>
				<th width="70"> Stripe Uom</th>
				<th width="70"> Qty.(KG)</th>
				<th width="70"> Rate</th>
				<th width="100">Amount</th>
			</tr>
			<?
			//if($db_type==0) $color_cond="d.fabric_color_id='".$color_id."'";
			//else if($db_type==2) $color_cond="nvl(d.fabric_color_id,0)=nvl('".$color_id."',0)";
			//else if($db_type==2) $color_cond="nvl(d.fabric_color_id,0)=nvl('".$color_id."',0)";


			$i = 1;
			$total_fab_qty = 0;
			$total_fabreqtotkg = 0;
			$fab_data_array = array();
			$total_fabamount = 0;
			$rows = 0;
			foreach ($stripe_arr as $body_id => $body_data) {
				foreach ($body_data as $color_id => $color_val) {
					$rowspan = count($color_val['stripe_color']);
					$composition = $stripe_arr2[$body_id][$color_id]['composition'];
					$construction = $stripe_arr2[$body_id][$color_id]['construction'];
					$gsm_weight = $stripe_arr2[$body_id][$color_id]['gsm_weight'];
					$color_type_id = $stripe_arr2[$body_id][$color_id]['color_type_id'];
					$dia_width = $stripe_arr2[$body_id][$color_id]['dia_width'];


			?>
					<tr>
						<?
						//$color_qty=$stripe_arr2[$body_id][$color_id]['fabreqtotkg'];//$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
						$color_qty = array_sum($stripe_arr[$body_id][$color_id]['fabreqtotkg']);
						?>
						<td rowspan="<? echo $rowspan; ?>"> <? echo $i; ?></td>
						<td rowspan="<? echo $rowspan; ?>"> <? echo $body_part[$body_id]; ?></td>
						<td rowspan="<? echo $rowspan; ?>"> <? echo $color_name_arr[$color_id]; ?></td>
						<td rowspan="<? echo $rowspan; ?>" align="right"> <? echo number_format($color_qty, 2); ?></td>
						<?
						$total_fab_qty += $color_qty;
						foreach ($color_val['stripe_color'] as $strip_color_id => $s_color_val) {
							$measurement = $color_val['measurement'][$strip_color_id];
							$uom = $color_val['uom'][$strip_color_id];
							$fabreqtotkg = $color_val['fabreqtotkg'][$strip_color_id];
							$rate = $color_val['rate'][$strip_color_id];
							$unit_charge = $color_val['unit_charge'][$strip_color_id];
							$yarn_dyed = $color_val['yarn_dyed'][$strip_color_id];
						?>
							<td><? echo  $color_name_arr[$s_color_val]; ?></td>
							<td align="right"> <? echo  number_format($measurement, 2); ?></td>
							<td> <? echo  $unit_of_measurement[$uom]; ?></td>
							<td align="right"> <? echo  number_format($fabreqtotkg, 2); ?></td>
							<td align="right"> <? echo  number_format($unit_charge, 2); ?></td>
							<td align="right"> <? echo number_format($fabreqtotkg * $unit_charge, 2); ?></td>
					</tr>
		<?
							$total_fabreqtotkg += $fabreqtotkg;
							$total_fabamount += $fabreqtotkg * $unit_charge;;
							$total_rate += $rate;
							$rows += 1;
						}
						$i++;
					}
				}
		?>
		<tfoot>
			<tr>
				<td colspan="3">Total </td>
				<td align="right"> <? echo  number_format($total_fab_qty, 2); ?> </td>
				<td></td>
				<td></td>
				<td> </td>
				<td align="right"><? echo  number_format($total_fabreqtotkg, 2); ?> </td>
				<td align="right"></td>
				<td align="right"><? echo  number_format($total_fabamount, 2); ?></td>
			</tr>
		</tfoot>
		</table>
		<?


		//start	Trims Cost part report here -------------------------------------------
		$supplier_library_fabric = return_library_array("select a.id, a.supplier_name from lib_supplier a where a.is_deleted=0  and a.status_active=1 group by a.id,a.supplier_name order by a.supplier_name", "id", "supplier_name");

		$sql = "select id, job_no, trim_group,description,brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp_multi, status_active from wo_pre_cost_trim_cost_dtls  where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
		$data_array = sql_select($sql);
		?>
		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px;text-align:center;font-family: 'Arial Narrow', Arial, sans-serif;" rules="all">

				<label style="float:left;background:#CCCCCC; font-size:larger"><b>Trims Details</b> </label>
				<tr style="font-weight:bold; background: #D7ECD9">
					<td width="110" style="background: #D7ECD9">Item Group</td>
					<td width="110" style="background: #D7ECD9">Item Description</td>
					<td width="100" style="background: #D7ECD9">Supplier</td>
					<td width="60" style="background: #D7ECD9">UOM</td>
					<td width="80" style="background: #D7ECD9">Cons/<?= $costing_for; ?>[Qnty]</td>
					<td width="100" style="background: #D7ECD9">TTL Required[Qnty]</td>
					<td width="80" style="background: #D7ECD9">Rate &#36;</td>
					<td width="80" style="background: #D7ECD9">Amount/<?= $costing_for; ?>&#36;</td>
					<td width="80" style="background: yellow">Amount &#36;</td>
					<td width="60" style="background: #D7ECD9">% to Ord. Value</td>
				</tr>
				<?
				$trim_qty_arr = $trims->getQtyArray_by_precostdtlsid();
				//print_r($trim_qty);
				$trim_amount_arr = $trims->getAmountArray_precostdtlsid();
				$total_trims_cost = 0;
				$total_trims_qty = $total_trims_cost_dzn = 0;
				$total_trims_cost_dzn = 0;
				$total_trims_cost_kg = 0;
				foreach ($data_array as $row) {

					$trim_group = return_library_array("select item_name,id from  lib_item_group where id=" . $row[csf("trim_group")], "id", "item_name");
					$cons_dzn_gmts = $row[csf("cons_dzn_gmts")];
					$amount_dzn = $row[csf("amount")];
					$pre_trims_qty = $trim_qty_arr[$row[csf("id")]];
					$pre_trims_amount = $trim_amount_arr[$row[csf("id")]];

					$nominated_supp_str = "";
					$exsupp = explode("_", $row[csf("nominated_supp_multi")]);
					foreach ($exsupp as $sid) {
						if ($nominated_supp_str == "") $nominated_supp_str = $supplier_library_fabric[$sid];
						else $nominated_supp_str .= ',' . $supplier_library_fabric[$sid];
					}
				?>
					<tr>
						<td align="left"><? echo $trim_group[$row[csf("trim_group")]]; ?></td>
						<td align="left"><? echo $row[csf("description")]; ?></td>
						<td align="left"><?= $nominated_supp_str; ?></td>
						<td align="center"><? echo $unit_of_measurement[$row[csf("cons_uom")]]; ?></td>
						<td align="right"><? echo fn_number_format($cons_dzn_gmts, 3); ?></td>
						<td align="right"><? echo fn_number_format($pre_trims_qty, 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("rate")], 3); ?></td>
						<td align="right"><? echo fn_number_format($amount_dzn, 4); ?></td>
						<td align="right" style="background: yellow"><? echo fn_number_format($pre_trims_amount, 2); ?></td>
						<td align="right" title="<? echo $amount_dzn . '=' . $price_dzn; ?>">
							<?
							$cv = ($amount_dzn / $price_dzn) * 100;
							if (is_infinite($cv) || is_nan($cv)) {
								$cv = 0;
							}
							echo fn_number_format($cv, 2);
							//echo fn_number_format(($amount_dzn/$price_dzn)*100,2); 
							?></td>
					</tr>
				<?
					$total_trims_cost += $pre_trims_amount;
					$total_trims_cost_dzn += $amount_dzn;
					$total_trims_qty += $pre_trims_qty;
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td>Trims Total</td>
					<td colspan="4"></td>
					<td align="right"><? if ($total_trims_qty > 0) {
											echo fn_number_format($total_trims_qty, 4);
										} ?></td>
					<td align="right"><? //echo fn_number_format($total_trims_cost_dzn,4); 
										?></td>

					<td align="right"><? if ($total_trims_cost_dzn > 0) {
											echo '&dollar;' . fn_number_format($total_trims_cost_dzn, 4);
										} ?></td>
					<td align="right" style="background: yellow"><? if ($total_trims_cost > 0) {
																		echo '&dollar;' . fn_number_format($total_trims_cost, 2);
																	} ?></td>
					<td align="right" title="<? echo $total_trims_cost_dzn . '=' . $price_dzn; ?>">
						<?
						$cv = ($total_trims_cost_dzn / $price_dzn) * 100;
						if (is_infinite($cv) || is_nan($cv)) {
							$cv = 0;
						}
						if ($cv) {
							echo fn_number_format($cv, 2) . ' %';
						}
						?>
					</td>
				</tr>
			</table>
		</div>
		<?
		$pre_cost_dtls_arr = sql_select("SELECT id, job_no, costing_per_id, order_uom_id, fabric_cost, fabric_cost_percent, trims_cost,depr_amor_pre_cost,deffdlc_cost,studio_cost,design_cost,trims_cost_percent,embel_cost,embel_cost_percent,comm_cost,comm_cost_percent,commission,incometax_cost,interest_cost,interest_percent,commission_percent,lab_test,lab_test_percent,inspection,inspection_percent,cm_cost,cm_cost_percent,freight,freight_percent,common_oh,common_oh_percent,design_percent, studio_percent, currier_pre_cost, currier_percent, certificate_pre_cost, certificate_percent, total_cost, total_cost_percent, price_dzn, price_dzn_percent, margin_dzn, margin_dzn_percent, price_pcs_or_set, price_pcs_or_set_percent, margin_pcs_set, margin_pcs_set_percent, cm_for_sipment_sche from wo_pre_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0");
		foreach ($pre_cost_dtls_arr as $row) {
			$price_dzn = $row[csf("price_dzn")];
			$lab_test_dzn = $row[csf("lab_test")];
			$commission_cost_dzn = $row[csf("commission")];
			$commercial_cost_dzn = $row[csf("comm_cost")];

			$inspection_dzn = $row[csf("inspection")];
			$cm_cost_dzn = $row[csf("cm_cost")];
			$common_oh_dzn = $row[csf("common_oh")];
			$freight_dzn = $row[csf("freight")];
			$currier_pre_cost_dzn = $row[csf("currier_pre_cost")];
			$currier_per_cost_dzn = $row[csf("currier_percent")];
			$certificate_pre_cost_dzn = $row[csf("certificate_pre_cost")];
			$deffdlc_cost_dzn = $row[csf("deffdlc_cost")];
			$depr_amor_pre_cost_dzn = $row[csf("depr_amor_pre_cost")];
			$interest_cost_dzn = $row[csf("interest_cost")];
			$interest_cost_percent = $row[csf("interest_percent")];
			$incometax_cost_dzn = $row[csf("incometax_cost")];
			$studio_cost_dzn = $row[csf("studio_cost")];
			$design_cost_dzn = $row[csf("design_cost")];
			$studio_cost_percent = $row[csf("studio_percent")];
			$design_cost_percent = $row[csf("design_percent")];

			$other_cost_per = $inspection_dzn + $freight_dzn + $certificate_pre_cost_dzn + $deffdlc_cost_dzn + $design_cost_dzn + $studio_cost_dzn + $common_oh_dzn + $interest_cost_dzn + $incometax_cost_dzn + $depr_amor_pre_cost_dzn;
		}
		?>
		<table class="rpt_table" border="1" align="left" cellpadding="0" width="350" cellspacing="0" rules="all" style="margin-top: 10px;font-family: 'Arial Narrow', Arial, sans-serif;">
			<tr style="background: #D7ECD9">
				<th>MISC/Others Cost</th>
				<th>%</th>
				<th>TTL Cost $</th>
			</tr>
			<tr>
				<td>Test cost</td>
				<td align="right"><?
									$lab_test_per = ($other_costing_arr[$job_no]['lab_test'] / $order_values) * 100;
									if (is_infinite($lab_test_per) || is_nan($lab_test_per)) {
										$lab_test_per = 0;
									}
									if ($lab_test_per > 0) {
										echo fn_number_format($lab_test_per, 2);
									}
									$total_misc_per += $lab_test_per;
									?></td>
				<th align="right"><? if ($other_costing_arr[$job_no]['lab_test'] > 0) {
										echo fn_number_format($other_costing_arr[$job_no]['lab_test'], 2);
									} ?></th>
			</tr>
			<tr>
				<td>Buying commission</td>
				<td align="right"><?
									$commission_cost_per = ($commission_costing_arr[$job_no] / $order_values) * 100;
									if (is_infinite($commission_cost_per) || is_nan($commission_cost_per)) {
										$commission_cost_per = 0;
									}
									if ($commission_cost_per > 0) {
										echo fn_number_format($commission_cost_per, 2);
									}
									$total_misc_per += $commission_cost_per;
									?></td>
				<th align="right"><? if ($commission_costing_arr[$job_no] > 0) {
										echo fn_number_format($commission_costing_arr[$job_no], 2);
									} ?></th>
			</tr>
			<tr>
				<td>Commercial cost</td>
				<td align="right"><?
									$commercial_cost_per = ($commercial_costing_arr[$job_no] / $order_values) * 100;
									if (is_infinite($commercial_cost_per) || is_nan($commercial_cost_per)) {
										$commercial_cost_per = 0;
									}
									if ($commercial_cost_per > 0) {
										echo fn_number_format($commercial_cost_per, 2);
									}
									$total_misc_per += $commercial_cost_per;
									?>
				</td>
				<th align="right"><? if ($commercial_costing_arr[$job_no] > 0) {
										echo fn_number_format($commercial_costing_arr[$job_no], 2);
									} ?></th>
			</tr>
			<tr>
				<td>Courier costs</td>
				<td align="right"><?
									$currier_pre_cost_dzn = $currier_pre_cost_dzn * ($order_job_qnty / 12);
									// $currier_pre_cost_dzn=($currier_pre_cost_dzn/$order_values)*100;
									if (is_infinite($currier_per_cost_dzn) || is_nan($currier_per_cost_dzn)) {
										$currier_per_cost_dzn = 0;
									}
									if ($currier_per_cost_dzn > 0) {
										echo fn_number_format($currier_per_cost_dzn, 2);
									}
									$total_misc_per += $currier_per_cost_dzn;

									?>
				</td>
				<th align="right"><? if ($currier_pre_cost_dzn > 0) {
										echo fn_number_format($currier_pre_cost_dzn, 2);
									} ?></th>
			</tr>
			<tr>
				<td>Other costs</td>
				<td align="right"><?
									$other_cost_per = ($total_other_cost / $order_values) * 100;
									if (is_infinite($other_cost_per) || is_nan($other_cost_per)) {
										$other_cost_per = 0;
									}
									if ($other_cost_per > 0) {
										echo fn_number_format($other_cost_per, 2);
									}
									$total_misc_per += $other_cost_per;
									?>
				</td>
				<th align="right"><? if ($total_other_cost > 0) {
										echo fn_number_format($total_other_cost, 2);
									} ?></th>
			</tr>
			<tr>
				<th>MISC/Others Cost Sub Total</th>
				<th align="right"><? if ($total_misc_per > 0) {
										echo fn_number_format($total_misc_per, 2) . '%';
									}  ?></th>
				<th align="right"><? if ($misc_cost > 0) {
										echo '&dollar;' . fn_number_format($misc_cost, 2);
									} ?></th>
			</tr>
		</table>
		<br /><br />
		<div>

			<br />
			<?  //echo signature_table(109, $cbo_company_name, "970px");
			?>
			<?
			$width = 990;
			$padding_top = 70;
			$prepared_by = '';
			$sql = sql_select("select designation,name,activities,prepared_by from variable_settings_signature where report_id=109 and company_id=$cbo_company_name order by sequence_no");


			if ($sql[0][csf("prepared_by")] == 1) {
				list($prepared_by, $activities) = explode('**', $prepared_by);
				$sql_2[100] = array(DESIGNATION => 'Prepared By', NAME => $prepared_by, ACTIVITIES => $activities, PREPARED_BY => 0);
				$sql = $sql_2 + $sql;
			}

			$count = count($sql);
			$td_width = floor($width / $count);
			$standard_width = $count * 120;
			if ($standard_width > $width) {
				$td_width = 120;
			}
			$no_coloumn_per_tr = floor($width / $td_width);
			$i = 1;
			if ($count == 0) {
				$message = "<b>Note: This is Software Generated Copy , Signature is not Required.</b>";
			}
			echo '<table id="signatureTblId" width="' . $width . '" style="padding-top:' . $padding_top . 'px;"><tr><td width="100%" height="' . $padding_top . '" colspan="' . $count . '">' . $message . '</td></tr><tr>';
			foreach ($sql as $row) {
				echo '<td width="' . $td_width . '" align="center" valign="top">
		<strong>' . $row[csf("activities")] . '</strong><br>
		<strong style="text-decoration:overline">' . $row[csf("designation")] . "</strong><br>" . $row[csf("name")] . '</td>';
				if ($i % $no_coloumn_per_tr == 0) {
					echo '</tr><tr><td width="100%" height="70" colspan="' . $no_coloumn_per_tr . '"></td></tr>';
				}
				$i++;
			}
			echo '</tr></table>';
			?>
		</div>
	<?
	disconnect($con);
	exit();
}

if ($action == "budgetsheet4") // md mamun/ crm-5038/28-02-2023 // --Issue-7709 For Axix
{
	///extract($_REQUEST);
	$process = array(&$_POST);
	extract(check_magic_quote_gpc($process));
	$txt_costing_date = change_date_format(str_replace("'", "", $txt_costing_date), 'yyyy-mm-dd', '-');
	if ($txt_job_no == "") $job_no = '';
	else $job_no = " and a.job_no=" . $txt_job_no . "";
	if ($cbo_company_name == "") $company_name = '';
	else $company_name = " and a.company_name=" . $cbo_company_name . "";
	if ($cbo_buyer_name == "") $cbo_buyer_name = '';
	else $cbo_buyer_name = " and a.buyer_name=" . $cbo_buyer_name . "";
	if ($txt_style_ref == "") $txt_style_ref = '';
	else $txt_style_ref = " and a.style_ref_no=" . $txt_style_ref . "";
	if ($txt_costing_date == "") $txt_costing_date = '';
	else $txt_costing_date = " and c.costing_date='" . $txt_costing_date . "'";
	$txt_po_breack_down_id = str_replace("'", '', $txt_po_breack_down_id);
	if (str_replace("'", '', $txt_po_breack_down_id) == "") {
		$txt_po_breack_down_id_cond = '';
		$txt_po_breack_down_id_cond1 = '';
		$txt_po_breack_down_id_cond2 = '';
		$txt_po_breack_down_id_cond3 = '';
	} else {
		$txt_po_breack_down_id_cond = " and b.id in(" . $txt_po_breack_down_id . ")";
		$txt_po_breack_down_id_cond1 = " and id in(" . $txt_po_breack_down_id . ")";
		$txt_po_breack_down_id_cond2 = " and po_break_down_id in(" . $txt_po_breack_down_id . ")";
		$txt_po_breack_down_id_cond3 = " and b.id in(" . $txt_po_breack_down_id . ")";
	}

	//array for display name
	$buyer_arr = return_library_array("select id, buyer_name from lib_buyer", 'id', 'buyer_name');
	$sesson_arr = return_library_array("select id, season_name from lib_buyer_season", 'id', 'season_name');
	$brand_arr = return_library_array("select id, brand_name from lib_buyer_brand", 'id', 'brand_name');
	$comp = return_library_array("select id, company_name from lib_company", 'id', 'company_name');
	$color_library = return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$fabric_composition_arr = return_library_array("select id, fabric_composition_name from lib_fabric_composition", 'id', 'fabric_composition_name');
	$photo_data_array = sql_select("SELECT id,master_tble_id,image_location from common_photo_library where master_tble_id=$txt_job_no and file_type=1  and rownum=1");

	if ($db_type == 0) $group_gsm = "group_concat( distinct b.gsm_weight) AS gsm_weight";
	if ($db_type == 2) $group_gsm = "listagg(b.gsm_weight ,',') within group (order by b.gsm_weight) AS gsm_weight";

	$gsm_weight_top = return_field_value("$group_gsm", "lib_body_part a,wo_pre_cost_fabric_cost_dtls b", "a.id=b.body_part_id and b.job_no=$txt_job_no and b.status_active=1 and b.is_deleted=0 and a.body_part_type in(1,20)", "gsm_weight");
	$gmtsitem_ratio_array = array();
	$grmnt_items = "";
	$grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no=$txt_job_no");
	foreach ($grmts_sql as $key => $val) {
		$grmnt_items .= $garments_item[$val[csf("gmts_item_id")]] . ",";
		$gmtsitem_ratio_array[$val[csf('job_no')]][$val[csf('gmts_item_id')]] = $val[csf('set_item_ratio')];
		$set_item_ratio += $val[csf('set_item_ratio')];
	}
	$grmnt_items = rtrim($grmnt_items, ",");


	$sql = "SELECT a.job_no,a.company_name, a.buyer_name,a.ship_mode,a.total_set_qnty,a.style_ref_no, a.gmts_item_id,a.order_uom, a.avg_unit_price, a.product_dept, a.season_buyer_wise, a.brand_id, a.style_description, a.job_quantity as job_qty, sum(b.plan_cut) as job_quantity, sum(b.po_quantity) as ord_qty, listagg(cast(b.sc_lc as varchar2(4000)),',') within group (order by b.sc_lc) as sc_lc, c.costing_per,c.costing_date,c.budget_minute,c.approved,a.quotation_id,c.exchange_rate ,c.incoterm,c.sew_effi_percent, c.remarks,c.sew_smv, c.refusing_cause, d.fab_knit_fin_req_kg, d.fab_knit_req_kg, d.fab_woven_req_yds,d.fab_woven_fin_req_yds, d.fab_yarn_req_kg
		from wo_po_details_master a, wo_po_break_down b,wo_pre_cost_mst c left join  wo_pre_cost_sum_dtls d on  c.job_no=d.job_no and d.status_active=1 and d.is_deleted=0
		where a.job_no=b.job_no_mst and b.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted =0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $job_no $txt_po_breack_down_id_cond $company_name $cbo_buyer_name $txt_style_ref group by a.job_no,a.company_name, a.buyer_name,a.style_ref_no, a.gmts_item_id,a.order_uom,a.ship_mode, a.avg_unit_price, a.product_dept, c.incoterm,c.costing_date,c.exchange_rate ,a.quotation_id,c.costing_per,c.sew_effi_percent,c.approved,c.budget_minute, d.fab_knit_req_kg, d.fab_woven_req_yds,d.fab_knit_fin_req_kg,d.fab_woven_fin_req_yds, d.fab_yarn_req_kg,a.job_quantity,a.season_buyer_wise, a.brand_id, a.total_set_qnty,a.style_description, c.remarks, c.refusing_cause,c.sew_smv order by a.job_no"; //a.job_quantity as job_quantity,

	$data_array = sql_select($sql);
	$plan_cut_qty = $data_array[0][csf('job_quantity')];
	$total_set_qnty = $data_array[0][csf('total_set_qnty')];
	$job_qnty = $data_array[0][csf('job_qty')];
	$exchange_rate = $data_array[0][csf('exchange_rate')];
	$is_approved = $data_array[0][csf('approved')];
	//----------------------------------sc lc no--------------------------------------------//
	$sql_lc_sc_po="select a.job_no,a.location_name, a.total_set_qnty, b.id, b.po_number, b.grouping, b.file_no, b.pub_shipment_date  from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst $job_no $txt_po_breack_down_id_cond $company_name $cbo_buyer_name $txt_style_ref and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by b.id";

	$sql_po_data=sql_select($sql_lc_sc_po);
	foreach($sql_po_data as $sql_po_row)
	{
		$po_id_arr[$sql_po_row[csf('id')]]=$sql_po_row[csf('id')];
	}
	$job_in_orders=implode(", ",array_unique(explode(",",substr(trim($job_in_orders),0,-1))));
	$po_id_str= implode( ",",$po_id_arr);

	$sales_contract_sql = sql_select("SELECT a.contract_no,b.wo_po_break_down_id from com_sales_contract a join com_sales_contract_order_info b on a.id=b.com_sales_contract_id where a.status_active=1 and a.is_deleted=0 and b.status_active in(1,7)  and b.wo_po_break_down_id in ($po_id_str) group by a.contract_no, b.wo_po_break_down_id");
	$sales_contract_arr = array();
	if (count($sales_contract_sql) > 0) {
		foreach ($sales_contract_sql as $key => $row) {
			$sales_contract_arr[$row[csf('wo_po_break_down_id')]] = $row[csf('contract_no')];
		}
	}

	$export_lc_sql = sql_select("SELECT a.export_lc_no,b.wo_po_break_down_id from com_export_lc a join com_export_lc_order_info b on a.id=b.com_export_lc_id where a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.wo_po_break_down_id in ($po_id_str) group by a.export_lc_no,b.wo_po_break_down_id");
	$export_lc_arr = array();
	if (count($export_lc_sql) > 0) {
		foreach ($export_lc_sql as $key => $row) {
			$export_lc_arr[$row[csf('wo_po_break_down_id')]] = $row[csf('export_lc_no')];
		}
	}
	$sc_lc_no = "";
	if (count($sales_contract_arr) > 0) {
		$sc_lc_no = implode(",", $sales_contract_arr);
	}
		$sc_lc_no=rtrim($sc_lc_no,',');
		$sc_lc_no=implode(",",array_unique(explode(",",$sc_lc_no)));
	 if (count($export_lc_arr) > 0) {
	 	$lc_sc_no = implode(",", $export_lc_arr);
	 }
	 	$lc_sc_no=rtrim($lc_sc_no,',');
		$lc_sc_no=implode(",",array_unique(explode(",",$lc_sc_no)));
		//----------------------------------sc lc no end --------------------------------------------//
	$preCost_histry = sql_select("SELECT min(a.sew_smv) as sew_smv,min(a.sew_effi_percent) as sew_effi_percent,min(b.margin_dzn_percent) as margin_dzn_percent ,min(b.fabric_cost_percent) as  fabric_cost_percent,min(b.trims_cost_percent ) as trims_cost_percent,min(b.embel_cost_percent) as embel_cost_percent,min(b.wash_cost_percent) as wash_cost_percent ,min(b.comm_cost_percent) as comm_cost_percent ,min(b.commission_percent) as commission_percent,min(b.lab_test_percent) as lab_test_percent,min(b.inspection_percent) as inspection_percent,min(b.cm_cost_percent) as cm_cost_percent,min(b.cm_cost) as cm_cost,min(b.freight_percent) as freight_percent,min(b.currier_percent) as currier_percent,min(b.certificate_percent) as certificate_percent,min(b.common_oh_percent) as common_oh_percent    from  wo_pre_cost_mst_histry a,wo_pre_cost_dtls_histry b where a.job_no=b.job_no and a.job_no=$txt_job_no");

	list($preCost_histry_row) = $preCost_histry;
	$opert_profitloss_percent = $preCost_histry_row[csf('margin_dzn_percent')];
	$fabric_cost_percent = $preCost_histry_row[csf('fabric_cost_percent')];
	$trims_cost_percent = $preCost_histry_row[csf('trims_cost_percent')];
	$embel_cost_percent = $preCost_histry_row[csf('embel_cost_percent')];
	$wash_cost_percent = $preCost_histry_row[csf('wash_cost_percent')];
	$comm_cost_percent = $preCost_histry_row[csf('comm_cost_percent')];
	$commission_percent = $preCost_histry_row[csf('commission_percent')];
	$common_oh_percent = $preCost_histry_row[csf('common_oh_percent')];

	$lab_test_percent = $preCost_histry_row[csf('lab_test_percent')];
	$inspection_percent = $preCost_histry_row[csf('inspection_percent')];
	$cm_cost_percent = $preCost_histry_row[csf('cm_cost_percent')];

	$freight_percent = $preCost_histry_row[csf('freight_percent')];
	$currier_percent = $preCost_histry_row[csf('currier_percent')];
	$certificate_percent = $preCost_histry_row[csf('certificate_percent')];
	//$currier_percent=$preCost_histry_row[csf('currier_percent')];
	$sew_effi_percent = $data_array[0][csf('sew_effi_percent')]; //
	$hissew_effi_percent = $preCost_histry_row[csf('sew_effi_percent')];
	//$sew_smv=$preCost_histry_row[csf('sew_smv')];
	$first_app_date = "";
	$last_app_date = "";
	$revised_no = 0;
	$preCost_approved = sql_select("SELECT max(b.approved_no) as approved_no, min(b.approved_date) as first_app_date, max(b.approved_date) as last_app_date,a.id from wo_pre_cost_mst a, approval_history b where   a.id=b.mst_id and a.job_no=$txt_job_no and b.entry_form=15 group by a.id");
	if (count($preCost_approved) > 0) {
		foreach ($preCost_approved as $preCost_approved_row) {
			$approved_no_row = $preCost_approved_row[csf('approved_no')];
			$fst_date = $preCost_approved_row[csf('first_app_date')];
			$fstapp_date = $fst_date[0];

			$last_date = $preCost_approved_row[csf('last_app_date')];
			$lstapp_date = $last_date[0];
			$precost_id = $preCost_approved_row[csf('id')];
			//if($approved_no_row>1){
			$revised_no = $approved_no_row - 1;
			//}
		}
	}

	//$img_path = (str_replace("'", "", $img_path))? str_replace("'", "", $img_path):'../../';
	$img_path = (str_replace("'", "", $path)) ? str_replace("'", "", $path) : '../';

	//echo $img_path;


	$costing_date = $data_array[0][csf('costing_date')];
	if (is_infinite($costing_date) || is_nan($costing_date)) {
		$costing_date = 0;
	}

	$pre_cost_dtls = "SELECT id,job_no,costing_per_id,order_uom_id,fabric_cost,fabric_cost_percent,trims_cost,trims_cost_percent,embel_cost,embel_cost_percent,comm_cost,comm_cost_percent,commission,commission_percent,lab_test,lab_test_percent,inspection,inspection_percent,cm_cost,cm_cost_percent,freight,freight_percent,common_oh,common_oh_percent,total_cost,total_cost_percent,price_dzn,price_dzn_percent,margin_dzn,margin_dzn_percent,price_pcs_or_set,price_pcs_or_set_percent,margin_pcs_set,margin_pcs_set_percent,cm_for_sipment_sche from wo_pre_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$pre_cost_dtls_arr = sql_select($pre_cost_dtls);
	foreach ($pre_cost_dtls_arr as $row) {
		$total_cost = $row[csf("total_cost")];
		$price_dzn = $row[csf("price_dzn")];
		$cm_cost = $row[csf("cm_cost")];
		$embel_cost_dzn = $row[csf("embel_cost")];
	}
	$approval_allow = sql_select("select b.id, b.page_id, b.approval_need, b.allow_partial, b.validate_page,a.setup_date from approval_setup_mst a,approval_setup_dtls b 
			where a.id=b.mst_id and a.company_id=$cbo_company_name and a.status_active=1 and b.page_id=25 and b.status_active=1 and b.is_deleted=0 order by b.id desc ");
	?>
		<div style="width:972px; margin:0 auto; font-family: 'Arial Narrow', Arial, sans-serif;">

			<div style="width:970px; font-size:20px; font-weight:bold">

				<b style="float: left"><? echo $comp[str_replace("'", "", $cbo_company_name)]; ?><br>Budget Sheet</b>
				<? if ($is_approved == 1) { ?> <b style="left: 50%; margin-left: 240px; color: green;"> This Budget is Approved </b> <? } elseif ($is_approved == 3) {
				if ($approval_allow[0][csf("approval_need")] == 1 && $approval_allow[0][csf("allow_partial")] == 1) {
					$ap_msg = "<b style='left: 50%; margin-left: 240px; color: green;'>This Budget is Approved </b>";
				} else {
					$ap_msg = "<b style='left: 50%; margin-left: 240px; color: green;'>This Budget is Partially Approved </b>";
				}
				echo $ap_msg;
				} else { ?><b style="left: 50%; margin-left: 240px; color: red;">
				This Budget is Not Approved

					</b> <? } ?>
				<b style="float:right;"> <? echo 'Budget Date: '; ?><? echo  date('d-M-y', strtotime($costing_date)); ?> <br><? echo 'Revised No:' . $revised_no; ?> <br><? //echo 'Last Revised Date:'.date('d-M-y',strtotime($last_date)); 
																																											?> </b>
			</div>

			<div style="width:970px; font-size:18px; font-weight:bold">
				<b style="float: left"></b>
				<b style="float:right; font-size:18px; font-weight:bold"> &nbsp; </b>
			</div>

			<?
			$result = sql_select("SELECT id,po_number,pub_shipment_date,grouping,file_no,excess_cut,po_received_date, plan_cut from wo_po_break_down where job_no_mst=$txt_job_no $txt_po_breack_down_id_cond1 and status_active=1 and is_deleted=0 order by po_received_date DESC");
			$job_in_orders = '';
			$public_ship_date = '';
			$job_in_ref = '';
			$job_in_file = '';
			$tot_excess_cut = 0;
			$tot_row = 0;
			foreach ($result as $val) {
				$job_in_orders .= $val[csf('po_number')] . ", ";
				$public_ship_date = $val[csf('pub_shipment_date')];
				$po_received_date = $val[csf('po_received_date')];
				$job_in_ref .= $val[csf('grouping')] . ",";
				$job_in_file .= $val[csf('file_no')] . ",";
				$txt_order_no_arr[$val[csf('id')]] = $val[csf('id')];
				if ($val[csf('excess_cut')] > 0) {
					$tot_row++;
				}
				$tot_excess_cut += $val[csf('excess_cut')];
				$plancutqty += $val[csf('plan_cut')];
			}
			$txt_order_no_id = implode(",", $txt_order_no_arr);
			$job_ref = array_unique(explode(",", rtrim($job_in_ref, ", ")));
			$job_file = array_unique(explode(",", rtrim($job_in_file, ", ")));

			foreach ($job_ref as $ref) {
				$ref_cond .= ", " . $ref;
			}
			$file_con = '';
			foreach ($job_file as $file) {
				if ($file_con == '') $file_cond = $file;
				else $file_cond .= ", " . $file;
			}

			foreach ($data_array as $row) {
				$order_price_per_dzn = 0;
				$order_job_qnty = 0;
				$ord_qty = 0;
				$avg_unit_price = 0;
				$uom = $row[csf("order_uom")];
				$sew_smv = $row[csf("sew_smv")];
				$order_values = $row[csf("job_qty")] * $row[csf("avg_unit_price")];

				$job_in_orders = substr(trim($job_in_orders), 0, -1);
				if ($row[csf("costing_per")] == 1) {
					$order_price_per_dzn = 12;
					$costing_for = "1 DZN";
				} else if ($row[csf("costing_per")] == 2) {
					$order_price_per_dzn = 1;
					$costing_for = "1 PCS";
				} else if ($row[csf("costing_per")] == 3) {
					$order_price_per_dzn = 24;
					$costing_for = "2 DZN";
				} else if ($row[csf("costing_per")] == 4) {
					$order_price_per_dzn = 36;
					$costing_for = "3 DZN";
				} else if ($row[csf("costing_per")] == 5) {
					$order_price_per_dzn = 48;
					$costing_for = "4 DZN";
				} else {
					$order_price_per_dzn = 0;
					$costing_for = "DZN";
				}
				$order_job_qnty = $row[csf("job_qty")];
				//$order_qty = $row[csf("job_qty")]*$set_item_ratio;
				$po_no = str_replace("'", "", $txt_po_breack_down_id);
				$condition = new condition();
				if (str_replace("'", "", $txt_job_no) != '') {
					$condition->job_no("=$txt_job_no");
				}

				if (str_replace("'", "", $txt_po_breack_down_id) != '') {
					$condition->po_id("in($po_no)");
				}
				$condition->init();
				$fabric = new fabric($condition);
				$yarn = new yarn($condition);
				$yarn_costing_arr = $yarn->getJobWiseYarnAmountArray();
				$yarn_qty_amount_arr = $yarn->getJobWiseYarnQtyAndAmountArray();

				$yarnDataWithFabricidArr = $yarn->get_By_Precostfabricdtlsid_YarnQtyAmountArray();

				$fabric = new fabric($condition);
				$fabricAmoutByFabricSource = $fabric->getAmountArray_by_job_knitAndwoven_greyAndfinish();
				$fabricQtyByFabricSource = $fabric->getQtyArray_by_job_knitAndwoven_greyAndfinish_purchase();

				$fabric_qty_arr = $fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
				$fabric_amount_arr = $fabric->getAmountArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
				$conversion = new conversion($condition);
				//echo $conversion->getQuery(); die;
				$conversion_costing_arr_process = $conversion->getAmountArray_by_job();
				$conv_qty_job_process = $conversion->getQtyArray_by_jobAndProcess();
				$conv_amount_job_process = $conversion->getAmountArray_by_jobAndProcess();
				$con_qty_fabric_process = $conversion->getQtyArray_by_fabricAndProcess();
				$con_amount_fabric_process = $conversion->getAmountArray_by_fabricAndProcess();

				$trims = new trims($condition);
				$trims_costing_arr = $trims->getAmountArray_by_job();
				$trims_qty_arr = $trims->getQtyArray_by_job();

				$emblishment = new emblishment($condition);
				$emblishment_costing_arr = $emblishment->getAmountArray_by_job();
				$emb_qty_job_name_arr = $emblishment->getQtyArray_by_jobAndEmbname();
				$emb_amount_job_name_arr = $emblishment->getAmountArray_by_jobAndEmbname();

				$wash = new wash($condition);
				$emblishment_costing_arr_wash = $wash->getAmountArray_by_job();
				$wash_qty_job_name_arr = $wash->getQtyArray_by_jobAndEmbname();
				$wash_amount_job_name_arr = $wash->getAmountArray_by_jobAndEmbname();


				$commercial = new commercial($condition);
				$commercial_costing_arr = $commercial->getAmountArray_by_job();
				$commission = new commision($condition);
				$commission_costing_arr = $commission->getAmountArray_by_job();
				$other = new other($condition);
				$other_costing_arr = $other->getAmountArray_by_job();
				/* echo '<pre>';
		print_r($con_amount_fabric_process); die; */
				$job_no = str_replace("'", "", $txt_job_no);
				// $finishing_arr = array('209','165','33','94','63','171','65','170','156','179','200','208','127','125','84','68','128','190','242','240','192','172','90','218','67','197','73','66','185','142','193','265');


				$finishing_arr = array(
					'2', '3', '4', '25', '26', '32', '33', '34', '36', '37', '38', '39', '40', '60', '61', '62', '63', '64', '65', '66', '67', '68', '69', '70', '71', '72', '73', '74', '75', '76', '77', '78', '79', '80', '81', '82', '83', '84', '85', '86', '87', '88', '89', '90', '91', '92', '93', '94', '100', '101', '120', '121', '122', '123', '124', '125', '127', '128', '129', '130', '131', '132', '133', '134', '135', '136', '137', '138', '139', '140', '141', '142', '143', '144', '145', '146', '147', '148', '149', '150', '151', '152', '153', '154', '155', '156', '157', '158', '159', '160', '161', '162', '163', '164', '165', '166', '167', '168', '169', '170', '171', '172', '173', '174', '175', '176', '177', '178', '179', '180', '181', '182', '183', '184', '185', '186', '187', '188', '189', '190', '191', '192', '193', '194', '195', '196', '197', '198', '199', '200', '201', '202', '203', '204', '205', '206', '207', '208', '209', '210', '211', '212', '213', '214', '215', '216', '217', '218', '219', '220', '221', '222', '223', '224', '225', '226', '227', '228', '229', '230', '231', '232', '233', '234', '235', '236', '237', '238', '239', '240', '241', '242', '243', '244', '245', '246', '247', '248', '249', '250', '251', '252', '253', '254', '255', '256', '257', '258', '259', '260', '261', '262', '263', '264', '265', '266', '267', '268', '269', '270', '271', '272', '273', '274', '275', '276', '277', '278', '279', '280', '281', '282', '283', '284', '285', '286', '287', '288', '289', '290', '291', '292', '293', '294', '295', '296', '297', '298', '299', '300', '303', '304', '305', '306', '307', '308', '309', '310', '311', '312', '313', '314', '315', '316', '317', '318', '319', '320', '321', '322', '323', '324', '325', '326', '327', '328', '329', '330', '331', '332', '333', '334', '335', '336', '337', '338', '339', '340', '341', '342', '343', '344', '345', '346', '347', '348', '349', '350', '351', '352', '353', '354', '355', '356', '357', '358', '359', '360', '361', '362', '363', '364', '365', '366', '367', '368', '369', '370', '371', '372', '373', '374', '375', '376', '377', '378', '379', '380', '381', '382', '383', '384', '385', '386', '387', '388', '389', '390', '391', '392', '393', '394', '395', '396', '397', '398', '399', '400', '401', '402', '403', '404', '405', '406', '407', '408', '409', '410', '411'
				);



				$total_finishing_amount = 0;
				$total_finishing_qty = 0;
				$other_cost_attr = array('inspection', 'freight', 'certificate_pre_cost', 'deffdlc_cost', 'design_cost', 'common_oh', 'interest_cost', 'incometax_cost', 'depr_amor_pre_cost');
				$total_other_cost = 0;

				foreach ($other_cost_attr as $attr) {
					$total_other_cost += $other_costing_arr[$job_no][$attr];
					$tot_sample_fabric_cost += $other_costing_arr[$job_no]['studio_cost'];
				}
				$misc_cost = $other_costing_arr[$job_no]['lab_test'] + $other_costing_arr[$job_no]['currier_pre_cost'] + $commercial_costing_arr[$job_no] + $commission_costing_arr[$job_no] + $total_other_cost;


				foreach ($finishing_arr as $fid) {

					$total_finishing_amount += array_sum($conv_amount_job_process[$job_no][$fid]);
					$total_finishing_qty += array_sum($conv_qty_job_process[$job_no][$fid]);
					//echo array_sum($conv_amount_job_process[$job_no][$fid]).'='.$fid.'<br>';
				}

				$total_fabic_cost = 0;
				if (count($conv_amount_job_process[$job_no][31]) > 0) {
					$total_fabic_cost += array_sum($conv_amount_job_process[$job_no][31]) / array_sum($conv_qty_job_process[$job_no][31]);
				}
				$total_fabric_amount += array_sum($conv_amount_job_process[$job_no][31]);
				$total_fabric_per += array_sum($conv_amount_job_process[$job_no][31]) / $order_values * 100;
				if (count($conv_amount_job_process[$job_no][30]) > 0) {
					$total_fabic_cost += array_sum($conv_amount_job_process[$job_no][30]) / array_sum($conv_qty_job_process[$job_no][30]);
				}
				if ($yarn_qty_amount_arr[$job_no]['amount'] != '') {
					$total_fabic_cost += $yarn_qty_amount_arr[$job_no]['amount'] / $yarn_qty_amount_arr[$job_no]['qty'];
				}
				$total_fabric_amount += $yarn_qty_amount_arr[$job_no]['amount'];
				$total_fabric_per += $yarn_qty_amount_arr[$job_no]['amount'] / $order_values * 100;
				if ($total_finishing_amount != 0) {
					$total_fabic_cost += $total_finishing_amount / $total_finishing_qty;
				}
				$total_fabric_amount += $total_finishing_amount;
				$total_fabric_per += $total_finishing_amount / $order_values * 100;
				$total_fabric_amount += array_sum($conv_amount_job_process[$job_no][30]);
				$total_fabric_per += array_sum($conv_amount_job_process[$job_no][30]) / $order_values * 100;
				if (count($conv_amount_job_process[$job_no][35]) > 0) {
					$total_fabic_cost += array_sum($conv_amount_job_process[$job_no][35]) / array_sum($conv_qty_job_process[$job_no][35]);
				}
				$total_fabric_amount += array_sum($conv_amount_job_process[$job_no][35]);
				$total_fabric_per += array_sum($conv_amount_job_process[$job_no][35]) / $order_values * 100;
				if (count($conv_amount_job_process[$job_no][1]) > 0) {
					$total_fabic_cost += array_sum($conv_amount_job_process[$job_no][1]) / array_sum($conv_qty_job_process[$job_no][1]);
				}
				$total_fabric_amount += array_sum($conv_amount_job_process[$job_no][1]);
				$total_fabric_per += array_sum($conv_amount_job_process[$job_no][1]) / $order_values * 100;

				$purchase_amount = array_sum($fabricAmoutByFabricSource['knit']['grey'][$job_no]) + array_sum($fabricAmoutByFabricSource['woven']['grey'][$job_no]);
				$purchase_qty = array_sum($fabricQtyByFabricSource['knit']['grey'][$job_no]) + array_sum($fabricQtyByFabricSource['woven']['grey'][$job_no]);

				$ather_emb_attr = array(4, 5, 6, 99);
				foreach ($ather_emb_attr as $att) {
					$others_emb_amount += $emb_amount_job_name_arr[$job_no][$att];
					$others_emb_qty += $emb_qty_job_name_arr[$job_no][$att];
				}
				$knitting_amount_summ = '';
				$dyeing_amount_summ = '';
				$yds_amount_summ = '';
				$aop_amount_summ = '';
				if (count($conv_amount_job_process[$job_no][1]) > 0) {
					// $knitting_amount_summ = fn_number_format(array_sum($conv_amount_job_process[$job_no][1]),2);
					$knitting_amount_summ = array_sum($conv_amount_job_process[$job_no][1]);
				}
				$yarn_amount_summ = $yarn_qty_amount_arr[$job_no]['amount'];
				$print_amount_summ = $emb_amount_job_name_arr[$job_no][1];
				$emb_amount_summ = $emb_amount_job_name_arr[$job_no][2];
				$wash_amount_summ = $wash_amount_job_name_arr[$job_no][3];
				if (count($conv_amount_job_process[$job_no][31]) > 0) {
					$dyeing_amount_summ =  array_sum($conv_amount_job_process[$job_no][31]);
				}
				if (count($conv_amount_job_process[$job_no][30]) > 0) {
					$yds_amount_summ = array_sum($conv_amount_job_process[$job_no][30]);
				}
				if (count($conv_amount_job_process[$job_no][35]) > 0) {
					$aop_amount_summ = array_sum($conv_amount_job_process[$job_no][35]);
				}
				/*echo '<pre>';
		print_r($conv_amount_job_process); die;*/

				$plan_per = (($plan_cut_qty - $job_qnty) / $job_qnty) * 100;
				$fcm = $cm_cost - ($cm_cost * $plan_per / 100);
				//	echo fn_number_format($fcm,4);
				$plan_dzn = $row[csf("job_qty")] * $set_item_ratio / 12;
				$fcm_cm_val = $plan_dzn * $cm_cost;

				//(($row[csf("job_qty")]*$set_item_ratio)/12)*$cm_cost

				$misc_cost += $other_costing_arr[$job_no]['studio_cost'];
				$total_budget_value = $yarn_amount_summ + $total_finishing_amount + $print_amount_summ + $trims_costing_arr[$job_no] + $yds_amount_summ + $aop_amount_summ + $emb_amount_summ + $knitting_amount_summ + $purchase_amount + $wash_amount_summ + $fcm_cm_val + $dyeing_amount_summ + $others_emb_amount + $misc_cost;



			?>
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px; font-family: 'Arial Narrow', Arial, sans-serif;" rules="all">

					<tr>
						<th rowspan="7">
							<? foreach ($photo_data_array as $inf) { ?>
								<?
								$image_location = return_field_value("image_location", "common_photo_library", "file_type=1 and form_name='company_details' and master_tble_id=$cbo_company_name", "image_location");
								?>

								<img src='<?= $img_path ?><? echo $inf[csf("image_location")]; ?>' height='100px' width='100px' />
							<? } ?>
						</th>
						<th style="background: #D7ECD9">Job No</th>
						<th><? echo $row[csf("job_no")]; ?></th>
						<th style="background: #D7ECD9">OR. Rcv Date</th>
						<th><? echo  date('d-M-y', strtotime($po_received_date)); ?></th>
						<th style="background: #D7ECD9">Order Quantity</th>
						<th style="background: yellow; color: #8B0000;">Price/Pcs</th>
						<th align="right" style="background: yellow; color: #8B0000;">&#36; <? echo $row[csf("avg_unit_price")]; ?> </th>
					</tr>
					<tr>
						<th style="background: #D7ECD9">Buyer</th>
						<th><? echo $buyer_arr[$row[csf("buyer_name")]]; ?></th>
						<th style="background: #D7ECD9">Ship. Date</th>
						<th><? echo  date('d-M-y', strtotime($public_ship_date)); ?></th>
						<th align="center" style="color: #8B0000"><? echo $row[csf("job_qty")]; ?> <? echo $unit_of_measurement[$row[csf("order_uom")]]; ?></th>
						<th style="background: yellow; color: #8B0000;">Order Value</th>
						<th align="right" style="background: yellow; color: #8B0000;">&#36; <?= number_format($order_values, 2);  ?></th>
					</tr>
					<tr>
						<th style="background: #D7ECD9">Prod. Dept</th>
						<th><? echo $product_dept[$row[csf("product_dept")]]; ?></th>
						<th style="background: #D7ECD9">Garments Item</th>
						<th>
							<?
							$grmnt_items = "";
							if ($garments_item[$row[csf("gmts_item_id")]] == "") {

								$grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no=$txt_job_no");
								foreach ($grmts_sql as $key => $val) {
									$grmnt_items .= $garments_item[$val[csf("gmts_item_id")]] . ", ";
									$gmts_item[] = $val[csf("gmts_item_id")];
								}
								$grmnt_items = substr_replace($grmnt_items, "", -1, 1);
							} else {
								$gmts_item = explode(',', $row[csf("gmts_item_id")]);
								$grmnt_items = $garments_item[$row[csf("gmts_item_id")]];
							}
							echo $grmnt_items;
							?>
						</th>
						<th align="center" style="color: #8B0000"><?= $row[csf("job_qty")] * $set_item_ratio . ' Pcs' ?></th>
						<!-- <th style="background: yellow; color: #8B0000;"> <? if ($zero_value == 0) echo "Budget Value"; ?></th>                      
                <th align="right" style="background: yellow; color: #8B0000;"><? if ($zero_value == 0) { ?>
                <? if ($total_budget_value > 0) {
					echo '&dollar;' . fn_number_format($total_budget_value, 2);
				} ?><br/>
				<? if ($total_budget_value > 0) {
					echo fn_number_format($total_budget_value / $order_values * 100, 2) . '%';
				} ?>
                <? } ?>
                </th>  -->
						<th style="background: #D7ECD9">File No</th>
						<th><? echo $file_cond; ?></th>
					</tr>
					<tr>
						<th style="background: #D7ECD9">Season / Brand</th>
						<th><? echo $sesson_arr[$row[csf("season_buyer_wise")]] . '&nbsp' . $brand_arr[$row[csf("brand_id")]]; ?></th>
						<th>Costing Per: <br><?= $costing_for;  ?></th>
						<th style="background: #D7ECD9">Plan Cut quantity (<? echo fn_number_format((($plan_cut_qty - $job_qnty) / $job_qnty) * 100, 2) . '%' ?>) </td>
						<th align="center" style="color: #8B0000"><?= $row[csf("job_quantity")] * $total_set_qnty . ' Pcs'; //." ". $unit_of_measurement[$row[csf("order_uom")]]; 
																	?></th>
						<!-- <th rowspan="2" style="background: yellow; color: #8B0000;"><? if ($zero_value == 0) echo "Open Value %"; ?></th>                      
                <th rowspan="2" align="right" style="background: yellow; color: #8B0000;"><? if ($zero_value == 0) { ?> &#36;<?
					$margin_val = $order_values - $total_budget_value;
					echo fn_number_format($margin_val, 2) . '<br>' . fn_number_format($margin_val / $order_values * 100, 2) . '%';
				}
					?></th> -->
						<th style="background: #D7ECD9">Ref No</th>
						<th><? echo ltrim($ref_cond, ", "); ?></th>
					</tr>
					<tr>
						<th style="background: #D7ECD9">Style No</th>
						<th><? $style_no = $row[csf("style_ref_no")];
							echo $row[csf("style_ref_no")]; ?></th>
						<th style="background: #D7ECD9">App. Status</th>
						<th colspan="2"><? if ($row[csf("approved")] == 1) {
											echo "This Budget is Approved ";
										} elseif ($row[csf("approved")] == 3) {
											echo "This Budget is partial Approved";
										} else {
											echo "This Budget is Not  Approved";
										} ?></th>
						<th style="background: #D7ECD9">SMV</th>
						<th>
							<?


							$sews_pcs_sql = sql_select("select gmts_item_id,smv_pcs from wo_po_details_mas_set_details where job_no=$txt_job_no");
							foreach ($sews_pcs_sql as $key => $val) {
								$sew_pcs[$val[csf("gmts_item_id")]] = $val[csf("smv_pcs")];
							}


							echo implode(',', $sew_pcs);
							?>
						</th>
					</tr>
					<tr>
						<th style="background: #D7ECD9">Sc/Lc No</th>
						<th colspan="2"><? echo $sc_lc_no; ?></th>
						<th style="background: #D7ECD9">Remarks</th>
						<th colspan="3"><? echo $row[csf("remarks")]; ?></th>
					</tr>
					<tr>
						<th style="background: #D7ECD9">Style Description</th>
						<th colspan="2"><? echo $row[csf("style_description")]; ?></th>
						<th style="background: #D7ECD9">Refusing Cause</th>
						<th colspan="3"><? echo $row[csf("refusing_cause")]; ?></th>
					</tr>
				</table>

			<?
				$avg_unit_price = $row[csf("avg_unit_price")];
				$ord_qty = $row[csf("ord_qty")];
			}		//end first foearch
			/*echo '<pre>';
			print_r($conv_amount_job_process); die;*/

			$yarnPer = $yarn_qty_amount_arr[$job_no]['amount'] / $yarn_qty_amount_arr[$job_no]['qty'];
			$finishPer = $total_finishing_amount / $total_finishing_qty;
			$ydsPer = array_sum($conv_amount_job_process[$job_no][30]) / array_sum($conv_qty_job_process[$job_no][30]);
			$aopPer = array_sum($conv_amount_job_process[$job_no][35]) / array_sum($conv_qty_job_process[$job_no][35]);
			$knitPer = array_sum($conv_amount_job_process[$job_no][1]) / array_sum($conv_qty_job_process[$job_no][1]);
			$purchPer = $purchase_qty / $purchase_amount;
			$dyePer = array_sum($conv_amount_job_process[$job_no][31]) / array_sum($conv_qty_job_process[$job_no][31]);

			$totFabPer = $yarnPer + $finishPer + $ydsPer + $aopPer + $knitPer + $purchPer + $dyePer;

			//echo $yarnPer.'='.$finishPer.'='.$ydsPer.'='.$aopPer.'='.$knitPer.'='.$purchPer.'='.$dyePer.'='.$totFabPer;
			//echo $other_costing_arr[$job_no]['cm_cost'].'='.$plancutqty.'='.$set_item_ratio;


			?>
			<br>
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px; margin-top: 10px; font-family: 'Arial Narrow', Arial, sans-serif;" rules="all">
				<label style="float:left;background:#CCCCCC; font-size:larger;"><b>Summary </b> </label>
				<tr style="background: #D7ECD9">
					<th colspan="8" width="320">Fabric </th>
					<th colspan="4" width="160">Embellishment</th>
					<th colspan="4" width="160">Trims + CM + Misc + Mrg</th>
					<th style="background: yellow">TTL COST &dollar;</th>
				</tr>
				<tr style="background: #D7ECD9">
					<th align="center">Item</th>
					<th align="center">Cost/Uom</th>
					<th align="center">Amount</th>
					<th align="center">&percnt;</th>
					<th align="center">Item</th>
					<th align="center">Cost/Uom</th>
					<th align="center">Amount</th>
					<th align="center">&percnt;</th>
					<th align="center">Item</th>
					<th align="center">Cost/Dz</th>
					<th align="center">Amount</th>
					<th align="center">&percnt;</th>
					<th align="center">Item</th>
					<th align="center">Cost/Dz</th>
					<th align="center">Amount</th>
					<th align="center">&percnt;</th>
					<th rowspan="5" align="right" style="background: yellow; color: #8B0000"><b>
							<? if ($total_budget_value > 0) {
								echo fn_number_format($total_budget_value, 2, '', '');
							} ?><br /><br />
							<? if ($total_budget_value > 0) {
								echo fn_number_format($total_budget_value / $order_values * 100, 2) . '%';
							} ?></b>
					</th>
				</tr>
				<tr>
					<th align="center">Yarn</th>
					<td align="center"><? if ($yarn_amount_summ > 0) {
											echo fn_number_format($yarn_qty_amount_arr[$job_no]['amount'] / $yarn_qty_amount_arr[$job_no]['qty'], 2);
										} ?></td>
					<td align="right" style="color: #8B0000"><? if ($yarn_amount_summ > 0) {
																	echo '&dollar;' . fn_number_format($yarn_amount_summ, 2);
																} ?></td>
					<td align="right"><? if ($yarn_amount_summ > 0) {
											echo fn_number_format($yarn_qty_amount_arr[$job_no]['amount'] / $order_values * 100, 2) . '%';
										}; ?></td>

					<th align="center">Finishing</th>
					<td align="center" title="<?= $total_finishing_amount . '=' . $total_finishing_qty; ?>"><? 
					if ($total_finishing_amount > 0) {
						echo fn_number_format($total_finishing_amount / $total_finishing_qty, 2);
					} ?>
					</td>
					<td align="right" style="color: #8B0000"><? if ($total_finishing_amount > 0) {
																	echo '&dollar;' . fn_number_format($total_finishing_amount, 2);
																} ?></td>
					<td align="right"><? if ($total_finishing_amount > 0) {
											echo fn_number_format($total_finishing_amount / $order_values * 100, 2) . '%';
										} ?></td>
					<?
					$print_amt = $emb_amount_job_name_arr[$job_no][1];
					$print_qty = $emb_qty_job_name_arr[$job_no][1];
					?>
					<th align="center">Print</th>
					<td align="center" title="Amt=<? echo $print_amt; ?>/Qty=<? echo $print_qty; ?>">
						<? if ($print_amount_summ > 0) {
							//echo fn_number_format($emb_amount_job_name_arr[$job_no][1]/$emb_qty_job_name_arr[$job_no][1],2);
							//echo fn_number_format($embel_cost_dzn,2);
							echo fn_number_format($print_amt / $print_qty, 2);
						}  ?></td>
					<td align="right" style="color: #8B0000"><? if ($print_amount_summ > 0) {
																	echo '&dollar;' . fn_number_format($print_amount_summ, 2);
																}  ?></td>
					<td align="right"><? if ($print_amount_summ > 0) {
											echo fn_number_format($emb_amount_job_name_arr[$job_no][1] / $order_values * 100, 2) . '%';
										} ?></td>

					<th align="center">Trim</th>
					<td align="center"><? if ($trims_costing_arr[$job_no] > 0) {
											echo fn_number_format($trims_costing_arr[$job_no] / $order_job_qnty, 2);
										} ?></td>
					<td align="right" style="color: #8B0000"><? if ($trims_costing_arr[$job_no] > 0) {
																	echo '&dollar;' . fn_number_format($trims_costing_arr[$job_no], 2);
																} ?></td>
					<td align="right"><? if ($trims_costing_arr[$job_no] > 0) {
											echo fn_number_format($trims_costing_arr[$job_no] / $order_values * 100, 2) . '%';
										} ?></td>
				</tr>
				<tr>
					<th align="center">Yds</th>
					<td align="center"><? if ($yds_amount_summ > 0) {
											echo fn_number_format(array_sum($conv_amount_job_process[$job_no][30]) / array_sum($conv_qty_job_process[$job_no][30]), 2);
										} ?></td>
					<td align="right" style="color: #8B0000"><? if ($yds_amount_summ > 0) {
																	echo '&dollar;' . fn_number_format($yds_amount_summ, 2);
																} ?></td>
					<td align="right"><? if ($yds_amount_summ > 0) {
											echo fn_number_format(array_sum($conv_amount_job_process[$job_no][30]) / $order_values * 100, 2) . '%';
										} ?></td>

					<th align="center">AOP</th>
					<td align="center"><? if ($aop_amount_summ > 0) {
											echo fn_number_format(array_sum($conv_amount_job_process[$job_no][35]) / array_sum($conv_qty_job_process[$job_no][35]), 2);
										} ?></td>
					<td align="right" style="color: #8B0000"><? if ($aop_amount_summ > 0) {
																	echo '&dollar;' . fn_number_format($aop_amount_summ, 2);
																} ?></td>
					<td align="right"><? if ($aop_amount_summ > 0) {
											echo fn_number_format(array_sum($conv_amount_job_process[$job_no][35]) / $order_values * 100, 2) . '%';
										} ?></td>

					<th align="center">EMB</th>
					<td align="center"><? if ($emb_amount_summ > 0) {
											echo fn_number_format($emb_amount_job_name_arr[$job_no][2] / $emb_qty_job_name_arr[$job_no][2], 2);
										}  ?></td>
					<td align="right" style="color: #8B0000"><? if ($emb_amount_summ > 0) {
																	echo '&dollar;' . fn_number_format($emb_amount_summ, 2);
																}  ?></td>
					<td align="right"><? if ($emb_amount_summ > 0) {
											echo fn_number_format($emb_amount_job_name_arr[$job_no][2] / $order_values * 100, 2) . '%';
										} ?></td>
					<th align="center">MISC</th>
					<td align="center"><? if ($misc_cost > 0) {
											echo fn_number_format($misc_cost / $order_job_qnty * 12, 2);
										} ?></td>
					<td align="right" style="color: #8B0000"><? if ($misc_cost > 0) {
																	echo '&dollar;' . fn_number_format($misc_cost, 2);
																}  ?></td>
					<td align="right"><? if ($misc_cost > 0) {
											echo fn_number_format($misc_cost / $order_values * 100, 2) . '%';
										} ?></td>
				</tr>
				<tr>
					<th align="center">Knitting</th>
					<td align="center"><? if ($knitting_amount_summ != '') {
											echo fn_number_format(array_sum($conv_amount_job_process[$job_no][1]) / array_sum($conv_qty_job_process[$job_no][1]), 2);
										} ?></td>
					<td align="right" style="color: #8B0000"><? if ($knitting_amount_summ != '') {
																	echo  '&dollar;' . $knitting_amount_summ;
																}   ?></td>
					<td align="right"><? if ($knitting_amount_summ != '') {
											echo fn_number_format(array_sum($conv_amount_job_process[$job_no][1]) / $order_values * 100, 2) . '%';
										} ?></td>

					<th align="center">P. Fabric</th>
					<td align="center"><? $total_fabic_cost += $purchase_qty / $purchase_amount;
										if ($purchase_qty > 0 && $purchase_amount > 0) {
											echo fn_number_format($purchase_qty / $purchase_amount, 2);
										} ?></td>
					<td align="right"><? $total_fabric_amount += $purchase_amount;
										if ($purchase_amount) {
											echo '&dollar;' . fn_number_format($purchase_amount, 2);
										} ?></td>
					<td align="right"><? $total_fabric_per += $purchase_amount / $order_values * 100;
										if ($purchase_amount > 0) {
											echo fn_number_format($purchase_amount / $order_values * 100, 2) . '%';
										}  ?></td>

					<th align="center">Wash</th>
					<td align="center"><? if ($wash_amount_summ > 0) {
											echo fn_number_format($wash_amount_job_name_arr[$job_no][3] / $wash_qty_job_name_arr[$job_no][3], 2);
										};  ?></td>
					<td align="right" style="color: #8B0000"><? if ($wash_amount_summ > 0) {
																	echo '&dollar;' . fn_number_format($wash_amount_summ, 2);
																}  ?></td>
					<td align="right"><? if ($wash_amount_summ > 0) {
											echo fn_number_format($wash_amount_job_name_arr[$job_no][3] / $order_values * 100, 2) . '%';
										} ?></td>


					<th align="center" style="color: #8B0000">F.CM</th>
					<td align="center" style="color: #8B0000" title="CM Cost-CM Cost*Plan Per%"><? //if($other_costing_arr[$job_no]['cm_cost']>0){echo fn_number_format(($other_costing_arr[$job_no]['cm_cost']/($plancutqty*$set_item_ratio))*12,2); }
																								echo fn_number_format($fcm, 4);
																								?></td>
					<td align="right" style="color: #8B0000" title="(Order Qnty Pcs(<?= $row[csf("job_qty")]; ?>)*(<?= $set_item_ratio; ?>)/12)*cm cost(<?= $cm_cost; ?>)"><? echo fn_number_format($fcm_cm_val, 2); //if($other_costing_arr[$job_no]['cm_cost']>0){ echo fn_number_format($other_costing_arr[$job_no]['cm_cost'],2); } 
																																											?></td>
					<td align="right"><? if ($fcm_cm_val > 0) {
											echo fn_number_format($fcm_cm_val / $order_values * 100, 2) . '%';
										} ?></td>
				</tr>
				<tr>
					<th align="center">Dyeing</th>
					<td align="center"><? if ($dyeing_amount_summ > 0) {
											echo fn_number_format(array_sum($conv_amount_job_process[$job_no][31]) / array_sum($conv_qty_job_process[$job_no][31]), 2);
										} ?></td>
					<td align="right" style="color: #8B0000"><? if ($dyeing_amount_summ > 0) {
																	echo '&dollar;' . fn_number_format($dyeing_amount_summ, 2);
																} ?></td>
					<td align="right"><? if ($dyeing_amount_summ > 0) {
											echo fn_number_format(array_sum($conv_amount_job_process[$job_no][31]) / $order_values * 100, 2) . '%';
										} ?></td>

					<th align="center" style="color: #8B0000">TOTAL</th>
					<th align="center" style="color: #8B0000"><? if ($total_fabic_cost > 0) {
																	echo fn_number_format($total_fabic_cost, 2);
																} ?></th>
					<th align="right" style="color: #8B0000"><? if ($total_fabric_amount > 0) {
																	echo '&dollar;' . fn_number_format($total_fabric_amount, 2);
																}  ?></th>
					<th align="right" style="color: #8B0000"><? if ($total_fabric_per > 0) {
																	echo fn_number_format($total_fabric_per, 2);
																}  ?></th>

					<th align="center" title="Special works, Garments dyeing, UV print and others.">Others</th>
					<td align="center"><? if ($others_emb_amount > 0) {
											echo fn_number_format($others_emb_amount / $others_emb_qty, 2);
										} ?></td>
					<td align="right"><? if ($others_emb_amount > 0) {
											echo '&dollar;' . fn_number_format($others_emb_amount, 2);
										}  ?></td>
					<td align="right"><? if ($others_emb_amount > 0) {
											echo fn_number_format($others_emb_amount / $order_values * 100, 2);
										}  ?></td>
					<th align="center">Mrg</th>
					<?
					$total_margin_val = $order_values - $total_budget_value;
					?>
					<td align="right" style="color: #8B0000" title="<?= $order_values .'-'. $total_budget_value . '/' . $row[csf("job_qty")] . '*' . $set_item_ratio . '/' . '12'; ?>"><?
																																									echo fn_number_format($total_margin_val / ($row[csf("job_qty")] * $set_item_ratio / 12), 2);


																																									?></td>
					<td align="right" title="<?= $order_values . '-' . $total_budget_value; ?>" style="color: #8B0000"><? echo '&dollar;' . fn_number_format($total_margin_val, 2); ?></td>
					<td align="right" style="color: #8B0000"><?
						$cv = ($total_margin_val / $order_values * 100);
						if (is_infinite($cv) || is_nan($cv)) {
							$cv = 0;
						}
						echo fn_number_format($cv, 2) . '%';  ?></td>
				</tr>
				<tr>
					<th align="center" colspan="12"> </th>

					<th align="center">O.CM</th>

					<td align="right" style="color: #8B0000"><? echo '&dollar;' . fn_number_format($cm_cost, 2); ?></td>
					<td align="right" style="color: #8B0000" title="(Order Qnty Pcs(<?= $row[csf("job_qty")]; ?>)*(<?= $set_item_ratio; ?>)/12)*cm cost(<?= $cm_cost; ?>)"><?= (($row[csf("job_qty")] * $set_item_ratio) / 12) * $cm_cost; ?>
					</td>
					<td align="right" style="color: #8B0000"></td>
				</tr>
			</table>
			<?
			$location_cpm_cost = 0;
			$cm_min_variable = return_field_value("yarn_iss_with_serv_app as cost_per_minute", "variable_order_tracking", "company_name =" . $cbo_company_name . " and variable_list=67 and is_deleted=0 and status_active=1", "cost_per_minute");
			if ($cm_min_variable == "" || $cm_min_variable == 0) $location_cpm_cost = 0;
			else $location_cpm_cost = $cm_min_variable;
			if ($location_cpm_cost != 1) {
				$sql_std_para = sql_select("select interest_expense, income_tax, cost_per_minute, applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$cbo_company_name and status_active=1 and is_deleted=0 order by id");

				foreach ($sql_std_para as $row) {
					$applying_period_date = change_date_format($row[csf('applying_period_date')], '', '', 1);
					$applying_period_to_date = change_date_format($row[csf('applying_period_to_date')], '', '', 1);
					$diff = datediff('d', $applying_period_date, $applying_period_to_date);
					for ($j = 0; $j < $diff; $j++) {
						//$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);
						$date_all = add_date(str_replace("'", "", $applying_period_date), $j);
						$newdate = change_date_format($date_all, '', '', 1);
						$financial_para[$newdate][interest_expense] = $row[csf('interest_expense')];
						$financial_para[$newdate][income_tax] = $row[csf('income_tax')];
						$financial_para[$newdate][cost_per_minute] = $row[csf('cost_per_minute')];
					}
				}
			} else {
				$sql_std_para = sql_select("select a.id, b.id as dtls_id, b.location_id, b.applying_period_date, b.applying_period_to_date, b.monthly_cm_expense, b.no_factory_machine, b.working_hour, b.cost_per_minute from lib_standard_cm_entry a, lib_standard_cm_entry_dtls b where a.id=b.mst_id and b.location_id=$location_name_id and a.company_id=$cbo_company_name");
				foreach ($sql_std_para as $row) {
					$applying_period_date = change_date_format($row[csf('applying_period_date')], '', '', 1);
					$applying_period_to_date = change_date_format($row[csf('applying_period_to_date')], '', '', 1);
					$diff = datediff('d', $applying_period_date, $applying_period_to_date);
					for ($j = 0; $j < $diff; $j++) {
						$date_all = add_date(str_replace("'", "", $applying_period_date), $j);
						$newdate = change_date_format($date_all, '', '', 1);
						$financial_para[$newdate][interest_expense] = $row[csf('interest_expense')];
						$financial_para[$newdate][income_tax] = $row[csf('income_tax')];
						$financial_para[$newdate][cost_per_minute] = $row[csf('cost_per_minute')];
					}
				}
			}

			$pre_costing_date = change_date_format($costing_date, '', '', 1);
			?>
			<? if ($zero_value == 0) { ?>
				<br />
				<label style="text-align:left; background:#CCCCCC; font-size:larger;"><b>CM Details </b> </label>
				<div style="width:970px; margin-top: 10px; font-family: 'Arial Narrow', Arial, sans-serif;">
					<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:720px;float: left;" rules="all">
						<tr>
							<th colspan="13">&nbsp;</th>
						</tr>
						<tr style="background: #D7ECD9">
							<th>Style NO.</th>
							<th>MC</th>
							<th>Prd/Hr</th>
							<th>SMV</th>
							<th>BCM</th>
							<th>F.CM</th>
							<th>TTL Min</th>
							<th align="center">CPM</th>
							<th>RL</th>
							<th>RD</th>
							<th>A Eff%</th>
							<th>Layout No</th>
							<th>Alloc Qty</th>
						</tr>
						<tr align="center">
							<td><?= $style_no  ?></td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td><?= $sew_smv ?></td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td>&#36; <? echo fn_number_format($financial_para[$pre_costing_date][cost_per_minute], 4); ?></td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
						</tr>
						<tr>
							<th>Grand Total</th>
							<th>&nbsp;</th>
							<th>&nbsp;</th>
							<th><?= $sew_smv ?></th>
							<th>&nbsp;</th>
							<th>&nbsp;</th>
							<th>&nbsp;</th>
							<th>&#36; <? echo fn_number_format($financial_para[$pre_costing_date][cost_per_minute], 4); ?></th>
							<th>&nbsp;</th>
							<th>&nbsp;</th>
							<th>&nbsp;</th>
							<th>&nbsp;</th>
							<th>&nbsp;</th>
						</tr>
					</table>
					<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:248px; margin-left: 2px; float: right;" rules="all">
						<tr>
							<th colspan="3" bgcolor="yellow">Embellishment[DZN]</th>
						</tr>
						<tr>
							<th>Print Qty</th>
							<th>Emb Qty</th>
							<th>Wash Qty</th>
						</tr>
						<tr align="center">
							<td><? if ($emb_qty_job_name_arr[$job_no][1] > 0) {
									echo fn_number_format($emb_qty_job_name_arr[$job_no][1], 2);
								} else {
									echo '&nbsp;';
								} ?></td>
							<td><? if ($emb_qty_job_name_arr[$job_no][2] > 0) {
									echo fn_number_format($emb_qty_job_name_arr[$job_no][2], 2);
								} else {
									echo '&nbsp;';
								} ?></td>
							<td><? if ($emb_qty_job_name_arr[$job_no][3] > 0) {
									echo fn_number_format($wash_qty_job_name_arr[$job_no][3], 2);
								} else {
									echo '&nbsp;';
								} ?></td>
						</tr>
						<tr>
							<th><? if ($emb_qty_job_name_arr[$job_no][1] > 0) {
									echo fn_number_format($emb_qty_job_name_arr[$job_no][1], 2);
								} else {
									echo '&nbsp;';
								} ?></th>
							<th><? if ($emb_qty_job_name_arr[$job_no][2] > 0) {
									echo fn_number_format($emb_qty_job_name_arr[$job_no][2], 2);
								} else {
									echo '&nbsp;';
								} ?></th>
							<th><? if ($emb_qty_job_name_arr[$job_no][3] > 0) {
									echo fn_number_format($wash_qty_job_name_arr[$job_no][3], 2);
								} else {
									echo '&nbsp;';
								} ?></th>
						</tr>
					</table>
				</div>
				<br>
			<? } ?>
			<?
			$nameArray_fabric_description = sql_select("SELECT (a.id) as fabric_cost_dtls_id,a.item_number_id, max(a.lib_yarn_count_deter_id) as determin_id,a.body_part_id,a.uom,a.color_type_id,a.fabric_source, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type, b.dia_width,avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent , a.fab_nature_id,  avg(b.requirment) as requirment, d.fabric_composition_id FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, lib_yarn_count_determina_mst d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and  c.id=b.color_size_table_id and a.lib_yarn_count_deter_id=d.id and c.status_active=1 and c.is_deleted=0  and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and a.job_no =$txt_job_no and  b.cons>0 group by a.body_part_id,a.uom,a.id,a.item_number_id,a.color_type_id,a.fabric_source,a.construction,a.composition,a.gsm_weight,b.dia_width,a.fab_nature_id, d.fabric_composition_id order by fabric_cost_dtls_id,a.body_part_id,b.dia_width");

			//a.fabric_source=1 and
			foreach ($nameArray_fabric_description as $row) {
				$fabric_id = $row[csf('fabric_cost_dtls_id')];
				$yarn_amount = $yarnDataWithFabricidArr[$fabric_id]['amount'];
				$yarn_qty = $yarnDataWithFabricidArr[$fabric_id]['qty'];

				$yds_amount = array_sum($con_amount_fabric_process[$fabric_id][30]);
				$yds_qty = array_sum($con_qty_fabric_process[$fabric_id][30]);

				$knitting_amount = array_sum($con_amount_fabric_process[$fabric_id][1]);
				$knitting_qty = array_sum($con_qty_fabric_process[$fabric_id][1]);
				$dyeing_amount = array_sum($con_amount_fabric_process[$fabric_id][31]);
				$dyeing_qty = array_sum($con_qty_fabric_process[$fabric_id][31]);
				$aop_amount = array_sum($con_amount_fabric_process[$fabric_id][35]);
				$aop_qty = array_sum($con_qty_fabric_process[$fabric_id][35]);

				$total_finishing_amount = 0;
				$total_finishing_qty = 0;
				foreach ($finishing_arr as $fid) {
					$total_finishing_amount += array_sum($con_amount_fabric_process[$fabric_id][$fid]);
					$total_finishing_qty += array_sum($con_qty_fabric_process[$fabric_id][$fid]);
				}

				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['body_part_id'] = $row[csf('body_part_id')];
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['description'] = $row[csf('construction')] . ', ' . $fabric_composition_arr[$row[csf('fabric_composition_id')]];
				if ($row[csf('fab_nature_id')] == 2) {
					$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['fqty'] = array_sum($fabric_qty_arr['knit']['finish'][$row[csf('fabric_cost_dtls_id')]]);
					$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['gqty'] = array_sum($fabric_qty_arr['knit']['grey'][$row[csf('fabric_cost_dtls_id')]]);
				}
				if ($row[csf('fab_nature_id')] == 3) {
					$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['fqty'] = array_sum($fabric_qty_arr['woven']['finish'][$row[csf('fabric_cost_dtls_id')]]);
					$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['gqty'] = array_sum($fabric_qty_arr['woven']['grey'][$row[csf('fabric_cost_dtls_id')]]);
				}

				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['funit'] = $row[csf('uom')];
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['cons'] = $row[csf('cons')];

				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['process_loss'] = $row[csf('process_loss_percent')];
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['yarn_amount'] = $yarn_amount;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['yarn_per'] = $yarn_amount / $yarn_qty;

				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['yds_amount'] = $yds_amount;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['yds_per'] = $yds_amount / $yds_qty;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['knitting_amount'] = $knitting_amount;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['knitting_per'] = $knitting_amount / $knitting_qty;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['dyeing_amount'] = $dyeing_amount;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['dyeing_per'] = $dyeing_amount / $dyeing_qty;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['aop_amount'] = $aop_amount;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['aop_per'] = $aop_amount / $aop_qty;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['finishing_amount'] = $total_finishing_amount;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['finishing_per'] = $total_finishing_amount / $total_finishing_qty;
				if ($row[csf('fabric_source')] == 1) {
					$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['ttl_cost'] = $yarn_amount + $yds_amount + $knitting_amount + $dyeing_amount + $aop_amount + $total_finishing_amount;
				}
				if ($row[csf('fabric_source')] == 2) {
					if ($row[csf('fab_nature_id')] == 2) {
						$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['ttl_cost'] = array_sum($fabric_amount_arr['knit']['grey'][$row[csf('fabric_cost_dtls_id')]]);
					}
					if ($row[csf('fab_nature_id')] == 3) {
						$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['ttl_cost'] = array_sum($fabric_amount_arr['woven']['grey'][$row[csf('fabric_cost_dtls_id')]]);
					}
				}
			}
			/* echo '<pre>';
			print_r($fabric_data_arr); die; */
			$total_finishing_amount = 0;
			?>
			<? if ($zero_value == 0) { ?>
				<br>
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px; margin-top: 10px; font-family: 'Arial Narrow', Arial, sans-serif;" rules="all">
					<label style="float:left;background:#CCCCCC; font-size:larger;"><b>Fabric Details </b> </label>
					<tr style="background: #D7ECD9">
						<th rowspan="2">Garments Part Name</th>
						<th rowspan="2">Fabric Details</th>
						<th rowspan="2">Con</th>
						<th>F. QTY</th>
						<th rowspan="2">Process Loss</th>
						<th>G. QTY</th>
						<th colspan="7">Cost/Uom (Fabric)</th>
						<th rowspan="2">Cost/Dz</th>
						<th rowspan="2" style="background: yellow;">TTL Cost $</th>
					</tr>
					<tr style="background: #D7ECD9">
						<th>Unit</th>
						<th>Unit</th>
						<th>Yarn</th>
						<th>Yds</th>
						<th>Knitting</th>
						<th>Dyeing</th>
						<th>AOP</th>
						<th>Finishing</th>
						<th>Cost/Uom</th>
					</tr>
					<?
					foreach ($fabric_data_arr as $value) { ?>
						<tr>
							<td rowspan="2"><?= $body_part[$value['body_part_id']] ?></td>
							<td rowspan="2"><?= $value['description'] ?></td>
							<td rowspan="2" align="center"><?= fn_number_format($value['cons'], 2); ?></td>
							<td align="center"><? $total_fqty += $value['fqty'];
												echo fn_number_format($value['fqty'], 2); ?></td>
							<td rowspan="2" align="center"><? if ($value['process_loss'] > 0) {
																echo fn_number_format($value['process_loss'], 2);
															} ?></td>
							<td align="center"><? $total_gqty += $value['gqty'];
												echo fn_number_format($value['gqty'], 2) ?></td>
							<td rowspan="2" align="right"><? $total_yarn_amount += $value['yarn_amount'];
															if ($value['yarn_amount'] > 0) {
																echo fn_number_format($value['yarn_per'], 2);
															} ?><br><? if ($value['yarn_amount'] > 0) {
																		echo fn_number_format($value['yarn_amount'], 2);
																	} ?></td>
							<td rowspan="2" align="right"><? $total_yds_amount += $value['yds_amount'];
															if ($value['yds_per'] > 0) {
																echo fn_number_format($value['yds_per'], 2);
															} ?><br><? if ($value['yds_amount'] > 0) {
																		echo fn_number_format($value['yds_amount'], 2);
																	} ?></td>
							<td rowspan="2" align="right"><? $total_knitting_amount += $value['knitting_amount'];
															if ($value['knitting_per'] > 0) {
																echo fn_number_format($value['knitting_per'], 2);
															} ?><br><? if ($value['knitting_amount'] > 0) {
																		echo fn_number_format($value['knitting_amount'], 2);
																	} ?></td>
							<td rowspan="2" align="right"><? $total_dyeing_amount += $value['dyeing_amount'];
															if ($value['dyeing_per'] > 0) {
																echo fn_number_format($value['dyeing_per'], 2);
															} ?><br><? if ($value['dyeing_amount'] > 0) {
																		echo fn_number_format($value['dyeing_amount'], 2);
																	} ?></td>
							<td rowspan="2" align="right"><? $total_aop_amount += $value['aop_amount'];
															if ($value['aop_per'] > 0) {
																echo fn_number_format($value['aop_per'], 2);
															} ?><br><? if ($value['aop_amount'] > 0) {
																		echo fn_number_format($value['aop_amount'], 2);
																	} ?></td>
							<td rowspan="2" align="right"><? $total_finishing_amount += $value['finishing_amount'];
															if ($value['finishing_per'] > 0) {
																echo fn_number_format($value['finishing_per'], 2);
															} ?><br><? if ($value['finishing_amount'] > 0) {
																		echo fn_number_format($value['finishing_amount'], 2);
																	} ?></td>
							<td rowspan="2" align="right" title="TTL Cost/Finish Quantity"><?= fn_number_format($value['ttl_cost'] / $value['fqty'], 2) ?></td>
							<td rowspan="2" align="right"><?= fn_number_format($value['ttl_cost'] / $order_job_qnty * 12, 2) ?></td>
							<th rowspan="2" style="background: yellow;" align="right"><? $total_ttl_cost += $value['ttl_cost'];
																						echo fn_number_format($value['ttl_cost'], 2) ?></th>
						</tr>
						<tr>
							<td align="center"><?= $unit_of_measurement[$value['funit']] ?></td>
							<td align="center"><?= $unit_of_measurement[$value['funit']] ?></td>
						</tr>
					<? }
					?>
					<tr>
						<th colspan="2">Fabric Total</th>
						<td></td>
						<th align="center"><? if ($total_fqty > 0) {
												echo fn_number_format($total_fqty, 2);
											} ?></th>
						<td></td>
						<th align="right"><? if ($total_gqty) {
												echo fn_number_format($total_gqty, 2);
											} ?></th>
						<th align="right"><? if ($total_yarn_amount) {
												echo fn_number_format($total_yarn_amount, 2);
											} ?></th>
						<th align="right"><? if ($total_yds_amount) {
												echo fn_number_format($total_yds_amount, 2);
											} ?></th>
						<th align="right"><? if ($total_knitting_amount) {
												echo fn_number_format($total_knitting_amount, 2);
											} ?></th>
						<th align="right"><? if ($total_dyeing_amount) {
												echo fn_number_format($total_dyeing_amount, 2);
											} ?></th>
						<th align="right"><? if ($total_aop_amount) {
												echo fn_number_format($total_aop_amount, 2);
											} ?></th>
						<th align="right"><? if ($total_finishing_amount) {
												echo fn_number_format($total_finishing_amount, 2);
											} ?></th>
						<th></th>
						<th></th>
						<th style="background: yellow;" align="right"><? if ($total_ttl_cost) {
																			echo '&dollar;' . fn_number_format($total_ttl_cost, 2);
																		} ?> <br><? if ($total_ttl_cost) {
																						echo fn_number_format($total_ttl_cost / $order_values * 100, 2) . '%';
																					} ?></th>
					</tr>
				</table>
			<? } ?>
			<?

			//end 	All Fabric Cost part report-------------------------------------------
			$lib_yarn_count = return_library_array("select yarn_count,id from lib_yarn_count", "id", "yarn_count");
			$sql = "select min(id) as id, count_id, copm_one_id, percent_one, copm_two_id, percent_two, color,type_id, min(cons_ratio) as cons_ratio, sum(cons_qnty) as cons_qnty, rate, sum(amount) as amount from wo_pre_cost_fab_yarn_cost_dtls where job_no=" . $txt_job_no . "  and status_active=1 and is_deleted=0 group by count_id, copm_one_id, percent_one, copm_two_id, percent_two, color,type_id, rate";

			$data_array = sql_select($sql);
			$yarn_data_array = $yarn->getCountCompositionPercentTypeColorAndRateWiseYarnQtyAndAmountArray();
			//print_r($yarn_data_array);

			?>
			<br>
			<div style="margin-top:15px; font-family: 'Arial Narrow', Arial, sans-serif;">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px;text-align:center;" rules="all">

					<label style="float:left;background:#CCCCCC; font-size:larger;"><b>Yarn Details </b> </label>
					<tr style="font-weight:bold;">

						<td width="540" style="background: #D7ECD9">Yarn Description</td>
						<td width="80" style="background: #D7ECD9">Yarn Qty/<?= $costing_for; ?></td>
						<td width="80" style="background: #D7ECD9">TTL Yarn Qty</td>
						<td width="80" style="background: #D7ECD9">Rate &#36;</td>
						<td width="80" style="background: yellow">Amount &#36;</td>
						<td width="80" style="background: #D7ECD9">% to Ord. Value</td>
					</tr>
					<?
					$total_yarn_qty = 0;
					$total_yarn_amount = 0;
					$total_yarn_cost_dzn = $total_yarn_qty_dzn = 0;
					$total_yarn_cost_kg = 0;
					$total_yarn_avg_cons_qty = 0;
					foreach ($data_array as $row) {
						if ($row[csf("percent_one")] == 100)
							$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];
						else
							$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $composition[$row[csf("copm_two_id")]] . " " . $row[csf("percent_two")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];
						$rowcons_qnty = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['qty'];
						$rowavgcons_qnty = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['qty'];
						$rowamount = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['amount'];
						if (is_infinite($rowamount) || is_nan($rowamount)) {
							$rowamount = 0;
						}
					?>
						<tr>
							<td align="left"><? echo $item_descrition; ?></td>
							<td align="right"><? echo fn_number_format($row[csf("cons_qnty")], 3); ?></td>
							<td align="right"><? echo fn_number_format($rowcons_qnty, 2); ?></td>

							<td align="right"><? if ($row[csf("rate")] > 0) {
													echo fn_number_format($row[csf("rate")], 3);
												} ?></td>
							<td align="right" style="background: yellow"><? if ($rowamount > 0) {
																				echo fn_number_format($rowamount, 2);
																			} ?></td>
							<td align="right"><?
												$cv = ($row[csf("amount")] / $price_dzn) * 100;
												if (is_infinite($cv) || is_nan($cv)) {
													$cv = 0;
												}
												if ($cv > 0) {
													echo fn_number_format($cv, 2);
												}
												?></td>
						</tr>
					<?
						$total_yarn_qty += $rowcons_qnty;
						$total_yarn_qty_dzn += $row[csf("cons_qnty")];
						$total_avg_yarn_qty += $rowavgcons_qnty;
						$total_yarn_amount += $rowamount;
						$total_yarn_cost_dzn += $row[csf("amount")];
						$total_yarn_avg_cons_qty += $rowavgcons_qnty;
						$total_yarn_cost_kg = $total_yarn_amount / $total_yarn_qty;
						if (is_infinite($total_yarn_cost_kg) || is_nan($total_yarn_cost_kg)) {
							$total_yarn_cost_kg = 0;
						}
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td>Yarn Total</td>
						<td align="right"><? if ($total_yarn_qty_dzn > 0) {
												echo fn_number_format($total_yarn_qty_dzn, 4);
											} ?></td>
						<td align="right"><? if ($total_yarn_qty > 0) {
												echo fn_number_format($total_yarn_qty, 2);
											} ?></td>
						<td></td>
						<td align="right" bgcolor="yellow"><? if ($total_yarn_amount > 0) {
																echo '&dollar;' . fn_number_format($total_yarn_amount, 2);
															} ?></td>
						<td align="right"><?
											$cv = ($total_yarn_cost_dzn / $price_dzn) * 100;
											if (is_infinite($cv) || is_nan($cv)) {
												$cv = 0;
											}
											if ($cv > 0) {
												echo fn_number_format($cv, 2) . ' %';
											}
											?></td>
					</tr>
				</table>
			</div>
			<!-- End Yarn Cost part report here ------------------------------------------- -->

			<table width="100%" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" style="font-family:Arial Narrow;">
				<caption> <strong style="float:left"> Stripe Details</strong></caption>
				<?
				$sql_cov_stripe = "select  b.id,b.conv_cost_dtls_id,b.fabric_cost_dtls_id,b.gmts_color_id,b.fabric_color_id,b.cons,b.unit_charge,c.stripe_color,d.body_part_id ,c.color_number_id,c.id as did
			from wo_pre_cost_fab_conv_cost_dtls a, wo_pre_cos_conv_color_dtls b ,wo_pre_stripe_color c ,wo_pre_cost_fabric_cost_dtls d
			where a.id=b.conv_cost_dtls_id and a.fabric_description=b.fabric_cost_dtls_id and a.fabric_description=c.pre_cost_fabric_cost_dtls_id and b.fabric_cost_dtls_id=c.pre_cost_fabric_cost_dtls_id  and b.gmts_color_id=c.color_number_id and b.fabric_color_id=c.stripe_color and d.id=c.pre_cost_fabric_cost_dtls_id and b.job_no='$job_no'  and a.status_active=1 and b.status_active=1 and c.status_active=1  order by b.id";
				$cov_stripe_data = sql_select($sql_cov_stripe);
				foreach ($cov_stripe_data as $row) {

					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['unit_charge'][$row[csf('did')]] = $row[csf('unit_charge')];
				}
				$color_name_arr = return_library_array("select id,color_name from lib_color where status_active=1 and is_deleted=0", 'id', 'color_name');
				$sql_stripe = "SELECT c.id,c.composition,c.construction,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,sum(b.grey_fab_qnty) as fab_qty,b.dia_width,d.color_number_id as color_number_id,d.id as did,d.stripe_color,d.fabreqtotkg as fabreqtotkg ,d.measurement as measurement ,d.yarn_dyed,d.uom,avg(b.rate) as  rate from wo_booking_dtls b, wo_pre_cost_fabric_cost_dtls c,wo_pre_stripe_color d where c.id=b.pre_cost_fabric_cost_dtls_id and c.job_no=b.job_no and d.pre_cost_fabric_cost_dtls_id=c.id and d.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and b.job_no=d.job_no and b.job_no='$job_no'  and d.job_no='$job_no'   and c.color_type_id in (2,3,4,6,32,33,34)  and b.status_active=1  and c.is_deleted=0 and c.status_active=1  and d.is_deleted=0 and d.status_active=1  and 	b.is_deleted=0  group by c.id,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,d.color_number_id,d.id,d.stripe_color,d.yarn_dyed,d.fabreqtotkg ,d.measurement,d.uom,c.composition,c.construction,b.dia_width order by d.id ";
				//echo $sql_stripe; die;
				$result_data = sql_select($sql_stripe);
				foreach ($result_data as $row) {
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['stripe_color'][$row[csf('did')]] = $row[csf('stripe_color')];
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['measurement'][$row[csf('did')]] = $row[csf('measurement')];
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['uom'][$row[csf('did')]] = $row[csf('uom')];
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['fabreqtotkg'][$row[csf('did')]] = $row[csf('fabreqtotkg')];
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['rate'][$row[csf('did')]] = $row[csf('rate')];
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['yarn_dyed'][$row[csf('did')]] = $row[csf('yarn_dyed')];

					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['composition'] = $row[csf('composition')];
					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['construction'] = $row[csf('construction')];
					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['gsm_weight'] = $row[csf('gsm_weight')];
					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['color_type_id'] = $row[csf('color_type_id')];
					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['dia_width'] = $row[csf('dia_width')];
					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['fabreqtotkg'] += $row[csf('fabreqtotkg')];
				}
				?>

				<tr>
					<th width="30"> SL</th>
					<th width="100"> Body Part</th>
					<th width="80"> Fabric Color</th>
					<th width="70"> Fabric Qty(KG)</th>
					<th width="70"> Stripe Color</th>
					<th width="70"> Stripe Measurement</th>
					<th width="70"> Stripe Uom</th>
					<th width="70"> Qty.(KG)</th>
					<th width="70"> Rate</th>
					<th width="100">Amount</th>
				</tr>
				<?
				//if($db_type==0) $color_cond="d.fabric_color_id='".$color_id."'";
				//else if($db_type==2) $color_cond="nvl(d.fabric_color_id,0)=nvl('".$color_id."',0)";
				//else if($db_type==2) $color_cond="nvl(d.fabric_color_id,0)=nvl('".$color_id."',0)";


				$i = 1;
				$total_fab_qty = 0;
				$total_fabreqtotkg = 0;
				$fab_data_array = array();
				$total_fabamount = 0;
				$rows = 0;
				foreach ($stripe_arr as $body_id => $body_data) {
					foreach ($body_data as $color_id => $color_val) {
						$rowspan = count($color_val['stripe_color']);
						$composition = $stripe_arr2[$body_id][$color_id]['composition'];
						$construction = $stripe_arr2[$body_id][$color_id]['construction'];
						$gsm_weight = $stripe_arr2[$body_id][$color_id]['gsm_weight'];
						$color_type_id = $stripe_arr2[$body_id][$color_id]['color_type_id'];
						$dia_width = $stripe_arr2[$body_id][$color_id]['dia_width'];


				?>
						<tr>
							<?
							//$color_qty=$stripe_arr2[$body_id][$color_id]['fabreqtotkg'];//$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
							$color_qty = array_sum($stripe_arr[$body_id][$color_id]['fabreqtotkg']);
							?>
							<td rowspan="<? echo $rowspan; ?>"> <? echo $i; ?></td>
							<td rowspan="<? echo $rowspan; ?>"> <? echo $body_part[$body_id]; ?></td>
							<td rowspan="<? echo $rowspan; ?>"> <? echo $color_name_arr[$color_id]; ?></td>
							<td rowspan="<? echo $rowspan; ?>" align="right"> <? echo number_format($color_qty, 2); ?></td>
							<?
							$total_fab_qty += $color_qty;
							foreach ($color_val['stripe_color'] as $strip_color_id => $s_color_val) {
								$measurement = $color_val['measurement'][$strip_color_id];
								$uom = $color_val['uom'][$strip_color_id];
								$fabreqtotkg = $color_val['fabreqtotkg'][$strip_color_id];
								$rate = $color_val['rate'][$strip_color_id];
								$unit_charge = $color_val['unit_charge'][$strip_color_id];
								$yarn_dyed = $color_val['yarn_dyed'][$strip_color_id];
							?>
								<td><? echo  $color_name_arr[$s_color_val]; ?></td>
								<td align="right"> <? echo  number_format($measurement, 2); ?></td>
								<td> <? echo  $unit_of_measurement[$uom]; ?></td>
								<td align="right"> <? echo  number_format($fabreqtotkg, 2); ?></td>
								<td align="right"> <? echo  number_format($unit_charge, 2); ?></td>
								<td align="right"> <? echo number_format($fabreqtotkg * $unit_charge, 2); ?></td>
						</tr>
			<?
								$total_fabreqtotkg += $fabreqtotkg;
								$total_fabamount += $fabreqtotkg * $unit_charge;;
								$total_rate += $rate;
								$rows += 1;
							}
							$i++;
						}
					}
			?>
			<tfoot>
				<tr>
					<td colspan="3">Total </td>
					<td align="right"> <? echo  number_format($total_fab_qty, 2); ?> </td>
					<td></td>
					<td></td>
					<td> </td>
					<td align="right"><? echo  number_format($total_fabreqtotkg, 2); ?> </td>
					<td align="right"></td>
					<td align="right"><? echo  number_format($total_fabamount, 2); ?></td>
				</tr>
			</tfoot>
			</table>
			<?


			//start	Trims Cost part report here -------------------------------------------
			$supplier_library_fabric = return_library_array("select a.id, a.supplier_name from lib_supplier a where a.is_deleted=0  and a.status_active=1 group by a.id,a.supplier_name order by a.supplier_name", "id", "supplier_name");

			$sql = "select id, job_no, trim_group,description,brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp_multi, status_active from wo_pre_cost_trim_cost_dtls  where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
			$data_array = sql_select($sql);
			?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px;text-align:center;font-family: 'Arial Narrow', Arial, sans-serif;" rules="all">

					<label style="float:left;background:#CCCCCC; font-size:larger"><b>Trims Details</b> </label>
					<tr style="font-weight:bold; background: #D7ECD9">
						<td width="110" style="background: #D7ECD9">Item Group</td>
						<td width="110" style="background: #D7ECD9">Item Description</td>
						<td width="100" style="background: #D7ECD9">Supplier</td>
						<td width="60" style="background: #D7ECD9">UOM</td>
						<td width="80" style="background: #D7ECD9">Cons/<?= $costing_for; ?>[Qnty]</td>
						<td width="100" style="background: #D7ECD9">TTL Required[Qnty]</td>
						<td width="80" style="background: #D7ECD9">Rate &#36;</td>
						<td width="80" style="background: #D7ECD9">Amount/<?= $costing_for; ?>&#36;</td>
						<td width="80" style="background: yellow">Amount &#36;</td>
						<td width="60" style="background: #D7ECD9">% to Ord. Value</td>
					</tr>
					<?
					$trim_qty_arr = $trims->getQtyArray_by_precostdtlsid();
					//print_r($trim_qty);
					$trim_amount_arr = $trims->getAmountArray_precostdtlsid();
					$total_trims_cost = 0;
					$total_trims_qty = $total_trims_cost_dzn = 0;
					$total_trims_cost_dzn = 0;
					$total_trims_cost_kg = 0;
					foreach ($data_array as $row) {

						$trim_group = return_library_array("select item_name,id from  lib_item_group where id=" . $row[csf("trim_group")], "id", "item_name");
						$cons_dzn_gmts = $row[csf("cons_dzn_gmts")];
						$amount_dzn = $row[csf("amount")];
						$pre_trims_qty = $trim_qty_arr[$row[csf("id")]];
						$pre_trims_amount = $trim_amount_arr[$row[csf("id")]];

						$nominated_supp_str = "";
						$exsupp = explode("_", $row[csf("nominated_supp_multi")]);
						foreach ($exsupp as $sid) {
							if ($nominated_supp_str == "") $nominated_supp_str = $supplier_library_fabric[$sid];
							else $nominated_supp_str .= ',' . $supplier_library_fabric[$sid];
						}
					?>
						<tr>
							<td align="left"><? echo $trim_group[$row[csf("trim_group")]]; ?></td>
							<td align="left"><? echo $row[csf("description")]; ?></td>
							<td align="left"><?= $nominated_supp_str; ?></td>
							<td align="center"><? echo $unit_of_measurement[$row[csf("cons_uom")]]; ?></td>
							<td align="right"><? echo fn_number_format($cons_dzn_gmts, 3); ?></td>
							<td align="right"><? echo fn_number_format($pre_trims_qty, 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("rate")], 3); ?></td>
							<td align="right"><? echo fn_number_format($amount_dzn, 4); ?></td>
							<td align="right" style="background: yellow"><? echo fn_number_format($pre_trims_amount, 2); ?></td>
							<td align="right" title="<? echo $amount_dzn . '=' . $price_dzn; ?>">
								<?
								$cv = ($amount_dzn / $price_dzn) * 100;
								if (is_infinite($cv) || is_nan($cv)) {
									$cv = 0;
								}
								echo fn_number_format($cv, 2);
								//echo fn_number_format(($amount_dzn/$price_dzn)*100,2); 
								?></td>
						</tr>
					<?
						$total_trims_cost += $pre_trims_amount;
						$total_trims_cost_dzn += $amount_dzn;
						$total_trims_qty += $pre_trims_qty;
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td>Trims Total</td>
						<td colspan="4"></td>
						<td align="right"><? if ($total_trims_qty > 0) {
												echo fn_number_format($total_trims_qty, 4);
											} ?></td>
						<td align="right"><? //echo fn_number_format($total_trims_cost_dzn,4); 
											?></td>

						<td align="right"><? if ($total_trims_cost_dzn > 0) {
												echo '&dollar;' . fn_number_format($total_trims_cost_dzn, 4);
											} ?></td>
						<td align="right" style="background: yellow"><? if ($total_trims_cost > 0) {
																			echo '&dollar;' . fn_number_format($total_trims_cost, 2);
																		} ?></td>
						<td align="right" title="<? echo $total_trims_cost_dzn . '=' . $price_dzn; ?>">
							<?
							$cv = ($total_trims_cost_dzn / $price_dzn) * 100;
							if (is_infinite($cv) || is_nan($cv)) {
								$cv = 0;
							}
							if ($cv) {
								echo fn_number_format($cv, 2) . ' %';
							}
							?>
						</td>
					</tr>
				</table>
			</div>
			<?
			$pre_cost_dtls_arr = sql_select("SELECT id, job_no, costing_per_id, order_uom_id, fabric_cost, fabric_cost_percent, trims_cost,depr_amor_pre_cost,deffdlc_cost,studio_cost,design_cost,trims_cost_percent,embel_cost,embel_cost_percent,comm_cost,comm_cost_percent,commission,incometax_cost,interest_cost,interest_percent,commission_percent,lab_test,lab_test_percent,inspection,inspection_percent,cm_cost,cm_cost_percent,freight,freight_percent,common_oh,common_oh_percent,design_percent, studio_percent, currier_pre_cost, currier_percent, certificate_pre_cost, certificate_percent, total_cost, total_cost_percent, price_dzn, price_dzn_percent, margin_dzn, margin_dzn_percent, price_pcs_or_set, price_pcs_or_set_percent, margin_pcs_set, margin_pcs_set_percent, cm_for_sipment_sche from wo_pre_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0");
			foreach ($pre_cost_dtls_arr as $row) {
				$price_dzn = $row[csf("price_dzn")];
				$lab_test_dzn = $row[csf("lab_test")];
				$commission_cost_dzn = $row[csf("commission")];
				$commercial_cost_dzn = $row[csf("comm_cost")];

				$inspection_dzn = $row[csf("inspection")];
				$cm_cost_dzn = $row[csf("cm_cost")];
				$common_oh_dzn = $row[csf("common_oh")];
				$freight_dzn = $row[csf("freight")];
				$currier_pre_cost_dzn = $row[csf("currier_pre_cost")];
				$currier_per_cost_dzn = $row[csf("currier_percent")];
				$certificate_pre_cost_dzn = $row[csf("certificate_pre_cost")];
				$deffdlc_cost_dzn = $row[csf("deffdlc_cost")];
				$depr_amor_pre_cost_dzn = $row[csf("depr_amor_pre_cost")];
				$interest_cost_dzn = $row[csf("interest_cost")];
				$interest_cost_percent = $row[csf("interest_percent")];
				$incometax_cost_dzn = $row[csf("incometax_cost")];
				$studio_cost_dzn = $row[csf("studio_cost")];
				$design_cost_dzn = $row[csf("design_cost")];
				$studio_cost_percent = $row[csf("studio_percent")];
				$design_cost_percent = $row[csf("design_percent")];

				$other_cost_per = $inspection_dzn + $freight_dzn + $certificate_pre_cost_dzn + $deffdlc_cost_dzn + $design_cost_dzn + $studio_cost_dzn + $common_oh_dzn + $interest_cost_dzn + $incometax_cost_dzn + $depr_amor_pre_cost_dzn;
			}
			?>
			<table class="rpt_table" border="1" align="left" cellpadding="0" width="350" cellspacing="0" rules="all" style="margin-top: 10px;font-family: 'Arial Narrow', Arial, sans-serif;">
				<tr style="background: #D7ECD9">
					<th>MISC/Others Cost</th>
					<th>%</th>
					<th>TTL Cost $</th>
				</tr>
				<tr>
					<td>Test cost</td>
					<td align="right"><?
										$lab_test_per = ($other_costing_arr[$job_no]['lab_test'] / $order_values) * 100;
										if (is_infinite($lab_test_per) || is_nan($lab_test_per)) {
											$lab_test_per = 0;
										}
										if ($lab_test_per > 0) {
											echo fn_number_format($lab_test_per, 2);
										}
										$total_misc_per += $lab_test_per;
										?></td>
					<th align="right"><? if ($other_costing_arr[$job_no]['lab_test'] > 0) {
											echo fn_number_format($other_costing_arr[$job_no]['lab_test'], 2);
										} ?></th>
				</tr>
				<tr>
					<td>Buying commission</td>
					<td align="right"><?
										$commission_cost_per = ($commission_costing_arr[$job_no] / $order_values) * 100;
										if (is_infinite($commission_cost_per) || is_nan($commission_cost_per)) {
											$commission_cost_per = 0;
										}
										if ($commission_cost_per > 0) {
											echo fn_number_format($commission_cost_per, 2);
										}
										$total_misc_per += $commission_cost_per;
										?></td>
					<th align="right"><? if ($commission_costing_arr[$job_no] > 0) {
											echo fn_number_format($commission_costing_arr[$job_no], 2);
										} ?></th>
				</tr>
				<tr>
					<td>Commercial cost</td>
					<td align="right"><?
										$commercial_cost_per = ($commercial_costing_arr[$job_no] / $order_values) * 100;
										if (is_infinite($commercial_cost_per) || is_nan($commercial_cost_per)) {
											$commercial_cost_per = 0;
										}
										if ($commercial_cost_per > 0) {
											echo fn_number_format($commercial_cost_per, 2);
										}
										$total_misc_per += $commercial_cost_per;
										?>
					</td>
					<th align="right"><? if ($commercial_costing_arr[$job_no] > 0) {
											echo fn_number_format($commercial_costing_arr[$job_no], 2);
										} ?></th>
				</tr>
				<tr>
					<td>Courier costs</td>
					<td align="right"><?
										$currier_pre_cost_dzn = $currier_pre_cost_dzn * ($order_job_qnty / 12);
										// $currier_pre_cost_dzn=($currier_pre_cost_dzn/$order_values)*100;
										if (is_infinite($currier_per_cost_dzn) || is_nan($currier_per_cost_dzn)) {
											$currier_per_cost_dzn = 0;
										}
										if ($currier_per_cost_dzn > 0) {
											echo fn_number_format($currier_per_cost_dzn, 2);
										}
										$total_misc_per += $currier_per_cost_dzn;

										?>
					</td>
					<th align="right"><? if ($currier_pre_cost_dzn > 0) {
											echo fn_number_format($currier_pre_cost_dzn, 2);
										} ?></th>
				</tr>
				<tr>
					<td>Sample Fabric Cost</td>
					<td align="right"><?
										$sample_fabric_cost = ($other_costing_arr[$job_no]['studio_cost'] / $order_values) * 100;
										if (is_infinite($sample_fabric_cost) || is_nan($sample_fabric_cost)) {
											$sample_fabric_cost = 0;
										}
										if ($sample_fabric_cost > 0) {
											echo fn_number_format($sample_fabric_cost, 2);
										}
										//$misc_cost +=$other_costing_arr[$job_no]['studio_cost'];
										$total_misc_per += $sample_fabric_cost;
										?>
					</td>
					<th align="right"><? if ($other_costing_arr[$job_no]['studio_cost'] > 0) {
											echo fn_number_format($other_costing_arr[$job_no]['studio_cost'], 2);
										} ?></th>
				</tr>
				<tr>
					<td>Other costs</td>
					<td align="right"><?
										$other_cost_per = ($total_other_cost / $order_values) * 100;
										if (is_infinite($other_cost_per) || is_nan($other_cost_per)) {
											$other_cost_per = 0;
										}
										if ($other_cost_per > 0) {
											echo fn_number_format($other_cost_per, 2);
										}
										$total_misc_per += $other_cost_per;
										?>
					</td>
					<th align="right"><? if ($total_other_cost > 0) {
											echo fn_number_format($total_other_cost, 2);
										} ?></th>
				</tr>
				<tr>
					<th>MISC/Others Cost Sub Total</th>
					<th align="right"><? if ($total_misc_per > 0) {
											echo fn_number_format($total_misc_per, 2) . '%';
										}  ?></th>
					<th align="right"><? if ($misc_cost > 0) {
											echo '&dollar;' . fn_number_format($misc_cost, 2);
										} ?></th>
				</tr>
			</table>
			<br /><br />
			<div>

				<br />
				<?  //echo signature_table(109, $cbo_company_name, "970px");
				?>
				<?
				$width = 990;
				$padding_top = 70;
				$prepared_by = '';
				$sql = sql_select("select designation,name,activities,prepared_by from variable_settings_signature where report_id=109 and company_id=$cbo_company_name order by sequence_no");


				if ($sql[0][csf("prepared_by")] == 1) {
					list($prepared_by, $activities) = explode('**', $prepared_by);
					$sql_2[100] = array(DESIGNATION => 'Prepared By', NAME => $prepared_by, ACTIVITIES => $activities, PREPARED_BY => 0);
					$sql = $sql_2 + $sql;
				}

				$count = count($sql);
				$td_width = floor($width / $count);
				$standard_width = $count * 120;
				if ($standard_width > $width) {
					$td_width = 120;
				}
				$no_coloumn_per_tr = floor($width / $td_width);
				$i = 1;
				if ($count == 0) {
					$message = "<b>Note: This is Software Generated Copy , Signature is not Required.</b>";
				}
				echo '<table id="signatureTblId" width="' . $width . '" style="padding-top:' . $padding_top . 'px;"><tr><td width="100%" height="' . $padding_top . '" colspan="' . $count . '">' . $message . '</td></tr><tr>';
				foreach ($sql as $row) {
					echo '<td width="' . $td_width . '" align="center" valign="top">
		<strong>' . $row[csf("activities")] . '</strong><br>
		<strong style="text-decoration:overline">' . $row[csf("designation")] . "</strong><br>" . $row[csf("name")] . '</td>';
					if ($i % $no_coloumn_per_tr == 0) {
						echo '</tr><tr><td width="100%" height="70" colspan="' . $no_coloumn_per_tr . '"></td></tr>';
					}
					$i++;
				}
				echo '</tr></table>';
				?>
			</div>
		<?
		disconnect($con);
		exit();
	}//test
	
if ($action == "budgetsheet3") {

	
		$process = array(&$_POST);
		extract(check_magic_quote_gpc($process));
		?>
			<style>
				.trims-gallery {
					margin: 5px;
					border: 1px solid #ccc;
					float: left;
				}

				.trims-gallery:hover {
					border: 1px solid #777;
				}
			</style>
			<?

			$country_library = return_library_array("select id,country_name from lib_country", "id", "country_name");

			if ($txt_job_no == "") $job_no = '';
			else $job_no = " and a.job_no=" . $txt_job_no . "";
			$costing_date = str_replace("'", "", $txt_costing_date);
			$txt_color_id = str_replace("'", '', $txt_color_id);
			$txt_po_breack_down_id = str_replace("'", '', $txt_po_breack_down_id);
			$txt_costing_date = change_date_format(str_replace("'", "", $txt_costing_date), 'yyyy-mm-dd', '-');
			if ($cbo_company_name == "") $company_name = '';
			else $company_name = " and a.company_name=" . $cbo_company_name . "";
			if ($cbo_buyer_name == "") $cbo_buyer_name = '';
			else $cbo_buyer_name = " and a.buyer_name=" . $cbo_buyer_name . "";
			if ($txt_style_ref == "") $txt_style_ref = '';
			else $txt_style_ref = " and a.style_ref_no=" . $txt_style_ref . "";
			if ($txt_costing_date == "") $txt_costing_date = '';
			else $txt_costing_date = " and b.costing_date='" . $txt_costing_date . "'";

			if (str_replace("'", '', $txt_po_breack_down_id) == "") {
				$txt_po_breack_down_id_cond = '';
				$txt_po_breack_down_id_cond1 = '';
				$txt_po_breack_down_id_cond2 = '';
				$txt_po_breack_down_id_cond3 = '';
				$txt_po_breack_down_id_cond4 = '';
			} else {
				$selected_po_breack_down_id = str_replace("'", '', $txt_po_breack_down_id);
				$txt_po_breack_down_id_cond = " and b.id in(" . $selected_po_breack_down_id . ")";
				$txt_po_breack_down_id_cond1 = " and c.po_break_down_id in(" . $selected_po_breack_down_id . ")";
				$txt_po_breack_down_id_cond4 = " and  po_break_down_id in(" . $selected_po_breack_down_id . ")";
			}
			if (str_replace("'", '', $txt_color_id) == "") {
				$txt_color_id_cond = '';
				$color_id_cond = "";
			} else {
				$selected_txt_color_id = str_replace("'", '', $txt_color_id);
				$txt_color_id_cond = " and c.color_number_id in(" . $selected_txt_color_id . ")";
				$color_id_cond = " and  color_number_id in(" . $selected_txt_color_id . ")";
			}

			$cm_cost_method_based_on = return_field_value("cm_cost_method_based_on", "variable_order_tracking", "company_name=" . $cbo_company_name . "  and variable_list=22 and status_active=1 and is_deleted=0");
			if ($cm_cost_method_based_on == "") $cm_cost_method_based_on = 1;

			$color_library = return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");

			//array for display name
			$buyer_arr = return_library_array("select id, buyer_name from lib_buyer", 'id', 'buyer_name');
			$comp = return_library_array("select id, company_name from lib_company", 'id', 'company_name');
			$body_part_type_arr = return_library_array("select id, body_part_full_name from lib_body_part", "id", "body_part_full_name");



			$po_qty = 0;
			$po_plun_cut_qty = 0;
			$total_set_qnty = 0;
			$total_fob_value = 0;
			$job_in_orders = '';
			$pulich_ship_date = '';
			$job_in_file = '';
			$job_in_ref = '';
			$sql_po = "SELECT a.job_no,a.location_name, a.total_set_qnty, b.id, b.po_number, b.grouping, b.file_no, b.pub_shipment_date, c.order_total,c.item_number_id, c.country_id, c.color_number_id, c.size_number_id, c.order_quantity, c.plan_cut_qnty,b.unit_price  from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and b.id=c.po_break_down_id and a.job_no =" . $txt_job_no . " $txt_po_breack_down_id_cond $txt_color_id_cond  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 order by b.id";

			$sql_po_data = sql_select($sql_po);
			foreach ($sql_po_data as $sql_po_row) {
				$po_qty += $sql_po_row[csf('order_quantity')];
				$po_plun_cut_qty += $sql_po_row[csf('plan_cut_qnty')];
				$total_set_qnty = $sql_po_row[csf('total_set_qnty')];
				$location_name_id = $sql_po_row[csf('location_name')];
				$po_unit_price_arr[$sql_po_row[csf('unit_price')]] = $sql_po_row[csf('unit_price')];

				$pulich_ship_date = $sql_po_row[csf('pub_shipment_date')];
				$job_in_file .= $sql_po_row[csf('file_no')] . ",";
				$job_in_ref .= $sql_po_row[csf('grouping')] . ",";
				$total_fob_value += $sql_po_row[csf('order_total')];
				$po_id_arr[$sql_po_row[csf('id')]] = $sql_po_row[csf('id')];
				$po_no_arr[$sql_po_row[csf('po_number')]] = $sql_po_row[csf('po_number')];
				$gmts_item_arr[$sql_po_row[csf('id')]][$sql_po_row[csf('color_number_id')]]['gmts_item'] = $sql_po_row[csf('item_number_id')];
			}
			$po_id_str = implode(",", $po_id_arr);
			$poNoArr = implode(",", $po_no_arr);

			$min_max_ship_date = sql_select("select b.job_no_mst, min(b.pub_shipment_date) as min_pub_shipment_date, max(b.pub_shipment_date) as max_pub_shipment_date from wo_po_break_down  b where b.job_no_mst=" . $txt_job_no . " $txt_po_breack_down_id_cond and b.status_active=1 and b.is_deleted=0 group by b.job_no_mst");
			foreach ($min_max_ship_date as $row) {
				$min_pub_ship_date = $row[csf('min_pub_shipment_date')];
				$max_pub_ship_date = $row[csf('max_pub_shipment_date')];
			}
			$shipment_country = sql_select("SELECT country_id from wo_po_color_size_breakdown where job_no_mst=" . $txt_job_no . " and status_active=1 and is_deleted=0 group by country_id");
			foreach ($shipment_country as $row) {
				$all_country_arr[$row[csf('country_id')]] = $country_library[$row[csf('country_id')]];
			}

			$approv_data_array = sql_select(" select a.job_no,b.id,b.approved_by,b.approved_no, b.current_approval_status,b.un_approved_reason, c.user_full_name,c.designation,d.approval_cause from wo_pre_cost_mst a join approval_history b on a.id=b.mst_id join  user_passwd c on b.approved_by=c.id left join fabric_booking_approval_cause d on a.id =d.booking_id  where   b.entry_form=15 $job_no order by b.id asc");

			foreach ($approv_data_array as $row) {
				$current_approval_status = $row[csf('current_approval_status')];
			}

			$fab_knit_req_kg_avg = 0;
			$fab_woven_req_yds_avg = 0;
			$sql_mst = "SELECT a.id as job_id, a.job_no, a.company_name, a.buyer_name, a.style_ref_no, a.quotation_id, a.gmts_item_id, a.order_uom, a.job_quantity, a.avg_unit_price, a.style_description, b.costing_per, b.budget_minute, b.costing_date, b.sew_smv, b.cut_smv, b.sew_effi_percent, b.cut_effi_percent, b.approved, b.exchange_rate, b.remarks, a.qlty_label, a.packing, a.sustainability_standard from wo_po_details_master a , wo_pre_cost_mst b where  a.id=b.job_id and  b.status_active=1 and b.is_deleted=0  and a.status_active=1 and a.job_no=$txt_job_no $company_name $cbo_buyer_name  order by a.job_no";
			//echo $sql_mst; die;
			$data_array = sql_select($sql_mst);

			$uom = "";
			$sew_smv = 0;
			$cut_smv = 0;
			$sew_effi_percent = 0;
			$cut_effi_percent = 0;
			foreach ($data_array as $row) {
				$order_price_per_dzn = 0;
				$order_job_qnty = 0;
				$avg_unit_price = 0;
				$buyer_name = $row[csf("buyer_name")];
				$job_id = $row[csf("job_id")];
				$job_no = $row[csf("job_no")];
				$style_ref_no = $row[csf("style_ref_no")];
				$style_desc = $row[csf("style_description")];
				$uom_id = $row[csf("order_uom")];
				$approved = $row[csf("approved")];
				$budget_minute = $row[csf("budget_minute")];
				$costing_per_id = $row[csf("costing_per")];
				$job_quantity = $row[csf("job_quantity")];
				$quotation_id = $row[csf("quotation_id")];

				if ($txt_color_id !== "" || $txt_po_breack_down_id !== "") {
					$avg_unit_price = array_sum($po_unit_price_arr) / count($po_unit_price_arr);
				} else {
					$avg_unit_price = $row[csf("avg_unit_price")];
				}


				$fab_yarn_req_kg = $row[csf("fab_yarn_req_kg")];
				$remarks = $row[csf("remarks")];
				$qlty_label = $quality_label[$row[csf("qlty_label")]];
				$packing_type = $packing[$row[csf("packing")]];
				$sew_smv = $row[csf("sew_smv")];
				$cut_smv = $row[csf("cut_smv")];
				$costing_date = $row[csf("costing_date")];
				$sew_effi_percent = $row[csf("sew_effi_percent")];
				$cut_effi_percent = $row[csf("cut_effi_percent")];
				$order_values = $row[csf("job_quantity")] * $avg_unit_price;
				$exchange_rate = $row[csf("exchange_rate")];
				$sustainability_standard = $sustainability_standard[$row[csf("sustainability_standard")]];


				$job_in_ref = rtrim($job_in_ref, ", ");
				$job_in_file = rtrim($job_in_file, ", ");
				$job_ref = array_unique(explode(",", $job_in_ref));
				$job_file = array_unique(explode(",", $job_in_file));

			?>
				<table style="width:850px">
					<tr>
						<td align="left"></td>
						<td align="left"><b style="font-size:25px; text-align:center; margin-left:35px"><? echo $comp[str_replace("'", "", $cbo_company_name)]; ?></b></b>
						</td>
					</tr>
					<tr>
						<td align="left"><b style="font-size:18px; text-align:left;">DATE: <? echo change_date_format($costing_date); ?></b></td>
						<td align="left">
							<div style="font-size:18px; width:220px; font-weight:bold; text-align:left; padding:10px; background-color:yellow; color:#00008B;">Factory Pre-Costing Sheet</div>
						</td>
						<td align="left">
							<div style="font-size:18px; width:220px; font-weight:bold; text-align:right; padding:10px;  color:#00FF00;"> <? if ($row[csf("approved")] == 1 || $row[csf("approved")] == 3) {
																																				echo "Approved ";
																																			} else {
																																				echo "";
																																			}
																																			// if($current_approval_status==0) $ap_msg="Approved";
																																			// else $ap_msg="";
																																			// echo $ap_msg;
																																			?></div>
						</td>
					</tr>
				</table>
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px" rules="all">
					<tr>
						<td width="140">Buyer</td>
						<td width="180" style="word-break:break-all"><? echo $buyer_arr[$buyer_name]; ?></td>
						<td rowspan="4" style="text-align: center; background-color:yellow;"><b>Style Ref. <? echo $style_ref_no; ?></b></td>
						<td colspan="2" style="text-align: center; background-color:green;">Condition</td>
					</tr>
					<tr>
						<td>Description</td>
						<td><? echo $style_desc; ?></td>
						<td colspan="2" style="text-align: center; background-color:#ff8c00;">Inspection By</td>
					</tr>
					<tr>
						<td>LC Company</td>
						<td><? echo $comp[str_replace("'", "", $cbo_company_name)]; ?></td>
						<td colspan="2" align="center"><?= $qlty_label ?></td>
					</tr>
					<tr>
						<td>Remarks</td>
						<td><?= $remarks ?></td>
						<td>Packing</td>
						<td><?= $packing_type ?></td>
					</tr>
					<tr>
						<td>Order QTY</td>
						<td><? echo $po_qty . " Pcs"; //$po_qty." ". $unit_of_measurement[$uom_id]; 
							?></td>
						<td rowspan="2" style="text-align: center; background-color:yellow;"><b>Job No-&nbsp;<? echo $job_no; ?></b></td>
						<td>Country</td>
						<td><? echo implode(",", $all_country_arr) ?></td>
					</tr>
					<tr>
						<td>Del</td>
						<td><?= change_date_format($min_pub_ship_date) ?> to <?= change_date_format($max_pub_ship_date) ?></td>
						<td>Plan Cut Qty</td>
						<td><? echo $po_plun_cut_qty . " Pcs"; // $po_plun_cut_qty." ". $unit_of_measurement[$uom_id]; 
							?></td>
					</tr>
					<tr>
						<td>PO</td>
						<td colspan="5">
							<div style="width: 650px;word-wrap: break-word;"><?= $poNoArr ?></div>
						</td>
					</tr>

				</table>
			<?
				$pcs_value = 0;

				$item_ratio_arr = array();
				$item_ratio = "";
				$gmts_item_sql = sql_select("select  count(set_item_ratio) set_item_ratio from  wo_po_details_mas_set_details  where job_no=$txt_job_no");

				foreach ($gmts_item_sql as $gmts_item_row) {
					$item_ratio_arr[$gmts_item_row[csf('gmts_item_id')]] = $gmts_item_row[csf('set_item_ratio')];
					$itemRatio = $gmts_item_row[csf('set_item_ratio')];
				}
				// echo $itemRatio;die;
				unset($gmts_item_sql);

				if ($set_item_ratio == 0 || $set_item_ratio == "") $set_item_ratio = 1;


				if ($costing_per_id == 1) {
					$order_price_per_dzn = 12;
					$costing_for = " DZN";
				} else if ($costing_per_id == 2) {
					$order_price_per_dzn = 1;
					$costing_for = " PCS";
				} else if ($costing_per_id == 3) {
					$order_price_per_dzn = 24;
					$costing_for = " 2 DZN";
				} else if ($costing_per_id == 4) {
					$order_price_per_dzn = 36;
					$costing_for = " 3 DZN";
				} else if ($costing_per_id == 5) {
					$order_price_per_dzn = 48;
					$costing_for = " 4 DZN";
				}
				$order_job_qnty = $job_quantity;
				$avg_unit_price = $avg_unit_price;
			} //end first foearch

			$pcs_value = $order_price_per_dzn * $itemRatio;
			// echo $pcs_value;
			//start	Trims Cost part report here -------------------------------------------


			$wo_pre_cos_fab_co_avg_con_dtls_data = sql_select("SELECT id, wo_pre_cost_trim_cost_dtls_id as pre_cost_trim_cost_dtls, job_no, po_break_down_id, item_number_id, color_number_id, size_number_id, item_size, item_color_number_id, country_id, place, cons, excess_per, tot_cons, ex_cons, rate, amount, pcs, gmts_pcs, color_size_table_id from wo_pre_cost_trim_co_cons_dtls where job_no=$txt_job_no  $color_id_cond $txt_po_breack_down_id_cond4  and status_active=1 and is_deleted=0");

			foreach ($wo_pre_cos_fab_co_avg_con_dtls_data as $val) {
				$gmts_item = $gmts_item_arr[$val[csf('po_break_down_id')]][$val[csf('color_number_id')]]['gmts_item'];
				// $item_ratio=$item_ratio_arr[$gmts_item];

				// $po_order_val=$po_qty*$pcs_value;
				// $RowtotReq=($row[csf('order_quantity')]/$item_ratio)*($val[csf('cons')]/$pcs_value);
				$RowtotReq = ($po_qty / $itemRatio) * ($val[csf('cons')] / $pcs_value);
				$trim_pre_cost_cons_arr[$val[csf('pre_cost_trim_cost_dtls')]]['cons'] = ($RowtotReq / $po_qty);
			}







			$sql_trim = "select id, job_no, trim_group,description,brand_sup_ref,remark, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp,status_active,seq
	from wo_pre_cost_trim_cost_dtls
	where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0 order by seq";
			$data_array_trim = sql_select($sql_trim);
			$TrimData = array();
			foreach ($data_array_trim as $row_trim) {
				if ($txt_color_id !== "" || $txt_po_breack_down_id !== "") {
					$amount = $trim_pre_cost_cons_arr[$row_trim[csf('id')]]['cons'] * $pcs_value * $row_trim[csf('rate')];
				} else {
					$amount = $row_trim[csf("amount")];
				}

				$TrimData[$row_trim[csf('id')]]['trim_group'] = $row_trim[csf('trim_group')];
				$TrimData[$row_trim[csf('id')]]['rate'] = $row_trim[csf('rate')];
				$TrimData[$row_trim[csf('id')]]['amount'] += $amount;
			}
			//End	Trims Cost part report here -------------------------------------------

			$sql_new = "select job_no, comm_cost, comm_cost_percent, commission, commission_percent, lab_test, lab_test_percent, inspection, inspection_percent, cm_cost, cm_cost_percent, freight, freight_percent, currier_pre_cost, currier_percent, certificate_pre_cost, certificate_percent, common_oh, common_oh_percent, depr_amor_pre_cost, total_cost, total_cost_percent, price_dzn, price_dzn_percent, margin_dzn, margin_dzn_percent, price_pcs_or_set, price_pcs_or_set_percent, margin_pcs_set, margin_pcs_set_percent, cm_for_sipment_sche, design_cost, design_percent, studio_cost, studio_percent, deffdlc_cost, interest_cost, incometax_cost from wo_pre_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
			$data_array_new = sql_select($sql_new);
			$labtest_others_attr = array('lab_test', 'inspection', 'freight', 'currier_pre_cost', 'certificate_pre_cost', 'deffdlc_cost', 'design_cost', 'studio_cost', 'common_oh', 'interest_cost', 'incometax_cost', 'depr_amor_pre_cost');

			foreach ($data_array_new as $row_new) {
				foreach ($labtest_others_attr as $attr) {
					$labtest_others_total += $row_new[csf($attr)];
				}
				$cm_cost = $row_new[csf('cm_cost')];
				$commission_cost = $row_new[csf('commission')];
				$commission_rate = $row_new[csf('commission_percent')];
			}

			//Emb cost Cost part report here -------------------------------------------
			$wo_pre_cos_fab_co_avg_con_dtls_data = sql_select("select id, pre_cost_emb_cost_dtls_id, job_no, po_break_down_id, item_number_id, color_number_id, size_number_id, requirment, rate, amount, color_size_table_id, country_id from wo_pre_cos_emb_co_avg_con_dtls where job_no=$txt_job_no $color_id_cond $txt_po_breack_down_id_cond4  order by id");

			foreach ($wo_pre_cos_fab_co_avg_con_dtls_data as $emb_con_row) {

				$gmts_item = $gmts_item_arr[$emb_con_row[csf('po_break_down_id')]][$emb_con_row[csf('color_number_id')]]['gmts_item'];
				$item_ratio = $item_ratio_arr[$gmts_item];
				// $pcs_value=$order_price_per_dzn*$item_ratio;
				// $po_order_val=$po_qty*$pcs_value;
				// $RowtotReq=($row[csf('order_quantity')]/$item_ratio)*($val[csf('cons')]/$pcs_value);	 

				$RowtotReq = ($po_qty / $itemRatio) * ($emb_con_row[csf('requirment')] / $pcs_value);
				$embl_pre_cost_cons_arr[$emb_con_row[csf('pre_cost_emb_cost_dtls_id')]]['cons'] = ($RowtotReq / $po_qty);
			}

			$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pre_cost_embe_cost_dtls where job_no=" . $txt_job_no . " and emb_name in(1,2,4,6,99) and status_active=1 and is_deleted=0";
			$data_array = sql_select($sql);
			foreach ($data_array as $row) {
				$emb_typearr ="";
				if ($row[csf("emb_name")] == 1) $emb_typearr = $emblishment_print_type;
				else if ($row[csf("emb_name")] == 2) $emb_typearr = $emblishment_embroy_type;
				else if ($row[csf("emb_name")] == 4) $emb_typearr = $emblishment_spwork_type;
				else if ($row[csf("emb_name")] == 99) $emb_typearr = $emblishment_other_type_arr;
				if ($row[csf("emb_name")] == 1) {
					//$print_emb_type[$row[csf("emb_type")]] = $emb_typearr[$row[csf("emb_type")]] . '-' . $row[csf("rate")];
					$print_emb_type[$row[csf("emb_type")]] = $emb_typearr[$row[csf("emb_type")]];
					$rate_emb_type[$row[csf("emb_type")]].= $row[csf("rate")].',';
				} else {
					//$other_emb_type[$row[csf("emb_type")]] = $emb_typearr[$row[csf("emb_type")]] . '-' . $row[csf("rate")];
					$other_emb_type[$row[csf("emb_type")]] = $emb_typearr[$row[csf("emb_type")]];
					$rate_other_emb_type[$row[csf("emb_type")]].= $row[csf("rate")].',';
				}
			}
			$EmbData = array();
			$EmbData['Print']['cons_dzn_gmts'] = 0;
			$EmbData['Embroidery / Special Works']['cons_dzn_gmts'] = 0;
			foreach ($data_array as $row) {

				if ($txt_color_id !== "" || $txt_po_breack_down_id !== "") {
					$amount = $embl_pre_cost_cons_arr[$row[csf('id')]]['cons'] * $pcs_value * $row[csf("rate")];
				} else {
					$amount = $row[csf("amount")];
				}

				if ($row[csf("emb_name")] == 1) {
					$emb_type = implode(",", $print_emb_type);
					$emb_rate = implode(",", $rate_emb_type);
					$EmbData['Print']['amount'] += $amount;
					// $emb_typearr = $emblishment_print_type;chop($knit_uom_grey_cons, ",");
					$EmbData['Print']['emb_type'] .= $emblishment_print_type[$row[csf("emb_type")]].'-'.$row[csf("rate")].', ';
					//$EmbData['Print']['rate_emb'] = $emb_rate;
				} else {
					if ($row[csf("emb_name")] == 2) $emb_typearr = $emblishment_embroy_type;
				  	if ($row[csf("emb_name")] == 4) $emb_typearr = $emblishment_spwork_type;
				  	if ($row[csf("emb_name")] == 99) $emb_typearr = $emblishment_other_type_arr;
					//$emb_type = implode(",", $other_emb_type);
					//$emb_rate = implode(",", $rate_other_emb_type);
					$EmbData['Embroidery / Special Works']['amount'] += $amount;
					$EmbData['Embroidery / Special Works']['emb_type'] .=$emb_typearr[$row[csf("emb_type")]].'-'.$row[csf("rate")].', ';
					//$EmbData['Embroidery / Special Works']['rate_emb'] = $emb_rate;

					//$EmbData['Embroidery / Special Works']['emb_type']=$row[csf("emb_type")]
				}
			}

			//End Emb cost Cost part report here 
			//Wash cost Cost part report here 
			$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pre_cost_embe_cost_dtls where job_no=" . $txt_job_no . " and emb_name in(3,5) and status_active=1 and is_deleted=0";
			$data_array = sql_select($sql);
			foreach ($data_array as $row) {
				if ($txt_color_id !== "" || $txt_po_breack_down_id !== "") {
					$amount = $embl_pre_cost_cons_arr[$row[csf('id')]]['cons'] * $pcs_value * $row[csf("rate")];
				} else {
					$amount = $row[csf("amount")];
				}
				$washData['Wash']['amount'] += $amount;
			}
			//End Wash cost Cost part report here
			//Commarcial cost Cost part report here
			$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls  where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
			$data_array = sql_select($sql);
			$Commar_rate = 0;
			foreach ($data_array as $row) {
				$Commar_rate += $row[csf("rate")];
			}
			//End Commarcial cost Cost part report here
			//2	All Fabric Cost part here
			$color_wise_cons_data = sql_select("select  id, po_break_down_id, color_number_id, gmts_sizes, dia_width, item_size, cons,process_loss_percent, requirment, pcs, color_size_table_id, rate, amount, pre_cost_fabric_cost_dtls_id as pre_cost_dtls_id 
		from wo_pre_cos_fab_co_avg_con_dtls where job_no=$txt_job_no $color_id_cond $txt_po_breack_down_id_cond4 and cons>0 order by id");
			foreach ($color_wise_cons_data as $val) {
				$gmts_item = $gmts_item_arr[$val[csf('po_break_down_id')]][$val[csf('color_number_id')]]['gmts_item'];
				$item_ratio = $item_ratio_arr[$gmts_item];
				// $pcs_value=$order_price_per_dzn*$item_ratio;
				// $po_plun_cut_val=$po_plun_cut_qty*$pcs_value;
				$fab_cons_qnty = (($val[csf('requirment')] / $pcs_value) * $po_plun_cut_qty);
				//  echo $pcs_value ."==>". $po_plun_cut_val ."==>".$fab_cons_qnty ."<br>";
				$color_wise_cons_arr[$val[csf('pre_cost_dtls_id')]]['cons'] = ($fab_cons_qnty / ($po_plun_cut_qty));
			}

			$sql = "select a.id, a.seq, a.job_no, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.uom, a.avg_cons, a.avg_cons_yarn, a.fabric_source, a.gsm_weight, a.rate, a.amount, a.avg_finish_cons, a.status_active, a.construction, a.composition from wo_pre_cost_fabric_cost_dtls a where  a.job_no=" . $txt_job_no . "  and a.status_active=1 and a.is_deleted=0  order by seq";
			$data_array = sql_select($sql);

			$conv_sql = sql_select("SELECT b.id, a.charge_unit from wo_pre_cost_fab_conv_cost_dtls a  join wo_pre_cost_fabric_cost_dtls b on a.job_id=b.job_id and a.fabric_description=b.id where b.status_active=1 and b.is_deleted=0 and  a.job_no=" . $txt_job_no . " and a.status_active=1 and a.is_deleted=0 and b.color_type_id=5 and a.cons_process=35");
			$con_charg_rate = array();
			foreach ($conv_sql as $conrow) {
				$con_charg_rate[$conrow[csf('id')]] = $conrow[csf('charge_unit')];
			}

			$knit_fab = "";
			$i = 1;
			$j = 1;
			foreach ($data_array as $row) {
				$uom = $unit_of_measurement[$row[csf("uom")]];
				$item_descrition = $row[csf("construction")] . ", " . $row[csf("composition")] . ", " . $color_type[$row[csf("color_type_id")]] . ", " . $row[csf("gsm_weight")] . ", " . $body_part_type_arr[$row[csf('body_part_id')]] . ", " . $sustainability_standard . ", " . $row[csf("seq")];

				if ($txt_color_id !== "" || $txt_po_breack_down_id !== "") {
					$avgCons = $color_wise_cons_arr[$row[csf('id')]]['cons'] * $pcs_value;
				} else {
					$avgCons = $row[csf("avg_cons")];
				}



				if ($row[csf("fab_nature_id")] == 2) { //knit fabrics
					if ($row[csf('color_type_id')] == 5) {
						$rate = $row[csf("rate")] + $con_charg_rate[$row[csf('id')]];
						$amount = $avgCons * $rate;
					} else {
						$rate = $row[csf("rate")];
						$amount = $avgCons * $rate;
					}
				}
				if ($row[csf("fab_nature_id")] == 3) { //woven fabrics
					if ($row[csf('color_type_id')] == 5) {
						$rate = $row[csf("rate")] + $con_charg_rate[$row[csf('id')]];
						$amount = $avgCons * $rate;
					} else {
						$rate = $row[csf("rate")];
						$amount = $avgCons * $rate;
					}
				}
				// echo   $avgCons ."<br>";
				$fabric_dtls_data_arr[$item_descrition]['description'] = $row[csf("construction")] . ", " . $row[csf("composition")] . ", " . $color_type[$row[csf("color_type_id")]] . ", " . $row[csf("gsm_weight")] . ", " . $body_part_type_arr[$row[csf('body_part_id')]] . ", " . $sustainability_standard;
				// $fabric_dtls_data_arr[$item_descrition]['avg_cons']+=$row[csf("avg_cons")];
				$fabric_dtls_data_arr[$item_descrition]['avg_cons'] += $avgCons;
				$fabric_dtls_data_arr[$item_descrition]['rate'] += $rate;
				$fabric_dtls_data_arr[$item_descrition]['amount'] += $amount;
			}
			foreach ($fabric_dtls_data_arr as $fabdata) {
				$knit_fab .= '<tr>
			<td align="left">' . $i . '</td>
			<td align="left">' . $fabdata['description'] . '</td>
			<td align="right">' . number_format($fabdata['avg_cons'], 8, '.', '') . '</td>
			<td align="right"></td>
			<td align="right">' . fn_number_format($fabdata['rate'], 4) . '</td>
			<td align="right"></td>
			<td align="right">' . fn_number_format($fabdata['amount'], 4) . '</td>
		</tr>';

				$Grandtotalavg_cons += $fabdata['avg_cons'];
				$Grandtotal_rate += $fabdata['rate'];
				$GrandtotalAmount += $fabdata['amount'];
				$grand_total += $fabdata['amount'];
				$i++;
			}

			$knit_fab = '<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<tr><td colspan="7" align="left"><b>1.Fabric Cost  </b></td></tr>
					<tr style="font-weight:bold"  align="center">
						<td width="80">Sl</td>
						<td width="350">Description</td>
						<td width="100">Cons./' . $costing_for . '</td>
						<td width="100"></td>
						<td width="100">Kg/Price</td>
						<td width="100"></td>
						<td width="100">Cost/' . $costing_for . '</td>
					</tr>' . $knit_fab;

			echo $knit_fab;

			$knit_fab_total .= '<tr class="rpt_bottom" style="font-weight:bold">
				<td colspan="2" align="right">Total</td>
				<td align="right">' . fn_number_format(($Grandtotalavg_cons), 4) . '</td>
				<td></td>
				<td align="right">' . fn_number_format(($Grandtotal_rate), 4) . '</td>
				<td align="right"></td>
				<td align="right">' . fn_number_format(($GrandtotalAmount), 4) . '</td>
			</tr></table></div>';
			echo $knit_fab_total;
			//end 	All Fabric Cost part report-------------------------------------------
			//start	Trims Cost part report here -------------------------------------------
			$trim_group = return_library_array("select item_name,id from  lib_item_group", "id", "item_name");
			?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<tr style="font-weight:bold">
						<td colspan="4" align="left">2. Accessories</td>
					</tr>
					<tr style="font-weight:bold">
						<td width="320">Garments Image</td>
						<td width="40">SL</td>
						<td width="250">Item Group</td>
						<td width="100">Cost/<? echo $costing_for; ?></td>
					</tr>
					<?
					$TotalDznAmount = 0;
					$TotalAmount = 0;
					$i = 1;
					foreach ($TrimData as $index => $row) {
						// $row["amount"] old
						if ($i == 1) { ?>
							<tr>
								<td align="left" rowspan="<?= count($TrimData) ?>">
									<?
									$nameArray_img = sql_select("SELECT image_location FROM common_photo_library where master_tble_id=$txt_job_no and form_name='knit_order_entry' and file_type=1");
									$path = ($path) ? $path : '../';

									?>
									<? foreach ($nameArray_img as $inf) { ?>
										<div class="trims-gallery">
											<img src='<? echo $path . $inf[csf("image_location")]; ?>' height='120' width='160' />
										</div>
									<?  } ?>

								</td>
								<td align="left"><? echo $i; ?></td>
								<td align="left"><? echo $trim_group[$row["trim_group"]]; ?></td>
								<td align="right">&dollar;<? echo fn_number_format($row["amount"], 4); ?></td>
							</tr>
						<? } else {
						?>
							<tr>
								<td align="left"><? echo $i; ?></td>
								<td align="left"><? echo $trim_group[$row["trim_group"]]; ?></td>
								<td align="right">&dollar;<? echo fn_number_format($row["amount"], 4); ?></td>
							</tr>
					<?
						}
						$TotalDznAmount += $row["amount"];
						$grand_total += $row["amount"];
						$TotalAmount += $row["tot_amount"];
						$totalcons_dzn_gmts += $row["cons_dzn_gmts"];
						$i++;
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td align="left">Total</td>
						<td align="right"></td>
						<td align="right"></td>
						<td align="right">&dollar;<? echo fn_number_format($TotalDznAmount, 4); ?></td>
					</tr>
				</table>
			</div>
			<?
			//End Trims Cost Part report here -------------------------------------------
			//start	Embellishment Details part report here -------------------------------------------
			?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="
		1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<tr style="font-weight:bold">
						<td width="40">SL</td>
						<td width="400" colspan="">Particulars</td>
						<td width="240" colspan="2">Cost/<? echo $costing_for; ?></td>
					</tr>
					<?
					$TotalDznAmount = 0;
					$TotalAmount = 0;
					$sl = 3;
					$data_array=sql_select($sql);
					foreach ($EmbData as $index => $row) {
						?>
							<tr>
								<td align="left" width="40"><? echo $sl; ?></td>
								<td align="left" width="400"><? echo $index; ?>[<?  $emb_type_result=$row["emb_type"]; echo chop($emb_type_result, ","); ?>]</td>
								<td align="right" width="240" colspan="2" style="font-weight:bold;">&dollar;<? echo fn_number_format($row["amount"], 4); ?></td>
							</tr>
						<?
							$grand_total += $row["amount"];
							$sl++;
						}
						
					
					?>
					<tr>
						<td align="left"><?= $sl++; ?></td>
						<td align="left">CM</td>
						<td align="right" colspan="2" style="font-weight:bold;">&dollar;<? $grand_total += $cm_cost;
																						echo fn_number_format($cm_cost, 4);  ?></td>
					</tr>
					<tr>
						<td align="left"><?= $sl++ ?></td>
						<td align="left">Wash / Gmts Dyeing</td>
						<td align="right" colspan="2" style="font-weight:bold;">&dollar;<? $grand_total += $washData['Wash']['amount'];
																						echo fn_number_format($washData['Wash']['amount'], 4);  ?></td>
					</tr>
					<tr>
						<td align="left"><?= $sl++ ?></td>
						<td align="left" title="lab Test,Inspection,Freight,Courier Cost,Certificate Cost,Deffd. LC/DC Cost,Design Cost,Studio Cost,Opert. Exp.,Interest,Income Tax,Depc. & Amort.">Inspection / Lab test / Others</td>
						<td align="right" colspan="2" style="font-weight:bold;">&dollar;<? $grand_total += $labtest_others_total;
																						echo fn_number_format($labtest_others_total, 4) ?></td>
					</tr>
					<tr>
						<td align="left"><?= $sl++ ?></td>
						<td align="left">Total</td>
						<td align="right" colspan="2" style="font-weight:bold;">&dollar;<?= fn_number_format($grand_total, 2) ?></td>
					</tr>
					<tr>
						<td align="left"><?= $sl++ ?></td>
						<td align="left" style="font-weight:bold;">Commercial Charge</td>
						<td align="right" style="font-weight:bold;">Commercial Charge <?= fn_number_format($Commar_rate, 2) ?>&percnt;</td>
						<td align="right" title="Agreed Price*Commercial Charge% *12" style="font-weight:bold;">&dollar;<?
																														$commercial_charge = $avg_unit_price * ($Commar_rate / 100) * 12;
																														echo fn_number_format($commercial_charge, 2)
																														?></td>
					</tr>
					<tr>
						<td align="left"><?= $sl++ ?></td>
						<td align="left">Commission / Rebate </td>
						<td align="right" style="font-weight:bold;">Commission / Rebate <?= fn_number_format($commission_rate, 2) ?>&percnt;</td>
						<td align="right" colspan="2" style="font-weight:bold;">&dollar;<? $total_commission_cost += $commission_cost;
																						echo fn_number_format($commission_cost, 2);  ?></td>
					</tr>
					<tr>
						<td align="right" colspan="3" style="font-weight:bold;">Grand Total price/dzn</td>
						<td align="right" title="Total+Commercial Charge+Commision/Rebet" style="font-weight:bold;">&dollar;<?= fn_number_format($commercial_charge + $total_commission_cost + $grand_total, 2) ?></td>
					</tr>
					<tr>
						<td align="right" colspan="3" style="font-weight:bold;">Unit Price</td>
						<td align="right" title="Grand Total price/dzn/12" style="font-weight:bold;">&dollar;<?
																												$factory_unit_price = ($commercial_charge + $total_commission_cost + $grand_total) / 12;
																												echo fn_number_format($factory_unit_price, 2)
																												?></td>
					</tr>
					<tr>
						<?
						$factory_profit = $avg_unit_price - $factory_unit_price
						?>
						<td align="right" colspan="3" style="font-weight:bold;">Factory Profit/Unit <?= fn_number_format(($factory_profit / $avg_unit_price) * 100, 2)  ?>&percnt;</td>
						<td align="right" title="Agreed Price-Unit Price" style="font-weight:bold;">&dollar;<?= fn_number_format($factory_profit, 2) ?></td>
					</tr>
					<tr>
						<td align="right" style="color:blue; font-weight:bold;" colspan="3">Final Unit Price</td>
						<td align="right" style="color:blue; font-weight:bold;" title="Factory Profit+Unit Price">&dollar;<?= fn_number_format($factory_profit + $factory_unit_price, 2) ?></td>
					</tr>
					<tr>
						<td align="right" style="color:blue ; font-weight:bold;" colspan="3">Quoted Price/Unit</td>
						<td align="right" style="color:blue ; font-weight:bold;" title="Factory Profit+Unit Price">&dollar;<?= fn_number_format($factory_profit + $factory_unit_price, 2) ?></td>
					</tr>
					<tr>
						<td align="right" style="color:blue ; font-weight:bold;" colspan="3">Target Price/Unit</td>
						<td align="right"></td>
					</tr>
					<tr>
						<td align="right" style="color:blue ; font-weight:bold;" colspan="3">Agreed Price/Unit</td>
						<td align="right" style="font-weight:bold;">&dollar;<?= fn_number_format($avg_unit_price, 2) ?></td>
					</tr>
				</table>
				<?
				$nameArray_request = sql_select("SELECT id, job_id, heading, value_field_one, value_field_two, value_field_three, value_field_four from wo_pre_cost_fabric_price_dtls where job_id=$job_id order by id ASC");
				?>
				<table id="fabric_price_date_tbl" cellspacing="0" cellpadding="0" border="1" rules="all" width="650" class="rpt_table" style="margin-top:10px ;">
					<? if (count($nameArray_request) > 0) {
						$i = 1;
						foreach ($nameArray_request as $row) {
							if ($i <= 2) {
					?>
								<tr>
									<td><strong><?= $row[csf('heading')] ?></td>
									<td><strong><?= $row[csf('value_field_one')] ?></strong></td>
									<td><strong><?= $row[csf('value_field_two')] ?></strong></td>
									<td><strong><?= $row[csf('value_field_three')] ?></strong></td>
									<td><strong><?= $row[csf('value_field_four')] ?></strong></td>
								</tr>
							<? } else if ($i > 2 && $i < 14) { ?>
								<tr>
									<td><strong><?= $row[csf('heading')] ?></strong></td>
									<td><?= $row[csf('value_field_one')] ?></td>
									<td><?= $row[csf('value_field_two')] ?></td>
									<td><?= $row[csf('value_field_three')] ?></td>
									<td><?= $row[csf('value_field_four')] ?></td>
								</tr>
							<?
								$total_field_one += $row[csf('value_field_one')] * 1;
								$total_field_two += $row[csf('value_field_two')] * 1;
								$total_field_three += $row[csf('value_field_three')] * 1;
								$total_field_four += $row[csf('value_field_four')] * 1;
							} else {
							?>
								<tr>
									<td><strong><?= $row[csf('heading')] ?></strong></td>
									<td><?= $row[csf('value_field_one')] ?></td>
									<td><?= $row[csf('value_field_two')] ?></td>
									<td><?= $row[csf('value_field_three')] ?></td>
									<td><?= $row[csf('value_field_four')] ?></td>
								</tr>
						<?
								$wastage_field_one = $total_field_one * ($row[csf('value_field_one')] / 100) * 1;
								$wastage_field_two = $total_field_two * ($row[csf('value_field_two')] / 100) * 1;
								$wastage_field_three = $total_field_three * ($row[csf('value_field_three')] / 100) * 1;
								$wastage_field_four = $total_field_four * ($row[csf('value_field_four')] / 100) * 1;
							}
							$i++;
						}
						?>
						<tr>
							<td><strong>Total</strong></td>
							<td><?= $total_field_one ?></td>
							<td><?= $total_field_two ?></td>
							<td><?= $total_field_three ?></td>
							<td><?= $total_field_four ?></td>
						</tr>
						<tr>
							<td><strong>wastage % price</strong></td>
							<td><?= number_format($wastage_field_one, 2) ?></td>
							<td><?= number_format($wastage_field_two, 2) ?></td>
							<td><?= number_format($wastage_field_three, 2) ?></td>
							<td><?= number_format($wastage_field_four, 2) ?></td>
						</tr>
						<tr>
							<td><strong>Fabric Price</strong></td>
							<td><?= number_format($total_field_one + $wastage_field_one, 2) ?></td>
							<td><?= number_format($total_field_two + $wastage_field_two, 2) ?></td>
							<td><?= number_format($total_field_three + $wastage_field_three, 2) ?></td>
							<td><?= number_format($total_field_four + $wastage_field_four, 2) ?></td>
						</tr>
				</table>
			<? } ?>

			</div>
			<?

			//End Commission Cost Part report here -------------------------------------------
			echo signature_table(109, $cbo_company_name, "860px");
			$mailBody = ob_get_contents();
			ob_clean();
			echo $mailBody;
			//------------------------------------End;
			exit();
		}

if ($action == "ocsReport") {
	$process = array(&$_POST);
	extract(check_magic_quote_gpc($process));
	if ($txt_job_no == "") $job_no = '';
	else $job_no = " and a.job_no=" . $txt_job_no . "";
	$costing_date = str_replace("'", "", $txt_costing_date);

	$txt_costing_date = change_date_format(str_replace("'", "", $txt_costing_date), 'yyyy-mm-dd', '-');
	if ($cbo_company_name == "") $company_name = '';
	else $company_name = " and a.company_name=" . $cbo_company_name . "";
	if ($cbo_buyer_name == "") $cbo_buyer_name = '';
	else $cbo_buyer_name = " and a.buyer_name=" . $cbo_buyer_name . "";
	if ($txt_style_ref == "") $txt_style_ref = '';
	else $txt_style_ref = " and a.style_ref_no=" . $txt_style_ref . "";
	if ($txt_costing_date == "") $txt_costing_date = '';
	else $txt_costing_date = " and b.costing_date='" . $txt_costing_date . "'";

	if (str_replace("'", '', $txt_po_breack_down_id) == "") {
		$txt_po_breack_down_id_cond = '';
		$txt_po_breack_down_id_cond1 = '';
		$txt_po_breack_down_id_cond2 = '';
		$txt_po_breack_down_id_cond3 = '';
	} else {
		$selected_po_breack_down_id = str_replace("'", '', $txt_po_breack_down_id);
		$txt_po_breack_down_id_cond = " and b.id in(" . $selected_po_breack_down_id . ")";
		$txt_po_breack_down_id_cond1 = " and id in(" . $selected_po_breack_down_id . ")";
	}

	$cm_cost_method_based_on = return_field_value("cm_cost_method_based_on", "variable_order_tracking", "company_name=" . $cbo_company_name . "  and variable_list=22 and status_active=1 and is_deleted=0");
	if ($cm_cost_method_based_on == "") $cm_cost_method_based_on = 1;
	/*
$sql_data=sql_select("select yarn_iss_with_serv_app from variable_order_tracking where company_name=".$cbo_company_name." and variable_list=67 and status_active=1 and is_deleted=0");
foreach($sql_data as $sql_row)
{
$location_cpm_cost=$sql_row[csf('yarn_iss_with_serv_app')];
}*/
	$color_library = return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$location_cpm_cost = 0;
	$cm_min_variable = return_field_value("yarn_iss_with_serv_app as cost_per_minute", "variable_order_tracking", "company_name =" . $cbo_company_name . " and variable_list=67 and is_deleted=0 and status_active=1", "cost_per_minute");
	if ($cm_min_variable == "" || $cm_min_variable == 0) $location_cpm_cost = 0;
	else $location_cpm_cost = $cm_min_variable;

	//array for display name
	$buyer_arr = return_library_array("select id, buyer_name from lib_buyer", 'id', 'buyer_name');
	$comp = return_library_array("select id, company_name from lib_company", 'id', 'company_name');

	//$gsm_weight_top=return_field_value("gsm_weight", "wo_pre_cost_fabric_cost_dtls", "job_no=$txt_job_no and body_part_id=1");
	//$gsm_weight_bottom=return_field_value("gsm_weight", "wo_pre_cost_fabric_cost_dtls", "job_no=$txt_job_no and body_part_id=20");
	if ($db_type == 0) $group_gsm = "group_concat( distinct b.gsm_weight) AS gsm_weight";
	if ($db_type == 2) $group_gsm = "listagg(b.gsm_weight ,',') within group (order by b.gsm_weight) AS gsm_weight";

	$gsm_weight_top = return_field_value("$group_gsm", "lib_body_part a,wo_pre_cost_fabric_cost_dtls b", "a.id=b.body_part_id and b.job_no=$txt_job_no and a.body_part_type=1 and b.status_active=1 and b.is_deleted=0", "gsm_weight");
	$gsm_weight_bottom = return_field_value("$group_gsm", "lib_body_part a,wo_pre_cost_fabric_cost_dtls b", "a.id=b.body_part_id and b.job_no=$txt_job_no and a.body_part_type=20 and b.status_active=1 and b.is_deleted=0", "gsm_weight");


	$po_qty = 0;
	$po_plun_cut_qty = 0;
	$total_set_qnty = 0;
	$total_fob_value = 0;
	$job_in_orders = '';
	$pulich_ship_date = '';
	$job_in_file = '';
	$job_in_ref = '';
	$sql_po = "select a.job_no,a.location_name, a.total_set_qnty, b.id, b.po_number, b.grouping, b.file_no, b.pub_shipment_date, c.order_total,c.item_number_id, c.country_id, c.color_number_id, c.size_number_id, c.order_quantity, c.plan_cut_qnty  from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and b.id=c.po_break_down_id and a.job_no =" . $txt_job_no . " $txt_po_breack_down_id_cond and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 order by b.id";

	$sql_po_data = sql_select($sql_po);
	foreach ($sql_po_data as $sql_po_row) {
		$po_qty += $sql_po_row[csf('order_quantity')];
		$po_plun_cut_qty += $sql_po_row[csf('plan_cut_qnty')];
		$total_set_qnty = $sql_po_row[csf('total_set_qnty')];
		$location_name_id = $sql_po_row[csf('location_name')];

		$job_in_orders .= $sql_po_row[csf('po_number')] . ",";
		$pulich_ship_date = $sql_po_row[csf('pub_shipment_date')];
		$job_in_file .= $sql_po_row[csf('file_no')] . ",";
		$job_in_ref .= $sql_po_row[csf('grouping')] . ",";
		$total_fob_value += $sql_po_row[csf('order_total')];
		$po_id_arr[$sql_po_row[csf('id')]] = $sql_po_row[csf('id')];
	}
	$job_in_orders = implode(", ", array_unique(explode(",", substr(trim($job_in_orders), 0, -1))));
	$po_id_str = implode(",", $po_id_arr);
	//echo $location_name_id.'DDD';

	$sales_contract_sql = sql_select("SELECT a.contract_no,b.wo_po_break_down_id from com_sales_contract a join com_sales_contract_order_info b on a.id=b.com_sales_contract_id where a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.wo_po_break_down_id in ($po_id_str) group by a.contract_no, b.wo_po_break_down_id");
	$sales_contract_arr = array();
	if (count($sales_contract_sql) > 0) {
		foreach ($sales_contract_sql as $key => $row) {
			$sales_contract_arr[$row[csf('wo_po_break_down_id')]] = $row[csf('contract_no')];
		}
	}

	$export_lc_sql = sql_select("SELECT a.export_lc_no,b.wo_po_break_down_id from com_export_lc a join com_export_lc_order_info b on a.id=b.com_export_lc_id where a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.wo_po_break_down_id in ($po_id_str) group by a.export_lc_no,b.wo_po_break_down_id");
	$export_lc_arr = array();
	if (count($export_lc_sql) > 0) {
		foreach ($export_lc_sql as $key => $row) {
			$export_lc_arr[$row[csf('wo_po_break_down_id')]] = $row[csf('export_lc_no')];
		}
	}
	$sc_lc_no = "";
	if (count($sales_contract_arr) > 0) {
		$sc_lc_no = implode(",", $sales_contract_arr);
	}
	if (count($export_lc_arr) > 0) {
		$sc_lc_no = implode(",", $export_lc_arr);
	}


	$gmtsitem_ratio_array = array();
	$gmtsitem_ratio_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no =" . $txt_job_no . ""); // where job_no ='FAL-14-01157'
	foreach ($gmtsitem_ratio_sql as $gmtsitem_ratio_sql_row) {
		$gmtsitem_ratio_array[$gmtsitem_ratio_sql_row[csf('job_no')]][$gmtsitem_ratio_sql_row[csf('gmts_item_id')]] = $gmtsitem_ratio_sql_row[csf('set_item_ratio')];
	}
	$cm_cost_based_on_date = "";
	if ($cm_cost_method_based_on == 1) {
		if ($db_type == 0) $cm_cost_based_on_date = change_date_format($costing_date, "yyyy-mm-dd", "-");
		if ($db_type == 2) $cm_cost_based_on_date = change_date_format($costing_date, "yyyy-mm-dd", "-", 1);
	} else if ($cm_cost_method_based_on == 2) {
		$min_shipment_sql = sql_select("select job_no_mst, min(shipment_date) as min_shipment_date from wo_po_break_down where job_no_mst=" . $txt_job_no . " $txt_po_breack_down_id_cond1 and status_active=1 and is_deleted=0 group by job_no_mst");
		$min_shipment_date = "";
		foreach ($min_shipment_sql as $row) {
			$min_shipment_date = $row[csf('min_shipment_date')];
		}

		if ($db_type == 0) $cm_cost_based_on_date = change_date_format($min_shipment_date, "yyyy-mm-dd", "-");
		if ($db_type == 2) $cm_cost_based_on_date = change_date_format($min_shipment_date, "yyyy-mm-dd", "-", 1);
	} else if ($cm_cost_method_based_on == 3) {
		$max_shipment_sql = sql_select("select job_no_mst, max(shipment_date) as max_shipment_date from wo_po_break_down where job_no_mst=" . $txt_job_no . " and status_active=1 and is_deleted=0 $txt_po_breack_down_id_cond1 group by job_no_mst");
		$max_shipment_date = "";
		foreach ($max_shipment_sql as $row) {
			$max_shipment_date = $row[csf('max_shipment_date')];
		}

		if ($db_type == 0) $cm_cost_based_on_date = change_date_format($max_shipment_date, "yyyy-mm-dd", "-");
		if ($db_type == 2) $cm_cost_based_on_date = change_date_format($max_shipment_date, "yyyy-mm-dd", "-", 1);
	} else if ($cm_cost_method_based_on == 4) {

		$max_shipment_sql = sql_select("select job_no_mst, min(pub_shipment_date) as min_pub_shipment_date from wo_po_break_down where job_no_mst=" . $txt_job_no . " and status_active=1 and is_deleted=0 $txt_po_breack_down_id_cond1 group by job_no_mst");
		$min_pub_shipment_date = "";
		foreach ($max_shipment_sql as $row) {
			$min_pub_shipment_date = $row[csf('min_pub_shipment_date')];
		}

		if ($db_type == 0) $cm_cost_based_on_date = change_date_format($min_pub_shipment_date, "yyyy-mm-dd", "-");
		if ($db_type == 2) $cm_cost_based_on_date = change_date_format($min_pub_shipment_date, "yyyy-mm-dd", "-", 1);
	} else if ($cm_cost_method_based_on == 5) {
		$max_shipment_sql = sql_select("select job_no_mst, max(pub_shipment_date) as max_pub_shipment_date from wo_po_break_down where job_no_mst=" . $txt_job_no . " and status_active=1 and is_deleted=0 $txt_po_breack_down_id_cond1 group by job_no_mst");
		$max_pub_shipment_date = "";
		foreach ($max_shipment_sql as $row) {
			$max_pub_shipment_date = $row[csf('max_pub_shipment_date')];
		}

		if ($db_type == 0) $cm_cost_based_on_date = change_date_format($max_pub_shipment_date, "yyyy-mm-dd", "-");
		if ($db_type == 2) $cm_cost_based_on_date = change_date_format($max_pub_shipment_date, "yyyy-mm-dd", "-", 1);
	}
	$financial_para = array();

	if ($location_cpm_cost != 1) {
		$sql_std_para = sql_select("select interest_expense, income_tax, cost_per_minute, applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$cbo_company_name and status_active=1 and is_deleted=0 order by id");

		foreach ($sql_std_para as $row) {
			$applying_period_date = change_date_format($row[csf('applying_period_date')], '', '', 1);
			$applying_period_to_date = change_date_format($row[csf('applying_period_to_date')], '', '', 1);
			$diff = datediff('d', $applying_period_date, $applying_period_to_date);
			for ($j = 0; $j < $diff; $j++) {
				//$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);
				$date_all = add_date(str_replace("'", "", $applying_period_date), $j);
				$newdate = change_date_format($date_all, '', '', 1);
				$financial_para[$newdate][interest_expense] = $row[csf('interest_expense')];
				$financial_para[$newdate][income_tax] = $row[csf('income_tax')];
				$financial_para[$newdate][cost_per_minute] = $row[csf('cost_per_minute')];
			}
		}
	} else {
		$sql_std_para = sql_select("select a.id, b.id as dtls_id, b.location_id, b.applying_period_date, b.applying_period_to_date, b.monthly_cm_expense, b.no_factory_machine, b.working_hour, b.cost_per_minute from lib_standard_cm_entry a, lib_standard_cm_entry_dtls b where a.id=b.mst_id and b.location_id=$location_name_id and a.company_id=$cbo_company_name");
		foreach ($sql_std_para as $row) {
			$applying_period_date = change_date_format($row[csf('applying_period_date')], '', '', 1);
			$applying_period_to_date = change_date_format($row[csf('applying_period_to_date')], '', '', 1);
			$diff = datediff('d', $applying_period_date, $applying_period_to_date);
			for ($j = 0; $j < $diff; $j++) {
				$date_all = add_date(str_replace("'", "", $applying_period_date), $j);
				$newdate = change_date_format($date_all, '', '', 1);
				$financial_para[$newdate][interest_expense] = $row[csf('interest_expense')];
				$financial_para[$newdate][income_tax] = $row[csf('income_tax')];
				$financial_para[$newdate][cost_per_minute] = $row[csf('cost_per_minute')];
			}
		}
	}
	$fab_knit_req_kg_avg = 0;
	$fab_woven_req_yds_avg = 0;
	$sql_mst = "SELECT a.job_no, a.company_name, a.buyer_name, a.style_ref_no, a.quotation_id, a.gmts_item_id, a.order_uom, a.job_quantity, a.avg_unit_price,a.style_description, b.costing_per, b.budget_minute,b.costing_date, b.sew_smv, b.cut_smv, b.sew_effi_percent, b.cut_effi_percent, b.approved, c.fab_knit_req_kg, c.fab_knit_fin_req_kg, c.fab_woven_req_yds, c.fab_woven_fin_req_yds, c.fab_yarn_req_kg, d.margin_pcs_bom, d.cost_pcs_set from wo_po_details_master a , wo_pre_cost_mst b , wo_pre_cost_dtls d , wo_pre_cost_sum_dtls c  where  a.id=b.job_id and  a.id=d.job_id  and a.id=c.job_id and c.status_active=1 and c.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and a.status_active=1 and b.status_active=1 and b.is_deleted=0 and d.job_no=$txt_job_no $job_no $company_name $cbo_buyer_name  order by a.job_no";
	// echo $sql_mst; die;
	$data_array = sql_select($sql_mst);
	$po_plan_quantity = 0;
	$result_sql = sql_select("select po_number,grouping,file_no,plan_cut,pub_shipment_date from wo_po_break_down where job_no_mst=$txt_job_no and status_active=1 and is_deleted=0 $txt_po_breack_down_id_cond1 order by pub_shipment_date DESC");

	foreach ($result_sql as $val) {

		$po_plan_quantity += $val[csf('plan_cut')];
	}

	$uom = "";
	$sew_smv = 0;
	$cut_smv = 0;
	$sew_effi_percent = 0;
	$cut_effi_percent = 0;
	foreach ($data_array as $row) {
		$order_price_per_dzn = 0;
		$order_job_qnty = 0;
		$avg_unit_price = 0;
		$buyer_name = $row[csf("buyer_name")];
		$style_ref_no = $row[csf("style_ref_no")];
		$style_desc = $row[csf("style_description")];
		$uom_id = $row[csf("order_uom")];
		$approved = $row[csf("approved")];
		$budget_minute = $row[csf("budget_minute")];
		$costing_per_id = $row[csf("costing_per")];
		$job_quantity = $row[csf("job_quantity")];
		$quotation_id = $row[csf("quotation_id")];
		$margin_pcs_bom = $row[csf("margin_pcs_bom")];
		$cost_pcs_set = $row[csf("cost_pcs_set")];
		$avg_unit_price = $row[csf("avg_unit_price")];
		$fab_yarn_req_kg = $row[csf("fab_yarn_req_kg")];
		//echo $buyer_name.'DDDDD';

		$sew_smv = $row[csf("sew_smv")];
		$cut_smv = $row[csf("cut_smv")];
		$costing_date = $row[csf("costing_date")];
		$sew_effi_percent = $row[csf("sew_effi_percent")];
		$cut_effi_percent = $row[csf("cut_effi_percent")];
		$order_values = $row[csf("job_quantity")] * $avg_unit_price;


		//$job_in_orders = substr(trim($job_in_orders),0,-1);
		$job_in_ref = rtrim($job_in_ref, ", ");
		$job_in_file = rtrim($job_in_file, ", ");
		$job_ref = array_unique(explode(",", $job_in_ref));
		$job_file = array_unique(explode(",", $job_in_file));

		foreach ($job_ref as $ref) {
			$ref_cond .= ", " . $ref;
		}
		$file_con = '';
		foreach ($job_file as $file) {
			if ($file_con == '') $file_cond = $file;
			else $file_cond .= ", " . $file;
		}

		$condition = new condition();
		if (str_replace("'", "", $txt_job_no) != '') {
			$condition->job_no("=$txt_job_no");
		}
		if (str_replace("'", '', $txt_po_breack_down_id) != "") {
			$condition->po_id("in($selected_po_breack_down_id)");
		}

		$condition->init();
		$fabric = new fabric($condition);

		$yarn = new yarn($condition);
		$conversion = new conversion($condition);
		$trim = new trims($condition);
		$emblishment = new emblishment($condition);
		$wash = new wash($condition);
		$other = new other($condition);
		$other_cost = $other->getAmountArray_by_job();
		//$trims_cost_arr=$trim->getQtyArray_by_orderAndItemidTypeid();
		//print_r($trims_cost_arr);
		$commercial = new commercial($condition);
		$commision = new commision($condition);


		//Fabric =====================
		$fabric_qty = $fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
		$fabric_amount = $fabric->getAmountArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
		$sql_fabric = "select id, job_no, body_part_id, fab_nature_id, color_type_id, fabric_description,uom, avg_cons,avg_cons_yarn, fabric_source,gsm_weight, rate, amount, avg_finish_cons, status_active from wo_pre_cost_fabric_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
		$data_arr_fabric = sql_select($sql_fabric);
		$summary_data = array();
		foreach ($data_arr_fabric as $fab_row) {
			$summary_data[fabric_cost][$fab_row[csf("id")]] = $fab_row[csf("amount")];
			$summary_data[fabric_cost_job] += $fabric_amount['knit']['grey'][$fab_row[csf("id")]][$fab_row[csf("uom")]];
			$summary_data[fabric_cost_job] += $fabric_amount['woven']['grey'][$fab_row[csf("id")]][$fab_row[csf("uom")]];
		}

		//Fabric End======================




		//Yarn===========================
		$totYarn = 0;
		$YarnData = array();
		$yarn_data_array = $yarn->get_By_Precostdtlsid_YarnQtyAmountArray();
		$sql_yarn = "select f.id as yarn_id, f.cons_ratio, f.cons_qnty, f.avg_cons_qnty, f.rate, f.amount, count_id, copm_one_id, percent_one, color, type_id from wo_pre_cost_fab_yarn_cost_dtls f where f.job_no =" . $txt_job_no . " and f.is_deleted=0 and f.status_active=1  order by f.id";
		$data_arr_yarn = sql_select($sql_yarn);
		foreach ($data_arr_yarn as $yarn_row) {
			$yarnrate = $yarn_row[csf("rate")];
			$summary_data[yarn_cost][$yarn_row[csf("yarn_id")]] = $yarn_row[csf("amount")];
			$summary_data[yarn_cost_job] += $yarn_data_array[$yarn_row[csf("yarn_id")]]['amount'];
			$index = "'" . $yarn_row[csf("count_id")] . "_" . $yarn_row[csf("copm_one_id")] . "_" . $yarn_row[csf("percent_one")] . "_" . $yarn_row[csf("type_id")] . "_" . $yarn_row[csf("color")] . "_" . $yarnrate . "'";
			$YarnData[$index]['qty'] += $yarn_data_array[$yarn_row[csf("yarn_id")]]['qty'];
			$YarnData[$index]['amount'] += $yarn_data_array[$yarn_row[csf("yarn_id")]]['amount'];
			$YarnData[$index]['dznqty'] += $yarn_row[csf("cons_qnty")];
			$YarnData[$index]['dznamount'] += $yarn_row[csf("amount")];
			$totYarn += $yarn_data_array[$yarn_row[csf("yarn_id")]]['qty'];
		}
		//Yarn End============================



		//start	Trims Cost part report here -------------------------------------------
		$sql_trim = "select id, job_no, trim_group,description,brand_sup_ref,remark, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp,status_active,seq
from wo_pre_cost_trim_cost_dtls
where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0 order by seq";
		$data_array_trim = sql_select($sql_trim);
		$trim_amount_arr = $trim->getAmountArray_precostdtlsid();
		$trim_qty_arr = $trim->getQtyArray_by_precostdtlsid();
		//$trim_type_qty_arr=$trim->getQtyArray_by_orderAndTrimsTypeid();
		//print_r($trim_type_qty_arr);
		$totTrim = 0;
		$TrimData = array();
		foreach ($data_array_trim as $row_trim) {
			$trim_qty = $trim_qty_arr[$row_trim[csf("id")]];
			$trim_amount = $trim_amount_arr[$row_trim[csf("id")]];
			$summary_data[trims_cost_job] += $trim_amount;
			$TrimData[$row_trim[csf('id')]]['trim_group'] = $row_trim[csf('trim_group')];
			$TrimData[$row_trim[csf('id')]]['description'] = $row_trim[csf('description')];
			$TrimData[$row_trim[csf('id')]]['brand_sup_ref'] = $row_trim[csf('brand_sup_ref')];
			$TrimData[$row_trim[csf('id')]]['remark'] = $row_trim[csf('remark')];
			$TrimData[$row_trim[csf('id')]]['cons_uom'] = $row_trim[csf('cons_uom')];
			$TrimData[$row_trim[csf('id')]]['cons_dzn_gmts'] = $row_trim[csf('cons_dzn_gmts')];
			$TrimData[$row_trim[csf('id')]]['rate'] = $row_trim[csf('rate')];
			$TrimData[$row_trim[csf('id')]]['amount'] = $row_trim[csf('amount')];
			$TrimData[$row_trim[csf('id')]]['apvl_req'] = $row_trim[csf('apvl_req')];
			$TrimData[$row_trim[csf('id')]]['nominated_supp'] = $row_trim[csf('nominated_supp')];
			$TrimData[$row_trim[csf('id')]]['tot_cons'] = $trim_qty;
			$TrimData[$row_trim[csf('id')]]['tot_amount'] = $trim_amount;
			$totTrim += $row_trim[csf('cons_dzn_gmts')];
		}
		//End	Trims Cost part report here -------------------------------------------
		$sql_fab = "select id, job_no, body_part_id, fab_nature_id, color_type_id, fabric_description, uom, avg_cons, avg_cons_yarn, fabric_source, gsm_weight, rate, amount, avg_finish_cons, status_active from wo_pre_cost_fabric_cost_dtls where job_no=" . $txt_job_no . "  and status_active=1 and is_deleted=0";
		$data_array_pre_fab = sql_select($sql_fab);


		$knit_grey_avg_cons = 0;


		foreach ($data_array_pre_fab as $row) {
			$fab_nature_id = $row[csf("fab_nature_id")];

			$uom = $unit_of_measurement[$row[csf("uom")]];
			if ($fab_nature_id == 2) {
				$knit_grey_avg_consArr[$uom] += $row[csf("avg_cons")];
				$knit_fin_avg_consArr[$uom] += $row[csf("avg_finish_cons")];
			} else if ($fab_nature_id == 3) {
				$wvn_grey_avg_consArr[$uom] += $row[csf("avg_cons")];
				$wvn_fin_avg_consArr[$uom] += $row[csf("avg_finish_cons")];
			}
		}
		//echo implode(",",$knit_fin_avg_consArr);
		$knit_uom_grey_cons = '';
		foreach ($knit_grey_avg_consArr as $uomId => $val) {

			$knit_uom_grey_cons .= number_format($val, 2) . "($uomId)" . ',';
		}
		$knit_uom_wise_grey_cons = chop($knit_uom_grey_cons, ",");

		$knit_uom_fin_cons = '';
		foreach ($knit_fin_avg_consArr as $uomId => $fin) {

			$knit_uom_fin_cons .= number_format($fin, 2) . "($uomId)" . ',';
		}

		$knit_uom_wise_fin_cons = chop($knit_uom_fin_cons, ",");
		//echo $knit_uom_wise_fin_cons.'F';
		// Knit End========
		$wvn_knit_uom_grey_cons = '';
		foreach ($wvn_grey_avg_consArr as $uomId => $val) {

			$wvn_knit_uom_grey_cons .= number_format($val, 2) . ' (' . $uomId . ')' . ',';
		}
		$wvn_uom_wise_grey_cons = chop($wvn_knit_uom_grey_cons, ",");

		$wvn_uom_fin_cons = '';
		foreach ($wvn_fin_avg_consArr as $uomId => $fin) {

			$wvn_uom_fin_cons .= number_format($fin, 2) . ' (' . $uomId . ')' . ',';
		}
		$wvn_uom_wise_fin_cons = chop($wvn_uom_fin_cons, ",");

	?>
		<table style="width:850px">
			<tr>
				<td colspan="6" align="center">
					<?
					$image_location = return_field_value("image_location", "common_photo_library", "file_type=1 and form_name='company_details' and master_tble_id='" . str_replace("'", "", $cbo_company_name) . "'", "image_location");
					?>
					<img src='<? echo $path . $image_location; ?>' height='70' align="left" />
					<b style="font-size:25px;"><? echo $comp[str_replace("'", "", $cbo_company_name)]; ?></b><br>
					<b style="font-size:14px;">Pre- Costing</b>
				</td>
			</tr>
		</table>
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px" rules="all">
			<tr>
				<td width="140">Job Number</td>
				<td width="130"><b><? echo $row[csf("job_no")]; ?></b></td>
				<td width="140">Buyer</td>
				<td width="180" style="word-break:break-all"><b><? echo $buyer_arr[$buyer_name]; ?></b></td>
				<td colspan="2" align="center"><b>Material Cost</b></td>
			</tr>
			<tr>
				<td>Garments Item</td>
				<?
				$grmnt_items = "";
				if ($garments_item[$row[csf("gmts_item_id")]] == "") {
					$grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no=$txt_job_no");
					foreach ($grmts_sql as $key => $val) {
						$grmnt_items .= $garments_item[$val[csf("gmts_item_id")]] . ", ";
					}
					$grmnt_items = substr_replace($grmnt_items, "", -1, 1);
				} else {
					$grmnt_items = $garments_item[$row[csf("gmts_item_id")]];
				}
				?>
				<td style="word-break:break-all"><b><? echo $grmnt_items; ?></b></td>
				<td>Style Ref. No </td>
				<td style="word-break:break-all"><b><? echo $style_ref_no; ?></b></td>
				<td width="120"><b>Fabric Purchase</b></td>
				<td align="right" style="word-break:break-all"><b><? echo fn_number_format($summary_data[fabric_cost_job], 4); ?></b></td>
			</tr>
			<tr>
				<td>Job Qty</td>
				<td><b><? echo $job_quantity . " " . $unit_of_measurement[$uom_id]; ?></b></td>
				<td>Plan Cut Qty</td>
				<td><b><? echo $po_plan_quantity . " " . $unit_of_measurement[$uom_id]; ?></b></td>
				<td><b>Yarn</b></td>
				<td align="right" style="word-break:break-all"><b><? echo fn_number_format($summary_data[yarn_cost_job], 4); ?></b></td>
			</tr>
			<tr>
				<td>Order Numbers</td>
				<td colspan="3" style="word-break:break-all"><b><? echo $job_in_orders; ?></b></td>
				<td><b>Accessories</b></td>
				<td align="right" style="word-break:break-all"><b><? echo fn_number_format($summary_data[trims_cost_job], 4) ?></b></td>
			</tr>
			<tr>
				<td>Quotation ID</td>
				<td><b><? echo  $quotation_id; ?> </b></td>
				<td>Internal Ref</td>
				<td style="word-break:break-all"><b><? echo ltrim($ref_cond, ", "); ?></b></td>
				<td><b>Total</b></td>
				<td align="right" style="word-break:break-all"><b><? echo fn_number_format($summary_data[fabric_cost_job] + $summary_data[yarn_cost_job] + $summary_data[trims_cost_job], 4); ?></b></td>
			</tr>
			<tr>
				<td>Knit Fab. Cons</td>
				<td><b><? echo $knit_uom_wise_grey_cons; //$row[csf("fab_knit_req_kg")];$fab_knit_req_kg_avg+=$row[csf("fab_knit_req_kg")]; 
						?> </b></td>
				<td>Woven Fab. Cons</td>
				<td><b><? echo $wvn_uom_wise_grey_cons; //$row[csf("fab_woven_req_yds")];$fab_woven_req_yds_avg+= $row[csf("fab_woven_req_yds")];
						?> </b></td>
				<td>Price Per <?= $unit_of_measurement[$uom_id]; ?></td>
				<td align="right"><b><? echo number_format($avg_unit_price, 4); ?></b></td>
			</tr>
			<tr>
				<td>Knit Fin Fab. Cons</td>
				<td><b><? echo $knit_uom_wise_fin_cons; ?> </b></td>
				<td>Woven Fin Fab. Cons</td>
				<td><b><? echo $wvn_uom_wise_fin_cons; ?> </b></td>
				<td>Costing Per <?= $unit_of_measurement[$uom_id]; ?></td>
				<td align="right"><b><? echo number_format($cost_pcs_set, 4); ?></b></td>
			</tr>
			<tr>
				<td>Avg Yarn Req</td>
				<td><b><? echo number_format($fab_yarn_req_kg, 2); ?> (Kg)</b></td>
				<td style="word-break:break-all">Shipment Date </td>
				<td><b><? echo change_date_format($pulich_ship_date); ?></b></td>
				<td>Margin Per <?= $unit_of_measurement[$uom_id]; ?></td>
				<td align="right"><b><? echo number_format($margin_pcs_bom, 4); ?></b></td>
			</tr>
			<tr>
				<td>GSM</td>
				<td style="word-break:break-all"><b><?
													$gsm_weights_top = implode(",", array_unique(explode(",", $gsm_weight_top)));
													$gsm_weight_bottom = implode(",", array_unique(explode(",", $gsm_weight_bottom)));
													if ($gsm_weights_top != '') $gsm_weightTop = $gsm_weights_top;
													else $gsm_weightTop = '';
													if ($gsm_weight_bottom != '' && $gsm_weights_top != '') $gsm_weightBottom = " ," . $gsm_weight_bottom;
													else if ($gsm_weight_bottom != '' && $gsm_weights_top == '') $gsm_weightBottom = $gsm_weight_bottom;
													else $gsm_weightBottom = '';
													echo $gsm_weightTop . $gsm_weightBottom;
													?></b></td>

				<td>Budget Minute</td>
				<td><b><? echo $budget_minute; ?> </b></td>
				<td align="center" colspan="2" rowspan="2" valign="middle" id="app_sms" style="font-size:20px; word-break:break-all">
					<font color="#FF0000">
						<? //if( $row[csf("approved")]==1 || $row[csf("approved")]==3){echo "This job is approved ";} else {echo "";}
						if ($approved == 1) $ap_msg = "This Job Is Approved";
						else if ($approved == 3) $ap_msg = "This Job Partially Approved";
						else $ap_msg = "";
						echo $ap_msg;
						?> </font>
				</td>
			</tr>
			<tr>
				<td>File No</td>
				<td style="word-break:break-all"><b><? echo $file_cond; ?></b></td>
				<td>Sc/Lc No</td>
				<td style="word-break:break-all"><b><? echo $sc_lc_no; ?></b></td>
			</tr>
			<tr>
				<td>Style Desc</td>
				<td><? echo $style_desc; ?></td>
			</tr>
		</table>
	<?
		if ($costing_per_id == 1) {
			$order_price_per_dzn = 12;
			$costing_for = " DZN";
		} else if ($costing_per_id == 2) {
			$order_price_per_dzn = 1;
			$costing_for = " PCS";
		} else if ($costing_per_id == 3) {
			$order_price_per_dzn = 24;
			$costing_for = " 2 DZN";
		} else if ($costing_per_id == 4) {
			$order_price_per_dzn = 36;
			$costing_for = " 3 DZN";
		} else if ($costing_per_id == 5) {
			$order_price_per_dzn = 48;
			$costing_for = " 4 DZN";
		}
		$order_job_qnty = $job_quantity;
		$avg_unit_price = $avg_unit_price;
	} //end first foearch

	//start	all summary report here -------------------------------------------


	$sql_new = "select job_no, fabric_cost, fabric_cost_percent, trims_cost, trims_cost_percent, embel_cost, embel_cost_percent, wash_cost, wash_cost_percent, comm_cost, comm_cost_percent, commission, commission_percent, lab_test, lab_test_percent, inspection, inspection_percent, cm_cost, cm_cost_percent, freight, freight_percent, currier_pre_cost, currier_percent, certificate_pre_cost, certificate_percent, common_oh, common_oh_percent, depr_amor_pre_cost, total_cost, total_cost_percent, price_dzn, price_dzn_percent, margin_dzn, margin_dzn_percent, price_pcs_or_set, price_pcs_or_set_percent, margin_pcs_set, margin_pcs_set_percent, cm_for_sipment_sche, design_cost, design_percent, studio_cost, studio_percent from wo_pre_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array_new = sql_select($sql_new);


	foreach ($data_array_new as $row_new) {
		$summary_data[price_dzn] = $row_new[csf("price_dzn")];
		$summary_data[price_dzn_job] = $total_fob_value; //($po_qty/($total_set_qnty*$order_price_per_dzn))*$row_new[csf("price_dzn")];
		$summary_data[commission] = $row_new[csf("commission")];
		$summary_data[trims_cost] = $row_new[csf("trims_cost")];
		$summary_data[emb_cost] = $row_new[csf("embel_cost")];
		$summary_data[lab_test] = $row_new[csf("lab_test")];
		$summary_data[lab_test_job] = $other_cost[$row_new[csf("job_no")]]['lab_test'];
		$summary_data[inspection] = $row_new[csf("inspection")];
		$summary_data[inspection_job] = $other_cost[$row_new[csf("job_no")]]['inspection'];
		$summary_data[freight] = $row_new[csf("freight")];
		$summary_data[freight_job] = $other_cost[$row_new[csf("job_no")]]['freight'];
		$summary_data[design] = $row_new[csf("design_cost")];
		$summary_data[design_job] = $other_cost[$row_new[csf("job_no")]]['design_cost'];
		//	$summary_data[design_job]=$row_new[csf("design_cost")]/$order_price_per_dzn*$po_qty;
		$summary_data[studio_job] = $other_cost[$row_new[csf("job_no")]]['studio_cost'];
		$summary_data[studio] = $row_new[csf("studio_cost")];
		//$summary_data[studio_job]=$row_new[csf("studio_cost")]/$order_price_per_dzn*$po_qty;
		$summary_data[currier_pre_cost] = $row_new[csf("currier_pre_cost")];
		$summary_data[currier_pre_cost_job] = $other_cost[$row_new[csf("job_no")]]['currier_pre_cost'];
		$summary_data[certificate_pre_cost] = $row_new[csf("certificate_pre_cost")];
		$summary_data[certificate_pre_cost_job] = $other_cost[$row_new[csf("job_no")]]['certificate_pre_cost'];
		$summary_data[wash_cost] = $row_new[csf("wash_cost")];
		$summary_data[OtherDirectExpenses] = $row_new[csf("lab_test")] + $row_new[csf("inspection")] + $row_new[csf("design_cost")] + $row_new[csf("studio_cost")] + $row_new[csf("freight")] + $row_new[csf("currier_pre_cost")] + $row_new[csf("certificate_pre_cost")] + $row_new[csf("wash_cost")];
		$summary_data[OtherDirectExpenses_job] = $summary_data[lab_test_job] + $summary_data[inspection_job] + $summary_data[design_job] + $summary_data[studio_job] + $summary_data[freight_job] + $summary_data[currier_pre_cost_job] + $summary_data[certificate_pre_cost_job];

		$summary_data[cm_cost] = $row_new[csf("cm_cost")];
		$summary_data[cm_cost_job] = $other_cost[$row_new[csf("job_no")]]['cm_cost'];
		$summary_data[comm_cost] = $row_new[csf("comm_cost")];
		$summary_data[common_oh] = $row_new[csf("common_oh")];
		$summary_data[common_oh_job] = $other_cost[$row_new[csf("job_no")]]['common_oh'];
		$summary_data[depr_amor_pre_cost] = $row_new[csf("depr_amor_pre_cost")];
		$summary_data[depr_amor_pre_cost_job] = $other_cost[$row_new[csf("job_no")]]['depr_amor_pre_cost'];
	}




	//Conversion
	$totConv = 0;
	$ConvData = array();
	$conv_data = array();
	$conv_amount_arr = $conversion->getAmountArray_by_conversionid();
	$conv_qty_arr = $conversion->getQtyArray_by_conversionid();
	$sql_conv = "select a.id as con_id, a.fabric_description as fabric_description_id, a.job_no, a.cons_process, a.req_qnty,a.avg_req_qnty, a.charge_unit, a.amount, a.status_active,b.body_part_id,b.fab_nature_id,b.color_type_id,b.fabric_description,b.uom  from wo_pre_cost_fab_conv_cost_dtls a left join wo_pre_cost_fabric_cost_dtls b on a.job_no=b.job_no and a.fabric_description=b.id and b.status_active=1 and b.is_deleted=0 where a.job_no=" . $txt_job_no . "  and a.id>0 and a.is_deleted =0 and a.status_active=1 ";
	$data_arr_conv = sql_select($sql_conv);
	foreach ($data_arr_conv as $conv_row) {
		$convamount = array_sum($conv_amount_arr[$conv_row[csf('con_id')]]);
		$convQty = array_sum($conv_qty_arr[$conv_row[csf('con_id')]]);
		$conv_data[cons_process][$conv_row[csf('con_id')]] = $conv_row[csf('cons_process')];
		$conv_data[amount][$conv_row[csf('con_id')]] = $conv_row[csf('amount')];
		$conv_data[amount_job][$conv_row[csf('con_id')]] += $convamount;
		$summary_data[conver_cost_job] += $convamount;

		$index = $conv_row[csf('con_id')];
		$ConvData[$index]['item_descrition'] = $body_part[$conv_row[csf("body_part_id")]] . ", " . $color_type[$conv_row[csf("color_type_id")]] . ", " . $conv_row[csf("fabric_description")];
		$ConvData[$index]['cons_process'] = $conv_row[csf("cons_process")];
		$ConvData[$index]['req_qnty'] = $conv_row[csf("req_qnty")];
		$ConvData[$index]['uom'] = $conv_row[csf("uom")];
		$ConvData[$index]['charge_unit'] = $conv_row[csf("charge_unit")];
		$ConvData[$index]['amount'] = $conv_row[csf("amount")];
		$ConvData[$index]['tot_req_qnty'] = $convQty;
		$ConvData[$index]['tot_amount'] = $convamount;
		$totConv += $conv_row[csf("req_qnty")];
	}
	//Conversion End

	//Emb cost Cost part report here -------------------------------------------

	$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pre_cost_embe_cost_dtls where job_no=" . $txt_job_no . " and emb_name in(1,2,4,5) and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	$emblishment_qty = $emblishment->getQtyArray_by_jobAndEmblishmentid();
	$emblishment_amount = $emblishment->getAmountArray_by_jobAndEmblishmentid();
	$totEmb = 0;
	$EmbData = array();

	foreach ($data_array as $row) {
		$embqty = $emblishment_qty[$row[csf("job_no")]][$row[csf("id")]];
		$embamount = $emblishment_amount[$row[csf("job_no")]][$row[csf("id")]];
		$summary_data[emb_cost_job] += $embamount;
		$EmbData[$row[csf("id")]]['emb_name'] = $row[csf("emb_name")];
		$EmbData[$row[csf("id")]]['emb_type'] = $row[csf("emb_type")];
		$EmbData[$row[csf("id")]]['cons_dzn_gmts'] = $row[csf("cons_dzn_gmts")];
		$EmbData[$row[csf("id")]]['rate'] = $row[csf("rate")];
		$EmbData[$row[csf("id")]]['amount'] = $row[csf("amount")];
		$EmbData[$row[csf("id")]]['tot_cons'] = $embqty;
		$EmbData[$row[csf("id")]]['tot_amount'] = $embamount;
		$totEmb += $row[csf("cons_dzn_gmts")];
	}
	//End Emb cost Cost part report here -------------------------------------------
	//Wash cost Cost part report here -------------------------------------------
	$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pre_cost_embe_cost_dtls where job_no=" . $txt_job_no . " and emb_name =3 and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	$wash_qty = $wash->getQtyArray_by_jobAndEmblishmentid();
	$wash_amount = $wash->getAmountArray_by_jobAndEmblishmentid();
	foreach ($data_array as $row) {
		$washqty = $wash_qty[$row[csf("job_no")]][$row[csf("id")]];
		$washamount = $wash_amount[$row[csf("job_no")]][$row[csf("id")]];
		$summary_data[wash_cost_job] += $washamount;
		$summary_data[OtherDirectExpenses_job] += $washamount;
		$EmbData[$row[csf("id")]]['emb_name'] = $row[csf("emb_name")];
		$EmbData[$row[csf("id")]]['emb_type'] = $row[csf("emb_type")];
		$EmbData[$row[csf("id")]]['cons_dzn_gmts'] = $row[csf("cons_dzn_gmts")];
		$EmbData[$row[csf("id")]]['rate'] = $row[csf("rate")];
		$EmbData[$row[csf("id")]]['amount'] = $row[csf("amount")];
		$EmbData[$row[csf("id")]]['tot_cons'] = $washqty;
		$EmbData[$row[csf("id")]]['tot_amount'] = $washamount;
		$totEmb += $row[csf("cons_dzn_gmts")];
	}
	//End Wash cost Cost part report here -------------------------------------------
	//Commision cost Cost part report here -------------------------------------------
	$sql = "select id,job_no,particulars_id,commission_base_id,commision_rate,commission_amount, status_active from wo_pre_cost_commiss_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	$commision_amount = $commision->getAmountArray_by_jobAndPrecostdtlsid();
	$totCommi = 0;
	$CommiData = array();
	foreach ($data_array as $row) {
		$commisionamount = $commision_amount[$row[csf("job_no")]][$row[csf("id")]];
		$summary_data[commission_job] += $commisionamount;
		$CommiData[$row[csf("id")]]['particulars_id'] = $row[csf("particulars_id")];
		$CommiData[$row[csf("id")]]['commission_base_id'] = $row[csf("commission_base_id")];
		$CommiData[$row[csf("id")]]['commision_rate'] = $row[csf("commision_rate")];
		$CommiData[$row[csf("id")]]['commission_amount'] = $row[csf("commission_amount")];
		$CommiData[$row[csf("id")]]['tot_commission_amount'] = $commisionamount;
		$totCommi += $row[csf("commission_amount")];
	}
	//End Commision cost Cost part report here -------------------------------------------
	//Commarcial cost Cost part report here -------------------------------------------
	$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls  where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	$commarcial_amount = $commercial->getAmountArray_by_jobAndPrecostdtlsid();

	$totCommar = 0;
	$CommarData = array();
	foreach ($data_array as $row) {
		$commarcialamount = $commarcial_amount[$row[csf("job_no")]][$row[csf("id")]];
		$summary_data[comm_cost_job] += $commarcialamount;
		$CommarData[$row[csf("id")]]['item_id'] = $row[csf("item_id")];
		$CommarData[$row[csf("id")]]['rate'] = $row[csf("rate")];
		$CommarData[$row[csf("id")]]['amount'] = $row[csf("amount")];
		$CommarData[$row[csf("id")]]['tot_amount'] = $commarcialamount;
		$totCommar += $row[csf("amount")];
	}
	//End Commarcial cost Cost part report here -------------------------------------------
	?>
	<div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;" rules="all">
			<tr style="font-weight:bold">
				<td align="center" width="850" colspan="5">Order Profitability </td>
			</tr>
			<tr style="font-weight:bold">
				<td align="center" width="80">Line Items</td>
				<td width="400">Particulars</td>
				<td width="120">Amount (USD)/<? echo $costing_for; ?></td>
				<td width="120">Total Value</td>
				<td>%</td>
			</tr>
			<tr>
				<td align="center">1</td>
				<td style="font-weight:bold">Gross FOB Value</td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[price_dzn], 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[price_dzn_job], 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[price_dzn_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">2</td>
				<td style=" padding-left:15px">Less: commission</td>
				<td align="right"><? echo fn_number_format($summary_data[commission], 4); ?></td>
				<td align="right"><? echo fn_number_format($summary_data[commission_job], 4); ?></td>
				<td align="right"><? echo fn_number_format(($summary_data[commission_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">3</td>
				<?
				$NetFOBValue = $summary_data[price_dzn] - $summary_data[commission];
				$NetFOBValue_job = $summary_data[price_dzn_job] - $summary_data[commission_job];
				?>
				<td style="font-weight:bold"><b>Net FOB Value (1-2)</b></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($NetFOBValue, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($NetFOBValue_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($NetFOBValue_job / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">4</td>
				<td style="font-weight:bold"><b>Less: Cost of Material & Services (5+6+7+8+9) </b></td>
				<?

				$summary_data[emb_cost] = 0;
				$summary_data[emb_cost] = ($summary_data[emb_cost_job] / $po_plan_quantity) * 12;

				$summary_data[trims_cost] = 0;
				$summary_data[trims_cost] = ($summary_data[trims_cost_job] / $po_plan_quantity) * 12;
				$Less_Cost_Material_Services = array_sum($summary_data[yarn_cost]) + array_sum($summary_data[fabric_cost]) + array_sum($conv_data[amount]) + $summary_data[trims_cost] + $summary_data[emb_cost] + $summary_data[lab_test] + $summary_data[inspection] + $summary_data[design] + $summary_data[studio] + $summary_data[freight] + $summary_data[currier_pre_cost] + $summary_data[certificate_pre_cost] + $summary_data[wash_cost];

				$Less_Cost_Material_Services_job = $summary_data[yarn_cost_job] + $summary_data[fabric_cost_job] + $summary_data[conver_cost_job] + $summary_data[trims_cost_job] + $summary_data[emb_cost_job] + $summary_data[OtherDirectExpenses_job];
				//$Less_Cost_Material_Services_job=array_sum($summary_data[yarn_cost])+array_sum($summary_data[fabric_cost])+array_sum($conv_data[amount])+$summary_data[trims_cost]+$summary_data[emb_cost]+$summary_data[OtherDirectExpenses_dzn];
				?>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format($Less_Cost_Material_Services, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($Less_Cost_Material_Services_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($Less_Cost_Material_Services_job / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center" rowspan="2">5</td>
				<td style=" padding-left:100px;font-weight:bold">Fabric Purchase Cost</td>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format(array_sum($summary_data[fabric_cost]), 4); ?></td>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format($summary_data[fabric_cost_job], 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[fabric_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td style=" padding-left:100px;font-weight:bold">Yarn Cost</td>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format(array_sum($summary_data[yarn_cost]), 4); ?></td>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format($summary_data[yarn_cost_job], 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[yarn_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center" valign="top">6</td>
				<td width="400" style=" padding-left:100px">
					<table>
						<tr>
							<td style="font-weight:bold">Conversion Cost</td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<? foreach ($conv_data[cons_process] as $key => $value) { ?>
							<tr>
								<td align="left"><? echo $conversion_cost_head_array[$conv_data[cons_process][$key]]; ?></td>
							</tr>
						<? } ?>
					</table>
				</td>
				<td align="right" valign="top">
					<table>
						<tr>
							<td align="right" style="font-weight:bold"><? echo fn_number_format(array_sum($conv_data[amount]), 4); ?></td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<? foreach ($conv_data[cons_process] as $key => $value) { ?>
							<tr>
								<td align="right"><? echo fn_number_format($conv_data[amount][$key], 4); ?></td>
							</tr>
						<? } ?>
					</table>
				</td>
				<td align="right" valign="top">
					<table>
						<tr>
							<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[conver_cost_job], 4); ?></td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<? foreach ($conv_data[cons_process] as $key => $value) { ?>
							<tr>
								<td align="right"><? echo fn_number_format($conv_data[amount_job][$key], 4); ?></td>
							</tr>
						<? } ?>
					</table>
				</td>
				<td align="right" valign="top">
					<table>
						<tr>
							<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[conver_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<? foreach ($conv_data[cons_process] as $key => $value) { ?>
							<tr>
								<td align="right"><? echo fn_number_format(($conv_data[amount_job][$key] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
							</tr>
						<? } ?>
					</table>
				</td>
			</tr>
			<tr>
				<td align="center">7</td>
				<td style="padding-left:100px;font-weight:bold"><b>Trim Cost </b></td>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format(($summary_data[trims_cost_job] / $po_plan_quantity) * 12, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[trims_cost_job], 4) ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[trims_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">8</td>
				<td style=" padding-left:100px;font-weight:bold"><b>Embelishment Cost </b></td>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format($summary_data[emb_cost], 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[emb_cost_job], 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[emb_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center" valign="top">9</td>
				<td style="padding-left:100px">
					<table>
						<tr>
							<td style="font-weight:bold">Other Direct Expenses</td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<tr>
							<td>Lab Test</td>
						</tr>
						<tr>
							<td>Inspection</td>
						</tr>
						<tr>
							<td>Design Cost</td>
						</tr>
						<tr>
							<td>Studio Cost</td>
						</tr>
						<tr>
							<td>Freight Cost</td>
						</tr>
						<tr>
							<td>Courier Cost</td>
						</tr>
						<tr>
							<td>Certificate Cost</td>
						</tr>
						<tr>
							<td>Garments Wash Cost</td>
						</tr>
					</table>
				</td>
				<td align="right" valign="top">
					<table>
						<tr>
							<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[OtherDirectExpenses], 4); ?></td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[lab_test], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[inspection], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[design], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[studio], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[freight], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[currier_pre_cost], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[certificate_pre_cost], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[wash_cost], 4); ?></td>
						</tr>
					</table>
				</td>
				<td align="right" valign="top">
					<table>
						<tr>
							<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[OtherDirectExpenses_job], 4); ?></td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[lab_test_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[inspection_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[design_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[studio_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[freight_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[currier_pre_cost_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[certificate_pre_cost_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[wash_cost_job], 4); ?></td>
						</tr>
					</table>
				</td>
				<td align="right" valign="top">
					<table>
						<tr>
							<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[OtherDirectExpenses_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[lab_test_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[inspection_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[design_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[studio_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[freight_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[currier_pre_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[certificate_pre_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
						<tr>
							<td align="right" title="<?= $summary_data[wash_cost] . '=' . $summary_data[price_dzn]; ?>"><? echo fn_number_format(($summary_data[wash_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td align="center">10</td>
				<td style="font-weight:bold">Contributions/Value Additions (3-4)</td>
				<?
				// $Contribution_Margin=$NetFOBValue-$Less_Cost_Material_Services;
				$Contribution_Margin_job = $NetFOBValue_job - $Less_Cost_Material_Services_job;
				$Contribution_Margin = ($Contribution_Margin_job / $po_plan_quantity) * 12; //$NetFOBValue-$Less_Cost_Material_Services;
				?>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format($Contribution_Margin, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($Contribution_Margin_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($Contribution_Margin_job / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">11</td>
				<td style=" padding-left:15px">Less: CM Cost </td>
				<td align="right"><? echo fn_number_format($summary_data[cm_cost], 4); ?> </td>
				<td align="right"><? echo fn_number_format($summary_data[cm_cost_job], 4); ?></td>
				<td align="right"><? echo fn_number_format(($summary_data[cm_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">12</td>
				<td style="font-weight:bold">Gross Profit (10-11)</td>
				<?
				$Gross_Profit = $Contribution_Margin - $summary_data[cm_cost];
				$Gross_Profit_job = $Contribution_Margin_job - $summary_data[cm_cost_job];
				?>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format($Gross_Profit, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($Gross_Profit_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($Gross_Profit_job / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">13</td>
				<td style=" padding-left:15px">Less: Commercial Cost</td>
				<td align="right"> <? echo fn_number_format($summary_data[comm_cost], 4); ?></td>
				<td align="right"><? echo fn_number_format($summary_data[comm_cost_job], 4); ?></td>
				<td align="right"><? echo fn_number_format(($summary_data[comm_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">14</td>
				<td style=" padding-left:15px">Less: Operating Expensees</td>
				<td align="right"><? echo fn_number_format($summary_data[common_oh], 4); ?> </td>
				<td align="right"><? echo fn_number_format($summary_data[common_oh_job], 4); ?> </td>
				<td align="right"><? echo fn_number_format(($summary_data[common_oh_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">15</td>
				<td style="font-weight:bold">Operating Profit/ Loss (12-(13+14))</td>
				<?
				$OperatingProfitLoss = $Gross_Profit - ($summary_data[comm_cost] + $summary_data[common_oh]);
				$OperatingProfitLoss_job = $Gross_Profit_job - ($summary_data[comm_cost_job] + $summary_data[common_oh_job]);
				?>
				<td align="right" style="font-weight:bold"> <? echo fn_number_format(($OperatingProfitLoss_job / $po_plan_quantity) * 12, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($OperatingProfitLoss_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($OperatingProfitLoss_job / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">16</td>
				<td style=" padding-left:15px">Less: Depreciation & Amortization </td>

				<td align="right"> <? echo fn_number_format($summary_data[depr_amor_pre_cost], 4); ?></td>
				<td align="right"><? echo fn_number_format($summary_data[depr_amor_pre_cost_job], 4); ?></td>
				<td align="right"><? echo fn_number_format(($summary_data[depr_amor_pre_cost_job] / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<?
				$pre_costing_date = change_date_format($costing_date, '', '', 1);
				$interest_expense = $NetFOBValue * $financial_para[$pre_costing_date][interest_expense] / 100;
				$income_tax = $NetFOBValue * $financial_para[$pre_costing_date][income_tax] / 100;
				$interest_expense_job = $NetFOBValue_job * $financial_para[$pre_costing_date][interest_expense] / 100;
				$income_tax_job = $NetFOBValue_job * $financial_para[$pre_costing_date][income_tax] / 100;
				?>
				<td align="center">17</td>
				<td style=" padding-left:15px">Less: Interest </td>

				<td align="right"> <? echo fn_number_format($interest_expense, 4); ?></td>
				<td align="right"><? echo fn_number_format($interest_expense_job, 4); ?></td>
				<td align="right"><? echo fn_number_format(($interest_expense_job / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<td align="center">18</td>
				<td style=" padding-left:15px">Less: Income Tax</td>

				<td align="right"> <? echo fn_number_format($income_tax, 4); ?></td>
				<td align="right"><? echo fn_number_format($income_tax_job, 4); ?></td>
				<td align="right"><? echo fn_number_format(($income_tax_job / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
			<tr>
				<?
				$Netprofit = $OperatingProfitLoss - ($summary_data[depr_amor_pre_cost] + $interest_expense + $income_tax);
				$Netprofit_job = $OperatingProfitLoss_job - ($summary_data[depr_amor_pre_cost_job] + $interest_expense_job + $income_tax_job);
				?>
				<td align="center">19</td>
				<td style="font-weight:bold">Net Profit/Loss (15-(16+17+18))</td>

				<td align="right" style="font-weight:bold"><? echo fn_number_format(($Netprofit_job / $po_plan_quantity) * 12, 4); ?> </td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($Netprofit_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($Netprofit_job / $summary_data[price_dzn_job]) * 100, 4); ?></td>
			</tr>
		</table>
	</div>

	<?
	//End all summary report here -------------------------------------------


	echo signature_table(109, $cbo_company_name, "860px");
	$mailBody = ob_get_contents();
	ob_clean();
	echo $mailBody;

	//Mail send------------------------------------------
	list($msil_address, $is_mail_send) = explode('**', $mail_data);
	if ($is_mail_send == 1) {

		require_once('../../../mailer/class.phpmailer.php');
		require_once('../../../auto_mail/setting/mail_setting.php');

		$mailBody = preg_replace("/<img[^>]+\>/i", " ", $mailBody);
		$mailToArr = array();
		if ($msil_address) {
			$mailToArr[] = $msil_address;
		}


		$sql = "SELECT a.BRAND_IDS,a.BUYER_IDS,c.email_address as MAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id  and a.mail_item=b.MAIL_ITEM_MST and a.mail_item=89 and b.mail_user_setup_id=c.id and a.company_id =" . $cbo_company_name . "  and   A.IS_DELETED=0 and A.STATUS_ACTIVE=1  and b.IS_DELETED=0 and b.STATUS_ACTIVE=1  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
		$mail_sql = sql_select($sql);
		$receverMailArr = array();
		foreach ($mail_sql as $row) {
			$mailToArr[] = $row[MAIL];
		}

		$elcetronicSql = "SELECT a.BUYER_ID,a.SEQUENCE_NO,a.BYPASS,b.USER_EMAIL  from electronic_approval_setup a join user_passwd b on a.user_id=b.id where b.valid=1  AND a.entry_form=15 and a.company_id=$cbo_company_name order by a.SEQUENCE_NO";

		$elcetronicSqlRes = sql_select($elcetronicSql);
		foreach ($elcetronicSqlRes as $rows) {

			if ($rows[BUYER_ID] != '') {
				foreach (explode(',', $rows[BUYER_ID]) as $bi) {
					if ($rows[USER_EMAIL] != '' && $bi == $buyer_name_id) {
						$mailToArr[] = $rows[USER_EMAIL];
					}
					if ($rows[BYPASS] == 2) {
						break;
					}
				}
			} else {
				if ($rows[USER_EMAIL]) {
					$mailToArr[] = $rows[USER_EMAIL];
				}
				if ($rows[BYPASS] == 2) {
					break;
				}
			}
		}


		$to = implode(',', array_unique($mailToArr));
		//echo $to;die;


		/*		//Att file....
$imgSql="select IMAGE_LOCATION,REAL_FILE_NAME from common_photo_library where is_deleted=0  and MASTER_TBLE_ID=$txt_job_no and file_type=1";
$imgSqlResult=sql_select($imgSql);
foreach($imgSqlResult as $rows){
	$att_file_arr[]='../../../'.$rows[IMAGE_LOCATION].'**'.$rows[REAL_FILE_NAME];
}
*/
		$subject = "Pre Cost Entry Report";
		$header = mailHeader();
		echo sendMailMailer($to, $subject, $mailBody, $from_mail, $att_file_arr);
	}

	//------------------------------------End;


	exit();
}

if ($action == "preCostRpt10") //copy cost rpt7//md mamun ahmed sagor/25244/24-10-2022
{
	$process = array(&$_POST);

	extract(check_magic_quote_gpc($process));
	if ($txt_job_no == "") $job_no = '';
	else $job_no = " and a.job_no=" . $txt_job_no . "";
	$txt_costing_date = change_date_format(str_replace("'", "", $txt_costing_date), 'yyyy-mm-dd', '-');
	$txt_costingdate = change_date_format(str_replace("'", "", $txt_costing_date), 'yyyy-mm-dd', '-');
	if ($db_type == 0) {
		$costing_date = change_date_format($txt_costing_date, "yyyy-mm-dd", "-");
	}
	if ($db_type == 2) {
		$costing_date = change_date_format($txt_costing_date, "yyyy-mm-dd", "-", 1);
	}
	if ($cbo_company_name == "") $company_name = '';
	else $company_name = " and a.company_name=" . $cbo_company_name . "";
	if ($cbo_buyer_name == "") $cbo_buyer_name = '';
	else $cbo_buyer_name = " and a.buyer_name=" . $cbo_buyer_name . "";
	if ($txt_style_ref == "") $txt_style_ref = '';
	else $txt_style_ref = " and a.style_ref_no=" . $txt_style_ref . "";
	if ($txt_costing_date == "") $txt_costing_date = '';
	else $txt_costing_date = " and b.costing_date='" . $txt_costing_date . "'";
	$buyer_arr = return_library_array("select id, buyer_name from lib_buyer", 'id', 'buyer_name');
	$comp = return_library_array("select id, company_name from lib_company", 'id', 'company_name');
	$color_library = return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");

	if ($db_type == 0) {
		$sqlcpm = sql_select("select cost_per_minute from lib_standard_cm_entry where company_id=$cbo_company_name and '$costing_date' between applying_period_date and applying_period_to_date  and status_active=1 and is_deleted=0 LIMIT 1");
	}
	if ($db_type == 2) {
		$sqlcpm = sql_select("select cost_per_minute from lib_standard_cm_entry where company_id=$cbo_company_name and '$costing_date' between applying_period_date and applying_period_to_date and status_active=1 and is_deleted=0");
	}

	$cpm = '';
	foreach ($sqlcpm as $sqlcpmrow) {
		$cpm = $sqlcpmrow[csf('cost_per_minute')];
	}
	if ($db_type == 0) $group_gsm = "group_concat( distinct b.gsm_weight) AS gsm_weight";
	if ($db_type == 2) $group_gsm = "listagg(b.gsm_weight ,',') within group (order by b.gsm_weight) AS gsm_weight";

	$gsm_weight_top = return_field_value("$group_gsm", "lib_body_part a,wo_pre_cost_fabric_cost_dtls b", "a.id=b.body_part_id and b.job_no=$txt_job_no and a.body_part_type=1 and b.status_active=1 and b.is_deleted=0", "gsm_weight");
	$gsm_weight_bottom = return_field_value("$group_gsm", "lib_body_part a,wo_pre_cost_fabric_cost_dtls b", "a.id=b.body_part_id and b.job_no=$txt_job_no and a.body_part_type=20 and b.status_active=1 and b.is_deleted=0", "gsm_weight");
	$po_qty = 0;
	$po_plun_cut_qty = 0;
	$total_set_qnty = 0;
	$total_fob_value = 0;
	$sql_po = "select a.job_no,a.total_set_qnty,b.id,b.PUB_SHIPMENT_DATE,c.item_number_id,c.country_id,c.color_number_id,c.size_number_id,c.order_quantity ,c.plan_cut_qnty, c.order_total,b.plan_cut  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst   and b.id=c.po_break_down_id  and a.job_no =" . $txt_job_no . "   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 order by b.id";
	$sql_po_data = sql_select($sql_po);
	$pulish_ship_date_arr = array();
	foreach ($sql_po_data as $sql_po_row) {
		$po_qty += $sql_po_row[csf('order_quantity')];
		$po_plun_cut_qty += $sql_po_row[csf('plan_cut_qnty')];
		$po_plun_cut_qty_arr[$sql_po_row[csf('id')]] = $sql_po_row[csf('plan_cut')];
		$total_set_qnty = $sql_po_row[csf('total_set_qnty')];
		$pulish_ship_date_arr[$sql_po_row[PUB_SHIPMENT_DATE]] = $sql_po_row[PUB_SHIPMENT_DATE];
		$total_fob_value += $sql_po_row[csf('order_total')];
	}
	$fab_knit_req_kg_avg = 0;
	$fab_woven_req_yds_avg = 0;

	if ($db_type == 0) {
		$sql = "select a.job_no,b.id,a.company_name,a.buyer_name,a.style_ref_no,a.gmts_item_id,a.order_uom,a.job_quantity,a.avg_unit_price,b.costing_per,b.budget_minute,b.approved,b.sew_smv,b.exchange_rate,b.sew_effi_percent,c.fab_knit_req_kg,c.fab_knit_fin_req_kg,c.fab_woven_req_yds,c.fab_woven_fin_req_yds,c.fab_yarn_req_kg,a.remarks from wo_po_details_master a, wo_pre_cost_mst b left join wo_pre_cost_sum_dtls c on   b.job_no=c.job_no where a.job_no=b.job_no  and a.status_active=1 $job_no $company_name $cbo_buyer_name  $txt_costing_date order by a.job_no";
	}
	if ($db_type == 2) {
		$sql = "select a.job_no,b.id,a.company_name,a.buyer_name,a.style_ref_no,a.gmts_item_id,a.order_uom,a.job_quantity,a.avg_unit_price,b.costing_per,b.budget_minute,b.approved,b.sew_smv,b.exchange_rate,b.sew_effi_percent,c.fab_knit_req_kg,c.fab_knit_fin_req_kg,c.fab_woven_req_yds,c.fab_woven_fin_req_yds,c.fab_yarn_req_kg,b.remarks from wo_po_details_master a, wo_pre_cost_mst b left join wo_pre_cost_sum_dtls c on   b.job_no=c.job_no where a.job_no=b.job_no and a.status_active=1 $job_no $company_name $cbo_buyer_name  order by a.job_no";
	}


	$data_array = sql_select($sql);

	ob_start();
	$uom = "";
	$sew_effi_percent = 0;
	$sew_smv = 0;
	$exchange_rate = 0;
	$remarks = "";
	$mst_id = 0;
	foreach ($data_array as $row) {
		$order_price_per_dzn = 0;
		$order_job_qnty = 0;
		$avg_unit_price = 0;
		$sew_effi_percent = $row[csf("sew_effi_percent")];
		$sew_smv = $row[csf("sew_smv")];
		$exchange_rate = $row[csf("exchange_rate")];
		$remarks = $row[csf("remarks")];
		$mst_id = $row[csf("id")];


		$order_values = $row[csf("job_quantity")] * $row[csf("avg_unit_price")];
		$result = sql_select("select po_number,grouping,file_no,pub_shipment_date from wo_po_break_down where job_no_mst=$txt_job_no and status_active=1 and is_deleted=0 order by pub_shipment_date DESC");
		$job_in_orders = '';
		$pulich_ship_date = '';
		$job_in_file = '';
		$job_in_ref = '';
		foreach ($result as $val) {
			$job_in_orders .= $val[csf('po_number')] . ", ";
			$pulich_ship_date = $val[csf('pub_shipment_date')];
			$job_in_ref .= $val[csf('grouping')] . ",";
			$job_in_file .= $val[csf('file_no')] . ",";
		}
		$job_in_orders = substr(trim($job_in_orders), 0, -1);

		$job_ref = array_unique(explode(",", rtrim($job_in_ref, ", ")));
		$job_file = array_unique(explode(",", rtrim($job_in_file, ", ")));

		foreach ($job_ref as $ref) {
			$ref_cond .= ", " . $ref;
		}
		$file_con = '';
		foreach ($job_file as $file) {
			if ($file_con == '') $file_cond = $file;
			else $file_cond .= ", " . $file;
		}

		$img_path = (str_replace("'", "", $path)) ? str_replace("'", "", $path) : '../';

	?>
		<table style="width:850px">
			<tr>
				<td colspan="6" align="center">
					<?
					$image_location = return_field_value("image_location", "common_photo_library", "file_type=1 and form_name='company_details' and master_tble_id=$cbo_company_name", "image_location");
					?>
					<img src='<?= $img_path ?><? echo $image_location; ?>' height='70' align="left" />
					<b style="font-size:25px;"><? echo $comp[str_replace("'", "", $cbo_company_name)]; ?></b><br>
					<b style="font-size:14px;">Budget </b>
				</td>
			</tr>
		</table>


		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px" rules="all">
			<tr>
				<td width="80">Job Number</td>
				<td width="80"><b><? echo $row[csf("job_no")]; ?></b></td>
				<td width="90">Buyer</td>
				<td width="100"><b><? echo $buyer_arr[$row[csf("buyer_name")]]; ?></b></td>
				<td width="80">Garments Item</td>
				<?
				$grmnt_items = "";
				$gmtsArr = array();
				if ($garments_item[$row[csf("gmts_item_id")]] == "") {

					$grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no=$txt_job_no");
					foreach ($grmts_sql as $key => $val) {
						$grmnt_items .= $garments_item[$val[csf("gmts_item_id")]] . ", ";
						$gmtsArr[$val[csf("gmts_item_id")]] = $val[csf("gmts_item_id")];
						//echo $val[csf("gmts_item_id")]."<br>";
					}
					$grmnt_items = substr_replace($grmnt_items, "", -1, 1);
				} else {
					$grmnt_items = $garments_item[$row[csf("gmts_item_id")]];
					$gmtsArr[$row[csf("gmts_item_id")]] = $row[csf("gmts_item_id")];
				}


				?>
				<td width="100"><b><? echo $grmnt_items; ?></b></td>
			</tr>
			<tr>
				<td>Style Ref. No </td>
				<td><b><? echo $row[csf("style_ref_no")]; ?></b></td>
				<td>Job Qnty Set </td>
				<td><b><?= number_format($row[csf("job_quantity")], 0); ?></b></td>
				<td>Job Qnty Pcs</td>
				<td><b><? $uom = $row[csf("order_uom")];
						echo number_format($row[csf("job_quantity")] * $total_set_qnty, 0); ?></b></td>
			</tr>
			<tr>
				<td>Order Numbers</td>
				<td><? echo $job_in_orders; ?></td>
				<td>Plan Cut Qnty Set</td>
				<td><b><? $plunCutQty = array_sum($po_plun_cut_qty_arr);
						echo number_format($plunCutQty, 0);; ?></b></td>
				<td>Plan Cut Qnty Pcs</td>
				<td><b><? $uom = $row[csf("order_uom")];
						echo number_format($plunCutQty * $total_set_qnty, 0);; ?></b></td>
			</tr>
			<tr>
				<td>Knit Fabric Cons</td>
				<td><b><? echo $row[csf("fab_knit_req_kg")];
						$fab_knit_req_kg_avg += $row[csf("fab_knit_req_kg")]; ?> (Kg)</b></td>

				<td>Woven Fabric Cons</td>
				<td><b><? echo $row[csf("fab_woven_req_yds")];
						$fab_woven_req_yds_avg += $row[csf("fab_woven_req_yds")]; ?> (Yds)</b></td>
				<td>Price Per Unit</td>
				<td><b><? echo $row[csf("avg_unit_price")]; ?> USD</b></td>
			</tr>
			<tr>
				<td>Avg Yarn Req</td>
				<td><b><? echo $row[csf("fab_yarn_req_kg")] ?> (Kg)</b></td>
				<td>Costing Per</td>
				<td><b><? echo $costing_per[$row[csf("costing_per")]]; ?></b></td>
				<td>Shipment Date </td>
				<td><b><? echo change_date_format($pulich_ship_date); ?></b></td>
			</tr>
			<tr>
				<td>Knit Fin Fabric Cons</td>
				<td><b><? echo $row[csf("fab_knit_fin_req_kg")] ?> (Kg)</b></td>
				<td>Woven Fin Fabric Cons</td>
				<td><b><? echo $row[csf("fab_woven_fin_req_yds")]; ?>(Yds)</b></td>
				<td>GSM </td>
				<td><b><? //echo $gsm_weight_top.",".$gsm_weight_bottom

						$gsm_weights_top = implode(",", array_unique(explode(",", $gsm_weight_top)));
						$gsm_weight_bottom = implode(",", array_unique(explode(",", $gsm_weight_bottom)));
						if ($gsm_weights_top != '') $gsm_weightTop = $gsm_weights_top;
						else $gsm_weightTop = '';
						if ($gsm_weight_bottom != '' && $gsm_weights_top != '') $gsm_weightBottom = " ," . $gsm_weight_bottom;
						else if ($gsm_weight_bottom != '' && $gsm_weights_top == '') $gsm_weightBottom = $gsm_weight_bottom;
						else $gsm_weightBottom = '';
						echo $gsm_weightTop . $gsm_weightBottom;
						?></b></td>

			</tr>
			<tr>
				<td>SMV</td>
				<td><b><? echo number_format($row[csf("sew_smv")], 2); ?> </b></td>
				<td>CPM</td>
				<td><b><? echo $cpm; ?> </b></td>
				<td>Budget Minute</td>
				<td><b><? echo $row[csf("budget_minute")] ?> </b></td>
			</tr>

			<tr>
				<td>Efficiency</td>
				<td colspan="1"><b><? echo $row[csf("sew_effi_percent")] ?> </b></td>
				<td>Garments Item Set Qty</td>
				<td colspan="1"><b><? echo count($gmtsArr); ?> </b></td>
				<?
				$amount = $row[csf("job_quantity")] * $row[csf("avg_unit_price")];
				?>
				<td>Amount</td>
				<td colspan="1"><b><? echo fn_number_format($amount, 4); ?></b></td>
			</tr>
			<tr>
				<td align="center" height="10" colspan="6" valign="top" id="app_sms" style="font-size:18px;">
					<font color="#FF0000"><?



											$ap_msg = "";
											if ($row[csf("approved")] == 1) {
												$ap_msg = "This Job Is Full Approved.";
											} else if ($row[csf("approved")] == 3) {
												$approval_allow = sql_select("select b.id, b.page_id, b.approval_need, b.allow_partial, b.validate_page,a.setup_date from approval_setup_mst a,approval_setup_dtls b where a.id=b.mst_id and a.company_id='$company_id' and a.status_active=1 and b.page_id=25 and b.status_active=1 and b.is_deleted=0 order by b.id desc ");
												if ($approval_allow[0][csf("approval_need")] == 1 && $approval_allow[0][csf("allow_partial")] == 1) {
													$ap_msg = "This Job Is Approved.";
												} else {
													$ap_msg = "This Job Partially Approved.";
												}
											} else {
												$ap_msg = " ";
											}
											echo $ap_msg;


											?> </font>
				</td>
			</tr>
		</table>
		<?
		if ($row[csf("costing_per")] == 1) {
			$order_price_per_dzn = 12;
			$costing_for = " DZN";
		} else if ($row[csf("costing_per")] == 2) {
			$order_price_per_dzn = 1;
			$costing_for = " PCS";
		} else if ($row[csf("costing_per")] == 3) {
			$order_price_per_dzn = 24;
			$costing_for = " 2 DZN";
		} else if ($row[csf("costing_per")] == 4) {
			$order_price_per_dzn = 36;
			$costing_for = " 3 DZN";
		} else if ($row[csf("costing_per")] == 5) {
			$order_price_per_dzn = 48;
			$costing_for = " 4 DZN";
		}
		$order_job_qnty = $row[csf("job_quantity")];
		$avg_unit_price = $row[csf("avg_unit_price")];
	} //end first foearch


	$lib_designation_arr = return_library_array(" select id,custom_designation from lib_designation", "id", "custom_designation");
	$user_lib_designation_arr = return_library_array("SELECT id,designation from user_passwd", "id", "designation");
	$user_lib_name_arr = return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
	// $mst_id=return_field_value("id as mst_id","wo_pre_cost_mst","id=$mst_id","mst_id");

	$approve_data_array = sql_select("select b.approved_by,min(b.approved_date) as approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=15  group by  b.approved_by order by b.approved_by asc");
	$unapprove_data_array = sql_select("select b.approved_by,b.approved_date,b.un_approved_reason,b.un_approved_date,b.approved_no from   approval_history b where b.mst_id=$mst_id and b.entry_form=15  order by b.approved_date,b.approved_by");


	if (count($approve_data_array) > 0) {
		?>
		<table width="850" class="rpt_table" border="1" cellpadding="0" cellspacing="0" rules="all">
			<thead>
				<tr style="border:1px solid black;">
					<th colspan="5" style="border:1px solid black;">Approval Status</th>
				</tr>
				<tr style="border:1px solid black;">
					<th width="3%" style="border:1px solid black;">Sl</th>
					<th width="40%" style="border:1px solid black;">Name</th>
					<th width="30%" style="border:1px solid black;">Designation</th>
					<th width="27%" style="border:1px solid black;">Approval Date</th>

				</tr>
			</thead>
			<tbody>
				<?
				$i = 1;
				foreach ($approve_data_array as $row) {


				?>
					<tr style="border:1px solid black;">
						<td width="3%" style="border:1px solid black;"><? echo $i; ?></td>
						<td width="40%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]]; ?></td>
						<td width="30%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]]; ?></td>
						<td width="27%" style="border:1px solid black;text-align:center"><? echo date("d-m-Y h:i:s", strtotime($row[csf('approved_date')])); ?></td>

					</tr>
				<?
					$i++;
				}
				?>
			</tbody>
		</table>
	<?
	}
	?>
	<br />
	<?
	$sql_unapproved = sql_select("select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=15 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id=$mst_id");
	//	echo  "select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=15 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id=$mst_id";
	$unapproved_request_arr = array();
	foreach ($sql_unapproved as $rowu) {
		$unapproved_request_arr[$rowu[csf('booking_id')]] = $rowu[csf('approval_cause')];
	}

	if (count($unapprove_data_array) > 0) {
	?>
		<table width="850" class="rpt_table" border="1" cellpadding="0" cellspacing="0" rules="all">
			<thead>
				<tr style="border:1px solid black;">
					<th colspan="6" style="border:1px solid black;">Approval/Un Approval History</th>
				</tr>
				<tr style="border:1px solid black;">
					<th width="3%" style="border:1px solid black;">Sl</th>
					<th width="30%" style="border:1px solid black;">Name</th>
					<th width="20%" style="border:1px solid black;">Designation</th>
					<th width="5%" style="border:1px solid black;">Approval Status</th>
					<th width="20%" style="border:1px solid black;">Reason For Un Approval</th>
					<th width="22%" style="border:1px solid black;"> Date</th>
				</tr>
			</thead>
			<tbody>
				<?
				$i = 1;
				foreach ($unapprove_data_array as $row) {

				?>
					<tr style="border:1px solid black;">
						<td width="3%" style="border:1px solid black;"><? echo $i; ?></td>
						<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]]; ?></td>
						<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]]; ?></td>
						<td width="5%" style="border:1px solid black; text-align:center"><? echo 'Yes'; ?></td>
						<td width="20%" style="border:1px solid black;"><? echo ''; ?></td>
						<td width="22%" style="border:1px solid black;text-align:center"><? if ($row[csf('approved_date')] != "") echo date("d-m-Y h:i:s", strtotime($row[csf('approved_date')]));
																							else echo ""; ?></td>
					</tr>
					<?
					$i++;
					$un_approved_date = explode(" ", $row[csf('un_approved_date')]);
					$un_approved_date = $un_approved_date[0];
					if ($db_type == 0) //Mysql
					{
						if ($un_approved_date == "" || $un_approved_date == "0000-00-00") $un_approved_date = "";
						else $un_approved_date = $un_approved_date;
					} else {
						if ($un_approved_date == "") $un_approved_date = "";
						else $un_approved_date = $un_approved_date;
					}

					if ($un_approved_date != "") {
					?>
						<tr style="border:1px solid black;">
							<td width="3%" style="border:1px solid black;"><? echo $i; ?></td>
							<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]]; ?></td>
							<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]]; ?></td>
							<td width="5%" style="border:1px solid black;text-align:center;"><? echo 'No'; ?></td>
							<td width="20%" style="border:1px solid black;text-align:center"><? echo $row[csf('un_approved_reason')]; //$unapproved_request_arr[$mst_id];
																								?></td>
							<td width="22%" style="border:1px solid black;text-align:center"><? if ($row[csf('un_approved_date')] != "") echo date("d-m-Y h:i:s", strtotime($row[csf('un_approved_date')]));
																								else echo ""; ?></td>
						</tr>

				<?
						$i++;
					}
				}
				?>
			</tbody>
		</table>
	<?
	}
	?>
	<br>


	<?

	//start	all summary report here -------------------------------------------
	$sql = "select fabric_cost,fabric_cost_percent,trims_cost,trims_cost_percent,embel_cost,embel_cost_percent,wash_cost,wash_cost_percent,comm_cost,comm_cost_percent,commission,commission_percent, lab_test,lab_test_percent,inspection,inspection_percent,cm_cost,cm_cost_percent,freight,freight_percent,currier_pre_cost,currier_percent,certificate_pre_cost,certificate_percent,common_oh,common_oh_percent,total_cost ,total_cost_percent,price_dzn,price_dzn_percent,margin_dzn,margin_dzn_percent,price_pcs_or_set,price_pcs_or_set_percent,margin_pcs_set, margin_pcs_set_percent,cm_for_sipment_sche,design_cost,design_percent, studio_cost, studio_percent, common_oh, common_oh_percent, depr_amor_pre_cost, depr_amor_po_price,interest_cost, interest_percent, incometax_cost, incometax_percent,margin_pcs_bom, margin_bom_per,incentives_pre_cost,incentives_pre_cost_per from wo_pre_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";

	//echo $sql;
	$data_array = sql_select($sql);




	$condition = new condition();
	if (str_replace("'", "", $txt_job_no) != '') {
		$condition->job_no("=$txt_job_no");
	}
	if (str_replace("'", '', $txt_po_breack_down_id) != "") {
		$condition->po_id("in($selected_po_breack_down_id)");
	}

	$condition->init();
	$fabric = new fabric($condition);

	$yarn = new yarn($condition);
	$conversion = new conversion($condition);
	$trim = new trims($condition);
	$emblishment = new emblishment($condition);
	$wash = new wash($condition);
	$other = new other($condition);
	$other_cost = $other->getAmountArray_by_job();
	//$trims_cost_arr=$trim->getQtyArray_by_orderAndItemidTypeid();
	// print_r($other_cost);
	$commercial = new commercial($condition);
	$commision = new commision($condition);


	//Fabric =====================
	$fabric_qty = $fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
	$fabric_amount = $fabric->getAmountArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
	$sql_fabric = "select id, job_no, body_part_id, fab_nature_id, color_type_id, fabric_description,uom, avg_cons,avg_cons_yarn, fabric_source,gsm_weight, rate, amount, avg_finish_cons, status_active from wo_pre_cost_fabric_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_arr_fabric = sql_select($sql_fabric);
	$summary_data = array();
	foreach ($data_arr_fabric as $fab_row) {
		$summary_data[fabric_cost][$fab_row[csf("id")]] = $fab_row[csf("amount")];
		$summary_data[fabric_cost_job] += $fabric_amount['knit']['grey'][$fab_row[csf("id")]][$fab_row[csf("uom")]];
		$summary_data[fabric_cost_job] += $fabric_amount['woven']['grey'][$fab_row[csf("id")]][$fab_row[csf("uom")]];
	}

	//Fabric End======================




	//Yarn===========================
	$totYarn = 0;
	$YarnData = array();
	$yarn_data_array = $yarn->get_By_Precostdtlsid_YarnQtyAmountArray();
	$sql_yarn = "select f.id as yarn_id, f.cons_ratio, f.cons_qnty, f.avg_cons_qnty, f.rate, f.amount, count_id, copm_one_id, percent_one, color, type_id from wo_pre_cost_fab_yarn_cost_dtls f where f.job_no =" . $txt_job_no . " and f.is_deleted=0 and f.status_active=1  order by f.id";
	$data_arr_yarn = sql_select($sql_yarn);
	foreach ($data_arr_yarn as $yarn_row) {
		$yarnrate = $yarn_row[csf("rate")];
		$summary_data[yarn_cost][$yarn_row[csf("yarn_id")]] = $yarn_row[csf("amount")];
		$summary_data[yarn_cost_job] += $yarn_data_array[$yarn_row[csf("yarn_id")]]['amount'];
		$index = "'" . $yarn_row[csf("count_id")] . "_" . $yarn_row[csf("copm_one_id")] . "_" . $yarn_row[csf("percent_one")] . "_" . $yarn_row[csf("type_id")] . "_" . $yarn_row[csf("color")] . "_" . $yarnrate . "'";
		$YarnData[$index]['qty'] += $yarn_data_array[$yarn_row[csf("yarn_id")]]['qty'];
		$YarnData[$index]['amount'] += $yarn_data_array[$yarn_row[csf("yarn_id")]]['amount'];
		$YarnData[$index]['dznqty'] += $yarn_row[csf("cons_qnty")];
		$YarnData[$index]['dznamount'] += $yarn_row[csf("amount")];
		$totYarn += $yarn_data_array[$yarn_row[csf("yarn_id")]]['qty'];
	}
	//Yarn End============================



	//start	Trims Cost part report here -------------------------------------------
	$sql_trim = "select id, job_no, trim_group,description,brand_sup_ref,remark, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp,status_active,seq
from wo_pre_cost_trim_cost_dtls
where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0 order by seq";
	$data_array_trim = sql_select($sql_trim);
	$trim_amount_arr = $trim->getAmountArray_precostdtlsid();
	$trim_qty_arr = $trim->getQtyArray_by_precostdtlsid();
	//$trim_type_qty_arr=$trim->getQtyArray_by_orderAndTrimsTypeid();
	//print_r($trim_type_qty_arr);
	$totTrim = 0;
	$TrimData = array();
	foreach ($data_array_trim as $row_trim) {
		$trim_qty = $trim_qty_arr[$row_trim[csf("id")]];
		$trim_amount = $trim_amount_arr[$row_trim[csf("id")]];
		$summary_data[trims_cost_job] += $trim_amount;
		$TrimData[$row_trim[csf('id')]]['trim_group'] = $row_trim[csf('trim_group')];
		$TrimData[$row_trim[csf('id')]]['description'] = $row_trim[csf('description')];
		$TrimData[$row_trim[csf('id')]]['brand_sup_ref'] = $row_trim[csf('brand_sup_ref')];
		$TrimData[$row_trim[csf('id')]]['remark'] = $row_trim[csf('remark')];
		$TrimData[$row_trim[csf('id')]]['cons_uom'] = $row_trim[csf('cons_uom')];
		$TrimData[$row_trim[csf('id')]]['cons_dzn_gmts'] = $row_trim[csf('cons_dzn_gmts')];
		$TrimData[$row_trim[csf('id')]]['rate'] = $row_trim[csf('rate')];
		$TrimData[$row_trim[csf('id')]]['amount'] = $row_trim[csf('amount')];
		$TrimData[$row_trim[csf('id')]]['apvl_req'] = $row_trim[csf('apvl_req')];
		$TrimData[$row_trim[csf('id')]]['nominated_supp'] = $row_trim[csf('nominated_supp')];
		$TrimData[$row_trim[csf('id')]]['tot_cons'] = $trim_qty;
		$TrimData[$row_trim[csf('id')]]['tot_amount'] = $trim_amount;
		$totTrim += $row_trim[csf('cons_dzn_gmts')];
	}
	//End	Trims Cost part report here -------------------------------------------



	$sql_new = "select job_no, fabric_cost, fabric_cost_percent, trims_cost, trims_cost_percent, embel_cost, embel_cost_percent, wash_cost, wash_cost_percent, comm_cost, comm_cost_percent, commission, commission_percent, lab_test, lab_test_percent, inspection, inspection_percent, cm_cost, cm_cost_percent, freight, freight_percent, currier_pre_cost, currier_percent, certificate_pre_cost, certificate_percent, common_oh, common_oh_percent, depr_amor_pre_cost, total_cost, total_cost_percent, price_dzn, price_dzn_percent, margin_dzn, margin_dzn_percent, price_pcs_or_set, price_pcs_or_set_percent, margin_pcs_set, margin_pcs_set_percent, cm_for_sipment_sche, design_cost, design_percent, studio_cost, studio_percent,incentives_pre_cost,incentives_pre_cost_per,incentives_pre_rate,incentives_pre_cost,margin_pcs_bom from wo_pre_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array_new = sql_select($sql_new);

	foreach ($data_array_new as $row_new) {
		$summary_data[price_dzn] = $row_new[csf("price_dzn")];
		$summary_data[price_dzn_job] = $total_fob_value; //($po_qty/($total_set_qnty*$order_price_per_dzn))*$row_new[csf("price_dzn")];
		$summary_data[commission] = $row_new[csf("commission")];
		$summary_data[trims_cost] = $row_new[csf("trims_cost")];
		$summary_data[emb_cost] = $row_new[csf("embel_cost")];
		$summary_data[lab_test] = $row_new[csf("lab_test")];
		$summary_data[margin_pcs_bom] = $row_new[csf("margin_pcs_bom")];

		$summary_data[lab_test_job] = $other_cost[$row_new[csf("job_no")]]['lab_test'];
		$summary_data[incentives_cost] = $other_cost[$row_new[csf("job_no")]]['incentives_cost'];
		$summary_data[inspection] = $row_new[csf("incentives_pre_cost")];
		$summary_data[inspection_job] = $other_cost[$row_new[csf("job_no")]]['inspection'];
		$summary_data[freight] = $row_new[csf("freight")];
		$summary_data[freight_job] = $other_cost[$row_new[csf("job_no")]]['freight'];
		$summary_data[design] = $row_new[csf("design_cost")];
		$summary_data[margin_pcs_set] = $row_new[csf("margin_pcs_set")];
		$summary_data[design_job] = $other_cost[$row_new[csf("job_no")]]['design_cost'];
		//	$summary_data[design_job]=$row_new[csf("design_cost")]/$order_price_per_dzn*$po_qty;
		$summary_data[studio_job] = $other_cost[$row_new[csf("job_no")]]['studio_cost'];
		$summary_data[studio] = $row_new[csf("studio_cost")];
		//$summary_data[studio_job]=$row_new[csf("studio_cost")]/$order_price_per_dzn*$po_qty;
		$summary_data[currier_pre_cost] = $row_new[csf("currier_pre_cost")];
		$summary_data[currier_pre_cost_job] = $other_cost[$row_new[csf("job_no")]]['currier_pre_cost'];
		$summary_data[certificate_pre_cost] = $row_new[csf("certificate_pre_cost")];
		$summary_data[certificate_pre_cost_job] = $other_cost[$row_new[csf("job_no")]]['certificate_pre_cost'];
		$summary_data[wash_cost] = $row_new[csf("wash_cost")];
		$summary_data[OtherDirectExpenses] = $row_new[csf("lab_test")] + $row_new[csf("inspection")] + $row_new[csf("design_cost")] + $row_new[csf("studio_cost")] + $row_new[csf("freight")] + $row_new[csf("currier_pre_cost")] + $row_new[csf("certificate_pre_cost")] + $row_new[csf("wash_cost")] + $row_new[csf("incentives_pre_cost")];
		$summary_data[OtherDirectExpenses_job] = $summary_data[lab_test_job] + $summary_data[incentives_cost] + $summary_data[inspection_job] + $summary_data[design_job] + $summary_data[studio_job] + $summary_data[freight_job] + $summary_data[currier_pre_cost_job] + $summary_data[certificate_pre_cost_job];

		$summary_data[cm_cost] = $row_new[csf("cm_cost")];
		$summary_data[cm_cost_job] = $other_cost[$row_new[csf("job_no")]]['cm_cost'];
		$summary_data[comm_cost] = $row_new[csf("comm_cost")];
		$summary_data[common_oh] = $row_new[csf("common_oh")];
		$summary_data[common_oh_job] = $other_cost[$row_new[csf("job_no")]]['common_oh'];
		$summary_data[depr_amor_pre_cost] = $row_new[csf("depr_amor_pre_cost")];
		$summary_data[depr_amor_pre_cost_job] = $other_cost[$row_new[csf("job_no")]]['depr_amor_pre_cost'];
	}




	//Conversion
	$totConv = 0;
	$ConvData = array();
	$conv_data = array();
	$conv_amount_arr = $conversion->getAmountArray_by_conversionid();
	$conv_qty_arr = $conversion->getQtyArray_by_conversionid();
	$sql_conv = "select a.id as con_id, a.fabric_description as fabric_description_id, a.job_no, a.cons_process, a.req_qnty,a.avg_req_qnty, a.charge_unit, a.amount, a.status_active,b.body_part_id,b.fab_nature_id,b.color_type_id,b.fabric_description,b.uom  from wo_pre_cost_fab_conv_cost_dtls a left join wo_pre_cost_fabric_cost_dtls b on a.job_no=b.job_no and a.fabric_description=b.id and b.status_active=1 and b.is_deleted=0 where a.job_no=" . $txt_job_no . "  and a.id>0 and a.is_deleted =0 and a.status_active=1 ";
	$data_arr_conv = sql_select($sql_conv);
	foreach ($data_arr_conv as $conv_row) {
		$convamount = array_sum($conv_amount_arr[$conv_row[csf('con_id')]]);
		$convQty = array_sum($conv_qty_arr[$conv_row[csf('con_id')]]);
		$conv_data[cons_process][$conv_row[csf('con_id')]] = $conv_row[csf('cons_process')];
		$conv_data[amount][$conv_row[csf('con_id')]] = $conv_row[csf('amount')];
		$conv_data[amount_job][$conv_row[csf('con_id')]] += $convamount;
		$summary_data[conver_cost_job] += $convamount;

		$index = $conv_row[csf('con_id')];
		$ConvData[$index]['item_descrition'] = $body_part[$conv_row[csf("body_part_id")]] . ", " . $color_type[$conv_row[csf("color_type_id")]] . ", " . $conv_row[csf("fabric_description")];
		$ConvData[$index]['cons_process'] = $conv_row[csf("cons_process")];
		$ConvData[$index]['req_qnty'] = $conv_row[csf("req_qnty")];
		$ConvData[$index]['uom'] = $conv_row[csf("uom")];
		$ConvData[$index]['charge_unit'] = $conv_row[csf("charge_unit")];
		$ConvData[$index]['amount'] = $conv_row[csf("amount")];
		$ConvData[$index]['tot_req_qnty'] = $convQty;
		$ConvData[$index]['tot_amount'] = $convamount;
		$totConv += $conv_row[csf("req_qnty")];
	}
	//Conversion End

	//Emb cost Cost part report here -------------------------------------------

	$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pre_cost_embe_cost_dtls where job_no=" . $txt_job_no . " and emb_name in(1,2,4,5) and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	$emblishment_qty = $emblishment->getQtyArray_by_jobAndEmblishmentid();
	$emblishment_amount = $emblishment->getAmountArray_by_jobAndEmblishmentid();
	$totEmb = 0;
	$EmbData = array();

	foreach ($data_array as $row) {
		$embqty = $emblishment_qty[$row[csf("job_no")]][$row[csf("id")]];
		$embamount = $emblishment_amount[$row[csf("job_no")]][$row[csf("id")]];
		$summary_data[emb_cost_job] += $embamount;
		$EmbData[$row[csf("id")]]['emb_name'] = $row[csf("emb_name")];
		$EmbData[$row[csf("id")]]['emb_type'] = $row[csf("emb_type")];
		$EmbData[$row[csf("id")]]['cons_dzn_gmts'] = $row[csf("cons_dzn_gmts")];
		$EmbData[$row[csf("id")]]['rate'] = $row[csf("rate")];
		$EmbData[$row[csf("id")]]['amount'] = $row[csf("amount")];
		$EmbData[$row[csf("id")]]['tot_cons'] = $embqty;
		$EmbData[$row[csf("id")]]['tot_amount'] = $embamount;
		$totEmb += $row[csf("cons_dzn_gmts")];
	}
	//End Emb cost Cost part report here -------------------------------------------
	//Wash cost Cost part report here -------------------------------------------
	$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pre_cost_embe_cost_dtls where job_no=" . $txt_job_no . " and emb_name =3 and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	$wash_qty = $wash->getQtyArray_by_jobAndEmblishmentid();
	$wash_amount = $wash->getAmountArray_by_jobAndEmblishmentid();
	foreach ($data_array as $row) {
		$washqty = $wash_qty[$row[csf("job_no")]][$row[csf("id")]];
		$washamount = $wash_amount[$row[csf("job_no")]][$row[csf("id")]];
		$summary_data[wash_cost_job] += $washamount;
		$summary_data[OtherDirectExpenses_job] += $washamount;
		$EmbData[$row[csf("id")]]['emb_name'] = $row[csf("emb_name")];
		$EmbData[$row[csf("id")]]['emb_type'] = $row[csf("emb_type")];
		$EmbData[$row[csf("id")]]['cons_dzn_gmts'] = $row[csf("cons_dzn_gmts")];
		$EmbData[$row[csf("id")]]['rate'] = $row[csf("rate")];
		$EmbData[$row[csf("id")]]['amount'] = $row[csf("amount")];
		$EmbData[$row[csf("id")]]['tot_cons'] = $washqty;
		$EmbData[$row[csf("id")]]['tot_amount'] = $washamount;
		$totEmb += $row[csf("cons_dzn_gmts")];
	}
	//End Wash cost Cost part report here -------------------------------------------
	//Commision cost Cost part report here -------------------------------------------
	$sql = "select id,job_no,particulars_id,commission_base_id,commision_rate,commission_amount, status_active from wo_pre_cost_commiss_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	$commision_amount = $commision->getAmountArray_by_jobAndPrecostdtlsid();
	$totCommi = 0;
	$CommiData = array();
	foreach ($data_array as $row) {
		$commisionamount = $commision_amount[$row[csf("job_no")]][$row[csf("id")]];
		$summary_data[commission_job] += $commisionamount;
		$CommiData[$row[csf("id")]]['particulars_id'] = $row[csf("particulars_id")];
		$CommiData[$row[csf("id")]]['commission_base_id'] = $row[csf("commission_base_id")];
		$CommiData[$row[csf("id")]]['commision_rate'] = $row[csf("commision_rate")];
		$CommiData[$row[csf("id")]]['commission_amount'] = $row[csf("commission_amount")];
		$CommiData[$row[csf("id")]]['tot_commission_amount'] = $commisionamount;
		$totCommi += $row[csf("commission_amount")];
	}
	//End Commision cost Cost part report here -------------------------------------------
	//Commarcial cost Cost part report here -------------------------------------------
	$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls  where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	$commarcial_amount = $commercial->getAmountArray_by_jobAndPrecostdtlsid();

	$totCommar = 0;
	$CommarData = array();
	foreach ($data_array as $row) {
		$commarcialamount = $commarcial_amount[$row[csf("job_no")]][$row[csf("id")]];
		$summary_data[comm_cost_job] += $commarcialamount;
		$CommarData[$row[csf("id")]]['item_id'] = $row[csf("item_id")];
		$CommarData[$row[csf("id")]]['rate'] = $row[csf("rate")];
		$CommarData[$row[csf("id")]]['amount'] = $row[csf("amount")];
		$CommarData[$row[csf("id")]]['tot_amount'] = $commarcialamount;
		$totCommar += $row[csf("amount")];
	}

	$others_cost_value = 0;
	$fabric_cost = 0;
	$trims_cost = 0;
	$embel_cost = 0;
	$comm_cost = 0;
	$commission = 0;
	$lab_test = 0;
	$inspection = 0;
	$cm_cost = 0;
	$freight = 0;
	$currier_pre_cost = 0;
	$certificate_pre_cost = 0;
	$common_oh = 0;
	$margin_pcs_bom = 0;
	$margin_bom_per = 0;
	?>

	<div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;" rules="all">
			<tr style="font-weight:bold">
				<td align="center" width="850" colspan="5">Order Profitability </td>
			</tr>
			<tr style="font-weight:bold">
				<td align="center" width="80">Line Items</td>
				<td width="400">Particulars</td>
				<!-- <td width="120">Amount (USD)/<? echo $costing_for; ?></td> -->
				<td width="120">Total Value</td>
				<td>%</td>
			</tr>
			<tr>
				<td align="center">1</td>
				<td style="font-weight:bold">Gross FOB Value</td>

				<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[price_dzn_job], 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[price_dzn_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>
				<td align="center">2</td>
				<td style=" padding-left:15px">Less: commission</td>

				<td align="right"><? echo fn_number_format($summary_data[commission_job], 4); ?></td>
				<td align="right"><? echo fn_number_format(($summary_data[commission_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>
				<td align="center">3</td>
				<?
				$NetFOBValue = $summary_data[price_dzn] - $summary_data[commission];
				$NetFOBValue_job = $summary_data[price_dzn_job] - $summary_data[commission_job];
				?>
				<td style="font-weight:bold"><b>Net FOB Value (1-2)</b></td>

				<td align="right" style="font-weight:bold"><? echo fn_number_format($NetFOBValue_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($NetFOBValue_job / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>
				<td align="center">4</td>
				<td style="font-weight:bold"><b>Less: Cost of Material & Services (5+6+7+8+9) </b></td>
				<?
				$Less_Cost_Material_Services = array_sum($summary_data[yarn_cost]) + array_sum($summary_data[fabric_cost]) + array_sum($conv_data[amount]) + $summary_data[trims_cost] + $summary_data[emb_cost] + $summary_data[lab_test] + $summary_data[inspection] + $summary_data[design] + $summary_data[studio] + $summary_data[freight] + $summary_data[currier_pre_cost] + $summary_data[certificate_pre_cost] + $summary_data[wash_cost];

				$Less_Cost_Material_Services_job = $summary_data[yarn_cost_job] + $summary_data[fabric_cost_job] + $summary_data[conver_cost_job] + $summary_data[trims_cost_job] + $summary_data[emb_cost_job] + $summary_data[OtherDirectExpenses_job];
				//$Less_Cost_Material_Services_job=array_sum($summary_data[yarn_cost])+array_sum($summary_data[fabric_cost])+array_sum($conv_data[amount])+$summary_data[trims_cost]+$summary_data[emb_cost]+$summary_data[OtherDirectExpenses_dzn];
				?>

				<td align="right" style="font-weight:bold"><? echo fn_number_format($Less_Cost_Material_Services_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($Less_Cost_Material_Services_job / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>
				<td align="center" rowspan="2">5</td>
				<td style=" padding-left:100px;font-weight:bold">Fabric Purchase Cost</td>

				<td align="right" style="font-weight:bold"> <? echo fn_number_format($summary_data[fabric_cost_job], 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[fabric_cost_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>
				<td style=" padding-left:100px;font-weight:bold">Yarn Cost</td>

				<td align="right" style="font-weight:bold"> <? echo fn_number_format($summary_data[yarn_cost_job], 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[yarn_cost_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>
				<td align="center" valign="top">6</td>
				<td width="400" style=" padding-left:100px">
					<table>
						<tr>
							<td style="font-weight:bold">Conversion Cost</td>
						</tr>
					</table>

					<?php
					if ($zero_value == 1) { ?>
						<table border="1" class="rpt_table" rules="all">
							<? foreach ($conv_data[cons_process] as $key => $value) { ?>
								<tr>
									<td align="left"><? echo $conversion_cost_head_array[$conv_data[cons_process][$key]]; ?></td>
								</tr>
							<? } ?>
						</table>
					<? } ?>
				</td>

				<td align="right" valign="top">
					<table>
						<tr>
							<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[conver_cost_job], 4); ?></td>
						</tr>
					</table>

					<?php
					if ($zero_value == 1) { ?>
						<table border="1" class="rpt_table" rules="all">
							<? foreach ($conv_data[cons_process] as $key => $value) { ?>
								<tr>
									<td align="right"><? echo fn_number_format($conv_data[amount_job][$key], 4); ?></td>
								</tr>
							<? } ?>
						</table>
					<? } ?>
				</td>
				<td align="right" valign="top">
					<table>
						<tr>
							<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[conver_cost_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
						</tr>
					</table>
					<?php
					if ($zero_value == 1) { ?>
						<table border="1" class="rpt_table" rules="all">
							<? foreach ($conv_data[cons_process] as $key => $value) { ?>
								<tr>
									<td align="right"><? echo fn_number_format(($conv_data[amount_job][$key] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
								</tr>
							<? } ?>
						</table>
					<? } ?>
				</td>
			</tr>
			<tr>
				<td align="center">7</td>
				<td style="padding-left:100px;font-weight:bold"><b>Trim Cost </b></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[trims_cost_job], 4) ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[trims_cost_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>
				<td align="center">8</td>
				<td style=" padding-left:100px;font-weight:bold"><b>Embelishment Cost </b></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[emb_cost_job], 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[emb_cost_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>
				<td align="center" valign="top">9</td>
				<td style="padding-left:100px">
					<table>
						<tr>
							<td style="font-weight:bold">Other Direct Expenses</td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<tr>
							<td>Lab Test</td>
						</tr>
						<tr>
							<td>Inspection</td>
						</tr>
						<tr>
							<td>Design Cost</td>
						</tr>
						<tr>
							<td>Studio Cost</td>
						</tr>
						<tr>
							<td>Freight Cost</td>
						</tr>
						<tr>
							<td>Courier Cost</td>
						</tr>
						<tr>
							<td>Certificate Cost</td>
						</tr>
						<tr>
							<td>Garments Wash Cost</td>
						</tr>
						<tr>
							<td>Incentives Missing Cost</td>
						</tr>
					</table>
				</td>

				<td align="right" valign="top">
					<table>
						<tr>
							<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[OtherDirectExpenses_job], 4); ?></td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[lab_test_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[inspection_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[design_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[studio_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[freight_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[currier_pre_cost_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[certificate_pre_cost_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[wash_cost_job], 4); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format($summary_data[incentives_cost], 4); ?></td>
						</tr>
					</table>
				</td>
				<td align="right" valign="top">
					<table>
						<tr>
							<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[OtherDirectExpenses_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
						</tr>
					</table>
					<table border="1" class="rpt_table" rules="all">
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[lab_test_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[inspection_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[design_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[studio_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[freight_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[currier_pre_cost_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[certificate_pre_cost_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
						</tr>
						<tr>
							<td align="right" title="<?= $summary_data[wash_cost] . '=' . $summary_data[price_dzn]; ?>"><? echo fn_number_format(($summary_data[wash_cost_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
						</tr>
						<tr>
							<td align="right"><? echo fn_number_format(($summary_data[incentives_cost] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
						</tr>
					</table>
				</td>
			</tr>
			<tr>
				<td align="center">10</td>
				<td style="font-weight:bold">Contributions/Value Additions (3-4)</td>
				<?
				$Contribution_Margin = $NetFOBValue - $Less_Cost_Material_Services;
				$Contribution_Margin_job = $NetFOBValue_job - $Less_Cost_Material_Services_job;
				?>

				<td align="right" style="font-weight:bold"><? echo fn_number_format($Contribution_Margin_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($Contribution_Margin_job / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>
				<td align="center">11</td>
				<td style=" padding-left:15px">Less: CM Cost </td>
				<td align="right"><? echo fn_number_format($summary_data[cm_cost_job], 4); ?></td>
				<td align="right"><? echo fn_number_format(($summary_data[cm_cost_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>
				<td align="center">12</td>
				<td style="font-weight:bold">Gross Profit (10-11)</td>
				<?
				$Gross_Profit = $Contribution_Margin - $summary_data[cm_cost];
				$Gross_Profit_job = $Contribution_Margin_job - $summary_data[cm_cost_job];
				?>

				<td align="right" style="font-weight:bold"><? echo fn_number_format($Gross_Profit_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($Gross_Profit_job / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>
				<td align="center">13</td>
				<td style=" padding-left:15px">Less: Commercial Cost</td>
				<td align="right"><? echo fn_number_format($summary_data[comm_cost_job], 4); ?></td>
				<td align="right"><? echo fn_number_format(($summary_data[comm_cost_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>
				<td align="center">14</td>
				<td style=" padding-left:15px">Less: Operating Expensees</td>
				<td align="right"><? echo fn_number_format($summary_data[common_oh_job], 4); ?> </td>
				<td align="right"><? echo fn_number_format(($summary_data[common_oh_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>
				<td align="center">15</td>
				<td style="font-weight:bold">Operating Profit/ Loss (12-(13+14))</td>
				<?
				$OperatingProfitLoss = $Gross_Profit - ($summary_data[comm_cost] + $summary_data[common_oh]);
				$OperatingProfitLoss_job = $Gross_Profit_job - ($summary_data[comm_cost_job] + $summary_data[common_oh_job]);
				?>

				<td align="right" style="font-weight:bold"><? echo fn_number_format($OperatingProfitLoss_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($OperatingProfitLoss_job / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>
				<td align="center">16</td>
				<td style=" padding-left:15px">Less: Depreciation & Amortization </td>
				<td align="right"><? echo fn_number_format($summary_data[depr_amor_pre_cost_job], 4); ?></td>
				<td align="right"><? echo fn_number_format(($summary_data[depr_amor_pre_cost_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>
				<?
				$pre_costing_date = change_date_format($costing_date, '', '', 1);
				$interest_expense = $NetFOBValue * $financial_para[$pre_costing_date][interest_expense] / 100;
				$income_tax = $NetFOBValue * $financial_para[$pre_costing_date][income_tax] / 100;
				$interest_expense_job = $NetFOBValue_job * $financial_para[$pre_costing_date][interest_expense] / 100;
				$income_tax_job = $NetFOBValue_job * $financial_para[$pre_costing_date][income_tax] / 100;
				?>
				<td align="center">17</td>
				<td style=" padding-left:15px">Less: Interest </td>

				<!-- <td align="right"> <? echo fn_number_format($interest_expense, 4); ?></td> -->
				<td align="right"><? echo fn_number_format($interest_expense_job, 4); ?></td>
				<td align="right"><? echo fn_number_format(($interest_expense_job / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>
				<td align="center">18</td>
				<td style=" padding-left:15px">Less: Income Tax</td>

				<!-- <td align="right"> <? echo fn_number_format($income_tax, 4); ?></td> -->
				<td align="right"><? echo fn_number_format($income_tax_job, 4); ?></td>
				<td align="right"><? echo fn_number_format(($income_tax_job / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>
				<?
				$Netprofit = $OperatingProfitLoss - ($summary_data[depr_amor_pre_cost] + $interest_expense + $income_tax);
				$Netprofit_job = $OperatingProfitLoss_job - ($summary_data[depr_amor_pre_cost_job] + $interest_expense_job + $income_tax_job);
				?>
				<td align="center">19</td>
				<td style="font-weight:bold">Net Profit/Loss (15-(16+17+18))</td>

				<!-- <td align="right" style="font-weight:bold"><? echo fn_number_format($Netprofit, 4); ?> </td> -->
				<td align="right" style="font-weight:bold"><? echo fn_number_format($Netprofit_job, 4); ?></td>
				<td align="right" style="font-weight:bold"><? echo fn_number_format(($Netprofit_job / $summary_data[price_dzn_job]) * 100, 2); ?></td>
			</tr>
			<tr>

				<td align="center">20</td>
				<td style="font-weight:bold">Margin Per <?= $unit_of_measurement[$uom]; ?></td>

				<td align="right" style="font-weight:bold"><?= fn_number_format($summary_data[margin_pcs_bom], 4); ?></td>
				<td align="right" style="font-weight:bold"></td>
			</tr>
		</table>
	</div>
	<?
	//End all summary report here -------------------------------------------

	$process_loss_data = sql_select("select id, po_break_down_id, color_number_id, gmts_sizes, dia_width, item_size, cons, process_loss_percent, requirment, pcs, color_size_table_id, rate, amount, remarks,pre_cost_fabric_cost_dtls_id,job_no from wo_pre_cos_fab_co_avg_con_dtls where job_no=" . $txt_job_no . "  order by id ");

	foreach ($process_loss_data as $row) {
		$process_loss_arr[$row[csf("pre_cost_fabric_cost_dtls_id")]][$row[csf("job_no")]]['avg_process_loss'] = $row[csf("process_loss_percent")];
	}

	$lib_yarn_count_deter_id = return_library_array("select id,fabric_composition_id from lib_yarn_count_determina_mst where status_active=1", "id", "fabric_composition_id");
	$lib_fabric_composition = return_library_array("select id,fabric_composition_name from lib_fabric_composition where status_active=1", "id", "fabric_composition_name");

	$sql = "select id, job_no, body_part_id, fab_nature_id, color_type_id, fabric_description,uom, avg_cons,avg_cons_yarn, fabric_source,gsm_weight, rate, amount,avg_finish_cons,status_active,lib_yarn_count_deter_id,avg_process_loss   from wo_pre_cost_fabric_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";

	$data_array = sql_select($sql);
	$knit_fab = "";
	$woven_fab = "";
	$knit_subtotal_avg_cons = 0;
	$knit_subtotal_amount = 0;
	$woven_subtotal_avg_cons = 0;
	$woven_subtotal_amount = 0;
	$grand_total_amount = 0;
	$i = 3;
	$j = 2;
	foreach ($data_array as $row) {
		$uom = $unit_of_measurement[$row[csf("uom")]];
		$fab_composition_id = $lib_yarn_count_deter_id[$row[csf("lib_yarn_count_deter_id")]];
		$fab_composition = $lib_fabric_composition[$fab_composition_id];
		// $avg_process_loss=$process_loss_arr[$row[csf("id")]][$row[csf("job_no")]]['avg_process_loss'];
		if ($row[csf("fab_nature_id")] == 2) //knit fabrics
		{
			$item_descrition = $body_part[$row[csf("body_part_id")]] . ", " . $color_type[$row[csf("color_type_id")]] . ", " . $row[csf("fabric_description")] . ", " . $row[csf("gsm_weight")];
			if ($row[csf("fabric_source")] != 2) {
				$amount = $row[csf("avg_finish_cons")] * $row[csf("rate")];
			} else {
				$amount = $row[csf("avg_cons")] * $row[csf("rate")];
			}
			$percent_to_order_value = $amount / $price_dzn * 100;
			//echo $amount.'='.$price_dzn;
			$i++;
			$knit_fab .= '<tr>
		<td align="left">' . $item_descrition . '</td>
		<td align="left">' . $fab_composition . '</td>
		<td align="left">' . $fabric_source[$row[csf("fabric_source")]] . '</td>
		<td align="right">' . fn_number_format($row[csf("avg_cons")], 4) . '</td>				
		 <td align="right">' . fn_number_format($row[csf("avg_finish_cons")], 4) . '</td>
		 <td align="right">' . fn_number_format($row[csf("avg_process_loss")], 4) . '</td>
		  <td align="left">' . $uom . '</td>
		<td align="right">' . fn_number_format($row[csf("rate")], 4) . '</td>
		<td align="right">' . fn_number_format($amount, 4) . '</td>
		<td align="right">' . fn_number_format($percent_to_order_value, 2) . '%</td>
	</tr>';
			if ($row[csf("uom")] == 12) {
				$knit_subtotal_avg_cons += $row[csf("avg_cons")];
				$knit_subtotal_avg_cons_yarn += $row[csf("avg_finish_cons")];
				if ($row[csf("fabric_source")] != 2) {
					$knit_subtotal_amount += $row[csf("avg_finish_cons")] * $row[csf("rate")];
				} else {
					$knit_subtotal_amount += $row[csf("avg_cons")] * $row[csf("rate")];
				}
			}
			if ($row[csf("uom")] == 27) {
				$knit_subtotal_avg_cons_yds += $row[csf("avg_cons")];
				$knit_subtotal_avg_cons_yarn_yds += $row[csf("avg_finish_cons")];
				if ($row[csf("fabric_source")] != 2) {
					$knit_subtotal_amount_yds += $row[csf("avg_finish_cons")] * $row[csf("rate")];
				} else {
					$knit_subtotal_amount_yds += $row[csf("avg_cons")] * $row[csf("rate")];
				}
			}
		}

		if ($row[csf("fab_nature_id")] == 3) //woven fabrics
		{
			$item_descrition = $body_part[$row[csf("body_part_id")]] . ", " . $color_type[$row[csf("color_type_id")]] . ", " . $row[csf("fabric_description")] . ", " . $row[csf("gsm_weight")];
			$amount = $row[csf("avg_finish_cons")] * $row[csf("rate")];
			$percent_to_order_value = $amount / $price_dzn * 100;
			$j++;
			$woven_fab .= '<tr>
		<td align="left">' . $item_descrition . '</td>
		<td align="left">' . $fab_composition . '</td>
		<td align="left">' . $fabric_source[$row[csf("fabric_source")]] . '</td>
		<td align="right">' . fn_number_format($row[csf("avg_cons")], 4) . '</td>					
		<td align="right">' . fn_number_format($row[csf("avg_finish_cons")], 4) . '</td>
		<td align="right">' . fn_number_format($row[csf("avg_process_loss")], 4) . '</td>
		 <td align="left">' . $uom . '</td>
		<td align="right">' . fn_number_format($row[csf("rate")], 4) . '</td>
		<td align="right">' . fn_number_format($amount, 4) . '</td>
		<td align="right">' . fn_number_format($percent_to_order_value, 2) . '%</td>
	</tr>';

			$woven_subtotal_avg_cons += $row[csf("avg_cons")];
			$woven_subtotal_avg_cons_yarn += $row[csf("avg_finish_cons")];
			$woven_subtotal_amount += $row[csf("avg_finish_cons")] * $row[csf("rate")];
		}
	}

	$knit_fab = '<div style="margin-top:15px">
	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
		<label><b>All Fabric Cost  </b></label>
			<tr style="font-weight:bold"  align="center">
				<td width="80" rowspan="' . $i . '" ><div class="verticalText"><b>Knit Fabric</b></div></td>
				<td width="350">Description</td>
				<td width="350">Fabric Composition</td>
				<td width="100">Source</td>
				<td width="100">Fab. Cons/' . $costing_for . '</td>
				<td width="100">Avg. Fab. Cons/' . $costing_for . '</td>
				<td width="100">Avg. Process Loss</td>
				<td width="100">UOM</td>
				<td width="100">Rate [USD]</td>
				<td width="100">Amount [USD]</td>
				<td width="100">% to Ord. Value</td>
			</tr>' . $knit_fab;
	$woven_fab = '<tr><td colspan="10">&nbsp;</td></tr><tr>
			<td width="80" rowspan="' . $j . '"><div class="verticalText"><b>Woven Fabric</b></div></td></tr>' . $woven_fab;

	//knit fabrics table here
	$fab_knit_req_kg_avg_amount = $knit_subtotal_amount / $knit_subtotal_avg_cons * $fab_knit_req_kg_avg;
	$knit_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
			<td colspan="3" align="left">Sub Total [Kg]</td>
			<td align="right">' . fn_number_format($knit_subtotal_avg_cons, 4) . '</td>
			<td align="right">' . fn_number_format($knit_subtotal_avg_cons_yarn, 4) . '</td>
			<td></td>
			<td></td>
			<td></td>
			<td align="right">' . fn_number_format($knit_subtotal_amount, 4) . '</td>
			<td align="right">' . fn_number_format($knit_subtotal_amount / $price_dzn * 100, 2) . '%</td>
		</tr>';
	$knit_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
			<td colspan="3" align="left">Sub Total[Yds]</td>
			<td align="right">' . fn_number_format($knit_subtotal_avg_cons_yds, 4) . '</td>
			<td align="right">' . fn_number_format($knit_subtotal_avg_cons_yarn_yds, 4) . '</td>
			<td></td>
			<td></td>
			<td></td>
			<td align="right">' . fn_number_format($knit_subtotal_amount_yds, 4) . '</td>
			<td align="right">' . fn_number_format($knit_subtotal_amount_yds / $price_dzn * 100, 2) . '%</td>
		</tr>';
	/*$knit_fab .='<tr class="rpt_bottom" style="font-weight:bold">
			<td colspan="2" align="left">Sub Total (Avg)</td>
			<td align="right">'.fn_number_format($fab_knit_req_kg_avg,4).'</td>
			<td align="right">'.fn_number_format($fab_knit_req_kg_avg,4).'</td>
			<td></td>
			<td align="right">'.fn_number_format($fab_knit_req_kg_avg_amount,4).'</td>
		</tr>';*/
	if ($zero_value == 1) {
		echo $knit_fab;
	} else {
		if ($row[csf("avg_cons")] > 0) {
			echo $knit_fab;
		} else {
			echo "";
		}
	}

	//woven fabrics table here
	$fab_woven_req_yds_avg_amount = $woven_subtotal_amount / $woven_subtotal_avg_cons * $fab_woven_req_yds_avg;
	$woven_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
				<td colspan="3" align="left">Sub Total</td>
				<td align="right">' . fn_number_format($woven_subtotal_avg_cons, 4) . '</td>
				<td align="right">' . fn_number_format($woven_subtotal_avg_cons_yarn, 4) . '</td>
				<td></td>
				<td></td>
				<td></td>
				<td align="right">' . fn_number_format($woven_subtotal_amount, 4) . '</td>
				<td align="right">' . fn_number_format($woven_subtotal_amount / $price_dzn * 100, 2) . '%</td>
			</tr>';
	/*$woven_fab .='<tr class="rpt_bottom" style="font-weight:bold">
				<td colspan="2" align="left">Sub Total (Avg)</td>
				<td align="right">'.fn_number_format($fab_woven_req_yds_avg,4).'</td>
				<td align="right">'.fn_number_format($fab_woven_req_yds_avg,4).'</td>
				<td></td>
				<td align="right">'.fn_number_format($fab_woven_req_yds_avg_amount,4).'</td>
			</tr>';*/
	$woven_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
				<td colspan="5" align="left">Total</td>
				<td align="right"></td>
				<td></td>
				<td></td>
				<td></td>
				<td align="right">' . fn_number_format(($woven_subtotal_amount + $knit_subtotal_amount + $knit_subtotal_amount_yds), 4) . '</td>
				<td align="right">' . fn_number_format((($woven_subtotal_amount + $knit_subtotal_amount + $knit_subtotal_amount_yds) / $price_dzn * 100), 2) . '%</td>
			</tr></table></div>';
	/*$woven_fab .='<tr class="rpt_bottom" style="font-weight:bold">
				<td colspan="4" align="left">Total (Avg)</td>
				<td align="right"></td>
				<td></td>
				<td align="right">'.fn_number_format(($fab_woven_req_yds_avg_amount+$fab_knit_req_kg_avg_amount),4).'</td>
			</tr></table></div>';*/
	// echo $woven_fab;
	if ($zero_value == 1) {
		echo $woven_fab;
	} else {
		if ($row[csf("avg_cons")] > 0) {
			echo $woven_fab;
		} else {
			echo "";
		}
	}
	$grand_total_amount = $knit_subtotal_amount + $woven_subtotal_amount + $knit_subtotal_amount_yds;
	//end 	All Fabric Cost part report-------------------------------------------

	//Start	Yarn Cost part report here -------------------------------------------
	$lib_yarn_count = return_library_array("select yarn_count,id from lib_yarn_count", "id", "yarn_count");
	//mysql
	/*$sql = "select id, count_id, copm_one_id, percent_one, copm_two_id, percent_two, type_id, cons_ratio, sum(cons_qnty) as cons_qnty, rate, sum(amount) as amount
		from wo_pre_cost_fab_yarn_cost_dtls
		where job_no=".$txt_job_no." group by count_id, copm_one_id, percent_one, copm_two_id, percent_two, type_id, rate";*/
	//oracle
	$sql = "select min(id) as id, count_id, copm_one_id, percent_one, copm_two_id, percent_two,color,type_id, min(cons_ratio) as cons_ratio , sum(cons_qnty) as cons_qnty,sum(avg_cons_qnty) as avg_cons_qnty, rate, sum(amount) as amount	from wo_pre_cost_fab_yarn_cost_dtls	where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0 group by count_id, copm_one_id, percent_one, copm_two_id, percent_two,color, type_id, rate";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
	?>
		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<tr style="font-weight:bold">
					<td width="70" rowspan="<?= count($data_array) + 2; ?>">
						<div class="verticalText"><b>Yarn Cost</b></div>
					</td>
					<td width="350">Yarn Desc</td>
					<td width="100">Yarn Qty</td>
					<td width="100">Avg.Yarn Qty</td>
					<td width="100">Rate [USD]</td>
					<td width="100">Amount [USD]</td>
					<td width="100">% to Ord. Value</td>
				</tr>
				<?
				$total_qnty = 0;
				$total_avg_qnty = 0;
				$total_amount = 0;
				foreach ($data_array as $row) {
					if ($row[csf("percent_one")] == 100)
						$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];
					else
						$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $composition[$row[csf("copm_two_id")]] . " " . $row[csf("percent_two")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];

				?>
					<tr>
						<td align="left"><? echo $item_descrition; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("cons_qnty")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("avg_cons_qnty")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")] / $price_dzn * 100, 2); ?>%</td>
					</tr>
				<?
					$total_qnty += $row[csf("cons_qnty")];
					$total_avg_qnty += $row[csf("avg_cons_qnty")];
					$total_amount += $row[csf("amount")];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td>Total</td>
					<td align="right"><? echo fn_number_format($total_qnty, 4); ?></td>
					<td align="right"><? echo fn_number_format($total_avg_qnty, 4); ?></td>
					<td></td>
					<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
					<td align="right"><? echo fn_number_format($total_amount / $price_dzn * 100, 2); ?>%</td>
				</tr>
			</table>
		</div>
		<?
		$grand_total_amount += $total_amount;
	} else {
		if ($fabric_cost > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<tr style="font-weight:bold">
						<td width="70" rowspan="<? echo count($data_array) + 2; ?>">
							<div class="verticalText"><b>Yarn Cost</b></div>
						</td>
						<td width="350">Yarn Desc</td>
						<td width="100">Yarn Qnty</td>
						<td width="100">Avg.Yarn Qnty</td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)</td>
						<td width="100">% to Ord. Value</td>
					</tr>
					<?
					$total_qnty = 0;
					$total_amount = 0;
					foreach ($data_array as $row) {
						if ($row[csf("percent_one")] == 100)
							$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];
						else
							$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $composition[$row[csf("copm_two_id")]] . " " . $row[csf("percent_two")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];

					?>
						<tr>
							<td align="left"><? echo $item_descrition; ?></td>
							<td align="right"><? echo fn_number_format($row[csf("cons_qnty")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("avg_cons_qnty")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")] / $price_dzn * 100, 2); ?>%</td>
						</tr>
					<?
						$total_qnty += $row[csf("cons_qnty")];
						$total_avg_qnty += $row[csf("avg_cons_qnty")];
						$total_amount += $row[csf("amount")];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td>Total</td>
						<td align="right"><? echo fn_number_format($total_qnty, 4); ?></td>
						<td align="right"><? echo fn_number_format($total_avg_qnty, 4); ?></td>
						<td></td>
						<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
						<td align="right"><? echo fn_number_format($total_amount / $price_dzn * 100, 2); ?>%</td>
					</tr>
				</table>
			</div>
		<?
			$grand_total_amount += $total_amount;
		} else {
			echo "";
		}
	}
	//End Yarn Cost part report here -------------------------------------------

	//start	Conversion Cost to Fabric report here -------------------------------------------
	$sql = "select a.id,a.fabric_description as fabric_description_id, a.job_no, a.cons_process, a.req_qnty,a.avg_req_qnty, a.charge_unit, a.amount, a.status_active,b.body_part_id,b.fab_nature_id,b.color_type_id,b.fabric_description
	from wo_pre_cost_fab_conv_cost_dtls a left join wo_pre_cost_fabric_cost_dtls b on a.job_no=b.job_no and a.fabric_description=b.id and b.status_active=1 and b.is_deleted=0
	where a.job_no=" . $txt_job_no . " and a.status_active=1 and a.is_deleted=0";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
		?>
		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<tr style="font-weight:bold">
					<td width="80" rowspan="<? echo count($data_array) + 3; ?>">
						<div class="verticalText"><b>Conversion Cost to Fabric</b></div>
					</td>
					<td width="350">Particulars</td>
					<td width="100">Process</td>
					<td width="100">Cons/<? echo $costing_for; ?></td>
					<td width="100">Avg. Cons/<? echo $costing_for; ?></td>
					<td width="100">Rate (USD)</td>
					<td width="100">Amount (USD)</td>
					<td width="100">% to Ord. Value</td>
				</tr>
				<?
				$total_amount = 0;
				foreach ($data_array as $row) {
					if ($row[csf("fabric_description_id")] != 0) {
						$item_descrition = $body_part[$row[csf("body_part_id")]] . ", " . $color_type[$row[csf("color_type_id")]] . ", " . $row[csf("fabric_description")];
					} else {
						$item_descrition = "All Fabrics";
					}
				?>
					<tr>
						<td align="left"><? echo $item_descrition; ?></td>
						<td align="left"><? echo $conversion_cost_head_array[$row[csf("cons_process")]]; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("req_qnty")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("avg_req_qnty")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("charge_unit")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")] / $price_dzn * 100, 2); ?>%</td>
					</tr>
				<?
					$total_amount += $row[csf("amount")];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="5">Total</td>
					<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
					<td align="right"><? echo  fn_number_format($total_amount / $price_dzn * 100, 2); ?>%</td>
				</tr>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td align="left" colspan="5">Total Fabric Cost</td>
					<td align="right"><? echo fn_number_format(($grand_total_amount + $total_amount), 4); ?></td>
					<td align="right"><? echo fn_number_format((($grand_total_amount + $total_amount) / $price_dzn * 100), 2); ?>%</td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($fabric_cost > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<tr style="font-weight:bold">
						<td width="80" rowspan="<? echo count($data_array) + 3; ?>">
							<div class="verticalText"><b>Conversion Cost to Fabric</b></div>
						</td>
						<td width="350">Particulars</td>
						<td width="100">Process</td>
						<td width="100">Cons/<? echo $costing_for; ?></td>
						<td width="100">Avg. Cons/<? echo $costing_for; ?></td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)</td>
						<td width="100">% to Ord. Value</td>
					</tr>
					<?
					$total_amount = 0;
					foreach ($data_array as $row) {
						if ($row[csf("fabric_description_id")] != 0) {
							$item_descrition = $body_part[$row[csf("body_part_id")]] . ", " . $color_type[$row[csf("color_type_id")]] . ", " . $row[csf("fabric_description")];
						} else {
							$item_descrition = "All Fabrics";
						}
					?>
						<tr>
							<td align="left"><? echo $item_descrition; ?></td>
							<td align="left"><? echo $conversion_cost_head_array[$row[csf("cons_process")]]; ?></td>
							<td align="right"><? echo fn_number_format($row[csf("req_qnty")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("avg_req_qnty")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("charge_unit")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")] / $price_dzn * 100, 2); ?>%</td>
						</tr>
					<?
						$total_amount += $row[csf("amount")];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="5">Total</td>
						<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
						<td align="right"><? echo fn_number_format($total_amount / $price_dzn * 100, 2); ?>%</td>
					</tr>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td align="left" colspan="5">Total Fabric Cost</td>
						<td align="right"><? echo fn_number_format(($grand_total_amount + $total_amount), 4); ?></td>
						<td align="right"><? echo fn_number_format((($grand_total_amount + $total_amount) / $price_dzn * 100), 2); ?>%</td>
					</tr>
				</table>
			</div>
		<?
		} else {
			echo "";
		}
	}
	//End Conversion Cost to Fabric report here -------------------------------------------
	//start	Trims Cost part report here -------------------------------------------
	$sql = "select id, job_no, trim_group,description,brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp,status_active,seq
	from wo_pre_cost_trim_cost_dtls
	where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0 order by seq";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
		?>
		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<label><b>Trims Cost</b></label>
				<tr style="font-weight:bold">
					<td width="150">Item Group</td>
					<td width="150">Description</td>
					<td width="150">Brand/Supp Ref</td>
					<td width="100">UOM</td>
					<td width="100">Cons/<? echo $costing_for; ?></td>
					<td width="100">Rate (USD)</td>
					<td width="100">Amount (USD)</td>
					<td width="100">% to Ord. Value</td>
				</tr>
				<?
				$total_amount = 0;
				foreach ($data_array as $row) {
					$trim_group = return_library_array("select item_name,id from  lib_item_group where id=" . $row[csf("trim_group")], "id", "item_name");

				?>
					<tr>
						<td align="left"><? echo $trim_group[$row[csf("trim_group")]]; ?></td>
						<td align="left"><? echo $row[csf("description")]; ?></td>
						<td align="left"><? echo $row[csf("brand_sup_ref")]; ?></td>
						<td align="left"><? echo $unit_of_measurement[$row[csf("cons_uom")]]; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("cons_dzn_gmts")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")] / $price_dzn * 100, 2); ?>%</td>
					</tr>
				<?
					$total_amount += $row[csf("amount")];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="6">Total</td>
					<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
					<td align="right"><? echo fn_number_format($total_amount / $price_dzn * 100, 2); ?>%</td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($trims_cost > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<label><b>Trims Cost</b></label>
					<tr style="font-weight:bold">
						<td width="150">Item Group</td>
						<td width="150">Description</td>
						<td width="150">Brand/Supp Ref</td>
						<td width="100">UOM</td>
						<td width="100">Cons/<? echo $costing_for; ?></td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)</td>
						<td width="100">% to Ord. Value</td>
					</tr>
					<?
					$total_amount = 0;
					foreach ($data_array as $row) {
						$trim_group = return_library_array("select item_name,id from  lib_item_group where id=" . $row[csf("trim_group")], "id", "item_name");

					?>
						<tr>
							<td align="left"><? echo $trim_group[$row[csf("trim_group")]]; ?></td>
							<td align="left"><? echo $row[csf("description")]; ?></td>
							<td align="left"><? echo $row[csf("brand_sup_ref")]; ?></td>
							<td align="left"><? echo $unit_of_measurement[$row[csf("cons_uom")]]; ?></td>
							<td align="right"><? echo fn_number_format($row[csf("cons_dzn_gmts")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")] / $price_dzn * 100, 2); ?>%</td>
						</tr>
					<?
						$total_amount += $row[csf("amount")];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="6">Total</td>
						<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
						<td align="right"><? echo fn_number_format($total_amount / $price_dzn * 100, 2); ?>%</td>
					</tr>
				</table>
			</div>
		<?
		} else {
			echo "";
		}
	}
	//End Trims Cost Part report here -------------------------------------------
	//start	Embellishment Details part report here -------------------------------------------
	$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active
	from wo_pre_cost_embe_cost_dtls
	where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
		?>
		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<label><b>Embellishment Details</b></label>
				<tr style="font-weight:bold">
					<td width="150">Particulars</td>
					<td width="150">Type</td>
					<td width="150">Cons/<? echo $costing_for; ?></td>
					<td width="100">Rate (USD)</td>
					<td width="100">Amount (USD)</td>
					<td width="100">% to Ord. Value</td>
				</tr>
				<?
				$total_amount = 0;
				foreach ($data_array as $row) {
					$em_type = "";
					//$emblishment_name_array=array(1=>"Printing",2=>"Embroidery",3=>"Wash",4=>"Special Works",5=>"Others");
					if ($row[csf("emb_name")] == 1) $em_type = $emblishment_print_type[$row[csf("emb_type")]];
					else if ($row[csf("emb_name")] == 2) $em_type = $emblishment_embroy_type[$row[csf("emb_type")]];
					else if ($row[csf("emb_name")] == 3) $em_type = $emblishment_wash_type[$row[csf("emb_type")]];
					else if ($row[csf("emb_name")] == 4) $em_type = $emblishment_spwork_type[$row[csf("emb_type")]];
					else if ($row[csf("emb_name")] == 5) $em_type = $emblishment_gmts_type[$row[csf("emb_type")]];
				?>
					<tr>
						<td align="left"><? echo $emblishment_name_array[$row[csf("emb_name")]]; ?></td>
						<td align="left"><? echo $em_type; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("cons_dzn_gmts")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")] / $price_dzn * 100, 2); ?>%</td>
					</tr>
				<?
					$total_amount += $row[csf("amount")];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="4">Total</td>
					<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
					<td align="right"><? echo fn_number_format($total_amount / $price_dzn * 100, 2); ?>%</td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($embel_cost > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<label><b>Embellishment Details</b></label>
					<tr style="font-weight:bold">
						<td width="150">Particulars</td>
						<td width="150">Type</td>
						<td width="150">Cons/<? echo $costing_for; ?></td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)</td>
						<td width="100">% to Ord. Value</td>
					</tr>
					<?
					$total_amount = 0;
					foreach ($data_array as $row) {
						$em_type = "";
						//$emblishment_name_array=array(1=>"Printing",2=>"Embroidery",3=>"Wash",4=>"Special Works",5=>"Others");
						if ($row[csf("emb_name")] == 1) $em_type = $emblishment_print_type[$row[csf("emb_type")]];
						else if ($row[csf("emb_name")] == 2) $em_type = $emblishment_embroy_type[$row[csf("emb_type")]];
						else if ($row[csf("emb_name")] == 3) $em_type = $emblishment_wash_type[$row[csf("emb_type")]];
						else if ($row[csf("emb_name")] == 4) $em_type = $emblishment_spwork_type[$row[csf("emb_type")]];
						else if ($row[csf("emb_name")] == 5) $em_type = $emblishment_gmts_type[$row[csf("emb_type")]];
					?>
						<tr>
							<td align="left"><? echo $emblishment_name_array[$row[csf("emb_name")]]; ?></td>
							<td align="left"><? echo $em_type; ?></td>
							<td align="right"><? echo fn_number_format($row[csf("cons_dzn_gmts")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")] / $price_dzn * 100, 2); ?>%</td>
						</tr>
					<?
						$total_amount += $row[csf("amount")];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="4">Total</td>
						<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
						<td align="right"><? echo fn_number_format($total_amount / $price_dzn * 100, 2); ?>%</td>
					</tr>
				</table>
			</div>
		<?
		} else {
			echo "";
		}
	}
	//End Embellishment Details Part report here -------------------------------------------


	//start	Commercial Cost part report here -------------------------------------------
	$sql = "select id, job_no, item_id, rate, amount, status_active
	from  wo_pre_cost_comarci_cost_dtls
	where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
		?>

		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<label><b>Commercial Cost</b></label>
				<tr style="font-weight:bold">
					<td width="150">Particulars</td>
					<td width="100">Rate In %</td>
					<td width="100">Amount (USD)</td>
				</tr>
				<?
				$total_amount = 0;
				foreach ($data_array as $row) {
				?>
					<tr>
						<td align="left"><? echo $camarcial_items[$row[csf("item_id")]]; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
					</tr>
				<?
					$total_amount += $row[csf("amount")];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="2">Total</td>
					<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($comm_cost > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<label><b>Commercial Cost</b></label>
					<tr style="font-weight:bold">
						<td width="150">Particulars</td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)</td>
					</tr>
					<?
					$total_amount = 0;
					foreach ($data_array as $row) {
					?>
						<tr>
							<td align="left"><? echo $camarcial_items[$row[csf("item_id")]]; ?></td>
							<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
						</tr>
					<?
						$total_amount += $row[csf("amount")];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="2">Total</td>
						<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
					</tr>
				</table>
			</div>
		<?
		} else {
			echo "";
		}
	}
	//End Commercial Cost Part report here -------------------------------------------


	//start	Commission Cost part report here -------------------------------------------
	$sql = "select id,job_no,particulars_id,commission_base_id,commision_rate,commission_amount, status_active
	from  wo_pre_cost_commiss_cost_dtls
	where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
		?>


		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<label><b>Commission Cost</b></label>
				<tr style="font-weight:bold">
					<td width="150">Particulars</td>
					<td width="150">Commission Basis</td>
					<td width="100">Rate (USD)</td>
					<td width="100">Amount (USD)</td>
				</tr>
				<?
				$total_amount = 0;
				foreach ($data_array as $row) {
				?>
					<tr>
						<td align="left"><? echo $commission_particulars[$row[csf("particulars_id")]]; ?></td>
						<td align="left"><? echo $commission_base_array[$row[csf("commission_base_id")]]; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("commision_rate")], 4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("commission_amount")], 4); ?></td>
					</tr>
				<?
					$total_amount += $row[csf("commission_amount")];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="3">Total</td>
					<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($commission > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<label><b>Commission Cost</b></label>
					<tr style="font-weight:bold">
						<td width="150">Particulars</td>
						<td width="150">Commission Basis</td>
						<td width="100">Rate (USD)</td>
						<td width="100">Amount (USD)</td>
					</tr>
					<?
					$total_amount = 0;
					foreach ($data_array as $row) {
					?>
						<tr>
							<td align="left"><? echo $commission_particulars[$row[csf("particulars_id")]]; ?></td>
							<td align="left"><? echo $commission_base_array[$row[csf("commission_base_id")]]; ?></td>
							<td align="right"><? echo fn_number_format($row[csf("commision_rate")], 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("commission_amount")], 4); ?></td>
						</tr>
					<?
						$total_amount += $row[csf("commission_amount")];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="3">Total</td>
						<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
					</tr>
				</table>
			</div>
		<?
		} else {
			echo "";
		}
	}
	//End Commission Cost Part report here -------------------------------------------


	//start	Other Components part report here -------------------------------------------

	$sql = "select fabric_cost,fabric_cost_percent,trims_cost,trims_cost_percent,embel_cost,embel_cost_percent,wash_cost,wash_cost_percent,comm_cost,comm_cost_percent,commission,commission_percent, lab_test,lab_test_percent,inspection,inspection_percent,cm_cost,cm_cost_percent,freight,freight_percent,currier_pre_cost,currier_percent,certificate_pre_cost,certificate_percent,common_oh,common_oh_percent,total_cost ,total_cost_percent,price_dzn,price_dzn_percent,margin_dzn,margin_dzn_percent,price_pcs_or_set,price_pcs_or_set_percent,margin_pcs_set, margin_pcs_set_percent,cm_for_sipment_sche,design_cost,design_percent, studio_cost, studio_percent, common_oh, common_oh_percent, depr_amor_pre_cost, depr_amor_po_price,interest_cost, interest_percent, incometax_cost, incometax_percent,incentives_pre_cost from wo_pre_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
		?>

		<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<label><b>Others Components</b></label>
				<tr style="font-weight:bold">
					<td width="150">Particulars</td>
					<td width="100">Amount (USD)</td>
				</tr>
				<?
				$total_amount = 0;
				foreach ($data_array as $row) {
				?>

					<tr>
						<td align="left" s>Lab Test </td>
						<td align="right"><? echo fn_number_format($row[csf("lab_test")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Inspection Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("inspection")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">CM Cost - IE</td>
						<td align="right"><? echo fn_number_format($row[csf("cm_cost")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Freight Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("freight")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Office OH</td>
						<td align="right"><? echo fn_number_format($row[csf("common_oh")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Currier Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("currier_pre_cost")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Certificate Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("certificate_pre_cost")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Design Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("design_cost")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Studio Cost</td>
						<td align="right"><? echo fn_number_format($row[csf("studio_cost")], 4); ?></td>
					</tr>

					<tr>
						<td align="left">Deprec. & Amort.</td>
						<td align="right"><? echo fn_number_format($row[csf("depr_amor_pre_cost")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Interest</td>
						<td align="right"><? echo fn_number_format($row[csf("interest_cost")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Income Tax </td>
						<td align="right"><? echo fn_number_format($row[csf("incometax_cost")], 4); ?></td>
					</tr>
					<tr>
						<td align="left">Incentives Missing Cost </td>
						<td align="right"><? echo fn_number_format($row[csf("incentives_pre_cost")], 4); ?></td>
					</tr>
				<?
					$total_amount += $row[csf("lab_test")] + $row[csf("inspection")] + $row[csf("cm_cost")] + $row[csf("freight")] + $row[csf("common_oh")] + $row[csf("currier_pre_cost")] + $row[csf("certificate_pre_cost")] + $row[csf("design_cost")] + $row[csf("studio_cost")] + $row[csf("depr_amor_pre_cost")] + $row[csf("interest_cost")] + $row[csf("incometax_cost")] + $row[csf("incentives_pre_cost")];
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td>Total</td>
					<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
				</tr>
			</table>
		</div>
		<?
	} else {
		if ($lab_test > 0 || $inspection > 0 || $cm_cost > 0 || $freight > 0 || $common_oh > 0) {
		?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<label><b>Others Components</b></label>
					<tr style="font-weight:bold">
						<td width="150">Particulars</td>
						<td width="100">Amount (USD)</td>
					</tr>
					<?
					$total_amount = 0;
					foreach ($data_array as $row) {
						if ($row[csf("lab_test")] > 0) {
					?>


							<tr>
								<td align="left" s>Lab Test </td>
								<td align="right"><? echo fn_number_format($row[csf("lab_test")], 4); ?></td>
							</tr>
						<?
						}
						if ($row[csf("inspection")] > 0) {
						?>
							<tr>
								<td align="left">Inspection Cost</td>
								<td align="right"><? echo fn_number_format($row[csf("inspection")], 4); ?></td>
							</tr>
						<?
						}
						if ($row[csf("cm_cost")] > 0) {
						?>
							<tr>
								<td align="left">CM Cost - IE</td>
								<td align="right"><? echo fn_number_format($row[csf("cm_cost")], 4); ?></td>
							</tr>
						<?
						}
						if ($row[csf("freight")] > 0) {
						?>
							<tr>
								<td align="left">Freight Cost</td>
								<td align="right"><? echo fn_number_format($row[csf("freight")], 4); ?></td>
							</tr>
						<?
						}
						if ($row[csf("common_oh")] > 0) {
						?>
							<tr>
								<td align="left">Office OH</td>
								<td align="right"><? echo fn_number_format($row[csf("common_oh")], 4); ?></td>
							</tr>
					<?
						}
						$total_amount += $row[csf("lab_test")] + $row[csf("inspection")] + $row[csf("cm_cost")] + $row[csf("freight")] + $row[csf("common_oh")];
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td>Total</td>
						<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
					</tr>
				</table>
			</div>
	<?
		} else {
			echo "";
		}
	}


	$first_day_this_month = date('01-m-Y', strtotime($txt_costingdate));
	$last_date  = date("t-m-Y", strtotime($txt_costingdate));
	if ($db_type == 0) {
		$start_date = change_date_format(str_replace("'", "", $first_day_this_month), "yyyy-mm-dd", "");
		$end_date = change_date_format(str_replace("'", "", $last_date), "yyyy-mm-dd", "");
	} else if ($db_type == 2) {
		$start_date = change_date_format(str_replace("'", "", $first_day_this_month), "", "", 1);
		$end_date = change_date_format(str_replace("'", "", $last_date), "", "", 1);
	}
	$date_quote_cond = " and applying_period_to_date between '$start_date' and '$end_date'";

	$cpm_cpm_sql = "select id,company_id,cost_per_minute from lib_standard_cm_entry where status_active=1 and is_deleted=0 and company_id=$cbo_company_name $date_quote_cond order by id desc";

	$cpm_cpm = sql_select($cpm_cpm_sql);
	foreach ($cpm_cpm as $row) {
		$tot_cost_per_minute = $row[csf('cost_per_minute')];
	} //var_dump($asking_profit_arr);
	//End Other Components  Part report here -------------------------------------------
	?>
	<div style="clear:both"></div>
	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:300px;text-align:center;float:left;width:30%" rules="all">

		<tr style="font-weight:bold">
			<td colspan="3">CM Details</td>
		</tr>
		<tr style="font-weight:bold">
			<td width="150">CPM</td>
			<td width="50">SMV </td>
			<td width="100"> Eff%</td>
		</tr>
		<tr>
			<td><? echo number_format($tot_cost_per_minute, 4);; ?></td>
			<td><? echo number_format($sew_smv, 2);; ?></td>
			<td><? echo $sew_effi_percent; ?></td>
		</tr>
	</table>
	<table style="float:left;width:65%">
		<tr>

			<td>
				<?
				// image show here  -------------------------------------------
				$sql = "select id,master_tble_id,image_location	from common_photo_library where master_tble_id=" . $txt_job_no . "";
				//  echo $sql;die();
				$data_array = sql_select($sql);

				?>

				<div>
					<? foreach ($data_array as $inf) { ?>
						<img src='<?= $img_path ?><? echo $inf[csf("image_location")]; ?>' height='97' width='89' />
					<?  } ?>
				</div>
			</td>
		</tr>

	</table>

</div>

<?
	// Issue-id=5729
	//echo "<br /><b>Note:".$smg." ".$smg2.".</b>"; 

	if ($ws_id != '') {
		$wsids = explode(',', $ws_id);
		$ids = "'" . implode("', '", $wsids) . "'";

		$sql = "SELECT a.id, a.system_no, a.extention_no, a.style_ref, a.operation_count, a.gmts_item_id, b.operator_smv, b.helper_smv, b.body_part_id, b.lib_sewing_id, c.department_code from ppl_gsd_entry_mst a, ppl_gsd_entry_dtls b, lib_sewing_operation_entry c where a.id=b.mst_id and b.lib_sewing_id=c.id and a.approved=1 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and a.id in ($ids) and c.department_code =8 order by a.id DESC";
		//echo $sql; die;
		$sql_result = sql_select($sql);
		$k = array();
		foreach ($sql_result as $row) {
			$smv += $row[csf('operator_smv')] + $row[csf('helper_smv')];
			$k[$row[csf('id')]] = $row[csf('id')];
		}
		$efficiency_data = sql_select("SELECT efficiency from ppl_balancing_mst_entry where gsd_mst_id in ($ids) and efficiency>0 and status_active=1 and is_deleted=0");
		$j = 0;
		foreach ($efficiency_data as $row) {
			$eff += $row[csf('efficiency')];
			$j++;
		}
?>
	<div style="margin-top:5px; margin-bottom: 5px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:400px;text-align:center;" rules="all">
			<tr>
				<td colspan="3" style="font-size: 20px; font-weight: bold;">CM Cost Details</td>
			</tr>
			<tr>
				<th>Particular</th>
				<th>IE</th>
				<th>Budget</th>
			</tr>
			<tr>
				<td>SMV</td>
				<td><? echo number_format($smv / count($k), 2); ?></td>
				<td><? echo fn_number_format($sew_smv, 2); ?></td>
			</tr>
			<tr>
				<td>Efficiency %</td>
				<td><? echo number_format($eff / $j, 2); ?> %</td>
				<td><? echo number_format($sew_effi_percent, 2); ?> %</td>
			</tr>
			<tr>
				<td>CPM (BDT)</td>
				<td colspan="2"><? echo $tot_cost_per_minute ?></td>
			</tr>
			<tr>
				<td>CPM (USD)</td>
				<td colspan="2"><? echo fn_number_format($tot_cost_per_minute / $exchange_rate, 7) ?></td>
			</tr>
			<tr>
				<td>Exchange Rate</td>
				<td colspan="2"><? echo $exchange_rate; ?></td>
			</tr>
			<tr>
				<td>CM Cost (USD)</td>
				<td><? echo $cm_cost ?></td>
				<td>Per <? echo $unit_of_measurement[$order_uom] ?></td>
			</tr>
		</table>
	</div>
<? } else { ?>
	<div style="margin-top:5px; margin-bottom: 5px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:400px;text-align:center;" rules="all">
			<tr>
				<td colspan="3" style="font-size: 20px; font-weight: bold;">CM Cost Details</td>
			</tr>
			<tr>
				<th>Particular</th>
				<th width="100">IE</th>
				<th>Budget </th>
			</tr>
			<tr>
				<td>SMV</td>
				<td width="100"></td>
				<td><?= number_format($sew_smv, 2);; ?></td>
			</tr>
			<tr>
				<td>Efficiency %</td>
				<td width="100"></td>
				<td><?= number_format($sew_effi_percent, 2);; ?></td>
			</tr>
			<tr>
				<td>CPM (BDT)</td>
				<td width="100"></td>
				<td colspan="2"><? echo $tot_cost_per_minute ?></td>
			</tr>
			<tr>
				<td>CPM (USD)</td>
				<td width="100"></td>
				<td colspan="2"><? echo number_format($tot_cost_per_minute / $exchange_rate, 4) ?></td>
			</tr>
			<tr>
				<td>Exchange Rate</td>
				<td width="100"></td>
				<td colspan="2"><? echo $exchange_rate; ?></td>
			</tr>
			<tr>
				<td>CM Cost (USD)</td>
				<td width="100"> </td>
				<td><? echo $cm_cost ?></td>
			</tr>
		</table>
	</div>
<? }




?>


<div style="clear:both"></div>
</div>
<!--End CM on Net Order Value Part report here -->
<? echo '<b>Note: &nbsp;' . $remarks; ?></b><br /><br />
<br />
<?
	echo signature_table(109, $cbo_company_name, "860px");

	$mailBody = ob_get_contents();
	ob_clean();


	//Mail send------------------------------------------
	list($msil_address, $is_mail_send) = explode('**', $mail_data);
	if ($is_mail_send == 1) {


		$data_array = sql_select("select b.id, b.job_no, b.fabric_cost, b.fabric_cost_percent, b.trims_cost, b.trims_cost_percent, b.embel_cost, b.embel_cost_percent, b.wash_cost, b.wash_cost_percent, b.comm_cost, b.comm_cost_percent, b.commission, b.commission_percent, b.lab_test, b.lab_test_percent, b.inspection, b.inspection_percent, b.cm_cost,  b.freight,  b.currier_pre_cost, b.certificate_pre_cost, b.certificate_percent, b.common_oh, b.depr_amor_pre_cost, b.depr_amor_po_price, b.total_cost, b.total_cost_percent, b.price_dzn, b.price_dzn_percent, b.margin_dzn, b.margin_dzn_percent, b.cost_pcs_set,  b.price_pcs_or_set,  b.margin_pcs_set, b.cm_for_sipment_sche, b.deffdlc_cost,  b.interest_cost,  b.incometax_cost, b.design_cost, b.design_percent, b.studio_cost, c.job_no_prefix_num, c.buyer_name, c.style_ref_no,c.job_quantity, c.quotation_id from wo_pre_cost_mst a ,wo_pre_cost_dtls b,wo_po_details_master c where a.job_no=b.job_no and  a.job_no=c.job_no and a.job_no=" . $txt_job_no . "  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0");



		$material_cost = $data_array[0][csf('fabric_cost')] + $data_array[0][csf('trims_cost')];
		$other_cost = $data_array[0]['LAB_TEST'] + $data_array[0]['INSPECTION'] + $data_array[0]['FREIGHT'] + $data_array[0]['CURRIER_PRE_COST'] + $data_array[0]['CERTIFICATE_PRE_COST'] + $data_array[0]['DESIGN_COST'] + $data_array[0]['STUDIO_COST'] + $data_array[0]['DEPR_AMOR_PRE_COST'] + $data_array[0]['INTEREST_COST'] + $data_array[0]['INCOMETAX_COST'] + $data_array[0]['COMMON_OH'];
		$quotation_id = $data_array[0][csf('quotation_id')];





		$bodymail = "
	<p>Dear Sir</p> 
	<p>Attached Please Find the cost break ups</p> 
<table>
	<tr>	
		<td><b>Job No</b></td>
		<td>:" . $data_array[0][csf('job_no')] . "</td>
	</tr>
	<tr>	
		<td><b>Buyer Name</b></td>
		<td>:" . $buyer_arr[$data_array[0][csf('buyer_name')]] . "</td>
	</tr>
	<tr>	
		<td><b>Style Ref</b></td>
		<td>:" . $data_array[0][csf('style_ref_no')] . "</td>
	</tr>
	<tr>	
		<td><b>Style Qty. (Pcs)</b></td>
		<td>:" . $data_array[0][csf('job_quantity')] . "</td>
	</tr>
	<tr>	
		<td><b>Delivery</b></td>
		<td>:" . change_date_format(max($pulish_ship_date_arr)) . "</td>
	</tr>
	<tr>	
		<td><b>Material Cost</b></td>
		<td>:" . number_format($material_cost, 4, '.', '') . "</td>
	</tr>
	<tr>	
		<td><b>Embellishment Cost</b></td>
		<td>:" . number_format($data_array[0][csf('embel_cost')], 4, '.', '') . "</td>
	</tr>
	<tr>	
		<td><b>Wash Cost</b></td>
		<td>:" . number_format($data_array[0][csf('wash_cost')], 4, '.', '') . "</td>
	</tr>
	<tr>	
		<td><b>Other Cost</b></td>
		<td>:" . number_format($other_cost, 4, '.', '') . "</td>
	</tr>
	<tr>	
		<td><b>CM Cost</b></td>
		<td>:" . number_format($data_array[0][csf('cm_cost')], 4, '.', '') . "</td>
	</tr>
	<tr>	
		<td><b>Total Cost</b></td>
		<td>:" . number_format($data_array[0][csf('total_cost')], 4, '.', '') . "</td>
	</tr>
	<tr>	
		<td><b>FOB Price /Dzn	</b></td>
		<td>:" . number_format($data_array[0][csf('price_dzn')], 4, '.', '') . "</td>
	</tr>
	<tr>	
		<td><b>Margin Value /Dzn</b></td>
		<td>:" . number_format($data_array[0][csf('margin_dzn')], 4, '.', '') . "</td>
	</tr>
	<tr>	
		<td><b>Margin Value  (%) /Dzn</b></td>
		<td>:" . number_format($data_array[0][csf('margin_dzn_percent')], 2, '.', '') . "</td>
	</tr>
</table>
<p>kindly review and advise approval please</p> 
";

		echo "mail_sent";

		require_once('../../../mailer/class.phpmailer.php');
		require_once('../../../auto_mail/setting/mail_setting.php');

		$mailBody = preg_replace("/<img[^>]+\>/i", " ", $mailBody);
		$mailToArr = array();
		if ($msil_address) {
			$mailToArr[] = $msil_address;
		}


		$sql = "SELECT a.BRAND_IDS,a.BUYER_IDS,c.email_address as MAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id  and a.mail_item=b.MAIL_ITEM_MST and a.mail_item=89 and b.mail_user_setup_id=c.id and a.company_id =" . $cbo_company_name . "  and   A.IS_DELETED=0 and A.STATUS_ACTIVE=1  and b.IS_DELETED=0 and b.STATUS_ACTIVE=1  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
		$mail_sql = sql_select($sql);
		$receverMailArr = array();
		foreach ($mail_sql as $row) {
			$mailToArr[] = $row[MAIL];
		}


		$elcetronicSql = "SELECT a.BUYER_ID,a.SEQUENCE_NO,a.BYPASS,b.USER_EMAIL  from electronic_approval_setup a join user_passwd b on a.user_id=b.id where b.valid=1  AND a.entry_form=15 and a.company_id=$cbo_company_name order by a.SEQUENCE_NO";
		//echo $elcetronicSql;die;

		$elcetronicSqlRes = sql_select($elcetronicSql);
		foreach ($elcetronicSqlRes as $rows) {

			if ($rows[BUYER_ID] != '') {
				foreach (explode(',', $rows[BUYER_ID]) as $bi) {
					if ($rows[USER_EMAIL] != '' && $bi == $buyer_name_id) {
						$mailToArr[] = $rows[USER_EMAIL];
					}
					if ($rows[BYPASS] == 2) {
						break;
					}
				}
			} else {
				if ($rows[USER_EMAIL]) {
					$mailToArr[] = $rows[USER_EMAIL];
				}
				if ($rows[BYPASS] == 2) {
					break;
				}
			}
		}


		$to = implode(',', array_unique($mailToArr));
		//echo $to;die;


		/*		//Att file....
	$imgSql="select IMAGE_LOCATION,REAL_FILE_NAME from common_photo_library where is_deleted=0  and MASTER_TBLE_ID=$txt_job_no and file_type=1";
	$imgSqlResult=sql_select($imgSql);
	foreach($imgSqlResult as $rows){
		$att_file_arr[]='../../../'.$rows[IMAGE_LOCATION].'**'.$rows[REAL_FILE_NAME];
	}
*/
		$mailBody = $bodymail;
		$subject = "Pre Cost Entry Report";
		$header = mailHeader();
		echo sendMailMailer($to, $subject, $mailBody, $from_mail, $att_file_arr) . $to;
	} else {
		echo $mailBody;
	}

	//------------------------------------End;


}

if ($action == "preCostRpt12") //copy cost rpt10//shariar
{
	$process = array(&$_POST);

	extract(check_magic_quote_gpc($process));
	if ($txt_job_no == "") $job_no = '';
	else $job_no = " and a.job_no=" . $txt_job_no . "";
	$txt_costing_date = change_date_format(str_replace("'", "", $txt_costing_date), 'yyyy-mm-dd', '-');
	$txt_costingdate = change_date_format(str_replace("'", "", $txt_costing_date), 'yyyy-mm-dd', '-');
	if ($db_type == 0) {
		$costing_date = change_date_format($txt_costing_date, "yyyy-mm-dd", "-");
	}
	if ($db_type == 2) {
		$costing_date = change_date_format($txt_costing_date, "yyyy-mm-dd", "-", 1);
	}
	if ($cbo_company_name == "") $company_name = '';
	else $company_name = " and a.company_name=" . $cbo_company_name . "";
	if ($cbo_buyer_name == "") $cbo_buyer_name = '';
	else $cbo_buyer_name = " and a.buyer_name=" . $cbo_buyer_name . "";
	if ($txt_style_ref == "") $txt_style_ref = '';
	else $txt_style_ref = " and a.style_ref_no=" . $txt_style_ref . "";
	if ($txt_costing_date == "") $txt_costing_date = '';
	else $txt_costing_date = " and b.costing_date='" . $txt_costing_date . "'";
	$buyer_arr = return_library_array("select id, buyer_name from lib_buyer", 'id', 'buyer_name');
	$comp = return_library_array("select id, company_name from lib_company", 'id', 'company_name');
	$color_library = return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$lip_yarn_count = return_library_array("select id,fabric_composition_id from lib_yarn_count_determina_mst where  status_active=1", "id", "fabric_composition_id");
	$fabric_composition_arr = return_library_array("select id,fabric_composition_name from lib_fabric_composition where  status_active=1", "id", "fabric_composition_name");

	if ($db_type == 0) {
		$sqlcpm = sql_select("select cost_per_minute from lib_standard_cm_entry where company_id=$cbo_company_name and '$costing_date' between applying_period_date and applying_period_to_date  and status_active=1 and is_deleted=0 LIMIT 1");
	}
	if ($db_type == 2) {
		$sqlcpm = sql_select("select cost_per_minute from lib_standard_cm_entry where company_id=$cbo_company_name and '$costing_date' between applying_period_date and applying_period_to_date and status_active=1 and is_deleted=0");
	}

	$cpm = '';
	foreach ($sqlcpm as $sqlcpmrow) {
		$cpm = $sqlcpmrow[csf('cost_per_minute')];
	}
	if ($db_type == 0) $group_gsm = "group_concat( distinct b.gsm_weight) AS gsm_weight";
	if ($db_type == 2) $group_gsm = "listagg(b.gsm_weight ,',') within group (order by b.gsm_weight) AS gsm_weight";

	$gsm_weight_top = return_field_value("$group_gsm", "lib_body_part a,wo_pre_cost_fabric_cost_dtls b", "a.id=b.body_part_id and b.job_no=$txt_job_no and a.body_part_type=1 and b.status_active=1 and b.is_deleted=0", "gsm_weight");
	$gsm_weight_bottom = return_field_value("$group_gsm", "lib_body_part a,wo_pre_cost_fabric_cost_dtls b", "a.id=b.body_part_id and b.job_no=$txt_job_no and a.body_part_type=20 and b.status_active=1 and b.is_deleted=0", "gsm_weight");
	$po_qty = 0;
	$po_plun_cut_qty = 0;
	$total_set_qnty = 0;
	$total_fob_value = 0;
	$sql_po = "select a.job_no,a.total_set_qnty,b.id,b.PUB_SHIPMENT_DATE,c.item_number_id,c.country_id,c.color_number_id,c.size_number_id,c.order_quantity ,c.plan_cut_qnty, c.order_total,b.plan_cut  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst   and b.id=c.po_break_down_id  and a.job_no =" . $txt_job_no . "   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 order by b.id";
	$sql_po_data = sql_select($sql_po);
	$pulish_ship_date_arr = array();
	foreach ($sql_po_data as $sql_po_row) {
		$po_qty += $sql_po_row[csf('order_quantity')];
		$po_plun_cut_qty += $sql_po_row[csf('plan_cut_qnty')];
		$po_plun_cut_qty_arr[$sql_po_row[csf('id')]] = $sql_po_row[csf('plan_cut')];
		$total_set_qnty = $sql_po_row[csf('total_set_qnty')];
		$pulish_ship_date_arr[$sql_po_row[PUB_SHIPMENT_DATE]] = $sql_po_row[PUB_SHIPMENT_DATE];
		$total_fob_value += $sql_po_row[csf('order_total')];
	}
	$fab_knit_req_kg_avg = 0;
	$fab_woven_req_yds_avg = 0;

	if ($db_type == 0) {
		$sql = "select a.job_no,b.id,a.company_name,a.buyer_name,a.style_ref_no,a.gmts_item_id,a.order_uom,a.job_quantity,a.avg_unit_price,b.costing_per,b.budget_minute,b.approved,b.sew_smv,b.exchange_rate,b.sew_effi_percent,c.fab_knit_req_kg,c.fab_knit_fin_req_kg,c.fab_woven_req_yds,c.fab_woven_fin_req_yds,c.fab_yarn_req_kg,a.remarks from wo_po_details_master a, wo_pre_cost_mst b left join wo_pre_cost_sum_dtls c on   b.job_no=c.job_no where a.job_no=b.job_no  and a.status_active=1 $job_no $company_name $cbo_buyer_name  $txt_costing_date order by a.job_no";
	}
	if ($db_type == 2) {
		$sql = "select a.job_no,b.id,a.company_name,a.buyer_name,a.style_ref_no,a.gmts_item_id,a.order_uom,a.job_quantity,a.avg_unit_price,b.costing_per,b.budget_minute,b.approved,b.sew_smv,b.exchange_rate,b.sew_effi_percent,c.fab_knit_req_kg,c.fab_knit_fin_req_kg,c.fab_woven_req_yds,c.fab_woven_fin_req_yds,c.fab_yarn_req_kg,b.remarks from wo_po_details_master a, wo_pre_cost_mst b left join wo_pre_cost_sum_dtls c on   b.job_no=c.job_no where a.job_no=b.job_no and a.status_active=1 $job_no $company_name $cbo_buyer_name  order by a.job_no";
	}


	$data_array = sql_select($sql);

	ob_start();
	$uom = "";
	$sew_effi_percent = 0;
	$sew_smv = 0;
	$exchange_rate = 0;
	$remarks = "";
	$mst_id = 0;
	foreach ($data_array as $row) {
		$order_price_per_dzn = 0;
		$order_job_qnty = 0;
		$avg_unit_price = 0;
		$sew_effi_percent = $row[csf("sew_effi_percent")];
		$sew_smv = $row[csf("sew_smv")];
		$exchange_rate = $row[csf("exchange_rate")];
		$remarks = $row[csf("remarks")];
		$mst_id = $row[csf("id")];


		$order_values = $row[csf("job_quantity")] * $row[csf("avg_unit_price")];
		$result = sql_select("select po_number,grouping,file_no,pub_shipment_date from wo_po_break_down where job_no_mst=$txt_job_no and status_active=1 and is_deleted=0 order by pub_shipment_date DESC");
		$job_in_orders = '';
		$pulich_ship_date = '';
		$job_in_file = '';
		$job_in_ref = '';
		foreach ($result as $val) {
			$job_in_orders .= $val[csf('po_number')] . ", ";
			$pulich_ship_date = $val[csf('pub_shipment_date')];
			$job_in_ref .= $val[csf('grouping')] . ",";
			$job_in_file .= $val[csf('file_no')] . ",";
		}
		$job_in_orders = substr(trim($job_in_orders), 0, -1);

		$job_ref = array_unique(explode(",", rtrim($job_in_ref, ", ")));
		$job_file = array_unique(explode(",", rtrim($job_in_file, ", ")));

		foreach ($job_ref as $ref) {
			$ref_cond .= ", " . $ref;
		}
		$file_con = '';
		foreach ($job_file as $file) {
			if ($file_con == '') $file_cond = $file;
			else $file_cond .= ", " . $file;
		}

		$img_path = (str_replace("'", "", $path)) ? str_replace("'", "", $path) : '../';

?>
<table style="width:850px">
	<tr>
		<td colspan="6" align="center">
			<?
			$image_location = return_field_value("image_location", "common_photo_library", "file_type=1 and form_name='company_details' and master_tble_id=$cbo_company_name", "image_location");
			?>
			<img src='<?= $img_path ?><? echo $image_location; ?>' height='70' align="left" />
			<b style="font-size:25px;"><? echo $comp[str_replace("'", "", $cbo_company_name)]; ?></b><br>
			<b style="font-size:14px;">Budget </b>
		</td>
	</tr>
</table>


<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px" rules="all">
	<tr>
		<td width="80">Job Number</td>
		<td width="80"><b><? echo $row[csf("job_no")]; ?></b></td>
		<td width="90">Buyer</td>
		<td width="100"><b><? echo $buyer_arr[$row[csf("buyer_name")]]; ?></b></td>
		<td width="80">Garments Item</td>
		<?
		$grmnt_items = "";
		$gmtsArr = array();
		if ($garments_item[$row[csf("gmts_item_id")]] == "") {

			$grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no=$txt_job_no");
			foreach ($grmts_sql as $key => $val) {
				$grmnt_items .= $garments_item[$val[csf("gmts_item_id")]] . ", ";
				$gmtsArr[$val[csf("gmts_item_id")]] = $val[csf("gmts_item_id")];
				//echo $val[csf("gmts_item_id")]."<br>";
			}
			$grmnt_items = substr_replace($grmnt_items, "", -1, 1);
		} else {
			$grmnt_items = $garments_item[$row[csf("gmts_item_id")]];
			$gmtsArr[$row[csf("gmts_item_id")]] = $row[csf("gmts_item_id")];
		}


		?>
		<td width="100"><b><? echo $grmnt_items; ?></b></td>
	</tr>
	<tr>
		<td>Style Ref. No </td>
		<td><b><? echo $row[csf("style_ref_no")]; ?></b></td>
		<td>Job Qnty Set </td>
		<td><b><?= number_format($row[csf("job_quantity")], 0); ?></b></td>
		<td>Job Qnty Pcs</td>
		<td><b><? $uom = $row[csf("order_uom")];
				echo number_format($row[csf("job_quantity")] * $total_set_qnty, 0); ?></b></td>
	</tr>
	<tr>
		<td>Order Numbers</td>
		<td><? echo $job_in_orders; ?></td>
		<td>Plan Cut Qnty Set</td>
		<td><b><? $plunCutQty = array_sum($po_plun_cut_qty_arr);
				echo number_format($plunCutQty, 0);; ?></b></td>
		<td>Plan Cut Qnty Pcs</td>
		<td><b><? $uom = $row[csf("order_uom")];
				echo number_format($plunCutQty * $total_set_qnty, 0);; ?></b></td>
	</tr>
	<tr>
		<td>Knit Fabric Cons</td>
		<td><b><? echo $row[csf("fab_knit_req_kg")];
				$fab_knit_req_kg_avg += $row[csf("fab_knit_req_kg")]; ?> (Kg)</b></td>

		<td>Woven Fabric Cons</td>
		<td><b><? echo $row[csf("fab_woven_req_yds")];
				$fab_woven_req_yds_avg += $row[csf("fab_woven_req_yds")]; ?> (Yds)</b></td>
		<td>Price Per Unit</td>
		<td><b><? echo $row[csf("avg_unit_price")]; ?> USD</b></td>
	</tr>
	<tr>
		<td>Avg Yarn Req</td>
		<td><b><? echo $row[csf("fab_yarn_req_kg")] ?> (Kg)</b></td>
		<td>Costing Per</td>
		<td><b><? echo $costing_per[$row[csf("costing_per")]]; ?></b></td>
		<td>Shipment Date </td>
		<td><b><? echo change_date_format($pulich_ship_date); ?></b></td>
	</tr>
	<tr>
		<td>Knit Fin Fabric Cons</td>
		<td><b><? echo $row[csf("fab_knit_fin_req_kg")] ?> (Kg)</b></td>
		<td>Woven Fin Fabric Cons</td>
		<td><b><? echo $row[csf("fab_woven_fin_req_yds")]; ?>(Yds)</b></td>
		<td>GSM </td>
		<td><b><? //echo $gsm_weight_top.",".$gsm_weight_bottom

				$gsm_weights_top = implode(",", array_unique(explode(",", $gsm_weight_top)));
				$gsm_weight_bottom = implode(",", array_unique(explode(",", $gsm_weight_bottom)));
				if ($gsm_weights_top != '') $gsm_weightTop = $gsm_weights_top;
				else $gsm_weightTop = '';
				if ($gsm_weight_bottom != '' && $gsm_weights_top != '') $gsm_weightBottom = " ," . $gsm_weight_bottom;
				else if ($gsm_weight_bottom != '' && $gsm_weights_top == '') $gsm_weightBottom = $gsm_weight_bottom;
				else $gsm_weightBottom = '';
				echo $gsm_weightTop . $gsm_weightBottom;
				?></b></td>

	</tr>
	<tr>
		<td>SMV</td>
		<td><b><? echo number_format($row[csf("sew_smv")], 2); ?> </b></td>
		<td>CPM</td>
		<td><b><? echo $cpm; ?> </b></td>
		<td>Budget Minute</td>
		<td><b><? echo $row[csf("budget_minute")] ?> </b></td>
	</tr>

	<tr>
		<td>Efficiency</td>
		<td colspan="1"><b><? echo $row[csf("sew_effi_percent")] ?> </b></td>
		<td>Garments Item Set Qty</td>
		<td colspan="1"><b><? echo count($gmtsArr); ?> </b></td>
		<?
		$amount = $row[csf("job_quantity")] * $row[csf("avg_unit_price")];
		?>
		<td>Amount</td>
		<td colspan="1"><b><? echo fn_number_format($amount, 4); ?></b></td>
	</tr>
	<tr>
		<td align="center" height="10" colspan="6" valign="top" id="app_sms" style="font-size:18px;">
			<font color="#FF0000"><?



									$ap_msg = "";
									if ($row[csf("approved")] == 1) {
										$ap_msg = "This Job Is Full Approved.";
									} else if ($row[csf("approved")] == 3) {
										$approval_allow = sql_select("select b.id, b.page_id, b.approval_need, b.allow_partial, b.validate_page,a.setup_date from approval_setup_mst a,approval_setup_dtls b where a.id=b.mst_id and a.company_id='$company_id' and a.status_active=1 and b.page_id=25 and b.status_active=1 and b.is_deleted=0 order by b.id desc ");
										if ($approval_allow[0][csf("approval_need")] == 1 && $approval_allow[0][csf("allow_partial")] == 1) {
											$ap_msg = "This Job Is Approved.";
										} else {
											$ap_msg = "This Job Partially Approved.";
										}
									} else {
										$ap_msg = " ";
									}
									echo $ap_msg;


									?> </font>
		</td>
	</tr>
</table>
<?
		if ($row[csf("costing_per")] == 1) {
			$order_price_per_dzn = 12;
			$costing_for = " DZN";
		} else if ($row[csf("costing_per")] == 2) {
			$order_price_per_dzn = 1;
			$costing_for = " PCS";
		} else if ($row[csf("costing_per")] == 3) {
			$order_price_per_dzn = 24;
			$costing_for = " 2 DZN";
		} else if ($row[csf("costing_per")] == 4) {
			$order_price_per_dzn = 36;
			$costing_for = " 3 DZN";
		} else if ($row[csf("costing_per")] == 5) {
			$order_price_per_dzn = 48;
			$costing_for = " 4 DZN";
		}
		$order_job_qnty = $row[csf("job_quantity")];
		$avg_unit_price = $row[csf("avg_unit_price")];
	} //end first foearch


?>
<br>


<?php
	$uom = 0;
	$joball = array();
	$nameArray_per_job = sql_select("SELECT  a.season_buyer_wise,  a.job_no,a.style_ref_no ,a.season_matrix,a.gmts_item_id,a.product_dept,a.dealing_marchant from wo_po_details_master a where  a.job_no=$txt_job_no and a.status_active=1 and a.is_deleted=0");
	foreach ($nameArray_per_job as $vals) {
		$joball['job_no'][$vals[csf('job_no')]] = $vals[csf('job_no')];
		$joball['style_ref_no'][$vals[csf('job_no')]] = $vals[csf('style_ref_no')];
		$all_job_arr[$vals[csf("job_no")]]["job"] = "'" . $vals[csf("job_no")] . "'";
		$all_job_arr[$vals[csf("job_no")]]["style"] = $vals[csf("style_ref_no")];
		$all_job_arr[$vals[csf("job_no")]]["item"] = $vals[csf("gmts_item_id")];
		$all_job_arr[$vals[csf("job_no")]]["season"] = $vals[csf("season_matrix")];

		$all_job_arr_season[$vals[csf("job_no")]] = $season_arr[$vals[csf("season_buyer_wise")]];

		$all_job_arr[$vals[csf("job_no")]]["dept"] = $vals[csf("product_dept")];
		$all_job_arr_dept[$vals[csf("job_no")]] = $product_dept[$vals[csf("product_dept")]];
		$all_jobs[$vals[csf("job_no")]] = "'" . $vals[csf("job_no")] . "'";
		$job_wise_style[$vals[csf("job_no")]] = $vals[csf("style_ref_no")];
		$po_job_no = $vals[csf('job_no')];
	}
	//echo $po_job_no.'DDD';die;
	$all_jobs_id = implode(",", $all_jobs);
	$seasons = implode(",", $all_job_arr_season);
	$depts = implode(",", $all_job_arr_dept);

	$po_data = array();
	$nameArray_job = sql_select("select b.job_no_mst,b.id, b.po_number,b.grouping, b.file_no, b.po_quantity,(pub_shipment_date-po_received_date) date_diff,MIN(po_received_date) as po_received_date,MIN(pub_shipment_date) as pub_shipment_date,MIN(b.insert_date) as insert_date,b.shiping_status   from  wo_po_break_down b where b.status_active =1 and b.is_deleted=0 and b.job_no_mst=$txt_job_no group by b.job_no_mst,b.id, b.po_number,b.grouping, b.file_no, b.po_quantity,pub_shipment_date,po_received_date,b.insert_date,b.shiping_status ");
	foreach ($nameArray_job as $result_job) {
		$po_data['po_id'][$result_job[csf('id')]] = $result_job[csf('id')];
		$po_data['po_number'][$result_job[csf('id')]] = $result_job[csf('po_number')];
		$po_data['leadtime'][$result_job[csf('id')]] = $result_job[csf('date_diff')];
		$po_data['po_quantity'][$result_job[csf('id')]] = $result_job[csf('po_quantity')];
		$po_data['po_received_date'][$result_job[csf('id')]] = change_date_format($result_job[csf('po_received_date')], 'dd-mm-yyyy', '-');
		$ddd = strtotime($result_job[csf('pub_shipment_date')]);
		$po_data['pub_shipment_date'][$ddd] = $ddd;

		$po_data['insert_date'][$result_job[csf('id')]] = $result_job[csf('insert_date')];

		if ($result_job[csf('shiping_status')] == 1) {
			$shiping_status = "FP";
		} else if ($result_job[csf('shiping_status')] == 2) {
			$shiping_status = "PS";
		} else if ($result_job[csf('shiping_status')] == 3) {
			$shiping_status = "FS";
		}
		$po_data['shiping_status'][$result_job[csf('id')]] = $shiping_status;
		$po_data['file_no'][$result_job[csf('id')]] = $result_job[csf('file_no')];

		$po_data['grouping'][$result_job[csf('id')]] = $result_job[csf('grouping')];
	}
	$txt_order_no_id = implode(",", array_unique($po_data['po_id']));
	$leadtime = implode(",", array_unique($po_data['leadtime']));
	$po_quantity = array_sum($po_data['po_quantity']);
	$po_received_date = implode(",", array_unique($po_data['po_received_date']));
	$po_number = implode(",", array_unique($po_data['po_number']));
	$shipment_date = date('d-m-Y', min($po_data['pub_shipment_date']));
	$maxshipment_date = date('d-m-Y', max($po_data['pub_shipment_date']));
	//$shipment_date=implode(",",array_unique($po_data['pub_shipment_date']));
	$shiping_status = implode(",", array_unique($po_data['shiping_status']));
	$file_no = implode(",", array_unique($po_data['file_no']));
	$grouping = implode(",", array_unique($po_data['grouping']));

?>
<br />
<!--  Here will be the main portion  -->
<?
	$costing_per = "";
	$costing_per_qnty = 0;
	$costing_per_id = return_field_value("costing_per", "wo_pre_cost_mst", "job_no in($txt_job_no)");
	if ($costing_per_id == 1) {
		$costing_per = "1 Dzn";
		$costing_per_qnty = 12;
	}
	if ($costing_per_id == 2) {
		$costing_per = "1 Pcs";
		$costing_per_qnty = 1;
	}
	if ($costing_per_id == 3) {
		$costing_per = "2 Dzn";
		$costing_per_qnty = 24;
	}
	if ($costing_per_id == 4) {
		$costing_per = "3 Dzn";
		$costing_per_qnty = 36;
	}
	if ($costing_per_id == 5) {
		$costing_per = "4 Dzn";
		$costing_per_qnty = 48;
	}
	$process_loss_method = return_field_value("process_loss_method", "wo_pre_cost_fabric_cost_dtls", "job_no in($job_no_in)");
	$uom_arr = array(1 => "Pcs", 12 => "Kg", 23 => "Mtr", 27 => "Yds");
	$p = 1;
	$color_wise_process_loss = sql_select("SELECT a.id,a.job_no, a.body_part_id, b.color_number_id,b.dia_width, a.process_loss_method, b.process_loss_percent as loss, avg(b.cons_pcs) as consdzn FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and  a.job_no=$txt_job_no and b.process_loss_percent>0 group by a.id,a.job_no, a.body_part_id, a.process_loss_method,b.dia_width, b.color_number_id, b.process_loss_percent");
	foreach ($color_wise_process_loss as $val) {
		$loss_arr[$val[csf("id")]][$val[csf("dia_width")]][$val[csf("job_no")]][$val[csf("body_part_id")]][$val[csf("color_number_id")]]['loss'] = $val[csf("loss")];
		$loss_arr[$val[csf("id")]][$val[csf("dia_width")]][$val[csf("job_no")]][$val[csf("body_part_id")]][$val[csf("color_number_id")]]['loss_method'] = $val[csf("process_loss_method")];
		$loss_arr[$val[csf("id")]][$val[csf("dia_width")]][$val[csf("job_no")]][$val[csf("body_part_id")]][$val[csf("color_number_id")]]['consdzn'] = $val[csf("consdzn")];
		$gmt_color_arr[$val[csf("id")]][$val[csf("dia_width")]][$val[csf("job_no")]][$val[csf("body_part_id")]][$val[csf("color_number_id")]]['color_id'] = $val[csf("color_number_id")];
	}
	$nameArray_qty_arr = sql_select("select b.job_no_mst,b.id,a.style_ref_no,c.item_number_id,c.color_number_id,c.plan_cut_qnty,c.order_quantity   from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where  a.job_no=b.job_no_mst and c.po_break_down_id=b.id and a.job_no=c.job_no_mst and a.status_active =1 and b.status_active =1 and c.status_active =1 and a.is_deleted=0 and a.job_no=$txt_job_no and b.id in($txt_order_no_id)  ");
	foreach ($nameArray_qty_arr as $row) {
		$gmts_qty_data_arr[$row[csf('job_no_mst')]][$row[csf('item_number_id')]][$row[csf('color_number_id')]][40] += $row[csf('order_quantity')];
		$gmts_qty_data_arr[$row[csf('job_no_mst')]][$row[csf('item_number_id')]][$row[csf('color_number_id')]][50] += $row[csf('order_quantity')];
		$fab_gmts_qty_data_arr[$row[csf('job_no_mst')]][$row[csf('item_number_id')]][$row[csf('color_number_id')]] += $row[csf('order_quantity')];
		$plan_qty_data_arr[$row[csf('job_no_mst')]][$row[csf('item_number_id')]][$row[csf('color_number_id')]] += $row[csf('order_quantity')];
		$gmts_color_data_arr[$row[csf('job_no_mst')]][$row[csf('item_number_id')]]['color'] .= $row[csf('color_number_id')] . ',';
	}


	$nameArray_fabric_description = sql_select("SELECT a.id as fabric_cost_dtls_id,a.seq, a.item_number_id, a.body_part_id,a.body_part_type,a.color_type_id, a.construction, a.composition, a.gsm_weight,a.width_dia_type as width_dia_type , b.dia_width,a.uom,a.color_size_sensitive,	a.color_break_down,c.job_no_mst,avg(b.requirment) as requirment,avg(b.cons) as consumption,avg(b.process_loss_percent) as process_loss_percent,avg(b.cons) as finish_cons,sum(c.plan_cut_qnty) as plan_cut_qnty,sum(c.order_quantity) as order_qnty,avg(c.excess_cut_perc) as ex_cut_per,b.color_number_id,b.rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and  b.po_break_down_id=c.po_break_down_id  and a.job_no=$txt_job_no  and a.status_active=1 and b.status_active=1 and c.status_active=1 and b.cons>0 group by a.id , a.item_number_id,a.seq, a.body_part_id,a.body_part_type,a.color_type_id, a.construction,a.composition, a.gsm_weight,a.width_dia_type , b.dia_width,a.uom ,a.color_size_sensitive,a.color_break_down,c.job_no_mst,b.color_number_id,b.rate order by a.item_number_id,b.color_number_id,a.seq,a.id");
	$uom_data_arr = array();
	$b_part_array_not = array(40, 50);
	foreach ($nameArray_fabric_description as $row) {
		if (!in_array($row[csf('body_part_type')], $b_part_array_not)) {
			$uom_data_arr[$row[csf('uom')]] = $row[csf('uom')];
		}
		if ($row[csf('body_part_type')] == 40 || $row[csf('body_part_type')] == 50) {
			$gmts_qty_data_arr[$row[csf('job_no_mst')]][$row[csf('item_number_id')]][$row[csf('gmts_color_id')]][$row[csf('body_part_type')]] = $row[csf('order_quantity_pcs')];
		}
	}

	foreach ($uom_data_arr as $uom_id => $uom_val) {
		if (count($nameArray_fabric_description) > 0) {

?>

	<table class="rpt_table" width="100%" border="1" cellpadding="0" cellspacing="0" rules="all">
		<caption> <strong>Fabric Booking Summary </strong> </caption>
		<tr>
			<th width="30" align="center">SL</th>
			<th width="150" align="center">Style</th>
			<th width="140" align="center">Gmts Item</th>
			<th width="130" align="center">Body Parts</th>
			<th width="100" align="center">Gmts Order Qty (Pcs)</th>
			<th width="100" align="center">Extra Cutting %</th>
			<th width="100" align="center">Fabric Construction</th>
			<th width="400" align="center">Yarn Composition</th>
			<th width="100" align="center">Fabric Composition</th>
			<th width="150" align="center">Add. Process</th>
			<th width="40" align="center">GSM</th>
			<th width="90" align="center">Fin Width/ Dia Type</th>
			<th width="100" align="center">Color Type</th>
			<th width="100" align="center">Combo</th>
			<th width="110" align="center">Fabric Color</th>
			<th width="80" align="center">Finish Cons. Kg/Dzn</th>
			<th width="60" align="center">UOM</th>
			<th width='120' align="center" title="Based on avg grey consumption">Finished Fab. Qty</th>
			<th width='100' align="center">Avg. P/L %</th>
			<th width='100' align="center">Grey Fabric Qty</th>
			<th width='100' align="center">Avg Rate/<? echo $unit_of_measurement[$uom_id]; ?></th>
			<th width='60' align="center">Amount</th>
			<th width='100' align="center">Additional DTM Trims Qty</th>
			<th align="center">Remarks</th>

		</tr>
		<? //wo_pre_cos_fab_co_color_dtls
			$dtm_arr = array();
			$sql = sql_select("select pre_cost_fabric_cost_id,fabric_color,sum(qty) as qty  from wo_dye_to_match where booking_no=$txt_booking_no and status_active=1 and is_deleted=0 group by pre_cost_fabric_cost_id,fabric_color");
			foreach ($sql as $row) {
				$dtm_arr[$row[csf('pre_cost_fabric_cost_id')]][$row[csf('fabric_color')]] = $row[csf('qty')];
			}

			$total_fin_fab_qnty = $total_gmt_qty_pcs = 0;
			$total_amount = 0;
			$total_grey_fab_qnty = 0;
			$tot_avg = 0;
			foreach ($nameArray_fabric_description as $val) {
				if ($val[csf('pre_cost_remarks')] != '') $remark_cond = " and d.pre_cost_remarks='" . $val[csf('pre_cost_remarks')] . "' ";
				else $remark_cond = " and d.pre_cost_remarks is null";


				$color_wise_wo_sql_qnty = sql_select("SELECT  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate,sum(d.fin_fab_qnty*d.rate) as amount,max(a.lib_yarn_count_deter_id) as determin_id
								FROM wo_pre_cost_fabric_cost_dtls a
								WHERE
								a.job_no=$txt_job_no
									a.item_number_id='" . $val[csf('item_number_id')] . "' and
									a.body_part_id='" . $val[csf('body_part_id')] . "' and
									a.color_type_id='" . $val[csf('color_type_id')] . "' and
									a.construction='" . $val[csf('construction')] . "' and
									a.composition='" . $val[csf('composition')] . "' and
									a.gsm_weight='" . $val[csf('gsm_weight')] . "' and
								
									a.id='" . $val[csf('fabric_cost_dtls_id')] . "' and
									a.uom='" . $uom_id . "'");

				if ($uom_id == $val[csf('uom')]) {
					if ($val[csf('pre_cost_remarks')] == 'no remarks')  $pre_cost_remarks = "";
					else  $pre_cost_remarks = $val[csf('pre_cost_remarks')];

					$order_quantity_pcs = 0;
					if ($val[csf('color_size_sensitive')] == 1 or $val[csf('color_size_sensitive')] == 2 or $val[csf('color_size_sensitive')] == 4) {
						$gmt_colorName = $color_library[$val[csf('fabric_color_id')]];
						$gmt_colorId = $val[csf('fabric_color_id')];
						//echo $gmt_colorId.'d';
						$order_quantity_pcs += $fab_gmts_qty_data_arr[$val[csf('job_no_mst')]][$val[csf('item_number_id')]][$val[csf('fabric_color_id')]];
						$plan_quantity_pcs += $plan_qty_data_arr[$val[csf('job_no_mst')]][$val[csf('item_number_id')]][$val[csf('fabric_color_id')]];
					} else {
						$color_break_down = $val[csf('color_break_down')];
						if ($color_break_down) {
							$gmts_color = "";
							$gmt_colorId = "";
							if (strpos($color_break_down, '__') !== false) {
								$color_break_down = explode('__', $color_break_down);
								foreach ($color_break_down as $key => $value) {
									$cols = explode('_', $value);
									if (trim(strtolower($color_library[$val[csf('fabric_color_id')]])) == trim(strtolower($cols[2]))) {
										if ($gmts_color == "") {
											$gmts_color = $cols[1];
											$order_quantity_pcs = $fab_gmts_qty_data_arr[$val[csf('job_no_mst')]][$val[csf('item_number_id')]][$cols[0]];
											$plan_quantity_pcs = $plan_qty_data_arr[$val[csf('job_no_mst')]][$val[csf('item_number_id')]][$cols[0]];
											$gmt_colorId = $cols[0];
										} else {
											$gmts_color .= ',' . $cols[1];
											$order_quantity_pcs += $fab_gmts_qty_data_arr[$val[csf('job_no_mst')]][$val[csf('item_number_id')]][$cols[0]];
											$plan_quantity_pcs += $plan_qty_data_arr[$val[csf('job_no_mst')]][$val[csf('item_number_id')]][$cols[0]];
											$gmt_colorId = $cols[0];
										}
									}
								}
							} else {
								$cols = explode('_', $color_break_down);
								if (trim(strtolower($color_library[$val[csf('fabric_color_id')]])) == trim(strtolower($cols[2]))) {
									if ($gmts_color == "") {
										$gmts_color = $cols[1];
										$order_quantity_pcs = $fab_gmts_qty_data_arr[$val[csf('job_no_mst')]][$val[csf('item_number_id')]][$cols[0]];
										$plan_quantity_pcs = $plan_qty_data_arr[$val[csf('job_no_mst')]][$val[csf('item_number_id')]][$cols[0]];
										$gmt_colorId = $cols[0];
									} else {
										$gmts_color .= ',' . $cols[1];
										$order_quantity_pcs += $fab_gmts_qty_data_arr[$val[csf('job_no_mst')]][$val[csf('item_number_id')]][$cols[0]];
										$plan_quantity_pcs += $plan_qty_data_arr[$val[csf('job_no_mst')]][$val[csf('item_number_id')]][$cols[0]];
										$gmt_colorId = $cols[0];
									}
								}
							}

							$gmt_colorName = $gmts_color;
						}
					}

					$gmt_color_Id = $gmt_colorId;
					$order_quantity_pcs = $fab_gmts_qty_data_arr[$val[csf('job_no_mst')]][$val[csf('item_number_id')]][$val[csf("color_number_id")]];



					$process_loss = $loss_arr[$val[csf("fabric_cost_dtls_id")]][$val[csf("dia_width")]][$val[csf("job_no_mst")]][$val[csf("body_part_id")]][$gmt_color_Id]['loss'];
					$p_loss_method = $loss_arr[$val[csf("fabric_cost_dtls_id")]][$val[csf("dia_width")]][$val[csf("job_no_mst")]][$val[csf("body_part_id")]][$gmt_color_Id]['loss_method'];

					if ($process_loss == '') $process_loss = 0;
					else $process_loss = $process_loss;
					if ($p_loss_method == '') $p_loss_method = 0;
					else $p_loss_method = $p_loss_method;

		?>
				<tr>
					<td align="center"> <? echo $p;
										$p++; ?></td>


					<td align="center"> <? echo $all_job_arr[$val[csf("job_no_mst")]]["style"]; ?></td>
					<td align="center"> <? echo $garments_item[$val[csf("item_number_id")]]; ?></td>
					<td align="center"><? echo $body_part[$val[csf('body_part_id')]]; ?></td>

					<td align="center"><? echo number_format($order_quantity_pcs, 2); ?></td>
					<td align="center"><? echo number_format($val[csf('ex_cut_per')], 2); ?></td>

					<td align="left"> <? echo $val[csf('construction')]; ?> </td>
					<td align="left"> <? echo $val[csf('composition')]; ?> </td>
					<td align="center">
						<?
						foreach ($color_wise_wo_sql_qnty  as $frow) {
							echo $fabric_composition_arr[$lip_yarn_count[$frow[csf('determin_id')]]];
						}
						?>
					</td>
					<td align="center"><? echo $pre_cost_remarks;	?> </td>
					<td align="center">
						<?
						echo $val[csf('gsm_weight')];
						?>
					</td>

					<td align="center">
						<?
						echo $val[csf('dia_width')] . '/' . $fabric_typee[$val[csf('width_dia_type')]];
						?>
					</td>

					<td align="center">
						<?
						echo $color_type[$val[csf('color_type_id')]];
						?>
					</td>
					<td align="center" title="<?= $gmt_color_Id; ?>">
						<?
						echo $color_library[$val[csf('color_number_id')]];
						?>
					</td>


					<td align="center">
						<?
						echo $color_library[$val[csf('color_number_id')]];
						?>
					</td>



					<td align="center"> <? echo def_number_format($val[csf('consumption')], 5); ?></td>

					<td align="center"> <? echo $unit_of_measurement[$val[csf('uom')]]; ?></td>

					<?
					$fin_fab_qnty = $color_wise_wo_sql_qnty[0][csf("fin_fab_qnty")];

					$grey_fab_qnty = $color_wise_wo_sql_qnty[0][csf("grey_fab_qnty")];
					$rate = $color_wise_wo_sql_qnty[0][csf("rate")];
					$amount = $color_wise_wo_sql_qnty[0][csf("amount")];
					$process_loss_percent = $val[csf("process_loss_percent")];
					$avgRate = $amount / $fin_fab_qnty;
					$con = $val[csf('consumption')] / $costing_per_qnty;
					$req = $val[csf('requirment')] / $costing_per_qnty;

					?> </td>
					<td align="center"> <? echo number_format($order_quantity_pcs * $con, 2);
										$tot_fin_qnty += $order_quantity_pcs * $con; ?> </td>
					<td align="center"> <? echo def_number_format($process_loss_percent, 2); ?> </td>
					<td align="center"> <? echo number_format($order_quantity_pcs * $req, 2);
										$tot_grey_qnty += $order_quantity_pcs * $req; ?> </td>
					<td align="center"> <? echo def_number_format($val[csf('rate')], 2); ?> </td>
					<td align="center"> <? echo def_number_format($order_quantity_pcs * $con * $val[csf('rate')], 2);
										$tot_amount += $order_quantity_pcs * $con * $val[csf('rate')]; ?> </td>


					<?

					$total_fin_fab_qnty += str_replace(",", "", def_number_format($greys, 2));
					$total_amount += str_replace(",", "", def_number_format($amount, 2));

					$total_grey_fab_qnty += str_replace(",", "", def_number_format($fin_fab_qnty, 2));
					$total_greyfabqnty += str_replace(",", "", def_number_format($grey_fab_qnty, 2));
					$total_rate += str_replace(",", "", def_number_format($rate, 2));
					$tot_avg = $total_amount / $total_grey_fab_qnty;
					$total_gmt_qty_pcs += $order_quantity_pcs;


					?>
					<td align="center"> <?= $dtm_arr[$val[csf('fabric_cost_dtls_id')]][$val[csf('fabric_color_id')]]  ?> </td>
					<td align="center"> <? echo $val[csf('remark')]; ?> </td>


				</tr>
		<?
				}
			}
		?>
		<tr style=" font-weight:bold">

			<td align="right" colspan="6"><strong>Total</strong></td>
			<td align="right"><? //echo def_number_format($total_gmt_qty_pcs,2);
								?></td>
			<td align="right" colspan="10">&nbsp;</td>

			<td align="center"><? echo def_number_format($tot_fin_qnty, 2); ?></td>
			<td align="right">&nbsp;</td>
			<td align="center"><? echo def_number_format($tot_grey_qnty, 2); ?></td>
			<td align="center"><? //echo def_number_format($tot_avg,2);
								?></td>
			<td align="center"><? echo def_number_format($tot_amount, 2); ?></td>
			<td align="right">&nbsp;</td>

		</tr>

	</table>

<?
		}
	}
	?>
	<br>

	<?
			$mailBody = ob_get_contents();
			ob_clean();


			//Mail send------------------------------------------
			list($msil_address, $is_mail_send) = explode('**', $mail_data);
			if ($is_mail_send == 1) {


				$data_array = sql_select("select b.id, b.job_no, b.fabric_cost, b.fabric_cost_percent, b.trims_cost, b.trims_cost_percent, b.embel_cost, b.embel_cost_percent, b.wash_cost, b.wash_cost_percent, b.comm_cost, b.comm_cost_percent, b.commission, b.commission_percent, b.lab_test, b.lab_test_percent, b.inspection, b.inspection_percent, b.cm_cost,  b.freight,  b.currier_pre_cost, b.certificate_pre_cost, b.certificate_percent, b.common_oh, b.depr_amor_pre_cost, b.depr_amor_po_price, b.total_cost, b.total_cost_percent, b.price_dzn, b.price_dzn_percent, b.margin_dzn, b.margin_dzn_percent, b.cost_pcs_set,  b.price_pcs_or_set,  b.margin_pcs_set, b.cm_for_sipment_sche, b.deffdlc_cost,  b.interest_cost,  b.incometax_cost, b.design_cost, b.design_percent, b.studio_cost, c.job_no_prefix_num, c.buyer_name, c.style_ref_no,c.job_quantity, c.quotation_id from wo_pre_cost_mst a ,wo_pre_cost_dtls b,wo_po_details_master c where a.job_no=b.job_no and  a.job_no=c.job_no and a.job_no=" . $txt_job_no . "  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0");



				$material_cost = $data_array[0][csf('fabric_cost')] + $data_array[0][csf('trims_cost')];
				$other_cost = $data_array[0]['LAB_TEST'] + $data_array[0]['INSPECTION'] + $data_array[0]['FREIGHT'] + $data_array[0]['CURRIER_PRE_COST'] + $data_array[0]['CERTIFICATE_PRE_COST'] + $data_array[0]['DESIGN_COST'] + $data_array[0]['STUDIO_COST'] + $data_array[0]['DEPR_AMOR_PRE_COST'] + $data_array[0]['INTEREST_COST'] + $data_array[0]['INCOMETAX_COST'] + $data_array[0]['COMMON_OH'];
				$quotation_id = $data_array[0][csf('quotation_id')];





				$bodymail = "
			<p>Dear Sir</p> 
			<p>Attached Please Find the cost break ups</p> 
		<table>
			<tr>	
				<td><b>Job No</b></td>
				<td>:" . $data_array[0][csf('job_no')] . "</td>
        	</tr>
			<tr>	
				<td><b>Buyer Name</b></td>
				<td>:" . $buyer_arr[$data_array[0][csf('buyer_name')]] . "</td>
        	</tr>
			<tr>	
				<td><b>Style Ref</b></td>
				<td>:" . $data_array[0][csf('style_ref_no')] . "</td>
        	</tr>
			<tr>	
				<td><b>Style Qty. (Pcs)</b></td>
				<td>:" . $data_array[0][csf('job_quantity')] . "</td>
        	</tr>
			<tr>	
				<td><b>Delivery</b></td>
				<td>:" . change_date_format(max($pulish_ship_date_arr)) . "</td>
        	</tr>
			<tr>	
				<td><b>Material Cost</b></td>
				<td>:" . number_format($material_cost, 4, '.', '') . "</td>
        	</tr>
			<tr>	
				<td><b>Embellishment Cost</b></td>
				<td>:" . number_format($data_array[0][csf('embel_cost')], 4, '.', '') . "</td>
        	</tr>
			<tr>	
				<td><b>Wash Cost</b></td>
				<td>:" . number_format($data_array[0][csf('wash_cost')], 4, '.', '') . "</td>
        	</tr>
			<tr>	
				<td><b>Other Cost</b></td>
				<td>:" . number_format($other_cost, 4, '.', '') . "</td>
        	</tr>
			<tr>	
				<td><b>CM Cost</b></td>
				<td>:" . number_format($data_array[0][csf('cm_cost')], 4, '.', '') . "</td>
        	</tr>
			<tr>	
				<td><b>Total Cost</b></td>
				<td>:" . number_format($data_array[0][csf('total_cost')], 4, '.', '') . "</td>
        	</tr>
			<tr>	
				<td><b>FOB Price /Dzn	</b></td>
				<td>:" . number_format($data_array[0][csf('price_dzn')], 4, '.', '') . "</td>
        	</tr>
			<tr>	
				<td><b>Margin Value /Dzn</b></td>
				<td>:" . number_format($data_array[0][csf('margin_dzn')], 4, '.', '') . "</td>
        	</tr>
			<tr>	
				<td><b>Margin Value  (%) /Dzn</b></td>
				<td>:" . number_format($data_array[0][csf('margin_dzn_percent')], 2, '.', '') . "</td>
        	</tr>
	    </table>
		<p>kindly review and advise approval please</p> 
		";

				echo "mail_sent";

				require_once('../../../mailer/class.phpmailer.php');
				require_once('../../../auto_mail/setting/mail_setting.php');

				$mailBody = preg_replace("/<img[^>]+\>/i", " ", $mailBody);
				$mailToArr = array();
				if ($msil_address) {
					$mailToArr[] = $msil_address;
				}


				$sql = "SELECT a.BRAND_IDS,a.BUYER_IDS,c.email_address as MAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id  and a.mail_item=b.MAIL_ITEM_MST and a.mail_item=89 and b.mail_user_setup_id=c.id and a.company_id =" . $cbo_company_name . "  and   A.IS_DELETED=0 and A.STATUS_ACTIVE=1  and b.IS_DELETED=0 and b.STATUS_ACTIVE=1  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
				$mail_sql = sql_select($sql);
				$receverMailArr = array();
				foreach ($mail_sql as $row) {
					$mailToArr[] = $row[MAIL];
				}


				$elcetronicSql = "SELECT a.BUYER_ID,a.SEQUENCE_NO,a.BYPASS,b.USER_EMAIL  from electronic_approval_setup a join user_passwd b on a.user_id=b.id where b.valid=1  AND a.entry_form=15 and a.company_id=$cbo_company_name order by a.SEQUENCE_NO";
				//echo $elcetronicSql;die;

				$elcetronicSqlRes = sql_select($elcetronicSql);
				foreach ($elcetronicSqlRes as $rows) {

					if ($rows[BUYER_ID] != '') {
						foreach (explode(',', $rows[BUYER_ID]) as $bi) {
							if ($rows[USER_EMAIL] != '' && $bi == $buyer_name_id) {
								$mailToArr[] = $rows[USER_EMAIL];
							}
							if ($rows[BYPASS] == 2) {
								break;
							}
						}
					} else {
						if ($rows[USER_EMAIL]) {
							$mailToArr[] = $rows[USER_EMAIL];
						}
						if ($rows[BYPASS] == 2) {
							break;
						}
					}
				}


				$to = implode(',', array_unique($mailToArr));
				//echo $to;die;


				/*		//Att file....
			$imgSql="select IMAGE_LOCATION,REAL_FILE_NAME from common_photo_library where is_deleted=0  and MASTER_TBLE_ID=$txt_job_no and file_type=1";
			$imgSqlResult=sql_select($imgSql);
			foreach($imgSqlResult as $rows){
				$att_file_arr[]='../../../'.$rows[IMAGE_LOCATION].'**'.$rows[REAL_FILE_NAME];
			}
	*/
				$mailBody = $bodymail;
				$subject = "Pre Cost Entry Report";
				$header = mailHeader();
				echo sendMailMailer($to, $subject, $mailBody, $from_mail, $att_file_arr) . $to;
			} else {
				echo $mailBody;
			}

			//------------------------------------End;


		}

if ($action == "preCostRpt11") //copy cost rpt10//Kausar/ISD-22-29430/12-12-2022/NZ
{
	$process = array(&$_POST);

	extract(check_magic_quote_gpc($process));
	if ($txt_job_no == "") $job_no = '';
	else $job_no = " and a.job_no=" . $txt_job_no . "";
	$txt_costing_date = change_date_format(str_replace("'", "", $txt_costing_date), 'yyyy-mm-dd', '-');
	$txt_costingdate = change_date_format(str_replace("'", "", $txt_costing_date), 'yyyy-mm-dd', '-');
	if ($db_type == 0) {
		$costing_date = change_date_format($txt_costing_date, "yyyy-mm-dd", "-");
	}
	if ($db_type == 2) {
		$costing_date = change_date_format($txt_costing_date, "yyyy-mm-dd", "-", 1);
	}
	if ($cbo_company_name == "") $company_name = '';
	else $company_name = " and a.company_name=" . $cbo_company_name . "";
	if ($cbo_buyer_name == "") $cbo_buyer_name = '';
	else $cbo_buyer_name = " and a.buyer_name=" . $cbo_buyer_name . "";
	if ($txt_style_ref == "") $txt_style_ref = '';
	else $txt_style_ref = " and a.style_ref_no=" . $txt_style_ref . "";
	if ($txt_costing_date == "") $txt_costing_date = '';
	else $txt_costing_date = " and b.costing_date='" . $txt_costing_date . "'";
	$buyer_arr = return_library_array("select id, buyer_name from lib_buyer", 'id', 'buyer_name');
	$comp = return_library_array("select id, company_name from lib_company", 'id', 'company_name');
	$color_library = return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");

	$sqlcpm = sql_select("select cost_per_minute from lib_standard_cm_entry where company_id=$cbo_company_name and '$costing_date' between applying_period_date and applying_period_to_date and status_active=1 and is_deleted=0");

	$cpm = '';
	foreach ($sqlcpm as $sqlcpmrow) {
		$cpm = $sqlcpmrow[csf('cost_per_minute')];
	}
	if ($db_type == 0) $group_gsm = "group_concat( distinct b.gsm_weight) AS gsm_weight";
	if ($db_type == 2) $group_gsm = "listagg(b.gsm_weight ,',') within group (order by b.gsm_weight) AS gsm_weight";

	$gsm_weight_top = return_field_value("$group_gsm", "lib_body_part a,wo_pre_cost_fabric_cost_dtls b", "a.id=b.body_part_id and b.job_no=$txt_job_no and a.body_part_type=1 and b.status_active=1 and b.is_deleted=0", "gsm_weight");

	$gsm_weight_bottom = return_field_value("$group_gsm", "lib_body_part a,wo_pre_cost_fabric_cost_dtls b", "a.id=b.body_part_id and b.job_no=$txt_job_no and a.body_part_type=20 and b.status_active=1 and b.is_deleted=0", "gsm_weight");

	$sqlpo = "select a.id as JOB_ID, a.job_no AS JOB_NO, a.total_set_qnty as TOTAL_SET_QNTY, b.id AS ID, b.po_number as PO_NUMBER, b.grouping as GROUPING, b.file_no as FILE_NO, b.PUB_SHIPMENT_DATE, b.plan_cut as PLAN_CUT, c.item_number_id AS ITEM_NUMBER_ID, c.country_id AS COUNTRY_ID, c.color_number_id AS COLOR_NUMBER_ID, c.size_number_id AS SIZE_NUMBER_ID, c.order_quantity AS ORDER_QUANTITY, c.plan_cut_qnty AS PLAN_CUT_QNTY, (c.order_quantity/a.total_set_qnty) AS ORDER_QUANTITY_SET, (c.plan_cut_qnty/a.total_set_qnty) AS PLAN_CUT_QNTY_SET, c.order_total as ORDER_TOTAL, c.country_ship_date AS COUNTRY_SHIP_DATE, d.costing_per_id AS COSTING_PER from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c, wo_pre_cost_dtls d where a.id=b.job_id and b.id=c.po_break_down_id and a.id=d.job_id and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 and d.is_deleted=0 and d.status_active=1 and a.job_no =" . $txt_job_no . "";

	$po_qty = 0;
	$po_plun_cut_qty = 0;
	$total_set_qnty = 0;
	$total_fob_value = 0;
	$po_arr = array();
	$poCountryArr = array();
	$reqQtyAmtArr = array();
	$pulish_ship_date_arr = array();
	$costingPer = 0;
	$jobid = "";
	//$sql_po="select a.job_no,a.total_set_qnty,b.id,b.PUB_SHIPMENT_DATE,c.item_number_id,c.country_id,c.color_number_id,c.size_number_id,c.order_quantity ,c.plan_cut_qnty, c.order_total,b.plan_cut  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst   and b.id=c.po_break_down_id  and a.job_no =".$txt_job_no." and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 order by b.id";
	$sql_po_data = sql_select($sqlpo);
	$job_in_orders = '';
	$pulich_ship_date = '';
	$job_in_file = '';
	$job_in_ref = '';
	foreach ($sql_po_data as $sql_po_row) {
		$po_qty += $sql_po_row['ORDER_QUANTITY_SET'];
		$po_plun_cut_qty += $sql_po_row['PLAN_CUT_QNTY_SET'];

		$po_plun_cut_qty_arr[$sql_po_row['ID']] = $sql_po_row['PLAN_CUT'];
		$total_set_qnty = $sql_po_row['TOTAL_SET_QNTY'];
		$pulish_ship_date_arr[$sql_po_row['PUB_SHIPMENT_DATE']] = $sql_po_row['PUB_SHIPMENT_DATE'];
		$total_fob_value += $sql_po_row['ORDER_TOTAL'];

		$job_in_orders .= $sql_po_row['PO_NUMBER'] . ", ";
		$pulich_ship_date = $sql_po_row['PUB_SHIPMENT_DATE'];
		$job_in_ref .= $sql_po_row['GROUPING'] . ",";
		$job_in_file .= $sql_po_row['FILE_NO'] . ",";

		$costingPerQty = 0;
		if ($sql_po_row['COSTING_PER'] == 1) {
			$costingPerQty = 12;
			$costing_for = " DZN";
		} elseif ($sql_po_row['COSTING_PER'] == 2) {
			$costingPerQty = 1;
			$costing_for = " PCS";
		} elseif ($sql_po_row['COSTING_PER'] == 3) {
			$costingPerQty = 24;
			$costing_for = " 2 DZN";
		} elseif ($sql_po_row['COSTING_PER'] == 4) {
			$costingPerQty = 36;
			$costing_for = " 2 DZN";
		} elseif ($sql_po_row['COSTING_PER'] == 5) {
			$costingPerQty = 48;
			$costing_for = " 4 DZN";
		} else {
			$costingPerQty = 0;
			$costing_for = "";
		}

		$costingPer = $costingPerQty;

		$po_arr[$sql_po_row['ID']][$sql_po_row['ITEM_NUMBER_ID']][$sql_po_row['COLOR_NUMBER_ID']][$sql_po_row['SIZE_NUMBER_ID']]['poqty'] += $sql_po_row['ORDER_QUANTITY'];
		$po_arr[$sql_po_row['ID']][$sql_po_row['ITEM_NUMBER_ID']][$sql_po_row['COLOR_NUMBER_ID']][$sql_po_row['SIZE_NUMBER_ID']]['planqty'] += $sql_po_row['PLAN_CUT_QNTY'];

		$po_arr[$sql_po_row['ID']][$sql_po_row['ITEM_NUMBER_ID']][$sql_po_row['COLOR_NUMBER_ID']][$sql_po_row['SIZE_NUMBER_ID']]['county_id'] .= $sql_po_row['COUNTRY_ID'] . ',';

		$poCountryArr[$sql_po_row['ID']][$sql_po_row['ITEM_NUMBER_ID']][$sql_po_row['COUNTRY_ID']][$sql_po_row['COLOR_NUMBER_ID']][$sql_po_row['SIZE_NUMBER_ID']]['poqty'] += $sql_po_row['ORDER_QUANTITY'];
		$poCountryArr[$sql_po_row['ID']][$sql_po_row['ITEM_NUMBER_ID']][$sql_po_row['COUNTRY_ID']][$sql_po_row['COLOR_NUMBER_ID']][$sql_po_row['SIZE_NUMBER_ID']]['planqty'] += $sql_po_row['PLAN_CUT_QNTY'];

		//$reqQtyAmtArr[$sql_po_row['ID']]['poqty']+=$sql_po_row['ORDER_QUANTITY'];
		//$reqQtyAmtArr[$sql_po_row['ID']]['planqty']+=$sql_po_row['PLAN_CUT_QNTY'];
		if ($jobid == "") $jobid = $sql_po_row['JOB_ID'];
		else $jobid .= ',' . $sql_po_row['JOB_ID'];
	}

	$job_in_orders = implode(",", array_filter(array_unique(explode(",", rtrim($job_in_orders, ", ")))));
	$job_in_orders = substr(trim($job_in_orders), 0, -1);

	$job_ref = array_unique(explode(",", rtrim($job_in_ref, ", ")));
	$job_file = array_unique(explode(",", rtrim($job_in_file, ", ")));

	foreach ($job_ref as $ref) {
		$ref_cond .= ", " . $ref;
	}
	$file_con = '';
	foreach ($job_file as $file) {
		if ($file_con == '') $file_cond = $file;
		else $file_cond .= ", " . $file;
	}

	//Item Ratio Details
	$gmtsitemRatioSql = "select job_id AS JOB_ID, gmts_item_id AS GMTS_ITEM_ID, set_item_ratio AS SET_ITEM_RATIO from wo_po_details_mas_set_details where 1=1 and job_no =" . $txt_job_no . "";
	//echo $gmtsitemRatioSql; die;
	$gmtsitemRatioSqlRes = sql_select($gmtsitemRatioSql);
	$jobItemRatioArr = array();
	foreach ($gmtsitemRatioSqlRes as $row) {
		$jobItemRatioArr[$row['JOB_ID']][$row['GMTS_ITEM_ID']] = $row['SET_ITEM_RATIO'];
	}
	unset($gmtsitemRatioSqlRes);

	//Contrast Details
	$sqlContrast = "select a.job_id AS JOB_ID, a.pre_cost_fabric_cost_dtls_id as PRECOSTID, a.gmts_color_id as COLOR_NUMBER_ID, a.contrast_color_id AS CONTRAST_COLOR_ID from wo_pre_cos_fab_co_color_dtls a where 1=1 and a.status_active=1 and a.is_deleted=0 and job_no =" . $txt_job_no . "";
	//echo $sqlContrast; die;
	$sqlContrastRes = sql_select($sqlContrast);
	$sqlContrastArr = array();
	foreach ($sqlContrastRes as $row) {
		$sqlContrastArr[$row['JOB_ID']][$row['PRECOSTID']][$row['COLOR_NUMBER_ID']] = $row['CONTRAST_COLOR_ID'];
	}
	unset($sqlContrastRes);

	//Stripe Details
	$sqlStripe = "select a.job_id AS JOB_ID, a.pre_cost_fabric_cost_dtls_id as PRECOSTID, a.po_break_down_id as POID, a.item_number_id AS ITEM_NUMBER_ID, a.color_number_id as COLOR_NUMBER_ID, a.stripe_color as STRIPE_COLOR, a.size_number_id as SIZE_NUMBER_ID, a.fabreq as FABREQ, a.yarn_dyed as YARN_DYED from wo_pre_stripe_color a where 1=1 and a.status_active=1 and a.is_deleted=0 and a.job_no =" . $txt_job_no . "";
	//echo $sqlStripe; die;
	$sqlStripeRes = sql_select($sqlStripe);
	$sqlStripeArr = array();
	foreach ($sqlStripeRes as $row) {
		$sqlStripeArr[$row['JOB_ID']][$row['PRECOSTID']][$row['COLOR_NUMBER_ID']]['strip'][$row['STRIPE_COLOR']] = $row['STRIPE_COLOR'];
		$sqlStripeArr[$row['JOB_ID']][$row['PRECOSTID']][$row['COLOR_NUMBER_ID']]['fabreq'][$row['STRIPE_COLOR']] = $row['FABREQ'];
	}
	unset($sqlStripeRes);

	//Fabric Details
	$sqlfab = "select a.job_id AS JOB_ID, a.id AS ID, a.item_number_id AS ITEM_NUMBER_ID, a.fab_nature_id AS FAB_NATURE_ID, a.color_type_id AS COLOR_TYPE_ID, a.fabric_source as FABRIC_SOURCE, a.body_part_id as BODY_PART_ID, a.fabric_description as FABRIC_DESCRIPTION, a.color_size_sensitive AS COLOR_SIZE_SENSITIVE, a.construction AS CONSTRUCTION, a.gsm_weight AS GSM_WEIGHT, a.uom AS UOM, a.amount as AMOUNTAVG, b.po_break_down_id AS POID, b.color_number_id AS COLOR_NUMBER_ID, b.gmts_sizes AS SIZE_NUMBER_ID, b.cons AS CONS, b.requirment AS REQUIRMENT, b.rate as RATE, b.amount as AMOUNT
from wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b
where 1=1 and a.id=b.pre_cost_fabric_cost_dtls_id and b.cons!=0 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.job_no =" . $txt_job_no . "";
	//echo $sqlfab; die;
	$sqlfabRes = sql_select($sqlfab);
	$fabIdWiseGmtsDataArr = array();
	$summary_data = array();
	$fabwisedataarr = array();
	foreach ($sqlfabRes as $row) {
		$poQty = $planQty = $itemRatio = $finReqPlan = $greyReqPlan = $finReqOrder = $greyReqOrder = $finAmtPlan = $greyAmtPlan = $finAmtOrder = $greyAmtOrder = 0;

		$fabIdWiseGmtsDataArr[$row['ID']]['item'] = $row['ITEM_NUMBER_ID'];
		$fabIdWiseGmtsDataArr[$row['ID']]['fnature'] = $row['FAB_NATURE_ID'];
		$fabIdWiseGmtsDataArr[$row['ID']]['sensitive'] = $row['COLOR_SIZE_SENSITIVE'];
		$fabIdWiseGmtsDataArr[$row['ID']]['color_type'] = $row['COLOR_TYPE_ID'];
		$fabIdWiseGmtsDataArr[$row['ID']]['uom'] = $row['UOM'];
		$fabIdWiseGmtsDataArr[$row['ID']]['bodypart'] = $row['BODY_PART_ID'];
		$fabIdWiseGmtsDataArr[$row['ID']]['fabric'] = $row['FABRIC_DESCRIPTION'];

		$poQty = $po_arr[$row['POID']][$row['ITEM_NUMBER_ID']][$row['COLOR_NUMBER_ID']][$row['SIZE_NUMBER_ID']]['poqty'];
		$planQty = $po_arr[$row['POID']][$row['ITEM_NUMBER_ID']][$row['COLOR_NUMBER_ID']][$row['SIZE_NUMBER_ID']]['planqty'];

		$itemRatio = $jobItemRatioArr[$row['JOB_ID']][$row['ITEM_NUMBER_ID']];

		//Plan Qty Wise
		$finReqPlan = ($planQty / $itemRatio) * ($row['CONS'] / $costingPer);
		$greyReqPlan = ($planQty / $itemRatio) * ($row['REQUIRMENT'] / $costingPer);

		$finAmtPlan = $finReqPlan * $row['RATE'];
		$greyAmtPlan = $greyReqPlan * $row['RATE'];
		//Po Qty Wise
		$finReqOrder = ($poQty / $itemRatio) * ($row['CONS'] / $costingPer);
		$greyReqOrder = ($poQty / $itemRatio) * ($row['REQUIRMENT'] / $costingPer);

		$finAmtOrder = $finReqOrder * $row['RATE'];
		$greyAmtOrder = $greyReqOrder * $row['RATE'];

		$row["AMOUNT"] = ($planQty / $po_plun_cut_qty) * $row["AMOUNT"];

		//echo $poQty.'='.$itemRatio.'='.$row['CONS'].'='.$row['REQUIRMENT'].'='.$costingPer.'='.$finReqOrder.'='.$greyAmtOrder.'<br>';

		$summary_data[fabric_cost][$row["ID"]] = $row["AMOUNT"];
		$summary_data[fabric_cost_dzn_knit][$row["FAB_NATURE_ID"]] += $row["AMOUNT"];
		$summary_data[fabric_cost_dzn_wvn][$row["FAB_NATURE_ID"]] += $row["AMOUNT"];

		$summary_data[fabric_cost_job_knitpo][$row["FAB_NATURE_ID"]] += $greyAmtOrder;
		$summary_data[fabric_cost_job_wvnpo][$row["FAB_NATURE_ID"]] += $greyAmtOrder;

		$summary_data[fabric_cost_job_knitplan][$row["FAB_NATURE_ID"]] += $greyAmtPlan;
		$summary_data[fabric_cost_job_wvnplan][$row["FAB_NATURE_ID"]] += $greyAmtPlan;

		$fabwisedataarr[$row['ID']][finpoqty] += $finReqOrder;
		$fabwisedataarr[$row['ID']][finplanqty] += $finReqPlan;

		$fabwisedataarr[$row['ID']][greypoqty] += $greyReqOrder;
		$fabwisedataarr[$row['ID']][greyplanqty] += $greyReqPlan;

		$fabwisedataarr[$row['ID']][greypoamt] += $greyAmtOrder;
		$fabwisedataarr[$row['ID']][greyplanamt] += $greyAmtPlan;
	}
	unset($sqlfabRes);
	//print_r($summary_data[fabric_cost_dzn_knit][2]); die;

	//Yarn Details
	$sqlYarn = "select a.job_id AS JOB_ID, a.pre_cost_fabric_cost_dtls_id as PRECOSTID, a.po_break_down_id as POID, a.color_number_id as COLOR_NUMBER_ID, a.gmts_sizes as SIZE_NUMBER_ID, a.cons AS CONS, a.requirment AS REQUIRMENT, b.id AS YARN_ID, b.count_id AS COUNT_ID, b.copm_one_id AS COPM_ONE_ID, b.percent_one AS PERCENT_ONE, b.type_id AS TYPE_ID, b.color AS COLOR, b.cons_ratio AS CONS_RATIO, b.cons_qnty AS CONS_QNTY, b.avg_cons_qnty AS AVG_CONS_QNTY, b.rate AS RATE, b.amount AS AMOUNT 

from wo_pre_cos_fab_co_avg_con_dtls a, wo_pre_cost_fab_yarn_cost_dtls b where 1=1 and a.job_id=b.job_id and a.pre_cost_fabric_cost_dtls_id=b.fabric_cost_dtls_id and a.cons!=0 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and a.job_no =" . $txt_job_no . "";
	//echo $sqlYarn;
	$sqlYarnRes = sql_select($sqlYarn);
	$YarnData = array();
	foreach ($sqlYarnRes as $row) {
		$poQty = $planQty = $itemRatio = $consQnty = $yarnReqPlan = $yarnReqOrder = $yarnAmtPlan = $yarnAmtOrder = 0;

		$gmtsItem = $fabIdWiseGmtsDataArr[$row['PRECOSTID']]['item'];

		$poQty = $po_arr[$row['POID']][$gmtsItem][$row['COLOR_NUMBER_ID']][$row['SIZE_NUMBER_ID']]['poqty'];
		$planQty = $po_arr[$row['POID']][$gmtsItem][$row['COLOR_NUMBER_ID']][$row['SIZE_NUMBER_ID']]['planqty'];
		$itemRatio = $jobItemRatioArr[$row['JOB_ID']][$gmtsItem];

		$consQnty = ($row['REQUIRMENT'] * $row['CONS_RATIO']) / 100;

		$yarnReqPlan = ($planQty / $itemRatio) * ($consQnty / $costingPer);
		$yarnReqOrder = ($poQty / $itemRatio) * ($consQnty / $costingPer);

		$yarnAmtPlan = $yarnReqPlan * $row['RATE'];
		$yarnAmtOrder = $yarnReqOrder * $row['RATE'];

		$yarnrate = $row['RATE'];
		$summary_data[yarn_cost][$row["YARN_ID"]] = $row["AMOUNT"];
		$summary_data[yarn_cost_job_plan] += $yarnAmtPlan;
		$summary_data[yarn_cost_job_order] += $yarnAmtOrder;
		$summary_data[yarn_cost_dzn] += $row["AMOUNT"];
		$index = "'" . $row["COUNT_ID"] . "_" . $row["COPM_ONE_ID"] . "_" . $row["PERCENT_ONE"] . "_" . $row["TYPE_ID"] . "_" . $row["COLOR"] . "_" . $yarnrate . "'";
		$YarnData[$index]['qtyorder'] += $yarnReqOrder;
		$YarnData[$index]['qtyplan'] += $yarnReqPlan;

		$YarnData[$index]['amountplan'] += $yarnAmtPlan;
		$YarnData[$index]['amountorder'] += $yarnAmtOrder;

		$YarnData[$index]['dznqty'] += $row["CONS_QNTY"];
		$YarnData[$index]['dznamount'] += $row["AMOUNT"];
	}
	unset($sqlYarnRes);

	//Convaersion Details
	$sqlConv = "select a.job_id AS JOB_ID, a.pre_cost_fabric_cost_dtls_id AS PRECOSTID, a.po_break_down_id as POID, a.color_number_id as COLOR_NUMBER_ID, a.gmts_sizes as SIZE_NUMBER_ID, a.dia_width AS DIA_WIDTH, a.cons AS CONS, a.requirment AS REQUIRMENT, b.id AS CONVERTION_ID, b.cons_process AS CONS_PROCESS, b.req_qnty AS REQ_QNTY, b.process_loss AS PROCESS_LOSS, b.avg_req_qnty AS AVG_REQ_QNTY, b.charge_unit AS CHARGE_UNIT, b.amount as AMOUNT, b.color_break_down AS COLOR_BREAK_DOWN
from wo_pre_cos_fab_co_avg_con_dtls a, wo_pre_cost_fab_conv_cost_dtls b where 1=1 and a.pre_cost_fabric_cost_dtls_id=b.fabric_description and a.cons!=0 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and a.job_no =" . $txt_job_no . " ";
	//echo $sqlConv; die;
	$sqlConvRes = sql_select($sqlConv);
	$convConsRateArr = array();
	$ConvData = array();
	foreach ($sqlConvRes as $row) {
		$id = $row['CONVERTION_ID'];
		$colorBreakDown = $row['COLOR_BREAK_DOWN'];
		if ($colorBreakDown != "") {
			$arr_1 = explode("__", $colorBreakDown);
			for ($ci = 0; $ci < count($arr_1); $ci++) {
				$arr_2 = explode("_", $arr_1[$ci]);
				$convConsRateArr[$id][$arr_2[0]][$arr_2[3]]['rate'] = $arr_2[1];
				$convConsRateArr[$id][$arr_2[0]][$arr_2[3]]['cons'] = $arr_2[4];
			}
		}
	}
	//echo "ff"; die;
	foreach ($sqlConvRes as $row) {
		$poQty = $planQty = $itemRatio = $consQnty = $reqqntyplan = $reqqntyorder = $convAmtPlan = $convAmtOrder = 0;
		$gmtsItem = $fabIdWiseGmtsDataArr[$row['PRECOSTID']]['item'];
		$bodypartid = $fabIdWiseGmtsDataArr[$row['PRECOSTID']]['bodypart'];
		$colortypeid = $fabIdWiseGmtsDataArr[$row['PRECOSTID']]['color_type'];
		$fabric = $fabIdWiseGmtsDataArr[$row['PRECOSTID']]['fabric'];
		$fabuom = $fabIdWiseGmtsDataArr[$row['PRECOSTID']]['uom'];

		$poQty = $po_arr[$row['POID']][$gmtsItem][$row['COLOR_NUMBER_ID']][$row['SIZE_NUMBER_ID']]['poqty'];
		$planQty = $po_arr[$row['POID']][$gmtsItem][$row['COLOR_NUMBER_ID']][$row['SIZE_NUMBER_ID']]['planqty'];

		$itemRatio = $jobItemRatioArr[$row['JOB_ID']][$gmtsItem];

		$colorTypeId = $fabIdWiseGmtsDataArr[$row['PRECOSTID']]['color_type'];
		$colorSizeSensitive = $fabIdWiseGmtsDataArr[$row['PRECOSTID']]['sensitive'];
		$consProcessId = $row['CONS_PROCESS'];
		$stripe_color = $sqlStripeArr[$row['JOB_ID']][$row['PRECOSTID']][$row['COLOR_NUMBER_ID']]['strip'];

		$qntyPlan = $qntyOrder = $convAmtPlan = $convAmtOrder = 0;

		if (($colorTypeId == 2 || $colorTypeId == 3 || $colorTypeId == 4 || $colorTypeId == 6 || $colorTypeId == 31 || $colorTypeId == 32 || $colorTypeId == 33 || $colorTypeId == 34) && $consProcessId == 30 && count($stripe_color) > 0) {
			$convrate = $requirment = 0;
			foreach ($stripe_color as $stripe_color_id) {
				$stripe_color_cons_dzn = $convConsRateArr[$row['CONVERTION_ID']][$row['COLOR_NUMBER_ID']][$stripe_color_id]['cons'];
				$convrate = $convConsRateArr[$row['CONVERTION_ID']][$row['COLOR_NUMBER_ID']][$stripe_color_id]['rate'];

				$requirment = $stripe_color_cons_dzn - ($stripe_color_cons_dzn * $row['PROCESS_LOSS']) / 100;

				$qntyPlan = ($planQty / $itemRatio) * ($requirment / $costingPer);
				$qntyOrder = ($poQty / $itemRatio) * ($requirment / $costingPer);

				if ($convrate > 0) {
					$reqqntyplan += $qntyPlan;
					$convAmtPlan += $qntyPlan * $convrate;

					$reqqntyorder += $qntyOrder;
					$convAmtOrder += $qntyOrder * $convrate;
				}
			}
		} else {
			$convrate = $requirment = 0;
			$rateColorId = $row['COLOR_NUMBER_ID'];
			if ($colorSizeSensitive == 3) $rateColorId = $sqlContrastArr[$row['JOB_ID']][$row['PRECOSTID']][$row['COLOR_NUMBER_ID']];
			else $rateColorId = $row['COLOR_NUMBER_ID'];

			if ($row['COLOR_BREAK_DOWN'] != "") $convrate = $convConsRateArr[$row['CONVERTION_ID']][$row['COLOR_NUMBER_ID']][$rateColorId]['rate'];
			else $convrate = $row['CHARGE_UNIT'];

			if ($convrate > 0) {
				$requirment = $row['REQUIRMENT'] - ($row['REQUIRMENT'] * ($row['PROCESS_LOSS'] / 100));

				$qntyPlan = ($planQty / $itemRatio) * ($requirment / $costingPer);
				$qntyOrder = ($poQty / $itemRatio) * ($requirment / $costingPer);

				$reqqntyplan += $qntyPlan;
				$convAmtPlan += $qntyPlan * $convrate;

				$reqqntyorder += $qntyOrder;
				$convAmtOrder += $qntyOrder * $convrate;
			}
		}
		//echo $qntyPlan.'='.$qntyOrder.'='.$convAmtPlan.'='.$convAmtOrder.'<br>';
		//$convamount=array_sum($conv_amount_arr[$row['CONVERTION_ID']]);
		//$convQty=array_sum($conv_qty_arr[$row['CONVERTION_ID']]);
		$conv_data[cons_process][$row['CONVERTION_ID']] = $consProcessId;
		$conv_data[amountplan][$row['CONVERTION_ID']] = $row['AMOUNT'];
		$conv_data[amount_job_plan][$row['CONVERTION_ID']] += $convAmtPlan;
		$conv_data[amount_job_order][$row['CONVERTION_ID']] += $convAmtOrder;
		$summary_data[conver_cost_plan] += $convAmtPlan;
		$summary_data[conver_cost_order] += $convAmtOrder;
		$summary_data[conver_cost_dzn] += $row['AMOUNT'];

		$index = $row['CONVERTION_ID'];
		$ConvData[$consProcessId][$index]['item_descrition'] = $body_part[$bodypartid] . ", " . $color_type[$colortypeid] . ", " . $fabric;
		$ConvData[$consProcessId][$index]['cons_process'] = $consProcessId;
		$ConvData[$consProcessId][$index]['req_qnty'] = $row["REQ_QNTY"];
		$ConvData[$consProcessId][$index]['process_loss'] = $row["PROCESS_LOSS"];
		$ConvData[$consProcessId][$index]['avg_req_qnty'] = $row["AVG_REQ_QNTY"];

		$ConvData[$consProcessId][$index]['uom'] = $fabuom;
		$ConvData[$consProcessId][$index]['charge_unit'] = $row["CHARGE_UNIT"];
		$ConvData[$consProcessId][$index]['amount'] = $row['AMOUNT'];

		$ConvData[$consProcessId][$index]['tot_req_qnty_order'] += $reqqntyorder;
		$ConvData[$consProcessId][$index]['tot_req_qnty_plan'] += $reqqntyplan;
		$ConvData[$consProcessId][$index]['tot_amount_order'] += $convAmtOrder;
		$ConvData[$consProcessId][$index]['tot_amount_plan'] += $convAmtPlan;
		$totConv += $row["REQ_QNTY"];
	}
	unset($sqlConvRes);
	//print_r($ConvData[1][34602]['tot_req_qnty_order']); die;

	//Trims Details
	$sqlTrim = "select a.job_id AS JOB_ID, a.id AS TRIMID, a.trim_group AS TRIM_GROUP, a.description AS DESCRIPTION, a.cons_uom AS CONS_UOM, a.cons_dzn_gmts CONS_DZN_GMTS, a.rate AS RATEMST, a.amount AS AMOUNTAVG, b.po_break_down_id as POID, b.item_number_id as ITEM_NUMBER_ID, b.color_number_id as COLOR_NUMBER_ID, b.size_number_id as SIZE_NUMBER_ID, b.cons AS CONS, b.tot_cons AS TOT_CONS, b.rate AS RATE, b.country_id AS COUNTRY_ID_TRIMS, b.color_size_table_id as COLOR_SIZE_ID, b.amount AS AMOUNT
from wo_pre_cost_trim_cost_dtls a, wo_pre_cost_trim_co_cons_dtls b
where 1=1 and a.id=b.wo_pre_cost_trim_cost_dtls_id and b.cons>0 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and a.job_no =" . $txt_job_no . "";
	//echo $sqlTrim; die;
	$sqlTrimRes = sql_select($sqlTrim);
	$trimsreqdata = array();

	foreach ($sqlTrimRes as $row) {
		$poQty = $planQty = $itemRatio = $consQntyOrder = $consQntyPlan = $consAmtOrder = $consAmtPlan = 0;

		$itemRatio = $jobItemRatioArr[$row['JOB_ID']][$row['ITEM_NUMBER_ID']];

		$poCountryId = array_filter(array_unique(explode(",", $po_arr[$row['POID']][$row['ITEM_NUMBER_ID']][$row['COLOR_NUMBER_ID']][$row['SIZE_NUMBER_ID']]['county_id'])));
		//print_r($poCountryId);

		if ($row['COUNTRY_ID_TRIMS'] == "" || $row['COUNTRY_ID_TRIMS'] == 0) {
			$poQty = $po_arr[$row['POID']][$row['ITEM_NUMBER_ID']][$row['COLOR_NUMBER_ID']][$row['SIZE_NUMBER_ID']]['poqty'];
			$planQty = $po_arr[$row['POID']][$row['ITEM_NUMBER_ID']][$row['COLOR_NUMBER_ID']][$row['SIZE_NUMBER_ID']]['planqty'];

			$consQntyOrder = ($poQty / $itemRatio) * ($row['CONS'] / $costingPer);
			$consQntyPlan = ($planQty / $itemRatio) * ($row['CONS'] / $costingPer);
			//$consTotQnty=($poQty/$itemRatio)*($row['TOT_CONS']/$costingPer);

			$consAmtOrder = $consQntyOrder * $row['RATE'];
			$consAmtPlan = $consQntyPlan * $row['RATE'];
		} else {
			$countryIdArr = explode(",", $row['COUNTRY_ID_TRIMS']);
			$consQntyOrder = $consQntyPlan = $consAmtOrder = $consAmtPlan = 0;
			foreach ($poCountryId as $countryId) {
				if (in_array($countryId, $countryIdArr)) {
					$poQty = $poCountryArr[$row['POID']][$row['ITEM_NUMBER_ID']][$countryId][$row['COLOR_NUMBER_ID']][$row['SIZE_NUMBER_ID']]['poqty'];
					$planQty = $poCountryArr[$row['POID']][$row['ITEM_NUMBER_ID']][$countryId][$row['COLOR_NUMBER_ID']][$row['SIZE_NUMBER_ID']]['planqty'];
					$consQty = $consTotQty = 0;

					$consQntyOrder = ($poQty / $itemRatio) * ($row['CONS'] / $costingPer);
					$consQntyPlan = ($planQty / $itemRatio) * ($row['CONS'] / $costingPer);

					$consAmtOrder += $consQntyOrder * $row['RATE'];
					$consAmtPlan += $consQntyPlan * $row['RATE'];
				}
			}
		}
		$row["AMOUNT"] = ($planQty / $po_plun_cut_qty) * $row["AMOUNT"];
		//echo $planQty.'='.$itemRatio.'='.$row['REQUIRMENT'].'='.$costingPer.'='.$yarnReq.'='.$yarnAmt.'<br>';
		$summary_data[trims_cost_order] += $consAmtOrder;
		$summary_data[trims_cost_plan] += $consAmtPlan;
		$summary_data[trims_cost_dzn] += $row['AMOUNT'];

		$trimsreqdata[$row['TRIMID']]['reqorderqty'] += $consQntyOrder;
		$trimsreqdata[$row['TRIMID']]['reqplanqty'] += $consQntyPlan;

		$trimsreqdata[$row['TRIMID']]['reqorderamt'] += $consAmtOrder;
		$trimsreqdata[$row['TRIMID']]['reqplanamt'] += $consAmtPlan;
	}
	unset($sqlTrimRes);
	//print_r($reqQtyAmtArr); die;


	$sqlEmb = "select a.job_id AS JOB_ID, a.id AS EMB_ID, a.emb_name AS EMB_NAME, a.emb_type AS EMB_TYPE, a.cons_dzn_gmts AS CONS_DZN_GMTS_MST, a.rate AS RATE_MST, a.amount AS AMOUNT_MST, a.budget_on AS BUDGET_ON, b.po_break_down_id as POID, b.item_number_id as ITEM_NUMBER_ID, b.color_number_id as COLOR_NUMBER_ID, b.size_number_id as SIZE_NUMBER_ID, b.requirment AS CONS_DZN_GMTS, b.rate AS RATE, b.amount AS AMOUNT, b.country_id AS COUNTRY_ID_EMB 
from wo_pre_cost_embe_cost_dtls a, wo_pre_cos_emb_co_avg_con_dtls b 
where 1=1 and a.cons_dzn_gmts>0 and
a.job_id=b.job_id and a.id=b.pre_cost_emb_cost_dtls_id and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and a.job_no =" . $txt_job_no . "";
	//echo $sqlEmb; die;
	$sqlEmbRes = sql_select($sqlEmb);
	$embdataarr = array();

	foreach ($sqlEmbRes as $row) {
		$poQty = $planQty = $itemRatio = $consQntyOrder = $consQntyPlan = $consAmtOrder = $consAmtPlan = 0;

		$itemRatio = $jobItemRatioArr[$row['JOB_ID']][$row['ITEM_NUMBER_ID']];
		$budget_on = $row['BUDGET_ON'];

		$poCountryId = array_filter(array_unique(explode(",", $po_arr[$row['POID']][$row['ITEM_NUMBER_ID']][$row['COLOR_NUMBER_ID']][$row['SIZE_NUMBER_ID']]['county_id'])));
		//print_r($poCountryId);
		$calPoPlanQty = 0;

		if ($row['COUNTRY_ID_EMB'] == "" || $row['COUNTRY_ID_EMB'] == 0) {
			$poQty = $po_arr[$row['POID']][$row['ITEM_NUMBER_ID']][$row['COLOR_NUMBER_ID']][$row['SIZE_NUMBER_ID']]['poqty'];
			$planQty = $po_arr[$row['POID']][$row['ITEM_NUMBER_ID']][$row['COLOR_NUMBER_ID']][$row['SIZE_NUMBER_ID']]['planqty'];

			//if($budget_on==1) $calPoPlanQty=$poQty; else $calPoPlanQty=$planQty;
			$consQtyPlan = $consQtyOrder = 0;
			$consQtyPlan = ($planQty / $itemRatio) * ($row['CONS_DZN_GMTS'] / $costingPer);
			$consQtyOrder = ($poQty / $itemRatio) * ($row['CONS_DZN_GMTS'] / $costingPer);

			$consQntyPlan += $consQtyPlan;

			$consAmtOrder = $consQtyOrder * $row['RATE'];
			$consAmtPlan = $consQtyPlan * $row['RATE'];
		} else {
			$countryIdArr = explode(",", $row['COUNTRY_ID_EMB']);

			foreach ($poCountryId as $countryId) {
				if (in_array($countryId, $countryIdArr)) {
					$poQty = $poCountryArr[$row['POID']][$row['ITEM_NUMBER_ID']][$countryId][$row['COLOR_NUMBER_ID']][$row['SIZE_NUMBER_ID']]['poqty'];
					$planQty = $poCountryArr[$row['POID']][$row['ITEM_NUMBER_ID']][$countryId][$row['COLOR_NUMBER_ID']][$row['SIZE_NUMBER_ID']]['planqty'];

					//if($budget_on==1) $calPoPlanQty=$poQty; else $calPoPlanQty=$planQty;
					$consQtyPlan = $consQtyOrder = 0;
					$consQtyOrder = ($poQty / $itemRatio) * ($row['CONS_DZN_GMTS'] / $costingPer);
					$consQtyPlan = ($planQty / $itemRatio) * ($row['CONS_DZN_GMTS'] / $costingPer);
					//echo $poQty.'-'.$itemRatio.'-'.$row['CONS_DZN_GMTS'].'-'.$costingPer.'<br>';
					$consAmtOrder += $consQtyOrder * $row['RATE'];
					$consAmtPlan += $consQtyPlan * $row['RATE'];
				}
			}
		}

		$row["AMOUNT"] = ($planQty / $po_plun_cut_qty) * $row["AMOUNT"];
		if ($row['EMB_NAME'] != 3) {
			$summary_data[emb_cost_order] += $consAmtOrder;
			$summary_data[emb_cost_plan] += $consAmtPlan;
			$summary_data[emb_cost_dzn] += $row["AMOUNT"];

			$embdataarr[$row["EMB_ID"]]['emborderqty'] += $consQtyOrder;
			$embdataarr[$row["EMB_ID"]]['embplanqty'] += $consQtyPlan;
			$embdataarr[$row["EMB_ID"]]['emborderamt'] += $consAmtOrder;
			$embdataarr[$row["EMB_ID"]]['embplanamt'] += $consAmtPlan;
		} else {
			$summary_data[wash_cost_order] += $consAmtOrder;
			$summary_data[wash_cost_plan] += $consAmtPlan;
			$summary_data[wash_cost_dzn] += $row["AMOUNT"];

			$embdataarr[$row["EMB_ID"]]['washorderqty'] += $consQtyOrder;
			$embdataarr[$row["EMB_ID"]]['washplanqty'] += $consQtyPlan;
			$embdataarr[$row["EMB_ID"]]['washorderamt'] += $consAmtOrder;
			$embdataarr[$row["EMB_ID"]]['washplanamt'] += $consAmtPlan;
		}
		//echo $planQty.'='.$itemRatio.'='.$row['REQUIRMENT'].'='.$costingPer.'='.$yarnReq.'='.$yarnAmt.'<br>';
	}
	unset($sqlEmbRes);
	//echo "<pre>";
	//print_r($reqQtyAmtArr); die;


	$fab_knit_req_kg_avg = 0;
	$fab_woven_req_yds_avg = 0;

	$sql = "select a.job_no, b.id, a.company_name, a.buyer_name, a.style_ref_no, a.gmts_item_id, a.order_uom, a.job_quantity, a.avg_unit_price, b.costing_per, b.budget_minute, b.approved, b.sew_smv, b.exchange_rate, b.sew_effi_percent, c.fab_knit_req_kg, c.fab_knit_fin_req_kg, c.fab_woven_req_yds, c.fab_woven_fin_req_yds, c.fab_yarn_req_kg, b.remarks from wo_po_details_master a, wo_pre_cost_mst b left join wo_pre_cost_sum_dtls c on b.job_no=c.job_no where a.job_no=b.job_no and a.status_active=1 $job_no $company_name $cbo_buyer_name order by a.job_no";
	$data_array = sql_select($sql);

	ob_start();
	$uom = 0;
	$sew_effi_percent = 0;
	$sew_smv = 0;
	$exchange_rate = 0;
	$remarks = "";
	$mst_id = 0;
	$jobpoqty = 0;
	foreach ($data_array as $row) {
		$order_price_per_dzn = 0;
		$order_job_qnty = 0;
		$avg_unit_price = 0;
		$sew_effi_percent = $row[csf("sew_effi_percent")];
		$sew_smv = $row[csf("sew_smv")];
		$exchange_rate = $row[csf("exchange_rate")];
		$remarks = $row[csf("remarks")];
		$mst_id = $row[csf("id")];

		$order_values = $row[csf("job_quantity")] * $row[csf("avg_unit_price")];

		$img_path = (str_replace("'", "", $path)) ? str_replace("'", "", $path) : '../';
?>
<table style="width:850px">
	<tr>
		<td colspan="6" align="center">
			<?
			$image_location = return_field_value("image_location", "common_photo_library", "file_type=1 and form_name='company_details' and master_tble_id=$cbo_company_name", "image_location");
			?>
			<img src='<?= $img_path ?><?= $image_location; ?>' height='70' align="left" />
			<b style="font-size:25px;"><?= $comp[str_replace("'", "", $cbo_company_name)]; ?></b><br>
			<b style="font-size:14px;">Budget</b>
		</td>
	</tr>
</table>

<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px" rules="all">
	<tr>
		<td width="130">Job Number</td>
		<td width="130"><b><?= $row[csf("job_no")]; ?></b></td>
		<td width="130">Buyer</td>
		<td width="130" style="word-break:break-all"><b><?= $buyer_arr[$row[csf("buyer_name")]]; ?></b></td>
		<td width="130">Garments Item</td>
		<?
		$grmnt_items = "";
		$gmtsArr = array();
		if ($garments_item[$row[csf("gmts_item_id")]] == "") {
			$grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no=$txt_job_no");
			foreach ($grmts_sql as $key => $val) {
				$grmnt_items .= $garments_item[$val[csf("gmts_item_id")]] . ", ";
				$gmtsArr[$val[csf("gmts_item_id")]] = $val[csf("gmts_item_id")];
				//echo $val[csf("gmts_item_id")]."<br>";
			}
			$grmnt_items = substr_replace($grmnt_items, "", -1, 1);
		} else {
			$grmnt_items = $garments_item[$row[csf("gmts_item_id")]];
			$gmtsArr[$row[csf("gmts_item_id")]] = $row[csf("gmts_item_id")];
		}
		?>
		<td style="word-break:break-all"><b><?= $grmnt_items; ?></b></td>
	</tr>
	<tr>
		<td>Style Ref. No </td>
		<td style="word-break:break-all"><b><?= $row[csf("style_ref_no")]; ?></b></td>
		<td>Job Qnty Set </td>
		<td><b><?= number_format($row[csf("job_quantity")], 0);
				$jobpoqty = $row[csf("job_quantity")]; ?></b></td>
		<td>Job Qnty Pcs</td>
		<td><b><? $uom = $row[csf("order_uom")];
				echo number_format($row[csf("job_quantity")] * $total_set_qnty, 0); ?></b></td>
	</tr>
	<tr>
		<td>Order Numbers</td>
		<td><?= $job_in_orders; ?></td>
		<td>Plan Cut Qnty Set</td>
		<td><b><? $plunCutQty = array_sum($po_plun_cut_qty_arr);
				echo number_format($plunCutQty, 0); ?></b></td>
		<td>Plan Cut Qnty Pcs</td>
		<td><b><? $uom = $row[csf("order_uom")];
				echo number_format($plunCutQty * $total_set_qnty, 0); ?></b></td>
	</tr>
	<tr>
		<td>Knit Fabric Cons</td>
		<td><b><?= $row[csf("fab_knit_req_kg")];
				$fab_knit_req_kg_avg += $row[csf("fab_knit_req_kg")]; ?> (Kg)</b></td>
		<td>Woven Fabric Cons</td>
		<td><b><?= $row[csf("fab_woven_req_yds")];
				$fab_woven_req_yds_avg += $row[csf("fab_woven_req_yds")]; ?> (Yds)</b></td>
		<td>Price Per Unit</td>
		<td><b><?= $row[csf("avg_unit_price")]; ?> USD</b></td>
	</tr>
	<tr>
		<td>Avg Yarn Req</td>
		<td><b><?= $row[csf("fab_yarn_req_kg")] ?> (Kg)</b></td>
		<td>Costing Per</td>
		<td><b><?= $costing_per[$row[csf("costing_per")]]; ?></b></td>
		<td>Shipment Date </td>
		<td style="word-break:break-all"><b><?= change_date_format($pulich_ship_date); ?></b></td>
	</tr>
	<tr>
		<td>Knit Fin Fabric Cons</td>
		<td><b><?= $row[csf("fab_knit_fin_req_kg")] ?> (Kg)</b></td>
		<td>Woven Fin Fabric Cons</td>
		<td><b><?= $row[csf("fab_woven_fin_req_yds")]; ?>(Yds)</b></td>
		<td>GSM </td>
		<td><b><? //echo $gsm_weight_top.",".$gsm_weight_bottom
				$gsm_weights_top = implode(",", array_unique(explode(",", $gsm_weight_top)));
				$gsm_weight_bottom = implode(",", array_unique(explode(",", $gsm_weight_bottom)));
				if ($gsm_weights_top != '') $gsm_weightTop = $gsm_weights_top;
				else $gsm_weightTop = '';
				if ($gsm_weight_bottom != '' && $gsm_weights_top != '') $gsm_weightBottom = " ," . $gsm_weight_bottom;
				else if ($gsm_weight_bottom != '' && $gsm_weights_top == '') $gsm_weightBottom = $gsm_weight_bottom;
				else $gsm_weightBottom = '';
				echo $gsm_weightTop . $gsm_weightBottom;
				?></b>
		</td>
	</tr>
	<tr>
		<td>SMV</td>
		<td><b><?= number_format($row[csf("sew_smv")], 2); ?> </b></td>
		<td>CPM</td>
		<td><b><?= $cpm; ?> </b></td>
		<td>Budget Minute</td>
		<td><b><?= $row[csf("budget_minute")] ?> </b></td>
	</tr>
	<tr>
		<td>Efficiency</td>
		<td><b><?= $row[csf("sew_effi_percent")] ?> </b></td>
		<td>Gmts Item Set Qty</td>
		<td><b><?= count($gmtsArr); ?> </b></td>
		<? $amount = $row[csf("job_quantity")] * $row[csf("avg_unit_price")]; ?>
		<td>Amount</td>
		<td><b><?= fn_number_format($amount, 4); ?></b></td>
	</tr>
	<tr>
		<td align="center" height="10" colspan="6" valign="top" id="app_sms" style="font-size:18px;">
			<font color="#FF0000"><?
									$ap_msg = "";
									if ($row[csf("approved")] == 1) {
										$ap_msg = "This Job Is Full Approved.";
									} else if ($row[csf("approved")] == 3) {
										$approval_allow = sql_select("select b.id, b.page_id, b.approval_need, b.allow_partial, b.validate_page,a.setup_date from approval_setup_mst a,approval_setup_dtls b where a.id=b.mst_id and a.company_id='$company_id' and a.status_active=1 and b.page_id=25 and b.status_active=1 and b.is_deleted=0 order by b.id desc ");
										if ($approval_allow[0][csf("approval_need")] == 1 && $approval_allow[0][csf("allow_partial")] == 1) {
											$ap_msg = "This Job Is Approved.";
										} else {
											$ap_msg = "This Job Partially Approved.";
										}
									} else {
										$ap_msg = " ";
									}
									echo $ap_msg;
									?> </font>
		</td>
	</tr>
</table>
<?
		$order_job_qnty = $row[csf("job_quantity")];
		$avg_unit_price = $row[csf("avg_unit_price")];
	} //end first foearch

	$lib_designation_arr = return_library_array(" select id,custom_designation from lib_designation", "id", "custom_designation");
	$user_lib_designation_arr = return_library_array("SELECT id,designation from user_passwd", "id", "designation");
	$user_lib_name_arr = return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
	// $mst_id=return_field_value("id as mst_id","wo_pre_cost_mst","id=$mst_id","mst_id");

	$approve_data_array = sql_select("select b.approved_by,min(b.approved_date) as approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=15  group by  b.approved_by order by b.approved_by asc");
	$unapprove_data_array = sql_select("select b.approved_by,b.approved_date,b.un_approved_reason,b.un_approved_date,b.approved_no from   approval_history b where b.mst_id=$mst_id and b.entry_form=15  order by b.approved_date,b.approved_by");

	if (count($approve_data_array) > 0) {
?>
<table width="850" class="rpt_table" border="1" cellpadding="0" cellspacing="0" rules="all">
	<thead>
		<tr style="border:1px solid black;">
			<th colspan="5" style="border:1px solid black;">Approval Status</th>
		</tr>
		<tr style="border:1px solid black;">
			<th width="3%" style="border:1px solid black;">Sl</th>
			<th width="40%" style="border:1px solid black;">Name</th>
			<th width="30%" style="border:1px solid black;">Designation</th>
			<th width="27%" style="border:1px solid black;">Approval Date</th>
		</tr>
	</thead>
	<tbody>
		<?
		$i = 1;
		foreach ($approve_data_array as $row) {
		?>
			<tr style="border:1px solid black;">
				<td width="3%" style="border:1px solid black;"><?= $i; ?></td>
				<td width="40%" style="border:1px solid black;text-align:center"><?= $user_lib_name_arr[$row[csf('approved_by')]]; ?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><?= $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]]; ?></td>
				<td width="27%" style="border:1px solid black;text-align:center"><?= date("d-m-Y h:i:s", strtotime($row[csf('approved_date')])); ?></td>
			</tr>
		<?
			$i++;
		}
		?>
	</tbody>
</table>
<?
	}
?>
<br />
<?
	$sql_unapproved = sql_select("select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=15 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id=$mst_id");
	//	echo  "select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=15 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id=$mst_id";
	$unapproved_request_arr = array();
	foreach ($sql_unapproved as $rowu) {
		$unapproved_request_arr[$rowu[csf('booking_id')]] = $rowu[csf('approval_cause')];
	}

	if (count($unapprove_data_array) > 0) {
?>
<table width="850" class="rpt_table" border="1" cellpadding="0" cellspacing="0" rules="all">
	<thead>
		<tr style="border:1px solid black;">
			<th colspan="6" style="border:1px solid black;">Approval/Un Approval History</th>
		</tr>
		<tr style="border:1px solid black;">
			<th width="3%" style="border:1px solid black;">Sl</th>
			<th width="30%" style="border:1px solid black;">Name</th>
			<th width="20%" style="border:1px solid black;">Designation</th>
			<th width="5%" style="border:1px solid black;">Approval Status</th>
			<th width="20%" style="border:1px solid black;">Reason For Un Approval</th>
			<th width="22%" style="border:1px solid black;"> Date</th>
		</tr>
	</thead>
	<tbody>
		<?
		$i = 1;
		foreach ($unapprove_data_array as $row) {
		?>
			<tr style="border:1px solid black;">
				<td width="3%" style="border:1px solid black;"><? echo $i; ?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]]; ?></td>
				<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]]; ?></td>
				<td width="5%" style="border:1px solid black; text-align:center"><? echo 'Yes'; ?></td>
				<td width="20%" style="border:1px solid black;"><? echo ''; ?></td>
				<td width="22%" style="border:1px solid black;text-align:center"><? if ($row[csf('approved_date')] != "") echo date("d-m-Y h:i:s", strtotime($row[csf('approved_date')]));
																					else echo ""; ?></td>
			</tr>
			<?
			$i++;
			$un_approved_date = explode(" ", $row[csf('un_approved_date')]);
			$un_approved_date = $un_approved_date[0];
			if ($db_type == 0) //Mysql
			{
				if ($un_approved_date == "" || $un_approved_date == "0000-00-00") $un_approved_date = "";
				else $un_approved_date = $un_approved_date;
			} else {
				if ($un_approved_date == "") $un_approved_date = "";
				else $un_approved_date = $un_approved_date;
			}
			if ($un_approved_date != "") {
			?>
				<tr style="border:1px solid black;">
					<td width="3%" style="border:1px solid black;"><?= $i; ?></td>
					<td width="30%" style="border:1px solid black;text-align:center"><?= $user_lib_name_arr[$row[csf('approved_by')]]; ?></td>
					<td width="20%" style="border:1px solid black;text-align:center"><?= $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]]; ?></td>
					<td width="5%" style="border:1px solid black;text-align:center;"><?= 'No'; ?></td>
					<td width="20%" style="border:1px solid black;text-align:center"><?= $row[csf('un_approved_reason')]; //$unapproved_request_arr[$mst_id];
																						?></td>
					<td width="22%" style="border:1px solid black;text-align:center"><? if ($row[csf('un_approved_date')] != "") echo date("d-m-Y h:i:s", strtotime($row[csf('un_approved_date')]));
																						else echo ""; ?></td>
				</tr>
		<?
				$i++;
			}
		}
		?>
	</tbody>
</table>
<?
	}
?>
<br>
<?

	$sql_new = "select job_no, fabric_cost, fabric_cost_percent, trims_cost, trims_cost_percent, embel_cost, embel_cost_percent, wash_cost, wash_cost_percent, comm_cost, comm_cost_percent, commission, commission_percent, lab_test, lab_test_percent, inspection, inspection_percent, cm_cost, cm_cost_percent, freight, freight_percent, currier_pre_cost, currier_percent, certificate_pre_cost, certificate_percent, common_oh, common_oh_percent, depr_amor_pre_cost, total_cost, total_cost_percent, price_dzn, price_dzn_percent, margin_dzn, margin_dzn_percent, price_pcs_or_set, price_pcs_or_set_percent, margin_pcs_set, margin_pcs_set_percent, cm_for_sipment_sche, design_cost, design_percent, studio_cost, studio_percent, incentives_pre_cost, incentives_pre_cost_per, incentives_pre_rate, incentives_pre_cost, deffdlc_cost, interest_cost, incometax_cost, margin_pcs_bom from wo_pre_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array_new = sql_select($sql_new);

	foreach ($data_array_new as $row_new) {
		$summary_data[price_dzn] = $row_new[csf("price_dzn")];
		$summary_data[price_dzn_job] = $total_fob_value; //($po_qty/($total_set_qnty*$order_price_per_dzn))*$row_new[csf("price_dzn")];

		$summary_data[lab_test_dzn] = $row_new[csf("lab_test")];
		$summary_data[lab_test_order] = ($row_new[csf("lab_test")] / 12) * $po_qty;
		$summary_data[lab_test_plan] = ($row_new[csf("lab_test")] / 12) * $po_plun_cut_qty;

		$summary_data[inspection_dzn] = $row_new[csf("incentives_pre_cost")];
		$summary_data[inspection_order] = ($row_new[csf("incentives_pre_cost")] / 12) * $po_qty;
		$summary_data[inspection_plan] = ($row_new[csf("incentives_pre_cost")] / 12) * $po_plun_cut_qty;

		$summary_data[cm_cost_dzn] = $row_new[csf("cm_cost")];
		$summary_data[cm_cost_order] = ($row_new[csf("cm_cost")] / 12) * $po_qty;
		$summary_data[cm_cost_plan] = ($row_new[csf("cm_cost")] / 12) * $po_plun_cut_qty;

		$summary_data[freight_dzn] = $row_new[csf("freight")];
		$summary_data[freight_order] = ($row_new[csf("freight")] / 12) * $po_qty;
		$summary_data[freight_plan] = ($row_new[csf("freight")] / 12) * $po_plun_cut_qty;

		$summary_data[currier_dzn] = $row_new[csf("currier_pre_cost")];
		$summary_data[currier_order] = ($row_new[csf("currier_pre_cost")] / 12) * $po_qty;
		$summary_data[currier_plan] = ($row_new[csf("currier_pre_cost")] / 12) * $po_plun_cut_qty;

		$summary_data[certificate_dzn] = $row_new[csf("certificate_pre_cost")];
		$summary_data[certificate_order] = ($row_new[csf("certificate_pre_cost")] / 12) * $po_qty;
		$summary_data[certificate_plan] = ($row_new[csf("certificate_pre_cost")] / 12) * $po_plun_cut_qty;

		$summary_data[design_dzn] = $row_new[csf("design_cost")];
		$summary_data[design_order] = ($row_new[csf("design_cost")] / 12) * $po_qty;
		$summary_data[design_plan] = ($row_new[csf("design_cost")] / 12) * $po_plun_cut_qty;

		$summary_data[studio_dzn] = $row_new[csf("studio_cost")];
		$summary_data[studio_order] = ($row_new[csf("studio_cost")] / 12) * $po_qty;
		$summary_data[studio_plan] = ($row_new[csf("studio_cost")] / 12) * $po_plun_cut_qty;

		$summary_data[incentives_dzn] = $row_new[csf("incentives_pre_cost")];
		$summary_data[incentives_order] = ($row_new[csf("incentives_pre_cost")] / 12) * $po_qty;
		$summary_data[incentives_plan] = ($row_new[csf("incentives_pre_cost")] / 12) * $po_plun_cut_qty;

		$summary_data[depr_amor_dzn] = $row_new[csf("depr_amor_pre_cost")];
		$summary_data[depr_amor_order] = ($row_new[csf("depr_amor_pre_cost")] / 12) * $po_qty;
		$summary_data[depr_amor_plan] = ($row_new[csf("depr_amor_pre_cost")] / 12) * $po_plun_cut_qty;

		$summary_data[common_oh_dzn] = $row_new[csf("common_oh")];
		$summary_data[common_oh_order] = ($row_new[csf("common_oh")] / 12) * $po_qty;
		$summary_data[common_oh_plan] = ($row_new[csf("common_oh")] / 12) * $po_plun_cut_qty;

		$summary_data[deffdlc_dzn] = $row_new[csf("deffdlc_cost")];
		$summary_data[deffdlc_order] = ($row_new[csf("deffdlc_cost")] / 12) * $po_qty;
		$summary_data[deffdlc_plan] = ($row_new[csf("deffdlc_cost")] / 12) * $po_plun_cut_qty;

		$summary_data[interest_dzn] = $row_new[csf("interest_cost")];
		$summary_data[interest_order] = ($row_new[csf("interest_cost")] / 12) * $po_qty;
		$summary_data[interest_plan] = ($row_new[csf("interest_cost")] / 12) * $po_plun_cut_qty;

		$summary_data[incometax_dzn] = $row_new[csf("incometax_cost")];
		$summary_data[incometax_order] = ($row_new[csf("incometax_cost")] / 12) * $po_qty;
		$summary_data[incometax_plan] = ($row_new[csf("incometax_cost")] / 12) * $po_plun_cut_qty;

		$trims_cost += $row_new[csf("trims_cost")];
		$embel_cost += $row_new[csf("embel_cost")];
		$wash_cost += $row_new[csf("wash_cost")];
	}

	//Commision cost Cost part report here -------------------------------------------
	$sqlcomm = "select id, job_no, particulars_id, commission_base_id, commision_rate, commission_amount from wo_pre_cost_commiss_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$sqlcommarr = sql_select($sqlcomm);
	$totCommi = 0;
	$CommiData = array();
	foreach ($sqlcommarr as $commrow) {
		$summary_data[commission_dzn] += $commrow[csf("commission_amount")];
		$summary_data[commission_order] += ($commrow[csf("commission_amount")] / 12) * $po_qty;
		$summary_data[commission_plan] += ($commrow[csf("commission_amount")] / 12) * $po_plun_cut_qty;
		$CommiData[$commrow[csf("id")]]['commission_amount'] = ($commrow[csf("commission_amount")] / 12) * $po_qty;
		$totCommi += $commrow[csf("commission_amount")];
	}
	unset($sqlcommarr);
	//print_r($summary_data);
	//End Commision cost Cost part report here -------------------------------------------
	//Commarcial cost Cost part report here -------------------------------------------
	$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls  where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	//$commarcial_amount=$commercial->getAmountArray_by_jobAndPrecostdtlsid();

	$totCommar = 0;
	$CommarData = array();
	foreach ($data_array as $row) {
		$summary_data[comm_cost_dzn] += $row[csf("amount")];
		$commlreqamtorder = ($row[csf("amount")] / 12) * $po_qty;
		$commlreqamtplan = ($row[csf("amount")] / 12) * $po_plun_cut_qty;
		$summary_data[comm_cost_order] += $commlreqamtorder;
		$summary_data[comm_cost_plan] += $commlreqamtplan;
		$CommarData[$row[csf("id")]]['amount'] += $commlreqamtorder;
		$comm_cost += $row[csf("amount")];
	}

	$comm_cost = sql_select("SELECT sum(rate) as rate from wo_pre_cost_comarci_cost_dtls where job_no =" . $txt_job_no . " and status_active=1 and is_deleted=0");
	foreach ($comm_cost as $row) {
		$commercial_rate = $row[csf('rate')];
	}
	$commercial_rate_per = $commercial_rate / 100;
?>
<div style="margin-top:15px">
<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;" rules="all">
	<tr style="font-weight:bold">
		<td align="center" width="850" colspan="5">Order Profitability </td>
	</tr>
	<tr style="font-weight:bold">
		<td align="center" width="80">SL</td>
		<td width="400">Particulars</td>
		<td width="120">Amount [USD]/<?= $costing_for; ?></td>
		<td width="120">Amount On Order Qty</td>
		<td>% On Order Amount</td>
	</tr>
	<tr>
		<td align="center">1</td>
		<td style="font-weight:bold">Order Value</td>
		<td align="right" style="font-weight:bold"><?= fn_number_format($summary_data[price_dzn], 4); ?></td>
		<td align="right" style="font-weight:bold"><?= fn_number_format($summary_data[price_dzn_job], 4); ?></td>
		<td align="right" style="font-weight:bold"><?= fn_number_format(($summary_data[price_dzn_job] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center" rowspan="7">2</td>
		<td>Knit Fabric Cost [Purchase]</td>
		<td align="right" style="font-weight:bold"><?= fn_number_format($summary_data[fabric_cost_dzn_knit][2], 4); ?></td>
		<td align="right" style="font-weight:bold"><?= fn_number_format($summary_data[fabric_cost_job_knitpo][2], 4); ?></td>
		<td align="right" style="font-weight:bold"><?= fn_number_format(($summary_data[fabric_cost_job_knitpo][2] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td>Woven Fabric Cost</td>
		<td align="right" style="font-weight:bold"><?= fn_number_format($summary_data[fabric_cost_dzn_wvn][3], 4); ?></td>
		<td align="right" style="font-weight:bold"><?= fn_number_format($summary_data[fabric_cost_job_wvnpo][3], 4); ?></td>
		<td align="right" style="font-weight:bold"><?= fn_number_format(($summary_data[fabric_cost_job_wvnpo][3] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td>Yarn Cost</td>
		<td align="right" style="font-weight:bold"><?= fn_number_format(array_sum($summary_data[yarn_cost]), 4); ?></td>
		<td align="right" style="font-weight:bold"><?= fn_number_format($summary_data[yarn_cost_job_order], 4); ?></td>
		<td align="right" style="font-weight:bold"><?= fn_number_format(($summary_data[yarn_cost_job_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td>Conversion Cost</td>
		<td align="right" style="font-weight:bold"><?= fn_number_format(array_sum($conv_data[amountplan]), 4); ?></td>
		<td align="right" style="font-weight:bold"><?= fn_number_format($summary_data[conver_cost_order], 4); ?></td>
		<td align="right" style="font-weight:bold"><?= fn_number_format(($summary_data[conver_cost_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<?
	$fabric_cost_ord_dzn = $summary_data[fabric_cost_dzn_knit][2] + $summary_data[fabric_cost_dzn_wvn][3] + array_sum($summary_data[yarn_cost]) + array_sum($conv_data[amountplan]);
	$fabric_cost_order = $summary_data[fabric_cost_job_knitpo][2] + $summary_data[fabric_cost_job_wvnpo][3] + $summary_data[yarn_cost_job_order] + $summary_data[conver_cost_order];
	$fabric_cost_plan = $summary_data[fabric_cost_job_knitplan][2] + $summary_data[fabric_cost_job_wvnplan][3] + $summary_data[yarn_cost_job_plan] + $summary_data[conver_cost_plan];

	$excessFabamt = $fabric_cost_plan - $fabric_cost_order;

	$fabricplandzn = ($excessFabamt / $jobpoqty) * 12;

	$fabriccostdzn = $fabric_cost_ord_dzn + $fabricplandzn;
	$fabriccostjob = $fabric_cost_order + $excessFabamt;
	?>
	<tr>
		<td>&nbsp;</td>
		<td align="right" style="font-weight:bold"><?= fn_number_format($fabric_cost_ord_dzn, 4); ?></td>
		<td align="right" style="font-weight:bold"><?= fn_number_format($fabric_cost_order, 4); ?></td>
		<td align="right">&nbsp;</td>
	</tr>
	<tr>
		<td>Plan Cut% Cost</td>
		<td align="right" style="font-weight:bold"><?= fn_number_format($fabricplandzn, 4); ?></td>
		<td align="right" style="font-weight:bold"><?= fn_number_format($excessFabamt, 4); ?></td>
		<td align="right" style="font-weight:bold"><?= fn_number_format(($excessFabamt / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td style="font-weight:bold">All Fabric Cost</td>
		<td align="right" style="font-weight:bold"><?= fn_number_format($fabriccostdzn, 4); ?></td>
		<td align="right" style="font-weight:bold"><?= fn_number_format($fabriccostjob, 4); ?></td>
		<td align="right" style="font-weight:bold"><?= fn_number_format(($fabriccostjob / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<td align="center">3</td>
	<td style="font-weight:bold"><b>Trim Cost </b></td>
	<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[trims_cost_dzn], 4) ?></td>
	<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[trims_cost_order], 4) ?></td>
	<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[trims_cost_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<td align="center" rowspan="2">4</td>
	<td style="font-weight:bold"><b>Embellishment Cost</b></td>
	<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[emb_cost_dzn], 4) ?></td>
	<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[emb_cost_order], 4) ?></td>
	<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[emb_cost_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<?
	$embcostplan = $summary_data[emb_cost_plan] - $summary_data[emb_cost_order];
	$embplandzn = ($embcostplan / $jobpoqty) * 12;
	?>
	<tr>
		<td>Plan Cut% Cost</td>
		<td align="right" style="font-weight:bold"><?= fn_number_format($embplandzn, 4); ?></td>
		<td align="right" style="font-weight:bold" title="<?= $summary_data[emb_cost_plan] . '-' . $summary_data[emb_cost_order]; ?>"><?= fn_number_format($embcostplan, 4); ?></td>
		<td align="right" style="font-weight:bold"><?= fn_number_format(($embcostplan / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<td align="center" rowspan="2">5</td>
	<td style="font-weight:bold"><b>Gmts Wash</b></td>
	<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[wash_cost_dzn], 4) ?></td>
	<td align="right" style="font-weight:bold"><? echo fn_number_format($summary_data[wash_cost_order], 4) ?></td>
	<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[wash_cost_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<?
	$washcostplan = $summary_data[wash_cost_plan] - $summary_data[wash_cost_order];
	$washplandzn = ($washcostplan / $jobpoqty) * 12;
	?>
	<tr>
		<td>Plan Cut% Cost</td>
		<td align="right" style="font-weight:bold"><?= fn_number_format($washplandzn, 4); ?></td>
		<td align="right" style="font-weight:bold" title="<?= $summary_data[wash_cost_plan] . '-' . $summary_data[wash_cost_order]; ?>"><?= fn_number_format($washcostplan, 4); ?></td>
		<td align="right" style="font-weight:bold"><?= fn_number_format(($washcostplan / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">6</td>
		<td>Commission</td>
		<td align="right"><? echo fn_number_format($summary_data[commission_dzn], 4); ?></td>
		<td align="right"><? echo fn_number_format($summary_data[commission_order], 4); ?></td>
		<td align="right"><? echo fn_number_format(($summary_data[commission_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">7</td>
		<td>Lab Test</td>
		<td align="right"><? echo fn_number_format($summary_data[lab_test_dzn], 4); ?></td>
		<td align="right"><? echo fn_number_format($summary_data[lab_test_order], 4); ?></td>
		<td align="right"><? echo fn_number_format(($summary_data[lab_test_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">8</td>
		<td>Inspection Cost</td>
		<td align="right"><? echo fn_number_format($summary_data[inspection_dzn], 4); ?></td>
		<td align="right"><? echo fn_number_format($summary_data[inspection_order], 4); ?></td>
		<td align="right"><? echo fn_number_format(($summary_data[inspection_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">9</td>
		<td>CM Cost</td>
		<td align="right"><? echo fn_number_format($summary_data[cm_cost_dzn], 4); ?></td>
		<td align="right"><? echo fn_number_format($summary_data[cm_cost_order], 4); ?></td>
		<td align="right"><? echo fn_number_format(($summary_data[cm_cost_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">10</td>
		<td>Freight Cost</td>
		<td align="right"><? echo fn_number_format($summary_data[freight_dzn], 4); ?></td>
		<td align="right"><? echo fn_number_format($summary_data[freight_order], 4); ?></td>
		<td align="right"><? echo fn_number_format(($summary_data[freight_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">11</td>
		<td>Currier Cost</td>
		<td align="right"><? echo fn_number_format($summary_data[currier_dzn], 4); ?></td>
		<td align="right"><? echo fn_number_format($summary_data[currier_order], 4); ?></td>
		<td align="right"><? echo fn_number_format(($summary_data[currier_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">12</td>
		<td>Certificate Cost</td>
		<td align="right"><? echo fn_number_format($summary_data[certificate_dzn], 4); ?></td>
		<td align="right"><? echo fn_number_format($summary_data[certificate_order], 4); ?></td>
		<td align="right"><? echo fn_number_format(($summary_data[certificate_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">13</td>
		<td>Design Cost</td>
		<td align="right"><? echo fn_number_format($summary_data[design_dzn], 4); ?></td>
		<td align="right"><? echo fn_number_format($summary_data[design_order], 4); ?></td>
		<td align="right"><? echo fn_number_format(($summary_data[design_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">14</td>
		<td>Studio Cost</td>
		<td align="right"><? echo fn_number_format($summary_data[studio_dzn], 4); ?></td>
		<td align="right"><? echo fn_number_format($summary_data[studio_order], 4); ?></td>
		<td align="right"><? echo fn_number_format(($summary_data[studio_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">15</td>
		<td>Incentives Missing Cost</td>
		<td align="right"><? echo fn_number_format($summary_data[incentives_dzn], 4); ?></td>
		<td align="right"><? echo fn_number_format($summary_data[incentives_order], 4); ?></td>
		<td align="right"><? echo fn_number_format(($summary_data[incentives_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">16</td>
		<td>Deprec. & Amort.</td>
		<td align="right"><? echo fn_number_format($summary_data[depr_amor_dzn], 4); ?></td>
		<td align="right"><? echo fn_number_format($summary_data[depr_amor_order], 4); ?></td>
		<td align="right"><? echo fn_number_format(($summary_data[depr_amor_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">17</td>
		<td>Operating Expenses</td>
		<td align="right"><? echo fn_number_format($summary_data[common_oh_dzn], 4); ?></td>
		<td align="right"><? echo fn_number_format($summary_data[common_oh_order], 4); ?></td>
		<td align="right"><? echo fn_number_format(($summary_data[common_oh_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">18</td>
		<td>Deffd. LC/DC Cost</td>
		<td align="right"><? echo fn_number_format($summary_data[deffdlc_dzn], 4); ?></td>
		<td align="right"><? echo fn_number_format($summary_data[deffdlc_order], 4); ?></td>
		<td align="right"><? echo fn_number_format(($summary_data[deffdlc_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">19</td>
		<td>Interest</td>
		<td align="right"><? echo fn_number_format($summary_data[interest_dzn], 4); ?></td>
		<td align="right"><? echo fn_number_format($summary_data[interest_order], 4); ?></td>
		<td align="right"><? echo fn_number_format(($summary_data[interest_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">20</td>
		<td>Income Tax</td>
		<td align="right"><? echo fn_number_format($summary_data[incometax_dzn], 4); ?></td>
		<td align="right"><? echo fn_number_format($summary_data[incometax_order], 4); ?></td>
		<td align="right"><? echo fn_number_format(($summary_data[incometax_order] / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">21</td>
		<td>Office OH</td>
		<td align="right"><? //echo fn_number_format($summary_data[incometax_dzn],4); 
							?></td>
		<td align="right"><? //echo fn_number_format($summary_data[incometax_order],4); 
							?></td>
		<td align="right"><? //echo fn_number_format(($summary_data[incometax_order]/$summary_data[price_dzn_job])*100,2);
							?></td>
	</tr>
	<?
	$subdznamt = $fabriccostdzn + $summary_data[trims_cost_dzn] + $summary_data[emb_cost_dzn] + $embplandzn + $summary_data[wash_cost_dzn] + $washplandzn + $summary_data[commission_dzn] + $summary_data[lab_test_dzn] + $summary_data[inspection_dzn] + $summary_data[cm_cost_dzn] + $summary_data[freight_dzn] + $summary_data[currier_dzn] + $summary_data[certificate_dzn] + $summary_data[design_dzn] + $summary_data[studio_dzn] + $summary_data[incentives_dzn] + $summary_data[depr_amor_dzn] + $summary_data[common_oh_dzn] + $summary_data[deffdlc_dzn] + $summary_data[interest_dzn] + $summary_data[incometax_dzn];

	$subpoamt = $fabriccostjob + $summary_data[trims_cost_order] + $summary_data[emb_cost_order] + $embcostplan + $summary_data[wash_cost_order] + $washcostplan + $summary_data[commission_order] + $summary_data[lab_test_order] + $summary_data[inspection_order] + $summary_data[cm_cost_order] + $summary_data[freight_order] + $summary_data[currier_order] + $summary_data[certificate_order] + $summary_data[design_order] + $summary_data[studio_order] + $summary_data[incentives_order] + $summary_data[depr_amor_order] + $summary_data[common_oh_order] + $summary_data[deffdlc_order] + $summary_data[interest_order] + $summary_data[incometax_order];
	?>
	<tr style="font-weight:bold; background-color:#999">
		<td align="center">22</td>
		<td align="center" style="font-weight:bold">Sub Total Cost</td>
		<td align="right"><? echo fn_number_format($subdznamt, 4); ?></td>
		<td align="right"><? echo fn_number_format($subpoamt, 4); ?></td>
		<td align="right"><? echo fn_number_format(($subpoamt / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">23</td>
		<td style="font-weight:bold"><b>Commercial</b></td>
		<td align="right" style="font-weight:bold"><? echo fn_number_format($subdznamt * $commercial_rate_per, 4) ?></td>
		<td align="right" style="font-weight:bold"><? echo fn_number_format($subpoamt * $commercial_rate_per, 4) ?></td>
		<td align="right" style="font-weight:bold"><? echo fn_number_format(($subpoamt * $commercial_rate_per / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<?
	//$totalcostdzn=$subdznamt+$summary_data[comm_cost_dzn];
	//$totalcostorde=$subpoamt+$summary_data[comm_cost_order];
	$totalcostdzn = $subdznamt + $subdznamt * $commercial_rate_per;
	$totalcostorde = $subpoamt + $subpoamt * $commercial_rate_per;
	?>
	<tr style="font-weight:bold; background-color:#FFCCFF">
		<td align="center">24</td>
		<td style="font-weight:bold"><b>Total Cost</b></td>
		<td align="right" style="font-weight:bold"><? echo fn_number_format($totalcostdzn, 4); ?></td>
		<td align="right" style="font-weight:bold"><? echo fn_number_format($totalcostorde, 4); ?></td>
		<td align="right" style="font-weight:bold"><? echo fn_number_format(($totalcostorde / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<?
	$margindzn = ($summary_data[price_dzn_job] - $totalcostorde) / ($po_qty / 12);
	$marginamt = ($summary_data[price_dzn_job] - $totalcostorde);
	$totalfob = $totalcostorde + $marginamt;
	$costpcs = $totalcostorde / $po_qty;
	$marginpcs = ($summary_data[price_dzn] / 12) - $costpcs;
	?>
	<tr>
		<td align="center">&nbsp;</td>
		<td style="font-weight:bold"><b>Margin</b></td>
		<td align="right" style="font-weight:bold"><? echo fn_number_format($margindzn, 4) ?></td>
		<td align="right" style="font-weight:bold"><? echo fn_number_format($marginamt, 4) ?></td>
		<td align="right" style="font-weight:bold"><? echo fn_number_format(($marginamt / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">&nbsp;</td>
		<td style="font-weight:bold"><b>Price/Pcs</b></td>
		<td align="right" style="font-weight:bold"><? echo fn_number_format(($summary_data[price_dzn] / 12), 4) ?></td>
		<td align="right" style="font-weight:bold"><? echo fn_number_format($totalfob, 4) ?></td>
		<td align="right" style="font-weight:bold"><? echo fn_number_format(($totalfob / $summary_data[price_dzn_job]) * 100, 2); ?></td>
	</tr>
	<tr>
		<td align="center">&nbsp;</td>
		<td style="font-weight:bold"><b>Cost/Pcs</b></td>
		<td align="right" style="font-weight:bold"><? echo fn_number_format($costpcs, 4) ?></td>
		<td align="right" style="font-weight:bold">&nbsp;</td>
		<td align="right" style="font-weight:bold">&nbsp;</td>
	</tr>
	<tr>
		<td align="center">&nbsp;</td>
		<td style="font-weight:bold"><b>Margin/Pcs</b></td>
		<td align="right" style="font-weight:bold"><? echo fn_number_format($marginpcs, 4) ?></td>
		<td align="right" style="font-weight:bold">&nbsp;</td>
		<td align="right" style="font-weight:bold">&nbsp;</td>
	</tr>
</table>
</div>
<?
	//End all summary report here -------------------------------------------

	$process_loss_data = sql_select("select id, po_break_down_id, color_number_id, gmts_sizes, dia_width, item_size, cons, process_loss_percent, requirment, pcs, color_size_table_id, rate, amount, remarks,pre_cost_fabric_cost_dtls_id,job_no from wo_pre_cos_fab_co_avg_con_dtls where job_no=" . $txt_job_no . "  order by id ");

	foreach ($process_loss_data as $row) {
		$process_loss_arr[$row[csf("pre_cost_fabric_cost_dtls_id")]][$row[csf("job_no")]]['avg_process_loss'] = $row[csf("process_loss_percent")];
	}

	$lib_yarn_count_deter_id = return_library_array("select id,fabric_composition_id from lib_yarn_count_determina_mst where status_active=1", "id", "fabric_composition_id");
	$lib_fabric_composition = return_library_array("select id,fabric_composition_name from lib_fabric_composition where status_active=1", "id", "fabric_composition_name");

	$sql = "select id, job_no, body_part_id, fab_nature_id, color_type_id, fabric_description, uom, avg_cons, avg_cons_yarn, fabric_source, gsm_weight, rate, amount, avg_finish_cons, status_active, lib_yarn_count_deter_id, avg_process_loss from wo_pre_cost_fabric_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";

	$data_array = sql_select($sql);
	$knit_fab = "";
	$woven_fab = "";
	$knit_subtotal_avg_cons = 0;
	$knit_subtotal_amount = 0;
	$woven_subtotal_avg_cons = 0;
	$woven_subtotal_amount = 0;
	$grand_total_amount = 0;
	$i = 3;
	$j = 2;
	foreach ($data_array as $row) {
		$uom = $unit_of_measurement[$row[csf("uom")]];
		$fab_composition_id = $lib_yarn_count_deter_id[$row[csf("lib_yarn_count_deter_id")]];
		$fab_composition = $lib_fabric_composition[$fab_composition_id];
		// $avg_process_loss=$process_loss_arr[$row[csf("id")]][$row[csf("job_no")]]['avg_process_loss'];
		if ($row[csf("fab_nature_id")] == 2) //knit fabrics
		{
			$item_descrition = $body_part[$row[csf("body_part_id")]] . ", " . $color_type[$row[csf("color_type_id")]] . ", " . $row[csf("fabric_description")] . ", " . $row[csf("gsm_weight")];
			$amount = $fabricvariance = 0;
			if ($row[csf("fabric_source")] != 2) {
				$amount = $row[csf("avg_finish_cons")] * $row[csf("rate")];
			} else {
				$amount = $row[csf("avg_cons")] * $row[csf("rate")];
			}
			$percent_to_order_value = ($amount / $summary_data[price_dzn]) * 100;

			$fabricvariance = $fabwisedataarr[$row[csf("id")]][greyplanamt] - $fabwisedataarr[$row[csf("id")]][greypoamt];
			//echo $amount.'='.$price_dzn;
			$i++;
			$knit_fab .= '<tr>
		<td align="left" style="word-break:break-all">' . $item_descrition . '</td>
		<td align="left" style="word-break:break-all">' . $fabric_source[$row[csf("fabric_source")]] . '</td>
		<td align="right">' . fn_number_format($row[csf("avg_finish_cons")], 4) . '</td>
		<td align="right">' . fn_number_format($fabwisedataarr[$row[csf("id")]][finpoqty], 4) . '</td>
		<td align="right">' . fn_number_format($fabwisedataarr[$row[csf("id")]][finplanqty], 4) . '</td>
		<td align="right">' . fn_number_format($row[csf("avg_process_loss")], 4) . '</td>
		<td align="right">' . fn_number_format($row[csf("avg_cons")], 4) . '</td>	
		
		<td align="right">' . fn_number_format($fabwisedataarr[$row[csf("id")]][greypoqty], 4) . '</td>
		<td align="right">' . fn_number_format($fabwisedataarr[$row[csf("id")]][greyplanqty], 4) . '</td>
		<td align="left">' . $uom . '</td>
		<td align="right">' . fn_number_format($row[csf("rate")], 4) . '</td>
		<td align="right">' . fn_number_format($amount, 4) . '</td>
		
		<td align="right">' . fn_number_format($fabwisedataarr[$row[csf("id")]][greypoamt], 4) . '</td>
		<td align="right">' . fn_number_format($fabwisedataarr[$row[csf("id")]][greyplanamt], 4) . '</td>
		<td align="right">' . fn_number_format($fabricvariance, 4) . '</td>
		<td align="right">' . fn_number_format($percent_to_order_value, 2) . '%</td>
	</tr>';
			$knitsubavg_fincons[$row[csf("uom")]] += $row[csf("avg_finish_cons")];
			$knitsubfinpoqty[$row[csf("uom")]] += $fabwisedataarr[$row[csf("id")]][finpoqty];
			$knitsubfinplanqty[$row[csf("uom")]] += $fabwisedataarr[$row[csf("id")]][finplanqty];
			$knitsubtotal_avg_greycons[$row[csf("uom")]] += $row[csf("avg_cons")];
			$knitsubgreypoqty[$row[csf("uom")]] += $fabwisedataarr[$row[csf("id")]][greypoqty];
			$knitsubgreyplanqty[$row[csf("uom")]] += $fabwisedataarr[$row[csf("id")]][greyplanqty];
			$knitsubrate[$row[csf("uom")]] += $row[csf("rate")];
			$knitsubamt[$row[csf("uom")]] += $amount;
			$knitsubgreypoamt[$row[csf("uom")]] += $fabwisedataarr[$row[csf("id")]][greypoamt];
			$knitsubgreyplanamt[$row[csf("uom")]] += $fabwisedataarr[$row[csf("id")]][greyplanamt];
			$knitsubvariance[$row[csf("uom")]] += $fabricvariance;
		}

		if ($row[csf("fab_nature_id")] == 3) //woven fabrics
		{
			$amount = $fabricvariance = 0;
			$item_descrition = $body_part[$row[csf("body_part_id")]] . ", " . $color_type[$row[csf("color_type_id")]] . ", " . $row[csf("fabric_description")] . ", " . $row[csf("gsm_weight")];
			$amount = $row[csf("avg_finish_cons")] * $row[csf("rate")];
			$percent_to_order_value = $amount / $summary_data[price_dzn] * 100;

			$fabricvariance = $fabwisedataarr[$row[csf("id")]][greyplanamt] - $fabwisedataarr[$row[csf("id")]][greypoamt];
			$j++;
			$woven_fab .= '<tr>
		<td align="left" style="word-break:break-all">' . $item_descrition . '</td>
		<td align="left" style="word-break:break-all">' . $fabric_source[$row[csf("fabric_source")]] . '</td>
		<td align="right">' . fn_number_format($row[csf("avg_finish_cons")], 4) . '</td>
		<td align="right">' . fn_number_format($fabwisedataarr[$row[csf("id")]][finpoqty], 4) . '</td>
		<td align="right">' . fn_number_format($fabwisedataarr[$row[csf("id")]][finplanqty], 4) . '</td>
		<td align="right">' . fn_number_format($row[csf("avg_process_loss")], 4) . '</td>
		<td align="right">' . fn_number_format($row[csf("avg_cons")], 4) . '</td>	
		
		<td align="right">' . fn_number_format($fabwisedataarr[$row[csf("id")]][greypoqty], 4) . '</td>
		<td align="right">' . fn_number_format($fabwisedataarr[$row[csf("id")]][greyplanqty], 4) . '</td>
		<td align="left">' . $uom . '</td>
		<td align="right">' . fn_number_format($row[csf("rate")], 4) . '</td>
		<td align="right">' . fn_number_format($amount, 4) . '</td>
		
		<td align="right">' . fn_number_format($fabwisedataarr[$row[csf("id")]][greypoamt], 4) . '</td>
		<td align="right">' . fn_number_format($fabwisedataarr[$row[csf("id")]][greyplanamt], 4) . '</td>
		<td align="right">' . fn_number_format($fabricvariance, 4) . '</td>
		<td align="right">' . fn_number_format($percent_to_order_value, 2) . '%</td>
	</tr>';

			$wvnsubavg_fincons += $row[csf("avg_finish_cons")];
			$wvnsubfinpoqty += $fabwisedataarr[$row[csf("id")]][finpoqty];
			$wvnsubfinplanqty += $fabwisedataarr[$row[csf("id")]][finplanqty];
			$wvnsubtotal_avg_greycons += $row[csf("avg_cons")];
			$wvnsubgreypoqty += $fabwisedataarr[$row[csf("id")]][greypoqty];
			$wvnsubgreyplanqty += $fabwisedataarr[$row[csf("id")]][greyplanqty];
			$wvnsubrate += $row[csf("rate")];
			$wvnsubamt += $amount;
			$wvnsubgreypoamt += $fabwisedataarr[$row[csf("id")]][greypoamt];
			$wvnsubgreyplanamt += $fabwisedataarr[$row[csf("id")]][greyplanamt];
			$wvnsubvariance += $fabricvariance;
		}
	}

	$knit_fab = '<div style="margin-top:15px">
	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:1250px;text-align:center;" rules="all">
		<label><b>All Fabric Cost </b></label>
			<tr style="font-weight:bold"  align="center">
				<td width="60" rowspan="' . $i . '" ><div class="verticalText"><b>Knit Fabric</b></div></td>
				<td width="250">Fabric Description</td>
				<td width="80">Source</td>
				<td width="60">Avg. Fin. Cons/' . $costing_for . '</td>
				<td width="80">Total Fin. On Order Qty.</td>
				<td width="80">Total Fin. On Plan Cut Qty.</td>
				<td width="70">Avg. Process Loss</td>
				<td width="60">Avg. Grey Cons/' . $costing_for . '</td>
				<td width="80">Total Grey On Order Qty.</td>
				<td width="80">Total Grey On Plan Cut Qty.</td>
				<td width="60">UOM</td>
				<td width="60">Rate [USD]</td>
				<td width="70">Amount/' . $costing_for . ' [USD]</td>
				<td width="80">Amount On Order Qty.</td>
				<td width="80">Amount On Plan Cut Qty.</td>
				<td width="60">Variance</td>
				<td>% to Ord. Value</td>
			</tr>' . $knit_fab;
	$woven_fab = '<tr><td colspan="10">&nbsp;</td></tr><tr>
			<td width="80" rowspan="' . $j . '"><div class="verticalText"><b>Woven Fabric</b></div></td></tr>' . $woven_fab;

	//knit fabrics table here
	$fab_knit_req_kg_avg_amount = $knit_subtotal_amount / $knit_subtotal_avg_cons * $fab_knit_req_kg_avg;
	$knit_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
			<td colspan="2" align="left">Sub Total [Kg]</td>
			<td align="right">' . fn_number_format($knitsubavg_fincons[12], 4) . '</td>
			<td align="right">' . fn_number_format($knitsubfinpoqty[12], 4) . '</td>
			<td align="right">' . fn_number_format($knitsubfinplanqty[12], 4) . '</td>
			<td align="right">&nbsp;</td>
			<td align="right">' . fn_number_format($knitsubtotal_avg_greycons[12], 4) . '</td>
			<td align="right">' . fn_number_format($knitsubgreypoqty[12], 4) . '</td>
			<td align="right">' . fn_number_format($knitsubgreyplanqty[12], 4) . '</td>
			<td>&nbsp;</td>
			<td align="right">' . fn_number_format($knitsubrate[12], 4) . '</td>
			<td align="right">' . fn_number_format($knitsubamt[12], 4) . '</td>
			
			<td align="right">' . fn_number_format($knitsubgreypoamt[12], 4) . '</td>
			<td align="right">' . fn_number_format($knitsubgreyplanamt[12], 4) . '</td>
			<td align="right">' . fn_number_format($knitsubvariance[12], 4) . '</td>
			
			<td align="right">' . fn_number_format($knitsubamt[12] / $summary_data[price_dzn] * 100, 2) . '%</td>
		</tr>';
	$knit_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
			<td colspan="2" align="left">Sub Total[Yds]</td>
			<td align="right">' . fn_number_format($knitsubavg_fincons[27], 4) . '</td>
			<td align="right">' . fn_number_format($knitsubfinpoqty[27], 4) . '</td>
			<td align="right">' . fn_number_format($knitsubfinplanqty[27], 4) . '</td>
			<td align="right">&nbsp;</td>
			<td align="right">' . fn_number_format($knitsubtotal_avg_greycons[27], 4) . '</td>
			<td align="right">' . fn_number_format($knitsubgreypoqty[27], 4) . '</td>
			<td align="right">' . fn_number_format($knitsubgreyplanqty[27], 4) . '</td>
			<td>&nbsp;</td>
			<td align="right">' . fn_number_format($knitsubrate[27], 4) . '</td>
			<td align="right">' . fn_number_format($knitsubamt[27], 4) . '</td>
			
			<td align="right">' . fn_number_format($knitsubgreypoamt[27], 4) . '</td>
			<td align="right">' . fn_number_format($knitsubgreyplanamt[27], 4) . '</td>
			<td align="right">' . fn_number_format($knitsubvariance[27], 4) . '</td>
			
			<td align="right">' . fn_number_format($knitsubamt[27] / $summary_data[price_dzn] * 100, 2) . '%</td>
		</tr>';
	if ($zero_value == 1) echo $knit_fab;
	else {
		if ($row[csf("avg_cons")] > 0) {
			echo $knit_fab;
		} else echo "";
	}

	//woven fabrics table here
	$fab_woven_req_yds_avg_amount = $woven_subtotal_amount / $woven_subtotal_avg_cons * $fab_woven_req_yds_avg;
	$woven_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
			<td colspan="2" align="left">Sub Total</td>
			<td align="right">' . fn_number_format($wvnsubavg_fincons, 4) . '</td>
			<td align="right">' . fn_number_format($wvnsubfinpoqty, 4) . '</td>
			<td align="right">' . fn_number_format($wvnsubfinplanqty, 4) . '</td>
			<td align="right">&nbsp;</td>
			<td align="right">' . fn_number_format($wvnsubtotal_avg_greycons, 4) . '</td>
			<td align="right">' . fn_number_format($wvnsubgreypoqty, 4) . '</td>
			<td align="right">' . fn_number_format($wvnsubgreyplanqty, 4) . '</td>
			<td>&nbsp;</td>
			<td align="right">' . fn_number_format($wvnsubrate, 4) . '</td>
			<td align="right">' . fn_number_format($wvnsubamt, 4) . '</td>
			
			<td align="right">' . fn_number_format($wvnsubgreypoamt, 4) . '</td>
			<td align="right">' . fn_number_format($wvnsubgreyplanamt, 4) . '</td>
			<td align="right">' . fn_number_format($wvnsubvariance, 4) . '</td>
			<td align="right">' . fn_number_format($wvnsubamt / $summary_data[price_dzn] * 100, 2) . '%</td>
		</tr>';

	$totfabamtdzn = $knitsubamt[12] + $knitsubamt[27] + $wvnsubamt;
	$totfabamtorder = $knitsubgreypoamt[12] + $knitsubgreypoamt[27] + $wvnsubgreypoamt;
	$totfabamtplan = $knitsubgreyplanamt[12] + $knitsubgreyplanamt[27] + $wvnsubgreyplanamt;
	$totfabamtvariance = $knitsubvariance[12] + $knitsubvariance[27] + $wvnsubvariance;

	$woven_fab .= '<tr class="rpt_bottom" style="font-weight:bold">
			<td colspan="12" align="right">Total :</td>
			<td align="right">' . fn_number_format($totfabamtdzn, 4) . '</td>
			<td align="right">' . fn_number_format($totfabamtorder, 4) . '</td>
			<td align="right">' . fn_number_format($totfabamtplan, 4) . '</td>
			<td align="right">' . fn_number_format($totfabamtvariance, 4) . '</td>
			<td align="right">' . fn_number_format($totfabamtdzn / $summary_data[price_dzn] * 100, 2) . '%</td>
		</tr></table></div>';
	if ($zero_value == 1) echo $woven_fab;
	else {
		if ($row[csf("avg_cons")] > 0) {
			echo $woven_fab;
		} else echo "";
	}
	//end All Fabric Cost part report-------------------------------------------

	//Start	Yarn Cost part report here -------------------------------------------
	$lib_yarn_count = return_library_array("select yarn_count,id from lib_yarn_count", "id", "yarn_count");
	$sql = "select min(id) as id, count_id, copm_one_id, percent_one, copm_two_id, percent_two, color, type_id, min(cons_ratio) as cons_ratio, sum(cons_qnty) as cons_qnty, sum(avg_cons_qnty) as avg_cons_qnty, rate, sum(amount) as amount from wo_pre_cost_fab_yarn_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0 group by count_id, copm_one_id, percent_one, copm_two_id, percent_two,color, type_id, rate";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
?>
<div style="margin-top:15px">
	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:1150px;text-align:center;" rules="all">
		<tr style="font-weight:bold">
			<td colspan="10">
				<div class="verticalText"><b>Yarn Cost</b></div>
			</td>
		</tr>
		<tr style="font-weight:bold">
			<td width="250">Yarn Desc</td>
			<td width="70">Qty/Dzn</td>
			<td width="100">Yarn Qnty on Order Qty.</td>
			<td width="100">Yarn Qnty on Plan Cut Qty.</td>
			<td width="70">Rate [USD]</td>
			<td width="70">Amount [USD]</td>
			<td width="100">Amount on Order Qty.</td>
			<td width="100">Amount on Plan Cut Qty.</td>
			<td width="100">Variance</td>
			<td>% to Ord. Value</td>
		</tr>
		<?
		$total_qnty = 0;
		$total_avg_qnty = 0;
		$total_amount = 0;
		foreach ($data_array as $row) {
			$index = "";
			$index = "'" . $row[csf("count_id")] . "_" . $row[csf("copm_one_id")] . "_" . $row[csf("percent_one")] . "_" . $row[csf("type_id")] . "_" . $row[csf("color")] . "_" . $row[csf("rate")] . "'";

			if ($row[csf("percent_one")] == 100)
				$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];
			else
				$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $composition[$row[csf("copm_two_id")]] . " " . $row[csf("percent_two")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];

			$yarnvariance = $YarnData[$index]['amountplan'] - $YarnData[$index]['amountorder'];
		?>
			<tr>
				<td align="left" style="word-break:break-all"><? echo $item_descrition; ?></td>
				<td align="right"><? echo fn_number_format($row[csf("cons_qnty")], 4); ?></td>
				<td align="right"><? echo fn_number_format($YarnData[$index]['qtyorder'], 4); ?></td>
				<td align="right"><? echo fn_number_format($YarnData[$index]['qtyplan'], 4); ?></td>
				<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
				<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>

				<td align="right"><? echo fn_number_format($YarnData[$index]['amountorder'], 4); ?></td>
				<td align="right"><? echo fn_number_format($YarnData[$index]['amountplan'], 4); ?></td>
				<td align="right"><? echo fn_number_format($yarnvariance, 4); ?></td>

				<td align="right"><? echo fn_number_format($row[csf("amount")] / $summary_data[price_dzn] * 100, 2); ?>%</td>
			</tr>
		<?
			$tot_yarn_qntydzn += $row[csf("cons_qnty")];
			$tot_yarn_qntyorder += $YarnData[$index]['qtyorder'];
			$tot_yarn_qntyplan += $YarnData[$index]['qtyplan'];
			$tot_yarn_amtdzn += $row[csf("amount")];
			$tot_yarn_amtorder += $YarnData[$index]['amountorder'];
			$tot_yarn_amtplan += $YarnData[$index]['amountplan'];
			$tot_yarn_amtvariance += $yarnvariance;
		}
		?>
		<tr class="rpt_bottom" style="font-weight:bold">
			<td>Total:</td>
			<td align="right"><? echo fn_number_format($tot_yarn_qntydzn, 4); ?></td>
			<td align="right"><? echo fn_number_format($tot_yarn_qntyorder, 4); ?></td>
			<td align="right"><? echo fn_number_format($tot_yarn_qntyplan, 4); ?></td>
			<td>&nbsp;</td>
			<td align="right"><? echo fn_number_format($tot_yarn_amtdzn, 4); ?></td>
			<td align="right"><? echo fn_number_format($tot_yarn_amtorder, 4); ?></td>
			<td align="right"><? echo fn_number_format($tot_yarn_amtplan, 4); ?></td>

			<td align="right"><? echo fn_number_format($tot_yarn_amtvariance, 4); ?></td>
			<td align="right"><? echo fn_number_format($tot_yarn_amtdzn / $summary_data[price_dzn] * 100, 2); ?>%</td>
		</tr>
	</table>
</div>
<?
		$grand_total_amount += $total_amount;
	} else {
		if ($totfabamtvariance > 0) {
?>
	<div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:1150px;text-align:center;" rules="all">
			<tr style="font-weight:bold">
				<td colspan="10">
					<div class="verticalText"><b>Yarn Cost</b></div>
				</td>
			</tr>
			<tr style="font-weight:bold">
				<td width="250">Yarn Desc</td>
				<td width="70">Qty/Dzn</td>
				<td width="100">Yarn Qnty on Order Qty.</td>
				<td width="100">Yarn Qnty on Plan Cut Qty.</td>
				<td width="70">Rate [USD]</td>
				<td width="70">Amount [USD]</td>
				<td width="100">Amount on Order Qty.</td>
				<td width="100">Amount on Plan Cut Qty.</td>
				<td width="100">Variance</td>
				<td>% to Ord. Value</td>
			</tr>
			<?
			$total_qnty = 0;
			$total_avg_qnty = 0;
			$total_amount = 0;
			foreach ($data_array as $row) {
				$index = "";
				$index = "'" . $row[csf("count_id")] . "_" . $row[csf("copm_one_id")] . "_" . $row[csf("percent_one")] . "_" . $row[csf("type_id")] . "_" . $row[csf("color")] . "_" . $row[csf("rate")] . "'";

				if ($row[csf("percent_one")] == 100)
					$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];
				else
					$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $composition[$row[csf("copm_two_id")]] . " " . $row[csf("percent_two")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];

				$yarnvariance = $YarnData[$index]['amountplan'] - $YarnData[$index]['amountorder'];
			?>
				<tr>
					<td style="word-break:break-all"><? echo $item_descrition; ?></td>
					<td align="right"><? echo fn_number_format($row[csf("cons_qnty")], 4); ?></td>
					<td align="right"><? echo fn_number_format($YarnData[$index]['qtyorder'], 4); ?></td>
					<td align="right"><? echo fn_number_format($YarnData[$index]['qtyplan'], 4); ?></td>
					<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
					<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>

					<td align="right"><? echo fn_number_format($YarnData[$index]['amountorder'], 4); ?></td>
					<td align="right"><? echo fn_number_format($YarnData[$index]['amountplan'], 4); ?></td>
					<td align="right"><? echo fn_number_format($yarnvariance, 4); ?></td>
					<td align="right"><? echo fn_number_format($row[csf("amount")] / $summary_data[price_dzn] * 100, 2); ?>%</td>
				</tr>
			<?
				$tot_yarn_qntydzn += $row[csf("cons_qnty")];
				$tot_yarn_qntyorder += $YarnData[$index]['qtyorder'];
				$tot_yarn_qntyplan += $YarnData[$index]['qtyplan'];
				$tot_yarn_amtdzn += $row[csf("amount")];
				$tot_yarn_amtorder += $YarnData[$index]['amountorder'];
				$tot_yarn_amtplan += $YarnData[$index]['amountplan'];
				$tot_yarn_amtvariance += $yarnvariance;
			}
			?>
			<tr class="rpt_bottom" style="font-weight:bold">
				<td>Total Yarn Cost:</td>
				<td align="right"><? echo fn_number_format($tot_yarn_qntydzn, 4); ?></td>
				<td align="right"><? echo fn_number_format($tot_yarn_qntyorder, 4); ?></td>
				<td align="right"><? echo fn_number_format($tot_yarn_qntyplan, 4); ?></td>
				<td>&nbsp;</td>
				<td align="right"><? echo fn_number_format($tot_yarn_amtdzn, 4); ?></td>
				<td align="right"><? echo fn_number_format($tot_yarn_amtorder, 4); ?></td>
				<td align="right"><? echo fn_number_format($tot_yarn_amtplan, 4); ?></td>

				<td align="right"><? echo fn_number_format($tot_yarn_amtvariance, 4); ?></td>
				<td align="right"><? echo fn_number_format($tot_yarn_amtdzn / $summary_data[price_dzn] * 100, 2); ?>%</td>
			</tr>
		</table>
	</div>
<?
			$grand_total_amount += $total_amount;
		} else {
			echo "";
		}
	}
	//End Yarn Cost part report here -------------------------------------------

	//Start	Conversion Cost to Fabric report here -------------------------------------------
	$sql = "select a.id, a.fabric_description as fabric_description_id, a.job_no, a.cons_process, a.req_qnty, a.process_loss, a.avg_req_qnty, a.charge_unit, a.amount, a.status_active, b.body_part_id, b.fab_nature_id, b.color_type_id, b.fabric_description
	from wo_pre_cost_fab_conv_cost_dtls a left join wo_pre_cost_fabric_cost_dtls b on a.job_no=b.job_no and a.fabric_description=b.id and b.status_active=1 and b.is_deleted=0 where a.job_no=" . $txt_job_no . " and a.status_active=1 and a.is_deleted=0 order by a.cons_process, a.id asc";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
?>
<div style="margin-top:15px">
	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:1250px;text-align:center;" rules="all">
		<tr style="font-weight:bold">
			<td colspan="13" align="center">
				<div class="verticalText"><b>Conversion Cost to Fabric</b></div>
			</td>
		</tr>
		<tr style="font-weight:bold">
			<td width="250">Fabric Description</td>
			<td width="100">Process</td>
			<td width="70">Cons/<? echo $costing_for; ?></td>
			<td width="60">Process Loss%</td>
			<td width="70">Cons/ DZN Without Process Loss</td>
			<td width="80">Required Qnty on Order Qty.</td>
			<td width="80">Required Qnty on Plan Cut Qty.</td>
			<td width="70">Rate [USD]</td>
			<td width="70">Amount/<? echo $costing_for; ?> [USD]</td>
			<td width="80">Amount On Order Qty.</td>
			<td width="80">Amount On Plan Cut Qty.</td>
			<td width="80">Variance</td>
			<td>% to Ord. Value</td>
		</tr>
		<?
		foreach ($ConvData as $processid => $processdata) {
			$prcess_totreqdzn = $prcess_totlossdzn = $prcess_totwithoutreqdzn = $prcess_reqorder = $prcess_reqplan = $prcess_amtdzn = $prcess_amtorder = $prcess_amtplan = $prcess_amtvariance = 0;
			foreach ($processdata as $convid => $convdata) {
				$converVariance = $convdata['tot_amount_plan'] - $convdata['tot_amount_order'];
		?>
				<tr>
					<td style="word-break:break-all"><?= $convdata['item_descrition']; ?></td>
					<td style="word-break:break-all"><?= $conversion_cost_head_array[$processid]; ?></td>
					<td align="right"><? echo fn_number_format($convdata['req_qnty'], 4); ?></td>
					<td align="right"><? echo fn_number_format($convdata['process_loss'], 4); ?></td>
					<td align="right"><? echo fn_number_format($convdata['avg_req_qnty'], 4); ?></td>

					<td align="right"><? echo fn_number_format($convdata['tot_req_qnty_order'], 4); ?></td>
					<td align="right"><? echo fn_number_format($convdata['tot_req_qnty_plan'], 4); ?></td>
					<td align="right"><? echo fn_number_format($convdata['charge_unit'], 4); ?></td>
					<td align="right"><? echo fn_number_format($convdata['amount'], 4); ?></td>

					<td align="right"><? echo fn_number_format($convdata['tot_amount_order'], 4); ?></td>
					<td align="right"><? echo fn_number_format($convdata['tot_amount_plan'], 4); ?></td>
					<td align="right"><? echo fn_number_format($converVariance, 4); ?></td>
					<td align="right"><? echo fn_number_format($convdata['amount'] / $summary_data[price_dzn] * 100, 2); ?>%</td>
				</tr>
			<?
				$prcess_totreqdzn += $convdata['req_qnty'];
				$prcess_totwithoutreqdzn += $convdata['avg_req_qnty'];
				$prcess_reqorder += $convdata['tot_req_qnty_order'];
				$prcess_reqplan += $convdata['tot_req_qnty_plan'];
				$prcess_amtdzn += $convdata['amount'];
				$prcess_amtorder += $convdata['tot_amount_order'];
				$prcess_amtplan += $convdata['tot_amount_plan'];
				$prcess_amtvariance += $converVariance;

				$conv_amtdzn += $convdata['amount'];
				$conv_amtorder += $convdata['tot_amount_order'];
				$conv_amtplan += $convdata['tot_amount_plan'];
				$conv_amtvariance += $converVariance;
			}
			?>
			<tr class="rpt_bottom" style="font-weight:bold">
				<td colspan="2"><?= $conversion_cost_head_array[$processid]; ?> Total:</td>
				<td align="right"><? echo fn_number_format($prcess_totreqdzn, 4); ?></td>
				<td>&nbsp;</td>
				<td align="right"><? echo fn_number_format($prcess_totwithoutreqdzn, 4); ?></td>

				<td align="right"><? echo fn_number_format($prcess_reqorder, 4); ?></td>
				<td align="right"><? echo fn_number_format($prcess_reqplan, 4); ?></td>
				<td>&nbsp;</td>
				<td align="right"><? echo fn_number_format($prcess_amtdzn, 4); ?></td>
				<td align="right"><? echo fn_number_format($prcess_amtorder, 4); ?></td>
				<td align="right"><? echo fn_number_format($prcess_amtplan, 4); ?></td>
				<td align="right"><? echo fn_number_format($prcess_amtvariance, 4); ?></td>
				<td align="right"><? echo  fn_number_format($prcess_amtdzn / $summary_data[price_dzn] * 100, 2); ?>%</td>
			</tr>
		<?
		}
		?>
		<tr class="rpt_bottom" style="font-weight:bold">
			<td colspan="2">Total Conversion Cost:</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>

			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td>&nbsp;</td>
			<td align="right"><? echo fn_number_format($conv_amtdzn, 4); ?></td>
			<td align="right"><? echo fn_number_format($conv_amtorder, 4); ?></td>
			<td align="right"><? echo fn_number_format($conv_amtplan, 4); ?></td>
			<td align="right"><? echo fn_number_format($conv_amtvariance, 4); ?></td>
			<td align="right"><? echo  fn_number_format($conv_amtdzn / $summary_data[price_dzn] * 100, 2); ?>%</td>
		</tr>
	</table>
</div>
<?
	} else {
		if ($totfabamtvariance > 0) {
?>
	<div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:1250px;text-align:center;" rules="all">
			<tr style="font-weight:bold">
				<td colspan="13" align="center">
					<div class="verticalText"><b>Conversion Cost to Fabric</b></div>
				</td>
			</tr>
			<tr style="font-weight:bold">
				<td width="250">Fabric Description</td>
				<td width="100">Process</td>
				<td width="70">Cons/<? echo $costing_for; ?></td>
				<td width="60">Process Loss%</td>
				<td width="70">Cons/ DZN Without Process Loss</td>
				<td width="80">Required Qnty on Order Qty.</td>
				<td width="80">Required Qnty on Plan Cut Qty.</td>
				<td width="70">Rate [USD]</td>
				<td width="70">Amount/<? echo $costing_for; ?> [USD]</td>
				<td width="80">Amount On Order Qty.</td>
				<td width="80">Amount On Plan Cut Qty.</td>
				<td width="80">Variance</td>
				<td>% to Ord. Value</td>
			</tr>
			<?
			foreach ($ConvData as $processid => $processdata) {
				$prcess_totreqdzn = $prcess_totlossdzn = $prcess_totwithoutreqdzn = $prcess_reqorder = $prcess_reqplan = $prcess_amtdzn = $prcess_amtorder = $prcess_amtplan = $prcess_amtvariance = 0;
				foreach ($processdata as $convid => $convdata) {
					$converVariance = $convdata['tot_amount_plan'] - $convdata['tot_amount_order'];
			?>
					<tr>
						<td style="word-break:break-all"><?= $convdata['item_descrition']; ?></td>
						<td style="word-break:break-all"><?= $conversion_cost_head_array[$processid]; ?></td>
						<td align="right"><? echo fn_number_format($convdata['req_qnty'], 4); ?></td>
						<td align="right"><? echo fn_number_format($convdata['process_loss'], 4); ?></td>
						<td align="right"><? echo fn_number_format($convdata['avg_req_qnty'], 4); ?></td>

						<td align="right"><? echo fn_number_format($convdata['tot_req_qnty_order'], 4); ?></td>
						<td align="right"><? echo fn_number_format($convdata['tot_req_qnty_plan'], 4); ?></td>
						<td align="right"><? echo fn_number_format($convdata['charge_unit'], 4); ?></td>
						<td align="right"><? echo fn_number_format($convdata['amount'], 4); ?></td>

						<td align="right"><? echo fn_number_format($convdata['tot_amount_order'], 4); ?></td>
						<td align="right"><? echo fn_number_format($convdata['tot_amount_plan'], 4); ?></td>
						<td align="right"><? echo fn_number_format($converVariance, 4); ?></td>
						<td align="right"><? echo fn_number_format($convdata['amount'] / $summary_data[price_dzn] * 100, 2); ?>%</td>
					</tr>
				<?
					$prcess_totreqdzn += $convdata['req_qnty'];
					$prcess_totwithoutreqdzn += $convdata['avg_req_qnty'];
					$prcess_reqorder += $convdata['tot_req_qnty_order'];
					$prcess_reqplan += $convdata['tot_req_qnty_plan'];
					$prcess_amtdzn += $convdata['amount'];
					$prcess_amtorder += $convdata['tot_amount_order'];
					$prcess_amtplan += $convdata['tot_amount_plan'];
					$prcess_amtvariance += $converVariance;

					$conv_amtdzn += $convdata['amount'];
					$conv_amtorder += $convdata['tot_amount_order'];
					$conv_amtplan += $convdata['tot_amount_plan'];
					$conv_amtvariance += $converVariance;
				}
				?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td colspan="2"><?= $conversion_cost_head_array[$processid]; ?> Total:</td>
					<td align="right"><? echo fn_number_format($prcess_totreqdzn, 4); ?></td>
					<td>&nbsp;</td>
					<td align="right"><? echo fn_number_format($prcess_totwithoutreqdzn, 4); ?></td>

					<td align="right"><? echo fn_number_format($prcess_reqorder, 4); ?></td>
					<td align="right"><? echo fn_number_format($prcess_reqplan, 4); ?></td>
					<td>&nbsp;</td>
					<td align="right"><? echo fn_number_format($prcess_amtdzn, 4); ?></td>
					<td align="right"><? echo fn_number_format($prcess_amtorder, 4); ?></td>
					<td align="right"><? echo fn_number_format($prcess_amtplan, 4); ?></td>
					<td align="right"><? echo fn_number_format($prcess_amtvariance, 4); ?></td>

					<td align="right"><? echo  fn_number_format($prcess_amtdzn / $summary_data[price_dzn] * 100, 2); ?>%</td>
				</tr>
			<?
			}
			?>
			<tr class="rpt_bottom" style="font-weight:bold">
				<td colspan="2">Total Conversion Cost:</td>
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td>&nbsp;</td>

				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td align="right"><? echo fn_number_format($conv_amtdzn, 4); ?></td>
				<td align="right"><? echo fn_number_format($conv_amtorder, 4); ?></td>
				<td align="right"><? echo fn_number_format($conv_amtplan, 4); ?></td>
				<td align="right"><? echo fn_number_format($conv_amtvariance, 4); ?></td>
				<td align="right"><? echo  fn_number_format($conv_amtdzn / $summary_data[price_dzn] * 100, 2); ?>%</td>
			</tr>
		</table>
	</div>
<?
		} else {
			echo "";
		}
	}
	//End Conversion Cost to Fabric report here -------------------------------------------

	//start	Trims Cost part report here -------------------------------------------
	$sql = "select id, job_no, trim_group, description, brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp, status_active, seq
	from wo_pre_cost_trim_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0 order by seq";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
?>
<div style="margin-top:15px">
	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:950px;text-align:center;" rules="all">
		<label><b>Trims Cost</b></label>
		<tr style="font-weight:bold">
			<td width="150">Item Group</td>
			<td width="150">Description</td>
			<td width="100">Brand/Supp Ref</td>
			<td width="60">UOM</td>
			<td width="80">Cons/<? echo $costing_for; ?></td>
			<td width="80">Total Qty. on Order Qty</td>
			<td width="70">Rate [USD]</td>
			<td width="70">Amount/<? echo $costing_for; ?> [USD]</td>
			<td width="80">Amount On Order Qty.</td>
			<td>% to Ord. Value</td>
		</tr>
		<?
		$total_amount = 0;
		foreach ($data_array as $row) {
			$trim_group = return_library_array("select item_name,id from  lib_item_group where id=" . $row[csf("trim_group")], "id", "item_name");
		?>
			<tr>
				<td style="word-break:break-all"><? echo $trim_group[$row[csf("trim_group")]]; ?></td>
				<td style="word-break:break-all"><? echo $row[csf("description")]; ?></td>
				<td style="word-break:break-all"><? echo $row[csf("brand_sup_ref")]; ?></td>
				<td style="word-break:break-all"><? echo $unit_of_measurement[$row[csf("cons_uom")]]; ?></td>
				<td align="right"><? echo fn_number_format($row[csf("cons_dzn_gmts")], 4); ?></td>
				<td align="right"><? echo fn_number_format($trimsreqdata[$row[csf("id")]]['reqorderqty'], 4); ?></td>

				<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
				<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
				<td align="right"><? echo fn_number_format($trimsreqdata[$row[csf("id")]]['reqorderamt'], 4); ?></td>
				<td align="right"><? echo fn_number_format($row[csf("amount")] / $summary_data[price_dzn] * 100, 2); ?>%</td>
			</tr>
		<?
			$tot_amountdzn += $row[csf("amount")];
			$tot_amountorder += $trimsreqdata[$row[csf("id")]]['reqorderamt'];
		}
		?>
		<tr class="rpt_bottom" style="font-weight:bold">
			<td colspan="7">Total Trims Cost:</td>
			<td align="right"><? echo fn_number_format($tot_amountdzn, 4); ?></td>
			<td align="right"><? echo fn_number_format($tot_amountorder, 4); ?></td>
			<td align="right"><? echo fn_number_format($tot_amountdzn / $summary_data[price_dzn] * 100, 2); ?>%</td>
		</tr>
	</table>
</div>
<?
	} else {
		if ($trims_cost > 0) {
?>
	<div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:950px;text-align:center;" rules="all">
			<label><b>Trims Cost</b></label>
			<tr style="font-weight:bold">
				<td width="150">Item Group</td>
				<td width="150">Description</td>
				<td width="100">Brand/Supp Ref</td>
				<td width="60">UOM</td>
				<td width="80">Cons/<? echo $costing_for; ?></td>
				<td width="80">Total Qty. on Order Qty</td>
				<td width="70">Rate [USD]</td>
				<td width="70">Amount/<? echo $costing_for; ?> [USD]</td>
				<td width="80">Amount On Order Qty.</td>
				<td>% to Ord. Value</td>
			</tr>
			<?
			$total_amount = 0;
			foreach ($data_array as $row) {
				$trim_group = return_library_array("select item_name,id from  lib_item_group where id=" . $row[csf("trim_group")], "id", "item_name");
			?>
				<tr>
					<td style="word-break:break-all"><? echo $trim_group[$row[csf("trim_group")]]; ?></td>
					<td style="word-break:break-all"><? echo $row[csf("description")]; ?></td>
					<td style="word-break:break-all"><? echo $row[csf("brand_sup_ref")]; ?></td>
					<td style="word-break:break-all"><? echo $unit_of_measurement[$row[csf("cons_uom")]]; ?></td>
					<td align="right"><? echo fn_number_format($row[csf("cons_dzn_gmts")], 4); ?></td>
					<td align="right"><? echo fn_number_format($trimsreqdata[$row[csf("id")]]['reqorderqty'], 4); ?></td>

					<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
					<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
					<td align="right"><? echo fn_number_format($trimsreqdata[$row[csf("id")]]['reqorderamt'], 4); ?></td>
					<td align="right"><? echo fn_number_format($row[csf("amount")] / $summary_data[price_dzn] * 100, 2); ?>%</td>
				</tr>
			<?
				$tot_amountdzn += $row[csf("amount")];
				$tot_amountorder += $trimsreqdata[$row[csf("id")]]['reqorderamt'];
			}
			?>
			<tr class="rpt_bottom" style="font-weight:bold">
				<td colspan="7">Total Trims Cost:</td>
				<td align="right"><? echo fn_number_format($tot_amountdzn, 4); ?></td>
				<td align="right"><? echo fn_number_format($tot_amountorder, 4); ?></td>
				<td align="right"><? echo fn_number_format($tot_amountdzn / $summary_data[price_dzn] * 100, 2); ?>%</td>
			</tr>
		</table>
	</div>
<?
		} else {
			echo "";
		}
	}
	//End Trims Cost Part report here -------------------------------------------
	//start	Embellishment Details part report here -------------------------------------------
	$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount, status_active from wo_pre_cost_embe_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0 and emb_name!=3 and cons_dzn_gmts is not null";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
?>
<div style="margin-top:15px">
	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:1000px;text-align:center;" rules="all">
		<label><b>Embellishment Details</b></label>
		<tr style="font-weight:bold">
			<td width="150">Particulars</td>
			<td width="150">Type</td>
			<td width="70">Cons/<? echo $costing_for; ?></td>
			<td width="80">Gmts. Qnty on Order Qty.</td>
			<td width="80">Gmts. Qnty on Plan Cut Qty.</td>
			<td width="70">Rate [USD]</td>
			<td width="70">Amount/<? echo $costing_for; ?> [USD]</td>
			<td width="80">Amount On Order Qty.</td>
			<td width="80">Amount On Plan Cut Qty.</td>
			<td width="80">Variance</td>
			<td>% to Ord. Value</td>
		</tr>
		<?
		$total_amount = 0;
		foreach ($data_array as $row) {
			$em_type = "";
			//$emblishment_name_array=array(1=>"Printing",2=>"Embroidery",3=>"Wash",4=>"Special Works",5=>"Others");
			if ($row[csf("emb_name")] == 1) $em_type = $emblishment_print_type[$row[csf("emb_type")]];
			else if ($row[csf("emb_name")] == 2) $em_type = $emblishment_embroy_type[$row[csf("emb_type")]];
			else if ($row[csf("emb_name")] == 3) $em_type = $emblishment_wash_type[$row[csf("emb_type")]];
			else if ($row[csf("emb_name")] == 4) $em_type = $emblishment_spwork_type[$row[csf("emb_type")]];
			else if ($row[csf("emb_name")] == 5) $em_type = $emblishment_gmts_type[$row[csf("emb_type")]];
			$embvariance = $embdataarr[$row[csf("id")]]['embplanamt'] - $embdataarr[$row[csf("id")]]['emborderamt'];
		?>
			<tr>
				<td style="word-break:break-all"><? echo $emblishment_name_array[$row[csf("emb_name")]]; ?></td>
				<td style="word-break:break-all"><? echo $em_type; ?></td>
				<td align="right"><? echo fn_number_format($row[csf("cons_dzn_gmts")], 4); ?></td>
				<td align="right"><? echo fn_number_format($embdataarr[$row[csf("id")]]['emborderqty'], 4); ?></td>
				<td align="right"><? echo fn_number_format($embdataarr[$row[csf("id")]]['embplanqty'], 4); ?></td>
				<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
				<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
				<td align="right"><? echo fn_number_format($embdataarr[$row[csf("id")]]['emborderamt'], 4); ?></td>
				<td align="right"><? echo fn_number_format($embdataarr[$row[csf("id")]]['embplanamt'], 4); ?></td>
				<td align="right"><? echo fn_number_format($embvariance, 4); ?></td>
				<td align="right"><? echo fn_number_format($row[csf("amount")] / $summary_data[price_dzn] * 100, 2); ?>%</td>
			</tr>
		<?
			$embamtdzn += $row[csf("amount")];
			$emborderamt += $embdataarr[$row[csf("id")]]['emborderamt'];
			$embplanamt += $embdataarr[$row[csf("id")]]['embplanamt'];
			$embvariancetot += $embvariance;
		}
		?>
		<tr class="rpt_bottom" style="font-weight:bold">
			<td colspan="6">Embellishment Total :</td>
			<td align="right"><? echo fn_number_format($embamtdzn, 4); ?></td>
			<td align="right"><? echo fn_number_format($emborderamt, 4); ?></td>
			<td align="right"><? echo fn_number_format($embplanamt, 4); ?></td>
			<td align="right"><? echo fn_number_format($embvariancetot, 4); ?></td>
			<td align="right"><? echo fn_number_format($embamtdzn / $summary_data[price_dzn] * 100, 2); ?>%</td>
		</tr>
	</table>
</div>
<?
	} else {
		if ($embel_cost > 0) {
?>
	<div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:1000px;text-align:center;" rules="all">
			<label><b>Embellishment Details</b></label>
			<tr style="font-weight:bold">
				<td width="150">Particulars</td>
				<td width="150">Type</td>
				<td width="70">Cons/<? echo $costing_for; ?></td>
				<td width="80">Gmts. Qnty on Order Qty.</td>
				<td width="80">Gmts. Qnty on Plan Cut Qty.</td>
				<td width="70">Rate [USD]</td>
				<td width="70">Amount/<? echo $costing_for; ?> [USD]</td>
				<td width="80">Amount On Order Qty.</td>
				<td width="80">Amount On Plan Cut Qty.</td>
				<td width="80">Variance</td>
				<td>% to Ord. Value</td>
			</tr>
			<?
			$total_amount = 0;
			foreach ($data_array as $row) {
				$em_type = "";
				//$emblishment_name_array=array(1=>"Printing",2=>"Embroidery",3=>"Wash",4=>"Special Works",5=>"Others");
				if ($row[csf("emb_name")] == 1) $em_type = $emblishment_print_type[$row[csf("emb_type")]];
				else if ($row[csf("emb_name")] == 2) $em_type = $emblishment_embroy_type[$row[csf("emb_type")]];
				else if ($row[csf("emb_name")] == 3) $em_type = $emblishment_wash_type[$row[csf("emb_type")]];
				else if ($row[csf("emb_name")] == 4) $em_type = $emblishment_spwork_type[$row[csf("emb_type")]];
				else if ($row[csf("emb_name")] == 5) $em_type = $emblishment_gmts_type[$row[csf("emb_type")]];
				$embvariance = $embdataarr[$row[csf("id")]]['embplanamt'] - $embdataarr[$row[csf("id")]]['emborderamt'];
			?>
				<tr>
					<td style="word-break:break-all"><? echo $emblishment_name_array[$row[csf("emb_name")]]; ?></td>
					<td style="word-break:break-all"><? echo $em_type; ?></td>
					<td align="right"><? echo fn_number_format($row[csf("cons_dzn_gmts")], 4); ?></td>
					<td align="right"><? echo fn_number_format($embdataarr[$row[csf("id")]]['emborderqty'], 4); ?></td>
					<td align="right"><? echo fn_number_format($embdataarr[$row[csf("id")]]['embplanqty'], 4); ?></td>
					<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
					<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
					<td align="right"><? echo fn_number_format($embdataarr[$row[csf("id")]]['emborderamt'], 4); ?></td>
					<td align="right"><? echo fn_number_format($embdataarr[$row[csf("id")]]['embplanamt'], 4); ?></td>
					<td align="right"><? echo fn_number_format($embvariance, 4); ?></td>
					<td align="right"><? echo fn_number_format($row[csf("amount")] / $summary_data[price_dzn] * 100, 2); ?>%</td>
				</tr>
			<?
				$embamtdzn += $row[csf("amount")];
				$emborderamt += $embdataarr[$row[csf("id")]]['emborderamt'];
				$embplanamt += $embdataarr[$row[csf("id")]]['embplanamt'];
				$embvariancetot += $embvariance;
			}
			?>
			<tr class="rpt_bottom" style="font-weight:bold">
				<td colspan="6">Embellishment Total :</td>
				<td align="right"><? echo fn_number_format($embamtdzn, 4); ?></td>
				<td align="right"><? echo fn_number_format($emborderamt, 4); ?></td>
				<td align="right"><? echo fn_number_format($embplanamt, 4); ?></td>
				<td align="right"><? echo fn_number_format($embvariancetot, 4); ?></td>
				<td align="right"><? echo fn_number_format($embamtdzn / $summary_data[price_dzn] * 100, 2); ?>%</td>
			</tr>
		</table>
	</div>
<?
		} else {
			echo "";
		}
	}
	//End Embellishment Details Part report here -------------------------------------------

	//start	Wash Details part report here -------------------------------------------
	$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount, status_active from wo_pre_cost_embe_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0 and emb_name=3";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
?>
<div style="margin-top:15px">
	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:1000px;text-align:center;" rules="all">
		<label><b>Gmts. Wash Details</b></label>
		<tr style="font-weight:bold">
			<td width="150">Particulars</td>
			<td width="150">Type</td>
			<td width="70">Cons/<? echo $costing_for; ?></td>
			<td width="80">Gmts. Qnty on Order Qty.</td>
			<td width="80">Gmts. Qnty on Plan Cut Qty.</td>
			<td width="70">Rate [USD]</td>
			<td width="70">Amount/<? echo $costing_for; ?> [USD]</td>
			<td width="80">Amount On Order Qty.</td>
			<td width="80">Amount On Plan Cut Qty.</td>
			<td width="80">Variance</td>
			<td>% to Ord. Value</td>
		</tr>
		<?
		$total_amount = 0;
		foreach ($data_array as $row) {
			$em_type = "";
			//$emblishment_name_array=array(1=>"Printing",2=>"Embroidery",3=>"Wash",4=>"Special Works",5=>"Others");
			if ($row[csf("emb_name")] == 1) $em_type = $emblishment_print_type[$row[csf("emb_type")]];
			else if ($row[csf("emb_name")] == 2) $em_type = $emblishment_embroy_type[$row[csf("emb_type")]];
			else if ($row[csf("emb_name")] == 3) $em_type = $emblishment_wash_type[$row[csf("emb_type")]];
			else if ($row[csf("emb_name")] == 4) $em_type = $emblishment_spwork_type[$row[csf("emb_type")]];
			else if ($row[csf("emb_name")] == 5) $em_type = $emblishment_gmts_type[$row[csf("emb_type")]];
			$washvariance = $embdataarr[$row[csf("id")]]['washplanamt'] - $embdataarr[$row[csf("id")]]['washorderamt'];
		?>
			<tr>
				<td style="word-break:break-all"><? echo $emblishment_name_array[$row[csf("emb_name")]]; ?></td>
				<td style="word-break:break-all"><? echo $em_type; ?></td>
				<td align="right"><? echo fn_number_format($row[csf("cons_dzn_gmts")], 4); ?></td>
				<td align="right"><? echo fn_number_format($embdataarr[$row[csf("id")]]['washorderqty'], 4); ?></td>
				<td align="right"><? echo fn_number_format($embdataarr[$row[csf("id")]]['washplanqty'], 4); ?></td>
				<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
				<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
				<td align="right"><? echo fn_number_format($embdataarr[$row[csf("id")]]['washorderamt'], 4); ?></td>
				<td align="right"><? echo fn_number_format($embdataarr[$row[csf("id")]]['washplanamt'], 4); ?></td>
				<td align="right"><? echo fn_number_format($washvariance, 4); ?></td>
				<td align="right"><? echo fn_number_format($row[csf("amount")] / $summary_data[price_dzn] * 100, 2); ?>%</td>
			</tr>
		<?
			$washamtdzn += $row[csf("amount")];
			$washorderamt += $embdataarr[$row[csf("id")]]['washorderamt'];
			$washplanamt += $embdataarr[$row[csf("id")]]['washplanamt'];
			$washvariancetot += $washvariance;
		}
		?>
		<tr class="rpt_bottom" style="font-weight:bold">
			<td colspan="6">Gmts. Wash Total :</td>
			<td align="right"><? echo fn_number_format($washamtdzn, 4); ?></td>
			<td align="right"><? echo fn_number_format($washorderamt, 4); ?></td>
			<td align="right"><? echo fn_number_format($washplanamt, 4); ?></td>
			<td align="right"><? echo fn_number_format($washvariancetot, 4); ?></td>
			<td align="right"><? echo fn_number_format($washamtdzn / $summary_data[price_dzn] * 100, 2); ?>%</td>
		</tr>
	</table>
</div>
<?
	} else {
		if ($wash_cost > 0) {
?>
	<div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:1000px;text-align:center;" rules="all">
			<label><b>Gmts. Wash Details</b></label>
			<tr style="font-weight:bold">
				<td width="150">Particulars</td>
				<td width="150">Type</td>
				<td width="70">Cons/<? echo $costing_for; ?></td>
				<td width="80">Gmts. Qnty on Order Qty.</td>
				<td width="80">Gmts. Qnty on Plan Cut Qty.</td>
				<td width="70">Rate [USD]</td>
				<td width="70">Amount/<? echo $costing_for; ?> [USD]</td>
				<td width="80">Amount On Order Qty.</td>
				<td width="80">Amount On Plan Cut Qty.</td>
				<td width="80">Variance</td>
				<td>% to Ord. Value</td>
			</tr>
			<?
			$total_amount = 0;
			foreach ($data_array as $row) {
				$em_type = "";
				//$emblishment_name_array=array(1=>"Printing",2=>"Embroidery",3=>"Wash",4=>"Special Works",5=>"Others");
				if ($row[csf("emb_name")] == 1) $em_type = $emblishment_print_type[$row[csf("emb_type")]];
				else if ($row[csf("emb_name")] == 2) $em_type = $emblishment_embroy_type[$row[csf("emb_type")]];
				else if ($row[csf("emb_name")] == 3) $em_type = $emblishment_wash_type[$row[csf("emb_type")]];
				else if ($row[csf("emb_name")] == 4) $em_type = $emblishment_spwork_type[$row[csf("emb_type")]];
				else if ($row[csf("emb_name")] == 5) $em_type = $emblishment_gmts_type[$row[csf("emb_type")]];
				$washvariance = $embdataarr[$row[csf("id")]]['washplanamt'] - $embdataarr[$row[csf("id")]]['washorderamt'];
			?>
				<tr>
					<td style="word-break:break-all"><? echo $emblishment_name_array[$row[csf("emb_name")]]; ?></td>
					<td style="word-break:break-all"><? echo $em_type; ?></td>
					<td align="right"><? echo fn_number_format($row[csf("cons_dzn_gmts")], 4); ?></td>
					<td align="right"><? echo fn_number_format($embdataarr[$row[csf("id")]]['washorderqty'], 4); ?></td>
					<td align="right"><? echo fn_number_format($embdataarr[$row[csf("id")]]['washplanqty'], 4); ?></td>
					<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
					<td align="right"><? echo fn_number_format($row[csf("amount")], 4); ?></td>
					<td align="right"><? echo fn_number_format($embdataarr[$row[csf("id")]]['washorderamt'], 4); ?></td>
					<td align="right"><? echo fn_number_format($embdataarr[$row[csf("id")]]['washplanamt'], 4); ?></td>
					<td align="right"><? echo fn_number_format($washvariance, 4); ?></td>
					<td align="right"><? echo fn_number_format($row[csf("amount")] / $summary_data[price_dzn] * 100, 2); ?>%</td>
				</tr>
			<?
				$washamtdzn += $row[csf("amount")];
				$washorderamt += $embdataarr[$row[csf("id")]]['washorderamt'];
				$washplanamt += $embdataarr[$row[csf("id")]]['washplanamt'];
				$washvariancetot += $washvariance;
			}
			?>
			<tr class="rpt_bottom" style="font-weight:bold">
				<td colspan="6">Gmts. Wash Total :</td>
				<td align="right"><? echo fn_number_format($washamtdzn, 4); ?></td>
				<td align="right"><? echo fn_number_format($washorderamt, 4); ?></td>
				<td align="right"><? echo fn_number_format($washplanamt, 4); ?></td>
				<td align="right"><? echo fn_number_format($washvariancetot, 4); ?></td>
				<td align="right"><? echo fn_number_format($washamtdzn / $summary_data[price_dzn] * 100, 2); ?>%</td>
			</tr>
		</table>
	</div>
<?
		} else {
			echo "";
		}
	}
	//End Wash Details Part report here -------------------------------------------


	//start	Commercial Cost part report here -------------------------------------------
	$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
?>
<div style="margin-top:15px">
	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:500px;text-align:center;" rules="all">
		<label><b>Commercial Cost</b></label>
		<tr style="font-weight:bold">
			<td width="150">Particulars</td>
			<td width="100">Rate In %</td>
			<td width="100">Amount/<? echo $costing_for; ?> [USD]</td>
			<td>Amount on Order Qty.</td>
		</tr>
		<?
		$total_amount = 0;
		foreach ($data_array as $row) {
			$rate_per = $row[csf("rate")] / 100;
		?>
			<tr>
				<td align="left"><? echo $camarcial_items[$row[csf("item_id")]]; ?></td>
				<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
				<td align="right"><? echo fn_number_format($subdznamt * $rate_per, 4); ?></td>
				<td align="right"><? echo fn_number_format($subpoamt * $rate_per, 4); ?></td>
			</tr>
		<?
			$total_commercialamountdzn += $subdznamt * $rate_per;
			$total_commercialamount += $subpoamt * $rate_per;
			//$total_commercialamount += $CommarData[$row[csf("id")]]['amount'];
		}
		?>
		<tr class="rpt_bottom" style="font-weight:bold">
			<td colspan="2">Total</td>
			<td align="right"><? echo fn_number_format($total_commercialamountdzn, 4); ?></td>
			<td align="right"><? echo fn_number_format($total_commercialamount, 4); ?></td>
		</tr>
	</table>
</div>
<?
	} else {
		if ($comm_cost > 0) {
?>
	<div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:500px;text-align:center;" rules="all">
			<label><b>Commercial Cost</b></label>
			<tr style="font-weight:bold">
				<td width="150">Particulars</td>
				<td width="100">Rate In %</td>
				<td width="100">Amount/<? echo $costing_for; ?> [USD]</td>
				<td>Amount on Order Qty.</td>
			</tr>
			<?
			$total_amount = 0;
			foreach ($data_array as $row) {
			?>
				<tr>
					<td align="left"><? echo $camarcial_items[$row[csf("item_id")]]; ?></td>
					<td align="right"><? echo fn_number_format($row[csf("rate")], 4); ?></td>
					<td align="right"><? echo fn_number_format($subdznamt * $rate_per, 4); ?></td>
					<td align="right"><? echo fn_number_format($subpoamt * $rate_per, 4); ?></td>
				</tr>
			<?
				/*  $total_commercialamountdzn += $row[csf("amount")];
				 $total_commercialamount += $CommarData[$row[csf("id")]]['amount']; */
				$total_commercialamountdzn += $subdznamt * $rate_per;
				$total_commercialamount += $subpoamt * $rate_per;
			}
			?>
			<tr class="rpt_bottom" style="font-weight:bold">
				<td colspan="2">Total</td>
				<td align="right"><? echo fn_number_format($total_commercialamountdzn, 4); ?></td>
				<td align="right"><? echo fn_number_format($total_commercialamount, 4); ?></td>
			</tr>
		</table>
	</div>
<?
		} else {
			echo "";
		}
	}
	//End Commercial Cost Part report here -------------------------------------------


	//start	Commission Cost part report here -------------------------------------------
	$sql = "select id, job_no, particulars_id, commission_base_id, commision_rate, commission_amount, status_active from wo_pre_cost_commiss_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$data_array = sql_select($sql);
	if ($zero_value == 1) {
?>
<div style="margin-top:15px">
	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:600px;text-align:center;" rules="all">
		<label><b>Commission Cost</b></label>
		<tr style="font-weight:bold">
			<td width="150">Particulars</td>
			<td width="150">Commission Basis</td>
			<td width="100">Rate [USD]</td>
			<td width="100">Amount/<? echo $costing_for; ?> [USD]</td>
			<td>Tot. Amount</td>
		</tr>
		<?
		$total_amount = 0;
		foreach ($data_array as $row) {
		?>
			<tr>
				<td><? echo $commission_particulars[$row[csf("particulars_id")]]; ?></td>
				<td><? echo $commission_base_array[$row[csf("commission_base_id")]]; ?></td>
				<td align="right"><? echo fn_number_format($row[csf("commision_rate")], 4); ?></td>
				<td align="right"><? echo fn_number_format($row[csf("commission_amount")], 4); ?></td>
				<td align="right"><? echo fn_number_format($CommiData[$row[csf("id")]]['commission_amount'], 4); ?></td>
			</tr>
		<?
			$total_commiamountdzn += $row[csf("commission_amount")];
			$total_commiamount += $CommiData[$row[csf("id")]]['commission_amount'];
		}
		?>
		<tr class="rpt_bottom" style="font-weight:bold">
			<td colspan="3">Total</td>
			<td align="right"><? echo fn_number_format($total_commiamountdzn, 4); ?></td>
			<td align="right"><? echo fn_number_format($total_commiamount, 4); ?></td>
		</tr>
	</table>
</div>
<?
	} else {
		if ($totCommi > 0) {
?>
	<div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:600px;text-align:center;" rules="all">
			<label><b>Commission Cost</b></label>
			<tr style="font-weight:bold">
				<td width="150">Particulars</td>
				<td width="150">Commission Basis</td>
				<td width="100">Rate [USD]</td>
				<td width="100">Amount/<? echo $costing_for; ?> [USD]</td>
				<td>Tot. Amount</td>
			</tr>
			<?
			$total_amount = 0;
			foreach ($data_array as $row) {
			?>
				<tr>
					<td><? echo $commission_particulars[$row[csf("particulars_id")]]; ?></td>
					<td><? echo $commission_base_array[$row[csf("commission_base_id")]]; ?></td>
					<td align="right"><? echo fn_number_format($row[csf("commision_rate")], 4); ?></td>
					<td align="right"><? echo fn_number_format($row[csf("commission_amount")], 4); ?></td>
					<td align="right"><? echo fn_number_format($CommiData[$row[csf("id")]]['commission_amount'], 4); ?></td>
				</tr>
			<?
				$total_commiamountdzn += $row[csf("commission_amount")];
				$total_commiamount += $CommiData[$row[csf("id")]]['commission_amount'];
			}
			?>
			<tr class="rpt_bottom" style="font-weight:bold">
				<td colspan="3">Total</td>
				<td align="right"><? echo fn_number_format($total_commiamountdzn, 4); ?></td>
				<td align="right"><? echo fn_number_format($total_commiamount, 4); ?></td>
			</tr>
		</table>
	</div>
<?
		} else {
			echo "";
		}
	}
	//End Commission Cost Part report here -------------------------------------------


	//start	Other Components part report here -------------------------------------------
	if ($zero_value == 1) {
?>
<div style="margin-top:15px">
	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:400px;text-align:center;" rules="all">
		<label><b>Others Components</b></label>
		<tr style="font-weight:bold">
			<td width="150">Particulars</td>
			<td width="100">Amount/<? echo $costing_for; ?> [USD]</td>
			<td>Amount on Order Qty.</td>
		</tr>
		<tr>
			<td align="left">Lab Test </td>
			<td align="right"><? echo fn_number_format($summary_data[lab_test_dzn], 4); ?></td>
			<td align="right"><? echo fn_number_format($summary_data[lab_test_order], 4); ?></td>
		</tr>
		<tr>
			<td align="left">Inspection Cost</td>
			<td align="right"><? echo fn_number_format($summary_data[inspection_dzn], 4); ?></td>
			<td align="right"><? echo fn_number_format($summary_data[inspection_order], 4); ?></td>
		</tr>
		<tr>
			<td align="left">CM Cost - IE</td>
			<td align="right"><? echo fn_number_format($summary_data[cm_cost_dzn], 4); ?></td>
			<td align="right"><? echo fn_number_format($summary_data[cm_cost_order], 4); ?></td>
		</tr>
		<tr>
			<td align="left">Freight Cost</td>
			<td align="right"><? echo fn_number_format($summary_data[freight_dzn], 4); ?></td>
			<td align="right"><? echo fn_number_format($summary_data[freight_order], 4); ?></td>
		</tr>
		<tr>
			<td align="left">Currier Cost</td>
			<td align="right"><? echo fn_number_format($summary_data[currier_dzn], 4); ?></td>
			<td align="right"><? echo fn_number_format($summary_data[currier_order], 4); ?></td>
		</tr>
		<tr>
			<td align="left">Certificate Cost</td>
			<td align="right"><? echo fn_number_format($summary_data[certificate_dzn], 4); ?></td>
			<td align="right"><? echo fn_number_format($summary_data[certificate_order], 4); ?></td>
		</tr>
		<tr>
			<td align="left">Design Cost</td>
			<td align="right"><? echo fn_number_format($summary_data[design_dzn], 4); ?></td>
			<td align="right"><? echo fn_number_format($summary_data[design_order], 4); ?></td>
		</tr>
		<tr>
			<td align="left">Studio Cost</td>
			<td align="right"><? echo fn_number_format($summary_data[studio_dzn], 4); ?></td>
			<td align="right"><? echo fn_number_format($summary_data[studio_order], 4); ?></td>
		</tr>
		<tr>
			<td align="left">Deprec. & Amort.</td>
			<td align="right"><? echo fn_number_format($summary_data[depr_amor_dzn], 4); ?></td>
			<td align="right"><? echo fn_number_format($summary_data[depr_amor_order], 4); ?></td>
		</tr>
		<tr>
			<td align="left">Interest</td>
			<td align="right"><? echo fn_number_format($summary_data[interest_dzn], 4); ?></td>
			<td align="right"><? echo fn_number_format($summary_data[interest_order], 4); ?></td>
		</tr>
		<tr>
			<td align="left">Income Tax </td>
			<td align="right"><? echo fn_number_format($summary_data[incometax_dzn], 4); ?></td>
			<td align="right"><? echo fn_number_format($summary_data[incometax_order], 4); ?></td>
		</tr>
		<tr>
			<td align="left">Incentives Missing Cost </td>
			<td align="right"><? echo fn_number_format($summary_data[incentives_dzn], 4); ?></td>
			<td align="right"><? echo fn_number_format($summary_data[incentives_order], 4); ?></td>
		</tr>
		<?
		$total_amountdzn += $summary_data[lab_test_dzn] + $summary_data[inspection_dzn] + $summary_data[cm_cost_dzn] + $summary_data[freight_dzn] + $summary_data[currier_dzn] + $summary_data[certificate_dzn] + $summary_data[design_dzn] + $summary_data[studio_dzn] + $summary_data[depr_amor_dzn] + $summary_data[interest_dzn] + $summary_data[incometax_dzn] + $summary_data[incentives_dzn];

		$total_amount += $summary_data[lab_test_order] + $summary_data[inspection_order] + $summary_data[cm_cost_order] + $summary_data[freight_order] + $summary_data[currier_order] + $summary_data[certificate_order] + $summary_data[design_order] + $summary_data[studio_order] + $summary_data[depr_amor_order] + $summary_data[interest_order] + $summary_data[incometax_order] + $summary_data[incentives_order];

		?>
		<tr class="rpt_bottom" style="font-weight:bold">
			<td>Total</td>
			<td align="right"><? echo fn_number_format($total_amountdzn, 4); ?></td>
			<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
		</tr>
	</table>
	<table style="float:left;width:65%">
		<tr>
			<td>
				<?
				$sql = "select id,master_tble_id,image_location from common_photo_library where master_tble_id=" . $txt_job_no . "";
				$data_array = sql_select($sql);
				?>
				<div>
					<? foreach ($data_array as $inf) { ?>
						<img src='<?= $img_path ?><? echo $inf[csf("image_location")]; ?>' height='97' width='89' />
					<?  } ?>
				</div>
			</td>
		</tr>
	</table>
</div>
<?
	} else {
		if ($summary_data[lab_test_dzn] > 0 || $summary_data[inspection_dzn] > 0 || $summary_data[cm_cost_dzn] > 0 || $summary_data[freight_dzn] > 0 || $common_oh > 0) {
?>
	<div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
			<label><b>Others Components</b></label>
			<tr style="font-weight:bold">
				<td width="150">Particulars</td>
				<td width="100">Amount/<? echo $costing_for; ?> [USD]</td>
				<td>Amount on Order Qty.</td>
			</tr>
			<?
			$total_amountdzn = $total_amount = 0;
			if ($summary_data[lab_test_dzn] > 0) {
			?>
				<tr>
					<td align="left" s>Lab Test </td>
					<td align="right"><? echo fn_number_format($summary_data[lab_test_dzn], 4); ?></td>
					<td align="right"><? echo fn_number_format($summary_data[lab_test_order], 4); ?></td>
				</tr>
			<?
			}
			if ($summary_data[inspection_dzn] > 0) {
			?>
				<tr>
					<td align="left">Inspection Cost</td>
					<td align="right"><? echo fn_number_format($summary_data[inspection_dzn], 4); ?></td>
					<td align="right"><? echo fn_number_format($summary_data[inspection_order], 4); ?></td>
				</tr>
			<?
			}
			if ($summary_data[cm_cost_dzn] > 0) {
			?>
				<tr>
					<td align="left">CM Cost - IE</td>
					<td align="right"><? echo fn_number_format($summary_data[cm_cost_dzn], 4); ?></td>
					<td align="right"><? echo fn_number_format($summary_data[cm_cost_order], 4); ?></td>
				</tr>
			<?
			}
			if ($summary_data[freight_dzn] > 0) {
			?>
				<tr>
					<td align="left">Freight Cost</td>
					<td align="right"><? echo fn_number_format($summary_data[freight_dzn], 4); ?></td>
					<td align="right"><? echo fn_number_format($summary_data[freight_order], 4); ?></td>
				</tr>
			<?
			}
			$total_amountdzn += $summary_data[lab_test_dzn] + $summary_data[inspection_dzn] + $summary_data[cm_cost_dzn] + $summary_data[freight_dzn];
			$total_amount += $summary_data[lab_test_order] + $summary_data[inspection_order] + $summary_data[cm_cost_order] + $summary_data[freight_order];
			?>
			<tr class="rpt_bottom" style="font-weight:bold">
				<td>Total</td>
				<td align="right"><? echo fn_number_format($total_amountdzn, 4); ?></td>
				<td align="right"><? echo fn_number_format($total_amount, 4); ?></td>
			</tr>
		</table>

	</div>
<?
		} else {
			echo "";
		}
?>
<table style="float:left;width:65%">
	<tr>
		<td>
			<?
			$sql = "select id,master_tble_id,image_location from common_photo_library where master_tble_id=" . $txt_job_no . "";
			$data_array = sql_select($sql);
			?>
			<div>
				<? foreach ($data_array as $inf) { ?>
					<img src='<?= $img_path ?><? echo $inf[csf("image_location")]; ?>' height='97' width='89' />
				<?  } ?>
			</div>
		</td>
	</tr>
</table>
<?
	}
?>

<div style="clear:both"></div>
</div>
<!--End CM on Net Order Value Part report here -->
<? echo '<b>Note: &nbsp;' . $remarks; ?></b><br /><br />
<br />
<?= signature_table(109, $cbo_company_name, "860px");
	$mailBody = ob_get_contents();
	ob_clean();
	//Mail send------------------------------------------
	list($msil_address, $is_mail_send) = explode('**', $mail_data);
	if ($is_mail_send == 1) {
		$data_array = sql_select("select b.id, b.job_no, b.fabric_cost, b.fabric_cost_percent, b.trims_cost, b.trims_cost_percent, b.embel_cost, b.embel_cost_percent, b.wash_cost, b.wash_cost_percent, b.comm_cost, b.comm_cost_percent, b.commission, b.commission_percent, b.lab_test, b.lab_test_percent, b.inspection, b.inspection_percent, b.cm_cost,  b.freight,  b.currier_pre_cost, b.certificate_pre_cost, b.certificate_percent, b.common_oh, b.depr_amor_pre_cost, b.depr_amor_po_price, b.total_cost, b.total_cost_percent, b.price_dzn, b.price_dzn_percent, b.margin_dzn, b.margin_dzn_percent, b.cost_pcs_set,  b.price_pcs_or_set,  b.margin_pcs_set, b.cm_for_sipment_sche, b.deffdlc_cost,  b.interest_cost,  b.incometax_cost, b.design_cost, b.design_percent, b.studio_cost, c.job_no_prefix_num, c.buyer_name, c.style_ref_no,c.job_quantity, c.quotation_id from wo_pre_cost_mst a ,wo_pre_cost_dtls b,wo_po_details_master c where a.job_no=b.job_no and  a.job_no=c.job_no and a.job_no=" . $txt_job_no . "  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0");

		$material_cost = $data_array[0][csf('fabric_cost')] + $data_array[0][csf('trims_cost')];
		$other_cost = $data_array[0]['LAB_TEST'] + $data_array[0]['INSPECTION'] + $data_array[0]['FREIGHT'] + $data_array[0]['CURRIER_PRE_COST'] + $data_array[0]['CERTIFICATE_PRE_COST'] + $data_array[0]['DESIGN_COST'] + $data_array[0]['STUDIO_COST'] + $data_array[0]['DEPR_AMOR_PRE_COST'] + $data_array[0]['INTEREST_COST'] + $data_array[0]['INCOMETAX_COST'] + $data_array[0]['COMMON_OH'];
		$quotation_id = $data_array[0][csf('quotation_id')];

		$bodymail = "
	<p>Dear Sir</p> 
	<p>Attached Please Find the cost break ups</p> 
<table>
	<tr>	
		<td><b>Job No</b></td>
		<td>:" . $data_array[0][csf('job_no')] . "</td>
	</tr>
	<tr>	
		<td><b>Buyer Name</b></td>
		<td>:" . $buyer_arr[$data_array[0][csf('buyer_name')]] . "</td>
	</tr>
	<tr>	
		<td><b>Style Ref</b></td>
		<td>:" . $data_array[0][csf('style_ref_no')] . "</td>
	</tr>
	<tr>	
		<td><b>Style Qty. (Pcs)</b></td>
		<td>:" . $data_array[0][csf('job_quantity')] . "</td>
	</tr>
	<tr>	
		<td><b>Delivery</b></td>
		<td>:" . change_date_format(max($pulish_ship_date_arr)) . "</td>
	</tr>
	<tr>	
		<td><b>Material Cost</b></td>
		<td>:" . number_format($material_cost, 4, '.', '') . "</td>
	</tr>
	<tr>	
		<td><b>Embellishment Cost</b></td>
		<td>:" . number_format($data_array[0][csf('embel_cost')], 4, '.', '') . "</td>
	</tr>
	<tr>	
		<td><b>Wash Cost</b></td>
		<td>:" . number_format($data_array[0][csf('wash_cost')], 4, '.', '') . "</td>
	</tr>
	<tr>	
		<td><b>Other Cost</b></td>
		<td>:" . number_format($other_cost, 4, '.', '') . "</td>
	</tr>
	<tr>	
		<td><b>CM Cost</b></td>
		<td>:" . number_format($data_array[0][csf('cm_cost')], 4, '.', '') . "</td>
	</tr>
	<tr>	
		<td><b>Total Cost</b></td>
		<td>:" . number_format($data_array[0][csf('total_cost')], 4, '.', '') . "</td>
	</tr>
	<tr>	
		<td><b>FOB Price /Dzn	</b></td>
		<td>:" . number_format($data_array[0][csf('price_dzn')], 4, '.', '') . "</td>
	</tr>
	<tr>	
		<td><b>Margin Value /Dzn</b></td>
		<td>:" . number_format($data_array[0][csf('margin_dzn')], 4, '.', '') . "</td>
	</tr>
	<tr>	
		<td><b>Margin Value  (%) /Dzn</b></td>
		<td>:" . number_format($data_array[0][csf('margin_dzn_percent')], 2, '.', '') . "</td>
	</tr>
</table>
<p>kindly review and advise approval please</p> 
";

		echo "mail_sent";

		require_once('../../../mailer/class.phpmailer.php');
		require_once('../../../auto_mail/setting/mail_setting.php');

		$mailBody = preg_replace("/<img[^>]+\>/i", " ", $mailBody);
		$mailToArr = array();
		if ($msil_address) {
			$mailToArr[] = $msil_address;
		}


		$sql = "SELECT a.BRAND_IDS,a.BUYER_IDS,c.email_address as MAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id  and a.mail_item=b.MAIL_ITEM_MST and a.mail_item=89 and b.mail_user_setup_id=c.id and a.company_id =" . $cbo_company_name . "  and   A.IS_DELETED=0 and A.STATUS_ACTIVE=1  and b.IS_DELETED=0 and b.STATUS_ACTIVE=1  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
		$mail_sql = sql_select($sql);
		$receverMailArr = array();
		foreach ($mail_sql as $row) {
			$mailToArr[] = $row[MAIL];
		}

		$elcetronicSql = "SELECT a.BUYER_ID,a.SEQUENCE_NO,a.BYPASS,b.USER_EMAIL  from electronic_approval_setup a join user_passwd b on a.user_id=b.id where b.valid=1  AND a.entry_form=15 and a.company_id=$cbo_company_name order by a.SEQUENCE_NO";
		//echo $elcetronicSql;die;

		$elcetronicSqlRes = sql_select($elcetronicSql);
		foreach ($elcetronicSqlRes as $rows) {

			if ($rows[BUYER_ID] != '') {
				foreach (explode(',', $rows[BUYER_ID]) as $bi) {
					if ($rows[USER_EMAIL] != '' && $bi == $buyer_name_id) {
						$mailToArr[] = $rows[USER_EMAIL];
					}
					if ($rows[BYPASS] == 2) {
						break;
					}
				}
			} else {
				if ($rows[USER_EMAIL]) {
					$mailToArr[] = $rows[USER_EMAIL];
				}
				if ($rows[BYPASS] == 2) {
					break;
				}
			}
		}
		$to = implode(',', array_unique($mailToArr));
		$mailBody = $bodymail;
		$subject = "Pre Cost Entry Report";
		$header = mailHeader();
		echo sendMailMailer($to, $subject, $mailBody, $from_mail, $att_file_arr) . $to;
	} else {
		echo $mailBody;
	}
	//------------------------------------End;
	exit();
}

if ($action == "budgetsheet2v3") //MD. SAKIB
{
	///extract($_REQUEST);
	$process = array(&$_POST);
	extract(check_magic_quote_gpc($process));
	$txt_costing_date = change_date_format(str_replace("'", "", $txt_costing_date), 'yyyy-mm-dd', '-');
	if ($txt_job_no == "") $job_no = '';
	else $job_no = " and a.job_no=" . $txt_job_no . "";
	if ($cbo_company_name == "") $company_name = '';
	else $company_name = " and a.company_name=" . $cbo_company_name . "";
	if ($cbo_buyer_name == "") $cbo_buyer_name = '';
	else $cbo_buyer_name = " and a.buyer_name=" . $cbo_buyer_name . "";
	if ($txt_style_ref == "") $txt_style_ref = '';
	else $txt_style_ref = " and a.style_ref_no=" . $txt_style_ref . "";
	if ($txt_costing_date == "") $txt_costing_date = '';
	else $txt_costing_date = " and c.costing_date='" . $txt_costing_date . "'";
	$txt_po_breack_down_id = str_replace("'", '', $txt_po_breack_down_id);
	if (str_replace("'", '', $txt_po_breack_down_id) == "") {
		$txt_po_breack_down_id_cond = '';
		$txt_po_breack_down_id_cond1 = '';
		$txt_po_breack_down_id_cond2 = '';
		$txt_po_breack_down_id_cond3 = '';
	} else {
		$txt_po_breack_down_id_cond = " and b.id in(" . $txt_po_breack_down_id . ")";
		$txt_po_breack_down_id_cond1 = " and id in(" . $txt_po_breack_down_id . ")";
		$txt_po_breack_down_id_cond2 = " and po_break_down_id in(" . $txt_po_breack_down_id . ")";
		$txt_po_breack_down_id_cond3 = " and b.id in(" . $txt_po_breack_down_id . ")";
	}

	//array for display name
	$buyer_arr = return_library_array("select id, buyer_name from lib_buyer", 'id', 'buyer_name');
	$sesson_arr = return_library_array("select id, season_name from lib_buyer_season", 'id', 'season_name');
	$brand_arr = return_library_array("select id, brand_name from lib_buyer_brand", 'id', 'brand_name');
	$comp = return_library_array("select id, company_name from lib_company", 'id', 'company_name');
	$color_library = return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$fabric_composition_arr = return_library_array("select id, fabric_composition_name from lib_fabric_composition", 'id', 'fabric_composition_name');
	$photo_data_array = sql_select("SELECT id,master_tble_id,image_location from common_photo_library where master_tble_id=$txt_job_no and file_type=1  and rownum=1");

	if ($db_type == 0) $group_gsm = "group_concat( distinct b.gsm_weight) AS gsm_weight";
	if ($db_type == 2) $group_gsm = "listagg(b.gsm_weight ,',') within group (order by b.gsm_weight) AS gsm_weight";

	$gsm_weight_top = return_field_value("$group_gsm", "lib_body_part a,wo_pre_cost_fabric_cost_dtls b", "a.id=b.body_part_id and b.job_no=$txt_job_no and b.status_active=1 and b.is_deleted=0 and a.body_part_type in(1,20)", "gsm_weight");
	$gmtsitem_ratio_array = array();
	$grmnt_items = "";
	$grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no=$txt_job_no");
	foreach ($grmts_sql as $key => $val) {
		$grmnt_items .= $garments_item[$val[csf("gmts_item_id")]] . ",";
		$gmtsitem_ratio_array[$val[csf('job_no')]][$val[csf('gmts_item_id')]] = $val[csf('set_item_ratio')];
		$set_item_ratio += $val[csf('set_item_ratio')];
	}
	$grmnt_items = rtrim($grmnt_items, ",");


	$sql = "SELECT a.job_no,a.company_name, a.buyer_name,a.ship_mode,a.total_set_qnty,a.style_ref_no, a.gmts_item_id,a.order_uom, a.avg_unit_price, a.product_dept, a.season_buyer_wise, a.brand_id, a.style_description, a.job_quantity as job_qty, sum(b.plan_cut) as job_quantity, sum(b.po_quantity) as ord_qty, listagg(cast(b.sc_lc as varchar2(4000)),',') within group (order by b.sc_lc) as sc_lc, c.costing_per,c.costing_date,c.budget_minute,c.approved,a.quotation_id,c.exchange_rate ,c.incoterm,c.sew_effi_percent, c.remarks,c.sew_smv, c.refusing_cause, d.fab_knit_fin_req_kg, d.fab_knit_req_kg, d.fab_woven_req_yds,d.fab_woven_fin_req_yds, d.fab_yarn_req_kg
		from wo_po_details_master a, wo_po_break_down b,wo_pre_cost_mst c left join  wo_pre_cost_sum_dtls d on  c.job_no=d.job_no and d.status_active=1 and d.is_deleted=0
		where a.job_no=b.job_no_mst and b.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted =0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $job_no $txt_po_breack_down_id_cond $company_name $cbo_buyer_name $txt_style_ref group by a.job_no,a.company_name, a.buyer_name,a.style_ref_no, a.gmts_item_id,a.order_uom,a.ship_mode, a.avg_unit_price, a.product_dept, c.incoterm,c.costing_date,c.exchange_rate ,a.quotation_id,c.costing_per,c.sew_effi_percent,c.approved,c.budget_minute, d.fab_knit_req_kg, d.fab_woven_req_yds,d.fab_knit_fin_req_kg,d.fab_woven_fin_req_yds, d.fab_yarn_req_kg,a.job_quantity,a.season_buyer_wise, a.brand_id, a.total_set_qnty,a.style_description, c.remarks, c.refusing_cause,c.sew_smv order by a.job_no"; //a.job_quantity as job_quantity,

	$data_array = sql_select($sql);
	$plan_cut_qty = $data_array[0][csf('job_quantity')];
	$total_set_qnty = $data_array[0][csf('total_set_qnty')];
	$job_qnty = $data_array[0][csf('job_qty')];
	$exchange_rate = $data_array[0][csf('exchange_rate')];
	$is_approved = $data_array[0][csf('approved')];
	//----------------------------------sc lc no--------------------------------------------//
	$sql_lc_sc_po="select a.job_no,a.location_name, a.total_set_qnty, b.id, b.po_number, b.grouping, b.file_no, b.pub_shipment_date  from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst $job_no $txt_po_breack_down_id_cond $company_name $cbo_buyer_name $txt_style_ref and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by b.id";

	$sql_po_data=sql_select($sql_lc_sc_po);
	foreach($sql_po_data as $sql_po_row)
	{
		$po_id_arr[$sql_po_row[csf('id')]]=$sql_po_row[csf('id')];
	}
	$job_in_orders=implode(", ",array_unique(explode(",",substr(trim($job_in_orders),0,-1))));
	$po_id_str= implode( ",",$po_id_arr);

	$sales_contract_sql = sql_select("SELECT a.contract_no,b.wo_po_break_down_id from com_sales_contract a join com_sales_contract_order_info b on a.id=b.com_sales_contract_id where a.status_active=1 and a.is_deleted=0 and b.status_active in(1,7)  and b.wo_po_break_down_id in ($po_id_str) group by a.contract_no, b.wo_po_break_down_id");
	$sales_contract_arr = array();
	if (count($sales_contract_sql) > 0) {
		foreach ($sales_contract_sql as $key => $row) {
			$sales_contract_arr[$row[csf('wo_po_break_down_id')]] = $row[csf('contract_no')];
		}
	}

	$export_lc_sql = sql_select("SELECT a.export_lc_no,b.wo_po_break_down_id from com_export_lc a join com_export_lc_order_info b on a.id=b.com_export_lc_id where a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.wo_po_break_down_id in ($po_id_str) group by a.export_lc_no,b.wo_po_break_down_id");
	$export_lc_arr = array();
	if (count($export_lc_sql) > 0) {
		foreach ($export_lc_sql as $key => $row) {
			$export_lc_arr[$row[csf('wo_po_break_down_id')]] = $row[csf('export_lc_no')];
		}
	}
	$sc_lc_no = "";
	if (count($sales_contract_arr) > 0) {
		$sc_lc_no = implode(",", $sales_contract_arr);
	}
		$sc_lc_no=rtrim($sc_lc_no,',');
		$sc_lc_no=implode(",",array_unique(explode(",",$sc_lc_no)));
	 if (count($export_lc_arr) > 0) {
	 	$lc_sc_no = implode(",", $export_lc_arr);
	 }
	 	$lc_sc_no=rtrim($lc_sc_no,',');
		$lc_sc_no=implode(",",array_unique(explode(",",$lc_sc_no)));
		//----------------------------------sc lc no end --------------------------------------------//
	$preCost_histry = sql_select("SELECT min(a.sew_smv) as sew_smv,min(a.sew_effi_percent) as sew_effi_percent,min(b.margin_dzn_percent) as margin_dzn_percent ,min(b.fabric_cost_percent) as  fabric_cost_percent,min(b.trims_cost_percent ) as trims_cost_percent,min(b.embel_cost_percent) as embel_cost_percent,min(b.wash_cost_percent) as wash_cost_percent ,min(b.comm_cost_percent) as comm_cost_percent ,min(b.commission_percent) as commission_percent,min(b.lab_test_percent) as lab_test_percent,min(b.inspection_percent) as inspection_percent,min(b.cm_cost_percent) as cm_cost_percent,min(b.cm_cost) as cm_cost,min(b.freight_percent) as freight_percent,min(b.currier_percent) as currier_percent,min(b.certificate_percent) as certificate_percent,min(b.common_oh_percent) as common_oh_percent    from  wo_pre_cost_mst_histry a,wo_pre_cost_dtls_histry b where a.job_no=b.job_no and a.job_no=$txt_job_no");

	list($preCost_histry_row) = $preCost_histry;
	$opert_profitloss_percent = $preCost_histry_row[csf('margin_dzn_percent')];
	$fabric_cost_percent = $preCost_histry_row[csf('fabric_cost_percent')];
	$trims_cost_percent = $preCost_histry_row[csf('trims_cost_percent')];
	$embel_cost_percent = $preCost_histry_row[csf('embel_cost_percent')];
	$wash_cost_percent = $preCost_histry_row[csf('wash_cost_percent')];
	$comm_cost_percent = $preCost_histry_row[csf('comm_cost_percent')];
	$commission_percent = $preCost_histry_row[csf('commission_percent')];
	$common_oh_percent = $preCost_histry_row[csf('common_oh_percent')];

	$lab_test_percent = $preCost_histry_row[csf('lab_test_percent')];
	$inspection_percent = $preCost_histry_row[csf('inspection_percent')];
	$cm_cost_percent = $preCost_histry_row[csf('cm_cost_percent')];

	$freight_percent = $preCost_histry_row[csf('freight_percent')];
	$currier_percent = $preCost_histry_row[csf('currier_percent')];
	$certificate_percent = $preCost_histry_row[csf('certificate_percent')];
	//$currier_percent=$preCost_histry_row[csf('currier_percent')];
	$sew_effi_percent = $data_array[0][csf('sew_effi_percent')]; //
	$hissew_effi_percent = $preCost_histry_row[csf('sew_effi_percent')];
	//$sew_smv=$preCost_histry_row[csf('sew_smv')];
	$first_app_date = "";
	$last_app_date = "";
	$revised_no = 0;
	$preCost_approved = sql_select("SELECT max(b.approved_no) as approved_no, min(b.approved_date) as first_app_date, max(b.approved_date) as last_app_date,a.id from wo_pre_cost_mst a, approval_history b where   a.id=b.mst_id and a.job_no=$txt_job_no and b.entry_form=15 group by a.id");
	if (count($preCost_approved) > 0) {
		foreach ($preCost_approved as $preCost_approved_row) {
			$approved_no_row = $preCost_approved_row[csf('approved_no')];
			$fst_date = $preCost_approved_row[csf('first_app_date')];
			$fstapp_date = $fst_date[0];

			$last_date = $preCost_approved_row[csf('last_app_date')];
			$lstapp_date = $last_date[0];
			$precost_id = $preCost_approved_row[csf('id')];
			//if($approved_no_row>1){
			$revised_no = $approved_no_row - 1;
			//}
		}
	}

	//$img_path = (str_replace("'", "", $img_path))? str_replace("'", "", $img_path):'../../';
	$img_path = (str_replace("'", "", $path)) ? str_replace("'", "", $path) : '../';

	//echo $img_path;


	$costing_date = $data_array[0][csf('costing_date')];
	if (is_infinite($costing_date) || is_nan($costing_date)) {
		$costing_date = 0;
	}

	$pre_cost_dtls = "SELECT id,job_no,costing_per_id,order_uom_id,fabric_cost,fabric_cost_percent,trims_cost,trims_cost_percent,embel_cost,embel_cost_percent,comm_cost,comm_cost_percent,commission,commission_percent,lab_test,lab_test_percent,inspection,inspection_percent,cm_cost,cm_cost_percent,freight,freight_percent,common_oh,common_oh_percent,total_cost,total_cost_percent,price_dzn,price_dzn_percent,margin_dzn,margin_dzn_percent,price_pcs_or_set,price_pcs_or_set_percent,margin_pcs_set,margin_pcs_set_percent,cm_for_sipment_sche from wo_pre_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
	$pre_cost_dtls_arr = sql_select($pre_cost_dtls);
	foreach ($pre_cost_dtls_arr as $row) {
		$total_cost = $row[csf("total_cost")];
		$price_dzn = $row[csf("price_dzn")];
		$cm_cost = $row[csf("cm_cost")];
		$embel_cost_dzn = $row[csf("embel_cost")];
	}
	$approval_allow = sql_select("select b.id, b.page_id, b.approval_need, b.allow_partial, b.validate_page,a.setup_date from approval_setup_mst a,approval_setup_dtls b 
			where a.id=b.mst_id and a.company_id=$cbo_company_name and a.status_active=1 and b.page_id=25 and b.status_active=1 and b.is_deleted=0 order by b.id desc ");
	?>
		<div style="width:972px; margin:0 auto; font-family: 'Arial Narrow', Arial, sans-serif;">

			<div style="width:970px; font-size:20px; font-weight:bold">

				<b style="float: left"><? echo $comp[str_replace("'", "", $cbo_company_name)]; ?><br>Budget Sheet</b>
			<? if ($is_approved == 1) 
			{ ?> <b style="left: 50%; margin-left: 240px; color: green;"> This Budget is Approved </b> <? }
			 elseif ($is_approved == 3) {
			if ($approval_allow[0][csf("approval_need")] == 1 && $approval_allow[0][csf("allow_partial")] == 1) {
				$ap_msg = "<b style='left: 50%; margin-left: 240px; color: green;'>This Budget is Approved </b>";
			} else {
				$ap_msg = "<b style='left: 50%; margin-left: 240px; color: green;'>This Budget is Partially Approved </b>";
			}
			echo $ap_msg;
		} else { ?>
		<b style="left: 50%; margin-left: 240px; color: red;">
					This Budget is Not Approved
			</b> 
			<? } ?>
				<b style="float:right;"> <? echo 'Budget Date: '; ?><? echo  date('d-M-y', strtotime($costing_date)); ?> <br><? echo 'Revised No:' . $revised_no; ?> <br><? //echo 'Last Revised Date:'.date('d-M-y',strtotime($last_date)); 
																																											?> </b>
			</div>

			<div style="width:970px; font-size:18px; font-weight:bold">
				<b style="float: left"></b>
				<b style="float:right; font-size:18px; font-weight:bold"> &nbsp; </b>
			</div>

			<?
			$result = sql_select("SELECT id,po_number,pub_shipment_date,grouping,file_no,excess_cut,po_received_date, plan_cut from wo_po_break_down where job_no_mst=$txt_job_no $txt_po_breack_down_id_cond1 and status_active=1 and is_deleted=0 order by po_received_date DESC");
			$job_in_orders = '';
			$public_ship_date = '';
			$job_in_ref = '';
			$job_in_file = '';
			$tot_excess_cut = 0;
			$tot_row = 0;
			foreach ($result as $val) {
				$job_in_orders .= $val[csf('po_number')] . ", ";
				$public_ship_date = $val[csf('pub_shipment_date')];
				$po_received_date = $val[csf('po_received_date')];
				$job_in_ref .= $val[csf('grouping')] . ",";
				$job_in_file .= $val[csf('file_no')] . ",";
				$txt_order_no_arr[$val[csf('id')]] = $val[csf('id')];
				if ($val[csf('excess_cut')] > 0) {
					$tot_row++;
				}
				$tot_excess_cut += $val[csf('excess_cut')];
				$plancutqty += $val[csf('plan_cut')];
			}
			$txt_order_no_id = implode(",", $txt_order_no_arr);
			$job_ref = array_unique(explode(",", rtrim($job_in_ref, ", ")));
			$job_file = array_unique(explode(",", rtrim($job_in_file, ", ")));

			foreach ($job_ref as $ref) {
				$ref_cond .= ", " . $ref;
			}
			$file_con = '';
			foreach ($job_file as $file) {
				if ($file_con == '') $file_cond = $file;
				else $file_cond .= ", " . $file;
			}

			foreach ($data_array as $row) {
				$order_price_per_dzn = 0;
				$order_job_qnty = 0;
				$ord_qty = 0;
				$avg_unit_price = 0;
				$uom = $row[csf("order_uom")];
				$sew_smv = $row[csf("sew_smv")];
				$order_values = $row[csf("job_qty")] * $row[csf("avg_unit_price")];

				$job_in_orders = substr(trim($job_in_orders), 0, -1);
				if ($row[csf("costing_per")] == 1) {
					$order_price_per_dzn = 12;
					$costing_for = "1 DZN";
				} else if ($row[csf("costing_per")] == 2) {
					$order_price_per_dzn = 1;
					$costing_for = "1 PCS";
				} else if ($row[csf("costing_per")] == 3) {
					$order_price_per_dzn = 24;
					$costing_for = "2 DZN";
				} else if ($row[csf("costing_per")] == 4) {
					$order_price_per_dzn = 36;
					$costing_for = "3 DZN";
				} else if ($row[csf("costing_per")] == 5) {
					$order_price_per_dzn = 48;
					$costing_for = "4 DZN";
				} else {
					$order_price_per_dzn = 0;
					$costing_for = "DZN";
				}
				$order_job_qnty = $row[csf("job_qty")];
				//$order_qty = $row[csf("job_qty")]*$set_item_ratio;
				$po_no = str_replace("'", "", $txt_po_breack_down_id);
				$condition = new condition();
				if (str_replace("'", "", $txt_job_no) != '') {
					$condition->job_no("=$txt_job_no");
				}

				if (str_replace("'", "", $txt_po_breack_down_id) != '') {
					$condition->po_id("in($po_no)");
				}
				$condition->init();
				$fabric = new fabric($condition);
				$yarn = new yarn($condition);
				$yarn_costing_arr = $yarn->getJobWiseYarnAmountArray();
				$yarn_qty_amount_arr = $yarn->getJobWiseYarnQtyAndAmountArray();

				$yarnDataWithFabricidArr = $yarn->get_By_Precostfabricdtlsid_YarnQtyAmountArray();

				$fabric = new fabric($condition);
				$fabricAmoutByFabricSource = $fabric->getAmountArray_by_job_knitAndwoven_greyAndfinish();
				$fabricQtyByFabricSource = $fabric->getQtyArray_by_job_knitAndwoven_greyAndfinish_purchase();

				$fabric_qty_arr = $fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
				$fabric_amount_arr = $fabric->getAmountArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
				$conversion = new conversion($condition);
				//echo $conversion->getQuery(); die;
				$conversion_costing_arr_process = $conversion->getAmountArray_by_job();
				$conv_qty_job_process = $conversion->getQtyArray_by_jobAndProcess();
				$conv_amount_job_process = $conversion->getAmountArray_by_jobAndProcess();
				$con_qty_fabric_process = $conversion->getQtyArray_by_fabricAndProcess();
				$con_amount_fabric_process = $conversion->getAmountArray_by_fabricAndProcess();

				$trims = new trims($condition);
				$trims_costing_arr = $trims->getAmountArray_by_job();
				$trims_qty_arr = $trims->getQtyArray_by_job();

				$emblishment = new emblishment($condition);
				$emblishment_costing_arr = $emblishment->getAmountArray_by_job();
				$emb_qty_job_name_arr = $emblishment->getQtyArray_by_jobAndEmbname();
				$emb_amount_job_name_arr = $emblishment->getAmountArray_by_jobAndEmbname();

				$wash = new wash($condition);
				$emblishment_costing_arr_wash = $wash->getAmountArray_by_job();
				$wash_qty_job_name_arr = $wash->getQtyArray_by_jobAndEmbname();
				$wash_amount_job_name_arr = $wash->getAmountArray_by_jobAndEmbname();


				$commercial = new commercial($condition);
				$commercial_costing_arr = $commercial->getAmountArray_by_job();
				$commission = new commision($condition);
				$commission_costing_arr = $commission->getAmountArray_by_job();
				$other = new other($condition);
				$other_costing_arr = $other->getAmountArray_by_job();
				/* echo '<pre>';
		print_r($con_amount_fabric_process); die; */
				$job_no = str_replace("'", "", $txt_job_no);
				// $finishing_arr = array('209','165','33','94','63','171','65','170','156','179','200','208','127','125','84','68','128','190','242','240','192','172','90','218','67','197','73','66','185','142','193','265');


				$finishing_arr = array(
					'2', '3', '4', '25', '26', '32', '33', '34', '36', '37', '38', '39', '40', '60', '61', '62', '63', '64', '65', '66', '67', '68', '69', '70', '71', '72', '73', '74', '75', '76', '77', '78', '79', '80', '81', '82', '83', '84', '85', '86', '87', '88', '89', '90', '91', '92', '93', '94', '100', '101', '120', '121', '122', '123', '124', '125', '127', '128', '129', '130', '131', '132', '133', '134', '135', '136', '137', '138', '139', '140', '141', '142', '143', '144', '145', '146', '147', '148', '149', '150', '151', '152', '153', '154', '155', '156', '157', '158', '159', '160', '161', '162', '163', '164', '165', '166', '167', '168', '169', '170', '171', '172', '173', '174', '175', '176', '177', '178', '179', '180', '181', '182', '183', '184', '185', '186', '187', '188', '189', '190', '191', '192', '193', '194', '195', '196', '197', '198', '199', '200', '201', '202', '203', '204', '205', '206', '207', '208', '209', '210', '211', '212', '213', '214', '215', '216', '217', '218', '219', '220', '221', '222', '223', '224', '225', '226', '227', '228', '229', '230', '231', '232', '233', '234', '235', '236', '237', '238', '239', '240', '241', '242', '243', '244', '245', '246', '247', '248', '249', '250', '251', '252', '253', '254', '255', '256', '257', '258', '259', '260', '261', '262', '263', '264', '265', '266', '267', '268', '269', '270', '271', '272', '273', '274', '275', '276', '277', '278', '279', '280', '281', '282', '283', '284', '285', '286', '287', '288', '289', '290', '291', '292', '293', '294', '295', '296', '297', '298', '299', '300', '303', '304', '305', '306', '307', '308', '309', '310', '311', '312', '313', '314', '315', '316', '317', '318', '319', '320', '321', '322', '323', '324', '325', '326', '327', '328', '329', '330', '331', '332', '333', '334', '335', '336', '337', '338', '339', '340', '341', '342', '343', '344', '345', '346', '347', '348', '349', '350', '351', '352', '353', '354', '355', '356', '357', '358', '359', '360', '361', '362', '363', '364', '365', '366', '367', '368', '369', '370', '371', '372', '373', '374', '375', '376', '377', '378', '379', '380', '381', '382', '383', '384', '385', '386', '387', '388', '389', '390', '391', '392', '393', '394', '395', '396', '397', '398', '399', '400', '401', '402', '403', '404', '405', '406', '407', '408', '409', '410', '411','427'
				);

				

				$total_finishing_amount = 0;
				$total_finishing_qty = 0;
				$other_cost_attr = array('freight', 'certificate_pre_cost', 'deffdlc_cost', 'design_cost', 'common_oh', 'interest_cost', 'incometax_cost', 'depr_amor_pre_cost');
				$total_other_cost = 0;

				foreach ($other_cost_attr as $attr) {
					$total_other_cost += $other_costing_arr[$job_no][$attr];
					$tot_sample_fabric_cost += $other_costing_arr[$job_no]['studio_cost'];
				}
				
				$misc_cost = $other_costing_arr[$job_no]['lab_test'] + $other_costing_arr[$job_no]['currier_pre_cost'] + $commercial_costing_arr[$job_no] + $commission_costing_arr[$job_no] + $total_other_cost;
				
				$sql_conv=sql_select("select a.fabric_description,a.cons_process from  wo_pre_cost_fab_conv_cost_dtls a where  a.job_no=".$txt_job_no."  and a.is_deleted=0 and  a.status_active=1");
				foreach($sql_conv as $rows)
				{
					$cons_processArr[$rows[csf('cons_process')]].=$rows[csf('fabric_description')].',';
				}
				
				foreach ($finishing_arr as $fid) {

					$total_finishing_amount += array_sum($conv_amount_job_process[$job_no][$fid]);
				//	$total_finishing_qty += array_sum($conv_qty_job_process[$job_no][$fid]);
					//echo array_sum($conv_amount_job_process[$job_no][$fid]).'='.$fid.'<br>';

					$fab_ids=rtrim($cons_processArr[$fid],',');
					$fab_idsArr=array_unique(explode(",",$fab_ids));
					if($fab_ids)
					{
						foreach($fab_idsArr as $fabid)
						{
							if($fab_process_chk[$fabid]=="")
							{
								//echo  $fid.'='.$fabid.'='.array_sum($con_qty_fabric_process[$fabid][$fid]).'<br>';
								$total_finishing_qty += array_sum($con_qty_fabric_process[$fabid][$fid]);
								$fab_process_chk[$fabid]=$fabid;
							}
						}
					}

				}

				$total_fabic_cost = 0;
				if (count($conv_amount_job_process[$job_no][31]) > 0) {
					$total_fabic_cost += array_sum($conv_amount_job_process[$job_no][31]) / array_sum($conv_qty_job_process[$job_no][31]);
				}
				$total_fabric_amount += array_sum($conv_amount_job_process[$job_no][31]);
				$total_fabric_per += array_sum($conv_amount_job_process[$job_no][31]) / $order_values * 100;
				if (count($conv_amount_job_process[$job_no][30]) > 0) {
					$total_fabic_cost += array_sum($conv_amount_job_process[$job_no][30]) / array_sum($conv_qty_job_process[$job_no][30]);
				}
				if ($yarn_qty_amount_arr[$job_no]['amount'] != '') {
					$total_fabic_cost += $yarn_qty_amount_arr[$job_no]['amount'] / $yarn_qty_amount_arr[$job_no]['qty'];
				}
				$total_fabric_amount += $yarn_qty_amount_arr[$job_no]['amount'];
				$total_fabric_per += $yarn_qty_amount_arr[$job_no]['amount'] / $order_values * 100;
				if ($total_finishing_amount != 0) {
					$total_fabic_cost += $total_finishing_amount / $total_finishing_qty;
				}
				$total_fabric_amount += $total_finishing_amount;
				$total_fabric_per += $total_finishing_amount / $order_values * 100;
				$total_fabric_amount += array_sum($conv_amount_job_process[$job_no][30]);
				$total_fabric_per += array_sum($conv_amount_job_process[$job_no][30]) / $order_values * 100;
				if (count($conv_amount_job_process[$job_no][35]) > 0) {
					$total_fabic_cost += array_sum($conv_amount_job_process[$job_no][35]) / array_sum($conv_qty_job_process[$job_no][35]);
				}
				$total_fabric_amount += array_sum($conv_amount_job_process[$job_no][35]);
				$total_fabric_per += array_sum($conv_amount_job_process[$job_no][35]) / $order_values * 100;
				if (count($conv_amount_job_process[$job_no][1]) > 0) {
					$total_fabic_cost += array_sum($conv_amount_job_process[$job_no][1]) / array_sum($conv_qty_job_process[$job_no][1]);
				}
				$total_fabric_amount += array_sum($conv_amount_job_process[$job_no][1]);
				$total_fabric_per += array_sum($conv_amount_job_process[$job_no][1]) / $order_values * 100;

				$purchase_amount = array_sum($fabricAmoutByFabricSource['knit']['grey'][$job_no]) + array_sum($fabricAmoutByFabricSource['woven']['grey'][$job_no]);
				$purchase_qty = array_sum($fabricQtyByFabricSource['knit']['grey'][$job_no]) + array_sum($fabricQtyByFabricSource['woven']['grey'][$job_no]);

				$ather_emb_attr = array(4, 5, 6, 99);
				foreach ($ather_emb_attr as $att) {
					$others_emb_amount += $emb_amount_job_name_arr[$job_no][$att];
					$others_emb_qty += $emb_qty_job_name_arr[$job_no][$att];
				}
				$knitting_amount_summ = '';
				$dyeing_amount_summ = '';
				$yds_amount_summ = '';
				$aop_amount_summ = '';
				if (count($conv_amount_job_process[$job_no][1]) > 0) {
					// $knitting_amount_summ = fn_number_format(array_sum($conv_amount_job_process[$job_no][1]),2);
					$knitting_amount_summ = array_sum($conv_amount_job_process[$job_no][1]);
				}
				$yarn_amount_summ = $yarn_qty_amount_arr[$job_no]['amount'];
				$print_amount_summ = $emb_amount_job_name_arr[$job_no][1];
				$emb_amount_summ = $emb_amount_job_name_arr[$job_no][2];
				$wash_amount_summ = $wash_amount_job_name_arr[$job_no][3];
				if (count($conv_amount_job_process[$job_no][31]) > 0) {
					$dyeing_amount_summ =  array_sum($conv_amount_job_process[$job_no][31]);
				}
				if (count($conv_amount_job_process[$job_no][30]) > 0) {
					$yds_amount_summ = array_sum($conv_amount_job_process[$job_no][30]);
				}
				if (count($conv_amount_job_process[$job_no][35]) > 0) {
					$aop_amount_summ = array_sum($conv_amount_job_process[$job_no][35]);
				}
				/*echo '<pre>';
		print_r($conv_amount_job_process); die;*/

				$plan_per = (($plan_cut_qty - $job_qnty) / $job_qnty) * 100;
				$fcm = $cm_cost - ($cm_cost * $plan_per / 100);
				//	echo fn_number_format($fcm,4);
				//$plan_dzn = $row[csf("job_qty")] * $set_item_ratio / 12;
				//$fcm_cm_val = $plan_dzn * $cm_cost;
				$fcm_cm_val=$other_costing_arr[$job_no]['cm_cost'];

				//(($row[csf("job_qty")]*$set_item_ratio)/12)*$cm_cost

				$misc_cost += $other_costing_arr[$job_no]['studio_cost'];
				$total_budget_value = $yarn_amount_summ + $total_finishing_amount + $print_amount_summ + $trims_costing_arr[$job_no] + $yds_amount_summ + $aop_amount_summ + $emb_amount_summ + $knitting_amount_summ + $purchase_amount + $wash_amount_summ + $fcm_cm_val + $dyeing_amount_summ + $others_emb_amount + $misc_cost;

			?>
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px; font-family: 'Arial Narrow', Arial, sans-serif;" rules="all">

					<tr>
						<th rowspan="7">
							<? foreach ($photo_data_array as $inf) { ?>
								<?
								$image_location = return_field_value("image_location", "common_photo_library", "file_type=1 and form_name='company_details' and master_tble_id=$cbo_company_name", "image_location");
								?>

								<img src='<?= $img_path ?><? echo $inf[csf("image_location")]; ?>' height='100px' width='100px' />
							<? } ?>
						</th>
						<th style="background: #D7ECD9">Job No</th>
						<th><? echo $row[csf("job_no")]; ?></th>
						<th style="background: #D7ECD9">OR. Rcv Date</th>
						<th><? echo  date('d-M-y', strtotime($po_received_date)); ?></th>
						<th style="background: #D7ECD9">Order Quantity</th>
						<th style="background: yellow; color: #8B0000;">Price/Pcs</th>
						<th align="right" style="background: yellow; color: #8B0000;">&#36; <? echo $row[csf("avg_unit_price")]; ?> </th>
					</tr>
					<tr>
						<th style="background: #D7ECD9">Buyer</th>
						<th><? echo $buyer_arr[$row[csf("buyer_name")]]; ?></th>
						<th style="background: #D7ECD9">Ship. Date</th>
						<th><? echo  date('d-M-y', strtotime($public_ship_date)); ?></th>
						<th align="center" style="color: #8B0000"><? echo $row[csf("job_qty")]; ?> <? echo $unit_of_measurement[$row[csf("order_uom")]]; ?></th>
						<th style="background: yellow; color: #8B0000;">Order Value</th>
						<th align="right" style="background: yellow; color: #8B0000;">&#36; <?= number_format($order_values, 2);  ?></th>
					</tr>
					<tr>
						<th style="background: #D7ECD9">Prod. Dept</th>
						<th><? echo $product_dept[$row[csf("product_dept")]]; ?></th>
						<th style="background: #D7ECD9">Garments Item</th>
						<th>
							<?
							$grmnt_items = "";
							if ($garments_item[$row[csf("gmts_item_id")]] == "") {

								$grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no=$txt_job_no");
								foreach ($grmts_sql as $key => $val) {
									$grmnt_items .= $garments_item[$val[csf("gmts_item_id")]] . ", ";
									$gmts_item[] = $val[csf("gmts_item_id")];
								}
								$grmnt_items = substr_replace($grmnt_items, "", -1, 1);
							} else {
								$gmts_item = explode(',', $row[csf("gmts_item_id")]);
								$grmnt_items = $garments_item[$row[csf("gmts_item_id")]];
							}
							echo $grmnt_items;
							?>
						</th>
						<th align="center" style="color: #8B0000"><?= $row[csf("job_qty")] * $set_item_ratio . ' Pcs' ?></th>
						<!-- <th style="background: yellow; color: #8B0000;"> <? if ($zero_value == 0) echo "Budget Value"; ?></th>                      
                <th align="right" style="background: yellow; color: #8B0000;"><? if ($zero_value == 0) { ?>
                <? if ($total_budget_value > 0) {
																						echo '&dollar;' . fn_number_format($total_budget_value, 2);
																					} ?><br/>
                <? if ($total_budget_value > 0) {
																						echo fn_number_format($total_budget_value / $order_values * 100, 2) . '%';
																					} ?>
                <? } ?>
                </th>  -->
						<th style="background: #D7ECD9">File No</th>
						<th><? echo $file_cond; ?></th>
					</tr>
					<tr>
						<th style="background: #D7ECD9">Season / Brand</th>
						<th><? echo $sesson_arr[$row[csf("season_buyer_wise")]] . '&nbsp' . $brand_arr[$row[csf("brand_id")]]; ?></th>
						<th>Costing Per: <br><?= $costing_for;  ?></th>
						<th style="background: #D7ECD9">Plan Cut quantity (<? echo fn_number_format((($plan_cut_qty - $job_qnty) / $job_qnty) * 100, 2) . '%' ?>) </td>
						<th align="center" style="color: #8B0000"><?= $row[csf("job_quantity")] * $total_set_qnty . ' Pcs'; //." ". $unit_of_measurement[$row[csf("order_uom")]]; 
																	?></th>
						<!-- <th rowspan="2" style="background: yellow; color: #8B0000;"><? if ($zero_value == 0) echo "Open Value %"; ?></th>                      
                <th rowspan="2" align="right" style="background: yellow; color: #8B0000;"><? if ($zero_value == 0) { ?> &#36;<?
																																$margin_val = $order_values - $total_budget_value;
																																echo fn_number_format($margin_val, 2) . '<br>' . fn_number_format($margin_val / $order_values * 100, 2) . '%';
																															}
																																?></th> -->
						<th style="background: #D7ECD9">Ref No</th>
						<th><? echo ltrim($ref_cond, ", "); ?></th>
					</tr>
					<tr>
						<th style="background: #D7ECD9">Style No</th>
						<th><? $style_no = $row[csf("style_ref_no")];
							echo $row[csf("style_ref_no")]; ?></th>
						<th style="background: #D7ECD9">App. Status</th>
						<th colspan="2"><? if ($row[csf("approved")] == 1) {
											echo "This Budget is Approved ";
										} elseif ($row[csf("approved")] == 3) {
											echo "This Budget is partial Approved";
										} else {
											echo "This Budget is Not  Approved";
										} ?></th>
						<th style="background: #D7ECD9">SMV</th>
						<th>
							<?


							$sews_pcs_sql = sql_select("select gmts_item_id,smv_pcs from wo_po_details_mas_set_details where job_no=$txt_job_no");
							foreach ($sews_pcs_sql as $key => $val) {
								$sew_pcs[$val[csf("gmts_item_id")]] = $val[csf("smv_pcs")];
							}


							echo implode(',', $sew_pcs);
							?>
						</th>
					</tr>
					<tr>
						<th style="background: #D7ECD9">Sc/Lc No</th>
						<th colspan="2"><? echo $sc_lc_no; ?></th>
						<th style="background: #D7ECD9">Remarks</th>
						<th colspan="3"><? echo $row[csf("remarks")]; ?></th>
					</tr>
					<tr>
						<th style="background: #D7ECD9">Style Description</th>
						<th colspan="2"><? echo $row[csf("style_description")]; ?></th>
						<th style="background: #D7ECD9">Refusing Cause</th>
						<th colspan="3"><? echo $row[csf("refusing_cause")]; ?></th>
					</tr>
				</table>

			<?
				$avg_unit_price = $row[csf("avg_unit_price")];
				$ord_qty = $row[csf("ord_qty")];
			}		//end first foearch
			/*echo '<pre>';
			print_r($conv_amount_job_process); die;*/

			$yarnPer = $yarn_qty_amount_arr[$job_no]['amount'] / $yarn_qty_amount_arr[$job_no]['qty'];
			$finishPer = $total_finishing_amount / $total_finishing_qty;
			$ydsPer = array_sum($conv_amount_job_process[$job_no][30]) / array_sum($conv_qty_job_process[$job_no][30]);
			$aopPer = array_sum($conv_amount_job_process[$job_no][35]) / array_sum($conv_qty_job_process[$job_no][35]);
			$knitPer = array_sum($conv_amount_job_process[$job_no][1]) / array_sum($conv_qty_job_process[$job_no][1]);
			$purchPer = $purchase_qty / $purchase_amount;
			$dyePer = array_sum($conv_amount_job_process[$job_no][31]) / array_sum($conv_qty_job_process[$job_no][31]);

			$totFabPer = $yarnPer + $finishPer + $ydsPer + $aopPer + $knitPer + $purchPer + $dyePer;

			//echo $yarnPer.'='.$finishPer.'='.$ydsPer.'='.$aopPer.'='.$knitPer.'='.$purchPer.'='.$dyePer.'='.$totFabPer;
			//echo $other_costing_arr[$job_no]['cm_cost'].'='.$plancutqty.'='.$set_item_ratio;


			?>
			<br>
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px; margin-top: 10px; font-family: 'Arial Narrow', Arial, sans-serif;" rules="all">
				<label style="float:left;background:#CCCCCC; font-size:larger;"><b>Summary </b> </label>
				<tr style="background: #D7ECD9">
					<th colspan="8" width="320">Fabric </th>
					<th colspan="4" width="160">Embellishment</th>
					<th colspan="4" width="160">Trims + CM + Misc + Mrg</th>
					<th style="background: yellow">TTL COST &dollar;</th>
				</tr>
				<tr style="background: #D7ECD9">
					<th align="center">Item</th>
					<th align="center">Cost/Uom</th>
					<th align="center">Amount</th>
					<th align="center">&percnt;</th>
					<th align="center">Item</th>
					<th align="center">Cost/Uom</th>
					<th align="center">Amount</th>
					<th align="center">&percnt;</th>
					<th align="center">Item</th>
					<th align="center">Cost/Dz</th>
					<th align="center">Amount</th>
					<th align="center">&percnt;</th>
					<th align="center">Item</th>
					<th align="center">Cost/Dz</th>
					<th align="center">Amount</th>
					<th align="center">&percnt;</th>
					<th rowspan="5" align="right" style="background: yellow; color: #8B0000"><b>
							<? if ($total_budget_value > 0) {
								echo fn_number_format($total_budget_value, 2, '', '');
							} ?><br /><br />
							<? if ($total_budget_value > 0) {
								echo fn_number_format($total_budget_value / $order_values * 100, 2) . '%';
							} ?></b>
					</th>
				</tr>
				<tr>
					<th align="center">Yarn</th>
					<td align="center"><? if ($yarn_amount_summ > 0) {
											echo fn_number_format($yarn_qty_amount_arr[$job_no]['amount'] / $yarn_qty_amount_arr[$job_no]['qty'], 2);
										} ?></td>
					<td align="right" style="color: #8B0000"><? if ($yarn_amount_summ > 0) {
																	echo '&dollar;' . fn_number_format($yarn_amount_summ, 2);
																} ?></td>
					<td align="right"><? if ($yarn_amount_summ > 0) {
											echo fn_number_format($yarn_qty_amount_arr[$job_no]['amount'] / $order_values * 100, 2) . '%';
										}; ?></td>

					<th align="center">Finishing</th>
					<td align="center" title="<?= $total_finishing_amount . '=' . $total_finishing_qty; ?>"><? if ($total_finishing_amount > 0) {
																												echo fn_number_format($total_finishing_amount / $total_finishing_qty, 2);
																											} ?></td>
					<td align="right" style="color: #8B0000"><? if ($total_finishing_amount > 0) {
																	echo '&dollar;' . fn_number_format($total_finishing_amount, 2);
																} ?></td>
					<td align="right"><? if ($total_finishing_amount > 0) {
											echo fn_number_format($total_finishing_amount / $order_values * 100, 2) . '%';
										} ?></td>
					<?
					$print_amt = $emb_amount_job_name_arr[$job_no][1];
					$print_qty = $emb_qty_job_name_arr[$job_no][1];
					?>
					<th align="center">Print</th>
					<td align="center" title="Amt=<? echo $print_amt; ?>/Qty=<? echo $print_qty; ?>">
						<? if ($print_amount_summ > 0) {
							//echo fn_number_format($emb_amount_job_name_arr[$job_no][1]/$emb_qty_job_name_arr[$job_no][1],2);
							//echo fn_number_format($embel_cost_dzn,2);
							echo fn_number_format($print_amt / $print_qty, 2);
						}  ?></td>
					<td align="right" style="color: #8B0000"><? if ($print_amount_summ > 0) {
																	echo '&dollar;' . fn_number_format($print_amount_summ, 2);
																}  ?></td>
					<td align="right"><? if ($print_amount_summ > 0) {
											echo fn_number_format($emb_amount_job_name_arr[$job_no][1] / $order_values * 100, 2) . '%';
										} ?></td>

					<th align="center">Trim</th>
					<td align="center"><? if ($trims_costing_arr[$job_no] > 0) {
											echo fn_number_format($trims_costing_arr[$job_no] / $order_job_qnty, 2);
										} ?></td>
					<td align="right" style="color: #8B0000"><? if ($trims_costing_arr[$job_no] > 0) {
																	echo '&dollar;' . fn_number_format($trims_costing_arr[$job_no], 2);
																} ?></td>
					<td align="right"><? if ($trims_costing_arr[$job_no] > 0) {
											echo fn_number_format($trims_costing_arr[$job_no] / $order_values * 100, 2) . '%';
										} ?></td>
				</tr>
				<tr>
					<th align="center">Yds</th>
					<td align="center"><? if ($yds_amount_summ > 0) {
											echo fn_number_format(array_sum($conv_amount_job_process[$job_no][30]) / array_sum($conv_qty_job_process[$job_no][30]), 2);
										} ?></td>
					<td align="right" style="color: #8B0000"><? if ($yds_amount_summ > 0) {
																	echo '&dollar;' . fn_number_format($yds_amount_summ, 2);
																} ?></td>
					<td align="right"><? if ($yds_amount_summ > 0) {
											echo fn_number_format(array_sum($conv_amount_job_process[$job_no][30]) / $order_values * 100, 2) . '%';
										} ?></td>

					<th align="center">AOP</th>
					<td align="center"><? if ($aop_amount_summ > 0) {
											echo fn_number_format(array_sum($conv_amount_job_process[$job_no][35]) / array_sum($conv_qty_job_process[$job_no][35]), 2);
										} ?></td>
					<td align="right" style="color: #8B0000"><? if ($aop_amount_summ > 0) {
																	echo '&dollar;' . fn_number_format($aop_amount_summ, 2);
																} ?></td>
					<td align="right"><? if ($aop_amount_summ > 0) {
											echo fn_number_format(array_sum($conv_amount_job_process[$job_no][35]) / $order_values * 100, 2) . '%';
										} ?></td>

					<th align="center">EMB</th>
					<td align="center"><? if ($emb_amount_summ > 0) {
											echo fn_number_format($emb_amount_job_name_arr[$job_no][2] / $emb_qty_job_name_arr[$job_no][2], 2);
										}  ?></td>
					<td align="right" style="color: #8B0000"><? if ($emb_amount_summ > 0) {
																	echo '&dollar;' . fn_number_format($emb_amount_summ, 2);
																}  ?></td>
					<td align="right"><? if ($emb_amount_summ > 0) {
											echo fn_number_format($emb_amount_job_name_arr[$job_no][2] / $order_values * 100, 2) . '%';
										} ?></td>
					<th align="center">MISC</th>
					<td align="center"><? if ($misc_cost > 0) {
											echo fn_number_format($misc_cost / $order_job_qnty * 12, 2);
										} ?></td>
					<td align="right" style="color: #8B0000"><? if ($misc_cost > 0) {
																	echo '&dollar;' . fn_number_format($misc_cost, 2);
																}  ?></td>
					<td align="right"><? if ($misc_cost > 0) {
											echo fn_number_format($misc_cost / $order_values * 100, 2) . '%';
										} ?></td>
				</tr>
				<tr>
					<th align="center">Knitting</th>
					<td align="center"><? if ($knitting_amount_summ != '') {
											echo fn_number_format(array_sum($conv_amount_job_process[$job_no][1]) / array_sum($conv_qty_job_process[$job_no][1]), 2);
										} ?></td>
					<td align="right" style="color: #8B0000"><? if ($knitting_amount_summ != '') {
																	echo  '&dollar;' . $knitting_amount_summ;
																}   ?></td>
					<td align="right"><? if ($knitting_amount_summ != '') {
											echo fn_number_format(array_sum($conv_amount_job_process[$job_no][1]) / $order_values * 100, 2) . '%';
										} ?></td>

					<th align="center">P. Fabric</th>
					<td align="center"><? $total_fabic_cost += $purchase_qty / $purchase_amount;
										if ($purchase_qty > 0 && $purchase_amount > 0) {
											echo fn_number_format($purchase_qty / $purchase_amount, 2);
										} ?></td>
					<td align="right"><? $total_fabric_amount += $purchase_amount;
										if ($purchase_amount) {
											echo '&dollar;' . fn_number_format($purchase_amount, 2);
										} ?></td>
					<td align="right"><? $total_fabric_per += $purchase_amount / $order_values * 100;
										if ($purchase_amount > 0) {
											echo fn_number_format($purchase_amount / $order_values * 100, 2) . '%';
										}  ?></td>

					<th align="center">Wash</th>
					<td align="center"><? if ($wash_amount_summ > 0) {
											echo fn_number_format($wash_amount_job_name_arr[$job_no][3] / $wash_qty_job_name_arr[$job_no][3], 2);
										};  ?></td>
					<td align="right" style="color: #8B0000"><? if ($wash_amount_summ > 0) {
																	echo '&dollar;' . fn_number_format($wash_amount_summ, 2);
																}  ?></td>
					<td align="right"><? if ($wash_amount_summ > 0) {
											echo fn_number_format($wash_amount_job_name_arr[$job_no][3] / $order_values * 100, 2) . '%';
										} ?></td>


					<th align="center" style="color: #8B0000">F.CM</th>
					<td align="center" style="color: #8B0000" title="CM Cost-CM Cost*Plan Per%"><? //if($other_costing_arr[$job_no]['cm_cost']>0){echo fn_number_format(($other_costing_arr[$job_no]['cm_cost']/($plancutqty*$set_item_ratio))*12,2); }
																								echo fn_number_format($fcm, 4);
																								?></td>
					<td align="right" style="color: #8B0000" title="(Order Qnty Pcs(<?= $row[csf("job_qty")]; ?>)*(<?= $set_item_ratio; ?>)/12)*cm cost(<?= $cm_cost; ?>)"><? echo fn_number_format($fcm_cm_val, 2); //if($other_costing_arr[$job_no]['cm_cost']>0){ echo fn_number_format($other_costing_arr[$job_no]['cm_cost'],2); } 
																																											?></td>
					<td align="right"><? if ($fcm_cm_val > 0) {
											echo fn_number_format($fcm_cm_val / $order_values * 100, 2) . '%';
										} ?></td>
				</tr>
				<tr>
					<th align="center">Dyeing</th>
					<td align="center"><? if ($dyeing_amount_summ > 0) {
											echo fn_number_format(array_sum($conv_amount_job_process[$job_no][31]) / array_sum($conv_qty_job_process[$job_no][31]), 2);
										} ?></td>
					<td align="right" style="color: #8B0000"><? if ($dyeing_amount_summ > 0) {
																	echo '&dollar;' . fn_number_format($dyeing_amount_summ, 2);
																} ?></td>
					<td align="right"><? if ($dyeing_amount_summ > 0) {
											echo fn_number_format(array_sum($conv_amount_job_process[$job_no][31]) / $order_values * 100, 2) . '%';
										} ?></td>

					<th align="center" style="color: #8B0000">TOTAL</th>
					<th align="center" style="color: #8B0000"><? if ($total_fabic_cost > 0) {
																	echo fn_number_format($total_fabic_cost, 2);
																} ?></th>
					<th align="right" style="color: #8B0000"><? if ($total_fabric_amount > 0) {
																	echo '&dollar;' . fn_number_format($total_fabric_amount, 2);
																}  ?></th>
					<th align="right" style="color: #8B0000"><? if ($total_fabric_per > 0) {
																	echo fn_number_format($total_fabric_per, 2);
																}  ?></th>

					<th align="center" title="Special works, Garments dyeing, UV print and others.">Others</th>
					<td align="center"><? if ($others_emb_amount > 0) {
											echo fn_number_format($others_emb_amount / $others_emb_qty, 2);
										} ?></td>
					<td align="right"><? if ($others_emb_amount > 0) {
											echo '&dollar;' . fn_number_format($others_emb_amount, 2);
										}  ?></td>
					<td align="right"><? if ($others_emb_amount > 0) {
											echo fn_number_format($others_emb_amount / $order_values * 100, 2);
										}  ?></td>
					<th align="center">Mrg</th>
					<?
					$total_margin_val = $order_values - $total_budget_value;
					?>
					<td align="right" style="color: #8B0000" title="<?= $total_margin_val . '/' . $row[csf("job_qty")] . '*' . $set_item_ratio . '/' . '12'; ?>"><? echo fn_number_format($total_margin_val / ($row[csf("job_qty")] * $set_item_ratio / 12), 2);?></td>
					<td align="right" title="<?= $order_values . '-' . $total_budget_value; ?>" style="color: #8B0000"><? echo '&dollar;' . fn_number_format($total_margin_val, 2); ?></td>
					<td align="right" style="color: #8B0000"><?
																$cv = ($total_margin_val / $order_values * 100);
																if (is_infinite($cv) || is_nan($cv)) {
																	$cv = 0;
																}
																echo fn_number_format($cv, 2) . '%';  ?></td>
				</tr>
				<tr>
					<th align="center" colspan="12"> </th>

					<th align="center">O.CM</th>

					<td align="right" style="color: #8B0000"><? echo '&dollar;' . fn_number_format($cm_cost, 2); ?></td>
					<td align="right" style="color: #8B0000" title="(Order Qnty Pcs(<?= $row[csf("job_qty")]; ?>)*(<?= $set_item_ratio; ?>)/12)*cm cost(<?= $cm_cost; ?>)"><?= $other_costing_arr[$job_no]['cm_cost']; ?>
					</td>
					<td align="right" style="color: #8B0000"></td>
				</tr>
			</table>
			<?
			$location_cpm_cost = 0;
			$cm_min_variable = return_field_value("yarn_iss_with_serv_app as cost_per_minute", "variable_order_tracking", "company_name =" . $cbo_company_name . " and variable_list=67 and is_deleted=0 and status_active=1", "cost_per_minute");
			if ($cm_min_variable == "" || $cm_min_variable == 0) $location_cpm_cost = 0;
			else $location_cpm_cost = $cm_min_variable;
			if ($location_cpm_cost != 1) {
				$sql_std_para = sql_select("select interest_expense, income_tax, cost_per_minute, applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$cbo_company_name and status_active=1 and is_deleted=0 order by id");

				foreach ($sql_std_para as $row) {
					$applying_period_date = change_date_format($row[csf('applying_period_date')], '', '', 1);
					$applying_period_to_date = change_date_format($row[csf('applying_period_to_date')], '', '', 1);
					$diff = datediff('d', $applying_period_date, $applying_period_to_date);
					for ($j = 0; $j < $diff; $j++) {
						//$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);
						$date_all = add_date(str_replace("'", "", $applying_period_date), $j);
						$newdate = change_date_format($date_all, '', '', 1);
						$financial_para[$newdate][interest_expense] = $row[csf('interest_expense')];
						$financial_para[$newdate][income_tax] = $row[csf('income_tax')];
						$financial_para[$newdate][cost_per_minute] = $row[csf('cost_per_minute')];
					}
				}
			} else {
				$sql_std_para = sql_select("select a.id, b.id as dtls_id, b.location_id, b.applying_period_date, b.applying_period_to_date, b.monthly_cm_expense, b.no_factory_machine, b.working_hour, b.cost_per_minute from lib_standard_cm_entry a, lib_standard_cm_entry_dtls b where a.id=b.mst_id and b.location_id=$location_name_id and a.company_id=$cbo_company_name");
				foreach ($sql_std_para as $row) {
					$applying_period_date = change_date_format($row[csf('applying_period_date')], '', '', 1);
					$applying_period_to_date = change_date_format($row[csf('applying_period_to_date')], '', '', 1);
					$diff = datediff('d', $applying_period_date, $applying_period_to_date);
					for ($j = 0; $j < $diff; $j++) {
						$date_all = add_date(str_replace("'", "", $applying_period_date), $j);
						$newdate = change_date_format($date_all, '', '', 1);
						$financial_para[$newdate][interest_expense] = $row[csf('interest_expense')];
						$financial_para[$newdate][income_tax] = $row[csf('income_tax')];
						$financial_para[$newdate][cost_per_minute] = $row[csf('cost_per_minute')];
					}
				}
			}

			$pre_costing_date = change_date_format($costing_date, '', '', 1);
			?>
			<? if ($zero_value == 0) { ?>
				<br />
				<label style="text-align:left; background:#CCCCCC; font-size:larger;"><b>CM Details </b> </label>
				<div style="width:970px; margin-top: 10px; font-family: 'Arial Narrow', Arial, sans-serif;">
					<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:720px;float: left;" rules="all">
						<tr>
							<th colspan="13">&nbsp;</th>
						</tr>
						<tr style="background: #D7ECD9">
							<th>Style NO.</th>
							<th>MC</th>
							<th>Prd/Hr</th>
							<th>SMV</th>
							<th>BCM</th>
							<th>F.CM</th>
							<th>TTL Min</th>
							<th align="center">CPM</th>
							<th>RL</th>
							<th>RD</th>
							<th>A Eff%</th>
							<th>Layout No</th>
							<th>Alloc Qty</th>
						</tr>
						<tr align="center">
							<td><?= $style_no  ?></td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td><?= $sew_smv ?></td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td>&#36; <? echo fn_number_format($financial_para[$pre_costing_date][cost_per_minute], 4); ?></td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
						</tr>
						<tr>
							<th>Grand Total</th>
							<th>&nbsp;</th>
							<th>&nbsp;</th>
							<th><?= $sew_smv ?></th>
							<th>&nbsp;</th>
							<th>&nbsp;</th>
							<th>&nbsp;</th>
							<th>&#36; <? echo fn_number_format($financial_para[$pre_costing_date][cost_per_minute], 4); ?></th>
							<th>&nbsp;</th>
							<th>&nbsp;</th>
							<th>&nbsp;</th>
							<th>&nbsp;</th>
							<th>&nbsp;</th>
						</tr>
					</table>
					<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:248px; margin-left: 2px; float: right;" rules="all">
						<tr>
							<th colspan="3" bgcolor="yellow">Embellishment[DZN]</th>
						</tr>
						<tr>
							<th>Print Qty</th>
							<th>Emb Qty</th>
							<th>Wash Qty</th>
						</tr>
						<tr align="center">
							<td><? if ($emb_qty_job_name_arr[$job_no][1] > 0) {
									echo fn_number_format($emb_qty_job_name_arr[$job_no][1], 2);
								} else {
									echo '&nbsp;';
								} ?></td>
							<td><? if ($emb_qty_job_name_arr[$job_no][2] > 0) {
									echo fn_number_format($emb_qty_job_name_arr[$job_no][2], 2);
								} else {
									echo '&nbsp;';
								} ?></td>
							<td><? if ($emb_qty_job_name_arr[$job_no][3] > 0) {
									echo fn_number_format($wash_qty_job_name_arr[$job_no][3], 2);
								} else {
									echo '&nbsp;';
								} ?></td>
						</tr>
						<tr>
							<th><? if ($emb_qty_job_name_arr[$job_no][1] > 0) {
									echo fn_number_format($emb_qty_job_name_arr[$job_no][1], 2);
								} else {
									echo '&nbsp;';
								} ?></th>
							<th><? if ($emb_qty_job_name_arr[$job_no][2] > 0) {
									echo fn_number_format($emb_qty_job_name_arr[$job_no][2], 2);
								} else {
									echo '&nbsp;';
								} ?></th>
							<th><? if ($emb_qty_job_name_arr[$job_no][3] > 0) {
									echo fn_number_format($wash_qty_job_name_arr[$job_no][3], 2);
								} else {
									echo '&nbsp;';
								} ?></th>
						</tr>
					</table>
				</div>
				<br>
			<? } ?>
			<?
			$nameArray_fabric_description = sql_select("SELECT (a.id) as fabric_cost_dtls_id,a.item_number_id, max(a.lib_yarn_count_deter_id) as determin_id,a.body_part_id,a.uom,a.color_type_id,a.fabric_source, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type, b.dia_width,avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent , a.fab_nature_id,  avg(b.requirment) as requirment, d.fabric_composition_id FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, lib_yarn_count_determina_mst d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and  c.id=b.color_size_table_id and a.lib_yarn_count_deter_id=d.id and c.status_active=1 and c.is_deleted=0  and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and a.job_no =$txt_job_no and  b.cons>0 group by a.body_part_id,a.uom,a.id,a.item_number_id,a.color_type_id,a.fabric_source,a.construction,a.composition,a.gsm_weight,b.dia_width,a.fab_nature_id, d.fabric_composition_id order by fabric_cost_dtls_id,a.body_part_id,b.dia_width");

			//a.fabric_source=1 and
			foreach ($nameArray_fabric_description as $row) {
				$fabric_id = $row[csf('fabric_cost_dtls_id')];
				$yarn_amount = $yarnDataWithFabricidArr[$fabric_id]['amount'];
				$yarn_qty = $yarnDataWithFabricidArr[$fabric_id]['qty'];

				$yds_amount = array_sum($con_amount_fabric_process[$fabric_id][30]);
				$yds_qty = array_sum($con_qty_fabric_process[$fabric_id][30]);

				$knitting_amount = array_sum($con_amount_fabric_process[$fabric_id][1]);
				$knitting_qty = array_sum($con_qty_fabric_process[$fabric_id][1]);
				$dyeing_amount = array_sum($con_amount_fabric_process[$fabric_id][31]);
				$dyeing_qty = array_sum($con_qty_fabric_process[$fabric_id][31]);
				$aop_amount = array_sum($con_amount_fabric_process[$fabric_id][35]);
				$aop_qty = array_sum($con_qty_fabric_process[$fabric_id][35]);

				$total_finishing_amount = 0;
				$total_finishing_qty = 0;
				foreach ($finishing_arr as $fid) {
					$total_finishing_amount += array_sum($con_amount_fabric_process[$fabric_id][$fid]);
					$total_finishing_qty += array_sum($con_qty_fabric_process[$fabric_id][$fid]);
				}

				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['body_part_id'] = $row[csf('body_part_id')];
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['description'] = $row[csf('construction')] . ', ' . $fabric_composition_arr[$row[csf('fabric_composition_id')]];
				if ($row[csf('fab_nature_id')] == 2) {
					$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['fqty'] = array_sum($fabric_qty_arr['knit']['finish'][$row[csf('fabric_cost_dtls_id')]]);
					$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['gqty'] = array_sum($fabric_qty_arr['knit']['grey'][$row[csf('fabric_cost_dtls_id')]]);
				}
				if ($row[csf('fab_nature_id')] == 3) {
					$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['fqty'] = array_sum($fabric_qty_arr['woven']['finish'][$row[csf('fabric_cost_dtls_id')]]);
					$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['gqty'] = array_sum($fabric_qty_arr['woven']['grey'][$row[csf('fabric_cost_dtls_id')]]);
				}

				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['funit'] = $row[csf('uom')];
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['cons'] = $row[csf('cons')];

				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['process_loss'] = $row[csf('process_loss_percent')];
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['yarn_amount'] = $yarn_amount;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['yarn_per'] = $yarn_amount / $yarn_qty;

				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['yds_amount'] = $yds_amount;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['yds_per'] = $yds_amount / $yds_qty;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['knitting_amount'] = $knitting_amount;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['knitting_per'] = $knitting_amount / $knitting_qty;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['dyeing_amount'] = $dyeing_amount;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['dyeing_per'] = $dyeing_amount / $dyeing_qty;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['aop_amount'] = $aop_amount;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['aop_per'] = $aop_amount / $aop_qty;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['finishing_amount'] = $total_finishing_amount;
				$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['finishing_per'] = $total_finishing_amount / $total_finishing_qty;
				if ($row[csf('fabric_source')] == 1) {
					$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['ttl_cost'] = $yarn_amount + $yds_amount + $knitting_amount + $dyeing_amount + $aop_amount + $total_finishing_amount;
				}
				if ($row[csf('fabric_source')] == 2) {
					if ($row[csf('fab_nature_id')] == 2) {
						$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['ttl_cost'] = array_sum($fabric_amount_arr['knit']['grey'][$row[csf('fabric_cost_dtls_id')]]);
					}
					if ($row[csf('fab_nature_id')] == 3) {
						$fabric_data_arr[$row[csf('fabric_cost_dtls_id')]]['ttl_cost'] = array_sum($fabric_amount_arr['woven']['grey'][$row[csf('fabric_cost_dtls_id')]]);
					}
				}
			}
			/* echo '<pre>';
			print_r($fabric_data_arr); die; */
			$total_finishing_amount = 0;
			?>
			<? if ($zero_value == 0) { ?>
				<br>
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px; margin-top: 10px; font-family: 'Arial Narrow', Arial, sans-serif;" rules="all">
					<label style="float:left;background:#CCCCCC; font-size:larger;"><b>Fabric Details </b> </label>
					<tr style="background: #D7ECD9">
						<th rowspan="2">Garments Part Name</th>
						<th rowspan="2">Fabric Details</th>
						<th rowspan="2">Con</th>
						<th>F. QTY</th>
						<th rowspan="2">Process Loss</th>
						<th>G. QTY</th>
						<th colspan="7">Cost/Uom (Fabric)</th>
						<th rowspan="2">Cost/Dz</th>
						<th rowspan="2" style="background: yellow;">TTL Cost $</th>
					</tr>
					<tr style="background: #D7ECD9">
						<th>Unit</th>
						<th>Unit</th>
						<th>Yarn</th>
						<th>Yds</th>
						<th>Knitting</th>
						<th>Dyeing</th>
						<th>AOP</th>
						<th>Finishing</th>
						<th>Cost/Uom</th>
					</tr>
					<?
					foreach ($fabric_data_arr as $value) { ?>
						<tr>
							<td rowspan="2"><?= $body_part[$value['body_part_id']] ?></td>
							<td rowspan="2"><?= $value['description'] ?></td>
							<td rowspan="2" align="center"><?= fn_number_format($value['cons'], 2); ?></td>
							<td align="center"><? $total_fqty += $value['fqty'];
												echo fn_number_format($value['fqty'], 2); ?></td>
							<td rowspan="2" align="center"><? if ($value['process_loss'] > 0) {
																echo fn_number_format($value['process_loss'], 2);
															} ?></td>
							<td align="center"><? $total_gqty += $value['gqty'];
												echo fn_number_format($value['gqty'], 2) ?></td>
							<td rowspan="2" align="right"><? $total_yarn_amount += $value['yarn_amount'];
															if ($value['yarn_amount'] > 0) {
																echo fn_number_format($value['yarn_per'], 2);
															} ?><br><? if ($value['yarn_amount'] > 0) {
																		echo fn_number_format($value['yarn_amount'], 2);
																	} ?></td>
							<td rowspan="2" align="right"><? $total_yds_amount += $value['yds_amount'];
															if ($value['yds_per'] > 0) {
																echo fn_number_format($value['yds_per'], 2);
															} ?><br><? if ($value['yds_amount'] > 0) {
																		echo fn_number_format($value['yds_amount'], 2);
																	} ?></td>
							<td rowspan="2" align="right"><? $total_knitting_amount += $value['knitting_amount'];
															if ($value['knitting_per'] > 0) {
																echo fn_number_format($value['knitting_per'], 2);
															} ?><br><? if ($value['knitting_amount'] > 0) {
																		echo fn_number_format($value['knitting_amount'], 2);
																	} ?></td>
							<td rowspan="2" align="right"><? $total_dyeing_amount += $value['dyeing_amount'];
															if ($value['dyeing_per'] > 0) {
																echo fn_number_format($value['dyeing_per'], 2);
															} ?><br><? if ($value['dyeing_amount'] > 0) {
																		echo fn_number_format($value['dyeing_amount'], 2);
																	} ?></td>
							<td rowspan="2" align="right"><? $total_aop_amount += $value['aop_amount'];
															if ($value['aop_per'] > 0) {
																echo fn_number_format($value['aop_per'], 2);
															} ?><br><? if ($value['aop_amount'] > 0) {
																		echo fn_number_format($value['aop_amount'], 2);
																	} ?></td>
							<td rowspan="2" align="right"><? $total_finishing_amount += $value['finishing_amount'];
															if ($value['finishing_per'] > 0) {
																echo fn_number_format($value['finishing_per'], 2);
															} ?><br><? if ($value['finishing_amount'] > 0) {
																		echo fn_number_format($value['finishing_amount'], 2);
																	} ?></td>
							<td rowspan="2" align="right" title="TTL Cost/Finish Quantity"><?= fn_number_format($value['ttl_cost'] / $value['fqty'], 2) ?></td>
							<td rowspan="2" align="right"><?= fn_number_format($value['ttl_cost'] / $order_job_qnty * 12, 2) ?></td>
							<th rowspan="2" style="background: yellow;" align="right"><? $total_ttl_cost += $value['ttl_cost'];
																						echo fn_number_format($value['ttl_cost'], 2) ?></th>
						</tr>
						<tr>
							<td align="center"><?= $unit_of_measurement[$value['funit']] ?></td>
							<td align="center"><?= $unit_of_measurement[$value['funit']] ?></td>
						</tr>
					<? }
					?>
					<tr>
						<th colspan="2">Fabric Total</th>
						<td></td>
						<th align="center"><? if ($total_fqty > 0) {
												echo fn_number_format($total_fqty, 2);
											} ?></th>
						<td></td>
						<th align="right"><? if ($total_gqty) {
												echo fn_number_format($total_gqty, 2);
											} ?></th>
						<th align="right"><? if ($total_yarn_amount) {
												echo fn_number_format($total_yarn_amount, 2);
											} ?></th>
						<th align="right"><? if ($total_yds_amount) {
												echo fn_number_format($total_yds_amount, 2);
											} ?></th>
						<th align="right"><? if ($total_knitting_amount) {
												echo fn_number_format($total_knitting_amount, 2);
											} ?></th>
						<th align="right"><? if ($total_dyeing_amount) {
												echo fn_number_format($total_dyeing_amount, 2);
											} ?></th>
						<th align="right"><? if ($total_aop_amount) {
												echo fn_number_format($total_aop_amount, 2);
											} ?></th>
						<th align="right"><? if ($total_finishing_amount) {
												echo fn_number_format($total_finishing_amount, 2);
											} ?></th>
						<th></th>
						<th></th>
						<th style="background: yellow;" align="right"><? if ($total_ttl_cost) {
																			echo '&dollar;' . fn_number_format($total_ttl_cost, 2);
																		} ?> <br><? if ($total_ttl_cost) {
																						echo fn_number_format($total_ttl_cost / $order_values * 100, 2) . '%';
																					} ?></th>
					</tr>
				</table>
			<? } ?>
			<?

			//end 	All Fabric Cost part report-------------------------------------------
			$lib_yarn_count = return_library_array("select yarn_count,id from lib_yarn_count", "id", "yarn_count");
			$sql = "select min(id) as id, count_id, copm_one_id, percent_one, copm_two_id, percent_two, color,type_id, min(cons_ratio) as cons_ratio, sum(cons_qnty) as cons_qnty, rate, sum(amount) as amount from wo_pre_cost_fab_yarn_cost_dtls where job_no=" . $txt_job_no . "  and status_active=1 and is_deleted=0 group by count_id, copm_one_id, percent_one, copm_two_id, percent_two, color,type_id, rate";

			$data_array = sql_select($sql);
			$yarn_data_array = $yarn->getCountCompositionPercentTypeColorAndRateWiseYarnQtyAndAmountArray();
			//print_r($yarn_data_array);

			?>
			<br>
			<div style="margin-top:15px; font-family: 'Arial Narrow', Arial, sans-serif;">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px;text-align:center;" rules="all">

					<label style="float:left;background:#CCCCCC; font-size:larger;"><b>Yarn Details </b> </label>
					<tr style="font-weight:bold;">

						<td width="540" style="background: #D7ECD9">Yarn Description</td>
						<td width="80" style="background: #D7ECD9">Yarn Qty/<?= $costing_for; ?></td>
						<td width="80" style="background: #D7ECD9">TTL Yarn Qty</td>
						<td width="80" style="background: #D7ECD9">Rate &#36;</td>
						<td width="80" style="background: yellow">Amount &#36;</td>
						<td width="80" style="background: #D7ECD9">% to Ord. Value</td>
					</tr>
					<?
					$total_yarn_qty = 0;
					$total_yarn_amount = 0;
					$total_yarn_cost_dzn = $total_yarn_qty_dzn = 0;
					$total_yarn_cost_kg = 0;
					$total_yarn_avg_cons_qty = 0;
					foreach ($data_array as $row) {
						if ($row[csf("percent_one")] == 100)
							$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];
						else
							$item_descrition = $lib_yarn_count[$row[csf("count_id")]] . " " . $composition[$row[csf("copm_one_id")]] . " " . $row[csf("percent_one")] . "% " . $composition[$row[csf("copm_two_id")]] . " " . $row[csf("percent_two")] . "% " . $color_library[$row[csf("color")]] . " " . $yarn_type[$row[csf("type_id")]];
						$rowcons_qnty = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['qty'];
						$rowavgcons_qnty = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['qty'];
						$rowamount = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['amount'];
						if (is_infinite($rowamount) || is_nan($rowamount)) {
							$rowamount = 0;
						}
					?>
						<tr>
							<td align="left"><? echo $item_descrition; ?></td>
							<td align="right"><? echo fn_number_format($row[csf("cons_qnty")], 3); ?></td>
							<td align="right"><? echo fn_number_format($rowcons_qnty, 2); ?></td>

							<td align="right"><? if ($row[csf("rate")] > 0) {
													echo fn_number_format($row[csf("rate")], 3);
												} ?></td>
							<td align="right" style="background: yellow"><? if ($rowamount > 0) {
																				echo fn_number_format($rowamount, 2);
																			} ?></td>
							<td align="right"><?
												$cv = ($row[csf("amount")] / $price_dzn) * 100;
												if (is_infinite($cv) || is_nan($cv)) {
													$cv = 0;
												}
												if ($cv > 0) {
													echo fn_number_format($cv, 2);
												}
												?></td>
						</tr>
					<?
						$total_yarn_qty += $rowcons_qnty;
						$total_yarn_qty_dzn += $row[csf("cons_qnty")];
						$total_avg_yarn_qty += $rowavgcons_qnty;
						$total_yarn_amount += $rowamount;
						$total_yarn_cost_dzn += $row[csf("amount")];
						$total_yarn_avg_cons_qty += $rowavgcons_qnty;
						$total_yarn_cost_kg = $total_yarn_amount / $total_yarn_qty;
						if (is_infinite($total_yarn_cost_kg) || is_nan($total_yarn_cost_kg)) {
							$total_yarn_cost_kg = 0;
						}
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td>Yarn Total</td>
						<td align="right"><? if ($total_yarn_qty_dzn > 0) {
												echo fn_number_format($total_yarn_qty_dzn, 4);
											} ?></td>
						<td align="right"><? if ($total_yarn_qty > 0) {
												echo fn_number_format($total_yarn_qty, 2);
											} ?></td>
						<td></td>
						<td align="right" bgcolor="yellow"><? if ($total_yarn_amount > 0) {
																echo '&dollar;' . fn_number_format($total_yarn_amount, 2);
															} ?></td>
						<td align="right"><?
											$cv = ($total_yarn_cost_dzn / $price_dzn) * 100;
											if (is_infinite($cv) || is_nan($cv)) {
												$cv = 0;
											}
											if ($cv > 0) {
												echo fn_number_format($cv, 2) . ' %';
											}
											?></td>
					</tr>
				</table>
			</div>
			<!-- End Yarn Cost part report here ------------------------------------------- -->

			<table width="100%" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" style="font-family:Arial Narrow;">
				<caption> <strong style="float:left"> Stripe Details</strong></caption>
				<?
				$sql_cov_stripe = "select  b.id,b.conv_cost_dtls_id,b.fabric_cost_dtls_id,b.gmts_color_id,b.fabric_color_id,b.cons,b.unit_charge,c.stripe_color,d.body_part_id ,c.color_number_id,c.id as did
			from wo_pre_cost_fab_conv_cost_dtls a, wo_pre_cos_conv_color_dtls b ,wo_pre_stripe_color c ,wo_pre_cost_fabric_cost_dtls d
			where a.id=b.conv_cost_dtls_id and a.fabric_description=b.fabric_cost_dtls_id and a.fabric_description=c.pre_cost_fabric_cost_dtls_id and b.fabric_cost_dtls_id=c.pre_cost_fabric_cost_dtls_id  and b.gmts_color_id=c.color_number_id and b.fabric_color_id=c.stripe_color and d.id=c.pre_cost_fabric_cost_dtls_id and b.job_no='$job_no'  and a.status_active=1 and b.status_active=1 and c.status_active=1  order by b.id";
				$cov_stripe_data = sql_select($sql_cov_stripe);
				foreach ($cov_stripe_data as $row) {

					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['unit_charge'][$row[csf('did')]] = $row[csf('unit_charge')];
				}
				$color_name_arr = return_library_array("select id,color_name from lib_color where status_active=1 and is_deleted=0", 'id', 'color_name');
				$sql_stripe = "SELECT c.id,c.composition,c.construction,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,sum(b.grey_fab_qnty) as fab_qty,b.dia_width,d.color_number_id as color_number_id,d.id as did,d.stripe_color,d.fabreqtotkg as fabreqtotkg ,d.measurement as measurement ,d.yarn_dyed,d.uom,avg(b.rate) as  rate from wo_booking_dtls b, wo_pre_cost_fabric_cost_dtls c,wo_pre_stripe_color d where c.id=b.pre_cost_fabric_cost_dtls_id and c.job_no=b.job_no and d.pre_cost_fabric_cost_dtls_id=c.id and d.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and b.job_no=d.job_no and b.job_no='$job_no'  and d.job_no='$job_no'   and c.color_type_id in (2,3,4,6,32,33,34)  and b.status_active=1  and c.is_deleted=0 and c.status_active=1  and d.is_deleted=0 and d.status_active=1  and 	b.is_deleted=0  group by c.id,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,d.color_number_id,d.id,d.stripe_color,d.yarn_dyed,d.fabreqtotkg ,d.measurement,d.uom,c.composition,c.construction,b.dia_width order by d.id ";
				//echo $sql_stripe; die;
				$result_data = sql_select($sql_stripe);
				foreach ($result_data as $row) {
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['stripe_color'][$row[csf('did')]] = $row[csf('stripe_color')];
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['measurement'][$row[csf('did')]] = $row[csf('measurement')];
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['uom'][$row[csf('did')]] = $row[csf('uom')];
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['fabreqtotkg'][$row[csf('did')]] = $row[csf('fabreqtotkg')];
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['rate'][$row[csf('did')]] = $row[csf('rate')];
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['yarn_dyed'][$row[csf('did')]] = $row[csf('yarn_dyed')];

					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['composition'] = $row[csf('composition')];
					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['construction'] = $row[csf('construction')];
					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['gsm_weight'] = $row[csf('gsm_weight')];
					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['color_type_id'] = $row[csf('color_type_id')];
					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['dia_width'] = $row[csf('dia_width')];
					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['fabreqtotkg'] += $row[csf('fabreqtotkg')];
				}
				?>

				<tr>
					<th width="30"> SL</th>
					<th width="100"> Body Part</th>
					<th width="80"> Fabric Color</th>
					<th width="70"> Fabric Qty(KG)</th>
					<th width="70"> Stripe Color</th>
					<th width="70"> Stripe Measurement</th>
					<th width="70"> Stripe Uom</th>
					<th width="70"> Qty.(KG)</th>
					<th width="70"> Rate</th>
					<th width="100">Amount</th>
				</tr>
				<?
				//if($db_type==0) $color_cond="d.fabric_color_id='".$color_id."'";
				//else if($db_type==2) $color_cond="nvl(d.fabric_color_id,0)=nvl('".$color_id."',0)";
				//else if($db_type==2) $color_cond="nvl(d.fabric_color_id,0)=nvl('".$color_id."',0)";


				$i = 1;
				$total_fab_qty = 0;
				$total_fabreqtotkg = 0;
				$fab_data_array = array();
				$total_fabamount = 0;
				$rows = 0;
				foreach ($stripe_arr as $body_id => $body_data) {
					foreach ($body_data as $color_id => $color_val) {
						$rowspan = count($color_val['stripe_color']);
						$composition = $stripe_arr2[$body_id][$color_id]['composition'];
						$construction = $stripe_arr2[$body_id][$color_id]['construction'];
						$gsm_weight = $stripe_arr2[$body_id][$color_id]['gsm_weight'];
						$color_type_id = $stripe_arr2[$body_id][$color_id]['color_type_id'];
						$dia_width = $stripe_arr2[$body_id][$color_id]['dia_width'];


				?>
						<tr>
							<?
							//$color_qty=$stripe_arr2[$body_id][$color_id]['fabreqtotkg'];//$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
							$color_qty = array_sum($stripe_arr[$body_id][$color_id]['fabreqtotkg']);
							?>
							<td rowspan="<? echo $rowspan; ?>"> <? echo $i; ?></td>
							<td rowspan="<? echo $rowspan; ?>"> <? echo $body_part[$body_id]; ?></td>
							<td rowspan="<? echo $rowspan; ?>"> <? echo $color_name_arr[$color_id]; ?></td>
							<td rowspan="<? echo $rowspan; ?>" align="right"> <? echo number_format($color_qty, 2); ?></td>
							<?
							$total_fab_qty += $color_qty;
							foreach ($color_val['stripe_color'] as $strip_color_id => $s_color_val) {
								$measurement = $color_val['measurement'][$strip_color_id];
								$uom = $color_val['uom'][$strip_color_id];
								$fabreqtotkg = $color_val['fabreqtotkg'][$strip_color_id];
								$rate = $color_val['rate'][$strip_color_id];
								$unit_charge = $color_val['unit_charge'][$strip_color_id];
								$yarn_dyed = $color_val['yarn_dyed'][$strip_color_id];
							?>
								<td><? echo  $color_name_arr[$s_color_val]; ?></td>
								<td align="right"> <? echo  number_format($measurement, 2); ?></td>
								<td> <? echo  $unit_of_measurement[$uom]; ?></td>
								<td align="right"> <? echo  number_format($fabreqtotkg, 2); ?></td>
								<td align="right"> <? echo  number_format($unit_charge, 2); ?></td>
								<td align="right"> <? echo number_format($fabreqtotkg * $unit_charge, 2); ?></td>
						</tr>
			<?
								$total_fabreqtotkg += $fabreqtotkg;
								$total_fabamount += $fabreqtotkg * $unit_charge;;
								$total_rate += $rate;
								$rows += 1;
							}
							$i++;
						}
					}
			?>
			<tfoot>
				<tr>
					<td colspan="3">Total </td>
					<td align="right"> <? echo  number_format($total_fab_qty, 2); ?> </td>
					<td></td>
					<td></td>
					<td> </td>
					<td align="right"><? echo  number_format($total_fabreqtotkg, 2); ?> </td>
					<td align="right"></td>
					<td align="right"><? echo  number_format($total_fabamount, 2); ?></td>
				</tr>
			</tfoot>
			</table>
			<?

			//start	Trims Cost part report here -------------------------------------------
			$supplier_library_fabric = return_library_array("select a.id, a.supplier_name from lib_supplier a where a.is_deleted=0  and a.status_active=1 group by a.id,a.supplier_name order by a.supplier_name", "id", "supplier_name");

			$sql = "select id, job_no, trim_group,description,brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp_multi, status_active from wo_pre_cost_trim_cost_dtls  where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0";
			$data_array = sql_select($sql);
			?>
			<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px;text-align:center;font-family: 'Arial Narrow', Arial, sans-serif;" rules="all">

					<label style="float:left;background:#CCCCCC; font-size:larger"><b>Trims Details</b> </label>
					<tr style="font-weight:bold; background: #D7ECD9">
						<td width="110" style="background: #D7ECD9">Item Group</td>
						<td width="110" style="background: #D7ECD9">Item Description</td>
						<td width="100" style="background: #D7ECD9">Supplier</td>
						<td width="60" style="background: #D7ECD9">UOM</td>
						<td width="80" style="background: #D7ECD9">Cons/<?= $costing_for; ?>[Qnty]</td>
						<td width="100" style="background: #D7ECD9">TTL Required[Qnty]</td>
						<td width="80" style="background: #D7ECD9">Rate &#36;</td>
						<td width="80" style="background: #D7ECD9">Amount/<?= $costing_for; ?>&#36;</td>
						<td width="80" style="background: yellow">Amount &#36;</td>
						<td width="60" style="background: #D7ECD9">% to Ord. Value</td>
					</tr>
					<?
					$trim_group = return_library_array("select item_name,id from  lib_item_group", "id", "item_name");
					$trim_qty_arr = $trims->getQtyArray_by_precostdtlsid();
					//print_r($trim_qty);
					$trim_amount_arr = $trims->getAmountArray_precostdtlsid();
					$total_trims_cost = 0;
					$total_trims_qty = $total_trims_cost_dzn = 0;
					$total_trims_cost_dzn = 0;
					$total_trims_cost_kg = 0;
					foreach ($data_array as $row) {
						$cons_dzn_gmts = $row[csf("cons_dzn_gmts")];
						$amount_dzn = $row[csf("amount")];
						$pre_trims_qty = $trim_qty_arr[$row[csf("id")]];
						$pre_trims_amount = $trim_amount_arr[$row[csf("id")]];

						$nominated_supp_str = "";
						$exsupp = explode("_", $row[csf("nominated_supp_multi")]);
						foreach ($exsupp as $sid) {
							if ($nominated_supp_str == "") $nominated_supp_str = $supplier_library_fabric[$sid];
							else $nominated_supp_str .= ',' . $supplier_library_fabric[$sid];
						}
					?>
						<tr>
							<td align="left"><? echo $trim_group[$row[csf("trim_group")]]; ?></td>
							<td align="left"><? echo $row[csf("description")]; ?></td>
							<td align="left"><?= $nominated_supp_str; ?></td>
							<td align="center"><? echo $unit_of_measurement[$row[csf("cons_uom")]]; ?></td>
							<td align="right"><? echo fn_number_format($cons_dzn_gmts, 3); ?></td>
							<td align="right"><? echo fn_number_format($pre_trims_qty, 4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("rate")], 3); ?></td>
							<td align="right"><? echo fn_number_format($amount_dzn, 4); ?></td>
							<td align="right" style="background: yellow"><? echo fn_number_format($pre_trims_amount, 2); ?></td>
							<td align="right" title="<? echo $amount_dzn . '=' . $price_dzn; ?>">
								<?
								$cv = ($amount_dzn / $price_dzn) * 100;
								if (is_infinite($cv) || is_nan($cv)) {
									$cv = 0;
								}
								echo fn_number_format($cv, 2);
								//echo fn_number_format(($amount_dzn/$price_dzn)*100,2); 
								?></td>
						</tr>
					<?
						$total_trims_cost += $pre_trims_amount;
						$total_trims_cost_dzn += $amount_dzn;
						$total_trims_qty += $pre_trims_qty;
					}
					?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td>Trims Total</td>
						<td colspan="4"></td>
						<td align="right"><? if ($total_trims_qty > 0) {
												echo fn_number_format($total_trims_qty, 4);
											} ?></td>
						<td align="right"><? //echo fn_number_format($total_trims_cost_dzn,4); 
											?></td>

						<td align="right"><? if ($total_trims_cost_dzn > 0) {
												echo '&dollar;' . fn_number_format($total_trims_cost_dzn, 4);
											} ?></td>
						<td align="right" style="background: yellow"><? if ($total_trims_cost > 0) {
																			echo '&dollar;' . fn_number_format($total_trims_cost, 2);
																		} ?></td>
						<td align="right" title="<? echo $total_trims_cost_dzn . '=' . $price_dzn; ?>">
							<?
							$cv = ($total_trims_cost_dzn / $price_dzn) * 100;
							if (is_infinite($cv) || is_nan($cv)) {
								$cv = 0;
							}
							if ($cv) {
								echo fn_number_format($cv, 2) . ' %';
							}
							?>
						</td>
					</tr>
				</table>
			</div>
			<?
			$pre_cost_dtls_arr = sql_select("SELECT id, job_no, costing_per_id, order_uom_id, fabric_cost, fabric_cost_percent, trims_cost,depr_amor_pre_cost,deffdlc_cost,studio_cost,design_cost,trims_cost_percent,embel_cost,embel_cost_percent,comm_cost,comm_cost_percent,commission,incometax_cost,interest_cost,interest_percent,commission_percent,lab_test,lab_test_percent,inspection,inspection_percent,cm_cost,cm_cost_percent,freight,freight_percent,common_oh,common_oh_percent,design_percent, studio_percent, currier_pre_cost, currier_percent, certificate_pre_cost, certificate_percent, total_cost, total_cost_percent, price_dzn, price_dzn_percent, margin_dzn, margin_dzn_percent, price_pcs_or_set, price_pcs_or_set_percent, margin_pcs_set, margin_pcs_set_percent, cm_for_sipment_sche from wo_pre_cost_dtls where job_no=" . $txt_job_no . " and status_active=1 and is_deleted=0");
			foreach ($pre_cost_dtls_arr as $row) {
				$price_dzn = $row[csf("price_dzn")];
				$lab_test_dzn = $row[csf("lab_test")];
				$commission_cost_dzn = $row[csf("commission")];
				$commercial_cost_dzn = $row[csf("comm_cost")];

				$inspection_dzn = $row[csf("inspection")];
				$inspection_percent = $row[csf("inspection_percent")];
				$cm_cost_dzn = $row[csf("cm_cost")];
				$common_oh_dzn = $row[csf("common_oh")];
				$freight_dzn = $row[csf("freight")];
				$currier_pre_cost_dzn = $row[csf("currier_pre_cost")];
				$currier_per_cost_dzn = $row[csf("currier_percent")];
				$certificate_pre_cost_dzn = $row[csf("certificate_pre_cost")];
				$deffdlc_cost_dzn = $row[csf("deffdlc_cost")];
				$depr_amor_pre_cost_dzn = $row[csf("depr_amor_pre_cost")];
				$interest_cost_dzn = $row[csf("interest_cost")];
				$interest_cost_percent = $row[csf("interest_percent")];
				$incometax_cost_dzn = $row[csf("incometax_cost")];
				$studio_cost_dzn = $row[csf("studio_cost")];
				$design_cost_dzn = $row[csf("design_cost")];
				$studio_cost_percent = $row[csf("studio_percent")];
				$design_cost_percent = $row[csf("design_percent")];

				$other_cost_per = $freight_dzn + $certificate_pre_cost_dzn + $deffdlc_cost_dzn + $design_cost_dzn + $studio_cost_dzn + $common_oh_dzn + $interest_cost_dzn + $incometax_cost_dzn + $depr_amor_pre_cost_dzn;
			}
			?>
			<table class="rpt_table" border="1" align="left" cellpadding="0" width="350" cellspacing="0" rules="all" style="margin-top: 10px;font-family: 'Arial Narrow', Arial, sans-serif;">
				<tr style="background: #D7ECD9">
					<th>MISC/Others Cost</th>
					<th>%</th>
					<th>TTL Cost $</th>
				</tr>
				<tr>
					<td>Test cost</td>
					<td align="right"><?
										$lab_test_per = ($other_costing_arr[$job_no]['lab_test'] / $order_values) * 100;
										if (is_infinite($lab_test_per) || is_nan($lab_test_per)) {
											$lab_test_per = 0;
										}
										if ($lab_test_per > 0) {
											echo fn_number_format($lab_test_per, 2);
										}
										$total_misc_per += $lab_test_per;
										?></td>
					<th align="right"><? if ($other_costing_arr[$job_no]['lab_test'] > 0) {
											echo fn_number_format($other_costing_arr[$job_no]['lab_test'], 2);
										} ?></th>
				</tr>
				<tr>
					<td>Buying commission</td>
					<td align="right"><?
										$commission_cost_per = ($commission_costing_arr[$job_no] / $order_values) * 100;
										if (is_infinite($commission_cost_per) || is_nan($commission_cost_per)) {
											$commission_cost_per = 0;
										}
										if ($commission_cost_per > 0) {
											echo fn_number_format($commission_cost_per, 2);
										}
										$total_misc_per += $commission_cost_per;
										?></td>
					<th align="right"><? if ($commission_costing_arr[$job_no] > 0) {
											echo fn_number_format($commission_costing_arr[$job_no], 2);
										} ?></th>
				</tr>
				<tr>
					<td>Commercial cost</td>
					<td align="right"><?
										$commercial_cost_per = ($commercial_costing_arr[$job_no] / $order_values) * 100;
										if (is_infinite($commercial_cost_per) || is_nan($commercial_cost_per)) {
											$commercial_cost_per = 0;
										}
										if ($commercial_cost_per > 0) {
											echo fn_number_format($commercial_cost_per, 2);
										}
										$total_misc_per += $commercial_cost_per;
										?>
					</td>
					<th align="right"><? if ($commercial_costing_arr[$job_no] > 0) {
											echo fn_number_format($commercial_costing_arr[$job_no], 2);
										} ?></th>
				</tr>
				<tr>
					<td>Courier costs</td>
					<td align="right"><?
										$currier_pre_cost_dzn = $currier_pre_cost_dzn * ($order_job_qnty / 12);
										// $currier_pre_cost_dzn=($currier_pre_cost_dzn/$order_values)*100;
										if (is_infinite($currier_per_cost_dzn) || is_nan($currier_per_cost_dzn)) {
											$currier_per_cost_dzn = 0;
										}
										if ($currier_per_cost_dzn > 0) {
											echo fn_number_format($currier_per_cost_dzn, 2);
										}
										$total_misc_per += $currier_per_cost_dzn;

										?>
					</td>
					<th align="right"><? if ($currier_pre_cost_dzn > 0) {
											echo fn_number_format($currier_pre_cost_dzn, 2);
										} ?></th>
				</tr>
				<tr>
					<td>Inspection Cost</td>
					<td align="right"><? if ($inspection_percent > 0) {echo fn_number_format($inspection_percent, 2);	}  ?></td>
						<th align="right">
							<? 
								$inspection_dzn = $inspection_dzn * ($order_job_qnty / 12);
								if ($inspection_dzn > 0) {echo fn_number_format($inspection_dzn, 2);} 
							?>
						</th>
				</tr>
				<tr>
					<td>Sample Fabric Cost</td>
					<td align="right"><?
										$sample_fabric_cost = ($other_costing_arr[$job_no]['studio_cost'] / $order_values) * 100;
										if (is_infinite($sample_fabric_cost) || is_nan($sample_fabric_cost)) {
											$sample_fabric_cost = 0;
										}
										if ($sample_fabric_cost > 0) {
											echo fn_number_format($sample_fabric_cost, 2);
										}
										//$misc_cost +=$other_costing_arr[$job_no]['studio_cost'];
										$total_misc_per += $sample_fabric_cost;
										?>
					</td>
					<th align="right"><? if ($other_costing_arr[$job_no]['studio_cost'] > 0) {echo fn_number_format($other_costing_arr[$job_no]['studio_cost'], 2);} ?></th>
				</tr>
				<tr>
					<td>Other costs</td>
					<td align="right"><?
										$other_cost_per = ($total_other_cost / $order_values) * 100;
										if (is_infinite($other_cost_per) || is_nan($other_cost_per)) {
											$other_cost_per = 0;
										}
										if ($other_cost_per > 0) {
											echo fn_number_format($other_cost_per, 2);
										}
										$total_misc_per += $other_cost_per;
										?>
					</td>
					<th align="right"><? if ($total_other_cost > 0) {
											echo fn_number_format($total_other_cost, 2);
										} ?></th>
				</tr>
				<tr>
					<th>MISC/Others Cost Sub Total</th>
					<th align="right"><? if ($total_misc_per > 0) {
											echo fn_number_format($total_misc_per+$inspection_percent, 2) . '%';
										}  ?></th>
					<th align="right"><? if ($misc_cost > 0) {
											echo '&dollar;' . fn_number_format($misc_cost+$inspection_dzn, 2);
										} ?></th>
				</tr>
			</table>
			<br /><br />
			<div>

				<br />
				<?  //echo signature_table(109, $cbo_company_name, "970px");
				?>
				<?
				$width = 990;
				$padding_top = 70;
				$prepared_by = '';
				$sql = sql_select("select designation,name,activities,prepared_by from variable_settings_signature where report_id=109 and company_id=$cbo_company_name order by sequence_no");


				if ($sql[0][csf("prepared_by")] == 1) {
					list($prepared_by, $activities) = explode('**', $prepared_by);
					$sql_2[100] = array(DESIGNATION => 'Prepared By', NAME => $prepared_by, ACTIVITIES => $activities, PREPARED_BY => 0);
					$sql = $sql_2 + $sql;
				}

				$count = count($sql);
				$td_width = floor($width / $count);
				$standard_width = $count * 120;
				if ($standard_width > $width) {
					$td_width = 120;
				}
				$no_coloumn_per_tr = floor($width / $td_width);
				$i = 1;
				if ($count == 0) {
					$message = "<b>Note: This is Software Generated Copy , Signature is not Required.</b>";
				}
				echo '<table id="signatureTblId" width="' . $width . '" style="padding-top:' . $padding_top . 'px;"><tr><td width="100%" height="' . $padding_top . '" colspan="' . $count . '">' . $message . '</td></tr><tr>';
				foreach ($sql as $row) {
					echo '<td width="' . $td_width . '" align="center" valign="top">
		<strong>' . $row[csf("activities")] . '</strong><br>
		<strong style="text-decoration:overline">' . $row[csf("designation")] . "</strong><br>" . $row[csf("name")] . '</td>';
					if ($i % $no_coloumn_per_tr == 0) {
						echo '</tr><tr><td width="100%" height="70" colspan="' . $no_coloumn_per_tr . '"></td></tr>';
					}
					$i++;
				}
				echo '</tr></table>';
				?>
			</div>
		<?
		disconnect($con);
		exit();
}

if($action=='accessories_details3')
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	$txt_costing_date=change_date_format(str_replace("'","",$txt_costing_date),'yyyy-mm-dd','-');
	if($txt_job_no=="") $job_no=''; else $job_no=" and a.job_no=".$txt_job_no."";
	if($cbo_company_name=="") $company_name=''; else $company_name=" and a.company_name=".$cbo_company_name."";
	if($cbo_buyer_name=="") $cbo_buyer_name=''; else $cbo_buyer_name=" and a.buyer_name=".$cbo_buyer_name."";
	if($txt_style_ref=="") $txt_style_ref=''; else $txt_style_ref=" and a.style_ref_no=".$txt_style_ref."";
	if($txt_costing_date=="") $txt_costing_date=''; else $txt_costing_date=" and c.costing_date='".$txt_costing_date."'";
	if(str_replace("'",'',$txt_po_breack_down_id)=="")
	{
		$txt_po_breack_down_id_cond='';
		$txt_po_breack_down_id_cond1='';
		$txt_po_breack_down_id_cond2='';
		$txt_po_breack_down_id_cond3='';
	}
	else
	{
		$txt_po_breack_down_id_cond=" and b.id in(".$txt_po_breack_down_id.")";
		$txt_po_breack_down_id_cond1=" and id in(".$txt_po_breack_down_id.")";
		$txt_po_breack_down_id_cond2=" and po_break_down_id in(".$txt_po_breack_down_id.")";
		$txt_po_breack_down_id_cond3=" and b.id in(".$txt_po_breack_down_id.")";
	}

	$buyer_arr=return_library_array( "select id, buyer_name from lib_buyer",'id','buyer_name');
	$comp=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$supplier_name_arr=return_library_array( "select id, supplier_name from  lib_supplier",'id','supplier_name');
	$color_library=return_library_array( "select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array( "select id, size_name from lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$item_name_library=return_library_array( "select id, item_name from lib_item_group where status_active=1 and is_deleted=0", "id", "item_name");


	$result =sql_select("select id,po_number,pub_shipment_date,file_no,grouping from wo_po_break_down where job_no_mst=$txt_job_no $txt_po_breack_down_id_cond1 and status_active=1 and is_deleted=0 order by pub_shipment_date DESC");
	$job_in_orders = array();
	$pulich_ship_date='';
	$job_in_ref = array();
	$job_in_file = array();
	foreach ($result as $val){
		$job_in_orders[$val[csf('id')]]= $val[csf('po_number')];
		$pulich_ship_date = $val[csf('pub_shipment_date')];
		$job_in_ref[$val[csf('id')]]= $val[csf('grouping')];
	    $job_in_file[$val[csf('id')]]= $val[csf('file_no')];
	}
	$ref_cond=implode(",",array_unique($job_in_ref));
	$file_con=implode(",",$job_in_file);
	$job_in_orders=implode(", ",$job_in_orders);

	$gmtsitem_ratio_array=array();
	$grmnt_items = "";
    $grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no=$txt_job_no");
	foreach($grmts_sql as $key=>$val)
	{
		$grmnt_items .=$garments_item[$val[csf("gmts_item_id")]].",";
		$gmtsitem_ratio_array[$val[csf('job_no')]][$val[csf('gmts_item_id')]]=$val[csf('set_item_ratio')];
	}
	$grmnt_items = rtrim($grmnt_items,",");

	if($db_type==0){
	   $sql = "select a.job_no,a.company_name, a.buyer_name,a.style_ref_no,a.ship_mode, a.gmts_item_id,a.order_uom, a.avg_unit_price,sum(b.plan_cut) as job_quantity,sum(b.po_quantity) as ord_qty, c.costing_date,c.costing_per,c.budget_minute,c.approved,   d.fab_knit_req_kg, d.fab_woven_req_yds, d.fab_yarn_req_kg from wo_po_details_master a, wo_po_break_down b, wo_pre_cost_mst c left join wo_pre_cost_sum_dtls d on   c.job_no=d.job_no and d.status_active=1 and d.is_deleted=0 where a.job_no=b.job_no_mst and b.job_no_mst=c.job_no  and a.status_active=1 and a.is_deleted =0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $job_no $txt_po_breack_down_id_cond $company_name $cbo_buyer_name $txt_style_ref $txt_costing_date group by a.job_no,a.company_name, a.buyer_name,a.style_ref_no, a.ship_mode,a.gmts_item_id,a.order_uom, a.avg_unit_price,c.costing_date,c.costing_per,c.approved,c.budget_minute, d.fab_knit_req_kg, d.fab_woven_req_yds, d.fab_yarn_req_kg order by a.job_no";
	}
	if($db_type==2){
	    $sql = "SELECT a.job_no,a.company_name, a.buyer_name,a.style_ref_no,a.ship_mode, a.gmts_item_id,a.order_uom, a.avg_unit_price,sum(b.plan_cut) as job_quantity,sum(b.po_quantity) as ord_qty, c.costing_date,c.costing_per,c.budget_minute,c.approved,d.fab_knit_req_kg, d.fab_woven_req_yds, d.fab_yarn_req_kg from wo_po_details_master a,wo_po_break_down b, wo_pre_cost_mst c left join  wo_pre_cost_sum_dtls d on  c.job_no=d.job_no and d.status_active=1 and d.is_deleted=0 where a.job_no=b.job_no_mst and b.job_no_mst=c.job_no  and a.status_active=1 and a.is_deleted =0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $job_no $txt_po_breack_down_id_cond $company_name $cbo_buyer_name $txt_style_ref group by a.job_no,a.company_name, a.buyer_name,a.style_ref_no, a.gmts_item_id,a.order_uom,a.ship_mode, a.avg_unit_price,c.costing_date, c.costing_per,c.approved,c.budget_minute, d.fab_knit_req_kg, d.fab_woven_req_yds, d.fab_yarn_req_kg  order by a.job_no";
	}
	$data_array=sql_select($sql);
	?>
    <div style="width:1052px; margin:0 auto">
    <div style="width:1050px; font-size:20px; font-weight:bold" align="center"><? echo $comp[str_replace("'","",$cbo_company_name)]; ?></div>
    <div style="width:1050px; font-size:14px; font-weight:bold" align="center">Accessories Details</div>
	<?

	$order_job_qnty=0;
	$ord_qty=0;
	$avg_unit_price=0;
	$order_values=0;
	$order_price_per_dzn=0;
	$costing_for='';
	foreach ($data_array as $row){
	    $order_job_qnty=$row[csf("job_quantity")];
		$ord_qty=$row[csf("ord_qty")];
		$avg_unit_price=$row[csf("avg_unit_price")];
		$order_values = $row[csf("job_quantity")]*$row[csf("avg_unit_price")];

		if($row[csf("costing_per")]==1){$order_price_per_dzn=12;$costing_for=" DZN";}
		else if($row[csf("costing_per")]==2){$order_price_per_dzn=1;$costing_for=" PCS";}
		else if($row[csf("costing_per")]==3){$order_price_per_dzn=24;$costing_for=" 2 DZN";}
		else if($row[csf("costing_per")]==4){$order_price_per_dzn=36;$costing_for=" 3 DZN";}
		else if($row[csf("costing_per")]==5){$order_price_per_dzn=48;$costing_for=" 4 DZN";}
		?>
        <div style="font-family:'Arial Narrow';">
        <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:1050px; font-family:Arial Narrow" rules="all">
            <tr>
                <td width="80">Job Number</td>
                <td width="80"><b><? echo $row[csf("job_no")]; ?></b></td>
                <td width="90">Buyer</td>
                <td width="100"><b><? echo $buyer_arr[$row[csf("buyer_name")]]; ?></b></td>
                <td width="80">Plan Cut Qnty</td>
                <td width="100"><b><? echo $row[csf("job_quantity")]." ".$unit_of_measurement[$row[csf("order_uom")]]; ?></b></td>
            </tr>
            <tr>
                <td>Order Qty</td>
                <td><b><? echo $row[csf("ord_qty")]." ".$unit_of_measurement[$row[csf("order_uom")]]; ?></b></td>
                <td>Style Ref. No</td>
                <td><b><? echo $row[csf("style_ref_no")]; ?></b></td>
                <td>Price Per Unit</td>
                <td><b><? echo $row[csf("avg_unit_price")]; ?></b></td>
            </tr>
            <tr>
                <td>Order Numbers</td>
                <td colspan="5"><? echo $job_in_orders; ?></td>
                </tr>
                <tr>
                <td>Garments Item</td>
                <td colspan="3"><b><? echo $grmnt_items; ?></b></td>
                <td>Shipment Date</td>
                <td><b><? echo change_date_format($pulich_ship_date); ?></b></td>
            </tr>
            <tr>
                <td>Budget Minute</td>
                <td><b><? echo $row[csf("budget_minute")] ?> </b></td>
                <td align="center" height="10" colspan="6" valign="top" id="app_sms" style="font-size:18px;">
                <font color="#FF0000"><? if( $row[csf("approved")]==1 || $row[csf("approved")]==3){echo "This Job is Approved ";} else {echo "";} ?></font>
                </td>
            </tr>
            <tr>
                <td>Internal Ref</td>
                <td colspan="2"><b><? echo ltrim($ref_cond,", "); ?></b></td>
                <td>File No</td>
                <td colspan="2"><b><? echo $file_cond; ?></b></td>
            </tr>
             <tr>
                <td>Costing Date</td>
                <td colspan="2"><b><? echo change_date_format($row[csf("costing_date")]); ?></b></td>
                <td>Ship Mode</td>
                <td colspan="2"><b><? echo $shipment_mode[$row[csf("ship_mode")]]; ?></b></td>
            </tr>
        </table>
            <?
	}//end first foearch

	$condition= new condition();
	if(str_replace("'","",$txt_job_no) !=''){
		$condition->job_no("=$txt_job_no");
	}
	if(str_replace("'",'',$txt_po_breack_down_id) !="")
	{
		$condition->po_id("in($txt_po_breack_down_id)");
	}
	$condition->init();
	$trim= new trims($condition);
	$color_sizewise_data=$trim->getQtyArray_by_OrderPrecostdtlsidGmtscolorAndGmtssize();
	$trims_data=sql_select("SELECT a.id as po_id, a.po_number, a.grouping, c.id as trims_id, c.trim_group, c.brand_sup_ref, c.description, c.cons_uom, c.item_print, d.color_number_id as gmts_color, d.size_number_id as size_id, e.image_location from wo_po_break_down a join wo_po_color_size_breakdown b on a.id=b.po_break_down_id join wo_pre_cost_trim_cost_dtls c on a.job_id=c.job_id join wo_pre_cost_trim_co_cons_dtls d on c.id=d.wo_pre_cost_trim_cost_dtls_id and d.color_size_table_id=b.id left join common_photo_library e on c.id=e.master_tble_id and e.form_name = 'pre_cost_trimsv2' and e.file_type=1 and e.is_deleted=0 where a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.job_no_mst =$txt_job_no group by a.id ,a.po_number, a.grouping, c.id, c.trim_group, c.brand_sup_ref, d.color_number_id, d.size_number_id, c.description, c.cons_uom, c.item_print, e.image_location");
	$trims_data_arr=array();
	foreach($trims_data as $row){
		//$index_key=$row[csf('gmts_color')].'*'.$row[csf('size_id')];
		$index_key=$row[csf('gmts_color')];
		$trims_data_arr[$row[csf('trims_id')]][$row[csf('po_id')]]['po_number']=$row[csf('po_number')];
		$trims_data_arr[$row[csf('trims_id')]][$row[csf('po_id')]]['ir_no']=$row[csf('grouping')];
		$trims_data_arr[$row[csf('trims_id')]][$row[csf('po_id')]]['dtls_data'][$index_key]['trims_id']=$row[csf('trims_id')];
		$trims_data_arr[$row[csf('trims_id')]][$row[csf('po_id')]]['dtls_data'][$index_key]['po_id']=$row[csf('po_id')];
		$trims_data_arr[$row[csf('trims_id')]][$row[csf('po_id')]]['dtls_data'][$index_key]['gmts_color']=$row[csf('gmts_color')];
		$trims_data_arr[$row[csf('trims_id')]][$row[csf('po_id')]]['dtls_data'][$index_key]['size_id']=$row[csf('size_id')];
		$trims_data_arr[$row[csf('trims_id')]][$row[csf('po_id')]]['dtls_data'][$index_key]['brand_sup_ref']=$row[csf('brand_sup_ref')];
		$trims_data_arr[$row[csf('trims_id')]][$row[csf('po_id')]]['dtls_data'][$index_key]['description']=$row[csf('description')];
		$trims_data_arr[$row[csf('trims_id')]][$row[csf('po_id')]]['dtls_data'][$index_key]['cons_uom']=$row[csf('cons_uom')];
		$trims_data_arr[$row[csf('trims_id')]][$row[csf('po_id')]]['dtls_data'][$index_key]['item_print']=$row[csf('item_print')];
		$trims_data_arr[$row[csf('trims_id')]][$row[csf('po_id')]]['dtls_data'][$index_key]['image_location']=$row[csf('image_location')];
		$trims_data_arr[$row[csf('trims_id')]][$row[csf('po_id')]]['dtls_data'][$index_key]['size_qty'][$row[csf('size_id')]]=$color_sizewise_data[$row[csf('po_id')]][$row[csf('trims_id')]][$row[csf('gmts_color')]][$row[csf('size_id')]];

		$precost_wise_size[$row[csf('trims_id')]][$row[csf('size_id')]]=$row[csf('size_id')];
		$trims_wise_data[$row[csf('trims_id')]]['brand_sup_ref']=$row[csf('brand_sup_ref')];
		$trims_wise_data[$row[csf('trims_id')]]['trim_group']=$row[csf('trim_group')];
		$trims_wise_data[$row[csf('trims_id')]]['cons_uom']=$row[csf('cons_uom')];
		$trims_wise_data[$row[csf('trims_id')]]['description']=$row[csf('description')];
		$trims_wise_data[$row[csf('trims_id')]]['qty']+=round($color_sizewise_data[$row[csf('po_id')]][$row[csf('trims_id')]][$row[csf('gmts_color')]][$row[csf('size_id')]]);
	}
	//ksort($precost_wise_size[$row[csf('trims_id')]][$row[csf('size_id')]]);
	/* echo '<pre>';
	print_r($precost_wise_size); die; */
	?>
	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:1050px; margin-top: 10px; text-align:center; font-family:Arial Narrow" rules="all">
		<? foreach($trims_data_arr as $trimsid=>$podata){ ?>
			<tr><td colspan="<?= 8+count($precost_wise_size[$trimsid]) ?>"><?= $item_name_library[$trims_wise_data[$trimsid]['trim_group']] ?></td></tr>
			<tr><td colspan="<?= 8+count($precost_wise_size[$trimsid]) ?>"><?= $trims_wise_data[$trimsid]['brand_sup_ref'] ?></td></tr>
			<tr>
				<th width="40">SL</th>
				<th width="120">PO Number/IR</th>
				<th width="60">Gmts Color</th>
				<th width="80">Item Description</th>
				<th width="60">UOM</th>
				<? 
				$sort_size=ksort($precost_wise_size[$trimsid]);
				foreach($precost_wise_size[$trimsid] as $sizeid){ ?>
				<th width="60"><?= $size_library[$sizeid] ?></th>
				<? } ?>
				<th width="60">TOTAL / PCS</th>
				<th width="80">Item Print</th>
				<th width="80">Picture</th>
			</tr>
			<? 
			$k=1;
			foreach($podata as $powise_dtls){
				$i=1; 	$item_wise_dtls=0;		
				foreach($powise_dtls['dtls_data'] as $sizedtls){
					if($i==1){?>
					<tr>
					<td rowspan="<?= count($powise_dtls['dtls_data']) ?>"><?= $k ?></td>
					<td rowspan="<?= count($powise_dtls['dtls_data']) ?>"><?= 'PO:'.$powise_dtls['po_number'].'<br>IR No:'.$powise_dtls['ir_no'] ?></td>
					<? 
					}
					if($i!=1) echo '<tr>';
					?>
					<td title="<?= $i ?>"><?= $color_library[$sizedtls['gmts_color']] ?></td>
					<td><?= $sizedtls['description'] ?></td>
					<td><?= $unit_of_measurement[$sizedtls['cons_uom']] ?></td>
					<? 
					$sizetotal=0;
					foreach($precost_wise_size[$trimsid] as $sizeid){ ?>
					<td align="right"><?= round($sizedtls['size_qty'][$sizeid]); ?></td>
					<? 
						$sizetotal+=round($sizedtls['size_qty'][$sizeid]);
						$item_wise_dtls+=round($sizedtls['size_qty'][$sizeid]);
					} 
					?>
					<td align="right"><?= $sizetotal ?></td>
					<? if($i==1){?>
					<td rowspan="<?= count($powise_dtls['dtls_data']) ?>"><?= $itemPrintArr[$sizedtls['item_print']] ?></td>
					<? if($sizedtls['image_location']!=''){ ?>
					<td rowspan="<?= count($powise_dtls['dtls_data']) ?>"><img  src='<? echo '../../'.$sizedtls['image_location']; ?>' height='70' align="center" width='80'/></td>
					<? } else { ?>
					<td rowspan="<?= count($powise_dtls['dtls_data']) ?>"></td>
					<? } 
					}
					?>

				<? 
				$i++;
				} ?>
			</tr>
			<tr>
				<td colspan="<?= 5+count($precost_wise_size[$trimsid]) ?>" align="right"><b>Item Total</b></td>
				<td align="right"><b><?= $item_wise_dtls ?></b></td>
				<td></td>
				<td></td>
			</tr>
			<? 
			$k++; 
			} ?>
		<? } ?>

	</table>
	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:500px; margin-top: 10px; text-align:center; font-family:Arial Narrow" rules="all">
		<tr><td colspan="5">Summary</td></tr>
		<tr>
			<th width="40">SL</th>
			<th width="150">Item Group</th>
			<th width="150">Description</th>
			<th width="80">UOM</th>
			<th width="80">WO Qty.</th>
		</tr>
		<? 
		$i=1;
		foreach($trims_wise_data as $summary){ ?>
			<tr>
				<td><?= $i ?></td>
				<td><?= $item_name_library[$summary['trim_group']] ?></td>
				<td><?= $summary['description'] ?></td>
				<td><?= $unit_of_measurement[$summary['cons_uom']] ?></td>
				<td><?= $summary['qty'] ?></td>
			</tr>
		<? $i++;
		} ?>
	</table>
	</div>
     <?  echo signature_table(109, $cbo_company_name, "1050px");?>
    </div>
	 <?
	exit();
}

if($action=="preCostRpt13")//Cost Rpt13, Btn Id 40 ISD-23-23737 for Renaissance
{   
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	if($txt_job_no=="") $job_noCond=''; else $job_noCond=" and a.job_no=".$txt_job_no."";

	$txt_costing_date=change_date_format(str_replace("'","",$txt_costing_date),'yyyy-mm-dd','-');
	if($cbo_company_name=="") $company_name=''; else $company_name=" and a.company_name=".$cbo_company_name."";
	if($cbo_buyer_name=="") $cbo_buyer_name=''; else $cbo_buyer_name=" and a.buyer_name=".$cbo_buyer_name."";
	if($txt_style_ref=="") $txt_style_ref=''; else $txt_style_ref=" and a.style_ref_no=".$txt_style_ref."";
	if($txt_costing_date=="") $txt_costing_date=''; else $txt_costing_date=" and b.costing_date='".$txt_costing_date."'";

	//array for display name
	
	$comp=return_library_array("select id, company_short_name from lib_company",'id','company_short_name');
	$buyer_arr=return_library_array("select id, buyer_name from lib_buyer",'id','buyer_name');
	$brand_arr=return_library_array("select id, brand_name from lib_buyer_brand",'id','brand_name');
	$season_arr=return_library_array("select id, season_name from lib_buyer_season",'id','season_name');
	//$color_library=return_library_array( "select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");

	 $po_qty=0; $po_plun_cut_qty=0; $total_set_qnty=0; $job_in_orders = ''; $pulich_ship_date=''; $job_in_file = ''; $job_in_ref = ''; $postatus='';
	 $sql_po="select a.job_no, a.total_set_qnty, b.id, b.po_number, b.grouping, b.file_no, b.pub_shipment_date, b.is_confirmed, c.item_number_id, c.country_id, c.color_number_id, c.size_number_id, c.order_quantity, c.plan_cut_qnty from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and b.id=c.po_break_down_id and a.job_no =".$txt_job_no." and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 order by b.id";
	//echo $sql_po;
	$sql_po_data=sql_select($sql_po); 
	foreach($sql_po_data as $sql_po_row){
		$po_qty+=$sql_po_row[csf('order_quantity')];
		$po_plun_cut_qty+=$sql_po_row[csf('plan_cut_qnty')];
		$total_set_qnty=$sql_po_row[csf('total_set_qnty')];
		
		$job_in_orders .= $sql_po_row[csf('po_number')].", ";
		$pulich_ship_date = $sql_po_row[csf('pub_shipment_date')];
		$job_in_file .= $sql_po_row[csf('file_no')].",";
		$job_in_ref .= $sql_po_row[csf('grouping')].",";
		$postatus .= $order_status[$sql_po_row[csf('is_confirmed')]].",";
		//echo $sql_po_row[csf('is_confirmed')].'-'.$order_status[$sql_po_row[csf('is_confirmed')]].'<br>';
	}
	//echo $postatus; die;
	$job_in_orders = substr(trim($job_in_orders),0,-1);
	$job_ref=array_unique(explode(",",rtrim($job_in_ref,", ")));
	$job_file=array_unique(explode(",",rtrim($job_in_file,", ")));
	$postatus=array_unique(explode(",",rtrim($postatus,", ")));

	foreach ($job_ref as $ref){
		$ref_cond.=", ".$ref;
	}
	$file_con='';
	foreach ($job_file as $file){
		if($file_con=='') $file_cond=$file; else $file_cond.=", ".$file;
	}
	$postatusstrshow='';
	foreach ($postatus as $postatusstr){
		if($postatusstrshow=='') $postatusstrshow=$postatusstr; else $postatusstrshow.=", ".$postatusstr;
	}
	//echo $postatusstrshow.'==';

	$gmtsitem_ratio_array=array();
	$gmtsitem_ratio_sql=sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no =".$txt_job_no."");// where job_no ='FAL-14-01157'
	foreach($gmtsitem_ratio_sql as $gmtsitem_ratio_sql_row){
		$gmtsitem_ratio_array[$gmtsitem_ratio_sql_row[csf('job_no')]][$gmtsitem_ratio_sql_row[csf('gmts_item_id')]]=$gmtsitem_ratio_sql_row[csf('set_item_ratio')];
	}
	
	$financial_para=array();
	$sql_std_para=sql_select("select interest_expense,income_tax,cost_per_minute,applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$cbo_company_name and status_active=1 and is_deleted=0 order by id");
	foreach($sql_std_para as $row )
	{
		$applying_period_date=change_date_format($row[csf('applying_period_date')],'','',1);
		$applying_period_to_date=change_date_format($row[csf('applying_period_to_date')],'','',1);
		$diff=datediff('d',$applying_period_date,$applying_period_to_date);
		for($j=0;$j<$diff;$j++)
		{
			//$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);
			$date_all=add_date(str_replace("'","",$applying_period_date),$j);
			$newdate =change_date_format($date_all,'','',1);
			$financial_para[$newdate][interest_expense]=$row[csf('interest_expense')];
			$financial_para[$newdate][income_tax]=$row[csf('income_tax')];
			$financial_para[$newdate][cost_per_minute]=$row[csf('cost_per_minute')];
		}
	}
	//print_r($financial_para['12-Nov-2023']);
	
	$job_no=str_replace("'","",$txt_job_no);
	
	$condition= new condition();
	if(str_replace("'","",$txt_job_no) !=''){
		$condition->job_no("=$txt_job_no");
	}
	if(str_replace("'",'',$txt_po_breack_down_id) !=""){
		$condition->po_id("in($txt_po_breack_down_id)");
	}
	$condition->init();
	$fabric= new fabric($condition);
	$yarn= new yarn($condition);
	$conversion= new conversion($condition);
	$trim= new trims($condition);
	$emblishment= new emblishment($condition);
	$wash= new wash($condition);
	$other= new other($condition);
	
	$commercial= new commercial($condition);
	$commision= new commision($condition);
	
	$fabric_costing_arr=$fabric->getAmountArray_by_job_knitAndwoven_greyAndfinish();
	$yarn_costing_arr=$yarn->getJobWiseYarnAmountArray();
	
	$conversion_costing_arr_process=$conversion->getAmountArray_by_job();
	$trims_costing_arr=$trim->getAmountArray_by_job();
	$emblishment_costing_arr=$emblishment->getAmountArray_by_job();
	$emblishment_costing_arr_wash=$wash->getAmountArray_by_job();
	
	$commercial_costing_arr=$commercial->getAmountArray_by_job();
	$commission_costing_arr=$commision->getAmountArray_by_job();
	$other_costing_arr=$other->getAmountArray_by_job();
	
	$ttl_cm_cost=$other_costing_arr[$job_no]['cm_cost'];
	
	$sql_dtls = "select job_no, fabric_cost, fabric_cost_percent, trims_cost, trims_cost_percent, embel_cost, embel_cost_percent, wash_cost, wash_cost_percent, comm_cost, comm_cost_percent, commission, commission_percent, lab_test, lab_test_percent, inspection, inspection_percent, cm_cost, cm_cost_percent, freight, freight_percent, currier_pre_cost, currier_percent, certificate_pre_cost, certificate_percent, common_oh, common_oh_percent, depr_amor_pre_cost, deffdlc_cost, deffdlc_percent, total_cost, total_cost_percent, price_dzn, price_dzn_percent, margin_dzn, margin_dzn_percent, price_pcs_or_set, price_pcs_or_set_percent, margin_pcs_set, margin_pcs_set_percent, cm_for_sipment_sche
	from wo_pre_cost_dtls where job_no=".$txt_job_no." and status_active=1 and is_deleted=0";
	$data_array_new=sql_select($sql_dtls);
	
	$summary_data=array();
	foreach($data_array_new as $row_new ){
		$summary_data[price_dzn]=$row_new[csf("price_dzn")];
		$summary_data[price_dzn_job]=($po_qty/($total_set_qnty*$order_price_per_dzn))*$row_new[csf("price_dzn")];
		$summary_data[commission]=$row_new[csf("commission")];
		$summary_data[trims_cost]=$row_new[csf("trims_cost")];
		$summary_data[emb_cost]=$row_new[csf("embel_cost")];

		$summary_data[lab_test]=$row_new[csf("lab_test")];
		$summary_data[lab_test_job]=$other_costing_arr[$row_new[csf("job_no")]]['lab_test'];

		$summary_data[inspection]=$row_new[csf("inspection")];
		$summary_data[inspection_job]=$other_costing_arr[$row_new[csf("job_no")]]['inspection'];

		$summary_data[freight]=$row_new[csf("freight")];
		$summary_data[freight_job]=$other_costing_arr[$row_new[csf("job_no")]]['freight'];

		$summary_data[currier_pre_cost]=$row_new[csf("currier_pre_cost")];
		$summary_data[currier_pre_cost_job]=$other_costing_arr[$row_new[csf("job_no")]]['currier_pre_cost'];

		$summary_data[certificate_pre_cost]=$row_new[csf("certificate_pre_cost")];
		$summary_data[certificate_pre_cost_job]=$other_costing_arr[$row_new[csf("job_no")]]['certificate_pre_cost'];
		$summary_data[wash_cost]=$row_new[csf("wash_cost")];

		$summary_data[OtherDirectExpenses]=$row_new[csf("lab_test")]+$row_new[csf("inspection")]+$row_new[csf("freight")]+$row_new[csf("currier_pre_cost")]+$row_new[csf("certificate_pre_cost")]+$row_new[csf("wash_cost")];
		$summary_data[OtherDirectExpenses_job]=$summary_data[lab_test_job]+$summary_data[inspection_job]+$summary_data[freight_job]+$summary_data[currier_pre_cost_job]+$summary_data[certificate_pre_cost_job];

		$summary_data[cm_cost]=$row_new[csf("cm_cost")];
		$summary_data[cm_cost_job]=$other_costing_arr[$row_new[csf("job_no")]]['cm_cost'];
		$summary_data[comm_cost]=$row_new[csf("comm_cost")];
		$summary_data[common_oh]=$row_new[csf("common_oh")];
		$summary_data[common_oh_job]=$other_costing_arr[$row_new[csf("job_no")]]['common_oh'];
		$summary_data[depr_amor_pre_cost]=$row_new[csf("depr_amor_pre_cost")];
		$summary_data[depr_amor_pre_cost_job]=$other_costing_arr[$row_new[csf("job_no")]]['depr_amor_pre_cost'];
		$summary_data[margindzn]=$row_new[csf("margin_dzn")];
		$summary_data[fabric_percent]=$row_new[csf("fabric_cost_percent")];
		$summary_data[trims_percent]=$row_new[csf("trims_cost_percent")];
		$summary_data[wash_percent]=$row_new[csf("wash_cost_percent")];
		$summary_data[emb_percent]=$row_new[csf("embel_cost_percent")];
		$summary_data[commercial_percent]=$row_new[csf("comm_cost_percent")];
		$summary_data[currier_percent]=$row_new[csf("currier_percent")];
		$summary_data[commission_percent]=$row_new[csf("commission_percent")];
		$summary_data[lab_test_percent]=$row_new[csf("lab_test_percent")];
		$summary_data[freight_percent]=$row_new[csf("freight_percent")];
		$summary_data[margin_dzn_percent]=$row_new[csf("margin_dzn_percent")];
		$summary_data[cm_cost_percent]=$row_new[csf("cm_cost_percent")];
		$summary_data[inspection_percent]=$row_new[csf("inspection_percent")];
		$summary_data[deffdlc_percent]=$row_new[csf("deffdlc_percent")];
		$summary_data[common_oh_percent]=$row_new[csf("common_oh_percent")];
	}
	unset($data_array_new);

	$fab_knit_req_kg_avg=0; $fab_woven_req_yds_avg=0;
	
    $sql = "select a.job_no, a.company_name, a.buyer_name, a.brand_id, a.season_buyer_wise, a.style_ref_no, a.quotation_id, a.gmts_item_id, a.order_uom, a.job_quantity, a.avg_unit_price, b.costing_per, b.budget_minute, b.costing_date, b.exchange_rate, b.incoterm, b.sew_smv, b.cut_smv, b.sew_effi_percent, b.cut_effi_percent, b.approved, c.fab_knit_req_kg, c.fab_knit_fin_req_kg, c.fab_woven_req_yds, c.fab_woven_fin_req_yds, c.fab_yarn_req_kg from wo_po_details_master a, wo_pre_cost_mst b left join wo_pre_cost_sum_dtls c on b.job_no=c.job_no where a.job_no=b.job_no and a.status_active=1 $job_noCond $company_name $cbo_buyer_name order by a.job_no";
	$data_array=sql_select($sql);
	$uom=""; $sew_smv=0; $cut_smv=0; $sew_effi_percent=0; $cut_effi_percent=$order_price_per_dzn=0; $cpmCal=0; $poQty=0;
	foreach ($data_array as $row){
		$order_price_per_dzn=0; $order_job_qnty=0; $avg_unit_price=0;
		$sew_smv=$row[csf("sew_smv")];
	    $cut_smv=$row[csf("cut_smv")];
	    $sew_effi_percent=$row[csf("sew_effi_percent")];
	    $cut_effi_percent=$row[csf("cut_effi_percent")];
		$order_values = $row[csf("job_quantity")]*$row[csf("avg_unit_price")];
		$pre_costing_date=change_date_format($row[csf('costing_date')],'','',1);
		$poQty=$row[csf("job_quantity")];
		
		if($row[csf("costing_per")]==1){
            $order_price_per_dzn=12;
            $costing_for=" DZN";
        }
        else if($row[csf("costing_per")]==2){
            $order_price_per_dzn=1;
            $costing_for=" PCS";
        }
        else if($row[csf("costing_per")]==3){
            $order_price_per_dzn=24;
            $costing_for=" 2 DZN";
        }
        else if($row[csf("costing_per")]==4){
            $order_price_per_dzn=36;
            $costing_for=" 3 DZN";
        }
        else if($row[csf("costing_per")]==5){
            $order_price_per_dzn=48;
            $costing_for=" 4 DZN";
        }
		?>
        <style>
		.vl {
		  border-left: 3px solid green;
		  position: absolute;
		  left: 50%;
		  top: 0;
		}
		</style>
        <table style="width:930px">
        	<tr>
            	<td colspan="3" align="left" style="font-size:14px; font-family:'Calibri Light';">
                	<b>COST SHEET</b>
                    <br />
                    <b style="font-size:14px; font-family:'Calibri Light'; background-color:#FFFFCC">Cost Sheet Revised No: <?
						$nameArray_approved = sql_select("select max(b.approved_no) as approved_no from wo_pre_cost_mst a, approval_history b where a.id=b.mst_id and a.job_no=".$txt_job_no." and b.entry_form=46");
							if(isset($nameArray_approved[0][csf('approved_no')]) ){
								echo ($nameArray_approved[0][csf('approved_no')]-1)*1;
							}
							else{ echo 0; }
						 ?>
					</b>
                </td>
			    <?
                $image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id=$cbo_company_name","image_location");
                $path=($path)?$path:'../../';
                ?>
                <td colspan="3" align="right"><img src='<? echo $path.$image_location; ?>' height='40' width='100' /><br /><?=date("l\, jS \of F\, Y"); ?></td>
           </tr>
       </table>

       <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:930px" rules="all">
            <tr>
                <td width="120" style="font-size:14px; font-family:'Calibri Light';"><b>Company</b></td>
                <td width="150" style="font-size:14px; font-family:'Calibri Light';"><b><? echo $comp[$row[csf("company_name")]]; ?></b></td>
                <td width="130" style="font-size:14px; font-family:'Calibri Light';" ><b>SMV/<?=$costing_for; ?></b></td>
                <td width="150" style="font-size:14px; font-family:'Calibri Light';" colspan="2"><b><? echo $sew_smv; ?></b></td>
                <td rowspan="12">
                	<?
					//echo $financial_para[$pre_costing_date][cost_per_minute].'=='.$row[csf("exchange_rate")].'=='.($sew_effi_percent/100);
					$fab_purchase_knit=array_sum($fabric_costing_arr['knit']['grey'][$job_no]);
					$fab_purchase_woven=array_sum($fabric_costing_arr['woven']['grey'][$job_no]);
					$yarn_costing=$yarn_costing_arr[$job_no];
					$conversion_cost=array_sum($conversion_costing_arr_process[$job_no]);
					
					$fabricCost=$fab_purchase_knit+$fab_purchase_woven+$yarn_costing+$conversion_cost;
					//echo $financial_para[$pre_costing_date][cost_per_minute].'=='.$row[csf("exchange_rate")].'=='.($sew_effi_percent/100);
					$cpmCal=($financial_para[$pre_costing_date][cost_per_minute]/$row[csf("exchange_rate")])/($sew_effi_percent/100);
					$totMaterialCost=$fabricCost+$trims_costing_arr[$job_no]+$emblishment_costing_arr_wash[$job_no]+$emblishment_costing_arr[$job_no];
					$otherCost=$commercial_costing_arr[$job_no]+$other_costing_arr[$job_no]['currier_pre_cost']+$commission_costing_arr[$job_no]+$other_costing_arr[$job_no]['lab_test']+$other_costing_arr[$job_no]['inspection']+$other_costing_arr[$job_no]['common_oh']+$other_costing_arr[$job_no]['deffdlc_cost']+$other_costing_arr[$job_no]['freight'];
					
					$breakevencm=$cpmCal*$sew_smv*$poQty;
					$calCM=$order_values-($totMaterialCost+$otherCost);
					$cmPcs=$calCM/$poQty;
					$totalMargin=$calCM-$breakevencm;
					$marginPcs=$totalMargin/$poQty;
					
					// image show here  -------------------------------------------
					$sqlData = "select id,master_tble_id,image_location from common_photo_library where master_tble_id=".$txt_job_no."";
					$data_array_img=sql_select($sqlData);
					$path=($path)?$path:'../../';
					?>
					<div>
					<? foreach($data_array_img as $inf){ ?>
						<img  src='<? echo $path.$inf[csf("image_location")]; ?>' border="1" height='200px' width='150px' />
					<?  } ?>
					</div>
                </td>
            </tr>
            <tr>
            	<td style="font-size:14px; font-family:'Calibri Light';"><b>Job Number</b></td>
                <td style="font-size:14px; font-family:'Calibri Light';"><b><?=$row[csf("job_no")]; ?></b></td>
                <td style="font-size:14px; font-family:'Calibri Light';"><b>Planned Efficiency</b></td>
                <td style="font-size:14px; font-family:'Calibri Light';" colspan="2"><b><?=$sew_effi_percent; ?>%</b></td>
            </tr>
            <tr>
            	<td style="font-size:14px; font-family:'Calibri Light';"><b>Buyer</b></td>
                <td style="font-size:14px; font-family:'Calibri Light';"><b><?=$buyer_arr[$row[csf("buyer_name")]]; ?></b></td>
                <td style="font-size:14px; font-family:'Calibri Light';background-color:#FFC"><b>Margin/<?=$costing_for; ?></b></td>
                <td style="font-size:14px; font-family:'Calibri Light';background-color:#FFC" width="75"><b><?=fn_number_format($marginPcs,3); ?></b></td>
                <td style="font-size:14px; font-family:'Calibri Light';background-color:#FFC" width="75" align="center"><?=fn_number_format((($totalMargin/$order_values)*100),2).' %';//$summary_data[margin_dzn_percent].' %'; ?></td>
            </tr>
            <tr>
            	<td style="font-size:14px; font-family:'Calibri Light';"><b>Brand</b></td>
                <td style="font-size:14px; font-family:'Calibri Light';"><b><?=$brand_arr[$row[csf("brand_id")]]; ?></b></td>
                <td style="font-size:14px; font-family:'Calibri Light';background-color:#FFC" ><b>CM/<?=$costing_for; ?></b></td>
                <td style="font-size:14px; font-family:'Calibri Light';background-color:#FFC" width="75"><b><?=fn_number_format($cmPcs,3); ?></b></td>
                <td style="font-size:14px; font-family:'Calibri Light';background-color:#FFC" width="75" align="center"><b><?=fn_number_format((($calCM/$order_values)*100),2).' %';//$summary_data[cm_cost_percent].' %'; ?></b></td>
            </tr>
            <tr>
            	<td style="font-size:14px; font-family:'Calibri Light';"><b>Costed Date</b></td>
                <td style="font-size:14px; font-family:'Calibri Light';"><b><?=change_date_format($pre_costing_date); ?></b></td>
                <td style="font-size:14px; font-family:'Calibri Light';background-color:#FFC"><b>EPM</b></td>
                <td style="font-size:14px; font-family:'Calibri Light';background-color:#FFC" colspan="2"><b><? $epm=$cmPcs/$sew_smv; echo fn_number_format($epm,3); ?></b></td>
            </tr>
            <tr>
            	<td style="font-size:14px; font-family:'Calibri Light';"><b>Season</b></td>
                <td style="font-size:14px; font-family:'Calibri Light';"><b><?=$season_arr[$row[csf("season_buyer_wise")]]; ?></b></td>
                <td style="font-size:14px; font-family:'Calibri Light';background-color:#FFC"><b>CPM</b></td>
                <td style="font-size:14px; font-family:'Calibri Light';background-color:#FFC" colspan="2" title="CPM (USD)/Planned Efficiency"><b><?=fn_number_format($cpmCal,3); ?></b></td>
            </tr>
            <tr>
            	<td style="font-size:14px; font-family:'Calibri Light';"><b>Garments Item</b></td>
                <?
                    $grmnt_items = "";
                    if($garments_item[$row[csf("gmts_item_id")]]=="")
                    {

                        $grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no=$txt_job_no");
                        foreach($grmts_sql as $key=>$val){
                            $grmnt_items .=$garments_item[$val[csf("gmts_item_id")]].", ";
                        }
                        $grmnt_items = substr_replace($grmnt_items,"",-1,1);
                    }else{
                        $grmnt_items = $garments_item[$row[csf("gmts_item_id")]];
                    }
					
					$appStatus="No"; $appStatusTdColor="#FF7377";
					if($row[csf("approved")]==1 || $row[csf("approved")]==3) { $appStatus="Yes";  $appStatusTdColor="#90EE90"; }
                ?>
                <td style="font-size:14px; font-family:'Calibri Light';"><b><?=$grmnt_items; ?></b></td>
                <td style="font-size:14px; font-family:'Calibri Light';"><b>Order Qty</b></td>
                <td style="font-size:14px; font-family:'Calibri Light';" colspan="2"><b><?=$row[csf("job_quantity")]." ". $unit_of_measurement[$row[csf("order_uom")]]; ?></b></td>
            </tr>
            <tr>
            	<td style="font-size:14px; font-family:'Calibri Light';"><b>Buyer Style Ref. No</b></td>
                <td style="font-size:14px; font-family:'Calibri Light';"><b><?=$row[csf("style_ref_no")]; ?></b></td>
                <td style="font-size:14px; font-family:'Calibri Light';"><b>Plan Qty</b></td>
                <td style="font-size:14px; font-family:'Calibri Light';" colspan="2"><b><?=$po_plun_cut_qty/$total_set_qnty." ". $unit_of_measurement[$row[csf("order_uom")]];?></b></td>
            </tr>
            <tr>
            	<td style="font-size:14px; font-family:'Calibri Light';"><b>Costing Per</b></td>
                <td style="font-size:14px; font-family:'Calibri Light';"><b><?=$costing_per[$row[csf("costing_per")]]; ?></b></td>
                <td style="font-size:14px; font-family:'Calibri Light';"><b>Price Per Piece</b></td>
                <td style="font-size:14px; font-family:'Calibri Light';" colspan="2"><b><?=$row[csf("avg_unit_price")]; ?> USD</b></td>
            </tr>
            <tr>
            	<td style="font-size:14px; font-family:'Calibri Light';"><b>Order Status</b></td>
                <td style="font-size:14px; font-family:'Calibri Light';"><b><?=$postatusstrshow; ?></b></td>
                <td style="font-size:14px; font-family:'Calibri Light';"><b>Total Value</b></td>
                <td style="font-size:14px; font-family:'Calibri Light';" colspan="2"><b><?=fn_number_format($order_values,3); ?> USD</b></td>
                
            </tr>
            <tr>
            	<td style="font-size:14px; font-family:'Calibri Light';"><b>Terms</b></td>
                <td style="font-size:14px; font-family:'Calibri Light';"><b><?=$incoterm[$row[csf("incoterm")]]; ?></b></td>
                <td style="font-size:14px; font-family:'Calibri Light';"><b>Cost Sheet Approved</b></td>
                <td style="font-size:14px; font-family:'Calibri Light'; background-color:<?=$appStatusTdColor; ?>" colspan="2"><b><?=$appStatus; ?></b></td>
            </tr>
            <tr>
                <td style="font-size:14px; font-family:'Calibri Light';">&nbsp;</td>
                <td style="font-size:14px; font-family:'Calibri Light';">&nbsp;</td>
                <td style="font-size:14px; font-family:'Calibri Light';"><b>Commercial Cost %</b></td>
                <td style="font-size:14px; font-family:'Calibri Light';" colspan="2"><b><?=$summary_data[commercial_percent]; ?></b></td>
            </tr>
        </table>
        <?
        $order_job_qnty=$row[csf("job_quantity")];
        $avg_unit_price=$row[csf("avg_unit_price")];
	}//end first foearch
	//start	all summary report here -------------------------------------------
	
	
	$lib_yarn_count=return_library_array("select yarn_count,id from lib_yarn_count", "id", "yarn_count");
	$fabricWiseTotRateArr=array();
	?>
    <br />
    <div style="border:2px solid black; width:930px">
    <table cellpadding="1" cellspacing="1" style="width:920px">
    	<tr>
        	<td width="306" valign="top">
            	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:305px" rules="all">
                	<tr>
                    	<td style="font-size:14px; font-family:'Calibri Light';" colspan="3" align="center"><b>Materials Cost Summary</b></td>
                    </tr>
                	<tr>
                        <td width="120" style="font-size:14px; font-family:'Calibri Light';" align="center"><b>Item</b></td>
                        <td width="100" style="font-size:14px; font-family:'Calibri Light';" align="center"><b>Value</b></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><b>%</b></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';">Fabric</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center" title="<?=$fab_purchase_knit.'='.$fab_purchase_woven.'='.$yarn_costing.'='.$conversion_cost; ?>">$ <?=fn_number_format($fabricCost,3); ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?=fn_number_format((($fabricCost/$order_values)*100),2); ?></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';">Trims</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center">$ <?=fn_number_format($trims_costing_arr[$job_no],3); ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?=fn_number_format((($trims_costing_arr[$job_no]/$order_values)*100),2); ?></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';">Wash</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center">$ <?=fn_number_format($emblishment_costing_arr_wash[$job_no],3); ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?=fn_number_format((($emblishment_costing_arr_wash[$job_no]/$order_values)*100),2); ?></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';">Embellishment</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center">$ <?=fn_number_format($emblishment_costing_arr[$job_no],3); ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?=fn_number_format((($emblishment_costing_arr[$job_no]/$order_values)*100),2); ?></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';"><b>&nbsp;</b></td>
                        <td style="font-size:14px; font-family:'Calibri Light';"><b>&nbsp;</b></td>
                        <td style="font-size:14px; font-family:'Calibri Light';"><b>&nbsp;</b></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="right"><b>Total :</b></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><b><? echo fn_number_format($totMaterialCost,3); ?></b></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><b><?=fn_number_format((($totMaterialCost/$order_values)*100),2); ?></b></td>
                    </tr>
                </table>
            </td>
            <td width="3">&nbsp;</td>
        	<td width="306" valign="top">
            	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:305px" rules="all">
                	<tr>
                    	<td style="font-size:14px; font-family:'Calibri Light';" colspan="3" align="center"><b>Other Costs Summary</b></td>
                    </tr>
                	<tr>
                        <td width="120" style="font-size:14px; font-family:'Calibri Light';" align="center"><b>Item</b></td>
                        <td width="100" style="font-size:14px; font-family:'Calibri Light';" align="center"><b>Value</b></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><b>%</b></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';" >Commercial Cost</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center">$ <?=fn_number_format($commercial_costing_arr[$job_no],3); ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?=fn_number_format((($commercial_costing_arr[$job_no]/$order_values)*100),2); ?></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';" >Courier Cost</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center">$ <?=fn_number_format($other_costing_arr[$job_no]['currier_pre_cost'],3); ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?=fn_number_format((($other_costing_arr[$job_no]['currier_pre_cost']/$order_values)*100),2); ?></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';" >Commission</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center">$ <?=fn_number_format($commission_costing_arr[$job_no],3); ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?=fn_number_format((($commission_costing_arr[$job_no]/$order_values)*100),2); ?></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';" >Lab Test</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center">$ <?=fn_number_format($other_costing_arr[$job_no]['lab_test'],3); ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?=fn_number_format((($other_costing_arr[$job_no]['lab_test']/$order_values)*100),2); ?></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';" >Inspection Cost</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center">$ <?=fn_number_format($other_costing_arr[$job_no]['inspection'],3); ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?=fn_number_format((($other_costing_arr[$job_no]['inspection']/$order_values)*100),2); ?></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';" >Opt Exp Cost</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center">$ <?=fn_number_format($other_costing_arr[$job_no]['common_oh'],3); ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?=fn_number_format((($other_costing_arr[$job_no]['common_oh']/$order_values)*100),2); ?></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';" >Deffd. LC/DC Cost</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center">$ <?=fn_number_format($other_costing_arr[$job_no]['deffdlc_cost'],3); ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?=fn_number_format((($other_costing_arr[$job_no]['deffdlc_cost']/$order_values)*100),2); ?></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';" >Freight Cost</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center">$ <?=fn_number_format($other_costing_arr[$job_no]['freight'],3); ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?=fn_number_format((($other_costing_arr[$job_no]['freight']/$order_values)*100),2); ?></td>
                    </tr>
                    <!--<tr>
                        <td style="font-size:14px; font-family:'Calibri Light';" >CM Cost</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center">$ <? //=fn_number_format($other_costing_arr[$job_no]['cm_cost'],3); ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><? //=fn_number_format((($other_costing_arr[$job_no]['cm_cost']/$order_values)*100),2); ?></td>
                    </tr>-->
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="right"><b>Total :</b></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><b><? echo fn_number_format($otherCost,3); ?></b></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><b><?=fn_number_format((($otherCost/$order_values)*100),2); ?></b></td>
                    </tr>
                </table>
            </td>
            <td width="3">&nbsp;</td>
            <td valign="top">
            	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:296px" rules="all">
                	<tr>
                    	<td style="font-size:14px; font-family:'Calibri Light';" colspan="3" align="center"><b>Order Profitability Summary</b></td>
                    </tr>
                    <tr>
                        <td width="150" style="font-size:14px; font-family:'Calibri Light';" >Total FOB Value</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center">$ <?=fn_number_format($order_values,3); ?></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';" >Materials Costs</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center">$ <?=fn_number_format($totMaterialCost,3); ?></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';" >Other Costs</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center">$ <?=fn_number_format($otherCost,3); ?></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';" >CM</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center">$ <? echo fn_number_format($calCM,3); ?></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';">Breakeven CM :</td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center" title="CPM*SMV*PO QTY">$<? echo fn_number_format($breakevencm,3); ?></td>
                    </tr>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="right"><b>Margin :</b></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><b><? echo fn_number_format($totalMargin,3); ?></b></td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
    </div>
	
    <!--Yarn =====================-->
    <? if($zero_value==1) { ?>
    <div style="margin-top:15px">
    	<label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b>Yarn Cost Details</b></label>
    	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:930px;" rules="all">
        	<tbody>
                <tr style="font-weight:bold; background-color:#FFC" align="center">
                    <td width="82" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Yarn Type</td>
                    <td width="80" style="font-size:14px; font-family:'Calibri Light';">Yarn Count</td>
                    <td width="200" style="font-size:14px; font-family:'Calibri Light';">Yarn Description</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">UOM</td>
                    <td width="60" style="font-size:14px; font-family:'Calibri Light';">YY</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Process Loss %</td>
                    <td width="60" style="font-size:14px; font-family:'Calibri Light';">Total YY</td>
                    
                    <td width="80" style="font-size:14px; font-family:'Calibri Light';">Req. Qty</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Rate</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Cost/<?=$costing_for; ?></td>
                    <td width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</td>
                    <td style="font-size:14px; font-family:'Calibri Light';">%</td>
                </tr>
          	
            
			<?
            $yarn_data_array=$yarn->getCountCompositionPercentTypeColorAndRateWiseYarnQtyAndAmountArray();
			$sql_yarn = "select MIN(ID) AS ID, LISTAGG(CAST(FABRIC_COST_DTLS_ID AS VARCHAR(4000)), ',') WITHIN GROUP (ORDER BY FABRIC_COST_DTLS_ID) as FABRIC_ROWID, COUNT_ID, COPM_ONE_ID, PERCENT_ONE, COPM_TWO_ID, PERCENT_TWO, COLOR, TYPE_ID, MIN(CONS_RATIO) AS CONS_RATIO, SUM(CONS_QNTY) AS CONS_QNTY, RATE, SUM(AMOUNT) AS AMOUNT from wo_pre_cost_fab_yarn_cost_dtls where job_no=".$txt_job_no." and status_active=1 and is_deleted=0 group by count_id, copm_one_id, percent_one, copm_two_id, percent_two, color, type_id, rate";
            $sql_yarnArr=sql_select($sql_yarn); $i=1; $yarnamtTotDzn=$yarnReqAmttotal=$yarnPerTotal=0;
            foreach($sql_yarnArr as $yrow)
            {
				$item_descrition ="";
				if($yrow["PERCENT_ONE"]==100)
					$item_descrition = $lib_yarn_count[$yrow["COUNT_ID"]]." ".$composition[$yrow["COPM_ONE_ID"]]." ".$yrow["PERCENT_ONE"]."% ".$color_library[$yrow["COLOR"]]." ".$yarn_type[$yrow["TYPE_ID"]];
            	else
					$item_descrition = $lib_yarn_count[$yrow["COUNT_ID"]]." ".$composition[$yrow["COPM_ONE_ID"]]." ".$yrow["PERCENT_ONE"]."% ".$composition[$yrow["COPM_TWO_ID"]]." ".$yrow["PERCENT_TWO"]."% ".$color_library[$yrow["COLOR"]]." ".$yarn_type[$yrow["TYPE_ID"]];
					
				$yrow["UOM"]=12;
				
                $rowYarnReqQty=$rowYarnReqAmt=$yarn_per=0;
                $rowYarnReqQty=$yarn_data_array[$yrow["COUNT_ID"]][$yrow["COPM_ONE_ID"]][$yrow["PERCENT_ONE"]][$yrow["TYPE_ID"]][$yrow["COLOR"]][$yrow["RATE"]]['qty'];
                $rowYarnReqAmt=$yarn_data_array[$yrow["COUNT_ID"]][$yrow["COPM_ONE_ID"]][$yrow["PERCENT_ONE"]][$yrow["TYPE_ID"]][$yrow["COLOR"]][$yrow["RATE"]]['amount'];
                
                $yarn_per=($rowYarnReqAmt/$order_values)*100;
                ?>
                <tr>
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$yarn_type[$yrow["TYPE_ID"]]; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$lib_yarn_count[$yrow["COUNT_ID"]]; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$item_descrition; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$unit_of_measurement[$yrow["UOM"]]; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($yrow["CONS_QNTY"],3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><? //=fn_number_format($yrow["AVG_PROCESS_LOSS"],2); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($yrow["CONS_QNTY"],3); ?></td>
                    
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowYarnReqQty,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($yrow["RATE"],3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($yrow["AMOUNT"],3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowYarnReqAmt,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($yarn_per,2); ?></td>
                </tr>
                <?	
				 $yarnamtTotDzn+=$yrow["AMOUNT"];
				 $yarnReqAmttotal+=$rowYarnReqAmt;
				 $yarnPerTotal+=$yarn_per;
				 
				 $exfabid="";
				 $exfabid=array_unique(array_unique(explode(",",$yrow['FABRIC_ROWID'])));
				 foreach($exfabid as $yfabid)
				 {
				 	$fabricWiseTotRateArr[$yfabid]+=$rowYarnReqAmt;
				 }
            }
            ?>
            </tbody>
            <tfoot>
            	<tr style="background-color:#CCFFFF">
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all" colspan="7" align="right"><b>Total Yarn Cost</b></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($yarnamtTotDzn,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($yarnReqAmttotal,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($yarnPerTotal,2); ?></td>
                </tr>
            </tfoot>
        </table>
    </div>
    <? } else { 
		if(($yarn_costing*1)>0)
		{
			?>
            <div style="margin-top:15px">
                <label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b>Yarn Cost Details</b></label>
                <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:930px;" rules="all">
                    <tbody>
                        <tr style="font-weight:bold; background-color:#FFC" align="center">
                            <td width="82" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Yarn Type</td>
                            <td width="80" style="font-size:14px; font-family:'Calibri Light';">Yarn Count</td>
                            <td width="200" style="font-size:14px; font-family:'Calibri Light';">Yarn Description</td>
                            <td width="50" style="font-size:14px; font-family:'Calibri Light';">UOM</td>
                            <td width="60" style="font-size:14px; font-family:'Calibri Light';">YY</td>
                            <td width="50" style="font-size:14px; font-family:'Calibri Light';">Process Loss %</td>
                            <td width="60" style="font-size:14px; font-family:'Calibri Light';">Total YY</td>
                            
                            <td width="80" style="font-size:14px; font-family:'Calibri Light';">Req. Qty</td>
                            <td width="50" style="font-size:14px; font-family:'Calibri Light';">Rate</td>
                            <td width="50" style="font-size:14px; font-family:'Calibri Light';">Cost/<?=$costing_for; ?></td>
                            <td width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</td>
                            <td style="font-size:14px; font-family:'Calibri Light';">%</td>
                        </tr>
                    
                    <?
                    $yarn_data_array=$yarn->getCountCompositionPercentTypeColorAndRateWiseYarnQtyAndAmountArray();
                    $sql_yarn = "select MIN(ID) AS ID, LISTAGG(CAST(FABRIC_COST_DTLS_ID AS VARCHAR(4000)), ',') WITHIN GROUP (ORDER BY FABRIC_COST_DTLS_ID) as FABRIC_ROWID, COUNT_ID, COPM_ONE_ID, PERCENT_ONE, COPM_TWO_ID, PERCENT_TWO, COLOR, TYPE_ID, MIN(CONS_RATIO) AS CONS_RATIO, SUM(CONS_QNTY) AS CONS_QNTY, RATE, SUM(AMOUNT) AS AMOUNT from wo_pre_cost_fab_yarn_cost_dtls where job_no=".$txt_job_no." and status_active=1 and is_deleted=0 group by count_id, copm_one_id, percent_one, copm_two_id, percent_two, color, type_id, rate";
                    $sql_yarnArr=sql_select($sql_yarn); $i=1; $yarnamtTotDzn=$yarnReqAmttotal=$yarnPerTotal=0;
                    foreach($sql_yarnArr as $yrow)
                    {
                        $item_descrition ="";
                        if($yrow["PERCENT_ONE"]==100)
                            $item_descrition = $lib_yarn_count[$yrow["COUNT_ID"]]." ".$composition[$yrow["COPM_ONE_ID"]]." ".$yrow["PERCENT_ONE"]."% ".$color_library[$yrow["COLOR"]]." ".$yarn_type[$yrow["TYPE_ID"]];
                        else
                            $item_descrition = $lib_yarn_count[$yrow["COUNT_ID"]]." ".$composition[$yrow["COPM_ONE_ID"]]." ".$yrow["PERCENT_ONE"]."% ".$composition[$yrow["COPM_TWO_ID"]]." ".$yrow["PERCENT_TWO"]."% ".$color_library[$yrow["COLOR"]]." ".$yarn_type[$yrow["TYPE_ID"]];
                            
                        $yrow["UOM"]=12;
                        
                        $rowYarnReqQty=$rowYarnReqAmt=$yarn_per=0;
                        $rowYarnReqQty=$yarn_data_array[$yrow["COUNT_ID"]][$yrow["COPM_ONE_ID"]][$yrow["PERCENT_ONE"]][$yrow["TYPE_ID"]][$yrow["COLOR"]][$yrow["RATE"]]['qty'];
                        $rowYarnReqAmt=$yarn_data_array[$yrow["COUNT_ID"]][$yrow["COPM_ONE_ID"]][$yrow["PERCENT_ONE"]][$yrow["TYPE_ID"]][$yrow["COLOR"]][$yrow["RATE"]]['amount'];
                        
                        $yarn_per=($rowYarnReqAmt/$order_values)*100;
                        ?>
                        <tr>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$yarn_type[$yrow["TYPE_ID"]]; ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$lib_yarn_count[$yrow["COUNT_ID"]]; ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$item_descrition; ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$unit_of_measurement[$yrow["UOM"]]; ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($yrow["CONS_QNTY"],3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><? //=fn_number_format($yrow["AVG_PROCESS_LOSS"],2); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($yrow["CONS_QNTY"],3); ?></td>
                            
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowYarnReqQty,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($yrow["RATE"],3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($yrow["AMOUNT"],3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowYarnReqAmt,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($yarn_per,2); ?></td>
                        </tr>
                        <?	
                         $yarnamtTotDzn+=$yrow["AMOUNT"];
                         $yarnReqAmttotal+=$rowYarnReqAmt;
                         $yarnPerTotal+=$yarn_per;
						 
						 $exfabid="";
						 $exfabid=array_unique(array_unique(explode(",",$yrow['FABRIC_ROWID'])));
						 foreach($exfabid as $yfabid)
						 {
							$fabricWiseTotRateArr[$yfabid]+=$rowYarnReqAmt;
						 }
                    }
                    ?>
                    </tbody>
                    <tfoot>
                        <tr style="background-color:#CCFFFF">
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all" colspan="7" align="right"><b>Total Yarn Cost</b></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($yarnamtTotDzn,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($yarnReqAmttotal,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($yarnPerTotal,2); ?></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <?
		}
	}
	?>
    
    <!--Conversion =====================-->
    <? if($zero_value==1) { ?>
    <div style="margin-top:15px">
    	<label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b>Conversion Cost Details</b></label>
    	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:930px;" rules="all">
        	<tbody>
                <tr style="font-weight:bold; background-color:#FFC" align="center">
                    <td width="82" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Process</td>
                    <td width="280" style="font-size:14px; font-family:'Calibri Light';">Particulars</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">UOM</td>
                    <td width="60" style="font-size:14px; font-family:'Calibri Light';">YY</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Process Loss %</td>
                    <td width="60" style="font-size:14px; font-family:'Calibri Light';">Total YY</td>
                    
                    <td width="80" style="font-size:14px; font-family:'Calibri Light';">Req. Qty</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Rate</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Cost/<?=$costing_for; ?></td>
                    <td width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</td>
                    <td style="font-size:14px; font-family:'Calibri Light';">%</td>
                </tr>
          	
            
			<?
			$conv_data_qty=$conversion->getQtyArray_by_conversionid();
			$conv_data_amt=$conversion->getAmountArray_by_conversionid();
			
			$sql_conv = "select A.ID, A.FABRIC_DESCRIPTION AS PRE_COST_FABRIC_COST_DTLS_ID, A.JOB_NO, A.CONS_PROCESS, A.REQ_QNTY, A.AVG_REQ_QNTY, A.PROCESS_LOSS, A.CHARGE_UNIT, A.AMOUNT, A.COLOR_BREAK_DOWN, A.STATUS_ACTIVE, B.BODY_PART_ID, B.UOM, B.FAB_NATURE_ID, B.COLOR_TYPE_ID, B.FABRIC_DESCRIPTION, B.ITEM_NUMBER_ID from wo_pre_cost_fab_conv_cost_dtls a left join wo_pre_cost_fabric_cost_dtls b on a.job_no=b.job_no and a.fabric_description=b.id and b.status_active=1 and b.is_deleted=0 where a.job_no=".$txt_job_no." and a.status_active=1 and a.is_deleted=0 order by a.cons_process";
			
            $sql_convArr=sql_select($sql_conv); $i=1; $convamtTotDzn=$convReqAmttotal=$convPerTotal=0;
            foreach($sql_convArr as $crow)
            {
				$item_descrition = "";
				if($crow["PRE_COST_FABRIC_COST_DTLS_ID"] ==0) $item_descrition = "All Fabrics";
				else
				{
					$item_descrition = $body_part[$crow["BODY_PART_ID"]].", ".$color_type[$crow["COLOR_TYPE_ID"]].", ".$crow["FABRIC_DESCRIPTION"];
				}
				
                $rowConvReqQty=$rowConvReqAmt=$conv_per=0;
                $rowConvReqQty=$conv_data_qty[$crow['ID']][$crow['UOM']];
                $rowConvReqAmt=$conv_data_amt[$crow['ID']][$crow['UOM']];
                
                $conv_per=($rowConvReqAmt/$order_values)*100;
                ?>
                <tr>
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$conversion_cost_head_array[$crow["CONS_PROCESS"]]; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$item_descrition; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$unit_of_measurement[$crow["UOM"]]; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($crow["AVG_REQ_QNTY"],3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($crow["PROCESS_LOSS"],2); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($crow["REQ_QNTY"],3); ?></td>
                    
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowConvReqQty,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($crow["CHARGE_UNIT"],3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($crow["AMOUNT"],3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowConvReqAmt,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($conv_per,2); ?></td>
                </tr>
                <?	
				 $convamtTotDzn+=$crow["AMOUNT"];
				 $convReqAmttotal+=$rowConvReqAmt;
				 $convPerTotal+=$conv_per;
				 
				 $fabricWiseTotRateArr[$crow['PRE_COST_FABRIC_COST_DTLS_ID']]+=$rowConvReqAmt;
            }
            ?>
            </tbody>
            <tfoot>
            	<tr style="background-color:#CCFFFF">
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all" colspan="6" align="right"><b>Total Conversion Cost</b></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($convamtTotDzn,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($convReqAmttotal,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($convPerTotal,2); ?></td>
                </tr>
            </tfoot>
        </table>
    </div>
    <? } else { 
		if(($conversion_cost*1)>0)
		{
			?>
            <div style="margin-top:15px">
                <label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b>Conversion Cost Details</b></label>
                <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:930px;" rules="all">
                    <thead>
                        <tr style="font-weight:bold; background-color:#FFC" align="center">
                            <th width="82" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Process</th>
                            <th width="280" style="font-size:14px; font-family:'Calibri Light';">Particulars</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">UOM</th>
                            <th width="60" style="font-size:14px; font-family:'Calibri Light';">YY</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">Process Loss %</th>
                            <th width="60" style="font-size:14px; font-family:'Calibri Light';">Total YY</th>
                            
                            <th width="80" style="font-size:14px; font-family:'Calibri Light';">Req. Qty</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">Rate</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">Cost/<?=$costing_for; ?></th>
                            <th width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</th>
                            <th style="font-size:14px; font-family:'Calibri Light';">%</th>
                        </tr>
                    </thead>
                    <tbody>
                    <?
                    $conv_data_qty=$conversion->getQtyArray_by_conversionid();
                    $conv_data_amt=$conversion->getAmountArray_by_conversionid();
                    
                    $sql_conv = "select A.ID, A.FABRIC_DESCRIPTION AS PRE_COST_FABRIC_COST_DTLS_ID, A.JOB_NO, A.CONS_PROCESS, A.REQ_QNTY, A.AVG_REQ_QNTY, A.PROCESS_LOSS, A.CHARGE_UNIT, A.AMOUNT, A.COLOR_BREAK_DOWN, A.STATUS_ACTIVE, B.BODY_PART_ID, B.UOM, B.FAB_NATURE_ID, B.COLOR_TYPE_ID, B.FABRIC_DESCRIPTION, B.ITEM_NUMBER_ID from wo_pre_cost_fab_conv_cost_dtls a left join wo_pre_cost_fabric_cost_dtls b on a.job_no=b.job_no and a.fabric_description=b.id and b.status_active=1 and b.is_deleted=0 where a.job_no=".$txt_job_no." and a.status_active=1 and a.is_deleted=0 order by a.cons_process";
                    
                    $sql_convArr=sql_select($sql_conv); $i=1; $convamtTotDzn=$convReqAmttotal=$convPerTotal=0;
                    foreach($sql_convArr as $crow)
                    {
                        $item_descrition = "";
                        if($crow["PRE_COST_FABRIC_COST_DTLS_ID"] ==0) $item_descrition = "All Fabrics";
                        else
                        {
                            $item_descrition = $body_part[$crow["BODY_PART_ID"]].", ".$color_type[$crow["COLOR_TYPE_ID"]].", ".$crow["FABRIC_DESCRIPTION"];
                        }
                        
                        $rowConvReqQty=$rowConvReqAmt=$conv_per=0;
                        $rowConvReqQty=$conv_data_qty[$crow['ID']][$crow['UOM']];
                        $rowConvReqAmt=$conv_data_amt[$crow['ID']][$crow['UOM']];
                        
                        $conv_per=($rowConvReqAmt/$order_values)*100;
                        ?>
                        <tr>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$conversion_cost_head_array[$crow["CONS_PROCESS"]]; ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$item_descrition; ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$unit_of_measurement[$crow["UOM"]]; ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($crow["AVG_REQ_QNTY"],3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($crow["PROCESS_LOSS"],2); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($crow["REQ_QNTY"],3); ?></td>
                            
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowConvReqQty,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($crow["CHARGE_UNIT"],3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($crow["AMOUNT"],3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowConvReqAmt,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($conv_per,2); ?></td>
                        </tr>
                        <?	
                         $convamtTotDzn+=$crow["AMOUNT"];
                         $convReqAmttotal+=$rowConvReqAmt;
                         $convPerTotal+=$conv_per;
						 
						 $fabricWiseTotRateArr[$crow['PRE_COST_FABRIC_COST_DTLS_ID']]+=$rowConvReqAmt;
                    }
                    ?>
                    </tbody>
                    <tfoot>
                        <tr style="background-color:#CCFFFF">
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all" colspan="6" align="right"><b>Total Conversion Cost</b></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($convamtTotDzn,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($convReqAmttotal,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($convPerTotal,2); ?></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <?
		}
	}
	?>
    
	<!--Fabric =====================-->
    <? if($zero_value==1) { ?>
    <div style="margin-top:15px">
    	<label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b>Fabric Cost Details</b></label>
    	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:930px;" rules="all">
        	<tbody>
                <tr style="font-weight:bold; background-color:#FFC" align="center">
                    <td width="82" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Fabric Nature</td>
                    <td width="80" style="font-size:14px; font-family:'Calibri Light';">Fabric Part</td>
                    <td width="200" style="font-size:14px; font-family:'Calibri Light';">Fabric Description</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">UOM</td>
                    <td width="60" style="font-size:14px; font-family:'Calibri Light';">YY</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Process Loss %</td>
                    <td width="60" style="font-size:14px; font-family:'Calibri Light';">Total YY</td>
                    
                    <td width="80" style="font-size:14px; font-family:'Calibri Light';">Req. Qty</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Rate</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Cost/<?=$costing_for; ?></td>
                    <td width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</td>
                    <td style="font-size:14px; font-family:'Calibri Light';">%</td>
                </tr>
          	
            
			<?
            $fabric_req_qty_arr=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
            $fabric_req_amt_arr=$fabric->getAmountArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
            $sql_fabric = "select ID, JOB_NO, BODY_PART_ID, FAB_NATURE_ID, COLOR_TYPE_ID, FABRIC_DESCRIPTION, UOM, AVG_CONS, AVG_CONS_YARN, FABRIC_SOURCE, GSM_WEIGHT, RATE, AMOUNT, AVG_FINISH_CONS, AVG_PROCESS_LOSS, BUDGET_ON from wo_pre_cost_fabric_cost_dtls where job_no=".$txt_job_no." and is_deleted=0 and status_active=1";
            $sql_fabricArr=sql_select($sql_fabric); $i=1; $fabamtTotDzn=$fabReqAmttotal=$fabPerTotal=0;
            foreach($sql_fabricArr as $frow)
            {
                $rowFabReqQty=$rowFabReqAmt=$fabric_per=$fabRate=$fabricAmt=$avgrate=0;
                $rowFabReqQty=$fabric_req_qty_arr['knit']['grey'][$frow["ID"]][$frow["UOM"]]+$fabric_req_qty_arr['woven']['grey'][$frow["ID"]][$frow["UOM"]];
				
				//$fabric_req_amt_arr['knit']['grey'][$frow["ID"]][$frow["UOM"]]+$fabric_req_amt_arr['woven']['grey'][$frow["ID"]][$frow["UOM"]];
				/*if($frow["BUDGET_ON"]==1)
					$avgrate=($fabricWiseTotRateArr[$frow['ID']]/$po_qty)*$order_price_per_dzn;
				else*/
					//$avgrate=($fabricWiseTotRateArr[$frow['ID']]/$rowFabReqQty)*$order_price_per_dzn;
				$fabRate=$frow["RATE"];
				$fabricAmt=$frow["AVG_CONS"];
				/*if($frow["BUDGET_ON"]==1)
					$rowFabReqAmt=($fabRate/$order_price_per_dzn)*$po_qty;
				else*/
					$rowFabReqAmt=$fabric_req_amt_arr['knit']['grey'][$frow["ID"]][$frow["UOM"]]+$fabric_req_amt_arr['woven']['grey'][$frow["ID"]][$frow["UOM"]];//($fabRate/$order_price_per_dzn)*$rowFabReqQty;
				$fabric_per=($rowFabReqAmt/$order_values)*100;
                ?>
                <tr>
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$item_category[$frow['FAB_NATURE_ID']]; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$body_part[$frow["BODY_PART_ID"]]; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$frow["FABRIC_DESCRIPTION"]; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$unit_of_measurement[$frow["UOM"]]; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($frow["AVG_FINISH_CONS"],3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($frow["AVG_PROCESS_LOSS"],2); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($frow["AVG_CONS"],3); ?></td>
                    
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right" title="<?=$fabricWiseTotRateArr[$frow['ID']]; ?>"><?=fn_number_format($rowFabReqQty,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($fabRate,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($fabricAmt,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowFabReqAmt,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($fabric_per,2); ?></td>
                </tr>
                <?	
				 $fabamtTotDzn+=$fabricAmt;
				 $fabReqAmttotal+=$rowFabReqAmt;
				 $fabPerTotal+=$fabric_per;
            }
            ?>
            </tbody>
            <tfoot>
            	<tr style="background-color:#CCFFFF">
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all" colspan="7" align="right"><b>Total Fabric Cost</b></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($fabamtTotDzn,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($fabReqAmttotal,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($fabPerTotal,2); ?></td>
                </tr>
            </tfoot>
        </table>
    </div>
    <? } else { 
		if(($fabricCost*1)>0)
		{
			?>
            <div style="margin-top:15px">
                <label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b>Fabric Cost Details</b></label>
                <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:930px;" rules="all">
                    <thead>
                        <tr style="font-weight:bold; background-color:#FFC" align="center">
                            <th width="82" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Fabric Nature</th>
                            <th width="80" style="font-size:14px; font-family:'Calibri Light';">Fabric Part</th>
                            <th width="200" style="font-size:14px; font-family:'Calibri Light';">Fabric Description</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">UOM</th>
                            <th width="60" style="font-size:14px; font-family:'Calibri Light';">YY</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">Process Loss %</th>
                            <th width="60" style="font-size:14px; font-family:'Calibri Light';">Total YY</th>
                            
                            <th width="80" style="font-size:14px; font-family:'Calibri Light';">Req. Qty</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">Rate</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">Cost/<?=$costing_for; ?></th>
                            <th width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</th>
                            <th style="font-size:14px; font-family:'Calibri Light';">%</th>
                        </tr>
                    </thead>
                    <tbody>
                    <?
                    $fabric_req_qty_arr=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
                    $fabric_req_amt_arr=$fabric->getAmountArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
                    $sql_fabric = "select ID, JOB_NO, BODY_PART_ID, FAB_NATURE_ID, COLOR_TYPE_ID, FABRIC_DESCRIPTION, UOM, AVG_CONS, AVG_CONS_YARN, FABRIC_SOURCE, GSM_WEIGHT, RATE, AMOUNT, AVG_FINISH_CONS, AVG_PROCESS_LOSS from wo_pre_cost_fabric_cost_dtls where job_no=".$txt_job_no." and is_deleted=0 and status_active=1";
                    $sql_fabricArr=sql_select($sql_fabric); $i=1; $fabamtTotDzn=$fabReqAmttotal=$fabPerTotal=0;
                    foreach($sql_fabricArr as $frow)
                    {
                        $rowFabReqQty=$rowFabReqAmt=$fabric_per=$fabRate=$fabricAmt=0;
                        $rowFabReqQty=$fabric_req_qty_arr['knit']['grey'][$frow["ID"]][$frow["UOM"]]+$fabric_req_qty_arr['woven']['grey'][$frow["ID"]][$frow["UOM"]];
                        $rowFabReqAmt=$fabric_req_amt_arr['knit']['grey'][$frow["ID"]][$frow["UOM"]]+$fabric_req_amt_arr['woven']['grey'][$frow["ID"]][$frow["UOM"]];
                        
						/*if($frow["BUDGET_ON"]==1)
							$avgrate=($fabricWiseTotRateArr[$frow['ID']]/$po_qty)*$order_price_per_dzn;
						else
							$avgrate=($fabricWiseTotRateArr[$frow['ID']]/$po_plun_cut_qty)*$order_price_per_dzn;*/
						$fabRate=$frow["RATE"];
						$fabricAmt=$frow["AVG_CONS"];
						/*if($frow["BUDGET_ON"]==1)
							$rowFabReqAmt=($fabRate/$order_price_per_dzn)*$po_qty;
						else
							$rowFabReqAmt=($fabRate/$order_price_per_dzn)*$po_plun_cut_qty;*/
						$fabric_per=($rowFabReqAmt/$order_values)*100;
                        ?>
                        <tr>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$item_category[$frow['FAB_NATURE_ID']]; ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$body_part[$frow["BODY_PART_ID"]]; ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$frow["FABRIC_DESCRIPTION"]; ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$unit_of_measurement[$frow["UOM"]]; ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($frow["AVG_FINISH_CONS"],3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($frow["AVG_PROCESS_LOSS"],2); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($frow["AVG_CONS"],3); ?></td>
                            
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowFabReqQty,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($fabRate,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($fabricAmt,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowFabReqAmt,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($fabric_per,2); ?></td>
                        </tr>
                        <?	
                         $fabamtTotDzn+=$fabricAmt;
                         $fabReqAmttotal+=$rowFabReqAmt;
                         $fabPerTotal+=$fabric_per;
                    }
                    ?>
                    </tbody>
                    <tfoot>
                        <tr style="background-color:#CCFFFF">
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all" colspan="7" align="right"><b>Total Fabric Cost</b></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($fabamtTotDzn,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($fabReqAmttotal,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($fabPerTotal,2); ?></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <?
		}
	}
	?>
    
    <!--Trims =====================-->
    
    <?
	$sql_trim = "select a.ID, a.JOB_NO, a.TRIM_GROUP, a.DESCRIPTION, a.CONS_UOM, a.TOT_CONS, a.EX_PER, a.CONS_DZN_GMTS, a.RATE, a.AMOUNT, b.ITEM_NAME, b.TRIM_TYPE from wo_pre_cost_trim_cost_dtls a, lib_item_group b where a.TRIM_GROUP=b.id and a.job_no=".$txt_job_no." and a.status_active=1 and a.is_deleted=0 order by b.TRIM_TYPE, a.seq Asc";
	
	$data_array_trim=sql_select($sql_trim);
	
	$trim_qty_arr=$trim->getQtyArray_by_precostdtlsid();
	$trim_amount_arr=$trim->getAmountArray_precostdtlsid(); $trimsDataArr=array();
	foreach($data_array_trim as $trow)
	{
		if($trow["TOT_CONS"]=="" || $trow["TOT_CONS"]==0) $trow["TOT_CONS"]=$trow["CONS_DZN_GMTS"];
		$trimsDataArr[$trow["TRIM_TYPE"]][$trow["ID"]]['ITEM_NAME']=$trow["ITEM_NAME"];
		$trimsDataArr[$trow["TRIM_TYPE"]][$trow["ID"]]['DESCRIPTION']=$trow["DESCRIPTION"];
		$trimsDataArr[$trow["TRIM_TYPE"]][$trow["ID"]]['CONS_UOM']=$trow["CONS_UOM"];
		$trimsDataArr[$trow["TRIM_TYPE"]][$trow["ID"]]['NET_CONS']=$trow["TOT_CONS"];
		$trimsDataArr[$trow["TRIM_TYPE"]][$trow["ID"]]['EX_PER']=$trow["EX_PER"];
		$trimsDataArr[$trow["TRIM_TYPE"]][$trow["ID"]]['GCONS']=$trow["CONS_DZN_GMTS"];
		$trimsDataArr[$trow["TRIM_TYPE"]][$trow["ID"]]['RATE']=$trow["RATE"];
		$trimsDataArr[$trow["TRIM_TYPE"]][$trow["ID"]]['AMOUNT']=$trow["AMOUNT"];
	}
	unset($data_array_trim);
	if($zero_value==1) { 
	?>
    <div style="margin-top:15px">
    	<label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b>Trims Cost Details</b></label>
    	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:930px;" rules="all">
        	<tbody>
                <tr style="font-weight:bold;background-color:#FFC" align="center">
                    <td width="130" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Item Name</td>
                    <td width="230" style="font-size:14px; font-family:'Calibri Light';">Item Description</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">UOM</td>
                    <td width="60" style="font-size:14px; font-family:'Calibri Light';">YY</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Wastage %</td>
                    <td width="60" style="font-size:14px; font-family:'Calibri Light';">Total YY</td>
                    <td width="80" style="font-size:14px; font-family:'Calibri Light';">Req. Qty</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Rate</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Cost /<?=$costing_for; ?></td>
                    <td width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</td>
                    <td style="font-size:14px; font-family:'Calibri Light';">%</td>
                </tr>
          	
            
			<?
            
			$i=1; $trimamtTotDzn=$trimReqAmttotal=$trimPerTotal=0;
            foreach($trimsDataArr as $trimtype=>$trimtypedata)
            {
				?>
                <tr>
                    <td colspan="11" style="font-size:14px; font-family:'Calibri Light';word-break:break-all; background-color:#FFC"><b><?=$trim_type[$trimtype]; ?> Trims Details</b></td>
                </tr>
                <?
				$typeTrimsAmtDzn=$typeTrimsAmt=$typeTrimsAmtPer=0;
				foreach($trimtypedata as $trimid=>$trimdata)
				{
					$rowTrimReqQty=$rowTrimReqAmt=$trim_per=0;
					$rowTrimReqQty=$trim_qty_arr[$trimid];
					$rowTrimReqAmt=$trim_amount_arr[$trimid];
					
					$trim_per=($rowTrimReqAmt/$order_values)*100;
					?>
					<tr>
						<td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$trimdata['ITEM_NAME']; ?></td>
						<td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$trimdata['DESCRIPTION']; ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$unit_of_measurement[$trimdata['CONS_UOM']]; ?></td>
						<td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trimdata["NET_CONS"],3); ?></td>
						<td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trimdata["EX_PER"],2); ?></td>
						<td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trimdata["GCONS"],3); ?></td>
						
						<td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowTrimReqQty,3); ?></td>
						<td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trimdata["RATE"],3); ?></td>
						<td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trimdata["AMOUNT"],3); ?></td>
						<td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowTrimReqAmt,3); ?></td>
						<td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trim_per,2); ?></td>
					</tr>
					<?
						$typeTrimsAmtDzn+=$trimdata["AMOUNT"];
						$typeTrimsAmt+=$rowTrimReqAmt;
						$typeTrimsAmtPer+=$trim_per;
						
						$trimamtTotDzn+=$trimdata["AMOUNT"];
						$trimReqAmttotal+=$rowTrimReqAmt;
						$trimPerTotal+=$trim_per;
				}
				 ?>
                <tr style="background-color:#CCCCCC">
                    <td colspan="8" style="font-size:14px; font-family:'Calibri Light';word-break:break-all;" align="right"><b>Total <?=$trim_type[$trimtype]; ?> Trims Cost :</b></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($typeTrimsAmtDzn,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($typeTrimsAmt,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($typeTrimsAmtPer,2); ?></td>
                </tr>
                <?
            }
            ?>
            </tbody>
            <tfoot>
            	<tr style="background-color:#CCFFFF">
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all" colspan="6" align="right"><b>Grand Total Trims Cost :</b></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trimamtTotDzn,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trimReqAmttotal,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trimPerTotal,2); ?></td>
                </tr>
            </tfoot>
        </table>
    </div>
    <? } else {
		if(($trims_costing_arr[$job_no]*1)>0)
		{
			?>
            <div style="margin-top:15px">
                <label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b>Trims Cost Details</b></label>
                <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:930px;" rules="all">
                    <thead>
                        <tr style="font-weight:bold;background-color:#FFC" align="center">
                            <th width="130" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Item Name</th>
                            <th width="230" style="font-size:14px; font-family:'Calibri Light';">Item Description</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">UOM</th>
                            <th width="60" style="font-size:14px; font-family:'Calibri Light';">YY</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">Wastage %</th>
                            <th width="60" style="font-size:14px; font-family:'Calibri Light';">Total YY</th>
                            <th width="80" style="font-size:14px; font-family:'Calibri Light';">Req. Qty</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">Rate</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">Cost /<?=$costing_for; ?></th>
                            <th width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</th>
                            <th style="font-size:14px; font-family:'Calibri Light';">%</th>
                        </tr>
                    </thead>
                    <tbody>
                    <?
                    
                    $i=1; $trimamtTotDzn=$trimReqAmttotal=$trimPerTotal=0;
                    foreach($trimsDataArr as $trimtype=>$trimtypedata)
                    {
                        ?>
                        <tr>
                            <td colspan="11" style="font-size:14px; font-family:'Calibri Light';word-break:break-all; background-color:#FFC"><b><?=$trim_type[$trimtype]; ?> Trims Details</b></td>
                        </tr>
                        <?
                        $typeTrimsAmtDzn=$typeTrimsAmt=$typeTrimsAmtPer=0;
                        foreach($trimtypedata as $trimid=>$trimdata)
                        {
                            $rowTrimReqQty=$rowTrimReqAmt=$trim_per=0;
                            $rowTrimReqQty=$trim_qty_arr[$trimid];
                            $rowTrimReqAmt=$trim_amount_arr[$trimid];
                            
                            $trim_per=($rowTrimReqAmt/$order_values)*100;
                            ?>
                            <tr>
                                <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$trimdata['ITEM_NAME']; ?></td>
                                <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$trimdata['DESCRIPTION']; ?></td>
                                <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$unit_of_measurement[$trimdata['CONS_UOM']]; ?></td>
                                <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trimdata["NET_CONS"],3); ?></td>
                                <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trimdata["EX_PER"],2); ?></td>
                                <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trimdata["GCONS"],3); ?></td>
                                
                                <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowTrimReqQty,3); ?></td>
                                <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trimdata["RATE"],3); ?></td>
                                <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trimdata["AMOUNT"],3); ?></td>
                                <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowTrimReqAmt,3); ?></td>
                                <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trim_per,2); ?></td>
                            </tr>
                            <?
                                $typeTrimsAmtDzn+=$trimdata["AMOUNT"];
                                $typeTrimsAmt+=$rowTrimReqAmt;
                                $typeTrimsAmtPer+=$trim_per;
                                
                                $trimamtTotDzn+=$trimdata["AMOUNT"];
                                $trimReqAmttotal+=$rowTrimReqAmt;
                                $trimPerTotal+=$trim_per;
                        }
                         ?>
                        <tr style="background-color:#CCCCCC">
                            <td colspan="8" style="font-size:14px; font-family:'Calibri Light';word-break:break-all;" align="right"><b>Total <?=$trim_type[$trimtype]; ?> Trims Cost :</b></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($typeTrimsAmtDzn,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($typeTrimsAmt,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($typeTrimsAmtPer,2); ?></td>
                        </tr>
                        <?
                    }
                    ?>
                    </tbody>
                    <tfoot>
                        <tr style="background-color:#CCFFFF">
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all" colspan="6" align="right"><b>Grand Total Trims Cost :</b></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trimamtTotDzn,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trimReqAmttotal,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($trimPerTotal,2); ?></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
			<?
		}
	}
	?>
    
    <!--Wash =====================-->
    <? if($zero_value==1) { ?>
    <div style="margin-top:15px">
    	<label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b>Wash Cost Details</b></label>
    	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:930px;" rules="all">
        	<tbody>
                <tr style="font-weight:bold; background-color:#FFC" align="center">
                	<td width="130" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Item</td>
                    <td width="230" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Wash Type</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">UOM</td>
                    <td width="60" style="font-size:14px; font-family:'Calibri Light';">YY</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Wastage %</td>
                    <td width="60" style="font-size:14px; font-family:'Calibri Light';">Total YY</td>
                    
                    <td width="80" style="font-size:14px; font-family:'Calibri Light';">Req. Qty</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Rate</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Cost /<?=$costing_for; ?></td>
                    <td width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</td>
                    <td style="font-size:14px; font-family:'Calibri Light';">%</td>
                </tr>
            
			<?
            $sql = "select ID, JOB_NO, EMB_NAME, EMB_TYPE, CONS_DZN_GMTS, RATE, AMOUNT from wo_pre_cost_embe_cost_dtls where job_no=".$txt_job_no." and emb_name =3 and is_deleted=0 and status_active=1";
			$data_arrayWash=sql_select($sql);
			$wash_qty=$wash->getQtyArray_by_jobAndEmblishmentid();
			$wash_amount=$wash->getAmountArray_by_jobAndEmblishmentid();
            $washQtyTot=$washamtTotDzn=$washReqAmttotal=$washPerTotal=0;
            foreach($data_arrayWash as $wrow)
            {
                $rowWashReqQty=$rowWashReqAmt=$wash_per=0;
                $rowWashReqQty=$wash_qty[$wrow["JOB_NO"]][$wrow["ID"]];
                $rowWashReqAmt=$wash_amount[$wrow["JOB_NO"]][$wrow["ID"]];
                
                $wash_per=($rowWashReqAmt/$order_values)*100;
                ?>
                <tr>
                	<td style="font-size:14px; font-family:'Calibri Light';word-break:break-all">Wash</td>
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$emblishment_wash_type[$wrow['EMB_TYPE']]; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$costing_for; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($wrow["CONS_DZN_GMTS"],3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><? //=fn_number_format($wrow["AVG_PROCESS_LOSS"],2); ?>&nbsp;</td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><? //=fn_number_format($wrow["AVG_CONS"],4); ?>&nbsp;</td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowWashReqQty,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($wrow["RATE"],3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($wrow["AMOUNT"],3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowWashReqAmt,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($wash_per,2); ?></td>
                </tr>
                <?	
				$washQtyTot+=$rowWashReqQty;
				$washamtTotDzn+=$wrow["AMOUNT"];
				$washReqAmttotal+=$rowWashReqAmt;
				$washPerTotal+=$wash_per;
            }
            ?>
            </tbody>
            <tfoot>
            	<tr style="background-color:#CCFFFF">
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all" colspan="6" align="right"><b>Total Wash Cost :</b></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($washQtyTot,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($washamtTotDzn,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($washReqAmttotal,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($washPerTotal,2); ?></td>
                </tr>
            </tfoot>
        </table>
    </div>
    <? } else {
		if(($emblishment_costing_arr_wash[$job_no]*1)>0)
		{
			?>
            <div style="margin-top:15px">
                <label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b>Wash Cost Details</b></label>
                <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:930px;" rules="all">
                    <thead>
                        <tr style="font-weight:bold; background-color:#FFC" align="center">
                            <th width="130" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Item</th>
                            <th width="230" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Wash Type</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">UOM</th>
                            <th width="60" style="font-size:14px; font-family:'Calibri Light';">YY</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">Wastage %</th>
                            <th width="60" style="font-size:14px; font-family:'Calibri Light';">Total YY</th>
                            
                            <th width="80" style="font-size:14px; font-family:'Calibri Light';">Req. Qty</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">Rate</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">Cost /<?=$costing_for; ?></th>
                            <th width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</th>
                            <th style="font-size:14px; font-family:'Calibri Light';">%</th>
                        </tr>
                    </thead>
                    <tbody>
                    <?
                    $sql = "select ID, JOB_NO, EMB_NAME, EMB_TYPE, CONS_DZN_GMTS, RATE, AMOUNT from wo_pre_cost_embe_cost_dtls where job_no=".$txt_job_no." and emb_name =3 and is_deleted=0 and status_active=1";
                    $data_arrayWash=sql_select($sql);
                    $wash_qty=$wash->getQtyArray_by_jobAndEmblishmentid();
                    $wash_amount=$wash->getAmountArray_by_jobAndEmblishmentid();
                    $washQtyTot=$washamtTotDzn=$washReqAmttotal=$washPerTotal=0;
                    foreach($data_arrayWash as $wrow)
                    {
                        $rowWashReqQty=$rowWashReqAmt=$wash_per=0;
                        $rowWashReqQty=$wash_qty[$wrow["JOB_NO"]][$wrow["ID"]];
                        $rowWashReqAmt=$wash_amount[$wrow["JOB_NO"]][$wrow["ID"]];
                        
                        $wash_per=($rowWashReqAmt/$order_values)*100;
                        ?>
                        <tr>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all">Wash</td>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$emblishment_wash_type[$wrow['EMB_TYPE']]; ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$costing_for; ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($wrow["CONS_DZN_GMTS"],3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><? //=fn_number_format($wrow["AVG_PROCESS_LOSS"],2); ?>&nbsp;</td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><? //=fn_number_format($wrow["AVG_CONS"],4); ?>&nbsp;</td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowWashReqQty,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($wrow["RATE"],3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($wrow["AMOUNT"],3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowWashReqAmt,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($wash_per,2); ?></td>
                        </tr>
                        <?	
                        $washQtyTot+=$rowWashReqQty;
                        $washamtTotDzn+=$wrow["AMOUNT"];
        
                        $washReqAmttotal+=$rowWashReqAmt;
                        $washPerTotal+=$wash_per;
                    }
                    ?>
                    </tbody>
                    <tfoot>
                        <tr style="background-color:#CCFFFF">
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all" colspan="6" align="right"><b>Total Wash Cost :</b></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($washQtyTot,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($washamtTotDzn,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($washReqAmttotal,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($washPerTotal,2); ?></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <?
		}
	}
	?>
    
    <!--Embellishment =====================-->
    <? if($zero_value==1) { ?>
    <div style="margin-top:15px">
    	<label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b>Embellishment Cost Details</b></label>
    	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:930px;" rules="all">
        	<tbody>
                <tr style="font-weight:bold; background-color:#FFC" align="center">
                	<td width="130" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Embellishment Name</td>
                    <td width="230" style="font-size:14px; font-family:'Calibri Light';">Embl. Type</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">UOM</td>
                    <td width="60" style="font-size:14px; font-family:'Calibri Light';">YY</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Wastage %</td>
                    <td width="60" style="font-size:14px; font-family:'Calibri Light';">Total YY</td>
                    
                    <td width="80" style="font-size:14px; font-family:'Calibri Light';">Req. Qty</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Rate</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Cost/<?=$costing_for; ?></td>
                    <td width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</td>
                    <td style="font-size:14px; font-family:'Calibri Light';">%</td>
                </tr>
          	
            
			<?
            $sql_emb = "select ID, JOB_NO, EMB_NAME, EMB_TYPE, CONS_DZN_GMTS, RATE, AMOUNT from wo_pre_cost_embe_cost_dtls where job_no=".$txt_job_no." and emb_name !=3 and is_deleted=0 and status_active=1";
			$data_arrayEmb=sql_select($sql_emb);
			$emblishment_qty=$emblishment->getQtyArray_by_jobAndEmblishmentid();
			$emblishment_amount=$emblishment->getAmountArray_by_jobAndEmblishmentid();
            $embQtyTot=$embamtTotDzn=$embReqAmttotal=$embPerTotal=0;
            foreach($data_arrayEmb as $erow)
            {
				//$type_array=array(0=>$blank_array,1=>$emblishment_print_type,2=>$emblishment_embroy_type,3=>$emblishment_wash_type,4=>$emblishment_spwork_type,5=>$emblishment_gmts_type,6=>$blank_array,99=>$emblishment_other_type_arr);
				
				if($erow['EMB_NAME']==1) $type_array=$emblishment_print_type;
				else if($erow['EMB_NAME']==2) $type_array=$emblishment_embroy_type;
				else if($erow['EMB_NAME']==3) $type_array=$emblishment_wash_type;
				else if($erow['EMB_NAME']==4) $type_array=$emblishment_spwork_type;
				else if($erow['EMB_NAME']==5) $type_array=$emblishment_gmts_type;
				else if($erow['EMB_NAME']==99) $type_array=$emblishment_other_type_arr;
				else $type_array=$blank_array;
				
                $rowEmbReqQty=$rowEmbReqAmt=$emb_per=0;
                $rowEmbReqQty=$emblishment_qty[$erow["JOB_NO"]][$erow["ID"]];
                $rowEmbReqAmt=$emblishment_amount[$erow["JOB_NO"]][$erow["ID"]];
                
                $emb_per=($rowEmbReqAmt/$order_values)*100;
                ?>
                <tr>
                	<td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$emblishment_name_array[$erow['EMB_NAME']]; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$type_array[$erow['EMB_TYPE']]; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$costing_for; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($erow["CONS_DZN_GMTS"],3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><? //=fn_number_format($wrow["AVG_PROCESS_LOSS"],2); ?>&nbsp;</td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><? //=fn_number_format($wrow["AVG_CONS"],4); ?>&nbsp;</td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowEmbReqQty,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($erow["RATE"],3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($erow["AMOUNT"],3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowEmbReqAmt,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($emb_per,2); ?></td>
                </tr>
                <?	
				$embQtyTot+=$rowWashReqQty;
				$embamtTotDzn+=$erow["AMOUNT"];
				$embReqAmttotal+=$rowEmbReqAmt;
				$embPerTotal+=$emb_per;
            }
            ?>
            </tbody>
            <tfoot>
            	<tr style="background-color:#CCFFFF">
                    <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all" colspan="6" align="right"><b>Total Embellishment Cost :</b></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($embQtyTot,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($embamtTotDzn,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($embReqAmttotal,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($embPerTotal,2); ?></td>
                </tr>
            </tfoot>
        </table>
    </div>
    <? } else {
		if(($emblishment_costing_arr[$job_no]*1)>0)
		{
			?>
            <div style="margin-top:15px">
                <label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b>Embellishment Cost Details</b></label>
                <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:930px;" rules="all">
                    <thead>
                        <tr style="font-weight:bold; background-color:#FFC" align="center">
                            <th width="130" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Embellishment Name</th>
                            <th width="230" style="font-size:14px; font-family:'Calibri Light';">Embl. Type</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">UOM</th>
                            <th width="60" style="font-size:14px; font-family:'Calibri Light';">YY</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">Wastage %</th>
                            <th width="60" style="font-size:14px; font-family:'Calibri Light';">Total YY</th>
                            
                            <th width="80" style="font-size:14px; font-family:'Calibri Light';">Req. Qty</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">Rate</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">Cost/<?=$costing_for; ?></th>
                            <th width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</th>
                            <th style="font-size:14px; font-family:'Calibri Light';">%</th>
                        </tr>
                    </thead>
                    <tbody>
                    <?
                    $sql_emb = "select ID, JOB_NO, EMB_NAME, EMB_TYPE, CONS_DZN_GMTS, RATE, AMOUNT from wo_pre_cost_embe_cost_dtls where job_no=".$txt_job_no." and emb_name !=3 and is_deleted=0 and status_active=1";
                    $data_arrayEmb=sql_select($sql_emb);
                    $emblishment_qty=$emblishment->getQtyArray_by_jobAndEmblishmentid();
                    $emblishment_amount=$emblishment->getAmountArray_by_jobAndEmblishmentid();
                    $embQtyTot=$embamtTotDzn=$embReqAmttotal=$embPerTotal=0;
                    foreach($data_arrayEmb as $erow)
                    {
                        //$type_array=array(0=>$blank_array,1=>$emblishment_print_type,2=>$emblishment_embroy_type,3=>$emblishment_wash_type,4=>$emblishment_spwork_type,5=>$emblishment_gmts_type,6=>$blank_array,99=>$emblishment_other_type_arr);
                        
                        if($erow['EMB_NAME']==1) $type_array=$emblishment_print_type;
                        else if($erow['EMB_NAME']==2) $type_array=$emblishment_embroy_type;
                        else if($erow['EMB_NAME']==3) $type_array=$emblishment_wash_type;
                        else if($erow['EMB_NAME']==4) $type_array=$emblishment_spwork_type;
                        else if($erow['EMB_NAME']==5) $type_array=$emblishment_gmts_type;
                        else if($erow['EMB_NAME']==99) $type_array=$emblishment_other_type_arr;
                        else $type_array=$blank_array;
                        
                        $rowEmbReqQty=$rowEmbReqAmt=$emb_per=0;
                        $rowEmbReqQty=$emblishment_qty[$erow["JOB_NO"]][$erow["ID"]];
                        $rowEmbReqAmt=$emblishment_amount[$erow["JOB_NO"]][$erow["ID"]];
                        
                        $emb_per=($rowEmbReqAmt/$order_values)*100;
                        ?>
                        <tr>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$emblishment_name_array[$erow['EMB_NAME']]; ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$type_array[$erow['EMB_TYPE']]; ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$costing_for; ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($erow["CONS_DZN_GMTS"],3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><? //=fn_number_format($wrow["AVG_PROCESS_LOSS"],2); ?>&nbsp;</td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><? //=fn_number_format($wrow["AVG_CONS"],4); ?>&nbsp;</td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowEmbReqQty,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($erow["RATE"],3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($erow["AMOUNT"],3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowEmbReqAmt,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($emb_per,2); ?></td>
                        </tr>
                        <?	
                        $embQtyTot+=$rowWashReqQty;
                        $embamtTotDzn+=$erow["AMOUNT"];
                        $embReqAmttotal+=$rowEmbReqAmt;
                        $embPerTotal+=$emb_per;
                    }
                    ?>
                    </tbody>
                    <tfoot>
                        <tr style="background-color:#CCFFFF">
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all" colspan="6" align="right"><b>Total Embellishment Cost :</b></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($embQtyTot,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right">&nbsp;</td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($embamtTotDzn,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($embReqAmttotal,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($embPerTotal,2); ?></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
            <?
		}
	}
	?>
    
    <!--Commercial =====================-->
    <? if($zero_value==1) { ?>
    <div style="margin-top:15px">
    	<label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b>Commercial Cost Details</b></label>
    	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:380px;" rules="all">
        	<tbody>
                <tr style="font-weight:bold; background-color:#FFC" align="center">
                	<td width="120" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Particulars</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Commercial %</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Cost/PCS</td>
                    <td width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</td>
                    <td style="font-size:14px; font-family:'Calibri Light';">%</td>
                </tr>
          	
            
			<?
            $sql_comml = "select ID, JOB_NO, ITEM_ID, RATE, AMOUNT from  wo_pre_cost_comarci_cost_dtls  where job_no=".$txt_job_no." and status_active=1 and is_deleted=0";
			$data_arrayComer=sql_select($sql_comml);
			$commarcial_amount=$commercial->getAmountArray_by_jobAndPrecostdtlsid();
            foreach($data_arrayComer as $cmlrow)
            {
                $rowComlReqAmt=$coml_per=$commlAmt=0;
                $rowComlReqAmt=$commarcial_amount[$cmlrow["JOB_NO"]][$cmlrow["ID"]];
                $commlAmt=$rowComlReqAmt/$order_job_qnty;
                $coml_per=($rowComlReqAmt/$order_values)*100;
                ?>
                <tr>
                	<td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$camarcial_items[$cmlrow['ITEM_ID']]; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($cmlrow["RATE"],3); ?></td>
                    
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($commlAmt,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowComlReqAmt,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($coml_per,2); ?></td>
                </tr>
                <?	
            }
            ?>
            </tbody>
        </table>
    </div>
    <? } else {
		if(($commercial_costing_arr[$job_no]*1)>0)
		{
			?>
            <div style="margin-top:15px">
                <label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b>Commercial Cost Details</b></label>
                <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:380px;" rules="all">
                    <thead>
                        <tr style="font-weight:bold; background-color:#FFC" align="center">
                            <th width="120" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Particulars</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">Commercial %</th>
                            <th width="50" style="font-size:14px; font-family:'Calibri Light';">Cost/PCS</th>
                            <th width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</th>
                            <th style="font-size:14px; font-family:'Calibri Light';">%</th>
                        </tr>
                    </thead>
                    <tbody>
                    <?
                    $sql_comml = "select ID, JOB_NO, ITEM_ID, RATE, AMOUNT from  wo_pre_cost_comarci_cost_dtls  where job_no=".$txt_job_no." and status_active=1 and is_deleted=0";
                    $data_arrayComer=sql_select($sql_comml);
                    $commarcial_amount=$commercial->getAmountArray_by_jobAndPrecostdtlsid();
                    foreach($data_arrayComer as $cmlrow)
                    {
                        $rowComlReqAmt=$coml_per=$commlAmt=0;
                        $rowComlReqAmt=$commarcial_amount[$cmlrow["JOB_NO"]][$cmlrow["ID"]];
                        $commlAmt=$rowComlReqAmt/$order_job_qnty;
                        $coml_per=($rowComlReqAmt/$order_values)*100;
                        ?>
                        <tr>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$camarcial_items[$cmlrow['ITEM_ID']]; ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($cmlrow["RATE"],3); ?></td>
                            
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($commlAmt,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowComlReqAmt,3); ?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($coml_per,2); ?></td>
                        </tr>
                        <?	
                    }
                    ?>
                    </tbody>
                </table>
            </div>
            <?
		}
	}
	?>
    
    <!--Commission =====================-->
    <? if($zero_value==1) { ?>
    <div style="margin-top:15px">
    	<label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b>Commission Cost Details</b></label>
    	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:380px;" rules="all">
        	<tbody>
                <tr style="font-weight:bold; background-color:#FFC" align="center">
                	<td width="120" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Particulars</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Commission %</td>
                    <td width="50" style="font-size:14px; font-family:'Calibri Light';">Cost/PCS</td>
                    <td width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</td>
                    <td style="font-size:14px; font-family:'Calibri Light';">%</td>
                </tr>
          
            
			<?
			$sql_comm = "select ID, JOB_NO, PARTICULARS_ID, COMMISSION_BASE_ID, COMMISION_RATE, COMMISSION_AMOUNT from wo_pre_cost_commiss_cost_dtls where job_no=".$txt_job_no." and status_active=1";
			$data_arrayComi=sql_select($sql_comm);
			$commision_amount=$commision->getAmountArray_by_jobAndPrecostdtlsid();
            foreach($data_arrayComi as $cmmrow)
            {
                $rowCommReqAmt=$comm_per=$commAmt=0;
                $rowCommReqAmt=$commision_amount[$cmmrow["JOB_NO"]][$cmmrow["ID"]];
                $commAmt=$rowCommReqAmt/$order_job_qnty;
                $comm_per=($rowCommReqAmt/$order_values)*100;
                ?>
                <tr>
                	<td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$commission_particulars[$cmmrow['PARTICULARS_ID']]; ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($cmmrow["COMMISION_RATE"],4); ?></td>
                    
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($commAmt,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowCommReqAmt,3); ?></td>
                    <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($comm_per,2); ?></td>
                </tr>
                <?	
            }
            ?>
            </tbody>
        </table>
    </div>
    <? } else { 
		if(($commission_costing_arr[$job_no]*1)>0)
		{
			?>
            <div style="margin-top:15px">
            <label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b>Commission Cost Details</b></label>
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:380px;" rules="all">
                <thead>
                    <tr style="font-weight:bold; background-color:#FFC" align="center">
                        <th width="120" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Particulars</th>
                        <th width="50" style="font-size:14px; font-family:'Calibri Light';">Commission %</th>
                        <th width="50" style="font-size:14px; font-family:'Calibri Light';">Cost/PCS</th>
                        <th width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</th>
                        <th style="font-size:14px; font-family:'Calibri Light';">%</th>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_comm = "select ID, JOB_NO, PARTICULARS_ID, COMMISSION_BASE_ID, COMMISION_RATE, COMMISSION_AMOUNT from wo_pre_cost_commiss_cost_dtls where job_no=".$txt_job_no." and status_active=1";
                $data_arrayComi=sql_select($sql_comm);
                $commision_amount=$commision->getAmountArray_by_jobAndPrecostdtlsid();
                foreach($data_arrayComi as $cmmrow)
                {
                    $rowCommReqAmt=$comm_per=$commAmt=0;
                    $rowCommReqAmt=$commision_amount[$cmmrow["JOB_NO"]][$cmmrow["ID"]];
                    $commAmt=$rowCommReqAmt/$order_job_qnty;
                    $comm_per=($rowCommReqAmt/$order_values)*100;
                    ?>
                    <tr>
                        <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$commission_particulars[$cmmrow['PARTICULARS_ID']]; ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($cmmrow["COMMISION_RATE"],4); ?></td>
                        
                        <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($commAmt,3); ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowCommReqAmt,3); ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($comm_per,2); ?></td>
                    </tr>
                    <?	
                }
                ?>
                </tbody>
            </table>
        </div>
            <?
		}
	}
	
	$otherCostHeadArr=array("currier_pre_cost"=>"Courier Cost","inspection"=>"Inspection Cost","common_oh"=>"Opt Exp","deffdlc_cost"=>"Deffd. LC/DC");
	
	$otherCostHeadPerArr=array("currier_pre_cost"=>"currier_percent","inspection"=>"inspection_percent","common_oh"=>"common_oh_percent","deffdlc_cost"=>"deffdlc_percent");
	
	
	 
	foreach($otherCostHeadArr as $indexcost=>$indexhead)
	{
		if($zero_value==1) { ?>
		<div style="margin-top:15px">
			<label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b><?=$indexhead; ?> Details</b></label>
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:380px;" rules="all">
				<tbody>
					<tr style="font-weight:bold; background-color:#FFC" align="center">
						<td width="120" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Particulars</td>
						<td width="50" style="font-size:14px; font-family:'Calibri Light';">%</td>
						<td width="50" style="font-size:14px; font-family:'Calibri Light';">Cost/PCS</td>
						<td width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</td>
						<td style="font-size:14px; font-family:'Calibri Light';">%</td>
					</tr>
				
				
				<?
					$rowcostReqAmt=$rowcost_per=$rowAmt=0;
					$rowcostReqAmt=$other_costing_arr[$job_no][$indexcost];
					$rowAmt=$rowcostReqAmt/$order_job_qnty;
					$rowcost_per=($rowcostReqAmt/$order_values)*100;
					?>
					<tr>
						<td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$indexhead; ?></td>
						<td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($summary_data[$otherCostHeadPerArr[$indexcost]],3); ?></td>
						
						<td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowAmt,3); ?></td>
						<td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowcostReqAmt,3); ?></td>
						<td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowcost_per,2); ?></td>
					</tr>
				</tbody>
			</table>
		</div>
		<? } else {
			if(($other_costing_arr[$job_no][$indexcost]*1)>0)
			{
				?>
				<div style="margin-top:15px">
					<label style="font-size:14px; font-family:'Calibri Light'; background-color:#CCCCCC"><b><?=$indexhead; ?> Cost Details</b></label>
					<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:380px;" rules="all">
						<thead>
							<tr style="font-weight:bold; background-color:#FFC" align="center">
								<th width="120" style="font-size:14px; font-family:'Calibri Light';" rowspan="<?=$i; ?>" >Particulars</th>
								<th width="50" style="font-size:14px; font-family:'Calibri Light';">%</th>
								<th width="50" style="font-size:14px; font-family:'Calibri Light';">Cost/PCS</th>
								<th width="80" style="font-size:14px; font-family:'Calibri Light';">Total Value</th>
								<th style="font-size:14px; font-family:'Calibri Light';">%</th>
							</tr>
						</thead>
						<tbody>
						<?
							$rowcostReqAmt=$rowcost_per=$rowAmt=0;
							$rowcostReqAmt=$other_costing_arr[$job_no][$indexcost];
							$rowAmt=$rowcostReqAmt/$order_job_qnty;
							$rowcost_per=($rowcostReqAmt/$order_values)*100;
							?>
							<tr>
								<td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$indexhead; ?></td>
								<td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($summary_data[$otherCostHeadPerArr[$indexcost]],3); ?></td>
								
								<td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowAmt,3); ?></td>
								<td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowcostReqAmt,3); ?></td>
								<td style="font-size:14px; font-family:'Calibri Light';" align="right"><?=fn_number_format($rowcost_per,2); ?></td>
							</tr>
						</tbody>
					</table>
				</div>
				<?
			}
		}
	}
	?>
    
    <br/>
    <?
    $lib_designation_arr=return_library_array(" select id,custom_designation from lib_designation","id","custom_designation");
	$user_lib_designation_arr=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
	$user_lib_name_arr=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");

	$mst_id=return_field_value("id as mst_id","wo_pre_cost_mst","job_no=$txt_job_no","mst_id");
	$unapprove_sql_data_array=sql_select("select B.APPROVED_BY, B.UN_APPROVED_BY, B.APPROVED_DATE, B.UN_APPROVED_REASON, B.UN_APPROVED_DATE, B.APPROVED_NO, b.APPROVED, b.UN_APPROVED_REASON from approval_history b where b.mst_id=$mst_id and b.entry_form=77 order by b.id");


    foreach($unapprove_sql_data_array as $row){
        $unapprove_data_array[$row['APPROVED_BY']]=$row;
    }

	if(count($unapprove_data_array)>0)
	{
		$app_status_arr = array(0=>'Un App',1=>'Full App',2=>'Deny',3=>'Partial App');
        ?>
		<table width="930" class="rpt_table" border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>
                <tr>
                	<th colspan="7" style="font-size:14px; font-family:'Calibri Light';word-break:break-all">Approval/Un Approval History</th>
                </tr>
                <tr>
                    <th width="30" style="font-size:14px; font-family:'Calibri Light';word-break:break-all">SL</th>
                    <th width="150" style="font-size:14px; font-family:'Calibri Light';word-break:break-all">Name</th>
                    <th width="120" style="font-size:14px; font-family:'Calibri Light';word-break:break-all">Designation</th>
                    <th width="60" style="font-size:14px; font-family:'Calibri Light';word-break:break-all">Approval Status</th>
                    <th width="60" style="font-size:14px; font-family:'Calibri Light';">Approval No</th>
                    <th width="120" style="font-size:14px; font-family:'Calibri Light';word-break:break-all">App. Date & Time</th>
                    <th style="font-size:14px; font-family:'Calibri Light';word-break:break-all">Reason For Un-Approval</th>
                </tr>
            </thead>
            <tbody>
				<?
                $i=1;
                foreach($unapprove_data_array as $row)
				{
					?>
					<tr>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?=$i; ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$user_lib_name_arr[$row[csf('approved_by')]]; ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';"><?=$lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]]; ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?= $app_status_arr[$row['APPROVED']]; ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?=$row[csf('approved_no')];?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><? if($row[csf('approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); else echo ""; ?></td>
                        <td style="font-size:14px; font-family:'Calibri Light';"> &nbsp; <?= $row['UN_APPROVED_REASON']; ?></td>
					</tr>
					<?
					$i++;
					//$un_approved_date= explode(" ",$row[csf('un_approved_date')]);
					//$un_approved_date=$un_approved_date[0];
					//if($un_approved_date=="") $un_approved_date="";else $un_approved_date=$un_approved_date;

					if($un_approved_date!="")
					{
						if($row[csf('un_approved_by')]!==0)  $row[csf('approved_by')]=$row[csf('un_approved_by')];
						?>
						<tr>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?=$i;?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$user_lib_name_arr[$row[csf('approved_by')]];?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';"><?=$lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?='No';?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';" align="center"><?=$row[csf('approved_no')];?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><? if($row[csf('un_approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('un_approved_date')])); else echo "";?></td>
                            <td style="font-size:14px; font-family:'Calibri Light';word-break:break-all"><?=$unapproved_request_arr[$mst_id];?></td>
						</tr>
						<?
						$i++;
					}


                }
                ?>
            </tbody>
		</table>
		<?
	}
	?>
    <br>
    <table width="930" align="center">
            <tr>
            <div style="text-align:center;font-size:xx-large; font-style:italic; margin-top:20px; color:#FF0000;">
				<?
                if(count($approval_arr)>0)
                {
                    if($approved == 2 || $approved == 0){echo "Draft";}else{}
                }
                ?>
            </div>
            </tr>
    </table>
 	<?
	echo signature_table(109, $cbo_company_name, "930px",'','1','','');
	exit();
}

if($action=="fabricBom")//nr 23947
{
	extract($_REQUEST);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
	$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
	$txt_job_no=str_replace("'","",$txt_job_no);
	$show_yarn_rate=str_replace("'","",$show_yarn_rate);
	$path=str_replace("'","",$path);
	if($path==1) $path="../../";

	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1 and master_tble_id='$cbo_company_name'",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	$marchentrArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info ","id","team_member_name");
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$brand_name_arr=return_library_array( "select id, brand_name from lib_buyer_brand ",'id','brand_name');
	$comp=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$user_name_arr=return_library_array( "select id, user_name from user_passwd ",'id','user_name');
	$team_leader_arr=return_library_array( "select id,team_leader_name from lib_marketing_team",'id','team_leader_name');
	$color_library = return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$pro_sub_dept_array=return_library_array( "select id,sub_department_name from lib_pro_sub_deparatment",'id','sub_department_name');
	$size_library=return_library_array( "select id, size_name from lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	?>
	<style type="text/css">
		@media print {
		    .pagebreak { page-break-before: always; } /* page-break-after works, as well */
		}
	</style>
	<div style="width:1330px" align="center">
    <?php

		if($txt_job_no=="") $job_no=''; else $job_no=" and b.job_no=".$txt_job_no."";
		$nameArray=sql_select( "select a.id, b.job_no, b.buyer_name, b.style_ref_no, b.gmts_item_id, b.order_uom, b.total_set_qnty, (b.job_quantity*b.total_set_qnty) as jobqtypcs, b.style_description, b.season_buyer_wise as season, b.product_dept, b.product_code, b.pro_sub_dep, b.dealing_marchant,b.factory_marchant, b.order_repeat_no, b.repeat_job_no,c.approved from wo_po_break_down a, wo_po_details_master b,wo_pre_cost_mst c where a.job_id=b.id and b.id=c.job_id and a.job_id=c.job_id and b.job_no ='".$txt_job_no."'");
		foreach($nameArray as $row)
        {
            $po_ids_all.=$row[csf('id')].",";
			$txt_order_no_arr[$row[csf('id')]] = $row[csf('id')];
		}
		$txt_order_no_id=implode(",", $txt_order_no_arr);
		$po_id_alls=implode(",",array_filter(array_unique(explode(",",$po_ids_all))));
		$po_id_all=chop($po_id_alls, ",");
		$job_no_str=$nameArray[0][csf('job_no')];	
		$is_approved = $nameArray[0][csf('approved')];

		if($txt_job_no!="") $location=return_field_value( "location_name", "wo_po_details_master","job_no='$txt_job_no'"); else $location="";
		$sql_loc=sql_select("select id,location_name,address from lib_location where company_id=$cbo_company_name");
		foreach($sql_loc as $row)
		{
		$location_name_arr[$row[csf('id')]]= $row[csf('location_name')];
		$location_address_arr[$row[csf('id')]]= $row[csf('address')];
		}
		 
  		ob_start();     
		?>	
											<!--    Header Company Information         -->
        <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black; font-family:Arial Narrow;" >
            <tr>
                <td width="200" style="font-size:28px"</td>
                <td width="1250">
                    <table width="100%" cellpadding="0" cellspacing="0"  style="position: relative;">
                        <tr>
                            <td align="center" style="font-size:28px;"> <?php echo $comp[$cbo_company_name]; ?></td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:18px;position: relative;"><?=$location_address_arr[$location]; ?></td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:24px">
                            	<span style="float:center;"><b><strong> <font style="color:black">Fabric Bom</font></strong></b></span> 
                            </td>
                        </tr>                        
						<tr>
                            <td align="center" style="font-size:20px">
							<? if ($is_approved == 1) { ?>
										<b style="color: green;"> This Budget is Approved </b>
									<? } elseif ($is_approved == 3) { ?>
										<b style="color: green;"> This Budget is partial Approved </b>
									<? } else { ?>
										<b style="color: red;"> This Budget is Not  Approved </b>
								<? } ?>							  
                            </td>
                            
							
                        </tr>
						<tr>
                            <td align="center" style="font-size:24px">
                            	<span style="float:center;"><b><strong> <font style="color:black">Job No</font>:<? echo $txt_job_no; ?></strong></b></span> 
                            </td>
                        </tr> 

                    </table>
					
                </td>
                <td width="200">
                </td>
            </tr>
        </table>
		<?
        $job_no=trim($txt_job_no,"'"); $total_set_qnty=0; $colar_excess_percent=0; $cuff_excess_percent=0; $rmg_process_breakdown=0; $booking_percent=0; $booking_po_id='';
		if($db_type==0)
        {
            $date_dif_cond="DATEDIFF(pub_shipment_date,po_received_date)";
            $group_concat_all="group_concat(grouping) as grouping, group_concat(file_no) as file_no";
        }
        else
        {
            $date_dif_cond="(pub_shipment_date-po_received_date)";
            $group_concat_all=" listagg(cast(grouping as varchar2(4000)),',') within group (order by grouping) as grouping,
                                listagg(cast(file_no as varchar2(4000)),',') within group (order by file_no) as file_no  ";
        }
        $po_number_arr=array(); $po_ship_date_arr=array(); $shipment_date=""; $po_no=""; $po_received_date=""; $shiping_status="";
        $po_sql=sql_select("select id, po_number, pub_shipment_date, MIN(pub_shipment_date) as mpub_shipment_date, MIN(po_received_date) as po_received_date, MIN(insert_date) as insert_date, plan_cut, po_quantity, shiping_status, $date_dif_cond as date_diff,min(factory_received_date) as factory_received_date, $group_concat_all,status_active from wo_po_break_down where id in(".$po_id_all.") group by id, po_number, pub_shipment_date, plan_cut, po_quantity, shiping_status, po_received_date,status_active ");
      
		
        $to_ship=0; $fp_ship=0; $f_ship=0;

        foreach($po_sql as $row)
        {
            $po_qnty_tot+=$row[csf('plan_cut')];
            $po_qnty_tot1+=$row[csf('po_quantity')];
            $po_number_arr[$row[csf('id')]]=$row[csf('po_number')];
            $po_ship_date_arr[$row[csf('id')]]=$row[csf('pub_shipment_date')];
            $po_num_arr[$row[csf('id')]]=$row[csf('po_number')];
            $po_no.=$row[csf('po_number')].", ";
            $shipment_date.=change_date_format($row[csf('mpub_shipment_date')],'dd-mm-yyyy','-').", ";
            $lead_time.=$row[csf('date_diff')].",";
            $po_received_date=change_date_format($row[csf('po_received_date')],'dd-mm-yyyy','-');
            $factory_received_date=change_date_format($row[csf('factory_received_date')],'dd-mm-yyyy','-');
            $grouping.=$row[csf('grouping')].",";
            $file_no.=$row[csf('file_no')].",";
			if($row[csf('status_active')]==3){
				$cancel_po_no[$row[csf('po_number')]]=$row[csf('po_number')];
			}

			
			$daysInHand.=(datediff('d',date('d-m-Y',time()),$row[csf('mpub_shipment_date')])-1).",";
			
			if($bookingup_date=="" || $bookingup_date=="0000-00-00 00:00:00")
			{
				$booking_date=$bookingins_date;
			}
			$WOPreparedAfter.=(datediff('d',$row[csf('insert_date')],$booking_date)-1).",";

			if($row[csf('shiping_status')]==1) {
				$shiping_status.= "FP".",";
				$to_ship++;
				$fp_ship++;
			}
			else if($row[csf('shiping_status')]==2){
				$shiping_status.= "PD".",";
				$to_ship++;
			} 
			else if($row[csf('shiping_status')]==3){
				$shiping_status.= "FS".",";
				$to_ship++;
				$f_ship++;
			} 
        }

        if($to_ship==$f_ship) $shiping_status= "<b style='color:green'>Full shipped</b>";
        else if($to_ship==$fp_ship) $shiping_status= "<b style='color:red'>Full Pending</b>";
        else $shiping_status= "<b style='color:red'>Partial Delivery</b>";
		
		$po_no=implode(",",array_filter(array_unique(explode(",",$po_no))));
		$shipment_date=implode(",",array_filter(array_unique(explode(",",$shipment_date))));
		$lead_time=implode(",",array_filter(array_unique(explode(",",$lead_time))));
		$po_received_date=implode(",",array_filter(array_unique(explode(",",$po_received_date))));
		$factory_received_date=implode(",",array_filter(array_unique(explode(",",$factory_received_date))));
		$grouping=implode(",",array_filter(array_unique(explode(",",$grouping))));
		$file_no=implode(",",array_filter(array_unique(explode(",",$file_no))));
		
		$daysInHand=implode(",",array_filter(array_unique(explode(",",$daysInHand))));
		$WOPreparedAfter=implode(",",array_filter(array_unique(explode(",",$WOPreparedAfter))));
		$shiping_status=implode(",",array_filter(array_unique(explode(",",$shiping_status))));
		 $labdip_sql=sql_select("select lapdip_no,color_name_id,po_break_down_id as poid from wo_po_lapdip_approval_info where job_no_mst='".$job_no."'  and approval_status=3 and is_deleted=0  and status_active=1 and is_deleted=0");
		 	foreach ($labdip_sql as $row) 
			{
				if($row[csf('lapdip_no')])
				{
					$labdipArr[$row[csf('poid')]][$row[csf('color_name_id')]]=$row[csf('lapdip_no')];
				}
				
			}
			unset($labdip_sql);
		//$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."'  and approval_status=3 and is_deleted=0  and color_name_id=".$row[csf('fabric_color_id')]." and  po_break_down_id=".$row[csf('po_break_down_id')]."  and status_active=1 and is_deleted=0 ");
		$po_no=str_replace("'","",$txt_po_breack_down_id);
			$condition= new condition();
			if(str_replace("'","",$txt_job_no) !=''){
				  $condition->job_no("='$txt_job_no'");
			 }

			   if(str_replace("'","",$txt_po_breack_down_id)!='')
			 {
				$condition->po_id("in(".$po_id_all.")");
			 }
			 else
			 { //$all_po_ids
				 $condition->po_id("in(".$po_id_all.")");
			 } 
			  $condition->init(); $fabric= new fabric($condition);
			  $fabric_qty_arr=$fabric->getQtyArray_by_JobColorFabricColorBodyPartIdDeterminIdGsmAndDiaWidth_knitAndwoven_greyAndfinish();
			    /*  echo '<pre>';
			  print_r($fabric_qty_arr); die;  
			  //echo $fabric->getQuery(); die; */
		$sql_fab_color="select d.pre_cost_fabric_cost_dtls_id as fab_dtl_id,d.gmts_color_id,d.contrast_color_id from wo_pre_cost_fabric_cost_dtls c,wo_pre_cos_fab_co_color_dtls d where c.job_no=d.job_no and d.pre_cost_fabric_cost_dtls_id=c.id and c.status_active=1 and c.is_deleted=0 and c.job_no='$txt_job_no'";
		$fab_result=sql_select($sql_fab_color);
		foreach($fab_result as $row)
		{
			$fab_color_arr[$row[csf("fab_dtl_id")]][$row[csf("gmts_color_id")]]=$row[csf("contrast_color_id")];
		}
		unset($fab_result);
 
		$nameArray_fabric_description= sql_select("select a.color_size_sensitive,a.body_part_id, a.lib_yarn_count_deter_id as determin_id, a.color_type_id, a.construction, a.composition, a.gsm_weight,a.width_dia_type as width_dia_type, b.dia_width, b.remarks, avg(b.cons) as cons, b.process_loss_percent, avg(b.requirment) as requirment,b.po_break_down_id,  b.color_number_id as gmts_color_id,a.id,a.job_no,a.uom FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b WHERE a.job_id=b.job_id and a.id=b.pre_cost_fabric_cost_dtls_id and a.job_no='$txt_job_no' and a.status_active = 1 AND a.is_deleted = 0  AND b.status_active = 1  AND b.is_deleted = 0 group by a.color_size_sensitive,a.body_part_id,a.id, a.lib_yarn_count_deter_id, a.color_type_id, a.construction, a.composition, a.gsm_weight, b.dia_width, b.remarks,b.po_break_down_id, b.process_loss_percent, b.color_number_id,a.job_no,a.uom,a.width_dia_type order by a.id, a.body_part_id, b.dia_width");
		foreach ($nameArray_fabric_description as $row) {	
			
					$color_size_sensitive=$row[csf("color_size_sensitive")];
					if($color_size_sensitive==3)
					{
						if($fab_color_arr[$row[csf("id")]][$row[csf("gmts_color_id")]]!='')
						{
							$fab_color_id=$fab_color_arr[$row[csf("id")]][$row[csf("gmts_color_id")]];
						}
					}
					else  $fab_color_id=$row[csf("gmts_color_id")];
					$fincons=array_sum($fabric_qty_arr['knit']['finish'][$row[csf("job_no")]][$row[csf("gmts_color_id")]][$fab_color_id][$row[csf("body_part_id")]][$row[csf("determin_id")]][$row[csf("gsm_weight")]][$row[csf("dia_width")]][$row[csf("width_dia_type")]])+array_sum($fabric_qty_arr['woven']['finish'][$row[csf("job_no")]][$row[csf("gmts_color_id")]][$fab_color_id][$row[csf("body_part_id")]][$row[csf("determin_id")]][$row[csf("gsm_weight")]][$row[csf("dia_width")]][$row[csf("width_dia_type")]]);
					$greycons=array_sum($fabric_qty_arr['knit']['grey'][$row[csf("job_no")]][$row[csf("gmts_color_id")]][$fab_color_id][$row[csf("body_part_id")]][$row[csf("determin_id")]][$row[csf("gsm_weight")]][$row[csf("dia_width")]][$row[csf("width_dia_type")]])+array_sum($fabric_qty_arr['woven']['grey'][$row[csf("job_no")]][$row[csf("gmts_color_id")]][$fab_color_id][$row[csf("body_part_id")]][$row[csf("determin_id")]][$row[csf("gsm_weight")]][$row[csf("dia_width")]][$row[csf("width_dia_type")]]);
			
			$grouping_item=$fab_color_id.'*'.$row[csf('body_part_id')].'*'.$row[csf('construction')].'*'.$row[csf('composition')].'*'.$row[csf('gsm_weight')].'*'.$row[csf('dia_width')].'*'.$row[csf('color_type_id')];	
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['fabric_color_id'] = $fab_color_id;
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['body_part_id'] = $row[csf('body_part_id')];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['fabric_des'] = $row[csf('construction')].','.$row[csf('composition')];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['gsm'] = $row[csf('gsm_weight')];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['fabric_dia'] = $row[csf('dia_width')].",".$fabric_typee[$row[csf('width_dia_type')]];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['color_type_id'] = $row[csf('color_type_id')];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['finsh_cons'] = $row[csf('cons')];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['gray_cons'] = $row[csf('requirment')];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['fin_fab_qnty'] = $fincons;
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['grey_fab_qnty'] = $greycons;
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['process_loss_percent'] = $row[csf('process_loss_percent')];
	
		}
		 /*  echo '<pre>';
			  print_r($fabric_data_arr); die;    */
		unset($nameArray_fabric_description);
		?>
		 <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" style="font-size: 18px;">
			 <tr>
				 <th>Gmts Color</th>
				 <th>Fabric Color</th>
				 <th>Body Part</th>
				 <th>Fabrication</th>
				 <th>GSM</th>
				 <th>Dia Type with </br> Fabric Dia</th>			
				 <th>Color Type</th>
				 <th>Finsh Cons.</th>
				 <th>Finish  Qty</th>
				 <th>Grey Cons.</th>
				 <th>Grey Qty</th>
				 <th>Process Loss %</th>
			 </tr>
			 <? 
			 foreach ($fabric_data_arr as $gmts_id=>$fabric_data_arr) {  
			 $i=1;     		  		
				 foreach ($fabric_data_arr as $fabric_id => $value) {
						 $fin_fab_qnty+=$value['fin_fab_qnty'];   		 	
						 $grey_fab_qnty+=$value['grey_fab_qnty'];   		 	
						  if($i==1){
						   ?>
						  <tr>
							 <td rowspan="<? echo count($fabric_data_arr) ?>"><? echo $color_library[$gmts_id] ?></td>
							 <td><? echo $color_library[$value['fabric_color_id']] ?></td>
							 <td><? echo $body_part[$value['body_part_id']] ?></td>
							 <td><? echo $value['fabric_des'] ?></td>
							 <td><? echo $value['gsm'] ?></td>
							 <td><? echo $value['fabric_dia'] ?></td>
							 <td><? echo $color_type[$value['color_type_id']] ?></td>
							 <td align="right"><? echo fn_number_format($value['finsh_cons'],4) ; ?></td>
							 <td align="right"><? echo fn_number_format($value['fin_fab_qnty'],4) ; ?></td>
							 <td align="right"><? echo fn_number_format($value['gray_cons'],4) ; ?></td>		     			
							 <td align="right"><? echo fn_number_format($value['grey_fab_qnty'],4) ; ?></td>
							 <td align="center"><? echo $value['process_loss_percent'] ?></td>
						 </tr>
						  <? } 
						  else { ?>
							  <tr>
								 <td><? echo $color_library[$value['fabric_color_id']] ?></td>
								 <td><? echo $body_part[$value['body_part_id']] ?></td>
								 <td><? echo $value['fabric_des'] ?></td>
								 <td><? echo $value['gsm'] ?></td>
								 <td><? echo $value['fabric_dia'] ?></td>
								 <td><? echo $color_type[$value['color_type_id']] ?></td> 
								 <td align="right"><? echo fn_number_format($value['finsh_cons'],4) ; ?></td>
								 <td align="right"><? echo number_format($value['fin_fab_qnty'],2) ?></td>
								 <td align="right"><? echo fn_number_format($value['gray_cons'],4) ; ?></td>			     			
								 <td align="right"><? echo number_format($value['grey_fab_qnty'],2) ?></td>
								 <td align="center"><? echo $value['process_loss_percent'] ?></td>
							 </tr>
						  <? }
						  $i++;
				 }
			 } 
			 ?>
			 <tr>
				 <th colspan="8">Total</th>
				 <th><? echo number_format($fin_fab_qnty);  ?></th>
				 <th></th>
				 <th><? echo number_format($grey_fab_qnty);  ?></th>
				 <th></th>
			 </tr>
		 </table>
		  <br/>



      	<!--  Here will be the main portion  -->
		<?
        $costing_per=""; $costing_per_qnty=0;
        $costing_per_id=return_field_value( "costing_per", "wo_pre_cost_mst","job_no ='$job_no'");
        if($costing_per_id==1)
        {
			$costing_per="1 Dzn";
			$costing_per_qnty=12;
        }
        if($costing_per_id==2)
        {
			$costing_per="1 Pcs";
			$costing_per_qnty=1;
        }
        if($costing_per_id==3)
        {
			$costing_per="2 Dzn";
			$costing_per_qnty=24;
        }
        if($costing_per_id==4)
        {
			$costing_per="3 Dzn";
			$costing_per_qnty=36;
        }
        if($costing_per_id==5)
        {
			$costing_per="4 Dzn";
			$costing_per_qnty=48;
        }

        $process_loss_method=return_field_value( "process_loss_method", "wo_pre_cost_fabric_cost_dtls","job_no='$job_no'");
		$fb_desc_sq="SELECT min(a.id) as fabric_cost_dtls_id, a.lib_yarn_count_deter_id as determin_id, a.item_number_id, a.body_part_id, a.color_type_id, a.construction, a.composition, a.gsm_weight, min(a.width_dia_type) as width_dia_type,  b.dia_width, avg(b.cons) as cons, avg(b.process_loss_percent) as process_loss_percent, avg(b.requirment) as requirment FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b WHERE a.job_id=b.job_id and a.id=b.pre_cost_fabric_cost_dtls_id  and b.po_break_down_id in(".$po_id_all.") and a.status_active=1 and b.status_active=1 group by a.body_part_id, a.lib_yarn_count_deter_id, a.color_type_id, a.item_number_id, a.construction, a.composition, a.gsm_weight,  b.dia_width order by fabric_cost_dtls_id, a.body_part_id, b.dia_width"; 
		$nameArray_fabric_description= sql_select($fb_desc_sq);
			?>
			<table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" style="font-family:Arial Narrow;font-size:18px;" >
                <tr align="center">
                    <th colspan="2" align="left">Body Part</th>
                    <?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
						if( $result_fabric_description[csf('body_part_id')] == "") echo "<td  colspan='2'>&nbsp</td>";
						else echo "<td colspan='2'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
                    }
                    ?>
                   <th colspan="2" align="center">Total</th>
                </tr>
                <tr>
                    <th width="120" align="left">Fabric Color</th>
                    <th width="120" align="left">Body Color</th>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
                   		echo "<th width='50'>Finish</th><th width='50' >Grey</th>";
                    }
                    ?>
					<th width='50'>Finish</th>
					<th width='50' >Grey</th>
                </tr>
                <?
				$condition= new condition();
				if(str_replace("'","",$po_id_all) !=''){
					$condition->po_id_in("$po_id_all");
				}
				$condition->init();
				$fabric= new fabric($condition);
				$fabric_req_qty_arr=$fabric->getQtyArray_by_orderGmtscolorAndBodypart_knitAndwoven_greyAndfinish();
			 	/* echo "<pre>";
				print_r($fabric_req_qty_arr);die;  */
                $color_wise_wo_sql = "SELECT b.po_break_down_id as po_id,a.item_number_id, a.body_part_id, a.color_type_id, a.construction, a.composition, a.gsm_weight, a.lib_yarn_count_deter_id, b.dia_width, b.remarks, b.color_number_id as fabric_color_id,  SUM (b.cons * b.pcs) AS fin_fab_qnty,SUM (b.requirment * b.pcs) AS grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b,wo_po_color_size_breakdown c where  a.id=b.pre_cost_fabric_cost_dtls_id and c.id=b.color_size_table_id and b.po_break_down_id 
				in(".$po_id_all.") and c.po_break_down_id in(".$po_id_all.")  and a.status_active=1 and b.status_active=1 and c.status_active=1 group by  b.po_break_down_id,a.item_number_id, a.body_part_id, a.color_type_id, a.construction, a.composition, a.gsm_weight, a.lib_yarn_count_deter_id, b.dia_width, b.remarks, b.color_number_id,b.cons,b.pcs,b.requirment";              
                $color_wise_wo_sql_res=sql_select($color_wise_wo_sql); $fin_grey_qty_arr=array(); $fin_grey_color_qty_arr=array();
                foreach($color_wise_wo_sql_res as $row)
                {
					$finconsump=array_sum($fabric_req_qty_arr['knit']['finish'][$row[csf("po_id")]][$row[csf("fabric_color_id")]][$row[csf("body_part_id")]])+array_sum($fabric_req_qty_arr['woven']['finish'][$row[csf("po_id")]][$row[csf("fabric_color_id")]][$row[csf("body_part_id")]]);
					$greyconsump=array_sum($fabric_req_qty_arr['knit']['grey'][$row[csf("po_id")]][$row[csf("fabric_color_id")]][$row[csf("body_part_id")]])+array_sum($fabric_req_qty_arr['woven']['grey'][$row[csf("po_id")]][$row[csf("fabric_color_id")]][$row[csf("body_part_id")]]);

					$fin_grey_key = $row[csf('item_number_id')].'**'.$row[csf('body_part_id')].'**'.$row[csf('color_type_id')].'**'.$row[csf('construction')].'**'.$row[csf('composition')].'**'.$row[csf('gsm_weight')].'**'.$row[csf('lib_yarn_count_deter_id')].'**'.$row[csf('dia_width')];
					$fin_grey_color_key = $row[csf('item_number_id')].'**'.$row[csf('body_part_id')].'**'.$row[csf('color_type_id')].'**'.$row[csf('construction')].'**'.$row[csf('composition')].'**'.$row[csf('gsm_weight')].'**'.$row[csf('lib_yarn_count_deter_id')].'**'.$row[csf('dia_width')].'**'.$row[csf('fabric_color_id')];
					/* $fin_grey_qty_arr[$fin_grey_key]['fin'] += $row[csf('fin_fab_qnty')];
					$fin_grey_qty_arr[$fin_grey_key]['grey'] += $row[csf('grey_fab_qnty')]; */
					$fin_grey_qty_arr[$fin_grey_key]['fin'] += $finconsump;
					$fin_grey_qty_arr[$fin_grey_key]['grey'] += $greyconsump;
					/* $fin_grey_color_qty_arr[$fin_grey_color_key]['fin'] +=$row[csf('fin_fab_qnty')];
					$fin_grey_color_qty_arr[$fin_grey_color_key]['grey'] +=$row[csf('grey_fab_qnty')]; */
					$fin_grey_color_qty_arr[$fin_grey_color_key]['fin'] +=$finconsump;
					$fin_grey_color_qty_arr[$fin_grey_color_key]['grey'] +=$greyconsump;
                }
				 /* echo "<pre>";
				print_r($fin_grey_qty_array);die;  */
                unset($color_wise_wo_sql_res);
                
                $gmt_color_library=array();
                $gmt_color_data=sql_select("select a.id,b.gmts_color_id, b.contrast_color_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id in(1,2) and a.fabric_source in(1,2) and a.job_no ='$job_no' and a.status_active=1 and b.status_active=1 order by a.id");
                foreach( $gmt_color_data as $gmt_color_row)
                {
                	$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
                } 
				unset($gmt_color_data);
                
                $lab_dip_no_arr=array();
                $lab_dip_no_sql=sql_select("select lapdip_no, color_name_id from wo_po_lapdip_approval_info where job_no_mst='$job_no' and status_active=1 and is_deleted=0 and approval_status=3");
                foreach($lab_dip_no_sql as $row)
                {
                	$lab_dip_no_arr[$row[csf('color_name_id')]].=$row[csf('lapdip_no')].',';
                }
                unset($lab_dip_no_sql);
                
                $grand_total_fin_fab_qnty=0; $grand_total_grey_fab_qnty=0; $grand_totalcons_per_finish=0; $grand_totalcons_per_grey=0;
                $color_wise_wo_sql=sql_select("select color_number_id as fabric_color_id FROM wo_pre_cos_fab_co_avg_con_dtls WHERE po_break_down_id in(".$po_id_all.")  and status_active=1 and is_deleted=0 group by color_number_id");
                foreach($color_wise_wo_sql as $color_wise_wo_result)
                {
					?>
					<tr>
                        <td width="120" align="left"><? echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]]; ?></td>
                        <td width="120"><? echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]); ?></td>
                       
                        <?
                        $total_fin_fab_qnty=0; $total_grey_fab_qnty=0;
                        foreach($nameArray_fabric_description as $result_fabric_description)
                        {
							$color_wo_fin_qnty=0; $color_wo_grey_qnty=0;
							$fin_gray_color = $result_fabric_description[csf('item_number_id')].'**'.$result_fabric_description[csf('body_part_id')].'**'.$result_fabric_description[csf('color_type_id')].'**'.$result_fabric_description[csf('construction')].'**'.$result_fabric_description[csf('composition')].'**'.$result_fabric_description[csf('gsm_weight')].'**'.$result_fabric_description[csf('determin_id')].'**'.$result_fabric_description[csf('dia_width')].'**'.$color_wise_wo_result[csf('fabric_color_id')];
							$color_wo_fin_qnty=$fin_grey_color_qty_arr[$fin_gray_color]['fin'];
							
							$color_wo_grey_qnty=$fin_grey_color_qty_arr[$fin_gray_color]['grey'];
							?>
							<td width='50' align='center' style="font-size:18px;">
								<?
                                if($color_wo_fin_qnty!="")
                                {
                                    echo number_format($color_wo_fin_qnty,2) ;
                                    $total_fin_fab_qnty+=$color_wo_fin_qnty;
                                }
                                ?>
							</td>
							<td width='50' align='center' style="font-size:18px;">
								<?
                                if($color_wo_grey_qnty!="")
                                {
									echo number_format($color_wo_grey_qnty,2);
									$total_grey_fab_qnty+=$color_wo_grey_qnty;
                                }
                                ?>
							</td>
							
							
							<?
                        }
                        ?>
						<td width='50' align='center' style="font-size:18px;">
								<?
                                
									echo number_format($total_fin_fab_qnty,2);
									 $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;
                                
                                ?>
							</td>
							
							<td width='50' align='center' style="font-size:18px;">
								<?
                               
									echo number_format($total_grey_fab_qnty,2);
									 $grand_total_grey_fab_qnty+=$total_grey_fab_qnty;
                                
                                ?>
							</td>
                        
					</tr>
					<?
                }
                ?>
                <tr style=" font-weight:bold">
                    <th width="120" align="left">&nbsp;</th>      
					                
                    <td width="120" align="left"><strong>Total</strong></td>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
						$wo_fin_qnty=0; $wo_grey_qnty=0;
						$fin_key = $result_fabric_description[csf('item_number_id')].'**'.$result_fabric_description[csf('body_part_id')].'**'.$result_fabric_description[csf('color_type_id')].'**'.$result_fabric_description[csf('construction')].'**'.$result_fabric_description[csf('composition')].'**'.$result_fabric_description[csf('gsm_weight')].'**'.$result_fabric_description[csf('determin_id')].'**'.$result_fabric_description[csf('dia_width')];
						
						$wo_fin_qnty=$fin_grey_qty_arr[$fin_key]['fin'];
						$wo_grey_qnty=$fin_grey_qty_arr[$fin_key]['grey'];
						?>
						<td width='50' align='center' style="font-size:18px;"><?  echo number_format($wo_fin_qnty,2) ;?></td><td width='50' align='center' style="font-size:18px;" > <? echo number_format($wo_grey_qnty,2);?></td>
						<?
                    }
                    ?>
					<td width='50' align='center' style="font-size:18px;"><?  echo number_format($grand_total_fin_fab_qnty,2) ;?></td><td width='50' align='center' style="font-size:18px;" > <? echo number_format($grand_total_grey_fab_qnty,2);?></td>
                   
                </tr>
               
			</table>
        <?

	$order_plan_qty_arr=array();
	$color_wise_wo_sql_qnty=sql_select( "select color_number_id, size_number_id, sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where job_no_mst='".$job_no."' and po_break_down_id in(".$po_id_all.") and status_active=1 and is_deleted =0 group by color_number_id, size_number_id");
	foreach($color_wise_wo_sql_qnty as $row)
	{
		$order_plan_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]]['plan']=$row[csf('plan_cut_qnty')];
		$order_plan_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]]['order']=$row[csf('order_quantity')];
	}

	$collar_cuff_percent_arr=array();
	$collar_cuff_body_arr=array();
	$collar_cuff_color_arr=array();
	$collar_cuff_size_arr=array();
	$collar_cuff_item_size_arr=array();
	$color_size_sensitive_arr=array();

	$collar_cuff_sql="select a.id, a.color_size_sensitive, a.color_break_down, b.color_number_id, b.gmts_sizes, b.item_size, c.size_number_id,e.body_part_full_name, e.body_part_type
	FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c, lib_body_part e

	WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and a.job_no='".$job_no."' and c.po_break_down_id in(".$po_id_all.") and a.body_part_id=e.id and a.fabric_source=1 and e.body_part_type in (40,50) and c.id=b.color_size_table_id and c.status_active=1 and c.is_deleted=0 order by  c.size_order";
	//echo $collar_cuff_sql;
	$collar_cuff_sql_res=sql_select($collar_cuff_sql);

	foreach($collar_cuff_sql_res as $collar_cuff_row)
	{
		$collar_cuff_percent_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('color_number_id')]][$collar_cuff_row[csf('gmts_sizes')]]=$collar_cuff_row[csf('colar_cuff_per')];
		$collar_cuff_body_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]]=$collar_cuff_row[csf('body_part_full_name')];
		$collar_cuff_size_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('size_number_id')]]=$collar_cuff_row[csf('size_number_id')];
		$collar_cuff_item_size_arr[$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('size_number_id')]][$collar_cuff_row[csf('item_size')]]=$collar_cuff_row[csf('item_size')];
		$color_size_sensitive_arr[$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('id')]][$collar_cuff_row[csf('color_number_id')]][$collar_cuff_row[csf('color_size_sensitive')]]=$collar_cuff_row[csf('color_break_down')];

	}
	unset($collar_cuff_sql_res); $jk=0;
	foreach($collar_cuff_body_arr as $body_type=>$body_name)
	{
		foreach($body_name as $body_val)
		{
			$count_collar_cuff=count($collar_cuff_size_arr[$body_type][$body_val]);
			$pre_grand_tot_collar=0; $pre_grand_tot_collar_order_qty=0;
			if($jk==0 || (($jk/2)==0)) {
			?>
			<div style="max-height:1330px; overflow:auto; float:left; padding-top:5px; margin-left:5px; margin:5px; margin-bottom:5px; position:relative;"> <? } ?>
			<table width="625" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
				<tr>
					<td colspan="<? echo $count_collar_cuff+3; ?>" align="center"><b><? echo $body_val; ?> - Color Size Brakedown in Pcs.</b></td>
				</tr>
				<tr>
					<td width="100">Size <? echo $jk; ?></td>
						<?
						foreach($collar_cuff_size_arr[$body_type][$body_val]  as $size_number_id)
						{
							?>
							<td align="center" style="border:1px solid black"><strong><? echo $size_library[$size_number_id];?></strong></td>
							<?
						}
						?>
					<td width="60" rowspan="2" align="center"><strong>Total</strong></td>
				</tr>
				<tr>
					<td style="font-size:12px"><? echo $body_val; ?> Size</td>
					<?
					foreach($collar_cuff_item_size_arr[$body_val]  as $size_number_id=>$size_number)
					{
						if(count($size_number)>0)
						{
							foreach($size_number  as $item_size=>$val)
							{
								?>
								<td align="center" style="border:1px solid black"><strong><? echo $item_size;?></strong></td>
								<?
							}
						}
						else
						{
							?>
							<td align="center" style="border:1px solid black"><strong>&nbsp;</strong></td>
							<?
						}
					}

					$pre_size_total_arr=array();
					foreach($color_size_sensitive_arr[$body_val] as $pre_cost_id=>$pre_cost_data)
					{
						foreach($pre_cost_data as $color_number_id=>$color_number_data)
						{
							foreach($color_number_data as $color_size_sensitive=>$color_break_down)
							{
								$pre_color_total_collar=0;
								$pre_color_total_collar_order_qnty=0;
								$process_loss_method=$process_loss_method;
								$constrast_color_arr=array();
								if($color_size_sensitive==3)
								{
									$constrast_color=explode('__',$color_break_down);
									for($i=0;$i<count($constrast_color);$i++)
									{
										$constrast_color2=explode('_',$constrast_color[$i]);
										$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
									}
								}
								?>
								<tr>
									<td>
										<?
										if( $color_size_sensitive==3)
										{
											echo strtoupper ($constrast_color_arr[$color_number_id]) ;
											$lab_dip_color_id=$lab_dip_color_arr[$pre_cost_id][$color_number_id];
										}
										else
										{
											echo $color_library[$color_number_id];
											$lab_dip_color_id=$color_number_id;
										}
										?>
									</td>
									<?
									foreach($collar_cuff_size_arr[$body_type][$body_val] as $size_number_id)
									{
										?>
										<td align="center" style="border:1px solid black">
											<? $plan_cut=0; $collerqty=0; $collar_ex_per=0;
											if($body_type==50) $plan_cut=($order_plan_qty_arr[$color_number_id][$size_number_id]['plan'])*2;
											else $plan_cut=$order_plan_qty_arr[$color_number_id][$size_number_id]['plan'];
											$ord_qty=$order_plan_qty_arr[$color_number_id][$size_number_id]['order'];

											$collar_ex_per=$collar_cuff_percent_arr[$body_type][$body_val][$color_number_id][$size_number_id];
											// echo $collar_ex_per.'=';
											if($body_type==50) { if($collar_ex_per==0 || $collar_ex_per=="") $collar_ex_per=$cuff_excess_percent; else $collar_ex_per=$collar_ex_per; }
											else if($body_type==40) { if($collar_ex_per==0 || $collar_ex_per=="") $collar_ex_per=$colar_excess_percent; else $collar_ex_per=$collar_ex_per; }
											$colar_excess_per=fn_number_format(($plan_cut*$collar_ex_per)/100,6,".",",");
											$collerqty=($plan_cut+$colar_excess_per);

											//$collerqty=fn_number_format(($requirment/$costing_per_qnty)*$plan_cut,2,'.','');

											echo fn_number_format($collerqty);
											$pre_size_total_arr[$size_number_id]+=$collerqty;
											$pre_color_total_collar+=$collerqty;
											$pre_color_total_collar_order_qnty+=$plan_cut;

											//$pre_grand_tot_collar_order_qty+=$plan_cut;
											?>
										</td>
										<?
									}
									?>
									<td align="center"><? echo fn_number_format($pre_color_total_collar); ?></td>
								</tr>
								<?
								$pre_grand_collar_ex_per+=$collar_ex_per;
								$pre_grand_tot_collar+=$pre_color_total_collar;
								$pre_grand_tot_collar_order_qty+=$pre_color_total_collar_order_qnty;
							}
						}
					}
					?>
				</tr>
				<tr>
					<td>Size Total</td>
						<?
						foreach($pre_size_total_arr  as $size_qty)
						{
							?>
							<td style="border:1px solid black;  text-align:center"><? echo fn_number_format($size_qty); ?></td>
							<?
						}
						?>
					<td style="border:1px solid black; text-align:center"><? echo fn_number_format($pre_grand_tot_collar); ?></td>
				</tr>
			</table>
			<? if($jk==0 || (($jk/2)==0)) { ?>
			</div> <? } ?>
			<br/>
			<?
			$jk++;
		}
	}
	?>
	<br>
	<?
	$condition= new condition();
	if(str_replace("'","",$txt_order_no_id) !=''){
		$condition->po_id("in(".str_replace("'","",$txt_order_no_id).")");
	}

	$condition->init();
	$cos_per_arr=$condition->getCostingPerArr();
	$yarn= new yarn($condition);
 	$yarn_data_array=$yarn->getCountCompositionPercentTypeColorAndRateWiseYarnQtyAndAmountArray();
	$yarn_count_arr=return_library_array( "select id,yarn_count from lib_yarn_count",'id','yarn_count');

	$yarn_sql_array=sql_select("SELECT MIN (a.ID) AS yarn_id, a.count_id, a.copm_one_id, a.percent_one, a.copm_two_id, a.percent_two, a.color, a.type_id, SUM (a.cons_qnty) AS yarn_required, a.rate AS rate FROM wo_pre_cost_fab_yarn_cost_dtls a WHERE a.job_no='$txt_job_no' AND a.status_active = 1 AND a.is_deleted = 0 GROUP BY a.count_id, a.copm_one_id, a.percent_one, a.copm_two_id, a.percent_two, a.rate, a.color, a.type_id ORDER BY type_id"); 
	?>
	<table  width="100%"  border="0" cellpadding="0" cellspacing="0" style="font-family:Arial Narrow;font-size:18px;" >
		<tr>
			<td width="100%" valign="top">
				<table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
				<tr align="center">
				<td colspan="7"><b>Yarn Required Summary</b></td>

				</tr>
				<tr align="center">
				<td width="40">Sl</td>
				<td width="40">Yarn Count</td>
				<td width="40">Yarn Type</td>
				<td width="120">Yarn Description</td>
				<td width="40">Brand</td>
				<td width="40">Lot</td>                   
				<td width="40">Rate</td>                  
				<td width="40">Cons for <? echo $costing_per; ?> Gmts</td>
				<td width="40">Total (KG)</td>
				</tr>
				<?
				$i=0;
				$total_yarn=0;
				foreach($yarn_sql_array  as $row)
				{

					$i++;
					$rowcons_qnty = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['qty'];
					$rowcons_Amt = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['amount'];


					$rate=$rowcons_Amt/$rowcons_qnty;
				?>
				<tr align="center">
				<td><? echo $i; ?></td>
				<td><?	echo $yarn_count_arr[$row[csf('count_id')]];?>
				</td>
				<td><? echo $yarn_type[$row[csf('type_id')]] ?></td>
				<td>
					<? 
						$yarn_des=$composition[$row[csf('copm_one_id')]]." ".$row[csf('percent_one')]."%  ";
				$yarn_des.=$color_library[$row[csf('color')]]." ";
				echo $yarn_des;
					?>
				</td>
				<td></td>                   
				<td></td>                   
				<td><? echo number_format($row[csf('rate')],4); ?></td>
				 
				<td title="<?="(".$rowcons_qnty."/".$po_qnty_tot.")*".$cos_per_arr[$job_no];?>"><?  echo number_format(($rowcons_qnty/$po_qnty_tot)*$cos_per_arr[$job_no],4);//echo number_format($row[csf('yarn_required')],4); ?></td>

				<td align="right">
				<? echo number_format($rowcons_qnty,2); $total_yarn+=$rowcons_qnty; ?></td>
				</tr>
				<?
				}
				?>
				<tr align="center">
				<td>Total</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>                  
				<td></td>                   
				<td></td>
				<td align="right"><? echo number_format($total_yarn,2); ?></td>
				</tr>
				</table>
			</td>
		   
			</td>
		</tr>
	</table>


	<br>

	<?

	$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
		?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" style="font-family:Arial Narrow;font-size:18px;">
            <tr>
                <td width="49%" valign="top">
                <?
				/* if(count($sql_embelishment)>0)
				{ */
				?>
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" style="font-family:Arial Narrow;font-size:18px;">
                    <tr align="center">
                    <td colspan="7"><b>Embelishment (Pre Cost)</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Embelishment Name</td>
                    <td>Embelishment Type</td>
                    <td>Cons <? echo $costing_per; ?> Gmts</td>
                    <td>Rate</td>
                    <td>Amount</td>

                    </tr>
                    <?
					$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
					$i=0;
					//$total_yarn=0;
					foreach($sql_embelishment  as $row_embelishment)
                    {

						$i++;
					?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
					<?
					echo $emblishment_name_array[$row_embelishment[csf('emb_name')]];
					?>
                    </td>
                    <td>
                    <?
					if($row_embelishment[csf('emb_name')]==1)
					{
					echo $emblishment_print_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==2)
					{
					echo $emblishment_embroy_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==3)
					{
					echo $emblishment_wash_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==4)
					{
					echo $emblishment_spwork_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==5)
					{
					echo $emblishment_gmts_type[$row_embelishment[csf('emb_type')]];
					}
					?>

                    </td>
                    <td>
                    <?
					echo $row_embelishment[csf('cons_dzn_gmts')];
					?>
                    </td>
                    <td>
					<?
					echo $row_embelishment[csf('rate')];
					?>
                    </td>

                    <td>
					<?
					echo $row_embelishment[csf('amount')];
					?>
                    </td>


                    </tr>
                    <?
					}
					?>

                    </table>
                    <?
				//}
					?>
                </td>
                <td width="2%">
                </td>
				<br>
				<table  width="100%" style="margin: 0px;padding: 0px;">
        <?php $stripe_color_wise=array(); ?>
       
        <tr>
        	<td width="70%">
        		<table  class="rpt_table" border="1" cellpadding="1" cellspacing="1" rules="all" width="100%"   style="font-family:Arial Narrow;font-size:18px;margin: 0px;padding: 0px;" >
	<?
	$sql_cov_stripe = "select  b.id,b.conv_cost_dtls_id,b.fabric_cost_dtls_id,b.gmts_color_id,b.fabric_color_id,b.cons,b.unit_charge,c.stripe_color,d.body_part_id ,c.color_number_id,c.id as did from wo_pre_cost_fab_conv_cost_dtls a, wo_pre_cos_conv_color_dtls b ,wo_pre_stripe_color c ,wo_pre_cost_fabric_cost_dtls d where a.id=b.conv_cost_dtls_id and a.fabric_description=b.fabric_cost_dtls_id and a.fabric_description=c.pre_cost_fabric_cost_dtls_id and b.fabric_cost_dtls_id=c.pre_cost_fabric_cost_dtls_id  and b.gmts_color_id=c.color_number_id and b.fabric_color_id=c.stripe_color and d.id=c.pre_cost_fabric_cost_dtls_id and b.job_no='$job_no'  and a.status_active=1 and b.status_active=1 and c.status_active=1  order by b.id";
				$cov_stripe_data = sql_select($sql_cov_stripe);
				foreach ($cov_stripe_data as $row) {

					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['unit_charge'][$row[csf('did')]] = $row[csf('unit_charge')];
				}
				$color_name_arr = return_library_array("select id,color_name from lib_color where status_active=1 and is_deleted=0", 'id', 'color_name');
				$sql_stripe = "SELECT c.id,c.composition,c.construction,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,sum(b.grey_fab_qnty) as fab_qty,b.dia_width,d.color_number_id as color_number_id,d.id as did,d.stripe_color,d.fabreqtotkg as fabreqtotkg ,d.measurement as measurement ,d.yarn_dyed,d.uom,avg(b.rate) as  rate from wo_booking_dtls b, wo_pre_cost_fabric_cost_dtls c,wo_pre_stripe_color d where c.id=b.pre_cost_fabric_cost_dtls_id and c.job_no=b.job_no and d.pre_cost_fabric_cost_dtls_id=c.id and d.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and b.job_no=d.job_no and b.job_no='$job_no'  and d.job_no='$job_no'   and c.color_type_id in (2,3,4,6,32,33,34)  and b.status_active=1  and c.is_deleted=0 and c.status_active=1  and d.is_deleted=0 and d.status_active=1  and 	b.is_deleted=0  group by c.id,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,d.color_number_id,d.id,d.stripe_color,d.yarn_dyed,d.fabreqtotkg ,d.measurement,d.uom,c.composition,c.construction,b.dia_width order by d.id ";
				//echo $sql_stripe; die;
				$result_data = sql_select($sql_stripe);
				foreach ($result_data as $row) {
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['stripe_color'][$row[csf('did')]] = $row[csf('stripe_color')];
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['measurement'][$row[csf('did')]] = $row[csf('measurement')];
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['uom'][$row[csf('did')]] = $row[csf('uom')];
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['fabreqtotkg'][$row[csf('did')]] = $row[csf('fabreqtotkg')];
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['rate'][$row[csf('did')]] = $row[csf('rate')];
					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['yarn_dyed'][$row[csf('did')]] = $row[csf('yarn_dyed')];

					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['composition'] = $row[csf('composition')];
					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['construction'] = $row[csf('construction')];
					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['gsm_weight'] = $row[csf('gsm_weight')];
					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['color_type_id'] = $row[csf('color_type_id')];
					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['dia_width'] = $row[csf('dia_width')];
					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['fabreqtotkg'] += $row[csf('fabreqtotkg')];
				}
				if (count($stripe_arr) > 0) {
				?>
						<tr>
        		            <td align="center" colspan="10">  Stripe Details</td>
        		            
    		            </tr>
        		            <tr>
	        		            <td align="center" width="30"> SL</td>
	        		            <td align="center" width="100"> Body Part</td>
	        		            <td align="center" width="80"> Fabric Color</td>
	        		            <td align="center" width="70"> Fabric Qty(KG)</td>
	        		            <td align="center" width="70"> Stripe Color</td>
	        		            <td align="center" width="70"> Stripe Measurement</td>
	        		            <td align="center" width="70"> Stripe Uom</td>
                                <td  align="center" width="70"> Total Feeder</td>
	        		            <td  align="center" width="70"> Qty.(KG)</td>
	        		            <td  align="center" width="70"> Y/D Req.</td>
        		            </tr>
        		            <?
							$color_wise_qty=sql_select("SELECT  a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,d.gmts_color_id,(d.fin_fab_qnty) as fin_fab_qnty,(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d WHERE a.job_id=b.job_id and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_id=a.job_id and c.id=b.color_size_table_id and b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id  and b.job_no='$job_no' and c.job_no_mst='$job_no' and d.job_no='$job_no' and d.status_active=1 and d.is_deleted=0 ");
							$tot_color_qty=0;
							foreach($color_wise_qty as $row)
							{
								$data_str=$row[csf('body_part_id')].$row[csf('color_type_id')].$row[csf('gmts_color_id')];
								if($stripe_yarn_dtls_vari==1) //Grey
								{
									$tot_color_qtyArr[$data_str]+=$row[csf('grey_fab_qnty')];
								}
								else 
								{
									$tot_color_qtyArr[$data_str]+=$row[csf('fin_fab_qnty')];
								}
							}
							unset($color_wise_qty);
										
        					$i=1;$total_fab_qty=0;$total_fabreqtotkg=$total_totfidder=0;$fab_data_array=array();$qnty=0;
        		            foreach($stripe_arr as $body_id=>$body_data)
        		            {
        						foreach($body_data as $color_id=>$color_val)
        						{

        							$rowspan=count($color_val['stripe_color']);
        							$composition=$stripe_arr2[$body_id][$color_id]['composition'];
        							$construction=$stripe_arr2[$body_id][$color_id]['construction'];
        							$gsm_weight=$stripe_arr2[$body_id][$color_id]['gsm_weight'];
        							$color_type_id=$stripe_arr2[$body_id][$color_id]['color_type_id'];
        							$dia_width=$stripe_arr2[$body_id][$color_id]['dia_width'];
									$subtotal_measurement=array_sum($color_val['subtotal_measurement']);
									$subtotal_totfidder=array_sum($color_val['totfidder']);
									

        							
        							$sk=0;
    								foreach($color_val['stripe_color'] as $strip_color_id=>$s_color_val)
        							{
        								
        								?>
	        							<tr>
		        							<?
		        							if($sk==0)
		        							{

												$data_str=$body_id.$color_type_id.$color_id;
			        							$color_qty=$tot_color_qtyArr[$data_str];
			        							//$color_qty=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
												if($subtotal_measurement>0){
													$measurement_qnty=$color_qty/$subtotal_measurement;
												}

												if($subtotal_totfidder>0){
													$fidder_qnty=$color_qty/$subtotal_totfidder;
												}
												
			        							?>
			        							<td rowspan="<? echo $rowspan;?>"> <? echo $i; ?></td>
			        							<td rowspan="<? echo $rowspan;?>"> <? echo $body_part[$body_id]; ?></td>
			        							<td rowspan="<? echo $rowspan;?>"> <? echo $color_name_arr[$color_id]; ?></td>
			        							<td rowspan="<? echo $rowspan;?>" align="right"><? echo number_format($color_qty,2); ?>&nbsp; </td>
			        							<?
			        							$total_fab_qty+=$color_qty;
											
			        							$i++;
			        						}
		        							$sk=0;
		        							

		        								$measurement=$color_val['measurement'][$strip_color_id];
												$totfidder=$color_val['totfidder'][$strip_color_id];
		        								$uom=$color_val['uom'][$strip_color_id];
		        								$fabreqtotkg=$color_val['fabreqtotkg'][$strip_color_id];
		        								$yarn_dyed=$color_val['yarn_dyed'][$strip_color_id];
												$qnty_kg=0;
												if($measurement>0){
													$qnty_kg+=$measurement_qnty*$measurement;
												}
												if($totfidder>0){
													$qnty_kg+=$fidder_qnty*$totfidder;
												}
												$qnty_kg=0;
												$qnty_kg=$fabreqtotkg;
												
		        								//echo __LINE__.'--'.$qnty.'--'.$measurement.'<br>';
		        								?>
		        							
			        								<td><?  echo  $color_name_arr[$s_color_val]; ?></td>
			        								<td align="right"> <? echo  number_format($measurement,2); ?> &nbsp; </td>
			        		                        <td> <? echo  $unit_of_measurement[$uom]; ?></td>
                                                      <td align="right"> <? echo  number_format($totfidder,2); ?> &nbsp;</td>
			        								<td align="right"><? echo  number_format($qnty_kg,2); ?> &nbsp;</td>
                                                  
			        								<td> <? echo  $yes_no[$yarn_dyed]; ?></td>
		        								
		        								<?
		        								
		        								$sk++;
		        								$total_fabreqtotkg+=$qnty_kg;
												$total_totfidder+=$totfidder;
		        								$stripe_color_wise[$color_name_arr[$s_color_val]]+=$qnty_kg;
		        								$color_sub_tot[$body_id][$color_id]['fab_qnty']+=$qnty_kg;
		        							
											
		        							?>
	        							</tr>
	        							<?
	        						}
									?>
								  <tr>
			        		            <td colspan="4">&nbsp; </td>
			        		            <td align="center" colspan="4"><b> Sub Total </b></td>
			        		            <td align="right"><b><? echo  number_format($color_sub_tot[$body_id][$color_id]['fab_qnty'],2); ?></b> &nbsp;</td>
			        		        </tr>

							<? }  
        						}?>
	        		            <tfoot>
		        		            <tr>
			        		            <td colspan="3">Total </td>
			        		            <td align="right">  <? echo  number_format($total_fab_qty,2); ?> &nbsp;</td>
			        		            <td></td>
			        		            <td></td>
                                       
			        		            <td>   </td>
                                          <td  align="right"><? echo  number_format($total_totfidder,2); ?></td>
			        		            <td align="right"><? echo  number_format($total_fabreqtotkg,2); ?> &nbsp;</td>
			        		        </tr>
	        		            </tfoot>
        		            </table>
        	</td>
        	
        	<td width="20%" >
        		        <table  class="rpt_table" border="1" cellpadding="1" cellspacing="1" rules="all" width="100%"   style="font-family:Arial Narrow;font-size:18px;margin: 0px;padding: 0px;"  >
        		       

        		        <tr>
        		            <td align="left" colspan="3"> Stripe  Color wise Summary</td>
    		            </tr>
        		        <?
        				?>
        		            <tr>
	        		            <td width="30"> SL</td>
	        		            <td width="70"> Stripe Color</td>
	        		            <td  width="70"> Qty.(KG)</td>
        		            </tr>
        		            <?

        					$i=1;$total_stripe_qnt=0;        		            
        						foreach($stripe_color_wise as $color=>$val)
        						{
        							
        							
        							?>
        							<tr>
	        							<td> <? echo $i; ?></td>
	        							
	        							<td > <? echo $color; ?></td>
	        							<td align="right"> <?php echo number_format($val,2); ?></td>
	        						</tr>
        							
        							<?
        							$total_stripe_qnt+=$val;
        							
        							$i++;
        						}
        					
        					?>
        		            <tfoot>
        		            <tr>
        		            
        		            <td></td>
        		            <td></td>
        		            
        		            <td align="right"><? echo  number_format($total_stripe_qnt,2); ?> </td>
        		            </tr>
        		            </tfoot>

        		            </table>
							<? } ?>
        	</td>
        </tr>
         </table >
        <br><br>
        <div ><? echo signature_table(109, $cbo_company_name, "1400px",'',70,$inserted_by2); ?></div>
		<br>	    
       </div>
       <?
	$emailBody=ob_get_contents();
	if($is_mail_send==1){
		$sql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=87 and b.mail_user_setup_id=c.id and a.company_id =$cbo_company_name";
		$mail_sql_res=sql_select($sql);
		
		$mailArr=array();
		foreach($mail_sql_res as $row)
		{
			$mailArr[$row[EMAIL]]=$row[EMAIL]; 
		}
		
		$supplier_id=$nameArray[0][csf('supplier_id')];
		$supplier_mail=return_field_value("email", "lib_supplier", "status_active=1 and is_deleted=0 and id=$supplier_id ");

		
		$mailArr=array();
		if($mail_id!=''){$mailArr[]=$mail_id;}
		if($supplier_mail_arr[$supplier_id]!=''){$mailArr[]=$supplier_mail;}
		
		$to=implode(',',$mailArr);
		$subject="Fabric Booking Auto Mail";
		
		if($to!=""){
			require '../../../vendor/phpmailer/phpmailer/PHPMailerAutoload.php';
			require_once('../../../auto_mail/setting/mail_setting.php');
			$header=mailHeader();
			sendMailMailer( $to, $subject, $emailBody );
		}
	}
	exit();
}

if($action=="report_part2_select_view")
{
	extract($_REQUEST);
	echo load_html_head_contents("Popup Info","../../../", '', '', $unicode);
	?>
    <script>
		var selected_id = new Array;
		var selected_name = new Array;
		var selected_no = new Array;
    	function check_all_data()
		{
			//var tbl_row_count = document.getElementById( 'list_view' ).rows.length;
			var tbl_row_count = $('#list_view tbody tr').length;
			var onclickString=paramArr=functionParam="";
			for( var i = 1; i <= tbl_row_count; i++ )
			{
				onclickString = $('#tr_' + i).attr('onclick');
				paramArr = onclickString.split("'");
				functionParam = paramArr[1];
				js_set_value( functionParam );
			}
		}
		function toggle( x, origColor ) {
			var newColor = 'yellow';
			if ( x.style ) {
				x.style.backgroundColor = ( newColor == x.style.backgroundColor )? origColor : newColor;
			}
		}
		function js_set_value( strCon )
		{
			//alert(strCon);
				var splitSTR = strCon.split("_");
				var str_or = splitSTR[0];
				var selectID = splitSTR[1];
				var selectDESC = splitSTR[2];
				//$('#txt_individual_id' + str).val(splitSTR[1]);
				//$('#txt_individual' + str).val('"'+splitSTR[2]+'"');
				toggle( document.getElementById( 'tr_' + str_or ), '#FFFFCC' );
				if( jQuery.inArray( str_or, selected_no ) == -1 ) {
					selected_id.push( selectID );
					selected_name.push( selectDESC );
					selected_no.push( str_or );
				}
				else {
					for( var i = 0; i < selected_id.length; i++ ) {
						if( selected_id[i] == selectID ) break;
					}
					selected_id.splice( i, 1 );
					selected_name.splice( i, 1 );
					selected_no.splice( i, 1 );
				}
				var id = ''; var name = ''; var job = ''; var num='';
				for( var i = 0; i < selected_id.length; i++ ) {
					id += selected_id[i] + ',';
					name += selected_name[i] + ',';
					num += selected_no[i] + ',';
				}
				id 		= id.substr( 0, id.length - 1 );
				name 	= name.substr( 0, name.length - 1 );
				num 	= num.substr( 0, num.length - 1 );
				//alert(num);
				$('#txt_selected_id').val( id );
				$('#txt_selected').val( name );
				$('#txt_selected_no').val( num );
		}
		function frm_close()
		{
			parent.emailwindow.hide();
		}
    </script>
    <?
	$select_rpt_option_arr=array(1=>"Master work order for Knitting ",2=>"Master work order for Dyeing",3=>"Master Work Order for Print",4=>"Master Work Order for Embroidery",5=>"Master Work Order for Wash",6=>"Master work order for Garments",7=>"Master work order for Yarn Dyeing ",8=>"Master Booking For All Over Print");
	//echo $sql;die;
	?>
    <div>
    <table width="100%" cellpadding="0" cellspacing="0" class="rpt_table" border="1" rules="all" id="list_view" align="left">
    	<thead>
        	<tr>
                <th width="50">Sl</th>
                <th>Report Option</th>
            </tr>
        </thead>
        <tbody>
			<?
            $i=1;
            foreach($select_rpt_option_arr as $id=>$val)
            {
                if ($i%2==0)
                $bgcolor="#E9F3FF";
                else
                $bgcolor="#FFFFFF";
                ?>
                <tr bgcolor="<? echo $bgcolor; ?>" id="tr_<? echo $i; ?>" onClick="js_set_value('<? echo $i."_".$id."_".$val; ?>')" style="cursor:pointer">
                    <td width="50"  align="center"><? echo $i; ?></td>
                    <td><? echo $val; ?></td>
                </tr>
                <?
                $i++;
            }
            ?>
            <tr>
                <td  style="vertical-align:middle; padding-left:20px;" colspan="2"><input type="checkbox" id="all_check" onClick="check_all_data('all_check')" />&nbsp;Check All / Un-Check All
                <input type='hidden' id='txt_selected_id' />
                <input type='hidden' id='txt_selected' />
                <input type='hidden' id='txt_selected_no' />
                </td>
            </tr>
        </tbody>
    </table>
    <br>
    <div style="width:100%"><p align="center"><input type="button" id="btn_close" class="formbutton" style="width:100px;" value="Close" onClick="frm_close();" ></p></div>
    </div>
    <script language="javascript" type="text/javascript">
	var category_no='<? echo $print_option_no;?>';
	var category_id='<? echo $print_option_id;?>';
	var category_des='<? echo $print_option;?>';
	var cate_ref="";
	if(category_no!="")
	{
		category_no_arr=category_no.split(",");
		category_id_arr=category_id.split(",");
		category_des_arr=category_des.split(",");
		var str_ref="";
		for(var k=0;k<category_no_arr.length; k++)
		{
			cate_ref=category_no_arr[k]+'_'+category_id_arr[k]+'_'+category_des_arr[k];
			js_set_value(cate_ref);
		}
	}
	</script>
    <?
	exit();
}

if($action=="masterWO")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	$presentation_type=str_replace("'","",$presentation_type);
	if($txt_job_no=="") $job_no=''; else $job_no=" and a.job_no=".$txt_job_no."";
	    $txt_costingd=change_date_format(str_replace("'","",$txt_costing_date),'yyyy-mm-dd','-');
		if($db_type==0)
		{
			$costing_dateP=change_date_format($txt_costingd, "yyyy-mm-dd", "-");
		}
		if($db_type==2)
		{
			$costing_dateP=change_date_format($txt_costingd, "yyyy-mm-dd", "-");
		}
	if($cbo_company_name=="") $company_name=''; else $company_name=" and a.company_name=".$cbo_company_name."";
	if($cbo_buyer_name=="") $cbo_buyer_name=''; else $cbo_buyer_name=" and a.buyer_name=".$cbo_buyer_name."";
	if($txt_style_ref=="") $txt_style_ref=''; else $txt_style_ref=" and a.style_ref_no=".$txt_style_ref."";
	if($txt_costing_date=="") $txt_costing_date_cond=''; else $txt_costing_date_cond=" and b.costing_date='".$txt_costing_date."'";
	//array for display name
	 $buyer_arr=return_library_array( "select id, buyer_name from lib_buyer",'id','buyer_name');
	 $comp=return_library_array( "select id, company_name from lib_company",'id','company_name');
	 $color_library=return_library_array( "select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	 $brand_name_arr=return_library_array( "select id, brand_name from lib_buyer_brand ",'id','brand_name');
	 $size_library=return_library_array( "select id,size_name from lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	 //====================
	 $cm_cost_method_based_on=return_field_value("cm_cost_method_based_on", "variable_order_tracking", "company_name=$cbo_company_name  and variable_list=22 and status_active=1 and is_deleted=0");
	if($cm_cost_method_based_on=="")
	{
		$cm_cost_method_based_on=1;
	}
	$costing_date="";
	if($cm_cost_method_based_on==1){
		$txt_costing_date=change_date_format(str_replace("'","",$txt_costing_date),'yyyy-mm-dd','-');
		if($db_type==0)
		{
			$costing_date=change_date_format($txt_costing_date, "yyyy-mm-dd", "-");
			$costing_dateP=change_date_format($txt_costing_date, "yyyy-mm-dd", "-");
		}
		if($db_type==2)
		{
			$costing_date=change_date_format($txt_costing_date, "yyyy-mm-dd", "-",1);
			$costing_dateP=change_date_format($txt_costing_date);
		}
	}
	if($cm_cost_method_based_on==2){
		$min_shipment_sql=sql_select("select job_no_mst, min(shipment_date) as min_shipment_date from wo_po_break_down where job_no_mst=$txt_job_no and status_active=1 and is_deleted=0 group by job_no_mst");
		$min_shipment_date="";
		foreach($min_shipment_sql as $row){
			$min_shipment_date=$row[csf('min_shipment_date')];
		}
		if($db_type==0)
		{
		   $costing_date=change_date_format($min_shipment_date, "yyyy-mm-dd", "-");
		}
		if($db_type==2)
		{
			$costing_date=change_date_format($min_shipment_date, "yyyy-mm-dd", "-",1)	;
		}
	}
	if($cm_cost_method_based_on==3){
		$max_shipment_sql=sql_select("select job_no_mst, max(shipment_date) as max_shipment_date from wo_po_break_down where job_no_mst=$txt_job_no and status_active=1 and is_deleted=0 group by job_no_mst");
		$max_shipment_date="";
		foreach($max_shipment_sql as $row){
			$max_shipment_date=$row[csf('max_shipment_date')];
		}
		if($db_type==0)
		{
		   $costing_date=change_date_format($max_shipment_date, "yyyy-mm-dd", "-");
		}
		if($db_type==2)
		{
			$costing_date=change_date_format($max_shipment_date, "yyyy-mm-dd", "-",1)	;
		}
	}
	if($cm_cost_method_based_on==4){
		$max_shipment_sql=sql_select("select job_no_mst, min(pub_shipment_date) as min_pub_shipment_date from wo_po_break_down where job_no_mst=$txt_job_no and status_active=1 and is_deleted=0 group by job_no_mst");
		$min_pub_shipment_date="";
		foreach($max_shipment_sql as $row){
			$min_pub_shipment_date=$row[csf('min_pub_shipment_date')];
		}
		if($db_type==0)
		{
		   $costing_date=change_date_format($min_pub_shipment_date, "yyyy-mm-dd", "-");
		}
		if($db_type==2)
		{
			$costing_date=change_date_format($min_pub_shipment_date, "yyyy-mm-dd", "-",1)	;
		}
	}
	if($cm_cost_method_based_on==5){
		$max_shipment_sql=sql_select("select job_no_mst, max(pub_shipment_date) as max_pub_shipment_date from wo_po_break_down where job_no_mst=$txt_job_no and status_active=1 and is_deleted=0 group by job_no_mst");
		$max_pub_shipment_date="";
		foreach($max_shipment_sql as $row){
			$max_pub_shipment_date=$row[csf('max_pub_shipment_date')];
		}
		if($db_type==0)
		{
		   $costing_date=change_date_format($max_pub_shipment_date, "yyyy-mm-dd", "-");
		}
		if($db_type==2)
		{
			$costing_date=change_date_format($max_pub_shipment_date, "yyyy-mm-dd", "-",1)	;
		}
	}
	 //================
	 if($db_type==0)
	{
		$sqlcpm=sql_select("select interest_expense,cost_per_minute from lib_standard_cm_entry where company_id=$cbo_company_name and '$costing_date' between applying_period_date and applying_period_to_date  and status_active=1 and is_deleted=0 LIMIT 1");
	}
	if($db_type==2)
	{
		 $sqlcpm=sql_select("select interest_expense,cost_per_minute from lib_standard_cm_entry where company_id=$cbo_company_name and '$costing_date' between applying_period_date and applying_period_to_date and status_active=1 and is_deleted=0");
	}
	$cpm='';$interest_expense='';
	foreach($sqlcpm as $sqlcpmrow)
	{
		$cpm=$sqlcpmrow[csf('cost_per_minute')];
		$interest_expense=$sqlcpmrow[csf('interest_expense')];
	}
	 $gsm_weight_top=return_field_value("gsm_weight", "wo_pre_cost_fabric_cost_dtls", "job_no=$txt_job_no and body_part_id=1");
	 $gsm_weight_bottom=return_field_value("gsm_weight", "wo_pre_cost_fabric_cost_dtls", "job_no=$txt_job_no and body_part_id=20");
	 $po_qty=0;
	 $po_plun_cut_qty=0;
	 $total_set_qnty=0;
	 $sql_po="select a.job_no,a.total_set_qnty,b.id,c.item_number_id,c.country_id,c.color_number_id,c.size_number_id,c.order_quantity ,c.plan_cut_qnty  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst   and b.id=c.po_break_down_id  and a.job_no =".$txt_job_no."   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 order by b.id";
	$sql_po_data=sql_select($sql_po);
	foreach($sql_po_data as $sql_po_row)
	{
	$po_qty+=$sql_po_row[csf('order_quantity')];
	$po_plun_cut_qty+=$sql_po_row[csf('plan_cut_qnty')];
	$total_set_qnty=$sql_po_row[csf('total_set_qnty')];
	}
	$fab_knit_req_kg_avg=0;
	$fab_woven_req_yds_avg=0;
	$sql = "select a.job_no,a.company_name,a.buyer_name,a.style_ref_no,a.gmts_item_id,a.order_uom,a.job_quantity,a.avg_unit_price,a.brand_id,b.costing_per,b.budget_minute,b.approved,b.inserted_by,b.sew_smv,b.sew_effi_percent,b.incoterm,b.exchange_rate,c.fab_knit_req_kg,c.fab_knit_fin_req_kg,c.fab_woven_req_yds,c.fab_woven_fin_req_yds,c.fab_yarn_req_kg from wo_po_details_master a, wo_pre_cost_mst b left join wo_pre_cost_sum_dtls c on   b.job_no=c.job_no where a.job_no=b.job_no and a.status_active=1 $job_no $company_name $cbo_buyer_name $txt_style_ref order by a.job_no";
	
	$data_array=sql_select($sql);
	//echo $print_option_id;die;
	//image----
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1 and master_tble_id='$cbo_company_name'",'master_tble_id','image_location');
    $image_location=return_field_value("image_location","common_photo_library","master_tble_id=".$txt_job_no."");
	ob_start();//part 0;
	if($presentation_type==2)
		$path="../../../";
	else
		$path="../../";
	?>
	<?
	$uom="";
	foreach ($data_array as $row)
	{
		$order_price_per_dzn=0;
		$order_job_qnty=0;
		$avg_unit_price=0;
		$order_values = $row[csf("job_quantity")]*$row[csf("avg_unit_price")];
		$result =sql_select("select po_number,grouping,file_no,pub_shipment_date from wo_po_break_down where job_no_mst=$txt_job_no and status_active=1 and is_deleted=0 order by pub_shipment_date DESC");
		$job_in_orders = '';$pulich_ship_date='';$job_in_file = '';$job_in_ref = '';
		foreach ($result as $val)
		{
			$job_in_orders .= $val[csf('po_number')].", ";
			$pulich_ship_date = $val[csf('pub_shipment_date')];
			$job_in_ref.=$val[csf('grouping')].",";
			$job_in_file.=$val[csf('file_no')].",";
		}
		$job_in_orders = substr(trim($job_in_orders),0,-1);
		$brandName=$brand_name_arr[$row[csf('brand_id')]];
		$job_ref=array_unique(explode(",",rtrim($job_in_ref,", ")));
		$job_file=array_unique(explode(",",rtrim($job_in_file,", ")));
		$jobNo=$row[csf("job_no")];
		$buyerName=$buyer_arr[$row[csf("buyer_name")]];
		$styleName=$row[csf("style_ref_no")];
		foreach ($job_ref as $ref)
		{
			$ref_cond.=", ".$ref;
		}
		$file_con='';
		foreach ($job_file as $file)
		{
			if($file_con=='') $file_cond=$file; else $file_cond.=", ".$file;
		}
			if($row[csf("costing_per")]==1){$order_price_per_dzn=12;$costing_for=" DZN";}
			else if($row[csf("costing_per")]==2){$order_price_per_dzn=1;$costing_for=" PCS";}
			else if($row[csf("costing_per")]==3){$order_price_per_dzn=24;$costing_for=" 2 DZN";}
			else if($row[csf("costing_per")]==4){$order_price_per_dzn=36;$costing_for=" 3 DZN";}
			else if($row[csf("costing_per")]==5){$order_price_per_dzn=48;$costing_for=" 4 DZN";}
			$order_job_qnty=$row[csf("job_quantity")];
			$avg_unit_price=$row[csf("avg_unit_price")];
	}//end first foearch

	$condition= new condition();
	if(str_replace("'","",$txt_job_no) !=''){
		$condition->job_no("=$txt_job_no");
	}
	if(str_replace("'",'',$txt_po_breack_down_id) !=""){
		$condition->po_id("in($txt_po_breack_down_id)");
	}
	$condition->init();
	$conversion= new conversion($condition);
	$emblishment= new emblishment($condition);
	$wash= new wash($condition);

	$part[0]=ob_get_contents();ob_end_clean();ob_start();//part 1;	
	$conv_qty_arr=$conversion->getQtyArray_by_conversionid();
	$conv_amount_arr=$conversion->getAmountArray_by_conversionid();
	//start	Knit -------------------------------------------
	$dia_arr=array();
	$sql_dia= "select pre_cost_fabric_cost_dtls_id, dia_width from  wo_pre_cos_fab_co_avg_con_dtls  where job_no=".$txt_job_no."";
	$data_dia_arr=sql_select($sql_dia);
	foreach( $data_dia_arr as $row )
	{
		$dia_arr[$row[csf("pre_cost_fabric_cost_dtls_id")]].=$row[csf("dia_width")].',';
	}
	unset($data_dia_arr);
	$knitSql = "select a.id,a.fabric_description as fabric_description_id,b.uom,b.gsm_weight, a.job_no,a.cons_process, a.req_qnty,a.avg_req_qnty, a.charge_unit, a.amount, a.status_active,b.body_part_id,b.fab_nature_id,b.color_type_id,b.fabric_description from wo_pre_cost_fab_conv_cost_dtls a left join wo_pre_cost_fabric_cost_dtls b on a.job_no=b.job_no and a.fabric_description=b.id and b.status_active=1 where a.job_no=".$txt_job_no." and a.cons_process=1 and a.status_active=1 ";
	$knidata_array=sql_select($knitSql);
	$knitconData=array();
	$totPro=array();
	foreach($knidata_array as $rows){
		$convQty=$conv_qty_arr[$rows[csf('id')]][$rows[csf('uom')]];
		$convAmt=$conv_amount_arr[$rows[csf('id')]][$rows[csf('uom')]];
		$knitconData[1][$rows[csf('id')]]['FABRIC_DESCRIPTION_ID']=$rows[csf('fabric_description_id')];
		$knitconData[1][$rows[csf('id')]]['CONS_PROCESS']=$rows[csf('cons_process')];
		$knitconData[1][$rows[csf('id')]]['REQ_QNTY']=$convQty;
		$knitconData[1][$rows[csf('id')]]['CHARGE_UNIT']=$rows[csf('charge_unit')];
		$knitconData[1][$rows[csf('id')]]['AMOUNT']=$convAmt;
		$knitconData[1][$rows[csf('id')]]['BODY_PART_ID']=$rows[csf('body_part_id')];
		$knitconData[1][$rows[csf('id')]]['COLOR_TYPE_ID']=$rows[csf('color_type_id')];
		$knitconData[1][$rows[csf('id')]]['FABRIC_DESCRIPTION']=$rows[csf('fabric_description')];
		$knitconData[1][$rows[csf('id')]]['UOM']=$rows[csf('uom')];
		$knitconData[1][$rows[csf('id')]]['GSM_WEIGHT']=$rows[csf('gsm_weight')];
		$knitconData[1][$rows[csf('id')]]['DIA_WIDTH']=$dia_arr[$rows[csf('fabric_description_id')]];
	}
	if(count($knidata_array)>0){
	if($zero_value==1)
	{
	?>
        <div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
		<th>
		Master work order for Knitting
		</th>
		</table>
		<table width="850" style="border:1px solid black; margin-top:1px;font-family:Arial Narrow; font-size:16px" >
			<tr>
				<td width="130">Job No.</td><td width="140">:<b><? echo $jobNo; ?></b></td>
				<td width="130">Style Ref. No</td><td width="140">:<b><? echo $styleName; ?></b></td>
				<td width="130">Order No.</td><td width="140">:<b><? echo $job_in_orders; ?></b></td>
            	<td width="130">Buyer</td><td width="140">:<b><? echo $buyerName;?></b></td>
			</tr>
		</table>
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                <tr style="font-weight:bold">
                    <td width="80">Sequence no.</td>
                    <td width="100">Service Type</td>
                    <td width="150">Item Description</td>
                    <td width="100">GSM</td>
                    <td width="100">Dia</td>
                    <td width="100">UOM</td>
                    <td width="100">WO Qty</td>
					<td width="100">Rate</td>
					<td width="100">Amount</td>
                </tr>
            <?
			$i=1;
            $total_amount=0;
			$total_req_qnty=0;
            foreach( $knitconData as $processId=>$idArr )
            {
				foreach( $idArr as $id=>$row )
				{
				if($row[csf("fabric_description_id")] !=0)
				{
					$item_descrition = $body_part[$row[csf("body_part_id")]].", ".$color_type[$row[csf("color_type_id")]].", ".$row[csf("fabric_description")];
				}
				else
				{
					$item_descrition = "All Fabrics";
				}
				?>
					<tr>
						<td align="center"><? echo $i;?></td>
						<td align="center"><? echo $conversion_cost_head_array[$row[csf("cons_process")]]; ?></td>
						<td align="center"><? echo $item_descrition; ?></td>
						<td align="center"><? echo $row[csf("gsm_weight")]; ?></td>
						<td align="center"><? echo implode(",",array_unique(explode(",",chop($row[csf("dia_width")], ","))));; ?></td>
						<td align="center"><? echo $unit_of_measurement[$row[csf("uom")]]; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("req_qnty")],4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("charge_unit")],4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")],2); ?></td>
					</tr>
				<?
					 $total_amount += $row[csf("amount")];
					 $total_req_qnty+= $row[csf("req_qnty")];
					 $i++;
				}
				
			}
            ?>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td align="left" colspan="6">Total</td>
                    <td align="right"><? echo fn_number_format($total_req_qnty,2); ?></td>
					<td></td>
                    <td align="right"><? echo fn_number_format($total_amount,2); ?></td>
                </tr>
            </table>
      </div>
      <?
	}
	else
	{
	?>
      <div style="margin-top:15px">
	  <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
		<th>
		Master work order for Knitting
		</th>
		</table>
		<table width="850" style="border:1px solid black; margin-top:1px;font-family:Arial Narrow; font-size:16px" >
				<tr>
					<td width="130">Job No.</td><td width="140"><b><? echo $jobNo; ?></b></td>
					<td width="130">Style Ref. No</td><td width="140"><b><? echo $styleName; ?></b></td>
					<td width="130">Order No.</td><td width="140"><? echo $job_in_orders; ?></td>
					<td width="130">Buyer</td><td width="140"><b><? echo $buyerName;?></b></td>
				</tr>
			</table>
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<tr style="font-weight:bold">
                    <td width="80">Sequence no.</td>
                    <td width="100">Service Type</td>
                    <td width="150">Item Description</td>
                    <td width="100">GSM</td>
                    <td width="100">Dia</td>
                    <td width="100">UOM</td>
                    <td width="100">WO Qty</td>
					<td width="100">Rate</td>
					<td width="100">Amount</td>
                </tr>
            <?
            $total_amount=0;
			$total_req_qnty=0;
            foreach( $knitconData as $processId=>$idArr )
            {
				foreach( $idArr as $id=>$row )
				{
				if($row[csf("fabric_description_id")] !=0)
				{
					$item_descrition = $body_part[$row[csf("body_part_id")]].", ".$color_type[$row[csf("color_type_id")]].", ".$row[csf("fabric_description")];
				}
				else
				{
					$item_descrition = "All Fabrics";
				}
				?>
					<tr>
						<td align="center"><? echo $i;?></td>
						<td align="center"><? echo $conversion_cost_head_array[$row[csf("cons_process")]]; ?></td>
						<td align="center"><? echo $item_descrition; ?></td>
						<td align="center"><? echo $row[csf("gsm_weight")]; ?></td>
						<td align="center"><? echo implode(",",array_unique(explode(",",chop($row[csf("dia_width")], ","))));; ?></td>
						<td align="center"><? echo $unit_of_measurement[$row[csf("uom")]]; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("req_qnty")],4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("charge_unit")],4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")],2); ?></td>
					</tr>
				<?
					 $total_amount += $row[csf("amount")];
					 $total_req_qnty+= $row[csf("req_qnty")];
				}
				$i++;
			}
            ?>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td align="left" colspan="6">Total</td>
                    <td align="right"><? echo fn_number_format($total_req_qnty,2); ?></td>
					<td></td>
                    <td align="right"><? echo fn_number_format($total_amount,2); ?></td>
                </tr>
            </table>
      </div>
    <?
	}
	$job_info=sql_select("SELECT id, inserted_by from wo_pre_cost_mst where status_active=1 and is_deleted=0 and job_no='".str_replace("'","",$txt_job_no)."'");
	 foreach ($job_info as $row) {
		 $inserted_by=$row[csf('inserted_by')];
		 $job_id=$row[csf('id')];
	 }
	$signature_arr=return_library_array( "select master_tble_id,image_location from common_photo_library where form_name='user_signature'",'master_tble_id','image_location');
	 $appSql="select approved_by from approval_history where entry_form=15 and mst_id = $job_id";
	 $appSqlRes=sql_select($appSql);
	 foreach($appSqlRes as $row){
		 $userSignatureArr[$row[csf('approved_by')]]=$path.$signature_arr[$row[csf('approved_by')]];
	 }
	 $userSignatureArr[$inserted_by]=$path.$signature_arr[$inserted_by];
	 //echo signature_table(109, $cbo_company_name, "1200px",$cbo_template_id,50,$inserted_by,$userSignatureArr);
	 //$report_id, $company, $width, $template_id="", $padding_top = 70,$prepared_by='',$userSignatureArr=array(),$break_tr=7
	 $width="850px";
	 $report_id=109;
	 $padding_top = 50;
	 $$prepared_by=$inserted_by;
	if ($cbo_template_id != '') {
		$template_id = " and template_id=$cbo_template_id ";
	}
	$sql = sql_select("select USER_ID,designation,name,activities,prepared_by from variable_settings_signature where report_id=$report_id and company_id=$cbo_company_name   and status_active=1 $template_id order by sequence_no ");
	$user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
	if($sql[0][csf("prepared_by")]==1){
		list($prepared_by,$activities)=explode('**',$prepared_by);
		$sql_2[100] = array ( USER_ID=>$prepared_by,DESIGNATION => 'Prepared By' ,NAME => ($user_lib_name[$prepared_by])?$user_lib_name[$prepared_by]:$prepared_by, ACTIVITIES =>$activities, PREPARED_BY => 0 );
		$sql=$sql_2+$sql;
	}
	$count = count($sql);
	$td_width = floor($width / $count);
	$standard_width = $count * 150;
	if ($standard_width > $width) {
		$td_width = 150;
	}
	$no_coloumn_per_tr = floor($width / $td_width);
	$i = 1;
	if ($count == 0) {$message = "<b>Note: This is Software Generated Copy , Signature is not Required.</b>";}
	echo '<table cellspacing="5" id="signatureTblId" width="' . $width . '" style="padding-top:' . $padding_top . 'px;"><tr><td width="100%" height="' . $padding_top . '" colspan="' . $count . '">' . $message . '</td></tr>';
	$flag=0;
	foreach ($sql as $row) {
		$flag++;
		$sigHtml='';
		if($userSignatureArr[$row['USER_ID']]){$sigHtml='<img src="'.$userSignatureArr[$row['USER_ID']].'" height="60" width="180">';}
		else{$sigHtml='<div height="40"></div>';}
		if($flag==1){echo "<tr>";}
		echo '<td width="' . $td_width . '" align="center" valign="top">
		<p style="min-height:40px;">'.$sigHtml.'</p>
		<strong>' . $row[csf("activities")] . '</strong><br>
		<strong style="text-decoration:overline">' . $row[csf("designation")] . "</strong><br>" . $row[csf("name")] . '</td>';
		if($flag==$break_tr || $count==$i){echo "</tr>";$flag=0;}
		$i++;
	}
	echo '</table>';
	}?>
	<p style="page-break-after:always;"></p>
	<?
        //End Knit report here -------------------------------------------
	$part[1]=ob_get_contents();ob_end_clean();ob_start();//part 2;	
	$conv_qty_array=$conversion->getQtyArray_by_ConversionidColorAndUom();
	$conv_amount_array=$conversion->getAmountArray_by_ConversionidColorAndUom();	
	/* echo "<pre>";
	print_r($conv_amount_array); */
	//start	dying -------------------------------------------
	$dyingSql = "select a.id,a.fabric_description as fabric_description_id,b.uom,b.gsm_weight, a.job_no,a.cons_process, a.req_qnty,a.avg_req_qnty, a.charge_unit, a.amount, a.status_active,b.body_part_id,b.fab_nature_id,b.color_type_id,b.fabric_description,c.dia_width,c.color_number_id from wo_pre_cost_fab_conv_cost_dtls a left join wo_pre_cost_fabric_cost_dtls b on a.job_no=b.job_no and a.fabric_description=b.id and b.status_active=1, wo_pre_cos_fab_co_avg_con_dtls c where a.job_no=".$txt_job_no." and a.fabric_description=c.pre_cost_fabric_cost_dtls_id and a.job_id=c.job_id and a.cons_process in(25,26,31,32,33,34,38,39,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,88,89,90,91,92,93,94,100,128,29,132,133,135,136,137,138,139,140,141,142,143, 144,145,146,147,148,149,150,151,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,180,181,182,183,184,185,186,187,189,190,191,192,193, 194,195,196,197,198,199,200,201,203,205,209,210,211,212,263,219,221,224,225,227,231,232,233,234,238,239,242,245,257,258,259,260,261,265,266,267,276,281,287,298,299,300,303,304,305,306,309, 310,311,312,313,314,315,316,317,318,319,320,321,322,323,324,325,326,327,328,329,330,331,332,333,335,336,337,338,339,340,341,342,343,344,345,346,347,348,349,350,351,352,353,354,355, 356,357,358,359,360,361,362,363,364,365,366,367,368,369,370,371,372,373,374,375,376,377,378,379,380,381,382,383,385,386,387,388,390,391,394,395,396,397,398,399,400,401,402,403, 404,405,412,413,414,415,416,417,418,419,420,421,422,423,424,425,427,428,429,430,431,432,433,434,435,436,437,438,439,440,441,442,443,476,481,289,243) and a.status_active=1 ";
	$dying_data_array=sql_select($dyingSql);
	$dyingconData=array();
	foreach($dying_data_array as $rows){
		$dyeconvQty=$conv_qty_array[$rows[csf('id')]][$rows[csf('color_number_id')]][$rows[csf('uom')]];
		$dyeconvAmt=$conv_amount_array[$rows[csf('id')]][$rows[csf('color_number_id')]][$rows[csf('uom')]];
		$dyingconData[$rows[csf('cons_process')]][$rows[csf('id')]][$rows[csf('color_number_id')]]['FABRIC_DESCRIPTION_ID']=$rows[csf('fabric_description_id')];
		$dyingconData[$rows[csf('cons_process')]][$rows[csf('id')]][$rows[csf('color_number_id')]]['COLOR_NO']=$rows[csf('color_number_id')];
		$dyingconData[$rows[csf('cons_process')]][$rows[csf('id')]][$rows[csf('color_number_id')]]['CONS_PROCESS']=$rows[csf('cons_process')];
		$dyingconData[$rows[csf('cons_process')]][$rows[csf('id')]][$rows[csf('color_number_id')]]['REQ_QNTY']=$dyeconvQty;
		$dyingconData[$rows[csf('cons_process')]][$rows[csf('id')]][$rows[csf('color_number_id')]]['AVG_REQ_QNTY']=$rows[csf('avg_req_qnty')];
		$dyingconData[$rows[csf('cons_process')]][$rows[csf('id')]][$rows[csf('color_number_id')]]['CHARGE_UNIT']=$rows[csf('charge_unit')];
		$dyingconData[$rows[csf('cons_process')]][$rows[csf('id')]][$rows[csf('color_number_id')]]['AMOUNT']=$dyeconvAmt;
		$dyingconData[$rows[csf('cons_process')]][$rows[csf('id')]][$rows[csf('color_number_id')]]['STATUS_ACTIVE']=$rows[csf('status_active')];
		$dyingconData[$rows[csf('cons_process')]][$rows[csf('id')]][$rows[csf('color_number_id')]]['BODY_PART_ID']=$rows[csf('body_part_id')];
		$dyingconData[$rows[csf('cons_process')]][$rows[csf('id')]][$rows[csf('color_number_id')]]['FAB_NATURE_ID']=$rows[csf('fab_nature_id')];
		$dyingconData[$rows[csf('cons_process')]][$rows[csf('id')]][$rows[csf('color_number_id')]]['COLOR_TYPE_ID']=$rows[csf('color_type_id')];
		$dyingconData[$rows[csf('cons_process')]][$rows[csf('id')]][$rows[csf('color_number_id')]]['FABRIC_DESCRIPTION']=$rows[csf('fabric_description')];
		$dyingconData[$rows[csf('cons_process')]][$rows[csf('id')]][$rows[csf('color_number_id')]]['UOM']=$rows[csf('uom')];
		$dyingconData[$rows[csf('cons_process')]][$rows[csf('id')]][$rows[csf('color_number_id')]]['GSM_WEIGHT']=$rows[csf('gsm_weight')];
		$dyingconData[$rows[csf('cons_process')]][$rows[csf('id')]][$rows[csf('color_number_id')]]['DIA_WIDTH'].=$rows[csf('dia_width')].',';
	}
	 /* echo '<pre>';
	print_r($dyingconData);die; */
	if(count($dying_data_array)>0){
	if($zero_value==1)
	{
	?>
        <div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
		<th>
		Master work order for Dyeing
		</th>
		</table>
		<table width="850" style="border:1px solid black; margin-top:1px;font-family:Arial Narrow; font-size:16px" >
			<tr>
				<td width="130">Job No.</td><td width="140"><b><? echo $jobNo; ?></b></td>
				<td width="130">Style Ref. No</td><td width="140"><b><? echo $styleName; ?></b></td>
				<td width="130">Order No.</td><td width="140"><b><? echo $job_in_orders; ?></b></td>
            	<td width="130">Buyer</td><td width="140"><b><? echo $buyerName;?></b></td>
			</tr>
		</table>
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                <tr style="font-weight:bold">
                    <td width="80">Sequence no.</td>
                    <td width="100">Service Type</td>
					<td width="100">Color</td>
                    <td width="150">Item Description</td>
                    <td width="100">GSM</td>
                    <td width="100">Dia</td>
                    <td width="100">UOM</td>
                    <td width="100">WO Qty</td>
					<td width="100">Rate</td>
					<td width="100">Amount</td>
                </tr>
            <?
			$i=1;
            $total_amount=0;
			$total_req_qnty=0;
            foreach( $dyingconData as $processId=>$coloridArr )
            {
				foreach( $coloridArr as $colorId=>$idArr )
				{
				foreach( $idArr as $id=>$row )
				{
				if($row[csf("fabric_description_id")] !=0)
				{
					$item_descrition = $body_part[$row[csf("body_part_id")]].", ".$color_type[$row[csf("color_type_id")]].", ".$row[csf("fabric_description")];
				}
				else
				{
					$item_descrition = "All Fabrics";
				}
				?>
					<tr>
						<td align="center"><? echo $i;?></td>
						<td align="center"><? echo $conversion_cost_head_array[$row[csf("cons_process")]]; ?></td>
						<td align="center"><? echo $color_library[$id]; ?></td>
						<td align="center"><? echo $item_descrition; ?></td>
						<td align="center"><? echo $row[csf("gsm_weight")]; ?></td>
						<td align="center"><? echo implode(",",array_unique(explode(",",chop($row[csf("dia_width")], ","))));; ?></td>
						<td align="center"><? echo $unit_of_measurement[$row[csf("uom")]]; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("req_qnty")],4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")]/$row[csf("req_qnty")],4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")],2); ?></td>
					</tr>
				<?
					 $total_amount += $row[csf("amount")];
					 $total_req_qnty+= $row[csf("req_qnty")];
					 $i++;
				}
				
			}
			}
            ?>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td align="left" colspan="7">Total</td>
                    <td align="right"><? echo fn_number_format($total_req_qnty,2); ?></td>
					<td></td>
                    <td align="right"><? echo fn_number_format($total_amount,2); ?></td>
                </tr>
            </table>
      </div>
      <?
	}
	else
	{
	?>
      <div style="margin-top:15px">
	  <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
		<th>
		Master work order for  Dyeing
		</th>
		</table>
		<table width="850" style="border:1px solid black; margin-top:1px;font-family:Arial Narrow; font-size:16px" >
				<tr>
					<td width="130">Job No.</td><td width="140"><b><? echo $jobNo; ?></b></td>
					<td width="130">Style Ref. No</td><td width="140"><b><? echo $styleName; ?></b></td>
					<td width="130">Order No.</td><td width="140"><b><? echo $job_in_orders; ?></b></td>
					<td width="130">Buyer</td><td width="140"><b><? echo $buyerName;?></b></td>
				</tr>
			</table>
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<tr>
					<td width="80">Sequence no.</td>
                    <td width="100">Service Type</td>
					<td width="100">Color</td>
                    <td width="150">Item Description</td>
                    <td width="100">GSM</td>
                    <td width="100">Dia</td>
                    <td width="100">UOM</td>
                    <td width="100">WO Qty</td>
					<td width="100">Rate</td>
					<td width="100">Amount</td>
				</tr>
            <?
            $total_amount=0;
			$total_req_qnty=0;
            foreach( $dyingconData as $processId=>$coloridArr )
            {
				foreach( $coloridArr as $colorId=>$idArr )
				{
				foreach( $idArr as $id=>$row )
				{
				if($row[csf("fabric_description_id")] !=0)
				{
					$item_descrition = $body_part[$row[csf("body_part_id")]].", ".$color_type[$row[csf("color_type_id")]].", ".$row[csf("fabric_description")];
				}
				else
				{
					$item_descrition = "All Fabrics";
				}
				?>
					<tr>
						<td align="center"><? echo $i;?></td>
						<td align="center"><? echo $conversion_cost_head_array[$row[csf("cons_process")]]; ?></td>
						<td align="center"><? echo $color_library[$id]; ?></td>
						<td align="center"><? echo $item_descrition; ?></td>
						<td align="center"><? echo $row[csf("gsm_weight")]; ?></td>
						<td align="center"><? echo implode(",",array_unique(explode(",",chop($row[csf("dia_width")], ","))));; ?></td>
						<td align="center"><? echo $unit_of_measurement[$row[csf("uom")]]; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("req_qnty")],4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")]/$row[csf("req_qnty")],4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")],2); ?></td>
					</tr>
				<?
					 $total_amount += $row[csf("amount")];
					 $total_req_qnty+= $row[csf("req_qnty")];
					 $i++;
				}
				
			}
			}
            ?>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td align="left" colspan="7">Total</td>
                    <td align="right"><? echo fn_number_format($total_req_qnty,2); ?></td>
					<td></td>
                    <td align="right"><? echo fn_number_format($total_amount,2); ?></td>
                </tr>
            </table>
      </div>
    <?	
	}
	$job_info=sql_select("SELECT id, inserted_by from wo_pre_cost_mst where status_active=1 and is_deleted=0 and job_no='".str_replace("'","",$txt_job_no)."'");
	 foreach ($job_info as $row) {
		 $inserted_by=$row[csf('inserted_by')];
		 $job_id=$row[csf('id')];
	 }
	$signature_arr=return_library_array( "select master_tble_id,image_location from common_photo_library where form_name='user_signature'",'master_tble_id','image_location');
	 $appSql="select approved_by from approval_history where entry_form=15 and mst_id = $job_id";
	 $appSqlRes=sql_select($appSql);
	 foreach($appSqlRes as $row){
		 $userSignatureArr[$row[csf('approved_by')]]=$path.$signature_arr[$row[csf('approved_by')]];
	 }
	 $userSignatureArr[$inserted_by]=$path.$signature_arr[$inserted_by];
	 //echo signature_table(109, $cbo_company_name, "1200px",$cbo_template_id,50,$inserted_by,$userSignatureArr);
	 //$report_id, $company, $width, $template_id="", $padding_top = 70,$prepared_by='',$userSignatureArr=array(),$break_tr=7
	 $width="850px";
	 $report_id=109;
	 $padding_top = 50;
	 $$prepared_by=$inserted_by;
	if ($cbo_template_id != '') {
		$template_id = " and template_id=$cbo_template_id ";
	}
	$sql = sql_select("select USER_ID,designation,name,activities,prepared_by from variable_settings_signature where report_id=$report_id and company_id=$cbo_company_name   and status_active=1 $template_id order by sequence_no ");
	$user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
	if($sql[0][csf("prepared_by")]==1){
		list($prepared_by,$activities)=explode('**',$prepared_by);
		$sql_2[100] = array ( USER_ID=>$prepared_by,DESIGNATION => 'Prepared By' ,NAME => ($user_lib_name[$prepared_by])?$user_lib_name[$prepared_by]:$prepared_by, ACTIVITIES =>$activities, PREPARED_BY => 0 );
		$sql=$sql_2+$sql;
	}
	$count = count($sql);
	$td_width = floor($width / $count);
	$standard_width = $count * 150;
	if ($standard_width > $width) {
		$td_width = 150;
	}
	$no_coloumn_per_tr = floor($width / $td_width);
	$i = 1;
	if ($count == 0) {$message = "<b>Note: This is Software Generated Copy , Signature is not Required.</b>";}
	echo '<table cellspacing="5" id="signatureTblId" width="' . $width . '" style="padding-top:' . $padding_top . 'px;"><tr><td width="100%" height="' . $padding_top . '" colspan="' . $count . '">' . $message . '</td></tr>';
	$flag=0;
	foreach ($sql as $row) {
		$flag++;
		$sigHtml='';
		if($userSignatureArr[$row['USER_ID']]){$sigHtml='<img src="'.$userSignatureArr[$row['USER_ID']].'" height="60" width="180">';}
		else{$sigHtml='<div height="40"></div>';}
		if($flag==1){echo "<tr>";}
		echo '<td width="' . $td_width . '" align="center" valign="top">
		<p style="min-height:40px;">'.$sigHtml.'</p>
		<strong>' . $row[csf("activities")] . '</strong><br>
		<strong style="text-decoration:overline">' . $row[csf("designation")] . "</strong><br>" . $row[csf("name")] . '</td>';
		if($flag==$break_tr || $count==$i){echo "</tr>";$flag=0;}
		$i++;
	}
	echo '</table>';
	}?>
	<p style="page-break-after:always;"></p><?
	$part[2]=ob_get_contents();ob_end_clean();ob_start();//part 3;
	/* $emblishment_qty=$emblishment->getQtyArray_by_jobEmbnameAndEmbtypeColorSize();
	$emblishment_amount=$emblishment->getAmountArray_by_jobEmbnameAndEmbtypeColorSize(); */
	$printSql = "select a.id, a.job_no, a.emb_name, a.emb_type, a.cons_dzn_gmts, b.rate, a.amount,b.color_number_id,b.size_number_id,a.body_part_id,c.order_quantity from wo_pre_cost_embe_cost_dtls a,wo_pre_cos_emb_co_avg_con_dtls b,wo_po_color_size_breakdown c where a.id=b.pre_cost_emb_cost_dtls_id and b.po_break_down_id=c.po_break_down_id and b.item_number_id=c.item_number_id and b.size_number_id=c.size_number_id and b.color_number_id=c.color_number_id and a.job_id=c.job_id and a.job_no=".$txt_job_no." and a.emb_name =1 and b.requirment>0 and a.status_active=1 and b.status_active=1 and c.status_active=1";
	$print_data_array=sql_select($printSql);
	$printconData=array();
	foreach($print_data_array as $rows){
		/* $printQty=$emblishment_qty[$rows[csf('job_no')]][1][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]];
		$printAmt=$emblishment_amount[$rows[csf('job_no')]][1][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]; */
		$printconData[1][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['EMB_TYPE']=$rows[csf('emb_type')];
		$printconData[1][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['GMTS_COLOR']=$rows[csf('color_number_id')];
		$printconData[1][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['ITEM_COLOR']=$rows[csf('color_number_id')];
		$printconData[1][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['GMTS_SIZE']=$rows[csf('size_number_id')];
		$printconData[1][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['ITEM_SIZE']=$rows[csf('size_number_id')];
		$printconData[1][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['UOM']=$rows[csf('uom')];
		$printconData[1][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['BODY_PART_ID']=$rows[csf('body_part_id')];
		$printconData[1][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['QNTY']+=$rows[csf('order_quantity')];
		$printconData[1][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['RATE']=$rows[csf('rate')];
		$printconData[1][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['AMOUNT']+=$rows[csf('rate')]*$rows[csf('order_quantity')];
	}
	if(count($print_data_array)>0){
	if($zero_value==1)
	{
	?>
		<div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
		<th>
		Master work order for Print
		</th>
		</table>
		<table width="850" style="border:1px solid black; margin-top:1px;font-family:Arial Narrow; font-size:16px" >
			<tr>
				<td width="130">Job No.</td><td width="140"><b><? echo $jobNo; ?></b></td>
				<td width="130">Style Ref. No</td><td width="140"><b><? echo $styleName; ?></b></td>
				<td width="130">Order No.</td><td width="140"><b><? echo $job_in_orders; ?></b></td>
				<td width="130">Buyer</td><td width="140"><b><? echo $buyerName;?></b></td>
			</tr>
		</table>
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<tr style="font-weight:bold">
					<td width="50">Sequence no.</td>   
					<td width="100">Print Type</td>
					<td width="100">Body Part</td>
					<td width="50">Gmts Color</td>
					<td width="50">Item Color</td>
					<td width="50">Gmts Size</td>
					<td width="50">Item Size</td>
					<td width="100">UOM</td>
					<td width="100">WO Qty</td>
					<td width="70">Rate</td>
					<td width="100">Amount</td>
				</tr>
			<?
			$i=1;
			$total_amount=0;
			$total_req_qnty=0;
			foreach( $printconData as $processId=>$processArr )
			{
				foreach( $processArr as $colorNoId=>$coloridArr )
				{
					foreach( $coloridArr as $sizeNoId=>$sizeidArr )
					{
						foreach( $sizeidArr as $id=>$row )
						{
				
						?>
							<tr>
								<td align="center"><? echo $i;?></td>
								<td align="center"><? echo $emblishment_print_type[$row[csf("emb_type")]]; ?></td>
								<td align="center"><? echo $body_part[$row[csf("body_part_id")]]; ?></td>
								<td align="center"><? echo $color_library[$row[csf("gmts_color")]]; ?></td>
								<td align="center"><? echo $color_library[$row[csf("item_color")]]; ?></td>
								<td align="center"><? echo $size_library[$row[csf("gmts_size")]]; ?></td>
								<td align="center"><? echo $size_library[$row[csf("item_size")]]; ?></td>
								<td align="center"><? //echo $size_library[$row[csf("uom")]]; ?>PCS</td>
								<td align="right"><? echo fn_number_format($row[csf("qnty")],4); ?></td>
								<td align="right"><? echo fn_number_format($row[csf("amount")]/$row[csf("qnty")],4); ?></td>
								<td align="right"><? echo fn_number_format($row[csf("amount")],2); ?></td>
							</tr>
						<?
						$total_amount += $row[csf("amount")];
						$total_req_qnty+= $row[csf("qnty")];
						$i++;
						}
					}
				}	
			}
			?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td align="left" colspan="8">Total</td>
					<td align="right"><? echo fn_number_format($total_req_qnty,2); ?></td>
					<td></td>
					<td align="right"><? echo fn_number_format($total_amount,2); ?></td>
				</tr>
			</table>
	  </div>
	  <?
	}
	else
	{
		
	?>
	  <div style="margin-top:15px">
	  <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
		<th>
		Master work order Print
		</th>
		</table>
		<table width="850" style="border:1px solid black; margin-top:1px;font-family:Arial Narrow; font-size:16px" >
				<tr>
					<td width="130">Job No.</td><td width="140"><b><? echo $jobNo; ?></b></td>
					<td width="130">Style Ref. No</td><td width="140"><b><? echo $styleName; ?></b></td>
					<td width="130">Order No.</td><td width="140"><b><? echo $job_in_orders; ?></b></td>
					<td width="130">Buyer</td><td width="140"><b><? echo $buyerName;?></b></td>
				</tr>
			</table>
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<tr style="font-weight:bold">
					<td width="50">Sequence no.</td>   
					<td width="100">Print Type</td>
					<td width="100">Body Part</td>
					<td width="50">Gmts Color</td>
					<td width="50">Item Color</td>
					<td width="50">Gmts Size</td>
					<td width="50">Item Size</td>
					<td width="100">UOM</td>
					<td width="100">WO Qty</td>
					<td width="70">Rate</td>
					<td width="100">Amount</td>
				</tr>
			<?
			$total_amount=0;
			$total_req_qnty=0;
			foreach( $printconData as $processId=>$processArr )
			{
				foreach( $processArr as $colorNoId=>$coloridArr )
				{
					foreach( $coloridArr as $sizeNoId=>$sizeidArr )
					{
						foreach( $sizeidArr as $id=>$row )
						{
				
						?>
							<tr>
								<td align="center"><? echo $i;?></td>
								<td align="center"><? echo $emblishment_print_type[$row[csf("emb_type")]]; ?></td>
								<td align="center"><? echo $body_part[$row[csf("body_part_id")]]; ?></td>
								<td align="center"><? echo $color_library[$row[csf("gmts_color")]]; ?></td>
								<td align="center"><? echo $color_library[$row[csf("item_color")]]; ?></td>
								<td align="center"><? echo $size_library[$row[csf("gmts_size")]]; ?></td>
								<td align="center"><? echo $size_library[$row[csf("item_size")]]; ?></td>
								<td align="center"><? //echo $size_library[$row[csf("uom")]]; ?>PCS</td>
								<td align="right"><? echo fn_number_format($row[csf("qnty")],4); ?></td>
								<td align="right"><? echo fn_number_format($row[csf("amount")]/$row[csf("qnty")],4); ?></td>
								<td align="right"><? echo fn_number_format($row[csf("amount")],2); ?></td>
							</tr>
						<?
						$total_amount += $row[csf("amount")];
						$total_req_qnty+= $row[csf("qnty")];
						$i++;
						}
					}
				}	
			}
			?>
				<tr class="rpt_bottom" style="font-weight:bold">
					<td align="left" colspan="8">Total</td>
					<td align="right"><? echo fn_number_format($total_req_qnty,2); ?></td>
					<td></td>
					<td align="right"><? echo fn_number_format($total_amount,2); ?></td>
				</tr>
			</table>
	  </div>
	<?
	}
	$job_info=sql_select("SELECT id, inserted_by from wo_pre_cost_mst where status_active=1 and is_deleted=0 and job_no='".str_replace("'","",$txt_job_no)."'");
	 foreach ($job_info as $row) {
		 $inserted_by=$row[csf('inserted_by')];
		 $job_id=$row[csf('id')];
	 }
	$signature_arr=return_library_array( "select master_tble_id,image_location from common_photo_library where form_name='user_signature'",'master_tble_id','image_location');
	 $appSql="select approved_by from approval_history where entry_form=15 and mst_id = $job_id";
	 $appSqlRes=sql_select($appSql);
	 foreach($appSqlRes as $row){
		 $userSignatureArr[$row[csf('approved_by')]]=$path.$signature_arr[$row[csf('approved_by')]];
	 }
	 $userSignatureArr[$inserted_by]=$path.$signature_arr[$inserted_by];
	 //echo signature_table(109, $cbo_company_name, "1200px",$cbo_template_id,50,$inserted_by,$userSignatureArr);
	 //$report_id, $company, $width, $template_id="", $padding_top = 70,$prepared_by='',$userSignatureArr=array(),$break_tr=7
	 $width="850px";
	 $report_id=109;
	 $padding_top = 50;
	 $$prepared_by=$inserted_by;
	if ($cbo_template_id != '') {
		$template_id = " and template_id=$cbo_template_id ";
	}
	$sql = sql_select("select USER_ID,designation,name,activities,prepared_by from variable_settings_signature where report_id=$report_id and company_id=$cbo_company_name   and status_active=1 $template_id order by sequence_no ");
	$user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
	if($sql[0][csf("prepared_by")]==1){
		list($prepared_by,$activities)=explode('**',$prepared_by);
		$sql_2[100] = array ( USER_ID=>$prepared_by,DESIGNATION => 'Prepared By' ,NAME => ($user_lib_name[$prepared_by])?$user_lib_name[$prepared_by]:$prepared_by, ACTIVITIES =>$activities, PREPARED_BY => 0 );
		$sql=$sql_2+$sql;
	}
	$count = count($sql);
	$td_width = floor($width / $count);
	$standard_width = $count * 150;
	if ($standard_width > $width) {
		$td_width = 150;
	}
	$no_coloumn_per_tr = floor($width / $td_width);
	$i = 1;
	if ($count == 0) {$message = "<b>Note: This is Software Generated Copy , Signature is not Required.</b>";}
	echo '<table cellspacing="5" id="signatureTblId" width="' . $width . '" style="padding-top:' . $padding_top . 'px;"><tr><td width="100%" height="' . $padding_top . '" colspan="' . $count . '">' . $message . '</td></tr>';
	$flag=0;
	foreach ($sql as $row) {
		$flag++;
		$sigHtml='';
		if($userSignatureArr[$row['USER_ID']]){$sigHtml='<img src="'.$userSignatureArr[$row['USER_ID']].'" height="60" width="180">';}
		else{$sigHtml='<div height="40"></div>';}
		if($flag==1){echo "<tr>";}
		echo '<td width="' . $td_width . '" align="center" valign="top">
		<p style="min-height:40px;">'.$sigHtml.'</p>
		<strong>' . $row[csf("activities")] . '</strong><br>
		<strong style="text-decoration:overline">' . $row[csf("designation")] . "</strong><br>" . $row[csf("name")] . '</td>';
		if($flag==$break_tr || $count==$i){echo "</tr>";$flag=0;}
		$i++;
	}
	echo '</table>';
	}?>
	<p style="page-break-after:always;"></p>
	<?
	$part[3]=ob_get_contents();ob_end_clean();ob_start();//part 4;
	/* $emblishment_qty=$emblishment->getQtyArray_by_jobEmbnameAndEmbtypeColorSize();
	$emblishment_amount=$emblishment->getAmountArray_by_jobEmbnameAndEmbtypeColorSize(); */
			//$wash_qty=$wash->getQtyArray_by_jobAndEmblishmentid();
			//$wash_amount=$wash->getAmountArray_by_jobAndEmblishmentid();
	$embroiderySql = "select a.id, a.job_no, a.emb_name, a.emb_type, a.cons_dzn_gmts, b.rate, a.amount,b.color_number_id,b.size_number_id,a.body_part_id,c.order_quantity from wo_pre_cost_embe_cost_dtls a,wo_pre_cos_emb_co_avg_con_dtls b,wo_po_color_size_breakdown c where a.id=b.pre_cost_emb_cost_dtls_id and b.po_break_down_id=c.po_break_down_id and b.item_number_id=c.item_number_id and b.size_number_id=c.size_number_id and b.color_number_id=c.color_number_id and a.job_id=c.job_id and a.job_no=".$txt_job_no." and a.emb_name =2 and b.requirment>0 and a.status_active=1 and b.status_active=1 and c.status_active=1";
	$embroidery_data_array=sql_select($embroiderySql);
	$embroideryconData=array();
	foreach($embroidery_data_array as $rows){
		/* $embQty=$emblishment_qty[$rows[csf('job_no')]][$rows[csf('emb_name')]][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]];
		$embAmt=$emblishment_amount[$rows[csf('job_no')]][$rows[csf('emb_name')]][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]; */
		$embroideryconData[2][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['EMB_TYPE']=$rows[csf('emb_type')];
		$embroideryconData[2][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['GMTS_COLOR']=$rows[csf('color_number_id')];
		$embroideryconData[2][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['ITEM_COLOR']=$rows[csf('color_number_id')];
		$embroideryconData[2][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['GMTS_SIZE']=$rows[csf('size_number_id')];
		$embroideryconData[2][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['ITEM_SIZE']=$rows[csf('size_number_id')];
		$embroideryconData[2][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['UOM']=$rows[csf('uom')];
		$embroideryconData[2][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['QNTY']+=$rows[csf('order_quantity')];
		$embroideryconData[2][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['RATE']=$rows[csf('rate')];
		$embroideryconData[2][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['BODY_PART_ID']=$rows[csf('body_part_id')];
		$embroideryconData[2][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['AMOUNT']+=$rows[csf('rate')]*$rows[csf('order_quantity')];
	}
	if(count($embroidery_data_array)>0){
	if($zero_value==1)
	{
	?>
        <div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
		<th>
		Master work order for Embroidery
		</th>
		</table>
		<table width="850" style="border:1px solid black; margin-top:1px;font-family:Arial Narrow; font-size:16px" >
			<tr>
				<td width="130">Job No.</td><td width="140"><b><? echo $jobNo; ?></b></td>
				<td width="130">Style Ref. No</td><td width="140"><b><? echo $styleName; ?></b></td>
				<td width="130">Order No.</td><td width="140"><b><? echo $job_in_orders; ?></b></td>
            	<td width="130">Buyer</td><td width="140"><b><? echo $buyerName;?></b></td>
			</tr>
		</table>
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                <tr style="font-weight:bold">
					<td width="50">Sequence no.</td>   
                    <td width="100">Embroidery Type</td>
					<td width="100">Body Part</td>
                    <td width="50">Gmts Color</td>
					<td width="50">Item Color</td>
					<td width="50">Gmts Size</td>
					<td width="50">Item Size</td>
                    <td width="100">UOM</td>
                    <td width="100">WO Qty</td>
					<td width="70">Rate</td>
					<td width="100">Amount</td>
                </tr>
            <?
			$i=1;
            $total_amount=0;
			$total_req_qnty=0;
            foreach( $embroideryconData as $processId=>$processArr )
				{
					foreach( $processArr as $colorNoId=>$coloridArr )
					{
						foreach( $coloridArr as $sizeNoId=>$sizeidArr )
						{
							foreach( $sizeidArr as $id=>$row )
							{
					
							?>
								<tr>
									<td align="center"><? echo $i;?></td>
									<td align="center"><? echo $emblishment_embroy_type[$row[csf("emb_type")]]; ?></td>
									<td align="center"><? echo $body_part[$row[csf("body_part_id")]]; ?></td>
									<td align="center"><? echo $color_library[$row[csf("gmts_color")]]; ?></td>
									<td align="center"><? echo $color_library[$row[csf("item_color")]]; ?></td>
									<td align="center"><? echo $size_library[$row[csf("gmts_size")]]; ?></td>
									<td align="center"><? echo $size_library[$row[csf("item_size")]]; ?></td>
									<td align="center"><? //echo $size_library[$row[csf("uom")]]; ?>PCS</td>
									<td align="right"><? echo fn_number_format($row[csf("qnty")],4); ?></td>
									<td align="right"><? echo fn_number_format($row[csf("amount")]/$row[csf("qnty")],4); ?></td>
									<td align="right"><? echo fn_number_format($row[csf("amount")],2); ?></td>
								</tr>
							<?
							$total_amount += $row[csf("amount")];
							$total_req_qnty+= $row[csf("qnty")];
							$i++;
							}
						}
					}	
				}
            ?>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td align="left" colspan="8">Total</td>
                    <td align="right"><? echo fn_number_format($total_req_qnty,2); ?></td>
					<td></td>
                    <td align="right"><? echo fn_number_format($total_amount,2); ?></td>
                </tr>
            </table>
      </div>
      <?
	}
	else
	{
		
	?>
      <div style="margin-top:15px">
	  <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
		<th>
		Master work order for Embroidery
		</th>
		</table>
		<table width="850" style="border:1px solid black; margin-top:1px;font-family:Arial Narrow; font-size:16px" >
				<tr>
					<td width="130">Job No.</td><td width="140"><b><? echo $jobNo; ?></b></td>
					<td width="130">Style Ref. No</td><td width="140"><b><? echo $styleName; ?></b></td>
					<td width="130">Order No.</td><td width="140"><b><? echo $job_in_orders; ?></b></td>
					<td width="130">Buyer</td><td width="140"><b><? echo $buyerName;?></b></td>
				</tr>
			</table>
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<tr style="font-weight:bold">
					<td width="50">Sequence no.</td>   
                    <td width="100">Embroidery Type</td>
					<td width="100">Body Part</td>
                    <td width="50">Gmts Color</td>
					<td width="50">Item Color</td>
					<td width="50">Gmts Size</td>
					<td width="50">Item Size</td>
                    <td width="100">UOM</td>
                    <td width="100">WO Qty</td>
					<td width="70">Rate</td>
					<td width="100">Amount</td>
                </tr>
            <?
            $total_amount=0;
			$total_req_qnty=0;
            foreach( $embroideryconData as $processId=>$processArr )
				{
					foreach( $processArr as $colorNoId=>$coloridArr )
					{
						foreach( $coloridArr as $sizeNoId=>$sizeidArr )
						{
							foreach( $sizeidArr as $id=>$row )
							{
					
							?>
								<tr>
									<td align="center"><? echo $i;?></td>
									<td align="center"><? echo $emblishment_embroy_type[$row[csf("emb_type")]]; ?></td>
									<td align="center"><? echo $body_part[$row[csf("body_part_id")]]; ?></td>
									<td align="center"><? echo $color_library[$row[csf("gmts_color")]]; ?></td>
									<td align="center"><? echo $color_library[$row[csf("item_color")]]; ?></td>
									<td align="center"><? echo $size_library[$row[csf("gmts_size")]]; ?></td>
									<td align="center"><? echo $size_library[$row[csf("item_size")]]; ?></td>
									<td align="center"><? //echo $size_library[$row[csf("uom")]]; ?>PCS</td>
									<td align="right"><? echo fn_number_format($row[csf("qnty")],4); ?></td>
									<td align="right"><? echo fn_number_format($row[csf("amount")]/$row[csf("qnty")],4); ?></td>
									<td align="right"><? echo fn_number_format($row[csf("amount")],2); ?></td>
								</tr>
							<?
							$total_amount += $row[csf("amount")];
							$total_req_qnty+= $row[csf("qnty")];
							$i++;
							}
						}
					}	
				}
            ?>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td align="left" colspan="8">Total</td>
                    <td align="right"><? echo fn_number_format($total_req_qnty,2); ?></td>
					<td></td>
                    <td align="right"><? echo fn_number_format($total_amount,2); ?></td>
                </tr>
            </table>
      </div>
    <?
	}
	$job_info=sql_select("SELECT id, inserted_by from wo_pre_cost_mst where status_active=1 and is_deleted=0 and job_no='".str_replace("'","",$txt_job_no)."'");
	 foreach ($job_info as $row) {
		 $inserted_by=$row[csf('inserted_by')];
		 $job_id=$row[csf('id')];
	 }
	$signature_arr=return_library_array( "select master_tble_id,image_location from common_photo_library where form_name='user_signature'",'master_tble_id','image_location');
	 $appSql="select approved_by from approval_history where entry_form=15 and mst_id = $job_id";
	 $appSqlRes=sql_select($appSql);
	 foreach($appSqlRes as $row){
		 $userSignatureArr[$row[csf('approved_by')]]=$path.$signature_arr[$row[csf('approved_by')]];
	 }
	 $userSignatureArr[$inserted_by]=$path.$signature_arr[$inserted_by];
	 //echo signature_table(109, $cbo_company_name, "1200px",$cbo_template_id,50,$inserted_by,$userSignatureArr);
	 //$report_id, $company, $width, $template_id="", $padding_top = 70,$prepared_by='',$userSignatureArr=array(),$break_tr=7
	 $width="850px";
	 $report_id=109;
	 $padding_top = 50;
	 $$prepared_by=$inserted_by;
	if ($cbo_template_id != '') {
		$template_id = " and template_id=$cbo_template_id ";
	}
	$sql = sql_select("select USER_ID,designation,name,activities,prepared_by from variable_settings_signature where report_id=$report_id and company_id=$cbo_company_name   and status_active=1 $template_id order by sequence_no ");
	$user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
	if($sql[0][csf("prepared_by")]==1){
		list($prepared_by,$activities)=explode('**',$prepared_by);
		$sql_2[100] = array ( USER_ID=>$prepared_by,DESIGNATION => 'Prepared By' ,NAME => ($user_lib_name[$prepared_by])?$user_lib_name[$prepared_by]:$prepared_by, ACTIVITIES =>$activities, PREPARED_BY => 0 );
		$sql=$sql_2+$sql;
	}
	$count = count($sql);
	$td_width = floor($width / $count);
	$standard_width = $count * 150;
	if ($standard_width > $width) {
		$td_width = 150;
	}
	$no_coloumn_per_tr = floor($width / $td_width);
	$i = 1;
	if ($count == 0) {$message = "<b>Note: This is Software Generated Copy , Signature is not Required.</b>";}
	echo '<table cellspacing="5" id="signatureTblId" width="' . $width . '" style="padding-top:' . $padding_top . 'px;"><tr><td width="100%" height="' . $padding_top . '" colspan="' . $count . '">' . $message . '</td></tr>';
	$flag=0;
	foreach ($sql as $row) {
		$flag++;
		$sigHtml='';
		if($userSignatureArr[$row['USER_ID']]){$sigHtml='<img src="'.$userSignatureArr[$row['USER_ID']].'" height="60" width="180">';}
		else{$sigHtml='<div height="40"></div>';}
		if($flag==1){echo "<tr>";}
		echo '<td width="' . $td_width . '" align="center" valign="top">
		<p style="min-height:40px;">'.$sigHtml.'</p>
		<strong>' . $row[csf("activities")] . '</strong><br>
		<strong style="text-decoration:overline">' . $row[csf("designation")] . "</strong><br>" . $row[csf("name")] . '</td>';
		if($flag==$break_tr || $count==$i){echo "</tr>";$flag=0;}
		$i++;
	}
	echo '</table>';
	}?>
	<p style="page-break-after:always;"></p>
	<?
 	$part[4]=ob_get_contents();ob_end_clean();ob_start();//part 5;
	/* $wash_qty=$wash->getQtyArray_by_jobEmbnameAndEmbtypeColorSize();
	$wash_amount=$wash->getAmountArray_by_jobEmbnameAndEmbtypeColorSize(); */
	$washSql = "select a.id, a.job_no, a.emb_name, a.emb_type, a.cons_dzn_gmts, b.rate, a.amount,b.color_number_id,b.size_number_id,a.body_part_id,c.order_quantity from wo_pre_cost_embe_cost_dtls a,wo_pre_cos_emb_co_avg_con_dtls b,wo_po_color_size_breakdown c where a.id=b.pre_cost_emb_cost_dtls_id and b.po_break_down_id=c.po_break_down_id and b.item_number_id=c.item_number_id and b.size_number_id=c.size_number_id and b.color_number_id=c.color_number_id and a.job_id=c.job_id and a.job_no=".$txt_job_no." and a.emb_name =3 and b.requirment>0 and a.status_active=1 and b.status_active=1 and c.status_active=1";
	$wash_data_array=sql_select($washSql);
	$washconData=array();
	foreach($wash_data_array as $rows){
		/* $washQty=$wash_qty[$rows[csf('job_no')]][$rows[csf('emb_name')]][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]];
		$washAmt=$wash_amount[$rows[csf('job_no')]][$rows[csf('emb_name')]][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]; */
		$washconData[3][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['EMB_TYPE']=$rows[csf('emb_type')];
		$washconData[3][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['GMTS_COLOR']=$rows[csf('color_number_id')];
		$washconData[3][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['ITEM_COLOR']=$rows[csf('color_number_id')];
		$washconData[3][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['GMTS_SIZE']=$rows[csf('size_number_id')];
		$washconData[3][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['ITEM_SIZE']=$rows[csf('size_number_id')];
		$washconData[3][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['UOM']=$rows[csf('uom')];
		$washconData[3][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['QNTY']+=$rows[csf('order_quantity')];
		$washconData[3][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['RATE']=$rows[csf('rate')];
		$washconData[3][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['BODY_PART_ID']=$rows[csf('body_part_id')];
		$washconData[3][$rows[csf('emb_type')]][$rows[csf('color_number_id')]][$rows[csf('size_number_id')]]['AMOUNT']+=$rows[csf('rate')]*$rows[csf('order_quantity')];
	}
	if(count($wash_data_array)>0){
	if($zero_value==1)
	{
	?>
        <div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
		<th>
		Master work order for Wash
		</th>
		</table>
		<table width="850" style="border:1px solid black; margin-top:1px;font-family:Arial Narrow; font-size:16px" >
			<tr>
				<td width="130">Job No.</td><td width="140"><b><? echo $jobNo; ?></b></td>
				<td width="130">Style Ref. No</td><td width="140"><b><? echo $styleName; ?></b></td>
				<td width="130">Order No.</td><td width="140"><b><? echo $job_in_orders; ?></b></td>
            	<td width="130">Buyer</td><td width="140"><b><? echo $buyerName;?></b></td>
			</tr>
		</table>
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                <tr style="font-weight:bold">
					<td width="50">Sequence no.</td>   
                    <td width="150">Wash Type</td>
                    <td width="75">Gmts Color</td>
					<td width="75">Item Color</td>
					<td width="50">Gmts Size</td>
					<td width="50">Item Size</td>
                    <td width="100">UOM</td>
                    <td width="100">WO Qty</td>
					<td width="70">Rate</td>
					<td width="100">Amount</td>
                </tr>
            <?
			$i=1;
            $total_amount=0;
			$total_req_qnty=0;
            foreach( $washconData as $processId=>$processArr )
				{
					foreach( $processArr as $colorNoId=>$coloridArr )
					{
						foreach( $coloridArr as $sizeNoId=>$sizeidArr )
						{
							foreach( $sizeidArr as $id=>$row )
							{
					
							?>
								<tr>
									<td align="center"><? echo $i;?></td>
									<td align="center"><? echo $emblishment_wash_type[$row[csf("emb_type")]]; ?></td>
									<td align="center"><? echo $color_library[$row[csf("gmts_color")]]; ?></td>
									<td align="center"><? echo $color_library[$row[csf("item_color")]]; ?></td>
									<td align="center"><? echo $size_library[$row[csf("gmts_size")]]; ?></td>
									<td align="center"><? echo $size_library[$row[csf("item_size")]]; ?></td>
									<td align="center"><? //echo $size_library[$row[csf("uom")]]; ?>PCS</td>
									<td align="right"><? echo fn_number_format($row[csf("qnty")],4); ?></td>
									<td align="right"><? echo fn_number_format($row[csf("amount")]/$row[csf("qnty")],4); ?></td>
									<td align="right"><? echo fn_number_format($row[csf("amount")],2); ?></td>
								</tr>
							<?
							$total_amount += $row[csf("amount")];
							$total_req_qnty+= $row[csf("qnty")];
							$i++;
							}
						}
					}	
				}
            ?>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td align="left" colspan="7">Total</td>
                    <td align="right"><? echo fn_number_format($total_req_qnty,2); ?></td>
					<td></td>
                    <td align="right"><? echo fn_number_format($total_amount,2); ?></td>
                </tr>
            </table>
      </div>
      <?
	}
	else
	{
		
	?>
      <div style="margin-top:15px">
	  <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
		<th>
		Master work order for Wash
		</th>
		</table>
		<table width="850" style="border:1px solid black; margin-top:1px;font-family:Arial Narrow; font-size:16px" >
				<tr>
					<td width="130">Job No.</td><td width="140"><b><? echo $jobNo; ?></b></td>
					<td width="130">Style Ref. No</td><td width="140"><b><? echo $styleName; ?></b></td>
					<td width="130">Order No.</td><td width="140"><b><? echo $job_in_orders; ?></b></td>
					<td width="130">Buyer</td><td width="140"><b><? echo $buyerName;?></b></td>
				</tr>
			</table>
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<tr style="font-weight:bold">
					<td width="50">Sequence no.</td>   
                    <td width="150">Wash Type</td>
                    <td width="75">Gmts Color</td>
					<td width="75">Item Color</td>
					<td width="50">Gmts Size</td>
					<td width="50">Item Size</td>
                    <td width="100">UOM</td>
                    <td width="100">WO Qty</td>
					<td width="70">Rate</td>
					<td width="100">Amount</td>
                </tr>
            <?
            $total_amount=0;
			$total_req_qnty=0;
            foreach( $washconData as $processId=>$processArr )
				{
					foreach( $processArr as $colorNoId=>$coloridArr )
					{
						foreach( $coloridArr as $sizeNoId=>$sizeidArr )
						{
							foreach( $sizeidArr as $id=>$row )
							{
					
							?>
								<tr>
									<td align="center"><? echo $i;?></td>
									<td align="center"><? echo $emblishment_wash_type[$row[csf("emb_type")]]; ?></td>
									<td align="center"><? echo $color_library[$row[csf("gmts_color")]]; ?></td>
									<td align="center"><? echo $color_library[$row[csf("item_color")]]; ?></td>
									<td align="center"><? echo $size_library[$row[csf("gmts_size")]]; ?></td>
									<td align="center"><? echo $size_library[$row[csf("item_size")]]; ?></td>
									<td align="center"><? //echo $size_library[$row[csf("uom")]]; ?>PCS</td>
									<td align="right"><? echo fn_number_format($row[csf("qnty")],4); ?></td>
									<td align="right"><? echo fn_number_format($row[csf("amount")]/$row[csf("qnty")],4); ?></td>
									<td align="right"><? echo fn_number_format($row[csf("amount")],2); ?></td>
								</tr>
							<?
							$total_amount += $row[csf("amount")];
							$total_req_qnty+= $row[csf("qnty")];
							$i++;
							}
						}
					}	
				}
            ?>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td align="left" colspan="7">Total</td>
                    <td align="right"><? echo fn_number_format($total_req_qnty,2); ?></td>
					<td></td>
                    <td align="right"><? echo fn_number_format($total_amount,2); ?></td>
                </tr>
            </table>
      </div>
    <?
	}
	$job_info=sql_select("SELECT id, inserted_by from wo_pre_cost_mst where status_active=1 and is_deleted=0 and job_no='".str_replace("'","",$txt_job_no)."'");
	 foreach ($job_info as $row) {
		 $inserted_by=$row[csf('inserted_by')];
		 $job_id=$row[csf('id')];
	 }
	$signature_arr=return_library_array( "select master_tble_id,image_location from common_photo_library where form_name='user_signature'",'master_tble_id','image_location');
	 $appSql="select approved_by from approval_history where entry_form=15 and mst_id = $job_id";
	 $appSqlRes=sql_select($appSql);
	 foreach($appSqlRes as $row){
		 $userSignatureArr[$row[csf('approved_by')]]=$path.$signature_arr[$row[csf('approved_by')]];
	 }
	 $userSignatureArr[$inserted_by]=$path.$signature_arr[$inserted_by];
	 //echo signature_table(109, $cbo_company_name, "1200px",$cbo_template_id,50,$inserted_by,$userSignatureArr);
	 //$report_id, $company, $width, $template_id="", $padding_top = 70,$prepared_by='',$userSignatureArr=array(),$break_tr=7
	 $width="850px";
	 $report_id=109;
	 $padding_top = 50;
	 $$prepared_by=$inserted_by;
	if ($cbo_template_id != '') {
		$template_id = " and template_id=$cbo_template_id ";
	}
	$sql = sql_select("select USER_ID,designation,name,activities,prepared_by from variable_settings_signature where report_id=$report_id and company_id=$cbo_company_name   and status_active=1 $template_id order by sequence_no ");
	$user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
	if($sql[0][csf("prepared_by")]==1){
		list($prepared_by,$activities)=explode('**',$prepared_by);
		$sql_2[100] = array ( USER_ID=>$prepared_by,DESIGNATION => 'Prepared By' ,NAME => ($user_lib_name[$prepared_by])?$user_lib_name[$prepared_by]:$prepared_by, ACTIVITIES =>$activities, PREPARED_BY => 0 );
		$sql=$sql_2+$sql;
	}
	$count = count($sql);
	$td_width = floor($width / $count);
	$standard_width = $count * 150;
	if ($standard_width > $width) {
		$td_width = 150;
	}
	$no_coloumn_per_tr = floor($width / $td_width);
	$i = 1;
	if ($count == 0) {$message = "<b>Note: This is Software Generated Copy , Signature is not Required.</b>";}
	echo '<table cellspacing="5" id="signatureTblId" width="' . $width . '" style="padding-top:' . $padding_top . 'px;"><tr><td width="100%" height="' . $padding_top . '" colspan="' . $count . '">' . $message . '</td></tr>';
	$flag=0;
	foreach ($sql as $row) {
		$flag++;
		$sigHtml='';
		if($userSignatureArr[$row['USER_ID']]){$sigHtml='<img src="'.$userSignatureArr[$row['USER_ID']].'" height="60" width="180">';}
		else{$sigHtml='<div height="40"></div>';}
		if($flag==1){echo "<tr>";}
		echo '<td width="' . $td_width . '" align="center" valign="top">
		<p style="min-height:40px;">'.$sigHtml.'</p>
		<strong>' . $row[csf("activities")] . '</strong><br>
		<strong style="text-decoration:overline">' . $row[csf("designation")] . "</strong><br>" . $row[csf("name")] . '</td>';
		if($flag==$break_tr || $count==$i){echo "</tr>";$flag=0;}
		$i++;
	}
	echo '</table>';
	}?>
	<p style="page-break-after:always;"></p>
	<?
		//End Conversion Cost to Fabric report here -------------------------------------------
		$part[5]=ob_get_contents();ob_end_clean();ob_start();//part 6;
		//start	dying -------------------------------------------
		$ratio_sql = sql_select("select SUM(set_item_ratio) as set_ratio from wo_po_details_mas_set_details where job_no=$txt_job_no");
		foreach($ratio_sql as $key=>$val)
		{
			$set_items=$val[csf("set_ratio")];
		}
		$sql_garmets="select a.smv_pcs,b.cm_cost,c.item_number_id,c.color_number_id,c.order_rate,SUM(c.order_quantity) as order_quantity from wo_po_details_mas_set_details a, wo_pre_cost_dtls b,wo_po_color_size_breakdown c where a.job_id=b.job_id and a.job_id=c.job_id and a.job_no =".$txt_job_no." and a.gmts_item_id=c.item_number_id  and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 group by a.smv_pcs,b.cm_cost,c.item_number_id,c.color_number_id,c.order_rate";
		$garmets_data_array=sql_select($sql_garmets);
		$gmtsconData=array();
		foreach($garmets_data_array as $rows){
			$gmtsconData[$rows[csf('item_number_id')]][$rows[csf('color_number_id')]]['SEW_SMV']=$rows[csf('smv_pcs')];
			$gmtsconData[$rows[csf('item_number_id')]][$rows[csf('color_number_id')]]['SET_ITEM_RATIOS']=$order_price_per_dzn*$set_items;
			$gmtsconData[$rows[csf('item_number_id')]][$rows[csf('color_number_id')]]['CM_COST']=$rows[csf('cm_cost')];
			$gmtsconData[$rows[csf('item_number_id')]][$rows[csf('color_number_id')]]['ITEMID']=$rows[csf('item_number_id')];
			$gmtsconData[$rows[csf('item_number_id')]][$rows[csf('color_number_id')]]['COLORID']=$rows[csf('color_number_id')];
			$gmtsconData[$rows[csf('item_number_id')]][$rows[csf('color_number_id')]]['RATE']=$rows[csf('order_rate')];
			$gmtsconData[$rows[csf('item_number_id')]][$rows[csf('color_number_id')]]['QUANTITY']+=$rows[csf('order_quantity')];
			$gmtsconData[$rows[csf('item_number_id')]][$rows[csf('color_number_id')]]['AMOUNT']=$rows[csf('order_quantity')]*$rows[csf('order_rate')];
		}   
		if(count($garmets_data_array)>0){
		if($zero_value==1)
		{
		?>
	
			<div style="margin-top:15px">
			<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
			<th>
			Master work order for  Garments
			</th>
			</table>
			<table width="850" style="border:1px solid black; margin-top:1px;font-family:Arial Narrow; font-size:16px" >
				<tr>
					<td width="130">Job No.</td><td width="140"><b><? echo $jobNo; ?></b></td>
					<td width="130">Style Ref. No</td><td width="140"><b><? echo $styleName; ?></b></td>
					<td width="130">Order No.</td><td width="140"><b><? echo $job_in_orders; ?></b></td>
					<td width="130">Buyer</td><td width="140"><b><? echo $buyerName;?></b></td>
				</tr>
			</table>
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
					<tr style="font-weight:bold">
						<td width="50">Sequence no.</td>   
						<td width="100">Process name</td>
						<td width="100">Color</td>
						<td width="100">CM cost/pcs</td>
						<td width="100">SMV</td>
						<td width="100">Gmt.Item</td>
						<td width="100">WO Qty Pcs</td>
						<td width="50">Rate</td>
						<td width="100">Amount</td>
					</tr>
				<?
				$i=1;
				$total_amount=0;
				$total_req_qnty=0;
				foreach( $gmtsconData as $processId=>$coloridArr )
				{
					
					foreach( $coloridArr as $id=>$row )
					{
					?>
						<tr>
							<td align="center"><? echo $i;?></td>
							<td align="center"><p>Sewing</p></td>
							<td align="center"><? echo $color_library[$row[csf("colorid")]]; ?></td>
							<td align="center"><? echo fn_number_format($row[csf("cm_cost")]/$row[csf("set_item_ratios")],6); ?></td>
							<td align="center"><? echo $row[csf("sew_smv")]; ?></td>
							<td align="right"><? echo $garments_item[$row[csf("itemid")]];; ?></td>
							<td align="right"><? echo fn_number_format($row[csf("quantity")],2); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("rate")],4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")],2); ?></td>
						</tr>
					<?
						 $total_amount += $row[csf("amount")];
						 $total_req_qnty+= $row[csf("quantity")];
						 $i++;
					}
					
				}
				?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td align="left" colspan="6">Total</td>
						<td align="right"><? echo fn_number_format($total_req_qnty,2); ?></td>
						<td></td>
						<td align="right"><? echo fn_number_format($total_amount,2); ?></td>
					</tr>
				</table>
		  </div>
		  <?
		}
		else
		{
			
		?>
		  <div style="margin-top:15px">
		  <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
			<th>
			Master work order for Garments
			</th>
			</table>
			<table width="850" style="border:1px solid black; margin-top:1px;font-family:Arial Narrow; font-size:16px" >
					<tr>
						<td width="130">Job No.</td><td width="140"><b><? echo $jobNo; ?></b></td>
						<td width="130">Style Ref. No</td><td width="140"><b><? echo $styleName; ?></b></td>
						<td width="130">Order No.</td><td width="140"><b><? echo $job_in_orders; ?></b></td>
						<td width="130">Buyer</td><td width="140"><b><? echo $buyerName;?></b></td>
					</tr>
				</table>
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<tr style="font-weight:bold">
						<td width="50">Sequence no.</td>   
						<td width="100">Process name</td>
						<td width="100">Color</td>
						<td width="100">CM cost/pcs</td>
						<td width="100">SMV</td>
						<td width="100">Gmt.Item</td>
						<td width="100">WO Qty Pcs</td>
						<td width="50">Rate</td>
						<td width="100">Amount</td>
					</tr>
				<?
				$total_amount=0;
				$total_req_qnty=0;
				foreach( $gmtsconData as $processId=>$coloridArr )
				{
					
					foreach( $coloridArr as $id=>$row )
					{
					?>
						<tr>
							<td align="center"><? echo $i;?></td>
							<td align="center"><p>Sewing</p></td>
							<td align="center"><? echo $color_library[$row[csf("colorid")]]; ?></td>
							<td align="center"><? echo fn_number_format($row[csf("cm_cost")]/$row[csf("set_item_ratios")],6); ?></td>
							<td align="center"><? echo $row[csf("sew_smv")]; ?></td>
							<td align="right"><? echo $garments_item[$row[csf("itemid")]];; ?></td>
							<td align="right"><? echo fn_number_format($row[csf("quantity")],2); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("rate")],4); ?></td>
							<td align="right"><? echo fn_number_format($row[csf("amount")],2); ?></td>
						</tr>
					<?
						 $total_amount += $row[csf("order_amount")];
						 $total_req_qnty+= $row[csf("order_quantity")];
						 $i++;
					}
					
				}
				?>
					<tr class="rpt_bottom" style="font-weight:bold">
						<td align="left" colspan="6">Total</td>
						<td align="right"><? echo fn_number_format($total_req_qnty,2); ?></td>
						<td></td>
						<td align="right"><? echo fn_number_format($total_amount,2); ?></td>
					</tr>
				</table>
		  </div>
		<?
		}
		$job_info=sql_select("SELECT id, inserted_by from wo_pre_cost_mst where status_active=1 and is_deleted=0 and job_no='".str_replace("'","",$txt_job_no)."'");
		 foreach ($job_info as $row) {
			 $inserted_by=$row[csf('inserted_by')];
			 $job_id=$row[csf('id')];
		 }
	
		$signature_arr=return_library_array( "select master_tble_id,image_location from common_photo_library where form_name='user_signature'",'master_tble_id','image_location');
		 $appSql="select approved_by from approval_history where entry_form=15 and mst_id = $job_id";
		 $appSqlRes=sql_select($appSql);
		 foreach($appSqlRes as $row){
			 $userSignatureArr[$row[csf('approved_by')]]=$path.$signature_arr[$row[csf('approved_by')]];
		 }
		 $userSignatureArr[$inserted_by]=$path.$signature_arr[$inserted_by];
		 //echo signature_table(109, $cbo_company_name, "1200px",$cbo_template_id,50,$inserted_by,$userSignatureArr);
		 //$report_id, $company, $width, $template_id="", $padding_top = 70,$prepared_by='',$userSignatureArr=array(),$break_tr=7
		 $width="850px";
		 $report_id=109;
		 $padding_top = 50;
		 $$prepared_by=$inserted_by;
		if ($cbo_template_id != '') {
			$template_id = " and template_id=$cbo_template_id ";
		}
		$sql = sql_select("select USER_ID,designation,name,activities,prepared_by from variable_settings_signature where report_id=$report_id and company_id=$cbo_company_name   and status_active=1 $template_id order by sequence_no ");
		$user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
	
		if($sql[0][csf("prepared_by")]==1){
			list($prepared_by,$activities)=explode('**',$prepared_by);
			$sql_2[100] = array ( USER_ID=>$prepared_by,DESIGNATION => 'Prepared By' ,NAME => ($user_lib_name[$prepared_by])?$user_lib_name[$prepared_by]:$prepared_by, ACTIVITIES =>$activities, PREPARED_BY => 0 );
			$sql=$sql_2+$sql;
		}
		$count = count($sql);
		$td_width = floor($width / $count);
		$standard_width = $count * 150;
		if ($standard_width > $width) {
			$td_width = 150;
		}
		$no_coloumn_per_tr = floor($width / $td_width);
		$i = 1;
		if ($count == 0) {$message = "<b>Note: This is Software Generated Copy , Signature is not Required.</b>";}
		echo '<table cellspacing="5" id="signatureTblId" width="' . $width . '" style="padding-top:' . $padding_top . 'px;"><tr><td width="100%" height="' . $padding_top . '" colspan="' . $count . '">' . $message . '</td></tr>';
		$flag=0;
		foreach ($sql as $row) {
			$flag++;
			$sigHtml='';
			if($userSignatureArr[$row['USER_ID']]){$sigHtml='<img src="'.$userSignatureArr[$row['USER_ID']].'" height="60" width="180">';}
			else{$sigHtml='<div height="40"></div>';}
			if($flag==1){echo "<tr>";}
			echo '<td width="' . $td_width . '" align="center" valign="top">
			<p style="min-height:40px;">'.$sigHtml.'</p>
			<strong>' . $row[csf("activities")] . '</strong><br>
			<strong style="text-decoration:overline">' . $row[csf("designation")] . "</strong><br>" . $row[csf("name")] . '</td>';
			if($flag==$break_tr || $count==$i){echo "</tr>";$flag=0;}
			$i++;
		}
		echo '</table>';
		}?>
		<p style="page-break-after:always;"></p>
		<?
    //End all summary report here -------------------------------------------
	$part[6]=ob_get_contents();ob_end_clean();ob_start();//part 7;
	$conv_qty_array=$conversion->getQtyArray_by_ConversionidColorAndUom();
	$conv_amount_array=$conversion->getAmountArray_by_ConversionidColorAndUom();	
	//start	dying -------------------------------------------
	$yarndyingSql = "select a.id,a.fabric_description as fabric_description_id,b.uom,b.gsm_weight, a.job_no,a.cons_process, a.req_qnty,a.avg_req_qnty, a.charge_unit, a.amount, a.status_active,b.body_part_id,b.fab_nature_id,b.color_type_id,b.fabric_description,c.dia_width,c.color_number_id from wo_pre_cost_fab_conv_cost_dtls a left join wo_pre_cost_fabric_cost_dtls b on a.job_no=b.job_no and a.fabric_description=b.id and b.status_active=1, wo_pre_cos_fab_co_avg_con_dtls c where a.job_no=".$txt_job_no." and a.fabric_description=c.pre_cost_fabric_cost_dtls_id and a.job_id=c.job_id and a.cons_process=30 and a.status_active=1 ";
	$yarn_dying_data_array=sql_select($yarndyingSql);
	$yarndyingconData=array();
	foreach($yarn_dying_data_array as $rows){
		$yarnconvQty=$conv_qty_array[$rows[csf('id')]][$rows[csf('color_number_id')]][$rows[csf('uom')]];
		$yarnconvAmt=$conv_amount_array[$rows[csf('id')]][$rows[csf('color_number_id')]][$rows[csf('uom')]];
		$yarndyingconData[30][$rows[csf('color_number_id')]]['FABRIC_DESCRIPTION_ID']=$rows[csf('fabric_description_id')];
		$yarndyingconData[30][$rows[csf('color_number_id')]]['COLOR_NO']=$rows[csf('color_number_id')];
		$yarndyingconData[30][$rows[csf('color_number_id')]]['CONS_PROCESS']=$rows[csf('cons_process')];
		$yarndyingconData[30][$rows[csf('color_number_id')]]['REQ_QNTY']=$yarnconvQty;
		$yarndyingconData[30][$rows[csf('color_number_id')]]['AVG_REQ_QNTY']=$rows[csf('avg_req_qnty')];
		$yarndyingconData[30][$rows[csf('color_number_id')]]['CHARGE_UNIT']=$rows[csf('charge_unit')];
		$yarndyingconData[30][$rows[csf('color_number_id')]]['AMOUNT']=$yarnconvAmt;
		$yarndyingconData[30][$rows[csf('color_number_id')]]['STATUS_ACTIVE']=$rows[csf('status_active')];
		$yarndyingconData[30][$rows[csf('color_number_id')]]['BODY_PART_ID']=$rows[csf('body_part_id')];
		$yarndyingconData[30][$rows[csf('color_number_id')]]['FAB_NATURE_ID']=$rows[csf('fab_nature_id')];
		$yarndyingconData[30][$rows[csf('color_number_id')]]['COLOR_TYPE_ID']=$rows[csf('color_type_id')];
		$yarndyingconData[30][$rows[csf('color_number_id')]]['FABRIC_DESCRIPTION']=$rows[csf('fabric_description')];
		$yarndyingconData[30][$rows[csf('color_number_id')]]['UOM']=$rows[csf('uom')];
		$yarndyingconData[30][$rows[csf('color_number_id')]]['GSM_WEIGHT']=$rows[csf('gsm_weight')];
		$yarndyingconData[30][$rows[csf('color_number_id')]]['DIA_WIDTH'].=$rows[csf('dia_width')].',';
	}
	 /* echo '<pre>';
	print_r($yarndyingconData);die;  */
	if(count($yarn_dying_data_array)>0){
	if($zero_value==1)
	{
	?>
        <div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
		<th>
		Master work order for Yarn Dyeing
		</th>
		</table>
		<table width="850" style="border:1px solid black; margin-top:1px;font-family:Arial Narrow; font-size:16px" >
			<tr>
				<td width="130">Job No.</td><td width="140"><b><? echo $jobNo; ?></b></td>
				<td width="130">Style Ref. No</td><td width="140"><b><? echo $styleName; ?></b></td>
				<td width="130">Order No.</td><td width="140"><b><? echo $job_in_orders; ?></b></td>
            	<td width="130">Buyer</td><td width="140"><b><? echo $buyerName;?></b></td>
			</tr>
		</table>
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                <tr style="font-weight:bold">
                    <td width="80">Sequence no.</td>          
					<td width="100">Color</td>
					<td width="100">Color Type</td>
                    <td width="150">Item Description</td>
                    <td width="100">WO Qty</td>
					<td width="100">Rate</td>
					<td width="100">Amount</td>
                </tr>
            <?
			$i=1;
            $total_amount=0;
			$total_req_qnty=0;
            foreach( $yarndyingconData as $processId=>$coloridArr )
            {
				
				foreach( $idArr as $id=>$row )
				{
				if($row[csf("fabric_description_id")] !=0)
				{
					$item_descrition =$row[csf("fabric_description")];
				}
				else
				{
					$item_descrition = "All Fabrics";
				}
				?>
					<tr>
						<td align="center"><? echo $i;?></td>
						<td align="center"><? echo $color_library[$id]; ?></td>
						<td align="center"><? echo $color_type[$row[csf("color_type_id")]]; ?></td>
						<td align="center"><? echo $item_descrition; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("req_qnty")],4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")]/$row[csf("req_qnty")],4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")],2); ?></td>
					</tr>
				<?
					 $total_amount += $row[csf("amount")];
					 $total_req_qnty+= $row[csf("req_qnty")];
					 $i++;
				}
				
			
			}
            ?>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td align="left" colspan="4">Total</td>
                    <td align="right"><? echo fn_number_format($total_req_qnty,2); ?></td>
					<td></td>
                    <td align="right"><? echo fn_number_format($total_amount,2); ?></td>
                </tr>
            </table>
      </div>
      <?
	}
	else
	{
		
	?>
      <div style="margin-top:15px">
	  <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
		<th>
		Master work order for Yarn Dyeing
		</th>
		</table>
		<table width="850" style="border:1px solid black; margin-top:1px;font-family:Arial Narrow; font-size:16px" >
				<tr>
					<td width="130">Job No.</td><td width="140"><b><? echo $jobNo; ?></b></td>
					<td width="130">Style Ref. No</td><td width="140"><b><? echo $styleName; ?></b></td>
					<td width="130">Order No.</td><td width="140"><b><? echo $job_in_orders; ?></b></td>
					<td width="130">Buyer</td><td width="140"><b><? echo $buyerName;?></b></td>
				</tr>
			</table>
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<tr style="font-weight:bold">
                    <td width="80">Sequence no.</td>          
					<td width="100">Color</td>
					<td width="100">Color Type</td>
                    <td width="150">Item Description</td>
                    <td width="100">WO Qty</td>
					<td width="100">Rate</td>
					<td width="100">Amount</td>
                </tr>
            <?
            $total_amount=0;
			$total_req_qnty=0;
            foreach( $yarndyingconData as $processId=>$coloridArr )
            {
				
				foreach( $idArr as $id=>$row )
				{
				if($row[csf("fabric_description_id")] !=0)
				{
					$item_descrition =$row[csf("fabric_description")];
				}
				else
				{
					$item_descrition = "All Fabrics";
				}
				?>
					<tr>
						<td align="center"><? echo $i;?></td>
						<td align="center"><? echo $color_library[$id]; ?></td>
						<td align="center"><? echo $color_type[$row[csf("color_type_id")]]; ?></td>
						<td align="center"><? echo $item_descrition; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("req_qnty")],4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")]/$row[csf("req_qnty")],4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")],2); ?></td>
					</tr>
				<?
					 $total_amount += $row[csf("amount")];
					 $total_req_qnty+= $row[csf("req_qnty")];
					 $i++;
				}
				
			
			}
            ?>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td align="left" colspan="4">Total</td>
                    <td align="right"><? echo fn_number_format($total_req_qnty,2); ?></td>
					<td></td>
                    <td align="right"><? echo fn_number_format($total_amount,2); ?></td>
                </tr>
            </table>
      </div>
    <?
	}
	$job_info=sql_select("SELECT id, inserted_by from wo_pre_cost_mst where status_active=1 and is_deleted=0 and job_no='".str_replace("'","",$txt_job_no)."'");
	 foreach ($job_info as $row) {
		 $inserted_by=$row[csf('inserted_by')];
		 $job_id=$row[csf('id')];
	 }
	$signature_arr=return_library_array( "select master_tble_id,image_location from common_photo_library where form_name='user_signature'",'master_tble_id','image_location');
	 $appSql="select approved_by from approval_history where entry_form=15 and mst_id = $job_id";
	 $appSqlRes=sql_select($appSql);
	 foreach($appSqlRes as $row){
		 $userSignatureArr[$row[csf('approved_by')]]=$path.$signature_arr[$row[csf('approved_by')]];
	 }
	 $userSignatureArr[$inserted_by]=$path.$signature_arr[$inserted_by];
	 //echo signature_table(109, $cbo_company_name, "1200px",$cbo_template_id,50,$inserted_by,$userSignatureArr);
	 //$report_id, $company, $width, $template_id="", $padding_top = 70,$prepared_by='',$userSignatureArr=array(),$break_tr=7
	 $width="850px";
	 $report_id=109;
	 $padding_top = 50;
	 $$prepared_by=$inserted_by;
	if ($cbo_template_id != '') {
		$template_id = " and template_id=$cbo_template_id ";
	}
	$sql = sql_select("select USER_ID,designation,name,activities,prepared_by from variable_settings_signature where report_id=$report_id and company_id=$cbo_company_name   and status_active=1 $template_id order by sequence_no ");
	$user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
	if($sql[0][csf("prepared_by")]==1){
		list($prepared_by,$activities)=explode('**',$prepared_by);
		$sql_2[100] = array ( USER_ID=>$prepared_by,DESIGNATION => 'Prepared By' ,NAME => ($user_lib_name[$prepared_by])?$user_lib_name[$prepared_by]:$prepared_by, ACTIVITIES =>$activities, PREPARED_BY => 0 );
		$sql=$sql_2+$sql;
	}
	$count = count($sql);
	$td_width = floor($width / $count);
	$standard_width = $count * 150;
	if ($standard_width > $width) {
		$td_width = 150;
	}
	$no_coloumn_per_tr = floor($width / $td_width);
	$i = 1;
	if ($count == 0) {$message = "<b>Note: This is Software Generated Copy , Signature is not Required.</b>";}
	echo '<table cellspacing="5" id="signatureTblId" width="' . $width . '" style="padding-top:' . $padding_top . 'px;"><tr><td width="100%" height="' . $padding_top . '" colspan="' . $count . '">' . $message . '</td></tr>';
	$flag=0;
	foreach ($sql as $row) {
		$flag++;
		$sigHtml='';
		if($userSignatureArr[$row['USER_ID']]){$sigHtml='<img src="'.$userSignatureArr[$row['USER_ID']].'" height="60" width="180">';}
		else{$sigHtml='<div height="40"></div>';}
		if($flag==1){echo "<tr>";}
		echo '<td width="' . $td_width . '" align="center" valign="top">
		<p style="min-height:40px;">'.$sigHtml.'</p>
		<strong>' . $row[csf("activities")] . '</strong><br>
		<strong style="text-decoration:overline">' . $row[csf("designation")] . "</strong><br>" . $row[csf("name")] . '</td>';
		if($flag==$break_tr || $count==$i){echo "</tr>";$flag=0;}
		$i++;
	}
	echo '</table>';
	}
	?>
	<p style="page-break-after:always;"></p>
	<?
	//End Conversion Cost to Fabric report here -------------------------------------------
	$part[7]=ob_get_contents();ob_end_clean();ob_start();//part 8;
	$conv_qty_array=$conversion->getQtyArray_by_jobFabricAndProcess();
	$conv_amount_array=$conversion->getAmountArray_by_jobFabricAndProcess();	
	 /* echo "<pre>";
	print_r($conv_qty_array); */ 
	//start	dying -------------------------------------------
	$aopSql = "select a.job_no,a.id,a.fabric_description as fabric_description_id,b.uom,b.gsm_weight, a.job_no,a.cons_process, a.req_qnty,a.avg_req_qnty, a.charge_unit, a.amount, a.status_active,b.body_part_id,b.fab_nature_id,b.color_type_id,b.fabric_description,c.dia_width,c.color_number_id from wo_pre_cost_fab_conv_cost_dtls a left join wo_pre_cost_fabric_cost_dtls b on a.job_no=b.job_no and a.fabric_description=b.id and b.status_active=1, wo_pre_cos_fab_co_avg_con_dtls c where a.job_no=".$txt_job_no." and a.fabric_description=c.pre_cost_fabric_cost_dtls_id and a.job_id=c.job_id and a.cons_process in(35) and a.status_active=1 ";
	$aop_data_array=sql_select($aopSql);
	$aopconData=array();
	foreach($aop_data_array as $rows){
		$aopconvQty=array_sum($conv_qty_array[$rows[csf('job_no')]][$rows[csf('fabric_description_id')]][35]);
		$aopconvAmt=array_sum($conv_amount_array[$rows[csf('job_no')]][$rows[csf('fabric_description_id')]][35]);
		$aopconData[35][$rows[csf('fabric_description')]]['FABRIC_DESCRIPTION_ID']=$rows[csf('fabric_description_id')];
		$aopconData[35][$rows[csf('fabric_description')]]['COLOR_NO']=$rows[csf('color_number_id')];
		$aopconData[35][$rows[csf('fabric_description')]]['CONS_PROCESS']=$rows[csf('cons_process')];
		$aopconData[35][$rows[csf('fabric_description')]]['REQ_QNTY']=$aopconvQty;
		$aopconData[35][$rows[csf('fabric_description')]]['AVG_REQ_QNTY']=$rows[csf('avg_req_qnty')];
		$aopconData[35][$rows[csf('fabric_description')]]['CHARGE_UNIT']=$rows[csf('charge_unit')];
		$aopconData[35][$rows[csf('fabric_description')]]['AMOUNT']=$aopconvAmt;
		$aopconData[35][$rows[csf('fabric_description')]]['STATUS_ACTIVE']=$rows[csf('status_active')];
		$aopconData[35][$rows[csf('fabric_description')]]['BODY_PART_ID']=$rows[csf('body_part_id')];
		$aopconData[35][$rows[csf('fabric_description')]]['FAB_NATURE_ID']=$rows[csf('fab_nature_id')];
		$aopconData[35][$rows[csf('fabric_description')]]['COLOR_TYPE_ID']=$rows[csf('color_type_id')];
		$aopconData[35][$rows[csf('fabric_description')]]['FABRIC_DESCRIPTION']=$rows[csf('fabric_description')];
		$aopconData[35][$rows[csf('fabric_description')]]['UOM']=$rows[csf('uom')];
		$aopconData[35][$rows[csf('fabric_description')]]['BRANDID']=$brandName;
		$aopconData[35][$rows[csf('fabric_description')]]['GSM_WEIGHT']=$rows[csf('gsm_weight')];
		$aopconData[35][$rows[csf('fabric_description')]]['DIA_WIDTH'].=$rows[csf('dia_width')].',';
	}
	  /* echo '<pre>';
	print_r($aopconData);die;  */
	if(count($aop_data_array)>0){
	if($zero_value==1)
	{
	?>
        <div style="margin-top:15px">
		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
		<th>
		Master Booking For All Over Print
		</th>
		</table>
		<table width="850" style="border:1px solid black; margin-top:1px;font-family:Arial Narrow; font-size:16px" >
			<tr>
				<td width="130">Job No.</td><td width="140"><b><? echo $jobNo; ?></b></td>
				<td width="130">Style Ref. No</td><td width="140"><b><? echo $styleName; ?></b></td>
				<td width="130">Order No.</td><td width="140"><b><? echo $job_in_orders; ?></b></td>
            	<td width="130">Buyer</td><td width="140"><b><? echo $buyerName;?></b></td>
			</tr>
		</table>
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                <tr style="font-weight:bold">
					<td width="80">Sequence no.</td>   
                    <td width="150">Fabric Description</td>
                    <td width="100">Fin. Dia</td>
					<td width="100">Brand</td>
                    <td width="100">UOM</td>
                    <td width="100">WO Qty</td>
					<td width="100">Rate</td>
					<td width="100">Amount</td>
                </tr>
            <?
			$i=1;
            $total_amount=0;
			$total_req_qnty=0;
            foreach( $aopconData as $processId=>$coloridArr )
            {
				
				foreach( $coloridArr as $id=>$row )
				{
				if($row[csf("fabric_description_id")] !=0)
				{
					$item_descrition = $body_part[$row[csf("body_part_id")]].", ".$color_type[$row[csf("color_type_id")]].", ".$row[csf("fabric_description")];
				}
				else
				{
					$item_descrition = "All Fabrics";
				}
				?>
					<tr>
						<td align="center"><? echo $i;?></td>
						<td align="center"><? echo $item_descrition; ?></td>
						<td align="center"><? echo implode(",",array_unique(explode(",",chop($row[csf("dia_width")], ","))));; ?></td>
						<td align="center"><? echo $row[csf("brand")]; ?></td>
						<td align="center"><? echo $unit_of_measurement[$row[csf("uom")]]; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("req_qnty")],4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("charge_unit")],4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")],2); ?></td>
					</tr>
				<?
					 $total_amount += $row[csf("amount")];
					 $total_req_qnty+= $row[csf("req_qnty")];
					 $i++;
				}
				
			}
            ?>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td align="left" colspan="5">Total</td>
                    <td align="right"><? echo fn_number_format($total_req_qnty,2); ?></td>
					<td></td>
                    <td align="right"><? echo fn_number_format($total_amount,2); ?></td>
                </tr>
            </table>
      </div>
      <?
	}
	else
	{
	?>
      <div style="margin-top:15px">
	  <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
		<th>
		Master Booking For All Over Print
		</th>
		</table>
		<table width="850" style="border:1px solid black; margin-top:1px;font-family:Arial Narrow; font-size:16px" >
				<tr>
					<td width="130">Job No.</td><td width="140"><b><? echo $jobNo; ?></b></td>
					<td width="130">Style Ref. No</td><td width="140"><b><? echo $styleName; ?></b></td>
					<td width="130">Order No.</td><td width="140"><b><? echo $job_in_orders; ?></b></td>
					<td width="130">Buyer</td><td width="140"><b><? echo $buyerName;?></b></td>
				</tr>
			</table>
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
				<tr style="font-weight:bold">
					<td width="80">Sequence no.</td>   
					<td width="150">Fabric Description</td>
                    <td width="100">Fin. Dia</td>
					<td width="100">Brand</td>
                    <td width="100">UOM</td>
                    <td width="100">WO Qty</td>
					<td width="100">Rate</td>
					<td width="100">Amount</td>
                </tr>
            <?
            $total_amount=0;
			$total_req_qnty=0;
            foreach( $aopconData as $processId=>$coloridArr )
            {
				
				foreach( $coloridArr as $id=>$row )
				{
				if($row[csf("fabric_description_id")] !=0)
				{
					$item_descrition = $body_part[$row[csf("body_part_id")]].", ".$color_type[$row[csf("color_type_id")]].", ".$row[csf("fabric_description")];
				}
				else
				{
					$item_descrition = "All Fabrics";
				}
				?>
					<tr>
						<td align="center"><? echo $i;?></td>
						<td align="center"><? echo $item_descrition; ?></td>
						<td align="center"><? echo implode(",",array_unique(explode(",",chop($row[csf("dia_width")], ","))));; ?></td>
						<td align="center"><? echo $brandName; ?></td>
						<td align="center"><? echo $unit_of_measurement[$row[csf("uom")]]; ?></td>
						<td align="right"><? echo fn_number_format($row[csf("req_qnty")],4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("charge_unit")],4); ?></td>
						<td align="right"><? echo fn_number_format($row[csf("amount")],2); ?></td>
					</tr>
				<?
					 $total_amount += $row[csf("amount")];
					 $total_req_qnty+= $row[csf("req_qnty")];
					 $i++;
				}
				
			}
            ?>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td align="left" colspan="5">Total</td>
                    <td align="right"><? echo fn_number_format($total_req_qnty,2); ?></td>
					<td></td>
                    <td align="right"><? echo fn_number_format($total_amount,2); ?></td>
                </tr>
            </table>
      </div>
    <?
	}
	$job_info=sql_select("SELECT id, inserted_by from wo_pre_cost_mst where status_active=1 and is_deleted=0 and job_no='".str_replace("'","",$txt_job_no)."'");
	 foreach ($job_info as $row) {
		 $inserted_by=$row[csf('inserted_by')];
		 $job_id=$row[csf('id')];
	 }
	$signature_arr=return_library_array( "select master_tble_id,image_location from common_photo_library where form_name='user_signature'",'master_tble_id','image_location');
	 $appSql="select approved_by from approval_history where entry_form=15 and mst_id = $job_id";
	 $appSqlRes=sql_select($appSql);
	 foreach($appSqlRes as $row){
		 $userSignatureArr[$row[csf('approved_by')]]=$path.$signature_arr[$row[csf('approved_by')]];
	 }
	 $userSignatureArr[$inserted_by]=$path.$signature_arr[$inserted_by];
	 //echo signature_table(109, $cbo_company_name, "1200px",$cbo_template_id,50,$inserted_by,$userSignatureArr);
	 //$report_id, $company, $width, $template_id="", $padding_top = 70,$prepared_by='',$userSignatureArr=array(),$break_tr=7
	 $width="850px";
	 $report_id=109;
	 $padding_top = 50;
	 $$prepared_by=$inserted_by;
	if ($cbo_template_id != '') {
		$template_id = " and template_id=$cbo_template_id ";
	}
	$sql = sql_select("select USER_ID,designation,name,activities,prepared_by from variable_settings_signature where report_id=$report_id and company_id=$cbo_company_name   and status_active=1 $template_id order by sequence_no ");
	$user_lib_name=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
	if($sql[0][csf("prepared_by")]==1){
		list($prepared_by,$activities)=explode('**',$prepared_by);
		$sql_2[100] = array ( USER_ID=>$prepared_by,DESIGNATION => 'Prepared By' ,NAME => ($user_lib_name[$prepared_by])?$user_lib_name[$prepared_by]:$prepared_by, ACTIVITIES =>$activities, PREPARED_BY => 0 );
		$sql=$sql_2+$sql;
	}
	$count = count($sql);
	$td_width = floor($width / $count);
	$standard_width = $count * 150;
	if ($standard_width > $width) {
		$td_width = 150;
	}
	$no_coloumn_per_tr = floor($width / $td_width);
	$i = 1;
	if ($count == 0) {$message = "<b>Note: This is Software Generated Copy , Signature is not Required.</b>";}
	echo '<table cellspacing="5" id="signatureTblId" width="' . $width . '" style="padding-top:' . $padding_top . 'px;"><tr><td width="100%" height="' . $padding_top . '" colspan="' . $count . '">' . $message . '</td></tr>';
	$flag=0;
	foreach ($sql as $row) {
		$flag++;
		$sigHtml='';
		if($userSignatureArr[$row['USER_ID']]){$sigHtml='<img src="'.$userSignatureArr[$row['USER_ID']].'" height="60" width="180">';}
		else{$sigHtml='<div height="40"></div>';}
		if($flag==1){echo "<tr>";}
		echo '<td width="' . $td_width . '" align="center" valign="top">
		<p style="min-height:40px;">'.$sigHtml.'</p>
		<strong>' . $row[csf("activities")] . '</strong><br>
		<strong style="text-decoration:overline">' . $row[csf("designation")] . "</strong><br>" . $row[csf("name")] . '</td>';
		if($flag==$break_tr || $count==$i){echo "</tr>";$flag=0;}
		$i++;
	}
	echo '</table>';
	}?>
	<p style="page-break-after:always;"></p>
	<?
	$part[8]=ob_get_contents();ob_end_clean();
	ob_start();//part 9;
	$part[9]=ob_get_contents();ob_end_clean();
	$html='';
	foreach(explode(',',str_replace("'","",$print_option_id)) as $part_id)
	{
		$html.=$part[$part_id];
	}
	if($html!=''){echo $part[0].$html.$part[9];}else{echo $part[0].$part[1].$part[2].$part[3].$part[4].$part[5].$part[6].$part[7].$part[8].$part[9];};
	exit();
}//end master if condition-------------------------------------------------------


