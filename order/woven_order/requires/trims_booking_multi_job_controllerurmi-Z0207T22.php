<?
/*-------------------------------------------- Comments
Version (MySql)          :  V2
Version (Oracle)         :  V1
Converted by             :  Aziz
Purpose			         :  This form will create Trims Booking Multi Job Wise
Functionality	         :
JS Functions	         :
Created by		         :  Monzu
Creation date 	         :  17-1-2016
Requirment Client        :  Urmi
Requirment By            :
Requirment type          :
Requirment               :
Affected page            :
Affected Code            :
DB Script                :
Updated by 		         :
Update date		         :
QC Performed BY	         :
QC Date			         :
Comments		         :
*/
header('Content-type:text/html; charset=utf-8');
session_start();
if( $_SESSION['logic_erp']['user_id'] == "" ) header("location:login.php");
include('../../../includes/common.php');
include('../../../includes/class4/class.conditions.php');
include('../../../includes/class4/class.reports.php');
include('../../../includes/class4/class.trims.php');
$data=$_REQUEST['data'];
$action=$_REQUEST['action'];
$permission=$_SESSION['page_permission'];
$buyer_cond=set_user_lavel_filtering(' and buy.id','buyer_id');
$company_cond=set_user_lavel_filtering(' and comp.id','company_id');


function signature_table1($report_id, $company, $width, $template_id="", $padding_top = 70,$prepared_by='') {
	if ($template_id != '') {
		$template_id = " and template_id=$template_id ";
	}
	$sql = sql_select("select designation,name,activities,prepared_by from variable_settings_signature where report_id=$report_id and company_id=$company   and status_active=1  $template_id order by sequence_no");


	if($sql[0][csf("prepared_by")]==1){
		list($prepared_by,$activities)=explode('**',$prepared_by);
		$sql_2[100] = array ( DESIGNATION => 'Prepared By' ,NAME => $prepared_by, ACTIVITIES =>$activities, PREPARED_BY => 0 );
		$sql=$sql_2+$sql;
	}

	$count = count($sql);
	$td_width = floor($width / $count);
	$standard_width = $count * 150;
	if ($standard_width > $width) {
		$td_width = 150;
	}
	$no_coloumn_per_tr = floor($width / $td_width);
	$i = 1;
	if ($count == 0) {$message = "<b>Note: This is Software Generated Copy , Signature is not Required.</b>";}
	$signature_data = '<table id="signatureTblId" width="' . $width . '" style="padding-top:' . $padding_top . 'px;"><tr><td width="100%" height="' . $padding_top . '" colspan="' . $count . '">' . $message . '</td></tr><tr>';
	foreach ($sql as $row) {
		$signature_data .= '<td width="' . $td_width . '" align="center" valign="top">
		<strong>' . $row[csf("activities")] . '</strong><br>
		<strong style="text-decoration:overline">' . $row[csf("designation")] . "</strong><br>" . $row[csf("name")] . '</td>';
		if ($i % $no_coloumn_per_tr == 0) {
			$signature_data .= '</tr><tr><td width="100%" height="70" colspan="' . $no_coloumn_per_tr . '"></td></tr>';
		}
		$i++;
	}
	$signature_data .= '</tr></table>';
	return $signature_data;
}


//---------------------------------------------------- Start---------------------------------------------------------------------------
function load_drop_down_supplier($data){
	$data=explode("_",$data);
	$pay_mode_id=$data[0];
	$tag_buyer_id=$data[1];
	$tag_comp_id=$data[2];
	if($pay_mode_id==5 || $pay_mode_id==3){
	   echo create_drop_down( "cbo_supplier_name", 172, "select id,company_name from lib_company where status_active=1 and is_deleted=0 order by company_name", "id,company_name",1, "-- Select Company --", "", "get_php_form_data( this.value, 'load_drop_down_attention', 'requires/trims_booking_multi_job_controllerurmi');",0,"" );
	}
	else
	{
		$tag_buyer=return_field_value("tag_buyer as tag_buyer", "lib_supplier_tag_buyer", "tag_buyer=$tag_buyer_id","tag_buyer");
		if($tag_buyer!='')
		{
			$tag_by_buyer=sql_select("SELECT supplier_id from lib_supplier_tag_buyer where tag_buyer = $tag_buyer_id group by supplier_id");
			foreach ($tag_by_buyer as $row) {
				$supplier_arr2[$row[csf('supplier_id')]] = $row[csf('supplier_id')];
			}
			$supplier_string2=implode(',', $supplier_arr2);
			$tag_another_buyer=sql_select("SELECT supplier_id from lib_supplier_tag_buyer where tag_buyer != $tag_buyer_id and supplier_id not in ($supplier_string2) group by supplier_id");
			foreach ($tag_another_buyer as $row) {
				$supplier_arr[$row[csf('supplier_id')]] = $row[csf('supplier_id')];
			}
			//$supplier_string=implode(',', $supplier_arr);
			function where_con_not_in_using_array($arrayData,$dataType=0,$table_coloum){
				$chunk_list_arr=array_chunk($arrayData,999);
				$p=1;
				foreach($chunk_list_arr as $process_arr)
				{
					if($dataType==0){
						if($p==1){$sql .=" and (".$table_coloum." not in(".implode(',',$process_arr).")"; }
						else {$sql .=" or ".$table_coloum." not in(".implode(',',$process_arr).")";}
					}
					else{
						if($p==1){$sql .=" and (".$table_coloum." not in('".implode("','",$process_arr)."')"; }
						else {$sql .=" or ".$table_coloum." not in('".implode("','",$process_arr)."')";}
					}
					$p++;
				}
				
				$sql.=") ";
				return $sql;
			}
			$supplier_string='';
			if(count($supplier_arr))
			{
				$supplier_string=where_con_not_in_using_array($supplier_arr,0,"c.id");
			}
			$tag_buy_supp="select c.supplier_name,c.id from lib_supplier_tag_company a, lib_supplier_party_type b, lib_supplier c where c.id=b.supplier_id and a.supplier_id = b.supplier_id and b.party_type in (4,5) and a.tag_company='$tag_comp_id' and c.status_active=1 and c.is_deleted=0 $supplier_string group by c.id, c.supplier_name order by c.supplier_name";
			//echo $tag_buy_supp; die;
			//$tag_buy_supp="select c.supplier_name,c.id from lib_supplier_tag_company a, lib_supplier_party_type b, lib_supplier c,lib_supplier_tag_buyer d where c.id=b.supplier_id and a.supplier_id = b.supplier_id and d.supplier_id=c.id and d.supplier_id=a.supplier_id  and d.supplier_id=b.supplier_id and b.party_type  in (4,5) and a.tag_company='$tag_comp_id' and c.status_active=1 and c.is_deleted=0  and d.tag_buyer=$tag_buyer group by c.id, c.supplier_name order by c.supplier_name";
		}
		else
		{
			$tag_buy_supp="select c.supplier_name,c.id from lib_supplier_tag_company a, lib_supplier_party_type b, lib_supplier c where c.id=b.supplier_id and a.supplier_id = b.supplier_id and b.party_type in (4,5) and a.tag_company='$tag_comp_id' and c.status_active=1 and c.is_deleted=0 group by c.id, c.supplier_name order by c.supplier_name";
		}
		//echo $tag_buy_supp;
		$cbo_supplier_name= create_drop_down( "cbo_supplier_name", 172, $tag_buy_supp,"id,supplier_name", 1, "--Select Supplier--",$selected,"get_php_form_data( this.value, 'load_drop_down_attention', 'requires/trims_booking_multi_job_controllerurmi');","");
	}
	return $cbo_supplier_name;
	exit();
}

if ($action=="send_mail_report_setting_first_select"){
	$print_report_format=return_field_value("format_id","lib_report_template","template_name ='".$data."' and module_id=2 and report_id in(26) and is_deleted=0 and status_active=1");
	echo $print_report_format;
	exit();
}


if ($action=="populate_variable_setting_data"){
	$data_array=sql_select("select exeed_budge_qty,exeed_budge_amount,amount_exceed_level from variable_order_tracking where company_name='$data' and item_category_id=4 and variable_list=26 and status_active=1 and is_deleted=0");
	foreach ($data_array as $row){
		echo "document.getElementById('exeed_budge_qty').value = '".$row[csf("exeed_budge_qty")]."';\n";
		echo "document.getElementById('exeed_budge_amount').value = '".$row[csf("exeed_budge_amount")]."';\n";
		echo "document.getElementById('amount_exceed_level').value = '".$row[csf("amount_exceed_level")]."';\n";
	}
//	echo "select c.supplier_name,c.id from lib_supplier_tag_company a, lib_supplier_party_type b, lib_supplier c where c.id=b.supplier_id and a.supplier_id = b.supplier_id and a.tag_company='$data' and b.party_type=4 and c.status_active=1 and c.is_deleted=0 group by c.id, c.supplier_name order by c.supplier_name";
	$cbo_supplier_name     = create_drop_down( "cbo_supplier_name", 172, "select c.supplier_name,c.id from lib_supplier_tag_company a, lib_supplier_party_type b, lib_supplier c where c.id=b.supplier_id and a.supplier_id = b.supplier_id and a.tag_company='$data' and b.party_type in (4,5) and c.status_active=1 and c.is_deleted=0 group by c.id, c.supplier_name order by c.supplier_name","id,supplier_name", 1, "--Select Supplier--",$selected,"get_php_form_data( this.value, \'load_drop_down_attention\', \'requires/trims_booking_multi_job_controllerurmi\');","");
	$cbo_buyer_name= create_drop_down( "cbo_buyer_name", 172, "select buy.id,buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company='$data' $buyer_cond and buy.id in (select  buyer_id from  lib_buyer_party_type where party_type in (1,3,21,90)) order by buyer_name","id,buyer_name", 1, "-- Select Buyer --", $selected,"check_paymode(this.value);","");

	echo "document.getElementById('supplier_td').innerHTML = '".$cbo_supplier_name."';\n";
	echo "document.getElementById('buyer_td').innerHTML = '".$cbo_buyer_name."';\n";
	$print_report_format=return_field_value("format_id","lib_report_template","template_name ='".$data."' and module_id=2 and report_id in(26) and is_deleted=0 and status_active=1");
	echo "document.getElementById('report_ids').value = '".$print_report_format."';\n";
	echo "print_report_button_setting('".$print_report_format."');\n";
	$sql_result=sql_select("select tna_integrated from variable_order_tracking where company_name='$data' and variable_list=14 and status_active=1 and is_deleted=0");
	$maintain_setting=$sql_result[0][csf('tna_integrated')];
	if($maintain_setting==1) {
		echo "document.getElementById('lib_tna_intregrate').value = '1';\n";
	}
	else {
		echo "document.getElementById('lib_tna_intregrate').value = '0';\n";
	}
	exit();
}

if ($action=="load_drop_down_buyer"){
	echo create_drop_down( "cbo_buyer_name", 172, "select buy.id,buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company='$data' $buyer_cond  and buy.id in (select  buyer_id from  lib_buyer_party_type where party_type in (1,3,21,90)) group by buy.id,buy.buyer_name  order by buyer_name","id,buyer_name", 1, "-- Select Buyer --", $selected, "check_paymode(this.value);","" );
	exit();
}

if ($action=="load_drop_down_buyer_pop"){
	echo create_drop_down( "cbo_buyer_name", 130, "select buy.id,buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company='$data' $buyer_cond  and buy.id in (select  buyer_id from  lib_buyer_party_type where party_type in (1,3,21,90)) group by  buy.id,buy.buyer_name order by buyer_name","id,buyer_name", 1, "--Select Buyer--", $selected, "","" );
	exit();
}

if ($action=="load_drop_down_supplier"){
	echo $action($data);
	exit();
}

if($action=="load_drop_down_attention"){
	$supplier_name=return_field_value("contact_person","lib_supplier","id ='".$data."' and is_deleted=0 and status_active=1");
	echo "document.getElementById('txt_attention').value = '".$supplier_name."';\n";
	exit();
}

if ($action=="fnc_process_data"){
	echo load_html_head_contents("Booking Search","../../../", 1, 1, $unicode);
	extract($_REQUEST);
	//echo $str_data;
	$buyer_arr=return_library_array("select id, short_name from lib_buyer",'id','short_name');
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$from_date = '';
	$to_date = '';
	$date_disabled ='';
	if($cbo_booking_month != 0 && $cbo_booking_year !=0)
	{
		$booking_month=0;
		if($cbo_booking_month<10) $booking_month.=$cbo_booking_month; else $booking_month=$cbo_booking_month;
		$start_date="01-".$booking_month."-".$cbo_booking_year;
		$end_date=cal_days_in_month(CAL_GREGORIAN, $booking_month, $cbo_booking_year)."-".$booking_month.'-'.$cbo_booking_year;
		if($start_date != '' && $end_date != '' )
		{
			$from_date = $start_date;
			$to_date = $end_date;
			$date_disabled = 'disabled';
		}
	}

	?>
	<script>
	var cbo_level='<? echo $cbo_level; ?>';
	var po_job_level=cbo_level;
		function check_all_data() {
			var tbl_row_count = document.getElementById( 'tbl_list_search' ).rows.length;
			tbl_row_count = tbl_row_count-1;
			//alert(tbl_row_count)
			if(document.getElementById('check_all').checked==true)
			{
				po_job_level=1;
			}
			else if(document.getElementById('check_all').checked==false)
			{
				po_job_level=cbo_level;
			}
			for( var i = 1; i <= tbl_row_count; i++ ) {
				js_set_value( i );
			}
		}

		function toggle( x, origColor ) {
			//alert(x+'_'+origColor)
			var newColor = 'yellow';
			if ( x.style ) {
				x.style.backgroundColor = ( newColor == x.style.backgroundColor )? origColor : newColor;
			}
		}

		function onlyUnique(value, index, self) {
			return self.indexOf(value) === index;
		}

		var selected_id = new Array();
		var selected_name = new Array();
		var selected_item=new Array();
		var selected_po=new Array();

		function js_set_value( str ) {
			if($("#search"+str).css("display") !='none'){
				var select_row=0; var sp=1;
				if(po_job_level==1)
				{
					var select_row= str;
					sp=1;
				}
				else if(po_job_level==2)
				{
					var tbl_length =$('#tbl_list_search tr').length-1;
					var select_str=$('#txt_job_no' + str).val()+'_'+$('#hiddtrim_group' + str).val()+'_'+$('#td_item_des' + str).text();
					for(var i=1; i<=tbl_length; i++)
					{
						var string=$('#txt_job_no' + i).val()+'_'+$('#hiddtrim_group' + i).val()+'_'+$('#td_item_des' + i).text();
						if(select_str==string)
						{
							//alert(select_str+'='+string);
							if(select_row==0)
							{
								select_row=i; sp=1;
							}
							else
							{
								select_row+=','+i; sp=2;
							}
						}
					}
				}
				var exrow = new Array();
				if(sp==2) { exrow=select_row.split(','); var countrow=exrow.length; }
				else countrow=1;
				//alert(select_row)

				//alert(exrow)
				for(var m=0; m<countrow; m++)
				{
					if(sp==2) exrow[m]=exrow[m];
					else exrow[m]=select_row;
					//alert(exrow[m])
					toggle( document.getElementById( 'search' + exrow[m] ), '#FFFFCC' );
					if( jQuery.inArray( $('#txt_individual_id' + exrow[m]).val(), selected_id ) == -1 ) {
						selected_id.push( $('#txt_individual_id' + exrow[m]).val() );
						selected_name.push($('#txt_job_no' + exrow[m]).val());
						selected_item.push($('#txt_trim_group_id' + exrow[m]).val());
						selected_po.push($('#txt_po_id' + exrow[m]).val());
					}
					else{
						for( var i = 0; i < selected_id.length; i++ ) {
							if( selected_id[i] == $('#txt_individual_id' + exrow[m]).val() ) break;
						}
						selected_id.splice( i, 1 );
						selected_name.splice( i,1 );
						selected_item.splice( i,1 );
						selected_po.splice( i,1 );
					}
				}
				var id = ''; var job = ''; var txt_trim_group_id=''; var txt_po_id='';
				for( var i = 0; i < selected_id.length; i++ ) {
					id += selected_id[i] + ',';
					job += selected_name[i] + ',';
					txt_trim_group_id+=selected_item[i]+ ',';
					txt_po_id+=selected_po[i]+ ',';
				}
				id = id.substr( 0, id.length - 1 );
				job = job.substr( 0, job.length - 1 );
				txt_trim_group_id = txt_trim_group_id.substr( 0, txt_trim_group_id.length - 1 );
				txt_po_id = txt_po_id.substr( 0, txt_po_id.length - 1 );
				$('#txt_selected_id').val( id );
				$('#txt_job_id').val( job );
				$('#itemGroup').val( txt_trim_group_id );
				$('#txt_selected_po').val( txt_po_id );
			}
		}
	</script>
	</head>
	<body>
        <div align="center" style="width:100%;" >
            <input type="hidden" id="txt_booking" value="" />
            <form name="searchorderfrm_1"  id="searchorderfrm_1" autocomplete="off">
                <table width="850" cellspacing="0" cellpadding="0" border="1" class="rpt_table" align="center" rules="all">
                    <thead>
                        <tr>
                            <th width="100">Style Ref</th>
                            <th width="80">Job No</th>
                            <th width="100">Dealing Merchant</th>
                            <th width="80">Int. Ref. No</th>
                            <th width="100">Order No</th>
                            <th width="100">Item Name</th>
                            <th width="130" colspan="2">Pub. Ship Date Range</th>
                            <th>&nbsp;
                                <input type="hidden"  style="width:20px" name="txt_garments_nature" id="txt_garments_nature" value="<? echo $garments_nature;?>" />
                                <input type="hidden" name="cbo_booking_month" id="cbo_booking_month" value="<? echo $cbo_booking_month;?>" />
                                <input type="hidden" name="cbo_booking_year" id="cbo_booking_year" value="<? echo $cbo_booking_year;?>" />
                                <input type="hidden" name="cbo_company_name" id="cbo_company_name" value="<? echo $company_id;?>" />
                                <input type="hidden" style="width:20px" name="cbo_buyer_name" id="cbo_buyer_name" value="<? echo $cbo_buyer_name;?>" />
                                <input type="hidden" name="cbo_currency" id="cbo_currency" value="<? echo $cbo_currency;?>" />
                                <input type="hidden" name="txt_booking_date" id="txt_booking_date" value="<? //echo $txt_booking_date;?>" />
                                <input type="hidden" name="cbo_currency_job" id="cbo_currency_job" value="<? echo $cbo_currency_job;?>" />
                                <input type="hidden" style="width:20px" name="cbo_supplier_name" id="cbo_supplier_name" value="<? echo $cbo_supplier_name;?>" /> 
                                <input type="hidden" name="cbo_trim_type" id="cbo_trim_type" value="<? echo $cbo_trim_type;?>" />
                            </th>
                        </tr>
                    </thead>
                    <?
					//echo $cbo_trim_type.'DDDD';
                    if($cbo_trim_type==0) $trim_cond="";else  $trim_cond="and a.trim_type in($cbo_trim_type)";
					//echo  "select a.id,a.item_name from  lib_item_group a where  a.status_active =1 and a.is_deleted=0 and a.item_category=4 $trim_cond order by a.item_name";
					//echo "select a.id,a.item_name from  lib_item_group a where  a.status_active =1 and a.is_deleted=0 and a.item_category=4 $trim_cond order by a.item_name";
					?>
                    <tr class="general">
                        <td><input name="txt_style" id="txt_style" class="text_boxes" style="width:90px"></td>
                        <td><input name="txt_job" id="txt_job" class="text_boxes" style="width:70px"></td>
                        <td><? echo create_drop_down( "cbo_dealing_merchant", 100, "select id,team_member_name from lib_mkt_team_member_info where status_active =1 and is_deleted=0 group by id, team_member_name order by team_member_name ASC","id,team_member_name", 1, "-Deal. Merchant-", $selected, "" ); ?></td>
                        <td><input name="txt_ref_no" id="txt_ref_no" class="text_boxes" style="width:70px"></td>
                        <td><input name="txt_order_search" id="txt_order_search" class="text_boxes" style="width:90px"></td>
                        <td><? echo create_drop_down( "cbo_item", 100, "select a.id,a.item_name from  lib_item_group a where  a.status_active =1 and a.is_deleted=0 and a.item_category=4 $trim_cond order by a.item_name","id,item_name", 1, "-- Select Item Name --", $selected, "",0 ); ?></td>
                        <td><input name="txt_date_from" id="txt_date_from" class="datepicker" style="width:60px" placeholder="From" value="<? echo $from_date; ?>" <? //echo $date_disabled; ?>></td>
                        <td><input name="txt_date_to" id="txt_date_to" class="datepicker" style="width:60px" placeholder="To" value="<? echo $to_date; ?>" <? //echo $date_disabled; ?>></td>
                        <td>
                            <input type="button" name="button2" class="formbutton" value="Show" onClick="show_list_view ( document.getElementById('cbo_company_name').value+'_'+document.getElementById('cbo_buyer_name').value+'_'+document.getElementById('cbo_supplier_name').value+'_'+document.getElementById('cbo_booking_month').value+'_'+document.getElementById('cbo_booking_year').value+'_'+document.getElementById('cbo_year_selection').value+'_'+document.getElementById('cbo_currency').value+'_'+document.getElementById('cbo_currency_job').value+'_'+document.getElementById('txt_style').value+'_'+document.getElementById('txt_order_search').value+'_'+document.getElementById('txt_job').value+'_'+document.getElementById('cbo_item').value+'_'+document.getElementById('txt_ref_no').value+'_'+'<? echo $txt_booking_no; ?>'+'_'+'<? echo $cbo_level; ?>'+'_'+'<? echo $cbo_material_source; ?>'+'_'+document.getElementById('txt_date_from').value+'_'+document.getElementById('txt_date_to').value+'_'+document.getElementById('cbo_dealing_merchant').value+'_'+'<? echo $txt_booking_date; ?>'+'_'+'<? echo $cbo_trim_type; ?>'+'_'+'<? echo $cbo_source; ?>', 'create_fnc_process_data', 'search_div', 'trims_booking_multi_job_controllerurmi','setFilterGrid(\'tbl_list_search\',-1)')" style="width:60px;" />
                        </td>
                    </tr>
                    <tr>
                        <td colspan="9" align="center" valign="middle"><? echo load_month_buttons(1); ?></td>
                    <tr>
                </table>
            </form>
        </div>
        <div id="search_div"></div>
	</div>
	</body>
	<script src="../../../includes/functions_bottom.js" type="text/javascript"></script>
	</html>
	<?
	exit();
}

if ($action=="create_fnc_process_data")
{
	//echo load_html_head_contents("Booking Search","../../../", 1, 1, $unicode);
	//echo $data;
	//extract($_REQUEST);
	$data=explode('_',$data);
	$company_id=$data[0];
	$cbo_buyer_name=$data[1];
	$cbo_supplier_name=$data[2];
	$cbo_booking_month=$data[3];
	$cbo_booking_year=$data[4];
	$cbo_year_selection=$data[5];
	$cbo_currency=$data[6];
	$cbo_currency_job=$data[7];
	$txt_style=$data[8];
	$txt_order_search=$data[9];
	$txt_job=$data[10];
	$cbo_item=$data[11];
	$ref_no=$data[12];
	$booking_no=$data[13];
	$cbo_level=$data[14];
	$cbo_material_source=$data[15];
	$fromDate=$data[16];
	$toDate=$data[17];
	//echo $fromDate.'='.$toDate;
	$dealing_merchant=$data[18];
	$booking_date=$data[19];
	$trim_type=$data[20];
	$cbo_source=$data[21];
	//echo $trim_type;

	if($txt_style == '' && $txt_job == '' && $ref_no == '' && $txt_order_search == '' && $cbo_item ==0 && $dealing_merchant==0 && $fromDate == '' && $toDate =='')
	{
		echo "<span style='color:red; font-weight:bold; font-size:20px; text-align:center'>Please select any search data.";
		die;
	}

	if(str_replace("'","",$cbo_buyer_name)==0)
	{
		if ($_SESSION['logic_erp']["data_level_secured"]==1)
		{
			if($_SESSION['logic_erp']["buyer_id"]!="") $buyer_id_cond=" and a.buyer_name in (".$_SESSION['logic_erp']["buyer_id"].")"; else $buyer_id_cond="";
		}
		else $buyer_id_cond="";
	}
	else $buyer_id_cond=" and a.buyer_name=$cbo_buyer_name";

	if($db_type==0) $job_year_cond=" and SUBSTRING_INDEX(a.insert_date, '-', 1)=$cbo_year_selection"; else if($db_type==2) $job_year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year_selection";

	if ($txt_style!="") $style_cond=" and a.style_ref_no='$txt_style'"; else $style_cond=$txt_style;
	if ($txt_order_search!="") $order_cond=" and b.po_number='$txt_order_search'"; else $order_cond="";
	if ($ref_no!="") $ref_cond=" and b.grouping='$ref_no'"; else $ref_cond="";
	if ($txt_job!="") $job_cond=" and a.job_no_prefix_num='$txt_job'"; else $job_cond ="";
	if ($cbo_item!=0) $itemgroup_cond=" and b.trim_group=$cbo_item"; else $itemgroup_cond ="";
	if ($dealing_merchant!=0) $dealing_merchant_cond=" and a.dealing_marchant='$dealing_merchant'"; else $dealing_merchant_cond ="";

	$buyer_arr=return_library_array("select id, short_name from lib_buyer",'id','short_name');

	extract(check_magic_quote_gpc($_REQUEST));

	if($db_type==0)
	{
		$year_field="YEAR(a.insert_date)";
	}
	else if($db_type==2)
	{
		$year_field="to_char(a.insert_date,'YYYY')";
	}

	$shipment_date ="";
	$class_datecond ="";
	if ($fromDate!="" &&  $toDate!="")
	{
		if($db_type==0)
		{
			if ($fromDate!="" &&  $toDate!="") $shipment_date = "and b.pub_shipment_date between '".change_date_format($fromDate, "yyyy-mm-dd", "-")."' and '".change_date_format($toDate, "yyyy-mm-dd", "-")."'"; else $shipment_date ="";

			if ($fromDate!="" &&  $toDate!="") $class_datecond = "between '".change_date_format($fromDate, "yyyy-mm-dd", "-")."' and '".change_date_format($toDate, "yyyy-mm-dd", "-")."'"; else $class_datecond ="";

		}
		else if($db_type==2)
		{
			if ($fromDate!="" &&  $toDate!="") $shipment_date = "and b.pub_shipment_date between '".change_date_format($fromDate, "yyyy-mm-dd", "-",1)."' and '".change_date_format($toDate, "yyyy-mm-dd", "-",1)."'"; else $shipment_date ="";

			if ($fromDate!="" &&  $toDate!="") $class_datecond = "between '".change_date_format($fromDate, "yyyy-mm-dd", "-",1)."' and '".change_date_format($toDate, "yyyy-mm-dd", "-",1)."'"; else $class_datecond ="";
			//$year_field="to_char(a.insert_date,'YYYY')";
		}
	}
	else
	{
		//echo $start_date.'--'.$end_date; die;
		if($start_date!="" &&  $end_date!="")
		{
			if($db_type==0)
			{
				if ($start_date!="" &&  $end_date!="") $shipment_date = "and b.pub_shipment_date between '".change_date_format($start_date, "yyyy-mm-dd", "-")."' and '".change_date_format($end_date, "yyyy-mm-dd", "-")."'"; else $shipment_date ="";

				if ($start_date!="" &&  $end_date!="") $class_datecond = "between '".change_date_format($start_date, "yyyy-mm-dd", "-")."' and '".change_date_format($end_date, "yyyy-mm-dd", "-")."'"; else $class_datecond ="";
				 //$year_field="YEAR(a.insert_date)";
			}
			else if($db_type==2)
			{
				if ($start_date!="" &&  $end_date!="") $shipment_date = "and b.pub_shipment_date between '".change_date_format($start_date, "yyyy-mm-dd", "-",1)."' and '".change_date_format($end_date, "yyyy-mm-dd", "-",1)."'"; else $shipment_date ="";

				if ($start_date!="" &&  $end_date!="") $class_datecond = "between '".change_date_format($start_date, "yyyy-mm-dd", "-",1)."' and '".change_date_format($end_date, "yyyy-mm-dd", "-",1)."'"; else $class_datecond ="";
				//$year_field="to_char(a.insert_date,'YYYY')";
			}
		}

	}
	?>
	<input type="hidden" name="txt_selected_id" id="txt_selected_id" value="" />
	<input type="hidden" name="itemGroup" id="itemGroup" value="" />
	<input type="hidden" name="txt_job_id" id="txt_job_id" value="" />
	<input type="hidden" name="txt_selected_po" id="txt_selected_po" value="" />
	<table cellspacing="0" cellpadding="0" border="1" rules="all" width="1205" class="rpt_table"  >
        <thead>
            <th width="25">SL</th>
            <th width="50">Buyer</th>
            <th width="50">Year</th>
            <th width="50">Job No</th>
            <th width="60">File No</th>
            <th width="60">Ref. No</th>
            <th width="100">Style No</th>
            <th width="100">Ord. No</th>
            <th width="100">Trim Group</th>
            <th width="130">Desc.</th>
            <th width="70">Brand/ Sup.Ref</th>
            <th width="70">Req. Qty</th>
            <th width="45">UOM</th>
            <th width="70">CU WOQ</th>
            <th width="70">Bal WOQ</th>
            <th width="45">Exch. Rate</th>
            <th width="40">Rate</th>
            <th>Amount</th>
        </thead>
	</table>
	<div style="width:1225px; overflow-y:scroll; max-height:340px;" id="buyer_list_view" >
        <table cellspacing="0" cellpadding="0" border="1" rules="all" width="1205" class="rpt_table" id="tbl_list_search" >
        <?
        //echo $start_date.'='.$end_date;
		if($trim_type==0) $trimCond="";else $trimCond="and trim_type=$trim_type";
		//echo $trimCond;
        $lib_item_group_arr=array();
        $sql_lib_item_group=sql_select("select id, item_name,trim_type, conversion_factor, order_uom as cons_uom from lib_item_group where status_active=1 $trimCond");
		//echo "select id, item_name,trim_type, conversion_factor, order_uom as cons_uom from lib_item_group where status_active=1 $trimCond";
        foreach($sql_lib_item_group as $rowitem){
            $lib_item_group_arr[$rowitem[csf('id')]][item_name]=$rowitem[csf('item_name')];
            $lib_item_group_arr[$rowitem[csf('id')]][conversion_factor]=$rowitem[csf('conversion_factor')];
            $lib_item_group_arr[$rowitem[csf('id')]][cons_uom]=$rowitem[csf('cons_uom')];
			$trim_type_arr[$rowitem[csf('id')]]=$rowitem[csf('trim_type')];
			$lib_item_group_id_arr[$rowitem[csf('id')]]=$rowitem[csf('id')];
        }
        unset($sql_lib_item_group);
		if($trim_type)
		{
		$item_id=implode(",",$lib_item_group_id_arr);
		$item_id_cond="and b.trim_group in($item_id)";
		} else  $item_id_cond="";
		//echo $item_id.'SSS';
		

	    $exceed_qty_level=return_field_value("exceed_qty_level", "variable_order_tracking", "company_name=$company_id  and variable_list=26 and status_active=1 and is_deleted=0");
		if( $exceed_qty_level==0 || $exceed_qty_level==2 || $exceed_qty_level=="") $exceed_qty_level=2;else $exceed_qty_level=$exceed_qty_level;
		//echo $exceed_qty_level.'DDD';;die;
        $condition= new condition();
        if(str_replace("'","",$company_id) !=''){
            $condition->company_name("=$company_id");
        }
        if(str_replace("'","",$cbo_buyer_name) !=''){
            $condition->buyer_name("=$cbo_buyer_name");
        }
        if(str_replace("'","",$txt_job) !=''){
            $condition->job_no_prefix_num("=$txt_job");
        }
        if(str_replace("'","",$txt_order_search)!='')
        {
            $condition->po_number("='$txt_order_search'");
        }
		if(str_replace("'","",$fromDate)!='' && str_replace("'","",$toDate)!=''){
			   $condition->pub_shipment_date($class_datecond);
		 }
         if(str_replace("'","",$ref_no)!='')
         {
            $condition->grouping("='$ref_no'");
         }

        $condition->init();
        $trims= new trims($condition);
        //echo $trims->getQuery(); die;
        $req_qty_arr=$trims->getQtyArray_by_orderAndPrecostdtlsid();
        //$trims= new trims($condition);
        $req_amount_arr=$trims->getAmountArray_by_orderAndPrecostdtlsid();

		  $sql_job="select a.job_no_prefix_num, a.job_no, $year_field  as year, a.company_name, a.buyer_name, a.currency_id, a.style_ref_no, b.id, b.po_number, b.file_no, b.grouping, b.po_quantity as plan_cut from wo_po_details_master a, wo_po_break_down b where a.id=b.job_id and a.company_name=$company_id and b.shiping_status not in(3) $buyer_id_cond $job_cond $dealing_merchant_cond $order_cond $ref_cond $style_cond $job_year_cond $shipment_date ";
		//echo $sql_job;
		$sql_jobRes=sql_select($sql_job); $jobData_arr=array(); $tot_rows=0; $poIds=''; $jobNo='';
		foreach($sql_jobRes as $jrow)
		{
			$tot_rows++;
			$poIds.=$jrow[csf('id')].",";
			$jobNo.="'".$jrow[csf('job_no')]."',";
			$jobData_arr[$jrow[csf('id')]]['jobPre']=$jrow[csf('job_no_prefix_num')];
			$jobData_arr[$jrow[csf('id')]]['job_no']=$jrow[csf('job_no')];
			$jobData_arr[$jrow[csf('id')]]['year']=$jrow[csf('year')];
			$jobData_arr[$jrow[csf('id')]]['company_name']=$jrow[csf('company_name')];
			$jobData_arr[$jrow[csf('id')]]['buyer_name']=$jrow[csf('buyer_name')];
			$jobData_arr[$jrow[csf('id')]]['currency_id']=$jrow[csf('currency_id')];
			$jobData_arr[$jrow[csf('id')]]['style_ref_no']=$jrow[csf('style_ref_no')];
			$jobData_arr[$jrow[csf('id')]]['po_number']=$jrow[csf('po_number')];
			$jobData_arr[$jrow[csf('id')]]['file_no']=$jrow[csf('file_no')];
			$jobData_arr[$jrow[csf('id')]]['grouping']=$jrow[csf('grouping')];
			$jobData_arr[$jrow[csf('id')]]['plan_cut']=$jrow[csf('plan_cut')];
		}
		unset($sql_jobRes);

		$poIds=chop($poIds,','); $poIds_bom_cond=""; $poIds_booking_cond=""; $poIds_tna_cond="";
		if($db_type==2 && $tot_rows>1000)
		{
			$poIds_bom_cond=" and (";
			$poIds_booking_cond=" and (";
			$poIds_tna_cond=" and (";
			$poIdsArr=array_chunk(explode(",",$poIds),999);
			foreach($poIdsArr as $ids)
			{
				$ids=implode(",",$ids);
				$poIds_bom_cond.=" c.po_break_down_id in($ids) or ";
				$poIds_booking_cond.=" b.po_break_down_id in($ids) or ";
				$poIds_tna_cond.=" po_number_id in($ids) or ";
			}

			$poIds_bom_cond=chop($poIds_bom_cond,'or ');
			$poIds_bom_cond.=")";

			$poIds_booking_cond=chop($poIds_booking_cond,'or ');
			$poIds_booking_cond.=")";
			$poIds_tna_cond=chop($poIds_tna_cond,'or ');
			$poIds_tna_cond.=")";
		}
		else
		{
			$poIds_bom_cond=" and c.po_break_down_id in ($poIds)";
			$poIds_booking_cond=" and b.po_break_down_id in ($poIds)";
			$poIds_tna_cond=" and po_number_id in ($poIds)";
		}

		$jobNos=implode(",",array_filter(array_unique(explode(",",$jobNo))));

		$cu_booking_arr=array();
		$sql_cu_booking=sql_select("select b.pre_cost_fabric_cost_dtls_id, b.po_break_down_id, b.wo_qnty as cu_wo_qnty, b.amount as cu_amount from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and a.booking_type=2 and a.booking_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $poIds_booking_cond");
        foreach($sql_cu_booking as $rowcu){
            $cu_booking_arr[$rowcu[csf('pre_cost_fabric_cost_dtls_id')]][$rowcu[csf('po_break_down_id')]]['cu_wo_qnty']+=$rowcu[csf('cu_wo_qnty')];
            $cu_booking_arr[$rowcu[csf('pre_cost_fabric_cost_dtls_id')]][$rowcu[csf('po_break_down_id')]]['cu_amount']+=$rowcu[csf('cu_amount')];
        }
        unset($sql_cu_booking);
        

	$sql_supp="select trimid from wo_pre_cost_trim_supplier where job_no in ($jobNos) and supplier_id in($cbo_supplier_name) and is_deleted=0 and status_active=1";
		$sql_suppRes=sql_select( $sql_supp ); $trim_id="";
		foreach($sql_suppRes as $row)
		{
			$trim_id.=$row[csf('trimid')].",";
		}
		unset($sql_suppRes);
		$trim_ids=chop($trim_id,',');
		if($db_type==2)
		{
		if($trim_ids!="") $trim_idCond="and (b.id in ($trim_ids) or b.nominated_supp_multi is null)"; else $trim_idCond=" and (b.nominated_supp_multi is null or b.nominated_supp_multi=0)";
		}
		else
		{
			if($trim_ids!="") $trim_idCond="and (b.id in ($trim_ids) or b.nominated_supp_multi='')"; else $trim_idCond=" and b.nominated_supp_multi=''";
		}
		$tnasql=sql_select("select po_number_id,task_finish_date,task_number from tna_process_mst where    is_deleted= 0 and status_active=1 $poIds_tna_cond");
		//echo "select po_number_id,task_finish_date,task_number from tna_process_mst where    is_deleted= 0 and status_active=1 $poIds_tna_cond"; 

			foreach($tnasql as $tnarow){
			$task_finish_date_arr[$tnarow[csf('po_number_id')]][$tnarow[csf('task_number')]]=$tnarow[csf('task_finish_date')];
			}
			unset($tnasql);

				
			$tna_integrated=return_field_value("tna_integrated","variable_order_tracking","company_name='$company_id' and variable_list=14 and status_active=1 and is_deleted=0","tna_integrated");
			//echo $tna_integrated;

			$approval_allow=sql_select("select b.id, b.page_id, b.approval_need, b.allow_partial, b.validate_page,a.setup_date from approval_setup_mst a,approval_setup_dtls b where a.id=b.mst_id and a.company_id='$data[0]' and a.status_active=1 and b.page_id=25 and b.status_active=1 and b.is_deleted=0 order by b.id desc ");
			if($approval_allow[0][csf("approval_need")]==1 && $approval_allow[0][csf("allow_partial")]==1){
				$approval_cond="and a.approved in (1,2,3)";
			}else{
				
				if($approval_allow[0][csf("approval_need")]==2) // Issue Id=26656 for Libas
				{
					$approval_cond="";
				}
				else
				{
				$approval_cond="and a.approved in (1)";
				}
			}
			$source_cond='';
			if(!empty($cbo_source))
			{
				if($cbo_source*1==1)
				{
					$source_cond=" and b.source_id in (1,0)";
				}
				else{
					$source_cond=" and b.source_id in (2,0)";
				}
			}
			

		 	   $sql="SELECT a.costing_per, a.exchange_rate, b.id as wo_pre_cost_trim_cost_dtls, b.trim_group, b.description, b.brand_sup_ref, b.rate, min(c.id) as id, b.nominated_supp_multi, c.po_break_down_id, avg(c.cons) AS cons from wo_pre_cost_mst a,  wo_pre_cost_trim_co_cons_dtls c,wo_pre_cost_trim_cost_dtls b where a.job_no=b.job_no and a.job_no=c.job_no and b.id=c.wo_pre_cost_trim_cost_dtls_id   $approval_cond and c.cons>0 and b.is_deleted=0 and b.status_active=1 $itemgroup_cond $poIds_bom_cond $item_id_cond $source_cond group by a.costing_per, a.exchange_rate, b.id, b.trim_group, b.description, b.brand_sup_ref, b.rate, b.nominated_supp_multi,c.po_break_down_id order by c.po_break_down_id, b.id asc"; //$trim_idCond

        $i=1; $total_req=0; $total_amount=0;
		// echo $sql;
		//if($poIds_bom_cond!='') //Check Need for Shipment Status
		$nameArray=sql_select( $sql );

        foreach ($nameArray as $row)
        {
        	$supplier_arr = explode(",", $row[csf('nominated_supp_multi')]);
        	$supplier_arr_data=array();
        	if(count($supplier_arr) >0)
        	{
        		foreach ($supplier_arr as $value) {
        			$supplier_arr_data[$value]=$value;
        		}
        	}        	
			//echo $row[csf('nominated_supp_multi')].'SDD';
        	if(array_key_exists($cbo_supplier_name, $supplier_arr_data) || $row[csf('nominated_supp_multi')] =='' || $row[csf('nominated_supp_multi')] ==0)
        	{
        		//echo "joy".__LINE__; die;
        		if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				$poid=$row[csf('po_break_down_id')];
				//else echo "B";
				// echo "B,";
				$cbo_currency_job=$jobData_arr[$poid]['currency_id'];
				$exchange_rate=$row[csf('exchange_rate')];
				if($cbo_currency==$cbo_currency_job){
					$exchange_rate=1;
				}
				$req_qnty_cons_uom=$req_qty_arr[$poid][$row[csf('wo_pre_cost_trim_cost_dtls')]];
				$req_amount_cons_uom=$req_amount_arr[$poid][$row[csf('wo_pre_cost_trim_cost_dtls')]];
				$rate_cons_uom=$req_amount_cons_uom/$req_qnty_cons_uom;

				$req_qnty=def_number_format($req_qnty_cons_uom/$lib_item_group_arr[$row[csf('trim_group')]][conversion_factor],5,"");
				$cu_wo_qnty=def_number_format($cu_booking_arr[$row[csf('wo_pre_cost_trim_cost_dtls')]][$poid]['cu_wo_qnty'],5,"");
				$cu_wo_amnt=def_number_format($cu_booking_arr[$row[csf('wo_pre_cost_trim_cost_dtls')]][$poid]['cu_amount'],5,"");
				$bal_woq=$req_qnty-$cu_wo_qnty;

				$rate=def_number_format(($rate_cons_uom*$lib_item_group_arr[$row[csf('trim_group')]][conversion_factor])*$exchange_rate,5,"");
				$req_amount=def_number_format($req_qnty*$rate,5,"");

				$bal_wom=$req_amount-$cu_wo_amnt;

				$total_req_amount+=$req_amount;
				$total_cu_amount+=$row[csf('cu_amount')];

				$total_req+=$req_qnty;
				$amount=def_number_format($rate*$bal_woq,4,"");
				//-----------------------------------------TNA Check----------------------
			
				//echo $tna_integrated.', ';
				if($tna_integrated==1)
				{				
					$trim_type=$trim_type_arr[$row[csf('trim_group')]];
					if($trim_type==1) $task_num=70; else $task_num=71;
					$task_finish_date='';
					/*$tnasql=sql_select("select po_number_id,task_finish_date from tna_process_mst where task_number=$task_num and po_number_id in($poid) and is_deleted= 0 and status_active=1");

					foreach($tnasql as $tnarow){
						$task_finish_date_arr[$tnarow[csf('po_number_id')]]=$tnarow[csf('task_finish_date')];
					}
					$task_finish_date=$task_finish_date_arr[$poid];*/
					$task_finish_date=$task_finish_date_arr[$poid][$task_num];

					$sql_tna_lib=sql_select("select b.date_calc, b.day_status from lib_capacity_calc_mst a, lib_capacity_calc_dtls b where a.id=b.mst_id and a.comapny_id=$company_id and b.date_calc='$task_finish_date' and a.status_active=1 and a.is_deleted=0");

					$date_calc=$sql_tna_lib[0][csf("date_calc")];
					$day_status=$sql_tna_lib[0][csf("day_status")];

					if($day_status==2)
					{
						$task_finish_date=return_field_value("max(b.date_calc) as  date_calc ", " lib_capacity_calc_mst a, lib_capacity_calc_dtls b "," a.id=b.mst_id and a.comapny_id=$company_id and b.date_calc<'$task_finish_date' and a.status_active=1 and a.is_deleted=0 and b.day_status=1","date_calc");
					}
					else
					{
						$task_finish_date=$task_finish_date;
					}

					if($task_finish_date !='')
					{
						
						$txt_tna_date=change_date_format($task_finish_date,'dd-mm-yyyy','-');
					}
					else
					{
						
						$txt_tna_date="";
					}
					$booking_date=str_replace("'","",$booking_date);
					//echo strtotime($txt_tna_date).'='.strtotime($booking_date).'<br>';
					if(strtotime($booking_date)> strtotime($txt_tna_date) || $txt_tna_date=='')
					{
						$td_row_color="red";
						$tna_found="TNA Found";
					}
					else 
					{
						$td_row_color=$bgcolor;
						$tna_found="";
					}
				} //TNA END
				//echo __LINE__.'bal'.$bal_woq.'--'.$cu_wo_qnty.'--'.$exceed_qty_level.'--'.$cbo_material_source;die;
				
				if($bal_woq>0 && ($cu_wo_qnty=="" || $cu_wo_qnty==0) && $exceed_qty_level==2)
				{
					?>
					<tr bgcolor="<?=$td_row_color;?>" style="text-decoration:none; cursor:pointer" id="search<?=$i;?>" onClick="js_set_value(<?=$i;?>)">
						<td width="25"><?=$i;?>
							<input type="hidden" name="txt_individual_id" id="txt_individual_id<?php echo $i ?>" value="<?=$row[csf('id')];?>"/>
							<input type="hidden" name="txt_trim_group_id" id="txt_trim_group_id<?php echo $i ?>" value="<?=$row[csf('wo_pre_cost_trim_cost_dtls')];?>"/>
							<input type="hidden" name="txt_job_no" id="txt_job_no<?php echo $i ?>" value="<?=$jobData_arr[$poid]['job_no'];?>"/>
							<input type="hidden" name="txt_po_id" id="txt_po_id<?php echo $i ?>" value="<?=$poid;?>"/>
							<input type="hidden" name="hiddtrim_group" id="hiddtrim_group<?php echo $i ?>" value="<?=$row[csf('trim_group')];?>"/>
						</td>
						<td width="50" style="word-break:break-all"><?=$buyer_arr[$jobData_arr[$poid]['buyer_name']];?></td>
						<td width="50" style="word-break:break-all"><?=$jobData_arr[$poid]['year'];?></td>
						<td width="50" style="word-break:break-all"><?=$jobData_arr[$poid]['jobPre'];?></td>
						<td width="60" style="word-break:break-all"><?=$jobData_arr[$poid]['file_no'];?></td>
						<td width="60" style="word-break:break-all"><?=$jobData_arr[$poid]['grouping'];?></td>
						<td width="100" style="word-break:break-all"><?=$jobData_arr[$poid]['style_ref_no'];?></td>
						<td width="100" title="<? echo $tna_found;?>" style="word-break:break-all"><?=$jobData_arr[$poid]['po_number'];?></td>
						<td width="100" style="word-break:break-all"><?=$lib_item_group_arr[$row[csf('trim_group')]][item_name];?></td>
						<td width="130" style="word-break:break-all" id="td_item_des<?php echo $i; ?>"><?=$row[csf('description')];?></td>
						<td width="70" style="word-break:break-all"><?=$row[csf('brand_sup_ref')];?></td>
						<td width="70" style="word-break:break-all" align="right"><?=number_format($req_qnty, 4);?></td>
						<td width="45" style="word-break:break-all"><?=$unit_of_measurement[$lib_item_group_arr[$row[csf('trim_group')]][cons_uom]];?></td>
						<td width="70" style="word-break:break-all" align="right"><?=def_number_format($cu_wo_qnty, 5, "");?></td>
						<td width="70" style="word-break:break-all" align="right"><?=number_format($bal_woq, 4);?></td>
						<td width="45" style="word-break:break-all" align="right"><?=number_format($exchange_rate, 2);?></td>
						<td width="40" style="word-break:break-all" align="right"><?=number_format($rate, 4);?></td>
						<td style="word-break:break-all" align="right"><?=number_format($amount, 2);?></td>
					</tr>
					<?
					$i++;
					$total_amount+=$amount;
				}
				elseif($bal_woq>0 && $cu_wo_qnty>0) //>=1
				{
					?>
					<tr bgcolor="<?=$td_row_color;?>" style="text-decoration:none; cursor:pointer" id="search<?=$i;?>" onClick="js_set_value(<?=$i;?>)">
						<td width="25"><?=$i;?>
							<input type="hidden" name="txt_individual_id" id="txt_individual_id<?php echo $i ?>" value="<?=$row[csf('id')];?>"/>
							<input type="hidden" name="txt_trim_group_id" id="txt_trim_group_id<?php echo $i ?>" value="<?=$row[csf('wo_pre_cost_trim_cost_dtls')];?>"/>
							<input type="hidden" name="txt_job_no" id="txt_job_no<?php echo $i ?>" value="<?=$jobData_arr[$poid]['job_no'];?>"/>
							<input type="hidden" name="txt_po_id" id="txt_po_id<?php echo $i ?>" value="<?=$poid;?>"/>
							<input type="hidden" name="hiddtrim_group" id="hiddtrim_group<?php echo $i ?>" value="<?=$row[csf('trim_group')];?>"/>
						</td>
						<td width="50" style="word-break:break-all"><?=$buyer_arr[$jobData_arr[$poid]['buyer_name']];?></td>
						<td width="50" style="word-break:break-all"><?=$jobData_arr[$poid]['year'];?></td>
						<td width="50" style="word-break:break-all"><?=$jobData_arr[$poid]['jobPre'];?></td>
						<td width="60" style="word-break:break-all"><?=$jobData_arr[$poid]['file_no'];?></td>
						<td width="60" style="word-break:break-all"><?=$jobData_arr[$poid]['grouping'];?></td>
						<td width="100" style="word-break:break-all"><?=$jobData_arr[$poid]['style_ref_no'];?></td>
						<td width="100" style="word-break:break-all"><?=$jobData_arr[$poid]['po_number'];?></td>
						<td width="100" style="word-break:break-all"><?=$lib_item_group_arr[$row[csf('trim_group')]][item_name];?></td>
						<td width="130" style="word-break:break-all" id="td_item_des<?php echo $i; ?>"><?=$row[csf('description')];?></td>
						<td width="70" style="word-break:break-all"><?=$row[csf('brand_sup_ref')];?></td>
						<td width="70" style="word-break:break-all" align="right"><?=number_format($req_qnty, 4);?></td>
						<td width="45" style="word-break:break-all"><?=$unit_of_measurement[$lib_item_group_arr[$row[csf('trim_group')]][cons_uom]];?></td>
						<td width="70" style="word-break:break-all" align="right"><?=def_number_format($cu_wo_qnty, 5, "");?></td>
						<td width="70" style="word-break:break-all" align="right"><?=number_format($bal_woq, 4);?></td>
						<td width="45" style="word-break:break-all" align="right"><?=number_format($exchange_rate, 2);?></td>
						<td width="40" style="word-break:break-all" align="right"><?=number_format($rate, 4);?></td>
						<td style="word-break:break-all" align="right"><?=number_format($amount, 2);?></td>
					</tr>
					<?
					$i++;
					$total_amount+=$amount;
				}
				elseif($bal_wom>0  && $exceed_qty_level==1)
				{
					//echo $bal_wom.'='.$exceed_qty_level;die;
					?>
					<tr bgcolor="<?=$td_row_color;?>" style="text-decoration:none; cursor:pointer" id="search<?=$i;?>" onClick="js_set_value(<?=$i;?>)">
						<td width="25"><?=$i;?>
							<input type="hidden" name="txt_individual_id" id="txt_individual_id<?php echo $i ?>" value="<?=$row[csf('id')];?>"/>
							<input type="hidden" name="txt_trim_group_id" id="txt_trim_group_id<?php echo $i ?>" value="<?=$row[csf('wo_pre_cost_trim_cost_dtls')];?>"/>
							<input type="hidden" name="txt_job_no" id="txt_job_no<?php echo $i ?>" value="<?=$jobData_arr[$poid]['job_no'];?>"/>
							<input type="hidden" name="txt_po_id" id="txt_po_id<?php echo $i ?>" value="<?=$poid;?>"/>
							<input type="hidden" name="hiddtrim_group" id="hiddtrim_group<?php echo $i ?>" value="<?=$row[csf('trim_group')];?>"/>
						</td>
						<td width="50" style="word-break:break-all"><?=$buyer_arr[$jobData_arr[$poid]['buyer_name']];?></td>
						<td width="50" style="word-break:break-all"><?=$jobData_arr[$poid]['year'];?></td>
						<td width="50" style="word-break:break-all"><?=$jobData_arr[$poid]['jobPre'];?></td>
						<td width="60" style="word-break:break-all"><?=$jobData_arr[$poid]['file_no'];?></td>
						<td width="60" style="word-break:break-all"><?=$jobData_arr[$poid]['grouping'];?></td>
						<td width="100" style="word-break:break-all"><?=$jobData_arr[$poid]['style_ref_no'];?></td>
						<td width="100" style="word-break:break-all"><?=$jobData_arr[$poid]['po_number'];?></td>
						<td width="100" style="word-break:break-all"><?=$lib_item_group_arr[$row[csf('trim_group')]][item_name];?></td>
						<td width="130" style="word-break:break-all" id="td_item_des<?php echo $i; ?>"><?=$row[csf('description')];?></td>
						<td width="70" style="word-break:break-all"><?=$row[csf('brand_sup_ref')];?></td>
						<td width="70" style="word-break:break-all" align="right"><?=number_format($req_qnty, 4);?></td>
						<td width="45" style="word-break:break-all"><?=$unit_of_measurement[$lib_item_group_arr[$row[csf('trim_group')]][cons_uom]];?></td>
						<td width="70" style="word-break:break-all" align="right"><?=def_number_format($cu_wo_qnty, 5, "");?></td>
						<td width="70" style="word-break:break-all" align="right"><?=number_format($bal_woq, 4);?></td>
						<td width="45" style="word-break:break-all" align="right"><?=number_format($exchange_rate, 2);?></td>
						<td width="40" style="word-break:break-all" align="right"><?=number_format($rate, 4);?></td>
						<td style="word-break:break-all" align="right"><?=number_format($amount, 2);?></td>
					</tr>
					<?
					$i++;
					$total_amount+=$amount;
				}
				elseif($bal_woq>0  && $cbo_material_source==3)
				{
					//echo $bal_wom.'='.$exceed_qty_level;die;
					?>
					<tr bgcolor="<?=$td_row_color;?>" style="text-decoration:none; cursor:pointer" id="search<?=$i;?>" onClick="js_set_value(<?=$i;?>)">
						<td width="25"><?=$i;?>
							<input type="hidden" name="txt_individual_id" id="txt_individual_id<?php echo $i ?>" value="<?=$row[csf('id')];?>"/>
							<input type="hidden" name="txt_trim_group_id" id="txt_trim_group_id<?php echo $i ?>" value="<?=$row[csf('wo_pre_cost_trim_cost_dtls')];?>"/>
							<input type="hidden" name="txt_job_no" id="txt_job_no<?php echo $i ?>" value="<?=$jobData_arr[$poid]['job_no'];?>"/>
							<input type="hidden" name="txt_po_id" id="txt_po_id<?php echo $i ?>" value="<?=$poid;?>"/>
							<input type="hidden" name="hiddtrim_group" id="hiddtrim_group<?php echo $i ?>" value="<?=$row[csf('trim_group')];?>"/>
						</td>
						<td width="50" style="word-break:break-all"><?=$buyer_arr[$jobData_arr[$poid]['buyer_name']];?></td>
						<td width="50" style="word-break:break-all"><?=$jobData_arr[$poid]['year'];?></td>
						<td width="50" style="word-break:break-all"><?=$jobData_arr[$poid]['jobPre'];?></td>
						<td width="60" style="word-break:break-all"><?=$jobData_arr[$poid]['file_no'];?></td>
						<td width="60" style="word-break:break-all"><?=$jobData_arr[$poid]['grouping'];?></td>
						<td width="100" style="word-break:break-all"><?=$jobData_arr[$poid]['style_ref_no'];?></td>
						<td width="100" style="word-break:break-all"><?=$jobData_arr[$poid]['po_number'];?></td>
						<td width="100" style="word-break:break-all"><?=$lib_item_group_arr[$row[csf('trim_group')]][item_name];?></td>
						<td width="130" style="word-break:break-all" id="td_item_des<?php echo $i; ?>"><?=$row[csf('description')];?></td>
						<td width="70" style="word-break:break-all"><?=$row[csf('brand_sup_ref')];?></td>
						<td width="70" style="word-break:break-all" align="right"><?=number_format($req_qnty, 4);?></td>
						<td width="45" style="word-break:break-all"><?=$unit_of_measurement[$lib_item_group_arr[$row[csf('trim_group')]][cons_uom]];?></td>
						<td width="70" style="word-break:break-all" align="right"><?=def_number_format($cu_wo_qnty, 5, "");?></td>
						<td width="70" style="word-break:break-all" align="right"><?=number_format($bal_woq, 4);?></td>
						<td width="45" style="word-break:break-all" align="right"><?=number_format($exchange_rate, 2);?></td>
						<td width="40" style="word-break:break-all" align="right"><?=number_format($rate, 4);?></td>
						<td style="word-break:break-all" align="right"><?=number_format($amount, 2);?></td>
					</tr>
					<?
					$i++;
					$total_amount+=$amount;
				}
			}
        }
        ?>
        </table>
        <table cellspacing="0" cellpadding="0" border="1" rules="all" width="1205" class="rpt_table">
        	<tfoot>
                <th width="25">&nbsp;</th>
                <th width="50">&nbsp;</th>
                <th width="50">&nbsp;</th>
                <th width="50">&nbsp;</th>
                <th width="60">&nbsp;</th>
                <th width="60">&nbsp;</th>
                <th width="100">&nbsp;</th>
                <th width="100">&nbsp;</th>
                <th width="100">&nbsp;</th>
                <th width="130">&nbsp;</th>
                <th width="70">&nbsp;</th>
                <th width="70" id="value_total_req"></th>
                <th width="45"><input type="hidden" style="width:40px"  id="txt_tot_req_amount" value="<?=number_format($total_req_amount, 2);?>" /></th>
                <th width="70"><input type="hidden" style="width:40px" id="txt_tot_cu_amount" value="<?=number_format($total_cu_amount, 2);?>" /></th>
                <th width="70">&nbsp;</th>
                <th width="45">&nbsp;</th>
                <th width="40">&nbsp;</th>
                <th id="value_total_amount"><?=number_format($total_amount, 2);?></th>
            </tfoot>
        </table>
	</div>
	<table width="1205" cellspacing="0" cellpadding="0" style="border:none" align="center">
        <tr>
            <td align="center" height="30" valign="bottom">
                <div style="width:100%">
                    <div style="width:50%; float:left" align="left">
                    	<input type="checkbox" name="check_all" id="check_all" onClick="check_all_data()" /> Check / Uncheck All
                    </div>
                    <div style="width:50%; float:left" align="left">
                    	<input type="button" name="close" onClick="parent.emailwindow.hide();" class="formbutton" value="Close" style="width:100px" />
                    </div>
                </div>
            </td>
        </tr>
	</table>
	<script>
		var tableFilters = {
			col_operation: {
				id: ["value_total_req","value_total_amount"],
				col: [11,17],
				operation: ["sum","sum"],
				write_method: ["innerHTML","innerHTML"]
			}
		}
		setFilterGrid('tbl_list_search',-1,tableFilters)
	</script>
	</div>
	</div>
	</body>
	<script src="../../../includes/functions_bottom.js" type="text/javascript"></script>
	</html>
	<?
	exit();
}

if ($action=="generate_fabric_booking")
{
	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	//$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	/*$trms_sql=sql_select("select id, trim_type, item_name from lib_item_group");
	foreach($trms_sql as $row)
	{
		$trim_group_library[$row[csf('id')]]=$row[csf('item_name')];
		$trim_type_arr[$row[csf('id')]]=$row[csf('trim_type')];
	}*/
	$booking_month=0;
	if($cbo_booking_month<10) $booking_month.=$cbo_booking_month; else $booking_month=$cbo_booking_month;
	if($garments_nature==0) $garment_nature_cond=""; else $garment_nature_cond=" and a.garments_nature=$garments_nature";

	$start_date=$cbo_booking_year."-".$booking_month."-01";
	$end_date=$cbo_booking_year."-".$booking_month."-".cal_days_in_month(CAL_GREGORIAN, $booking_month, $cbo_booking_year);
	$param=implode(",",array_unique(explode(",",str_replace("'","",$param))));
	$data=implode(",",array_unique(explode(",",str_replace("'","",$data))));
	$pre_cost_id=implode(",",array_unique(explode(",",str_replace("'","",$pre_cost_id))));
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$cbo_pay_mode=str_replace("'","",$cbo_pay_mode);
	$tna_integrated=return_field_value("tna_integrated","variable_order_tracking","company_name='$cbo_company_name' and variable_list=14 and status_active=1 and is_deleted=0","tna_integrated");
	$tnasql=sql_select("select task_number, po_number_id, task_finish_date from tna_process_mst where po_number_id in($data) and is_deleted= 0 and status_active=1");
	$tnataskfinishArr=array();
	foreach($tnasql as $trow)
	{
		$tnataskfinishArr[$trow[csf('task_number')]][$trow[csf('po_number_id')]]=$trow[csf('task_finish_date')];
	}
	unset($tnasql);

	$sql_lib_item_group_array=array();
	$sql_lib_item_group=sql_select("select id, item_name, conversion_factor, order_uom as cons_uom, hs_code, trim_type from lib_item_group");
	foreach($sql_lib_item_group as $row_sql_lib_item_group){
		$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][item_name]=$row_sql_lib_item_group[csf('item_name')];
		$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][conversion_factor]=$row_sql_lib_item_group[csf('conversion_factor')];
		$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][cons_uom]=$row_sql_lib_item_group[csf('cons_uom')];
		$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][hs_code]=$row_sql_lib_item_group[csf('hs_code')];
		$trim_type_arr[$row_sql_lib_item_group[csf('id')]]=$row_sql_lib_item_group[csf('trim_type')];
		$trim_group_library[$row_sql_lib_item_group[csf('id')]]=$row_sql_lib_item_group[csf('item_name')];
	}
	$exchange_rate_conversion = set_conversion_rate($cbo_currency, $txt_booking_date);//Conversion Exchance From Lib

	$condition= new condition();
	if(str_replace("'","",$data) !=''){
		$condition->po_id("in($data)");
	}

	$condition->init();
	$trims= new trims($condition);
	$req_qty_arr=$trims->getQtyArray_by_orderAndPrecostdtlsid();
	$req_amount_arr=$trims->getAmountArray_by_orderAndPrecostdtlsid();
	$reqAmountJobLevelArr=$trims->getAmountArray_by_job();
	$cu_booking_arr=array();
	$sql_cu_booking=sql_select("select c.job_no,c.pre_cost_fabric_cost_dtls_id,c.po_break_down_id, sum(c.wo_qnty) as cu_wo_qnty, sum(c.amount) as cu_amount from wo_po_details_master a, wo_po_break_down  d, wo_booking_dtls c, wo_booking_mst e where a.job_no=d.job_no_mst and e.booking_no=c.booking_no and a.job_no=c.job_no and  d.id=c.po_break_down_id and a.company_name=$cbo_company_name $shipment_date and c.status_active=1 and c.is_deleted=0 and e.status_active=1 and e.is_deleted=0 and c.booking_type=2 and c.pre_cost_fabric_cost_dtls_id in($pre_cost_id)  group by c.job_no, c.pre_cost_fabric_cost_dtls_id, c.po_break_down_id");
	foreach($sql_cu_booking as $row_cu_booking)
	{
		$cu_booking_arr[$row_cu_booking[csf('job_no')]][$row_cu_booking[csf('pre_cost_fabric_cost_dtls_id')]]['cu_woq'][$row_cu_booking[csf('po_break_down_id')]] = $row_cu_booking[csf('cu_wo_qnty')];
		$cu_booking_arr[$row_cu_booking[csf('job_no')]][$row_cu_booking[csf('pre_cost_fabric_cost_dtls_id')]]['cu_amount'][$row_cu_booking[csf('po_break_down_id')]] = $row_cu_booking[csf('cu_amount')];
	}
	unset ($sql_cu_booking);
	
	$powiseCostingPerReqQtyArr=array();
	foreach ($req_amount_arr as $poid=>$podata)
	{
		foreach ($podata as $bomid=>$bomdata)
		{
			$powiseCostingPerReqQtyArr[$bomid][$poid]['amt']+=$bomdata;
		}
	}
	//print_r($powiseCostingPerReqQtyArr[34805][60978]);
	
	

	$sql="select a.job_no_prefix_num, a.job_no, a.company_name, a.buyer_name, a.currency_id, a.style_ref_no, b.costing_per, b.exchange_rate, c.id as wo_pre_cost_trim_cost_dtls, c.trim_group, c.description, c.brand_sup_ref, c.country, c.rate, c.amount, d.id as po_id, d.po_number, d.po_quantity as plan_cut, min(e.id) as id, e.po_break_down_id, avg(e.cons) as cons

	from wo_po_details_master a, wo_pre_cost_mst b, wo_pre_cost_trim_cost_dtls c, wo_po_break_down d, wo_pre_cost_trim_co_cons_dtls e

	where a.job_no=b.job_no and a.job_no=c.job_no and a.job_no=d.job_no_mst and a.job_no=e.job_no and c.id=e.wo_pre_cost_trim_cost_dtls_id and d.id=e.po_break_down_id and a.company_name=$cbo_company_name $garment_nature_cond and e.id in($param) and e.po_break_down_id in($data) and c.id in($pre_cost_id) and d.is_deleted=0 and d.status_active=1

	group by a.job_no_prefix_num, a.job_no, a.company_name, a.buyer_name, a.currency_id, a.style_ref_no, b.costing_per, b.exchange_rate, c.id, c.trim_group, c.description, c.brand_sup_ref, c.country, c.rate, c.amount, d.id, d.po_number, d.po_quantity, e.po_break_down_id order by d.id,c.id";

	$i=1; $job_and_trimgroup_level=array();
	$nameArray=sql_select( $sql ); $job_noArr=array();
	/*foreach ($nameArray as $row)
	{
		$job_noArr[$row[csf('job_no')]]="'".$row[csf('job_no')]."'";
	}
	$txt_job_no=implode(",",$job_noArr); $item_ratio_array=array();
	if($txt_job_no!="")
	{
		$item_ratiodata=sql_select("select job_no, gmts_item_id, set_item_ratio from wo_po_details_mas_set_details where job_no in ($txt_job_no)");
		foreach ($item_ratiodata as $irow)
		{
			$item_ratio_array[$irow[csf('job_no')]][$irow[csf('gmts_item_id')]]=$irow[csf('set_item_ratio')];
		}
		unset($item_ratiodata);
	}*/
	
	if($cbo_level==2)
	{
		foreach ($nameArray as $row)
		{
			$cbo_currency_job=$row[csf('currency_id')];
			$exchange_rate=$row[csf('exchange_rate')];//$exchange_rate_conversion;//
			if($cbo_currency==$cbo_currency_job) $exchange_rate=1;
			$job_no=$row[csf('job_no')];
			$trim_cost_dtls_id=$row[csf('wo_pre_cost_trim_cost_dtls')];
			$po_id=$row[csf('po_id')];

			$req_qnty_cons_uom=$req_qty_arr[$po_id][$trim_cost_dtls_id];
			$req_amount_cons_uom=$req_amount_arr[$po_id][$trim_cost_dtls_id];
			$rate_cons_uom=$req_amount_cons_uom/$req_qnty_cons_uom;

			$req_qnty_ord_uom=def_number_format($req_qnty_cons_uom/$sql_lib_item_group_array[$row[csf('trim_group')]][conversion_factor],3,"");
			$rate_ord_uom=def_number_format(($rate_cons_uom*$sql_lib_item_group_array[$row[csf('trim_group')]][conversion_factor])*$exchange_rate,3,"");
			$req_amount_ord_uom=def_number_format($req_qnty_ord_uom*$rate_ord_uom,3,"");

			$cu_woq=$cu_booking_arr[$job_no][$trim_cost_dtls_id]['cu_woq'][$po_id];
			$cu_amount=$cu_booking_arr[$job_no][$trim_cost_dtls_id]['cu_amount'][$po_id];
			$bal_woq=def_number_format($req_qnty_ord_uom-$cu_woq,3,"");
			$amount=def_number_format($rate_ord_uom*$bal_woq,3,"");

			//$reqAmtJobLevelConsUom=$reqAmountJobLevelArr[$job_no];
			
			$costing_per=0;
			if($row[csf('costing_per')]==1) $costing_per=12;
			else if($row[csf('costing_per')]==2) $costing_per=1;
			else if($row[csf('costing_per')]==3) $costing_per=24;
			else if($row[csf('costing_per')]==4) $costing_per=36;
			else if($row[csf('costing_per')]==5) $costing_per=48;
			else $costing_per=0;
			
			$itempoWiseReqQty=0;
			
			$itempoWiseReqQty=($powiseCostingPerReqQtyArr[$trim_cost_dtls_id][$po_id]['amt']/$row[csf('plan_cut')])*$costing_per;

			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['job_no'][$po_id]=$job_no;
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['style_ref_no'][$po_id]=$row[csf('style_ref_no')];
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['po_id'][$po_id]=$po_id;
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['po_number'][$po_id]=$row[csf('po_number')];
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['country'][$po_id]=$row[csf('country')];
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['description'][$po_id]=$row[csf('description')];
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['brand_sup_ref'][$po_id]=$row[csf('brand_sup_ref')];
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['trim_group'][$po_id]=$row[csf('trim_group')];
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['trim_group_name'][$po_id]=$trim_group_library[$row[csf('trim_group')]];
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['wo_pre_cost_trim_cost_dtls'][$po_id]=$trim_cost_dtls_id;

			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['req_qnty'][$po_id]=$req_qnty_ord_uom;
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['uom'][$po_id]=$sql_lib_item_group_array[$row[csf('trim_group')]][cons_uom];
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['uom_name'][$po_id]=$unit_of_measurement[$sql_lib_item_group_array[$row[csf('trim_group')]][cons_uom]];
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['req_amount'][$po_id]=$req_amount_ord_uom;
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['req_amount_cons_uom'][$po_id]=$req_amount_cons_uom;
			//$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['req_amount_job_lebel_cons_uom'][$po_id]=$reqAmtJobLevelConsUom;

			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['cu_woq'][$po_id]=$cu_woq;
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['cu_amount'][$po_id]=$cu_amount;
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['bal_woq'][$po_id]=$bal_woq;
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['exchange_rate'][$po_id]=$exchange_rate;
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['rate'][$po_id]=$rate_ord_uom;
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['amount'][$po_id]=$amount;
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['pre_req_amt'][$po_id]=$row[csf('amount')];
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['txt_delivery_date'][$po_id]=$txt_delivery_date;
			$job_and_trimgroup_level[$job_no][$trim_cost_dtls_id]['reqqtycostingper'][$po_id]=$itempoWiseReqQty;
		}
	}
	?>
	<input type="hidden" id="strdata" value='<?=json_encode($job_and_trimgroup_level); ?>' style="background-color:#CCC"/>
	<table cellspacing="0" cellpadding="0" border="1" rules="all" width="1660" class="rpt_table" >
        <thead>
            <th width="40">SL</th>
            <th width="80">Job No</th>
            <th width="80">Style  Ref</th>
            <th width="100">Ord. No</th>
            <th width="100">Trims Group</th>
            <th width="100">HS Code</th>
            <th width="150">Description</th>
            <th width="150">Brand Sup.</th>
            <th width="70">Req. Qnty</th>
            <th width="50">UOM</th>
            <th width="80">CU WOQ</th>
            <th width="80">Bal WOQ</th>
            <th width="100">Sensitivity</th>
            <th width="80">WOQ</th>
            <th width="55">Exch.Rate</th>
            <th width="80">Rate</th>
            <th width="80">Amount</th>
            <th width="80">Delv. Date</th>
            <th>Remark</th>
        </thead>
	</table>
	<table cellspacing="0" cellpadding="0" border="1" rules="all" width="1660" class="rpt_table" id="tbl_list_search" >
        <tbody>
        <?
        if($cbo_level==1)
        {
            foreach ($nameArray as $selectResult)
            {
                if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

                $cbo_currency_job=$selectResult[csf('currency_id')];
                $exchange_rate=$selectResult[csf('exchange_rate')];//$exchange_rate_conversion;//
                if($cbo_currency == $cbo_currency_job) $exchange_rate=1;

                $req_qnty_cons_uom = $req_qty_arr[$selectResult[csf('po_id')]][$selectResult[csf('wo_pre_cost_trim_cost_dtls')]];
                $req_amount_cons_uom = $req_amount_arr[$selectResult[csf('po_id')]][$selectResult[csf('wo_pre_cost_trim_cost_dtls')]];
                $rate_cons_uom = $req_amount_cons_uom/$req_qnty_cons_uom;

                $req_qnty_ord_uom = def_number_format($req_qnty_cons_uom/$sql_lib_item_group_array[$selectResult[csf('trim_group')]][conversion_factor],5,"");
                $rate_ord_uom = def_number_format(($rate_cons_uom*$sql_lib_item_group_array[$selectResult[csf('trim_group')]][conversion_factor])*$exchange_rate,5,"");
                $req_amount_ord_uom = def_number_format($req_qnty_ord_uom*$rate_ord_uom,5,"");

                $cu_woq = $cu_booking_arr[$selectResult[csf('job_no')]][$selectResult[csf('wo_pre_cost_trim_cost_dtls')]]['cu_woq'][$selectResult[csf('po_id')]];
                $cu_amount = $cu_booking_arr[$selectResult[csf('job_no')]][$selectResult[csf('wo_pre_cost_trim_cost_dtls')]]['cu_amount'][$selectResult[csf('po_id')]];
                $bal_woq = def_number_format($req_qnty_ord_uom-$cu_woq,5,"");
                $amount = def_number_format($bal_woq*$rate_ord_uom,5,"");
                $reqAmtJobLevelConsUom=$reqAmountJobLevelArr[$selectResult[csf('job_no')]];
				$req_amt_bal=$req_amount_ord_uom-$cu_amount;

				if($cbo_company_name<0) $cbo_company_name=0;
					//$tna_integrated=return_field_value("tna_integrated","variable_order_tracking","company_name='$cbo_company_name' and variable_list=14 and status_active=1 and is_deleted=0","tna_integrated");

				if($tna_integrated==1)
				{
					//echo " $('#txt_delevary_date').attr('disabled',true);\n";
					$txt_delivery_date="";
					$deli_date_con="disabled=disabled";
				}
				else
				{
					//echo "$('#txt_delevary_date').attr('disabled',false);\n";
					$deli_date_con="";
				}
				$trim_type=$trim_type_arr[$selectResult[csf('trim_group')]];
				if($trim_type==1) $task_num='70'; else $task_num='71';
				$task_finish_date='';
				$po_id_txt=$selectResult[csf('po_id')];
				/*$tnasql=sql_select("select po_number_id,task_finish_date from tna_process_mst where task_number=$task_num and po_number_id in($po_id_txt) and is_deleted= 0 and status_active=1");

				foreach($tnasql as $tnarow){
				$task_finish_date_arr[$tnarow[csf('po_number_id')]]=$tnarow[csf('task_finish_date')];
				}*/
				$task_finish_date=$tnataskfinishArr[$task_num][$po_id_txt];
				
				//$task_finish_date_arr[$selectResult[csf('po_id')]];

				$sql_tna_lib=sql_select("select b.date_calc, b.day_status from lib_capacity_calc_mst a, lib_capacity_calc_dtls b where a.id=b.mst_id and a.comapny_id=$cbo_company_name and b.date_calc='$task_finish_date' and a.status_active=1 and a.is_deleted=0");

				$date_calc=$sql_tna_lib[0][csf("date_calc")];
				$day_status=$sql_tna_lib[0][csf("day_status")];

				if($day_status==2)
				{
					$task_finish_date=return_field_value("max(b.date_calc) as date_calc ", "lib_capacity_calc_mst a, lib_capacity_calc_dtls b","a.id=b.mst_id and a.comapny_id=$cbo_company_name and b.date_calc<'$task_finish_date' and a.status_active=1 and a.is_deleted=0 and b.day_status=1","date_calc");
				}
				else
				{
					$task_finish_date=$task_finish_date;
				}

				if($task_finish_date !='')
				{
					$txt_delivery_date=change_date_format($task_finish_date,'dd-mm-yyyy','-');
					$txt_tna_date=change_date_format($task_finish_date,'dd-mm-yyyy','-');
				}
				else
				{
					$txt_delivery_date=""; $txt_tna_date="";
				}
				
				$costing_per=0;
				if($selectResult[csf('costing_per')]==1) $costing_per=12;
				else if($selectResult[csf('costing_per')]==2) $costing_per=1;
				else if($selectResult[csf('costing_per')]==3) $costing_per=24;
				else if($selectResult[csf('costing_per')]==4) $costing_per=36;
				else if($selectResult[csf('costing_per')]==5) $costing_per=48;
				else $costing_per=0;
				
				$itempoWiseReqQty=0;
			
				$itempoWiseReqQty=($powiseCostingPerReqQtyArr[$selectResult[csf('wo_pre_cost_trim_cost_dtls')]][$selectResult[csf('po_id')]]['amt']/$selectResult[csf('plan_cut')])*$costing_per;

                ?>
                <tr bgcolor="<?=$bgcolor; ?>" style="text-decoration:none; cursor:pointer" id="search<?=$i; ?>" onClick="change_color('search<?=$i; ?>','<?=$bgcolor; ?>');">
                    <td width="40"><?=$i; ?></td>
                    <td width="80"><?=$selectResult[csf('job_no')]; ?>
                        <input type="hidden" id="txtjob_<?=$i; ?>" value="<?=$selectResult[csf('job_no')]; ?>" style="width:30px" class="text_boxes" readonly/>
                    </td>
                     <td width="80">
                          <p>  <? echo $selectResult[csf('style_ref_no')];?> </p>
                        </td>
                    <td width="100" style="word-wrap:break-word; word-break:break-all; width:100px"><?=$selectResult[csf('po_number')]; ?>
                        <input type="hidden" id="txtbookingid_<?=$i;?>" value="" readonly/>
                        <input type="hidden" id="txtpoid_<?=$i;?>" value="<?=$selectResult[csf('po_id')];?>" readonly/>
                        <input type="hidden" id="txtcountry_<?=$i;?>" value="<?=$selectResult[csf('country')]; ?>" readonly />
                    </td>
                    <td width="100" title="<?=$sql_lib_item_group_array[$selectResult[csf('trim_group')]][conversion_factor]; ?>"><?=$trim_group_library[$selectResult[csf('trim_group')]];?>
                        <input type="hidden" id="txttrimcostid_<?=$i;?>" value="<?=$selectResult[csf('wo_pre_cost_trim_cost_dtls')];?>" readonly/>
                        <input type="hidden" id="txttrimgroup_<?=$i;?>" value="<?=$selectResult[csf('trim_group')];?>" readonly/>
                        <input type="hidden" id="txtReqAmt_<?=$i;?>" value="<?=$itempoWiseReqQty; ?>" style="width:30px"/>
                    </td>
					<td width="100"><input type="text" style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  background-color:<?=$bgcolor; ?>" id="txthscode_<?=$i;?>" value="<?=$sql_lib_item_group_array[$selectResult[csf('trim_group')]][hs_code] ?>" /></td>
                    <td width="150"><input type="text" style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  background-color:<? echo $bgcolor; ?>" id="txtdesc_<? echo $i;?>"  value="<? echo $selectResult[csf('description')];?>" /></td>
                    <td width="150"><input type="text" style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  background-color:<? echo $bgcolor; ?>" id="txtbrandsup_<? echo $i;?>"  value="<? echo $selectResult[csf('brand_sup_ref')];?>" /></td>
                    <td width="70" align="right">
                        <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px; text-align:right; background-color:<? echo $bgcolor; ?>" id="txtreqqnty_<? echo $i;?>" value="<? echo number_format($req_qnty_ord_uom,4,'.','');?>"  readonly  />
                        <input type="hidden"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px; text-align:right; background-color:<? echo $bgcolor; ?>" id="txtreqamount_<? echo $i;?>" value="<? echo number_format($req_amount_ord_uom,4,'.','');?>"  readonly  />
                        <input type="hidden"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px; text-align:right; background-color:<? echo $bgcolor; ?>" id="txtreqamountjoblevelconsuom_<? echo $i;?>" value="<? echo number_format($reqAmtJobLevelConsUom,4,'.','');?>"  readonly  />
                        <input type="hidden"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px; text-align:right; background-color:<? echo $bgcolor; ?>" id="txtreqamountitemlevelconsuom_<? echo $i;?>" value="<? echo number_format($req_amount_cons_uom,4,'.','');?>"  readonly  />
                    </td>
                    <td width="50"><? echo $unit_of_measurement[$sql_lib_item_group_array[$selectResult[csf('trim_group')]][cons_uom]];?>
                        <input type="hidden" id="txtuom_<? echo $i;?>" value="<? echo $sql_lib_item_group_array[$selectResult[csf('trim_group')]][cons_uom];?>" readonly />
                    </td>
                    <td width="80" align="right">
                        <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtcuwoq_<? echo $i;?>" value="<? echo number_format($selectResult[csf('cu_woq')],4,'.','');?>"  readonly  />
                        <input type="hidden"  style="width:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtcuamount_<? echo $i;?>" value="<? echo number_format($selectResult[csf('cu_amount')],4,'.','');?>"  readonly  />
                    </td>
                    <td width="80" align="right"><input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtbalwoq_<? echo $i;?>" value="<? echo number_format($bal_woq,4,'.',''); ?>" readonly  /></td>
                    <td width="100" align="right"><? echo create_drop_down( "cbocolorsizesensitive_".$i, 100, $size_color_sensitive,"", 1, "--Select--", "", "set_cons_break_down($i),copy_value(this.value,'cbocolorsizesensitive_',$i)","","1,2,3,4" ); ?></td>
                    <td width="80" align="right"><input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:#FFC" id="txtwoq_<? echo $i;?>" value="<? echo number_format($bal_woq,4,'.','');?>" onClick="open_consumption_popup('requires/trims_booking_multi_job_controllerurmi.php?action=consumption_popup', '<?=$trim_group_library[$selectResult[csf('trim_group')]]?>','txtpoid_<? echo $i;?>',<? echo $i;?>)" readonly /></td>
                    <td width="55" align="right"><input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtexchrate_<? echo $i;?>" value="<? echo $exchange_rate;?>" readonly /></td>
                    <td width="80" align="right">
                        <?
                        $ratetexcolor="#000000";
                        $decimal=explode(".",$rate_ord_uom);
                        if(strlen($decimal[1]>6)) $ratetexcolor="#F00";
                        ?>
                        <input type="text" style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;   text-align:right; color:<? echo $ratetexcolor; ?>; background-color:<? echo $bgcolor; ?>" id="txtrate_<? echo $i;?>" value="<? echo $rate_ord_uom ;?>" onChange="calculate_amount(<? echo $i; ?>)" readonly />
                        <input type="hidden"  style="width:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtrate_precost_<? echo $i;?>" value="<? echo $rate_ord_uom;?>" readonly />
                    </td>
                    <td width="80" align="right"><input type="text"  title="Available balance=<? echo number_format($req_amt_bal,4);?>"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtamount_<? echo $i;?>" value="<? echo number_format($amount,4,'.','');?>" readonly /></td>
                    <td width="80" align="right">
                        <input type="text"   style="width:90%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtddate_<? echo $i;?>"  class="datepicker" onChange="compare_date(1)" value="<? echo $txt_delivery_date; ?>"   <? echo $deli_date_con; ?> readonly  />
                        <input name="txttnadate_<? echo $i;?>" id="txttnadate_<? echo $i;?>" class="datepicker" type="hidden" value="<? echo $txt_tna_date;?>" style="width:70px;"  readonly/>
                        <input type="hidden" id="consbreckdown_<? echo $i;?>"  value=""/>
                        <input type="hidden" id="jsondata_<? echo $i;?>"  value=""/>
                    </td>
                     <td width="" align="right">
                        <input type="text"   style="width:75px; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:center; background-color:<? echo $bgcolor; ?>" id="txtremark_<? echo $i;?>"  class="text_boxes"  value="<? //echo $txt_delivery_date; ?>" />
                        
                         
                    </td>
                </tr>
                <?
                $i++;
            }
        }
        else if($cbo_level==2)
        {
            $i=1;
            foreach ($job_and_trimgroup_level as $job_no)
            {
                foreach ($job_no as $wo_pre_cost_trim_cost_dtls)
                {
                    $job_no=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['job_no']));
                    $po_number=implode(", ",$wo_pre_cost_trim_cost_dtls['po_number']);
					$style_ref_no=implode(", ",$wo_pre_cost_trim_cost_dtls['style_ref_no']);
                    $po_id=implode(",",$wo_pre_cost_trim_cost_dtls['po_id']);
                    $country=implode(",",array_unique(explode(",",implode(",",$wo_pre_cost_trim_cost_dtls['country']))));
                    $description=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['description']));
                    $brand_sup_ref=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['brand_sup_ref']));
                    $wo_pre_cost_trim_id=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['wo_pre_cost_trim_cost_dtls']));
                    $wo_pre_req_amt=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['pre_req_amt']));

                    $trim_group = implode(",",array_unique($wo_pre_cost_trim_cost_dtls['trim_group']));
                    $uom=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['uom']));

                    $req_qnty_ord_uom=array_sum($wo_pre_cost_trim_cost_dtls['req_qnty']);
                    $rate_ord_uom=array_sum($wo_pre_cost_trim_cost_dtls['req_amount'])/array_sum($wo_pre_cost_trim_cost_dtls['req_qnty']);
                    $req_amount_ord_uom=array_sum($wo_pre_cost_trim_cost_dtls['req_amount']);
                    $req_amount_cons_uom=array_sum($wo_pre_cost_trim_cost_dtls['req_amount_cons_uom']);

                    $bal_woq=array_sum($wo_pre_cost_trim_cost_dtls['bal_woq']);
                    $amount=array_sum($wo_pre_cost_trim_cost_dtls['amount']);

                    $cu_woq=array_sum($wo_pre_cost_trim_cost_dtls['cu_woq']);
                    $cu_amount=array_sum($wo_pre_cost_trim_cost_dtls['cu_amount']);

                    $reqAmtJobLevelConsUom=$reqAmountJobLevelArr[$job_no];
					$req_amt_bal=$req_amount_ord_uom-$cu_amount;
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

					if($cbo_company_name<0) $cbo_company_name=0;
					$tna_integrated=return_field_value("tna_integrated","variable_order_tracking","company_name='$cbo_company_name' and variable_list=14 and status_active=1 and is_deleted=0","tna_integrated");

					//echo $tna_integrated."TTTTTTTTTTM";
					if($tna_integrated==1)
					{
						//echo " $('#txt_delevary_date').attr('disabled',true);\n";
						$deli_date_con="disabled=disabled";
					}
					else
					{
						//echo "$('#txt_delevary_date').attr('disabled',false);\n";
						$deli_date_con="";
					}
					$trim_type=$trim_type_arr[$trim_group];
					if($trim_type==1) $task_num='70'; else $task_num='71';
					$task_finish_date='';
					$tnasql=sql_select("select min(po_number_id) as po_number_id,min(task_finish_date) as  task_finish_date from tna_process_mst where task_number=$task_num and po_number_id in($data) and is_deleted= 0 and status_active=1 order by task_finish_date ");
					//echo "select min(po_number_id) as po_number_id,min(task_finish_date) as  task_finish_date from tna_process_mst where task_number=$task_num and po_number_id in($data) and is_deleted= 0 and status_active=1 order by task_finish_date ";

					foreach($tnasql as $tnarow){
					//$task_finish_date_arr[$tnarow[csf('po_number_id')]]=$tnarow[csf('task_finish_date')];
					$task_finish_date=$tnarow[csf('task_finish_date')];
					}
					//echo $po_id.'='.$data;
					//$po_ids=array_unique(explode(",",$po_id));
					//$task_finish_date="";
					//foreach($po_ids as $pId)
					//{
						//$task_finish_date=$task_finish_date_arr[$pId];
						//echo $task_finish_date.'G';
						$sql_tna_lib=sql_select("select b.date_calc, b.day_status from lib_capacity_calc_mst a, lib_capacity_calc_dtls b where a.id=b.mst_id and a.comapny_id=$cbo_company_name and b.date_calc='$task_finish_date' and a.status_active=1 and a.is_deleted=0");
						//echo "select b.date_calc, b.day_status from lib_capacity_calc_mst a, lib_capacity_calc_dtls b where a.id=b.mst_id and a.comapny_id=$cbo_company_name and b.date_calc='$task_finish_date' and a.status_active=1 and a.is_deleted=0";

						$date_calc=$sql_tna_lib[0][csf("date_calc")];
						$day_status=$sql_tna_lib[0][csf("day_status")];

						if($day_status==2)
						{
						$task_finish_date=return_field_value("max(b.date_calc) as  date_calc ", " lib_capacity_calc_mst a, lib_capacity_calc_dtls b "," a.id=b.mst_id and a.comapny_id=$cbo_company_name and b.date_calc<'$task_finish_date' and a.status_active=1 and a.is_deleted=0 and b.day_status=1","date_calc");
						//$task_finish_date.=$task_finish_date.",";
						}
						else
						{
						$task_finish_date=$task_finish_date;
						}
						//echo $task_finish_date.', ';
						$txt_delivery_date="";
						if($task_finish_date !='')
						{
							$txt_delivery_date=change_date_format($task_finish_date,'dd-mm-yyyy','-');
							$txt_tna_date=change_date_format($task_finish_date,'dd-mm-yyyy','-');
						}
						else
						{
							$txt_delivery_date="";
							$txt_tna_date="";
						}
					//} //TNA End



                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>" style="text-decoration:none; cursor:pointer" id="search<? echo $i;?>" onClick="change_color('search<?=$i; ?>','<?=$bgcolor; ?>');">
                        <td width="40"><? echo $i;?></td>
                        <td width="80"><? echo $job_no; ?>
                            <input type="hidden" id="txtjob_<? echo $i;?>" value="<? echo $job_no;?>" style="width:30px" class="text_boxes" readonly/>
                        </td>
                        <td width="80">
                          <p>  <? echo $style_ref_no;?></p>
                        </td>
                        <td width="100" style="word-wrap:break-word; word-break:break-all; width:100px"><? echo $po_number; ?>
                            <input type="hidden" id="txtbookingid_<? echo $i;?>" value="" readonly/>
                            <input type="hidden" id="txtpoid_<? echo $i;?>" value="<? echo $po_id; ?>" readonly/>
                            <input type="hidden" id="txtcountry_<? echo $i;?>"  value="<? echo $country; ?>" readonly />
                        </td>
                        <td width="100" title="<? echo $sql_lib_item_group_array[$trim_group][conversion_factor]; ?>"><? echo $trim_group_library[$trim_group];?>
                            <input type="hidden" id="txttrimcostid_<? echo $i;?>" value="<? echo $wo_pre_cost_trim_id;?>" readonly/>
                            <input type="hidden" id="txttrimgroup_<? echo $i;?>" value="<? echo $trim_group;?>" readonly/>
                            <input class="text_boxes" name="txtReqAmt_<? echo $i;?>" id="txtReqAmt_<? echo $i;?>" type="hidden" value="<? // echo $wo_pre_req_amt; ?>" style="width:30px"/>


                        </td>
						<td width="100"><input type="text" style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  background-color:<? echo $bgcolor; ?>" id="txthscode_<? echo $i;?>"  value="<? echo $sql_lib_item_group_array[$trim_group][hs_code] ?>" /></td>
                        <td width="150"><input type="text" style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  background-color:<? echo $bgcolor; ?>" id="txtdesc_<? echo $i;?>"  value="<? echo $description; ?>" /></td>
                        <td width="150"><input type="text" style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  background-color:<? echo $bgcolor; ?>" id="txtbrandsup_<? echo $i;?>"  value="<? echo $brand_sup_ref;?>" /></td>
                        <td width="70" align="right">
                            <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px; text-align:right; background-color:<? echo $bgcolor; ?>" id="txtreqqnty_<? echo $i;?>" value="<? echo number_format($req_qnty_ord_uom,4,'.','');?>"  readonly  />
                            <input type="hidden"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px; text-align:right; background-color:<? echo $bgcolor; ?>" id="txtreqamount_<? echo $i;?>" value="<? echo number_format($req_amount_ord_uom,4,'.','');?>"  readonly  />
                            <input type="hidden"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px; text-align:right; background-color:<? echo $bgcolor; ?>" id="txtreqamountjoblevelconsuom_<? echo $i;?>" value="<? echo number_format($reqAmtJobLevelConsUom,4,'.','');?>"  readonly  />
                            <input type="hidden"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px; text-align:right; background-color:<? echo $bgcolor; ?>" id="txtreqamountitemlevelconsuom_<? echo $i;?>" value="<? echo number_format($req_amount_cons_uom,4,'.','');?>"  readonly  />
                        </td>
                        <td width="50"><? echo $unit_of_measurement[$uom]; ?><input type="hidden" id="txtuom_<? echo $i;?>" value="<? echo $uom;?>" readonly /></td>
                        <td width="80" align="right">
                            <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtcuwoq_<? echo $i;?>" value="<? echo number_format($cu_woq,4,'.',''); ?>"  readonly  />
                            <input type="hidden"  style="width:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtcuamount_<? echo $i;?>" value="<? echo number_format($cu_amount,4,'.','');?>"  readonly  />
                        </td>
                        <td width="80" align="right"><input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtbalwoq_<? echo $i;?>" value="<? echo number_format($bal_woq,4,'.','');?>" readonly /></td>
                        <td width="100" align="right"><? echo create_drop_down( "cbocolorsizesensitive_".$i, 100, $size_color_sensitive,"", 1, "--Select--", "", "set_cons_break_down($i),copy_value(this.value,'cbocolorsizesensitive_',$i)","","1,2,3,4" ); ?></td>
                        <td width="80" align="right"><input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:#FFC" id="txtwoq_<? echo $i;?>" value="<? echo number_format($bal_woq,4,'.','');?>" onClick="open_consumption_popup('requires/trims_booking_multi_job_controllerurmi.php?action=consumption_popup', '<?=$trim_group_library[$trim_group]?>','txtpoid_<? echo $i;?>',<? echo $i;?>)" readonly/></td>
                        <td width="55" align="right"><input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtexchrate_<? echo $i;?>" value="<? echo $exchange_rate;?>" readonly /></td>
                        <td width="80" align="right">
                            <?
                            $ratetexcolor="#000000";
                            $decimal=explode(".",$rate_ord_uom);
                            if(strlen($decimal[1])>6) $ratetexcolor="#F00";
                            ?>
                            <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; color:<? echo $ratetexcolor;  ?>;  background-color:<? echo $bgcolor; ?>" id="txtrate_<? echo $i;?>" value="<? echo $rate_ord_uom ;?>" onChange="calculate_amount(<? echo $i; ?>)" readonly />

                            <input type="hidden"  style="width:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtrate_precost_<? echo $i;?>" value="<? echo $rate_ord_uom;?>" readonly />
                        </td>
                        <td width="80" align="right"> <input type="text"  title="Available balance=<? echo number_format($req_amt_bal,4);?>" style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtamount_<? echo $i;?>" value="<? echo number_format($amount,4,'.','');?>" readonly /></td>
                        <td width="" align="center">
                            <input type="text"   style="width:90%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtddate_<? echo $i;?>"  class="datepicker" value="<? echo $txt_delivery_date; ?>"  onChange="compare_date(1)"  <? echo $deli_date_con;?> readonly />
                            <input name="txttnadate_<? echo $i;?>" id="txttnadate_<? echo $i;?>" class="datepicker" type="hidden" value="<? echo $txt_tna_date;?>" style="width:70px;"  readonly/>
                            <input type="hidden" id="consbreckdown_<? echo $i;?>"  value=""/>
                            <input type="hidden" id="jsondata_<? echo $i;?>"  value=""/>
                        </td>
                        <td width="" align="center">
                        <input type="text"   style="width:75px; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:center; background-color:<? echo $bgcolor; ?>" id="txtremark_<? echo $i;?>"  class="text_boxes"  value="<? //echo $txt_delivery_date; ?>" />
                        </td>
                    </tr>
                    <?
                    $i++;
                }
            }
        }
        ?>
        </tbody>
	</table>
	<table width="1660" class="rpt_table" border="0" rules="all">
        <tfoot>
            <tr>
                <th width="40">&nbsp;</th>
                <th width="80"></th>
                 <th width="80"></th>
                <th width="100"></th>
                <th width="100"></th>
                <th width="100"></th>
                <th width="150"></th>
                <th width="150"></th>
                <th width="70"><? echo $tot_req_qty; ?></th>
                <th width="50"></th>
                <th width="80"><? echo $tot_cu_woq; ?></th>
                <th width="80"><? echo $tot_bal_woq; ?></th>
                <th width="100"></th>
                <th width="80"></th>
                <th width="55"></th>
                <th width="80"></th>
                <th width="80"><input type="hidden" id="tot_amount" value="<? echo  $total_amount; ?>" style="width:80px" readonly /></th>
                <th width="80"><input type="hidden" id="saved_tot_amount" value="0" style="width:80px; text-align:right" readonly/></th>
                 <th width=""></th>
            </tr>
        </tfoot>
	</table>
    <table width="1660" colspan="17" cellspacing="0" class="" border="0">
        <tr>
            <td align="center"class="button_container">
            	<? echo load_submit_buttons( $permission, "fnc_trims_booking_dtls", 0,0,"reset_form('','booking_list_view','','','')",2); ?>
            </td>
        </tr>
    </table>
	<?
	exit();
}

if ($action=="show_trim_booking")
{
	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	//$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$trms_sql=sql_select("select id,trim_type,item_name from lib_item_group");
	foreach($trms_sql as $row)
	{
		$trim_group_library[$row[csf('id')]]=$row[csf('item_name')];
		$trim_type_arr[$row[csf('id')]]=$row[csf('trim_type')];
	}
	$cbo_pay_mode=str_replace("'","",$cbo_pay_mode);
	$booking_month=0;
	if($cbo_booking_month<10) $booking_month.=$cbo_booking_month;
	else $booking_month=$cbo_booking_month;

	if($garments_nature==0) $garment_nature_cond="";
	else $garment_nature_cond=" and a.garments_nature=$garments_nature";

	$start_date=$cbo_booking_year."-".$booking_month."-01";
	$end_date=$cbo_booking_year."-".$booking_month."-".cal_days_in_month(CAL_GREGORIAN, $booking_month, $cbo_booking_year);
	if($db_type==0){
		if ($start_date!="" &&  $end_date!="") $shipment_date = "and d.pub_shipment_date between '".change_date_format($start_date, "yyyy-mm-dd", "-")."' and '".change_date_format($end_date, "yyyy-mm-dd", "-")."'"; else $shipment_date ="";
	}
	else if($db_type==2){
		if ($start_date!="" &&  $end_date!="") $shipment_date = "and d.pub_shipment_date between '".change_date_format($start_date, "yyyy-mm-dd", "-",1)."' and '".change_date_format($end_date, "yyyy-mm-dd", "-",1)."'"; else $shipment_date ="";
	}

	$sql_lib_item_group_array=array();
	$sql_lib_item_group=sql_select("select id, item_name,conversion_factor,order_uom as cons_uom from lib_item_group");
	foreach($sql_lib_item_group as $row_sql_lib_item_group){
		$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][item_name]=$row_sql_lib_item_group[csf('item_name')];
		$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][conversion_factor]=$row_sql_lib_item_group[csf('conversion_factor')];
		$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][cons_uom]=$row_sql_lib_item_group[csf('cons_uom')];
	}
	unset($sql_lib_item_group);
	$condition= new condition();

	if(str_replace("'","",$job_no) !=''){
		$condition->job_no("in('$job_no')");
	}
	$condition->init();
	$trims= new trims($condition);
	$req_qty_arr=$trims->getQtyArray_by_orderAndPrecostdtlsid();
	$req_amount_arr=$trims->getAmountArray_by_orderAndPrecostdtlsid();
	$reqAmountJobLevelArr=$trims->getAmountArray_by_job();
	
	$powiseCostingPerReqQtyArr=array();
	foreach ($req_amount_arr as $poid=>$podata)
	{
		foreach ($podata as $bomid=>$bomdata)
		{
			$powiseCostingPerReqQtyArr[$bomid][$poid]['amt']+=$bomdata;
		}
	}

	$cu_booking_arr=array();
	$sql_cu_booking=sql_select("select c.job_no,c.pre_cost_fabric_cost_dtls_id,c.po_break_down_id, sum(c.wo_qnty) as cu_wo_qnty, sum(c.amount) as cu_amount from wo_po_details_master a, wo_po_break_down  d , wo_booking_dtls c where a.id=d.job_id and a.job_no=c.job_no and  d.id=c.po_break_down_id and a.company_name=$cbo_company_name and c.pre_cost_fabric_cost_dtls_id=$pre_cost_id and c.status_active=1 and c.is_deleted=0 group by c.job_no, c.pre_cost_fabric_cost_dtls_id,c.po_break_down_id");
	foreach($sql_cu_booking as $row_cu_booking)
	{
		$cu_booking_arr[$row_cu_booking[csf('job_no')]][$row_cu_booking[csf('pre_cost_fabric_cost_dtls_id')]]['cu_woq'][$row_cu_booking[csf('po_break_down_id')]]=$row_cu_booking[csf('cu_wo_qnty')];
		$cu_booking_arr[$row_cu_booking[csf('job_no')]][$row_cu_booking[csf('pre_cost_fabric_cost_dtls_id')]]['cu_amount'][$row_cu_booking[csf('po_break_down_id')]]=$row_cu_booking[csf('cu_amount')];
	}
	unset($sql_cu_booking);

	$sql="SELECT a.job_no_prefix_num, a.job_no, a.company_name, a.buyer_name, a.currency_id, a.style_ref_no, b.costing_per, f.exchange_rate, c.id as wo_pre_cost_trim_cost_dtls, c.trim_group, c.description as description_pre_cost, c.brand_sup_ref as brand_sup_ref_precost, c.country, c.rate, c.amount, d.id as po_id, d.po_number, d.po_quantity as plan_cut, min(e.id) as id, e.po_break_down_id, avg(e.cons) as cons, sum(f.wo_qnty) as cu_woq, sum(f.amount) as cu_amount, f.id as booking_id, f.sensitivity, f.delivery_date, f.description as description, f.brand_supplier as brand_sup_ref, f.hs_code,f.remark

	from wo_po_details_master a, wo_pre_cost_mst b, wo_pre_cost_trim_cost_dtls c, wo_po_break_down d, wo_pre_cost_trim_co_cons_dtls e, wo_booking_dtls f

	where
	a.id=b.job_id and a.id=c.job_id and a.id=d.job_id and a.id=e.job_id and a.job_no=f.job_no and c.id=e.wo_pre_cost_trim_cost_dtls_id and d.id=e.po_break_down_id and e.wo_pre_cost_trim_cost_dtls_id= f.pre_cost_fabric_cost_dtls_id and e.po_break_down_id=f.po_break_down_id and f.booking_type=2 and f.booking_no=$txt_booking_no and f.id in($booking_id) and a.company_name=$cbo_company_name $garment_nature_cond and e.wo_pre_cost_trim_cost_dtls_id=$pre_cost_id and d.is_deleted=0 and d.status_active=1 and f.status_active=1 and f.is_deleted=0

	group by
	a.job_no_prefix_num, a.job_no, a.company_name, a.buyer_name, a.currency_id, a.style_ref_no, b.costing_per, f.exchange_rate, c.id, c.trim_group, c.description, c.brand_sup_ref, c.country, c.rate, c.amount, d.id, d.po_number, d.po_quantity, e.po_break_down_id, f.id, f.sensitivity, f.delivery_date, f.description, f.brand_supplier, f.remark,f.hs_code
	order by d.id,c.id";
	//echo $sql;
	$job_and_trimgroup_level=array();
	$i=1;
	$nameArray=sql_select( $sql );
	$poid="";
	foreach ($nameArray as $infr)
	{
		if($poid=="") $poid=$infr[csf('po_id')]; else $poid.=','.$infr[csf('po_id')];
	}
	$delivery_date='';

	if($cbo_level==2)
	{
		foreach ($nameArray as $infr)
		{
			$cbo_currency_job=$infr[csf('currency_id')];
			$exchange_rate=$infr[csf('exchange_rate')];
			if($cbo_currency==$cbo_currency_job) $exchange_rate=1;
			$job_no=$infr[csf('job_no')];
			$pre_cost_trim_id=$infr[csf('wo_pre_cost_trim_cost_dtls')];

			if(!empty($delivery_date))
			{
				$delivery_date=min($delivery_date,$infr[csf('delivery_date')]);
			}
			else
			{
				$delivery_date=$infr[csf('delivery_date')];
			}

			$req_qnty_cons_uom=$req_qty_arr[$infr[csf('po_id')]][$pre_cost_trim_id];
			$req_amount_cons_uom=$req_amount_arr[$infr[csf('po_id')]][$pre_cost_trim_id];
			$rate_cons_uom=$req_amount_cons_uom/$req_qnty_cons_uom;
			$req_qnty_ord_uom=def_number_format($req_qnty_cons_uom/$sql_lib_item_group_array[$infr[csf('trim_group')]][conversion_factor],3,"");
			$rate_ord_uom=def_number_format(($rate_cons_uom*$sql_lib_item_group_array[$infr[csf('trim_group')]][conversion_factor])*$exchange_rate,3,"");
			$req_amount_ord_uom=def_number_format($req_qnty_ord_uom*$rate_ord_uom,3,"");

			$cu_woq=$cu_booking_arr[$job_no][$pre_cost_trim_id]['cu_woq'][$infr[csf('po_id')]];
			$cu_amount=$cu_booking_arr[$job_no][$pre_cost_trim_id]['cu_amount'][$infr[csf('po_id')]];
			$bal_woq=def_number_format($req_qnty_ord_uom-$cu_woq,3,"");
			$amount=def_number_format($rate_ord_uom*$bal_woq,3,"");
			$total_req_amount+=$req_amount;
			$total_cu_amount+=$infr[csf('cu_amount')];
			
			$costing_per=0;
			if($infr[csf('costing_per')]==1) $costing_per=12;
			else if($infr[csf('costing_per')]==2) $costing_per=1;
			else if($infr[csf('costing_per')]==3) $costing_per=24;
			else if($infr[csf('costing_per')]==4) $costing_per=36;
			else if($infr[csf('costing_per')]==5) $costing_per=48;
			else $costing_per=0;
			
			$itempoWiseReqQty=0;
		
			$itempoWiseReqQty=($powiseCostingPerReqQtyArr[$pre_cost_trim_id][$infr[csf('po_id')]]['amt']/$infr[csf('plan_cut')])*$costing_per;
			//if($infr[csf('po_id')]==58499) echo $powiseCostingPerReqQtyArr[$pre_cost_trim_id][$infr[csf('po_id')]]['amt'].'='.$infr[csf('plan_cut')].'='.$costing_per.'<br>';

			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['job_no'][$infr[csf('po_id')]]=$job_no;
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['po_id'][$infr[csf('po_id')]]=$infr[csf('po_id')];
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['style_ref_no'][$infr[csf('po_id')]]=$infr[csf('style_ref_no')];
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['company_name'][$infr[csf('company_name')]]=$infr[csf('company_name')];
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['po_number'][$infr[csf('po_id')]]=$infr[csf('po_number')];
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['country'][$infr[csf('po_id')]]=$infr[csf('country')];
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['description'][$infr[csf('po_id')]]=$infr[csf('description')];
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['hs_code'][$infr[csf('po_id')]]=$infr[csf('hs_code')];
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['remark'][$infr[csf('po_id')]]=$infr[csf('remark')];
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['brand_sup_ref'][$infr[csf('po_id')]]=$infr[csf('brand_sup_ref')];
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['trim_group'][$infr[csf('po_id')]]=$infr[csf('trim_group')];
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['trim_group_name'][$infr[csf('po_id')]]=$trim_group_library[$infr[csf('trim_group')]];
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['wo_pre_cost_trim_cost_dtls'][$infr[csf('po_id')]]=$pre_cost_trim_id;

			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['req_qnty'][$infr[csf('po_id')]]=$req_qnty_ord_uom;
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['uom'][$infr[csf('po_id')]]=$sql_lib_item_group_array[$infr[csf('trim_group')]][cons_uom];
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['uom_name'][$infr[csf('po_id')]]=$unit_of_measurement[$sql_lib_item_group_array[$infr[csf('trim_group')]][cons_uom]];
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['req_amount'][$infr[csf('po_id')]]=$req_amount_ord_uom;
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['req_amount_cons_uom'][$infr[csf('po_id')]]=$req_amount_cons_uom;

			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['cu_woq'][$infr[csf('po_id')]]=$cu_woq;
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['cu_amount'][$infr[csf('po_id')]]=$cu_amount;
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['bal_woq'][$infr[csf('po_id')]]=$bal_woq;
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['exchange_rate'][$infr[csf('po_id')]]=$exchange_rate;
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['rate'][$infr[csf('po_id')]]=$rate_ord_uom;
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['amount'][$infr[csf('po_id')]]=$amount;
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['pre_req_amt'][$infr[csf('po_id')]]=$infr[csf('amount')];
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['txt_delivery_date'][$infr[csf('po_id')]]=$infr[csf('delivery_date')];
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['booking_id'][$infr[csf('po_id')]]=$infr[csf('booking_id')];
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['sensitivity'][$infr[csf('po_id')]]=$infr[csf('sensitivity')];
			$job_and_trimgroup_level[$job_no][$pre_cost_trim_id]['reqqtycostingper'][$infr[csf('po_id')]]=def_number_format($itempoWiseReqQty,5,"");
		}
	}
	//print_r($job_and_trimgroup_level['OG-22-00128'][54087]['reqqtycostingper']);

	$sql_booking=sql_select("select c.job_no, c.pre_cost_fabric_cost_dtls_id, c.po_break_down_id, sum(c.wo_qnty) as wo_qnty, sum(c.amount) as amount from wo_po_details_master a, wo_po_break_down d, wo_booking_dtls c where a.id=d.job_id and a.job_no=c.job_no and  d.id=c.po_break_down_id and c.booking_no=$txt_booking_no and c.pre_cost_fabric_cost_dtls_id=$pre_cost_id  and c.id in($booking_id) and c.booking_type=2 and c.status_active=1 and c.is_deleted=0 group by c.job_no, c.pre_cost_fabric_cost_dtls_id, c.po_break_down_id");
	foreach($sql_booking as $row_booking)
	{
		$job_and_trimgroup_level[$row_booking[csf('job_no')]][$row_booking[csf('pre_cost_fabric_cost_dtls_id')]]['woq'][$row_booking[csf('po_break_down_id')]]=$row_booking[csf('wo_qnty')];
		$job_and_trimgroup_level[$row_booking[csf('job_no')]][$row_booking[csf('pre_cost_fabric_cost_dtls_id')]]['amount'][$row_booking[csf('po_break_down_id')]]=$row_booking[csf('amount')];
	}
	unset($sql_booking);
	?>
    <input type="hidden" id="strdata" value='<?=json_encode($job_and_trimgroup_level); ?>' style="background-color:#CCC"/>
	<table cellspacing="0" cellpadding="0" border="1" rules="all" width="1660" class="rpt_table" >
        <thead>
            <th width="40">SL</th>
            <th width="80">Job No</th>
            <th width="80">Style Ref</th>
            <th width="100">Ord. No</th>
            <th width="100">Trims Group</th>
            <th width="100">HS Code</th>
            <th width="150">Description</th>
            <th width="150">Brand Sup.</th>
            <th width="70">Req. Qnty</th>
            <th width="50">UOM</th>
            <th width="80">CU WOQ</th>
            <th width="80">Bal WOQ</th>
            <th width="100">Sensitivity</th>
            <th width="80">WOQ</th>
            <th width="55">Exch.Rate</th>
            <th width="80">Rate</th>
            <th width="80">Amount</th>
            <th width="80">Delv. Date</th>
            <th>Remark</th>
        </thead>
	</table>
	<table cellspacing="0" cellpadding="0" border="1" rules="all" width="1660" class="rpt_table" id="tbl_list_search" >
        <tbody>
        <?
		$pi_array=array();
		$pi_number=sql_select( "Select a.pi_number, b.item_group from com_pi_master_details a, com_pi_item_details b where a.id=b.pi_id and b.work_order_no=$txt_booking_no and a.item_category_id=4 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0");
		foreach ($pi_number as $row)
		{
			$pi_array[$row[csf('item_group')]]=$row[csf('pi_number')];
		}
		unset($pi_number);
		$recv_array=array();
		$recv_number=sql_select( "Select a.recv_number, b.item_group_id from inv_receive_master a, inv_trims_entry_dtls b where a.id=b.mst_id and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.item_category=4 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and  b.is_deleted=0");
		foreach ($recv_number as $row)
		{
			$recv_array[$row[csf('item_group_id')]]=$row[csf('recv_number')];
		}
		unset($recv_number);

        if($cbo_level==1)
        {
            foreach ($nameArray as $selectResult)
            {
                if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

                $cbo_currency_job=$selectResult[csf('currency_id')];
                $exchange_rate=$selectResult[csf('exchange_rate')];
                if($cbo_currency==$cbo_currency_job) $exchange_rate=1;
				$po_id=$selectResult[csf('po_id')];

                $req_qnty_cons_uom=$req_qty_arr[$selectResult[csf('po_id')]][$selectResult[csf('wo_pre_cost_trim_cost_dtls')]];
                $req_amount_cons_uom=$req_amount_arr[$selectResult[csf('po_id')]][$selectResult[csf('wo_pre_cost_trim_cost_dtls')]];
                $rate_cons_uom=$req_amount_cons_uom/$req_qnty_cons_uom;

                $req_qnty_ord_uom=def_number_format($req_qnty_cons_uom/$sql_lib_item_group_array[$selectResult[csf('trim_group')]][conversion_factor],3,"");
                $rate_ord_uom=def_number_format(($rate_cons_uom*$sql_lib_item_group_array[$selectResult[csf('trim_group')]][conversion_factor])*$exchange_rate,3,"");
                $req_amount_ord_uom=def_number_format($req_qnty_ord_uom*$rate_ord_uom,3,"");

                $cu_woq=$cu_booking_arr[$selectResult[csf('job_no')]][$selectResult[csf('wo_pre_cost_trim_cost_dtls')]]['cu_woq'][$selectResult[csf('po_id')]];
                $cu_amount=$cu_booking_arr[$selectResult[csf('job_no')]][$selectResult[csf('wo_pre_cost_trim_cost_dtls')]]['cu_amount'][$selectResult[csf('po_id')]];
                $bal_woq=def_number_format($req_qnty_ord_uom-$cu_woq,3,"");

                $woq=$job_and_trimgroup_level[$selectResult[csf('job_no')]][$selectResult[csf('wo_pre_cost_trim_cost_dtls')]]['woq'][$selectResult[csf('po_id')]];
                $amount=$job_and_trimgroup_level[$selectResult[csf('job_no')]][$selectResult[csf('wo_pre_cost_trim_cost_dtls')]]['amount'][$selectResult[csf('po_id')]];
                $rate=$amount/$woq;
                $total_amount+=$amount;
                $reqAmtJobLevelConsUom=$reqAmountJobLevelArr[$selectResult[csf('job_no')]];

				$piNumber=0;
				$pi_number=$pi_array[$trim_group];
				if($pi_number!="") $piNumber=1;

				$recvNumber=0;
				$recv_number=$recv_array[$trim_group];
				if($recv_number) $recvNumber=1;

				$disAbled=0;
				if($recvNumber==1 || $piNumber==1) $disAbled=1; else $disAbled=0;
				if($cbo_company_name<0) $cbo_company_name=0;
					$tna_integrated=return_field_value("tna_integrated","variable_order_tracking","company_name='$cbo_company_name' and variable_list=14 and status_active=1 and is_deleted=0","tna_integrated");
					//echo $cbo_company_name.'X';
					if($tna_integrated==1)
					{
						//echo " $('#txt_delevary_date').attr('disabled',true);\n";
						$deli_date_con="disabled=disabled";
					}
					else
					{
						//echo "$('#txt_delevary_date').attr('disabled',false);\n";
						$deli_date_con="";
					}
					$trim_type=$trim_type_arr[$selectResult[csf('trim_group')]];
					//echo $trim_type.'ddd';
					if($trim_type==1) $task_num='70'; else $task_num='71';
					$task_finish_date='';
					$tnasql=sql_select("select po_number_id,task_finish_date from tna_process_mst where task_number=$task_num and po_number_id in($po_id) and is_deleted= 0 and status_active=1");

					foreach($tnasql as $tnarow){
					$task_finish_date_arr[$tnarow[csf('po_number_id')]]=$tnarow[csf('task_finish_date')];
					}
					$task_finish_date=$task_finish_date_arr[$selectResult[csf('po_id')]];
					$sql_tna_lib=sql_select("select b.date_calc, b.day_status from lib_capacity_calc_mst a, lib_capacity_calc_dtls b where a.id=b.mst_id and a.comapny_id=$cbo_company_name and b.date_calc='$task_finish_date' and a.status_active=1 and a.is_deleted=0");

					$date_calc=$sql_tna_lib[0][csf("date_calc")];
					$day_status=$sql_tna_lib[0][csf("day_status")];

					if($day_status==2)
					{
					$task_finish_date=return_field_value("max(b.date_calc) as  date_calc ", " lib_capacity_calc_mst a, lib_capacity_calc_dtls b "," a.id=b.mst_id and a.comapny_id=$cbo_company_name and b.date_calc<'$task_finish_date' and a.status_active=1 and a.is_deleted=0 and b.day_status=1","date_calc");
					}
					else
					{
					$task_finish_date=$task_finish_date;
					}

					//$delivery_date="";
					if($task_finish_date !='')
					{
						$txt_tna_date=change_date_format($task_finish_date,'dd-mm-yyyy','-');
					}
					else
					{
						$txt_tna_date="";
					}
					
					$costing_per=0;
				if($selectResult[csf('costing_per')]==1) $costing_per=12;
				else if($selectResult[csf('costing_per')]==2) $costing_per=1;
				else if($selectResult[csf('costing_per')]==3) $costing_per=24;
				else if($selectResult[csf('costing_per')]==4) $costing_per=36;
				else if($selectResult[csf('costing_per')]==5) $costing_per=48;
				else $costing_per=0;
				
				$itempoWiseReqQty=0;
			
				$itempoWiseReqQty=($powiseCostingPerReqQtyArr[$selectResult[csf('wo_pre_cost_trim_cost_dtls')]][$selectResult[csf('po_id')]]['amt']/$selectResult[csf('plan_cut')])*$costing_per;

                ?>
                <tr bgcolor="<? echo $bgcolor; ?>" style="text-decoration:none; cursor:pointer" id="search<? echo $i;?>">
                    <td width="40"><? echo $i;?></td>
                    <td width="80"><? echo $selectResult[csf('job_no')];?>
                        <input type="hidden" id="txtjob_<? echo $i;?>" value="<? echo $selectResult[csf('job_no')];?>" style="width:30px" class="text_boxes" readonly/>
                    </td>
                      <td width="80"> <p><? echo $selectResult[csf('style_ref_no')];?> </p>
                         
                    </td>
                    <td width="100" style="word-break:break-all"><? echo $selectResult[csf('po_number')];?>
                        <input type="hidden" id="txtbookingid_<? echo $i;?>" value="<? echo $selectResult[csf('booking_id')];?>" readonly/>
                        <input type="hidden" id="txtpoid_<? echo $i;?>" value="<? echo $selectResult[csf('po_id')];?>" readonly/>
                        <input type="hidden" id="txtcountry_<? echo $i;?>"  value="<? echo $selectResult[csf('country')] ?>" readonly />
                    </td>
                    <td width="100"  title="<? echo $sql_lib_item_group_array[$selectResult[csf('trim_group')]][conversion_factor];  ?>">
                        <? echo $trim_group_library[$selectResult[csf('trim_group')]];?>
                        <input type="hidden" id="txttrimcostid_<? echo $i;?>" value="<? echo $selectResult[csf('wo_pre_cost_trim_cost_dtls')];?>" readonly/>
                        <input type="hidden" id="txttrimgroup_<? echo $i;?>" value="<? echo $selectResult[csf('trim_group')];?>" readonly/>
                        <input class="text_boxes" name="txtReqAmt_<?=$i;?>" id="txtReqAmt_<?=$i;?>" type="hidden" value="<?=$itempoWiseReqQty; ?>" style="width:30px"/>
                    </td>
					<td width="100">
                        <input type="text" style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  background-color:<? echo $bgcolor; ?>" id="txthscode_<? echo $i;?>"  value="<? echo $selectResult[csf('hs_code')];?>"  <? if($disAbled){echo "disabled";}else{ echo "";}?> />
                    </td>
                    <td width="150">
                        <input type="text" style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  background-color:<? echo $bgcolor; ?>" id="txtdesc_<? echo $i;?>"  value="<? echo $selectResult[csf('description')];?>"  <? if($disAbled){echo "disabled";}else{ echo "";}?> />
                    </td>
                    <td width="150">
                        <input type="text" style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  background-color:<? echo $bgcolor; ?>" id="txtbrandsup_<? echo $i;?>"  value="<? echo $selectResult[csf('brand_sup_ref')];?>"  <? if($disAbled){echo "disabled";}else{ echo "";}?> />
                    </td>
                    <td width="70" align="right">
                        <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px; text-align:right; background-color:<? echo $bgcolor; ?>" id="txtreqqnty_<? echo $i;?>" value="<? echo number_format($req_qnty_ord_uom,4,'.','');?>"  readonly  />
                        <input type="hidden"  style="width:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px; text-align:right; background-color:<? echo $bgcolor; ?>" id="txtreqamount_<? echo $i;?>" value="<? echo number_format($req_amount_ord_uom,4,'.','');?>"  readonly  />
                        <input type="hidden"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px; text-align:right; background-color:<? echo $bgcolor; ?>" id="txtreqamountjoblevelconsuom_<? echo $i;?>" value="<? echo number_format($reqAmtJobLevelConsUom,4,'.','');?>"  readonly  />
                        <input type="hidden"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px; text-align:right; background-color:<? echo $bgcolor; ?>" id="txtreqamountitemlevelconsuom_<? echo $i;?>" value="<? echo number_format($req_amount_cons_uom,4,'.','');?>"  readonly  />
                    </td>
                    <td width="50">
                        <? echo $unit_of_measurement[$sql_lib_item_group_array[$selectResult[csf('trim_group')]][cons_uom]];?>
                        <input type="hidden" id="txtuom_<? echo $i;?>" value="<? echo $sql_lib_item_group_array[$selectResult[csf('trim_group')]][cons_uom];?>" readonly />
                    </td>
                    <td width="80" align="right">
                        <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtcuwoq_<? echo $i;?>" value="<? echo number_format($cu_woq,4,'.','');?>"  readonly  />
                        <input type="hidden"  style="width:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtcuamount_<? echo $i;?>" value="<? echo number_format($cu_amount,4,'.','');?>"  readonly  />
                    </td>
                    <td width="80" align="right">
                        <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtbalwoq_<? echo $i;?>" value="<? echo number_format($bal_woq,4,'.',''); ?>"  readonly  />
                    </td>
                    <td width="100" align="right"><? echo create_drop_down( "cbocolorsizesensitive_".$i, 100, $size_color_sensitive,"", 1, "--Select--", $selectResult[csf("sensitivity")], "set_cons_break_down($i),copy_value(this.value,'cbocolorsizesensitive_',$i)",$disAbled,"1,2,3,4" ); ?>
                    </td>
                    <td width="80" align="right">
                        <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:#FFC" id="txtwoq_<? echo $i;?>" value="<? echo number_format($woq,4,'.','');?>" onClick="open_consumption_popup('requires/trims_booking_multi_job_controllerurmi.php?action=consumption_popup', '<?=$trim_group_library[$selectResult[csf('trim_group')]];?>','txtpoid_<? echo $i;?>',<? echo $i;?>)" readonly />
                    </td>
                    <td width="55" align="right">
                        <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtexchrate_<? echo $i;?>" value="<? echo $exchange_rate;?>" readonly />
                    </td>
                    <td width="80" align="right">
                        <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtrate_<? echo $i;?>" value="<? echo $rate;?>" onChange="calculate_amount(<? echo $i; ?>)" readonly />

                        <input type="hidden"  style="width:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtrate_precost_<? echo $i;?>" value="<? echo $rate_ord_uom;?>" readonly />
                    </td>
                    <td width="80" align="right">
                        <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtamount_<? echo $i;?>" value="<? echo number_format($amount,4,'.','');?>"  readonly  />
                    </td>
                    <td width="80" align="center">
                        <input type="text"   style="width:90%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:center; background-color:<? echo $bgcolor; ?>" id="txtddate_<? echo $i;?>"  class="datepicker" value="<? echo change_date_format($selectResult[csf('delivery_date')],"dd-mm-yyyy","-"); ?>"  onChange="compare_date(2)"  readonly <? if($disAbled){echo "disabled";}else{ echo "";}?> <? echo $deli_date_con;?>   />
                         <input name="txttnadate_<? echo $i;?>" id="txttnadate_<? echo $i;?>" class="datepicker" type="hidden" value="<? echo $txt_tna_date;?>" style="width:70px;"  readonly/>
                        <input type="hidden" id="consbreckdown_<? echo $i;?>"  value=""/>
                        <input type="hidden" id="jsondata_<? echo $i;?>"  value=""/>
                    </td>
                    <td>
                   	 <input class="text_boxes" type="text" style="width:75px;"  name="txtremark_<? echo $i;?>" id="txtremark_<? echo $i;?>"  value="<? echo $selectResult[csf('remark')];?>"/>/>
                    </td>
                </tr>
            <?
            $i++;
            }
        }
        else if($cbo_level==2)
        {
            $i=1;
            foreach ($job_and_trimgroup_level as $job_no)
            {
                foreach ($job_no as $wo_pre_cost_trim_cost_dtls)
                {
                    $job_no=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['job_no']));
					$style_ref_no=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['style_ref_no']));
					$remark=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['remark']));
                    $po_number=implode(", ",$wo_pre_cost_trim_cost_dtls['po_number']);
                    $po_id=implode(",",$wo_pre_cost_trim_cost_dtls['po_id']);
					$company_name=implode(",",$wo_pre_cost_trim_cost_dtls['company_name']);
                    $country=implode(",",array_unique(explode(",",implode(",",$wo_pre_cost_trim_cost_dtls['country']))));
                    $description=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['description']));
                    $hs_code=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['hs_code']));
                    $brand_sup_ref=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['brand_sup_ref']));
                    $wo_pre_cost_trim_id=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['wo_pre_cost_trim_cost_dtls']));
					$wo_pre_req_amt=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['pre_req_amt']));

                    $trim_group = implode(",",array_unique($wo_pre_cost_trim_cost_dtls['trim_group']));
                    $uom=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['uom']));
                    $booking_id=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['booking_id']));
                    $sensitivity=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['sensitivity']));
                    //$delivery_date=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['txt_delivery_date']));

                    $req_qnty_ord_uom=array_sum($wo_pre_cost_trim_cost_dtls['req_qnty']);
                    $rate_ord_uom=array_sum($wo_pre_cost_trim_cost_dtls['req_amount'])/array_sum($wo_pre_cost_trim_cost_dtls['req_qnty']);
                    $req_amount_ord_uom=array_sum($wo_pre_cost_trim_cost_dtls['req_amount']);
                    $req_amount_cons_uom=array_sum($wo_pre_cost_trim_cost_dtls['req_amount_cons_uom']);

                    $bal_woq=array_sum($wo_pre_cost_trim_cost_dtls['bal_woq']);
                    $cu_woq=array_sum($wo_pre_cost_trim_cost_dtls['cu_woq']);
                    $cu_amount=array_sum($wo_pre_cost_trim_cost_dtls['cu_amount']);

                    $woq=array_sum($wo_pre_cost_trim_cost_dtls['woq']);
                    $amount=array_sum($wo_pre_cost_trim_cost_dtls['amount']);
                    $rate=$amount/$woq;
                    $total_amount+=$amount;
                    $reqAmtJobLevelConsUom=$reqAmountJobLevelArr[$job_no];

					$piNumber=0;
					$pi_number=$pi_array[$trim_group];
					if($pi_number!="") $piNumber=1;

					$recvNumber=0;
					$recv_number=$recv_array[$trim_group];
					if($recv_number) $recvNumber=1;

					$disAbled=0;
					if($recvNumber==1 || $piNumber==1) $disAbled=1; else $disAbled=0;
					if($cbo_company_name<0) $cbo_company_name=0;
					$tna_integrated=return_field_value("tna_integrated","variable_order_tracking","company_name='$cbo_company_name' and variable_list=14 and status_active=1 and is_deleted=0","tna_integrated");
					//echo $cbo_company_name.'X';
					if($tna_integrated==1)
					{
						//echo " $('#txt_delevary_date').attr('disabled',true);\n";
						$deli_date_con="disabled=disabled";
					}
					else
					{
						//echo "$('#txt_delevary_date').attr('disabled',false);\n";
						$deli_date_con="";
					}
					$trim_type=$trim_type_arr[$trim_group];
					//echo $trim_type.'ddd';
					if($trim_type==1) $task_num='70'; else $task_num='71';
					$task_finish_date='';
					//$tnasql=sql_select("select po_number_id,task_finish_date from tna_process_mst where task_number=$task_num and po_number_id in($po_id) and is_deleted= 0 and status_active=1");
					$tnasql=sql_select("select min(po_number_id) as po_number_id,min(task_finish_date) as  task_finish_date from tna_process_mst where task_number=$task_num and po_number_id in($po_id) and is_deleted= 0 and status_active=1 order by task_finish_date ");
					//echo "select min(po_number_id) as po_number_id,min(task_finish_date) as  task_finish_date from tna_process_mst where task_number=$task_num and po_number_id in($po_id) and is_deleted= 0 and status_active=1 order by task_finish_date ";

					foreach($tnasql as $tnarow){
					//$task_finish_date_arr[$tnarow[csf('po_number_id')]]=$tnarow[csf('task_finish_date')];
					$task_finish_date=$tnarow[csf('task_finish_date')];
					}
					//$task_finish_date=$task_finish_date_arr[$po_id];
					$sql_tna_lib=sql_select("select b.date_calc, b.day_status from lib_capacity_calc_mst a, lib_capacity_calc_dtls b where a.id=b.mst_id and a.comapny_id=$cbo_company_name and b.date_calc='$task_finish_date' and a.status_active=1 and a.is_deleted=0");

					$date_calc=$sql_tna_lib[0][csf("date_calc")];
					$day_status=$sql_tna_lib[0][csf("day_status")];

					if($day_status==2)
					{
					$task_finish_date=return_field_value("max(b.date_calc) as  date_calc ", " lib_capacity_calc_mst a, lib_capacity_calc_dtls b "," a.id=b.mst_id and a.comapny_id=$cbo_company_name and b.date_calc<'$task_finish_date' and a.status_active=1 and a.is_deleted=0 and b.day_status=1","date_calc");
					}
					else
					{
					$task_finish_date=$task_finish_date;
					}

					//$delivery_date="";
					if($task_finish_date !='')
					{
						$txt_tna_date=change_date_format($task_finish_date,'dd-mm-yyyy','-');
					}
					else
					{
						$txt_tna_date="";
					}
					//echo $disAbled.'=='.$deli_date_con.'='.$txt_tna_date;
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>" style="text-decoration:none; cursor:pointer" id="search<? echo $i;?>">
                        <td width="40"><? echo $i;?></td>
                        <td width="80"><? echo $job_no?><input type="hidden" id="txtjob_<? echo $i;?>" value="<? echo $job_no;?>" style="width:30px" class="text_boxes" readonly/></td>
                        <td width="80"> <p><? echo $style_ref_no;?></p></td>
                        
                        <td width="100" style="word-break:break-all"><? echo $po_number; ?>
                            <input type="hidden" id="txtbookingid_<? echo $i;?>" value="<? echo $booking_id; ?>" readonly/>
                            <input type="hidden" id="txtpoid_<? echo $i;?>" value="<? echo $po_id; ?>" readonly/>
                            <input type="hidden" id="txtcountry_<? echo $i;?>"  value="<? echo $country; ?>" readonly />
                        </td>
                        <td width="100"  title="<? echo $sql_lib_item_group_array[$trim_group][conversion_factor]; ?>"><? echo $trim_group_library[$trim_group];?>
                            <input type="hidden" id="txttrimcostid_<? echo $i;?>" value="<? echo $wo_pre_cost_trim_id;?>" readonly/>
                            <input type="hidden" id="txttrimgroup_<? echo $i;?>" value="<? echo $trim_group;?>" readonly/>
                            <input class="text_boxes" name="txtReqAmt_<?=$i;?>" id="txtReqAmt_<?=$i;?>" type="hidden" value="<? //=$wo_pre_req_amt; ?>" style="width:30px"/>
                        </td>
                        <td width="100">
                            <input type="text" style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  background-color:<? echo $bgcolor; ?>" id="txthscode_<? echo $i;?>"  value="<? echo $hs_code; ?>" <? if($disAbled){echo "disabled";}else{ echo "";}?> />
                        </td>
                        <td width="150">
                            <input type="text" style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  background-color:<? echo $bgcolor; ?>" id="txtdesc_<? echo $i;?>"  value="<? echo $description; ?>" <? if($disAbled){echo "disabled";}else{ echo "";}?> />
                        </td>
                        <td width="150">
                            <input type="text" style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  background-color:<? echo $bgcolor; ?>" id="txtbrandsup_<? echo $i;?>"  value="<? echo $brand_sup_ref;?>" <? if($disAbled){echo "disabled";}else{ echo "";}?>  />
                        </td>
                        <td width="70" align="right">
                            <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px; text-align:right; background-color:<? echo $bgcolor; ?>" id="txtreqqnty_<? echo $i;?>" value="<? echo number_format($req_qnty_ord_uom,4,'.','');?>"  readonly  />
                            <input type="hidden"  style="width:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px; text-align:right; background-color:<? echo $bgcolor; ?>" id="txtreqamount_<? echo $i;?>" value="<? echo number_format($req_amount_ord_uom,4,'.','');?>"  readonly  />
                            <input type="hidden"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px; text-align:right; background-color:<? echo $bgcolor; ?>" id="txtreqamountjoblevelconsuom_<? echo $i;?>" value="<? echo number_format($reqAmtJobLevelConsUom,4,'.','');?>"  readonly  />
                            <input type="hidden"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px; text-align:right; background-color:<? echo $bgcolor; ?>" id="txtreqamountitemlevelconsuom_<? echo $i;?>" value="<? echo number_format($req_amount_cons_uom,4,'.','');?>"  readonly  />
                        </td>
                        <td width="50"><?  echo $unit_of_measurement[$uom];?><input type="hidden" id="txtuom_<? echo $i;?>" value="<? echo $uom;?>" readonly /></td>
                        <td width="80" align="right">
                            <input type="text"  style="width:100%; height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtcuwoq_<? echo $i;?>" value="<? echo number_format($cu_woq,4,'.',''); ?>"  readonly  />
                            <input type="hidden"  style="width:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtcuamount_<? echo $i;?>" value="<? echo $cu_amount;?>"  readonly  />
                        </td>
                        <td width="80" align="right">
                            <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtbalwoq_<? echo $i;?>" value="<? echo number_format($bal_woq,4,'.','');?>"  readonly  />
                        </td>
                        <td width="100" align="right"><?  echo create_drop_down( "cbocolorsizesensitive_".$i, 100, $size_color_sensitive,"", 1, "--Select--", $sensitivity, "set_cons_break_down($i),copy_value(this.value,'cbocolorsizesensitive_',$i)",$disAbled,"1,2,3,4" ); ?>
                        </td>
                        <td width="80" align="right">
                            <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:#FFC" id="txtwoq_<? echo $i;?>" value="<? echo number_format($woq,4,'.','');?>" onClick="open_consumption_popup('requires/trims_booking_multi_job_controllerurmi.php?action=consumption_popup', '<?=$trim_group_library[$trim_group];?>','txtpoid_<? echo $i;?>',<? echo $i;?>)" readonly />
                        </td>
                        <td width="55" align="right">
                            <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtexchrate_<? echo $i;?>" value="<? echo $exchange_rate;?>" readonly />
                        </td>
                        <td width="80" align="right">
                            <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtrate_<? echo $i;?>" value="<? echo $rate;?>" onChange="calculate_amount(<? echo $i; ?>)" readonly />
                            <input type="hidden"  style="width:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtrate_precost_<? echo $i;?>" value="<? echo $rate_ord_uom;?>" readonly />
                        </td>
                        <td width="80" align="right">
                            <input type="text"  style="width:100%;height:100%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtamount_<? echo $i;?>" value="<? echo number_format($amount,4,'.','');?>"  readonly  />
                        </td>
                        <td width="" align="right">
                            <input type="text"   style="width:90%; font-family:Verdana, Geneva, sans-serif; font-size:11px;  text-align:right; background-color:<? echo $bgcolor; ?>" id="txtddate_<? echo $i;?>"  class="datepicker" onChange="compare_date(2)" value="<? echo change_date_format($delivery_date,"dd-mm-yyyy","-"); ?>"  readonly <? if($disAbled){echo "disabled";}else{ echo "";}?>  <? echo $deli_date_con;?>   />
                            <input name="txttnadate_<? echo $i;?>" id="txttnadate_<? echo $i;?>" class="datepicker" type="hidden" value="<? echo $txt_tna_date;?>" style="width:70px;"  readonly/>
                            <input type="hidden" id="consbreckdown_<? echo $i;?>"  value=""/>
                            <input type="hidden" id="jsondata_<? echo $i;?>"  value=""/>
                        </td>
                         <td>
                   		 <input class="text_boxes" type="text" style="width:75px;"  name="txtremark_<? echo $i;?>" id="txtremark_<? echo $i;?>" value="<? echo $remark;?>"/>
                    </td>
                    </tr>
                    <?
                    $i++;
                }
            }
        }
        ?>
        </tbody>
	</table>
	<table width="1660" class="rpt_table" border="0" rules="all">
        <tfoot>
            <tr>
                <th width="40">&nbsp;</th>
                <th width="80">&nbsp;</th> 
                <th width="80">&nbsp;</th>
                <th width="100">&nbsp;</th>
                <th width="100">&nbsp;</th>
                <th width="100">&nbsp;</th>
                <th width="150">&nbsp;</th>
                <th width="150">&nbsp;</th>
                <th width="70"><? echo $tot_req_qty; ?></th>
                <th width="50">&nbsp;</th>
                <th width="80"><? echo $tot_cu_woq; ?></th>
                <th width="80"><? echo $tot_bal_woq; ?></th>
                <th width="100">&nbsp;</th>
                <th width="80">&nbsp;</th>
                <th width="55">&nbsp;</th>
                <th width="80"><input type="hidden" id="tot_amount" value="<? echo  number_format($total_amount,4,'.',''); ?>" class="text_boxes_numeric" style="width:140px"/></th>
                <th width="80"><input type="hidden" id="tot_amount" value="<? echo  number_format($total_amount,4,'.',''); ?>" class="text_boxes_numeric" style="width:140px"/></th>
                <th width="80"><input type="hidden" id="saved_tot_amount" value="0" style="width:80px; text-align:right" readonly/></th>
                  <th >&nbsp;</th>
            </tr>
        </tfoot>
	</table>
    <table width="1600" colspan="17" cellspacing="0" class="" border="0">
        <tr>
            <td align="center"class="button_container">
            	<? echo load_submit_buttons( $permission, "fnc_trims_booking_dtls", 1,0,"reset_form('','booking_list_view','','','')",2); ?>
            </td>
        </tr>
    </table>
	<?
	exit();
}

if ($action=="show_trim_booking_list")
{
	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$booking_month=0;
	if($cbo_booking_month<10){
		$booking_month.=$cbo_booking_month;
	}
	else{
		$booking_month=$cbo_booking_month;
	}
	if($garments_nature==0) $garment_nature_cond=""; else $garment_nature_cond=" and a.garments_nature=$garments_nature";

	$start_date=$cbo_booking_year."-".$booking_month."-01";
	$end_date=$cbo_booking_year."-".$booking_month."-".cal_days_in_month(CAL_GREGORIAN, $booking_month, $cbo_booking_year);
	if($db_type==0){
		if ($start_date!="" &&  $end_date!="") $shipment_date = "and d.pub_shipment_date between '".change_date_format($start_date, "yyyy-mm-dd", "-")."' and '".change_date_format($end_date, "yyyy-mm-dd", "-")."'"; else $shipment_date ="";
	}
	else if($db_type==2){
		if ($start_date!="" &&  $end_date!="") $shipment_date = "and d.pub_shipment_date between '".change_date_format($start_date, "yyyy-mm-dd", "-",1)."' and '".change_date_format($end_date, "yyyy-mm-dd", "-",1)."'"; else $shipment_date ="";
	}

	$sql_lib_item_group_array=array();
	$sql_lib_item_group=sql_select("select id, item_name,conversion_factor,order_uom as cons_uom from lib_item_group");
	foreach($sql_lib_item_group as $row_sql_lib_item_group){
		$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][item_name]=$row_sql_lib_item_group[csf('item_name')];
		$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][conversion_factor]=$row_sql_lib_item_group[csf('conversion_factor')];
		$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][cons_uom]=$row_sql_lib_item_group[csf('cons_uom')];
		$trim_group_library[$row_sql_lib_item_group[csf('id')]]=$row_sql_lib_item_group[csf('item_name')];
	}
	unset($sql_lib_item_group);

	$sql ="SELECT a.job_no, a.currency_id, a.style_ref_no, b.exchange_rate, c.id as bom_trim_dtls_id, c.trim_group, c.description as description_pre_cost, c.brand_sup_ref as brand_sup_ref_precost, c.country, c.rate, d.id as po_id, d.po_number, d.po_quantity as plan_cut, min(e.id) as id, e.po_break_down_id, avg(e.cons) as cons, sum(f.wo_qnty) as cu_woq, sum(f.amount) as cu_amount, f.id as booking_id, f.sensitivity, f.delivery_date, f.description as description , f.brand_supplier as brand_sup_ref from wo_po_details_master a join wo_pre_cost_mst b  on a.id=b.JOB_ID join  wo_pre_cost_trim_cost_dtls c on a.id=c.JOB_ID join wo_po_break_down d on a.id=d.JOB_ID join wo_pre_cost_trim_co_cons_dtls e on a.id=e.JOB_ID and c.id=e.wo_pre_cost_trim_cost_dtls_id and d.id=e.po_break_down_id join wo_booking_dtls f on a.job_no=f.job_no and e.wo_pre_cost_trim_cost_dtls_id= f.pre_cost_fabric_cost_dtls_id and e.po_break_down_id=f.po_break_down_id where f.booking_type=2 and f.booking_no=$txt_booking_no and a.company_name=$cbo_company_name $garment_nature_cond and d.is_deleted=0 and d.status_active=1 and f.status_active=1 and f.is_deleted=0 group by a.job_no, a.currency_id, a.style_ref_no, b.exchange_rate, c.id, c.trim_group, c.description, c.brand_sup_ref, c.country, c.rate, d.id, d.po_number, d.po_quantity, e.po_break_down_id, f.id, f.sensitivity, f.delivery_date, f.description, f.brand_supplier order by d.id, c.id";
	//echo $sql;
	$i=1; $delivery_date='';
	$nameArray=sql_select( $sql ); $job_and_trimgroup_level=array();
	foreach ($nameArray as $row)
	{
		$cbo_currency_job=$row[csf('currency_id')];
		$exchange_rate=$row[csf('exchange_rate')];
		$bom_dtls_id=$row[csf('bom_trim_dtls_id')];
		if($cbo_currency==$cbo_currency_job) $exchange_rate=1;
		
		if(!empty($delivery_date))
		{
			$delivery_date=min($delivery_date,$row[csf('delivery_date')]);
		}
		else $delivery_date=$row[csf('delivery_date')];
		
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['job_no'][$row[csf('po_id')]]=$row[csf('job_no')];
	
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['po_id'][$row[csf('po_id')]]=$row[csf('po_id')];
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['po_number'][$row[csf('po_id')]]=$row[csf('po_number')];
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['country'][$row[csf('po_id')]]=$row[csf('country')];
	
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['description'][$row[csf('po_id')]]=$row[csf('description')];
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]][$bom_dtls_id]['brand_sup_ref'][$row[csf('po_id')]]=$row[csf('brand_sup_ref')];
	
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['trim_group'][$row[csf('po_id')]]=$row[csf('trim_group')];
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['trim_group_name'][$row[csf('po_id')]]=$trim_group_library[$row[csf('trim_group')]];
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['wo_pre_cost_trim_cost_dtls'][$row[csf('po_id')]]=$bom_dtls_id;
	
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['uom'][$row[csf('po_id')]]=$sql_lib_item_group_array[$row[csf('trim_group')]][cons_uom];
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['uom_name'][$row[csf('po_id')]]=$unit_of_measurement[$sql_lib_item_group_array[$row[csf('trim_group')]][cons_uom]];
	
	
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['cu_woq'][$row[csf('po_id')]]=$cu_woq;
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['cu_amount'][$row[csf('po_id')]]=$cu_amount;
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['bal_woq'][$row[csf('po_id')]]=$bal_woq;
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['exchange_rate'][$row[csf('po_id')]]=$exchange_rate;
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['rate'][$row[csf('po_id')]]=$rate_ord_uom;
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['txt_delivery_date'][$row[csf('po_id')]]=$row[csf('delivery_date')];
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['style_ref'][$row[csf('po_id')]]=$row[csf('style_ref_no')];
	
		//$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['booking_id'][$row[csf('po_id')]]=$row[csf('booking_id')];
		$job_and_trimgroup_level[$row[csf('job_no')]][$bom_dtls_id][$row[csf('sensitivity')]][$row[csf('description')]][$row[csf('brand_sup_ref')]]['sensitivity'][$row[csf('po_id')]]=$row[csf('sensitivity')];
	}
	if($cbo_level==2) { unset($nameArray); }
	
	$sql_booking=sql_select("select c.job_no, c.pre_cost_fabric_cost_dtls_id as bomid, c.id as booking_id, c.po_break_down_id, c.sensitivity, c.description, c.brand_supplier, c.wo_qnty as wo_qnty, c.amount as amount,d.po_number from wo_po_break_down d, wo_booking_dtls c where d.job_no_mst=c.job_no and d.id=c.po_break_down_id and c.booking_no=$txt_booking_no and c.booking_type=2 and c.status_active=1 and c.is_deleted=0");

	$trim_ids_arr=array();
	foreach($sql_booking as $row_booking)
	{
		$trim_ids_arr[$row_booking[csf('bomid')]]=$row_booking[csf('bomid')];
	}
	$trim_id_cond=where_con_using_array($trim_ids_arr,0,"id");
	//echo "SELECT id , trim_group from wo_pre_cost_trim_cost_dtls where is_deleted=0 $trim_id_cond ";
	$sql_trims=sql_select("SELECT id , trim_group from wo_pre_cost_trim_cost_dtls where is_deleted=0 $trim_id_cond ");
	$trim_group_arr=array();
	foreach ($sql_trims as $row) 
	{
		$trim_group_arr[$row[csf('id')]]=$row[csf('trim_group')];
	}

	foreach($sql_booking as $row_booking){
		$job_and_trimgroup_level[$row_booking[csf('job_no')]][$row_booking[csf('bomid')]][$row_booking[csf('sensitivity')]][$row_booking[csf('description')]][$row_booking[csf('brand_supplier')]]['woq'][$row_booking[csf('po_break_down_id')]]+=$row_booking[csf('wo_qnty')];
		$job_and_trimgroup_level[$row_booking[csf('job_no')]][$row_booking[csf('bomid')]][$row_booking[csf('sensitivity')]][$row_booking[csf('description')]][$row_booking[csf('brand_supplier')]]['amount'][$row_booking[csf('po_break_down_id')]]+=$row_booking[csf('amount')];

		$job_and_trimgroup_level[$row_booking[csf('job_no')]][$row_booking[csf('bomid')]][$row_booking[csf('sensitivity')]][$row_booking[csf('description')]][$row_booking[csf('brand_supplier')]]['description'][$row_booking[csf('po_break_down_id')]]=$row_booking[csf('description')];
		$job_and_trimgroup_level[$row_booking[csf('job_no')]][$row_booking[csf('bomid')]][$row_booking[csf('sensitivity')]][$row_booking[csf('description')]][$row_booking[csf('brand_supplier')]]['brand_sup_ref'][$row_booking[csf('po_break_down_id')]]=$row_booking[csf('brand_supplier')];
		$job_and_trimgroup_level[$row_booking[csf('job_no')]][$row_booking[csf('bomid')]][$row_booking[csf('sensitivity')]][$row_booking[csf('description')]][$row_booking[csf('brand_supplier')]]['booking_id'][$row_booking[csf('po_break_down_id')]]=$row_booking[csf('booking_id')];
		$job_and_trimgroup_level[$row_booking[csf('job_no')]][$row_booking[csf('bomid')]][$row_booking[csf('sensitivity')]][$row_booking[csf('description')]][$row_booking[csf('brand_supplier')]]['po_number'][$row_booking[csf('po_break_down_id')]]=$row_booking[csf('po_number')];
		$job_and_trimgroup_level[$row_booking[csf('job_no')]][$row_booking[csf('bomid')]][$row_booking[csf('sensitivity')]][$row_booking[csf('description')]][$row_booking[csf('brand_supplier')]]['sensitivity'][$row_booking[csf('po_break_down_id')]]=$row_booking[csf('sensitivity')];
		$job_and_trimgroup_level[$row_booking[csf('job_no')]][$row_booking[csf('bomid')]][$row_booking[csf('sensitivity')]][$row_booking[csf('description')]][$row_booking[csf('brand_supplier')]]['uom'][$row_booking[csf('po_break_down_id')]]=$sql_lib_item_group_array[$trim_group_arr[$row_booking[csf('bomid')]]][cons_uom];

		$job_and_trimgroup_level[$row_booking[csf('job_no')]][$row_booking[csf('bomid')]][$row_booking[csf('sensitivity')]][$row_booking[csf('description')]][$row_booking[csf('brand_supplier')]]['uom_name'][$row_booking[csf('po_break_down_id')]]=$unit_of_measurement[$sql_lib_item_group_array[$trim_group_arr[$row_booking[csf('bomid')]]][cons_uom]];
		
		$job_and_trimgroup_level[$row_booking[csf('job_no')]][$row_booking[csf('bomid')]][$row_booking[csf('sensitivity')]][$row_booking[csf('description')]][$row_booking[csf('brand_supplier')]]['trim_group'][$row_booking[csf('po_break_down_id')]]=$trim_group_library[$trim_group_arr[$row_booking[csf('bomid')]]];
	}
	unset($sql_booking);
	?>
	<table cellspacing="0" cellpadding="0" border="1" rules="all" width="1130" class="rpt_table">
        <thead>
            <th width="30">SL</th>
            <th width="90">Job No</th>
            <th width="100">Style Ref.</th>
            <th width="100">Ord. No</th>
            <th width="100">Trims Group</th>
            <th width="120">Description</th>
            <th width="100">Brand Sup.</th>
            <th width="60">UOM</th>
            <th width="80">Sensitivity</th>
            <th width="70">WOQ</th>
            <th width="50">Exch. Rate</th>
            <th width="60">Rate</th>
            <th width="80">Amount</th>
            <th>Delv. Date</th>
        </thead>
        <tbody id="save_list">
			<?
            if($cbo_level==1)
			{
				foreach ($nameArray as $rrow)
				{
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				
					$cbo_currency_job=$rrow[csf('currency_id')];
					$exchange_rate=$rrow[csf('exchange_rate')];
					if($cbo_currency==$cbo_currency_job) $exchange_rate=1;
					
					$woq=def_number_format($job_and_trimgroup_level[$rrow[csf('job_no')]][$rrow[csf('bom_trim_dtls_id')]][$rrow[csf('sensitivity')]][$rrow[csf('description')]][$rrow[csf('brand_sup_ref')]]['woq'][$rrow[csf('po_id')]],3,"");
					//echo $rrow[csf('job_no')].'='.$rrow[csf('wo_pre_cost_trim_cost_dtls')].'='.$rrow[csf('sensitivity')].'='.$rrow[csf('description')].'='.$rrow[csf('brand_sup_ref')].'='.$rrow[csf('wo_pre_cost_trim_cost_dtls')];
				
					$amount=def_number_format($job_and_trimgroup_level[$rrow[csf('job_no')]][$rrow[csf('bom_trim_dtls_id')]][$rrow[csf('sensitivity')]][$rrow[csf('description')]][$rrow[csf('brand_sup_ref')]]['amount'][$rrow[csf('po_id')]],3,"");
					//$rate=def_number_format($amount/$woq,3,"");
					$rate=$job_and_trimgroup_level[$rrow[csf('job_no')]][$rrow[csf('bom_trim_dtls_id')]][$rrow[csf('sensitivity')]][$rrow[csf('description')]][$rrow[csf('brand_sup_ref')]]['amount'][$rrow[csf('po_id')]]/$job_and_trimgroup_level[$rrow[csf('job_no')]][$rrow[csf('bom_trim_dtls_id')]][$rrow[csf('sensitivity')]][$rrow[csf('description')]][$rrow[csf('brand_sup_ref')]]['woq'][$rrow[csf('po_id')]];
					$total_amount+=$amount;
					?>
					<tr bgcolor="<?=$bgcolor; ?>" style="text-decoration:none; cursor:pointer" id="search<?=$i; ?>" onClick="fnc_show_booking(<?=$rrow[csf('bom_trim_dtls_id')]; ?>,'<?=$rrow[csf('po_id')]; ?>','<?=$rrow[csf('booking_id')];?>','<?=$rrow[csf('job_no')];?>')">
                        <td width="30" align="center"><?=$i; ?></td>
                        <td width="90" style="word-break:break-all"><?=$rrow[csf('job_no')]; ?></td>
                        <td width="100" style="word-break:break-all"><?=$rrow[csf('style_ref_no')]; ?></td>
                        <td width="100" style="word-break:break-all"><?=$rrow[csf('po_number')]; ?></td>
                        <td width="100" style="word-break:break-all" title="<?=$sql_lib_item_group_array[$rrow[csf('trim_group')]][conversion_factor]; ?>"><?=$trim_group_library[$rrow[csf('trim_group')]]; ?></td>
                        <td width="120" style="word-break:break-all"><?=$rrow[csf('description')]; ?></td>
                        <td width="100" style="word-break:break-all"><?=$rrow[csf('brand_sup_ref')]; ?></td>
                        <td width="60" style="word-break:break-all"><?=$unit_of_measurement[$sql_lib_item_group_array[$rrow[csf('trim_group')]][cons_uom]]; ?></td>
                        <td width="80" style="word-break: break-all"><?=$size_color_sensitive[$rrow[csf("sensitivity")]]; ?></td>
                        <td width="70" align="right"><?=number_format($woq,3,'.',''); ?></td>
                        <td width="50" align="right"><?=$exchange_rate; ?></td>
                        <td width="60" align="right"><?=number_format($rate,4,'.',''); ?></td>
                        <td width="80" align="right"><?=number_format($amount,3,'.',''); ?></td>
                        <td><?=change_date_format($rrow[csf('delivery_date')],"dd-mm-yyyy","-"); ?></td>
					</tr>
					<?
					$i++;
				}
            }
            else if($cbo_level==2)//Job Level
			{
				$i=1;
				foreach ($job_and_trimgroup_level as $job_no=>$job_wise_data)
				{
					foreach ($job_wise_data as $sen)
					{
						foreach ($sen as $desc)
						{
							foreach ($desc as $brandsup)
							{
								foreach ($brandsup as $wo_pre_cost_trim_cost_dtls)
								{
									//$job_no=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['job_no']));
									$po_number=implode(",",$wo_pre_cost_trim_cost_dtls['po_number']);
									$po_id=implode(",",$wo_pre_cost_trim_cost_dtls['po_id']);
									$country=implode(",",array_unique(explode(",",implode(",",$wo_pre_cost_trim_cost_dtls['country']))));
									$description=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['description']));
									$brand_sup_ref=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['brand_sup_ref']));
									$wo_pre_cost_trim_id=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['wo_pre_cost_trim_cost_dtls']));
									$trim_group = implode(",",array_unique($wo_pre_cost_trim_cost_dtls['trim_group']));
									$uom=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['uom']));
									$style_ref=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['style_ref']));
									$booking_id=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['booking_id']));
									$sensitivity=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['sensitivity']));
									//$delivery_date=implode(",",array_unique($wo_pre_cost_trim_cost_dtls['txt_delivery_date']));
									//$delivery_date=date('d-m-Y',$delivery_date);
								
									$woq=def_number_format(array_sum($wo_pre_cost_trim_cost_dtls['woq']),3,"");
									$amount=def_number_format(array_sum($wo_pre_cost_trim_cost_dtls['amount']),3,"");
									//$rate=def_number_format($amount/$woq,3,"");
									$rate=array_sum($wo_pre_cost_trim_cost_dtls['amount'])/array_sum($wo_pre_cost_trim_cost_dtls['woq']);
									$total_amount+=$amount;
								
									?>
									<tr bgcolor="<?=$bgcolor; ?>" style="text-decoration:none; cursor:pointer" id="search<?=$i; ?>" onClick="fnc_show_booking(<?=$wo_pre_cost_trim_id; ?>,'<?=$po_id; ?>','<?=$booking_id; ?>','<?=$job_no; ?>')">
                                        <td width="30" align="center"><?=$i; ?></td>
                                        <td width="90" style="word-break: break-all"><?=$job_no; ?></td>
                                        <td width="100" style="word-break:break-all"><?=$style_ref; ?></td>
                                        <td width="100" style="word-break: break-all"><?=$po_number; ?></td>
                                        <td width="100" style="word-break: break-all" title="<?=$sql_lib_item_group_array[$trim_group][conversion_factor]; ?>"><?=$trim_group; ?></td>
                                        <td width="120" style="word-break: break-all"><?=$description; ?></td>
                                        <td width="100" style="word-break: break-all"><?=$brand_sup_ref; ?></td>
                                        <td width="60" style="word-break: break-all"><?=$unit_of_measurement[$uom]; ?></td>
                                        <td width="80" style="word-break: break-all"><?=$size_color_sensitive[$sensitivity]; ?></td>
                                        <td width="70" align="right"><?=number_format($woq,4,'.',''); ?></td>
                                        <td width="50" align="right"><?=$exchange_rate; ?></td>
                                        <td width="60" align="right"><?=number_format($rate,4,'.',''); ?></td>
                                        <td width="80" align="right"><?=number_format($amount,6,'.',''); ?></td>
                                        <td><?=change_date_format($delivery_date); ?></td>
									</tr>
									<?
									$i++;
								}
							}
						}
					}
				}
            }
            ?>
        </tbody>
	</table>
	<?
	exit();
}

if ($action == "consumption_popup")
{
	echo load_html_head_contents("Consumption Entry","../../../", 1, 1, $unicode,'','');
	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	?>
	<script>
		var str_gmtssizes = [<? echo substr(return_library_autocomplete( "select size_name from lib_size where status_active=1 and is_deleted=0", "size_name" ), 0, -1); ?>];
		var str_diawidth = [<? echo substr(return_library_autocomplete( "select color_name from lib_color where status_active=1 and is_deleted=0", "color_name" ), 0, -1); ?>];

		function poportionate_qty(qty)
		{
			var round_check=0;
			var total_txtwoq_cal=0;
			if ($('#round_down').is(":checked"))
			{
			   round_check=1;
			}
			var txtwoq=document.getElementById('txtwoq').value*1;
			var txtwoq_qty=document.getElementById('txtwoq_qty').value*1;
			var rowCount = $('#tbl_consmption_cost tbody tr').length;
			for(var i=1; i<=rowCount; i++){
				var poreqqty=$('#poreqqty_'+i).val()*1;
				var txtwoq_cal =number_format_common((txtwoq_qty/txtwoq) * (poreqqty),5,0);
				if(round_check==1){
					txtwoq_cal=Math.floor(txtwoq_cal);
					total_txtwoq_cal+=Math.floor(txtwoq_cal);
				}
				$('#qty_'+i).val(txtwoq_cal);
				calculate_requirement(i);
			}
			/* if(round_check==1){
				$('#txtwoq_qty').val(number_format_common(total_txtwoq_cal,5,0));
			} */
			set_sum_value( 'qty_sum', 'qty_');
			if(round_check!=1){
				var j=i-1;
				var qty_sum=document.getElementById('qty_sum').value*1;
				if(qty_sum >txtwoq_qty ){
					$('#qty_'+j).val(number_format_common(txtwoq_cal*1-(qty_sum-txtwoq_qty),5,0));				
				}
				else if(qty_sum < txtwoq_qty ){
					$('#qty_'+j).val(number_format_common((txtwoq_cal*1) +(txtwoq_qty - qty_sum),5,0));				
				}
				else{
					$('#qty_'+j).val(number_format_common(txtwoq_cal,5,0));
				}
			}
			//set_sum_value( 'qty_sum', 'qty_');
			calculate_requirement(j);
		}

		function calculate_requirement(i)
		{
			var process_loss_method_id=document.getElementById('process_loss_method_id').value;
			if(process_loss_method_id == ''){
				console.log('if process_loss_method_id setting value 0 calculate requirment set woqny 0 ::'+process_loss_method_id);
			}
			var cons=(document.getElementById('qty_'+i).value)*1;
			var processloss=(document.getElementById('excess_'+i).value)*1;
			var WastageQty='';
			if(process_loss_method_id==1){
				WastageQty=cons+cons*(processloss/100);
			}
			else if(process_loss_method_id==2){
				var devided_val = 1-(processloss/100);
				var WastageQty=parseFloat(cons/devided_val);
			}
			else{
				WastageQty=0;
			}
			WastageQty= number_format_common( WastageQty, 5, 0) ;
			document.getElementById('woqny_'+i).value= WastageQty;
			set_sum_value( 'woqty_sum', 'woqny_' );
			calculate_amount(i);
		}

		function set_sum_value(des_fil_id,field_id)
		{
			if(des_fil_id=='qty_sum') var ddd={dec_type:5,comma:0,currency:0};
			if(des_fil_id=='excess_sum') var ddd={dec_type:5,comma:0,currency:0};
			if(des_fil_id=='woqty_sum') var ddd={dec_type:5,comma:0,currency:0};
			if(des_fil_id=='amount_sum') var ddd={dec_type:5,comma:0,currency:0};
			if(des_fil_id=='pcs_sum') var ddd={dec_type:6,comma:0};
			var rowCount = $('#tbl_consmption_cost tbody tr').length;
			math_operation( des_fil_id, field_id, '+', rowCount,ddd );
		}

		function copy_value(value,field_id,i)
		{
			var itemsizes=document.getElementById('itemsizes_'+i).value;
			var gmtssizesid=document.getElementById('gmtssizesid_'+i).value;
			var pocolorid=document.getElementById('pocolorid_'+i).value;
			var rowCount = $('#tbl_consmption_cost tbody tr').length;
			var copy_basis=$('input[name="copy_basis"]:checked').val()

			for(var j=i; j<=rowCount; j++)
			{
				if(field_id=='des_' || field_id=='brndsup_' || field_id=='itemcolor_' || field_id=='itemsizes_' || field_id=='qty_' || field_id=='excess_' || field_id=='rate_' || field_id=='itemref_'){
					if(copy_basis==0) document.getElementById(field_id+j).value=value;
					if(copy_basis==1)
					{
						if(field_id=='itemcolor_')
						{
							if( pocolorid==document.getElementById('pocolorid_'+j).value) document.getElementById(field_id+j).value=value;
						}
						else
						{
							if( gmtssizesid==document.getElementById('gmtssizesid_'+j).value) document.getElementById(field_id+j).value=value;
						}
					}
					if(copy_basis==2){
						if( pocolorid==document.getElementById('pocolorid_'+j).value) document.getElementById(field_id+j).value=value;
					}
					if(copy_basis==3){
						if( itemsizes==document.getElementById('itemsizes_'+j).value) document.getElementById(field_id+j).value=value;
					}
					if(field_id=='qty_' || field_id=='excess_')
					{
						calculate_requirement(j);
						if(field_id=='qty_') set_sum_value( 'qty_sum', 'qty_' );
					}
					if(field_id=='rate_') calculate_amount(j);
				}
			}
		}

		function calculate_amount(i)
		{
			var rate=(document.getElementById('rate_'+i).value)*1;
			var woqny=(document.getElementById('woqny_'+i).value)*1;
			var amount=number_format_common((rate*woqny),5,0);
			document.getElementById('amount_'+i).value=amount;
			set_sum_value( 'amount_sum', 'amount_' );
			calculate_avg_rate();
		}

		function calculate_avg_rate()
		{
			var woqty_sum=document.getElementById('woqty_sum').value;
			var amount_sum=document.getElementById('amount_sum').value;
			//var avg_rate=number_format_common((amount_sum/woqty_sum),5,0);
			var avg_rate=(amount_sum/woqty_sum);
			document.getElementById('rate_sum').value=avg_rate;
		}

		function js_set_value()
		{
			var reg=/[^a-zA-Z0-9!@#$%^,;.:<>{}?\+|\[\]\- \/]/g;
			var row_num=$('#tbl_consmption_cost tbody tr').length;
			var cons_breck_down="";
			for(var i=1; i<=row_num; i++){
				var txtdescription=$('#des_'+i).val();
				var txtsupref=$('#brndsup_'+i).val();
				//alert(txtdescription.match(reg))
				if(txtdescription.match(reg)){
					alert("Your Description Can not Have any thing other than a-zA-Z0-9!@#$%^,;.:<>{}?+|[]/- ");
					//release_freezing();
					$('#des_'+i).css('background-color', 'red');
					return;
				}
				if(txtsupref.match(reg)){
					alert("Your Brand Sup. Ref Can not Have any thing other than a-zA-Z0-9!@#$%^,;.:<>{}?+|[]/- ");
					$('#brndsup_'+i).css('background-color', 'red');
					//release_freezing();
					return;
				}

				var pocolorid=$('#pocolorid_'+i).val();					if($('#pocolorid_'+i).val()=='') pocolorid=0;
				var gmtssizesid=$('#gmtssizesid_'+i).val(); 			if(gmtssizesid=='') gmtssizesid=0;
				var des=trim($('#des_'+i).val()); 						if(des=='') des=0;
				var brndsup=trim($('#brndsup_'+i).val()); 				if(brndsup=='') brndsup=0;
				var itemcolor=$('#itemcolor_'+i).val(); 				if(itemcolor=='') itemcolor=0;
				var itemref=$('#itemref_'+i).val(); 					if(itemref=='') itemref=0;
				var itemsizes=$('#itemsizes_'+i).val(); 				if(itemsizes=='') itemsizes=0;
				var qty=$('#qty_'+i).val(); 							if(qty=='') qty=0;
				var excess=$('#excess_'+i).val(); 						if(excess=='') excess=0;
				var woqny=$('#woqny_'+i).val(); 						if(woqny=='') woqny=0;
				var rate=$('#rate_'+i).val(); 							if(rate=='') rate=0;
				var amount=$('#amount_'+i).val(); 						if(amount=='') amount=0;
				var pcs=$('#pcs_'+i).val(); 							if(pcs=='') pcs=0;
				var colorsizetableid=$('#colorsizetableid_'+i).val(); 	if(colorsizetableid=='')colorsizetableid=0;
				var updateid=$('#updateid_'+i).val(); 					if(updateid=='') updateid=0;
				var reqqty=$('#reqqty_'+i).val(); 						if(reqqty=='') reqqty=0;
				var remarks=$('#remarks_'+i).val(); 					if(remarks=='') remarks=0;
				var poarticle=$('#poarticle_'+i).val(); 				if(poarticle=='') poarticle='no article';

				if(cons_breck_down==""){
					cons_breck_down+=pocolorid+'_'+gmtssizesid+'_'+des+'_'+brndsup+'_'+itemcolor+'_'+itemsizes+'_'+qty+'_'+excess+'_'+woqny+'_'+rate+'_'+amount+'_'+pcs+'_'+colorsizetableid+'_'+reqqty+'_'+poarticle+'_'+itemref+'_'+remarks;
				}
				else{
					cons_breck_down+="__"+pocolorid+'_'+gmtssizesid+'_'+des+'_'+brndsup+'_'+itemcolor+'_'+itemsizes+'_'+qty+'_'+excess+'_'+woqny+'_'+rate+'_'+amount+'_'+pcs+'_'+colorsizetableid+'_'+reqqty+'_'+poarticle+'_'+itemref+'_'+remarks;
				}
			}
			document.getElementById('cons_breck_down').value=cons_breck_down;
			parent.emailwindow.hide();
		}

		function fnc_qty_blank()
		{
			var rowCount = $('#tbl_consmption_cost tbody tr').length;
			if(document.getElementById('chk_qty').checked==true)
			{
				document.getElementById('chk_qty').value=1;
				for(var i=1; i<=rowCount; i++){
					$('#qty_'+i).val('');
					calculate_requirement(i);
					calculate_amount(i);
				}
				set_sum_value( 'qty_sum', 'qty_' );
				set_sum_value( 'woqty_sum', 'woqny_' );
			}
			else if(document.getElementById('chk_qty').checked==false)
			{
				document.getElementById('chk_qty').value=0;
				for(var i=1; i<=rowCount; i++){
					$('#qty_'+i).val('');
					calculate_requirement(i);
					calculate_amount(i);
				}
				set_sum_value( 'qty_sum', 'qty_' );
				set_sum_value( 'woqty_sum', 'woqny_' );
			}
		}
	</script>
	</head>
	<body>
		<?
       extract($_REQUEST);
       // extract(check_magic_quote_gpc($_REQUEST));
        if($txt_job_no==""){
			$txt_job_no_cond=""; $txt_job_no_cond1="";
        }
        else{
			$txt_job_no_cond ="and a.job_no='$txt_job_no'"; $txt_job_no_cond1 ="and job_no='$txt_job_no'";
        }
        if($txt_country=="") $txt_country_cond=""; else $txt_country_cond ="and c.country_id in ($txt_country)";

        $process_loss_method=return_field_value("process_loss_method", "variable_order_tracking", "company_name=$cbo_company_name  and variable_list=18 and item_category_id=4 and status_active=1 and is_deleted=0");
        $tot_po_qty=0;
        $sql_po_qty=sql_select("select b.id,sum(c.order_quantity) as order_quantity,(sum(c.order_quantity)/a.total_set_qnty) as order_quantity_set  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where a.id=b.job_id and a.id=c.job_id and b.id=c.po_break_down_id and  b.id in($txt_po_id)  $txt_country_cond  and a.status_active=1 and b.status_active=1 and c.status_active=1 group by b.id,a.total_set_qnty"); //,c.item_number_id
        foreach($sql_po_qty as $sql_po_qty_row){
			$po_qty_arr[$sql_po_qty_row[csf('id')]]=$sql_po_qty_row[csf('order_quantity_set')];
			$tot_po_qty+=$sql_po_qty_row[csf('order_quantity_set')];
        }
		
		 $sql_pre=sql_select("select d.wo_pre_cost_trim_cost_dtls_id as trims_dtls_id,d.color_size_table_id,d.item_ref,d.size_number_id,d.color_number_id,d.item_color_number_id as item_color  from  wo_pre_cost_trim_co_cons_dtls d where   d.po_break_down_id in($txt_po_id)   and d.status_active=1  "); //,c.item_number_id
		// echo "select d.color_size_table_id,d.item_ref  from  wo_pre_cost_trim_co_cons_dtls d where   d.po_break_down_id in($txt_po_id)   and d.status_active=1  ";
		//echo "select d.wo_pre_cost_trim_cost_dtls_id as trims_dtls_id,d.color_size_table_id,d.item_ref,d.size_number_id,d.color_number_id,d.item_color_number_id as item_color  from  wo_pre_cost_trim_co_cons_dtls d where   d.po_break_down_id in($txt_po_id)   and d.status_active=1  ";
        foreach($sql_pre as $row){
			if($row[csf('item_ref')]!='')
			{
			$item_ref_color_size_arr[$row[csf('trims_dtls_id')]][$row[csf('color_size_table_id')]]['item_ref']=$row[csf('item_ref')];
			$item_ref_color_arr[$row[csf('color_number_id')]]['item_ref'].=$row[csf('item_ref')].',';
			$item_ref_size_arr[$row[csf('size_number_id')]]['item_ref'].=$row[csf('item_ref')].',';
			}
			 
        }
		
        ?>
        <div align="center" style="width:1250px;" >
            <fieldset>
                <form id="consumptionform_1" autocomplete="off">
                    <table width="1250" cellspacing="0" class="rpt_table" border="0" id="tbl_consmption_cost" rules="all">
                        <thead>
                        	<tr>
                                <th colspan="16" id="td_sync_msg" style="color:#FF0000"></th>
                            </tr>
                            <tr>
                                <th colspan="16">
                                    <input type="hidden" id="cons_breck_down" name="cons_breck_down" value="" />
                                    <input type="hidden" id="txtwoq" value="<?=$txt_req_quantity;?>"/>
                                    Wo Qty:<input type="text" id="txtwoq_qty" class="text_boxes_numeric" onBlur="poportionate_qty(this.value);" value="<?=$txtwoq; ?>"/>
                                    <input type="radio" name="copy_basis" value="0" <? if(!$txt_update_dtls_id) { echo "checked";} ?>>Copy to All
                                    <input type="radio" name="copy_basis" value="1">Gmts Size Wise
                                    <input type="radio" name="copy_basis" value="2">Gmts Color Wise
                                    <input type="radio" name="copy_basis" value="3">Item Size Wise
                                    <input type="radio" name="copy_basis" value="10" <? if($txt_update_dtls_id) { echo "checked";} ?>>No Copy
									<input type="checkbox" name="round_down" id="round_down" value="" onClick="poportionate_qty();" >Round Down

                                    <input type="hidden" id="process_loss_method_id" name="process_loss_method_id" value="<?=$process_loss_method; ?>"/>
                                    <input type="hidden" id="po_qty" name="po_qty" value="<?=$tot_po_qty; ?>"/>
                                </th>
                            </tr>
                            <tr>
                                <th width="30">SL</th>
                                <th width="80">Article No</th>
                                <th width="90">Gmts. Color</th>
                                <th width="70">Gmts. Sizes</th>
                                <th width="100">Description</th>
                                <th width="100">Brand/Sup Ref</th>
                                <th width="100">Item Color</th>
                                <th width="100">Item Ref</th>
                                <th width="70">Item Size</th>
                                <th width="70">Wo Qty <input type="checkbox" id="chk_qty" name="chk_qty" value="0" onClick="fnc_qty_blank();"></th>
                                <th width="40">Excess %</th>
                                <th width="70">WO Qty.</th>
                                <th width="100">Rate</th>
                                <th width="100">Amount</th>
                                <th>RMG Qty</th>
								<th width="200">Remarks</th>
                            </tr>
                        </thead>
                        <tbody>
                        <?
						//echo $txt_po_id.'GGGGGGGGG';die;
                        $sql_lib_item_group_array=array();
                        $sql_lib_item_group=sql_select("select id, item_name,conversion_factor,order_uom as cons_uom from lib_item_group");
                        foreach($sql_lib_item_group as $lrow){
							$sql_lib_item_group_array[$lrow[csf('id')]][item_name]=$lrow[csf('item_name')];
							$sql_lib_item_group_array[$lrow[csf('id')]][conversion_factor]=$lrow[csf('conversion_factor')];
							$sql_lib_item_group_array[$lrow[csf('id')]][cons_uom]=$lrow[csf('cons_uom')];
                        }
						unset($sql_lib_item_group);

                        $booking_data_arr=array();
						if($txt_update_dtls_id=="") $txt_update_dtls_id=0;
                        $booking_data=sql_select("select id, wo_trim_booking_dtls_id, description, brand_supplier, item_color, item_size, cons, process_loss_percent, requirment, rate, amount, pcs, color_size_table_id,item_ref,remarks from wo_trim_book_con_dtls where wo_trim_booking_dtls_id in($txt_update_dtls_id) and status_active=1 and is_deleted=0");

                        foreach($booking_data as $row){
							$booking_data_arr[$row[csf('color_size_table_id')]][id]=$row[csf('id')];
							$booking_data_arr[$row[csf('color_size_table_id')]][description]=$row[csf('description')];
							$booking_data_arr[$row[csf('color_size_table_id')]][brand_supplier]=$row[csf('brand_supplier')];
							$booking_data_arr[$row[csf('color_size_table_id')]][item_color]=$row[csf('item_color')];
							$booking_data_arr[$row[csf('color_size_table_id')]][item_ref]=$row[csf('item_ref')];
							$booking_data_arr[$row[csf('color_size_table_id')]][item_size]=$row[csf('item_size')];
							$booking_data_arr[$row[csf('color_size_table_id')]][remarks]=$row[csf('remarks')];
							$booking_data_arr[$row[csf('color_size_table_id')]][cons]+=$row[csf('cons')];
							$booking_data_arr[$row[csf('color_size_table_id')]][process_loss_percent]=$row[csf('process_loss_percent')];
							$booking_data_arr[$row[csf('color_size_table_id')]][requirment]+=$row[csf('requirment')];
							$booking_data_arr[$row[csf('color_size_table_id')]][rate]=$row[csf('rate')];
							$booking_data_arr[$row[csf('color_size_table_id')]][amount]+=$row[csf('amount')];
                        }
						unset($booking_data);

                        $condition= new condition();
                        if(str_replace("'","",$txt_po_id) !=''){
							$condition->po_id("in($txt_po_id)");
                        }

                        $condition->init();
                        $trims= new trims($condition);
						//echo $trims->getQuery(); die;
						$piNumber=0;
						$pi_number=return_field_value( "pi_number", "com_pi_master_details a,com_pi_item_details b"," a.id=b.pi_id  and b.work_order_no='$txt_booking_no' and b.item_group='".$txt_trim_group_id."' and a.item_category_id=4 and a.status_active=1 and  a.is_deleted=0  and b.status_active=1 and  b.is_deleted=0");
						if($pi_number){
							$piNumber=1;
						}
						$recvNumber=0;
						$recv_number=return_field_value( "recv_number", "inv_receive_master a,inv_trims_entry_dtls b"," a.id=b.mst_id and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and b.item_group_id='".$txt_trim_group_id."' and a.item_category=4 and a.status_active=1 and  a.is_deleted=0  and b.status_active=1 and  b.is_deleted=0");
						if($recv_number){
							$recvNumber=1;
						}
						
                        $gmt_color_edb=""; $item_color_edb=""; $gmt_size_edb=""; $item_size_edb="";
                        if($cbo_colorsizesensitive==1){
							$req_qty_arr=$trims->getQtyArray_by_orderPrecostdtlsidAndGmtscolor();
							$req_amount_arr=$trims->getAmountArray_by_orderAndPrecostdtlsidAndGmtscolor();
							$sql="SELECT b.id, b.po_number, b.po_quantity, min(c.id) as color_size_table_id, c.color_number_id, min(c.color_order) as color_order, sum(c.order_quantity) as order_quantity, (sum(c.order_quantity)/a.total_set_qnty) as order_quantity_set from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c, wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where  a.id=b.job_id and a.id=c.job_id and a.id=d.job_id and a.id=e.job_id and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  b.id, b.po_number,b.po_quantity,a.total_set_qnty,c.color_number_id order by b.id, color_order";
							$gmt_size_edb=1; $item_size_edb=1;
                        }
                        else if($cbo_colorsizesensitive==2){

							//$req_qty_arr=$trims->getQtyArray_by_orderPrecostdtlsidAndGmtssize();
							//$req_amount_arr=$trims->getAmountArray_by_orderAndPrecostdtlsidAndGmtssize();

							$req_qty_arr=$trims->getQtyArray_by_orderPrecostdtlsidGmtssizeAndArticle();
							$req_amount_arr=$trims->getAmountArray_by_orderAndPrecostdtlsidGmtssizeAndArticle();
						//print_r($req_amount_arr);

							$sql="select b.id, b.po_number,b.po_quantity,min(c.id) as color_size_table_id,c.size_number_id,c.article_number,min(c.size_order) as size_order,min(e.item_size) as item_size,sum(c.order_quantity) as order_quantity ,(sum(c.order_quantity)/a.total_set_qnty) as order_quantity_set from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c ,wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.id=b.job_id and a.id=c.job_id and a.id=d.job_id and a.id=e.job_id and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  b.id, b.po_number,b.po_quantity,a.total_set_qnty,c.size_number_id,c.article_number order by b.id,size_order";
							$gmt_color_edb=1; $item_color_edb=1;
                        }
                        else if($cbo_colorsizesensitive==3){
							$req_qty_arr=$trims->getQtyArray_by_orderPrecostdtlsidAndGmtscolor();
							$req_amount_arr=$trims->getAmountArray_by_orderAndPrecostdtlsidAndGmtscolor();
							$sql="select b.id, b.po_number,b.po_quantity,min(c.id) as color_size_table_id,c.color_number_id,min(c.color_order) as color_order,sum(c.order_quantity) as order_quantity ,(sum(c.order_quantity)/a.total_set_qnty) as order_quantity_set,min(e.item_color_number_id) as item_color_number_id from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c,wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.id=b.job_id and a.id=c.job_id and a.id=d.job_id and a.id=e.job_id and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  b.id, b.po_number,b.po_quantity,a.total_set_qnty,c.color_number_id order by b.id, color_order";
							$gmt_size_edb=1; $item_size_edb=1;
                        }
                        else if($cbo_colorsizesensitive==4){

							//$req_qty_arr=$trims->getQtyArray_by_OrderPrecostdtlsidGmtscolorAndGmtssize();
							//$req_amount_arr=$trims->getAmountArray_by_OrderPrecostdtlsidGmtscolorAndGmtssize();
							//$req_qty_arr=$trims->getQtyArray_by_OrderPrecostdtlsidGmtscolorGmtssizeAndArticle();
							//$req_amount_arr=$trims->getAmountArray_by_OrderPrecostdtlsidGmtscolorGmtssizeAndArticle();


							$req_qty_arr=$trims->getQtyArray_by_OrderPrecostdtlsidGmtscolorGmtssizeAndArticleItemColorItemSize();
							$req_amount_arr=$trims->getAmountArray_by_OrderPrecostdtlsidGmtscolorGmtssizeAndArticleItemColorItemSize();
							//echo $trims->getQuery();

						 $sql="select b.id, b.po_number, b.po_quantity, min(c.id) as color_size_table_id, c.color_number_id, c.size_number_id, c.article_number, min(c.color_order) as color_order, min(c.size_order) as size_order, e.item_size as item_size, sum(c.order_quantity) as order_quantity,(sum(c.order_quantity)/a.total_set_qnty) as order_quantity_set,e.item_color_number_id from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c,wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.id=b.job_id and a.id=c.job_id and a.id=d.job_id and a.id=e.job_id and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  b.id, b.po_number,b.po_quantity,a.total_set_qnty,c.color_number_id,c.size_number_id,c.article_number,e.item_color_number_id,e.item_size  order by b.id, color_order,size_order";
                        }
                        else{
							$req_qty_arr=$trims->getQtyArray_by_orderAndPrecostdtlsid();
							$req_amount_arr=$trims->getAmountArray_by_orderAndPrecostdtlsid();
							$sql="select b.id, b.po_number,b.po_quantity,min(c.id) as color_size_table_id,sum(c.order_quantity) as order_quantity,(sum(c.order_quantity)/a.total_set_qnty) as order_quantity_set  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c,wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.id=b.job_id and a.id=c.job_id and a.id=d.job_id and a.id=e.job_id and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  b.id, b.po_number,b.po_quantity,a.total_set_qnty order by b.id";
                        }

                        $po_color_level_data_arr=array(); $po_size_level_data_arr=array(); $po_no_sen_level_data_arr=array(); $po_color_size_level_data_arr=array();
						
						
                        $data_array=sql_select($sql);
						//echo $sql;
                        if ( count($data_array)>0)
						{
							$i=0;
							foreach( $data_array as $row ){
								$data=explode('_',$data_array_cons[$i]);
								$i++;
								$item_color = $booking_data_arr[$row[csf('color_size_table_id')]][item_color];
								if($item_color==0 || $item_color=="" ) $item_color = $row[csf('color_number_id')];

								$item_size=$booking_data_arr[$row[csf('color_size_table_id')]][item_size];
								if($item_size=='0' || $item_size == "") $item_size=$row[csf('item_size')];

								$rate=$booking_data_arr[$row[csf('color_size_table_id')]][rate];
								if($rate==0 || $rate=="")$rate=$txt_avg_price;

								$description=$booking_data_arr[$row[csf('color_size_table_id')]][description];
								if($description=="") $description=trim($txt_pre_des);

								$brand_supplier=$booking_data_arr[$row[csf('color_size_table_id')]][brand_supplier];
								if($brand_supplier=="") $brand_supplier=trim($txt_pre_brand_sup);

								if($cbo_colorsizesensitive==1 || $cbo_colorsizesensitive==3 )
								{
									$txt_req_quantity=$req_qty_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('color_number_id')]];
									$req_qnty_ord_uom=def_number_format($txt_req_quantity/$sql_lib_item_group_array[$txt_trim_group_id][conversion_factor],5,"");
									$txtwoq_cal =def_number_format($req_qnty_ord_uom,5,"");
									$txtreq_amount=$req_amount_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('color_number_id')]];

									$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['req_qty'][$row[csf('id')]]=$txtwoq_cal;
									$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['req_amt'][$row[csf('id')]]=$txtreq_amount;
									$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['po_qty'][$row[csf('id')]]=$po_qty;
									$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['order_quantity_set'][$row[csf('id')]]=$row[csf('order_quantity_set')];
									$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['po_id'][$row[csf('id')]]=$row[csf('id')];
									$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['order_quantity'][$row[csf('id')]]=$row[csf('order_quantity')];
									$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['color_size_table_id'][$row[csf('id')]]=$row[csf('color_size_table_id')];
									if($cbo_colorsizesensitive==3)
									{
										$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['item_color_number_id'][$row[csf('id')]]=$row[csf('item_color_number_id')];
									}

									$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['booking_cons'][$row[csf('id')]]=$booking_data_arr[$row[csf('color_size_table_id')]][cons];
									$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['booking_qty'][$row[csf('id')]]=$booking_data_arr[$row[csf('color_size_table_id')]][requirment];
									$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['booking_amt'][$row[csf('id')]]=$booking_data_arr[$row[csf('color_size_table_id')]][amount];
								}
								else if($cbo_colorsizesensitive==2)
								{
									$txt_req_quantity=$req_qty_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]];
									$txtreq_amount=$req_amount_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]];
									//echo $txtreq_amount.'='.$txt_req_quantity.', ';
									$req_qnty_ord_uom=def_number_format($txt_req_quantity/$sql_lib_item_group_array[$txt_trim_group_id][conversion_factor],5,"");
									$txtwoq_cal =def_number_format($req_qnty_ord_uom,5,"");
									$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['req_qty'][$row[csf('id')]]=$txtwoq_cal;
									$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['req_amt'][$row[csf('id')]]=$txtreq_amount;
									$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['po_qty'][$row[csf('id')]]=$po_qty;
									$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['order_quantity_set'][$row[csf('id')]]=$row[csf('order_quantity_set')];
									$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['po_id'][$row[csf('id')]]=$row[csf('id')];
									$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['order_quantity'][$row[csf('id')]]=$row[csf('order_quantity')];

									$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['color_size_table_id'][$row[csf('id')]]=$row[csf('color_size_table_id')];
									$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['article_number'][$row[csf('id')]]=$row[csf('article_number')];

									$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['booking_cons'][$row[csf('id')]]=$booking_data_arr[$row[csf('color_size_table_id')]][cons];
									$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['booking_qty'][$row[csf('id')]]=$booking_data_arr[$row[csf('color_size_table_id')]][requirment];
									$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['booking_amt'][$row[csf('id')]]=$booking_data_arr[$row[csf('color_size_table_id')]][amount];

								}
								else if($cbo_colorsizesensitive==4)
								{
									$txt_req_quantity=$req_qty_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]];
									$txtreq_amount=$req_amount_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]];

									// echo "<pre>";
									// print_r($req_amount_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]]);
									// echo "</pre>";
									$req_qnty_ord_uom=def_number_format($txt_req_quantity/$sql_lib_item_group_array[$txt_trim_group_id][conversion_factor],5,"");
									$txtwoq_cal =def_number_format($req_qnty_ord_uom,5,"");
									
									if($row[csf('item_color_number_id')]=='' || $row[csf('item_color_number_id')]=='0' || $color_library[$row[csf('item_color_number_id')]]=='' || $color_library[$row[csf('item_color_number_id')]]=='0') $row[csf('item_color_number_id')]=$row[csf('color_number_id')];

									$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['req_qty'][$row[csf('id')]]+=$txtwoq_cal;
									$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['req_amt'][$row[csf('id')]]+=$txtreq_amount;
									$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['po_qty'][$row[csf('id')]]=$po_qty;
									$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['order_quantity_set'][$row[csf('id')]]=$row[csf('order_quantity_set')];
									$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['po_id'][$row[csf('id')]]=$row[csf('id')];
									$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['order_quantity'][$row[csf('id')]]=$row[csf('order_quantity')];
									$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['color_size_table_id'][$row[csf('id')]]=$row[csf('color_size_table_id')];
									$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['article_number'][$row[csf('id')]]=$row[csf('article_number')];
									$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['item_size'][$row[csf('id')]]=$row[csf('item_size')];
									$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['item_color_number_id'][$row[csf('id')]]=$row[csf('item_color_number_id')];

									$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['booking_cons'][$row[csf('id')]]=$booking_data_arr[$row[csf('color_size_table_id')]][cons];
									$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['booking_qty'][$row[csf('id')]]=$booking_data_arr[$row[csf('color_size_table_id')]][requirment];
									$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['booking_amt'][$row[csf('id')]]=$booking_data_arr[$row[csf('color_size_table_id')]][amount];

								}
								else if($cbo_colorsizesensitive==0)
								{
									$txt_req_quantity=$req_qty_arr[$row[csf('id')]][$cbo_trim_precost_id];
									$txtreq_amount=$req_amount_arr[$row[csf('id')]][$cbo_trim_precost_id];
									$req_qnty_ord_uom=def_number_format($txt_req_quantity/$sql_lib_item_group_array[$txt_trim_group_id][conversion_factor],5,"");
									$txtwoq_cal =def_number_format($req_qnty_ord_uom,5,"");

									$po_no_sen_level_data_arr[$cbo_trim_precost_id]['req_qty'][$row[csf('id')]]=$txtwoq_cal;
									$po_no_sen_level_data_arr[$cbo_trim_precost_id]['req_amt'][$row[csf('id')]]=$txtreq_amount;
									$po_no_sen_level_data_arr[$cbo_trim_precost_id]['po_qty'][$row[csf('id')]]=$po_qty;
									$po_no_sen_level_data_arr[$cbo_trim_precost_id]['order_quantity_set'][$row[csf('id')]]=$row[csf('order_quantity_set')];
									$po_no_sen_level_data_arr[$cbo_trim_precost_id]['po_id'][$row[csf('id')]]=$row[csf('id')];
									$po_no_sen_level_data_arr[$cbo_trim_precost_id]['order_quantity'][$row[csf('id')]]=$row[csf('order_quantity')];
									$po_no_sen_level_data_arr[$cbo_trim_precost_id]['color_size_table_id'][$row[csf('id')]]=$row[csf('color_size_table_id')];

									$po_no_sen_level_data_arr[$cbo_trim_precost_id]['booking_cons'][$row[csf('id')]]=$booking_data_arr[$row[csf('color_size_table_id')]][cons];
									$po_no_sen_level_data_arr[$cbo_trim_precost_id]['booking_qty'][$row[csf('id')]]=$booking_data_arr[$row[csf('color_size_table_id')]][requirment];
									$po_no_sen_level_data_arr[$cbo_trim_precost_id]['booking_amt'][$row[csf('id')]]=$booking_data_arr[$row[csf('color_size_table_id')]][amount];

								}
							}
                        }
						/*$piNumber=0;

						$pi_number=return_field_value( "pi_number", "com_pi_master_details a,com_pi_item_details b"," a.id=b.pi_id  and b.work_order_no='$txt_booking_no' and b.item_group='".$txt_trim_group_id."' and a.item_category_id=4 and a.status_active=1 and  a.is_deleted=0  and b.status_active=1 and  b.is_deleted=0");
						if($pi_number){
							$piNumber=1;
						}
						$recvNumber=0;
						$recv_number=return_field_value( "recv_number", "inv_receive_master a,inv_trims_entry_dtls b"," a.id=b.mst_id and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and b.item_group_id='".$txt_trim_group_id."' and a.item_category=4 and a.status_active=1 and  a.is_deleted=0  and b.status_active=1 and  b.is_deleted=0");
						if($recv_number){
							$recvNumber=1;
						}*/
						//echo $piNumber."PI8888888";

                        if ( count($data_array)>0 && $cbo_level==1)
						{
							$i=0;
							foreach( $data_array as $row )
							{
								$data=explode('_',$data_array_cons[$i]);

								if($cbo_colorsizesensitive==1 || $cbo_colorsizesensitive==3 ){
									$txt_req_quantity=$req_qty_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('color_number_id')]];
									$txtwoq_amt_cal=$req_amount_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('color_number_id')]];
									$item_size="";
									$item_color = $booking_data_arr[$row[csf('color_size_table_id')]][item_color];
									if(empty($item_color) && $cbo_colorsizesensitive==3)
									{
										$item_color = $row[csf('item_color_number_id')];
									}
									if($item_color==0 || $item_color=="" ) $item_color = $row[csf('color_number_id')];
								}
								else if($cbo_colorsizesensitive==2){
									$txt_req_quantity = $req_qty_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]];
									$txtwoq_amt_cal = $req_amount_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]];
									
									$item_color ="";
									$item_size=$booking_data_arr[$row[csf('color_size_table_id')]][item_size];
									if($item_size=='0' || $item_size == "") $item_size=$row[csf('item_size')];
									if($item_size=='0' || $item_size == "") $item_size=$size_library[$row[csf('size_number_id')]];
								}
								else if($cbo_colorsizesensitive==4){
									$txt_req_quantity=$req_qty_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]];
									$txtwoq_amt_cal=$req_amount_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]];
									$item_color = $booking_data_arr[$row[csf('color_size_table_id')]][item_color];
									if(empty($item_color))
									{
										$item_color = $row[csf('item_color_number_id')];
									}
									if($color_library[$item_color]=='0' || $color_library[$item_color]=="" ) $item_color = $row[csf('color_number_id')];
									
									$item_size=$booking_data_arr[$row[csf('color_size_table_id')]][item_size];
									if($item_size=='0' || $item_size == "") $item_size=$row[csf('item_size')];
									if($item_size=='0' || $item_size == "") $item_size=$size_library[$row[csf('size_number_id')]];
								}
								else if($cbo_colorsizesensitive==0){
									$txt_req_quantity = $req_qty_arr[$row[csf('id')]][$cbo_trim_precost_id];
									$txtwoq_amt_cal = $req_amount_arr[$row[csf('id')]][$cbo_trim_precost_id];
									
									$item_color = $booking_data_arr[$row[csf('color_size_table_id')]][item_color];
									if($item_color==0 || $item_color=="" ) $item_color = $row[csf('color_number_id')];
									
									$item_size=$booking_data_arr[$row[csf('color_size_table_id')]][item_size];
									if($item_size=='0' || $item_size == "") $item_size=$row[csf('item_size')];
									if($item_size=='0' || $item_size == "") $item_size=$size_library[$row[csf('size_number_id')]];
								}
								$req_qnty_ord_uom = def_number_format($txt_req_quantity/$sql_lib_item_group_array[$txt_trim_group_id][conversion_factor],5,"");
								$txtwoq_cal = def_number_format($req_qnty_ord_uom,5,"");

								$rate=$booking_data_arr[$row[csf('color_size_table_id')]][rate];
								if($rate==0 || $rate=="") $rate=$txtwoq_amt_cal/$txt_req_quantity;//$rate=$txt_avg_price; 20-2047 by Aziz

								$description=$booking_data_arr[$row[csf('color_size_table_id')]][description];
								if($description=="") $description=trim($txt_pre_des);

								$brand_supplier=$booking_data_arr[$row[csf('color_size_table_id')]][brand_supplier];
								if($brand_supplier=="")$brand_supplier=trim($txt_pre_brand_sup);
								
								$pre_item_ref=$item_ref_color_size_arr[$cbo_trim_precost_id][$row[csf('color_size_table_id')]]['item_ref'];
								//echo $pre_item_ref.'='.$row[csf('color_size_table_id')].',';
								$item_ref = $booking_data_arr[$row[csf('color_size_table_id')]][item_ref];
								if($item_ref) $item_ref=$item_ref;else $item_ref=$pre_item_ref;
								$remarks = $booking_data_arr[$row[csf('color_size_table_id')]][remarks];

								if($txtwoq_cal>0)
								{
									$i++;
									?>
                                    <tr id="break_<? echo $i;?>" align="center">
                                        <td><? echo $i;?></td>
                                        <td><input type="text" id="poarticle_<? echo $i;?>" name="poarticle_<? echo $i;?>" class="text_boxes" style="width:70px" value="<? echo $row[csf('article_number')]; ?>"  readonly /></td>
                                        <td>
                                            <input type="text" id="pocolor_<? echo $i;?>" name="pocolor_<? echo $i;?>" class="text_boxes" style="width:80px" value="<? echo $color_library[$row[csf('color_number_id')]]; ?>" <? if($gmt_color_edb || $piNumber || $recvNumber ){ echo  "disabled";}else { echo "";} ?> readonly/>
                                            <input type="hidden" id="pocolorid_<? echo $i;?>" name="pocolorid_<? echo $i;?>" class="text_boxes" style="width:70px" value="<? echo $row[csf('color_number_id')]; ?>" readonly />
                                            <input type="hidden" id="poid_<? echo $i;?>" name="poid_<? echo $i;?>" class="text_boxes" style="width:70px" value="<? echo $row[csf('id')]; ?>" />
                                            <input type="hidden" id="poqty_<? echo $i;?>" name="poqty_<? echo $i;?>" class="text_boxes" style="width:70px" value="<? echo $po_qty_arr[$row[csf('id')]]; ?>" readonly />
                                            <input type="hidden" id="poreqqty_<? echo $i;?>" name="poreqqty_<? echo $i;?>" class="text_boxes" style="width:70px" value="<? echo $txtwoq_cal; ?>" readonly />
                                        </td>
                                        <td>
                                            <input type="text" id="gmtssizes_<? echo $i;?>"  name="gmtssizes_<? echo $i;?>" class="text_boxes" style="width:60px" value="<? echo $size_library[$row[csf('size_number_id')]]; ?>" <? if($gmt_size_edb || $piNumber || $recvNumber ){ echo  "disabled";}else { echo "";} ?> readonly/>
                                            <input type="hidden" id="gmtssizesid_<? echo $i;?>"  name="gmtssizesid_<? echo $i;?>" class="text_boxes" style="width:50px" value="<? echo $row[csf('size_number_id')]; ?>" readonly />
                                        </td>
                                        <td><input type="text" id="des_<? echo $i;?>"  name="des_<? echo $i;?>" class="text_boxes" style="width:90px" value="<? echo $description;?>" onChange="copy_value(this.value,'des_',<? echo $i;?>)" <? if( $piNumber || $recvNumber ){ echo  "disabled";}else { echo "";} ?> /></td>
                                        <td><input type="text" id="brndsup_<? echo $i;?>"  name="brndsup_<? echo $i;?>" class="text_boxes" style="width:90px" value="<? echo $brand_supplier; ?>" onChange="copy_value(this.value,'brndsup_',<? echo $i;?>)" <? if( $piNumber || $recvNumber ){ echo  "disabled";}else { echo "";} ?>/></td>
                                        <td><input type="text" id="itemcolor_<? echo $i;?>" value="<? echo $color_library[$item_color]; ?>" name="itemcolor_<? echo $i;?>" class="text_boxes" style="width:90px" onChange="copy_value(this.value,'itemcolor_',<? echo $i;?>)" <? if($item_color_edb || $piNumber || $recvNumber ){ echo "disabled";}else { echo "";} ?> /></td>
                                        <td><input type="text" id="itemref_<? echo $i;?>" value="<? echo $item_ref; ?>" name="itemref_<? echo $i;?>" class="text_boxes" style="width:90px" onChange="copy_value(this.value,'itemref_',<? echo $i;?>)" <? if($piNumber || $recvNumber ){ echo "disabled";}else { echo "";} ?> /></td>
                                        
                                        <td><input type="text" id="itemsizes_<? echo $i;?>"  name="itemsizes_<? echo $i;?>"    class="text_boxes" style="width:60px" onChange="copy_value(this.value,'itemsizes_',<? echo $i;?>)" value="<? echo $item_size; ?>" <? if($item_size_edb || $piNumber || $recvNumber ){ echo  "disabled";}else { echo "";} ?> /></td>
                                        <td><input type="hidden" id="reqqty_<? echo $i;?>"  name="reqqty_<? echo $i;?>" class="text_boxes_numeric" style="width:60px"    value="<? echo $txtwoq_cal ?>" readonly/>
                                        	<input type="text" id="qty_<? echo $i;?>" onBlur="validate_sum( <? echo $i; ?> )" onChange="set_sum_value( 'qty_sum', 'qty_' );set_sum_value( 'woqty_sum', 'woqny_' );calculate_requirement(<? echo $i;?>);copy_value(this.value,'qty_',<? echo $i;?>)"  name="qty_<? echo $i;?>" class="text_boxes_numeric" style="width:60px"   placeholder="<? echo $txtwoq_cal; ?>" value="<? echo $booking_data_arr[$row[csf('color_size_table_id')]][cons]; ?>"/>
                                        </td>
                                        <td><input type="text" id="excess_<? echo $i;?>" onBlur="set_sum_value( 'excess_sum', 'excess_' ) "  name="excess_<? echo $i;?>" class="text_boxes_numeric" style="width:30px" onChange="calculate_requirement(<? echo $i;?>);set_sum_value( 'excess_sum', 'excess_' );set_sum_value( 'woqty_sum', 'woqny_' );copy_value(this.value,'excess_',<? echo $i;?>) " value="<? echo $booking_data_arr[$row[csf('color_size_table_id')]][process_loss_percent]; ?>" disabled/></td>
                                        <td><input type="text" id="woqny_<? echo $i;?>" onBlur="set_sum_value('woqty_sum', 'woqny_')" onChange="set_sum_value('woqty_sum', 'woqny_')" name="woqny_<? echo $i;?>" class="text_boxes_numeric" style="width:60px" value="<? echo $booking_data_arr[$row[csf('color_size_table_id')]][requirment]; ?>" readonly /></td>
                                        <td><input type="text" id="rate_<? echo $i;?>"  name="rate_<? echo $i;?>" class="text_boxes_numeric" style="width:90px" onChange="calculate_amount(<? echo $i;?>);set_sum_value( 'amount_sum', 'amount_' );copy_value(this.value,'rate_',<? echo $i;?>) " value="<? echo $rate; ?>" <? if( $piNumber || $recvNumber ){ echo  "disabled";}else { echo "";} ?> /></td>
                                        <td><input type="text" id="amount_<? echo $i;?>" name="amount_<? echo $i;?>" onBlur="set_sum_value( 'amount_sum', 'amount_' )" class="text_boxes_numeric" style="width:90px" value="<? echo $booking_data_arr[$row[csf('color_size_table_id')]][amount]; ?>" readonly></td>
                                        <td>
                                            <input type="text" id="pcs_<? echo $i;?>"  name="pcs_<? echo $i;?>"  onBlur="set_sum_value( 'pcs_sum', 'pcs_' ) " class="text_boxes_numeric" style="width:50px"  value="<? echo $row[csf('order_quantity')]; ?>" readonly>
                                            <input type="hidden" id="pcsset_<? echo $i;?>"  name="pcsset_<? echo $i;?>"  onBlur="set_sum_value( 'pcs_sum', 'pcs_' ) " class="text_boxes_numeric" style="width:50px"  value="<? echo $row[csf('order_quantity_set')]; ?>" readonly>
                                            <input type="hidden" id="colorsizetableid_<? echo $i;?>"  name="colorsizetableid_<? echo $i;?>" class="text_boxes" style="width:45px" value="<? echo $row[csf('color_size_table_id')]; ?>" />
                                            <input type="hidden" id="updateid_<? echo $i;?>"  name="updateid_<? echo $i;?>" class="text_boxes" style="width:45px" value="<? echo $booking_data_arr[$row[csf('color_size_table_id')]][id]; ?>" readonly />
                                        </td>
										<td><input type="text" id="remarks_<? echo $i;?>"  name="remarks_<? echo $i;?>" class="text_boxes" style="width:90px" value="<? echo $remarks;?>" onChange="copy_value(this.value,'remarks_',<? echo $i;?>)" />
                                            
                                        </td>
                                    </tr>
								<?
								}
							}
                        }

                        $level_arr=array(); $gmt_color_edb="";  $item_color_edb="";  $gmt_size_edb="";  $item_size_edb="";
                        if($cbo_colorsizesensitive==1){
							$sql="select min(b.id) as id , min(c.id) as color_size_table_id,c.color_number_id,min(c.color_order) as color_order,sum(c.order_quantity) as order_quantity from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c,wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.job_no=b.job_no_mst and a.id=c.job_id and a.id=d.job_id and a.id=e.job_id and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1   and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  c.color_number_id order by  color_order";
							$level_arr=$po_color_level_data_arr;
							$gmt_size_edb=1;
							$item_size_edb=1;
                        }
                        else if($cbo_colorsizesensitive==2){
							$sql="select min(b.id) as id , min(c.id) as color_size_table_id,c.size_number_id,c.article_number,min(c.size_order) as size_order,min(e.item_size) as item_size,sum(c.order_quantity) as order_quantity from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c ,wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.id=b.job_id and a.id=c.job_id and a.id=d.job_id and a.id=e.job_id and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1   and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  c.size_number_id,c.article_number order by size_order";
							$level_arr=$po_size_level_data_arr;
							$gmt_color_edb=1; $item_color_edb=1;
                        }
                        else if($cbo_colorsizesensitive==3){
							$sql="SELECT min(b.id) as id, min(c.id) as color_size_table_id,c.color_number_id,min(c.color_order) as color_order,sum(c.order_quantity) as order_quantity, min(e.item_color_number_id) as item_color_number_id  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c ,wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.job_no=b.job_no_mst and a.id=c.job_id and a.id=d.job_id and a.id=e.job_id and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1   and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  c.color_number_id order by  color_order";
							$level_arr=$po_color_level_data_arr;
							$gmt_size_edb=1; $item_size_edb=1;
                        }
                        else if($cbo_colorsizesensitive==4){
						 $sql="select min(b.id) as id ,min(c.id) as color_size_table_id, c.color_number_id, c.size_number_id, c.article_number, min(c.color_order) as color_order, min(c.size_order) as size_order, e.item_size as item_size, e.item_color_number_id, sum(c.order_quantity) as order_quantity  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c, wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.id=b.job_id and a.id=c.job_id and a.id=d.job_id and a.id=e.job_id and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  c.color_number_id,c.size_number_id, c.article_number,e.item_color_number_id,e.item_size order by  color_order,size_order,c.article_number";
							$level_arr=$po_color_size_level_data_arr;
                        }
                        else{
							$sql="select b.job_no_mst,min(b.id) as id , min(c.id) as color_size_table_id,sum(c.order_quantity) as order_quantity from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c ,wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and a.id=d.job_id and a.id=e.job_id and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1   and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  b.job_no_mst";
							$level_arr=$po_no_sen_level_data_arr;
                        }
						
                        $data_array=sql_select($sql);
                        if ( count($data_array)>0 && $cbo_level==2){
							$i=0;
							foreach( $data_array as $row ){

								if($cbo_colorsizesensitive==1){
									$txtwoq_cal =def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['req_qty']),5,"");
									$txtwoq_amt_cal =def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['req_amt']),5,"");;
									$po_qty=array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['po_qty']);
									$order_quantity_set=array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['order_quantity_set']);
									$booking_cons=def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['booking_cons']),5,"");
									$booking_qty=def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['booking_qty']),5,"");
									$booking_amt=def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['booking_amt']),5,"");
									
									$item_size="";
									
									$item_color = $booking_data_arr[$row[csf('color_size_table_id')]][item_color];
									if($item_color==0 || $item_color=="" ) $item_color = $row[csf('color_number_id')];
								}
								if($cbo_colorsizesensitive==2){
									$txtwoq_cal =def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['req_qty']),5,"");
									$txtwoq_amt_cal =def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['req_amt']),5,"");
									//echo $txtwoq_amt_cal.'='.$txtwoq_cal.' , ';
									$po_qty=array_sum($level_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['po_qty']);
									$order_quantity_set=array_sum($level_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['order_quantity_set']);
									$booking_cons=def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['booking_cons']),5,"");
									$booking_qty=def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['booking_qty']),5,"");
									$booking_amt=def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['booking_amt']),5,"");
									
									$item_size=$booking_data_arr[$row[csf('color_size_table_id')]][item_size];
									if($item_size=='0' || $item_size == "") $item_size=$row[csf('item_size')];
									if($item_size=='0' || $item_size == "") $item_size=$size_library[$row[csf('size_number_id')]];
									
									$item_color = "";
								}
								if($cbo_colorsizesensitive==3){
									$txtwoq_cal =def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['req_qty']),5,"");
									$txtwoq_amt_cal =def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['req_amt']),5,"");
									$po_qty=array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['po_qty']);
									$order_quantity_set=array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['order_quantity_set']);
									$booking_cons=def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['booking_cons']),5,"");
									$booking_qty=def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['booking_qty']),5,"");
									$booking_amt=def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['booking_amt']),5,"");
									
									$item_size="";
									$item_color = $booking_data_arr[$row[csf('color_size_table_id')]][item_color];
									if($item_color==0 || $item_color=="" ) $item_color = $row[csf('item_color_number_id')];
									if($item_color==0 || $item_color=="" ) $item_color = $row[csf('color_number_id')];
									
								}
								if($cbo_colorsizesensitive==4){
									if($row[csf('item_color_number_id')]=='' || $row[csf('item_color_number_id')]=='0' || $color_library[$row[csf('item_color_number_id')]]=='' || $color_library[$row[csf('item_color_number_id')]]=='0') $row[csf('item_color_number_id')]=$row[csf('color_number_id')];
									$txtwoq_cal =def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['req_qty']),5,"");
									$txtwoq_amt_cal =def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['req_amt']),5,"");
									$po_qty=array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['po_qty']);
									$order_quantity_set=array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['order_quantity_set']);
									$booking_cons=def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['booking_cons']),5,"");
									$booking_qty=def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['booking_qty']),5,"");
									$booking_amt=def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['booking_amt']),5,"");
									$item_color =0;
									$item_color = $booking_data_arr[$row[csf('color_size_table_id')]][item_color];
									if($item_color=='0' || $item_color=="" ) $item_color = $row[csf('item_color_number_id')];
									if($color_library[$item_color]=='0' || $color_library[$item_color]=="" || $item_color=='0' || $item_color=="") $item_color = $row[csf('color_number_id')];
									
									$item_size=$booking_data_arr[$row[csf('color_size_table_id')]][item_size];
									if($item_size=='0' || $item_size == "") $item_size=$row[csf('item_size')];
									if($item_size=='0' || $item_size == "") $item_size=$size_library[$row[csf('size_number_id')]];
								}
								if($cbo_colorsizesensitive==0){
									$txtwoq_cal =def_number_format(array_sum($level_arr[$cbo_trim_precost_id]['req_qty']),5,"");
									$txtwoq_amt_cal =def_number_format(array_sum($level_arr[$cbo_trim_precost_id]['req_amt']),5,"");
									$po_qty=array_sum($level_arr[$cbo_trim_precost_id]['po_qty']);
									$order_quantity_set=array_sum($level_arr[$cbo_trim_precost_id]['order_quantity_set']);
									$booking_cons=def_number_format(array_sum($level_arr[$cbo_trim_precost_id]['booking_cons']),5,"");
									$booking_qty=def_number_format(array_sum($level_arr[$cbo_trim_precost_id]['booking_qty']),5,"");
									$booking_amt=def_number_format(array_sum($level_arr[$cbo_trim_precost_id]['booking_amt']),5,"");
									
									$item_color = $booking_data_arr[$row[csf('color_size_table_id')]][item_color];
									if($item_color==0 || $item_color=="" ) $item_color = $row[csf('color_number_id')];
								}

								$rate=$booking_data_arr[$row[csf('color_size_table_id')]][rate];
								if(($rate*1)==0)
								{
									if($booking_amt>0) $rate=$booking_amt/$booking_qty; else $rate=$txtwoq_amt_cal/$txtwoq_cal;
								}
								//echo "<pre>".$rate."**".$booking_amt."__".$booking_qty."**".$txtwoq_amt_cal."__".$txtwoq_cal."</pre>";
								//$rate=$txt_avg_price; //20-2047 by aziz


								$description=$booking_data_arr[$row[csf('color_size_table_id')]][description];
								if($description=="") $description=trim($txt_pre_des);
								//echo $description.'='.$txt_pre_des.'<br/>';
								$brand_supplier=$booking_data_arr[$row[csf('color_size_table_id')]][brand_supplier];
								if($brand_supplier=="") $brand_supplier=trim($txt_pre_brand_sup);
								
								$pre_item_ref=$item_ref_color_size_arr[$cbo_trim_precost_id][$row[csf('color_size_table_id')]]['item_ref'];
								//echo $pre_item_ref.'='.$row[csf('color_size_table_id')].',';
								$item_ref = $booking_data_arr[$row[csf('color_size_table_id')]][item_ref];
								if($item_ref) $item_ref=$item_ref;else $item_ref=$pre_item_ref;
								$remarks = $booking_data_arr[$row[csf('color_size_table_id')]][remarks];

								if($txtwoq_cal>0)
								{
									$i++;
									?>
									<tr id="break_<?=$i; ?>" align="center">
                                        <td><?=$i; ?></td>
                                        <td><input type="text" id="poarticle_<? echo $i;?>"  name="poarticle_<? echo $i;?>" class="text_boxes" style="width:70px" value="<? echo $row[csf('article_number')]; ?>" readonly />
                                        </td>
                                        <td>
                                            <input type="text" id="pocolor_<? echo $i;?>"  name="pocolor_<? echo $i;?>" class="text_boxes" style="width:80px" value="<? echo $color_library[$row[csf('color_number_id')]]; ?>" <? if($gmt_color_edb || $piNumber || $recvNumber ){ echo  "disabled";}else { echo "";} ?> readonly />
                                            <input type="hidden" id="pocolorid_<? echo $i;?>"  name="pocolorid_<? echo $i;?>" class="text_boxes" style="width:75px" value="<? echo $row[csf('color_number_id')]; ?>" readonly />
                                            <input type="hidden" id="poid_<? echo $i;?>"  name="poid_<? echo $i;?>" class="text_boxes" style="width:75px" value="<? echo $row[csf('id')]; ?>" readonly />
                                            <input type="hidden" id="poqty_<? echo $i;?>"  name="poqty_<? echo $i;?>" class="text_boxes" style="width:75px" value="<? echo $po_qty; ?>" readonly />
                                            <input type="hidden" id="poreqqty_<? echo $i;?>"  name="poreqqty_<? echo $i;?>" class="text_boxes" style="width:75px" value="<? echo $txtwoq_cal; ?>" readonly />
                                        </td>
                                        <td>
                                            <input type="text" id="gmtssizes_<? echo $i;?>"  name="gmtssizes_<? echo $i;?>" class="text_boxes" style="width:60px" value="<? echo $size_library[$row[csf('size_number_id')]]; ?>" <? if($gmt_size_edb || $piNumber || $recvNumber ){ echo  "disabled";}else { echo "";} ?> readonly/>
                                            <input type="hidden" id="gmtssizesid_<? echo $i;?>"  name="gmtssizesid_<? echo $i;?>" class="text_boxes" style="width:60px" value="<? echo $row[csf('size_number_id')]; ?>" readonly />
                                        </td>
                                        <td><input type="text" id="des_<? echo $i;?>"  name="des_<? echo $i;?>" class="text_boxes" style="width:90px" value="<? echo $description;?>" onChange="copy_value(this.value,'des_',<? echo $i;?>)" <? if( $piNumber || $recvNumber ){ echo  "disabled";}else { echo "";} ?> />
                                        </td>
                                        <td><input type="text" id="brndsup_<? echo $i;?>"  name="brndsup_<? echo $i;?>" class="text_boxes" style="width:90px" value="<? echo $brand_supplier; ?>" onChange="copy_value(this.value,'brndsup_',<? echo $i;?>)" <? if( $piNumber || $recvNumber ){ echo  "disabled";}else { echo "";} ?> />
                                        </td>
                                        <td><input type="text" id="itemcolor_<? echo $i;?>"  value="<? echo $color_library[$item_color]; ?>" name="itemcolor_<? echo $i;?>" class="text_boxes" style="width:90px" onChange="copy_value(this.value,'itemcolor_',<? echo $i;?>)"   <? if($item_color_edb || $piNumber || $recvNumber ){ echo  "disabled";}else { echo "";} ?> /></td>
                                         <td><input type="text" id="itemref_<? echo $i;?>"  value="<? echo $item_ref; ?>" name="itemref_<? echo $i;?>" class="text_boxes" style="width:90px" onChange="copy_value(this.value,'itemref_',<? echo $i;?>)"   <? if($item_color_edb || $piNumber || $recvNumber ){ echo  "disabled";}else { echo "";} ?> /></td>
                                         
                                        <td><input type="text" id="itemsizes_<? echo $i;?>"  name="itemsizes_<? echo $i;?>" class="text_boxes" style="width:60px" onChange="copy_value(this.value,'itemsizes_',<? echo $i;?>)" value="<? echo $item_size; ?>"  <? if($item_size_edb || $piNumber || $recvNumber ){ echo  "disabled";}else { echo "";} ?>/>
                                        </td>
                                        <td><input type="hidden" id="reqqty_<? echo $i;?>"  name="reqqty_<? echo $i;?>" class="text_boxes_numeric" style="width:60px" value="<? echo $txtwoq_cal ?>" readonly/>

                                        	<input type="text" id="qty_<? echo $i;?>" onBlur="validate_sum( <? echo $i; ?> )" onChange="set_sum_value( 'qty_sum', 'qty_' );set_sum_value( 'woqty_sum', 'woqny_' );calculate_requirement(<? echo $i;?>);copy_value(this.value,'qty_',<? echo $i;?>)"  name="qty_<? echo $i;?>" class="text_boxes_numeric" style="width:60px" placeholder="<? echo $txtwoq_cal; ?>" value="<? if($booking_cons>0){echo $booking_cons;} ?>"/>
                                        </td>
                                        <td>
                                        	<input type="text" id="excess_<? echo $i;?>" onBlur="set_sum_value( 'excess_sum', 'excess_' ) "  name="excess_<? echo $i;?>" class="text_boxes_numeric" style="width:30px" onChange="calculate_requirement(<? echo $i;?>);set_sum_value( 'excess_sum', 'excess_' );set_sum_value( 'woqty_sum', 'woqny_' );copy_value(this.value,'excess_',<? echo $i;?>) " value="<? echo $booking_data_arr[$row[csf('color_size_table_id')]][process_loss_percent]; ?>" disabled/>
                                        </td>
                                        <td><input type="text" id="woqny_<? echo $i;?>" onBlur="set_sum_value( 'woqty_sum', 'woqny_' ) " onChange="set_sum_value( 'woqty_sum', 'woqny_' )"  name="woqny_<? echo $i;?>" class="text_boxes_numeric" style="width:60px" value="<?  if($booking_qty){echo $booking_qty;} ?>" readonly />
                                        </td>
                                        <td><input type="text" id="rate_<? echo $i;?>"  name="rate_<? echo $i;?>" class="text_boxes_numeric" style="width:90px" onChange="calculate_amount(<? echo $i;?>);set_sum_value( 'amount_sum', 'amount_' );copy_value(this.value,'rate_',<? echo $i;?>) " value="<? echo $rate; ?>" <? if( $piNumber || $recvNumber ){ echo  "disabled";}else { echo "";} ?> />
                                        </td>
                                        <td><input type="text" id="amount_<? echo $i;?>"  name="amount_<? echo $i;?>"  onBlur="set_sum_value( 'amount_sum', 'amount_' ) " class="text_boxes_numeric" style="width:90px"  value="<? echo $booking_amt; //$booking_data_arr[$row[csf('color_size_table_id')]][amount]; ?>" readonly>
                                        </td>

                                        <td><input type="text" id="pcs_<? echo $i;?>"  name="pcs_<? echo $i;?>"  onBlur="set_sum_value( 'pcs_sum', 'pcs_' ) " class="text_boxes_numeric" style="width:50px"  value="<? echo $row[csf('order_quantity')]; ?>" readonly>
                                            <input type="hidden" id="pcsset_<? echo $i;?>"  name="pcsset_<? echo $i;?>"  onBlur="set_sum_value( 'pcs_sum', 'pcs_' ) " class="text_boxes_numeric" style="width:50px"  value="<? echo $order_quantity_set; ?>" readonly>
                                            <input type="hidden" id="colorsizetableid_<? echo $i;?>"  name="colorsizetableid_<? echo $i;?>" class="text_boxes" style="width:45px" value="<? echo $row[csf('color_size_table_id')]; ?>" />
                                            <input type="hidden" id="updateid_<? echo $i;?>"  name="updateid_<? echo $i;?>" class="text_boxes" style="width:45px" value="<? echo $booking_data_arr[$row[csf('color_size_table_id')]][id]; ?>" readonly />
                                        </td>
										<td><input type="text" id="remarks_<? echo $i;?>"  name="remarks_<? echo $i;?>" class="text_boxes" style="width:90px" value="<? echo $remarks;?>" onChange="copy_value(this.value,'remarks_',<? echo $i;?>)" />
                                            
                                        </td>
									</tr>
								<?
								}
							}
                        }
                        ?>
                        </tbody>
                        <tfoot>
                            <tr>
                               <th width="30">&nbsp;</th>
                               <th width="80">&nbsp;</th>
                               <th width="90">&nbsp;</th>
                               <th width="70">&nbsp;</th>
                               <th width="100">&nbsp;</th>
                               <th width="100">&nbsp;</th>
                               <th width="100">&nbsp;</th>
                               <th width="100">&nbsp;</th>
                               <th width="70">&nbsp;</th>
                               <th width="70"><input type="text" id="qty_sum" name="qty_sum" class="text_boxes_numeric" style="width:60px"  readonly></th>
                               <th width="40"><input type="text" id="excess_sum"  name="excess_sum" class="text_boxes_numeric" style="width:30px" readonly></th>
                               <th width="70"><input type="text" id="woqty_sum"  name="woqty_sum" class="text_boxes_numeric" style="width:60px" readonly></th>
                               <th width="100"><input type="text" id="rate_sum"  name="rate_sum" class="text_boxes_numeric" style="width:90px" readonly></th>
                               <th width="100"><input type="text" id="amount_sum" name="amount_sum" class="text_boxes_numeric" style="width:90px" readonly></th>
                               <th><input type="hidden" id="json_data" name="json_data" class="text_boxes_numeric" style="width:50px" value='<? echo json_encode($level_arr); ?>' readonly>
                                	<input type="text" id="pcs_sum" name="pcs_sum" class="text_boxes_numeric" style="width:50px" readonly>
                               </th>
                            </tr>
                        </tfoot>
                    </table>
                    <table width="1250" cellspacing="0" class="" border="0" rules="all">
                        <tr>
                            <td align="center" width="100%"> <input type="button" class="formbutton" value="Close" onClick="js_set_value()"/> </td>
                        </tr>
                    </table>
                </form>
            </fieldset>
        </div>
	</body>
	<script>
		$("input[type=text]").focus(function() {
		   $(this).select();
		});
		<?
		if($txt_update_dtls_id==""){
			?>
			poportionate_qty(<? echo $txtwoq; ?>);
			<?
		}
		?>
		set_sum_value( 'qty_sum', 'qty_' );
		set_sum_value( 'woqty_sum', 'woqny_' );
		set_sum_value( 'amount_sum', 'amount_' );
		set_sum_value( 'pcs_sum', 'pcs_' );
		calculate_avg_rate();
		var wo_qty=$('#txtwoq_qty').val()*1;

		var wo_qty_sum=$('#qty_sum').val()*1;
		//console.log(wo_qty+'--'+wo_qty_sum);
		//if(wo_qty!=wo_qty_sum)
		if((wo_qty-wo_qty_sum)>1)
		{
			$('#td_sync_msg').html("Booking Info not synchronized with order entry and pre-costing. order entry or pre-costing has updated after booking entry.");
		}
	</script>
	<script src="../../../includes/functions_bottom.js" type="text/javascript"></script>
	</html>
	<?
    exit();
}

if ($action=="set_cons_break_down"){
	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from lib_size",'id','size_name');
	$data=explode("_",$data);
	$garments_nature=$data[0];
	$cbo_company_name=$data[1];
	$txt_job_no=$data[2];
	$txt_po_id=$data[3];
	$cbo_trim_precost_id=$data[4];
	$txt_trim_group_id=$data[5];
	$txt_update_dtls_id=trim($data[6]);
	$cbo_colorsizesensitive=$data[7];
	$txt_req_quantity=$data[8];
	$txt_avg_price=$data[9];
	$txt_country=$data[10];
	$txt_pre_des=$data[11];
	$txt_pre_brand_sup=$data[12];
	$cbo_level=$data[13];

	if($txt_job_no==""){
		$txt_job_no_cond=""; $txt_job_no_cond1="";
	}
	else{
		$txt_job_no_cond ="and a.job_no='$txt_job_no'"; $txt_job_no_cond1 ="and job_no='$txt_job_no'";
	}

	if($txt_country=="") $txt_country_cond=""; else $txt_country_cond ="and c.country_id in ($txt_country)";

	$process_loss_method=return_field_value("process_loss_method", "variable_order_tracking", "company_name=$cbo_company_name  and variable_list=18 and item_category_id=4 and status_active=1 and is_deleted=0");
	$sql_po_qty=sql_select("select b.id,sum(c.order_quantity) as order_quantity,(sum(c.order_quantity)/a.total_set_qnty) as order_quantity_set  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and b.id=c.po_break_down_id and  b.id in($txt_po_id)  $txt_country_cond  and a.status_active=1 and b.status_active=1 and c.status_active=1 group by b.id,a.total_set_qnty"); //,c.item_number_id
	$tot_po_qty=0;
	foreach($sql_po_qty as$sql_po_qty_row){
		$po_qty_arr[$sql_po_qty_row[csf('id')]]=$sql_po_qty_row[csf('order_quantity_set')];
		$tot_po_qty+=$sql_po_qty_row[csf('order_quantity_set')];
	}
	$sql_lib_item_group_array=array();
	$sql_lib_item_group=sql_select("select id, item_name,conversion_factor,order_uom as cons_uom from lib_item_group");
	foreach($sql_lib_item_group as $row_sql_lib_item_group){
		$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][item_name]=$row_sql_lib_item_group[csf('item_name')];
		$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][conversion_factor]=$row_sql_lib_item_group[csf('conversion_factor')];
		$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][cons_uom]=$row_sql_lib_item_group[csf('cons_uom')];
	}
	if($txt_update_dtls_id=="" || $txt_update_dtls_id==0) $txt_update_dtls_id=0;else $txt_update_dtls_id=$txt_update_dtls_id;
	$booking_data_arr=array();
	$booking_data=sql_select("select id,wo_trim_booking_dtls_id,description,brand_supplier,item_color,item_size,cons,process_loss_percent,requirment,rate, 	amount,pcs,color_size_table_id,item_ref  from wo_trim_book_con_dtls where wo_trim_booking_dtls_id in($txt_update_dtls_id) and status_active=1 and is_deleted=0");
	foreach($booking_data as $booking_data_row){
		$booking_data_arr[$booking_data_row[csf('color_size_table_id')]][id]=$booking_data_row[csf('id')];
		$booking_data_arr[$booking_data_row[csf('color_size_table_id')]][description]=$booking_data_row[csf('description')];
		$booking_data_arr[$booking_data_row[csf('color_size_table_id')]][brand_supplier]=$booking_data_row[csf('brand_supplier')];
		$booking_data_arr[$booking_data_row[csf('color_size_table_id')]][item_color]=$booking_data_row[csf('item_color')];
		$booking_data_arr[$booking_data_row[csf('color_size_table_id')]][item_color]=$booking_data_row[csf('item_ref')];
		$booking_data_arr[$booking_data_row[csf('color_size_table_id')]][item_size]=$booking_data_row[csf('item_size')];
		$booking_data_arr[$booking_data_row[csf('color_size_table_id')]][cons]+=$booking_data_row[csf('cons')];
		$booking_data_arr[$booking_data_row[csf('color_size_table_id')]][process_loss_percent]=$booking_data_row[csf('process_loss_percent')];
		$booking_data_arr[$booking_data_row[csf('color_size_table_id')]][requirment]+=$booking_data_row[csf('requirment')];
		$booking_data_arr[$booking_data_row[csf('color_size_table_id')]][rate]=$booking_data_row[csf('rate')];
		$booking_data_arr[$booking_data_row[csf('color_size_table_id')]][amount]+=$booking_data_row[csf('amount')];
	}
	 $sql_pre=sql_select("select d.wo_pre_cost_trim_cost_dtls_id as trims_dtls_id,d.color_size_table_id,d.item_ref,d.size_number_id,d.color_number_id,d.item_color_number_id as item_color  from  wo_pre_cost_trim_co_cons_dtls d where   d.po_break_down_id in($txt_po_id)   and d.status_active=1  "); //,c.item_number_id
		// echo "select d.color_size_table_id,d.item_ref  from  wo_pre_cost_trim_co_cons_dtls d where   d.po_break_down_id in($txt_po_id)   and d.status_active=1  ";
        foreach($sql_pre as $row){
			if($row[csf('item_ref')]!='')
			{
			$item_ref_color_size_arr[$row[csf('trims_dtls_id')]][$row[csf('color_size_table_id')]]['item_ref']=$row[csf('item_ref')];
			$item_ref_color_arr[$row[csf('trims_dtls_id')]][$row[csf('color_number_id')]]['item_ref'].=$row[csf('item_ref')].',';
			$item_ref_size_arr[$row[csf('trims_dtls_id')]][$row[csf('size_number_id')]]['item_ref'].=$row[csf('item_ref')].',';
			}
			 
        }
		unset($sql_pre);
		
		$cu_booking_data_arr=array();
	$cu_booking_data=sql_select("select a.pre_cost_fabric_cost_dtls_id,b.id,b.wo_trim_booking_dtls_id,b.po_break_down_id,b.color_number_id,b.gmts_sizes,b.requirment,b.article_number  from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id=b.wo_trim_booking_dtls_id and b.po_break_down_id in($txt_po_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.id not in($txt_update_dtls_id)");
	foreach($cu_booking_data as $cu_booking_data_row){
		if($cbo_colorsizesensitive==1 || $cbo_colorsizesensitive==3 ){
			$cu_booking_data_arr[$cu_booking_data_row[csf('po_break_down_id')]][$cu_booking_data_row[csf('pre_cost_fabric_cost_dtls_id')]][$cu_booking_data_row[csf('color_number_id')]]+=$cu_booking_data_row[csf('requirment')];
		}
		if($cbo_colorsizesensitive==2 ){
			$cu_booking_data_arr[$cu_booking_data_row[csf('po_break_down_id')]][$cu_booking_data_row[csf('pre_cost_fabric_cost_dtls_id')]][$cu_booking_data_row[csf('gmts_sizes')]][$cu_booking_data_row[csf('article_number')]]+=$cu_booking_data_row[csf('requirment')];
		}
		if($cbo_colorsizesensitive==4 ){
			$cu_booking_data_arr[$cu_booking_data_row[csf('po_break_down_id')]][$cu_booking_data_row[csf('pre_cost_fabric_cost_dtls_id')]][$cu_booking_data_row[csf('color_number_id')]][$cu_booking_data_row[csf('gmts_sizes')]][$cu_booking_data_row[csf('article_number')]][$cu_booking_data_row[csf('item_color')]][$cu_booking_data_row[csf('item_size')]]+=$cu_booking_data_row[csf('requirment')];
		}
		if($cbo_colorsizesensitive==0 ){
			$cu_booking_data_arr[$cu_booking_data_row[csf('po_break_down_id')]][$cu_booking_data_row[csf('pre_cost_fabric_cost_dtls_id')]]+=$cu_booking_data_row[csf('requirment')];
		}
	}

	$condition= new condition();
	if(str_replace("'","",$txt_po_id) !=''){
			$condition->po_id("in($txt_po_id)");
	}

	$condition->init();
	$trims= new trims($condition);
	$gmt_color_edb="";
	$item_color_edb="";
	$gmt_size_edb="";
	$item_size_edb="";
	if($cbo_colorsizesensitive==1){
		$req_qty_arr=$trims->getQtyArray_by_orderPrecostdtlsidAndGmtscolor();
		$req_amount_arr=$trims->getAmountArray_by_orderAndPrecostdtlsidAndGmtscolor();
		 $sql="select b.id, b.po_number,b.po_quantity,min(c.id) as color_size_table_id,c.color_number_id,min(c.color_order) as color_order,sum(c.order_quantity) as order_quantity,(sum(c.order_quantity)/a.total_set_qnty) as order_quantity_set  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c,wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and a.job_no=d.job_no and a.job_no=e.job_no and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1   and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  b.id, b.po_number,b.po_quantity,a.total_set_qnty,c.color_number_id order by b.id, color_order";
		$gmt_size_edb="disabled";
		$item_size_edb="disabled";
	}
	else if($cbo_colorsizesensitive==2){
	    //$req_qty_arr=$trims->getQtyArray_by_orderPrecostdtlsidAndGmtssize();
		//$req_amount_arr=$trims->getAmountArray_by_orderAndPrecostdtlsidAndGmtssize();
		$req_qty_arr=$trims->getQtyArray_by_orderPrecostdtlsidGmtssizeAndArticle();
		$req_amount_arr=$trims->getAmountArray_by_orderAndPrecostdtlsidGmtssizeAndArticle();
		$sql="select b.id, b.po_number,b.po_quantity,min(c.id) as color_size_table_id,c.size_number_id,c.article_number,min(c.size_order) as size_order,min(e.item_size) as item_size,sum(c.order_quantity) as order_quantity ,(sum(c.order_quantity)/a.total_set_qnty) as order_quantity_set from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c,wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and a.job_no=d.job_no and a.job_no=e.job_no and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1   and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  b.id, b.po_number,b.po_quantity,a.total_set_qnty,c.size_number_id,c.article_number order by b.id,size_order";
		$gmt_color_edb="disabled";
		$item_color_edb="disabled";
	}
	else if($cbo_colorsizesensitive==3){
		$req_qty_arr=$trims->getQtyArray_by_orderPrecostdtlsidAndGmtscolor();
		$req_amount_arr=$trims->getAmountArray_by_orderAndPrecostdtlsidAndGmtscolor();
		$sql="select b.id, b.po_number,b.po_quantity,min(c.id) as color_size_table_id,c.color_number_id,min(c.color_order) as color_order,sum(c.order_quantity) as order_quantity ,(sum(c.order_quantity)/a.total_set_qnty) as order_quantity_set,min(e.item_color_number_id) as item_color_number_id from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c,wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and a.job_no=d.job_no and a.job_no=e.job_no and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1   and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  b.id, b.po_number,b.po_quantity,a.total_set_qnty,c.color_number_id order by b.id, color_order";
		$gmt_size_edb="disabled";
		$item_size_edb="disabled";
	}
	else if($cbo_colorsizesensitive==4){

		//$req_qty_arr=$trims->getQtyArray_by_OrderPrecostdtlsidGmtscolorAndGmtssize();
		//$req_amount_arr=$trims->getAmountArray_by_OrderPrecostdtlsidGmtscolorAndGmtssize();

		// $req_qty_arr=$trims->getQtyArray_by_OrderPrecostdtlsidGmtscolorGmtssizeAndArticle();
		// $req_amount_arr=$trims->getAmountArray_by_OrderPrecostdtlsidGmtscolorGmtssizeAndArticle();


		 $req_qty_arr=$trims->getQtyArray_by_OrderPrecostdtlsidGmtscolorGmtssizeAndArticleItemColorItemSize();
		 $req_amount_arr=$trims->getAmountArray_by_OrderPrecostdtlsidGmtscolorGmtssizeAndArticleItemColorItemSize();



		 $sql="select b.id, b.po_number,b.po_quantity,min(c.id) as color_size_table_id,c.color_number_id,c.size_number_id,c.article_number,min(c.color_order) as color_order,min(c.size_order) as size_order,e.item_size as item_size,sum(c.order_quantity) as order_quantity,(sum(c.order_quantity)/a.total_set_qnty) as order_quantity_set,e.item_color_number_id  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c ,wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and a.job_no=d.job_no and a.job_no=e.job_no and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1   and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  b.id, b.po_number,b.po_quantity,a.total_set_qnty,c.color_number_id,c.size_number_id,c.article_number,e.item_color_number_id,e.item_size  order by b.id, color_order,size_order";
	}
	else{
		$req_qty_arr=$trims->getQtyArray_by_orderAndPrecostdtlsid();
	    $req_amount_arr=$trims->getAmountArray_by_orderAndPrecostdtlsid();
		$sql="select b.id, b.po_number,b.po_quantity,min(c.id) as color_size_table_id,sum(c.order_quantity) as order_quantity,(sum(c.order_quantity)/a.total_set_qnty) as order_quantity_set  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c,wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and a.job_no=d.job_no and a.job_no=e.job_no and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1   and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  b.id, b.po_number,b.po_quantity,a.total_set_qnty order by b.id";
	}

	$data_array=sql_select($sql);
	if ( count($data_array)>0)
	{
		$i=0;
		foreach( $data_array as $row )
		{
			$po_qty=$row[csf('order_quantity')];
			$color_number_id=$row[csf('color_number_id')];
			if($color_number_id=="") $color_number_id=0;

			$size_number_id=$row[csf('size_number_id')];
			if($size_number_id=="") $size_number_id=0;

			$description=$txt_pre_des;
			if($description=="") $description=0;

			$brand_supplier=$txt_pre_brand_sup;
			if($brand_supplier=="") $brand_supplier=0;

			$item_color=$color_library[$row[csf('color_number_id')]];
			if($item_color=="") $item_color=0;

			$item_size=$row[csf('item_size')];
			if($item_size=="") $item_size=0;
			$excess=0;
			$pcs=$row[csf('order_quantity_set')];
			if($pcs=="") $pcs=0;

			$colorsizetableid=$row[csf('color_size_table_id')];
			if($colorsizetableid=="") $colorsizetableid=0;

			$articleNumber=$row[csf('article_number')];
			if($articleNumber=="") $articleNumber='no article';

			if($cbo_colorsizesensitive==1 || $cbo_colorsizesensitive==3 ){
				$txt_req_quantity=$req_qty_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('color_number_id')]];
				$req_qnty_ord_uom = def_number_format($txt_req_quantity/$sql_lib_item_group_array[$txt_trim_group_id][conversion_factor],5,"");
				$cu_qnty_ord_uom = def_number_format($cu_booking_data_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('color_number_id')]],5,"");
				//$req_qnty_ord_uom = $req_qnty_ord_uom - $cu_qnty_ord_uom;
				//$txtwoq_cal = def_number_format($req_qnty_ord_uom,5,"");
				$req_qnty_ordUom = def_number_format((($data[14]/$data[8])*$req_qnty_ord_uom),5,"");
				$txtwoq_cal = def_number_format($req_qnty_ordUom,5,"");
				$amount = def_number_format($txtwoq_cal*$txt_avg_price,5,"");

				$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['req_qty'][$row[csf('id')]]=$txtwoq_cal;
				$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['po_qty'][$row[csf('id')]]=$po_qty;
				$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['order_quantity_set'][$row[csf('id')]]=$row[csf('order_quantity_set')];
				$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['po_id'][$row[csf('id')]]=$row[csf('id')];
				$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['order_quantity'][$row[csf('id')]]=$row[csf('order_quantity')];
				$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['color_size_table_id'][$row[csf('id')]]=$row[csf('color_size_table_id')];

				if($cbo_colorsizesensitive==3)
				{
					$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['item_color_number_id'][$row[csf('id')]]=$row[csf('item_color_number_id')];
				}

				$po_color_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['amount'][$row[csf('id')]]=$amount;
			}
			else if($cbo_colorsizesensitive==2){
				$txt_req_quantity=$req_qty_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]];
				$req_qnty_ord_uom=def_number_format($txt_req_quantity/$sql_lib_item_group_array[$txt_trim_group_id][conversion_factor],5,"");
				$cu_qnty_ord_uom = def_number_format($cu_booking_data_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]],5,"");
				//$req_qnty_ord_uom = $req_qnty_ord_uom - $cu_qnty_ord_uom;
				//$txtwoq_cal =def_number_format($req_qnty_ord_uom,5,"");
				$req_qnty_ordUom = def_number_format((($data[14]/$data[8])*$req_qnty_ord_uom),5,"");
				$txtwoq_cal = def_number_format($req_qnty_ordUom,5,"");
				$amount=def_number_format($txtwoq_cal*$txt_avg_price,5,"");

				$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['req_qty'][$row[csf('id')]]=$txtwoq_cal;
				$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['po_qty'][$row[csf('id')]]=$po_qty;
				$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['order_quantity_set'][$row[csf('id')]]=$row[csf('order_quantity_set')];
				$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['po_id'][$row[csf('id')]]=$row[csf('id')];
				$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['order_quantity'][$row[csf('id')]]=$row[csf('order_quantity')];
				$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['color_size_table_id'][$row[csf('id')]]=$row[csf('color_size_table_id')];

				$po_size_level_data_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['amount'][$row[csf('id')]]=$amount;
			}
			else if($cbo_colorsizesensitive==4){
				$txt_req_quantity=$req_qty_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]];
				$req_qnty_ord_uom=def_number_format($txt_req_quantity/$sql_lib_item_group_array[$txt_trim_group_id][conversion_factor],5,"");
				$cu_qnty_ord_uom = def_number_format($cu_booking_data_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]],5,"");
				//$req_qnty_ord_uom = $req_qnty_ord_uom - $cu_qnty_ord_uom;
				//$txtwoq_cal =def_number_format($req_qnty_ord_uom,5,"");
				$req_qnty_ordUom = def_number_format((($data[14]/$data[8])*$req_qnty_ord_uom),5,"");
				
				$txtwoq_cal = def_number_format($req_qnty_ordUom,5,"");
				if($txtwoq_cal) 
				{
				if($row[csf('item_size')]=='' || $row[csf('item_size')]=='0') $row[csf('item_size')]=$size_library[$row[csf('size_number_id')]];
				
				$amount=def_number_format($txtwoq_cal*$txt_avg_price,5,"");
				if($row[csf('item_color_number_id')]=='' || $row[csf('item_color_number_id')]=='0' || $color_library[$row[csf('item_color_number_id')]]=='' || $color_library[$row[csf('item_color_number_id')]]=='0') $row[csf('item_color_number_id')]=$row[csf('color_number_id')];

				$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['req_qty'][$row[csf('id')]]=$txtwoq_cal;
				$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['po_qty'][$row[csf('id')]]=$po_qty;
				$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['order_quantity_set'][$row[csf('id')]]=$row[csf('order_quantity_set')];
				$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['po_id'][$row[csf('id')]]=$row[csf('id')];
				$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['order_quantity'][$row[csf('id')]]=$row[csf('order_quantity')];

				$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['color_size_table_id'][$row[csf('id')]]=$row[csf('color_size_table_id')];
				$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['item_color_number_id'][$row[csf('id')]]=$row[csf('item_color_number_id')];

				$po_color_size_level_data_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['amount'][$row[csf('id')]]=$amount;
				}
			}
			else if($cbo_colorsizesensitive==0){
				$txt_req_quantity=$req_qty_arr[$row[csf('id')]][$cbo_trim_precost_id];
				$req_qnty_ord_uom=def_number_format($txt_req_quantity/$sql_lib_item_group_array[$txt_trim_group_id][conversion_factor],5,"");
				$cu_qnty_ord_uom = def_number_format($cu_booking_data_arr[$row[csf('id')]][$cbo_trim_precost_id],5,"");
				//$req_qnty_ord_uom = $req_qnty_ord_uom - $cu_qnty_ord_uom;
				//$txtwoq_cal =def_number_format($req_qnty_ord_uom,5,"");
				$req_qnty_ordUom = def_number_format((($data[14]/$data[8])*$req_qnty_ord_uom),5,"");
				$txtwoq_cal = def_number_format($req_qnty_ordUom,5,"");
				$amount=def_number_format($txtwoq_cal*$txt_avg_price,5,"");

				$po_no_sen_level_data_arr[$cbo_trim_precost_id]['req_qty'][$row[csf('id')]]=$txtwoq_cal;
				$po_no_sen_level_data_arr[$cbo_trim_precost_id]['po_qty'][$row[csf('id')]]=$po_qty;
				$po_no_sen_level_data_arr[$cbo_trim_precost_id]['order_quantity_set'][$row[csf('id')]]=$row[csf('order_quantity_set')];
				$po_no_sen_level_data_arr[$cbo_trim_precost_id]['po_id'][$row[csf('id')]]=$row[csf('id')];
				$po_no_sen_level_data_arr[$cbo_trim_precost_id]['order_quantity'][$row[csf('id')]]=$row[csf('order_quantity')];
				$po_no_sen_level_data_arr[$cbo_trim_precost_id]['color_size_table_id'][$row[csf('id')]]=$row[csf('color_size_table_id')];

				$po_no_sen_level_data_arr[$cbo_trim_precost_id]['amount'][$row[csf('id')]]=$amount;
			}
		}
	}

	$cons_breck_down="";
	if ( count($data_array)>0 && $cbo_level==1)
	{
		$i=0;
		foreach( $data_array as $row )
		{
			$color_number_id=$row[csf('color_number_id')];
			if($color_number_id=="") $color_number_id=0;

			$size_number_id=$row[csf('size_number_id')];
			if($size_number_id=="") $size_number_id=0;

			$description=$txt_pre_des;
			if($description=="") $description=0;

			$brand_supplier=$txt_pre_brand_sup;
			if($brand_supplier=="") $brand_supplier=0;
			if($cbo_colorsizesensitive==3 || $cbo_colorsizesensitive==4)
			{
				$item_color=$color_library[$row[csf('item_color_number_id')]];
			}
			else
			{
				$item_color=$color_library[$row[csf('color_number_id')]];
			}
			if($item_color=="") $item_color=0;

			$item_size=$row[csf('item_size')];
			
			$item_ref=$item_ref_color_size_arr[$cbo_trim_precost_id][$row[csf('color_size_table_id')]]['item_ref'];
			if($item_ref=="") $item_ref=0;

			if($item_size=="") $item_size=0;
			$excess=0;

			$pcs=$row[csf('order_quantity_set')];
			if($pcs=="") $pcs=0;

			$colorsizetableid=$row[csf('color_size_table_id')];
			if($colorsizetableid=="") $colorsizetableid=0;

			$articleNumber=$row[csf('article_number')];
			if($articleNumber=="") $articleNumber='no article';

			$remarks=$row[csf('remarks')];
			if($remarks=="") $remarks=0;

			if($cbo_colorsizesensitive==1 || $cbo_colorsizesensitive==3 ){
				$txt_req_quantity=$req_qty_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('color_number_id')]];
				$req_qnty_ord_uom=def_number_format($txt_req_quantity/$sql_lib_item_group_array[$txt_trim_group_id][conversion_factor],5,"");
				//$txtwoq_cal =def_number_format($req_qnty_ord_uom,5,"");
				$req_qnty_ordUom = def_number_format((($data[14]/$data[8])*$req_qnty_ord_uom),5,"");
				$txtwoq_cal = def_number_format($req_qnty_ordUom,5,"");
				$amount=def_number_format($txtwoq_cal*$txt_avg_price,5,"");
			}

			else if($cbo_colorsizesensitive==2){
				$txt_req_quantity=$req_qty_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]];
				$req_qnty_ord_uom=def_number_format($txt_req_quantity/$sql_lib_item_group_array[$txt_trim_group_id][conversion_factor],5,"");
				//$txtwoq_cal =def_number_format($req_qnty_ord_uom,5,"");
				$req_qnty_ordUom = def_number_format((($data[14]/$data[8])*$req_qnty_ord_uom),5,"");
				$txtwoq_cal = def_number_format($req_qnty_ordUom,5,"");
				$amount=def_number_format($txtwoq_cal*$txt_avg_price,5,"");
			}
			else if($cbo_colorsizesensitive==4){
				$txt_req_quantity=$req_qty_arr[$row[csf('id')]][$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]];
				$req_qnty_ord_uom=def_number_format($txt_req_quantity/$sql_lib_item_group_array[$txt_trim_group_id][conversion_factor],5,"");
				//$txtwoq_cal =def_number_format($req_qnty_ord_uom,5,"");
				$req_qnty_ordUom = def_number_format((($data[14]/$data[8])*$req_qnty_ord_uom),5,"");
				$txtwoq_cal = def_number_format($req_qnty_ordUom,5,"");
				$amount=def_number_format($txtwoq_cal*$txt_avg_price,5,"");
			}
			else if($cbo_colorsizesensitive==0){
				$txt_req_quantity=$req_qty_arr[$row[csf('id')]][$cbo_trim_precost_id];
				$req_qnty_ord_uom=def_number_format($txt_req_quantity/$sql_lib_item_group_array[$txt_trim_group_id][conversion_factor],5,"");
				//$txtwoq_cal =def_number_format($req_qnty_ord_uom,5,"");
				$req_qnty_ordUom = def_number_format((($data[14]/$data[8])*$req_qnty_ord_uom),5,"");
				$txtwoq_cal = def_number_format($req_qnty_ordUom,5,"");
				$amount=def_number_format($txtwoq_cal*$txt_avg_price,5,"");
			}
			if($txtwoq_cal>0){
				if($cons_breck_down=="")
				{
					$cons_breck_down.=$color_number_id.'_'.$size_number_id.'_'.$description.'_'.$brand_supplier.'_'.$item_color.'_'.$item_size.'_'.$txtwoq_cal.'_'.$excess.'_'.$txtwoq_cal.'_'.$txt_avg_price.'_'.$amount.'_'.$pcs.'_'.$colorsizetableid."_".$txtwoq_cal."_".$articleNumber."_".$item_ref;
				}
				else
				{
					$cons_breck_down.="__".$color_number_id.'_'.$size_number_id.'_'.$description.'_'.$brand_supplier.'_'.$item_color.'_'.$item_size.'_'.$txtwoq_cal.'_'.$excess.'_'.$txtwoq_cal.'_'.$txt_avg_price.'_'.$amount.'_'.$pcs.'_'.$colorsizetableid."_".$txtwoq_cal."_".$articleNumber."_".$item_ref;
				}
			}
		}
		echo $cons_breck_down;
	}

	$level_arr=array();
	$gmt_color_edb="";
	$item_color_edb="";
	$gmt_size_edb="";
	$item_size_edb="";
	if($cbo_colorsizesensitive==1){
		$sql="select min(b.id) as id , min(c.id) as color_size_table_id,c.color_number_id,min(c.color_order) as color_order,sum(c.order_quantity) as order_quantity from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c,wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and a.job_no=d.job_no and a.job_no=e.job_no and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1   and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  c.color_number_id order by  color_order";
		$level_arr=$po_color_level_data_arr;
		$gmt_size_edb="disabled";
		$item_size_edb="disabled";
	}
	else if($cbo_colorsizesensitive==2){
		$sql="select min(b.id) as id , min(c.id) as color_size_table_id,c.size_number_id,c.article_number,min(c.size_order) as size_order,min(e.item_size) as item_size,sum(c.order_quantity) as order_quantity from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c,wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and a.job_no=d.job_no and a.job_no=e.job_no and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1   and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  c.size_number_id,c.article_number order by size_order";
		$level_arr=$po_size_level_data_arr;
		$gmt_color_edb="disabled";
		$item_color_edb="disabled";
	}
	else if($cbo_colorsizesensitive==3){
		$sql="select min(b.id) as id, min(c.id) as color_size_table_id,c.color_number_id,min(c.color_order) as color_order,sum(c.order_quantity) as order_quantity,min(e.item_color_number_id) as item_color_number_id from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c,wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and a.job_no=d.job_no and a.job_no=e.job_no and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1   and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  c.color_number_id order by  color_order";
		$level_arr=$po_color_level_data_arr;
		$gmt_size_edb="disabled";
		$item_size_edb="disabled";
	}
	else if($cbo_colorsizesensitive==4){
		$sql="select min(b.id) as id ,min(c.id) as color_size_table_id,c.color_number_id,c.size_number_id,c.article_number,min(c.color_order) as color_order,min(c.size_order) as size_order,e.item_size as item_size,sum(c.order_quantity) as order_quantity,e.item_color_number_id from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c,wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and a.job_no=d.job_no and a.job_no=e.job_no and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1   and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  c.color_number_id,c.size_number_id,c.article_number,e.item_color_number_id,e.item_size  order by  color_order,size_order";
		$level_arr=$po_color_size_level_data_arr;
	}
	else{
		  $sql="select b.job_no_mst,min(b.id) as id , min(c.id) as color_size_table_id,sum(c.order_quantity) as order_quantity from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c, wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and a.job_no=d.job_no and a.job_no=e.job_no and b.id=c.po_break_down_id and b.id=e.po_break_down_id  and d.id=e.wo_pre_cost_trim_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1   and  b.id in($txt_po_id)  $txt_country_cond and d.id=$cbo_trim_precost_id group by  b.job_no_mst";
		$level_arr=$po_no_sen_level_data_arr;
	}
	$data_array=sql_select($sql);

	$cons_breck_down="";
	if ( count($data_array)>0 && $cbo_level==2)
	{
		$i=0;
		foreach( $data_array as $row )
		{
			if($row[csf('item_size')]=='' || $row[csf('item_size')]=='0') $row[csf('item_size')]=$size_library[$row[csf('size_number_id')]];
			if($cbo_colorsizesensitive==1){
				$txtwoq_cal =def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['req_qty']),5,"");
				$po_qty=array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['po_qty']);
				$order_quantity_set=array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['order_quantity_set']);
				$booking_qty=def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['booking_qty']),5,"");
				$amount=def_number_format($txtwoq_cal*$txt_avg_price,5,"");
			}
			if($cbo_colorsizesensitive==2){
				$txtwoq_cal =def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['req_qty']),5,"");
				$po_qty=array_sum($level_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['po_qty']);
				$order_quantity_set=array_sum($level_arr[$cbo_trim_precost_id][$row[csf('size_number_id')]][$row[csf('article_number')]]['order_quantity_set']);
				$amount=def_number_format($txtwoq_cal*$txt_avg_price,5,"");
			}
			if($cbo_colorsizesensitive==3){
				$txtwoq_cal =def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['req_qty']),5,"");
				$po_qty=array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['po_qty']);
				$order_quantity_set=array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]]['order_quantity_set']);
				$amount=def_number_format($txtwoq_cal*$txt_avg_price,5,"");
			}
			if($cbo_colorsizesensitive==4){
				
				if($row[csf('item_color_number_id')]=='' || $row[csf('item_color_number_id')]=='0' || $color_library[$row[csf('item_color_number_id')]]=='' || $color_library[$row[csf('item_color_number_id')]]=='0') $row[csf('item_color_number_id')]=$row[csf('color_number_id')];
				
				$txtwoq_cal =def_number_format(array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['req_qty']),5,"");
				$po_qty=array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['po_qty']);
				$order_quantity_set=array_sum($level_arr[$cbo_trim_precost_id][$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('article_number')]][$row[csf('item_color_number_id')]][$row[csf('item_size')]]['order_quantity_set']);
				$amount=def_number_format($txtwoq_cal*$txt_avg_price,5,"");
			}
			if($cbo_colorsizesensitive==0){
				$txtwoq_cal =def_number_format(array_sum($level_arr[$cbo_trim_precost_id]['req_qty']),5,"");
				$po_qty=array_sum($level_arr[$cbo_trim_precost_id]['po_qty']);
				$order_quantity_set=array_sum($level_arr[$cbo_trim_precost_id]['order_quantity_set']);
				$amount=def_number_format($txtwoq_cal*$txt_avg_price,5,"");
			}
			$color_number_id=$row[csf('color_number_id')];
			if($color_number_id=="") $color_number_id=0;

			$size_number_id=$row[csf('size_number_id')];
			if($size_number_id=="") $size_number_id=0;

			$description=$txt_pre_des;
			if($description=="") $description=0;

			$brand_supplier=$txt_pre_brand_sup;
			if($brand_supplier=="") $brand_supplier=0;


			if($cbo_colorsizesensitive==3 || $cbo_colorsizesensitive==4)
			{
				$item_color=$color_library[$row[csf('item_color_number_id')]];
			}
			else
			{
				$item_color=$color_library[$row[csf('color_number_id')]];
			}

			if($item_color=="") $item_color=0;
			
			$item_ref=$item_ref_color_size_arr[$cbo_trim_precost_id][$row[csf('color_size_table_id')]]['item_ref'];
			if($item_ref=="") $item_ref=0;

			$item_size=$row[csf('item_size')];
			if($item_size=="") $item_size=0;
			$excess=0;

			$pcs=$row[csf('order_quantity_set')];
			if($pcs=="") $pcs=0;

			$colorsizetableid=$row[csf('color_size_table_id')];
			if($colorsizetableid=="") $colorsizetableid=0;

			$articleNumber=$row[csf('article_number')];
			if($articleNumber=="") $articleNumber='no article';

			if($txtwoq_cal>0){
				if($cons_breck_down==""){
					$cons_breck_down.=trim($color_number_id).'_'.$size_number_id.'_'.$description.'_'.$brand_supplier.'_'.$item_color.'_'.$item_size.'_'.$txtwoq_cal.'_'.$excess.'_'.$txtwoq_cal.'_'.$txt_avg_price.'_'.$amount.'_'.$pcs.'_'.$colorsizetableid."_".$txtwoq_cal."_".$articleNumber."_".$item_ref;

				}
				else{
					$cons_breck_down.="__".trim($color_number_id).'_'.$size_number_id.'_'.$description.'_'.$brand_supplier.'_'.$item_color.'_'.$item_size.'_'.$txtwoq_cal.'_'.$excess.'_'.$txtwoq_cal.'_'.$txt_avg_price.'_'.$amount.'_'.$pcs.'_'.$colorsizetableid."_".$txtwoq_cal."_".$articleNumber."_".$item_ref;
				}
			}
		}
		//echo $cons_breck_down;die;
		echo $cons_breck_down."**".json_encode($level_arr); 
	}
}

if ($action=="save_update_delete"){
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	if(str_replace("'","",$txt_booking_no)!='')
	{
		$sql=sql_select("select a.trims_del,b.delevery_qty  from trims_delivery_mst a, trims_delivery_dtls b where a.id=b.mst_id and b.order_no=$txt_booking_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0");
		foreach($sql as $row)
		{
			$trims_del_no.=$row[csf('trims_del')].",";
			$trims_del_qty +=$row[csf('delevery_qty')];
		}
		$book_qty=return_field_value( "sum(b.wo_qnty) as wo_qnty", "wo_booking_mst a,wo_booking_dtls b","a.booking_no=b.booking_no and a.company_id=$cbo_company_name and a.booking_type in (2,5) and a.booking_no=$txt_booking_no","wo_qnty");
		//echo "10**".$trims_del_qty."**".$book_qty; die;
		if($book_qty > 0)
		{
			if( $book_qty <= $trims_del_qty  )
			{
				$trims_del_no=implode(", ",array_unique(explode(",",chop($trims_del_no,','))));
				echo "delQtyExeed**".$trims_del_no;
				 disconnect($con);die;
			}
		}
	}

	if ($operation==0)
	{
		$con = connect();
		if($db_type==0){
		mysql_query("BEGIN");
		}
		
		if($db_type==0) $date_cond=" YEAR(insert_date)";
		else if($db_type==2) $date_cond="to_char(insert_date,'YYYY')";
		
		$new_booking_no=explode("*",return_mrr_number( str_replace("'","",$cbo_company_name), '', 'TB', date("Y",time()), 5, "select booking_no_prefix, booking_no_prefix_num from wo_booking_mst where company_id=$cbo_company_name and booking_type in(2) and $date_cond=".date('Y',time())." order by id DESC ", "booking_no_prefix", "booking_no_prefix_num" ));
		
		$id=return_next_id( "id", "wo_booking_mst", 1 ) ;
		$field_array="id, booking_type, is_short, booking_month, booking_year, booking_no_prefix, booking_no_prefix_num, booking_no, company_id, buyer_id, 	item_category, supplier_id, currency_id, booking_date, delivery_date, pay_mode, source, fabric_source, attention, remarks, item_from_precost, entry_form, cbo_level, ready_to_approved,delivery_address,trime_type, tenor, inserted_by, insert_date";
		$data_array ="(".$id.",2,2,".$cbo_booking_month.",".$cbo_booking_year.",'".$new_booking_no[1]."',".$new_booking_no[2].",'".$new_booking_no[0]."',".$cbo_company_name.",".$cbo_buyer_name.",4,".$cbo_supplier_name.",".$cbo_currency.",".$txt_booking_date.",".$txt_delivery_date.",".$cbo_pay_mode.",".$cbo_source.",".$cbo_material_source.",".$txt_attention.",".$txt_remarks.",1,87,".$cbo_level.",".$cbo_ready_to_approved.",".$delivery_address.",".$cbo_trim_type.",".$txt_tenor.",".$_SESSION['logic_erp']['user_id'].",'".$pc_date_time."')";
		$rID=sql_insert("wo_booking_mst",$field_array,$data_array,0);
		if($db_type==0){
			if($rID){
				mysql_query("COMMIT");
				echo "0**".$new_booking_no[0]."**".$id;
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**".$new_booking_no[0]."**".$id;
			}
		}
		elseif($db_type==2 || $db_type==1 ){
			if($rID){
				oci_commit($con);
				echo "0**".$new_booking_no[0]."**".$id;
			}
			else{
				oci_rollback($con);
				echo "10**".$new_booking_no[0]."**".$id;
			}
		}
		disconnect($con);
		die;
	}
	else if ($operation==1){
		$con = connect();
		if($db_type==0){
			mysql_query("BEGIN");
		}
		$update_id=str_replace("'","",$update_id);
		$is_approved=return_field_value( "is_approved", "wo_booking_mst","booking_no=$txt_booking_no");
		if($is_approved==3){
			$is_approved=1;
		}
		if($is_approved==1){
			echo "app1**".str_replace("'","",$txt_booking_no);
			 disconnect($con);die;
		}
		//if(str_replace("'","",$cbo_pay_mode)==2){
		$pi_number=return_field_value( "pi_number", "com_pi_master_details a,com_pi_item_details b"," a.id=b.pi_id  and b.work_order_no=$txt_booking_no and a.item_category_id=4 and a.status_active=1 and  a.is_deleted=0  and b.status_active=1 and  b.is_deleted=0");
			if($pi_number){
				echo "pi1**".str_replace("'","",$txt_booking_no)."**".$pi_number;
				 disconnect($con);die;
			}
		/*	}else{*/
			$recv_number=return_field_value( "recv_number", "inv_receive_master a,inv_trims_entry_dtls b"," a.id=b.mst_id and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no  and a.item_category=4 and a.status_active=1 and  a.is_deleted=0  and b.status_active=1 and  b.is_deleted=0");
			if($recv_number){
				echo "recv1**".str_replace("'","",$txt_booking_no)."**".$recv_number;
				 disconnect($con);die;
			}
		//}
		$flag=1;
		$is_received_id=return_field_value( "id", "subcon_ord_mst","order_no=$txt_booking_no and order_id is not null and entry_form=255 and status_active=1 and is_deleted=0");
		//echo "10** select id from subcon_ord_mst where order_no=$txt_booking_no and order_id is not null and entry_form=255".$is_received_id; die;
		if($is_received_id!='')
		{
			$field_array_rec_up="is_apply_last_update*updated_by*update_date";
			$data_array_rec_up ="2*".$_SESSION['logic_erp']['user_id']."*'".$pc_date_time."'";
			$rID_rec=sql_update("subcon_ord_mst",$field_array_rec_up,$data_array_rec_up,"id","".$is_received_id."",0);
			if($rID_rec) $flag=1; else $flag=0;
		}
		$field_array_up="booking_month*booking_year*item_category*supplier_id*currency_id*booking_date*delivery_date*pay_mode*source*fabric_source*attention*remarks*item_from_precost*entry_form*delivery_address*cbo_level*ready_to_approved*trime_type*tenor*updated_by*update_date*revised_no";

		$data_array_up ="".$cbo_booking_month."*".$cbo_booking_year."*4*".$cbo_supplier_name."*".$cbo_currency."*".$txt_booking_date."*".$txt_delivery_date."*".$cbo_pay_mode."*".$cbo_source."*".$cbo_material_source."*".$txt_attention."*".$txt_remarks."*1*87*".$delivery_address."*".$cbo_level."*".$cbo_ready_to_approved."*".$cbo_trim_type."*".$txt_tenor."*".$_SESSION['logic_erp']['user_id']."*'".$pc_date_time."'*revised_no+1";
		if($data_array_up!='')
		{
			$rID=sql_update("wo_booking_mst",$field_array_up,$data_array_up,"booking_no","".$txt_booking_no."",0);
			if($rID) $flag=1; else $flag=0;
		}

		//echo "10**".$rID_rec."**".$rID; die;
		if($db_type==0){
			if($rID==1 && $flag==1){
				mysql_query("COMMIT");
				echo "1**".str_replace("'","",$txt_booking_no)."**".$update_id;
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**".str_replace("'","",$txt_booking_no)."**".$update_id;
			}
		}
		else if($db_type==2 || $db_type==1 ){
			if($rID==1 && $flag==1){
				oci_commit($con);
				echo "1**".str_replace("'","",$txt_booking_no)."**".$update_id;
			}
			else{
				oci_rollback($con);
				echo "10**".str_replace("'","",$txt_booking_no)."**".$update_id;
			}
		}
		disconnect($con);
		die;
	}
	else if ($operation==2){
		$con = connect();
		if($db_type==0){
			mysql_query("BEGIN");
		}
		$is_approved=return_field_value( "is_approved", "wo_booking_mst","booking_no=$txt_booking_no");
		if($is_approved==3){
			$is_approved=1;
		}
		if($is_approved==1){
			echo "app1**".str_replace("'","",$txt_booking_no);
			 disconnect($con);die;
		}
		//if(str_replace("'","",$cbo_pay_mode)==2){
		$pi_number=return_field_value( "pi_number", "com_pi_master_details a,com_pi_item_details b"," a.id=b.pi_id  and b.work_order_no=$txt_booking_no  and a.item_category_id=4 and a.status_active=1 and  a.is_deleted=0  and b.status_active=1 and  b.is_deleted=0");
			if($pi_number){
				echo "pi1**".str_replace("'","",$txt_booking_no)."**".$pi_number;
				 disconnect($con);die;
			}
		/*}else{*/
			$recv_number=return_field_value( "recv_number", "inv_receive_master a,inv_trims_entry_dtls b"," a.id=b.mst_id and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no  and a.item_category=4 and a.status_active=1 and  a.is_deleted=0  and b.status_active=1 and  b.is_deleted=0");
			if($recv_number){
				echo "recv1**".str_replace("'","",$txt_booking_no)."**".$recv_number;
				 disconnect($con);die;
			}
		//}
		$is_received_id=return_field_value( "subcon_job", "subcon_ord_mst","order_no=$txt_booking_no and order_id is not null and entry_form=255 and status_active=1 and is_deleted=0");
		//echo "10** select id from subcon_ord_mst where order_no=$txt_booking_no and order_id is not null and entry_form=255".$is_received_id; die;
		$rID_rec=1;
		if($is_received_id!='')
		{
			echo "orderFound**".str_replace("'","",$txt_booking_no)."**$is_received_id"; disconnect($con); die;
			//echo "orderFound**".str_replace("'","",$txt_booking_no)."**".implode(",",$trims_recNoCheckArr)."**".$order_trim_recv_qty;
		}
		$delete_cause=str_replace("'","",$delete_cause);
		$delete_cause=str_replace('"','',$delete_cause);
		$delete_cause=str_replace('(','',$delete_cause);
		$delete_cause=str_replace(')','',$delete_cause);

		//$rID=execute_query( "delete from wo_booking_mst where  booking_no =".$txt_booking_no."",0);
		//$rID1=execute_query( "delete from wo_booking_dtls where  booking_no =".$txt_booking_no."",0);
		//$rID2=execute_query( "delete from wo_trim_book_con_dtls where  booking_no =".$txt_booking_no."",0);
		if(str_replace("'","",$delete_type)==1)
		{
			$rID=execute_query( "update wo_booking_mst set status_active=0,is_deleted=1,delete_cause='$delete_cause',updated_by=".$_SESSION['logic_erp']['user_id'].", update_date='".$pc_date_time."'   where  booking_no=$txt_booking_no",0);
			$rID1=execute_query( "update wo_booking_dtls set status_active=0,is_deleted=1,delete_cause='$delete_cause',updated_by=".$_SESSION['logic_erp']['user_id'].", update_date='".$pc_date_time."'   where  booking_no=$txt_booking_no",0);
			$rID1=execute_query( "update wo_trim_book_con_dtls set status_active=0,is_deleted=1 where  booking_no=$txt_booking_no",0);
		}
		else
		{
			$rID=1;
			$rID1=execute_query( "update wo_booking_dtls set status_active=0,is_deleted=1,delete_cause='$delete_cause',updated_by=".$_SESSION['logic_erp']['user_id'].", update_date='".$pc_date_time."'   where  booking_no=$txt_booking_no",0);
			$rID1=execute_query( "update wo_trim_book_con_dtls set status_active=0,is_deleted=1 where  booking_no=$txt_booking_no",0);
		}

		if($db_type==0){
			if($rID  && $rID1){
				mysql_query("COMMIT");
				echo "2**".str_replace("'","",$txt_booking_no);
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**".str_replace("'","",$txt_booking_no);
			}
		}
		else if($db_type==2 || $db_type==1 ){
			if($rID  && $rID1){
				oci_commit($con);
				echo "2**".str_replace("'","",$txt_booking_no);
			}
			else{
				oci_rollback($con);
				echo "10**".str_replace("'","",$txt_booking_no);
			}
		}
		disconnect($con);
		die;
	}
}

if ($action=="save_update_delete_dtls")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	$booking_id=str_replace("'","",$update_id);
	$is_approved=return_field_value( "is_approved", "wo_booking_mst","booking_no=$txt_booking_no");
	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	if($is_approved==3) $is_approved=1;

	if($is_approved==1){
		echo "app1**".str_replace("'","",$txt_booking_no);
		 disconnect($con);die;
	}

	if(str_replace("'","",$txt_booking_no)!='' )
	{
		$sql=sql_select("select a.trims_del,b.booking_dtls_id,b.delevery_qty  from trims_delivery_mst a, trims_delivery_dtls b where a.id=b.mst_id and b.order_no=$txt_booking_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0");
		$delivery_qty_arr=array();
		foreach($sql as $row)
		{
			$delivery_qty_arr[$row[csf('booking_dtls_id')]]['delevery_qty'] +=$row[csf('delevery_qty')];
			$delivery_qty_arr[$row[csf('booking_dtls_id')]]['trims_del'] .=$row[csf('trims_del')].",";
		}
	}
	$flag=1;
	$is_received_id=return_field_value( "id", "subcon_ord_mst","order_no=$txt_booking_no and order_id is not null and entry_form=255 and status_active=1 and is_deleted=0");
	if($is_received_id!='')
	{
		$field_array_rec_up="is_apply_last_update*updated_by*update_date";
		$data_array_rec_up ="2*".$_SESSION['logic_erp']['user_id']."*'".$pc_date_time."'";
		$rID_rec=sql_update("subcon_ord_mst",$field_array_rec_up,$data_array_rec_up,"id","".$is_received_id."",0);
		if($rID_rec) $flag=1; else $flag=0;
	}

	$sql_lib_item_group_array=array();
	$sql_lib_item_group=sql_select("select id, item_name,conversion_factor,order_uom as cons_uom from lib_item_group");
	foreach($sql_lib_item_group as $row_sql_lib_item_group){
		$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]]['conversion_factor']=$row_sql_lib_item_group[csf('conversion_factor')];
	}

	$exeed_budge_qty=0; $exeed_budge_amount=0; $amount_exceed_level=0; $exceed_qty_level=0;
	$data_array=sql_select("select exeed_budge_qty,exeed_budge_amount,amount_exceed_level,exceed_qty_level from variable_order_tracking where company_name='$cbo_company_name' and item_category_id=4 and variable_list=26 and status_active=1 and is_deleted=0");
	foreach ($data_array as $row){
		$exeed_budge_qty=$row[csf("exeed_budge_qty")];
		$exeed_budge_amount=$row[csf("exeed_budge_amount")];
		$amount_exceed_level=$row[csf("amount_exceed_level")];
		$exceed_qty_level = $row[csf("exceed_qty_level")];
	}

	if ($operation==0)
	{
		$curr_book_amount_job_level=array();
		$curr_book_amount_job_item_level=array();
		$jobArr=array(); $poArr=array(); $pre_trim_id_arr=array(); $des_data=""; $brand_data="";
		for ($i=1;$i<=$total_row;$i++)
		{
			$txttrimcostid="txttrimcostid_".$i;
			$txtReqAmt="txtReqAmt_".$i;
			$txtpoid="txtpoid_".$i;
			$txttrimgroup="txttrimgroup_".$i;
			$txtwoq="txtwoq_".$i;
			$txtexchrate="txtexchrate_".$i;
			$txtrate="txtrate_".$i;
			$txtamount="txtamount_".$i;
			$txtbookingid="txtbookingid_".$i;
			$txtjob_id="txtjob_".$i;
			$txtreqqnty="txtreqqnty_".$i;
			$txtdesc="txtdesc_".$i;
		    $txtbrandsup="txtbrandsup_".$i;
			$txtreqamount="txtreqamount_".$i;
			$txtremark="txtremark_".$i;
			$txtreqamountjoblevelconsuom="txtreqamountjoblevelconsuom_".$i;
			$txtreqamountitemlevelconsuom="txtreqamountitemlevelconsuom_".$i;

			$JoBc=$$txtjob_id;
			$condition= new condition();
			if(str_replace("'","",$$txtjob_id) !=''){
				$condition->job_no("=$JoBc");
			}

			$condition->init();
			$trims= new trims($condition);
			//$req_qty_arr=$trims->getQtyArray_by_orderAndPrecostdtlsid();
			//$req_amount_arr=$trims->getAmountArray_by_orderAndPrecostdtlsid();

			$pretrimcostid=str_replace("'","",$$txttrimcostid);
			$poid=str_replace("'","",$$txtpoid);
			$conversion_factor=$sql_lib_item_group_array[str_replace("'","",$$txttrimgroup)]['conversion_factor'];
			$reqQtyItemLevelArr=$trims->getQtyArray_by_orderAndPrecostdtlsid();
			$reqAmountItemLevelArr=$trims->getAmountArray_precostdtlsid();
			$reqAmountJobLevelArr=$trims->getAmountArray_by_job();

			$curr_book_amount_job_level[str_replace("'","",$$txtjob_id)]['req_amount']=$reqAmountJobLevelArr[str_replace("'","",$$txtjob_id)];
			$curr_book_amount_job_level[str_replace("'","",$$txtjob_id)]['cur_amount']+=(str_replace("'","",$$txtamount)/str_replace("'","",$$txtexchrate));
			$curr_book_amount_job_level[str_replace("'","",$$txtjob_id)]['prev_amount']=0;

			$curr_book_amount_job_item_level[str_replace("'","",$$txtjob_id)][$poid][str_replace("'","",$$txttrimcostid)]['req_amount']+=$reqAmountItemLevelArr[$pretrimcostid];
			$curr_book_amount_job_item_level[str_replace("'","",$$txtjob_id)][$poid][str_replace("'","",$$txttrimcostid)]['cur_amount']+=(str_replace("'","",$$txtamount)/str_replace("'","",$$txtexchrate));
			$curr_book_amount_job_item_level[str_replace("'","",$$txtjob_id)][$poid][str_replace("'","",$$txttrimcostid)]['prev_amount']=0;

			$curr_book_qty_job_item_level[str_replace("'","",$$txtjob_id)][$poid][$pretrimcostid]['req_qty']+=$reqQtyItemLevelArr[$poid][$pretrimcostid];
			$curr_book_qty_job_item_level[str_replace("'","",$$txtjob_id)][$poid][$pretrimcostid]['cur_qty']+=(str_replace("'","",$$txtreqqnty)*$conversion_factor);
			$curr_book_qty_job_item_level[str_replace("'","",$$txtjob_id)][$poid][$pretrimcostid]['prev_qty']=0;

			$jobArr[$$txtjob_id]=$$txtjob_id;
			$poArr[$poid]=$poid;
			$pre_trim_id_arr[$pretrimcostid]=$pretrimcostid;
			$des_arr[$$txtdesc]=$$txtdesc;
			$brand_arr[$$txtbrandsup]=$$txtbrandsup;
			$booking_dtls_id_arr[$bookingdtlsid]=$bookingdtlsid;
		}


		$prev_book_amount_job_level=array();
		$prev_book_amount_job_item_level=array();
		$sql=sql_select("select b.job_no, b.po_break_down_id, b.pre_cost_fabric_cost_dtls_id, b.trim_group,b.wo_qnty,b.amount,b.exchange_rate from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no and b.job_no in(".implode(",",$jobArr).") and b.booking_type=2 and b.is_short=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0");
		foreach($sql as $row){
			$curr_book_amount_job_level[$row[csf('job_no')]]['prev_amount']+=($row[csf('amount')]/$row[csf('exchange_rate')]);
			$curr_book_amount_job_item_level[$row[csf('job_no')]][$row[csf('po_id')]][$row[csf('pre_cost_fabric_cost_dtls_id')]]['prev_amount']+=($row[csf('amount')]/$row[csf('exchange_rate')]);
			$curr_book_qty_job_item_level[$row[csf('job_no')]][$row[csf('po_id')]][$row[csf('pre_cost_fabric_cost_dtls_id')]]['prev_qty']+=($row[csf('wo_qnty')]*$sql_lib_item_group_array[$row[csf('trim_group')]]['conversion_factor']);

		}

		$con = connect();
		if($db_type==0){
			mysql_query("BEGIN");
		}
		if( check_table_status( $_SESSION['menu_id'], 1 )==0 ){
			echo "15**0";
			 disconnect($con);die;
		}

		if(str_replace("'","",implode(",",$des_arr))!="") $des_data_cond="and description in(".implode(",",$des_arr).")"; else $des_data_cond="";
		if(str_replace("'","",implode(",",$brand_arr))!="") $brand_data_cond="and brand_supplier in(".implode(",",$brand_arr).")"; else $brand_data_cond="";
		if (is_duplicate_field( "booking_no", "wo_booking_dtls", "job_no in(".implode(",",$jobArr).") and po_break_down_id in (".implode(",",$poArr).") and pre_cost_fabric_cost_dtls_id in(".implode(",",$pre_trim_id_arr).") and booking_type=2 and is_short=2 and booking_no=$txt_booking_no and status_active=1 and is_deleted=0 $des_data_cond $brand_data_cond") == 1)// and id not in(".implode(",",$booking_dtls_id_arr).")
		{
			echo "11**0";
			check_table_status( $_SESSION['menu_id'],0);
			 disconnect($con);die;
		}

		$id_dtls=return_next_id( "id", "wo_booking_dtls", 1 ) ;
		$field_array1="id, pre_cost_fabric_cost_dtls_id, pre_req_amt, po_break_down_id, job_no, booking_no, booking_mst_id, booking_type, is_short, trim_group, description, brand_supplier, uom, sensitivity, wo_qnty, exchange_rate, rate, amount, delivery_date, country_id_string, hs_code,remark, inserted_by, insert_date";

		$field_array2="id,wo_trim_booking_dtls_id,booking_no,booking_mst_id,job_no,po_break_down_id,color_number_id,gmts_sizes,description,brand_supplier,item_color,item_size,cons, process_loss_percent, requirment, rate, amount, pcs, color_size_table_id, article_number,item_ref,remarks";

		$add_comma=0;
		$id1=return_next_id( "id", "wo_trim_book_con_dtls", 1 );
		$new_array_color=array();
		for ($i=1;$i<=$total_row;$i++){
			$txttrimcostid="txttrimcostid_".$i;
			$txtReqAmt="txtReqAmt_".$i;
			$txtpoid="txtpoid_".$i;
			$txttrimgroup="txttrimgroup_".$i;
			$txtuom="txtuom_".$i;
			$cbocolorsizesensitive="cbocolorsizesensitive_".$i;
			$txtwoq="txtwoq_".$i;
			$txtexchrate="txtexchrate_".$i;
			$txtrate="txtrate_".$i;
			$txtamount="txtamount_".$i;
			$txtddate="txtddate_".$i;
			$consbreckdown="consbreckdown_".$i;
			$txtbookingid="txtbookingid_".$i;
			$txtcountry="txtcountry_".$i;
			$txtjob_id="txtjob_".$i;

			$txtdesc="txtdesc_".$i;
			$txthscode="txthscode_".$i;

			$txtbrandsup="txtbrandsup_".$i;
			$txtreqamount="txtreqamount_".$i;
			$txtremark="txtremark_".$i;
			$txtreqamountjoblevelconsuom="txtreqamountjoblevelconsuom_".$i;
			$txtreqamountitemlevelconsuom="txtreqamountitemlevelconsuom_".$i;

			$job=str_replace("'","",$$txtjob_id);
			$trimcostid=str_replace("'","",$$txttrimcostid);
			$amt=str_replace("'","",$$txtamount);
			$exRate=str_replace("'","",$$txtexchrate);
			$uom_id=str_replace("'","",$$txtuom);
			$poid=str_replace("'","",$$txtpoid);
			$conversion_factor=$sql_lib_item_group_array[str_replace("'","",$$txttrimgroup)]['conversion_factor'];

			if($amount_exceed_level==1){
				$reqAmt=(($curr_book_amount_job_level[$job]['req_amount']*$exeed_budge_amount)/100)+$curr_book_amount_job_level[$job]['req_amount'];
				$curAmt=$curr_book_amount_job_level[$job]['prev_amount']+($amt/$exRate);
				if(($curAmt-$reqAmt)>1){
					echo "vad1**".str_replace("'","",$txt_booking_no)."**".$i;
					check_table_status( $_SESSION['menu_id'],0);
					disconnect($con);
					die;
				}
				$curr_book_amount_job_level[$job]['prev_amount']+=($amt/$exRate);
			}

			if($amount_exceed_level==2){
				$reqAmt=(($curr_book_amount_job_item_level[$job][$poid][$trimcostid]['req_amount']*$exeed_budge_amount)/100)+$curr_book_amount_job_item_level[$job][$poid][$trimcostid]['req_amount'];
				$curAmt=$curr_book_amount_job_item_level[$job][$poid][$trimcostid]['prev_amount']+($amt/$exRate);
				if(($curAmt-$reqAmt)>1){
					echo "vad1**".str_replace("'","",$txt_booking_no)."**".$i."**".$curAmt."**".$reqAmt."**".$curr_book_amount_job_item_level[$job][$poid][$trimcostid]['req_amount'];
					check_table_status( $_SESSION['menu_id'],0);
					 disconnect($con);die;
				}
				$curr_book_amount_job_item_level[$job][$poid][$trimcostid]['prev_amount']+=($amt/$exRate);
			}

			if($exceed_qty_level==2){
				$reqQty=(($curr_book_qty_job_item_level[$job][$poid][$trimcostid]['req_qty']*$exeed_budge_qty)/100)+$curr_book_qty_job_item_level[$job][$poid][$trimcostid]['req_qty'];
				$curQty=$curr_book_qty_job_item_level[$job][$poid][$trimcostid]['prev_qty']+($woq*$conversion_factor);
				if(($curQty-$reqQty)>1){
					echo "vad2**".str_replace("'","",$txt_booking_no)."**".$i."**".$curQty."**".$reqQty."**".$curr_book_qty_job_item_level[$job][$poid][$trimcostid]['req_qty'];
					check_table_status( $_SESSION['menu_id'],0);
					 disconnect($con);die;
				}
				$curr_book_qty_job_item_level[$job][$poid][$trimcostid]['prev_qty']+=($woq*$conversion_factor);
			}

			$data_array1 ="(".$id_dtls.",".$$txttrimcostid.",".$$txtReqAmt.",".$$txtpoid.",".$$txtjob_id.",".$txt_booking_no.",".$booking_id.",2,2,".$$txttrimgroup.",".$$txtdesc.",".trim($$txtbrandsup).",".$$txtuom.",".$$cbocolorsizesensitive.",".$$txtwoq.",".$$txtexchrate.",".$$txtrate.",".$$txtamount.",".$$txtddate.",".$$txtcountry.",".$$txthscode.",".$$txtremark.",".$_SESSION['logic_erp']['user_id'].",'".$pc_date_time."')";

			//	CONS break down===============================================================================================
			if(str_replace("'",'',$$consbreckdown) !=''){
				$data_array2="";
				$rID_de1=execute_query( "delete from wo_trim_book_con_dtls where  wo_trim_booking_dtls_id =".$$txtbookingid."",0);
				$consbreckdown_array=explode('__',str_replace("'",'',$$consbreckdown));
				for($c=0;$c < count($consbreckdown_array);$c++){
					$consbreckdownarr=explode('_',$consbreckdown_array[$c]);
					 $consbreckdownarr[4]=trim(str_replace("'",'',$consbreckdownarr[4]));
					 if(str_replace("'","",$consbreckdownarr[4])=='0') $consbreckdownarr[4]='';
					if(str_replace("'",'',$consbreckdownarr[4]) !='')
					{
						if (!in_array(str_replace("'","",$consbreckdownarr[4]),$new_array_color, TRUE)){
							$color_id = return_id( str_replace("'","",$consbreckdownarr[4]), $color_library, "lib_color", "id,color_name","87");
							$new_array_color[$color_id]=str_replace("'","",$consbreckdownarr[4]);
						}
						else $color_id =  array_search(str_replace("'","",$consbreckdownarr[4]), $new_array_color);
					}
					else $color_id =0;
					if ($c!=0) $data_array2 .=",";
					$data_array2 .="(".$id1.",".$id_dtls.",".$txt_booking_no.",".$booking_id.",".$$txtjob_id.",".$$txtpoid.",'".$consbreckdownarr[0]."','".$consbreckdownarr[1]."','".$consbreckdownarr[2]."','".trim($consbreckdownarr[3])."','".$color_id."','".$consbreckdownarr[5]."','".$consbreckdownarr[6]."','".$consbreckdownarr[7]."','".$consbreckdownarr[8]."','".$consbreckdownarr[9]."','".$consbreckdownarr[10]."','".$consbreckdownarr[11]."','".$consbreckdownarr[12]."','".$consbreckdownarr[14]."','".$consbreckdownarr[15]."','".$consbreckdownarr[15]."')";
					$id1=$id1+1;
					$add_comma++;
				}
			}
			//CONS break down end===============================================================================================
			$rID1=sql_insert("wo_booking_dtls",$field_array1,$data_array1,0);
			$rID2=1;
			if($data_array2 !=""){
				$rID2=sql_insert("wo_trim_book_con_dtls",$field_array2,$data_array2,1);

			}
			$id_dtls=$id_dtls+1;
		}

		check_table_status( $_SESSION['menu_id'],0);

		if($db_type==0){
			if($rID1 && $rID2  && $flag){
				mysql_query("COMMIT");
				echo "0**".$new_booking_no[0];
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**".$new_booking_no[0];
			}
		}
		else if($db_type==2 || $db_type==1 )
		{
			if($rID1 && $rID2 && $flag){
				oci_commit($con);
				echo "0**".$new_booking_no[0];
			}
			else{
				oci_rollback($con);
				echo "10**".$new_booking_no[0];
			}
		}
		disconnect($con);
		die;
	}
	else if ($operation==1)
	{
		$curr_book_amount_job_level=array();
		$curr_book_amount_job_item_level=array();
		$jobArr=array(); $poArr=array(); $pre_trim_id_arr=array(); $des_data=""; $brand_data="";
		for ($i=1;$i<=$total_row;$i++)
		{
			$trims_del_qty='';
			$txttrimcostid="txttrimcostid_".$i;
			$txtReqAmt="txtReqAmt_".$i;
			$txtpoid="txtpoid_".$i;
			$txttrimgroup="txttrimgroup_".$i;
			$txtwoq="txtwoq_".$i;
			$txtexchrate="txtexchrate_".$i;
			$txtrate="txtrate_".$i;
			$txtamount="txtamount_".$i;
			$txtbookingid="txtbookingid_".$i;
			$txtjob_id="txtjob_".$i;
			$txtreqqnty="txtreqqnty_".$i;
			$txtdesc="txtdesc_".$i;
		    $txtbrandsup="txtbrandsup_".$i;
			$txtreqamount="txtreqamount_".$i;
			$txtremark="txtremark_".$i;
			$txtreqamountjoblevelconsuom="txtreqamountjoblevelconsuom_".$i;
			$txtreqamountitemlevelconsuom="txtreqamountitemlevelconsuom_".$i;

			$JoBc=$$txtjob_id;
			$condition= new condition();

			if(str_replace("'","",$$txtjob_id) !=''){
				$condition->job_no("=$JoBc");
			}

			$condition->init();
			$trims= new trims($condition);
			//$req_qty_arr=$trims->getQtyArray_by_orderAndPrecostdtlsid();
			//$req_amount_arr=$trims->getAmountArray_by_orderAndPrecostdtlsid();

			$reqQtyItemLevelArr=$trims->getQtyArray_by_precostdtlsid();
			$reqAmountItemLevelArr=$trims->getAmountArray_precostdtlsid();
			$reqAmountJobLevelArr=$trims->getAmountArray_by_job();

			$pretrimcostid=str_replace("'","",$$txttrimcostid);
			$poid=str_replace("'","",$$txtpoid);
			$bookingdtlsid=str_replace("'","",$$txtbookingid);
			$trims_del_qty=$delivery_qty_arr[$bookingdtlsid]['delevery_qty'];
			if($trims_del_qty>0)
			{
				if( str_replace("'","",$$txtreqqnty) <= $trims_del_qty)
				{
					$trims_del_no=$delivery_qty_arr[$bookingdtlsid]['trims_del'];
					$trims_del_no=implode(", ",array_unique(explode(",",chop($trims_del_no,','))));
					echo "delQtyExeed**".$trims_del_no;
					 disconnect($con);die;
				}
			}
			$conversion_factor=$sql_lib_item_group_array[str_replace("'","",$$txttrimgroup)]['conversion_factor'];

			$curr_book_amount_job_level[str_replace("'","",$$txtjob_id)]['req_amount']=$reqAmountJobLevelArr[str_replace("'","",$$txtjob_id)];
			$curr_book_amount_job_level[str_replace("'","",$$txtjob_id)]['cur_amount']+=(str_replace("'","",$$txtamount)/str_replace("'","",$$txtexchrate));
			$curr_book_amount_job_level[str_replace("'","",$$txtjob_id)]['prev_amount']=0;

			$curr_book_amount_job_item_level[str_replace("'","",$$txtjob_id)][$poid][str_replace("'","",$$txttrimcostid)]['req_amount']+=$reqAmountItemLevelArr[$pretrimcostid];
			$curr_book_amount_job_item_level[str_replace("'","",$$txtjob_id)][$poid][str_replace("'","",$$txttrimcostid)]['cur_amount']+=(str_replace("'","",$$txtamount)/str_replace("'","",$$txtexchrate));
			$curr_book_amount_job_item_level[str_replace("'","",$$txtjob_id)][$poid][str_replace("'","",$$txttrimcostid)]['prev_amount']=0;

			$curr_book_qty_job_item_level[str_replace("'","",$$txtjob_id)][$poid][$pretrimcostid]['req_qty']+=$reqQtyItemLevelArr[$pretrimcostid];
			$curr_book_qty_job_item_level[str_replace("'","",$$txtjob_id)][$poid][$pretrimcostid]['cur_qty']+=(str_replace("'","",$$txtreqqnty)*$conversion_factor);
			$curr_book_qty_job_item_level[str_replace("'","",$$txtjob_id)][$poid][$pretrimcostid]['prev_qty']=0;

			$jobArr[$$txtjob_id]=$$txtjob_id;
			$poArr[$poid]=$poid;
			$pre_trim_id_arr[$pretrimcostid]=$pretrimcostid;
			$des_arr[$$txtdesc]=$$txtdesc;
			$brand_arr[$$txtbrandsup]=$$txtbrandsup;
			$booking_dtls_id_arr[$bookingdtlsid]=$bookingdtlsid;
		}

		$prev_book_amount_job_level=array();
		$prev_book_amount_job_item_level=array();
		//$sql=sql_select("select  id,po_break_down_id as po_id, job_no,pre_cost_fabric_cost_dtls_id,trim_group,wo_qnty,amount,exchange_rate from wo_booking_dtls where job_no in(".implode(",",$jobArr).") and booking_type=2 and is_short=2 and status_active=1 and is_deleted=0");// and po_break_down_id in($poid)
		$sql=sql_select("select b.id ,b.job_no, b.po_break_down_id as po_id, b.pre_cost_fabric_cost_dtls_id, b.trim_group,b.wo_qnty,b.amount,b.exchange_rate from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no and b.job_no in(".implode(",",$jobArr).") and b.booking_type=2 and b.is_short=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0");
		foreach($sql as $row){
			$curr_book_amount_job_level[$row[csf('job_no')]]['prev_amount']+=($row[csf('amount')]/$row[csf('exchange_rate')]);

			$prev_book_amount_job_level[$row[csf('id')]]['prev_amount']=($row[csf('amount')]/$row[csf('exchange_rate')]);
			$prev_book_amount_job_level[$row[csf('id')]]['prev_qty']=($row[csf('wo_qnty')]*$sql_lib_item_group_array[$row[csf('trim_group')]]['conversion_factor']);

			$curr_book_amount_job_item_level[$row[csf('job_no')]][$row[csf('po_id')]][$row[csf('pre_cost_fabric_cost_dtls_id')]]['prev_amount']+=($row[csf('amount')]/$row[csf('exchange_rate')]);
		    $curr_book_qty_job_item_level[$row[csf('job_no')]][$row[csf('po_id')]][$row[csf('pre_cost_fabric_cost_dtls_id')]]['prev_qty']+=($row[csf('wo_qnty')]*$sql_lib_item_group_array[$row[csf('trim_group')]]['conversion_factor']);

		}
		$con = connect();
		if($db_type==0){
		mysql_query("BEGIN");
		}
		if( check_table_status( $_SESSION['menu_id'], 1 )==0 ){
			echo "15**1";
			 disconnect($con);die;
		}

		if(str_replace("'","",implode(",",$des_arr))!="") $des_data_cond="and description in(".implode(",",$des_arr).")"; else $des_data_cond="";
		if(str_replace("'","",implode(",",$brand_arr))!="") $brand_data_cond="and brand_supplier in(".implode(",",$brand_arr).")"; else $brand_data_cond="";

		//if (is_duplicate_field( "booking_no", "wo_booking_dtls", "job_no in(".implode(",",$jobArr).") and booking_type=2 and is_short=2 and booking_no=$txt_booking_no and status_active=1 and is_deleted=0 $des_data_cond $brand_data_cond") == 1)
		if (is_duplicate_field( "booking_no", "wo_booking_dtls", "job_no in(".implode(",",$jobArr).") and po_break_down_id in (".implode(",",$poArr).") and pre_cost_fabric_cost_dtls_id in(".implode(",",$pre_trim_id_arr).") and id not in(".implode(",",$booking_dtls_id_arr).") and booking_type=2 and is_short=2 and booking_no=$txt_booking_no and status_active=1 and is_deleted=0 $des_data_cond $brand_data_cond") == 1)
		{
			echo "11**0";
			check_table_status( $_SESSION['menu_id'],0);
			 disconnect($con);die;
		}
		$sql_subcon_trim=sql_select("select b.job_no_mst,a.order_no,b.booking_dtls_id,b.booked_qty,b.item_group from subcon_ord_mst a,subcon_ord_dtls b where a.subcon_job=b.job_no_mst and a.order_no=$txt_booking_no and a.order_id is not null and a.entry_form=255 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 ");
		foreach($sql_subcon_trim as $row)
		{
			$trims_recQtyArr[$row[csf('booking_dtls_id')]]['booked_qty']=$row[csf('booked_qty')];
			$trims_recNoArr[$row[csf('booking_dtls_id')]]=$row[csf('job_no_mst')];
		}
 
 
		$field_array_up1="pre_cost_fabric_cost_dtls_id*pre_req_amt*po_break_down_id*job_no*trim_group*description*brand_supplier*uom*sensitivity*wo_qnty*exchange_rate*rate*amount*delivery_date*country_id_string*hs_code*remark*updated_by*update_date";
		$field_array_up2="id,wo_trim_booking_dtls_id,booking_no,booking_mst_id,job_no,po_break_down_id,color_number_id,gmts_sizes,description,brand_supplier,item_color,item_size,cons, process_loss_percent,requirment,rate,amount,pcs,color_size_table_id,article_number,item_ref,remarks";

		$add_comma=0;
		$id1=return_next_id( "id", "wo_trim_book_con_dtls", 1 );
		$new_array_color=array();
		for ($i=1;$i<=$total_row;$i++)
		{
			$txttrimcostid="txttrimcostid_".$i;
			$txtReqAmt="txtReqAmt_".$i;
			$txtpoid="txtpoid_".$i;
			$txttrimgroup="txttrimgroup_".$i;
			$txtuom="txtuom_".$i;
			$cbocolorsizesensitive="cbocolorsizesensitive_".$i;
			$txtwoq="txtwoq_".$i;
			$txtexchrate="txtexchrate_".$i;
			$txtrate="txtrate_".$i;
			$txtamount="txtamount_".$i;
			$txtddate="txtddate_".$i;
			$consbreckdown="consbreckdown_".$i;
			$txtbookingid="txtbookingid_".$i;
			$txtcountry="txtcountry_".$i;
			$txtjob_id="txtjob_".$i;

			$txtdesc="txtdesc_".$i;
			$txthscode="txthscode_".$i;
			$txtbrandsup="txtbrandsup_".$i;
			$txtreqamount="txtreqamount_".$i;
			$txtremarks="txtremarks_".$i;
			$txtreqamountjoblevelconsuom="txtreqamountjoblevelconsuom_".$i;
			$txtreqamountitemlevelconsuom="txtreqamountitemlevelconsuom_".$i;
			$poid=str_replace("'","",$$txtpoid);
			$pi_number=array();
			$piquantity=0;
			$sqlPi=sql_select("select a.pi_number, b.quantity from  com_pi_master_details a, com_pi_item_details b where a.id=b.pi_id  and b.work_order_no=$txt_booking_no and b.item_group=".$$txttrimgroup." and b.order_id in($poid) and a.item_category_id=4 and a.status_active=1 and  a.is_deleted=0  and b.status_active=1 and  b.is_deleted=0");
			foreach($sqlPi as $rowPi){
				$pi_number[$rowPi[csf('pi_number')]]=$rowPi[csf('pi_number')];
				$piquantity+=$rowPi[csf('quantity')];
			}
			$uom_id=str_replace("'","",$$txtuom);
			if($piquantity && str_replace("'","",$$txtwoq) < $piquantity){
				echo "pi1**".str_replace("'","",$txt_booking_no)."**".implode(",",$pi_number)."**".$piquantity;
				check_table_status( $_SESSION['menu_id'],0);

				 disconnect($con);die;
			}
			
			$ex_book_dtls_id=explode(",",str_replace("'",'',$$txtbookingid));
				$order_trim_recv_qty=0;
				foreach($ex_book_dtls_id as $book_dtls_id)
				{
					$order_trim_recv_qty+=$trims_recQtyArr[$book_dtls_id]['booked_qty'];
					$trims_recNoCheckArr[$book_dtls_id]=$trims_recNoArr[$book_dtls_id];
				}
				
			if($order_trim_recv_qty && str_replace("'","",$$txtwoq) < $order_trim_recv_qty){
				echo "orderFound**".str_replace("'","",$txt_booking_no)."**".implode(",",$trims_recNoCheckArr)."**".$order_trim_recv_qty;
				check_table_status( $_SESSION['menu_id'],0);
				 disconnect($con);die;
			}
			

			$recv_number=array();
			$recvquantity=0;
			if(str_replace("'","",$$txtdesc)=="" || str_replace("'","",$$txtdesc)==0) $desc_con=""; else $desc_con=" and b.item_description=".$$txtdesc." ";
			if(str_replace("'","",$$txtpoid)=="" || str_replace("'","",$$txtpoid)==0) $poid_con=""; else $poid_con=" and c.po_breakdown_id in (".str_replace("'","",$$txtpoid).") ";
			$sqlRecv=sql_select("select a.recv_number, c.quantity as receive_qnty from  inv_receive_master a,inv_trims_entry_dtls b, order_wise_pro_details c where a.id=b.mst_id and b.id=c.dtls_id and c.trans_type=1 and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and b.item_group_id=".$$txttrimgroup." and c.po_breakdown_id in($poid) and a.item_category=4 and a.status_active=1 and a.is_deleted=0  and b.status_active=1 and b.is_deleted=0 $desc_con $poid_con");
			foreach($sqlRecv as $rowRecv){
				$recv_number[$rowRecv[csf('recv_number')]]=$rowRecv[csf('recv_number')];
				$recvquantity+=$rowRecv[csf('receive_qnty')];
			}
			
			if($recvquantity>0)
			{
				if($recvquantity>0 && $recvquantity<=str_replace("'","",$$txtwoq))
				{
					check_table_status( $_SESSION['menu_id'],0);
				}
				else
				{
					echo "recv1**".str_replace("'","",$txt_booking_no)."**".implode(",",$recv_number)."**".$recvquantity;
					check_table_status( $_SESSION['menu_id'],0);
					 disconnect($con);die;
				}
			}
			
			$job=str_replace("'","",$$txtjob_id);
			$poid=str_replace("'","",$$txtpoid);
			$trimcostid=str_replace("'","",$$txttrimcostid);
			$amt=str_replace("'","",$$txtamount);
			$exRate=str_replace("'","",$$txtexchrate);
			//==============================
			if($amount_exceed_level==1){
				$reqAmt=(($curr_book_amount_job_level[$job]['req_amount']*$exeed_budge_amount)/100)+$curr_book_amount_job_level[$job]['req_amount'];

				$pre_amt=0;
				$ex_book_dtls_id=explode(",",str_replace("'",'',$$txtbookingid));
				foreach($ex_book_dtls_id as $book_dtls_id)
				{
					$pre_amt+=$prev_book_amount_job_level[$book_dtls_id]['prev_amount'];
				}
				$curAmt=($curr_book_amount_job_level[$job]['prev_amount']-$pre_amt)+($amt/$exRate);

				//$curAmt=$curr_book_amount_job_level[$job]['prev_amount']+($amt/$exRate);
				if(($curAmt-$reqAmt)>1){
					echo "vad1**".str_replace("'","",$txt_booking_no)."**".$i;
					check_table_status( $_SESSION['menu_id'],0);
					 disconnect($con);die;
				}
				$curr_book_amount_job_level[$job]['prev_amount']+=($amt/$exRate);
			}
			if($amount_exceed_level==2){
				$reqAmt=(($curr_book_amount_job_item_level[$job][$poid][$trimcostid]['req_amount']*$exeed_budge_amount)/100)+$curr_book_amount_job_item_level[$job][$poid][$trimcostid]['req_amount'];
				$pre_amt=0;
				$ex_book_dtls_id=explode(",",str_replace("'",'',$$txtbookingid));
				foreach($ex_book_dtls_id as $book_dtls_id)
				{
					$pre_amt+=$prev_book_amount_job_level[$book_dtls_id]['prev_amount'];
				}

				$curAmt=($curr_book_amount_job_item_level[$job][$poid][$trimcostid]['prev_amount']-$pre_amt)+($amt/$exRate);
				if(($curAmt-$reqAmt)>1){
					echo "vad1**".str_replace("'","",$txt_booking_no)."**".$i."**".$curAmt."**".$reqAmt."**".$curr_book_amount_job_item_level[$job][$poid][$trimcostid]['req_amount'];
					check_table_status( $_SESSION['menu_id'],0);
					 disconnect($con);die;
				}
					//echo "vad1**".str_replace("'","",$txt_booking_no)."**".$i."**".$curAmt."**".$reqAmt."**".$curr_book_amount_job_item_level[$job][$poid][$trimcostid]['req_amount'];
				$curr_book_amount_job_item_level[$job][$poid][$trimcostid]['prev_amount']+=($amt/$exRate);
			}


			if($exceed_qty_level==2){
				$reqQty=(($curr_book_qty_job_item_level[$job][$poid][$trimcostid]['req_qty']*$exeed_budge_qty)/100)+$curr_book_qty_job_item_level[$job][$poid][$trimcostid]['req_qty'];
				$curQty=$curr_book_qty_job_item_level[$job][$poid][$trimcostid]['prev_qty']+($woq*$conversion_factor);
				if(($curQty-$reqQty)>1){
					echo "vad2**".str_replace("'","",$txt_booking_no)."**".$i."**".$curQty."**".$reqQty."**".$curr_book_amount_job_item_level[$job][$poid][$trimcostid]['req_qty'];
					check_table_status( $_SESSION['menu_id'],0);
					 disconnect($con);die;
				}
				$curr_book_qty_job_item_level[$job][$poid][$trimcostid]['prev_qty']+=($woq*$conversion_factor);
			}


			if(str_replace("'",'',$$txtbookingid)!=""){
				$id_arr=array();
				$data_array_up1=array();
				$id_arr[]=str_replace("'",'',$$txtbookingid);
				$data_array_up1[str_replace("'",'',$$txtbookingid)] =explode("*",("".$$txttrimcostid."*".$$txtReqAmt."*".$$txtpoid."*".$$txtjob_id."*".$$txttrimgroup."*".$$txtdesc."*".trim($$txtbrandsup)."*".$$txtuom."*".$$cbocolorsizesensitive."*".$$txtwoq."*".$$txtexchrate."*".$$txtrate."*".$$txtamount."*".$$txtddate."*".$$txtcountry."*".$$txthscode."*".$$txtremark."*".$_SESSION['logic_erp']['user_id']."*'".$pc_date_time."'"));

				//	CONS break down===============================================================================================
				if(str_replace("'",'',$$consbreckdown) !=''){
					$data_array_up2="";
					$rID_de1=execute_query( "delete from wo_trim_book_con_dtls where  wo_trim_booking_dtls_id =".$$txtbookingid."",0);
					$consbreckdown_array=explode('__',str_replace("'",'',$$consbreckdown));
					for($c=0;$c < count($consbreckdown_array);$c++){
						$consbreckdownarr=explode('_',$consbreckdown_array[$c]);
						 $consbreckdownarr[4]=trim(str_replace("'",'',$consbreckdownarr[4]));
						 if(str_replace("'","",$consbreckdownarr[4])=='0') $consbreckdownarr[4]='';
						if(str_replace("'",'',$consbreckdownarr[4]) !='')
						{
							if (!in_array(str_replace("'","",$consbreckdownarr[4]),$new_array_color, TRUE)){
								$color_id = return_id( str_replace("'","",$consbreckdownarr[4]), $color_library, "lib_color", "id,color_name","87");
								$new_array_color[$color_id]=str_replace("'","",$consbreckdownarr[4]);
							}
							else $color_id =  array_search(str_replace("'","",$consbreckdownarr[4]), $new_array_color);
						}
						else $color_id =0;


						if ($c!=0) $data_array_up2 .=",";
						$data_array_up2 .="(".$id1.",".$$txtbookingid.",".$txt_booking_no.",".$booking_id.",".$$txtjob_id.",".$$txtpoid.",'".$consbreckdownarr[0]."','".$consbreckdownarr[1]."','".$consbreckdownarr[2]."','".trim($consbreckdownarr[3])."','".$color_id."','".$consbreckdownarr[5]."','".$consbreckdownarr[6]."','".$consbreckdownarr[7]."','".$consbreckdownarr[8]."','".$consbreckdownarr[9]."','".$consbreckdownarr[10]."','".$consbreckdownarr[11]."','".$consbreckdownarr[12]."','".$consbreckdownarr[14]."','".$consbreckdownarr[15]."','".$consbreckdownarr[16]."')";
						$id1=$id1+1;
						$add_comma++;
					}
				}
				//CONS break down end===============================================================================================
				if($data_array_up1 !="")
				{
				$rID1=execute_query(bulk_update_sql_statement( "wo_booking_dtls", "id", $field_array_up1, $data_array_up1, $id_arr ));
				}
			}
			$rID2=1;
			if($data_array_up2 !="")
			{
				$rID2=sql_insert("wo_trim_book_con_dtls",$field_array_up2,$data_array_up2,1);
			}
		}
		$rID=execute_query( "update wo_booking_mst set revised_no=revised_no+1 where  booking_no=$txt_booking_no",0);
		check_table_status( $_SESSION['menu_id'],0);
		if($db_type==0){
			if($rID1 &&  $rID2 && $flag){
				mysql_query("COMMIT");
				echo "1**".str_replace("'","",$txt_booking_no);
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**".str_replace("'","",$txt_booking_no);
			}
		}
		else if($db_type==2 || $db_type==1 ){
			if($rID1 &&  $rID2 && $flag){
				oci_commit($con);
				echo "1**".str_replace("'","",$txt_booking_no);
			}
			else{
				oci_rollback($con);
				echo "10**".str_replace("'","",$txt_booking_no);
			}
		}
		disconnect($con);
		die;
	}
	else if ($operation==2)
	{
		$con = connect();
		if($db_type==0){
			mysql_query("BEGIN");
		}
		for ($i=1;$i<=$total_row;$i++){
			$txttrimcostid="txttrimcostid_".$i;
			$txttrimgroup="txttrimgroup_".$i;
			$txtpoid="txtpoid_".$i;
			$txtbookingid="txtbookingid_".$i;
			$txtdesc="txtdesc_".$i;
			$txtreqqnty="txtreqqnty_".$i;
			//if(str_replace("'","",$cbo_pay_mode)==2){
			$pi_number=return_field_value( "pi_number", "com_pi_master_details a,com_pi_item_details b"," a.id=b.pi_id  and b.work_order_no=$txt_booking_no and b.item_group=".$$txttrimgroup." and a.item_category_id=4 and a.status_active=1 and  a.is_deleted=0  and b.status_active=1 and  b.is_deleted=0");
			    if($pi_number){
				    echo "pi1**".str_replace("'","",$txt_booking_no)."**".$pi_number;
				     disconnect($con);die;
			    }
			//}else{
				
			if(str_replace("'","",$$txtdesc)=="" || str_replace("'","",$$txtdesc)==0) $desc_con=""; else $desc_con=" and b.item_description=".$$txtdesc." ";
			$recv_number=return_field_value( "recv_number", "inv_receive_master a,inv_trims_entry_dtls b"," a.id=b.mst_id and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and b.item_group_id=".$$txttrimgroup." and a.item_category=4 and a.status_active=1 and  a.is_deleted=0  and b.status_active=1 and  b.is_deleted=0 $desc_con");
			    if($recv_number){
				    echo "recv1**".str_replace("'","",$txt_booking_no)."**".$recv_number;
				     disconnect($con);die;
			    }
			//}
			$bookingdtlsid=str_replace("'","",$$txtbookingid);
			$subcon_job=return_field_value( "subcon_job", "subcon_ord_mst a, subcon_ord_dtls b"," a.entry_form=255 and a.subcon_job=b.job_no_mst and a.id=b.mst_id and b.booking_dtls_id in ($bookingdtlsid) and a.status_active=1 and b.status_active=1");
		    if(!empty($subcon_job)){
			     echo "orderFound**".$subcon_job."**SELECT subcon_job from subcon_ord_mst a, subcon_ord_dtls b where a.entry_form=255 and a.subcon_job=b.job_no_mst and a.id=b.mst_id and b.booking_dtls_id in ($bookingdtlsid) and a.status_active=1 and b.status_active=1";
			     oci_rollback($con);
			     disconnect($con);die;
		    }
		    
			
			$trims_del_qty=$delivery_qty_arr[$bookingdtlsid]['delevery_qty'];
			if($trims_del_qty>0)
			{
				if( str_replace("'","",$$txtreqqnty) <= $trims_del_qty)
				{
					$trims_del_no=$delivery_qty_arr[$bookingdtlsid]['trims_del'];
					$trims_del_no=implode(", ",array_unique(explode(",",chop($trims_del_no,','))));
					 echo "delQtyExeed**".$trims_del_no;
					 disconnect($con);die;
				}
			}
			$delete_cause=str_replace("'","",$delete_cause);
			$delete_cause=str_replace('"','',$delete_cause);
			$delete_cause=str_replace('(','',$delete_cause);
			$delete_cause=str_replace(')','',$delete_cause);

			//$rID1=execute_query( "delete from wo_booking_dtls where  id in (".str_replace("'","",$$txtbookingid).")",0);
			//$rID2=execute_query( "delete from wo_trim_book_con_dtls where  wo_trim_booking_dtls_id in(".str_replace("'","",$$txtbookingid).")",0);

			$rID1=execute_query( "update wo_booking_dtls set status_active=0,is_deleted=1,delete_cause='$delete_cause',updated_by=".$_SESSION['logic_erp']['user_id'].", update_date='".$pc_date_time."'   where  id in (".str_replace("'","",$$txtbookingid).") and booking_no=$txt_booking_no",0);
		    $rID2=execute_query( "update wo_trim_book_con_dtls set status_active=0,is_deleted=1 where  wo_trim_booking_dtls_id in(".str_replace("'","",$$txtbookingid).") and booking_no=$txt_booking_no",0);
		}
		if($db_type==0){
			if($rID1 &&  $rID2 && $flag){
				mysql_query("COMMIT");
				echo "2**".str_replace("'","",$txt_booking_no);
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**".str_replace("'","",$txt_booking_no);
			}
		}

		if($db_type==2 || $db_type==1 ){
			if($rID1 &&  $rID2 && $flag){
				oci_commit($con);
				echo "2**".str_replace("'","",$txt_booking_no);
			}
			else{
				oci_rollback($con);
				echo "10**".str_replace("'","",$txt_booking_no);
			}
		}
		disconnect($con);
		die;
	}
}

if ($action=="save_update_delete_dtls_job_level"){

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	$booking_mst_id=str_replace("'","",$update_id);
	$is_approved=return_field_value( "is_approved", "wo_booking_mst","booking_no=$txt_booking_no");
	if($is_approved==3) $is_approved=1;
	if($is_approved==1){
		echo "app1**".str_replace("'","",$txt_booking_no);
		 disconnect($con);die;
	}

	if(str_replace("'","",$txt_booking_no)!='' )
	{
		$sql=sql_select("select a.trims_del,b.booking_dtls_id,b.delevery_qty  from trims_delivery_mst a, trims_delivery_dtls b where a.id=b.mst_id and b.order_no=$txt_booking_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0");
		$delivery_qty_arr=array();
		foreach($sql as $row)
		{
			$delivery_qty_arr[$row[csf('booking_dtls_id')]]['delevery_qty'] +=$row[csf('delevery_qty')];
			$delivery_qty_arr[$row[csf('booking_dtls_id')]]['trims_del'] .=$row[csf('trims_del')].",";
		}
	}
	$trim_type= return_library_array("select id, trim_type from lib_item_group",'id','trim_type');

	$sql_lib_item_group_array=array();
	$sql_lib_item_group=sql_select("select id, item_name,conversion_factor,order_uom as cons_uom from lib_item_group");
	foreach($sql_lib_item_group as $row_sql_lib_item_group){
		$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]]['conversion_factor']=$row_sql_lib_item_group[csf('conversion_factor')];
	}

	$exeed_budge_qty=0; $exeed_budge_amount=0; $amount_exceed_level=0; $exceed_qty_level=0;

	$data_array=sql_select("select exeed_budge_qty,exeed_budge_amount,amount_exceed_level,exceed_qty_level from variable_order_tracking where company_name='$cbo_company_name' and item_category_id=4 and variable_list=26 and status_active=1 and is_deleted=0");
	foreach ($data_array as $row){
		$exeed_budge_qty=$row[csf("exeed_budge_qty")];
		$exeed_budge_amount=$row[csf("exeed_budge_amount")];
		$amount_exceed_level=$row[csf("amount_exceed_level")];
		$exceed_qty_level = $row[csf("exceed_qty_level")];
	}

	$strdata=json_decode(str_replace("'","",$strdata));

	if ($operation==0)
	{
		$curr_book_amount_job_level=array(); $curr_book_amount_job_item_level=array(); $jobArr=array(); $poArr=array(); $pre_trim_id_arr=array(); $des_arr=array(); $brand_arr=array();

		for ($i=1;$i<=$total_row;$i++){
			$txttrimcostid="txttrimcostid_".$i;
			$txtReqAmt="txtReqAmt_".$i;
			$txtpoid="txtpoid_".$i;
			$txttrimgroup="txttrimgroup_".$i;
			$txtwoq="txtwoq_".$i;
			$txtexchrate="txtexchrate_".$i;
			$txtrate="txtrate_".$i;
			$txtamount="txtamount_".$i;
			$txtbookingid="txtbookingid_".$i;
			$txtjob_id="txtjob_".$i;
			$txtreqqnty="txtreqqnty_".$i;
			$txtdesc="txtdesc_".$i;
		    $txtbrandsup="txtbrandsup_".$i;
			$txtreqamount="txtreqamount_".$i;
			$txtremarks="txtremarks_".$i;
			$txtremark="txtremark_".$i;
			$txtreqamountjoblevelconsuom="txtreqamountjoblevelconsuom_".$i;
			$txtreqamountitemlevelconsuom="txtreqamountitemlevelconsuom_".$i;			
			$JoBc=$$txtjob_id;
			$condition= new condition();
			if(str_replace("'","",$$txtjob_id) !=''){
				$condition->job_no("=$JoBc");
			}

			$condition->init();
			$trims= new trims($condition);
			//$req_qty_arr=$trims->getQtyArray_by_orderAndPrecostdtlsid();
			//$req_amount_arr=$trims->getAmountArray_by_orderAndPrecostdtlsid();
			$reqQtyItemLevelArr=$trims->getQtyArray_by_precostdtlsid();
			$reqAmountItemLevelArr=$trims->getAmountArray_precostdtlsid();
			$reqAmountJobLevelArr=$trims->getAmountArray_by_job();
			//$reqQtyJobLevelArr=$trims->getQtyArray_by_job();

			$pretrimcostid=str_replace("'","",$$txttrimcostid);
			$poid=str_replace("'","",$$txtpoid);
			$conversion_factor=$sql_lib_item_group_array[str_replace("'","",$$txttrimgroup)]['conversion_factor'];

			$curr_book_qty_job_item_level[str_replace("'","",$$txtjob_id)][$pretrimcostid]['req_qty']+=$reqQtyItemLevelArr[$pretrimcostid];
			$curr_book_qty_job_item_level[str_replace("'","",$$txtjob_id)][$pretrimcostid]['cur_qty']+=(str_replace("'","",$$txtreqqnty)*$conversion_factor);
			$curr_book_qty_job_item_level[str_replace("'","",$$txtjob_id)][$pretrimcostid]['prev_qty']=0;

			$curr_book_amount_job_level[str_replace("'","",$$txtjob_id)]['req_amount']=$reqAmountJobLevelArr[str_replace("'","",$$txtjob_id)];
			$curr_book_amount_job_level[str_replace("'","",$$txtjob_id)]['cur_amount']+=(str_replace("'","",$$txtamount)/str_replace("'","",$$txtexchrate));
			$curr_book_amount_job_level[str_replace("'","",$$txtjob_id)]['prev_amount']=0;

			$curr_book_amount_job_item_level[str_replace("'","",$$txtjob_id)][$pretrimcostid]['req_amount']+=$reqAmountItemLevelArr[$pretrimcostid];
			$curr_book_amount_job_item_level[str_replace("'","",$$txtjob_id)][$pretrimcostid]['cur_amount']+=(str_replace("'","",$$txtamount)/str_replace("'","",$$txtexchrate));
			$curr_book_amount_job_item_level[str_replace("'","",$$txtjob_id)][$pretrimcostid]['prev_amount']=0;

			$jobArr[$$txtjob_id]=$$txtjob_id;
			$poArr[$poid]=$poid;
			$pre_trim_id_arr[$pretrimcostid]=$pretrimcostid;
			$des_arr[$$txtdesc]=$$txtdesc;
			$brand_arr[$$txtbrandsup]=$$txtbrandsup;
		}


		$prev_book_amount_job_level=array();
		$prev_book_amount_job_item_level=array();
		$sql=sql_select("select b.id, b.job_no, b.pre_cost_fabric_cost_dtls_id, b.trim_group, b.wo_qnty, b.amount, b.exchange_rate from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no and b.job_no in(".implode(",",$jobArr).") and b.booking_type=2 and b.is_short=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and  b.exchange_rate>0");
		foreach($sql as $row){
			$curr_book_amount_job_level[$row[csf('job_no')]]['prev_amount']+=($row[csf('amount')]/$row[csf('exchange_rate')]);
			$curr_book_amount_job_item_level[$row[csf('job_no')]][$row[csf('pre_cost_fabric_cost_dtls_id')]]['prev_amount']+=($row[csf('amount')]/$row[csf('exchange_rate')]);
			$curr_book_qty_job_item_level[$row[csf('job_no')]][$row[csf('pre_cost_fabric_cost_dtls_id')]]['prev_qty']+=($row[csf('wo_qnty')]*$sql_lib_item_group_array[$row[csf('trim_group')]]['conversion_factor']);
		}


		$con = connect();
		if($db_type==0){
			mysql_query("BEGIN");
		}
		if  (check_table_status( $_SESSION['menu_id'], 1 )==0 ){
			echo "15**0**".$_SESSION['menu_id'];
			 disconnect($con);die;
		}

		if(str_replace("'","",implode(",",$des_arr))!="") $des_data_cond="and description in(".implode(",",$des_arr).")"; else $des_data_cond="";
		if(str_replace("'","",implode(",",$brand_arr))!="") $brand_data_cond="and brand_supplier in(".implode(",",$brand_arr).")"; else $brand_data_cond="";
		if (is_duplicate_field( "booking_no", "wo_booking_dtls", "job_no in(".implode(",",$jobArr).") and po_break_down_id in (".implode(",",$poArr).") and pre_cost_fabric_cost_dtls_id in(".implode(",",$pre_trim_id_arr).") and booking_type=2 and is_short=2 and booking_no=$txt_booking_no and status_active=1 and is_deleted=0 $des_data_cond $brand_data_cond") == 1)
		{
			check_table_status( $_SESSION['menu_id'],0);
			echo "11**0";
			 disconnect($con);die;
		}

		$id_dtls=return_next_id( "id", "wo_booking_dtls", 1 ) ;
		$field_array1="id, pre_cost_fabric_cost_dtls_id, pre_req_amt, po_break_down_id, job_no, booking_no, booking_mst_id, booking_type, is_short, trim_group, description, brand_supplier, uom, sensitivity, wo_qnty, exchange_rate, rate, amount, delivery_date, country_id_string, hs_code, remark,inserted_by, insert_date";
		$field_array2="id, wo_trim_booking_dtls_id, booking_no, booking_mst_id, job_no, po_break_down_id, color_number_id, gmts_sizes, description, brand_supplier, item_color, item_size, cons, process_loss_percent, requirment, rate, amount, pcs, color_size_table_id, article_number, item_ref, remarks";
		$add_comma=0;
		$id1=return_next_id( "id", "wo_trim_book_con_dtls", 1 );
		$new_array_color=array();
		for ($i=1;$i<=$total_row;$i++){
			$txttrimcostid="txttrimcostid_".$i;
			$txtReqAmt="txtReqAmt_".$i;
			$txtpoid="txtpoid_".$i;
			$txttrimgroup="txttrimgroup_".$i;
			$txtuom="txtuom_".$i;
			$cbocolorsizesensitive="cbocolorsizesensitive_".$i;
			$txtwoq="txtwoq_".$i;
			$txtexchrate="txtexchrate_".$i;
			$txtrate="txtrate_".$i;
			$txtamount="txtamount_".$i;
			$txtddate="txtddate_".$i;
			$consbreckdown="consbreckdown_".$i;
			$txtbookingid="txtbookingid_".$i;
			$txtcountry="txtcountry_".$i;
			$txtjob_id="txtjob_".$i;
			$txtreqqnty="txtreqqnty_".$i;
			$txtremarks="txtremarks_".$i;
			$txtremark="txtremark_".$i;
			$jsondata="jsondata_".$i;

			$txtdesc="txtdesc_".$i;
		    $txtbrandsup="txtbrandsup_".$i;
			$txtreqamount="txtreqamount_".$i;
			$txtreqamountjoblevelconsuom="txtreqamountjoblevelconsuom_".$i;
			$txtreqamountitemlevelconsuom="txtreqamountitemlevelconsuom_".$i;
			$txthscode="txthscode_".$i;

			$jsonarr=json_decode(str_replace("'","",$$jsondata));
			$uom_id=str_replace("'","",$$txtuom);
			$delivery_ddate=str_replace("'","",$$txtddate);
			$job=str_replace("'","",$$txtjob_id);
			$trimcostid=str_replace("'","",$$txttrimcostid);
			$reqqnty=str_replace("'","",$$txtreqqnty);
			$woq=str_replace("'","",$$txtwoq);
			$rate=str_replace("'","",$$txtrate);
			$amt=str_replace("'","",$$txtamount);
			$exRate=str_replace("'","",$$txtexchrate);
			$conversion_factor=$sql_lib_item_group_array[str_replace("'","",$$txttrimgroup)]['conversion_factor'];

			//==============================
			$reqAmt=$curAmt=0;
			if($amount_exceed_level==1){
				$reqAmt=(($curr_book_amount_job_level[$job]['req_amount']*$exeed_budge_amount)/100)+$curr_book_amount_job_level[$job]['req_amount'];
				$curAmt=$curr_book_amount_job_level[$job]['prev_amount']+$curr_book_amount_job_level[$job]['cur_amount'];
				$reqAmut=$curAmut=0;
				$reqAmut=number_format($reqAmt,0,'.','');
				$curAmut=number_format($curAmt,0,'.','');

				if(($curAmut>$reqAmut)){
					echo "vad1**".str_replace("'","",$txt_booking_no)."**".$i."**".$curAmut."**".$reqAmut;
					check_table_status( $_SESSION['menu_id'],0);
					 disconnect($con);die;
				}
				//$curr_book_amount_job_level[$job]['prev_amount']+=($amt/$exRate);
			}
			if($amount_exceed_level==2){
				$reqAmt=(($curr_book_amount_job_item_level[$job][$trimcostid]['req_amount']*$exeed_budge_amount)/100)+$curr_book_amount_job_item_level[$job][$trimcostid]['req_amount'];
				$curAmt=$curr_book_amount_job_item_level[$job][$trimcostid]['prev_amount']+$curr_book_amount_job_item_level[$job][$trimcostid]['cur_amount'];
				if(($curAmt-$reqAmt)>1){
					echo "vad1**".str_replace("'","",$txt_booking_no)."**".$i."**".$curAmt."**".$reqAmt."**".$curr_book_amount_job_item_level[$job][$trimcostid]['req_amount'];
					check_table_status( $_SESSION['menu_id'],0);
					 disconnect($con);die;
				}
				//$curr_book_amount_job_item_level[$job][$trimcostid]['prev_amount']+=($amt/$exRate);
			}

			if($exceed_qty_level==2){
				$reqQty=(($curr_book_qty_job_item_level[$job][$trimcostid]['req_qty']*$exeed_budge_qty)/100)+$curr_book_qty_job_item_level[$job][$trimcostid]['req_qty'];
				$curQty=$curr_book_qty_job_item_level[$job][$trimcostid]['prev_qty']+($woq*$conversion_factor);
				if(($curQty-$reqQty)>1){
					echo "vad2**".str_replace("'","",$txt_booking_no)."**".$i."**".$curQty."**".$reqQty."**".$curr_book_qty_job_item_level[$job][$trimcostid]['req_qty'];
					check_table_status( $_SESSION['menu_id'],0);
					 disconnect($con);die;
				}
				$curr_book_qty_job_item_level[$job][$trimcostid]['prev_qty']+=($woq*$conversion_factor);
			}

			//===========================
			$po_ids=str_replace("'", "", $$txtpoid);
			$sql_date="SELECT a.task_finish_date,a.po_number_id,a.task_number from tna_process_mst a, wo_po_break_down b where a.po_number_id = b.id and a.status_active=1 and b.is_deleted=0 and A.TASK_NUMBER in (70,71) and (b.id in($po_ids))  group by a.task_finish_date,a.po_number_id,a.task_number";
			//echo $sql_date;

			$date_arr=array();

			$sql_result=sql_select($sql_date);
			foreach ($sql_result as $row) 
			{
				$date_arr[$row[csf('po_number_id')]][$row[csf('task_number')]]=$row[csf('task_finish_date')];
			}
			foreach($strdata->$job->$trimcostid->po_id as $poId){
				$wqQty=($strdata->$job->$trimcostid->req_qnty->$poId/$reqqnty)*$woq;
				$po_wise_wqqty[$poId]= $wqQty;
			}
			
			$rd=0;
			foreach($po_wise_wqqty as $poid=>$qty){
				$rd++;
				$powise_rounddown[$poid]=floor($qty);
				if(count($po_wise_wqqty)!=$rd){
					$remainning_qty+=$qty-floor($qty);
				}               
				if(count($po_wise_wqqty)==$rd){
					$powise_rounddown[$poid]=$qty+$remainning_qty;
				}
			}

			foreach($strdata->$job->$trimcostid->po_id as $poId){
				$wqQty=($strdata->$job->$trimcostid->req_qnty->$poId/$reqqnty)*$woq;
				//$wqQty=number_format($wqQty,8,'.','');
				//$wqQty=$powise_rounddown[$poId];

				//$date_del=$$txtddate;
				if($trim_type[str_replace("'", "", $$txttrimgroup)]==1)
				{
					$date_del=$date_arr[$poId][70];
				}
				else{

					$date_del=$date_arr[$poId][71];
				}
				if($date_del=='') $date_del=$delivery_ddate;
				$reqqtycostingper=$strdata->$job->$trimcostid->reqqtycostingper->$poId;
				
				$amount=$wqQty*$rate;
				$data_array1 ="(".$id_dtls.",".$$txttrimcostid.",'".$reqqtycostingper."',".$poId.",".$$txtjob_id.",".$txt_booking_no.",".$booking_mst_id.",2,2,".$$txttrimgroup.",".$$txtdesc.",".trim($$txtbrandsup).",".$$txtuom.",".$$cbocolorsizesensitive.",".$wqQty.",".$$txtexchrate.",".$$txtrate.",".$amount.",'".$date_del."',".$$txtcountry.",".$$txthscode.",".$$txtremark.",".$_SESSION['logic_erp']['user_id'].",'".$pc_date_time."')";
				$rID1=sql_insert("wo_booking_dtls",$field_array1,$data_array1,0);
				//	CONS break down===============================================================================================
				if(str_replace("'",'',$$consbreckdown) !=''){
					$rID_de1=execute_query( "delete from wo_trim_book_con_dtls where  wo_trim_booking_dtls_id =".$$txtbookingid."",0);
					$consbreckdown_array=explode('__',str_replace("'",'',$$consbreckdown));
					$d=0;
					for($c=0;$c < count($consbreckdown_array);$c++){
						$consbreckdownarr=explode('_',$consbreckdown_array[$c]);
						 $consbreckdownarr[4]=trim(str_replace("'",'',$consbreckdownarr[4]));
						 if(str_replace("'","",$consbreckdownarr[4])=='0') $consbreckdownarr[4]='';
						if(str_replace("'",'',$consbreckdownarr[4]) !='')
						{
							if (!in_array(str_replace("'","",$consbreckdownarr[4]),$new_array_color, TRUE)){
								$color_id = return_id( str_replace("'","",$consbreckdownarr[4]), $color_library, "lib_color", "id,color_name","87");
								$new_array_color[$color_id]=str_replace("'","",$consbreckdownarr[4]);
							}
							else $color_id =  array_search(str_replace("'","",$consbreckdownarr[4]), $new_array_color);
						}
						else $color_id =0;

						$gmc=$consbreckdownarr[0];
						$gms=$consbreckdownarr[1];
						$itemcolor=$color_id;
						$itemsize=str_replace("'", "", $consbreckdownarr[5]);
						$art=$consbreckdownarr[14];
						
						if(str_replace("'","",$$cbocolorsizesensitive)==1 || str_replace("'","",$$cbocolorsizesensitive)==3){
							$bQty=($jsonarr->$trimcostid->$gmc->req_qty->$poId/$consbreckdownarr[13])*$consbreckdownarr[6];
							$bwqQty=($jsonarr->$trimcostid->$gmc->req_qty->$poId/$consbreckdownarr[13])*$consbreckdownarr[8];
							$order_qty=$jsonarr->$trimcostid->$gmc->order_quantity->$poId;
							$colorSizeTableId=$jsonarr->$trimcostid->$gmc->color_size_table_id->$poId;
						}
						if(str_replace("'","",$$cbocolorsizesensitive)==2){
							$bQty=($jsonarr->$trimcostid->$gms->$art->req_qty->$poId/$consbreckdownarr[13])*$consbreckdownarr[6];
							$bwqQty=($jsonarr->$trimcostid->$gms->$art->req_qty->$poId/$consbreckdownarr[13])*$consbreckdownarr[8];
							$order_qty=$jsonarr->$trimcostid->$gms->$art->order_quantity->$poId;
							$colorSizeTableId=$jsonarr->$trimcostid->$gms->$art->color_size_table_id->$poId;
						}
						if(str_replace("'","",$$cbocolorsizesensitive)==4){
							$bQty=($jsonarr->$trimcostid->$gmc->$gms->$art->$itemcolor->$itemsize->req_qty->$poId/$consbreckdownarr[13])*$consbreckdownarr[6];
							$bwqQty=($jsonarr->$trimcostid->$gmc->$gms->$art->$itemcolor->$itemsize->req_qty->$poId/$consbreckdownarr[13])*$consbreckdownarr[8];
							$order_qty=$jsonarr->$trimcostid->$gmc->$gms->$art->$itemcolor->$itemsize->order_quantity->$poId;
							$colorSizeTableId=$jsonarr->$trimcostid->$gmc->$gms->$art->$itemcolor->$itemsize->color_size_table_id->$poId;
						}
						if(str_replace("'","",$$cbocolorsizesensitive)==0){
							$bQty=($jsonarr->$trimcostid->req_qty->$poId/$consbreckdownarr[13])*$consbreckdownarr[6];
							$bwqQty=($jsonarr->$trimcostid->req_qty->$poId/$consbreckdownarr[13])*$consbreckdownarr[8];
							$order_qty=$jsonarr->$trimcostid->order_quantity->$poId;
							$colorSizeTableId=$jsonarr->$trimcostid->color_size_table_id->$poId;
						}
						$consbreckdownarr[9]=number_format($consbreckdownarr[9],8,'.','');
						$bamount=$bwqQty*$consbreckdownarr[9];
						if ($d!=0){
							$data_array2 .=",";
						}
						$bQty=number_format($bQty,8,'.','');
						$bwqQty=number_format($bwqQty,8,'.','');
						
						$data_array2 ="(".$id1.",".$id_dtls.",".$txt_booking_no.",".$booking_mst_id.",".$$txtjob_id.",".$poId.",'".$consbreckdownarr[0]."','".$consbreckdownarr[1]."','".$consbreckdownarr[2]."','".trim($consbreckdownarr[3])."','".$color_id."','".$consbreckdownarr[5]."','".$bQty."','".$consbreckdownarr[7]."','".$bwqQty."','".$consbreckdownarr[9]."','".$bamount."','".$order_qty."','".$colorSizeTableId."','".$consbreckdownarr[14]."','".$consbreckdownarr[15]."','".$consbreckdownarr[16]."')";
						$id1=$id1+1;
						$add_comma++;
						$d++;
						$rID2=sql_insert("wo_trim_book_con_dtls",$field_array2,$data_array2,0);
					}
				}//CONS break down end==============================================================================================
				$id_dtls=$id_dtls+1;
			}
		}
		$flag=1;
		$is_received_id=return_field_value( "id", "subcon_ord_mst","order_no=$txt_booking_no and order_id is not null and entry_form=255 and status_active=1 and is_deleted=0");
		//echo "10** select id from subcon_ord_mst where order_no=$txt_booking_no and order_id is not null and entry_form=255".$is_received_id; die;
		if($is_received_id!='')
		{
			$field_array_rec_up="is_apply_last_update*updated_by*update_date";
			$data_array_rec_up ="2*".$_SESSION['logic_erp']['user_id']."*'".$pc_date_time."'";
			$rID_rec=sql_update("subcon_ord_mst",$field_array_rec_up,$data_array_rec_up,"id","".$is_received_id."",0);
			if($rID_rec) $flag=1; else $flag=0;
		}
		check_table_status( $_SESSION['menu_id'],0);
		if($db_type==0)
		{
			if($rID1 && $rID2 && $flag){
				mysql_query("COMMIT");
				echo "0**".$new_booking_no[0];
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**".$new_booking_no[0];
			}
		}
		else if($db_type==2 || $db_type==1 )
		{
			if($rID1 && $rID2 && $flag){
				oci_commit($con);
				echo "0**".$new_booking_no[0];
			}
			else{
				oci_rollback($con);
				echo "10**".$new_booking_no[0];
			}
		}
		disconnect($con);
		die;
	}
	else if ($operation==1)
	{
		$curr_book_amount_job_level=array();
		$curr_book_amount_job_item_level=array();
		$jobArr=array(); $poArr=array(); $pre_trim_id_arr=array(); $des_arr=array(); $brand_arr=array(); $booking_dtls_id_arr=array();

		for ($i=1;$i<=$total_row;$i++){
			$txttrimcostid="txttrimcostid_".$i;
			$txtReqAmt="txtReqAmt_".$i;
			$txtpoid="txtpoid_".$i;
			$txttrimgroup="txttrimgroup_".$i;
			$txtwoq="txtwoq_".$i;
			$txtexchrate="txtexchrate_".$i;
			$txtrate="txtrate_".$i;
			$txtamount="txtamount_".$i;
			$txtbookingid="txtbookingid_".$i;
			$txtjob_id="txtjob_".$i;
			$txtreqqnty="txtreqqnty_".$i;
			$txtdesc="txtdesc_".$i;
		    $txtbrandsup="txtbrandsup_".$i;
			$txtreqamount="txtreqamount_".$i;
			$txtremarks="txtremarks_".$i;
			$txtremark="txtremark_".$i;
			$txtreqamountjoblevelconsuom="txtreqamountjoblevelconsuom_".$i;
			$txtreqamountitemlevelconsuom="txtreqamountitemlevelconsuom_".$i;
			$JoBc=$$txtjob_id;
			$condition= new condition();

			if(str_replace("'","",$$txtjob_id) !=''){
				$condition->job_no("=$JoBc");

			}

			$condition->init();
			$trims= new trims($condition);
			//$req_qty_arr=$trims->getQtyArray_by_orderAndPrecostdtlsid();
			//$req_amount_arr=$trims->getAmountArray_by_orderAndPrecostdtlsid();

			$reqQtyItemLevelArr=$trims->getQtyArray_by_precostdtlsid();
			$reqAmountItemLevelArr=$trims->getAmountArray_precostdtlsid();

			$reqAmountJobLevelArr=$trims->getAmountArray_by_job();

			$pretrimcostid=str_replace("'","",$$txttrimcostid);
			$poid=str_replace("'","",$$txtpoid);
			$bookingdtlsid=str_replace("'","",$$txtbookingid);
			$trims_del_qty=$delivery_qty_arr[$bookingdtlsid]['delevery_qty'];
			if($trims_del_qty>0)
			{
				if( str_replace("'","",$$txtreqqnty) <= $trims_del_qty)
				{
					$trims_del_no=$delivery_qty_arr[$bookingdtlsid]['trims_del'];
					$trims_del_no=implode(", ",array_unique(explode(",",chop($trims_del_no,','))));
					echo "delQtyExeed**".$trims_del_no;
					 disconnect($con);die;
				}
			}

			$conversion_factor=$sql_lib_item_group_array[str_replace("'","",$$txttrimgroup)]['conversion_factor'];

			$curr_book_qty_job_item_level[str_replace("'","",$$txtjob_id)][$pretrimcostid]['req_qty']+=$reqQtyItemLevelArr[$pretrimcostid];
			$curr_book_qty_job_item_level[str_replace("'","",$$txtjob_id)][$pretrimcostid]['cur_qty']+=(str_replace("'","",$$txtreqqnty)*$conversion_factor);
			$curr_book_qty_job_item_level[str_replace("'","",$$txtjob_id)][$pretrimcostid]['prev_qty']=0;


			$curr_book_amount_job_level[str_replace("'","",$$txtjob_id)]['req_amount']=$reqAmountJobLevelArr[str_replace("'","",$$txtjob_id)];
			$curr_book_amount_job_level[str_replace("'","",$$txtjob_id)]['cur_amount']+=(str_replace("'","",$$txtamount)/str_replace("'","",$$txtexchrate));
			$curr_book_amount_job_level[str_replace("'","",$$txtjob_id)]['prev_amount']=0;

			$curr_book_amount_job_item_level[str_replace("'","",$$txtjob_id)][$pretrimcostid]['req_amount']+=$reqAmountItemLevelArr[$pretrimcostid];
			$curr_book_amount_job_item_level[str_replace("'","",$$txtjob_id)][$pretrimcostid]['cur_amount']+=(str_replace("'","",$$txtamount)/str_replace("'","",$$txtexchrate));
			$curr_book_amount_job_item_level[str_replace("'","",$$txtjob_id)][$pretrimcostid]['prev_amount']=0;

			$jobArr[$$txtjob_id]=$$txtjob_id;
			$poArr[$poid]=$poid;
			$pre_trim_id_arr[$pretrimcostid]=$pretrimcostid;
			$des_arr[$$txtdesc]=$$txtdesc;
			$brand_arr[$$txtbrandsup]=$$txtbrandsup;
			$booking_dtls_id_arr[$bookingdtlsid]=$bookingdtlsid;
		}
		 
		$sql_subcon_trim=sql_select("select b.job_no_mst,a.order_no,b.booking_dtls_id,b.booked_qty,b.item_group from subcon_ord_mst a,subcon_ord_dtls b where a.subcon_job=b.job_no_mst and a.order_no=$txt_booking_no and a.order_id is not null and a.entry_form=255 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 ");
		foreach($sql_subcon_trim as $row)
		{
			$trims_recQtyArr[$row[csf('booking_dtls_id')]]['booked_qty']=$row[csf('booked_qty')];
			$trims_recNoArr[$row[csf('booking_dtls_id')]]=$row[csf('job_no_mst')];
		}
 
		$prev_book_amount_job_level=array();
		$prev_book_amount_job_item_level=array();
		//$sql=sql_select("select id, job_no, pre_cost_fabric_cost_dtls_id, trim_group, wo_qnty, amount, exchange_rate from wo_booking_dtls where job_no in(".implode(",",$jobArr).") and booking_type=2 and is_short=2 and status_active=1 and is_deleted=0"); //and booking_no !=$txt_booking_no
		$sql=sql_select("select b.id, b.job_no, b.pre_cost_fabric_cost_dtls_id, b.trim_group, b.wo_qnty, b.amount, b.exchange_rate from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no and b.job_no in(".implode(",",$jobArr).") and b.booking_type=2 and b.is_short=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and  b.exchange_rate>0");
		foreach($sql as $row){
			$curr_book_amount_job_level[$row[csf('job_no')]]['prev_amount']+=($row[csf('amount')]/$row[csf('exchange_rate')]);

			$prev_book_amount_job_level[$row[csf('id')]]['prev_amount']=($row[csf('amount')]/$row[csf('exchange_rate')]);
			$prev_book_amount_job_level[$row[csf('id')]]['prev_qty']=($row[csf('wo_qnty')]*$sql_lib_item_group_array[$row[csf('trim_group')]]['conversion_factor']);

			$curr_book_amount_job_item_level[$row[csf('job_no')]][$row[csf('pre_cost_fabric_cost_dtls_id')]]['prev_amount']+=($row[csf('amount')]/$row[csf('exchange_rate')]);

			$curr_book_qty_job_item_level[$row[csf('job_no')]][$row[csf('pre_cost_fabric_cost_dtls_id')]]['prev_qty']+=($row[csf('wo_qnty')]*$sql_lib_item_group_array[$row[csf('trim_group')]]['conversion_factor']);

		}

		$con = connect();
		if($db_type==0){
			mysql_query("BEGIN");
		}
		if  ( check_table_status( $_SESSION['menu_id'], 1 )==0 ){
			echo "15**1";
			 disconnect($con);die;
		}

		if(str_replace("'","",implode(",",$des_arr))!="") $des_data_cond="and description in(".implode(",",$des_arr).")"; else $des_data_cond="";
		if(str_replace("'","",implode(",",$brand_arr))!="") $brand_data_cond="and brand_supplier in(".implode(",",$brand_arr).")"; else $brand_data_cond="";
		if (is_duplicate_field( "booking_no", "wo_booking_dtls", "job_no in(".implode(",",$jobArr).") and po_break_down_id in (".implode(",",$poArr).") and pre_cost_fabric_cost_dtls_id in(".implode(",",$pre_trim_id_arr).") and id not in(".implode(",",$booking_dtls_id_arr).") and booking_type=2 and is_short=2 and booking_no=$txt_booking_no and status_active=1 and is_deleted=0 $des_data_cond $brand_data_cond") == 1)
		{
			check_table_status( $_SESSION['menu_id'],0);
			echo "11**0";
			disconnect($con);die;
		}
		$field_array_up1="pre_cost_fabric_cost_dtls_id*pre_req_amt*po_break_down_id*job_no*trim_group*description*brand_supplier*uom*sensitivity*wo_qnty*exchange_rate*rate*amount*delivery_date*country_id_string*hs_code*remark*updated_by*update_date";
		$field_array_up2="id,wo_trim_booking_dtls_id,booking_no,booking_mst_id,job_no,po_break_down_id,color_number_id,gmts_sizes,description,brand_supplier,item_color,item_size,cons, process_loss_percent,requirment,rate,amount,pcs,color_size_table_id,article_number,item_ref,remarks";
		$add_comma=0;
		$id1=return_next_id( "id", "wo_trim_book_con_dtls", 1);
		$new_array_color=array();
		
		for ($i=1;$i<=$total_row;$i++){
			$txttrimcostid="txttrimcostid_".$i;
			$txtReqAmt="txtReqAmt_".$i;
			$txtpoid="txtpoid_".$i;
			$txttrimgroup="txttrimgroup_".$i;
			$txtuom="txtuom_".$i;
			$cbocolorsizesensitive="cbocolorsizesensitive_".$i;
			$txtwoq="txtwoq_".$i;
			$txtexchrate="txtexchrate_".$i;
			$txtrate="txtrate_".$i;
			$txtamount="txtamount_".$i;
			$txtddate="txtddate_".$i;
			$consbreckdown="consbreckdown_".$i;
			$txtbookingid="txtbookingid_".$i;
			$txtcountry="txtcountry_".$i;
			$txtjob_id="txtjob_".$i;
			$txtreqqnty="txtreqqnty_".$i;
			$jsondata="jsondata_".$i;
			$txtdesc="txtdesc_".$i;
			$txthscode="txthscode_".$i;
		    $txtbrandsup="txtbrandsup_".$i;
			$txtreqamount="txtreqamount_".$i;
			$txtremarks="txtremarks_".$i;
			$txtremark="txtremark_".$i;
			$txtreqamountjoblevelconsuom="txtreqamountjoblevelconsuom_".$i;
			$txtreqamountitemlevelconsuom="txtreqamountitemlevelconsuom_".$i;
			$jsonarr=json_decode(str_replace("'","",$$jsondata));
			$poid=str_replace("'","",$$txtpoid);

			$pi_number=array();
			$piquantity=0;
			$sqlPi=sql_select("select a.pi_number, b.quantity from  com_pi_master_details a, com_pi_item_details b where a.id=b.pi_id  and b.work_order_no=$txt_booking_no and b.item_group=".$$txttrimgroup." and b.order_id in($poid) and a.item_category_id=4 and a.status_active=1 and  a.is_deleted=0  and b.status_active=1 and  b.is_deleted=0");
			foreach($sqlPi as $rowPi){
				$pi_number[$rowPi[csf('pi_number')]]=$rowPi[csf('pi_number')];
				$piquantity+=$rowPi[csf('quantity')];
			}
			
				$ex_book_dtls_id=explode(",",str_replace("'",'',$$txtbookingid));
				$order_trim_recv_qty=0;
				foreach($ex_book_dtls_id as $book_dtls_id)
				{
					$order_trim_recv_qty+=$trims_recQtyArr[$book_dtls_id]['booked_qty'];
					$trims_recNoCheckArr[$book_dtls_id]=$trims_recNoArr[$book_dtls_id];
				}
				
			if($order_trim_recv_qty && str_replace("'","",$$txtwoq) < $order_trim_recv_qty){
				echo "orderFound**".str_replace("'","",$txt_booking_no)."**".implode(",",$trims_recNoCheckArr)."**".$order_trim_recv_qty;
				check_table_status( $_SESSION['menu_id'],0);
				 disconnect($con);die;
			}
			
			if($piquantity && str_replace("'","",$$txtwoq) < $piquantity){
				echo "pi1**".str_replace("'","",$txt_booking_no)."**".implode(",",$pi_number)."**".$piquantity;
				check_table_status( $_SESSION['menu_id'],0);
				 disconnect($con);die;
			}

			$recv_number=array();
			$recvquantity=0;
			if(str_replace("'","",$$txtdesc)=="" || str_replace("'","",$$txtdesc)==0) $desc_con=""; else $desc_con=" and b.item_description=".$$txtdesc." ";
			if(str_replace("'","",$$txtpoid)=="" || str_replace("'","",$$txtpoid)==0) $poid_con=""; else $poid_con=" and c.po_breakdown_id in (".str_replace("'","",$$txtpoid).") ";
			$sqlRecv=sql_select("select a.recv_number, c.quantity as receive_qnty from  inv_receive_master a,inv_trims_entry_dtls b, order_wise_pro_details c where a.id=b.mst_id and b.id=c.dtls_id and c.trans_type=1 and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and b.item_group_id=".$$txttrimgroup." and c.po_breakdown_id in($poid) and a.item_category=4 and a.status_active=1 and a.is_deleted=0  and b.status_active=1 and b.is_deleted=0 $desc_con $poid_con");
			foreach($sqlRecv as $rowRecv){
				$recv_number[$rowRecv[csf('recv_number')]]=$rowRecv[csf('recv_number')];
				$recvquantity+=$rowRecv[csf('receive_qnty')];
			}
			if($recvquantity>0)
			{
				if($recvquantity>0 && $recvquantity<=str_replace("'","",$$txtwoq))
				{
					check_table_status( $_SESSION['menu_id'],0);
				}
				else
				{
					echo "recv1**".str_replace("'","",$txt_booking_no)."**".implode(",",$recv_number)."**".$recvquantity;
					check_table_status( $_SESSION['menu_id'],0);
					 disconnect($con);die;
				}
			}
			$job=str_replace("'","",$$txtjob_id);
			$trimcostid=str_replace("'","",$$txttrimcostid);
			$reqqnty=str_replace("'","",$$txtreqqnty);
			$woq=str_replace("'","",$$txtwoq);
			$rate=str_replace("'","",$$txtrate);

			$amt=str_replace("'","",$$txtamount);
			$exRate=str_replace("'","",$$txtexchrate);

			$uom_id=str_replace("'","",$$txtuom);
			$conversion_factor=$sql_lib_item_group_array[str_replace("'","",$$txttrimgroup)]['conversion_factor'];


			//==============================
			if($amount_exceed_level==1){
				$reqAmt=(($curr_book_amount_job_level[$job]['req_amount']*$exeed_budge_amount)/100)+$curr_book_amount_job_level[$job]['req_amount'];

				$pre_amt=0;
				$ex_book_dtls_id=explode(",",str_replace("'",'',$$txtbookingid));
				foreach($ex_book_dtls_id as $book_dtls_id)
				{
					$pre_amt+=$prev_book_amount_job_level[$book_dtls_id]['prev_amount'];
				}
				$curAmt=($curr_book_amount_job_level[$job]['prev_amount']-$pre_amt)+($amt/$exRate);
				check_table_status( $_SESSION['menu_id'],0);
				//echo $curAmt.'='.$reqAmt.'='.$curr_book_amount_job_level[$job]['prev_amount'].'='.$pre_amt.'='.($amt/$exRate).'='.str_replace("'",'',$$txtbookingid); die;
				if($curAmt>$reqAmt){
					echo "vad1**".str_replace("'","",$txt_booking_no)."**".$i;
					check_table_status( $_SESSION['menu_id'],0);
					 disconnect($con);die;
				}
				$curr_book_amount_job_level[$job]['prev_amount']+=($amt/$exRate);
			}
			if($amount_exceed_level==2){
				$reqAmt=(($curr_book_amount_job_item_level[$job][$trimcostid]['req_amount']*$exeed_budge_amount)/100)+$curr_book_amount_job_item_level[$job][$trimcostid]['req_amount'];
				$pre_amt=0;
				$ex_book_dtls_id=explode(",",str_replace("'",'',$$txtbookingid));
				foreach($ex_book_dtls_id as $book_dtls_id)
				{
					$pre_amt+=$prev_book_amount_job_level[$book_dtls_id]['prev_amount'];
				}
				$curAmt=($curr_book_amount_job_item_level[$job][$trimcostid]['prev_amount']-$pre_amt)+($amt/$exRate);
				if($curAmt>$reqAmt){
					echo "vad1**".str_replace("'","",$txt_booking_no)."**".$i."**".$curAmt."**".$reqAmt."**".$curr_book_amount_job_item_level[$job][$trimcostid]['req_amount'];
					check_table_status( $_SESSION['menu_id'],0);
					 disconnect($con);die;
				}
				$curr_book_amount_job_item_level[$job][$trimcostid]['prev_amount']+=($amt/$exRate);
			}

			if($exceed_qty_level==2){
				$reqQty=(($curr_book_qty_job_item_level[$job][$trimcostid]['req_qty']*$exeed_budge_qty)/100)+$curr_book_qty_job_item_level[$job][$trimcostid]['req_qty'];
				//$curQty=$curr_book_qty_job_item_level[$job][$trimcostid]['prev_qty']+($woq*$conversion_factor);
				$pre_qty=0;
				$ex_book_dtls_id=explode(",",str_replace("'",'',$$txtbookingid));
				foreach($ex_book_dtls_id as $book_dtls_id)
				{
					$pre_qty+=$prev_book_amount_job_level[$book_dtls_id]['prev_qty'];
				}
				$curQty=($curr_book_qty_job_item_level[$job][$trimcostid]['prev_qty']-$pre_qty)+($woq*$conversion_factor);
				if(($curQty-$reqQty)>1){
					echo "vad2**".str_replace("'","",$txt_booking_no)."**".$i."**".$curQty."**".$reqQty."**".$curr_book_amount_job_item_level[$job][$trimcostid]['req_qty'];
					check_table_status( $_SESSION['menu_id'],0);
					 disconnect($con);die;
				}
				$curr_book_qty_job_item_level[$job][$trimcostid]['prev_qty']+=($woq*$conversion_factor);
			}
			//===========================

			if(str_replace("'",'',$$txtbookingid)!=""){
				$powise_rounddown=array();
				foreach($strdata->$job->$trimcostid->po_id as $poId){
					$wqQty=($strdata->$job->$trimcostid->req_qnty->$poId/$reqqnty)*$woq;
					$po_wise_wqqty[$poId]= $wqQty;
				}
				
				$rd=0;
				foreach($po_wise_wqqty as $poid=>$qty){
					$rd++;
					$powise_rounddown[$poid]=floor($qty);
					if(count($po_wise_wqqty)!=$rd){
						$remainning_qty+=$qty-floor($qty);
					}               
					if(count($po_wise_wqqty)==$rd){
						$powise_rounddown[$poid]=$qty+$remainning_qty;
					}
				}
				foreach($strdata->$job->$trimcostid->po_id as $poId){
					//$wqQty=($strdata->$job->$trimcostid->req_qnty->$poId/$reqqnty)*$woq;
					//$wqQty=number_format($wqQty,4,'.','');
					$reqqtycostingper=$strdata->$job->$trimcostid->reqqtycostingper->$poId;
					$wqQty=$powise_rounddown[$poId];
					$amount=$wqQty*$rate;
					$id_arr=array();
					$data_array_up1=array();
					$id_arr[]=str_replace("'",'',$strdata->$job->$trimcostid->booking_id->$poId);
					$data_array_up1[str_replace("'",'',$strdata->$job->$trimcostid->booking_id->$poId)] =explode("*",("".$$txttrimcostid."*'".$reqqtycostingper."'*".$poId."*".$$txtjob_id."*".$$txttrimgroup."*".$$txtdesc."*".trim($$txtbrandsup)."*".$$txtuom."*".$$cbocolorsizesensitive."*".$wqQty."*".$$txtexchrate."*".$$txtrate."*".$amount."*".$$txtddate."*".$$txtcountry."*".$$txthscode."*".$$txtremark."*".$_SESSION['logic_erp']['user_id']."*'".$pc_date_time."'"));
					if($data_array_up1 !=""){
						$rID1=execute_query(bulk_update_sql_statement( "wo_booking_dtls", "id", $field_array_up1, $data_array_up1, $id_arr ));
					}
					//	CONS break down===============================================================================================
					$rID2=1;
					if(str_replace("'",'',$$consbreckdown) !=''){
						$rID_de1=execute_query( "delete from wo_trim_book_con_dtls where  wo_trim_booking_dtls_id =".$strdata->$job->$trimcostid->booking_id->$poId."",0);
						$consbreckdown_array=explode('__',str_replace("'",'',$$consbreckdown));
						$d=0;
						for($c=0;$c < count($consbreckdown_array);$c++){
							$consbreckdownarr=explode('_',$consbreckdown_array[$c]);
							 $consbreckdownarr[4]=trim(str_replace("'",'',$consbreckdownarr[4]));
							 if(str_replace("'","",$consbreckdownarr[4])=='0') $consbreckdownarr[4]='';
							if(str_replace("'",'',$consbreckdownarr[4]) !='')
							{
								if (!in_array(str_replace("'","",$consbreckdownarr[4]),$new_array_color, TRUE)){
									$color_id = return_id( str_replace("'","",$consbreckdownarr[4]), $color_library, "lib_color", "id,color_name","87");
									$new_array_color[$color_id]=str_replace("'","",$consbreckdownarr[4]);
								}
								else $color_id =  array_search(str_replace("'","",$consbreckdownarr[4]), $new_array_color);
							}
							else $color_id =0;
							$gmc=$consbreckdownarr[0];
							$gms=$consbreckdownarr[1];
							$art=$consbreckdownarr[14];
							$itemcolor=$color_id;
							$itemsize=str_replace("'", "", $consbreckdownarr[5]);

							if(str_replace("'","",$$cbocolorsizesensitive)==1 || str_replace("'","",$$cbocolorsizesensitive)==3){
								
								$bQty=($jsonarr->$trimcostid->$gmc->req_qty->$poId/$consbreckdownarr[13])*$consbreckdownarr[6];
								$bwqQty=($jsonarr->$trimcostid->$gmc->req_qty->$poId/$consbreckdownarr[13])*$consbreckdownarr[8];
								$order_qty=$jsonarr->$trimcostid->$gmc->order_quantity->$poId;
								$colorSizeTableId=$jsonarr->$trimcostid->$gmc->color_size_table_id->$poId;
								 //echo "10**=".$jsonarr->$trimcostid->$gmc->req_qty->$poId.'='.$consbreckdownarr[13].'='.$consbreckdownarr[8].', ';
								 
							}
							if(str_replace("'","",$$cbocolorsizesensitive)==2){
								$bQty=($jsonarr->$trimcostid->$gms->$art->req_qty->$poId/$consbreckdownarr[13])*$consbreckdownarr[6];
								$bwqQty=($jsonarr->$trimcostid->$gms->$art->req_qty->$poId/$consbreckdownarr[13])*$consbreckdownarr[8];
								$order_qty=$jsonarr->$trimcostid->$gms->$art->order_quantity->$poId;
								$colorSizeTableId=$jsonarr->$trimcostid->$gms->$art->color_size_table_id->$poId;
							}
							if(str_replace("'","",$$cbocolorsizesensitive)==4){
								$bQty=($jsonarr->$trimcostid->$gmc->$gms->$art->$itemcolor->$itemsize->req_qty->$poId/$consbreckdownarr[13])*$consbreckdownarr[6];
								$bwqQty=($jsonarr->$trimcostid->$gmc->$gms->$art->$itemcolor->$itemsize->req_qty->$poId/$consbreckdownarr[13])*$consbreckdownarr[8];
								$order_qty=$jsonarr->$trimcostid->$gmc->$gms->$art->$itemcolor->$itemsize->order_quantity->$poId;
								$colorSizeTableId=$jsonarr->$trimcostid->$gmc->$gms->$art->$itemcolor->$itemsize->color_size_table_id->$poId;
							}
							if(str_replace("'","",$$cbocolorsizesensitive)==0){
								$bQty=($jsonarr->$trimcostid->req_qty->$poId/$consbreckdownarr[13])*$consbreckdownarr[6];
								$bwqQty=($jsonarr->$trimcostid->req_qty->$poId/$consbreckdownarr[13])*$consbreckdownarr[8];
								$order_qty=$jsonarr->$trimcostid->order_quantity->$poId;
								$colorSizeTableId=$jsonarr->$trimcostid->color_size_table_id->$poId;
							}
							$consbreckdownarr[9]=number_format($consbreckdownarr[9],8,'.','');
							$bamount=$bwqQty*$consbreckdownarr[9];
							$bwqQty=number_format($bwqQty,8,'.','');
							$bQty=number_format($bQty,8,'.','');
							if ($d!=0) $data_array2 .=",";
							$data_array2 ="(".$id1.",".$strdata->$job->$trimcostid->booking_id->$poId.",".$txt_booking_no.",".$booking_mst_id.",".$$txtjob_id.",".$poId.",'".$consbreckdownarr[0]."','".$consbreckdownarr[1]."','".$consbreckdownarr[2]."','".trim($consbreckdownarr[3])."','".$color_id."','".$consbreckdownarr[5]."','".$bQty."','".$consbreckdownarr[7]."','".$bwqQty."','".$consbreckdownarr[9]."','".$bamount."','".$order_qty."','".$colorSizeTableId."','".$consbreckdownarr[14]."','".$consbreckdownarr[15]."','".$consbreckdownarr[16]."')";
							$id1=$id1+1;
							$add_comma++;
							$d++;
							$rID2=sql_insert("wo_trim_book_con_dtls",$field_array_up2,$data_array2,0);
						}
					}//CONS break down end==============================================================================================
				}
			}
		}
		//check_table_status( $_SESSION['menu_id'],0);die;
		$flag=1;
		$is_received_id=return_field_value( "id", "subcon_ord_mst","order_no=$txt_booking_no and order_id is not null and entry_form=255 and status_active=1 and is_deleted=0");
		if($is_received_id!='')
		{
			$field_array_rec_up="is_apply_last_update*updated_by*update_date";
			$data_array_rec_up ="2*".$_SESSION['logic_erp']['user_id']."*'".$pc_date_time."'";
			$rID_rec=sql_update("subcon_ord_mst",$field_array_rec_up,$data_array_rec_up,"id","".$is_received_id."",0);
			if($rID_rec) $flag=1; else $flag=0;
		}
		$rID=execute_query( "update wo_booking_mst set revised_no=revised_no+1 where  booking_no=$txt_booking_no",0);
		//echo "10**".$rID1."**".$rID2."**".$flag;
		check_table_status( $_SESSION['menu_id'],0);
		if($db_type==0){
			if($rID1 && $rID2 && $flag){
				mysql_query("COMMIT");
				echo "1**".str_replace("'","",$txt_booking_no);
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**".str_replace("'","",$txt_booking_no);
			}
		}
		else if($db_type==2 || $db_type==1 ){
			if($rID1 && $rID2 && $flag){
				oci_commit($con);
				echo "1**".str_replace("'","",$txt_booking_no);
			}
			else{
				oci_rollback($con);
				echo "10**".str_replace("'","",$txt_booking_no);
			}
		}
		disconnect($con);
		die;
	}
	else if ($operation==2){
		$con = connect();
		if($db_type==0){
			mysql_query("BEGIN");
		}
		for ($i=1;$i<=$total_row;$i++){
			$txttrimcostid="txttrimcostid_".$i;
			$txttrimgroup="txttrimgroup_".$i;
			$txtpoid="txtpoid_".$i;
			$txtbookingid="txtbookingid_".$i;
			$txtdesc="txtdesc_".$i;
			$txtreqqnty="txtreqqnty_".$i;

			//if(str_replace("'","",$cbo_pay_mode)==2){
			$pi_number=return_field_value( "pi_number", "com_pi_master_details a,com_pi_item_details b"," a.id=b.pi_id  and b.work_order_no=$txt_booking_no and b.item_group=".$$txttrimgroup."  and a.item_category_id=4 and a.status_active=1 and  a.is_deleted=0  and b.status_active=1 and  b.is_deleted=0");
			    if($pi_number){
				    echo "pi1**".str_replace("'","",$txt_booking_no)."**".$pi_number."**0";
				   disconnect($con);  die;
			    }
			//}else{
				if(str_replace("'","",$$txtdesc)=="" || str_replace("'","",$$txtdesc)==0) $desc_con=""; else $desc_con=" and b.item_description=".$$txtdesc." ";
				$recv_number=return_field_value( "recv_number", "inv_receive_master a,inv_trims_entry_dtls b"," a.id=b.mst_id and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and b.item_group_id=".$$txttrimgroup." $desc_con and a.item_category=4 and a.status_active=1 and  a.is_deleted=0  and b.status_active=1 and  b.is_deleted=0");
			    if($recv_number){
				    echo "recv1**".str_replace("'","",$txt_booking_no)."**".$recv_number."**0";
				    disconnect($con); die;
			    }
			//}

			$bookingdtlsid=str_replace("'","",$$txtbookingid);
			$subcon_job=return_field_value( "subcon_job", "subcon_ord_mst a, subcon_ord_dtls b"," a.entry_form=255 and a.subcon_job=b.job_no_mst and a.id=b.mst_id and b.booking_dtls_id in ($bookingdtlsid) and a.status_active=1 and b.status_active=1");
		    if(!empty($subcon_job)){
			     echo "orderFound**".$subcon_job."**SELECT subcon_job from subcon_ord_mst a, subcon_ord_dtls b where a.entry_form=255 and a.subcon_job=b.job_no_mst and a.id=b.mst_id and b.booking_dtls_id in ($bookingdtlsid) and a.status_active=1 and b.status_active=1";
			     oci_rollback($con);
			     disconnect($con);die;
		    }
		    
			$trims_del_qty=$delivery_qty_arr[$bookingdtlsid]['delevery_qty'];
			if($trims_del_qty>0)
			{
				if( str_replace("'","",$$txtreqqnty) <= $trims_del_qty)
				{
					$trims_del_no=$delivery_qty_arr[$bookingdtlsid]['trims_del'];
					$trims_del_no=implode(", ",array_unique(explode(",",chop($trims_del_no,','))));
					echo "delQtyExeed**".$trims_del_no;
					 disconnect($con);die;
				}
			}
			$delete_cause=str_replace("'","",$delete_cause);
			$delete_cause=str_replace('"','',$delete_cause);
			$delete_cause=str_replace('(','',$delete_cause);
			$delete_cause=str_replace(')','',$delete_cause);
			//$rID1=execute_query( "delete from wo_booking_dtls where  id in (".str_replace("'","",$$txtbookingid).")",0);
			//$rID2=execute_query( "delete from wo_trim_book_con_dtls where  wo_trim_booking_dtls_id in(".str_replace("'","",$$txtbookingid).")",0);
			$rID1=execute_query( "update wo_booking_dtls set status_active=0,is_deleted=1,delete_cause='$delete_cause',updated_by=".$_SESSION['logic_erp']['user_id'].", update_date='".$pc_date_time."'   where  id in (".str_replace("'","",$$txtbookingid).") and booking_no=$txt_booking_no",0);
		    $rID2=execute_query( "update wo_trim_book_con_dtls set status_active=0,is_deleted=1 where  wo_trim_booking_dtls_id in(".str_replace("'","",$$txtbookingid).") and booking_no=$txt_booking_no",0);
		}
		$flag=1;
		$is_received_id=return_field_value( "id", "subcon_ord_mst","order_no=$txt_booking_no and order_id is not null and entry_form=255 and status_active=1 and is_deleted=0");
		if($is_received_id!='')
		{
			$field_array_rec_up="is_apply_last_update*updated_by*update_date";
			$data_array_rec_up ="2*".$_SESSION['logic_erp']['user_id']."*'".$pc_date_time."'";
			$rID_rec=sql_update("subcon_ord_mst",$field_array_rec_up,$data_array_rec_up,"id","".$is_received_id."",0);
			if($rID_rec) $flag=1; else $flag=0;
		}

		if($db_type==0){
			if($rID1 &&  $rID2 && $flag){
				mysql_query("COMMIT");
				echo "2**".str_replace("'","",$txt_booking_no);
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**".str_replace("'","",$txt_booking_no);
			}
		}

		if($db_type==2 || $db_type==1 ){
			if($rID1 &&  $rID2 && $flag){
				oci_commit($con);
				echo "2**".str_replace("'","",$txt_booking_no);
			}
			else{
				oci_rollback($con);
				echo "10**".str_replace("'","",$txt_booking_no);

			}
		}
		disconnect($con);
		die;
	}
}

if ($action=="trims_booking_popup")
{
	echo load_html_head_contents("Booking Search","../../../", 1, 1, $unicode);
	extract($_REQUEST);
	//extract(check_magic_quote_gpc($_REQUEST));

	?>
	<script>
		function set_checkvalue(){
				if(document.getElementById('chk_job_wo_po').value==0) document.getElementById('chk_job_wo_po').value=1;
				else document.getElementById('chk_job_wo_po').value=0;
		}
		function js_set_value( str_data ){
			document.getElementById('txt_booking').value=str_data;
			parent.emailwindow.hide();
		}
	</script>
	</head>
    <body>
        <div align="center" style="width:1030px;" >
        <input type="hidden" id="txt_booking" value="" />
            <form name="searchorderfrm_1"  id="searchorderfrm_1" autocomplete="off">
            <table width="1030" cellspacing="0" cellpadding="0" border="1" class="rpt_table" align="center" rules="all">
                <thead>
                    <tr>
                        <th colspan="11" align="center"><? echo create_drop_down( "cbo_search_category", 130, $string_search_type,'', 1, "-- Search Catagory --" ); ?></th>
                    </tr>
                    <tr>
                        <th width="140" class="must_entry_caption">Company Name</th>
                        <th width="130" class="must_entry_caption">Buyer Name</th>
                        <th width="90">Style Ref </th>
                        <th width="70">Job No </th>
                        <th width="70">Internal Ref.</th>
                        <th width="80">Order No</th>
                        <th width="130">Supplier Name</th>
                        <th width="70">Booking No</th>
                        <th colspan="2" width="130"> Booking Date Range</th>
                        <th><input type="checkbox" value="0" onClick="set_checkvalue()" id="chk_job_wo_po">WO Without PO</th>
                    </tr>
                </thead>
                <tr class="general">
                    <td><? 

					echo create_drop_down( "cbo_company_mst", 150, "select id,company_name from lib_company comp where status_active=1 and is_deleted=0 and core_business not in(3) $company_cond order by company_name","id,company_name",1, "-- Select Company --", $company_id, "load_drop_down( 'trims_booking_multi_job_controllerurmi', this.value, 'load_drop_down_buyer_pop', 'buyer_td' );"); ?></td>
                    <td width="155" id="buyer_td"><?=create_drop_down( "cbo_buyer_name", 140, "select id,buyer_name from lib_buyer where status_active =1 and is_deleted=0 order by buyer_name","id,buyer_name", 1, "-- Select Buyer --", "", "",0,"" ); ?></td>
                    <td><input name="txt_style" id="txt_style" class="text_boxes" style="width:80px"></td>
                    <td><input name="txt_job" id="txt_job" class="text_boxes" style="width:60px"></td>
                     <td><input name="internal_ref" id="internal_ref" class="text_boxes" style="width:80px"></td>
                    <td><input name="txt_order_search" id="txt_order_search" class="text_boxes" style="width:80px"></td>
                    <td><? echo create_drop_down( "cbo_supplier_name", 130, "select a.id,a.supplier_name from lib_supplier a, lib_supplier_party_type b where a.id=b.supplier_id and b.party_type in(4,5) and a.status_active =1 and a.is_deleted=0 order by supplier_name","id,supplier_name", 1, "-- Select Supplier --", $selected, "",0 ); ?></td>
                    <td><input name="txt_booking_prifix" id="txt_booking_prifix" class="text_boxes" style="width:60px"></td>
                    <td>
                        <input name="txt_date_from" id="txt_date_from" class="datepicker" style="width:60px" placeholder="From Date">
                    </td>
                    <td>
                        <input name="txt_date_to" id="txt_date_to" class="datepicker" style="width:60px" placeholder="To Date">
                    </td>
                    <td align="center">
                    	<input type="button" name="button2" class="formbutton" value="Show" onClick="show_list_view ( document.getElementById('cbo_company_mst').value+'_'+document.getElementById('cbo_buyer_name').value+'_'+document.getElementById('cbo_supplier_name').value+'_'+document.getElementById('txt_date_from').value+'_'+document.getElementById('txt_date_to').value+'_'+document.getElementById('cbo_year_selection').value+'_'+document.getElementById('txt_booking_prifix').value+'_'+document.getElementById('cbo_search_category').value+'_'+document.getElementById('txt_style').value+'_'+document.getElementById('txt_order_search').value+'_'+document.getElementById('txt_job').value+'_'+document.getElementById('chk_job_wo_po').value+'_'+document.getElementById('internal_ref').value, 'create_booking_search_list_view', 'search_div', 'trims_booking_multi_job_controllerurmi','setFilterGrid(\'list_view\',-1)')" style="width:70px;" />
                    </td>
                </tr>
                <tr class="general">
                    <td align="center" valign="middle" colspan="11" >
						<?
                            //echo create_drop_down( "cbo_year_selection", 70, $year,"", 1, "-- Select --", date('Y'), "",0 );
                            echo load_month_buttons(1);
                        ?>
                    </td>
                </tr>
            </table>
            <div id="search_div"></div>
            </form>
        </div>
    </body>
    <script src="../../../includes/functions_bottom.js" type="text/javascript"></script>
    </html>
    <?
    exit();
}

if ($action=="create_booking_search_list_view")
{
	$data=explode('_',$data);
	if ($data[0]!=0) $company=" and a.company_id='$data[0]'"; else { echo "Please Select Company First."; disconnect($con); die; }
	if ($data[1]!=0){
		 $buyer=" and c.buyer_name='$data[1]'";
		 $buyer2=" and a.buyer_id='$data[1]'";
	}
	else 
	{
		$buyer=set_user_lavel_filtering(' and c.buyer_name','buyer_id');
		$buyer2=set_user_lavel_filtering(' and a.buyer_id','buyer_id');
	}
	if ($data[2]!=0) $supplier_id=" and a.supplier_id='$data[2]'"; else $supplier_id ="";
	if($db_type==0){
	$booking_year_cond=" and SUBSTRING_INDEX(a.insert_date, '-', 1)=$data[5]";
	$job_year_cond=" and SUBSTRING_INDEX(c.insert_date, '-', 1)=$data[5]";
	
		if ($data[3]!="" &&  $data[4]!="") $booking_date  = "and a.booking_date  between '".change_date_format($data[3], "yyyy-mm-dd", "-")."' and '".change_date_format($data[4], "yyyy-mm-dd", "-")."'"; else $booking_date ="";

	}
	if($db_type==2){
	$booking_year_cond=" and to_char(a.insert_date,'YYYY')=$data[5]";
	$job_year_cond=" and to_char(c.insert_date,'YYYY')=$data[5]";
		if ($data[3]!="" &&  $data[4]!="") $booking_date  = "and a.booking_date  between '".change_date_format($data[3], "yyyy-mm-dd", "-",1)."' and '".change_date_format($data[4], "yyyy-mm-dd", "-",1)."'"; else $booking_date ="";
	}

	if($data[7]==1){
		if (str_replace("'","",$data[6])!="") $booking_cond=" and a.booking_no_prefix_num ='$data[6]'   "; else $booking_cond="";
		if (trim($data[8])!="") $style_cond=" and c.style_ref_no ='$data[8]'";
		if (str_replace("'","",$data[9])!="") $order_cond=" and d.po_number = '$data[9]'  "; //else  $order_cond="";
		if (str_replace("'","",$data[10])!="") $job_cond=" and c.job_no_prefix_num = '$data[10]'  "; //else  $order_cond="";
	}
	if($data[7]==2){
		if (str_replace("'","",$data[6])!="") $booking_cond=" and a.booking_no_prefix_num like '$data[6]%'  $booking_year_cond  "; else $booking_cond="";
		if (trim($data[8])!="") $style_cond=" and c.style_ref_no like '$data[8]%'  "; //else  $style_cond="";
		if (str_replace("'","",$data[9])!="") $order_cond=" and d.po_number like '$data[9]%'  "; //else  $order_cond="";
		if (str_replace("'","",$data[10])!="") $job_cond=" and c.job_no_prefix_num like '$data[10]%'  "; //else  $order_cond="";
	}
	if($data[7]==3){
		if (str_replace("'","",$data[6])!="") $booking_cond=" and a.booking_no_prefix_num like '%$data[6]'  $booking_year_cond  "; else $booking_cond="";
		if (trim($data[8])!="") $style_cond=" and c.style_ref_no like '%$data[8]'"; //else  $style_cond="";
		if (str_replace("'","",$data[9])!="") $order_cond=" and d.po_number like '%$data[9]'  "; //else  $order_cond="";
		if (str_replace("'","",$data[10])!="") $job_cond=" and c.job_no_prefix_num like '%$data[10]'  "; //else  $order_cond="";
	}
	if($data[7]==4 || $data[7]==0){
		if (str_replace("'","",$data[6])!="") $booking_cond=" and a.booking_no_prefix_num like '%$data[6]%'  $booking_year_cond  "; else $booking_cond="";
		if (trim($data[8])!="") $style_cond=" and c.style_ref_no like '%$data[8]%'"; //else  $style_cond="";
		if (str_replace("'","",$data[9])!="") $order_cond=" and d.po_number like '%$data[9]%'  "; //else  $order_cond="";
		if (str_replace("'","",$data[10])!="") $job_cond=" and c.job_no_prefix_num like '%$data[10]%' $job_year_cond "; //else  $order_cond="";
	}
	$comp=return_library_array( "select id, company_short_name from lib_company",'id','company_short_name');
	$suplier=return_library_array( "select id, short_name from lib_supplier",'id','short_name');
	$user_arr=return_library_array("select id,user_full_name from user_passwd","id","user_full_name");

	if($data[11]==0)
	{
		$internal_ref_con='';
		if(!empty($data[12]))
		{
			$internal_ref_con=" and d.grouping like '%$data[12]%'";
		}

		$sql="SELECT a.id, a.pay_mode, a.booking_no_prefix_num, a.inserted_by, a.booking_no, a.company_id, a.supplier_id, a.booking_date, a.delivery_date, c.style_ref_no, d.po_number from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d where a.booking_no=b.booking_no and b.job_no=c.job_no and b.job_no=d.job_no_mst and c.id=d.job_id and b.po_break_down_id=d.id and a.booking_type=2 and a.entry_form=87 and a.is_short=2 and a.status_active =1 and a.is_deleted=0 and b.status_active =1 and b.is_deleted=0 $company  $buyer  $supplier_id $booking_date $booking_cond $style_cond $order_cond $job_cond $internal_ref_con group by a.id,a.pay_mode, a.booking_no_prefix_num,a.inserted_by, a.booking_no, a.company_id, a.supplier_id, a.booking_date, a.delivery_date,c.style_ref_no,d.po_number  order by a.id DESC";

	}
	else
	{
		$internal_ref_con='';
		if(!empty($data[12]))
		{
			$internal_ref_con=" and c.grouping like '%$data[12]%'";
		}

		$sql="SELECT a.id,a.pay_mode, a.job_no, a.inserted_by, a.booking_no_prefix_num, a.booking_no, company_id, a.supplier_id, a.booking_date, a.delivery_date from wo_booking_mst a where a.booking_no not in ( select a.booking_no from wo_booking_mst a, wo_booking_dtls b, wo_po_break_down c where a.booking_no=b.booking_no  and b.po_break_down_id=c.id and a.booking_type=2 and a.entry_form=87 and a.status_active =1 and a.is_deleted=0 and b.status_active =1 and b.is_deleted=0 $company ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $supplier_id $booking_date $booking_cond $job_cond $file_cond $ref_cond $internal_ref_con group by a.booking_no_prefix_num, a.booking_no, company_id, a.supplier_id, a.booking_date, a.delivery_date ) and a.booking_type=2 and a.is_short=2 and a.entry_form=87 and  a.status_active =1 and a.is_deleted=0 $company $buyer2 $supplier_id $booking_date $booking_cond group by a.id, a.pay_mode, a.booking_no_prefix_num,a.inserted_by, a.booking_no, a.job_no, company_id, a.supplier_id, a.booking_date, a.delivery_date order by a.id DESC";
		//".set_user_lavel_filtering(' and a.buyer_id','buyer_id')."
	}
	//echo $sql;
	$booking_data = sql_select($sql);
	if(count($booking_data)>0){
		foreach ($booking_data as $row) {
			if($row[csf("pay_mode")]==3 || $row[csf("pay_mode")]==5)
			{

				$supplier_or_company[$row[csf("id")]]=$comp[$row[csf("supplier_id")]];
			}
			else
			{
				$supplier_or_company[$row[csf("id")]]=$suplier[$row[csf("supplier_id")]];
			}
		}

	}
	/*echo '<pre>';
	print_r($supplier_or_company); die;*/

	if($data[11]==0)
	{
		$arr=array (1=>$comp,2=>$supplier_or_company,7=>$user_arr);
		echo  create_list_view("list_view", "Booking No,Company,Supplier,Booking Date,Delivery Date,Style Ref No,Po Number,Insert User", "60,100,100,70,150,150,120","940","300",0, $sql , "js_set_value", "booking_no", "", 1, "0,company_id,id,0,0,0,0,inserted_by", $arr , "booking_no_prefix_num,company_id,id,booking_date,delivery_date,style_ref_no,po_number,inserted_by", '','','0,0,0,3,3,0,0,0','','');
	}
	else{
		$arr=array (1=>$comp,2=>$supplier_or_company,5=>$user_arr);
		echo  create_list_view("list_view", "Booking No,Company,Supplier,Booking Date,Delivery Date,Insert User", "120,100,100,100,100","700","300",0, $sql , "js_set_value", "booking_no", "", 1, "0,company_id,id,0,0,inserted_by", $arr , "booking_no_prefix_num,company_id,id,booking_date,delivery_date,inserted_by", '','','0,0,0,3,3,0','','');
	}

	exit();
}

if ($action=="populate_data_from_search_popup_booking")
{

	$job_no="";
	 $sql= "select id,booking_no,booking_date,company_id,buyer_id,currency_id,exchange_rate,pay_mode,booking_month,supplier_id,attention,remarks,item_from_precost,delivery_date,source,booking_year,is_approved,cbo_level,ready_to_approved,fabric_source,delivery_address,trime_type,tenor from wo_booking_mst  where booking_no='$data' and  status_active =1 and is_deleted=0";

	$data_array=sql_select($sql);
	foreach ($data_array as $row){
		echo "get_php_form_data(".$row[csf("company_id")].", 'populate_variable_setting_data', 'requires/trims_booking_multi_job_controllerurmi' );\n";
		echo "document.getElementById('cbo_company_name').value = '".$row[csf("company_id")]."';\n";
		echo "document.getElementById('update_id').value = '".$row[csf("id")]."';\n";
		echo "document.getElementById('cbo_buyer_name').value = '".$row[csf("buyer_id")]."';\n";
		echo "document.getElementById('txt_booking_no').value = '".$row[csf("booking_no")]."';\n";
		echo "document.getElementById('cbo_currency').value = '".$row[csf("currency_id")]."';\n";
		echo "document.getElementById('cbo_trim_type').value = '".$row[csf("trime_type")]."';\n";
		echo "document.getElementById('txt_tenor').value = '".$row[csf("tenor")]."';\n";
		echo "document.getElementById('cbo_pay_mode').value = '".$row[csf("pay_mode")]."';\n";
		$paymodeData=$row[csf("pay_mode")].'_'.$row[csf("buyer_id")].'_'.$row[csf("company_id")];
		echo "load_drop_down( 'requires/trims_booking_multi_job_controllerurmi', '".$paymodeData."', 'load_drop_down_supplier', 'supplier_td' );\n";
		echo "document.getElementById('txt_booking_date').value = '".change_date_format($row[csf("booking_date")],'dd-mm-yyyy','-')."';\n";
		echo "document.getElementById('cbo_booking_month').value = '".$row[csf("booking_month")]."';\n";
		echo "document.getElementById('cbo_supplier_name').value = '".$row[csf("supplier_id")]."';\n";
		echo "document.getElementById('txt_attention').value = '".$row[csf("attention")]."';\n";
		echo "document.getElementById('txt_remarks').value = '".$row[csf("remarks")]."';\n";
		if($row[csf("delivery_address")]!="")
		{
		$d_address=preg_replace('/\s+/', ' ', trim($row[csf("delivery_address")]))."";
		}
		echo "document.getElementById('delivery_address').value = '".($d_address)."';\n";
		echo "document.getElementById('txt_delivery_date').value = '".change_date_format($row[csf("delivery_date")],'dd-mm-yyyy','-')."';\n";
		echo "document.getElementById('cbo_source').value = '".$row[csf("source")]."';\n";
        echo "document.getElementById('cbo_material_source').value = '".$row[csf("fabric_source")]."';\n";
		echo "document.getElementById('cbo_booking_year').value = '".$row[csf("booking_year")]."';\n";
		if($row[csf("is_approved")]==3){
			$is_approved=1;
		}else{
			$is_approved=$row[csf("is_approved")];
		}
		echo "document.getElementById('id_approved_id').value = '".$is_approved."';\n";
		echo "document.getElementById('cbo_level').value = '".$row[csf("cbo_level")]."';\n";
		echo "document.getElementById('cbo_ready_to_approved').value = '".$row[csf("ready_to_approved")]."';\n";
		echo " $('#cbo_company_name').attr('disabled',true);\n";
		echo " $('#cbo_supplier_name').attr('disabled',true);\n";
		echo " $('#cbo_level').attr('disabled',true);\n";
		echo " $('#cbo_buyer_name').attr('disabled',true);\n";
		echo " $('#cbo_booking_month').attr('disabled',true);\n";
		echo " $('#cbo_booking_year').attr('disabled',true);\n";
		echo "fnc_show_booking_list();\n";

		if($row[csf("is_approved")]==1)
		{
			echo "document.getElementById('app_sms2').innerHTML = 'This booking is approved';\n";
			echo "document.getElementById('txt_un_appv_request').disabled = '".false."';\n";
		}
		elseif($row[csf("is_approved")]==3)
		{
			echo "document.getElementById('app_sms2').innerHTML = 'This booking is partial approved';\n";
			echo "document.getElementById('txt_un_appv_request').disabled = '".false."';\n";
		}
		else
		{
			echo "document.getElementById('app_sms2').innerHTML = '';\n";
			echo "document.getElementById('txt_un_appv_request').disabled = '".true."';\n";
		}
	}
}

//================================================report Start=====================================================
if($action=="show_trim_booking_report2") // Buck Up
{

	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	$user_name_arr=return_library_array( "select id,user_name from   user_passwd",'id','user_name');

	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	//$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");

	$sqlitem=sql_select("select id,order_uom,trim_uom  from lib_item_group");
	foreach($sqlitem as $row)
	{
		$order_uom_arr[$row[csf('id')]]=$row[csf('order_uom')];
		$cons_uom_arr[$row[csf('id')]]=$row[csf('trim_uom')];
	}
	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;
	//$revised_no_data=sql_select("select a.revised_no  from wo_booking_mst a where  a.booking_no=$txt_booking_no and  a.status_active =1 and a.is_deleted=0");
	//list($revised_no_row)=$revised_no_data;
		$booking_grand_total=0;
		$currency_id="";


		$buyer_string=array();
		$style_owner=array();
		$job_no=array();
		$style_ref=array();
		$all_dealing_marcent=array();
		$season=array();
		$order_repeat_no=array();
		$po_id_arr=array();

		$nameArray_buyer=sql_select( "select a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, b.po_break_down_id from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
        foreach ($nameArray_buyer as $result_buy){
			$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
			$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
			//$season[$result_buy[csf('job_no')]]=$season_arr[$result_buy[csf('season_matrix')]];
			$season_matrix=$result_buy[csf('season_matrix')];
			$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
			if($season_matrix!=0 && $season_buyer_wise==0 )
			{
				$season_matrix_con=$season_matrix;
			}
			else if($season_buyer_wise!=0 && $season_matrix==0)
			{
				$season_matrix_con=$season_buyer_wise;
			}
			$seasons_name.=$season_arr[$season_matrix_con].',';
			$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
			$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

			$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];
		}
		$style_sting=implode(",",array_unique($style_ref));
		$job_no=implode(",",$job_no);
		$seasons_names=rtrim($seasons_name,',');

		$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));
		$poid_arr=array_unique($po_id_arr);
		//$txt_order_no_id=array_unique($po_id_arr);
		$order_rept_no=rtrim($order_rept_no,',');
		$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));

		$po_no=array();
		$file_no=array();
		$ref_no=array();
		$po_quantity=array();
		$sc_lc_arr=array();
		$pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';
		$nameArray_job=sql_select( "SELECT max(a.update_date) as update_date,b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, sum(b.po_quantity) as po_quantity, b.sc_lc  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  b.status_active =1 and b.is_deleted=0 and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, b.sc_lc  ");
        foreach ($nameArray_job as $result_job){
			$po_no[$result_job[csf('job_no_mst')]][$result_job[csf('id')]]=$result_job[csf('po_number')];
			$sc_lc_arr[$result_job[csf('job_no_mst')]][$result_job[csf('sc_lc')]]=$result_job[csf('sc_lc')];
			$po_shipdate_arr[$result_job[csf('job_no_mst')]].=change_date_format($result_job[csf('pub_shipment_date')]).',';
			$file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
			$ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
			$po_quantity[$result_job[csf('id')]]=$result_job[csf('po_quantity')];
		//	$tot_po_quantity+=$result_job[csf('po_quantity')];
			$job_ref_no[$result_job[csf('job_no_mst')]].=$result_job[csf('grouping')].',';
			$job_file_no[$result_job[csf('job_no_mst')]].=$result_job[csf('file_no')].',';
			$po_no_arr[$result_job[csf('job_no_mst')]]['po_id'].=$result_job[csf('id')].',';
			$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
			$int_ref_no.=$result_job[csf('grouping')].',';
			if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];
			$revised_update_date=explode(" ",$result_job[csf('update_date')]);
			$revised_date=strtotime($revised_update_date[0]);

		}
		$sql_job=sql_select( "select b.job_no_mst,b.id as po_id, b.po_quantity as po_quantity  from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.")  ");
		foreach ($sql_job as $row)
		{
			$job_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('po_id')]]+=$row[csf('po_quantity')];
			$tot_po_quantity+=$row[csf('po_quantity')];
		}

        $nameArray=sql_select( "select a.booking_no,a.inserted_by, a.insert_date,a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_address, a.delivery_date, a.source, a.remarks, a.revised_no,a.update_date from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
		foreach( $nameArray as $row)
		{
			$varcode_booking_no=$row[csf('booking_no')];
			$booking_date=$row[csf('booking_date')];
			$delivery_date=$row[csf('delivery_date')];
			$pay_mode_id=$row[csf('pay_mode')];
			$supplier_id=$row[csf('supplier_id')];
			$currency_id=$row[csf('currency_id')];
			$buyer_id=$row[csf('buyer_id')];
			$exchange_rate=$row[csf('exchange_rate')];
			$attention=$row[csf('attention')];
			$remarks=$row[csf('remarks')];
			$delivery_address=$row[csf('delivery_address')];
			$revised_no=$row[csf('revised_no')];
			$insert_dateAr=explode(" ",$row[csf('insert_date')]);
			$mst_update_date=explode(" ",$row[csf('update_date')]);
			$mst_revised_date=strtotime($mst_update_date[0]);
			if($mst_revised_date=='') $mst_revised_date=strtotime($insert_dateAr[0]);

			$source_id=$row[csf('source')];
			$inserted_by=$row[csf('inserted_by')];
		}
		//echo $inserted_by.'DD';
		if($revised_date!="" && $mst_revised_date!="")
		{
			$max_revised_date_time=max($revised_date,$mst_revised_date);
			$max_revised_date=date('d-m-Y',$max_revised_date_time);
		}
		else if($revised_date!="" && $mst_revised_date=="")
		{
			//$max_revised_date=$revised_date;
			$max_revised_date=date('d-m-Y',$revised_date);
		}
		else if($mst_revised_date!="" && $revised_date=="")
		{
			//$max_revised_date=$mst_revised_date;
			$max_revised_date=date('d-m-Y',$mst_revised_date);
		}
		//echo $max_revised_date.'DD';
	?>
		<html>
		<head>
		<style type="text/css" media="print">
			table { page-break-inside:auto }
		</style>
	</head>



	<div style="width:1333px" align="center">

   <table width="1333px" cellpadding="0" cellspacing="0" style="border:0px solid black" >
   <thead>
       <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
           <tr>
               <td width="20px">
                    <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
                    <tr>
                    <td width="50" >
					   <? if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                                <img  src='../../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />

                       <?
                           }
                           else
                           {
                       ?>
                                <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                       <?	}
                       }
                       else
                       { ?>
                         <img  src='../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                      <? }
                       ?>
                   </td>
                    <td width="40px" align="center">
                    &nbsp;  &nbsp;  &nbsp;
                    </td>
                    <td width="30px"   align="center">

                   <b style="font-size:25px;"> <?
                    echo $company_library[$cbo_company_name]; ?>
                    </b>
                    <br>
                    <label>
                    	<?
                            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                            foreach ($nameArray as $result){
                            ?>
                              <?  if($result[csf('plot_no')]!='') echo $result[csf('plot_no')]; else echo '';?> &nbsp;
                                <? echo $result[csf('level_no')];?> &nbsp;
                                 <? echo $result[csf('road_no')]; ?>  &nbsp;
                                <? echo $result[csf('block_no')];?>  &nbsp;
                                <? echo $result[csf('city')];?>  &nbsp;
                                <? echo $result[csf('zip_code')]; ?>  &nbsp;
                                 <?php echo $result[csf('province')]; ?>  &nbsp;
                                <? echo $country_arr[$result[csf('country_id')]]; ?> &nbsp;<br/>
                                <? echo $result[csf('email')];?>  &nbsp;
                                <? echo $result[csf('website')];
								if($result[csf('plot_no')]!='')
								{
									$plot_no=$result[csf('plot_no')];
								}
								if($result[csf('level_no')]!='')
								{
									$level_no=$result[csf('level_no')];
								}
								if($result[csf('road_no')]!='')
								{
									$road_no=$result[csf('road_no')];
								}
								if($result[csf('block_no')]!='')
								{
									$block_no=$result[csf('block_no')];
								}
								if($result[csf('city')]!='')
								{
									$city=$result[csf('city')];
								}
								$company_address[$result[csf('id')]]=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
								if($result[csf('bin_no')]!='') echo "<br> BIN:".$result[csf('bin_no')];
                            }
						?>
                        </label>
                        <br/>
                        <b style="font-size:20px;">
                         <?php echo $report_title; ?>
                        </b>
                    </td>
                     <td width="10px" align="center" style="font-size:20px;">
                      <table width="80%" align="right" cellpadding="0" cellspacing="0" style="border:0px solid black">
                      	<tr>
                            <td width="80">  Booking No:&nbsp; <?php echo $varcode_booking_no; ?>  </td>
                        </tr>
                        <tr>
                            <td>  Booking Date:&nbsp; <?php echo change_date_format($booking_date); ?>  </td>
                        </tr>
                        <?
                        if($revised_no>0)
						{
						?>
                        <tr>
                            <td>  Revised No:&nbsp; <?php echo $revised_no . '&nbsp(Date:' . change_date_format($max_revised_date) . ')'; ?>  </td>
                        </tr>
                        <?
						}
                        if(str_replace("'","",$id_approved_id) ==1)
						 {
						 ?>
                          <tr>
                             <td>Approved Status :&nbsp;  <? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </td>
                         </tr>
                         <?
						}
						 ?>
                      </table>

                     </td>
                   </tr>
                   </table>
               </td>
            </tr>
       </table>

		   <table width="100%" style="border:0px solid black;table-layout: fixed;">
				<tr>
					<td colspan="6" valign="top"></td>
				</tr>
				<tr>
					<td width="100" style="font-size:18px"><span><b>To, </b></span>  </td>
					<td width="110" colspan="5" style="font-size:18px">&nbsp;<span></span></td>
				</tr>
				<tr>

					<td width="210" colspan="2" style="font-size:18px">&nbsp; <b>
					<?
					if($pay_mode_id==5 || $pay_mode_id==3){
						echo $company_library[$supplier_id];
					}
					else{
						echo $supplier_name_arr[$supplier_id];
					}
					?></b>
					</td>
                    <td  width="100" style="font-size:12px"><b>Buyer.</b></td>
					<td  width="110" >:&nbsp;<? echo $buyer_name_arr[$buyer_id]; ?></td>
                    <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
					<td width="110">:&nbsp;<?  echo change_date_format($delivery_date); ?></td>
				</tr>
				<tr>

					<td width="110" colspan="2" rowspan="2" style="font-size:18px">Address :&nbsp;
					<?
					if($pay_mode_id==5 || $pay_mode_id==3){
						$address=$company_address[$supplier_id];
					}
					else{
						$address=$supplier_address_arr[$supplier_id];
					}
					echo $address;
					?></b>
					</td>
					<td width="100" style="font-size:12px"><b>PO Qty.</b>   </td>
					<td width="110">:&nbsp;<? echo $tot_po_quantity; ?></td>
                     <td style="font-size:12px" ><b>Delivery To </b>   </td>
					<td style="">:&nbsp;
					<?
						echo $delivery_address;
					?>
					</td>

				</tr>
                <tr>

                    <td width="100" style="font-size:12px"><b>Season</b> </td>
					<td width="110">:&nbsp;<? echo $seasons_names; ?></td>

                    <td width="100" style="font-size:12px"><b>Currency</b></td>
					<td width="110">:&nbsp;<?  echo $currency[$currency_id]; ?></td>

                </tr>
                <tr>
                    <td style="font-size:12px" ><b>Attention </b>   </td>
					<td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
					<?
						echo $attention;
					?>
					</td>
                    <td width="100" style="font-size:12px"><b>Order Repeat </b> </td>
					<td width="110">:&nbsp;<? echo $order_rept_no; ?></td>
                    <td  style="font-size:12px"><b>Pay mode</b></td>
                	<td>:&nbsp;<? echo $pay_mode[$pay_mode_id];?></td>

                </tr>

				 <tr>
                    <td style="font-size:12px"><b>Source</b></td>
                	<td>:&nbsp;<? echo $source[$source_id];?></td>
                    <td style="font-size:12px"><b>Dealing Merchant</b></td>
					<td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
					<?
						echo implode(",",array_unique($all_dealing_marcent));
					?>
					</td>
				</tr>
				<tr>
					<td width="100" style="font-size:12px"><b>Remarks</b>  </td>
					<td width="110" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" colspan="5">:&nbsp;<? echo $remarks; ?></td>

				</tr>
				</table>
    		</thead>
            <tbody>
            <!-- <div id="page_break_div">

            </div>-->


          <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?

		$precost_arr=array();
		$trims_qtyPerUnit_arr=array();

		$precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0 and b.po_break_down_id in(".$po_idss.")");
        $calUom="";
		foreach($precost_sql as $precost_row){
			if($precost_row[csf('cal_parameter')]==1){
			   $calUom="Mtr";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==2){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==3){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==4){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==5){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==6){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==7){
			   $calUom="Pcs";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==8){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else{
				$calUom=0;
			}
			 $trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
		}
		$booking_country_arr=array();
		$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,sensitivity,country_id_string from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and po_break_down_id in(".$po_idss.")");
		foreach($nameArray_booking_country as $nameArray_booking_country_row){
			$country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
			$tocu=count($country_id_string);
			for($cu=0;$cu<$tocu;$cu++){
				$booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
			}
		}

		$nameArray_job_po=sql_select( "select job_no from wo_booking_dtls  where booking_no='$txt_booking_no' and po_break_down_id in(".$po_idss.") and status_active =1 and is_deleted=0 group by job_no order by job_no ");
		foreach($nameArray_job_po as $nameArray_job_po_row){
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$nameArray_job_po_row[csf('job_no')]."'   and sensitivity=1 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
	    if(count($nameArray_item)>0){
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];//$po_quantity[$poid];
			}
			$shipdate=rtrim($po_shipdate_arr[$nameArray_job_po_row[csf('job_no')]],',');
			$shipdates=implode(",",array_unique(explode(",",$shipdate)));
        ?>
        &nbsp;
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >

            <tr>
                <td colspan="13" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" align="left"><strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; if($ref_nos!='' ) echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;else " ";if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;  Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?> &nbsp; LC/SC: <? echo implode(",",$sc_lc_arr[$nameArray_job_po_row[csf('job_no')]]); ?></td>

                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td align="center" style="border:1px solid black"><strong>Cons</strong></td>
                <td align="center" style="border:1px solid black"><strong>Cons Uom</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? }?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item){
			$i++;
            $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_color,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount,sum(b.requirment*b.rate) as amt_cons from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center"  style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription){
                ?>
                <td style="border:1px solid black"><?  if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                 <td style="border:1px solid black; text-align:left">
               <? //echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                 <td style="border:1px solid black; text-align:left">
               <? $uom_cons_id=$cons_uom_arr[$result_item[csf('trim_group')]];
			  echo  $unit_of_measurement[$uom_cons_id];
			    ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?


				echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right" title="AVG Rate"><p><? echo number_format($result_itemdescription[csf('amt_cons')]/$result_itemdescription[csf('cons')],4,".","");//$result_itemdescription[csf('rate')]; ?> </p></td>
                <td style="border:1px solid black; text-align:right">
                <?
               // $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				 $amount_as_per_gmts_color = $result_itemdescription[csf('amt_cons')];
				echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                  <? if($show_comment==1) {?>
                 <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					//echo number_format($item_desctiption_total ,4);
				 ?></td>
                  <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					//echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                  <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="11"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->


        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=2 and  status_active =1 and  is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                 <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Size Sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; echo "&nbsp;&nbsp;Int Ref.:".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";echo "&nbsp;&nbsp; Po Qty..:".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;margin-left:210px; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?> &nbsp; LC/SC: <? echo implode(",",$sc_lc_arr[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Article No</strong></td>
                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
			$i++;
			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,b.article_number,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size,b.article_number order by bid");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][2]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black">
				<?
				if($result_itemdescription[csf('article_number')]!="no article"){
					echo $result_itemdescription[csf('article_number')];
				}else{
					echo "-";
				}
				?>
                </td>
                <td style="border:1px solid black; text-align:left">
              <? echo $result_itemdescription[csf('item_size')];?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>


                <td style="border:1px solid black; text-align:right">
				<?
			/*	$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];
					if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
					{
						 echo number_format($result_itemdescription[csf('cons')],0);
					}
					else
					{
						 echo number_format($result_itemdescription[csf('cons')],4);
					}*/
					  echo number_format($result_itemdescription[csf('cons')],4);

                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4,".",""); ?> </td>
                <td style="border:1px solid black; text-align:right">

                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold"><?
			/*	if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
					{
						 echo number_format($item_desctiption_total,0);
					}
					else
					{
						echo number_format($item_desctiption_total,4);
					}*/
					echo number_format($item_desctiption_total,4);
				 ?></td>
                 <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=3 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>
        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?> &nbsp; LC/SC: <? echo implode(",",$sc_lc_arr[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by trim_group ", "item_color", "color_number_id"  );

			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,b.color_number_id order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   echo $color_library[$result_itemdescription[csf('color_number_id')]];
			   ?>
                </td>
               <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>

                <td style="border:1px solid black; text-align:right">
				<?
				/*$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];
				if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
				{
					echo number_format($result_itemdescription[csf('cons')],0);
				}
				else
				{
					echo number_format($result_itemdescription[csf('cons')],4);
				}*/
				echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4,".",""); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?></p> </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
			/*	if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
				{
					echo number_format($item_desctiption_total,0);
				}
				else
				{
					echo number_format($item_desctiption_total,4);
				}*/
				echo number_format($item_desctiption_total,4);
				 ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group");
	   if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));

			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" ><strong>Color & size sensitive (<? echo "Job NO: ".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]] ;echo "&nbsp;&nbsp;Int Ref.:&nbsp;".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?> &nbsp; LC/SC: <? echo implode(",",$sc_lc_arr[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group </strong> </td>


                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td style="border:1px solid black"><strong>Article No.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td style="border:1px solid black; width:170px;"><strong>Gmts Color</strong> </td>
                <td style="border:1px solid black;"><strong>Gmts Size</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by trim_group ", "item_color", "color_number_id"  );

			 $nameArray_color=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.color_number_id as gmt_color, b.item_color as color_number_id,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount, min(c.color_order) as color_order, min(c.size_order) as size_order,c.article_number from wo_booking_dtls a, wo_trim_book_con_dtls b,wo_po_color_size_breakdown c  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and b.po_break_down_id=c.po_break_down_id and b.color_number_id=c.color_number_id and b.gmts_sizes=c.size_number_id and  c.id=b.color_size_table_id and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.color_number_id>0 and c.article_number=b.article_number and a.sensitivity=4 and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.color_number_id, b.item_color,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,c.article_number order by c.article_number,color_order,size_order");



            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]." and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  status_active =1 and is_deleted=0 order by trim_group ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][4]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
				foreach($nameArray_color as $result_color)
                {
					?>

					<td style="border:1px solid black" ><? if($result_color[csf('description')]){echo $result_color[csf('description')];} ?> </td>
					<td style="border:1px solid black" ><? if($result_color[csf('brand_supplier')]){echo $result_color[csf('brand_supplier')]; }?> </td>
                    <td style="border:1px solid black">
					<?
					if($result_color[csf('article_number')]!="no article"){
						echo $result_color[csf('article_number')];
					}else{
						echo "-";
					}
					?>
                    </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('gmt_color')]];?> </td>
                    <td style="border:1px solid black; text-align:left">
					<? echo $size_library[$result_color[csf('gmts_sizes')]]; ?>
					</td>
					<td style="border:1px solid black; text-align:left">
					<? echo $result_color[csf('item_size')]; ?>
					</td>
                    <td style="border:1px solid black; text-align:left">
				   <?
				   $calUom=$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][2];
			       $calQty=explode("_",$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				   if($calUom && end($calQty)){
					   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
				   }
                   ?>
                    </td>

					<td style="border:1px solid black; text-align:right">
					<?
				/*	$uom_id=$order_uom_arr[$order_uom_arr[$result_item[csf('trim_group')]]];
					if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
					{
						echo number_format($result_color[csf('cons')],0);
					}
					else
					{
						echo number_format($result_color[csf('cons')],4);
					}*/
					echo number_format($result_color[csf('cons')],4);

					$item_desctiption_total += $result_color[csf('cons')] ;
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]];  ?></td>
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('rate')],4,".","");
					?>
                     </td>
					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,4);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					$trims_remark=$trims_remark_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
					?>
					</td>
                     <? if($show_comment==1) {?>
                    <td style="border:1px solid black;text-align:center"><? echo $trims_remark; ?> </td>
                    <? } ?>
				</tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="10"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
			/*	if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
					{
						echo number_format($item_desctiption_total,0);
					}
					else
					{
						echo number_format($item_desctiption_total,4);
					}
					*/
				echo number_format($item_desctiption_total,4);  ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }

            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="13"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
       <?
		}
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->



         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=0 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				//echo $poid.', ';
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}

			//$po_quantity[$result_job[csf('id')]];
        ?>
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>NO sensitive  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?> &nbsp; LC/SC: <? echo implode(",",$sc_lc_arr[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                 </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td align="center" style="border:1px solid black"><strong> Qnty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                 <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                 <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color");

            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">

                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);

				?>
                </td>
                <?
                $color_tatal=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
                $item_desctiption_total=0;
                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <?
				if($db_type==0)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.cons) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
						}
						if($db_type==2)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.cons) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
						}

                foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right">
                <?
				//$uom_arr=array(1,52,50,51,53,54,55,56,57,31,59,62,65,66,67,74,78,80);
				//print_r($uom_arr);
				$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];
				//echo $order_uom_id.'DD';
                if($result_color_size_qnty[csf('cons')]!= "")
                {

					/*	if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
						{
							 echo number_format($result_color_size_qnty[csf('cons')],0);
						}
						else
						{
							echo number_format($result_color_size_qnty[csf('cons')],4);
						}*/
               echo number_format($result_color_size_qnty[csf('cons')],4);
                $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                $color_tatal+=$result_color_size_qnty[csf('cons')];
                }
                else echo "";
                ?>
                </td>
                <?
                }
                ?>

                <td style="border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><p><? echo number_format($result_itemdescription[csf('rate')],4,".",""); ?> </p></td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                 <td style="border:1px solid black; text-align:right"><? echo $trims_remark; ?> </td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;">
                <?
                if($color_tatal !='')
                {
					/*	if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
						{
						 echo number_format($color_tatal,0);
						}
						else
						{
							 echo number_format($color_tatal,4);
						}*/
						 echo number_format($color_tatal,4);
                }
                ?>
                </td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="9"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <?
		}
		}
		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->

       <?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>
       <br/>
       <table width="100%" style="margin-top:1px">
       <tr>
       <td>
       <table width="100%" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                <td width="70%" style="border:1px solid black; text-align:left"><? echo number_format($booking_grand_total,2);?></td>
            </tr>
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                <td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
            </tr>
       </table>
       </td>
       </tr>
       </table>
         <br/>
        <table width="100%">
        <tr>
        <td width="49%">
        <?
        	echo get_spacial_instruction($txt_booking_no);
        ?>
    	</td>
    <td width="2%"></td>
    <?
	$lib_designation_arr=return_library_array(" select id,custom_designation from lib_designation","id","custom_designation");
	$user_lib_designation_arr=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
	$user_lib_name_arr=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");

	$mst_id=return_field_value("id as mst_id","wo_booking_mst","booking_no='$txt_booking_no'","mst_id");
	//echo $mst_id.'ssD';
	//and b.un_approved_date is null
	 $approve_data_array=sql_select("select b.approved_by,min(b.approved_date) as approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=8  group by  b.approved_by order by b.approved_by asc");
	// echo "select b.approved_by,min(b.approved_date) as approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=8  group by  b.approved_by order by b.approved_by asc";
	 $unapprove_data_array=sql_select("select b.approved_by,b.approved_date,b.un_approved_reason,b.un_approved_date,b.approved_no from   approval_history b where b.mst_id=$mst_id and b.entry_form=8  order by b.approved_date,b.approved_by");

	?>
    <td width="49%" valign="top">
	<?
          if(count($approve_data_array)>0)
			{
 		?>
       <table  width="850" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>
            <tr style="border:1px solid black;">
                <th colspan="5" style="border:1px solid black;">Approval Status</th>
                </tr>
                <tr style="border:1px solid black;">
                <th width="3%" style="border:1px solid black;">Sl</th>
				<th width="40%" style="border:1px solid black;">Name</th>
				<th width="30%" style="border:1px solid black;">Designation</th>
				<th width="27%" style="border:1px solid black;">Approval Date</th>

                </tr>
            </thead>
            <tbody>
            <?
			$i=1;
			foreach($approve_data_array as $row){


			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
				<td width="40%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
				<td width="27%" style="border:1px solid black;text-align:center"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')]));?></td>

                </tr>
                <?
				$i++;
			}
				?>
            </tbody>
        </table>
		<?
		}
		?>
		<br>
		<?
		if(count($unapprove_data_array)>0)
		{
			$sql_unapproved=sql_select("select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=8 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id=$mst_id");
			$unapproved_request_arr=array();
			foreach($sql_unapproved as $rowu)
			{
			$unapproved_request_arr[$rowu[csf('booking_id')]]=$rowu[csf('approval_cause')];
			}
 		?>
       <table  width="850" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>
            <tr style="border:1px solid black;">
                <th colspan="6" style="border:1px solid black;">Approval/Un Approval History</th>
                </tr>
                <tr style="border:1px solid black;">
                <th width="3%" style="border:1px solid black;">Sl</th>
				<th width="30%" style="border:1px solid black;">Name</th>
				<th width="20%" style="border:1px solid black;">Designation</th>
				<th width="5%" style="border:1px solid black;">Approval Status</th>
				<th width="20%" style="border:1px solid black;">Reason For Un Approval</th>
				<th width="22%" style="border:1px solid black;"> Date</th>

                </tr>
            </thead>
            <tbody>
            <?
			$i=1;
			foreach($unapprove_data_array as $row){

			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
				<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
				<td width="5%" style="border:1px solid black; text-align:center"><? echo 'Yes';?></td>
				<td width="20%" style="border:1px solid black;"><? echo '';?></td>
				<td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); else echo "";?></td>
            </tr>
				<?
				$i++;
				$un_approved_date= explode(" ",$row[csf('un_approved_date')]);
				$un_approved_date=$un_approved_date[0];
				if($db_type==0) //Mysql
				{
					if($un_approved_date=="" || $un_approved_date=="0000-00-00") $un_approved_date="";else $un_approved_date=$un_approved_date;
				}
				else
				{
					if($un_approved_date=="") $un_approved_date="";else $un_approved_date=$un_approved_date;
				}

				if($un_approved_date!="")
				{
				?>
			<tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
				<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
				<td width="5%" style="border:1px solid black;text-align:center;"><? echo 'No';?></td>
				<td width="20%" style="border:1px solid black;text-align:center"><? echo $unapproved_request_arr[$mst_id];?></td>
				<td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('un_approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('un_approved_date')])); else echo "";?></td>
              </tr>

                <?
				$i++;
				}

			}
				?>
            </tbody>
        </table>
		<?
		}
		?>
    </td>
    </tr>
    </table>

   	 </tbody>
     </table>

    </div> <!--class="footer_signature"-->
	<div align="left"><b>Prepared By: &nbsp; <? echo $user_name_arr[$inserted_by];?></b></div>
    <div >

         <?
          echo signature_table(132, $cbo_company_name, "1330px",1);

		 ?>
      	</div>
        <br>
      <div id="page_break_div"></div>
     <br>

    <div>

		<?
        	//echo signature_table(2, $cbo_company_name, "1330px");
			echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>

	<?
    if($link == 1){
        ?>
        <script type="text/javascript" src="../../../js/jquery.js"></script>
        <script type="text/javascript" src="../../../js/jquerybarcode.js"></script>
    <?
    }else {
        ?>
         <script type="text/javascript" src="../../js/jquery.js"></script>
        <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
        <?
    }
        ?>
    <script>
    fnc_generate_Barcode('<? echo $varcode_booking_no; ?>','barcode_img_id');

    </script>
  </html>
	<?
	exit();
}
//================================================report Start=====================================================
if($action=="show_trim_booking_report17") // Buck Up
{

	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	$user_name_arr=return_library_array( "select id,user_name from   user_passwd",'id','user_name');

	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	//$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");

	$sqlitem=sql_select("select id,order_uom,trim_uom  from lib_item_group");
	foreach($sqlitem as $row)
	{
		$order_uom_arr[$row[csf('id')]]=$row[csf('order_uom')];
		$cons_uom_arr[$row[csf('id')]]=$row[csf('trim_uom')];
	}
	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;
	//$revised_no_data=sql_select("select a.revised_no  from wo_booking_mst a where  a.booking_no=$txt_booking_no and  a.status_active =1 and a.is_deleted=0");
	//list($revised_no_row)=$revised_no_data;
		$booking_grand_total=0;
		$currency_id="";


		$buyer_string=array();
		$style_owner=array();
		$job_no=array();
		$style_ref=array();
		$all_dealing_marcent=array();
		$season=array();
		$order_repeat_no=array();
		$po_id_arr=array();

		$nameArray_buyer=sql_select( "select a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, b.po_break_down_id from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
        foreach ($nameArray_buyer as $result_buy){
			$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
			$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
			//$season[$result_buy[csf('job_no')]]=$season_arr[$result_buy[csf('season_matrix')]];
			$season_matrix=$result_buy[csf('season_matrix')];
			$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
			if($season_matrix!=0 && $season_buyer_wise==0 )
			{
				$season_matrix_con=$season_matrix;
			}
			else if($season_buyer_wise!=0 && $season_matrix==0)
			{
				$season_matrix_con=$season_buyer_wise;
			}
			$seasons_name.=$season_arr[$season_matrix_con].',';
			$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
			$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

			$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];
		}
		$style_sting=implode(",",array_unique($style_ref));
		$job_no=implode(",",$job_no);
		$seasons_names=rtrim($seasons_name,',');

		$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));
		$poid_arr=array_unique($po_id_arr);
		//$txt_order_no_id=array_unique($po_id_arr);
		$order_rept_no=rtrim($order_rept_no,',');
		$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));

		$po_no=array();
		$file_no=array();
		$ref_no=array();
		$po_quantity=array();
		$pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';
		$nameArray_job=sql_select( "select max(a.update_date) as update_date,b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, sum(b.po_quantity) as po_quantity  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  b.status_active =1 and b.is_deleted=0 and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no ");
        foreach ($nameArray_job as $result_job){
			$po_no[$result_job[csf('job_no_mst')]][$result_job[csf('id')]]=$result_job[csf('po_number')];
			$po_shipdate_arr[$result_job[csf('job_no_mst')]].=change_date_format($result_job[csf('pub_shipment_date')]).',';
			$file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
			$ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
			$po_quantity[$result_job[csf('id')]]=$result_job[csf('po_quantity')];
		//	$tot_po_quantity+=$result_job[csf('po_quantity')];
			$job_ref_no[$result_job[csf('job_no_mst')]].=$result_job[csf('grouping')].',';
			$job_file_no[$result_job[csf('job_no_mst')]].=$result_job[csf('file_no')].',';
			$po_no_arr[$result_job[csf('job_no_mst')]]['po_id'].=$result_job[csf('id')].',';
			$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
			$int_ref_no.=$result_job[csf('grouping')].',';
			if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];
			$revised_update_date=explode(" ",$result_job[csf('update_date')]);
			$revised_date=strtotime($revised_update_date[0]);

		}
		$sql_job=sql_select( "select b.job_no_mst,b.id as po_id, b.po_quantity as po_quantity  from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.")  ");
		foreach ($sql_job as $row)
		{
			$job_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('po_id')]]+=$row[csf('po_quantity')];
			$tot_po_quantity+=$row[csf('po_quantity')];
		}

        $nameArray=sql_select( "select a.booking_no,a.inserted_by, a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_address, a.delivery_date, a.source, a.remarks, a.revised_no,a.update_date from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
		foreach( $nameArray as $row)
		{
			$varcode_booking_no=$row[csf('booking_no')];
			$booking_date=$row[csf('booking_date')];
			$delivery_date=$row[csf('delivery_date')];
			$pay_mode_id=$row[csf('pay_mode')];
			$supplier_id=$row[csf('supplier_id')];
			$currency_id=$row[csf('currency_id')];
			$buyer_id=$row[csf('buyer_id')];
			$exchange_rate=$row[csf('exchange_rate')];
			$attention=$row[csf('attention')];
			$remarks=$row[csf('remarks')];
			$delivery_address=$row[csf('delivery_address')];
			$revised_no=$row[csf('revised_no')];
			$mst_update_date=explode(" ",$row[csf('update_date')]);
			$mst_revised_date=strtotime($mst_update_date[0]);

			$source_id=$row[csf('source')];
			$inserted_by=$row[csf('inserted_by')];
		}
		//echo $inserted_by.'DD';
		if($revised_date!="" && $mst_revised_date!="")
		{
			$max_revised_date_time=max($revised_date,$mst_revised_date);
			$max_revised_date=date('d-m-Y',$max_revised_date_time);
		}
		else if($revised_date!="" && $mst_revised_date=="")
		{
			//$max_revised_date=$revised_date;
			$max_revised_date=date('d-m-Y',$revised_date);
		}
		else if($mst_revised_date!="" && $revised_date=="")
		{
			//$max_revised_date=$mst_revised_date;
			$max_revised_date=date('d-m-Y',$mst_revised_date);
		}
		//echo $max_revised_date.'DD';
	ob_start();
	?>
		<html>
		<head>
		<style type="text/css" media="print">
		table { page-break-inside:auto }
		/*
        @media print {
        thead {display: table-header-group;}
    }
	@media print {
			  #page_break_div {
				page-break-before: always;
			  }
	}
			.footer_signature {
				position: fixed;
				height: auto;
				bottom:0;
				width:100%;

				}
			@media print {
				table {
					page-break-inside: avoid;
				}
			}
			@media all {
  			#page_break_div   { display: none; }
			}*/

	</style>
	</head>



	<div style="width:1333px" align="center">

   <table width="1333px" cellpadding="0" cellspacing="0" style="border:0px solid black" >
   <thead>
       <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
           <tr>
               <td width="20px">
                    <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
                    <tr>
                    <td width="50" >
					   <? if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                                <img  src='../../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />

                       <?
                           }
                           else
                           {
                       ?>
                                <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                       <?	}
                       }
                       else
                       { ?>
                         <img  src='../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                      <? }
                       ?>
                   </td>
                    <td width="40px" align="center">
                    &nbsp;  &nbsp;  &nbsp;
                    </td>
                    <td width="30px"   align="center">

                   <b style="font-size:25px;"> <?
                    echo $company_library[$cbo_company_name]; ?>
                    </b>
                    <br>
                    <label>
                    	<?
                            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                            foreach ($nameArray as $result){
                            ?>
                              <?  if($result[csf('plot_no')]!='') echo $result[csf('plot_no')]; else echo '';?> &nbsp;
                                <? echo $result[csf('level_no')];?> &nbsp;
                                 <? echo $result[csf('road_no')]; ?>  &nbsp;
                                <? echo $result[csf('block_no')];?>  &nbsp;
                                <? echo $result[csf('city')];?>  &nbsp;
                                <? echo $result[csf('zip_code')]; ?>  &nbsp;
                                 <?php echo $result[csf('province')]; ?>  &nbsp;
                                <? echo $country_arr[$result[csf('country_id')]]; ?> &nbsp;<br/>
                                <? echo $result[csf('email')];?>  &nbsp;
                                <? echo $result[csf('website')];
								if($result[csf('plot_no')]!='')
								{
									$plot_no=$result[csf('plot_no')];
								}
								if($result[csf('level_no')]!='')
								{
									$level_no=$result[csf('level_no')];
								}
								if($result[csf('road_no')]!='')
								{
									$road_no=$result[csf('road_no')];
								}
								if($result[csf('block_no')]!='')
								{
									$block_no=$result[csf('block_no')];
								}
								if($result[csf('city')]!='')
								{
									$city=$result[csf('city')];
								}
								$company_address[$result[csf('id')]]=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
                            }
						?>
                        </label>
                        <br/>
                        <b style="font-size:20px;">
                         <?php echo $report_title; ?>
                        </b>
                    </td>
                     <td width="10px" align="center" style="font-size:20px;">
                      <table width="80%" align="right" cellpadding="0" cellspacing="0" style="border:0px solid black">
                      	<tr>
                            <td width="80">  Booking No:&nbsp; <?php echo $varcode_booking_no; ?>  </td>
                        </tr>
                        <tr>
                            <td>  Booking Date:&nbsp; <?php echo change_date_format($booking_date); ?>  </td>
                        </tr>
                        <?
                        if($revised_no>0)
						{
						?>
                        <tr>
                            <td>  Revised No:&nbsp; <?php echo $revised_no . '&nbsp(Date:' . change_date_format($max_revised_date) . ')'; ?>  </td>
                        </tr>
                        <?
						}
                        if(str_replace("'","",$id_approved_id) ==1)
						 {
						 ?>
                          <tr>
                             <td>Approved Status :&nbsp;  <? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </td>
                         </tr>
                         <?
						}
						 ?>
                      </table>

                     </td>
                   </tr>
                   </table>
               </td>
            </tr>
       </table>

		   <table width="100%" style="border:0px solid black;table-layout: fixed;">
				<tr>
					<td colspan="6" valign="top"></td>
				</tr>
				<tr>
					<td width="100" style="font-size:18px"><span><b>To, </b></span>  </td>
					<td width="110" colspan="5" style="font-size:18px">&nbsp;<span></span></td>
				</tr>
				<tr>

					<td width="210" colspan="2" style="font-size:18px">&nbsp; <b>
					<?
					if($pay_mode_id==5 || $pay_mode_id==3){
						echo $company_library[$supplier_id];
					}
					else{
						echo $supplier_name_arr[$supplier_id];
					}
					?></b>
					</td>
                    <td  width="100" style="font-size:12px"><b>Buyer.</b></td>
					<td  width="110" >:&nbsp;<? echo $buyer_name_arr[$buyer_id]; ?></td>
                    <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
					<td width="110">:&nbsp;<?  echo change_date_format($delivery_date); ?></td>
				</tr>
				<tr>

					<td width="110" colspan="2" rowspan="2" style="font-size:18px">Address :&nbsp;
					<?
					if($pay_mode_id==5 || $pay_mode_id==3){
						$address=$company_address[$supplier_id];
					}
					else{
						$address=$supplier_address_arr[$supplier_id];
					}
					echo $address;
					?></b>
					</td>
					<td width="100" style="font-size:12px"><b>PO Qty.</b>   </td>
					<td width="110">:&nbsp;<? echo $tot_po_quantity; ?></td>
                     <td style="font-size:12px" ><b>Delivery To </b>   </td>
					<td style="">:&nbsp;
					<?
						echo $delivery_address;
					?>
					</td>

				</tr>
                <tr>

                    <td width="100" style="font-size:12px"><b>Season</b> </td>
					<td width="110">:&nbsp;<? echo $seasons_names; ?></td>

                    <td width="100" style="font-size:12px"><b>Currency</b></td>
					<td width="110">:&nbsp;<?  echo $currency[$currency_id]; ?></td>

                </tr>
                <tr>
                    <td style="font-size:12px" ><b>Attention </b>   </td>
					<td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
					<?
						echo $attention;
					?>
					</td>
                    <td width="100" style="font-size:12px"><b>Order Repeat </b> </td>
					<td width="110">:&nbsp;<? echo $order_rept_no; ?></td>
                    <td  style="font-size:12px"><b>Pay mode</b></td>
                	<td>:&nbsp;<? echo $pay_mode[$pay_mode_id];?></td>

                </tr>

				 <tr>
                    <td style="font-size:12px"><b>Source</b></td>
                	<td>:&nbsp;<? echo $source[$source_id];?></td>
                    <td style="font-size:12px"><b>Dealing Merchant</b></td>
					<td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
					<?
						echo implode(",",array_unique($all_dealing_marcent));
					?>
					</td>
				</tr>
				<tr>
					<td width="100" style="font-size:12px"><b>Remarks</b>  </td>
					<td width="110" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" colspan="5">:&nbsp;<? echo $remarks; ?></td>

				</tr>
				</table>
    		</thead>
            <tbody>
            <!-- <div id="page_break_div">

            </div>-->


          <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?

		$precost_arr=array();
		$trims_qtyPerUnit_arr=array();

		$precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0 and b.po_break_down_id in(".$po_idss.")");
	
        $calUom="";
		foreach($precost_sql as $precost_row){
			if($precost_row[csf('cal_parameter')]==1){
			   $calUom="Mtr";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==2){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==3){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==4){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==5){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==6){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==7){
			   $calUom="Pcs";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==8){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else{
				$calUom=0;
			}
			 $trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
		}
		$booking_country_arr=array();
		$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,sensitivity,country_id_string from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and po_break_down_id in(".$po_idss.")");
		foreach($nameArray_booking_country as $nameArray_booking_country_row){
			$country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
			$tocu=count($country_id_string);
			for($cu=0;$cu<$tocu;$cu++){
				$booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
			}
		}

		$nameArray_job_po=sql_select( "select job_no from wo_booking_dtls  where booking_no='$txt_booking_no' and po_break_down_id in(".$po_idss.") and status_active =1 and is_deleted=0 group by job_no order by job_no ");
		foreach($nameArray_job_po as $nameArray_job_po_row){
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$nameArray_job_po_row[csf('job_no')]."'   and sensitivity=1 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
	    if(count($nameArray_item)>0){
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];//$po_quantity[$poid];
			}
			$shipdate=rtrim($po_shipdate_arr[$nameArray_job_po_row[csf('job_no')]],',');
			$shipdates=implode(",",array_unique(explode(",",$shipdate)));
        ?>
        &nbsp;
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >

            <tr>
                <td colspan="13" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" align="left"><strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; if($ref_nos!='' ) echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;else " ";if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;  Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>

                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
				<td align="center" style="border:1px solid black"><strong>GMTS Color</strong></td>
				<td align="center" style="border:1px solid black"><strong>GMTS Color Qnty</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td align="center" style="border:1px solid black"><strong>Cons</strong></td>
                <td align="center" style="border:1px solid black"><strong>Cons Uom</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? }?>
            </tr>
            <?
						
						$precost_sql=sql_select("select costing_per from wo_pre_cost_mst where status_active = 1 and  is_deleted = 0 and job_no='".$nameArray_job_po_row[csf('job_no')]."' ");		
						$cbo_costing_per=$precost_sql[0][csf('costing_per')];

						$item_ratio_arr=array();
						$gmts_item_sql=sql_select("select gmts_item_id, set_item_ratio from  wo_po_details_mas_set_details  where job_no='".$nameArray_job_po_row[csf('job_no')]."'");
						foreach($gmts_item_sql as $gmts_item_row)
						{
							$item_ratio_arr[$gmts_item_row[csf('gmts_item_id')]] = $gmts_item_row[csf('set_item_ratio')];
						}
						unset($gmts_item_sql);


						$gmts_data=sql_select("SELECT b.id, b.po_number, c.item_number_id, c.color_number_id, c.size_number_id,plan_cut_qnty,order_quantity,d.wo_pre_cost_trim_cost_dtls_id as pre_cost_dtls_id,d.cons, d.excess_per,d.color_number_id	from wo_po_break_down b left join wo_pre_cost_trim_co_cons_dtls d on b.id=po_break_down_id and d.job_no=b.job_no_mst,wo_po_color_size_breakdown c
						where b.id=c.po_break_down_id and b.job_no_mst='".$nameArray_job_po_row[csf('job_no')]."' and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted =0 	group by b.id, b.po_number, c.item_number_id, c.color_number_id, c.size_number_id ,d.wo_pre_cost_trim_cost_dtls_id,d.cons, d.excess_per,d.color_number_id,order_quantity,plan_cut_qnty	order by b.id, c.item_number_id");
					

						if($cbo_costing_per==1) $pcs_value=1*12;
						else if($cbo_costing_per==2) $pcs_value=1*1;
						else if($cbo_costing_per==3) $pcs_value=2*12;
						else if($cbo_costing_per==4) $pcs_value=3*12;
						else if($cbo_costing_per==5) $pcs_value=4*12;

					


					

					
						$dataArray=sql_select("SELECT b.id, b.po_number, c.item_number_id, c.color_number_id, c.size_number_id, min(c.id) as color_size_table_id, min(color_order) as color_order, min(size_order) as size_order, sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity from wo_po_break_down b,wo_po_color_size_breakdown c where b.id=c.po_break_down_id and b.job_no_mst='".$nameArray_job_po_row[csf('job_no')]."' and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted =0 group by b.id, b.po_number, c.item_number_id, c.color_number_id, c.size_number_id order by b.id, c.item_number_id, color_order, size_order");

						$gmts_color_arr=array();$gmts_item_arr=array();$color_wise_trims_arr=array();
						foreach($dataArray as $row){
							$cons=$trims_arr[$row[csf('color_size_table_id')]]['cons'];
							$color_wise_trims_arr[$row[csf('item_number_id')]][$row[csf('color_number_id')]]['gmts_qty']+=$row[csf('order_quantity')];
							$color_size_trims_arr[$row[csf('item_number_id')]][$row[csf('size_number_id')]]['gmts_qty']+=$row[csf('order_quantity')];
							// $color_wise_trims_arr[$row[csf('item_number_id')]][$row[csf('color_number_id')]]['gmts_qty']+=($row[csf('order_quantity')]/$item_ratio_arr[$row[csf('item_number_id')]])*($cons/$pcs_value);

							$gmts_color_arr[$row[csf('color_size_table_id')]]=$row[csf('color_number_id')];
							$gmts_item_arr[$row[csf('color_size_table_id')]]=$row[csf('item_number_id')];
							$gmts_size_arr[$row[csf('color_size_table_id')]]=$row[csf('size_number_id')];
						
						}
						// unset($dataArray);
	  



			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item){
			$i++;
            $nameArray_item_description=sql_select( "  select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_color,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount,sum(b.requirment*b.rate) as amt_cons,b.color_number_id,b.color_size_table_id from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,b.color_number_id,b.color_size_table_id order by bid ");


			$trimsdtls=sql_select("SELECT id, wo_pre_cost_trim_cost_dtls_id, job_no, po_break_down_id, item_number_id, color_number_id, size_number_id, item_size, item_color_number_id, country_id, place, cons, excess_per, tot_cons, ex_cons, rate,amount, pcs, gmts_pcs, color_size_table_id, rate_cal_data from wo_pre_cost_trim_co_cons_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."' and  wo_pre_cost_trim_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]."  and status_active=1 and is_deleted=0 ");
						
						$trims_arr=array();
							foreach($trimsdtls as $rows){
								// $pre_cost_trims_arr[$rows[csf('color_size_table_id')]]['excess_per']=$rows[csf('excess_per')];
								$trims_arr[$rows[csf('color_size_table_id')]]['cons']=$rows[csf('cons')];
								// $pre_cost_trims_arr[$rows[csf('color_size_table_id')]]['excess_per']=$rows[csf('excess_per')];
								$item_gmts_color[$rows[csf('color_size_table_id')]][$rows[csf('color_number_id')]]=$rows[csf('color_number_id')];
							}


			
			//   echo "<pre>";
			//   print_r($pre_cost_trims_arr);
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center"  style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription){
                ?>
                <td style="border:1px solid black"><?  if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
				<td style="border:1px solid black; text-align:left">
               <? 
				$cons=$trims_arr[$result_itemdescription[csf('color_size_table_id')]]['cons'];
			   $gmts_color=$gmts_color_arr[$result_itemdescription[csf('color_size_table_id')]];
			   $trim_group=$gmts_item_arr[$result_itemdescription[csf('color_size_table_id')]];
			   echo $color_library[$gmts_color]; ?>
                </td>
				<td style="border:1px solid black; text-align:left" title="<?=$pre_cost_dtls_id.'=>'.$trim_group.'=>'.$gmts_color;?>"><? echo $color_wise_trims_arr[$trim_group][$gmts_color]['gmts_qty']; ?></td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                 <td style="border:1px solid black; text-align:left">
               <? echo number_format($cons,4); ?>
                </td>
                 <td style="border:1px solid black; text-align:left">
               <? $uom_cons_id=$cons_uom_arr[$result_item[csf('trim_group')]];
			  echo  $unit_of_measurement[$uom_cons_id];
			    ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?


				echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right" title="AVG Rate"><p><? echo number_format($result_itemdescription[csf('amt_cons')]/$result_itemdescription[csf('cons')],4,".","");//$result_itemdescription[csf('rate')]; ?> </p></td>
                <td style="border:1px solid black; text-align:right">
                <?
               // $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				 $amount_as_per_gmts_color = $result_itemdescription[csf('amt_cons')];
				echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                  <? if($show_comment==1) {?>
                 <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="6"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					//echo number_format($item_desctiption_total ,4);
				 ?></td>
                  <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					//echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                  <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="13"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->


        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=2 and  status_active =1 and  is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                 <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Size Sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; echo "&nbsp;&nbsp;Int Ref.:".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";echo "&nbsp;&nbsp; Po Qty..:".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;margin-left:210px; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Article No</strong></td>
                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
				<td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
				<td align="center" style="border:1px solid black"><strong>Gmts Color Qty</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
				<td align="center" style="border:1px solid black"><strong>Cons</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
			$i++;
			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,b.article_number,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount,b.color_size_table_id	from wo_booking_dtls a , wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size,b.article_number,b.color_size_table_id order by bid");



			$trimsdtls=sql_select("SELECT id, wo_pre_cost_trim_cost_dtls_id, job_no, po_break_down_id, item_number_id, color_number_id, size_number_id, item_size, item_color_number_id, country_id, place, cons, excess_per, tot_cons, ex_cons, rate,amount, pcs, gmts_pcs, color_size_table_id, rate_cal_data from wo_pre_cost_trim_co_cons_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."' and  wo_pre_cost_trim_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and status_active=1 and is_deleted=0 ");
						
			$trims_arr=array();
				foreach($trimsdtls as $rows){
					// $pre_cost_trims_arr[$rows[csf('color_size_table_id')]]['excess_per']=$rows[csf('excess_per')];
					$trims_arr[$rows[csf('color_size_table_id')]]['cons']=$rows[csf('cons')];
					// $pre_cost_trims_arr[$rows[csf('color_size_table_id')]]['excess_per']=$rows[csf('excess_per')];
					$item_gmts_color[$rows[csf('color_size_table_id')]][$rows[csf('color_number_id')]]=$rows[csf('color_number_id')];
				}

            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][2]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black">
				<?
				if($result_itemdescription[csf('article_number')]!="no article"){
					echo $result_itemdescription[csf('article_number')];
				}else{
					echo "-";
				}
				

				$cons=$trims_arr[$result_itemdescription[csf('color_size_table_id')]]['cons'];
				$gmts_color=$gmts_color_arr[$result_itemdescription[csf('color_size_table_id')]];
				$trim_group=$gmts_item_arr[$result_itemdescription[csf('color_size_table_id')]];
				$size=$gmts_size_arr[$result_itemdescription[csf('color_size_table_id')]];;
				

				?>
                </td>
                <td style="border:1px solid black; text-align:left"><? echo $result_itemdescription[csf('item_size')];?></td>
				<td style="border:1px solid black; text-align:left"><? // echo $color_library[$gmts_color]; ?></td>
				<td style="border:1px solid black; text-align:left" title="<?=$gmts_color.'-'.$trim_group;?>"><? echo number_format($color_size_trims_arr[$trim_group][$size]['gmts_qty'],0);;?></td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>

				<td style="border:1px solid black; text-align:right"><? echo number_format($cons,4);	?>    </td>
                <td style="border:1px solid black; text-align:right">
				<?
			/*	$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];
					if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
					{
						 echo number_format($result_itemdescription[csf('cons')],0);
					}
					else
					{
						 echo number_format($result_itemdescription[csf('cons')],4);
					}*/
					  echo number_format($result_itemdescription[csf('cons')],4);

                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
			
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4,".",""); ?> </td>
                <td style="border:1px solid black; text-align:right">

                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="8"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold"><?
			/*	if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
					{
						 echo number_format($item_desctiption_total,0);
					}
					else
					{
						echo number_format($item_desctiption_total,4);
					}*/
					echo number_format($item_desctiption_total,4);
				 ?></td>
                 <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="13"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=3 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>
        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
				<td align="center" style="border:1px solid black"><strong>Gmts Color Qty</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
				<td align="center" style="border:1px solid black"><strong>Cons</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by trim_group ", "item_color", "color_number_id"  );

			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount,b.color_size_table_id	from wo_booking_dtls a , wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,b.color_number_id,b.color_size_table_id order by bid ");




			$trimsdtls=sql_select("SELECT id, wo_pre_cost_trim_cost_dtls_id, job_no, po_break_down_id, item_number_id, color_number_id, size_number_id, item_size, item_color_number_id, country_id, place, cons, excess_per, tot_cons, ex_cons, rate,amount, pcs, gmts_pcs, color_size_table_id, rate_cal_data from wo_pre_cost_trim_co_cons_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."' and  wo_pre_cost_trim_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]."  and status_active=1 and is_deleted=0 ");
						
			$trims_arr=array();
				foreach($trimsdtls as $rows){
					// $pre_cost_trims_arr[$rows[csf('color_size_table_id')]]['excess_per']=$rows[csf('excess_per')];
					$trims_arr[$rows[csf('color_size_table_id')]]['cons']=$rows[csf('cons')];
					// $pre_cost_trims_arr[$rows[csf('color_size_table_id')]]['excess_per']=$rows[csf('excess_per')];
					$item_gmts_color[$rows[csf('color_size_table_id')]][$rows[csf('color_number_id')]]=$rows[csf('color_number_id')];
				}



            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]];
			   
			 
			   $cons=$trims_arr[$result_itemdescription[csf('color_size_table_id')]]['cons'];
			   $gmts_color=$gmts_color_arr[$result_itemdescription[csf('color_size_table_id')]];
			   $trim_group=$gmts_item_arr[$result_itemdescription[csf('color_size_table_id')]];
			 
			 
			 
			 ?>
                </td>
                <td style="border:1px solid black; text-align:left"> <?   echo $color_library[$gmts_color]; 
				
				
				?>  </td>
				<td style="border:1px solid black; text-align:right"> <?   echo $color_wise_trims_arr[$trim_group][$gmts_color]['gmts_qty'];; ?>  </td>
               <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>

				<td style="border:1px solid black; text-align:right"><?	echo number_format($cons,4);  ?>       </td>
                <td style="border:1px solid black; text-align:right">
				<?
				/*$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];
				if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
				{
					echo number_format($result_itemdescription[csf('cons')],0);
				}
				else
				{
					echo number_format($result_itemdescription[csf('cons')],4);
				}*/
				echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4,".",""); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?></p> </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="7"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
			/*	if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
				{
					echo number_format($item_desctiption_total,0);
				}
				else
				{
					echo number_format($item_desctiption_total,4);
				}*/
				echo number_format($item_desctiption_total,4);
				 ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="12"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group");
	   if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));

			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" ><strong>Color & size sensitive (<? echo "Job NO: ".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]] ;echo "&nbsp;&nbsp;Int Ref.:&nbsp;".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group </strong> </td>


                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td style="border:1px solid black"><strong>Article No.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td style="border:1px solid black; width:170px;"><strong>Gmts Color</strong> </td>
				<td style="border:1px solid black; width:170px;"><strong>Gmts Color Qty</strong> </td>
                <td style="border:1px solid black;"><strong>Gmts Size</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
				<td align="center" style="border:1px solid black"><strong>Cons</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by trim_group ", "item_color", "color_number_id"  );

			 $nameArray_color=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.color_number_id as gmt_color, b.item_color as color_number_id,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,sum(b.requirment) as cons, avg(b.rate) as rate, sum(b.amount) as amount, min(c.color_order) as color_order, min(c.size_order) as size_order,c.article_number,b.color_size_table_id from wo_booking_dtls a , wo_trim_book_con_dtls b,wo_po_color_size_breakdown c   where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and b.po_break_down_id=c.po_break_down_id and b.color_number_id=c.color_number_id and b.gmts_sizes=c.size_number_id and  c.id=b.color_size_table_id and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.color_number_id>0 and c.article_number=b.article_number and a.sensitivity=4 and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.color_number_id, b.item_color,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,c.article_number,b.color_size_table_id order by c.article_number,color_order,size_order");



	


            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]." and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  status_active =1 and is_deleted=0 order by trim_group ");




			$trimsdtls=sql_select("SELECT id, wo_pre_cost_trim_cost_dtls_id, job_no, po_break_down_id, item_number_id, color_number_id, size_number_id, item_size, item_color_number_id, country_id, place, cons, excess_per, tot_cons, ex_cons, rate,amount, pcs, gmts_pcs, color_size_table_id, rate_cal_data from wo_pre_cost_trim_co_cons_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."' and  wo_pre_cost_trim_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]."  and status_active=1 and is_deleted=0 ");
						
			$trims_arr=array();
				foreach($trimsdtls as $rows){
					// $pre_cost_trims_arr[$rows[csf('color_size_table_id')]]['excess_per']=$rows[csf('excess_per')];
					$trims_arr[$rows[csf('color_size_table_id')]]['cons']=$rows[csf('cons')];
					// $pre_cost_trims_arr[$rows[csf('color_size_table_id')]]['excess_per']=$rows[csf('excess_per')];
					$item_gmts_color[$rows[csf('color_size_table_id')]][$rows[csf('color_number_id')]]=$rows[csf('color_number_id')];
				}

            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][4]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
				foreach($nameArray_color as $result_color)
                {
					?>

					<td style="border:1px solid black" ><? if($result_color[csf('description')]){echo $result_color[csf('description')];} ?> </td>
					<td style="border:1px solid black" ><? if($result_color[csf('brand_supplier')]){echo $result_color[csf('brand_supplier')]; }?> </td>
                    <td style="border:1px solid black">
					<?
					if($result_color[csf('article_number')]!="no article"){
						echo $result_color[csf('article_number')];
					}else{
						echo "-";
					}

					$cons=$trims_arr[$result_color[csf('color_size_table_id')]]['cons'];
					$gmts_color=$gmts_color_arr[$result_color[csf('color_size_table_id')]];
					$trim_group=$gmts_item_arr[$result_color[csf('color_size_table_id')]];


					?>
                    </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$gmts_color];	?> </td>
					<td style="border:1px solid black"><? echo  $color_wise_trims_arr[$trim_group][$gmts_color]['gmts_qty']; ?> </td>
                    <td style="border:1px solid black; text-align:left">
					<? echo $size_library[$result_color[csf('gmts_sizes')]]; ?>
					</td>
					<td style="border:1px solid black; text-align:left">
					<? echo $result_color[csf('item_size')]; ?>
					</td>
                    <td style="border:1px solid black; text-align:left">
				   <?
				   $calUom=$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][2];
			       $calQty=explode("_",$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				   if($calUom && end($calQty)){
					   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
				   }
                   ?>
                    </td>
					<td style="border:1px solid black; text-align:right"><?	echo number_format($cons,4);?> </td>
					<td style="border:1px solid black; text-align:right">
					<?
				/*	$uom_id=$order_uom_arr[$order_uom_arr[$result_item[csf('trim_group')]]];
					if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
					{
						echo number_format($result_color[csf('cons')],0);
					}
					else
					{
						echo number_format($result_color[csf('cons')],4);
					}*/
					echo number_format($result_color[csf('cons')],4);

					$item_desctiption_total += $result_color[csf('cons')] ;
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]];  ?></td>
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('rate')],4,".","");
					?>
                     </td>
					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,4);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					$trims_remark=$trims_remark_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
					?>
					</td>
                     <? if($show_comment==1) {?>
                    <td style="border:1px solid black;text-align:center"><? echo $trims_remark; ?> </td>
                    <? } ?>
				</tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="12"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
			/*	if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
					{
						echo number_format($item_desctiption_total,0);
					}
					else
					{
						echo number_format($item_desctiption_total,4);
					}
					*/
				echo number_format($item_desctiption_total,4);  ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }

            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="15"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
       <?
		}
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->



         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=0 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				//echo $poid.', ';
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}

			//$po_quantity[$result_job[csf('id')]];
        ?>
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>NO sensitive  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                 </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td align="center" style="border:1px solid black"><strong> Qnty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                 <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                 <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color");

            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">

                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);

				?>
                </td>
                <?
                $color_tatal=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
                $item_desctiption_total=0;
                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <?
				if($db_type==0)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.cons) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
						}
						if($db_type==2)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.cons) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
						}

                foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right">
                <?
				//$uom_arr=array(1,52,50,51,53,54,55,56,57,31,59,62,65,66,67,74,78,80);
				//print_r($uom_arr);
				$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];
				//echo $order_uom_id.'DD';
                if($result_color_size_qnty[csf('cons')]!= "")
                {

					/*	if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
						{
							 echo number_format($result_color_size_qnty[csf('cons')],0);
						}
						else
						{
							echo number_format($result_color_size_qnty[csf('cons')],4);
						}*/
               echo number_format($result_color_size_qnty[csf('cons')],4);
                $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                $color_tatal+=$result_color_size_qnty[csf('cons')];
                }
                else echo "";
                ?>
                </td>
                <?
                }
                ?>

                <td style="border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><p><? echo number_format($result_itemdescription[csf('rate')],4,".",""); ?> </p></td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                 <td style="border:1px solid black; text-align:right"><? echo $trims_remark; ?> </td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;">
                <?
                if($color_tatal !='')
                {
					/*	if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
						{
						 echo number_format($color_tatal,0);
						}
						else
						{
							 echo number_format($color_tatal,4);
						}*/
						 echo number_format($color_tatal,4);
                }
                ?>
                </td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="9"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <?
		}
		}
		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->

       <?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>
       <br/>
       <table width="100%" style="margin-top:1px">
       <tr>
       <td>
       <table width="100%" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                <td width="70%" style="border:1px solid black; text-align:left"><? echo number_format($booking_grand_total,2);?></td>
            </tr>
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                <td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
            </tr>
       </table>
       </td>
       </tr>
       </table>
         <br/>
        <table width="100%">
        <tr>
        <td width="49%">
        <?
        	echo get_spacial_instruction($txt_booking_no);
        ?>
    	</td>
    <td width="2%"></td>
    <?
	$lib_designation_arr=return_library_array(" select id,custom_designation from lib_designation","id","custom_designation");
	$user_lib_designation_arr=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
	$user_lib_name_arr=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");

	$mst_id=return_field_value("id as mst_id","wo_booking_mst","booking_no='$txt_booking_no'","mst_id");
	//echo $mst_id.'ssD';
	//and b.un_approved_date is null
	 $approve_data_array=sql_select("select b.approved_by,min(b.approved_date) as approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=8  group by  b.approved_by order by b.approved_by asc");
	// echo "select b.approved_by,min(b.approved_date) as approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=8  group by  b.approved_by order by b.approved_by asc";
	 $unapprove_data_array=sql_select("select b.approved_by,b.approved_date,b.un_approved_reason,b.un_approved_date,b.approved_no from   approval_history b where b.mst_id=$mst_id and b.entry_form=8  order by b.approved_date,b.approved_by");

	?>
    <td width="49%" valign="top">
	<?
          if(count($approve_data_array)>0)
			{
 		?>
       <table  width="850" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>
            <tr style="border:1px solid black;">
                <th colspan="5" style="border:1px solid black;">Approval Status</th>
                </tr>
                <tr style="border:1px solid black;">
                <th width="3%" style="border:1px solid black;">Sl</th>
				<th width="40%" style="border:1px solid black;">Name</th>
				<th width="30%" style="border:1px solid black;">Designation</th>
				<th width="27%" style="border:1px solid black;">Approval Date</th>

                </tr>
            </thead>
            <tbody>
            <?
			$i=1;
			foreach($approve_data_array as $row){


			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
				<td width="40%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
				<td width="27%" style="border:1px solid black;text-align:center"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')]));?></td>

                </tr>
                <?
				$i++;
			}
				?>
            </tbody>
        </table>
		<?
		}
		?>
		<br>
		<?
		if(count($unapprove_data_array)>0)
		{
			$sql_unapproved=sql_select("select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=8 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id=$mst_id");
			$unapproved_request_arr=array();
			foreach($sql_unapproved as $rowu)
			{
			$unapproved_request_arr[$rowu[csf('booking_id')]]=$rowu[csf('approval_cause')];
			}
 		?>
       <table  width="850" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>
            <tr style="border:1px solid black;">
                <th colspan="6" style="border:1px solid black;">Approval/Un Approval History</th>
                </tr>
                <tr style="border:1px solid black;">
                <th width="3%" style="border:1px solid black;">Sl</th>
				<th width="30%" style="border:1px solid black;">Name</th>
				<th width="20%" style="border:1px solid black;">Designation</th>
				<th width="5%" style="border:1px solid black;">Approval Status</th>
				<th width="20%" style="border:1px solid black;">Reason For Un Approval</th>
				<th width="22%" style="border:1px solid black;"> Date</th>

                </tr>
            </thead>
            <tbody>
            <?
			$i=1;
			foreach($unapprove_data_array as $row){

			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
				<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
				<td width="5%" style="border:1px solid black; text-align:center"><? echo 'Yes';?></td>
				<td width="20%" style="border:1px solid black;"><? echo '';?></td>
				<td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); else echo "";?></td>
            </tr>
				<?
				$i++;
				$un_approved_date= explode(" ",$row[csf('un_approved_date')]);
				$un_approved_date=$un_approved_date[0];
				if($db_type==0) //Mysql
				{
					if($un_approved_date=="" || $un_approved_date=="0000-00-00") $un_approved_date="";else $un_approved_date=$un_approved_date;
				}
				else
				{
					if($un_approved_date=="") $un_approved_date="";else $un_approved_date=$un_approved_date;
				}

				if($un_approved_date!="")
				{
				?>
			<tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
				<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
				<td width="5%" style="border:1px solid black;text-align:center;"><? echo 'No';?></td>
				<td width="20%" style="border:1px solid black;text-align:center"><? echo $unapproved_request_arr[$mst_id];?></td>
				<td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('un_approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('un_approved_date')])); else echo "";?></td>
              </tr>

                <?
				$i++;
				}

			}
				?>
            </tbody>
        </table>
		<?
		}
		?>
    </td>
    </tr>
    </table>

   	 </tbody>
     </table>

    </div> <!--class="footer_signature"-->
	<div align="left"><b>Prepared By: &nbsp; <? echo $user_name_arr[$inserted_by];?></b></div>
    <div >

         <?
          echo signature_table(132, $cbo_company_name, "1330px",1);

		 ?>
      	</div>
        <br>
      <div id="page_break_div"></div>
     <br>

    <div>

		<?
        	//echo signature_table(2, $cbo_company_name, "1330px");
			echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>

	<?
    if($link == 1){
        ?>
        <script type="text/javascript" src="../../../js/jquery.js"></script>
        <script type="text/javascript" src="../../../js/jquerybarcode.js"></script>
    <?
    }else {
        ?>
         <script type="text/javascript" src="../../js/jquery.js"></script>
        <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
        <?
    }
        ?>
    <script>
    fnc_generate_Barcode('<? echo $varcode_booking_no; ?>','barcode_img_id');

    </script>
  </html>
	<?

	$html = ob_get_contents();
	ob_clean();
	list($is_mail_send,$mail)=explode('___',$mail_send_data);
	if($is_mail_send==1){
		require_once('../../../mailer/class.phpmailer.php');
		require_once('../../../auto_mail/setting/mail_setting.php');
		$mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
			
		$mailToArr=array();
		$mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
		//echo $mailSql;die;
		$mailSqlRes=sql_select($mailSql);
		foreach($mailSqlRes as $rows){
			if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		}
		
		
		$mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=98 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
		//echo $mailSql;die;
		$mailSqlRes=sql_select($mailSql);
		foreach($mailSqlRes as $rows){
			if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		}
		if($mail!=''){$mailToArr[]=$mail;}
		
		$to=implode(',',$mailToArr);
		$subject="  Trims Booking Multi Job ";
		$header=mailHeader();
		echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
		
	}
	else{
		echo $html;
	}
	exit();

}
if($action=="show_trim_booking_report11") // Print Booking 11
{
	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	$user_name_arr=return_library_array( "select id,user_name from   user_passwd",'id','user_name');

	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	//$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");

	$sqlitem=sql_select("select id,order_uom,trim_uom  from lib_item_group");
	foreach($sqlitem as $row)
	{
		$order_uom_arr[$row[csf('id')]]=$row[csf('order_uom')];
		$cons_uom_arr[$row[csf('id')]]=$row[csf('trim_uom')];
	}
	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;
	//$revised_no_data=sql_select("select a.revised_no  from wo_booking_mst a where  a.booking_no=$txt_booking_no and  a.status_active =1 and a.is_deleted=0");
	//list($revised_no_row)=$revised_no_data;
		$booking_grand_total=0;
		$currency_id="";


		$buyer_string=array();
		$style_owner=array();
		$job_no=array();
		$style_ref=array();
		$all_dealing_marcent=array();
		$season=array();
		$order_repeat_no=array();
		$po_id_arr=array();

		$nameArray_buyer=sql_select( "select a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, b.po_break_down_id from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
        foreach ($nameArray_buyer as $result_buy){
			$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
			$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
			//$season[$result_buy[csf('job_no')]]=$season_arr[$result_buy[csf('season_matrix')]];
			$season_matrix=$result_buy[csf('season_matrix')];
			$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
			if($season_matrix!=0 && $season_buyer_wise==0 )
			{
				$season_matrix_con=$season_matrix;
			}
			else if($season_buyer_wise!=0 && $season_matrix==0)
			{
				$season_matrix_con=$season_buyer_wise;
			}
			$seasons_name.=$season_arr[$season_matrix_con].',';
			$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
			$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

			$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];
		}
		$style_sting=implode(",",array_unique($style_ref));
		$job_no=implode(",",$job_no);
		$seasons_names=rtrim($seasons_name,',');

		$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));
		$poid_arr=array_unique($po_id_arr);
		//$txt_order_no_id=array_unique($po_id_arr);
		$order_rept_no=rtrim($order_rept_no,',');
		$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));

		$po_no=array();
		$file_no=array();
		$ref_no=array();
		$po_quantity=array();
		$pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';
		$nameArray_job=sql_select( "select max(a.update_date) as update_date,b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, sum(b.po_quantity) as po_quantity  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no ");
        foreach ($nameArray_job as $result_job){
			$po_no[$result_job[csf('job_no_mst')]][$result_job[csf('id')]]=$result_job[csf('po_number')];
			$po_shipdate_arr[$result_job[csf('job_no_mst')]].=change_date_format($result_job[csf('pub_shipment_date')]).',';
			$file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
			$ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
			$po_quantity[$result_job[csf('id')]]=$result_job[csf('po_quantity')];
		//	$tot_po_quantity+=$result_job[csf('po_quantity')];
			$job_ref_no[$result_job[csf('job_no_mst')]].=$result_job[csf('grouping')].',';
			$job_file_no[$result_job[csf('job_no_mst')]].=$result_job[csf('file_no')].',';
			$po_no_arr[$result_job[csf('job_no_mst')]]['po_id'].=$result_job[csf('id')].',';
			$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
			$int_ref_no.=$result_job[csf('grouping')].',';
			if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];
			$revised_update_date=explode(" ",$result_job[csf('update_date')]);
			$revised_date=strtotime($revised_update_date[0]);

		}
		$sql_job=sql_select( "select b.job_no_mst,b.id as po_id, b.po_quantity as po_quantity  from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.") ");
		foreach ($sql_job as $row)
		{
			$job_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('po_id')]]+=$row[csf('po_quantity')];
			$tot_po_quantity+=$row[csf('po_quantity')];
		}

        $nameArray=sql_select( "select a.booking_no,a.inserted_by, a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.source, a.remarks, a.revised_no,a.update_date from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
		foreach( $nameArray as $row)
		{
			$varcode_booking_no=$row[csf('booking_no')];
			$booking_date=$row[csf('booking_date')];
			$delivery_date=$row[csf('delivery_date')];
			$pay_mode_id=$row[csf('pay_mode')];
			$supplier_id=$row[csf('supplier_id')];
			$currency_id=$row[csf('currency_id')];
			$buyer_id=$row[csf('buyer_id')];
			$exchange_rate=$row[csf('exchange_rate')];
			$attention=$row[csf('attention')];
			$remarks=$row[csf('remarks')];
			$revised_no=$row[csf('revised_no')];
			$mst_update_date=explode(" ",$row[csf('update_date')]);
			$mst_revised_date=strtotime($mst_update_date[0]);

			$source_id=$row[csf('source')];
			$inserted_by=$row[csf('inserted_by')];
		}
		//echo $inserted_by.'DD';
		if($revised_date!="" && $mst_revised_date!="")
		{
			$max_revised_date_time=max($revised_date,$mst_revised_date);
			$max_revised_date=date('d-m-Y',$max_revised_date_time);
		}
		else if($revised_date!="" && $mst_revised_date=="")
		{
			//$max_revised_date=$revised_date;
			$max_revised_date=date('d-m-Y',$revised_date);
		}
		else if($mst_revised_date!="" && $revised_date=="")
		{
			//$max_revised_date=$mst_revised_date;
			$max_revised_date=date('d-m-Y',$mst_revised_date);
		}
		//echo $max_revised_date.'DD';
		ob_start();
	?>
		<html>
		<head>
		<style type="text/css" media="print">
		/*table { page-break-inside:auto }*/
		/*
        @media print {
        thead {display: table-header-group;}
    }
	@media print {
			  #page_break_div {
				page-break-before: always;
			  }
	}
			.footer_signature {
				position: fixed;
				height: auto;
				bottom:0;
				width:100%;

				}
			@media print {
				table {
					page-break-inside: avoid;
				}
			}
			@media all {
  			#page_break_div   { display: none; }
			}*/

	</style>
	</head>



	<div style="width:1333px" align="center">

   <table width="1333px" cellpadding="0" cellspacing="0" style="border:0px solid black" >
   <thead>
       <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
           <tr>
               <td width="20px">
                    <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
                    <tr>
                    <td width="50" >
					   <? if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                                <img  src='../../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />

                       <?
                           }
                           else
                           {
                       ?>
                                <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                       <?	}
                       }
                       else
                       { ?>
                         <img  src='../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                      <? }
                       ?>
                   </td>
                    <td width="40px" align="center">
                    &nbsp;  &nbsp;  &nbsp;
                    </td>
                    <td width="30px"   align="center">

                   <b style="font-size:25px;"> <?
                    echo $company_library[$cbo_company_name]; ?>
                    </b>
                    <br>
                    <label>
                    	<?
                            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                            foreach ($nameArray as $result){
                            ?>
                              <?  if($result[csf('plot_no')]!='') echo $result[csf('plot_no')]; else echo '';?> &nbsp;
                                <? echo $result[csf('level_no')];?> &nbsp;
                                 <? echo $result[csf('road_no')]; ?>  &nbsp;
                                <? echo $result[csf('block_no')];?>  &nbsp;
                                <? echo $result[csf('city')];?>  &nbsp;
                                <? echo $result[csf('zip_code')]; ?>  &nbsp;
                                 <?php echo $result[csf('province')]; ?>  &nbsp;
                                <? echo $country_arr[$result[csf('country_id')]]; ?> &nbsp;<br/>
                                <? echo $result[csf('email')];?>  &nbsp;
                                <? echo $result[csf('website')];
								if($result[csf('plot_no')]!='')
								{
									$plot_no=$result[csf('plot_no')];
								}
								if($result[csf('level_no')]!='')
								{
									$level_no=$result[csf('level_no')];
								}
								if($result[csf('road_no')]!='')
								{
									$road_no=$result[csf('road_no')];
								}
								if($result[csf('block_no')]!='')
								{
									$block_no=$result[csf('block_no')];
								}
								if($result[csf('city')]!='')
								{
									$city=$result[csf('city')];
								}
								$company_address[$result[csf('id')]]=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
                            }
						?>
                        </label>
                        <br/>
                        <b style="font-size:20px;">
                         <?php echo $report_title; ?>
                        </b>
                    </td>
                     <td width="10px" align="center" style="font-size:20px;">
                      <table width="80%" align="right" cellpadding="0" cellspacing="0" style="border:0px solid black">
                      	<tr>
                            <td width="80">  Booking No:&nbsp; <?php echo $varcode_booking_no; ?>  </td>
                        </tr>
                        <tr>
                            <td>  Booking Date:&nbsp; <?php echo change_date_format($booking_date); ?>  </td>
                        </tr>
                        <?
                        if($revised_no>0)
						{
						?>
                        <tr>
                            <td>  Revised No:&nbsp; <?php echo $revised_no . '&nbsp(Date:' . change_date_format($max_revised_date) . ')'; ?>  </td>
                        </tr>
                        <?
						}
                        if(str_replace("'","",$id_approved_id) ==1)
						 {
						 ?>
                          <tr>
                             <td>Approved Status :&nbsp;  <? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </td>
                         </tr>
                         <?
						}
						 ?>
                      </table>

                     </td>
                   </tr>
                   </table>
               </td>
            </tr>
       </table>

		   <table width="100%" style="border:0px solid black;table-layout: fixed;">
				<tr>
					<td colspan="6" valign="top"></td>
				</tr>
				<tr>
					<td width="100" style="font-size:18px"><span><b>To, </b></span>  </td>
					<td width="110" colspan="5" style="font-size:18px">&nbsp;<span></span></td>
				</tr>
				<tr>

					<td width="210" colspan="2" style="font-size:18px">&nbsp; <b>
					<?
					if($pay_mode_id==5 || $pay_mode_id==3){
						echo $company_library[$supplier_id];
					}
					else{
						echo $supplier_name_arr[$supplier_id];
					}
					?></b>
					</td>
                    <td  width="100" style="font-size:12px"><b>Buyer.</b></td>
					<td  width="110" >:&nbsp;<? echo $buyer_name_arr[$buyer_id]; ?></td>
                    <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
					<td width="110">:&nbsp;<?  echo change_date_format($delivery_date); ?></td>
				</tr>
				<tr>

					<td width="110" colspan="2" rowspan="2" style="font-size:18px">Address :&nbsp;
					<?
					if($pay_mode_id==5 || $pay_mode_id==3){
						$address=$company_address[$supplier_id];
					}
					else{
						$address=$supplier_address_arr[$supplier_id];
					}
					echo $address;
					?></b>
					</td>
					<td width="100" style="font-size:12px"><b>PO Qty.</b>   </td>
					<td width="110">:&nbsp;<? echo $tot_po_quantity; ?></td>
                     <td style="font-size:12px" ><b>Delivery To </b>   </td>
					<td style="">:&nbsp;
					<?
						//echo $attention;
					?>
					</td>

				</tr>
                <tr>

                    <td width="100" style="font-size:12px"><b>Season</b> </td>
					<td width="110">:&nbsp;<? echo $seasons_names; ?></td>

                    <td width="100" style="font-size:12px"><b>Currency</b></td>
					<td width="110">:&nbsp;<?  echo $currency[$currency_id]; ?></td>

                </tr>
                <tr>
                    <td style="font-size:12px" ><b>Attention </b>   </td>
					<td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
					<?
						echo $attention;
					?>
					</td>
                    <td width="100" style="font-size:12px"><b>Order Repeat </b> </td>
					<td width="110">:&nbsp;<? echo $order_rept_no; ?></td>
                    <td  style="font-size:12px"><b>Pay mode</b></td>
                	<td>:&nbsp;<? echo $pay_mode[$pay_mode_id];?></td>

                </tr>

				 <tr>
                    <td style="font-size:12px"><b>Source</b></td>
                	<td>:&nbsp;<? echo $source[$source_id];?></td>
                    <td style="font-size:12px"><b>Dealing Merchant</b></td>
					<td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
					<?
						echo implode(",",array_unique($all_dealing_marcent));
					?>
					</td>
				</tr>
				<tr>
					<td width="100" style="font-size:12px"><b>Remarks</b>  </td>
					<td width="110" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" colspan="5">:&nbsp;<? echo $remarks; ?></td>

				</tr>
				</table>
    		</thead>
            <tbody>
            <!-- <div id="page_break_div">

            </div>-->


          <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?

		$precost_arr=array();
		$trims_qtyPerUnit_arr=array();

		$precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0");
        $calUom="";
		foreach($precost_sql as $precost_row){
			if($precost_row[csf('cal_parameter')]==1){
			   $calUom="Mtr";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==2){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==3){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==4){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==5){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==6){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==7){
			   $calUom="Pcs";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==8){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else{
				$calUom=0;
			}
			 $trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
		}
		$booking_country_arr=array();
		$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,sensitivity,country_id_string from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0");
		foreach($nameArray_booking_country as $nameArray_booking_country_row){
			$country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
			$tocu=count($country_id_string);
			for($cu=0;$cu<$tocu;$cu++){
				$booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
			}
		}

		$nameArray_job_po=sql_select( "select job_no from wo_booking_dtls  where booking_no='$txt_booking_no' and status_active =1 and is_deleted=0 group by job_no order by job_no ");
		foreach($nameArray_job_po as $nameArray_job_po_row){
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$nameArray_job_po_row[csf('job_no')]."'   and sensitivity=1 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
	    if(count($nameArray_item)>0){
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];//$po_quantity[$poid];
			}
			$shipdate=rtrim($po_shipdate_arr[$nameArray_job_po_row[csf('job_no')]],',');
			$shipdates=implode(",",array_unique(explode(",",$shipdate)));
        ?>
        &nbsp;
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >

            <tr>
                <td colspan="13" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" align="left"><strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; if($ref_nos!='' ) echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;else " ";if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;  Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>

                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td align="center" style="border:1px solid black"><strong>Cons</strong></td>
                <td align="center" style="border:1px solid black"><strong>Cons Uom</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? }?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item){
			$i++;
            $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_color,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount,sum(b.requirment*b.rate) as amt_cons from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center"  style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription){
                ?>
                <td style="border:1px solid black"><?  if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                 <td style="border:1px solid black; text-align:left">
               <? //echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                 <td style="border:1px solid black; text-align:left">
               <? $uom_cons_id=$cons_uom_arr[$result_item[csf('trim_group')]];
			  echo  $unit_of_measurement[$uom_cons_id];
			    ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?


				echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$item_wise_summery[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_itemdescription[csf('cons')];
				$item_wise_valueArr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_itemdescription[csf('amt_cons')];
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right" title="AVG Rate"><p><? echo number_format($result_itemdescription[csf('amt_cons')]/$result_itemdescription[csf('cons')],4);//$result_itemdescription[csf('rate')]; ?> </p></td>
                <td style="border:1px solid black; text-align:right">
                <?
               // $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				 $amount_as_per_gmts_color = $result_itemdescription[csf('amt_cons')];
				echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                  <? if($show_comment==1) {?>
                 <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					//echo number_format($item_desctiption_total ,4);
				 ?></td>
                  <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					//echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                  <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="11"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->


        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=2 and  status_active =1 and  is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                 <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Size Sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; echo "&nbsp;&nbsp;Int Ref.:".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";echo "&nbsp;&nbsp; Po Qty..:".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;margin-left:210px; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Article No</strong></td>
                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
			$i++;
			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,b.article_number,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size,b.article_number order by bid");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][2]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black">
				<?
				if($result_itemdescription[csf('article_number')]!="no article"){
					echo $result_itemdescription[csf('article_number')];
				}else{
					echo "-";
				}
				?>
                </td>
                <td style="border:1px solid black; text-align:left">
              <? echo $result_itemdescription[csf('item_size')];?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>


                <td style="border:1px solid black; text-align:right">
				<?
			/*	$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];
					if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
					{
						 echo number_format($result_itemdescription[csf('cons')],0);
					}
					else
					{
						 echo number_format($result_itemdescription[csf('cons')],4);
					}*/
					  echo number_format($result_itemdescription[csf('cons')],4);

                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$item_wise_summery[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_itemdescription[csf('cons')];
				$item_wise_valueArr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">

                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold"><?
			/*	if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
					{
						 echo number_format($item_desctiption_total,0);
					}
					else
					{
						echo number_format($item_desctiption_total,4);
					}*/
					echo number_format($item_desctiption_total,4);
				 ?></td>
                 <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=3 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>
        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by trim_group ", "item_color", "color_number_id"  );

			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,b.color_number_id order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   echo $color_library[$result_itemdescription[csf('color_number_id')]];
			   ?>
                </td>
               <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>

                <td style="border:1px solid black; text-align:right">
				<?
				/*$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];
				if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
				{
					echo number_format($result_itemdescription[csf('cons')],0);
				}
				else
				{
					echo number_format($result_itemdescription[csf('cons')],4);
				}*/
				echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')];
				$item_wise_summery[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_itemdescription[csf('cons')];
				$item_wise_valueArr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				
				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?></p> </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
			/*	if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
				{
					echo number_format($item_desctiption_total,0);
				}
				else
				{
					echo number_format($item_desctiption_total,4);
				}*/
				echo number_format($item_desctiption_total,4);
				 ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group");
	   if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));

			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" ><strong>Color & size sensitive (<? echo "Job NO: ".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]] ;echo "&nbsp;&nbsp;Int Ref.:&nbsp;".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group </strong> </td>


                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td style="border:1px solid black"><strong>Article No.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td style="border:1px solid black; width:170px;"><strong>Gmts Color</strong> </td>
                <td style="border:1px solid black;"><strong>Gmts Size</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by trim_group ", "item_color", "color_number_id"  );

			 $nameArray_color=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.color_number_id as gmt_color, b.item_color as color_number_id,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount, min(c.color_order) as color_order, min(c.size_order) as size_order,c.article_number from wo_booking_dtls a, wo_trim_book_con_dtls b,wo_po_color_size_breakdown c  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and b.po_break_down_id=c.po_break_down_id and b.color_number_id=c.color_number_id and b.gmts_sizes=c.size_number_id and  c.id=b.color_size_table_id and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.color_number_id>0 and c.article_number=b.article_number and a.sensitivity=4 and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.color_number_id, b.item_color,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,c.article_number order by c.article_number,color_order,size_order");



            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]." and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  status_active =1 and is_deleted=0 order by trim_group ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][4]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
				foreach($nameArray_color as $result_color)
                {
					?>

					<td style="border:1px solid black" ><? if($result_color[csf('description')]){echo $result_color[csf('description')];} ?> </td>
					<td style="border:1px solid black" ><? if($result_color[csf('brand_supplier')]){echo $result_color[csf('brand_supplier')]; }?> </td>
                    <td style="border:1px solid black">
					<?
					if($result_color[csf('article_number')]!="no article"){
						echo $result_color[csf('article_number')];
					}else{
						echo "-";
					}
					?>
                    </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('gmt_color')]];?> </td>
                    <td style="border:1px solid black; text-align:left">
					<? echo $size_library[$result_color[csf('gmts_sizes')]]; ?>
					</td>
					<td style="border:1px solid black; text-align:left">
					<? echo $result_color[csf('item_size')]; ?>
					</td>
                    <td style="border:1px solid black; text-align:left">
				   <?
				   $calUom=$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][2];
			       $calQty=explode("_",$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				   if($calUom && end($calQty)){
					   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
				   }
                   ?>
                    </td>

					<td style="border:1px solid black; text-align:right">
					<?
				/*	$uom_id=$order_uom_arr[$order_uom_arr[$result_item[csf('trim_group')]]];
					if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
					{
						echo number_format($result_color[csf('cons')],0);
					}
					else
					{
						echo number_format($result_color[csf('cons')],4);
					}*/
					echo number_format($result_color[csf('cons')],4);

					$item_desctiption_total += $result_color[csf('cons')] ;
					$item_wise_summery[$result_item[csf('trim_group')]][$result_color[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_color[csf('cons')];
					$item_wise_valueArr[$result_item[csf('trim_group')]][$result_color[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_color[csf('amount')];
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]];  ?></td>
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('rate')],4);
					?>
                     </td>
					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,4);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					$trims_remark=$trims_remark_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
					?>
					</td>
                     <? if($show_comment==1) {?>
                    <td style="border:1px solid black;text-align:center"><? echo $trims_remark; ?> </td>
                    <? } ?>
				</tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="10"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
			/*	if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
					{
						echo number_format($item_desctiption_total,0);
					}
					else
					{
						echo number_format($item_desctiption_total,4);
					}
					*/
				echo number_format($item_desctiption_total,4);  ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }

            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="13"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
       <?
		}
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->



         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=0 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				//echo $poid.', ';
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}

			//$po_quantity[$result_job[csf('id')]];
        ?>
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%">
                <tr>
                <td width="60%"><strong>NO sensitive  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                 </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td align="center" style="border:1px solid black"><strong> Qnty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                 <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                 <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color");
				
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">

                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);

				?>
                </td>
                <?
                $color_tatal=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
                $item_desctiption_total=0;
                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <?
				if($db_type==0)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.cons) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
						}
						if($db_type==2)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.cons) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
						}

                foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right">
                <?
				//$uom_arr=array(1,52,50,51,53,54,55,56,57,31,59,62,65,66,67,74,78,80);
				//print_r($uom_arr);
				$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];
				//echo $order_uom_id.'DD';
                if($result_color_size_qnty[csf('cons')]!= "")
                {

					/*	if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
						{
							 echo number_format($result_color_size_qnty[csf('cons')],0);
						}
						else
						{
							echo number_format($result_color_size_qnty[csf('cons')],4);
						}*/
               echo number_format($result_color_size_qnty[csf('cons')],4);
                $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                $color_tatal+=$result_color_size_qnty[csf('cons')];
				$item_wise_summery[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_color_size_qnty[csf('cons')];
				
				
                }
                else echo "";
                ?>
                </td>
                <?
                }
                ?>

                <td style="border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><p><? echo number_format($result_itemdescription[csf('rate')],4); ?> </p></td>
                <td style="border:1px solid black; text-align:right">
                <?
				
				
                $amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				
				$item_wise_valueArr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$amount_as_per_gmts_color;
				
								
                ?>
                </td>
                 <? if($show_comment==1) {?>
                 <td style="border:1px solid black; text-align:right"><? echo $trims_remark; ?> </td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;">
                <?
                if($color_tatal !='')
                {
					/*	if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
						{
						 echo number_format($color_tatal,0);
						}
						else
						{
							 echo number_format($color_tatal,4);
						}*/
						 echo number_format($color_tatal,4);
                }
                ?>
                </td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
		//	print_r($item_wise_valueArr2);
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="9"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <?
		}
		}
		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->

		
		
			<table border="1" align="left" class="rpt_table" cellpadding="0" width="1080px" cellspacing="0" rules="all" >
				<tr>
					<th colspan="6"><strong>Summary</strong> </th>					
				</tr>
				<tr>
					<th width="30" style="border:1px solid black"><strong>Sl</strong> </th>
					<th width="300" style="border:1px solid black"><strong>Item Group </strong> </th>
                    <th width="350" style="border:1px solid black"><strong>Description</strong> </th>
					<th width="100" align="center" style="border:1px solid black"><strong>UOM</strong> </th>
					<th width="150" style="border:1px solid black"><strong>WO Qty.</strong> </th>
                    <th style="border:1px solid black"><strong>Total Amount</strong> </th>

				</tr>
				<?php
				// $item_wise_summery[$result_item[csf('trim_group')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_color_size_qnty[csf('cons')];
				$sl=1;$tot_item_wise_value=0;
				foreach($item_wise_summery as $item_id => $desc_data){ 
					foreach($desc_data as $desc => $uom_data){
							foreach($uom_data as $uom => $row){
						$item_wise_value=$item_wise_valueArr[$item_id][$desc][$uom];
						?>
					<tr>
						<td style="border:1px solid black; word-break:break-all"><?=$sl;?> </td>
						<td style="border:1px solid black; word-break:break-all"><?=$trim_group_library[$item_id];?> </td>
                        <td align="center" style="border:1px solid black; word-break:break-all"><?=$desc;?></td>
						<td align="center" style="border:1px solid black"><?=$unit_of_measurement[$uom];?></td>
						<td align="right" style="border:1px solid black"> <?=number_format($row,4);?></td>
                        <td align="right" style="border:1px solid black"> <?=number_format($item_wise_value,4);?></td>
					</tr>
				<?
				$sl++;
				$tot_item_wise_value+=$item_wise_value;
					}
				}
			}?>
            <tr>
                <td align="right" style="border:1px solid black" colspan="5"><b>Total Amount</b></td>
                <td align="right" style="border:1px solid black"><b><?=number_format($tot_item_wise_value,4);?></b></td>
            </tr>
		</table>
		<br/>
       <?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>
       <br/>
       <table width="1080px" align="left" style="margin-top:1px" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                <td width="70%" style="border:1px solid black; text-align:left"><? echo number_format($booking_grand_total,2);?></td>
            </tr>
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                <td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
            </tr>
       </table>
         <br/>
        <table width="100%">
        <tr>
        <td width="49%">
        <?=get_spacial_instruction($txt_booking_no); ?>
    	</td>
    <td width="2%"></td>
    <?
	$lib_designation_arr=return_library_array(" select id,custom_designation from lib_designation","id","custom_designation");
	$user_lib_designation_arr=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
	$user_lib_name_arr=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");

	$mst_id=return_field_value("id as mst_id","wo_booking_mst","booking_no='$txt_booking_no'","mst_id");
	//echo $mst_id.'ssD';
	//and b.un_approved_date is null
	 $approve_data_array=sql_select("select b.approved_by,min(b.approved_date) as approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=8  group by  b.approved_by order by b.approved_by asc");
	// echo "select b.approved_by,min(b.approved_date) as approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=8  group by  b.approved_by order by b.approved_by asc";
	 $unapprove_data_array=sql_select("select b.approved_by,b.approved_date,b.un_approved_reason,b.un_approved_date,b.approved_no from   approval_history b where b.mst_id=$mst_id and b.entry_form=8  order by b.approved_date,b.approved_by");

	?>
    <td width="49%" valign="top">
	<?
          if(count($approve_data_array)>0)
			{
 		?>
       <table  width="850" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>
            <tr style="border:1px solid black;">
                <th colspan="5" style="border:1px solid black;">Approval Status</th>
                </tr>
                <tr style="border:1px solid black;">
                <th width="3%" style="border:1px solid black;">Sl</th>
				<th width="40%" style="border:1px solid black;">Name</th>
				<th width="30%" style="border:1px solid black;">Designation</th>
				<th width="27%" style="border:1px solid black;">Approval Date</th>

                </tr>
            </thead>
            <tbody>
            <?
			$i=1;
			foreach($approve_data_array as $row){


			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
				<td width="40%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
				<td width="27%" style="border:1px solid black;text-align:center"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')]));?></td>

                </tr>
                <?
				$i++;
			}
				?>
            </tbody>
        </table>
		<?
		}
		?>
		<br>
		<?
		if(count($unapprove_data_array)>0)
		{
			$sql_unapproved=sql_select("select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=8 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id=$mst_id");
			$unapproved_request_arr=array();
			foreach($sql_unapproved as $rowu)
			{
			$unapproved_request_arr[$rowu[csf('booking_id')]]=$rowu[csf('approval_cause')];
			}
 		?>
       <table  width="850" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>
            <tr style="border:1px solid black;">
                <th colspan="6" style="border:1px solid black;">Approval/Un Approval History</th>
                </tr>
                <tr style="border:1px solid black;">
                <th width="3%" style="border:1px solid black;">Sl</th>
				<th width="30%" style="border:1px solid black;">Name</th>
				<th width="20%" style="border:1px solid black;">Designation</th>
				<th width="5%" style="border:1px solid black;">Approval Status</th>
				<th width="20%" style="border:1px solid black;">Reason For Un Approval</th>
				<th width="22%" style="border:1px solid black;"> Date</th>

                </tr>
            </thead>
            <tbody>
            <?
			$i=1;
			foreach($unapprove_data_array as $row){

			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
				<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
				<td width="5%" style="border:1px solid black; text-align:center"><? echo 'Yes';?></td>
				<td width="20%" style="border:1px solid black;"><? echo '';?></td>
				<td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); else echo "";?></td>
            </tr>
				<?
				$i++;
				$un_approved_date= explode(" ",$row[csf('un_approved_date')]);
				$un_approved_date=$un_approved_date[0];
				if($db_type==0) //Mysql
				{
					if($un_approved_date=="" || $un_approved_date=="0000-00-00") $un_approved_date="";else $un_approved_date=$un_approved_date;
				}
				else
				{
					if($un_approved_date=="") $un_approved_date="";else $un_approved_date=$un_approved_date;
				}

				if($un_approved_date!="")
				{
				?>
			<tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
				<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
				<td width="5%" style="border:1px solid black;text-align:center;"><? echo 'No';?></td>
				<td width="20%" style="border:1px solid black;text-align:center"><? echo $unapproved_request_arr[$mst_id];?></td>
				<td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('un_approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('un_approved_date')])); else echo "";?></td>
              </tr>

                <?
				$i++;
				}

			}
				?>
            </tbody>
        </table>
		<?
		}
		?>
    </td>
    </tr>
    </table>

   	 </tbody>
     </table>

    </div> <!--class="footer_signature"-->
	<div align="left"><b>Prepared By: &nbsp; <? echo $user_name_arr[$inserted_by];?></b></div>
    <div >

         <?
          echo signature_table(132, $cbo_company_name, "1330px",1);

		 ?>
      	</div>
        <br>
      <div id="page_break_div"></div>
     <br>

    <div>

		<?
        	//echo signature_table(2, $cbo_company_name, "1330px");
			echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>

	<?
    if($link == 1){
        ?>
        <script type="text/javascript" src="../../../js/jquery.js"></script>
        <script type="text/javascript" src="../../../js/jquerybarcode.js"></script>
    <?
    }else {
        ?>
         <script type="text/javascript" src="../../js/jquery.js"></script>
        <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
        <?
    }
        ?>
    <script>
    fnc_generate_Barcode('<? echo $varcode_booking_no; ?>','barcode_img_id');

    </script>
  </html>
	<?
	    $html = ob_get_contents();
		ob_clean();
		list($is_mail_send,$mail)=explode('___',$mail_send_data);
		if($is_mail_send==1){
			require_once('../../../mailer/class.phpmailer.php');
			require_once('../../../auto_mail/setting/mail_setting.php');
			$mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
				
			$mailToArr=array();
			$mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
			//echo $mailSql;die;
			$mailSqlRes=sql_select($mailSql);
			foreach($mailSqlRes as $rows){
				if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
			}
			
			
			$mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=97 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
			//echo $mailSql;die;
			$mailSqlRes=sql_select($mailSql);
			foreach($mailSqlRes as $rows){
				if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
			}
			
			if($mail!=''){$mailToArr[]=$mail;}
			$to=implode(',',$mailToArr);
			$subject="Trims Booking Multy Job";
			$header=mailHeader();
			echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
			
		}
		else{
			echo $html;
		}
		exit();
}
if($action=="show_trim_booking_report3")
{
	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');

	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");
	$lib_user=return_library_array("select id,user_full_name from user_passwd","id","user_full_name");

	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;
	//$revised_no_data=sql_select("select a.revised_no  from wo_booking_mst a where  a.booking_no=$txt_booking_no and  a.status_active =1 and a.is_deleted=0");
	//list($revised_no_row)=$revised_no_data;
		$booking_grand_total=0; $currency_id="";

		$buyer_string=array(); $style_owner=array(); $job_no=array(); $style_ref=array(); $all_dealing_marcent=array(); $season=array(); $order_repeat_no=array(); $po_id_arr=array();

		$nameArray_buyer=sql_select( "select  a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, b.po_break_down_id from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
        foreach ($nameArray_buyer as $result_buy){
			$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
			$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
			//$season[$result_buy[csf('job_no')]]=$season_arr[$result_buy[csf('season_matrix')]];
			$season_matrix=$result_buy[csf('season_matrix')];
			$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
			if($season_matrix!=0 && $season_buyer_wise==0 )
			{
				$season_matrix_con=$season_matrix;
			}
			else if($season_buyer_wise!=0 && $season_matrix==0)
			{
				$season_matrix_con=$season_buyer_wise;
			}
			$seasons_name.=$season_arr[$season_matrix_con].',';
			$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
			$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

			$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];
		}
		$style_sting=implode(",",array_unique($style_ref));
		$job_no_str = "'" . implode( "','", $job_no ) . "'";
		$job_no=implode(",",$job_no);
		$seasons_names=rtrim($seasons_name,',');

		$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));
		$poid_arr=array_unique($po_id_arr);

		$order_rept_no=rtrim($order_rept_no,',');
		$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));
		$main_fabric_approved = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and a.job_no in (".$job_no_str.") and b.entry_form=7 and a.status_active =1 and a.is_deleted=0 order by b.id asc");


		$po_no=array(); $file_no=array(); $ref_no=array(); $po_quantity=array();
		$pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';
		$nameArray_job=sql_select( "select b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, sum(b.po_quantity) as po_quantity  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no ");
        foreach ($nameArray_job as $result_job){
			$po_no[$result_job[csf('job_no_mst')]][$result_job[csf('id')]]=$result_job[csf('po_number')];
			$file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
			$ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
			$po_quantity[$result_job[csf('id')]]=$result_job[csf('po_quantity')];
		//	$tot_po_quantity+=$result_job[csf('po_quantity')];
			$job_ref_no[$result_job[csf('job_no_mst')]].=$result_job[csf('grouping')].',';
			$job_file_no[$result_job[csf('job_no_mst')]].=$result_job[csf('file_no')].',';
			$po_no_arr[$result_job[csf('job_no_mst')]]['po_id'].=$result_job[csf('id')].',';
			$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
			$int_ref_no.=$result_job[csf('grouping')].',';
			if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];

		}
			//echo $po_idss.'DDDDDDDDD';
		$sql_job=sql_select( "select b.job_no_mst,b.id as po_id, b.po_quantity as po_quantity  from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.") ");
		foreach ($sql_job as $row)
		{
			$job_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('po_id')]]+=$row[csf('po_quantity')];
			$tot_po_quantity+=$row[csf('po_quantity')];
		}

        $nameArray=sql_select( "select a.booking_no, a.is_approved,a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_address, a.delivery_date, a.source, a.remarks, a.revised_no,a.inserted_by,a.insert_date from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
		foreach( $nameArray as $row)
		{
			$varcode_booking_no=$row[csf('booking_no')];
			$booking_date=$row[csf('booking_date')];
			$delivery_date=$row[csf('delivery_date')];
			$pay_mode_id=$row[csf('pay_mode')];
			$supplier_id=$row[csf('supplier_id')];
			$currency_id=$row[csf('currency_id')];
			$buyer_id=$row[csf('buyer_id')];
			$exchange_rate=$row[csf('exchange_rate')];
			$attention=$row[csf('attention')];
			$remarks=$row[csf('remarks')];
			$delivery_address=$row[csf('delivery_address')];
			$revised_no=$row[csf('revised_no')];
			$source_id=$row[csf('source')];
			$is_approved=$row[csf('is_approved')];
		}
		$approved_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name, b.id from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0 order by b.id asc");

	 $sql_date_update=sql_select("SELECT a.updated_by, a.booking_no,a.update_date
				  FROM wo_booking_dtls a, wo_booking_dtls b
				 WHERE a.booking_no = b.booking_no AND a.update_date >= b.update_date
				 and a.booking_no='$txt_booking_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.update_date desc");
	 $sql_date_insert=sql_select("SELECT a.inserted_by, a.booking_no,a.insert_date
						  FROM wo_booking_dtls a, wo_booking_dtls b
						 WHERE a.booking_no = b.booking_no AND a.insert_date <= b.insert_date
						 and a.booking_no='$txt_booking_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.insert_date");
	
	ob_start();
	
	?>
	<table width="100%"  cellpadding="0" cellspacing="0" style="border:0px solid black">
       		<tr>
                <td width="20px">
                    <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
                    <tr>
                    <td width="50" >
                       <? if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                                <img  src='../../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />

                       <?
                           }
                           else
                           {
                       ?>
                                <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
                       <?	}
                       }
                       else
                       { ?>
                         <img  src='../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
                      <? }
                       ?>
                   </td>
                    <td width="40px" align="center">
                    &nbsp;  &nbsp;  &nbsp;
                    </td>
                    <td width="30px"   align="center">

                   <b style="font-size:25px;"> <?
                    echo $company_library[$cbo_company_name]; ?>
                    </b>
                    <br>
                    <label>
                        <?
                            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,bin_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                            foreach ($nameArray as $result){
                            ?>
                              <?  if($result[csf('plot_no')]!='') echo $result[csf('plot_no')]; else echo '';?> &nbsp;
                                <? echo $result[csf('level_no')];?> &nbsp;
                                 <? echo $result[csf('road_no')]; ?>  &nbsp;
                                <? echo $result[csf('block_no')];?>  &nbsp;
                                <? echo $result[csf('city')];?>  &nbsp;
                                <? echo $result[csf('zip_code')]; ?>  &nbsp;
                                 <?php echo $result[csf('province')]; ?>  &nbsp;
                                <? echo $country_arr[$result[csf('country_id')]]; ?> &nbsp;<br/>
                                <? echo $result[csf('email')];?>  &nbsp;
                                <? echo $result[csf('website')];
                                if($result[csf('plot_no')]!='')
                                {
                                    $plot_no=$result[csf('plot_no')];
                                }
                                if($result[csf('level_no')]!='')
                                {
                                    $level_no=$result[csf('level_no')];
                                }
                                if($result[csf('road_no')]!='')
                                {
                                    $road_no=$result[csf('road_no')];
                                }
                                if($result[csf('block_no')]!='')
                                {
                                    $block_no=$result[csf('block_no')];
                                }
                                if($result[csf('city')]!='')
                                {
                                    $city=$result[csf('city')];
                                }
                                $company_address[$result[csf('id')]]=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
								if($result[csf('bin_no')]!='') echo "<br> BIN:".$result[csf('bin_no')];
                            }
                        ?>
                        </label>
                        <br/>
                        <b style="font-size:20px;">
                         <?php echo $report_title; ?>
                        </b>
                    </td>
                     <td width="10px" align="center" style="font-size:20px;">
                      <table width="80%" align="right" cellpadding="0" cellspacing="0" style="border:0px solid black">
                        <tr>
                            <td width="80">  Booking No:&nbsp; <?php echo $varcode_booking_no; ?>  </td>
                        </tr>
                        <tr>
                            <td>  Booking Date:&nbsp; <?php echo change_date_format($booking_date); ?>  </td>
                        </tr>
                        <?
                        if($revised_no>0)
                        {
                        ?>
                        <tr>
                            <td>  Revised No:&nbsp; <?php echo $revised_no; ?>  </td>
                        </tr>
                        <?
                        }
                        //if(str_replace("'","",$id_approved_id) ==1)
                        // {
                         ?>
                          <tr>
                              <td>Approved Status :&nbsp;  <? 
							 if($is_approved ==1){ echo "(Approved)";} 
							 else if($is_approved ==3){ echo "(Partial Approved)";} else{echo "";}; ?> 
                             </td>
                         </tr>
                         <?
                       // }
                         ?>
                      </table>
                     </td>
                   </tr>
                   </table>
                </td>
        	</tr>
            <tr>
            <td>

            	<table width="1320"  style="border:0px solid black;table-layout: fixed;">
                <tr>
                    <td colspan="6" valign="top"> </td>
                </tr>
                <tr>
                    <td width="100" style="font-size:18px" align="left"><span><b>To, </b></span>  </td>
                    <td width="110" colspan="5" style="font-size:18px">&nbsp;<span></span></td>
                </tr>
            	<tr>
                    <td width="210" colspan="2" align="left" style="font-size:18px">&nbsp; <b>
                    <?
                    if($pay_mode_id==5 || $pay_mode_id==3){
                        echo $company_library[$supplier_id];
                    }
                    else{
                        echo $supplier_name_arr[$supplier_id];
                    }
                    ?></b>
                    </td>
                    <td  width="100" style="font-size:12px"><b>Buyer</b></td>
                    <td  width="110" align="left">:&nbsp;<? echo $buyer_name_arr[$buyer_id]; ?></td>
                    <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
                    <td width="110" align="left">:&nbsp;<?  echo change_date_format($delivery_date); ?></td>
           	   </tr>
              <tr>
                <td width="100" colspan="2" rowspan="2" align="left" style="font-size:18px">Address :&nbsp;
                <b>
                <?
                if($pay_mode_id==5 || $pay_mode_id==3){
                    $address=$company_address[$supplier_id];
                }
                else{
                    $address=$supplier_address_arr[$supplier_id];
                }
                echo $address;
                ?></b>
                </td>
                <td width="100" style="font-size:12px"><b>PO Qty.</b> </td>
                <td width="110" align="left">:&nbsp;<? echo $tot_po_quantity; ?></td>
                <td style="font-size:12px" ><b>Delivery To </b> </td>
                <td style="" align="left">:&nbsp;
                <?
                    echo $delivery_address;
                ?>
                </td>
             </tr>
            <tr>
                <td width="100" style="font-size:12px"><b>Season</b> </td>
                <td width="110" align="left">:&nbsp;<? echo $seasons_names; ?></td>
                <td width="100" style="font-size:12px"><b>Currency</b></td>
                <td width="110" align="left">:&nbsp;<?  echo $currency[$currency_id]; ?></td>
            </tr>
            <tr>
                <td width="100" style="font-size:12px" align="left"><b>Attention </b>   </td>
                <td align="left" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
                <?
                    echo $attention;

                ?>
                </td>
                <td width="100" style="font-size:12px"><b>Order Repeat </b> </td>
                <td width="110" align="left">:&nbsp;<? echo $order_rept_no; ?></td>
                <td  style="font-size:12px"><b>Pay mode</b></td>
                <td align="left">:&nbsp;<? echo $pay_mode[$pay_mode_id];?></td>
            </tr>
             <tr>
                <td width="100" style="font-size:12px" align="left"><b>Source</b></td>
                <td align="left" >:&nbsp;<? echo $source[$source_id];?></td>
                <td style="font-size:12px"><b>Dealing Merchant</b></td>
                <td align="left" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
                <?
                    echo implode(",",array_unique($all_dealing_marcent));
                ?>
                </td>
                <td>Insert By</td>
                <td title="<?=$sql_date_insert[0][csf('insert_date')];?>">:&nbsp;<?=$lib_user[$sql_date_insert[0][csf('inserted_by')]]?></td>
            </tr>
            <tr>
                <td width="100" style="font-size:12px" align="left"><b>Remarks</b>  </td>
                <td align="left" width="110" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" >:&nbsp;<? echo $remarks; ?></td>
                <td width="130" style="font-size:12px" align="left"><b>Main Fabric Booking 1<sup>st</sup> Approved Date</b></td>
                <td align="left">:&nbsp;<?  echo change_date_format($main_fabric_approved[0][csf('approved_date')]); ?></td>
                <td>Last Update By</td>
                <td title="<?=$sql_date_update[0][csf('update_date')];?>">:&nbsp;<?=$lib_user[$sql_date_update[0][csf('updated_by')]]?> </td>
            </tr>
            </table>
            </td>
            </tr>
          	</table>
          <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?

		$precost_arr=array();
		$trims_qtyPerUnit_arr=array();

		$precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0");
        $calUom="";
		foreach($precost_sql as $precost_row){
			if($precost_row[csf('cal_parameter')]==1){
			   $calUom="Mtr";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==2){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==3){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==4){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==5){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==6){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==7){
			   $calUom="Pcs";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==8){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else{
				$calUom=0;
			}
			 $trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
		}
		$booking_country_arr=array();
		$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,sensitivity,country_id_string from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0");
		foreach($nameArray_booking_country as $nameArray_booking_country_row){
			$country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
			$tocu=count($country_id_string);
			for($cu=0;$cu<$tocu;$cu++){
				$booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
			}
		}

		$nameArray_job_po=sql_select( "select job_no from wo_booking_dtls  where booking_no='$txt_booking_no' and status_active =1 and is_deleted=0 group by job_no order by job_no ");
		foreach($nameArray_job_po as $nameArray_job_po_row){
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$nameArray_job_po_row[csf('job_no')]."'   and sensitivity=1 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
	    if(count($nameArray_item)>0){
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];//$po_quantity[$poid]; 
			}
        ?>

        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="11" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" align="left"><strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; if($ref_nos!='' ) echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;else " ";if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;  Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				  <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? }?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item){
			$i++;
            $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_color,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.rate*b.requirment) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center"  style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription){
                ?>
                <td style="border:1px solid black"><?  if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?

				echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right" title="Avg Rate"><? echo number_format( $result_itemdescription[csf('amount')]/$result_itemdescription[csf('cons')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('amount')];
				// $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>

                 <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

					echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="8"><strong>Total</strong></td>
				  <? if($show_comment==1) {?>
				 <td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->


        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=2 and  status_active =1 and  is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                 <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Size Sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; echo "&nbsp;&nbsp;Int Ref.:".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp; Po Qty..:".$po_no_qty; ?></strong></td>
                <td width="40%" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Article No</strong></td>
                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
			$i++;
			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,b.article_number,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size,b.article_number order by bid");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][2]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black">
				<?
				if($result_itemdescription[csf('article_number')]!="no article"){
					echo $result_itemdescription[csf('article_number')];
				}else{
					echo "-";
				}
				?>
                </td>
                <td style="border:1px solid black; text-align:left">
              <? echo $result_itemdescription[csf('item_size')];?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>


                <td style="border:1px solid black; text-align:right">
				<?

					  echo number_format($result_itemdescription[csf('cons')],4);

                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">

                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>

                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold"><?

					echo number_format($item_desctiption_total,4);
				 ?></td>
                 <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="9"><strong>Total</strong></td>
				 <? if($show_comment==1) {?>
					<td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=3 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>
        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>

                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by trim_group ", "item_color", "color_number_id"  );

			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,sum(b.amount) as amount,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,b.color_number_id order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   echo $color_library[$result_itemdescription[csf('color_number_id')]];
			   ?>
                </td>
               <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>

                <td style="border:1px solid black; text-align:right">
				<?
				echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('amount')]/$result_itemdescription[csf('cons')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('amount')];//$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>

                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?></p> </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				echo number_format($item_desctiption_total,4);
				 ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="9"><strong>Total</strong></td>
				<? if($show_comment==1) {?>
				<td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group");
	   if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));

			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" ><strong>Color & size sensitive (<? echo "Job NO: ".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]] ;echo "&nbsp;&nbsp;Int Ref.:&nbsp;".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group </strong> </td>


                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td style="border:1px solid black"><strong>Article No.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td style="border:1px solid black; width:170px;"><strong>Gmts Color</strong> </td>
                <td style="border:1px solid black;"><strong>Gmts Size</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;

            foreach($nameArray_item as $result_item)
            {

				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by trim_group ", "item_color", "color_number_id"  );

			 $nameArray_color=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.color_number_id as gmt_color, b.item_color as color_number_id,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount, min(c.color_order) as color_order, min(c.size_order) as size_order,c.article_number from wo_booking_dtls a, wo_trim_book_con_dtls b,wo_po_color_size_breakdown c  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and b.po_break_down_id=c.po_break_down_id and b.color_number_id=c.color_number_id and b.gmts_sizes=c.size_number_id and  c.id=b.color_size_table_id and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=4 and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.color_number_id, b.item_color,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,c.article_number order by c.article_number,color_order,size_order");



            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]." and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  status_active =1 and is_deleted=0 order by trim_group ");

            if(count($nameArray_color)>0){
            	$i++; ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][4]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                /*echo '<pre>';
            	print_r($nameArray_color);*/

				foreach($nameArray_color as $result_color)
                {
					?>

					<td style="border:1px solid black" ><? if($result_color[csf('description')]){echo $result_color[csf('description')];} ?> </td>
					<td style="border:1px solid black" ><? if($result_color[csf('brand_supplier')]){echo $result_color[csf('brand_supplier')]; }?> </td>
                    <td style="border:1px solid black">
					<?
					if($result_color[csf('article_number')]!="no article"){
						echo $result_color[csf('article_number')];
					}else{
						echo "-";
					}
					?>
                    </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('gmt_color')]];?> </td>
                    <td style="border:1px solid black; text-align:left">
					<? echo $size_library[$result_color[csf('gmts_sizes')]]; ?>
					</td>
					<td style="border:1px solid black; text-align:left">
					<? echo $result_color[csf('item_size')]; ?>
					</td>
                    <td style="border:1px solid black; text-align:left">
				   <?
				   $calUom=$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][2];
			       $calQty=explode("_",$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				   if($calUom && end($calQty)){
					   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
				   }
                   ?>
                    </td>

					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('cons')],4);
					$item_desctiption_total += $result_color[csf('cons')] ;
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]];  ?></td>
					<? if($show_comment==1) {?>
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('rate')],4);
					?>
                     </td>

					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,2);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					$trims_remark=$trims_remark_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
					?>
					</td>

                    <td style="border:1px solid black;text-align:center"><? echo $trims_remark; ?> </td>
                    <? } ?>
				</tr>
            	<?
            	}
            	?>
            	<tr>
	                <td style="border:1px solid black;  text-align:right" colspan="10"><strong> Item Total</strong></td>
	                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					echo number_format($item_desctiption_total,4);  ?></td>
	                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
					<? if($show_comment==1) {?>
	                <td style="border:1px solid black; text-align:right"></td>

	                <td style="border:1px solid black; text-align:right">
	                <?
	                echo number_format($total_amount_as_per_gmts_color,2);
	                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
	                ?>
	                </td>

	                <td>&nbsp;  </td>
	                <? } ?>
            	</tr>
            <?
            }
        	}

            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="<? echo ($show_comment==1) ? 13 : 11; ?>"><strong>Total</strong></td>
				<? if($show_comment==1) {?>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp;  </td>
                <? } else{ ?>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                <? } ?>
            </tr>
        </table>
        <br/>
       <?
		}
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->

         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=0 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				//echo $poid.', ';
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}

			//$po_quantity[$result_job[csf('id')]];
			if($show_comment==1) $tdColspan=6; else $tdColspan=3;
        ?>
        <table border="1" align="left" class="rpt_table" cellpadding="0" width="1320" cellspacing="0" style="table-layout: fixed;"  rules="all" >
            <tr>
                <td colspan="5" width="645" style="word-break:break-all; "><strong>NO sensitive  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="530" colspan="<?=$tdColspan;?>" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
            </tr>
            <tr>
                <td width="25" style="border:1px solid black"><strong>Sl</strong> </td>
                <td width="120" style="border:1px solid black"><strong>Item Group</strong> </td>
                <td width="200" style="border:1px solid black"><strong>Item Description</strong> </td>
                <td width="150" style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td width="150" style="border:1px solid black"><strong>Item Color</strong> </td>
                <td width="80" align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td width="100" align="center" style="border:1px solid black"><strong>Qty</strong></td>
                <td width="80" style="border:1px solid black" align="center"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td width="80" style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td width="100" style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <td width="220" style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                 <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color");
				?>
				<tr>
					<td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>"><? echo $i; ?></td>
					<td align="center" style="word-break:break-all; border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
						<?
						echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
						echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);
						?>
					</td>
					<?
					$color_tatal=0;
					$total_amount_as_per_gmts_color=0;
					foreach($nameArray_item_description as $result_itemdescription)
					{
						$item_desctiption_total=0;
						?>
						<td style="word-break:break-all; border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
						<td style="word-break:break-all; border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
						<td style="word-break:break-all; border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
						<td style="word-break:break-all; border:1px solid black; text-align:left">
						<?
						$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
						$calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
						$calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
						if($calUom && end($calQty)){
						echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
						?>
						</td>
						<?
					}

					if($db_type==0)
					{
					 $nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
					}
					if($db_type==2)
					{
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
					}

					foreach($nameArray_color_size_qnty as $result_color_size_qnty)
					{
						?>
						<td style="word-break:break-all; border:1px solid black; text-align:right">
						<?
						if($result_color_size_qnty[csf('cons')]!= "")
						{
							echo number_format($result_color_size_qnty[csf('cons')],4);
							$item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
							$color_tatal+=$result_color_size_qnty[csf('cons')];
						}
						else echo "";
						?>
						</td>
						<?
					}
					?>
					<td style="word-break:break-all; border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
					<? if($show_comment==1)
					{
						?>
						<td style="word-break:break-all; border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
						<td style="word-break:break-all; border:1px solid black; text-align:right">
						<?
							$amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
							$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
						?>
						</td>
						<td style="word-break:break-all; border:1px solid black; text-align:right"><? echo $trims_remark; ?> </td>
					<? } ?>
				</tr>
				<?
				}
				?>
				<tr>
					<td style="border:1px solid black; text-align:right"></td>
					<td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
					<td style="border:1px solid black;  text-align:right; font-weight:bold;"><? if($color_tatal !='') echo number_format($color_tatal,4); ?></td>
					<td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
					<? if($show_comment==1)
					{?>
						<td style="border:1px solid black; text-align:right"></td>
						<td style="border:1px solid black; text-align:right">
						<?
						echo number_format($total_amount_as_per_gmts_color,2);
						$grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
						?>
						</td>
						<td>&nbsp;</td>
					<? } ?>
				</tr>
				<?
				}
				?>
				<tr>
					<td align="right" style="border:1px solid black"  colspan="8"><strong>Total</strong></td>
					<? if($show_comment==1) {?>
					<td>&nbsp;</td>
					<td style="border:1px solid black;  text-align:right"><? echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
					<td>&nbsp;</td>
				</tr>
        <? } ?>
        </table>
        <?
		}
		}
		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->

		

       <?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>

           <table border="1" align="left" class="rpt_table" cellpadding="0" width="1320" cellspacing="0" rules="all">
                <tr style="border:1px solid black;">
                    <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                    <td width="70%" style="border:1px solid black; text-align:left"><? echo number_format($booking_grand_total,2);?></td>
                </tr>
                <tr style="border:1px solid black;">
                    <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                    <td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
                </tr>
           </table>
         <br/>
        <table width="1320">
            <tr>
                <td width="470" style="word-break:break-all"><? echo get_spacial_instruction($txt_booking_no); ?></td>
                <td width="10">&nbsp;</td>
                <td width="450" valign="top">
                    <table width="440" class="rpt_table" border="1" cellpadding="0" cellspacing="0" rules="all">
                        <tr style="border:1px solid black;">
                            <td colspan="4" style="border:1px solid black;">Approval Status</td>
                        </tr>
                        <tr style="border:1px solid black;">
                            <td width="20" style="border:1px solid black;">Sl</td>
                            <td width="180" style="border:1px solid black;">Name</td>
                            <td width="100" style="border:1px solid black;">Approval Date</td>
                            <td style="border:1px solid black;">Approval No</td>
                        </tr>
                        <?
                        $i;
                        foreach($approved_array as $row){
                            ?>
                            <tr style="border:1px solid black;">
                                <td style="border:1px solid black;"><? echo $i;?></td>
                                <td style="border:1px solid black;"><? echo $row[csf('user_full_name')];?></td>
                                <td style="border:1px solid black;"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); ;?></td>
                                <td style="border:1px solid black;"><? echo $row[csf('approved_no')];?></td>
                            </tr>
                            <?
                            $i++;
                        }
                        ?>
                    </table>
                </td>
            </tr>
        </table>
	  <br>
        <?
        //------------------------------ Query for TNA start-----------------------------------

	//------------------------------ Query for TNA end-----------------------------------
		?>
    <div  style="margin-top:-50px;">
         <?
          echo signature_table(132, $cbo_company_name, "1320px",1);
		 ?>
   </div>
     <!-- <div id="page_break_div"></div> -->
    <div>
		<?
        	//echo signature_table(2, $cbo_company_name, "1330px");
			echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>
	<?
  	$html = ob_get_contents();
	  ob_clean();
	  list($is_mail_send,$mail)=explode('___',$mail_send_data);
	  if($is_mail_send==1){
		  require_once('../../../mailer/class.phpmailer.php');
		  require_once('../../../auto_mail/setting/mail_setting.php');
		  $mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
			  
		  $mailToArr=array();
		  $mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
		  //echo $mailSql;die;
		  $mailSqlRes=sql_select($mailSql);
		  foreach($mailSqlRes as $rows){
			  if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		  }
		  
		  
		  $mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=97 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
		  //echo $mailSql;die;
		  $mailSqlRes=sql_select($mailSql);
		  foreach($mailSqlRes as $rows){
			  if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		  }
		  
		  if($mail!=''){$mailToArr[]=$mail;}
		  $to=implode(',',$mailToArr);
		  $subject="Trims Booking Multy Job";
		  $header=mailHeader();
		  echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
		  
	  }
	  else{
		  echo $html;
	  }
	  exit();
  
	
}
if($action=="show_trim_booking_report14")
{
	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');

	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$brandArr=return_library_array( "select id, brand_name from lib_buyer_brand",'id','brand_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$team_leader_arr=return_library_array("select id,team_leader_name from lib_marketing_team","id","team_leader_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");
	$lib_user=return_library_array("select id,user_full_name from user_passwd","id","user_full_name");

	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;
	//$revised_no_data=sql_select("select a.revised_no  from wo_booking_mst a where  a.booking_no=$txt_booking_no and  a.status_active =1 and a.is_deleted=0");
	//list($revised_no_row)=$revised_no_data;
		$booking_grand_total=0; $currency_id="";

		$buyer_string=array(); $brand_string=array(); $style_owner=array(); $job_no=array(); $style_ref=array(); $all_dealing_marcent=array(); $season=array(); $order_repeat_no=array(); $po_id_arr=array();$job_no_arr=array();

		$nameArray_buyer=sql_select( "select  a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.factory_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, a.brand_id, b.po_break_down_id,a.JOB_NO_PREFIX_NUM,a.team_leader,a.style_description from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");

        foreach ($nameArray_buyer as $result_buy){
			$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$brand_string[$result_buy[csf('brand_id')]]=$brandArr[$result_buy[csf('brand_id')]];
			$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
			$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$style_desc[$result_buy[csf('job_no')]]=$result_buy[csf('style_description')];
			$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
			$job_prefix_arr[$txt_booking_no][$result_buy[csf('JOB_NO_PREFIX_NUM')]]=$result_buy[csf('JOB_NO_PREFIX_NUM')];
			$job_no_arr[$txt_booking_no][$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$booking_style_ref[$txt_booking_no][$result_buy[csf('style_ref_no')]]=$result_buy[csf('style_ref_no')];
			$dealing_merchant_list[$txt_booking_no][$result_buy[csf('dealing_marchant')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
			$factory_merchant_list[$txt_booking_no][$result_buy[csf('factory_marchant')]]=$deling_marcent_arr[$result_buy[csf('factory_marchant')]];
			$team_leader_list[$txt_booking_no][$result_buy[csf('team_leader')]]=$team_leader_arr[$result_buy[csf('team_leader')]];
			//$season[$result_buy[csf('job_no')]]=$season_arr[$result_buy[csf('season_matrix')]];
			$season_matrix=$result_buy[csf('season_matrix')];
			$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
			if($season_matrix!=0 && $season_buyer_wise==0 )
			{
				$season_matrix_con=$season_matrix;
			}
			else if($season_buyer_wise!=0 && $season_matrix==0)
			{
				$season_matrix_con=$season_buyer_wise;
			}
			$seasons_name.=$season_arr[$season_matrix_con].',';
			$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
			$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

			$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];
		}
		//print_r($brand_string);
		$style_sting=implode(",",array_unique($style_ref));
		$job_no_str = "'" . implode( "','", $job_no ) . "'";
		$job_no=implode(",",$job_no);
		$seasons_names=rtrim($seasons_name,',');

		$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));
		$poid_arr=array_unique($po_id_arr);

		$order_rept_no=rtrim($order_rept_no,',');
		$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));
		$brand_str=implode(",",$brand_string);
		$main_fabric_approved = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and a.job_no in (".$job_no_str.") and b.entry_form=7 and a.status_active =1 and a.is_deleted=0 order by b.id asc");


		$po_no=array(); $file_no=array(); $ref_no=array(); $po_quantity=array();
		$pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';
		$nameArray_job=sql_select( "select b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, sum(b.po_quantity) as po_quantity  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no ");
        foreach ($nameArray_job as $result_job){
			$po_no[$result_job[csf('job_no_mst')]][$result_job[csf('id')]]=$result_job[csf('po_number')];
			$file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
			$ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
			$po_quantity[$result_job[csf('id')]]=$result_job[csf('po_quantity')];
		//	$tot_po_quantity+=$result_job[csf('po_quantity')];
			$job_ref_no[$result_job[csf('job_no_mst')]].=$result_job[csf('grouping')].',';
			$job_file_no[$result_job[csf('job_no_mst')]].=$result_job[csf('file_no')].',';
			$po_no_arr[$result_job[csf('job_no_mst')]]['po_id'].=$result_job[csf('id')].',';
			$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
			$int_ref_no.=$result_job[csf('grouping')].',';
			if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];

		}
			//echo $po_idss.'DDDDDDDDD';
		$sql_job=sql_select( "select b.job_no_mst,b.id as po_id, b.po_quantity as po_quantity  from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.") ");
		foreach ($sql_job as $row)
		{
			$job_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('po_id')]]+=$row[csf('po_quantity')];
			$tot_po_quantity+=$row[csf('po_quantity')];
		}

        $nameArray=sql_select( "select a.booking_no, a.is_approved,a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.source, a.remarks, a.revised_no,a.inserted_by,a.insert_date,a.DELIVERY_ADDRESS from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
		foreach( $nameArray as $row)
		{
			$varcode_booking_no=$row[csf('booking_no')];
			$booking_date=$row[csf('booking_date')];
			$delivery_date=$row[csf('delivery_date')];
			$pay_mode_id=$row[csf('pay_mode')];
			$supplier_id=$row[csf('supplier_id')];
			$currency_id=$row[csf('currency_id')];
			$buyer_id=$row[csf('buyer_id')];
			$exchange_rate=$row[csf('exchange_rate')];
			$attention=$row[csf('attention')];
			$remarks=$row[csf('remarks')];
			$revised_no=$row[csf('revised_no')];
			$source_id=$row[csf('source')];
			$is_approved=$row[csf('is_approved')];
			$delivery_add=$row[csf('DELIVERY_ADDRESS')];
		}
		$approved_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name, b.id from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0 order by b.id asc");

	 $sql_date_update=sql_select("SELECT a.updated_by, a.booking_no,a.update_date
				  FROM wo_booking_dtls a, wo_booking_dtls b
				 WHERE a.booking_no = b.booking_no AND a.update_date >= b.update_date
				 and a.booking_no='$txt_booking_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.update_date desc");
	 $sql_date_insert=sql_select("SELECT a.inserted_by, a.booking_no,a.insert_date
						  FROM wo_booking_dtls a, wo_booking_dtls b
						 WHERE a.booking_no = b.booking_no AND a.insert_date <= b.insert_date
						 and a.booking_no='$txt_booking_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.insert_date");

	$nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website,contact_no from lib_company where id=$cbo_company_name");
		foreach ($nameArray as $result){              
			if($result[csf('plot_no')]!='')
			{
				$plot_no=$result[csf('plot_no')];
			}
			if($result[csf('level_no')]!='')
			{
				$level_no=$result[csf('level_no')];
			}
			if($result[csf('road_no')]!='')
			{
				$road_no=$result[csf('road_no')];
			}
			if($result[csf('block_no')]!='')
			{
				$block_no=$result[csf('block_no')];
			}
			if($result[csf('city')]!='')
			{
				$city=$result[csf('city')];
			}
			$company_address[$result[csf('id')]]['address']=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
			$company_address[$result[csf('id')]]['tel']=$result[csf('contact_no')];
			$company_address[$result[csf('id')]]['email']=$result[csf('email')];
		}
	ob_start();
	
	?>
	    <table border="1" align="left" class="rpt_table container" cellpadding="0" width="100%" cellspacing="0" rules="all" style="padding-bottom: 10px">
   			<tr>
			   <td width="150px"  style="border-right:0" align="left"><? if($report_type==1)
                   {
                       if($link == 1)

                       {
                   ?>
                            <img  src='../../../<? echo $imge_arr[$cbo_company_name]; ?>' height='40%' width='50%' />

                   <?
                       }
                       else
                       {
                   ?>
                            <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='40%' width='50%' />
                   <?	}
                   }
                   else
                   { ?>
                     <img  src='../<? echo $imge_arr[$cbo_company_name]; ?>' height='40%' width='50%' />
                  <? }
                   ?></td>		
			   <td width="200px" colspan="2" align="left"><b><?=$company_library[$cbo_company_name];?></b></td>		  
			   <td  colspan="2" align="left"><b>M&M DEPARTMENT</b></td>
			   <td  colspan="2" align="left"><b>PURCHASE ORDER <br>(CODE: MMD/M&M/DMF-09)</b></td>
			   <td   align="left"><b>BOOKING DATE :<?php echo change_date_format($booking_date); ?></b> </td>		   
			</tr>
		</table>
				<table border="1" align="left" class="rpt_table container"  cellpadding="0" width="100%" cellspacing="0" rules="all" style="padding-bottom: 10px">
				<tr>
				   <td colspan="2" align="left"><b>Factory Name: <?=$company_library[$cbo_company_name];?></b> </td>				   
				   <td  colspan="2" align="left"><b>SUB: Accessories Purchase Order</b></td>	
				   <td  colspan="2" align="left"><b>Booking No:</b></td>	
				   <td colspan="2"  align="left"><b><?=$txt_booking_no;?></b> </td>						   
				</tr>
				<tr>
				   <td width="100" colspan="8" align="left"><b>Head Office: </b>
				   <?=$company_address[$cbo_company_name]['address'].";Tel:+88-02-".$company_address[$cbo_company_name]['tel'].", Fax:+88-02-".$company_address[$cbo_company_name]['email'];?>
					 
					 </td>				   
				   					   
				</tr>
				<tr>
				   <td width="100" colspan="8" align="left"><b>Factory:</b> <?
                            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                            foreach ($nameArray as $result){
                            ?>
                              <?  if($result[csf('plot_no')]!='') echo $result[csf('plot_no')]; else echo '';?> &nbsp;
                                <? echo $result[csf('level_no')];?> &nbsp;
                                 <? echo $result[csf('road_no')]; ?>  &nbsp;
                                <? echo $result[csf('block_no')];?>  &nbsp;
                                <? echo $result[csf('city')];?>  &nbsp;
                                <? echo $result[csf('zip_code')]; ?>  &nbsp;
                                 <?php echo $result[csf('province')]; ?>  &nbsp;
                                <? echo $country_arr[$result[csf('country_id')]]; ?> &nbsp;<br/>
                                <? echo $result[csf('email')];?>  &nbsp;
                                <? echo $result[csf('website')];
                                if($result[csf('plot_no')]!='')
                                {
                                    $plot_no=$result[csf('plot_no')];
                                }
                                if($result[csf('level_no')]!='')
                                {
                                    $level_no=$result[csf('level_no')];
                                }
                                if($result[csf('road_no')]!='')
                                {
                                    $road_no=$result[csf('road_no')];
                                }
                                if($result[csf('block_no')]!='')
                                {
                                    $block_no=$result[csf('block_no')];
                                }
                                if($result[csf('city')]!='')
                                {
                                    $city=$result[csf('city')];
                                }
                                $company_address[$result[csf('id')]]=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
                            }
                        ?></td>		   				  
				</tr>
				<tr>
				   <td width="100" align="left"> <b>To :</b> </td>
				
				   <td width="350" colspan="3" align="left"> <b><?
                    if($pay_mode_id==5 || $pay_mode_id==3){
                        echo $company_library[$supplier_id];
                    }
                    else{
                        echo $supplier_name_arr[$supplier_id];
                    }
                    ?></b></td>
				 <td width="100" colspan="2"align="left"><b>Job No. :</b> </td>	
				 <td width="200" colspan="2" align="left"><b><?=implode(",",$job_no_arr[$txt_booking_no]);?></b></td>	
				 
				</tr>
				<tr>
				   <td width="100" align="left"><b>  Attn.  :</b></td>
				   <td width="150" colspan="3" align="left"><b><? echo $attention;     ?></b></td>
				   <td width="150" colspan="2" align="left"> <b>Buyer’s Name:</b></td>	
				   <td width="200" colspan="2" align="left"><b><? echo $buyer_name_arr[$buyer_id].'/'.$brand_str; ?></b></td>	
				 
				</tr>
				<tr>
				   <td width="100" align="left"><b> Team Leader  :</b></td>
				   <td width="350" colspan="3" align="left"><b><?=implode(",",$team_leader_list[$txt_booking_no]);?></b></td>
				   <td width="100" colspan="2" align="left"><b>Style Ref  :</b></td>	
				   <td width="200" colspan="2" align="left"><b><?=implode(",",$booking_style_ref[$txt_booking_no]);?> </b></td>	
				</tr>
				<tr>
				   <td width="100" align="left"><b>Dealing Merchant  :</b></td>
				   <td width="350" colspan="3" align="left"><b><?=implode(",",$dealing_merchant_list[$txt_booking_no]);?> </b></td>
				   <td width="100" colspan="2" align="left"><b>Delivery Place   :</b></td>	
				   <td width="200" colspan="2" align="left"><b><?=$delivery_add;?> </b></td>	
				</tr>
				<tr>
				  
				   <td width="100"  align="left"><b>Factory Merchant  :</b></td>
				   <td width="200" colspan="3" align="left"><b><?=implode(",",$factory_merchant_list[$txt_booking_no]);?></b></td>
				   <td width="100" colspan="2" align="left"><b>Delivery Date   :</b></td>	
				   <td width="200" colspan="2" align="left"><b><?= change_date_format($delivery_date,'dd-mm-yyyy','-') ;?> </b></td>	
				</tr>

          	</table>


          <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?

		$precost_arr=array();
		$trims_qtyPerUnit_arr=array();

		$precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0");
        $calUom="";
		foreach($precost_sql as $precost_row){
			if($precost_row[csf('cal_parameter')]==1){
			   $calUom="Mtr";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==2){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==3){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==4){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==5){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==6){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==7){
			   $calUom="Pcs";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==8){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else{
				$calUom=0;
			}
			 $trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
		}
		$booking_country_arr=array();
		$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,sensitivity,country_id_string from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0");
		foreach($nameArray_booking_country as $nameArray_booking_country_row){
			$country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
			$tocu=count($country_id_string);
			for($cu=0;$cu<$tocu;$cu++){
				$booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
			}
		}

		$nameArray_job_po=sql_select( "select job_no from wo_booking_dtls  where booking_no='$txt_booking_no' and status_active =1 and is_deleted=0 group by job_no order by job_no ");
		foreach($nameArray_job_po as $nameArray_job_po_row){
		//$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$nameArray_job_po_row[csf('job_no')]."'   and sensitivity=1 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
		$nameArray_item=sql_select("SELECT a.pre_cost_fabric_cost_dtls_id, a.trim_group from wo_booking_dtls a join lib_item_group b on b.id=a.trim_group where a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=1 and  a.status_active =1 and a.is_deleted=0 and b.rate_cal_parameter not in (2,14) group by a.pre_cost_fabric_cost_dtls_id, a.trim_group order by a.trim_group");
	    if(count($nameArray_item)>0){
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];//$po_quantity[$poid]; 
			}
        ?>

        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="11" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" align="left"><strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style Desc:".$style_desc[$nameArray_job_po_row[csf('job_no')]]; if($file_nos!='' || $file_nos!=0 ) ; echo " &nbsp;  Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
             
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>Qty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UNIT</strong></td>
				  <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
				<td style="border:1px solid black" align="center"><strong>Currency</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? }?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item){
			$i++;
            $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_color,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.rate*b.requirment) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center"  style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription){
                ?>
                <td style="border:1px solid black"><?  if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>

                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?

				echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_itemdescription[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right" title="Avg Rate"><? echo number_format( $result_itemdescription[csf('amount')]/$result_itemdescription[csf('cons')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('amount')];
				// $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
				<td style="border:1px solid black; text-align:right"><p><? echo $currency[$currency_id]; ?> </p></td>
                 <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

					echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>
				<td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="8"><strong>Total</strong></td>
				  <? if($show_comment==1) {?>
				 <td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp; </td>
				<td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->


        <!--==============================================Size Sensitive START=========================================  -->
		<?
		//$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=2 and  status_active =1 and  is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
		$nameArray_item=sql_select("SELECT a.pre_cost_fabric_cost_dtls_id, a.trim_group from wo_booking_dtls a join lib_item_group b on b.id=a.trim_group where a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=2 and  a.status_active =1 and a.is_deleted=0 and b.rate_cal_parameter not in (2,14) group by a.pre_cost_fabric_cost_dtls_id, a.trim_group order by a.trim_group");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="11" align="">
                 <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Size Sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style Desc:".$style_desc[$nameArray_job_po_row[csf('job_no')]]; echo "&nbsp;&nbsp; Po Qty..:".$po_no_qty; ?></strong></td>
                <td width="40%" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>              
                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UNIT</strong></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
				<td style="border:1px solid black" align="center"><strong>Currency</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
			$i++;
			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,b.article_number,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size,b.article_number order by bid");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][2]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>             
                <td style="border:1px solid black; text-align:left">
              <? echo $result_itemdescription[csf('item_size')];?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>


                <td style="border:1px solid black; text-align:right">
				<?

					  echo number_format($result_itemdescription[csf('cons')],4);

                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_itemdescription[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];

				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">

                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
				<td style="border:1px solid black; text-align:right"><p><? echo $currency[$currency_id]; ?> </p></td>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="3"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold"><?

					echo number_format($item_desctiption_total,4);
				 ?></td>
                 <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>
		

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp; </td>
				<td>&nbsp; </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="7"><strong>Total</strong></td>
				 <? if($show_comment==1) {?>
					<td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp; </td>
				<td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 //$nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=3 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		$nameArray_item=sql_select("SELECT a.pre_cost_fabric_cost_dtls_id, a.trim_group from wo_booking_dtls a join lib_item_group b on b.id=a.trim_group where a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=3 and  a.status_active =1 and a.is_deleted=0 and b.rate_cal_parameter not in (2,14) group by a.pre_cost_fabric_cost_dtls_id, a.trim_group order by a.trim_group");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>
        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style Desc:".$style_desc[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>

                <td style="border:1px solid black"><strong>Item Description</strong> </td>
				<td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
               
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UNIT</strong></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
				<td style="border:1px solid black" align="center"><strong>Currency</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by trim_group ", "item_color", "color_number_id"  );

			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,b.color_number_id order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>

                <td style="border:1px solid black; text-align:left">
               <?
			   echo $color_library[$result_itemdescription[csf('color_number_id')]];
			   ?>
                </td>
				<td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
              
               <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>

                <td style="border:1px solid black; text-align:right">
				<?
				echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_itemdescription[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
				<td style="border:1px solid black; text-align:right"><p><? echo $currency[$currency_id]; ?></p> </td>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?></p> </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				echo number_format($item_desctiption_total,4);
				 ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
				<td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="8"><strong>Total</strong></td>
				<? if($show_comment==1) {?>
				<td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp;  </td>
				<td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
		//$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group");
		$nameArray_item=sql_select("SELECT a.pre_cost_fabric_cost_dtls_id, a.trim_group from wo_booking_dtls a join lib_item_group b on b.id=a.trim_group where a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=4 and  a.status_active =1 and a.is_deleted=0 and b.rate_cal_parameter not in (2,14) group by a.pre_cost_fabric_cost_dtls_id, a.trim_group order by a.trim_group");
	   if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));

			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="13" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" ><strong>Color & size sensitive (<? echo "Job NO: ".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style Desc:".$style_desc[$nameArray_job_po_row[csf('job_no')]] ;echo "&nbsp;&nbsp;&nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group </strong> </td>


                <td style="border:1px solid black"><strong>Item Description</strong> </td>
				<td style="border:1px solid black; width:170px;"><strong>Gmts Color</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
          
                <td style="border:1px solid black;"><strong>Gmts Size</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UNIT</strong></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
				<td style="border:1px solid black" align="center"><strong>Currency</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;

            foreach($nameArray_item as $result_item)
            {

				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by trim_group ", "item_color", "color_number_id"  );

			 $nameArray_color=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.color_number_id as gmt_color, b.item_color as color_number_id,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount, min(c.color_order) as color_order, min(c.size_order) as size_order,c.article_number from wo_booking_dtls a, wo_trim_book_con_dtls b,wo_po_color_size_breakdown c  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and b.po_break_down_id=c.po_break_down_id and b.color_number_id=c.color_number_id and b.gmts_sizes=c.size_number_id and  c.id=b.color_size_table_id and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=4 and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.color_number_id, b.item_color,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,c.article_number order by c.article_number,color_order,size_order");



            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]." and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  status_active =1 and is_deleted=0 order by trim_group ");

            if(count($nameArray_color)>0){
            	$i++; ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][4]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                /*echo '<pre>';
            	print_r($nameArray_color);*/

				foreach($nameArray_color as $result_color)
                {
					?>

					<td style="border:1px solid black" ><? if($result_color[csf('description')]){echo $result_color[csf('description')];} ?> </td>
					<td style="border:1px solid black"><? echo $color_library[$result_color[csf('gmt_color')]];?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                   
                    <td style="border:1px solid black; text-align:left">
					<? echo $size_library[$result_color[csf('gmts_sizes')]]; ?>
					</td>
					<td style="border:1px solid black; text-align:left">
					<? echo $result_color[csf('item_size')]; ?>
					</td>
                    <td style="border:1px solid black; text-align:left">
				   <?
				   $calUom=$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][2];
			       $calQty=explode("_",$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				   if($calUom && end($calQty)){
					   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
				   }
                   ?>
                    </td>

					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('cons')],4);
					$item_desctiption_total += $result_color[csf('cons')] ;
					$trims_item_arr[$result_item[csf('trim_group')]][$result_color[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_color[csf('cons')];
					$trims_item_arr[$result_item[csf('trim_group')]][$result_color[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_color[csf('amount')];
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]];  ?></td>
					<? if($show_comment==1) {?>
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('rate')],4);
					?>
                     </td>

					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,2);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					$trims_remark=$trims_remark_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
					?>
					</td>
					<td style="border:1px solid black;text-align:center"><? echo $currency[$currency_id]; ?> </td>
                    <td style="border:1px solid black;text-align:center"><? echo $trims_remark; ?> </td>
                    <? } ?>
				</tr>
            	<?
            	}
            	?>
            	<tr>
	                <td style="border:1px solid black;  text-align:right" colspan="8"><strong> Item Total</strong></td>
	                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					echo number_format($item_desctiption_total,4);  ?></td>
	                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
					<? if($show_comment==1) {?>
	                <td style="border:1px solid black; text-align:right"></td>

	                <td style="border:1px solid black; text-align:right">
	                <?
	                echo number_format($total_amount_as_per_gmts_color,2);
	                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
	                ?>
	                </td>

	                <td>&nbsp;  </td>
					<td>&nbsp;  </td>
	                <? } ?>
            	</tr>
            <?
            }
        	}

            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="<? echo ($show_comment==1) ? 11 : 9; ?>"><strong>Total</strong></td>
				<? if($show_comment==1) {?>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
				<td>&nbsp;  </td>
                <td>&nbsp;  </td>
                <? } else{ ?>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                <? } ?>
            </tr>
        </table>
        <br/>
       <?
		}
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->

         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select("SELECT a.pre_cost_fabric_cost_dtls_id, a.trim_group, b.rate_cal_parameter from wo_booking_dtls a join lib_item_group b on b.id=a.trim_group where a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.rate_cal_parameter not in (2,14) group by a.pre_cost_fabric_cost_dtls_id, a.trim_group, b.rate_cal_parameter order by a.trim_group");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				//echo $poid.', ';
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			} 

			//$po_quantity[$result_job[csf('id')]];
			if($show_comment==1) $tdColspan=6; else $tdColspan=3;
        ?>
        <table border="1" align="left" class="rpt_table" cellpadding="0" width="1320" cellspacing="0" style="table-layout: fixed;"  rules="all" >
            <tr>
                <td colspan="5" width="645" style="word-break:break-all; "><strong>NO sensitive  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style Desc:".$style_desc[$nameArray_job_po_row[csf('job_no')]]; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="530" colspan="<?=$tdColspan;?>" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
            </tr>
            <tr>
                <td width="25" style="border:1px solid black"><strong>Sl</strong> </td>
                <td width="120" style="border:1px solid black"><strong>Item Group</strong> </td>
                <td width="200" style="border:1px solid black"><strong>Item Description</strong> </td>
                <td width="150" style="border:1px solid black"><strong>Item Color</strong> </td>
                <td width="80" align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td width="100" align="center" style="border:1px solid black"><strong>Qty</strong></td>
                <td width="80" style="border:1px solid black" align="center"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td width="80" style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td width="100" style="border:1px solid black" align="center"><strong>Amount</strong></td>
				<td width="220" style="border:1px solid black" align="center"><strong>Currency</strong></td>
                <td width="220" style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                 <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color");
				?>
				<tr>
					<td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>"><? echo $i; ?></td>
					<td align="center" style="word-break:break-all; border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
						<?
						echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
						echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);
						?>
					</td>
					<?
					$color_tatal=0;
					$total_amount_as_per_gmts_color=0;
					foreach($nameArray_item_description as $result_itemdescription)
					{
						$item_desctiption_total=0;
						?>
						<td style="word-break:break-all; border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
					
						<td style="word-break:break-all; border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
						<td style="word-break:break-all; border:1px solid black; text-align:left">
						<?
						$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
						$calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
						$calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
						if($calUom && end($calQty)){
						echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
						?>
						</td>
						<?
					}

					if($db_type==0)
					{
					 $nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
					}
					if($db_type==2)
					{
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
					}

					foreach($nameArray_color_size_qnty as $result_color_size_qnty)
					{
						?>
						<td style="word-break:break-all; border:1px solid black; text-align:right">
						<?
						if($result_color_size_qnty[csf('cons')]!= "")
						{
							echo number_format($result_color_size_qnty[csf('cons')],4);
							$item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
							$color_tatal+=$result_color_size_qnty[csf('cons')];
							$trims_item_arr[$result_item[csf('trim_group')]][$result_color_size_qnty[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_color_size_qnty[csf('cons')];
				        	$trims_item_arr[$result_item[csf('trim_group')]][$result_color_size_qnty[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_color_size_qnty[csf('amount')];
						}
						else echo "";
						?>
						</td>
						<?
					}
					?>
					<td style="word-break:break-all; border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
					<? if($show_comment==1)
					{
						?>
						<td style="word-break:break-all; border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
						<td style="word-break:break-all; border:1px solid black; text-align:right">
						<?
							$amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
							$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
						?>
						</td>
						<td style="word-break:break-all; border:1px solid black; text-align:right"><? echo $currency[$currency_id]; ?> </td>
						<td style="word-break:break-all; border:1px solid black; text-align:right"><? echo $trims_remark; ?> </td>
					<? } ?>
				</tr>
				<?
				}
				?>
				<tr>
					<td style="border:1px solid black;  text-align:right" colspan="3"><strong> Item Total</strong></td>
					<td style="border:1px solid black;  text-align:right; font-weight:bold;"><? if($color_tatal !='') echo number_format($color_tatal,4); ?></td>
					<td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
					<? if($show_comment==1)
					{?>
						<td style="border:1px solid black; text-align:right"></td>
						<td style="border:1px solid black; text-align:right">
						<?
						echo number_format($total_amount_as_per_gmts_color,2);
						$grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
						?>
						</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
					<? } ?>
				</tr>
				<?
				}
				?>
				<tr>
					<td align="right" style="border:1px solid black"  colspan="7"><strong>Total</strong></td>
					<? if($show_comment==1) {?>
					<td>&nbsp;</td>
					<td style="border:1px solid black;  text-align:right"><? echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
					<td>&nbsp;</td>
					<td>&nbsp;</td>
				</tr>
        <? } ?>
        </table>
        <?
		}

			$carton_nameArray_item=sql_select("SELECT a.pre_cost_fabric_cost_dtls_id, a.trim_group, b.rate_cal_parameter from wo_booking_dtls a join lib_item_group b on b.id=a.trim_group where a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.status_active =1 and a.is_deleted=0 and b.rate_cal_parameter in (2,14) group by a.pre_cost_fabric_cost_dtls_id, a.trim_group, b.rate_cal_parameter order by a.trim_group");
			
			//and a.sensitivity=0
			if(count($carton_nameArray_item)>0)
			{
				$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
				$po_ids=array_unique(explode(",",$po_ids));
				$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
				$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
				$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
				$file_nos=implode(",",array_unique(explode(",",$file_nos)));
				$po_no_qty=0;
				$job_no=$nameArray_job_po_row[csf('job_no')];
				foreach($po_ids as $poid)
				{
					$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
				}
		        ?>
		        <table border="1" align="left" class="rpt_table" cellpadding="0" width="1320" cellspacing="0" style="margin-top: 10px"  rules="all" >
		            <tr>
		                <td colspan="5" width="645" style="word-break:break-all; "><strong>Carton Details  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style Desc:".$style_desc[$nameArray_job_po_row[csf('job_no')]]; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
		                <td width="530" colspan="10" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
		            </tr>
		            <tr>
		                <td width="30" style="border:1px solid black"><strong>Sl</strong> </td>
		                <td width="90" style="border:1px solid black"><strong>Item Group</strong> </td>
		                <td width="80" style="border:1px solid black"><strong>Item Description</strong> </td>
		                <td width="90" style="border:1px solid black" colspan="3"><strong>Mesurmant (L x W x H) CM</strong> </td>
		                <td width="80" align="center" style="border:1px solid black"><strong>SQM/Pcs</strong></td>
		                <td width="80" align="center" style="border:1px solid black"><strong>WO Qty</strong></td>
		                <td width="80" style="border:1px solid black" align="center"><strong>UOM</strong></td>
		                <td width="80" style="border:1px solid black" align="center"><strong>Rate</strong></td>
		                <td width="80" style="border:1px solid black" align="center"><strong>Ttl Sqm</strong></td>
		                <td width="80" style="border:1px solid black" align="center"><strong>Rate/Sqm</strong></td>
		                <td width="80" style="border:1px solid black" align="center"><strong>Amount</strong></td>
						<td width="80" style="border:1px solid black" align="center"><strong>Currency</strong></td>
		                <td width="120" style="border:1px solid black" align="center"><strong>Remarks</strong></td>
		            </tr>
		            <?
					$i=0;
		            $grand_total_as_per_gmts_color=0;
		            foreach($carton_nameArray_item as $cartondata)
		            {
						$i++;
						$cartonarray_item_description=sql_select( "SELECT a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount, c.rate_cal_data, b.remarks from wo_booking_dtls a, wo_trim_book_con_dtls b, wo_pre_cost_trim_co_cons_dtls c where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and c.wo_pre_cost_trim_cost_dtls_id=a.pre_cost_fabric_cost_dtls_id  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$cartondata[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$cartondata[csf('pre_cost_fabric_cost_dtls_id')]."  and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color, c.rate_cal_data,b.remarks");
						
						?>
						<tr>
							<td style="border:1px solid black" rowspan="<? echo count($cartonarray_item_description)+1; ?>"><? echo $i; ?></td>
							<td align="center" style="word-break:break-all; border:1px solid black" rowspan="<? echo count($cartonarray_item_description)+1; ?>">
								<?
								echo $trim_group_library[$cartondata[csf('trim_group')]]."<br/>";
								echo implode(",",$booking_country_arr[$cartondata[csf('pre_cost_fabric_cost_dtls_id')]][0]);
								?>
							</td>
							<?
							$color_tatal=0;
							$total_amount_as_per_gmts_color=0;
							foreach($cartonarray_item_description as $cartonresult)
							{
								$item_desctiption_total=0;
								$rate_cal_arr=explode("~~",$cartonresult[csf('rate_cal_data')]);
								$sqmpcs=0;
								if($cartondata[csf('rate_cal_parameter')]==2){
									$sqmpcs=($rate_cal_arr[0]+$rate_cal_arr[1]+6)*($rate_cal_arr[1]+$rate_cal_arr[2]+3)/5000;
								}
								if($cartondata[csf('rate_cal_parameter')]==14){
									$sqmpcs=($rate_cal_arr[0]*$rate_cal_arr[1])/10000;
								}
								?>
								<td style="word-break:break-all; border:1px solid black"><? if($cartonresult[csf('description')]){ echo $cartonresult[csf('description')];} ?> </td>
							
								<td style="word-break:break-all; border:1px solid black" width="30"><? echo $rate_cal_arr[0]; ?> </td>
								<td style="word-break:break-all; border:1px solid black" width="30"><? echo $rate_cal_arr[1]; ?> </td>
								<td style="word-break:break-all; border:1px solid black;" width="30">
								<? echo $rate_cal_arr[2];?></td>
								<td style="word-break:break-all; border:1px solid black; text-align:left"><? echo number_format($sqmpcs,4);?></td>
								<?

							if($db_type==0)
							{
							 $nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $cartondata[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$cartondata[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $cartonresult[csf('description')]."' and b.brand_supplier='".$cartonresult[csf('brand_supplier')]."' and b.item_color='".$cartonresult[csf('item_color')]."'");
							}
							if($db_type==2)
							{
								$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons,sum(b.amount) as amount  from wo_booking_dtls a, wo_trim_book_con_dtls b,wo_pre_cost_trim_co_cons_dtls c  where a.id= b.wo_trim_booking_dtls_id  and a.pre_cost_fabric_cost_dtls_id= c.wo_pre_cost_trim_cost_dtls_id and b.color_size_table_id=c.color_size_table_id and a.po_break_down_id=c.po_break_down_id and b.po_break_down_id=c.po_break_down_id  and a.po_break_down_id=c.po_break_down_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  and a.trim_group=". $cartondata[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$cartondata[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $cartonresult[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$cartonresult[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$cartonresult[csf('item_color')]."',0) and nvl(c.rate_cal_data,0)=nvl('".$cartonresult[csf('rate_cal_data')]."',0)");
							}

							foreach($nameArray_color_size_qnty as $result_color_size_qnty)
							{
								?>
								<td style="word-break:break-all; border:1px solid black; text-align:right">
								<?
								$ttl_sqm=0;
								if($result_color_size_qnty[csf('cons')]!= "")
								{
									echo number_format($result_color_size_qnty[csf('cons')],4);
									$item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
									$color_tatal+=$result_color_size_qnty[csf('cons')];
									$ttl_sqm=$result_color_size_qnty[csf('cons')]*$sqmpcs;
									$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_color_size_qnty[csf('cons')];
						         	$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_color_size_qnty[csf('amount')];
								}
								else echo "";
								?>
								</td>
								<?
							}
							?>
							<td style="word-break:break-all; border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
							<td style="word-break:break-all; border:1px solid black; text-align:right"><? echo number_format($sqmpcs*$rate_cal_arr[3],4); ?> </td>
							<td style="word-break:break-all; border:1px solid black; text-align:right"><? echo number_format($ttl_sqm,4); ?> </td>
							<td style="word-break:break-all; border:1px solid black; text-align:right"><? echo number_format($rate_cal_arr[3],4); ?> </td>
							<td style="word-break:break-all; border:1px solid black; text-align:right">
							<?
								$amount_as_per_gmts_color = $ttl_sqm* $rate_cal_arr[3];
								echo number_format($amount_as_per_gmts_color,2);
								$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
							?>
							</td>
							<td style="word-break:break-all; border:1px solid black;"><? echo $currency[$currency_id]; ?> </td>
							<td style="word-break:break-all; border:1px solid black;"><? echo $cartonresult[csf('remarks')]; ?> </td>
						</tr>
						<?
						}
						?>
						<tr>
							<td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
							<td style="border:1px solid black;  text-align:right; font-weight:bold;"><? if($color_tatal !='') echo number_format($color_tatal,4); ?></td>
							<td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
							<td style="border:1px solid black; text-align:right"></td>
							<td style="border:1px solid black; text-align:right"></td>
							<td style="border:1px solid black; text-align:right">
							<?
							echo number_format($total_amount_as_per_gmts_color,2);
							$grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
							?>
							</td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
						</tr>
						<?
						}
						?>
						<tr>
							<td align="right" style="border:1px solid black"  colspan="7"><strong>Total</strong></td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
							<td style="border:1px solid black;  text-align:right"><? echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
							<td>&nbsp;</td>
							<td>&nbsp;</td>
						</tr>
		        
		        </table>
		        <?
			}
		}
		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->

		<?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>

<br>
<br>
<table border="1" align="left" class="rpt_table"  cellpadding="0" width="50%" cellspacing="0" rules="all" >
				<tr>
					<td style="border:1px solid black" align="center" colspan="6"><strong>Summary Report</strong> </td>
						
					</tr>
					<tr>
					<td style="border:1px solid black" align="center"><strong>Sl</strong> </td>
						<td style="border:1px solid black" align="center"><strong>Item Group</strong> </td>
						<td style="border:1px solid black" align="center"><strong>Description</strong> </td>
						<td style="border:1px solid black" align="center"><strong>Order Uom</strong> </td>
						
						<td style="border:1px solid black" align="center"><strong>Total Qnty</strong> </td>
						<? if($show_comment==1) {?>
						<td style="border:1px solid black" align="center"><strong>Total Amount</strong> </td>
						<? } ?>
					</tr>
					<?
					// print_r($trims_item_arr);
					$t=1;$total_item_cons=$total_item_amount=0;
					foreach($trims_item_arr as $trim_id=>$trim_data )
					{
						foreach($trim_data as $trimdesc =>$trim_desc )
						{
							foreach($trim_desc as $uom_id=>$val )
							{
					?>
					<tr>
						<td style="border:1px solid black"> <? echo $t; ?> </td>
							<td align="center" style="border:1px solid black"> <? echo $trim_group_library[$trim_id];?> </td>
							<td align="center" style="border:1px solid black"> <? echo $trimdesc;?> </td>
							<td align="center" style="border:1px solid black"> <? echo $unit_of_measurement[$uom_id];?> </td>
							<td align="right" style="border:1px solid black"> <? echo number_format($val['cons'],0);?> </td>
							<? if($show_comment==1) {?>
							<td align="right" style="border:1px solid black"> <? echo number_format($val['amount'],2);?> </td>
							<? } ?>
						</tr>
						<?
							$t++;
							$total_item_cons+=$val['cons'];
							$total_item_amount+=$val['amount'];
							}
					    	}
						}
						?>
					<tr>
					<? if($show_comment==1) {?>
					<td colspan="5" align="right"> <b>Total</b> </td>
					
					<td align="right"><b> <? echo number_format($total_item_amount,2);?></b> </td>
					<? } ?>
					</tr>

		</table>




    
           <table border="1" align="left" class="rpt_table" cellpadding="0" width="100%" cellspacing="0" rules="all" style="margin-top: 10px">
              	<tr style="border:1px solid black;">
                    <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                    <td width="70%" style="border:1px solid black;"><? echo number_format($booking_grand_total,2);?></td>
                </tr>
                <tr style="border:1px solid black;">
                    <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                    <td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
                </tr>
           </table>
         <br/>
		 <!-- <table border="1" align="left" class="rpt_table" cellpadding="0" width="100%" cellspacing="0" rules="all" style="margin-top: 10px">
            <tr>
                <td  style="word-break:break-all"><? echo get_spacial_instruction($txt_booking_no); ?></td>           
                
            </tr>
        </table> -->
			<?
					
					$mst_id=$txt_booking_no; $width="100%"; $entry_form=87;
					
						if ($entry_form != '') {$entry_form_con = " and entry_form=$entry_form";}
					
						$data_array = sql_select("select id, terms from  wo_booking_terms_condition where   booking_no='" . str_replace("'", "", $mst_id) . "' $entry_form_con   order by id asc");
						$tot_row=count($data_array)/2;
						//echo $tot_row;
						$k=1;
						foreach($data_array as $row)
						{
							if($k<=$tot_row)
							{
							$term_bookingArr[$row[csf('id')]]['terms']=$row[csf('terms')];
							}
							else
							{
							$other_term_bookingArr[$row[csf('id')]]['terms']=$row[csf('terms')];	
							}
							$k++;
						}
						
			if (count($data_array) > 0) {
					?>
					<br>
				<table align="left"  width="<?=$width;?>" align="center"   border="0" cellpadding="0" cellspacing="0" >
					<tr>
						<td valign="top">
					
							<table   width="650" class="rpt_table"   align="center"  border="1" cellpadding="0" cellspacing="0" rules="all">
							<thead>
								<tr style="border:1px solid black;">
								<th width="3%" style="border:1px solid black;">Sl</th>
								<th width="45%" style="border:1px solid black;">Special Instruction</th>
								</tr>
							</thead>
							<tbody>
								<?
						
								//print_r($term_bookingArr);
								$sl=1;
								foreach ($term_bookingArr as $term=>$row) {
									?>
									<tr id="settr_1" align="" style="border:1px solid black;">
										<td align="center" style="border:1px solid black;text-align:center"><?=$sl;?></td>
										<td style="border:1px solid black; font-weight:bold"><?=$row['terms'];?></td>
										<?
									$sl++;
								}?>
							</tbody>
							</table>
						</td>
						<!--1st part end-->
						<?
						$sl2=$sl;
						if (count($other_term_bookingArr) > 0) {
						?>
							<td valign="top">
								<table  width="650" class="rpt_table"   align="center"  border="1" cellpadding="0" cellspacing="0" rules="all">
										<thead>
											<tr style="border:1px solid black;">
											<th width="3%" style="border:1px solid black;" >Sl</th>
											<th width="45%" style="border:1px solid black;">Special Instruction</th>
											</tr>
										</thead>
										<tbody>
										<?
										foreach ($other_term_bookingArr as $term2=>$row2) {
											?>
											<tr id="settr_2" align="" style="border:1px solid black;">
												<td align="center" style="border:1px solid black; text-align:center"><?=$sl2;?></td>
												<td style="border:1px solid black; font-weight:bold"><?=$row2['terms'];?></td>
											<?
											$sl2++;
										}
								
									?>
									</tbody>
								</table>
						
							</td> 
					<?	}?>   
				</tr>
			</table>
			<?	}?>	
    
	  <br>
        <?
        //------------------------------ Query for TNA start-----------------------------------

	//------------------------------ Query for TNA end-----------------------------------
		?>

    <div  style="margin-top:-50px;">
         <?
          echo signature_table(132, $cbo_company_name, "1320px",1);
		 ?>
   </div>
     <!-- <div id="page_break_div"></div> -->
    <div>
		<?
        	//echo signature_table(2, $cbo_company_name, "1330px");
			echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>
	<?
  

    $html = ob_get_contents();
	  ob_clean();
	  list($is_mail_send,$mail)=explode('___',$mail_send_data);
	  if($is_mail_send==1){
		  require_once('../../../mailer/class.phpmailer.php');
		  require_once('../../../auto_mail/setting/mail_setting.php');
		  $mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
			  
		  $mailToArr=array();
		  $mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
		  //echo $mailSql;die;
		  $mailSqlRes=sql_select($mailSql);
		  foreach($mailSqlRes as $rows){
			  if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		  }
		  
		  
		  $mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=97 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
		  //echo $mailSql;die;
		  $mailSqlRes=sql_select($mailSql);
		  foreach($mailSqlRes as $rows){
			  if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		  }
		  
		  if($mail!=''){$mailToArr[]=$mail;}
		  $to=implode(',',$mailToArr);
		  $subject="Trims Booking Multy Job";
		  $header=mailHeader();
		  echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
		  
	  }
	  else{
		  echo $html;
	  }
	  exit();



}
if($action=="show_trim_booking_report12")
{
	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');

	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");
	$lib_user=return_library_array("select id,user_full_name from user_passwd","id","user_full_name");

	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;
	//$revised_no_data=sql_select("select a.revised_no  from wo_booking_mst a where  a.booking_no=$txt_booking_no and  a.status_active =1 and a.is_deleted=0");
	//list($revised_no_row)=$revised_no_data;
		$booking_grand_total=0; $currency_id="";

		$buyer_string=array(); $style_owner=array(); $job_no=array(); $style_ref=array(); $all_dealing_marcent=array(); $season=array(); $order_repeat_no=array(); $po_id_arr=array();

		$nameArray_buyer=sql_select( "select  a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, b.po_break_down_id from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
        foreach ($nameArray_buyer as $result_buy){
			$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
			$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
			//$season[$result_buy[csf('job_no')]]=$season_arr[$result_buy[csf('season_matrix')]];
			$season_matrix=$result_buy[csf('season_matrix')];
			$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
			if($season_matrix!=0 && $season_buyer_wise==0 )
			{
				$season_matrix_con=$season_matrix;
			}
			else if($season_buyer_wise!=0 && $season_matrix==0)
			{
				$season_matrix_con=$season_buyer_wise;
			}
			$seasons_name.=$season_arr[$season_matrix_con].',';
			$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
			$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

			$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];
		}
		$style_sting=implode(",",array_unique($style_ref));
		$job_no_str = "'" . implode( "','", $job_no ) . "'";
		$job_no=implode(",",$job_no);
		$seasons_names=rtrim($seasons_name,',');

		$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));
		$poid_arr=array_unique($po_id_arr);

		$order_rept_no=rtrim($order_rept_no,',');
		$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));
		$main_fabric_approved = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and a.job_no in (".$job_no_str.") and b.entry_form=7 and a.status_active =1 and a.is_deleted=0 order by b.id asc");


		$po_no=array(); $file_no=array(); $ref_no=array(); $po_quantity=array();
		$pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';
		$nameArray_job=sql_select( "select b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, sum(b.po_quantity) as po_quantity  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no ");
        foreach ($nameArray_job as $result_job){
			$po_no[$result_job[csf('job_no_mst')]][$result_job[csf('id')]]=$result_job[csf('po_number')];
			$file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
			$ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
			$po_quantity[$result_job[csf('id')]]=$result_job[csf('po_quantity')];
		//	$tot_po_quantity+=$result_job[csf('po_quantity')];
			$job_ref_no[$result_job[csf('job_no_mst')]].=$result_job[csf('grouping')].',';
			$job_file_no[$result_job[csf('job_no_mst')]].=$result_job[csf('file_no')].',';
			$po_no_arr[$result_job[csf('job_no_mst')]]['po_id'].=$result_job[csf('id')].',';
			$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
			$int_ref_no.=$result_job[csf('grouping')].',';
			if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];

		}
			//echo $po_idss.'DDDDDDDDD';
		$sql_job=sql_select( "select b.job_no_mst,b.id as po_id, b.po_quantity as po_quantity  from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.") ");
		foreach ($sql_job as $row)
		{
			$job_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('po_id')]]+=$row[csf('po_quantity')];
			$tot_po_quantity+=$row[csf('po_quantity')];
		}

        $nameArray=sql_select( "select a.booking_no, a.is_approved,a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.source, a.remarks, a.revised_no,a.inserted_by,a.insert_date,a.delivery_address from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
		foreach( $nameArray as $row)
		{
			$varcode_booking_no=$row[csf('booking_no')];
			$booking_date=$row[csf('booking_date')];
			$delivery_date=$row[csf('delivery_date')];
			$pay_mode_id=$row[csf('pay_mode')];
			$supplier_id=$row[csf('supplier_id')];
			$currency_id=$row[csf('currency_id')];
			$buyer_id=$row[csf('buyer_id')];
			$exchange_rate=$row[csf('exchange_rate')];
			$attention=$row[csf('attention')];
			$remarks=$row[csf('remarks')];
			$revised_no=$row[csf('revised_no')];
			$source_id=$row[csf('source')];
			$is_approved=$row[csf('is_approved')];
			$delivery_address=$row[csf('delivery_address')];
		}
		$approved_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name, b.id from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0 order by b.id asc");

	 $sql_date_update=sql_select("SELECT a.updated_by, a.booking_no,a.update_date
				  FROM wo_booking_dtls a, wo_booking_dtls b
				 WHERE a.booking_no = b.booking_no AND a.update_date >= b.update_date
				 and a.booking_no='$txt_booking_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.update_date desc");
	 $sql_date_insert=sql_select("SELECT a.inserted_by, a.booking_no,a.insert_date
						  FROM wo_booking_dtls a, wo_booking_dtls b
						 WHERE a.booking_no = b.booking_no AND a.insert_date <= b.insert_date
						 and a.booking_no='$txt_booking_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.insert_date");
	ob_start();
	
	?>
	<table width="100%"  cellpadding="0" cellspacing="0" style="border:0px solid black">
       		<tr>
                <td width="20px">
                    <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
                    <tr>
                    <td width="50" >
                       <? if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                                <img  src='../../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />

                       <?
                           }
                           else
                           {
                       ?>
                                <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                       <?	}
                       }
                       else
                       { ?>
                         <img  src='../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                      <? }
                       ?>
                   </td>
                    <td width="40px" align="center">
                    &nbsp;  &nbsp;  &nbsp;
                    </td>
                    <td width="30px"   align="center">

                   <b style="font-size:25px;"> <?
                    echo $company_library[$cbo_company_name]; ?>
                    </b>
                    <br>
                    <label>
                        <?
                            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                            foreach ($nameArray as $result){
                            ?>
                              <?  if($result[csf('plot_no')]!='') echo $result[csf('plot_no')]; else echo '';?> &nbsp;
                                <? echo $result[csf('level_no')];?> &nbsp;
                                 <? echo $result[csf('road_no')]; ?>  &nbsp;
                                <? echo $result[csf('block_no')];?>  &nbsp;
                                <? echo $result[csf('city')];?>  &nbsp;
                                <? echo $result[csf('zip_code')]; ?>  &nbsp;
                                 <?php echo $result[csf('province')]; ?>  &nbsp;
                                <? echo $country_arr[$result[csf('country_id')]]; ?> &nbsp;<br/>
                                <? echo $result[csf('email')];?>  &nbsp;
                                <? echo $result[csf('website')];
                                if($result[csf('plot_no')]!='')
                                {
                                    $plot_no=$result[csf('plot_no')];
                                }
                                if($result[csf('level_no')]!='')
                                {
                                    $level_no=$result[csf('level_no')];
                                }
                                if($result[csf('road_no')]!='')
                                {
                                    $road_no=$result[csf('road_no')];
                                }
                                if($result[csf('block_no')]!='')
                                {
                                    $block_no=$result[csf('block_no')];
                                }
                                if($result[csf('city')]!='')
                                {
                                    $city=$result[csf('city')];
                                }
                                $company_address[$result[csf('id')]]=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
                            }
                        ?>
                        </label>
                        <br/>
                        <b style="font-size:20px;">
                         <?php echo $report_title; ?>
                        </b>
                    </td>
                     <td width="10px" align="center" style="font-size:20px;">
                      <table width="80%" align="right" cellpadding="0" cellspacing="0" style="border:0px solid black">
                        <tr>
                            <td width="80">  Booking No:&nbsp; <?php echo $varcode_booking_no; ?>  </td>
                        </tr>
                        <tr>
                            <td>  Booking Date:&nbsp; <?php echo change_date_format($booking_date); ?>  </td>
                        </tr>
                        <?
                        if($revised_no>0)
                        {
                        ?>
                        <tr>
                            <td>  Revised No:&nbsp; <?php echo $revised_no; ?>  </td>
                        </tr>
                        <?
                        }
                        //if(str_replace("'","",$id_approved_id) ==1)
                        // {
                         ?>
                          <tr>
                              <td>Approved Status :&nbsp;  <? 
							 if($is_approved ==1){ echo "(Approved)";} 
							 else if($is_approved ==3){ echo "(Partial Approved)";} else{echo "";}; ?> 
                             </td>
                         </tr>
                         <?
                       // }
                         ?>
                      </table>
                     </td>
                   </tr>
                   </table>
                </td>
        	</tr>
            <tr>
            <td>

            	<table width="1320"  style="border:0px solid black;table-layout: fixed;">
                <tr>
                    <td colspan="6" valign="top"> </td>
                </tr>
                <tr>
                    <td width="100" style="font-size:18px" align="left"><span><b>To, </b></span>  </td>
                    <td width="110" colspan="5" style="font-size:18px">&nbsp;<span></span></td>
                </tr>
            	<tr>
                    <td width="210" colspan="2" align="left" style="font-size:18px">&nbsp; <b>
                    <?
                    if($pay_mode_id==5 || $pay_mode_id==3){
                        echo $company_library[$supplier_id];
                    }
                    else{
                        echo $supplier_name_arr[$supplier_id];
                    }
                    ?></b>
                    </td>
                    <td  width="100" style="font-size:12px"><b>Buyer</b></td>
                    <td  width="110" align="left">:&nbsp;<? echo $buyer_name_arr[$buyer_id]; ?></td>
                    <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
                    <td width="110" align="left">:&nbsp;<?  echo change_date_format($delivery_date); ?></td>
           	   </tr>
              <tr>
                <td width="100" colspan="2" rowspan="2" align="left" style="font-size:18px">Address :&nbsp;
                <b>
                <?
                if($pay_mode_id==5 || $pay_mode_id==3){
                    $address=$company_address[$supplier_id];
                }
                else{
                    $address=$supplier_address_arr[$supplier_id];
                }
                echo $address;
                ?></b>
                </td>
                <td width="100" style="font-size:12px"><b>PO Qty.</b> </td>
                <td width="110" align="left">:&nbsp;<? echo $tot_po_quantity; ?></td>
                <td style="font-size:12px" ><b>Delivery To </b> </td>
                <td style="" align="left">:&nbsp;<?  echo $delivery_address;?>
             </tr>
            <tr>
                <td width="100" style="font-size:12px"><b>Season</b> </td>
                <td width="110" align="left">:&nbsp;<? echo $seasons_names; ?></td>
                <td width="100" style="font-size:12px"><b>Currency</b></td>
                <td width="110" align="left">:&nbsp;<?  echo $currency[$currency_id]; ?></td>
            </tr>
            <tr>
                <td width="100" style="font-size:12px" align="left"><b>Attention </b>   </td>
                <td align="left" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
                <?
                    echo $attention;

                ?>
                </td>
                <td width="100" style="font-size:12px"><b>Order Repeat </b> </td>
                <td width="110" align="left">:&nbsp;<? echo $order_rept_no; ?></td>
                <td  style="font-size:12px"><b>Pay mode</b></td>
                <td align="left">:&nbsp;<? echo $pay_mode[$pay_mode_id];?></td>
            </tr>
             <tr>
                <td width="100" style="font-size:12px" align="left"><b>Source</b></td>
                <td align="left" >:&nbsp;<? echo $source[$source_id];?></td>
                <td style="font-size:12px"><b>Dealing Merchant</b></td>
                <td align="left" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
                <?
                    echo implode(",",array_unique($all_dealing_marcent));
                ?>
                </td>
                <td>Insert By</td>
                <td title="<?=$sql_date_insert[0][csf('insert_date')];?>">:&nbsp;<?=$lib_user[$sql_date_insert[0][csf('inserted_by')]]?></td>
            </tr>
            <tr>
                <td width="100" style="font-size:12px" align="left"><b>Remarks</b>  </td>
                <td align="left" width="110" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" >:&nbsp;<? echo $remarks; ?></td>
                <td width="130" style="font-size:12px" align="left"><b>Main Fabric Booking 1<sup>st</sup> Approved Date</b></td>
                <td align="left">:&nbsp;<?  echo change_date_format($main_fabric_approved[0][csf('approved_date')]); ?></td>
                <td>Last Update By</td>
                <td title="<?=$sql_date_update[0][csf('update_date')];?>">:&nbsp;<?=$lib_user[$sql_date_update[0][csf('updated_by')]]?> </td>
            </tr>
            </table>
            </td>
            </tr>
          	</table>
          <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?

		$precost_arr=array();
		$trims_qtyPerUnit_arr=array();

		$precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0");
        $calUom="";
		foreach($precost_sql as $precost_row){
			if($precost_row[csf('cal_parameter')]==1){
			   $calUom="Mtr";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==2){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==3){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==4){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==5){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==6){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==7){
			   $calUom="Pcs";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==8){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else{
				$calUom=0;
			}
			 $trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
		}
		$booking_country_arr=array();
		$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,sensitivity,country_id_string from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0");
		foreach($nameArray_booking_country as $nameArray_booking_country_row){
			$country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
			$tocu=count($country_id_string);
			for($cu=0;$cu<$tocu;$cu++){
				$booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
			}
		}

		$nameArray_job_po=sql_select( "select job_no from wo_booking_dtls  where booking_no='$txt_booking_no' and status_active =1 and is_deleted=0 group by job_no order by job_no ");
		foreach($nameArray_job_po as $nameArray_job_po_row){
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$nameArray_job_po_row[csf('job_no')]."'   and sensitivity=1 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
	    if(count($nameArray_item)>0){
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];//$po_quantity[$poid]; 
			}
        ?>

        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="11" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" align="left"><strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; if($ref_nos!='' ) echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;else " ";if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;  Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				  <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? }?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item){
			$i++;
            $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_color,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.rate*b.requirment) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color order by bid ");
          
			
		 ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center"  style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription){
                ?>
                <td style="border:1px solid black"><?  if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?

				echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right" title="Avg Rate"><? echo number_format( $result_itemdescription[csf('amount')]/$result_itemdescription[csf('cons')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('amount')];
				// $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>

                 <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

					echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="8"><strong>Total</strong></td>
				  <? if($show_comment==1) {?>
				 <td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->


        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=2 and  status_active =1 and  is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
		$item_size_arr=array();
		foreach($nameArray_item as $result_item)
		{
			$i++;
			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,b.article_number,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount,a.trim_group from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size,b.article_number ,a.trim_group order by bid");
				foreach($nameArray_item_description as $row){
				$item_size_arr[$row[csf('item_size')]]=$row[csf('item_size')];
				$item_size_wise_arr[$row[csf('item_size')]]['wo_qnty']=$row[csf('cons')];

				$item_wise_data[$row[csf('trim_group')]]['wo_qnty']=$row[csf('cons')];
				$item_wise_data[$row[csf('trim_group')]]['description']=$row[csf('description')];
				$item_wise_data[$row[csf('trim_group')]]['brand_supplier']=$row[csf('brand_supplier')];
				$item_wise_data[$row[csf('trim_group')]]['article_number']=$row[csf('article_number')];
				$item_wise_data[$row[csf('trim_group')]]['pre_cost_fabric_cost_dtls_id']=$row[csf('pre_cost_fabric_cost_dtls_id')];
				$item_wise_data[$row[csf('trim_group')]]['rate']=$row[csf('rate')];
						
				$item_size_wise_data[$row[csf('trim_group')]][$row[csf('item_size')]]['wo_qnty']=$row[csf('cons')];

			  }

	
		}


			// echo "<pre>";

			// print_r($item_size_arr);




		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
		
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
			
         ?>

         <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                 <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Size Sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; echo "&nbsp;&nbsp;Int Ref.:".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp; Po Qty..:".$po_no_qty; ?></strong></td>
                <td width="40%" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black" rowspan="2"><strong>Sl</strong> </td>
                <td style="border:1px solid black"  rowspan="2"><strong>Item Group</strong> </td>
                <td style="border:1px solid black" rowspan="2"><strong>Item Description</strong> </td>
                <td style="border:1px solid black" rowspan="2"><strong>Brand/Supplier Ref.</strong> </td>
                 <td align="center" style="border:1px solid black" rowspan="2"><strong>Article No</strong></td>
                <td align="center" style="border:1px solid black"  colspan="<?=count($item_size_arr);?>"><strong>Item Size</strong></td>
               
                <td style="border:1px solid black" align="center" rowspan="2"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>UOM</strong></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>Amount</strong></td>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
			<tr>
				<?php
				foreach($item_size_arr as $val){?>
                <td align="center" style="border:1px solid black"><strong><?=$val;?></strong></td>
				<?}?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
					// echo "<pre>";
			// print_r($item_size_wise_data);
            foreach($item_wise_data as $item_id=>$row)
            {
				

			$i++;
		
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$item_id]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][2]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
               
					$item_size=$result_itemdescription[csf('item_size')];
                ?>
                <td style="border:1px solid black"><? if($row['description']){ echo $row['description'];}?> </td>
                <td style="border:1px solid black"><? if($row['brand_supplier']){echo $row['brand_supplier'];} ?> </td>
                <td style="border:1px solid black">
				<?
				if($row['article_number']!="no article"){
					echo $row['article_number'];
				}else{
					echo "-";
				}
				?>
                </td>

					<?
				foreach($item_size_wise_data[$item_id] as $size_id=>$val)
				{?>
                <td style="border:1px solid black; text-align:left">
                     <? 
					 	echo  $val['wo_qnty'];
					 	$item_wise_wo_qty[$item_id]+=$val['wo_qnty'];
					 ?>
                </td>
				<?}?>
               
                <td style="border:1px solid black; text-align:right">
				<?

					  echo number_format($item_wise_wo_qty[$item_id],4);
              		  $item_desctiption_total += $item_wise_wo_qty[$item_id] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$item_id]]; ?></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($row['rate'],4); ?> </td>

                <td style="border:1px solid black; text-align:right">

                <?
                $amount_as_per_gmts_color = $item_wise_wo_qty[$item_id]*$row['rate'];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$row['pre_cost_fabric_cost_dtls_id']]['remark'];
                ?>

                </td>

                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                <?  ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="<?=count($item_size_arr)+3;?>"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold"><?

					echo number_format($item_desctiption_total,4);
				 ?></td>
                 <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="<?=count($item_size_arr)+5;?>"><strong>Total</strong></td>
				 <? if($show_comment==1) {?>
					<td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=3 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>
        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>

                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by trim_group ", "item_color", "color_number_id"  );

			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,b.color_number_id order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   echo $color_library[$result_itemdescription[csf('color_number_id')]];
			   ?>
                </td>
               <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>

                <td style="border:1px solid black; text-align:right">
				<?
				echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>

                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?></p> </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				echo number_format($item_desctiption_total,4);
				 ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="9"><strong>Total</strong></td>
				<? if($show_comment==1) {?>
				<td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group");



		foreach($nameArray_item as $result_item)
		{

		$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by trim_group ", "item_color", "color_number_id"  );

		 $nameArray_color=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.color_number_id as gmt_color, b.item_color as color_number_id,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount, min(c.color_order) as color_order, min(c.size_order) as size_order,c.article_number,a.trim_group from wo_booking_dtls a, wo_trim_book_con_dtls b,wo_po_color_size_breakdown c  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and b.po_break_down_id=c.po_break_down_id and b.color_number_id=c.color_number_id and b.gmts_sizes=c.size_number_id and  c.id=b.color_size_table_id and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=4 and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.color_number_id, b.item_color,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,c.article_number,a.trim_group order by c.article_number,color_order,size_order");



		$nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]." and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  status_active =1 and is_deleted=0 order by trim_group ");

		foreach($nameArray_color as $result_color)
		{
				$item_size_arr[$result_color[csf('item_size')]]=$result_color[csf('item_size')];
				$gmts_size_arr[$result_color[csf('gmts_sizes')]]=$result_color[csf('gmts_sizes')];

				$item_size_data[$result_color[csf('trim_group')]][$result_color[csf('gmt_color')]][$result_color[csf('gmts_sizes')]]['gmts_qty']+=$result_color[csf('cons')];

				// $item_size_data[$result_color[csf('trim_group')]][$result_color[csf('color_number_id')]][$result_color[csf('item_size')]]['item_qty']+=$result_color[csf('cons')];

				$item_size_data[$result_color[csf('trim_group')]][$result_color[csf('gmt_color')]][$result_color[csf('gmts_sizes')]]['gmts_qty']+=$result_color[csf('cons')];
				$item_color_data[$result_color[csf('trim_group')]][$result_color[csf('gmt_color')]]['pre_cost_fabric_cost_dtls_id']=$result_color[csf('pre_cost_fabric_cost_dtls_id')];

				$item_color_data[$result_color[csf('trim_group')]][$result_color[csf('gmt_color')]]['description']=$result_color[csf('description')];
				
				
				$item_color_data[$result_color[csf('trim_group')]][$result_color[csf('gmt_color')]]['brand_supplier']=$result_color[csf('brand_supplier')];
				$item_color_data[$result_color[csf('trim_group')]][$result_color[csf('gmt_color')]]['article_number']=$result_color[csf('article_number')];

				 $item_color_data[$result_color[csf('trim_group')]][$result_color[csf('gmt_color')]]['rate']=$result_color[csf('rate')];

				 $color_arr[$result_color[csf('trim_group')]][$result_color[csf('gmt_color')]]=$result_color[csf('gmt_color')];

		}


		}
	   if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));

			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}




         ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" ><strong>Color & size sensitive (<? echo "Job NO: ".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]] ;echo "&nbsp;&nbsp;Int Ref.:&nbsp;".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black" rowspan="2"><strong>Sl</strong> </td>
                <td style="border:1px solid black" rowspan="2"><strong>Item Group </strong> </td>


                <td style="border:1px solid black" rowspan="2"><strong>Item Description</strong> </td>
                <td style="border:1px solid black" rowspan="2"><strong>Brand/Supplier Ref.</strong> </td>
                <td style="border:1px solid black" rowspan="2"><strong>Article No.</strong> </td>
                 <td style="border:1px solid black" rowspan="2"><strong>Item Color</strong> </td>
                <td style="border:1px solid black; width:170px;" rowspan="2"><strong>Gmts Color</strong> </td>
                <td style="border:1px solid black;" colspan="<?=count($gmts_size_arr);?>"><strong>Gmts Size</strong> </td>

              
                <td style="border:1px solid black" align="center" rowspan="2"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center" rowspan="2"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center" rowspan="2"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
			<tr>
				<?php
				foreach($gmts_size_arr as $gval){?>
               
                <td style="border:1px solid black;"><strong><?=$size_library[$gval];?></strong> </td>
				<?}
				
			?>
               
               
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;

					



				foreach($item_color_data as $itemid=>$color_data){
					

            	$i++; ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   count($color_arr[$itemid]); ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($color_arr[$itemid]); ?>">
                <?
				echo $trim_group_library[$itemid]."<br/>";
				echo implode(",",$booking_country_arr[$row['pre_cost_fabric_cost_dtls_id']][4]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                /*echo '<pre>';
            	print_r($nameArray_color);*/

			
					?>

					<td style="border:1px solid black" rowspan="<? echo   count($color_arr[$itemid]); ?>"><? if($row['description']){echo $row['description'];} ?> </td>
					<td style="border:1px solid black" rowspan="<? echo   count($color_arr[$itemid]); ?>"><? if($row['brand_supplier']){echo $row['brand_supplier']; }?> </td>
                    <td style="border:1px solid black" rowspan="<? echo   count($color_arr[$itemid]); ?>">
					<?
					if($result_color[csf('article_number')]!="no article"){
						echo $result_color[csf('article_number')];
					}else{
						echo "-";
					}
					foreach($color_data as $colorid=>$row){
					?>
                    </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$colorid];?> </td>
				
					<? foreach($gmts_size_arr as $gval){
						
							$color_sum_qty[$colorid]+=$item_size_data[$itemid][$colorid][$gval]['gmts_qty'];
						?>
               
			  		 <td style="border:1px solid black;"><strong><?=$item_size_data[$itemid][$colorid][$gval]['gmts_qty'];?></strong> </td>
			 		  <?}?>

                   
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($color_sum_qty[$colorid],4);
					$item_desctiption_total += $color_sum_qty[$colorid];

					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$itemid]]; $uom_text=$unit_of_measurement[$order_uom_arr[$itemid]];  ?></td>
					<? if($show_comment==1) {?>
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($row['rate'],4);
					?>
                     </td>

					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,2);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					$trims_remark=$trims_remark_arr[$row['pre_cost_fabric_cost_dtls_id']]['remark'];
					?>
					</td>

                    <td style="border:1px solid black;text-align:center"><? echo $trims_remark; ?> </td>
            		 <?} ?>
				</tr>
            	<?
           		 }
            	?>
            	<tr>
	                <td style="border:1px solid black;  text-align:right" colspan="<?=count($color_arr[$itemid])+10;?>"><strong> Item Total</strong></td>
	                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					echo number_format($item_desctiption_total,4);  ?></td>
	                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
					<? if($show_comment==1) {?>
	                <td style="border:1px solid black; text-align:right"></td>

	                <td style="border:1px solid black; text-align:right">
	                <?
	                echo number_format($total_amount_as_per_gmts_color,2);
	                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
	                ?>
	                </td>

	                <td>&nbsp;  </td>
	                <? } ?>
            	</tr>
            <?
			$row_count=count($color_arr[$itemid]);
            }
		   }
        	

            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="<? echo $row_count+13; ?>"><strong>Total</strong></td>
				<? if($show_comment==1) {?>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp;  </td>
                <? } else{ ?>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                <? } ?>
            </tr>
        </table>
        <br/>
       <?
		
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->

         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=0 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				//echo $poid.', ';
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}

			//$po_quantity[$result_job[csf('id')]];
			if($show_comment==1) $tdColspan=6; else $tdColspan=3;
        ?>
        <table border="1" align="left" class="rpt_table" cellpadding="0" width="1320" cellspacing="0" style="table-layout: fixed;"  rules="all" >
            <tr>
                <td colspan="5" width="645" style="word-break:break-all; "><strong>NO sensitive  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="530" colspan="<?=$tdColspan;?>" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
            </tr>
            <tr>
                <td width="25" style="border:1px solid black"><strong>Sl</strong> </td>
                <td width="120" style="border:1px solid black"><strong>Item Group</strong> </td>
                <td width="200" style="border:1px solid black"><strong>Item Description</strong> </td>
                <td width="150" style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td width="150" style="border:1px solid black"><strong>Item Color</strong> </td>
                <td width="80" align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td width="100" align="center" style="border:1px solid black"><strong>Qty</strong></td>
                <td width="80" style="border:1px solid black" align="center"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td width="80" style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td width="100" style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <td width="220" style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                 <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color");
				?>
				<tr>
					<td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>"><? echo $i; ?></td>
					<td align="center" style="word-break:break-all; border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
						<?
						echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
						echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);
						?>
					</td>
					<?
					$color_tatal=0;
					$total_amount_as_per_gmts_color=0;
					foreach($nameArray_item_description as $result_itemdescription)
					{
						$item_desctiption_total=0;
						?>
						<td style="word-break:break-all; border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
						<td style="word-break:break-all; border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
						<td style="word-break:break-all; border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
						<td style="word-break:break-all; border:1px solid black; text-align:left">
						<?
						$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
						$calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
						$calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
						if($calUom && end($calQty)){
						echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
						?>
						</td>
						<?
					}

					if($db_type==0)
					{
					 $nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
					}
					if($db_type==2)
					{
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
					}

					foreach($nameArray_color_size_qnty as $result_color_size_qnty)
					{
						?>
						<td style="word-break:break-all; border:1px solid black; text-align:right">
						<?
						if($result_color_size_qnty[csf('cons')]!= "")
						{
							echo number_format($result_color_size_qnty[csf('cons')],4);
							$item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
							$color_tatal+=$result_color_size_qnty[csf('cons')];
						}
						else echo "";
						?>
						</td>
						<?
					}
					?>
					<td style="word-break:break-all; border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
					<? if($show_comment==1)
					{
						?>
						<td style="word-break:break-all; border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
						<td style="word-break:break-all; border:1px solid black; text-align:right">
						<?
							$amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
							$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
						?>
						</td>
						<td style="word-break:break-all; border:1px solid black; text-align:right"><? echo $trims_remark; ?> </td>
					<? } ?>
				</tr>
				<?
				}
				?>
				<tr>
					<td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
					<td style="border:1px solid black;  text-align:right; font-weight:bold;"><? if($color_tatal !='') echo number_format($color_tatal,4); ?></td>
					<td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
					<? if($show_comment==1)
					{?>
						<td style="border:1px solid black; text-align:right"></td>
						<td style="border:1px solid black; text-align:right">
						<?
						echo number_format($total_amount_as_per_gmts_color,2);
						$grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
						?>
						</td>
						<td>&nbsp;</td>
					<? } ?>
				</tr>
				<?
				}
				?>
				<tr>
					<td align="right" style="border:1px solid black"  colspan="8"><strong>Total</strong></td>
					<? if($show_comment==1) {?>
					<td>&nbsp;</td>
					<td style="border:1px solid black;  text-align:right"><? echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
					<td>&nbsp;</td>
				</tr>
        <? } ?>
        </table>
        <?
		}
		}
		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->

		

       <?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>

           <table border="1" align="left" class="rpt_table" cellpadding="0" width="1320" cellspacing="0" rules="all">
                <tr style="border:1px solid black;">
                    <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                    <td width="70%" style="border:1px solid black; text-align:left"><? echo number_format($booking_grand_total,2);?></td>
                </tr>
                <tr style="border:1px solid black;">
                    <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                    <td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
                </tr>
           </table>
         <br/>
        <table width="1320">
            <tr>
                <td width="470" style="word-break:break-all"><? echo get_spacial_instruction($txt_booking_no); ?></td>
                <td width="10">&nbsp;</td>
                <td width="450" valign="top">
                    <table width="440" class="rpt_table" border="1" cellpadding="0" cellspacing="0" rules="all">
                        <tr style="border:1px solid black;">
                            <td colspan="4" style="border:1px solid black;">Approval Status</td>
                        </tr>
                        <tr style="border:1px solid black;">
                            <td width="20" style="border:1px solid black;">Sl</td>
                            <td width="180" style="border:1px solid black;">Name</td>
                            <td width="100" style="border:1px solid black;">Approval Date</td>
                            <td style="border:1px solid black;">Approval No</td>
                        </tr>
                        <?
                        $i;
                        foreach($approved_array as $row){
                            ?>
                            <tr style="border:1px solid black;">
                                <td style="border:1px solid black;"><? echo $i;?></td>
                                <td style="border:1px solid black;"><? echo $row[csf('user_full_name')];?></td>
                                <td style="border:1px solid black;"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); ;?></td>
                                <td style="border:1px solid black;"><? echo $row[csf('approved_no')];?></td>
                            </tr>
                            <?
                            $i++;
                        }
                        ?>
                    </table>
                </td>
            </tr>
        </table>
	  <br>
        <?
        //------------------------------ Query for TNA start-----------------------------------

	//------------------------------ Query for TNA end-----------------------------------
		?>
    <div  style="margin-top:-50px;">
         <?
          echo signature_table(132, $cbo_company_name, "1320px",1);
		 ?>
   </div>
     <!-- <div id="page_break_div"></div> -->
    <div>
		<?
        	//echo signature_table(2, $cbo_company_name, "1330px");
			echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>
	<?
        $html = ob_get_contents();
		ob_clean();
		list($is_mail_send,$mail)=explode('___',$mail_send_data);
		if($is_mail_send==1){
			require_once('../../../mailer/class.phpmailer.php');
			require_once('../../../auto_mail/setting/mail_setting.php');
			$mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
				
			$mailToArr=array();
			$mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
			//echo $mailSql;die;
			$mailSqlRes=sql_select($mailSql);
			foreach($mailSqlRes as $rows){
				if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
			}
			
			
			$mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=97 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
			//echo $mailSql;die;
			$mailSqlRes=sql_select($mailSql);
			foreach($mailSqlRes as $rows){
				if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
			}
			if($mail!=''){$mailToArr[]=$mail;}
			
			$to=implode(',',$mailToArr);
			$subject="Trims Booking Multy Job";
			$header=mailHeader();
			echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
			
		}
		else{
			echo $html;
		}
		exit();
}
if($action=="show_trim_booking_report4") // Aziz-5-5-2018
{

	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');

	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");

	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;
		$booking_grand_total=0;
		$currency_id="";


		$buyer_string=array();
		$style_owner=array();
		$job_no=array();
		$style_ref=array();
		$all_dealing_marcent=array();
		$season=array();
		$order_repeat_no=array();
		$po_id_arr=array();

		$nameArray_buyer=sql_select( "select  a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, b.po_break_down_id from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
        foreach ($nameArray_buyer as $result_buy){
			$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
			$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
			$season_matrix=$result_buy[csf('season_matrix')];
			$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
			if($season_matrix!=0 && $season_buyer_wise==0 )
			{
				$season_matrix_con=$season_matrix;
			}
			else if($season_buyer_wise!=0 && $season_matrix==0)
			{
				$season_matrix_con=$season_buyer_wise;
			}
			$seasons_name.=$season_arr[$season_matrix_con].',';
			$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
			$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

			$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];
		}
		$style_sting=implode(",",array_unique($style_ref));
		$job_no_str = "'" . implode( "','", $job_no ) . "'";
		$job_no=implode(",",$job_no);
		$seasons_names=rtrim($seasons_name,',');

		$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));
		$poid_arr=array_unique($po_id_arr);

		$order_rept_no=rtrim($order_rept_no,',');
		$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));

		$po_no=array();
		$file_no=array();
		$ref_no=array();
		$po_quantity=array();
		$pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';
		$nameArray_job=sql_select( "select max(a.update_date) as update_date,b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, sum(b.po_quantity) as po_quantity  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no ");
        foreach ($nameArray_job as $result_job){
			$po_no_arr[$result_job[csf('id')]]=$result_job[csf('po_number')];
			$job_file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
			$job_ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
			$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
			if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];
			$revised_update_date=explode(" ",$result_job[csf('update_date')]);
			$revised_date=strtotime($revised_update_date[0]);

		}
		$sql_job=sql_select( "select b.job_no_mst,b.id as po_id, b.po_quantity as po_quantity  from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.") ");
		foreach ($sql_job as $row)
		{
			$job_po_qty_arr[$row[csf('po_id')]]+=$row[csf('po_quantity')];
			$tot_po_quantity+=$row[csf('po_quantity')];
		}

        $nameArray=sql_select( "select a.booking_no, a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_address, a.delivery_date, a.source, a.remarks, a.revised_no,a.update_date from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
		foreach( $nameArray as $row)
		{
			$varcode_booking_no=$row[csf('booking_no')];
			$booking_date=$row[csf('booking_date')];
			$delivery_date=$row[csf('delivery_date')];
			$pay_mode_id=$row[csf('pay_mode')];
			$supplier_id=$row[csf('supplier_id')];
			$currency_id=$row[csf('currency_id')];
			$buyer_id=$row[csf('buyer_id')];
			$exchange_rate=$row[csf('exchange_rate')];
			$attention=$row[csf('attention')];
			$remarks=$row[csf('remarks')];
			$delivery_address=$row[csf('delivery_address')];

			$revised_no=$row[csf('revised_no')];
			$mst_update_date=explode(" ",$row[csf('update_date')]);
			$mst_revised_date=strtotime($mst_update_date[0]);


			$source_id=$row[csf('source')];
		}
		if($revised_date!="" && $mst_revised_date!="")
		{
			$max_revised_date_time=max($revised_date,$mst_revised_date);
			$max_revised_date=date('d-m-Y',$max_revised_date_time);
		}
		else if($revised_date!="" && $mst_revised_date=="")
		{
			//$max_revised_date=$revised_date;
			$max_revised_date=date('d-m-Y',$revised_date);
		}
		else if($mst_revised_date!="" && $revised_date=="")
		{

			$max_revised_date=date('d-m-Y',$mst_revised_date);
		}
		$main_fabric_approved = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and a.job_no in (".$job_no_str.") and b.entry_form=7 and a.status_active =1 and a.is_deleted=0 order by b.id asc");
	
	ob_start();
	
	?>
	<html>
	<head>
	<style type="text/css" media="print">
	table { page-break-inside:auto }


	</style>
	</head>


	<div style="width:1333px" align="center">
   <table width="1333px" cellpadding="0" cellspacing="0" style="border:0px solid black" >
   <thead>
       <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
           <tr>
               <td width="20px">
                    <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
                    <tr>
                    <td width="50" >
					   <? if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                                <img  src='../../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />

                       <?
                           }
                           else
                           {
                       ?>
                                <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                       <?	}
                       }
                       else
                       { ?>
                         <img  src='../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                      <? }
                       ?>
                   </td>
                    <td width="40px" align="center">
                    &nbsp;  &nbsp;  &nbsp;
                    </td>
                    <td width="30px"   align="center">

                   <b style="font-size:25px;"> <?
                    echo $company_library[$cbo_company_name]; ?>
                    </b>
                    <br>
                    <label>
                    	<?
                            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                            foreach ($nameArray as $result){
                          ?>
                              <?  if($result[csf('plot_no')]!='') echo $result[csf('plot_no')]; else echo '';?> &nbsp;
                                <? echo $result[csf('level_no')];?> &nbsp;
                                 <? echo $result[csf('road_no')]; ?>  &nbsp;
                                <? echo $result[csf('block_no')];?>  &nbsp;
                                <? echo $result[csf('city')];?>  &nbsp;
                                <? echo $result[csf('zip_code')]; ?>  &nbsp;
                                 <?php echo $result[csf('province')]; ?>  &nbsp;
                                <? echo $country_arr[$result[csf('country_id')]]; ?> &nbsp;<br/>
                                <? echo $result[csf('email')];?>  &nbsp;
                                <? echo $result[csf('website')];
								if($result[csf('plot_no')]!='')
								{
									$plot_no=$result[csf('plot_no')];
								}
								if($result[csf('level_no')]!='')
								{
									$level_no=$result[csf('level_no')];
								}
								if($result[csf('road_no')]!='')
								{
									$road_no=$result[csf('road_no')];
								}
								if($result[csf('block_no')]!='')
								{
									$block_no=$result[csf('block_no')];
								}
								if($result[csf('city')]!='')
								{
									$city=$result[csf('city')];
								}
								$company_address[$result[csf('id')]]=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
                            }
						?>
                        </label>
                        <br/>
                        <b style="font-size:20px;">
                         <?php echo $report_title; ?>
                        </b>
                    </td>
                     <td width="10px" align="center" style="font-size:20px;">
                      <table width="80%" align="right" cellpadding="0" cellspacing="0" style="border:0px solid black">
                      	<tr>
                            <td width="80">  Booking No:&nbsp; <?php echo $varcode_booking_no; ?>  </td>
                        </tr>
                        <tr>
                            <td>  Booking Date:&nbsp; <?php echo change_date_format($booking_date); ?>  </td>
                        </tr>
                        <?
                        if($revised_no>0)
						{
						?>
                        <tr>
                            <td>  Revised No:&nbsp; <?php echo $revised_no . '&nbsp(Date:' . change_date_format($max_revised_date) . ')'; ?>  </td>
                        </tr>
                        <?
						}
                        if(str_replace("'","",$id_approved_id) ==1)
						 {
						 ?>
                          <tr>
                             <td>Approved Status :&nbsp;  <? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </td>
                         </tr>
                         <?
						}
						 ?>
                      </table>

                     </td>
                   </tr>
                   </table>
               </td>
            </tr>
       </table>

		   <table width="100%" style="border:0px solid black;table-layout: fixed;">
				<tr>
					<td colspan="6" valign="top"></td>
				</tr>
				<tr>
					<td width="100" style="font-size:18px"><span><b>To, </b></span>  </td>
					<td width="110" colspan="5" style="font-size:18px">&nbsp;<span></span></td>
				</tr>
				<tr>

					<td width="210" colspan="2" style="font-size:18px">&nbsp; <b>
					<?
					if($pay_mode_id==5 || $pay_mode_id==3){
						echo $company_library[$supplier_id];
					}
					else{
						echo $supplier_name_arr[$supplier_id];
					}
					?></b>
					</td>
                    <td  width="100" style="font-size:12px"><b>Buyer.</b></td>
					<td  width="110" >:&nbsp;<? echo $buyer_name_arr[$buyer_id]; ?></td>
                    <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
					<td width="110">:&nbsp;<?  echo change_date_format($delivery_date); ?></td>
				</tr>
				<tr>

					<td width="110" colspan="2" rowspan="2" style="font-size:18px">Address :&nbsp;
					<?
					if($pay_mode_id==5 || $pay_mode_id==3){
						$address=$company_address[$supplier_id];
					}
					else{
						$address=$supplier_address_arr[$supplier_id];
					}
					echo $address;
					?></b>
					</td>
					<td width="100" style="font-size:12px"><b>PO Qty.</b>   </td>
					<td width="110">:&nbsp;<? echo $tot_po_quantity; ?></td>
                     <td style="font-size:12px" ><b>Delivery To </b>   </td>
					<td style="">:&nbsp;
					<?
						echo $delivery_address;
					?>
					</td>

				</tr>
                <tr>

                    <td width="100" style="font-size:12px"><b>Season</b> </td>
					<td width="110">:&nbsp;<? echo $seasons_names; ?></td>

                    <td width="100" style="font-size:12px"><b>Currency</b></td>
					<td width="110">:&nbsp;<?  echo $currency[$currency_id]; ?></td>

                </tr>
                <tr>
                    <td style="font-size:12px" ><b>Attention </b>   </td>
					<td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
					<?
						echo $attention;
					?>
					</td>
                    <td width="100" style="font-size:12px"><b>Order Repeat </b> </td>
					<td width="110">:&nbsp;<? echo $order_rept_no; ?></td>
                    <td  style="font-size:12px"><b>Pay mode</b></td>
                	<td>:&nbsp;<? echo $pay_mode[$pay_mode_id];?></td>

                </tr>

				 <tr>
                    <td style="font-size:12px"><b>Source</b></td>
                	<td>:&nbsp;<? echo $source[$source_id];?></td>
                    <td style="font-size:12px"><b>Dealing Merchant</b></td>
					<td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
					<?
						echo implode(",",array_unique($all_dealing_marcent));
					?>
					</td>
				</tr>
				<tr>
					<td width="100" style="font-size:12px"><b>Remarks</b>  </td>
					<td width="110" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" >:&nbsp;<? echo $remarks; ?></td>
					<td width="130" style="font-size:12px" align="left"><b>Main Fabric Booking 1<sup>st</sup> Approved Date</b></td>
                	<td align="left">:&nbsp;<?  echo change_date_format($main_fabric_approved[0][csf('approved_date')]); ?></td>

				</tr>
				</table>
    		</thead>
            <tbody>

          <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?

		$precost_arr=array();
		$trims_qtyPerUnit_arr=array();

		$precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0");
        $calUom="";
		foreach($precost_sql as $precost_row){
			if($precost_row[csf('cal_parameter')]==1){
			   $calUom="Mtr";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==2){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==3){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==4){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==5){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==6){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==7){
			   $calUom="Pcs";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==8){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else{
				$calUom=0;
			}
			 $trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
		}
		$booking_country_arr=array();
		$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,po_break_down_id as po_id,sensitivity,country_id_string,delivery_date from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0");
		foreach($nameArray_booking_country as $nameArray_booking_country_row){

			$po_delivery_date_arr[$nameArray_booking_country_row[csf('po_id')]]=$nameArray_booking_country_row[csf('delivery_date')];

			$country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
			$tocu=count($country_id_string);
			for($cu=0;$cu<$tocu;$cu++){
				$booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
			}
		}

		$nameArray_job_po=sql_select( "select job_no,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and status_active =1 and is_deleted=0 group by job_no,po_break_down_id order by job_no,po_break_down_id ");
		foreach($nameArray_job_po as $nameArray_job_po_row){
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]."   and sensitivity=1 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id  order by trim_group ");
	    if(count($nameArray_item)>0){

			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];
        ?>
        &nbsp;
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >

            <tr>
                <td colspan="9" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" align="left"><strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; if($ref_nos!='' ) echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;else " "; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;  Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]].' &nbsp;&nbsp;&nbsp; '; echo "&nbsp;&nbsp;Delivery Date:&nbsp;".change_date_format($po_delivery_date); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>



                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? }?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item){
			$i++;
            $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description,b.article_number, b.brand_supplier,b.item_color,a.gmts_color_id,b.gmts_sizes,b.item_size,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_id')]."  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id,b.item_color,a.gmts_color_id,b.gmts_sizes,b.item_size, b.description,b.article_number, b.brand_supplier,b.item_color order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center"  style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription){
                ?>
                <td style="border:1px solid black"><?  if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>

                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>


                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?
				$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];


				echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                  <? if($show_comment==1) {?>
                 <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

					echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                  <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="9"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->


        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id as po_id  from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]." and sensitivity=2 and  status_active =1 and  is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id  order by trim_group ");
		if(count($nameArray_item)>0)
		{

			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];

			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];

        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                 <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Size Sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; echo "&nbsp;&nbsp;Int Ref.:".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp; Po Qty..:".$po_no_qty; ?></strong></td>
                <td width="40%" style="margin-left:210px; font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]].'&nbsp; &nbsp; ';echo "&nbsp;Delivery Date:&nbsp;".change_date_format($po_delivery_date);  ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Article No</strong></td>
                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
			$i++;//
			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,b.article_number,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$result_item[csf('po_id')]." and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size,b.article_number order by b.article_number,bid");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][2]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black">
				<?
				if($result_itemdescription[csf('article_number')]!="no article"){
					echo $result_itemdescription[csf('article_number')];
				}else{
					echo "-";
				}
				?>
                </td>
                <td style="border:1px solid black; text-align:left">
              <? echo $result_itemdescription[csf('item_size')];?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>


                <td style="border:1px solid black; text-align:right">
				<?

				echo number_format($result_itemdescription[csf('cons')],4);

                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">

                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold"><?

					echo number_format($item_desctiption_total,4);
				 ?></td>
                 <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]."  and sensitivity=3 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id order by trim_group ");
		if(count($nameArray_item)>0)
		{

			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			//$job_no=$nameArray_job_po_row[csf('job_no')];
			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];

        ?>
        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="11" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" style="font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]]; echo "&nbsp;&nbsp;&nbsp;Delivery Date:&nbsp;".change_date_format($po_delivery_date); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$result_item[csf('po_id')]."  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by trim_group ", "item_color", "color_number_id"  );

			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.article_number,b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$result_item[csf('po_id')]." and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.article_number,b.brand_supplier,b.item_color,b.color_number_id order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>

                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   echo $color_library[$result_itemdescription[csf('color_number_id')]];
			   ?>
                </td>
               <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>

                <td style="border:1px solid black; text-align:right">
				<?

				echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?></p> </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

				echo number_format($item_desctiption_total,4);
				 ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]." and sensitivity=4 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id order by po_break_down_id,trim_group");
	   if(count($nameArray_item)>0)
		{


			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];

        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" ><strong>Color & size sensitive (<? echo "Job NO: ".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]] ;echo "&nbsp;&nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" style="font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]];echo "&nbsp;&nbsp;&nbsp;Delivery Date:&nbsp;".change_date_format($po_delivery_date); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group </strong> </td>


                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td style="border:1px solid black"><strong>Article No.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td style="border:1px solid black; width:170px;"><strong>Gmts Color</strong> </td>
                <td style="border:1px solid black;"><strong>Gmts Size</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.po_break_down_id=".$result_item[csf('po_id')]." and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by trim_group ", "item_color", "color_number_id"  );

			 $nameArray_color=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.color_number_id as gmt_color, b.item_color as color_number_id,b.item_size,b.gmts_sizes,b.description,b.article_number, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount, min(c.color_order) as color_order, min(c.size_order) as size_order,c.article_number from wo_booking_dtls a, wo_trim_book_con_dtls b,wo_po_color_size_breakdown c  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and b.po_break_down_id=c.po_break_down_id and b.color_number_id=c.color_number_id and b.gmts_sizes=c.size_number_id and  c.id=b.color_size_table_id and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'   and a.po_break_down_id=".$result_item[csf('po_id')]." and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=4 and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.color_number_id, b.item_color,b.item_size,b.gmts_sizes,b.description,b.article_number, b.brand_supplier,c.article_number order by c.article_number,color_order,size_order");



            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]."  and po_break_down_id=".$result_item[csf('po_id')]."  and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  status_active =1 and is_deleted=0 order by trim_group ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][4]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
				foreach($nameArray_color as $result_color)
                {
					?>

					<td style="border:1px solid black" ><? if($result_color[csf('description')]){echo $result_color[csf('description')];} ?> </td>
					<td style="border:1px solid black" ><? if($result_color[csf('brand_supplier')]){echo $result_color[csf('brand_supplier')]; }?> </td>
                    <td style="border:1px solid black">
					<?
					if($result_color[csf('article_number')]!="no article"){
						echo $result_color[csf('article_number')];
					}else{
						echo "-";
					}
					?>
                    </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('gmt_color')]];?> </td>
                    <td style="border:1px solid black; text-align:left">
					<? echo $size_library[$result_color[csf('gmts_sizes')]]; ?>
					</td>
					<td style="border:1px solid black; text-align:left">
					<? echo $result_color[csf('item_size')]; ?>
					</td>
                    <td style="border:1px solid black; text-align:left">
				   <?
				   $calUom=$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][2];
			       $calQty=explode("_",$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				   if($calUom && end($calQty)){
					   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
				   }
                   ?>
                    </td>

					<td style="border:1px solid black; text-align:right">
					<?

					echo number_format($result_color[csf('cons')],4);

					$item_desctiption_total += $result_color[csf('cons')] ;
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]];  ?></td>
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('rate')],4);
					?>
                     </td>
					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,2);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					$trims_remark=$trims_remark_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
					?>
					</td>
                     <? if($show_comment==1) {?>
                    <td style="border:1px solid black;text-align:center"><? echo $trims_remark; ?> </td>
                    <? } ?>
				</tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="10"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

				echo number_format($item_desctiption_total,4);  ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }

            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="13"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
       <?
		}
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->



         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]." and sensitivity=0 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];
        ?>
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>NO sensitive  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";  echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]];echo "&nbsp;&nbsp;&nbsp;Delivery Date:&nbsp;".change_date_format($po_delivery_date); ?></td>
                </tr>
                </table>
                 </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
				<td style="border:1px solid black"><strong>Article No.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td align="center" style="border:1px solid black"><strong> Qnty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                 <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                 <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description,b.article_number, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.po_break_down_id=".$result_item[csf('po_id')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description,b.article_number, b.brand_supplier,b.item_color");

            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">

                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);

				?>
                </td>
                <?
                $color_tatal=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
                $item_desctiption_total=0;
                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
				 <td style="border:1px solid black"><?
				  if($result_itemdescription[csf('article_number')]!="no article"){
						echo $result_itemdescription[csf('article_number')];
					}else{
						echo "-";
					}
				  ?>
				   </td>

                <td style="border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <?
				if($db_type==0)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.po_break_down_id=". $result_item[csf('po_id')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
						}
						if($db_type==2)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]."  and a.po_break_down_id=". $result_item[csf('po_id')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
						}

                foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right">
                <?
				//print_r($uom_arr);
				$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];
				//echo $order_uom_id.'DD';
                if($result_color_size_qnty[csf('cons')]!= "")
                {

               echo number_format($result_color_size_qnty[csf('cons')],4);
                $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                $color_tatal+=$result_color_size_qnty[csf('cons')];
                }
                else echo "";
                ?>
                </td>
                <?
                }
                ?>

                <td style="border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                 <td style="border:1px solid black; text-align:right"><? echo $trims_remark; ?> </td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;">
                <?
                if($color_tatal !='')
                {

						 echo number_format($color_tatal,4);
                }
                ?>
                </td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <?
		}
		}
		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->

       <?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>
       <br/>
       <table width="100%" style="margin-top:1px">
       <tr>
       <td>
       <table width="100%" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                <td width="70%" style="border:1px solid black; text-align:left"><strong><? echo number_format($booking_grand_total,2);?></strong></td>
            </tr>
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                <td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
            </tr>
       </table>
       </td>
       </tr>
       </table>
         <br/>
        <table width="100%">
        <tr>
        <td width="49%">
        <?
        	echo get_spacial_instruction($txt_booking_no);
        ?>
    	</td>
    <td width="2%"></td>
    <?
	 $data_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");

	?>
    <td width="49%" valign="top">
        <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">

            <tr style="border:1px solid black;">
                <td colspan="3" style="border:1px solid black;">Approval Status</td>
                </tr>
                <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;">Sl</td><td width="50%" style="border:1px solid black;">Name</td><td width="27%" style="border:1px solid black;">Approval Date</td><td width="20%" style="border:1px solid black;">Approval No</td>
                </tr>


            <?
			$i;
			foreach($data_array as $row){
			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td><td width="50%" style="border:1px solid black;"><? echo $row[csf('user_full_name')];?></td><td width="27%" style="border:1px solid black;"><? echo change_date_format($row[csf('approved_date')],"dd-mm-yyyy","-");?></td><td width="20%" style="border:1px solid black;"><? echo $row[csf('approved_no')];?></td>
                </tr>
                <?
				$i++;
			}
				?>

        </table>
    </td>
    </tr>
    </table>

   	 </tbody>
     </table>

    </div> <!--class="footer_signature"-->
    <div  style="margin-top:-5px;">
         <?
          echo signature_table(132, $cbo_company_name, "1330px",1);
		 ?>
      	</div>
        <br>
      <div id="page_break_div">
   	 </div>
     <br>
    <div>

		<?
        	//echo signature_table(2, $cbo_company_name, "1330px");
			echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>

	<?
    if($link == 1){
        ?>
        <script type="text/javascript" src="../../../js/jquery.js"></script>
        <script type="text/javascript" src="../../../js/jquerybarcode.js"></script>
    <?
    }else {
        ?>
         <script type="text/javascript" src="../../js/jquery.js"></script>
        <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
        <?
    }
        ?>
    <script>
    fnc_generate_Barcode('<? echo $varcode_booking_no; ?>','barcode_img_id');

    </script>
  </html>
	<?
	    $html = ob_get_contents();
		ob_clean();
		list($is_mail_send,$mail)=explode('___',$mail_send_data);
		if($is_mail_send==1){
			require_once('../../../mailer/class.phpmailer.php');
			require_once('../../../auto_mail/setting/mail_setting.php');
			$mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
				
			$mailToArr=array();
			$mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
			//echo $mailSql;die;
			$mailSqlRes=sql_select($mailSql);
			foreach($mailSqlRes as $rows){
				if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
			}
			
			
			$mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=97 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
			//echo $mailSql;die;
			$mailSqlRes=sql_select($mailSql);
			foreach($mailSqlRes as $rows){
				if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
			}
			if($mail!=''){$mailToArr[]=$mail;}
			
			$to=implode(',',$mailToArr);
			$subject="Trims Booking Multy Job";
			$header=mailHeader();
			echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
			
		}
		else{
			echo $html;
		}
		exit();
}
if($action=="show_trim_booking_report19") // Aziz-29-3-2022 
{

	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');

	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");

	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;
		$booking_grand_total=0;
		$currency_id="";


		$buyer_string=array();
		$style_owner=array();
		$job_no=array();
		$style_ref=array();
		$all_dealing_marcent=array();
		$season=array();
		$order_repeat_no=array();
		$po_id_arr=array();

		$nameArray_buyer=sql_select( "select  a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, b.po_break_down_id from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
        foreach ($nameArray_buyer as $result_buy){
			$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
			$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
			$season_matrix=$result_buy[csf('season_matrix')];
			$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
			if($season_matrix!=0 && $season_buyer_wise==0 )
			{
				$season_matrix_con=$season_matrix;
			}
			else if($season_buyer_wise!=0 && $season_matrix==0)
			{
				$season_matrix_con=$season_buyer_wise;
			}
			$seasons_name.=$season_arr[$season_matrix_con].',';
			$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
			$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

			$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];
		}
		$style_sting=implode(",",array_unique($style_ref));
		$job_no_str = "'" . implode( "','", $job_no ) . "'";
		$job_no=implode(",",$job_no);
		$seasons_names=rtrim($seasons_name,',');

		$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));
		$poid_arr=array_unique($po_id_arr);

		$order_rept_no=rtrim($order_rept_no,',');
		$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));

		$po_no=array();
		$file_no=array();
		$ref_no=array();
		$po_quantity=array();
		$pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';
		$nameArray_job=sql_select( "select max(a.update_date) as update_date,b.job_no_mst,b.id,a.pre_cost_fabric_cost_dtls_id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, sum(b.po_quantity) as po_quantity,b.shipment_date  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping,a.pre_cost_fabric_cost_dtls_id, b.file_no,b.shipment_date ");
        foreach ($nameArray_job as $result_job){
			$po_no_arr[$result_job[csf('id')]]=$result_job[csf('po_number')];
			$PretrimsDtlsIdArr[$result_job[csf('pre_cost_fabric_cost_dtls_id')]]=$result_job[csf('pre_cost_fabric_cost_dtls_id')];
			$job_file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
			$job_ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
			$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
			if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];
			$revised_update_date=explode(" ",$result_job[csf('update_date')]);
			$revised_date=strtotime($revised_update_date[0]);
			$shipdate_arr[$result_job[csf('id')]]=$result_job[csf('shipment_date')];
			

		}
		$sql_job=sql_select( "select b.job_no_mst,b.id as po_id,c.color_number_id,c.size_number_id, c.order_quantity as po_quantity  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where a.id=b.job_id and a.id=c.job_id and c.po_break_down_id=b.id and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and  c.status_active =1 and c.is_deleted=0 and b.id in(".$po_idss.") ");
		
		foreach ($sql_job as $row)
		{
			$job_po_qty_arr[$row[csf('po_id')]]+=$row[csf('po_quantity')];
			$color_size_qty_arr[$row[csf('po_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]+=$row[csf('po_quantity')];
			$tot_po_quantity+=$row[csf('po_quantity')];
		}

        $nameArray=sql_select( "select a.booking_no, a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_address, a.delivery_date, a.source, a.remarks, a.revised_no,a.update_date from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
		foreach( $nameArray as $row)
		{
			$varcode_booking_no=$row[csf('booking_no')];
			$booking_date=$row[csf('booking_date')];
			$delivery_date=$row[csf('delivery_date')];
			$pay_mode_id=$row[csf('pay_mode')];
			$supplier_id=$row[csf('supplier_id')];
			$currency_id=$row[csf('currency_id')];
			$buyer_id=$row[csf('buyer_id')];
			$exchange_rate=$row[csf('exchange_rate')];
			$attention=$row[csf('attention')];
			$remarks=$row[csf('remarks')];
			$delivery_address=$row[csf('delivery_address')];

			$revised_no=$row[csf('revised_no')];
			$mst_update_date=explode(" ",$row[csf('update_date')]);
			$mst_revised_date=strtotime($mst_update_date[0]);


			$source_id=$row[csf('source')];
		}
		if($revised_date!="" && $mst_revised_date!="")
		{
			$max_revised_date_time=max($revised_date,$mst_revised_date);
			$max_revised_date=date('d-m-Y',$max_revised_date_time);
		}
		else if($revised_date!="" && $mst_revised_date=="")
		{
			//$max_revised_date=$revised_date;
			$max_revised_date=date('d-m-Y',$revised_date);
		}
		else if($mst_revised_date!="" && $revised_date=="")
		{

			$max_revised_date=date('d-m-Y',$mst_revised_date);
		}
		$main_fabric_approved = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and a.job_no in (".$job_no_str.") and b.entry_form=7 and a.status_active =1 and a.is_deleted=0 order by b.id asc");
		
 ob_start();
	?>

 <body>
	<div style="width:1333px" align="center">
		<?php	//ob_start();	?>
		<table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
           <tr>
               <td width="20px">
                    <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
                    <tr>
                    <td width="50" >
					   <? if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                                <img  src='../../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />

                       <?
                           }
                           else
                           {
                       ?>
                                <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                       <?	}
                       }
                       else
                       { ?>
                         <img  src='../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                      <? }
                       ?>
                   </td>
                    <td width="40px" align="center">
                    &nbsp;  &nbsp;  &nbsp;
                    </td>
                    <td width="30px"   align="center">

                   <b style="font-size:25px;"> <?
                    echo $company_library[$cbo_company_name]; ?>
                    </b>
                    <br>
                    <label>
                    	<?
                            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                            foreach ($nameArray as $result){
                          ?>
                              <?  if($result[csf('plot_no')]!='') echo $result[csf('plot_no')]; else echo '';?> &nbsp;
                                <? echo $result[csf('level_no')];?> &nbsp;
                                 <? echo $result[csf('road_no')]; ?>  &nbsp;
                                <? echo $result[csf('block_no')];?>  &nbsp;
                                <? echo $result[csf('city')];?>  &nbsp;
                                <? echo $result[csf('zip_code')]; ?>  &nbsp;
                                 <?php echo $result[csf('province')]; ?>  &nbsp;
                                <? echo $country_arr[$result[csf('country_id')]]; ?> &nbsp;<br/>
                                <? echo $result[csf('email')];?>  &nbsp;
                                <? echo $result[csf('website')];
								if($result[csf('plot_no')]!='')
								{
									$plot_no=$result[csf('plot_no')];
								}
								if($result[csf('level_no')]!='')
								{
									$level_no=$result[csf('level_no')];
								}
								if($result[csf('road_no')]!='')
								{
									$road_no=$result[csf('road_no')];
								}
								if($result[csf('block_no')]!='')
								{
									$block_no=$result[csf('block_no')];
								}
								if($result[csf('city')]!='')
								{
									$city=$result[csf('city')];
								}
								$company_address[$result[csf('id')]]=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
                            }
						?>
                        </label>
                        <br/>
                        <b style="font-size:20px;">
                         <?php echo $report_title; ?>
                        </b>
                    </td>
                     <td width="10px" align="center" style="font-size:20px;">
                      <table width="80%" align="right" cellpadding="0" cellspacing="0" style="border:0px solid black">
                      	<tr>
                            <td width="80">  Booking No:&nbsp; <?php echo $varcode_booking_no; ?>  </td>
                        </tr>
                        <tr>
                            <td>  Booking Date:&nbsp; <?php echo change_date_format($booking_date); ?>  </td>
                        </tr>
                        <?
                        if($revised_no>0)
						{
						?>
                        <tr>
                            <td>  Revised No:&nbsp; <?php echo $revised_no . '&nbsp(Date:' . change_date_format($max_revised_date) . ')'; ?>  </td>
                        </tr>
                        <?
						}
                        if(str_replace("'","",$id_approved_id) ==1)
						 {
						 ?>
                          <tr>
                             <td>Approved Status :&nbsp;  <? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </td>
                         </tr>
                         <?
						}
						 ?>
                      </table>

                     </td>
                   </tr>
                   </table>
               </td>
            </tr>
       </table>
	   <table width="100%" style="border:0px solid black;table-layout: fixed;">
				<tr>
					<td colspan="6" valign="top"></td>
				</tr>
				<tr>
					<td width="100" style="font-size:18px"><span><b>To, </b></span>  </td>
					<td width="110" colspan="5" style="font-size:18px">&nbsp;<span></span></td>
				</tr>
				<tr>

					<td width="210" colspan="2" style="font-size:18px">&nbsp; <b>
					<?
					if($pay_mode_id==5 || $pay_mode_id==3){
						echo $company_library[$supplier_id];
					}
					else{
						echo $supplier_name_arr[$supplier_id];
					}
					?></b>
					</td>
                    <td  width="100" style="font-size:12px"><b>Buyer.</b></td>
					<td  width="110" >:&nbsp;<? echo $buyer_name_arr[$buyer_id]; ?></td>
                    <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
					<td width="110">:&nbsp;<?  echo change_date_format($delivery_date); ?></td>
				</tr>
				<tr>

					<td width="110" colspan="2" rowspan="2" style="font-size:18px">Address :&nbsp;
					<?
					if($pay_mode_id==5 || $pay_mode_id==3){
						$address=$company_address[$supplier_id];
					}
					else{
						$address=$supplier_address_arr[$supplier_id];
					}
					echo $address;
					?></b>
					</td>
					<td width="100" style="font-size:12px"><b>PO Qty.</b>   </td>
					<td width="110">:&nbsp;<? echo $tot_po_quantity; ?></td>
                     <td style="font-size:12px" ><b>Delivery To </b>   </td>
					<td style="">:&nbsp;
					<?
						echo $delivery_address;
					?>
					</td>

				</tr>
                <tr>

                    <td width="100" style="font-size:12px"><b>Season</b> </td>
					<td width="110">:&nbsp;<? echo $seasons_names; ?></td>

                    <td width="100" style="font-size:12px"><b>Currency</b></td>
					<td width="110">:&nbsp;<?  echo $currency[$currency_id]; ?></td>

                </tr>
                <tr>
                    <td style="font-size:12px" ><b>Attention </b>   </td>
					<td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
					<?
						echo $attention;
					?>
					</td>
                    <td width="100" style="font-size:12px"><b>Order Repeat </b> </td>
					<td width="110">:&nbsp;<? echo $order_rept_no; ?></td>
                    <td  style="font-size:12px"><b>Pay mode</b></td>
                	<td>:&nbsp;<? echo $pay_mode[$pay_mode_id];?></td>

                </tr>

				 <tr>
                    <td style="font-size:12px"><b>Source</b></td>
                	<td>:&nbsp;<? echo $source[$source_id];?></td>
                    <td style="font-size:12px"><b>Dealing Merchant</b></td>
					<td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
					<?
						echo implode(",",array_unique($all_dealing_marcent));
					?>
					</td>
				</tr>
				<tr>
					<td width="100" style="font-size:12px"><b>Remarks</b>  </td>
					<td width="110" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" >:&nbsp;<? echo $remarks; ?></td>
					<td width="130" style="font-size:12px" align="left"><b>Main Fabric Booking 1<sup>st</sup> Approved Date</b></td>
                	<td align="left">:&nbsp;<?  echo change_date_format($main_fabric_approved[0][csf('approved_date')]); ?></td>

				</tr>
			</table>


			   <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?

		$precost_arr=array();
		$trims_qtyPerUnit_arr=array();

		$precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0");
        $calUom="";
		foreach($precost_sql as $precost_row){
			if($precost_row[csf('cal_parameter')]==1){
			   $calUom="Mtr";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==2){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==3){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==4){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==5){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==6){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==7){
			   $calUom="Pcs";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==8){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else{
				$calUom=0;
			}
			 $trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
		}
		$booking_country_arr=array();
		$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,po_break_down_id as po_id,sensitivity,country_id_string,delivery_date from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0");
		foreach($nameArray_booking_country as $nameArray_booking_country_row){

			$po_delivery_date_arr[$nameArray_booking_country_row[csf('po_id')]]=$nameArray_booking_country_row[csf('delivery_date')];

			$country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
			$tocu=count($country_id_string);
			for($cu=0;$cu<$tocu;$cu++){
				$booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
			}
		}

		$nameArray_job_po=sql_select( "select job_no,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and status_active =1 and is_deleted=0 group by job_no,po_break_down_id order by job_no ");
		foreach($nameArray_job_po as $nameArray_job_po_row){
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]."   and sensitivity=1 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id  order by trim_group ");
	    if(count($nameArray_item)>0){

			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];
			$shipdate=$shipdate_arr[$nameArray_job_po_row[csf('po_id')]];
        ?>
        &nbsp;
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >

            <tr>
                <td colspan="11" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" align="left"><strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; if($ref_nos!='' ) echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;else " "; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;  Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]].' &nbsp;&nbsp;&nbsp; '; echo "&nbsp;&nbsp;Shipment Date:&nbsp;".change_date_format($shipdate); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>



                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? }?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item){
			$i++;
            $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description,b.article_number, b.brand_supplier,b.item_color,a.gmts_color_id,b.gmts_sizes,b.item_size,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_id')]."  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id,b.item_color,a.gmts_color_id,b.gmts_sizes,b.item_size, b.description,b.article_number, b.brand_supplier,b.item_color order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                	<? echo $i; ?>
                </td>
                <td align="center"  style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
					<?
					echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
					echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
					?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription){
                ?>
                <td style="border:1px solid black"><?  if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>

                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>


                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?
				$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];


				echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$po_id=$nameArray_job_po_row[csf('po_id')];
				$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['wo_qty']+=$result_itemdescription[csf('cons')];
				$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                  <? if($show_comment==1) {?>
                 <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

					echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                  <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="9"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->


        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id as po_id  from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]." and sensitivity=2 and  status_active =1 and  is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id  order by trim_group ");
		if(count($nameArray_item)>0)
		{

			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];

			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];
			$shipdate=$shipdate_arr[$nameArray_job_po_row[csf('po_id')]];
        ?>
		  <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                 <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Size Sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; echo "&nbsp;&nbsp;Int Ref.:".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp; Po Qty..:".$po_no_qty; ?></strong></td>
                <td width="40%" style="margin-left:210px; font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]].'&nbsp; &nbsp; ';echo "&nbsp;Shipment Date:&nbsp;".change_date_format($shipdate);  ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Article No</strong></td>
                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
			$i++;//
			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,b.article_number,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$result_item[csf('po_id')]." and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size,b.article_number order by b.article_number,bid");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][2]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black">
				<?
				if($result_itemdescription[csf('article_number')]!="no article"){
					echo $result_itemdescription[csf('article_number')];
				}else{
					echo "-";
				}
				?>
                </td>
                <td style="border:1px solid black; text-align:left">
              <? echo $result_itemdescription[csf('item_size')];?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>


                <td style="border:1px solid black; text-align:right">
				<?

				echo number_format($result_itemdescription[csf('cons')],4);

                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				
				$po_id=$result_item[csf('po_id')];
				$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['wo_qty']+=$result_itemdescription[csf('cons')];
				$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">

                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold"><?

					echo number_format($item_desctiption_total,4);
				 ?></td>
                 <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

		 <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]."  and sensitivity=3 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id order by trim_group ");
		if(count($nameArray_item)>0)
		{

			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			//$job_no=$nameArray_job_po_row[csf('job_no')];
			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];
			$shipdate=$shipdate_arr[$nameArray_job_po_row[csf('po_id')]];
        ?>
        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="11" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" style="font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]]; echo "&nbsp;&nbsp;&nbsp;Shipment Date:&nbsp;".change_date_format($shipdate); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$result_item[csf('po_id')]."  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by trim_group ", "item_color", "color_number_id"  );

			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.article_number,b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$result_item[csf('po_id')]." and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.article_number,b.brand_supplier,b.item_color,b.color_number_id order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>

                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   echo $color_library[$result_itemdescription[csf('color_number_id')]];
			   ?>
                </td>
               <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>

                <td style="border:1px solid black; text-align:right">
				<?

				echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				
				$po_id=$result_item[csf('po_id')];
				$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['wo_qty']+=$result_itemdescription[csf('cons')];
				$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				
				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?></p> </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

				echo number_format($item_desctiption_total,4);
				 ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]." and sensitivity=4 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id order by po_break_down_id,trim_group");
	   if(count($nameArray_item)>0)
		{


			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];
			$shipdate=$shipdate_arr[$nameArray_job_po_row[csf('po_id')]];
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" ><strong>Color & size sensitive (<? echo "Job NO: ".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]] ;echo "&nbsp;&nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" style="font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]];echo "&nbsp;&nbsp;&nbsp;Shipment Date:&nbsp;".change_date_format($shipdate); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group </strong> </td>


                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td style="border:1px solid black"><strong>Grmnts Order Qty</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td style="border:1px solid black; width:170px;"><strong>Gmts Color</strong> </td>
                <td style="border:1px solid black;"><strong>Gmts Size</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
               
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.po_break_down_id=".$result_item[csf('po_id')]." and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by trim_group ", "item_color", "color_number_id"  );

			 $nameArray_color=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.color_number_id as gmt_color, b.item_color as color_number_id,b.item_size,b.gmts_sizes,b.description,b.article_number, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount, min(c.color_order) as color_order, min(c.size_order) as size_order,c.article_number from wo_booking_dtls a, wo_trim_book_con_dtls b,wo_po_color_size_breakdown c  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and b.po_break_down_id=c.po_break_down_id and b.color_number_id=c.color_number_id and b.gmts_sizes=c.size_number_id and  c.id=b.color_size_table_id and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'   and a.po_break_down_id=".$result_item[csf('po_id')]." and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=4 and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.color_number_id, b.item_color,b.item_size,b.gmts_sizes,b.description,b.article_number, b.brand_supplier,c.article_number order by c.article_number,color_order,size_order");



            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]."  and po_break_down_id=".$result_item[csf('po_id')]."  and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  status_active =1 and is_deleted=0 order by trim_group ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][4]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
				foreach($nameArray_color as $result_color)
                {
					?>

					<td style="border:1px solid black" ><? if($result_color[csf('description')]){echo $result_color[csf('description')];} ?> </td>
					<td style="border:1px solid black" ><? if($result_color[csf('brand_supplier')]){echo $result_color[csf('brand_supplier')]; }?> </td>
                    <td style="border:1px solid black">
					<?
					$color_size_qty=$color_size_qty_arr[$result_item[csf('po_id')]][$result_color[csf('gmt_color')]][$result_color[csf('gmts_sizes')]];
					echo $color_size_qty;
					?>
                    </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('gmt_color')]];?> </td>
                    <td style="border:1px solid black; text-align:left">
					<? echo $size_library[$result_color[csf('gmts_sizes')]]; ?>
					</td>
					<td style="border:1px solid black; text-align:left">
					<? echo $result_color[csf('item_size')]; ?>
					</td>
                    <td style="border:1px solid black; text-align:left">
				   <?
				   $calUom=$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][2];
			       $calQty=explode("_",$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				   if($calUom && end($calQty)){
					   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
				   }
                   ?>
                    </td>

					<td style="border:1px solid black; text-align:right">
					<?

					echo number_format($result_color[csf('cons')],4);

					$item_desctiption_total += $result_color[csf('cons')] ;
					$po_id=$result_item[csf('po_id')];
					$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['wo_qty']+=$result_color[csf('cons')];
					$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['amount']+=$result_color[csf('cons')]*$result_color[csf('rate')];
				
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]];  ?></td>
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('rate')],4);
					?>
                     </td>
					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,2);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					$trims_remark=$trims_remark_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
					?>
					</td>
                    
				</tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="10"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

				echo number_format($item_desctiption_total,4);  ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                
            </tr>
            <?
            }

            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="13"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 
            </tr>
        </table>
        <br/>
       <?
		}
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->



         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]." and sensitivity=0 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];
			$shipdate=$shipdate_arr[$nameArray_job_po_row[csf('po_id')]];
        ?>
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>NO sensitive  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";  echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]];echo "&nbsp;&nbsp;&nbsp;Shipment Date:&nbsp;".change_date_format($shipdate); ?></td>
                </tr>
                </table>
                 </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
				<td style="border:1px solid black"><strong>Article No.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td align="center" style="border:1px solid black"><strong> Qnty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                 <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                 <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description,b.article_number, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.po_break_down_id=".$result_item[csf('po_id')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description,b.article_number, b.brand_supplier,b.item_color");

            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">

                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);

				?>
                </td>
                <?
                $color_tatal=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
                $item_desctiption_total=0;
                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
				 <td style="border:1px solid black"><?
				  if($result_itemdescription[csf('article_number')]!="no article"){
						echo $result_itemdescription[csf('article_number')];
					}else{
						echo "-";
					}
				  ?>
				   </td>

                <td style="border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <?
				if($db_type==0)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.po_break_down_id=". $result_item[csf('po_id')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
						}
						if($db_type==2)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]."  and a.po_break_down_id=". $result_item[csf('po_id')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
						}

                foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right">
                <?
				//print_r($uom_arr);
				$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];
				//echo $order_uom_id.'DD';
                if($result_color_size_qnty[csf('cons')]!= "")
                {

               echo number_format($result_color_size_qnty[csf('cons')],4);
                $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                $color_tatal+=$result_color_size_qnty[csf('cons')];
				
				$po_id=$result_item[csf('po_id')];
					$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['wo_qty']+=$result_color_size_qnty[csf('cons')];
					$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['amount']+=$result_color_size_qnty[csf('cons')]*$result_color_size_qnty[csf('rate')];
					
                }
                else echo "";
                ?>
                </td>
                <?
                }
                ?>

                <td style="border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                 <td style="border:1px solid black; text-align:right"><? echo $trims_remark; ?> </td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;">
                <?
                if($color_tatal !='')
                {

						 echo number_format($color_tatal,4);
                }
                ?>
                </td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <?
		}
		}
		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->

       <?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>
       <br/>
       <table width="100%" style="margin-top:1px">
       <tr>
       <td>
       <table width="100%" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                <td width="70%" style="border:1px solid black; text-align:left"><strong><? echo number_format($booking_grand_total,2);?></strong></td>
            </tr>
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                <td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
            </tr>
       </table>
       </td>
       </tr>
       </table>
         <br/>
        <table width="100%">
        <tr>
        <td width="49%">
        <?
        	echo get_spacial_instruction($txt_booking_no);
        ?>
    	</td>
    <td width="2%"></td>
    <?
	 $data_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");

	?>
    <td width="49%" valign="top">
        <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">

            <tr style="border:1px solid black;">
                <td colspan="3" style="border:1px solid black;">Approval Status</td>
                </tr>
                <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;">Sl</td><td width="50%" style="border:1px solid black;">Name</td><td width="27%" style="border:1px solid black;">Approval Date</td><td width="20%" style="border:1px solid black;">Approval No</td>
                </tr>


            <?
			$i;
			foreach($data_array as $row){
			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td><td width="50%" style="border:1px solid black;"><? echo $row[csf('user_full_name')];?></td><td width="27%" style="border:1px solid black;"><? echo change_date_format($row[csf('approved_date')],"dd-mm-yyyy","-");?></td><td width="20%" style="border:1px solid black;"><? echo $row[csf('approved_no')];?></td>
                </tr>
                <?
				$i++;
			}
				?>

        </table>
        <br>
        <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">

            <tr style="border:1px solid black;">
                <td colspan="3" style="border:1px solid black; text-align:center">Item Image</td>
                </tr>
                <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"> <?
				 
				$trimsDtlsId=implode(",",$PretrimsDtlsIdArr);
				 
				$item_imge_arr=sql_select("select a.master_tble_id,a.image_location from   common_photo_library a,wo_pre_cost_trim_cost_dtls b where  to_char(b.id)=a.master_tble_id and  a.form_name='pre_cost_trimsv2' and a.file_type=1 and b.id in($trimsDtlsId)");
				 
				?>
				 <p>
			<?	foreach($item_imge_arr as $row)
			   {
				 if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                               <img  src='../../../<? echo $row[csf('image_location')]; ?>' height='75px' width='170px' />  &nbsp;

                       <?
                           }
                           else
                           {
                       ?>
                               <img  src='../../<? echo $row[csf('image_location')]; ?>' height='75px' width='170px' />&nbsp;
                       <?	}
                       }
                       else
                       { ?>
                           <img  src='../<? echo $row[csf('image_location')]; ?>' height='75px' width='170px' />&nbsp;
                      <? }

				  }
                       ?>
					   </p></td>
                
                </tr>


            <?
			$i;
			foreach($data_array as $row){
			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td><td width="50%" style="border:1px solid black;"><? echo $row[csf('user_full_name')];?></td><td width="27%" style="border:1px solid black;"><? echo change_date_format($row[csf('approved_date')],"dd-mm-yyyy","-");?></td><td width="20%" style="border:1px solid black;"><? echo $row[csf('approved_no')];?></td>
                </tr>
                <?
				$i++;
			}
				?>

        </table>
    </td>
    </tr>
    
    	<tr>
        <td>
        <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
             <tr style="border:1px solid black;">
                <td width="20%" style="border:1px solid black;"><strong>Item Name</strong></td>
                <td width="30%" style="border:1px solid black;"><strong>PO Number</strong></td>
                <td width="15%" style="border:1px solid black;"><strong>PO Qty</strong></td>
                <td width="20%" style="border:1px solid black;"><strong>WO Qty</strong></td>
                <td width="10%" style="border:1px solid black;"><strong>Rate</strong></td>
                <td width="20%" style="border:1px solid black;"><strong>Amount</strong></td>
                    
            </tr>
				<?
            $i;$tot_po_qty=$tot_wo_qty=$tot_wo_amount=0;
            foreach($trim_cons_arr as $item_id=>$item_data)
            {
				$k;$sub_po_qty=$sub_wo_qty=$sub_wo_amount=0;
				foreach($item_data as $poId=>$row){
					
					$po_no_qty=$job_po_qty_arr[$poId];
			?>
			<tr style="border:1px solid black;">
                <td  style="border:1px solid black;"><? echo $trim_group_library[$item_id];?></td>
                <td  style="border:1px solid black;"><? echo $po_no_arr[$poId];?></td>
                <td align="right" style="border:1px solid black;"><? echo number_format($po_no_qty,0);?></td>
                <td  align="right" style="border:1px solid black;"><? echo number_format($row[('wo_qty')],2);?></td>
               
                <td  align="right" style="border:1px solid black;"><? echo number_format($row[('amount')]/$row[('wo_qty')],4);?></td>
                <td  align="right" style="border:1px solid black;"><? echo number_format($row[('amount')],2);?></td>
                </tr>
					<?
					$k++;
				$sub_po_qty+=$po_no_qty;
				$sub_wo_qty+=$row[('wo_qty')];
				$sub_wo_amount+=$row[('amount')];

					$i++;
				$tot_po_qty+=$po_no_qty;
				$tot_wo_qty+=$row[('wo_qty')];
				$tot_wo_amount+=$row[('amount')];
				}
				?>
				<tr style="border:1px solid black;">
                <td  colspan="2" style="border:1px solid black; text-align:right">Sub Total</td>
                <td align="right" style="border:1px solid black;"><strong><? echo number_format($sub_po_qty,2);?></strong></td>
                <td align="right" style="border:1px solid black;"><strong><? echo number_format($sub_wo_qty,2);?></strong></td>
                <td style="border:1px solid black; text-align:left"><strong> &nbsp;</strong></td>               
                <td align="right" style="border:1px solid black;"><strong><? echo number_format($sub_wo_amount,2);?></strong></td>
                
              </tr>
				<?
            }
            ?>
            <tr style="border:1px solid black;">
                <td  colspan="2" style="border:1px solid black; text-align:right">Total</td>
                <td align="right" style="border:1px solid black;"><strong><? echo number_format($tot_po_qty,2);?></strong></td>
                <td align="right" style="border:1px solid black;"><strong><? echo number_format($tot_wo_qty,2);?></strong></td>
                <td style="border:1px solid black; text-align:left"><strong>&nbsp;</strong></td>                
                <td align="right" style="border:1px solid black;"><strong><? echo number_format($tot_wo_amount,2);?></strong></td>
                
              </tr>

        </table>
        
        </td>
        </tr>
    </table>



    </div>

 </body>
	 
		

     <br>
    <div>

		<?
        	
			echo signature_table(132, $cbo_company_name, "1330px");
			
		
		 echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>

	<?
	
	



    if($link == 1){
        ?>
        <script type="text/javascript" src="../../../js/jquery.js"></script>
        <script type="text/javascript" src="../../../js/jquerybarcode.js"></script>
    <?
    }else {
        ?>
         <script type="text/javascript" src="../../js/jquery.js"></script>
        <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
        <?
    }
        ?>
    <script>
    fnc_generate_Barcode('<? echo $varcode_booking_no; ?>','barcode_img_id');

    </script>
 
	<?
	
 		$user_id=$_SESSION['logic_erp']['user_id'];
		$report_category=101;
		$html = ob_get_contents();
		ob_clean();
		//$new_link=create_delete_report_file( $html, 2, $delete, "../../../" );
		foreach (glob("tb*.xls") as $filename) {
		//if( @filemtime($filename) < (time()-$seconds_old) )
		@unlink($filename);
		}
		//---------end------------//
		$name=time();
		$filename="tb".$user_id."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc, $html);
		

		list($is_mail_send,$mail)=explode('___',$mail_send_data);
		if($is_mail_send==1){
			require_once('../../../mailer/class.phpmailer.php');
			require_once('../../../auto_mail/setting/mail_setting.php');
			$mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
				
			$mailToArr=array();
			$mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
			//echo $mailSql;die;
			$mailSqlRes=sql_select($mailSql);
			foreach($mailSqlRes as $rows){
				if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
			}
			
			
			$mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=98 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
			//echo $mailSql;die;
			$mailSqlRes=sql_select($mailSql);
			foreach($mailSqlRes as $rows){
				if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
			}
			
			if($mail!=''){$mailToArr[]=$mail;}
			$to=implode(',',$mailToArr);
			 $subject=" Trims Booking Multi Job ";
			$header=mailHeader();
			echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
			
		}
		else{
			echo "$html####$filename####$report_category";
		}
		exit();
	


		
	 
}
if($action=="show_trim_booking_report15") // Md Mamun-09-11-2021
{

	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');

	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");

	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;
		$booking_grand_total=0;
		$currency_id="";


		$buyer_string=array();
		$style_owner=array();
		$job_no=array();
		$style_ref=array();
		$all_dealing_marcent=array();
		$season=array();
		$order_repeat_no=array();
		$po_id_arr=array();

		$nameArray_buyer=sql_select( "select  a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, b.po_break_down_id from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
        foreach ($nameArray_buyer as $result_buy){
			$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
			$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
			$season_matrix=$result_buy[csf('season_matrix')];
			$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
			if($season_matrix!=0 && $season_buyer_wise==0 )
			{
				$season_matrix_con=$season_matrix;
			}
			else if($season_buyer_wise!=0 && $season_matrix==0)
			{
				$season_matrix_con=$season_buyer_wise;
			}
			$seasons_name.=$season_arr[$season_matrix_con].',';
			$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
			$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

			$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];
		}
		$style_sting=implode(",",array_unique($style_ref));
		$job_no_str = "'" . implode( "','", $job_no ) . "'";
		$job_no=implode(",",$job_no);
		$seasons_names=rtrim($seasons_name,',');

		$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));
		$poid_arr=array_unique($po_id_arr);

		$order_rept_no=rtrim($order_rept_no,',');
		$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));

		$po_no=array();
		$file_no=array();
		$ref_no=array();
		$po_quantity=array();
		$pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';
		$nameArray_job=sql_select( "select max(a.update_date) as update_date,b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, sum(b.po_quantity) as po_quantity  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no ");
        foreach ($nameArray_job as $result_job){
			$po_no_arr[$result_job[csf('id')]]=$result_job[csf('po_number')];
			$job_file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
			$job_ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
			$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
			if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];
			$revised_update_date=explode(" ",$result_job[csf('update_date')]);
			$revised_date=strtotime($revised_update_date[0]);

		}
		$sql_job=sql_select( "select b.job_no_mst,b.id as po_id, b.po_quantity as po_quantity  from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.") ");
		foreach ($sql_job as $row)
		{
			$job_po_qty_arr[$row[csf('po_id')]]+=$row[csf('po_quantity')];
			$tot_po_quantity+=$row[csf('po_quantity')];
		}

        $nameArray=sql_select( "select a.booking_no, a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.source, a.remarks, a.revised_no,a.update_date from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
		foreach( $nameArray as $row)
		{
			$varcode_booking_no=$row[csf('booking_no')];
			$booking_date=$row[csf('booking_date')];
			$delivery_date=$row[csf('delivery_date')];
			$pay_mode_id=$row[csf('pay_mode')];
			$supplier_id=$row[csf('supplier_id')];
			$currency_id=$row[csf('currency_id')];
			$buyer_id=$row[csf('buyer_id')];
			$exchange_rate=$row[csf('exchange_rate')];
			$attention=$row[csf('attention')];
			$remarks=$row[csf('remarks')];
			$revised_no=$row[csf('revised_no')];
			$mst_update_date=explode(" ",$row[csf('update_date')]);
			$mst_revised_date=strtotime($mst_update_date[0]);


			$source_id=$row[csf('source')];
		}
		if($revised_date!="" && $mst_revised_date!="")
		{
			$max_revised_date_time=max($revised_date,$mst_revised_date);
			$max_revised_date=date('d-m-Y',$max_revised_date_time);
		}
		else if($revised_date!="" && $mst_revised_date=="")
		{
			//$max_revised_date=$revised_date;
			$max_revised_date=date('d-m-Y',$revised_date);
		}
		else if($mst_revised_date!="" && $revised_date=="")
		{

			$max_revised_date=date('d-m-Y',$mst_revised_date);
		}
		$main_fabric_approved = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and a.job_no in (".$job_no_str.") and b.entry_form=7 and a.status_active =1 and a.is_deleted=0 order by b.id asc");
	ob_start();
	
	?>
	<html>
	<head>
	<style type="text/css" media="print">
	table { page-break-inside:auto }


	</style>
	</head>


	<div style="width:1333px" align="center">
   <table width="1333px" cellpadding="0" cellspacing="0" style="border:0px solid black" >
   <thead>
       <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
           <tr>
               <td width="20px">
                    <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
                    <tr>
                    <td width="50" >
					   <? if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                                <img  src='../../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />

                       <?
                           }
                           else
                           {
                       ?>
                                <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                       <?	}
                       }
                       else
                       { ?>
                         <img  src='../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                      <? }
                       ?>
                   </td>
                    <td width="40px" align="center">
                    &nbsp;  &nbsp;  &nbsp;
                    </td>
                    <td width="30px"   align="center">

                   <b style="font-size:25px;"> <?
                    echo $company_library[$cbo_company_name]; ?>
                    </b>
                    <br>
                    <label>
                    	<?
                            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                            foreach ($nameArray as $result){
                          ?>
                              <?  if($result[csf('plot_no')]!='') echo $result[csf('plot_no')]; else echo '';?> &nbsp;
                                <? echo $result[csf('level_no')];?> &nbsp;
                                 <? echo $result[csf('road_no')]; ?>  &nbsp;
                                <? echo $result[csf('block_no')];?>  &nbsp;
                                <? echo $result[csf('city')];?>  &nbsp;
                                <? echo $result[csf('zip_code')]; ?>  &nbsp;
                                 <?php echo $result[csf('province')]; ?>  &nbsp;
                                <? echo $country_arr[$result[csf('country_id')]]; ?> &nbsp;<br/>
                                <? echo $result[csf('email')];?>  &nbsp;
                                <? echo $result[csf('website')];
								if($result[csf('plot_no')]!='')
								{
									$plot_no=$result[csf('plot_no')];
								}
								if($result[csf('level_no')]!='')
								{
									$level_no=$result[csf('level_no')];
								}
								if($result[csf('road_no')]!='')
								{
									$road_no=$result[csf('road_no')];
								}
								if($result[csf('block_no')]!='')
								{
									$block_no=$result[csf('block_no')];
								}
								if($result[csf('city')]!='')
								{
									$city=$result[csf('city')];
								}
								$company_address[$result[csf('id')]]=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
                            }
						?>
                        </label>
                        <br/>
                        <b style="font-size:20px;">
                         <?php echo $report_title; ?>
                        </b>
                    </td>
                     <td width="10px" align="center" style="font-size:20px;">
                      <table width="80%" align="right" cellpadding="0" cellspacing="0" style="border:0px solid black">
                      	<tr>
                            <td width="80">  Booking No:&nbsp; <?php echo $varcode_booking_no; ?>  </td>
                        </tr>
                        <tr>
                            <td>  Booking Date:&nbsp; <?php echo change_date_format($booking_date); ?>  </td>
                        </tr>
                        <?
                        if($revised_no>0)
						{
						?>
                        <tr>
                            <td>  Revised No:&nbsp; <?php echo $revised_no . '&nbsp(Date:' . change_date_format($max_revised_date) . ')'; ?>  </td>
                        </tr>
                        <?
						}
                        if(str_replace("'","",$id_approved_id) ==1)
						 {
						 ?>
                          <tr>
                             <td>Approved Status :&nbsp;  <? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </td>
                         </tr>
                         <?
						}
						 ?>
                      </table>

                     </td>
                   </tr>
                   </table>
               </td>
            </tr>
       </table>

		   <table width="100%" style="border:0px solid black;table-layout: fixed;">
				<tr>
					<td colspan="6" valign="top"></td>
				</tr>
				<tr>
					<td width="100" style="font-size:18px"><span><b>To, </b></span>  </td>
					<td width="110" colspan="5" style="font-size:18px">&nbsp;<span></span></td>
				</tr>
				<tr>

					<td width="210" colspan="2" style="font-size:18px">&nbsp; <b>
					<?
					if($pay_mode_id==5 || $pay_mode_id==3){
						echo $company_library[$supplier_id];
					}
					else{
						echo $supplier_name_arr[$supplier_id];
					}
					?></b>
					</td>
                    <td  width="100" style="font-size:12px"><b>Buyer.</b></td>
					<td  width="110" >:&nbsp;<? echo $buyer_name_arr[$buyer_id]; ?></td>
                    <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
					<td width="110">:&nbsp;<?  echo change_date_format($delivery_date); ?></td>
				</tr>
				<tr>

					<td width="110" colspan="2" rowspan="2" style="font-size:18px">Address :&nbsp;
					<?
					if($pay_mode_id==5 || $pay_mode_id==3){
						$address=$company_address[$supplier_id];
					}
					else{
						$address=$supplier_address_arr[$supplier_id];
					}
					echo $address;
					?></b>
					</td>
					<td width="100" style="font-size:12px"><b>PO Qty.</b>   </td>
					<td width="110">:&nbsp;<? echo $tot_po_quantity; ?></td>
                     <td style="font-size:12px" ><b>Delivery To </b>   </td>
					<td style="">:&nbsp;
					<?
						//echo $attention;
					?>
					</td>

				</tr>
                <tr>

                    <td width="100" style="font-size:12px"><b>Season</b> </td>
					<td width="110">:&nbsp;<? echo $seasons_names; ?></td>

                    <td width="100" style="font-size:12px"><b>Currency</b></td>
					<td width="110">:&nbsp;<?  echo $currency[$currency_id]; ?></td>

                </tr>
                <tr>
                    <td style="font-size:12px" ><b>Attention </b>   </td>
					<td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
					<?
						echo $attention;
					?>
					</td>
                    <td width="100" style="font-size:12px"><b>Order Repeat </b> </td>
					<td width="110">:&nbsp;<? echo $order_rept_no; ?></td>
                    <td  style="font-size:12px"><b>Pay mode</b></td>
                	<td>:&nbsp;<? echo $pay_mode[$pay_mode_id];?></td>

                </tr>

				 <tr>
                    <td style="font-size:12px"><b>Source</b></td>
                	<td>:&nbsp;<? echo $source[$source_id];?></td>
                    <td style="font-size:12px"><b>Dealing Merchant</b></td>
					<td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
					<?
						echo implode(",",array_unique($all_dealing_marcent));
					?>
					</td>
				</tr>
				<tr>
					<td width="100" style="font-size:12px"><b>Remarks</b>  </td>
					<td width="110" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" >:&nbsp;<? echo $remarks; ?></td>
					<td width="130" style="font-size:12px" align="left"><b>Main Fabric Booking 1<sup>st</sup> Approved Date</b></td>
                	<td align="left">:&nbsp;<?  echo change_date_format($main_fabric_approved[0][csf('approved_date')]); ?></td>

				</tr>
				</table>
    		</thead>
            <tbody>

          <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?

		$precost_arr=array();
		$trims_qtyPerUnit_arr=array();

		$precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0");
        $calUom="";
		foreach($precost_sql as $precost_row){
			if($precost_row[csf('cal_parameter')]==1){
			   $calUom="Mtr";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==2){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==3){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==4){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==5){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==6){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==7){
			   $calUom="Pcs";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==8){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else{
				$calUom=0;
			}
			 $trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
		}
		$booking_country_arr=array();
		$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,po_break_down_id as po_id,sensitivity,country_id_string,delivery_date from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0");
		foreach($nameArray_booking_country as $nameArray_booking_country_row){

			$po_delivery_date_arr[$nameArray_booking_country_row[csf('po_id')]]=$nameArray_booking_country_row[csf('delivery_date')];

			$country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
			$tocu=count($country_id_string);
			for($cu=0;$cu<$tocu;$cu++){
				$booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
			}
		}

		$nameArray_job_po=sql_select( "select job_no,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and status_active =1 and is_deleted=0 group by job_no,po_break_down_id order by job_no ");
		foreach($nameArray_job_po as $nameArray_job_po_row){
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]."   and sensitivity=1 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id  order by trim_group ");
	    if(count($nameArray_item)>0){

			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];
        ?>
        &nbsp;
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >

            <tr>
                <td colspan="9" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" align="left"><strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; if($ref_nos!='' ) echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;else " "; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;  Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]].' &nbsp;&nbsp;&nbsp; '; echo "&nbsp;&nbsp;Delivery Date:&nbsp;".change_date_format($po_delivery_date); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>



                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? }?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item){
			$i++;
            $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description,b.article_number, b.brand_supplier,b.item_color,a.gmts_color_id,b.gmts_sizes,b.item_size,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_id')]."  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id,b.item_color,a.gmts_color_id,b.gmts_sizes,b.item_size, b.description,b.article_number, b.brand_supplier,b.item_color order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center"  style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription){
                ?>
                <td style="border:1px solid black"><?  if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>

                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>


                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?
				$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];


				echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                  <? if($show_comment==1) {?>
                 <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

					echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                  <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="9"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->


        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id as po_id  from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]." and sensitivity=2 and  status_active =1 and  is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id  order by trim_group ");
		if(count($nameArray_item)>0)
		{

			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];

			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];

			$item_wise_data=array();	$size_arr=array();	$size_wise_qnty=array();
			foreach($nameArray_item as $result_item)
            {
			$i++;//
			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,b.article_number,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$result_item[csf('po_id')]." and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size,b.article_number order by b.article_number,bid");

				foreach($nameArray_item_description as $row)
				{

					$item_wise_data[$result_item[csf('trim_group')]]['description']=$row[csf('description')];
					$item_wise_data[$result_item[csf('trim_group')]]['pre_cost_fabric_cost_dtls_id']=$row[csf('pre_cost_fabric_cost_dtls_id')];
					$item_wise_data[$result_item[csf('trim_group')]]['article_number']=$row[csf('article_number')];
					$item_wise_data[$result_item[csf('trim_group')]]['rate']=$row[csf('rate')];
					$item_wise_data[$result_item[csf('trim_group')]]['amount']+=$row[csf('cons')]*$row[csf('rate')];
					$size_arr[$row[csf('item_size')]]=$row[csf('item_size')];
					$size_wise_qnty[$row[csf('item_size')]]['qnty']+=$row[csf('cons')];

				}
			}

			//  echo "<pre>";
			//  print_r($size_arr);
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                 <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Size Sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; echo "&nbsp;&nbsp;Int Ref.:".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp; Po Qty..:".$po_no_qty; ?></strong></td>
                <td width="40%" style="margin-left:210px; font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]].'&nbsp; &nbsp; ';echo "&nbsp;Delivery Date:&nbsp;".change_date_format($po_delivery_date);  ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black" rowspan="2"><strong>Sl</strong> </td>
                <td style="border:1px solid black" rowspan="2"><strong>Item Group</strong> </td>
                <td style="border:1px solid black" rowspan="2"><strong>Item Description</strong> </td>
                <td style="border:1px solid black" rowspan="2"><strong>Brand/Supplier Ref.</strong> </td>
                 <td align="center" style="border:1px solid black" rowspan="2"><strong>Article No</strong></td>
                <td align="center" style="border:1px solid black" colspan="<?=count($size_arr);?>"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black" rowspan="2"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
			<tr>
             <?php
			 foreach($size_arr as $row){?>
                <td align="center" style="border:1px solid black"><strong><?=$row;?></strong></td>
				<?}?>
               
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0; $item_sum=array();
            foreach($item_wise_data as $item=>$result_item)
            {
			$i++;//
		
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$item]."<br/>";
				echo implode(",",$booking_country_arr[$result_item['pre_cost_fabric_cost_dtls_id']][2]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                

                ?>
                <td style="border:1px solid black"><? if($result_item['description']){ echo $result_item['description'];}?> </td>
                <td style="border:1px solid black"><? if($result_item['brand_supplier']){echo $result_item['brand_supplier'];} ?> </td>
                <td style="border:1px solid black">
				<?
				if($result_item['article_number']!="no article"){
					echo $result_item['article_number'];
				}else{
					echo "-";
				}
				?>
                </td>
				<?php
					 foreach($size_arr as $row){?>
                <td style="border:1px solid black; text-align:left">
            		  <? echo $size_wise_qnty[$row]['qnty'];
					  
						$item_sum[$item]+=$size_wise_qnty[$row]['qnty'];
					 ?>
                </td>
				<?}?>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_item['pre_cost_fabric_cost_dtls_id']][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_item['pre_cost_fabric_cost_dtls_id']][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>


                <td style="border:1px solid black; text-align:right">
				<?

				echo $item_sum[$item];

                $item_desctiption_total += $item_sum[$item] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$item]]; $uom_text=$unit_of_measurement[$order_uom_arr[$item]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_item['rate'],4); ?> </td>
                <td style="border:1px solid black; text-align:right">

                <?
                $amount_as_per_gmts_color = $result_item['amount'];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_item['pre_cost_fabric_cost_dtls_id']]['remark'];
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                <? } ?>
            </tr>
            <?
            
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="<?=count($size_arr)+4;?>"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold"><?

					echo number_format($item_desctiption_total,4);
				 ?></td>
                 <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"   colspan="<?=count($size_arr)+7;?>"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]."  and sensitivity=3 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id order by trim_group ");
		if(count($nameArray_item)>0)
		{

			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			//$job_no=$nameArray_job_po_row[csf('job_no')];
			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];

        ?>
        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="11" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" style="font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]]; echo "&nbsp;&nbsp;&nbsp;Delivery Date:&nbsp;".change_date_format($po_delivery_date); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$result_item[csf('po_id')]."  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by trim_group ", "item_color", "color_number_id"  );

			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.article_number,b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$result_item[csf('po_id')]." and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.article_number,b.brand_supplier,b.item_color,b.color_number_id order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>

                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   echo $color_library[$result_itemdescription[csf('color_number_id')]];
			   ?>
                </td>
               <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>

                <td style="border:1px solid black; text-align:right">
				<?

				echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?></p> </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

				echo number_format($item_desctiption_total,4);
				 ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]." and sensitivity=4 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id order by po_break_down_id,trim_group");
	   if(count($nameArray_item)>0)
		{


			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];


			foreach($nameArray_item as $result_item)
            {
				$i++;

				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.po_break_down_id=".$result_item[csf('po_id')]." and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by trim_group ", "item_color", "color_number_id"  );

			 $nameArray_color=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.color_number_id as gmt_color, b.item_color as color_number_id,b.item_size,b.gmts_sizes,b.description,b.article_number, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount, min(c.color_order) as color_order, min(c.size_order) as size_order,c.article_number from wo_booking_dtls a, wo_trim_book_con_dtls b,wo_po_color_size_breakdown c  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and b.po_break_down_id=c.po_break_down_id and b.color_number_id=c.color_number_id and b.gmts_sizes=c.size_number_id and  c.id=b.color_size_table_id and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'   and a.po_break_down_id=".$result_item[csf('po_id')]." and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=4 and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.color_number_id, b.item_color,b.item_size,b.gmts_sizes,b.description,b.article_number, b.brand_supplier,c.article_number order by c.article_number,color_order,size_order");

			

			 


            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]."  and po_break_down_id=".$result_item[csf('po_id')]."  and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  status_active =1 and is_deleted=0 order by trim_group ");

			$color_size_wise_data=array();$size_arr=array();$color_size_wise_qnty=array();
				foreach($nameArray_color as $result_color){

					$color_size_wise_data[$result_item[csf('trim_group')]][$result_color[csf('color_number_id')]]['description']=$result_color[csf('description')];
					$color_size_wise_data[$result_item[csf('trim_group')]][$result_color[csf('color_number_id')]]['brand_supplier']=$result_color[csf('brand_supplier')];;
					$color_size_wise_data[$result_item[csf('trim_group')]][$result_color[csf('color_number_id')]]['pre_cost_fabric_cost_dtls_id']=$result_color[csf('pre_cost_fabric_cost_dtls_id')];;
					$color_size_wise_data[$result_item[csf('trim_group')]][$result_color[csf('color_number_id')]]['brand_supplier']=$result_color[csf('brand_supplier')];;
					$color_size_wise_data[$result_item[csf('trim_group')]][$result_color[csf('color_number_id')]]['rate']=$result_color[csf('rate')];;
					$color_size_wise_data[$result_item[csf('trim_group')]][$result_color[csf('color_number_id')]]['amount']=$result_color[csf('amount')];;
					$size_arr[$result_color[csf('item_size')]]=$result_color[csf('item_size')];
					$color_size_wise_qnty[$result_color[csf('color_number_id')]][$result_color[csf('item_size')]]['qnty']+=$result_color[csf('cons')];


				}

			
			}
			

			//   echo "<br><pre>";
			//   print_r($color_size_wise_data);die;

		}



        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" ><strong>Color & size sensitive (<? echo "Job NO: ".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]] ;echo "&nbsp;&nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" style="font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]];echo "&nbsp;&nbsp;&nbsp;Delivery Date:&nbsp;".change_date_format($po_delivery_date); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black" rowspan="2"><strong>Sl</strong> </td>
                <td style="border:1px solid black" rowspan="2"><strong>Item Group </strong> </td>


                <td style="border:1px solid black" rowspan="2"><strong>Item Description</strong> </td>
                <td style="border:1px solid black" rowspan="2"><strong>Brand/Supplier Ref.</strong> </td>
                <td style="border:1px solid black" rowspan="2"><strong>Article No.</strong> </td>
                 <td style="border:1px solid black" rowspan="2"><strong>Item Color</strong> </td>
               		
                <td align="center" style="border:1px solid black" colspan="<?=count($size_arr);?>"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black" rowspan="2"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
			<tr>
                
				<?php

				foreach($size_arr as $row){?>
				<td style="border:1px solid black;"><strong><?=$row;?></strong> </td>
				<?php
					}
				?>
               
            </tr>
            <?
			$i=0;
			$item_desctiption_total=array();
            $grand_total_as_per_gmts_color=0;
			$s=0;$desc=0;$sup=0;$art=0;$it=0;
            foreach($color_size_wise_data as $item_id=>$item_data)
            {
				foreach($item_data as $color_id=>$result_color)
				{
				$i++;

				
            ?>
            <tr>
				<? if($s==0){?>
                <td style="border:1px solid black" rowspan="<?=count($item_data);?>"><? echo $i ; ?></td>
				<?$s++;}
				if($it==0){?>
                <td align="center" style="border:1px solid black" rowspan="<?=count($item_data);?>"><?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item['pre_cost_fabric_cost_dtls_id']][4]);
				?>
                </td>
                <?
			

                $total_amount_as_per_gmts_color=0;

						?>

					<td style="border:1px solid black" rowspan="<?=count($item_data);?>"><? if($result_color['description']){echo $result_color['description'];} ?> </td>

					<td style="border:1px solid black" rowspan="<?=count($item_data);?>"><? if($result_color['brand_supplier']){echo $result_color['brand_supplier']; }?> </td>

                    <td style="border:1px solid black" rowspan="<?=count($item_data);?>">
					<?
					if($result_color['article_number']!="no article"){
						echo $result_color['article_number'];
					}else{
						echo "-";
					}
					?>
                    </td>
					<?php
					$it++;}
					?>	
				
				
                    <td style="border:1px solid black"><? echo $color_library[$color_id]; ?> </td>
				
					<?
					foreach($size_arr as $row){?>
					<td style="border:1px solid black; text-align:left">
					<? echo $color_size_wise_qnty[$color_id][$row]['qnty'];
						$item_color_sum[$item_id][$color_id]+=$color_size_wise_qnty[$color_id][$row]['qnty']; 
					?>
					</td>
					<?}?>
                    <td style="border:1px solid black; text-align:left">
				   <?
				   $calUom=$trims_qtyPerUnit_arr[$result_color['pre_cost_fabric_cost_dtls_id']][2];
			       $calQty=explode("_",$trims_qtyPerUnit_arr[$result_color['pre_cost_fabric_cost_dtls_id']][1]);
				   if($calUom && end($calQty)){
					   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
				   }
                   ?>
                    </td>

					<td style="border:1px solid black; text-align:right">
					<?

					echo number_format($item_color_sum[$item_id][$color_id],4);

					$item_desctiption_total[$item_id] += $item_color_sum[$item_id][$color_id] ;
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]];  ?></td>
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color['rate'],4);
					?>
                     </td>
					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color['amount'];
					echo number_format($amount_as_per_gmts_color,2);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					$trims_remark=$trims_remark_arr[$result_color['pre_cost_fabric_cost_dtls_id']]['remark'];
					?>
					</td>
                     <? if($show_comment==1) {?>
                    <td style="border:1px solid black;text-align:center"><? echo $trims_remark; ?> </td>
                    <? } ?>
				</tr>
            <?
            
			 }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="<?=count($size_arr)+7;?>"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

				echo number_format($item_desctiption_total[$item_id],4);  ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }

            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="<?=count($size_arr)+10;?>"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
       <?
		
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->



         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]." and sensitivity=0 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];
        ?>
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>NO sensitive  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";  echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]];echo "&nbsp;&nbsp;&nbsp;Delivery Date:&nbsp;".change_date_format($po_delivery_date); ?></td>
                </tr>
                </table>
                 </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
				<td style="border:1px solid black"><strong>Article No.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td align="center" style="border:1px solid black"><strong> Qnty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                 <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                 <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description,b.article_number, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.po_break_down_id=".$result_item[csf('po_id')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description,b.article_number, b.brand_supplier,b.item_color");

            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">

                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);

				?>
                </td>
                <?
                $color_tatal=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
                $item_desctiption_total=0;
                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
				 <td style="border:1px solid black"><?
				  if($result_itemdescription[csf('article_number')]!="no article"){
						echo $result_itemdescription[csf('article_number')];
					}else{
						echo "-";
					}
				  ?>
				   </td>

                <td style="border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <?
				if($db_type==0)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.po_break_down_id=". $result_item[csf('po_id')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
						}
						if($db_type==2)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]."  and a.po_break_down_id=". $result_item[csf('po_id')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
						}

                foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right">
                <?
				//print_r($uom_arr);
				$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];
				//echo $order_uom_id.'DD';
                if($result_color_size_qnty[csf('cons')]!= "")
                {

               echo number_format($result_color_size_qnty[csf('cons')],4);
                $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                $color_tatal+=$result_color_size_qnty[csf('cons')];
                }
                else echo "";
                ?>
                </td>
                <?
                }
                ?>

                <td style="border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                 <td style="border:1px solid black; text-align:right"><? echo $trims_remark; ?> </td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;">
                <?
                if($color_tatal !='')
                {

						 echo number_format($color_tatal,4);
                }
                ?>
                </td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <?
		}
		}
		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->

       <?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>
       <br/>
       <table width="100%" style="margin-top:1px">
       <tr>
       <td>
       <table width="100%" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                <td width="70%" style="border:1px solid black; text-align:left"><strong><? echo number_format($booking_grand_total,2);?></strong></td>
            </tr>
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                <td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
            </tr>
       </table>
       </td>
       </tr>
       </table>
         <br/>
        <table width="100%">
        <tr>
        <td width="49%">
        <?
        	echo get_spacial_instruction($txt_booking_no);
        ?>
    	</td>
    <td width="2%"></td>
    <?
	 $data_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");

	?>
    <td width="49%" valign="top">
        <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">

            <tr style="border:1px solid black;">
                <td colspan="3" style="border:1px solid black;">Approval Status</td>
                </tr>
                <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;">Sl</td><td width="50%" style="border:1px solid black;">Name</td><td width="27%" style="border:1px solid black;">Approval Date</td><td width="20%" style="border:1px solid black;">Approval No</td>
                </tr>


            <?
			$i;
			foreach($data_array as $row){
			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td><td width="50%" style="border:1px solid black;"><? echo $row[csf('user_full_name')];?></td><td width="27%" style="border:1px solid black;"><? echo change_date_format($row[csf('approved_date')],"dd-mm-yyyy","-");?></td><td width="20%" style="border:1px solid black;"><? echo $row[csf('approved_no')];?></td>
                </tr>
                <?
				$i++;
			}
				?>

        </table>
    </td>
    </tr>
    </table>

   	 </tbody>
     </table>

    </div> <!--class="footer_signature"-->
    <div  style="margin-top:-5px;">
         <?
          echo signature_table(132, $cbo_company_name, "1330px",1);
		 ?>
      	</div>
        <br>
      <div id="page_break_div">
   	 </div>
     <br>
    <div>

		<?
        	//echo signature_table(2, $cbo_company_name, "1330px");
			echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>

	<?
    if($link == 1){
        ?>
        <script type="text/javascript" src="../../../js/jquery.js"></script>
        <script type="text/javascript" src="../../../js/jquerybarcode.js"></script>
    <?
    }else {
        ?>
         <script type="text/javascript" src="../../js/jquery.js"></script>
        <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
        <?
    }
        ?>
    <script>
    fnc_generate_Barcode('<? echo $varcode_booking_no; ?>','barcode_img_id');

    </script>
  </html>
	<?
	
	$html = ob_get_contents();
	ob_clean();
	list($is_mail_send,$mail)=explode('___',$mail_send_data);
	if($is_mail_send==1){
		require_once('../../../mailer/class.phpmailer.php');
		require_once('../../../auto_mail/setting/mail_setting.php');
		$mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
			
		$mailToArr=array();
		$mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
		//echo $mailSql;die;
		$mailSqlRes=sql_select($mailSql);
		foreach($mailSqlRes as $rows){
			if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		}
		
		
		$mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=98 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
		//echo $mailSql;die;
		$mailSqlRes=sql_select($mailSql);
		foreach($mailSqlRes as $rows){
			if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		}
		
		if($mail!=''){$mailToArr[]=$mail;}
		$to=implode(',',$mailToArr);
		$subject="  Trims Booking Multi Job ";
		$header=mailHeader();
		echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
		
	}
	else{
		echo "$html****$filename****$report_cat";
	}
	exit();
}
if($action=="show_trim_booking_report5") // Aziz-13-01-2019
{//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");
	$lib_user=return_library_array("select id,user_full_name from user_passwd","id","user_full_name");

	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;
	//$revised_no_data=sql_select("select a.revised_no  from wo_booking_mst a where  a.booking_no=$txt_booking_no and  a.status_active =1 and a.is_deleted=0");
	//list($revised_no_row)=$revised_no_data;
		$booking_grand_total=0; $currency_id="";

		$buyer_string=array(); $style_owner=array(); $job_no=array(); $style_ref=array(); $all_dealing_marcent=array(); $season=array(); $order_repeat_no=array(); $po_id_arr=array();

		$nameArray_buyer=sql_select( "select  a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, b.po_break_down_id from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
        foreach ($nameArray_buyer as $result_buy){
			$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
			$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
			//$season[$result_buy[csf('job_no')]]=$season_arr[$result_buy[csf('season_matrix')]];
			$season_matrix=$result_buy[csf('season_matrix')];
			$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
			if($season_matrix!=0 && $season_buyer_wise==0 )
			{
				$season_matrix_con=$season_matrix;
			}
			else if($season_buyer_wise!=0 && $season_matrix==0)
			{
				$season_matrix_con=$season_buyer_wise;
			}
			$seasons_name.=$season_arr[$season_matrix_con].',';
			$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
			$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

			$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];
		}
		$style_sting=implode(",",array_unique($style_ref));
		$job_no_str = "'" . implode( "','", $job_no ) . "'";
		$job_no=implode(",",$job_no);
		$seasons_names=rtrim($seasons_name,',');

		$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));
		$poid_arr=array_unique($po_id_arr);

		$order_rept_no=rtrim($order_rept_no,',');
		$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));
		$main_fabric_approved = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and a.job_no in (".$job_no_str.") and b.entry_form=7 and a.status_active =1 and a.is_deleted=0 order by b.id asc");


		$po_no=array(); $file_no=array(); $ref_no=array(); $po_quantity=array();
		$pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';
		$nameArray_job=sql_select( "select b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, sum(b.po_quantity) as po_quantity  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no ");
        foreach ($nameArray_job as $result_job){
			$po_no[$result_job[csf('job_no_mst')]][$result_job[csf('id')]]=$result_job[csf('po_number')];
			$file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
			$ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
			$po_quantity[$result_job[csf('id')]]=$result_job[csf('po_quantity')];
		//	$tot_po_quantity+=$result_job[csf('po_quantity')];
			$job_ref_no[$result_job[csf('job_no_mst')]].=$result_job[csf('grouping')].',';
			$job_file_no[$result_job[csf('job_no_mst')]].=$result_job[csf('file_no')].',';
			$po_no_arr[$result_job[csf('job_no_mst')]]['po_id'].=$result_job[csf('id')].',';
			$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
			$int_ref_no.=$result_job[csf('grouping')].',';
			if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];

		}
			//echo $po_idss.'DDDDDDDDD';
		$sql_job=sql_select( "select b.job_no_mst,b.id as po_id, b.po_quantity as po_quantity  from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.") ");
		foreach ($sql_job as $row)
		{
			$job_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('po_id')]]+=$row[csf('po_quantity')];
			$tot_po_quantity+=$row[csf('po_quantity')];
		}

        $nameArray=sql_select( "select a.booking_no, a.is_approved,a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_address, a.delivery_date, a.source, a.remarks, a.revised_no,a.inserted_by,a.insert_date from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
		foreach( $nameArray as $row)
		{
			$varcode_booking_no=$row[csf('booking_no')];
			$booking_date=$row[csf('booking_date')];
			$delivery_date=$row[csf('delivery_date')];
			$pay_mode_id=$row[csf('pay_mode')];
			$supplier_id=$row[csf('supplier_id')];
			$currency_id=$row[csf('currency_id')];
			$buyer_id=$row[csf('buyer_id')];
			$exchange_rate=$row[csf('exchange_rate')];
			$attention=$row[csf('attention')];
			$remarks=$row[csf('remarks')];
			$delivery_address=$row[csf('delivery_address')];
			$revised_no=$row[csf('revised_no')];
			$source_id=$row[csf('source')];
			$is_approved=$row[csf('is_approved')];
		}
		$approved_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name, b.id from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0 order by b.id asc");

	 $sql_date_update=sql_select("SELECT a.updated_by, a.booking_no,a.update_date
				  FROM wo_booking_dtls a, wo_booking_dtls b
				 WHERE a.booking_no = b.booking_no AND a.update_date >= b.update_date
				 and a.booking_no='$txt_booking_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.update_date desc");
	 $sql_date_insert=sql_select("SELECT a.inserted_by, a.booking_no,a.insert_date
						  FROM wo_booking_dtls a, wo_booking_dtls b
						 WHERE a.booking_no = b.booking_no AND a.insert_date <= b.insert_date
						 and a.booking_no='$txt_booking_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.insert_date");

	ob_start();
	?>
	<table width="100%"  cellpadding="0" cellspacing="0" style="border:0px solid black">
       		<tr>
                <td width="20px">
                    <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
                    <tr>
                    <td width="50" >
                       <? if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                                <img  src='../../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />

                       <?
                           }
                           else
                           {
                       ?>
                                <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
                       <?	}
                       }
                       else
                       { ?>
                         <img  src='../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
                      <? }
                       ?>
                   </td>
                    <td width="40px" align="center">
                    &nbsp;  &nbsp;  &nbsp;
                    </td>
                    <td width="30px"   align="center">

                   <b style="font-size:25px;"> <?
                    echo $company_library[$cbo_company_name]; ?>
                    </b>
                    <br>
                    <label>
                        <?
                            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                            foreach ($nameArray as $result){
                            ?>
                              <?  if($result[csf('plot_no')]!='') echo $result[csf('plot_no')]; else echo '';?> &nbsp;
                                <? echo $result[csf('level_no')];?> &nbsp;
                                 <? echo $result[csf('road_no')]; ?>  &nbsp;
                                <? echo $result[csf('block_no')];?>  &nbsp;
                                <? echo $result[csf('city')];?>  &nbsp;
                                <? echo $result[csf('zip_code')]; ?>  &nbsp;
                                 <?php echo $result[csf('province')]; ?>  &nbsp;
                                <? echo $country_arr[$result[csf('country_id')]]; ?> &nbsp;<br/>
                                <? echo $result[csf('email')];?>  &nbsp;
                                <? echo $result[csf('website')];
                                if($result[csf('plot_no')]!='')
                                {
                                    $plot_no=$result[csf('plot_no')];
                                }
                                if($result[csf('level_no')]!='')
                                {
                                    $level_no=$result[csf('level_no')];
                                }
                                if($result[csf('road_no')]!='')
                                {
                                    $road_no=$result[csf('road_no')];
                                }
                                if($result[csf('block_no')]!='')
                                {
                                    $block_no=$result[csf('block_no')];
                                }
                                if($result[csf('city')]!='')
                                {
                                    $city=$result[csf('city')];
                                }
                                $company_address[$result[csf('id')]]=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
                            }
                        ?>
                        </label>
                        <br/>
                        <b style="font-size:20px;">
                         <?php echo $report_title; ?>
                        </b>
                    </td>
                     <td width="10px" align="center" style="font-size:20px;">
                      <table width="80%" align="right" cellpadding="0" cellspacing="0" style="border:0px solid black">
                        <tr>
                            <td width="80">  Booking No:&nbsp; <?php echo $varcode_booking_no; ?>  </td>
                        </tr>
                        <tr>
                            <td>  Booking Date:&nbsp; <?php echo change_date_format($booking_date); ?>  </td>
                        </tr>
                        <?
                        if($revised_no>0)
                        {
                        ?>
                        <tr>
                            <td>  Revised No:&nbsp; <?php echo $revised_no; ?>  </td>
                        </tr>
                        <?
                        }
                        //if(str_replace("'","",$id_approved_id) ==1)
                        // {
                         ?>
                          
                         <?
                       // }
                         ?>
                      </table>
                     </td>
                   </tr>
                   </table>
                </td>
        	</tr>
            <tr>
            <td>

            	<table width="1320"  style="border:0px solid black;table-layout: fixed;">
                <tr>
                    <td colspan="6" valign="top"> </td>
                </tr>
                <tr>
                    <td width="100" style="font-size:18px" align="left"><span><b>To,</b></span>  </td>
                    <td width="110" colspan="5" style="font-size:18px">&nbsp;<span></span></td>
                </tr>
            	<tr>
                    <td width="210" colspan="2" align="left" style="font-size:18px">&nbsp; <b>
                    <?
                    if($pay_mode_id==5 || $pay_mode_id==3){
                        echo $company_library[$supplier_id];
                    }
                    else{
                        echo $supplier_name_arr[$supplier_id];
                    }
                    ?>
                    &nbsp;
                    </b>
                    </td>
                    <td  width="100" style="font-size:16px"><b>Buyer</b></td>
                    <td  width="110" align="left">:&nbsp;<? echo $buyer_name_arr[$buyer_id]; ?></td>
                    <td width="100" style="font-size:16px"><b>Delivery Date</b></td>
                    <td width="110" align="left">:&nbsp;<?  echo change_date_format($delivery_date); ?></td>
           	   </tr>
              <tr>
                <td width="100" colspan="2" rowspan="2" align="left" style="font-size:18px">Address :&nbsp;
                <b>
                <?
                if($pay_mode_id==5 || $pay_mode_id==3){
                    $address=$company_address[$supplier_id];
                }
                else{
                    $address=$supplier_address_arr[$supplier_id];
                }
                echo $address;
                ?></b>
                </td>
                <td width="100" style="font-size:16px"><b>PO Qty.</b> </td>
                <td width="110" align="left">:&nbsp;<? echo $tot_po_quantity; ?></td>
                <td style="font-size:14px" ><b>Delivery To </b> </td>
                <td style="" align="left">:&nbsp;<?  echo $delivery_address;?>
               
                </td>
             </tr>
            <tr>
                <td width="100" style="font-size:16px"><b>Season</b> </td>
                <td width="110" align="left">:&nbsp;<? echo $seasons_names; ?></td>
                <td width="100" style="font-size:16px"><b>Currency</b></td>
                <td width="110" align="left">:&nbsp;<?  echo $currency[$currency_id]; ?></td>
            </tr>
            <tr>
                <td width="100" style="font-size:16px" align="left"><b>Attention </b>   </td>
                <td align="left" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
                <?
                    echo $attention;

                ?>
                </td>
                <td width="100" style="font-size:16px"><b>Order Repeat </b> </td>
                <td width="110" align="left">:&nbsp;<? echo $order_rept_no; ?></td>
                <td  style="font-size:16px"><b>Pay mode</b></td>
                <td align="left">:&nbsp;<? echo $pay_mode[$pay_mode_id];?></td>
            </tr>
             <tr>
                <td width="100" style="font-size:16px" align="left"><b>Source</b></td>
                <td align="left" >:&nbsp;<? echo $source[$source_id];?></td>
                <td style="font-size:16px"><b>Dealing Merchant</b></td>
                <td align="left" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
                <?
                    echo implode(",",array_unique($all_dealing_marcent));
                ?>
                </td>
                <td width="100" style="font-size:16px" align="left"><b>Insert By</b></td>
                <td title="<?=$sql_date_insert[0][csf('insert_date')];?>">:&nbsp;<?=$lib_user[$sql_date_insert[0][csf('inserted_by')]]?></td>
            </tr>
            <tr>
                <td width="100" style="font-size:16px" align="left"><b>Remarks</b>  </td>
                <td align="left" width="110" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" >:&nbsp;<? echo $remarks; ?></td>
                <td width="130" style="font-size:14px" align="left">&nbsp;</td>
                <td align="left">&nbsp;</td>
                <td width="100" style="font-size:16px" align="left"><b>Last Update By</b></td>
                <td title="<?=$sql_date_update[0][csf('update_date')];?>">:&nbsp;<?=$lib_user[$sql_date_update[0][csf('updated_by')]]?> </td>
            </tr>
            </table>
            </td>
            </tr>
          	</table>


          <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?

		$precost_arr=array();
		$trims_qtyPerUnit_arr=array();

		$precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0");
        $calUom="";
		foreach($precost_sql as $precost_row){
			if($precost_row[csf('cal_parameter')]==1){
			   $calUom="Mtr";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==2){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==3){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==4){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==5){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==6){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==7){
			   $calUom="Pcs";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==8){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else{
				$calUom=0;
			}
			 $trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
		}
		$booking_country_arr=array();
		$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,sensitivity,country_id_string from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0");
		foreach($nameArray_booking_country as $nameArray_booking_country_row){
			$country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
			$tocu=count($country_id_string);
			for($cu=0;$cu<$tocu;$cu++){
				$booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
			}
		}

		$nameArray_job_po=sql_select( "select job_no from wo_booking_dtls  where booking_no='$txt_booking_no' and status_active =1 and is_deleted=0 group by job_no order by job_no ");
		foreach($nameArray_job_po as $nameArray_job_po_row){
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,description from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$nameArray_job_po_row[csf('job_no')]."'   and sensitivity=1 group by pre_cost_fabric_cost_dtls_id,trim_group,description  order by trim_group ");
	    if(count($nameArray_item)>0){
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];//$po_quantity[$poid];
			}
			$shipdate=rtrim($po_shipdate_arr[$nameArray_job_po_row[csf('job_no')]],',');
			$shipdates=implode(",",array_unique(explode(",",$shipdate)));
        ?>
        &nbsp;
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
        	<thead>
            <tr>
                <td colspan="12" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" align="left"><strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; if($ref_nos!='' ) echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;else " ";if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;  Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>

                </tr>
                </table>
                </td>
            </tr>
            
            <tr>
                <td style="border:1px solid black"  width="20"> <strong>Sl</strong> </td>
                <td style="border:1px solid black" ><strong>Item Group</strong> </td>
				<td style="border:1px solid black" width="120"><strong>Item Image</strong> </td>
                <td style="border:1px solid black"><strong>Item Desc.</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supp. Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="right"  width="80"><strong>WO Qty</strong></td>
                <td style="border:1px solid black" align="center"  width="50"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black" align="right"  width="50"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="right"  width="80"><strong>Amount</strong></td> 
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? }?>
            </tr>
            </thead>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=$grand_total_as_per_gmts_color_qty=0;
            foreach($nameArray_item as $result_item){
			$i++;
            $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_color,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center"  style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				?>
                </td>
				<td align="left"  style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				$item_imge_arr=sql_select("select master_tble_id,image_location from   common_photo_library where form_name='pre_cost_trimsv2' and file_type=1 and master_tble_id='".$result_item[csf('pre_cost_fabric_cost_dtls_id')]."' ");
				?>
				 <p>
			<?	foreach($item_imge_arr as $row)
			   {
				 if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                               <img  src='../../../<? echo $row[csf('image_location')]; ?>' height='35px' width='110px' />  &nbsp;

                       <?
                           }
                           else
                           {
                       ?>
                               <img  src='../../<? echo $row[csf('image_location')]; ?>' height='35px' width='110px' />&nbsp;
                       <?	}
                       }
                       else
                       { ?>
                           <img  src='../<? echo $row[csf('image_location')]; ?>' height='35px' width='110px' />&nbsp;
                      <? }

				  }
                       ?>
					   </p>
                </td>
				<td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>"><? echo $result_item[csf('description')]; ?> </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=$total_qty_as_per_gmts_color=0;$x=1;
                foreach($nameArray_item_description as $result_itemdescription){
                ?>
                
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?


				// echo number_format($result_itemdescription[csf('cons')],4);
				// $item_desctiption_total += $result_itemdescription[csf('cons')] ;

				echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$item_wise_summery[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_itemdescription[csf('cons')];
				$item_wise_valueArr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_itemdescription[csf('amt_cons')];
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; 
				$total_qty_as_per_gmts_color+=$result_itemdescription[csf('cons')];
				?></td>
                <? if($show_comment==1) {?>
				<td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                  <? 
				   if($x==1) {
				  ?>
                 <td style="border:1px solid black; text-align: center" rowspan="<? echo count($nameArray_item_description); ?>"><p><? echo $trims_remark; ?> </p></td>
                 <? }  }?>
            </tr>
            <?
			$x++;
            }
            ?>
            <tr>
				
                <td style="border:1px solid black;  text-align:right" colspan="3"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

					echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
				$grand_total_as_per_gmts_color_qty+=$total_qty_as_per_gmts_color;
                ?>
                </td>
                  <? //if($show_comment==1) {?>
                <!--<td rowspan="<? //echo count($nameArray_item_description)+1; ?>">&nbsp;  </td>-->
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="7"><strong>Total</strong></td>
                 <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color_qty,2); ?></td>
				 <? if($show_comment==1) {?>
                <td  style="border:1px solid black;  text-align:right"><? // echo number_format($grand_total_as_per_gmts_color_qty,2); ?></td>
                 <td align="right" style="border:1px solid black" ><strong></strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 
                <td rowspan="<? //echo count($nameArray_item_description)+1; ?>">&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->


        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,description from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=2 and  status_active =1 and  is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,description  order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
        	<thead>
            <tr>
                <td colspan="14" align="">
                 <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Size Sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; echo "&nbsp;&nbsp;Int Ref.:".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";echo "&nbsp;&nbsp; Po Qty..:".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;margin-left:210px; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black" width="20"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group </strong> </td>
				<td style="border:1px solid black"  width="120"><strong>Item Image</strong> </td>
                <td style="border:1px solid black"><strong>Item Desc</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supp. Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Article No</strong></td>
				<td align="center" style="border:1px solid black"><strong>Gmt Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Item Size/EAN Code</strong></td>
                <td align="center" style="border:1px solid black"  width="50"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center" width="80"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center" width="50"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center" width="50"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center" width="80"><strong>Amount</strong></td>
                 
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            </thead>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=$grand_total_as_per_gmts_color_qty=0;
            foreach($nameArray_item as $result_item)
            {
			$i++;
			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,b.gmts_sizes,b.article_number,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size,b.article_number,b.gmts_sizes order by bid");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][2]);
				?>
                </td>
				 <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				$item_imge_arr=sql_select("select master_tble_id,image_location from   common_photo_library where form_name='pre_cost_trimsv2' and file_type=1 and master_tble_id='".$result_item[csf('pre_cost_fabric_cost_dtls_id')]."' ");
				?>
				 <p>
			<?	foreach($item_imge_arr as $row)
			   {
				 if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                               <img  src='../../../<? echo $row[csf('image_location')]; ?>' height='35px' width='110px' />  &nbsp;

                       <?
                           }
                           else
                           {
                       ?>
                               <img  src='../../<? echo $row[csf('image_location')]; ?>' height='35px' width='110px' />&nbsp;
                       <?	}
                       }
                       else
                       { ?>
                           <img  src='../<? echo $row[csf('image_location')]; ?>' height='35px' width='110px' />&nbsp;
                      <? }

				  }
                       ?>
					   </p>
                </td>
				<td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>"><? echo $result_item[csf('description')]; ?> </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=$total_qty_as_per_gmts_color=0;$k=1;
                foreach($nameArray_item_description as $result_itemdescription)
                {
                ?>
                
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black">
				<?
				if($result_itemdescription[csf('article_number')]!="no article"){
					echo $result_itemdescription[csf('article_number')];
				}else{
					echo "-";
				}
				?>
                </td>
                <td style="border:1px solid black; text-align:left">
              <? 	echo $size_library[$result_itemdescription[csf('gmts_sizes')]];?>
                </td>
				 <td style="border:1px solid black; text-align:left">
             		 <? echo $result_itemdescription[csf('item_size')];?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?
				// echo number_format($result_itemdescription[csf('cons')],4);
                // $item_desctiption_total += $result_itemdescription[csf('cons')] ;

				echo number_format($result_itemdescription[csf('cons')],4);

                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$item_wise_summery[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_itemdescription[csf('cons')];
				$item_wise_valueArr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				 $total_qty_as_per_gmts_color+=$result_itemdescription[csf('cons')];
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                 <? 
				  if($k==1)
				  {
				 ?>
                <td style="border:1px solid black; text-align:center" rowspan="<? echo count($nameArray_item_description); ?>"><p><? echo $trims_remark; ?> </p></td>
                <?
				  }
				} ?>
            </tr>
            <?
				$k++;
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="6"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold"><?

					echo number_format($item_desctiption_total,4);
				 ?></td>
                 <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				 <?  if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
				$grand_total_as_per_gmts_color_qty+=$total_qty_as_per_gmts_color;
                ?>
                </td>

                 
                <td >&nbsp; </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="9"><strong>Total</strong></td>
				  <td align="right"><?  echo number_format($grand_total_as_per_gmts_color_qty,2);?> </td>
				  <? if($show_comment==1) {?>
                   <td align="right"><?  //echo number_format($grand_total_as_per_gmts_color_qty,2);?> </td>
                    <td align="right"><?  //echo number_format($grand_total_as_per_gmts_color_qty,2);?> </td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                 
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group,description from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=3 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,description order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>
        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
        	<thead>
            <tr>
                <td colspan="13" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black" width="20"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
				 <td style="border:1px solid black"  width="120"><strong>Item Image</strong> </td>
                <td style="border:1px solid black"><strong>Item Desc.</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supp. Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td align="center" style="border:1px solid black"  width="50"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"  width="80"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"  width="50"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"  width="50"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"  width="80"><strong>Amount</strong></td>
                 
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            </thead>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=$grand_total_as_per_gmts_color_qty=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by trim_group ", "item_color", "color_number_id"  );

			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,b.color_number_id order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
				?>
                </td>
				 <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
               <?
				$item_imge_arr=sql_select("select master_tble_id,image_location from   common_photo_library where form_name='pre_cost_trimsv2' and file_type=1 and master_tble_id='".$result_item[csf('pre_cost_fabric_cost_dtls_id')]."' ");
				?>
				 <p>
			<?	foreach($item_imge_arr as $row)
			   {
				 if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                               <img  src='../../../<? echo $row[csf('image_location')]; ?>' height='35px' width='110px' />  &nbsp;

                       <?
                           }
                           else
                           {
                       ?>
                               <img  src='../../<? echo $row[csf('image_location')]; ?>' height='35px' width='110px' />&nbsp;
                       <?	}
                       }
                       else
                       { ?>
                           <img  src='../<? echo $row[csf('image_location')]; ?>' height='35px' width='110px' />&nbsp;
                      <? }

				  }
                       ?>
					   </p>
                </td>
				<td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>"><? echo $result_item[csf('description')]; ?> </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=$total_as_per_gmts_color_qty=0;$m=1;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
               
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   echo $color_library[$result_itemdescription[csf('color_number_id')]];
			   ?>
                </td>
               <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>

                <td style="border:1px solid black; text-align:right">
				<?

				// echo number_format($result_itemdescription[csf('cons')],4);
                // $item_desctiption_total += $result_itemdescription[csf('cons')] ;

				echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')];
				$item_wise_summery[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_itemdescription[csf('cons')];
				$item_wise_valueArr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				?>
                </td>
                <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$total_as_per_gmts_color_qty+= $result_itemdescription[csf('cons')];
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                 <? 
				 if($m==1)
				 {
				 ?>
                <td style="border:1px solid black; text-align:center" rowspan="<? echo count($nameArray_item_description); ?>"><p><? echo $trims_remark; ?></p> </td>
                <?
				}
				} ?>
            </tr>
            <?
			$m++;
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

				echo number_format($item_desctiption_total,4);
				 ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $uom_text; ?></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
				  $grand_total_as_per_gmts_color_qty+=$total_as_per_gmts_color_qty;
                ?>
                </td>
                 
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
				  <td align="right"><?  echo number_format($grand_total_as_per_gmts_color_qty,2);?>  </td>
				  <? if($show_comment==1) {?>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,description from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,description order by trim_group");
	   if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));

			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >

            <thead>
            <tr>
                <td colspan="15" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" ><strong>Color & size sensitive (<? echo "Job NO: ".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]] ;echo "&nbsp;&nbsp;Int Ref.:&nbsp;".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"  width="20"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group </strong> </td>
				<td style="border:1px solid black"  width="120"><strong>Item Image </strong> </td>
                <td style="border:1px solid black"><strong>Item Desc.</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supp. Ref.</strong> </td>
                <td style="border:1px solid black"><strong>Article No.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td style="border:1px solid black; width:170px;"><strong>Gmts Color</strong> </td>
                <td style="border:1px solid black;"><strong>Gmts Size</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Size/EAN Code</strong></td>
                <td align="center" style="border:1px solid black"  width="50"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"  width="80"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"  width="50"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"  width="50"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"  width="50"><strong>Amount</strong></td>
                
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            </thead>
            <?
			$color_size_array=array();
			$i=0;
			$item_total_as_per_gmts_color=$item_total_as_per_gmts_color_qty=0;
            $grand_total_as_per_gmts_color=$grand_total_as_per_gmts_color_qty=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by trim_group ", "item_color", "color_number_id"  );

			 $nameArray_color=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.color_number_id as gmt_color, b.item_color as color_number_id,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount, min(c.color_order) as color_order, min(c.size_order) as size_order,c.article_number from wo_booking_dtls a, wo_trim_book_con_dtls b,wo_po_color_size_breakdown c  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and b.po_break_down_id=c.po_break_down_id and b.color_number_id=c.color_number_id and b.gmts_sizes=c.size_number_id and  c.id=b.color_size_table_id and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=4 and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.color_number_id, b.item_color,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,c.article_number order by c.article_number,color_order,size_order");



            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]." and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  status_active =1 and is_deleted=0 order by trim_group ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][4]);
				?>
                </td>
				  <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
				 <?
				$item_imge_arr=sql_select("select master_tble_id,image_location from   common_photo_library where form_name='pre_cost_trimsv2' and file_type=1 and master_tble_id='".$result_item[csf('pre_cost_fabric_cost_dtls_id')]."' ");
				?>
				 <p>
			<?	foreach($item_imge_arr as $row)
			   {
				 if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                               <img  src='../../../<? echo $row[csf('image_location')]; ?>' height='35px' width='110px' />  &nbsp;

                       <?
                           }
                           else
                           {
                       ?>
                               <img  src='../../<? echo $row[csf('image_location')]; ?>' height='35px' width='110px' />&nbsp;
                       <?	}
                       }
                       else
                       { ?>
                           <img  src='../<? echo $row[csf('image_location')]; ?>' height='35px' width='110px' />&nbsp;
                      <? }

				  }
                       ?>
					   </p>
					   </td>
					   
					   <td style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>"><? echo $result_item[csf('description')];  ?> 
					
					</td>
					

                <?
				$item_desctiption_total=0;$n=1;$k=1;
                $total_amount_as_per_gmts_color=$total_qty_as_per_gmts_color=0;
				$color_arr_check=array();
				foreach($nameArray_color as $result_color)
                {
					
					
					?>
					<td style="border:1px solid black" ><? if($result_color[csf('brand_supplier')]){echo $result_color[csf('brand_supplier')]; }?> </td>
                    <td style="border:1px solid black">
					<?
					if($result_color[csf('article_number')]!="no article"){
						echo $result_color[csf('article_number')];
					}else{
						echo "-";
					}
					?>
                    </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('gmt_color')]];?> </td>
                    <td style="border:1px solid black; text-align:left">
					<? echo $size_library[$result_color[csf('gmts_sizes')]]; ?>
					</td>
					<td style="border:1px solid black; text-align:left">
					<? echo $result_color[csf('item_size')]; ?>
					</td>
                    <td style="border:1px solid black; text-align:left">
				   <?
				   $calUom=$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][2];
			       $calQty=explode("_",$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				   if($calUom && end($calQty)){
					   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
				   }
                   ?>
                    </td>

					<td style="border:1px solid black; text-align:right">
					<?

					echo number_format($result_color[csf('cons')],4);
					$item_desctiption_total += $result_color[csf('cons')] ;
					$item_wise_summery[$result_item[csf('trim_group')]][$result_color[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_color[csf('cons')];
					$item_wise_valueArr[$result_item[csf('trim_group')]][$result_color[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_color[csf('amount')];

					//$item_desctiption_total += $result_color[csf('cons')] ;
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]];
					$total_qty_as_per_gmts_color+=$result_color[csf('cons')];
					?></td>
					<? if($show_comment==1) {?>
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('rate')],4);
					?>
                     </td>
					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,4);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					
					$trims_remark=$trims_remark_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
					?>
					</td>
                     <? 
					 if($n==1) {
					 ?>
                    <td style="border:1px solid black;text-align:center" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>"><? echo $trims_remark; ?> </td>
                    <?
					 }
					} ?>
				</tr>
            <?
			$n++;
            }
            ?>
			
            <tr>
			    
                <!-- <td style="border:1px solid black;  text-align:right" colspan="10"><strong> Item Total</strong></td> -->
				<td style="border:1px solid black" align="right" colspan="<? echo count($nameArray_color)+4; ?>"><strong>Item Total</strong></td>
				<td>&nbsp;  </td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

				echo number_format($item_desctiption_total,4);  ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				<?
				$grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
				$grand_total_as_per_gmts_color_qty+=$total_qty_as_per_gmts_color;
				?>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>
				
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                
                ?>
                </td>
                 
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
//grand_total_as_per_gmts_color_qty
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="11"><strong>Total</strong></td>
				<td align="right"><? echo number_format($grand_total_as_per_gmts_color_qty,2);?> </td>
				<? if($show_comment==1) {?>
                <td><? //echo number_format($grand_total_as_per_gmts_color_qty,2);?> </td>
                <td><? //echo number_format($grand_total_as_per_gmts_color_qty,2);?> </td>
				
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
       <?
		}
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->



         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,description from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=0 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,description order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				//echo $poid.', ';
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}

			//$po_quantity[$result_job[csf('id')]];
        ?>
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
        	<thead>
            <tr>
                <td colspan="15" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>NO sensitive  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                 </td>
            </tr>
            <tr>
                <td style="border:1px solid black"  width="20"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
				<td style="border:1px solid black"  width="120"><strong>Item Image</strong> </td>
                <td style="border:1px solid black"><strong>Item Desc.</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supp. Ref.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                 <td align="center" style="border:1px solid black"  width="50"><strong>Qty per Unit</strong></td>
                <td align="center" style="border:1px solid black"  width="80"><strong> Qnty</strong></td>
                <td style="border:1px solid black" align="center"  width="50"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"  width="50"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"  width="80"><strong>Amount</strong></td>
                 
                 <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                 <? } ?>
            </tr>
            </thead>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=$grand_total_as_per_gmts_color_qty=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color");

            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">

                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);

				?>
                </td>
				<td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
 <?
				$item_imge_arr=sql_select("select master_tble_id,image_location from   common_photo_library where form_name='pre_cost_trimsv2' and file_type=1 and master_tble_id='".$result_item[csf('pre_cost_fabric_cost_dtls_id')]."' ");
				?>
				 <p>
			<?	foreach($item_imge_arr as $row)
			   {
				 if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                               <img  src='../../../<? echo $row[csf('image_location')]; ?>' height='35px' width='110px' />  &nbsp;

                       <?
                           }
                           else
                           {
                       ?>
                               <img  src='../../<? echo $row[csf('image_location')]; ?>' height='35px' width='110px' />&nbsp;
                       <?	}
                       }
                       else
                       { ?>
                           <img  src='../<? echo $row[csf('image_location')]; ?>' height='35px' width='110px' />&nbsp;
                      <? }

				  }
                       ?>
					   </p>
                </td>
				<td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>"><? echo $result_item[csf('description')]; ?> </td>
                <?
                $color_tatal=0;$p=1;
                $total_amount_as_per_gmts_color=$total_qty_as_per_gmts_color=0;$j=1;
                foreach($nameArray_item_description as $result_itemdescription)
                {
                $item_desctiption_total=0;
                ?>
                
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <?
				if($db_type==0)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.cons) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
						}
						if($db_type==2)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.cons) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
						}

                foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right">
                <?
				//$uom_arr=array(1,52,50,51,53,54,55,56,57,31,59,62,65,66,67,74,78,80);
				//print_r($uom_arr);
				$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];
				//echo $order_uom_id.'DD';
                if($result_color_size_qnty[csf('cons')]!= "")
                {


               echo number_format($result_color_size_qnty[csf('cons')],4);
                $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                $color_tatal+=$result_color_size_qnty[csf('cons')];
				$item_wise_summery[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$result_color_size_qnty[csf('cons')];
                }
                else echo "";
                ?>
                </td>
                <?
                }
                ?>

                <td style="border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$item_wise_valueArr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]+=$amount_as_per_gmts_color;
				 $total_qty_as_per_gmts_color+=$item_desctiption_total;
                ?>
                </td>
                 <? 
				 	if($p==1)
				  	{
				 ?>
                 <td style="border:1px solid black; text-align:center" rowspan="<? echo count($nameArray_item_description); ?>"><? echo $trims_remark; ?> </td>
                 <?
				 	}
				 	} ?>
            </tr>
            <?
				$p++;
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="3"><strong> Item Total</strong></td>

                <td style="border:1px solid black;  text-align:right; font-weight:bold;">
                <?
                if($color_tatal !='')
                {

						 echo number_format($color_tatal,4);
                }
                ?>
                </td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
				$grand_total_as_per_gmts_color_qty+=$total_qty_as_per_gmts_color;
                ?>
                </td>
                 
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="7"><strong>Total</strong></td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color_qty,2); ?></td>
				<? if($show_comment==1) {?>
                <td align="right" style="border:1px solid black"><strong></strong></td>
				<td>&nbsp;  </td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <?
		}
		}
		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->

		<!--==============================================Summary====================================================  -->
		<table border="1" align="left" class="rpt_table" cellpadding="0" width="1080px" cellspacing="0" rules="all" >
				<tr>
					<th colspan="6"><strong>Summary</strong> </th>					
				</tr>
				<tr>
					<th width="30" style="border:1px solid black"><strong>Sl</strong> </th>
					<th width="300" style="border:1px solid black"><strong>Item Group </strong> </th>
                    <th width="350" style="border:1px solid black"><strong>Description</strong> </th>
					<th width="100" align="center" style="border:1px solid black"><strong>UOM</strong> </th>
					<th width="150" style="border:1px solid black"><strong>WO Qty.</strong> </th>
                    <th style="border:1px solid black"><strong>Total Amount</strong> </th>

				</tr>
				<?php
				$sl=1;$tot_item_wise_value=0;
				foreach($item_wise_summery as $item_id => $desc_data){ 
					foreach($desc_data as $desc => $uom_data){
							foreach($uom_data as $uom => $row){
						$item_wise_value=$item_wise_valueArr[$item_id][$desc][$uom];
						?>
					<tr>
						<td style="border:1px solid black; word-break:break-all"><?=$sl;?> </td>
						<td style="border:1px solid black; word-break:break-all"><?=$trim_group_library[$item_id];?> </td>
                        <td align="center" style="border:1px solid black; word-break:break-all"><?=$desc;?></td>
						<td align="center" style="border:1px solid black"><?=$unit_of_measurement[$uom];?></td>
						<td align="right" style="border:1px solid black"> <?=number_format($row,4);?></td>
                        <td align="right" style="border:1px solid black"> <?=number_format($item_wise_value,4);?></td>
					</tr>
				<?
				$sl++;
				$tot_item_wise_value+=$item_wise_value;
					}
				}
			}?>
            <tr>
                <td align="right" style="border:1px solid black" colspan="5"><b>Total Amount</b></td>
                <td align="right" style="border:1px solid black"><b><?=number_format($tot_item_wise_value,4);?></b></td>
            </tr>
		</table>
		<br/>
       <?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>
       <br/>
       <table width="100%" style="margin-top:1px">
       <tr>
       <td>
       <table width="100%" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left"><b>Total Booking Amount</b></td>
                <td width="70%" style="border:1px solid black; text-align:left"><b><? echo number_format($booking_grand_total,2);?></b></td>
            </tr>
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left"><b>Total Booking Amount (in word)</b></td>
                <td width="70%" style="border:1px solid black;"><b><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></b></td>
            </tr>
       </table>
       </td>
       </tr>
       </table>
         <br/>
        <table width="100%">
        <tr>
        <td width="49%">
        <?
        	echo get_spacial_instruction($txt_booking_no);
        ?>
    	</td>
    <td width="2%"></td>
    <?
	$lib_designation_arr=return_library_array(" select id,custom_designation from lib_designation","id","custom_designation");
	$user_lib_designation_arr=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
	$user_lib_name_arr=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");

	$mst_id=return_field_value("id as mst_id","wo_booking_mst","booking_no='$txt_booking_no'","mst_id");
	//echo $mst_id.'ssD';
	//and b.un_approved_date is null
	 $approve_data_array=sql_select("select b.approved_by,min(b.approved_date) as approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=8  group by  b.approved_by order by b.approved_by asc");
	// echo "select b.approved_by,min(b.approved_date) as approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=8  group by  b.approved_by order by b.approved_by asc";
	 $unapprove_data_array=sql_select("select b.approved_by,b.approved_date,b.un_approved_reason,b.un_approved_date,b.approved_no from   approval_history b where b.mst_id=$mst_id and b.entry_form=8  order by b.approved_date,b.approved_by");

	?>
    <td width="49%" valign="top">
	<?
          if(count($approve_data_array)>0)
			{
 		?>
       <table  width="850" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>
            <tr style="border:1px solid black;">
                <th colspan="5" style="border:1px solid black;">Approval Status</th>
                </tr>
                <tr style="border:1px solid black;">
                <th width="3%" style="border:1px solid black;">Sl</th>
				<th width="40%" style="border:1px solid black;">Name</th>
				<th width="30%" style="border:1px solid black;">Designation</th>
				<th width="27%" style="border:1px solid black;">Approval Date</th>

                </tr>
            </thead>
            <tbody>
            <?
			$i=1;
			foreach($approve_data_array as $row){


			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
				<td width="40%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
				<td width="27%" style="border:1px solid black;text-align:center"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')]));?></td>

                </tr>
                <?
				$i++;
			}
				?>
            </tbody>
        </table>
		<?
		}
		?>
		<br>
		<?
		if(count($unapprove_data_array)>0)
		{
			$sql_unapproved=sql_select("select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=8 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id=$mst_id");
			$unapproved_request_arr=array();
			foreach($sql_unapproved as $rowu)
			{
			$unapproved_request_arr[$rowu[csf('booking_id')]]=$rowu[csf('approval_cause')];
			}
 		?>
       <table  width="850" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>
            <tr style="border:1px solid black;">
                <th colspan="6" style="border:1px solid black;">Approval/Un Approval History</th>
                </tr>
                <tr style="border:1px solid black;">
                <th width="3%" style="border:1px solid black;">Sl</th>
				<th width="30%" style="border:1px solid black;">Name</th>
				<th width="20%" style="border:1px solid black;">Designation</th>
				<th width="5%" style="border:1px solid black;">Approval Status</th>
				<th width="20%" style="border:1px solid black;">Reason For Un Approval</th>
				<th width="22%" style="border:1px solid black;"> Date</th>

                </tr>
            </thead>
            <tbody>
            <?
			$i=1;
			foreach($unapprove_data_array as $row){

			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
				<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
				<td width="5%" style="border:1px solid black; text-align:center"><? echo 'Yes';?></td>
				<td width="20%" style="border:1px solid black;"><? echo '';?></td>
				<td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); else echo "";?></td>
            </tr>
				<?
				$i++;
				$un_approved_date= explode(" ",$row[csf('un_approved_date')]);
				$un_approved_date=$un_approved_date[0];
				if($db_type==0) //Mysql
				{
					if($un_approved_date=="" || $un_approved_date=="0000-00-00") $un_approved_date="";else $un_approved_date=$un_approved_date;
				}
				else
				{
					if($un_approved_date=="") $un_approved_date="";else $un_approved_date=$un_approved_date;
				}

				if($un_approved_date!="")
				{
				?>
			<tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
				<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
				<td width="5%" style="border:1px solid black;text-align:center;"><? echo 'No';?></td>
				<td width="20%" style="border:1px solid black;text-align:center"><? echo $unapproved_request_arr[$mst_id];?></td>
				<td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('un_approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('un_approved_date')])); else echo "";?></td>
              </tr>

                <?
				$i++;
				}

			}
				?>
            </tbody>
        </table>
		<?
		}
		?>
    </td>
    </tr>
    </table>

   	 </tbody>
     </table>

    </div> <!--class="footer_signature"-->
    <div >
         <?
          echo signature_table(132, $cbo_company_name, "1330px",1);

		 ?>
      	</div>
        <br>
      <div id="page_break_div"></div>
     <br>
    <div>

		<?
        	//echo signature_table(2, $cbo_company_name, "1330px");
			echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>

<?
    if($link == 1){
        ?>
        <script type="text/javascript" src="../../../js/jquery.js"></script>
        <script type="text/javascript" src="../../../js/jquerybarcode.js"></script>
    <?
    }else {
        ?>
         <script type="text/javascript" src="../../js/jquery.js"></script>
        <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
        <?
    }
        ?>
    <script>
    fnc_generate_Barcode('<? echo $varcode_booking_no; ?>','barcode_img_id');

    </script>
  </html>
<?
    $html = ob_get_contents();
	ob_clean();
	list($is_mail_send,$mail)=explode('___',$mail_send_data);
	if($is_mail_send==1){
		require_once('../../../mailer/class.phpmailer.php');
		require_once('../../../auto_mail/setting/mail_setting.php');
		$mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
			
		$mailToArr=array();
		$mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
		//echo $mailSql;die;
		$mailSqlRes=sql_select($mailSql);
		foreach($mailSqlRes as $rows){
			if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		}
		
		
		$mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=97 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
		//echo $mailSql;die;
		$mailSqlRes=sql_select($mailSql);
		foreach($mailSqlRes as $rows){
			if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		}
		if($mail!=''){$mailToArr[]=$mail;}
		
		$to=implode(',',$mailToArr);
		$subject="Trims Booking Multy Job";
		$header=mailHeader();
		echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
		
	}
	else{
		echo $html;
	}
	exit();




}

if($action=="show_trim_booking_report6")
{

	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');

	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");

	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;
	//$revised_no_data=sql_select("select a.revised_no  from wo_booking_mst a where  a.booking_no=$txt_booking_no and  a.status_active =1 and a.is_deleted=0");
	//list($revised_no_row)=$revised_no_data;
		$booking_grand_total=0;
		$currency_id="";


		$buyer_string=array();
		$style_owner=array();
		$job_no=array();
		$style_ref=array();
		$all_dealing_marcent=array();
		$season=array();
		$order_repeat_no=array();
		$po_id_arr=array();

		$nameArray_buyer=sql_select( "select  a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, b.po_break_down_id from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
        foreach ($nameArray_buyer as $result_buy){
			$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
			$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
			//$season[$result_buy[csf('job_no')]]=$season_arr[$result_buy[csf('season_matrix')]];
			$season_matrix=$result_buy[csf('season_matrix')];
			$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
			if($season_matrix!=0 && $season_buyer_wise==0 )
			{
				$season_matrix_con=$season_matrix;
			}
			else if($season_buyer_wise!=0 && $season_matrix==0)
			{
				$season_matrix_con=$season_buyer_wise;
			}
			$seasons_name.=$season_arr[$season_matrix_con].',';
			$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
			$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

			$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];
		}
		$style_sting=implode(",",array_unique($style_ref));
		$job_no_str = "'" . implode( "','", $job_no ) . "'";
		$job_no=implode(",",$job_no);
		$seasons_names=rtrim($seasons_name,',');

		$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));
		$poid_arr=array_unique($po_id_arr);


		$order_rept_no=rtrim($order_rept_no,',');
		$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));
		$main_fabric_approved = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and a.job_no in (".$job_no_str.") and b.entry_form=7 and a.status_active =1 and a.is_deleted=0 order by b.id asc");


		$po_no=array();
		$file_no=array();
		$ref_no=array();
		$po_quantity=array();
		$pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';
		$nameArray_job=sql_select( "select b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, sum(b.po_quantity) as po_quantity  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no ");
        foreach ($nameArray_job as $result_job){
			$po_no[$result_job[csf('job_no_mst')]][$result_job[csf('id')]]=$result_job[csf('po_number')];
			$file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
			$ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
			$po_quantity[$result_job[csf('id')]]=$result_job[csf('po_quantity')];
		//	$tot_po_quantity+=$result_job[csf('po_quantity')];
			$job_ref_no[$result_job[csf('job_no_mst')]].=$result_job[csf('grouping')].',';
			$job_file_no[$result_job[csf('job_no_mst')]].=$result_job[csf('file_no')].',';
			$po_no_arr[$result_job[csf('job_no_mst')]]['po_id'].=$result_job[csf('id')].',';
			$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
			$int_ref_no.=$result_job[csf('grouping')].',';
			if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];

		}
			//echo $po_idss.'DDDDDDDDD';
		$sql_job=sql_select( "select b.job_no_mst,b.id as po_id, b.po_quantity as po_quantity  from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.") ");
		foreach ($sql_job as $row)
		{
			$job_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('po_id')]]+=$row[csf('po_quantity')];
			$tot_po_quantity+=$row[csf('po_quantity')];
		}

        $nameArray=sql_select( "select a.booking_no, a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.source, a.remarks, a.revised_no from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
		foreach( $nameArray as $row)
		{
			$varcode_booking_no=$row[csf('booking_no')];
			$booking_date=$row[csf('booking_date')];
			$delivery_date=$row[csf('delivery_date')];
			$pay_mode_id=$row[csf('pay_mode')];
			$supplier_id=$row[csf('supplier_id')];
			$currency_id=$row[csf('currency_id')];
			$buyer_id=$row[csf('buyer_id')];
			$exchange_rate=$row[csf('exchange_rate')];
			$attention=$row[csf('attention')];
			$remarks=$row[csf('remarks')];
			$revised_no=$row[csf('revised_no')];
			$source_id=$row[csf('source')];
		}
		$approved_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name, b.id from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0 order by b.id asc");
		ob_start();
	?>

	<html>
	<head>
	</head>
	<table width="1333px"  cellpadding="0" cellspacing="0" style="border:0px solid black" >
	    <tr>
		    <th>
		       	<table width="100%"  cellpadding="0" cellspacing="0" style="border:0px solid black">
		       		<tr>
		                <td width="20px">
		                    <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
			                    <tr>
				                    <td width="2">&nbsp;</td>
				                    <td width="4" align="center">&nbsp;</td>
				                    <td width="250" align="center">
					                    <b style="font-size:20px;"> <?
					                    echo $company_library[$cbo_company_name]; ?>
					                    </b>
					                    <br>
					                    <label>
					                        <?
					                            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
					                            foreach ($nameArray as $result){
					                            ?>
					                              <?  if($result[csf('plot_no')]!='') echo $result[csf('plot_no')]; else echo '';?> &nbsp;
					                                <? echo $result[csf('level_no')];?> &nbsp;
					                                 <? echo $result[csf('road_no')]; ?>  &nbsp;
					                                <? echo $result[csf('block_no')];?>  &nbsp;
					                                <? echo $result[csf('city')];?>  &nbsp;
					                                <? echo $result[csf('zip_code')]; ?>  &nbsp;
					                                 <?php echo $result[csf('province')]; ?>  &nbsp;
					                                <? echo $country_arr[$result[csf('country_id')]]; ?> &nbsp;<br/>
					                                <? echo $result[csf('email')];?>  &nbsp;
					                                <? echo $result[csf('website')];
					                                if($result[csf('plot_no')]!='')
					                                {
					                                    $plot_no=$result[csf('plot_no')];
					                                }
					                                if($result[csf('level_no')]!='')
					                                {
					                                    $level_no=$result[csf('level_no')];
					                                }
					                                if($result[csf('road_no')]!='')
					                                {
					                                    $road_no=$result[csf('road_no')];
					                                }
					                                if($result[csf('block_no')]!='')
					                                {
					                                    $block_no=$result[csf('block_no')];
					                                }
					                                if($result[csf('city')]!='')
					                                {
					                                    $city=$result[csf('city')];
					                                }
					                                $company_address[$result[csf('id')]]=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
					                            }
					                        ?>
					                        </label>
					                        <br/>
					                        <b style="font-size:15px;">
					                         <?php echo $report_title; ?>
					                        </b>
				                    </td>
			                    	<td width="10px" align="center" style="font-size:15px;">
				                      	<table width="80%" align="right" cellpadding="0" cellspacing="0" style="border:0px solid black">
					                        <tr>
					                            <td width="80">  Booking No:&nbsp; <?php echo $varcode_booking_no; ?>  </td>
					                        </tr>
					                        <tr>
					                            <td>  Booking Date:&nbsp; <?php echo change_date_format($booking_date); ?>  </td>
					                        </tr>
					                        <?
					                        if($revised_no>0)
					                        {
					                        ?>
					                        <tr>
					                            <td>  Revised No:&nbsp; <?php echo $revised_no; ?>  </td>
					                        </tr>
					                        <?
					                        }
					                        if(str_replace("'","",$id_approved_id) ==1)
					                         {
					                         ?>
					                          <tr>
					                             <td>Approved Status :&nbsp;  <? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </td>
					                         </tr>
					                         <?
					                        }
					                         ?>
				                    	</table>
			                     	</td>
			                    </tr>
		                   </table>
		                </td>
		        	</tr>
		            <tr>
		            	<td>
		            		<table width="100%"  style="border:0px solid black;table-layout: fixed;">
				                <tr><td colspan="6" valign="top"> </td></tr>
				                <tr>
				                    <td width="30" style="font-size:18px" align="left"><span><b>To, </b></span>  </td>
				                    <td width="110" colspan="5" style="font-size:18px">&nbsp;<span></span></td>
				                </tr>
				            	<tr>
				                    <td width="210" colspan="2" align="left" style="font-size:18px">&nbsp; <b>
				                    <?
				                    if($pay_mode_id==5 || $pay_mode_id==3){
				                        echo $company_library[$supplier_id];
				                    }
				                    else{
				                        echo $supplier_name_arr[$supplier_id];
				                    }
				                    ?></b>
				                    </td>
				                    <td  width="100" style="font-size:12px"><b>Buyer</b></td>
				                    <td  width="110" align="left">:&nbsp;<? echo $buyer_name_arr[$buyer_id]; ?></td>
				                    <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
				                    <td width="110" align="left">:&nbsp;<?  echo change_date_format($delivery_date); ?></td>
				           	    </tr>
				                <tr>
					                <td width="100" colspan="2" rowspan="2" align="left" style="font-size:18px">Address :&nbsp;
					                <b>
					                <?
					                if($pay_mode_id==5 || $pay_mode_id==3){
					                    $address=$company_address[$supplier_id];
					                }
					                else{
					                    $address=$supplier_address_arr[$supplier_id];
					                }
					                echo $address;
					                ?></b>
					                </td>
					                <td width="100" style="font-size:12px"><b>PO Qty.</b> </td>
					                <td width="110" align="left">:&nbsp;<? echo $tot_po_quantity; ?></td>
					                <td style="font-size:12px" ><b>Delivery To </b> </td>
					                <td style="" align="left">:&nbsp;</td>
				                </tr>
				            	<tr>
				                <td width="100" style="font-size:12px"><b>Season</b> </td>
				                <td width="110" align="left">:&nbsp;<? echo $seasons_names; ?></td>
				                <td width="100" style="font-size:12px"><b>Currency</b></td>
				                <td width="110" align="left">:&nbsp;<?  echo $currency[$currency_id]; ?></td>
				            	</tr>
					            <tr>
					                <td width="100" style="font-size:12px" align="left"><b>Attention </b>   </td>
					                <td align="left" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
					                <?
					                    echo $attention;
					                ?>
					                </td>
					                <td width="100" style="font-size:12px"><b>Order Repeat </b> </td>
					                <td width="110" align="left">:&nbsp;<? echo $order_rept_no; ?></td>
					                <td  style="font-size:12px"><b>Pay mode</b></td>
					                <td align="left">:&nbsp;<? echo $pay_mode[$pay_mode_id];?></td>
					            </tr>
					             <tr>
					                <td width="100" style="font-size:12px" align="left"><b>Source</b></td>
					                <td align="left" >:&nbsp;<? echo $source[$source_id];?></td>
					                <td style="font-size:12px"><b>Dealing Merchant</b></td>
					                <td align="left" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
					                <?
					                    echo implode(",",array_unique($all_dealing_marcent));
					                ?>
					                </td>
					            </tr>
					            <tr>
					                <td width="100" style="font-size:12px" align="left"><b>Remarks</b>  </td>
					                <td align="left" width="110" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" >:&nbsp;<? echo $remarks; ?></td>
					                <td width="130" style="font-size:12px" align="left"><b>Main Fabric Booking 1<sup>st</sup> Approved Date</b></td>
					                <td align="left">:&nbsp;<?  echo change_date_format($main_fabric_approved[0][csf('approved_date')]); ?></td>
					            </tr>
		            		</table>
		            	</td>
		            </tr>
		        </table>
		    </th>
	    </tr>
    </table>

          <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?

		$precost_arr=array();
		$trims_qtyPerUnit_arr=array();

		$precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0");
        $calUom="";
		foreach($precost_sql as $precost_row){
			if($precost_row[csf('cal_parameter')]==1){
			   $calUom="Mtr";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==2){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==3){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==4){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==5){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==6){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==7){
			   $calUom="Pcs";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==8){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else{
				$calUom=0;
			}
			 $trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
		}
		$booking_country_arr=array();
		$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,sensitivity,country_id_string from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0");
		foreach($nameArray_booking_country as $nameArray_booking_country_row){
			$country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
			$tocu=count($country_id_string);
			for($cu=0;$cu<$tocu;$cu++){
				$booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
			}
		}

		$nameArray_job_po=sql_select( "select job_no from wo_booking_dtls  where booking_no='$txt_booking_no' and status_active =1 and is_deleted=0 group by job_no order by job_no ");
		foreach($nameArray_job_po as $nameArray_job_po_row){
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$nameArray_job_po_row[csf('job_no')]."'   and sensitivity=1 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
	    if(count($nameArray_item)>0){
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];//$po_quantity[$poid];
			}
        ?>

        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="11"><strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; if($ref_nos!='' ) echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;else " ";if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;  Po Qty.:&nbsp;".$po_no_qty; "Po No:" .implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></strong>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black; width: 30px"><strong>Sl</strong> </td>
                <td style="border:1px solid black; width: 90px"><strong>Item Group</strong> </td>
                <td style="border:1px solid black; width: 90px"><strong>Item Description</strong> </td>
                <td style="border:1px solid black; width: 60px"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black; width: 60px"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black; width: 30px"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black; width: 30px" align="center"><strong>WO Qty</strong></td>
                <td style="border:1px solid black; width: 30px" align="center"><strong>UOM</strong></td>
				  <? if($show_comment==1) {?>
                <td style="border:1px solid black; width: 30px" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black; width: 30px" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black; width: 60px" align="center"><strong>Remarks</strong></td>
                <? }?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item){
			$i++;
            $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_color,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black; width: 30px" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center"  style="border:1px solid black; width: 90px" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription){
                ?>
                <td style="border:1px solid black; width: 90px"><?  if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black; width: 60px"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left; width: 60px">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left; width: 30px">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <td style="border:1px solid black; text-align:right; width: 30px">
				<?

				echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center; width: 30px"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right; width: 30px"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>

                <td style="border:1px solid black; text-align:right; width: 30px">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>

                 <td style="border:1px solid black; text-align:right; width: 60px"><p><? echo $trims_remark; ?> </p></td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

					echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="8"><strong>Total</strong></td>
				  <? if($show_comment==1) {?>
				 <td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->


        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=2 and  status_active =1 and  is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                 <table width="100%">
                <tr>
                <td width="60%"><strong>Size Sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; echo "&nbsp;&nbsp;Int Ref.:".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp; Po Qty..:".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;margin-left:210px; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Article No</strong></td>
                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
			$i++;
			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,b.article_number,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size,b.article_number order by bid");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][2]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black">
				<?
				if($result_itemdescription[csf('article_number')]!="no article"){
					echo $result_itemdescription[csf('article_number')];
				}else{
					echo "-";
				}
				?>
                </td>
                <td style="border:1px solid black; text-align:left">
              <? echo $result_itemdescription[csf('item_size')];?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>


                <td style="border:1px solid black; text-align:right">
				<?

					  echo number_format($result_itemdescription[csf('cons')],4);

                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">

                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>

                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold"><?

					echo number_format($item_desctiption_total,4);
				 ?></td>
                 <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="9"><strong>Total</strong></td>
				 <? if($show_comment==1) {?>
					<td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=3 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>
        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>

                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by trim_group ", "item_color", "color_number_id"  );

			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,b.color_number_id order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   echo $color_library[$result_itemdescription[csf('color_number_id')]];
			   ?>
                </td>
               <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>

                <td style="border:1px solid black; text-align:right">
				<?
				echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>

                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?></p> </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				echo number_format($item_desctiption_total,4);
				 ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="9"><strong>Total</strong></td>
				<? if($show_comment==1) {?>
				<td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group");
	   if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));

			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" ><strong>Color & size sensitive (<? echo "Job NO: ".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]] ;echo "&nbsp;&nbsp;Int Ref.:&nbsp;".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group </strong> </td>


                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td style="border:1px solid black"><strong>Article No.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td style="border:1px solid black; width:170px;"><strong>Gmts Color</strong> </td>
                <td style="border:1px solid black;"><strong>Gmts Size</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by trim_group ", "item_color", "color_number_id"  );

			 $nameArray_color=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.color_number_id as gmt_color, b.item_color as color_number_id,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount, min(c.color_order) as color_order, min(c.size_order) as size_order,c.article_number from wo_booking_dtls a, wo_trim_book_con_dtls b,wo_po_color_size_breakdown c  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and b.po_break_down_id=c.po_break_down_id and b.color_number_id=c.color_number_id and b.gmts_sizes=c.size_number_id and  c.id=b.color_size_table_id and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=4 and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.color_number_id, b.item_color,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,c.article_number order by c.article_number,color_order,size_order");



            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]." and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  status_active =1 and is_deleted=0 order by trim_group ");
            if(count($nameArray_color)>0){
            	$i++; ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][4]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
				foreach($nameArray_color as $result_color)
                {
					?>

					<td style="border:1px solid black" ><? if($result_color[csf('description')]){echo $result_color[csf('description')];} ?> </td>
					<td style="border:1px solid black" ><? if($result_color[csf('brand_supplier')]){echo $result_color[csf('brand_supplier')]; }?> </td>
                    <td style="border:1px solid black">
					<?
					if($result_color[csf('article_number')]!="no article"){
						echo $result_color[csf('article_number')];
					}else{
						echo "-";
					}
					?>
                    </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('gmt_color')]];?> </td>
                    <td style="border:1px solid black; text-align:left">
					<? echo $size_library[$result_color[csf('gmts_sizes')]]; ?>
					</td>
					<td style="border:1px solid black; text-align:left">
					<? echo $result_color[csf('item_size')]; ?>
					</td>
                    <td style="border:1px solid black; text-align:left">
				   <?
				   $calUom=$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][2];
			       $calQty=explode("_",$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				   if($calUom && end($calQty)){
					   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
				   }
                   ?>
                    </td>

					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('cons')],4);
					$item_desctiption_total += $result_color[csf('cons')] ;
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]];  ?></td>
					<? if($show_comment==1) {?>
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('rate')],4);
					?>
                     </td>

					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,4);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					$trims_remark=$trims_remark_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
					?>
					</td>

                    <td style="border:1px solid black;text-align:center"><? echo $trims_remark; ?> </td>
                    <? } ?>
				</tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="10"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				echo number_format($item_desctiption_total,4);  ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
         }

            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="<? echo ($show_comment==1) ? 13 : 11; ?>"><strong>Total</strong></td>
				<? if($show_comment==1) {?>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp;  </td>
                <? } else{ ?>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                <? } ?>
            </tr>
        </table>
        <br/>
       <?
		}
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->

         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=0 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				//echo $poid.', ';
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}

			//$po_quantity[$result_job[csf('id')]];
        ?>
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                    <table width="100%" style="table-layout: fixed;">
                    <tr>
                    <td width="60%"><strong>NO sensitive  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                    <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                    </tr>
                    </table>
                 </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td align="center" style="border:1px solid black"><strong> Qnty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                 <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                 <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color");

            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">

                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);

				?>
                </td>
                <?
                $color_tatal=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
                $item_desctiption_total=0;
                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <?
				if($db_type==0)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
						}
						if($db_type==2)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
						}

                foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right">
                <?
                if($result_color_size_qnty[csf('cons')]!= "")
                {

               echo number_format($result_color_size_qnty[csf('cons')],4);
                $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                $color_tatal+=$result_color_size_qnty[csf('cons')];
                }
                else echo "";
                ?>
                </td>
                <?
                }
                ?>

                <td style="border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
					<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                ?>
                </td>

                 <td style="border:1px solid black; text-align:right"><? echo $trims_remark; ?> </td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;">
                <?
                if($color_tatal !='')
                {

						 echo number_format($color_tatal,4);
                }
                ?>
                </td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="8"><strong>Total</strong></td>
					<? if($show_comment==1) {?>
					<td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <?
		}
		}
		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->

       <?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>
       <br/>
       <table width="100%" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                <td width="70%" style="border:1px solid black; text-align:left"><? echo number_format($booking_grand_total,2);?></td>
            </tr>
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                <td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
            </tr>
        </table>
         <br/>
            <table width="100%" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
                <tr>
                <td width="49%">
                <?
                    echo get_spacial_instruction($txt_booking_no);
                ?>
                </td>
                <td width="2%"></td>
                <td width="49%" valign="top" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
                    <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">

                        <tr style="border:1px solid black;">
                            <td colspan="3" style="border:1px solid black;">Approval Status</td>
                            </tr>
                            <tr style="border:1px solid black;">
                            <td width="3%" style="border:1px solid black;">Sl</td><td width="50%" style="border:1px solid black;">Name</td><td width="27%" style="border:1px solid black;">Approval Date</td><td width="20%" style="border:1px solid black;">Approval No</td>
                            </tr>


                        <?
                        $i;
                        foreach($approved_array as $row){
                        ?>
                        <tr style="border:1px solid black;">
                            <td width="3%" style="border:1px solid black;"><? echo $i;?></td><td width="50%" style="border:1px solid black;"><? echo $row[csf('user_full_name')];?></td><td width="27%" style="border:1px solid black;"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); ;?></td><td width="20%" style="border:1px solid black;"><? echo $row[csf('approved_no')];?></td>
                            </tr>
                            <?
                            $i++;
                        }
                            ?>

                    </table>
            </td>
            </tr>
        </table>
		 <br>
	  <br>
        <?
        //------------------------------ Query for TNA start-----------------------------------
			$sql_job_color=sql_select( "select c.color_type_id,b.id as po_id  from wo_po_details_master a, wo_po_break_down b,wo_pre_cost_fabric_cost_dtls c where a.job_no=b.job_no_mst and  a.job_no=c.job_no and  b.job_no_mst=c.job_no  and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.") ");

			foreach ($sql_job_color as $row)
			{
				$po_color_type_arr[$row[csf('po_id')]]=$row[csf('color_type')];

			}


				$po_num_arr=return_library_array("select id,po_number from wo_po_break_down where id in($po_idss)",'id','po_number');
				$tna_start_sql=sql_select( "select id,po_number_id,

								(case when task_number=73 then task_start_date else null end) as finishing_start_date,
								(case when task_number=73 then task_finish_date else null end) as finishing_end_date,
								(case when task_number=179 then task_start_date else null end) as aop_finishing_start_date,
								(case when task_number=179 then task_finish_date else null end) as aop_finishing_end_date,
								(case when task_number=180 then task_start_date else null end) as yd_finishing_start_date,
								(case when task_number=180 then task_finish_date else null end) as yd_finishing_end_date
								from tna_process_mst
								where status_active=1 and po_number_id in($po_idss)");

				$tna_fab_start=$tna_knit_start=$tna_dyeing_start=$tna_fin_start=$tna_cut_start=$tna_sewin_start=$tna_exfact_start="";
				$tna_date_task_arr=array();
				foreach($tna_start_sql as $row)
				{

					if($row[csf("finishing_start_date")]!="" && $row[csf("finishing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_start_date']=$row[csf("finishing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_end_date']=$row[csf("finishing_end_date")];
					}
					if($row[csf("aop_finishing_start_date")]!="" && $row[csf("aop_finishing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['aop_finishing_start_date']=$row[csf("aop_finishing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['aop_finishing_end_date']=$row[csf("aop_finishing_end_date")];
					}
					if($row[csf("yd_finishing_start_date")]!="" && $row[csf("yd_finishing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['yd_finishing_start_date']=$row[csf("yd_finishing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['yd_finishing_end_date']=$row[csf("yd_finishing_end_date")];
					}

				}

	//------------------------------ Query for TNA end-----------------------------------
		?>
        <fieldset id="div_size_color_matrix" style="max-width:700;">
        <legend>TNA Information</legend>
        <!--<span style="font-size:180; font-weight:bold;"></span>-->
        <table width="100%" style="border:1px solid black;font-size:12px" border="1" cellpadding="2" cellspacing="0" rules="all">
            <tr>
            	<td rowspan="2" align="center" width="100" valign="top">SL</td>
            	<td width="280" rowspan="2"  align="center" valign="top"><b>Order No</b></td>

                <td colspan="2" align="center" valign="top"><b>Finishing Fabric In Solid</b></td>
                <td colspan="2" align="center" valign="top"><b>Finishing Fabric In AOP </b></td>
                <td colspan="2" align="center" valign="top"><b>Finishing Fabric In YD </b></td>

            </tr>
            <tr>

                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>


            </tr>
            <?
			$i=1;
			foreach($tna_date_task_arr as $order_id=>$row)
			{
				?>
                <tr>
                	<td width="100"><? echo $i; ?></td>
                    <td><? echo $po_num_arr[$order_id]; ?></td>

                    <td align="center"><? echo change_date_format($row['finishing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['aop_finishing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['aop_finishing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['yd_finishing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['yd_finishing_end_date']); ?></td>

                </tr>
                <?
				$i++;
			}
			?>

        </table>
        </fieldset>



     <!--class="footer_signature"-->
    <div  style="margin-top:-50px;">
         <?
          echo signature_table(132, $cbo_company_name, "1333px",1);
		 ?>
    </div>
    <div id="page_break_div"></div>

</html>

<?
        //echo signature_table(2, $cbo_company_name, "1330px");
		//echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
		$user_id=$_SESSION['logic_erp']['user_id'];
		$report_cat=100;
		$html = ob_get_contents();
		ob_clean();
		//$new_link=create_delete_report_file( $html, 2, $delete, "../../../" );
		foreach (glob("tb*.xls") as $filename) {
		//if( @filemtime($filename) < (time()-$seconds_old) )
		@unlink($filename);
		}
		//---------end------------//
		$name=time();
		$filename="tb".$user_id."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc, $html);
		echo "$html####$filename####$report_cat";

//exit();
}

if($action=="show_trim_booking_report7")
{
	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');

	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");

	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;
	//$revised_no_data=sql_select("select a.revised_no  from wo_booking_mst a where  a.booking_no=$txt_booking_no and  a.status_active =1 and a.is_deleted=0");
	//list($revised_no_row)=$revised_no_data;
		$booking_grand_total=0;
		$currency_id="";


		$buyer_string=array();
		$style_owner=array();
		$job_no=array();
		$style_ref=array();
		$all_dealing_marcent=array();
		$season=array();
		$order_repeat_no=array();
		$po_id_arr=array();

		$nameArray_buyer=sql_select( "select  a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, b.po_break_down_id from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
        foreach ($nameArray_buyer as $result_buy){
			$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
			$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
			//$season[$result_buy[csf('job_no')]]=$season_arr[$result_buy[csf('season_matrix')]];
			$season_matrix=$result_buy[csf('season_matrix')];
			$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
			if($season_matrix!=0 && $season_buyer_wise==0 )
			{
				$season_matrix_con=$season_matrix;
			}
			else if($season_buyer_wise!=0 && $season_matrix==0)
			{
				$season_matrix_con=$season_buyer_wise;
			}
			$seasons_name.=$season_arr[$season_matrix_con].',';
			$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
			$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

			$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];
		}
		$style_sting=implode(",",array_unique($style_ref));
		$job_no_str = "'" . implode( "','", $job_no ) . "'";
		$job_no=implode(",",$job_no);
		$seasons_names=rtrim($seasons_name,',');

		$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));
		$poid_arr=array_unique($po_id_arr);


		$order_rept_no=rtrim($order_rept_no,',');
		$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));
		$main_fabric_approved = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and a.job_no in (".$job_no_str.") and b.entry_form=7 and a.status_active =1 and a.is_deleted=0 order by b.id asc");


		$po_no=array();
		$file_no=array();
		$ref_no=array();
		$po_quantity=array();
		$pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';
		$nameArray_job=sql_select( "select  max(a.update_date) as update_date,b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, sum(b.po_quantity) as po_quantity  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no ");
        foreach ($nameArray_job as $result_job){
			$po_no[$result_job[csf('job_no_mst')]][$result_job[csf('id')]]=$result_job[csf('po_number')];
			$file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
			$ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
			$po_quantity[$result_job[csf('id')]]=$result_job[csf('po_quantity')];
		//	$tot_po_quantity+=$result_job[csf('po_quantity')];
			$job_ref_no[$result_job[csf('job_no_mst')]].=$result_job[csf('grouping')].',';
			$job_file_no[$result_job[csf('job_no_mst')]].=$result_job[csf('file_no')].',';
			$po_no_arr[$result_job[csf('job_no_mst')]]['po_id'].=$result_job[csf('id')].',';
			$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
			$int_ref_no.=$result_job[csf('grouping')].',';
			if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];
			$revised_update_date=explode(" ",$result_job[csf('update_date')]);
			$revised_date=strtotime($revised_update_date[0]);

		}
			//echo $po_idss.'DDDDDDDDD';
		$sql_job=sql_select( "select a.order_uom, a.total_set_qnty, b.job_no_mst,b.id as po_id, b.po_quantity as po_quantity  from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.") ");
		foreach ($sql_job as $row)
		{
			$job_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('po_id')]]+=$row[csf('po_quantity')];
			$job_uom_arr[$row[csf('job_no_mst')]]=$row[csf('order_uom')];
			$tot_po_quantity+=$row[csf('po_quantity')]*$row[csf('total_set_qnty')];
		}

        $nameArray=sql_select( "select a.booking_no, a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.source, a.remarks, a.revised_no,a.update_date,a.delivery_address from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
		foreach( $nameArray as $row)
		{
			$varcode_booking_no=$row[csf('booking_no')];
			$booking_date=$row[csf('booking_date')];
			$delivery_date=$row[csf('delivery_date')];
			$pay_mode_id=$row[csf('pay_mode')];
			$supplier_id=$row[csf('supplier_id')];
			$currency_id=$row[csf('currency_id')];
			$buyer_id=$row[csf('buyer_id')];
			$exchange_rate=$row[csf('exchange_rate')];
			$attention=$row[csf('attention')];
			$remarks=$row[csf('remarks')];
			$delivery_address=$row[csf('delivery_address')];
			$revised_no=$row[csf('revised_no')];
			$mst_update_date=explode(" ",$row[csf('update_date')]);
			$mst_revised_date=strtotime($mst_update_date[0]);
			$source_id=$row[csf('source')];
		}
		if($revised_date!="" && $mst_revised_date!="")
		{
			$max_revised_date_time=max($revised_date,$mst_revised_date);
			$max_revised_date=date('d-m-Y',$max_revised_date_time);
		}
		else if($revised_date!="" && $mst_revised_date=="")
		{
			$max_revised_date=date('d-m-Y',$revised_date);
		}
		else if($mst_revised_date!="" && $revised_date=="")
		{
			$max_revised_date=date('d-m-Y',$mst_revised_date);
		}
		$approved_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name, b.id from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0 order by b.id asc");
	
	ob_start();
	?>

	<table width="100%"  cellpadding="0" cellspacing="0" style="border:0px solid black">
       		<tr>
                <td width="20px">
                    <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
                    <tr>
	                    <td width="50" >
	                       <? if($report_type==1)
	                       {
	                           if($link == 1)
	                           {
	                       		?><img  src='../../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' /><?
	                           }
	                           else
	                           {
	                       			?><img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' /><?
						   	}
	                       }
	                       else
	                       { ?>
	                         <img  src='../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
	                      <? }
	                       ?>
	                   </td>
                    <td width="40px" align="center">
                    &nbsp;  &nbsp;  &nbsp;
                    </td>
                    <td width="30px"   align="center">
                   <b style="font-size:25px;"> <?
                    echo $company_library[$cbo_company_name]; ?>
                    </b>
                    <br>
                    <label>
                        <?
                            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                            foreach ($nameArray as $result){
                            ?>
                              <?  if($result[csf('plot_no')]!='') echo $result[csf('plot_no')]; else echo '';?> &nbsp;
                                <? echo $result[csf('level_no')];?> &nbsp;
                                 <? echo $result[csf('road_no')]; ?>  &nbsp;
                                <? echo $result[csf('block_no')];?>  &nbsp;
                                <? echo $result[csf('city')];?>  &nbsp;
                                <? echo $result[csf('zip_code')]; ?>  &nbsp;
                                 <?php echo $result[csf('province')]; ?>  &nbsp;
                                <? echo $country_arr[$result[csf('country_id')]]; ?> &nbsp;<br/>
                                <? echo $result[csf('email')];?>  &nbsp;
                                <? echo $result[csf('website')];
                                if($result[csf('plot_no')]!='')
                                {
                                    $plot_no=$result[csf('plot_no')];
                                }
                                if($result[csf('level_no')]!='')
                                {
                                    $level_no=$result[csf('level_no')];
                                }
                                if($result[csf('road_no')]!='')
                                {
                                    $road_no=$result[csf('road_no')];
                                }
                                if($result[csf('block_no')]!='')
                                {
                                    $block_no=$result[csf('block_no')];
                                }
                                if($result[csf('city')]!='')
                                {
                                    $city=$result[csf('city')];
                                }
                                $company_address[$result[csf('id')]]=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
                            }
                        ?>
                        </label>
                        <br/>
                        <b style="font-size:20px;">
                         <?php echo $report_title; ?>
                        </b>
                    </td>
                     <td width="10px" align="center" style="font-size:20px;">
                      <table width="80%" align="right" cellpadding="0" cellspacing="0" style="border:0px solid black">
                        <tr>
                            <td width="80">  Booking No:&nbsp; <?php echo $varcode_booking_no; ?>  </td>
                        </tr>
                        <tr>
                            <td>  Booking Date:&nbsp; <?php echo change_date_format($booking_date); ?>  </td>
                        </tr>
                        <?
                        if($revised_no>0)
                        {
                        ?>
                        <tr>
                            <td>  Revised No:&nbsp; <?php echo $revised_no . '&nbsp(Date:' . change_date_format($max_revised_date) . ')'; ?>  </td>
                        </tr>
                        <?
                        }
                        if(str_replace("'","",$id_approved_id) ==1)
                         {
                         ?>
                          <tr>
                             <td>Approved Status :&nbsp;  <? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </td>
                         </tr>
                         <?
                        }
                         ?>
                      </table>

                     </td>
                   </tr>
                   </table>
                </td>
        	</tr>
            <tr>
            <td>

            	<table width="100%"  style="border:0px solid black;table-layout: fixed;">
                <tr>
                    <td colspan="6" valign="top"> </td>
                </tr>
                <tr>
                    <td width="100" style="font-size:18px" align="left"><span><b>To, </b></span>  </td>
                    <td width="110" colspan="5" style="font-size:18px">&nbsp;<span></span></td>
                </tr>
            	<tr>
                    <td width="210" colspan="2" align="left" style="font-size:18px">&nbsp; <b>
                    <?
                    if($pay_mode_id==5 || $pay_mode_id==3){
                        echo $company_library[$supplier_id];
                    }
                    else{
                        echo $supplier_name_arr[$supplier_id];
                    }
                    ?></b>
                    </td>
                    <td  width="100" style="font-size:12px"><b>Buyer</b></td>
                    <td  width="110" align="left">:&nbsp;<? echo $buyer_name_arr[$buyer_id]; ?></td>
                    <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
                    <td width="110" align="left">:&nbsp;<?  echo change_date_format($delivery_date); ?></td>
           	   </tr>
              <tr>
                <td width="100" colspan="2" rowspan="2" align="left" style="font-size:18px">Address :&nbsp;
                <b>
                <?
                if($pay_mode_id==5 || $pay_mode_id==3){
                    $address=$company_address[$supplier_id];
                }
                else{
                    $address=$supplier_address_arr[$supplier_id];
                }
                echo $address;
                ?></b>
                </td>
                <td width="100" style="font-size:12px"><b>PO Qty.[PCS]</b> </td>
                <td width="110" align="left">:&nbsp;<? echo $tot_po_quantity; ?></td>
                <td style="font-size:12px" ><b>Delivery To </b> </td>
                <td style="" align="left">:&nbsp;
                <?
                    echo $delivery_address;
                ?>
                </td>
             </tr>
            <tr>
                <td width="100" style="font-size:12px"><b>Season</b> </td>
                <td width="110" align="left">:&nbsp;<? echo $seasons_names; ?></td>
                <td width="100" style="font-size:12px"><b>Currency</b></td>
                <td width="110" align="left">:&nbsp;<?  echo $currency[$currency_id]; ?></td>
            </tr>
            <tr>
                <td width="100" style="font-size:12px" align="left"><b>Attention </b>   </td>
                <td align="left" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
                <?
                    echo $attention;
                ?>
                </td>
                <td width="100" style="font-size:12px"><b>Order Repeat </b> </td>
                <td width="110" align="left">:&nbsp;<? echo $order_rept_no; ?></td>
                <td  style="font-size:12px"><b>Pay mode</b></td>
                <td align="left">:&nbsp;<? echo $pay_mode[$pay_mode_id];?></td>
            </tr>
            <tr>
                <td width="100" style="font-size:12px" align="left"><b>Source</b></td>
                <td align="left" >:&nbsp;<? echo $source[$source_id];?></td>
                <td style="font-size:12px"><b>Dealing Merchant</b></td>
                <td align="left" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
                <?
                    echo implode(",",array_unique($all_dealing_marcent));
                ?>
                </td>
            </tr>
            <tr>
                <td width="100" style="font-size:12px" align="left"><b>Remarks</b>  </td>
                <td align="left" width="110" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" >:&nbsp;<? echo $remarks; ?></td>
                <td width="130" style="font-size:12px" align="left"><b>Main Fabric Booking 1<sup>st</sup> Approved Date</b></td>
                <td align="left">:&nbsp;<?  echo change_date_format($main_fabric_approved[0][csf('approved_date')]); ?></td>
            </tr>
            </table>
            </td>
            </tr>
          </table>
 <!--    	<table width="1333px"  cellpadding="0" cellspacing="0" style="border:0px solid black" >
    <tr>
    <th>

    </th>
    </tr>
     <tr>
     <td> -->
          <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?
  //getQtyArray_by_orderPrecostdtlsidAndGmtscolor
   //$condition->company_name("=$cbo_company_name");
   $condition= new condition();
	  if($po_idss !=''){
	 $condition->po_id("in($po_idss)");
	}
	$condition->init();
	$trim= new trims($condition);

	//echo $trim->getQuery();die;
	$trim_req_qty_arr=$trim->getQtyArray_by_orderPrecostdtlsidAndGmtscolor();
	$trim_req_size_qty_arr=$trim->getQtyArray_by_orderPrecostdtlsidAndGmtssize();
	$trim_req_color_size_qty_arr=$trim->getQtyArray_by_OrderPrecostdtlsidGmtscolorAndGmtssize();
	$costPerArr=$condition->getCostingPerArr();


	//print_r($trim_req_color_size_qty_arr);
		$precost_arr=array();
		$trims_qtyPerUnit_arr=array();

		$precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0");
        $calUom="";
		foreach($precost_sql as $precost_row){
			if($precost_row[csf('cal_parameter')]==1){
			   $calUom="Mtr";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==2){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==3){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==4){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==5){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==6){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==7){
			   $calUom="Pcs";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==8){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else{
				$calUom=0;
			}
			 $trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
		}
		$booking_country_arr=array();
		$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,sensitivity,country_id_string,remark from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0");
		foreach($nameArray_booking_country as $row){
			if($row[csf('remark')]!="")
			{
			 $booking_remarkArr[$row[csf('pre_cost_fabric_cost_dtls_id')]]=$row[csf('remark')];
			}
			$country_id_string=explode(",",$row[csf('country_id_string')]);
			$tocu=count($country_id_string);
			for($cu=0;$cu<$tocu;$cu++){
				$booking_country_arr[$row[csf('pre_cost_fabric_cost_dtls_id')]][$row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
			}
		}
		$data_array_color="select a.job_no_mst,a.id as po_id,b.order_quantity, b.item_number_id,b.color_number_id, b.size_number_id from  wo_po_break_down a, wo_po_color_size_breakdown b where a.job_no_mst=b.job_no_mst and a.id=b.po_break_down_id and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and a.id in($po_idss) order by a.id";
		$result_color=sql_select($data_array_color);
		 foreach($result_color as $row)
		 {
			 $color_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('color_number_id')]]+=$row[csf('order_quantity')];
			 $item_color_qty_arr[$row[csf('job_no_mst')]][$row[csf('item_number_id')]][$row[csf('color_number_id')]]+=$row[csf('order_quantity')];
			  $size_qty_arr[$row[csf('job_no_mst')]][$row[csf('item_number_id')]][$row[csf('size_number_id')]]+=$row[csf('order_quantity')];
			 $color_size_qty_arr[$row[csf('job_no_mst')]][$row[csf('item_number_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]+=$row[csf('order_quantity')];

			 $job_qty_arr[$row[csf('job_no_mst')]][$row[csf('item_number_id')]]+=$row[csf('order_quantity')];
		 }

		$trim_pre=sql_select( "select a.id as trim_cost_id,a.trim_group,c.cons,a.job_no,a.cons_uom,c.item_number_id,c.po_break_down_id,c.color_number_id,c.size_number_id from wo_pre_cost_trim_cost_dtls a,wo_pre_cost_trim_co_cons_dtls c   where a.id=c.wo_pre_cost_trim_cost_dtls_id and c.cons>0 and c.po_break_down_id in($po_idss) and  a.status_active =1 and a.is_deleted=0 and  c.status_active =1 and c.is_deleted=0  order by a.job_no ");
		foreach($trim_pre as $row)
		{
			$trim_item_arr[$row[csf('job_no')]][$row[csf('trim_group')]]=$row[csf('cons_uom')];
			$trim_item_arr2[$row[csf('trim_cost_id')]].=$row[csf('item_number_id')].',';
			$trim_req_qty=$trim_req_qty_arr[$row[csf('po_break_down_id')]][$row[csf('trim_cost_id')]][$row[csf('color_number_id')]];
			$trim_size_req_qty=$trim_req_size_qty_arr[$row[csf('po_break_down_id')]][$row[csf('trim_cost_id')]][$row[csf('size_number_id')]];
			$trim_color_size_req_qty=$trim_req_color_size_qty_arr[$row[csf('po_break_down_id')]][$row[csf('trim_cost_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]];
			//echo $trim_req_qty.'<br>';
			if($trim_color_size_req_qty>0)
			{
			$trim_color_req_qty_arr[$row[csf('trim_cost_id')]][$row[csf('color_number_id')]]+=$trim_color_size_req_qty;
			$trim_item_req_qty_arr[$row[csf('trim_cost_id')]]+=$trim_color_size_req_qty;
			$trim_item_size_req_qty_arr[$row[csf('trim_cost_id')]][$row[csf('size_number_id')]]+=$trim_color_size_req_qty;
			}
			//$trim_color_req_qty_arr[$row[csf('trim_cost_id')]][$row[csf('color_number_id')]]+=$row[csf('cons')];
			$trim_size_req_qty_arr[$row[csf('trim_cost_id')]][$row[csf('size_number_id')]]+=$trim_size_req_qty;
			$trim_color_size_req_qty_arr[$row[csf('trim_cost_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]+=$trim_color_size_req_qty;

		}
		//print_r($trim_color_req_qty_arr);
		$nameArray_job_po=sql_select( "select job_no from wo_booking_dtls  where booking_no='$txt_booking_no' and status_active =1 and is_deleted=0 group by job_no order by job_no ");
		foreach($nameArray_job_po as $nameArray_job_po_row){
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$nameArray_job_po_row[csf('job_no')]."'   and sensitivity=1 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
	    if(count($nameArray_item)>0){
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];//$po_quantity[$poid];
			}
        ?>

        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="13" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" align="left"><strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; if($ref_nos!='' ) echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;else " ";if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;  Po Qty.:&nbsp;".$po_no_qty.'['.$unit_of_measurement[$job_uom_arr[$nameArray_job_po_row[csf('job_no')]]].']'; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td align="center" style="border:1px solid black"><strong>Avg.Cons.</strong></td>
                <td align="center" style="border:1px solid black"><strong>Cons.UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				  <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? }?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item){
			$i++;
            $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_color,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color order by bid ");
			$trim_uom=$trim_item_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf('trim_group')]];
			
			 

			$costPerQty=$costPerArr[$nameArray_job_po_row[csf('job_no')]];

            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center"  style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				?>
                </td>
                <?
				$item_desctiption_total=$item_desctiption_color_total=$item_color_po_qty_total=$item_color_req_qty_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription){
					$item_color=$result_itemdescription[csf('item_color')];
					$trim_item=rtrim($trim_item_arr2[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]],',');
					$trim_item_id=array_unique(explode(",",$trim_item));
					$jobno=$nameArray_job_po_row[csf('job_no')];
					$color_po_qty=0;
					foreach($trim_item_id as $item)
					{
					$color_po_qty+=$item_color_qty_arr[$jobno][$item][$item_color];
					}
					// $job_qty=$job_qty_arr[$nameArray_job_po_row[csf('job_no')]];
					//$color_po_qty=$color_po_qty_arr[$nameArray_job_po_row[csf('job_no')]][$item_color];
					//echo  $color_po_qty.'='. $job_qty.'<br>';
					$color_trimreq=$trim_color_req_qty_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][$result_itemdescription[csf('item_color')]];
				//	$color_trim_cons=$trim_color_req_qty_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][$result_itemdescription[csf('item_color')]];
					$color_trim_req=($color_trimreq/$color_po_qty)*$costPerQty;

                ?>
                <td style="border:1px solid black"><?  if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left" title="<? echo $trim_item;?>">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td align="center" style="border:1px solid black;">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                 <td title="Color Req Qty/Item Color Qty*Cost Per(<? echo $color_trimreq.'/'.$color_po_qty.'*'.$costPerQty;?>)" style="border:1px solid black; text-align:right">
               <? echo number_format($color_trim_req,4);
			   $item_desctiption_color_total += $color_trim_req ;
			   $item_color_po_qty_total += $color_po_qty ;
			   $item_color_req_qty_total += $color_trimreq ;//$item_color_po_qty_total=$item_color_req_qty_total=0;
			    ?>
                </td>
                 <td align="center" style="border:1px solid black;">
               <? echo $unit_of_measurement[$trim_uom]; ?>
                </td>

                <td style="border:1px solid black; text-align:right">
				<?
				echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$trims_item_arr[$result_item[csf('trim_group')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_itemdescription[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
				$remark= $booking_remarkArr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]];
               if($trims_remark!="") $trims_remark=$trims_remark;else $trims_remark=$remark;
			    ?>
                </td>

                 <td  style="border:1px solid black; text-align:center"><p><? echo $trims_remark; ?> </p></td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                 <td title="<? echo '('.$item_color_req_qty_total.'/'.$item_color_po_qty_total.')*'.$costPerQty;?>" style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					echo number_format(($item_color_req_qty_total/$item_color_po_qty_total)*$costPerQty,4);//number_format($item_desctiption_color_total ,4);
				 ?></td>
                  <td style="border:1px solid black;  text-align:right; font-weight:bold;"></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
				  <? if($show_comment==1) {?>
				 <td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->


        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=2 and  status_active =1 and  is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                 <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Size Sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; echo "&nbsp;&nbsp;Int Ref.:".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp; Po Qty.:".$po_no_qty.'['.$unit_of_measurement[$job_uom_arr[$nameArray_job_po_row[csf('job_no')]]].']'; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;margin-left:210px; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Article No</strong></td>
                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>Avg. Cons.</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cons.UOM</strong></td>

                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
			$i++;
			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,b.gmts_sizes,b.article_number,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size,b.gmts_sizes,b.article_number order by bid");
			$trim_uom=$trim_item_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf('trim_group')]];
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][2]);
				?>
                </td>
                <?
                $item_desctiption_total=$item_desctiption_size_total=$item_po_desctiption_size_total=$item_req_desctiption_size_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
					//$trim_size_req_qty_arr[$row[csf('trim_cost_id')]][$row[csf('size_number_id')]]
					//$color_trim_req=$trim_size_req_qty_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][$result_itemdescription[csf('gmts_sizes')]];
					//$trim_item_size_req_qty_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][$row[csf('size_number_id')]];
					$costPerQty=$costPerArr[$nameArray_job_po_row[csf('job_no')]];
					//$color_id=$result_itemdescription[csf('color_number_id')];
					$trim_item=rtrim($trim_item_arr2[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]],',');
					$trim_item_id=array_unique(explode(",",$trim_item));
					$gmts_sizes=$result_itemdescription[csf('gmts_sizes')];
					$jobno=$nameArray_job_po_row[csf('job_no')];
					$size_po_qty=0;
					foreach($trim_item_id as $item)
					{
					$size_po_qty+=$size_qty_arr[$jobno][$item][$gmts_sizes];
					}

					$trim_sizereq=$trim_item_size_req_qty_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][$result_itemdescription[csf('gmts_sizes')]];
					//$job_qty=$job_qty_arr[$nameArray_job_po_row[csf('job_no')]];
					$trim_size_req=($trim_sizereq/$size_po_qty)*$costPerQty;

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black">
				<?
				if($result_itemdescription[csf('article_number')]!="no article"){
					echo $result_itemdescription[csf('article_number')];
				}else{
					echo "-";
				}
				?>
                </td>
                <td style="border:1px solid black; text-align:left">
              <? echo $result_itemdescription[csf('item_size')];?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <td  title="Item Size Req Qty/Item Size Qty*Cost Per(<? echo $trim_sizereq.'/'.$size_po_qty.'*'.$costPerQty;?>)" style="border:1px solid black; text-align:right">
               <? echo number_format($trim_size_req,4);
			   $item_desctiption_size_total += $trim_size_req ;
			   $item_po_desctiption_size_total += $size_po_qty ;//
			   $item_req_desctiption_size_total += $trim_sizereq ;

			    ?>
                </td>
                 <td align="center" style="border:1px solid black;">
               <? echo $unit_of_measurement[$trim_uom]; ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?
					  echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$trims_item_arr[$result_item[csf('trim_group')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_itemdescription[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];

				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">

                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
				$remark= $booking_remarkArr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]];
               if($trims_remark!="") $trims_remark=$trims_remark;else $trims_remark=$remark;
                ?>
                </td>

                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td  title="<? echo '('.$item_req_desctiption_size_total.'/'.$item_po_desctiption_size_total.')*'.$costPerQty;?>" style="border:1px solid black;  text-align:right; font-weight:bold"><?

					echo number_format(($item_req_desctiption_size_total/$item_po_desctiption_size_total)*$costPerQty,4);
				 ?></td>
                   <td style="border:1px solid black;  text-align:right; font-weight:bold"><?

					//echo number_format($item_desctiption_total,4);
				 ?></td>
                   <td style="border:1px solid black;  text-align:right; font-weight:bold"><?

					echo number_format($item_desctiption_total,4);
				 ?></td>
                 <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="11"><strong>Total</strong></td>
				 <? if($show_comment==1) {?>
					<td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=3 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>
        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty.'['.$unit_of_measurement[$job_uom_arr[$nameArray_job_po_row[csf('job_no')]]].']'; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>

                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>Avg.Cons.</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cons.UOM</strong></td>

                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by trim_group ", "item_color", "color_number_id"  );

			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,b.color_number_id order by bid ");

			$trim_uom=$trim_item_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf('trim_group')]];
			?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
				?>
                </td>
                <?
                $item_desctiption_total=$item_desctiption_color_total=$item_req_desctiption_color_total=$item_po_desctiption_color_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

				$costPerQty=$costPerArr[$nameArray_job_po_row[csf('job_no')]];
				$color_id=$result_itemdescription[csf('color_number_id')];

				$trim_item=rtrim($trim_item_arr2[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]],',');
				$trim_item_id=array_unique(explode(",",$trim_item));
				$jobno=$nameArray_job_po_row[csf('job_no')];
				$color_po_qty=0;
				foreach($trim_item_id as $item)
				{
				$color_po_qty+=$item_color_qty_arr[$jobno][$item][$color_id];
				}

				$color_trimreq=$trim_color_req_qty_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][$color_id];
				//$job_qty=$job_qty_arr[$nameArray_job_po_row[csf('job_no')]];

				$color_trim_req=($color_trimreq/$color_po_qty)*$costPerQty;


                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   echo $color_library[$result_itemdescription[csf('color_number_id')]];
			   ?>
                </td>
               <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                 <td title="Color Req Qty/Color PO Qty*Cost Per(<? echo $color_trimreq.'/'.$color_po_qty.'*'.$costPerQty;?>)" style="border:1px solid black; text-align:right">
               <? echo number_format($color_trim_req,4);
			   $item_desctiption_color_total += $color_trim_req ;
			   $item_req_desctiption_color_total += $color_trimreq ;
			   $item_po_desctiption_color_total += $color_po_qty ;
			    ?>
                </td>
                 <td align="center" style="border:1px solid black;">
               <? echo $unit_of_measurement[$trim_uom]; ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?
				echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$trims_item_arr[$result_item[csf('trim_group')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_itemdescription[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];

				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
				$remark= $booking_remarkArr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]];
               if($trims_remark!="") $trims_remark=$trims_remark;else $trims_remark=$remark;
                ?>
                </td>

                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?></p> </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td title="Color Req Qty/Color PO Qty*Cost Per(<? echo $item_req_desctiption_color_total.'/'.$item_po_desctiption_color_total.'*'.$costPerQty;?>)" style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				echo number_format(($item_req_desctiption_color_total/$item_po_desctiption_color_total)*$costPerQty,4);
				 ?></td>
                  <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				//echo number_format($item_desctiption_total,4);
				 ?></td>
                  <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				echo number_format($item_desctiption_total,4);
				 ?></td>

                <td style="border:1px solid black;text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="11"><strong>Total</strong></td>
				<? if($show_comment==1) {?>
				<td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group");
	   if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));

			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="16" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" ><strong>Color & size sensitive (<? echo "Job NO: ".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]] ;echo "&nbsp;&nbsp;Int Ref.:&nbsp;".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty.'['.$unit_of_measurement[$job_uom_arr[$nameArray_job_po_row[csf('job_no')]]].']';?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group </strong> </td>


                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td style="border:1px solid black"><strong>Article No.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td style="border:1px solid black; width:170px;"><strong>Gmts Color</strong> </td>
                <td style="border:1px solid black;"><strong>Gmts Size</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                 <td align="center" style="border:1px solid black"><strong>Cons.</strong></td>
                <td align="center" style="border:1px solid black"><strong>Cons.UOM</strong></td>

                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by trim_group ", "item_color", "color_number_id"  );

			 $nameArray_color=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.color_number_id as gmt_color, b.item_color as color_number_id,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount, min(c.color_order) as color_order, min(c.size_order) as size_order,c.article_number from wo_booking_dtls a, wo_trim_book_con_dtls b,wo_po_color_size_breakdown c  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and b.po_break_down_id=c.po_break_down_id and b.color_number_id=c.color_number_id and b.gmts_sizes=c.size_number_id and  c.id=b.color_size_table_id and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=4 and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.color_number_id, b.item_color,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,c.article_number order by c.article_number,color_order,size_order");



            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]." and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  status_active =1 and is_deleted=0 order by trim_group ");
            if(count($nameArray_color)>0){
            	$i++; ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <?
				$trim_uom=$trim_item_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf('trim_group')]];
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][4]);
				?>
                </td>
                <?
				$item_desctiption_total=$item_desctiption_color_size_total=$item_po_desctiption_color_size_total=$item_req_desctiption_color_size_total=0;
                $total_amount_as_per_gmts_color=0;
				foreach($nameArray_color as $result_color)
                {
					$costPerQty=$costPerArr[$nameArray_job_po_row[csf('job_no')]];
					$color_id=$result_color[csf('color_number_id')];
					$gmts_sizes=$result_color[csf('gmts_sizes')];

					$trim_item=rtrim($trim_item_arr2[$result_color[csf('pre_cost_fabric_cost_dtls_id')]],',');
					$trim_item_id=array_unique(explode(",",$trim_item));
					$jobno=$nameArray_job_po_row[csf('job_no')];
					$color_po_qty=0;
					foreach($trim_item_id as $item)
					{
					$color_po_qty+=$color_size_qty_arr[$jobno][$item][$color_id][$gmts_sizes];
					}

					$color_trimreq=$trim_color_size_req_qty_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][$color_id][$result_color[csf('gmts_sizes')]];
					$job_qty=$job_qty_arr[$nameArray_job_po_row[csf('job_no')]];
					$color_size_trim_req=($color_trimreq/$color_po_qty)*$costPerQty;

					//$color_size_trim_req=$trim_color_size_req_qty_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][$result_color[csf('gmt_color')]][$result_color[csf('gmts_sizes')]];

					?>

					<td style="border:1px solid black" ><? if($result_color[csf('description')]){echo $result_color[csf('description')];} ?> </td>
					<td style="border:1px solid black" ><? if($result_color[csf('brand_supplier')]){echo $result_color[csf('brand_supplier')]; }?> </td>
                    <td style="border:1px solid black">
					<?
					if($result_color[csf('article_number')]!="no article"){
						echo $result_color[csf('article_number')];
					}else{
						echo "-";
					}
					?>
                    </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('gmt_color')]];?> </td>
                    <td style="border:1px solid black; text-align:left">
					<? echo $size_library[$result_color[csf('gmts_sizes')]]; ?>
					</td>
					<td style="border:1px solid black; text-align:left">
					<? echo $result_color[csf('item_size')]; ?>
					</td>
                    <td style="border:1px solid black; text-align:left">
				   <?
				   $calUom=$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][2];
			       $calQty=explode("_",$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				   if($calUom && end($calQty)){
					   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
				   }
                   ?>
                    </td>
                    <td title="Color Size Req Qty/Color Size Qty*Cost Per(<? echo $color_trimreq.'/'.$color_po_qty.'*'.$costPerQty;?>)" style="border:1px solid black; text-align:right">
				   <? echo number_format($color_size_trim_req,4);
                   $item_desctiption_color_size_total += $color_size_trim_req ;
				    $item_po_desctiption_color_size_total += $color_po_qty ;
					 $item_req_desctiption_color_size_total += $color_trimreq ;
                    ?>
                    </td>
                     <td align="center" style="border:1px solid black;">
                   <? echo $unit_of_measurement[$trim_uom]; ?>
                    </td>

					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('cons')],4);
					$item_desctiption_total += $result_color[csf('cons')] ;
					$trims_item_arr[$result_item[csf('trim_group')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_color[csf('cons')];
					$trims_item_arr[$result_item[csf('trim_group')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_color[csf('amount')];
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]];  ?></td>
					<? if($show_comment==1) {?>
					<td style="border:1px solid black; text-align:right">
					<?

					echo number_format($result_color[csf('rate')],4);
					?>
                     </td>

					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,4);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					$trims_remark=$trims_remark_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
					$remark= $booking_remarkArr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]];
              		 if($trims_remark!="") $trims_remark=$trims_remark;else $trims_remark=$remark;
					?>
					</td>

                    <td style="border:1px solid black;text-align:center"><? echo $trims_remark; ?> </td>
                    <? } ?>
				</tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="10"><strong> Item Total</strong></td>
                 <td title="Color Size Req Qty/Color Size Qty*Cost Per(<? echo $item_req_desctiption_color_size_total.'/'.$item_po_desctiption_color_size_total.'*'.$costPerQty;?>)" style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				echo number_format(($item_req_desctiption_color_size_total/$item_po_desctiption_color_size_total)*$costPerQty,4);
				 ?></td>
                  <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				//echo number_format($item_desctiption_total,4);
				 ?></td>

                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				echo number_format($item_desctiption_total,4);  ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
        }

            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="<? echo ($show_comment==1) ? 15 : 13; ?>"><strong>Total</strong></td>
				<? if($show_comment==1) {?>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp;  </td>
                <? } else{ ?>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                <? } ?>
            </tr>
        </table>
        <br/>
       <?
		}
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->

         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=0 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				//echo $poid.', ';
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}

			//$po_quantity[$result_job[csf('id')]];
        ?>
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="16" align="">
                    <table width="100%" style="table-layout: fixed;">
                    <tr>
                    <td width="60%"><strong>NO sensitive  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty.'['.$unit_of_measurement[$job_uom_arr[$nameArray_job_po_row[csf('job_no')]]].']'; ?></strong></td>
                    <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                    </tr>
                    </table>
                 </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td align="center" style="border:1px solid black"><strong>Avg.Cons.</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cons.UOM</strong></td>
                <td align="center" style="border:1px solid black"><strong> Qnty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                 <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                 <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color");

	$trim_uom=$trim_item_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf('trim_group')]];
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">

                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);

				?>
                </td>
                <?
                $color_tatal=0;
                $total_amount_as_per_gmts_color=$item_req_desctiption_color_total=$item_po_desctiption_color_total=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

				$costPerQty=$costPerArr[$nameArray_job_po_row[csf('job_no')]];

				$trim_item=rtrim($trim_item_arr2[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]],',');
				$trim_item_id=array_unique(explode(",",$trim_item));
				$jobno=$nameArray_job_po_row[csf('job_no')];
				$color_po_qty=0;
				foreach($trim_item_id as $item)
				{
				$color_po_qty+=$job_qty_arr[$jobno][$item];
				}

				//$color_id=$result_itemdescription[csf('color_number_id')];
				$trim_trimreq=$trim_item_req_qty_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]];
				//$job_qty=$job_qty_arr[$nameArray_job_po_row[csf('job_no')]];
				$trim_color_req=($trim_trimreq/$color_po_qty)*$costPerQty;

				//$trim_color_req=$trim_color_req_qty_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][$result_itemdescription[csf('item_color')]];
                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <td title="Item Req Qty/Job Item Qty*Cost Per(<? echo $trim_trimreq.'/'.$color_po_qty.'*'.$costPerQty;?>)" style="border:1px solid black; text-align:right">
				   <? echo number_format($trim_color_req,4);
                   $item_desctiption_color_total += $trim_color_req ;
				    $item_req_desctiption_color_total += $trim_trimreq ;
					 $item_po_desctiption_color_total += $color_po_qty ;
                    ?>
                    </td>
                     <td align="center" style="border:1px solid black;">
                   <? echo $unit_of_measurement[$trim_uom]; ?>
                    </td>

                <?
				if($db_type==0)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
						}
						if($db_type==2)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons,sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
						}

                foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right">
                <?
                if($result_color_size_qnty[csf('cons')]!= "")
                {

               echo number_format($result_color_size_qnty[csf('cons')],4);
                $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                $color_tatal+=$result_color_size_qnty[csf('cons')];

				$trims_item_arr[$result_item[csf('trim_group')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_color_size_qnty[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_color_size_qnty[csf('amount')];//*$result_itemdescription[csf('rate')];
                }
                else echo "";
                ?>
                </td>
                <?
                }
                ?>

                <td style="border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
					<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_color_size_qnty[csf('amount')];// $item_desctiption_total*  $result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,4);//amount
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$remark= $booking_remarkArr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]];
              	if($trims_remark!="") $trims_remark=$trims_remark;else $trims_remark=$remark;
                ?>
                </td>

                 <td style="border:1px solid black; text-align:right"><? echo $trims_remark; ?> </td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td  title="Item Req Qty/Job Item Qty*Cost Per(<? echo $item_req_desctiption_color_total.'/'.$item_po_desctiption_color_total.'*'.$costPerQty;?>)" style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				echo number_format((($item_req_desctiption_color_total/$item_po_desctiption_color_total)*$costPerQty),4);
				 ?></td>
                  <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				//echo number_format($item_desctiption_total,4);
				 ?></td>

                <td style="border:1px solid black;  text-align:right; font-weight:bold;">
                <?
                if($color_tatal !='')
                {

						 echo number_format($color_tatal,4);
                }
                ?>
                </td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
					<? if($show_comment==1) {?>
					<td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <?
		}
		}
		?>
        </td>
         </tr>
     </table>
     <br>
      <table border="1" align="left" class="rpt_table"  cellpadding="0" width="50%" cellspacing="0" rules="all" >

            <tr>
              <td style="border:1px solid black" align="center"><strong>Sl</strong> </td>
                <td style="border:1px solid black" align="center"><strong>Item Group</strong> </td>
                <td style="border:1px solid black" align="center"><strong>Order Uom</strong> </td>
                <td style="border:1px solid black" align="center"><strong>Total Qnty</strong> </td>
                <td style="border:1px solid black" align="center"><strong>Total Amount</strong> </td>
             </tr>
             <?
			// print_r($trims_item_arr);
			 $t=1;$total_item_cons=$total_item_amount=0;
             foreach($trims_item_arr as $trim_id=>$trim_data )
			 {
				  	foreach($trim_data as $uom_id=>$val )
			 		{
			 ?>
             <tr>
                <td style="border:1px solid black"> <? echo $t; ?> </td>
                    <td align="center" style="border:1px solid black"> <? echo $trim_group_library[$trim_id];?> </td>
                    <td align="center" style="border:1px solid black"> <? echo $unit_of_measurement[$uom_id];?> </td>
                    <td align="right" style="border:1px solid black"> <? echo number_format($val['cons'],4);?> </td>
                    <td align="right" style="border:1px solid black"> <? echo number_format($val['amount'],2);?> </td>
                </tr>
                <?
			 		$t++;
					$total_item_cons+=$val['cons'];
					$total_item_amount+=$val['amount'];
					}
				}
				?>
               <tr>
               <td colspan="4" align="right"> <b>Total</b> </td>
               <td align="right"><b> <? echo number_format($total_item_amount,2);?></b> </td>
               </tr>

      </table>

        <!--==============================================NO NENSITIBITY END=========================================  -->

       <?
	   //$trims_item_arr[$result_item[csf('trim_group')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_color_size_qnty[csf('cons')];
	//	$trims_item_arr[$result_item[csf('trim_group')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>
       <br/>
       <table width="100%" style="margin-top:1px">
           <tr>
           <td>
           <table width="100%" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
                <tr style="border:1px solid black;">
                    <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                    <td width="70%" style="border:1px solid black; text-align:left"><? echo number_format($booking_grand_total,2);?></td>
                </tr>
                <tr style="border:1px solid black;">
                    <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                    <td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
                </tr>
           </table>
           </td>
           </tr>
       </table>
         <br/>
            <table width="100%">
                <tr>
                <td width="49%">
                <?
                    echo get_spacial_instruction($txt_booking_no);
                ?>
                </td>
                <td width="2%"></td>
                <td width="49%" valign="top">
                    <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">

                        <tr style="border:1px solid black;">
                            <td colspan="3" style="border:1px solid black;">Approval Status</td>
                            </tr>
                            <tr style="border:1px solid black;">
                            <td width="3%" style="border:1px solid black;">Sl</td><td width="50%" style="border:1px solid black;">Name</td><td width="27%" style="border:1px solid black;">Approval Date</td><td width="20%" style="border:1px solid black;">Approval No</td>
                            </tr>


                        <?
                        $i;
                        foreach($approved_array as $row){
                        ?>
                        <tr style="border:1px solid black;">
                            <td width="3%" style="border:1px solid black;"><? echo $i;?></td><td width="50%" style="border:1px solid black;"><? echo $row[csf('user_full_name')];?></td><td width="27%" style="border:1px solid black;"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); ;?></td><td width="20%" style="border:1px solid black;"><? echo $row[csf('approved_no')];?></td>
                            </tr>
                            <?
                            $i++;
                        }
                            ?>

                    </table>
            </td>
            </tr>
        </table>
		 <br>
	  <br>
        <?
        //------------------------------ Query for TNA start-----------------------------------
			$sql_job_color=sql_select( "select c.color_type_id,b.id as po_id  from wo_po_details_master a, wo_po_break_down b,wo_pre_cost_fabric_cost_dtls c where a.job_no=b.job_no_mst and  a.job_no=c.job_no and  b.job_no_mst=c.job_no  and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.") ");

			foreach ($sql_job_color as $row)
			{
				$po_color_type_arr[$row[csf('po_id')]]=$row[csf('color_type')];

			}


				$po_num_arr=return_library_array("select id,po_number from wo_po_break_down where id in($po_idss)",'id','po_number');
				$tna_start_sql=sql_select( "select id,po_number_id,

								(case when task_number=73 then task_start_date else null end) as finishing_start_date,
								(case when task_number=73 then task_finish_date else null end) as finishing_end_date,
								(case when task_number=179 then task_start_date else null end) as aop_finishing_start_date,
								(case when task_number=179 then task_finish_date else null end) as aop_finishing_end_date,
								(case when task_number=180 then task_start_date else null end) as yd_finishing_start_date,
								(case when task_number=180 then task_finish_date else null end) as yd_finishing_end_date
								from tna_process_mst
								where status_active=1 and po_number_id in($po_idss)");

				$tna_fab_start=$tna_knit_start=$tna_dyeing_start=$tna_fin_start=$tna_cut_start=$tna_sewin_start=$tna_exfact_start="";
				$tna_date_task_arr=array();
				foreach($tna_start_sql as $row)
				{

					if($row[csf("finishing_start_date")]!="" && $row[csf("finishing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_start_date']=$row[csf("finishing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_end_date']=$row[csf("finishing_end_date")];
					}
					if($row[csf("aop_finishing_start_date")]!="" && $row[csf("aop_finishing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['aop_finishing_start_date']=$row[csf("aop_finishing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['aop_finishing_end_date']=$row[csf("aop_finishing_end_date")];
					}
					if($row[csf("yd_finishing_start_date")]!="" && $row[csf("yd_finishing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['yd_finishing_start_date']=$row[csf("yd_finishing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['yd_finishing_end_date']=$row[csf("yd_finishing_end_date")];
					}

				}

	//------------------------------ Query for TNA end-----------------------------------
		?>
        <fieldset id="div_size_color_matrix" style="max-width:700;">
        <legend>TNA Information</legend>
        <!--<span style="font-size:180; font-weight:bold;"></span>-->
        <table width="100%" style="border:1px solid black;font-size:12px" border="1" cellpadding="2" cellspacing="0" rules="all">
            <tr>
            	<td rowspan="2" align="center" width="100" valign="top">SL</td>
            	<td width="280" rowspan="2"  align="center" valign="top"><b>Order No</b></td>

                <td colspan="2" align="center" valign="top"><b>Finishing Fabric In Solid</b></td>
                <td colspan="2" align="center" valign="top"><b>Finishing Fabric In AOP </b></td>
                <td colspan="2" align="center" valign="top"><b>Finishing Fabric In YD </b></td>

            </tr>
            <tr>

                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>


            </tr>
            <?
			$i=1;
			foreach($tna_date_task_arr as $order_id=>$row)
			{
				?>
                <tr>
                	<td width="100"><? echo $i; ?></td>
                    <td><? echo $po_num_arr[$order_id]; ?></td>

                    <td align="center"><? echo change_date_format($row['finishing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['aop_finishing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['aop_finishing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['yd_finishing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['yd_finishing_end_date']); ?></td>

                </tr>
                <?
				$i++;
			}
			?>

        </table>
        </fieldset>



     <!--class="footer_signature"-->
    <div  style="margin-top:-50px;">
         <?
          echo signature_table(132, $cbo_company_name, "1333px",1);
		 ?>
   </div>
      <div id="page_break_div">
   	 </div>
    <div>

		<?
        	//echo signature_table(2, $cbo_company_name, "1330px");
			echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>

	<?
	    $html = ob_get_contents();
		ob_clean();
		list($is_mail_send,$mail)=explode('___',$mail_send_data);
		if($is_mail_send==1){
			require_once('../../../mailer/class.phpmailer.php');
			require_once('../../../auto_mail/setting/mail_setting.php');
			$mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
				
			$mailToArr=array();
			$mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
			//echo $mailSql;die;
			$mailSqlRes=sql_select($mailSql);
			foreach($mailSqlRes as $rows){
				if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
			}
			
			
			$mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=97 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
			//echo $mailSql;die;
			$mailSqlRes=sql_select($mailSql);
			foreach($mailSqlRes as $rows){
				if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
			}
			if($mail!=''){$mailToArr[]=$mail;}
			
			$to=implode(',',$mailToArr);
			$subject="Trims Booking Multy Job";
			$header=mailHeader();
			echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
			
		}
		else{
			echo $html;
		}
		exit();
}

if($action=="show_trim_booking_report8") //17-12-19
{

	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	$user_name_arr=return_library_array( "select id,user_name from   user_passwd",'id','user_name');

	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	//$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");

	$sqlitem=sql_select("select id,order_uom,trim_uom  from lib_item_group");
	foreach($sqlitem as $row)
	{
		$order_uom_arr[$row[csf('id')]]=$row[csf('order_uom')];
		$cons_uom_arr[$row[csf('id')]]=$row[csf('trim_uom')];
	}
	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;
	//$revised_no_data=sql_select("select a.revised_no  from wo_booking_mst a where  a.booking_no=$txt_booking_no and  a.status_active =1 and a.is_deleted=0");
	//list($revised_no_row)=$revised_no_data;
		$booking_grand_total=0;
		$currency_id="";


		$buyer_string=array();
		$style_owner=array();
		$job_no=array();
		$style_ref=array();
		$all_dealing_marcent=array();
		$season=array();
		$order_repeat_no=array();
		$po_id_arr=array();

		$nameArray_buyer=sql_select( "select a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, b.po_break_down_id from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
        foreach ($nameArray_buyer as $result_buy){
			$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
			$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
			//$season[$result_buy[csf('job_no')]]=$season_arr[$result_buy[csf('season_matrix')]];
			$season_matrix=$result_buy[csf('season_matrix')];
			$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
			if($season_matrix!=0 && $season_buyer_wise==0 )
			{
				$season_matrix_con=$season_matrix;
			}
			else if($season_buyer_wise!=0 && $season_matrix==0)
			{
				$season_matrix_con=$season_buyer_wise;
			}
			$seasons_name.=$season_arr[$season_matrix_con].',';
			$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
			$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

			$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];
		}
		$style_sting=implode(",",array_unique($style_ref));
		$job_no=implode(",",$job_no);
		$seasons_names=rtrim($seasons_name,',');

		$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));
		$poid_arr=array_unique($po_id_arr);
		//$txt_order_no_id=array_unique($po_id_arr);
		$order_rept_no=rtrim($order_rept_no,',');
		$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));

		$po_no=array();
		$file_no=array();
		$ref_no=array();
		$po_quantity=array();
		$sc_lc_arr=array();
		$pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';
		$nameArray_job=sql_select( "select max(a.update_date) as update_date,b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, sum(b.po_quantity) as po_quantity, b.sc_lc, sum(b.no_of_carton) as no_of_carton  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, b.sc_lc ");
        foreach ($nameArray_job as $result_job){
			$po_no[$result_job[csf('job_no_mst')]][$result_job[csf('id')]]=$result_job[csf('po_number')];
			$sc_lc_arr[$result_job[csf('job_no_mst')]][$result_job[csf('sc_lc')]]=$result_job[csf('sc_lc')];
			$po_shipdate_arr[$result_job[csf('job_no_mst')]].=change_date_format($result_job[csf('pub_shipment_date')]).',';
			$file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
			$ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
			$po_quantity[$result_job[csf('id')]]=$result_job[csf('po_quantity')];
		//	$tot_po_quantity+=$result_job[csf('po_quantity')];
			$job_ref_no[$result_job[csf('job_no_mst')]].=$result_job[csf('grouping')].',';
			$job_file_no[$result_job[csf('job_no_mst')]].=$result_job[csf('file_no')].',';
			$po_no_arr[$result_job[csf('job_no_mst')]]['po_id'].=$result_job[csf('id')].',';
			$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
			$int_ref_no.=$result_job[csf('grouping')].',';
			if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];
			$revised_update_date=explode(" ",$result_job[csf('update_date')]);
			$revised_date=strtotime($revised_update_date[0]);
			$totCartonQty+=$result_job[csf('no_of_carton')];
		}
		$sql_job=sql_select( "select b.job_no_mst,b.id as po_id, b.po_quantity as po_quantity, c.order_quantity,c.color_number_id,c.size_number_id  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and b.id=c.po_break_down_id and a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0   and  c.status_active =1 and c.is_deleted=0  and b.id in(".$po_idss.") ");
		foreach ($sql_job as $row)
		{
			$job_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('po_id')]]+=$row[csf('order_quantity')];
			$color_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('color_number_id')]]+=$row[csf('order_quantity')];
			$color_item_po_qty_arr[$row[csf('job_no_mst')]][$color_library[$row[csf('color_number_id')]]]+=$row[csf('order_quantity')];
			$color_size_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]+=$row[csf('order_quantity')];
			$size_po_qty_arr[$row[csf('job_no_mst')]][$size_library[$row[csf('size_number_id')]]]+=$row[csf('order_quantity')];
			$tot_po_quantity+=$row[csf('order_quantity')];
			
		}

        $nameArray=sql_select( "select a.booking_no,a.inserted_by,a.delivery_address, a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.source, a.remarks, a.revised_no,a.update_date from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
		foreach( $nameArray as $row)
		{
			$varcode_booking_no=$row[csf('booking_no')];
			$booking_date=$row[csf('booking_date')];
			$delivery_date=$row[csf('delivery_date')];
			$pay_mode_id=$row[csf('pay_mode')];
			$supplier_id=$row[csf('supplier_id')];
			$currency_id=$row[csf('currency_id')];
			$buyer_id=$row[csf('buyer_id')];
			$exchange_rate=$row[csf('exchange_rate')];
			$attention=$row[csf('attention')];
			$remarks=$row[csf('remarks')];
			$deli_address=trim($row[csf('delivery_address')]);
			
			$revised_no=$row[csf('revised_no')];
			$mst_update_date=explode(" ",$row[csf('update_date')]);
			$mst_revised_date=strtotime($mst_update_date[0]);

			$source_id=$row[csf('source')];
			$inserted_by=$row[csf('inserted_by')];
		}
		//echo $inserted_by.'DD';
		if($revised_date!="" && $mst_revised_date!="")
		{
			$max_revised_date_time=max($revised_date,$mst_revised_date);
			$max_revised_date=date('d-m-Y',$max_revised_date_time);
		}
		else if($revised_date!="" && $mst_revised_date=="")
		{
			//$max_revised_date=$revised_date;
			$max_revised_date=date('d-m-Y',$revised_date);
		}
		else if($mst_revised_date!="" && $revised_date=="")
		{
			//$max_revised_date=$mst_revised_date;
			$max_revised_date=date('d-m-Y',$mst_revised_date);
		}
		// echo   $deli_address.'DDDDDDDD'.'DD';
	
	ob_start();
	
	?>
<html>
<head>
  <style type="text/css" media="print">
   table { page-break-inside:auto }

</style>
</head>



	<div style="width:1333px" align="center">

   <table width="1333px" cellpadding="0" cellspacing="0" style="border:0px solid black" >
   <thead>
       <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
           <tr>
               <td width="20px">
                    <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
                    <tr>
                    <td width="50" >
					   <? if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                                <img  src='../../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />

                       <?
                           }
                           else
                           {
                       ?>
                                <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                       <?	}
                       }
                       else
                       { ?>
                         <img  src='../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                      <? }
                       ?>
                   </td>
                    <td width="40px" align="center">
                    &nbsp;  &nbsp;  &nbsp;
                    </td>
                    <td width="30px"   align="center">

                   <b style="font-size:25px;"> <?
                    echo $company_library[$cbo_company_name]; ?>
                    </b>
                    <br>
                    <label>
                    	<?
                            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                            foreach ($nameArray as $result){
                            ?>
                              <?  if($result[csf('plot_no')]!='') echo $result[csf('plot_no')]; else echo '';?> &nbsp;
                                <? echo $result[csf('level_no')];?> &nbsp;
                                 <? echo $result[csf('road_no')]; ?>  &nbsp;
                                <? echo $result[csf('block_no')];?>  &nbsp;
                                <? echo $result[csf('city')];?>  &nbsp;
                                <? echo $result[csf('zip_code')]; ?>  &nbsp;
                                 <?php echo $result[csf('province')]; ?>  &nbsp;
                                <? echo $country_arr[$result[csf('country_id')]]; ?> &nbsp;<br/>
                                <? echo $result[csf('email')];?>  &nbsp;
                                <? echo $result[csf('website')];
								if($result[csf('plot_no')]!='')
								{
									$plot_no=$result[csf('plot_no')];
								}
								if($result[csf('level_no')]!='')
								{
									$level_no=$result[csf('level_no')];
								}
								if($result[csf('road_no')]!='')
								{
									$road_no=$result[csf('road_no')];
								}
								if($result[csf('block_no')]!='')
								{
									$block_no=$result[csf('block_no')];
								}
								if($result[csf('city')]!='')
								{
									$city=$result[csf('city')];
								}
								$company_address[$result[csf('id')]]=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
                            }
						?>
                        </label>
                        <br/>
                        <b style="font-size:20px;">
                         <?php echo $report_title; ?>
                        </b>
                    </td>
                     <td width="10px" align="center" style="font-size:20px;">
                      <table width="80%" align="right" cellpadding="0" cellspacing="0" style="border:0px solid black">
                      	<tr>
                            <td width="80">  Booking No:&nbsp; <?php echo $varcode_booking_no; ?>  </td>
                        </tr>
                        <tr>
                            <td>  Booking Date:&nbsp; <?php echo change_date_format($booking_date); ?>  </td>
                        </tr>
                        <?
                        if($revised_no>0)
						{
						?>
                        <tr>
                            <td>  Revised No:&nbsp; <?php echo $revised_no . '&nbsp(Date:' . change_date_format($max_revised_date) . ')'; ?>  </td>
                        </tr>
                        <?
						}
                        if(str_replace("'","",$id_approved_id) ==1)
						 {
						 ?>
                          <tr>
                             <td>Approved Status :&nbsp;  <? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </td>
                         </tr>
                         <?
						}
						 ?>
                      </table>

                     </td>
                   </tr>
                   </table>
               </td>
            </tr>
       </table>

		   <table width="100%" style="border:0px solid black;table-layout: fixed;">
				<tr>
					<td colspan="6" valign="top"></td>
				</tr>
				<tr>
					<td width="100" style="font-size:18px"><span><b>To, </b></span>  </td>
					<td width="110" colspan="5" style="font-size:18px">&nbsp;<span></span></td>
				</tr>
				<tr>

					<td width="210" colspan="2" style="font-size:18px">&nbsp; <b>
					<?
					if($pay_mode_id==5 || $pay_mode_id==3){
						echo $company_library[$supplier_id];
					}
					else{
						echo $supplier_name_arr[$supplier_id];
					}
					?></b>
					</td>
                    <td  width="100" style="font-size:12px"><b>Buyer.</b></td>
					<td  width="110" >:&nbsp;<? echo $buyer_name_arr[$buyer_id]; ?></td>
                    <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
					<td width="110">:&nbsp;<?  echo change_date_format($delivery_date); ?></td>
				</tr>
				<tr>

					<td width="110" colspan="2" rowspan="2" style="font-size:18px">Address :&nbsp;
					<?
					if($pay_mode_id==5 || $pay_mode_id==3){
						$address=$company_address[$supplier_id];
					}
					else{
						$address=$supplier_address_arr[$supplier_id];
					}
					echo $address;
					?></b>
					</td>
					<td width="100" style="font-size:12px"><b>PO Qty.</b>   </td>
					<td width="110">:&nbsp;<? echo $tot_po_quantity; ?></td>
                     <td style="font-size:12px" ><b>Delivery To </b>   </td>
					<td style="">:&nbsp;
					<?
						 echo $deli_address;
					?>
					</td>

				</tr>
                <tr>

                    <td width="100" style="font-size:12px"><b>Season</b> </td>
					<td width="110">:&nbsp;<? echo $seasons_names; ?></td>

                    <td width="100" style="font-size:12px"><b>Currency</b></td>
					<td width="110">:&nbsp;<?  echo $currency[$currency_id]; ?></td>

                </tr>
                <tr>
                    <td style="font-size:12px" ><b>Attention </b>   </td>
					<td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;<?=$attention; ?></td>
                    <td width="100" style="font-size:12px"><b>Order Repeat </b> </td>
					<td width="110">:&nbsp;<?=$order_rept_no; ?></td>
                    <td  style="font-size:12px"><b>Pay mode</b></td>
                	<td>:&nbsp;<?=$pay_mode[$pay_mode_id];?></td>
                </tr>

				 <tr>
                    <td style="font-size:12px"><b>Source</b></td>
                	<td>:&nbsp;<? echo $source[$source_id];?></td>
                    <td style="font-size:12px"><b>Dealing Merchant</b></td>
					<td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;<?=implode(",",array_unique($all_dealing_marcent)); ?></td>
                    <td style="font-size:12px"><b>Carton Qty.</b></td>
                	<td>:&nbsp;<?=$totCartonQty; ?></td>
				</tr>
				<tr>
					<td width="100" style="font-size:12px"><b>Remarks</b>  </td>
					<td width="110" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" colspan="5">:&nbsp;<? echo $remarks; ?></td>

				</tr>
				</table>
    		</thead>
            <tbody>
            <!-- <div id="page_break_div">

            </div>-->


          <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?

		$precost_arr=array();
		$trims_qtyPerUnit_arr=array();

		$precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark,a.description, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0");

        $calUom="";
		foreach($precost_sql as $precost_row){


			$calculatorstring=explode("_",$precost_row[csf('calculatorstring')]);
			$trims_cons_gmts_per_arr[$precost_row[csf('trim_group')]][$precost_row[csf('id')]]['gmt_per']=$calculatorstring[0];
			$trims_cons_gmts_per_arr[$precost_row[csf('trim_group')]][$precost_row[csf('id')]]['cone_len']=$calculatorstring[2];

			if($precost_row[csf('cal_parameter')]==1){
			   $calUom="Mtr";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==2){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==3){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==4){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==5){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==6){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==7){
			   $calUom="Pcs";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==8){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else{
				$calUom=0;
			}
			 $trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
		}
		$booking_country_arr=array();
		$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,sensitivity,country_id_string from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0");
		foreach($nameArray_booking_country as $nameArray_booking_country_row){
			$country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
			$tocu=count($country_id_string);
			for($cu=0;$cu<$tocu;$cu++){
				$booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
			}
		}

		$nameArray_job_po=sql_select( "select job_no from wo_booking_dtls  where booking_no='$txt_booking_no' and status_active =1 and is_deleted=0 group by job_no order by job_no ");
		foreach($nameArray_job_po as $nameArray_job_po_row){
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$nameArray_job_po_row[csf('job_no')]."'   and sensitivity=1 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
	    if(count($nameArray_item)>0){
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];//$po_quantity[$poid];
			}
			$shipdate=rtrim($po_shipdate_arr[$nameArray_job_po_row[csf('job_no')]],',');
			$shipdates=implode(",",array_unique(explode(",",$shipdate)));
        ?>
        &nbsp;
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >

            <tr>
                <td colspan="13" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" align="left"><strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; if($ref_nos!='' ) echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;else " ";if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;  Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" title="<?=implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?>" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?>&nbsp;&nbsp; SC/LC: <? echo implode(",",$sc_lc_arr[$nameArray_job_po_row[csf('job_no')]]); ?></td>

                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Garments Order Qty(Pcs)</strong></td>
                <td align="center" style="border:1px solid black"><strong>Cons Per Garment</strong></td>
                <td align="center" style="border:1px solid black"><strong>Cone Length</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? }?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item){
			$i++;
            $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.color_number_id as item_color,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.color_number_id order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center"  style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription){
                ?>
                <td style="border:1px solid black"><?  if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:right">
               <?
			   	$color_po_qty=$color_po_qty_arr[$nameArray_job_po_row[csf('job_no')]][$result_itemdescription[csf('item_color')]];
			  	 echo number_format($color_po_qty,0);
			   ?>
                </td>
                 <td style="border:1px solid black; text-align:right">
               <? echo number_format($trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['gmt_per'],0); ?>
                </td>
                 <td style="border:1px solid black; text-align:right">
               <?
			 	 echo  number_format($trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['cone_len'],0);
			    ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?


				echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                  <? if($show_comment==1) {?>
                 <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="6"><strong> Item Total</strong></td>

                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                  <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="11"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->


        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=2 and  status_active =1 and  is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                 <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Size Sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; echo "&nbsp;&nbsp;Int Ref.:".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";echo "&nbsp;&nbsp; Po Qty..:".$po_no_qty; ?></strong></td>
                <td width="40%" title="<?=implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?>" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;margin-left:210px; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?>&nbsp;&nbsp; SC/LC: <? echo implode(",",$sc_lc_arr[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Article No</strong></td>
                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>GarmentsOrder qty</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cons Per Garment</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cone Length</strong></td>

                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
			$i++;
			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,b.article_number,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size,b.article_number order by bid");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][2]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

				$gmts_order_qty=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['gmt_per'];
				$cone_len=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['cone_len'];
				$size_po_qty=$size_po_qty_arr[$nameArray_job_po_row[csf('job_no')]][$result_itemdescription[csf('item_size')]];
                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black">
				<?
				if($result_itemdescription[csf('article_number')]!="no article"){
					echo $result_itemdescription[csf('article_number')];

				}else{
					echo "-";
				}
				?>
                </td>
                <td style="border:1px solid black; text-align:left">
              <? echo $result_itemdescription[csf('item_size')];?>
                </td>
                 <td style="border:1px solid black; text-align:right">
              <? 	echo number_format($size_po_qty,0);?>
                </td>
                 <td style="border:1px solid black; text-align:right">
              <? echo number_format($gmts_order_qty,0);?>
                </td>
                <td style="border:1px solid black; text-align:right">
               <?
			 //  $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   //$calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   //echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   echo number_format($cone_len,0);
			   ?>
                </td>


                <td style="border:1px solid black; text-align:right">
				<?

					  echo number_format($result_itemdescription[csf('cons')],4);

                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">

                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="7"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold"><?
			/*	if($uom_id==1 || $uom_id==52 || $uom_id==54 || $uom_id==50 || $uom_id==51 || $uom_id==53 || $uom_id==54 || $uom_id==55 || $uom_id==56 || $uom_id==57 || $uom_id==31 || $uom_id==59 || $uom_id==62 || $uom_id==65 || $uom_id==66 || $uom_id==67 || $uom_id==74 || $uom_id==78 || $uom_id==80 )
					{
						 echo number_format($item_desctiption_total,0);
					}
					else
					{
						echo number_format($item_desctiption_total,4);
					}*/
					echo number_format($item_desctiption_total,4);
				 ?></td>
                 <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="12"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=3 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>
        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" title="<?=implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?>" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?>&nbsp;&nbsp; SC/LC: <? echo implode(",",$sc_lc_arr[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Garments Order Qty(Pcs)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cons Per Garment</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cone Length</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by trim_group ", "item_color", "color_number_id"  );

			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,b.color_number_id order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
				$gmts_order_qty=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['gmt_per'];
				$cone_len=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['cone_len'];
				$color_po_qty=$color_po_qty_arr[$nameArray_job_po_row[csf('job_no')]][$result_itemdescription[csf('color_number_id')]];

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   echo $color_library[$result_itemdescription[csf('color_number_id')]];
			   ?>
                </td>
               <td style="border:1px solid black; text-align:right">
               <?
			   echo number_format($color_po_qty,0);
			   ?>
               </td>
                <td style="border:1px solid black; text-align:right">
               <?
			   echo number_format($gmts_order_qty,0);
			   ?>
               </td>
               <td style="border:1px solid black; text-align:right">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				  // echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   echo number_format($cone_len,0);
			   ?>
                </td>

                <td style="border:1px solid black; text-align:right">
				<?

				echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?></p> </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="7"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

				echo number_format($item_desctiption_total,4);
				 ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="12"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group");
	   if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));

			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="17" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" ><strong>Color & size sensitive (<? echo "Job NO: ".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]] ;echo "&nbsp;&nbsp;Int Ref.:&nbsp;".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" title="<?=implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?>" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?>&nbsp;&nbsp; SC/LC: <? echo implode(",",$sc_lc_arr[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group </strong> </td>


                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td style="border:1px solid black"><strong>Article No.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td style="border:1px solid black; width:170px;"><strong>Gmts Color</strong> </td>
                <td style="border:1px solid black;"><strong>Gmts Size</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Garments Order Qty(Pcs)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cons Per Garment</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cone Length</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by trim_group ", "item_color", "color_number_id"  );

			 $nameArray_color=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.color_number_id as gmt_color, b.item_color as color_number_id,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount, min(c.color_order) as color_order, min(c.size_order) as size_order,c.article_number from wo_booking_dtls a, wo_trim_book_con_dtls b,wo_po_color_size_breakdown c  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and b.po_break_down_id=c.po_break_down_id and b.color_number_id=c.color_number_id and b.gmts_sizes=c.size_number_id and  c.id=b.color_size_table_id and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=4 and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.color_number_id, b.item_color,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,c.article_number order by c.article_number,color_order,size_order");



            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]." and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  status_active =1 and is_deleted=0 order by trim_group ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][4]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
				foreach($nameArray_color as $result_color)
                {
				$gmts_order_qty=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_color[csf('pre_cost_fabric_cost_dtls_id')]]['gmt_per'];
				$cone_len=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_color[csf('pre_cost_fabric_cost_dtls_id')]]['cone_len'];
				$color_po_qty=$color_size_po_qty_arr[$nameArray_job_po_row[csf('job_no')]][$result_color[csf('gmt_color')]][$result_color[csf('gmts_sizes')]];
					?>

					<td style="border:1px solid black" ><? if($result_color[csf('description')]){echo $result_color[csf('description')];} ?> </td>
					<td style="border:1px solid black" ><? if($result_color[csf('brand_supplier')]){echo $result_color[csf('brand_supplier')]; }?> </td>
                    <td style="border:1px solid black">
					<?
					if($result_color[csf('article_number')]!="no article"){
						echo $result_color[csf('article_number')];
					}else{
						echo "-";
					}
					?>
                    </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('gmt_color')]];?> </td>
                    <td style="border:1px solid black; text-align:left">
					<? echo $size_library[$result_color[csf('gmts_sizes')]]; ?>
					</td>
					<td style="border:1px solid black; text-align:left">
					<? echo $result_color[csf('item_size')]; ?>
					</td>
                    <td style="border:1px solid black; text-align:right">
					<?  echo number_format($color_po_qty,0); ?>
					</td>
                    <td style="border:1px solid black; text-align:right">
					<?  echo number_format($gmts_order_qty,0); ?>
					</td>
                    <td style="border:1px solid black; text-align:right">
				   <?
				   $calUom=$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][2];
			       $calQty=explode("_",$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				   if($calUom && end($calQty)){
					   //echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
				   }
				   echo number_format($cone_len,0);
                   ?>
                    </td>

					<td style="border:1px solid black; text-align:right">
					<?

					echo number_format($result_color[csf('cons')],4);
					$item_desctiption_total += $result_color[csf('cons')] ;
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]];  ?></td>
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('rate')],4);
					?>
                     </td>
					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,4);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					$trims_remark=$trims_remark_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
					?>
					</td>
                     <? if($show_comment==1) {?>
                    <td style="border:1px solid black;text-align:center"><? echo $trims_remark; ?> </td>
                    <? } ?>
				</tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="12"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

				echo number_format($item_desctiption_total,4);  ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }

            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="15"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
       <?
		}
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->



         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=0 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				//echo $poid.', ';
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}

			//$po_quantity[$result_job[csf('id')]];
        ?>
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="16" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>NO sensitive  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" title="<?=implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?>" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?>&nbsp;&nbsp; SC/LC: <? echo implode(",",$sc_lc_arr[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                 </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Garments Order Qty(Pcs)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cons Per Garment</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cone Length</strong></td>
                <td align="center" style="border:1px solid black"><strong> Qnty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                 <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                 <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color");

            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">

                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);

				?>
                </td>
                <?
                $color_tatal=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

				$gmts_order_qty=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['gmt_per'];
				$cone_len=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['cone_len'];
				$color_po_qty=$color_item_po_qty_arr[$nameArray_job_po_row[csf('job_no')]][$result_itemdescription[csf('item_color')]];

                $item_desctiption_total=0;
                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
                <td style="border:1px solid black;text-align:right"><? echo number_format($color_po_qty,0); ?> </td>
                <td style="border:1px solid black;text-align:right"><?  echo  number_format($gmts_order_qty,0); ?> </td>
                <td style="border:1px solid black; text-align:right">
               <?
			   $trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				  // echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   echo $cone_len;
			   ?>
                </td>
                <?
				if($db_type==0)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.cons) as cons,sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
						}
						if($db_type==2)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.cons) as cons,sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
						}

                foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right">
                <?
				//$uom_arr=array(1,52,50,51,53,54,55,56,57,31,59,62,65,66,67,74,78,80);
				//print_r($uom_arr);
				$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];
				//echo $order_uom_id.'DD';
                if($result_color_size_qnty[csf('cons')]!= "")
                {
              	 echo number_format($result_color_size_qnty[csf('cons')],4);
                $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                $color_tatal+=$result_color_size_qnty[csf('cons')];
                }
                else echo "";
                ?>
                </td>
                <?
                }
                ?>

                <td style="border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_color_size_qnty[csf('amount')]/$result_color_size_qnty[csf('cons')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color =$result_color_size_qnty[csf('amount')]; //$item_desctiption_total*  $result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                 <td style="border:1px solid black; text-align:right"><? echo $trims_remark; ?> </td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="6"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;">
                <?
                if($color_tatal !='')
                {
					echo number_format($color_tatal,4);
                }
                ?>
                </td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="11"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <?
		}
		}
		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->

       <?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>
       <br/>
       <table width="100%" style="margin-top:1px">
       <tr>
       <td>
       <table width="100%" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                <td width="70%" style="border:1px solid black; text-align:left"><? echo number_format($booking_grand_total,2);?></td>
            </tr>
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                <td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
            </tr>
       </table>
       </td>
       </tr>
       </table>
         <br/>
        <table width="100%">
        <tr>
        <td width="49%">
        <?
        	echo get_spacial_instruction($txt_booking_no);
        ?>
    	</td>
    <td width="2%"></td>
    <?
	$lib_designation_arr=return_library_array(" select id,custom_designation from lib_designation","id","custom_designation");
	$user_lib_designation_arr=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
	$user_lib_name_arr=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");

	$mst_id=return_field_value("id as mst_id","wo_booking_mst","booking_no='$txt_booking_no'","mst_id");
	//echo $mst_id.'ssD';
	//and b.un_approved_date is null
	 $approve_data_array=sql_select("select b.approved_by,min(b.approved_date) as approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=8  group by  b.approved_by order by b.approved_by asc");
	// echo "select b.approved_by,min(b.approved_date) as approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=8  group by  b.approved_by order by b.approved_by asc";
	 $unapprove_data_array=sql_select("select b.approved_by,b.approved_date,b.un_approved_reason,b.un_approved_date,b.approved_no from   approval_history b where b.mst_id=$mst_id and b.entry_form=8  order by b.approved_date,b.approved_by");

	?>
    <td width="49%" valign="top">
	<?
          if(count($approve_data_array)>0)
			{
 		?>
       <table  width="850" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>
            <tr style="border:1px solid black;">
                <th colspan="5" style="border:1px solid black;">Approval Status</th>
                </tr>
                <tr style="border:1px solid black;">
                <th width="3%" style="border:1px solid black;">Sl</th>
				<th width="40%" style="border:1px solid black;">Name</th>
				<th width="30%" style="border:1px solid black;">Designation</th>
				<th width="27%" style="border:1px solid black;">Approval Date</th>

                </tr>
            </thead>
            <tbody>
            <?
			$i=1;
			foreach($approve_data_array as $row){


			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
				<td width="40%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
				<td width="27%" style="border:1px solid black;text-align:center"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')]));?></td>

                </tr>
                <?
				$i++;
			}
				?>
            </tbody>
        </table>
		<?
		}
		?>
		<br>
		<?
		if(count($unapprove_data_array)>0)
		{
			$sql_unapproved=sql_select("select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=8 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id=$mst_id");
			$unapproved_request_arr=array();
			foreach($sql_unapproved as $rowu)
			{
			$unapproved_request_arr[$rowu[csf('booking_id')]]=$rowu[csf('approval_cause')];
			}
 		?>
       <table  width="850" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>
            <tr style="border:1px solid black;">
                <th colspan="6" style="border:1px solid black;">Approval/Un Approval History</th>
                </tr>
                <tr style="border:1px solid black;">
                <th width="3%" style="border:1px solid black;">Sl</th>
				<th width="30%" style="border:1px solid black;">Name</th>
				<th width="20%" style="border:1px solid black;">Designation</th>
				<th width="5%" style="border:1px solid black;">Approval Status</th>
				<th width="20%" style="border:1px solid black;">Reason For Un Approval</th>
				<th width="22%" style="border:1px solid black;"> Date</th>

                </tr>
            </thead>
            <tbody>
            <?
			$i=1;
			foreach($unapprove_data_array as $row){

			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
				<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
				<td width="5%" style="border:1px solid black; text-align:center"><? echo 'Yes';?></td>
				<td width="20%" style="border:1px solid black;"><? echo '';?></td>
				<td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); else echo "";?></td>
            </tr>
				<?
				$i++;
				$un_approved_date= explode(" ",$row[csf('un_approved_date')]);
				$un_approved_date=$un_approved_date[0];
				if($db_type==0) //Mysql
				{
					if($un_approved_date=="" || $un_approved_date=="0000-00-00") $un_approved_date="";else $un_approved_date=$un_approved_date;
				}
				else
				{
					if($un_approved_date=="") $un_approved_date="";else $un_approved_date=$un_approved_date;
				}

				if($un_approved_date!="")
				{
				?>
			<tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
				<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
				<td width="5%" style="border:1px solid black;text-align:center;"><? echo 'No';?></td>
				<td width="20%" style="border:1px solid black;text-align:center"><? echo $unapproved_request_arr[$mst_id];?></td>
				<td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('un_approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('un_approved_date')])); else echo "";?></td>
              </tr>

                <?
				$i++;
				}

			}
				?>
            </tbody>
        </table>
		<?
		}
		?>
    </td>
    </tr>
    </table>

   	 </tbody>
     </table>

    </div> <!--class="footer_signature"-->
	<div align="left"><b>Prepared By: &nbsp; <? echo $user_name_arr[$inserted_by];?></b></div>
    <div >

         <?
          echo signature_table(132, $cbo_company_name, "1330px",1);

		 ?>
      	</div>
        <br>
      <div id="page_break_div"></div>
     <br>

    <div>

		<?
        	//echo signature_table(2, $cbo_company_name, "1330px");
			echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>

<?
    if($link == 1){
        ?>
        <script type="text/javascript" src="../../../js/jquery.js"></script>
        <script type="text/javascript" src="../../../js/jquerybarcode.js"></script>
    <?
    }else {
        ?>
         <script type="text/javascript" src="../../js/jquery.js"></script>
        <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
        <?
    }
        ?>
    <script>
    fnc_generate_Barcode('<? echo $varcode_booking_no; ?>','barcode_img_id');

    </script>
  </html>
<?
    $html = ob_get_contents();
	ob_clean();
	list($is_mail_send,$mail)=explode('___',$mail_send_data);
	if($is_mail_send==1){
		require_once('../../../mailer/class.phpmailer.php');
		require_once('../../../auto_mail/setting/mail_setting.php');
		$mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
			
		$mailToArr=array();
		$mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
		//echo $mailSql;die;
		$mailSqlRes=sql_select($mailSql);
		foreach($mailSqlRes as $rows){
			if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		}
		
		
		$mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=97 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
		//echo $mailSql;die;
		$mailSqlRes=sql_select($mailSql);
		foreach($mailSqlRes as $rows){
			if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		}
		if($mail!=''){$mailToArr[]=$mail;}
		
		$to=implode(',',$mailToArr);
		$subject="Trims Booking Multy Job";
		$header=mailHeader();
		echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
		
	}
	else{
		echo $html;
	}
	exit();




}

if($action=="show_trim_booking_report9") //For Islam
{
	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from lib_supplier",'id','supplier_name');

	$supplier_address_arr=return_library_array( "select id, address_1 from lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");

	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;
	//$revised_no_data=sql_select("select a.revised_no  from wo_booking_mst a where  a.booking_no=$txt_booking_no and  a.status_active =1 and a.is_deleted=0");
	//list($revised_no_row)=$revised_no_data;
	$booking_grand_total=0; $currency_id="";
	$buyer_string=array(); $style_owner=array(); $job_no=array(); $style_ref=array(); $all_dealing_marcent=array(); $season=array(); $order_repeat_no=array(); $po_id_arr=array();
	$po_no=array(); $file_no=array(); $ref_no=array(); $po_quantity=array(); $pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';

	$nameArray_buyer=sql_select( "select a.job_no, a.style_ref_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, a.total_set_qnty, a.order_uom, b.po_break_down_id, max(b.update_date) as update_date, c.pub_shipment_date, c.po_number, c.grouping, c.file_no, c.po_quantity as po_quantity from wo_po_details_master a, wo_booking_dtls b, wo_po_break_down c where b.po_break_down_id=c.id and a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0 group by a.job_no, a.style_ref_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, a.total_set_qnty, a.order_uom, b.po_break_down_id, c.pub_shipment_date, c.po_number,c.grouping, c.file_no, c.po_quantity");

	foreach ($nameArray_buyer as $result_buy){
		$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
		$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
		$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
		$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
		$uomarr[$result_buy[csf('job_no')]]=$result_buy[csf('order_uom')];
		$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
		$season_matrix_con=$result_buy[csf('season_buyer_wise')];

		$seasons_name.=$season_arr[$season_matrix_con].',';
		$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
		$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

		$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];

		$po_no[$result_buy[csf('job_no')]][$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_number')];
		$file_no[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('file_no')];
		$ref_no[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('grouping')];
		$po_quantity[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_quantity')];
	//	$tot_po_quantity+=$result_buy[csf('po_quantity')];
		$job_ref_no[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('grouping')];
		$job_file_no[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('file_no')];
		$po_no_arr[$result_buy[csf('job_no')]]['po_id'].=$result_buy[csf('po_break_down_id')].',';
		$pub_shipment_date.=$result_buy[csf('pub_shipment_date')].',';
		$int_ref_no.=$result_buy[csf('grouping')].',';
		if($po_idss=='') $po_idss=$result_buy[csf('po_break_down_id')];else $po_idss.=",".$result_buy[csf('po_break_down_id')];
		$revised_update_date=explode(" ",$result_buy[csf('update_date')]);
		$revised_date=strtotime($revised_update_date[0]);

		$job_po_qty_arr[$result_buy[csf('job_no')]][$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_quantity')];
		$tot_po_quantity+=$result_buy[csf('po_quantity')]*$result_buy[csf('total_set_qnty')];
	}
	$style_sting=implode(",",array_unique($style_ref));
	$job_no_str = "'" . implode( "','", $job_no ) . "'";
	$job_no=implode(",",$job_no);
	$seasons_names=implode(",",array_filter(array_unique(explode(",",$seasons_name))));
	$poid_arr=array_unique($po_id_arr);

	$order_rept_no=rtrim($order_rept_no,',');
	$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));
	$main_fabric_approved = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and a.job_no in (".$job_no_str.") and b.entry_form=7 and a.status_active =1 and a.is_deleted=0 order by b.id asc");
	//print_r($po_idss); die;

	/*$nameArray_job=sql_select( "select  max(a.update_date) as update_date,b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, sum(b.po_quantity) as po_quantity  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no ");
	foreach ($nameArray_job as $result_job){
		$po_no[$result_job[csf('job_no_mst')]][$result_job[csf('id')]]=$result_job[csf('po_number')];
		$file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
		$ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
		$po_quantity[$result_job[csf('id')]]=$result_job[csf('po_quantity')];
	//	$tot_po_quantity+=$result_job[csf('po_quantity')];
		$job_ref_no[$result_job[csf('job_no_mst')]].=$result_job[csf('grouping')].',';
		$job_file_no[$result_job[csf('job_no_mst')]].=$result_job[csf('file_no')].',';
		$po_no_arr[$result_job[csf('job_no_mst')]]['po_id'].=$result_job[csf('id')].',';
		$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
		$int_ref_no.=$result_job[csf('grouping')].',';
		if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];
		$revised_update_date=explode(" ",$result_job[csf('update_date')]);
		$revised_date=strtotime($revised_update_date[0]);

	}
		//echo $po_idss.'DDDDDDDDD';
	$sql_job=sql_select( "select b.job_no_mst,b.id as po_id, b.po_quantity as po_quantity  from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.") ");
	foreach ($sql_job as $row)
	{
		$job_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('po_id')]]+=$row[csf('po_quantity')];
		$tot_po_quantity+=$row[csf('po_quantity')];
	}
 */
	$nameArray=sql_select( "select a.booking_no, a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.source, a.remarks, a.revised_no,a.update_date,a.delivery_address from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
	foreach( $nameArray as $row)
	{
		$varcode_booking_no=$row[csf('booking_no')];
		$booking_date=$row[csf('booking_date')];
		$delivery_date=$row[csf('delivery_date')];
		$pay_mode_id=$row[csf('pay_mode')];
		$supplier_id=$row[csf('supplier_id')];
		$currency_id=$row[csf('currency_id')];
		$buyer_id=$row[csf('buyer_id')];
		$exchange_rate=$row[csf('exchange_rate')];
		$attention=$row[csf('attention')];
		$remarks=$row[csf('remarks')];
		$delivery_address=$row[csf('delivery_address')];
		$revised_no=$row[csf('revised_no')];
		$mst_update_date=explode(" ",$row[csf('update_date')]);
		$mst_revised_date=strtotime($mst_update_date[0]);
		$source_id=$row[csf('source')];
	}
	if($revised_date!="" && $mst_revised_date!="")
	{
		$max_revised_date_time=max($revised_date,$mst_revised_date);
		$max_revised_date=date('d-m-Y',$max_revised_date_time);
	}
	else if($revised_date!="" && $mst_revised_date=="") $max_revised_date=date('d-m-Y',$revised_date);
	else if($mst_revised_date!="" && $revised_date=="") $max_revised_date=date('d-m-Y',$mst_revised_date);

	$approved_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name, b.id from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0 order by b.id asc");
	ob_start();
	
	?>
   	<table width="1333px" cellpadding="0" cellspacing="0" style="border:0px solid black" >
    	<tr>
            <th>
                <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
                    <tr>
                        <td width="20px">
                            <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
                                <tr>
                                    <td width="50" >
                                    <? if($report_type==1)
                                    {
										if($link == 1)
										{
											?><img  src='../../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' /><?
										}
										else
										{
											?><img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' /><?
										}
									}
									else
									{
										?><img  src='../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' /><?
									}
                                    ?>
                                    </td>
                                    <td width="40px" align="center">&nbsp;  &nbsp;  &nbsp;</td>
                                    <td width="30px" align="center"><b style="font-size:25px;"><? echo $company_library[$cbo_company_name]; ?></b>
                                        <br>
                                        <label>
                                            <?
                                            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                                            foreach ($nameArray as $result)
                                            {
                                                if($result[csf('plot_no')]!='') echo $result[csf('plot_no')]; else echo '';?> &nbsp;
                                                <? echo $result[csf('level_no')];?> &nbsp;
                                                <? echo $result[csf('road_no')]; ?>  &nbsp;
                                                <? echo $result[csf('block_no')];?>  &nbsp;
                                                <? echo $result[csf('city')];?>  &nbsp;
                                                <? echo $result[csf('zip_code')]; ?>  &nbsp;
                                                <?php echo $result[csf('province')]; ?>  &nbsp;
                                                <? echo $country_arr[$result[csf('country_id')]]; ?> &nbsp;<br/>
                                                <? echo $result[csf('email')];?>  &nbsp;
                                                <? echo $result[csf('website')];
                                                if($result[csf('plot_no')]!='') $plot_no=$result[csf('plot_no')];
                                                if($result[csf('level_no')]!='') $level_no=$result[csf('level_no')];
                                                if($result[csf('road_no')]!='') $road_no=$result[csf('road_no')];
                                                if($result[csf('block_no')]!='') $block_no=$result[csf('block_no')];
                                                if($result[csf('city')]!='') $city=$result[csf('city')];

                                                $company_address[$result[csf('id')]]=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
                                            }
                                            ?>
                                        </label>
                                        <br/>
                                        <b style="font-size:20px;"><?php echo $report_title; ?></b>
                                    </td>
                                    <td width="10px" align="center" style="font-size:20px;">
                                        <table width="80%" align="right" cellpadding="0" cellspacing="0" style="border:0px solid black">
                                            <tr>
                                                <td width="80">  Booking No:&nbsp; <?php echo $varcode_booking_no; ?></td>
                                            </tr>
                                            <tr>
                                                <td>Booking Date:&nbsp; <?php echo change_date_format($booking_date); ?></td>
                                            </tr>
                                            <?
                                            if($revised_no>0)
                                            {
                                                ?>
                                                <tr>
                                                    <td>Revised No:&nbsp;<?php echo $revised_no . '&nbsp(Date:' . change_date_format($max_revised_date) . ')'; ?></td>
                                                </tr>
                                                <?
                                            }
                                            if(str_replace("'","",$id_approved_id) ==1)
                                            {
                                                ?>
                                                <tr>
                                                    <td>Approved Status :&nbsp;<? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?></td>
                                                </tr>
                                                <?
                                            }
                                            ?>
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <table width="100%"  style="border:0px solid black;table-layout: fixed;">
                                <tr>
                                	<td colspan="6" valign="top">&nbsp;</td>
                                </tr>
                                <tr>
                                    <td width="100" style="font-size:18px" align="left"><span><b>To, </b></span>  </td>
                                    <td width="110" colspan="5" style="font-size:18px">&nbsp;<span></span></td>
                                </tr>
                                <tr>
                                    <td width="210" colspan="2" align="left" style="font-size:18px">&nbsp;<b>
                                        <? if($pay_mode_id==5 || $pay_mode_id==3) echo $company_library[$supplier_id]; else echo $supplier_name_arr[$supplier_id]; ?></b>
                                    </td>
                                    <td width="100" style="font-size:12px"><b>Buyer</b></td>
                                    <td width="110" align="left">:&nbsp;<? echo $buyer_name_arr[$buyer_id]; ?></td>
                                    <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
                                    <td width="110" align="left">:&nbsp;<?  echo change_date_format($delivery_date); ?></td>
                                </tr>
                                <tr>
                                    <td width="100" colspan="2" rowspan="2" align="left" style="font-size:18px">Address :&nbsp;
                                        <b><?
                                        if($pay_mode_id==5 || $pay_mode_id==3) $address=$company_address[$supplier_id]; else $address=$supplier_address_arr[$supplier_id];
                                        echo $address;
                                        ?></b>
                                    </td>
                                    <td width="100" style="font-size:12px"><b>PO Qty.[PCS]</b> </td>
                                    <td width="110" align="left">:&nbsp;<?=$tot_po_quantity;?></td>
                                    <td style="font-size:12px"><b>Delivery To </b> </td>
                                    <td style="" align="left">:&nbsp;<?=$delivery_address;?></td>
                                </tr>
                                <tr>
                                    <td width="100" style="font-size:12px"><b>Season</b> </td>
                                    <td width="110" align="left">:&nbsp;<? echo $seasons_names; ?></td>
                                    <td width="100" style="font-size:12px"><b>Currency</b></td>
                                    <td width="110" align="left">:&nbsp;<?  echo $currency[$currency_id]; ?></td>
                                </tr>
                                <tr>
                                    <td width="100" style="font-size:12px" align="left"><b>Attention </b>   </td>
                                    <td align="left" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;<? echo $attention; ?></td>
                                    <td width="100" style="font-size:12px"><b>Order Repeat </b> </td>
                                    <td width="110" align="left">:&nbsp;<? echo $order_rept_no; ?></td>
                                    <td  style="font-size:12px"><b>Pay mode</b></td>
                                    <td align="left">:&nbsp;<? echo $pay_mode[$pay_mode_id];?></td>
                                </tr>
                                <tr>
                                    <td width="100" style="font-size:12px" align="left"><b>Source</b></td>
                                    <td align="left" >:&nbsp;<? echo $source[$source_id];?></td>
                                    <td style="font-size:12px"><b>Dealing Merchant</b></td>
                                    <td align="left" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;<? echo implode(",",array_unique($all_dealing_marcent)); ?></td>
                                </tr>
                                <tr>
                                    <td width="100" style="font-size:12px" align="left"><b>Remarks</b>  </td>
                                    <td align="left" width="110" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" >:&nbsp;<? echo $remarks; ?></td>
                                    <td width="130" style="font-size:12px" align="left"><b>Main Fabric Booking 1<sup>st</sup> Approved Date</b></td>
                                    <td align="left">:&nbsp;<?  echo change_date_format($main_fabric_approved[0][csf('approved_date')]); ?></td>
                                </tr>
                            </table>
                        </td>
                    </tr>
                </table>
            </th>
		</tr>
     	<tr>
     		<td>
                <!--==============================================AS PER Sensitivity START=========================================  -->
                <?
				$condition= new condition();
				if($po_idss !=''){
					$condition->po_id("in($po_idss)");
				}
				$condition->init();
				$trim= new trims($condition);

				//echo $trim->getQuery();die;
				$trim_req_qty_arr=$trim->getQtyArray_by_orderPrecostdtlsidAndGmtscolor();
				$trim_req_size_qty_arr=$trim->getQtyArray_by_orderPrecostdtlsidAndGmtssize();
				$trim_req_color_size_qty_arr=$trim->getQtyArray_by_OrderPrecostdtlsidGmtscolorAndGmtssize();
				$costPerArr=$condition->getCostingPerArr();
                $precost_arr=array(); $trims_qtyPerUnit_arr=array();

                $precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0");
                $calUom="";
                foreach($precost_sql as $precost_row)
				{
					if($precost_row[csf('cal_parameter')]==1){
						$calUom="Mtr";
						$trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
						$trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
					}
					else if($precost_row[csf('cal_parameter')]==2) $calUom="Pcs";
					else if($precost_row[csf('cal_parameter')]==3) $calUom="Pcs";
					else if($precost_row[csf('cal_parameter')]==4) $calUom="Pcs";
					else if($precost_row[csf('cal_parameter')]==5){
						$calUom="Yds";
						$trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
						$trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
					}
					else if($precost_row[csf('cal_parameter')]==6){
						$calUom="Yds";
						$trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
						$trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
					}
					else if($precost_row[csf('cal_parameter')]==7){
						$calUom="Pcs";
						$trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
						$trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
					}
					else if($precost_row[csf('cal_parameter')]==8){
						$calUom="Yds";
						$trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
						$trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
					}
					else $calUom=0;

					$trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
                }


                $booking_country_arr=array();
                $nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,po_break_down_id as po_id,sensitivity,country_id_string,delivery_date from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0");
                foreach($nameArray_booking_country as $nameArray_booking_country_row)
				{
					$po_delivery_date_arr[$nameArray_booking_country_row[csf('po_id')]]=$nameArray_booking_country_row[csf('delivery_date')];
					$country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
					$tocu=count($country_id_string);
					for($cu=0;$cu<$tocu;$cu++){
						$booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
					}
                }

				$data_array_color="select a.job_no_mst, a.id as po_id, b.order_quantity, b.item_number_id, b.color_number_id, b.size_number_id from wo_po_break_down a, wo_po_color_size_breakdown b where a.job_no_mst=b.job_no_mst and a.id=b.po_break_down_id and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and a.id in($po_idss) order by a.id";
				$result_color=sql_select($data_array_color);
				foreach($result_color as $row)
				{
					$color_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('color_number_id')]]+=$row[csf('order_quantity')];
					$item_color_qty_arr[$row[csf('po_id')]][$row[csf('item_number_id')]][$row[csf('color_number_id')]]+=$row[csf('order_quantity')];
					$size_qty_arr[$row[csf('po_id')]][$row[csf('item_number_id')]][$row[csf('size_number_id')]]+=$row[csf('order_quantity')];
					$color_size_qty_arr[$row[csf('po_id')]][$row[csf('item_number_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]+=$row[csf('order_quantity')];

					$job_qty_arr[$row[csf('po_id')]][$row[csf('item_number_id')]]+=$row[csf('order_quantity')];
				}
				// print_r($item_color_qty_arr);

				$trim_pre=sql_select( "select a.id as trim_cost_id, a.trim_group, c.cons, a.job_no, a.cons_uom, c.item_number_id, c.po_break_down_id, c.color_number_id, c.size_number_id from wo_pre_cost_trim_cost_dtls a,wo_pre_cost_trim_co_cons_dtls c where a.id=c.wo_pre_cost_trim_cost_dtls_id and c.cons>0 and c.po_break_down_id in($po_idss) and  a.status_active =1 and a.is_deleted=0 and c.status_active =1 and c.is_deleted=0 order by a.job_no ");

				foreach($trim_pre as $row)
				{
					$trim_item_arr[$row[csf('job_no')]][$row[csf('trim_group')]]=$row[csf('cons_uom')];
					$trim_item_arr2[$row[csf('trim_cost_id')]].=$row[csf('item_number_id')].',';

					$trim_req_qty=$trim_req_qty_arr[$row[csf('po_break_down_id')]][$row[csf('trim_cost_id')]][$row[csf('color_number_id')]];
					$trim_size_req_qty=$trim_req_size_qty_arr[$row[csf('po_break_down_id')]][$row[csf('trim_cost_id')]][$row[csf('size_number_id')]];
					$trim_color_size_req_qty=$trim_req_color_size_qty_arr[$row[csf('po_break_down_id')]][$row[csf('trim_cost_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]];
					if($trim_color_size_req_qty>0)
					{
						$trim_color_req_qty_arr[$row[csf('po_break_down_id')]][$row[csf('trim_cost_id')]][$row[csf('color_number_id')]]+=$trim_color_size_req_qty;
						$trim_item_req_qty_arr[$row[csf('po_break_down_id')]][$row[csf('trim_cost_id')]]+=$trim_color_size_req_qty;
						$trim_item_size_req_qty_arr[$row[csf('po_break_down_id')]][$row[csf('trim_cost_id')]][$row[csf('size_number_id')]]+=$trim_color_size_req_qty;
					}
					$trim_size_req_qty_arr[$row[csf('po_break_down_id')]][$row[csf('trim_cost_id')]][$row[csf('size_number_id')]]+=$trim_size_req_qty;
					$trim_color_size_req_qty_arr[$row[csf('po_break_down_id')]][$row[csf('trim_cost_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]+=$trim_color_size_req_qty;
				}

                $nameArray_job_po=sql_select( "select job_no, po_break_down_id as po_id, sensitivity from wo_booking_dtls where booking_no='$txt_booking_no' and status_active =1 and is_deleted=0 group by job_no, po_break_down_id, sensitivity order by sensitivity, job_no,po_break_down_id ");
                foreach($nameArray_job_po as $nameArray_job_po_row)
				{
					$jobnoStr=$nameArray_job_po_row[csf('job_no')];
					$poIdNo=$nameArray_job_po_row[csf('po_id')];
					$sensitivity=$nameArray_job_po_row[csf('sensitivity')];
					$costPerQty=$costPerArr[$jobnoStr];
					$itemTotalSpan=0; $totalSpan=0;
					if($sensitivity==0 || $sensitivity=="") $sensitivitystr="NO SENSITIBITY"; else $sensitivitystr=$size_color_sensitive[$nameArray_job_po_row[csf('sensitivity')]];
					if($sensitivity==0 || $sensitivity=="" || $sensitivity==1 || $sensitivity==2)
					{
						$itemTotalSpan=8; $totalSpan=12;
					}
					else if($sensitivity==3)
					{
						$itemTotalSpan=9; $totalSpan=13;
					}
					else if($sensitivity==4)
					{
						$itemTotalSpan=11; $totalSpan=15;
					}

					$nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group, po_break_down_id as po_id from wo_booking_dtls where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$jobnoStr."' and po_break_down_id='".$poIdNo."' and sensitivity='".$sensitivity."' group by pre_cost_fabric_cost_dtls_id, trim_group, po_break_down_id order by trim_group ");
					if(count($nameArray_item)>0)
					{
						$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
						$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
						$po_no_qty=0;
						$job_no=$nameArray_job_po_row[csf('job_no')];
						$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('job_no')]][$nameArray_job_po_row[csf('po_id')]];
						$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];

						?>
						&nbsp;
						<table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
							<tr>
								<td colspan="12" align="">
									<table width="100%" style="table-layout: fixed;">
										<tr>
											<td width="60%" align="left"><strong><?=$sensitivitystr . ";    Job NO:" . $nameArray_job_po_row[csf('job_no')] . ";   Style NO:" . $style_ref[$nameArray_job_po_row[csf('job_no')]];if ($ref_nos != '') {
	echo "; &nbsp;Int Ref.:&nbsp;" . $ref_nos;
 } else {
	" ";
 }
 if ($file_nos != '' || $file_nos != 0) {
	echo "; &nbsp;File No.:&nbsp;" . $file_nos;
 } else {
	" ";
 }

 echo "; &nbsp;  Po Qty.:&nbsp;" . $po_no_qty . '[' . $unit_of_measurement[$uomarr[$nameArray_job_po_row[csf('job_no')]]] . ']';?></strong></td>
											<td width="40%" style="font-weight:bold;">Po No: <?=$po_no[$nameArray_job_po_row[csf('job_no')]][$nameArray_job_po_row[csf('po_id')]] . ' &nbsp;&nbsp;&nbsp; ';
 echo "&nbsp;&nbsp;Delivery Date:&nbsp;" . change_date_format($po_delivery_date);?></td>
										</tr>
									</table>
								</td>
							</tr>
							<tr>
								<td style="border:1px solid black"><strong>Sl</strong> </td>
								<td style="border:1px solid black"><strong>Item Group</strong> </td>
								<td style="border:1px solid black"><strong>Item Description</strong> </td>
								<td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
								<td style="border:1px solid black"><strong>Article No.</strong> </td>
								<? if($sensitivity==2) { ?>
									<td style="border:1px solid black"><strong>Item Size</strong> </td>
								<? } else if($sensitivity==3) {?>
									<td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
									<td align="center" style="border:1px solid black"><strong>Item Ref</strong></td>
									<td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
								<? } else if($sensitivity==4) {?>
									<td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
									<td align="center" style="border:1px solid black"><strong>Item Ref</strong></td>
									<td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
									<td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
									<td align="center" style="border:1px solid black"><strong>Gmts Size</strong></td>
								<? } else {?>
									<td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
									<td align="center" style="border:1px solid black"><strong>Item Ref</strong></td>
								<? } ?>
								<td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
								<td align="center" style="border:1px solid black"><strong>Avg. Cons</strong></td>
								<td align="center" style="border:1px solid black"><strong>Cons. UOM</strong></td>
								<td style="border:1px solid black" align="center"><strong>WO Qty</strong></td>
								<td style="border:1px solid black" align="center"><strong>UOM</strong></td>
								<? if($show_comment==1) {?>
									<td style="border:1px solid black" align="center"><strong>Rate</strong></td>
								<? }?>
									<td style="border:1px solid black" align="center"><strong>Amount</strong></td>
									<td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
								
							</tr>
							<?
							$i=0; $grand_total_as_per_gmts_color=0;
							foreach($nameArray_item as $result_item)
							{
								$i++;
								$bomDtls_id=$result_item[csf('pre_cost_fabric_cost_dtls_id')];
								$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, min(b.id) as bid, b.description, b.article_number, b.brand_supplier, b.item_color, a.gmts_color_id, b.color_number_id, b.gmts_sizes, b.item_size, sum(b.requirment) as cons, avg(b.rate) as rate, sum(b.amount) as amount,b.remarks,b.item_ref from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id=b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$jobnoStr."' and a.po_break_down_id='".$poIdNo."' and a.sensitivity='".$sensitivity."' and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id='".$bomDtls_id."' and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.item_color, a.gmts_color_id, b.color_number_id, b.gmts_sizes, b.item_size, b.description, b.article_number, b.brand_supplier, b.item_color,b.remarks,b.item_ref  order by bid ");

								
							
								$trim_uom=$trim_item_arr[$jobnoStr][$result_item[csf('trim_group')]];

								?>
								<tr>
									<td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>"><? echo $i.'-'.$color_po_qty; ?></td>
									<td align="center"  style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
										<?
										echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
										echo implode(",",$booking_country_arr[$bomDtls_id][1]);
										?>
									</td>
									<?
									$item_desctiption_total=0; $total_amount_as_per_gmts_color=0;
									foreach($nameArray_item_description as $result_itemdescription)
									{
										$color_id=$result_itemdescription[csf('color_number_id')];
										$gmts_sizes=$result_itemdescription[csf('gmts_sizes')];
										$item_color=$result_itemdescription[csf('item_color')];
										$trim_item=rtrim($trim_item_arr2[$bomDtls_id],',');
										$trim_item_id=array_unique(explode(",",$trim_item));
										$po_qty=0; $avgCons=0; $reqQty=0;
										if($sensitivity==1)
										{
											foreach($trim_item_id as $item)
											{
												$po_qty+=$item_color_qty_arr[$poIdNo][$item][$color_id];
											}
											$reqQty=$trim_color_req_qty_arr[$poIdNo][$bomDtls_id][$result_itemdescription[csf('color_number_id')]];
										}
										else if($sensitivity==2)
										{
											foreach($trim_item_id as $item)
											{
												$po_qty+=$size_qty_arr[$poIdNo][$item][$gmts_sizes];
											}
											$reqQty=$trim_item_size_req_qty_arr[$poIdNo][$bomDtls_id][$gmts_sizes];
										}
										else if($sensitivity==3)
										{
											foreach($trim_item_id as $item)
											{
												$po_qty+=$item_color_qty_arr[$poIdNo][$item][$color_id];
											}
											$reqQty=$trim_color_req_qty_arr[$poIdNo][$bomDtls_id][$color_id];
										}
										else if($sensitivity==4)
										{
											foreach($trim_item_id as $item)
											{
												$po_qty+=$color_size_qty_arr[$poIdNo][$item][$color_id][$gmts_sizes];
											}
											$reqQty=$trim_color_size_req_qty_arr[$poIdNo][$bomDtls_id][$color_id][$gmts_sizes];
										}
										else
										{
											foreach($trim_item_id as $item)
											{
												$po_qty+=$job_qty_arr[$poIdNo][$item];
											}
											$reqQty=$trim_item_req_qty_arr[$poIdNo][$bomDtls_id];
										}
										$avgCons=($reqQty/$po_qty)*$costPerQty;
										?>
										<td style="border:1px solid black"><?=$result_itemdescription[csf('description')];?> </td>
										<td style="border:1px solid black"><?=$result_itemdescription[csf('brand_supplier')];?> </td>
										<td style="border:1px solid black"><?=$result_itemdescription[csf('article_number')];?> </td>
										<? if($sensitivity==2) { ?>
											<td style="border:1px solid black; text-align:left"><?=$result_itemdescription[csf('item_size')];?></td>
										<? } else if($sensitivity==3){ ?>
											<td style="border:1px solid black; text-align:left"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?></td>
											<td style="border:1px solid black; text-align:left"><? echo $result_itemdescription[csf('item_ref')]; ?></td>
											<td style="border:1px solid black; text-align:left"><? echo $color_library[$result_itemdescription[csf('color_number_id')]]; ?></td>
										<? } else if($sensitivity==4){ ?>
											<td style="border:1px solid black; text-align:left"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?></td>
											<td style="border:1px solid black; text-align:left"><? echo $result_itemdescription[csf('item_ref')]; ?></td>
											<td style="border:1px solid black; text-align:left"><? echo $color_library[$result_itemdescription[csf('color_number_id')]]; ?></td>
											<td style="border:1px solid black; text-align:left"><? echo $result_itemdescription[csf('item_size')]; ?></td>
											<td style="border:1px solid black; text-align:left"><? echo $size_library[$result_itemdescription[csf('gmts_sizes')]]; ?></td>
										<? } else { ?>
											<td style="border:1px solid black; text-align:left"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?></td>
											<td style="border:1px solid black; text-align:left"><? echo $result_itemdescription[csf('item_ref')]; ?></td>
										<? } ?>
                                        <td style="border:1px solid black; text-align:left">
											<?
											$calUom=$trims_qtyPerUnit_arr[$bomDtls_id][2];
											$calQty=explode("_",$trims_qtyPerUnit_arr[$bomDtls_id][1]);
											if($calUom && end($calQty)){
												echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
											}
											?>
										</td>
										<td style="border:1px solid black; text-align:right" title="(Req Qty/Po Qty)*Cost Per (<? echo $reqQty.'/'.$po_qty.'*'.$costPerQty;?>)"><?=number_format($avgCons, 4);?></td>
										<td style="border:1px solid black; text-align:center"><?=$unit_of_measurement[$trim_uom];?></td>
										<td style="border:1px solid black; text-align:right">
											<?
											$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];
											echo number_format($result_itemdescription[csf('cons')],4);
											$item_desctiption_total += $result_itemdescription[csf('cons')] ;
											?>
										</td>
										<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
										<? if($show_comment==1) {?>
											<td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
											<? } ?>
											<td style="border:1px solid black; text-align:right">
												<?
												$amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
												echo number_format($amount_as_per_gmts_color,4);
												$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
												$trims_remark=$trims_remark_arr[$bomDtls_id]['remark'];
												?>
											</td>
											<td style="border:1px solid black; text-align:right"><p><? echo $result_itemdescription[csf('remarks')]; ?> </p></td>
									
										</tr>
										<?

										$trims_item_arr[$result_item[csf('trim_group')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_itemdescription[csf('cons')];
										$trims_item_arr[$result_item[csf('trim_group')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
									}
									?>
								<tr>
									<td style="border:1px solid black; text-align:right" colspan="<?=$itemTotalSpan;?>"><strong>Item Total : </strong></td>
									<td style="border:1px solid black; text-align:right; font-weight:bold;"><?=number_format($item_desctiption_total, 4);?></td>
									<td style="border:1px solid black; text-align:center"><?=$uom_text;?></td>
									<? if($show_comment==1) {?>
										<td style="border:1px solid black; text-align:right"></td>
										<? } ?>
										<td style="border:1px solid black; text-align:right">
											<?
												echo number_format($total_amount_as_per_gmts_color,2);
												$grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
											?>
										</td>
										<td>&nbsp;  </td>
									
								</tr>
								<?
							}
							?>
							<tr>
								<td align="right" style="border:1px solid black" colspan="<?=$totalSpan;?>"><strong>Total : </strong></td>
								
									<td style="border:1px solid black;  text-align:right"><strong><?=number_format($grand_total_as_per_gmts_color, 2);
 $booking_grand_total += $grand_total_as_per_gmts_color;?></strong></td>
									<td>&nbsp; </td>
							
							</tr>
						</table>
						<br/>
						<?
					}
				}

			?>
            <!--==============================================AS PER Sensitivity END=========================================  -->
            </td>
        </tr>
    </table>
    <br>
    <table border="1" align="left" class="rpt_table"  cellpadding="0" width="50%" cellspacing="0" rules="all" >
        <tr>
            <td style="border:1px solid black" align="center"><strong>Sl</strong> </td>
            <td style="border:1px solid black" align="center"><strong>Item Group</strong> </td>
            <td style="border:1px solid black" align="center"><strong>Order Uom</strong> </td>
            <td style="border:1px solid black" align="center"><strong>Total Qnty</strong> </td>
            <td style="border:1px solid black" align="center"><strong>Total Amount</strong> </td>
        </tr>
        <?
        // print_r($trims_item_arr);
        $t=1;$total_item_cons=$total_item_amount=0;
        foreach($trims_item_arr as $trim_id=>$trim_data )
        {
			foreach($trim_data as $uom_id=>$val )
			{
				?>
				<tr>
                    <td style="border:1px solid black"> <? echo $t; ?> </td>
                    <td align="center" style="border:1px solid black"> <? echo $trim_group_library[$trim_id];?> </td>
                    <td align="center" style="border:1px solid black"> <? echo $unit_of_measurement[$uom_id];?> </td>
                    <td align="right" style="border:1px solid black"> <? echo number_format($val['cons'],4);?> </td>
                    <td align="right" style="border:1px solid black"> <? echo number_format($val['amount'],2);?> </td>
				</tr>
				<?
				$t++;
				$total_item_cons+=$val['cons'];
				$total_item_amount+=$val['amount'];
			}
        }
        ?>
        <tr>
            <td colspan="4" align="right"> <b>Total</b> </td>
            <td align="right"><b> <? echo number_format($total_item_amount,2);?></b> </td>
        </tr>
    </table>
	<?
    $mcurrency=""; $dcurrency="";
    if($currency_id==1)
    {
		$mcurrency='Taka'; $dcurrency='Paisa';
    }
    if($currency_id==2)
    {
		$mcurrency='USD'; $dcurrency='CENTS';
    }
    if($currency_id==3)
    {
		$mcurrency='EURO'; $dcurrency='CENTS';
    }
    ?>
    <br/>
    <table width="100%" style="margin-top:1px">
        <tr>
            <td>
                <table width="100%" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
                    <tr style="border:1px solid black;">
                        <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                        <td width="70%" style="border:1px solid black; text-align:left"><? echo number_format($booking_grand_total,2);?></td>
                    </tr>
                    <tr style="border:1px solid black;">
                        <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                        <td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
	<br/>
    <table width="100%">
        <tr>
            <td width="49%"><?=get_spacial_instruction($txt_booking_no);?></td>
            <td width="2%">&nbsp;</td>
            <td width="49%" valign="top">
                <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
                    <tr style="border:1px solid black;">
                    	<td colspan="3" style="border:1px solid black;">Approval Status</td>
                    </tr>
                    <tr style="border:1px solid black;">
                    	<td width="3%" style="border:1px solid black;">Sl</td><td width="50%" style="border:1px solid black;">Name</td><td width="27%" style="border:1px solid black;">Approval Date</td><td width="20%" style="border:1px solid black;">Approval No</td>
                    </tr>
                    <?
                    $i;
                    foreach($approved_array as $row){
						?>
						<tr style="border:1px solid black;">
						<td width="3%" style="border:1px solid black;"><? echo $i;?></td><td width="50%" style="border:1px solid black;"><? echo $row[csf('user_full_name')];?></td><td width="27%" style="border:1px solid black;"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); ;?></td><td width="20%" style="border:1px solid black;"><? echo $row[csf('approved_no')];?></td>
						</tr>
						<?
						$i++;
                    }
                    ?>
                </table>
            </td>
        </tr>
    </table>
	<br>
	<br>
	<?
    //------------------------------ Query for TNA start-----------------------------------
    $sql_job_color=sql_select( "select c.color_type_id,b.id as po_id  from wo_po_details_master a, wo_po_break_down b,wo_pre_cost_fabric_cost_dtls c where a.job_no=b.job_no_mst and  a.job_no=c.job_no and  b.job_no_mst=c.job_no  and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.") ");

    foreach ($sql_job_color as $row)
    {
    	$po_color_type_arr[$row[csf('po_id')]]=$row[csf('color_type')];
    }
    $po_num_arr=return_library_array("select id,po_number from wo_po_break_down where id in($po_idss)",'id','po_number');
    $tna_start_sql=sql_select( "select id,po_number_id,
		(case when task_number=73 then task_start_date else null end) as finishing_start_date,
		(case when task_number=73 then task_finish_date else null end) as finishing_end_date,
		(case when task_number=179 then task_start_date else null end) as aop_finishing_start_date,
		(case when task_number=179 then task_finish_date else null end) as aop_finishing_end_date,
		(case when task_number=180 then task_start_date else null end) as yd_finishing_start_date,
		(case when task_number=180 then task_finish_date else null end) as yd_finishing_end_date
		from tna_process_mst
		where status_active=1 and po_number_id in($po_idss)");

    $tna_fab_start=$tna_knit_start=$tna_dyeing_start=$tna_fin_start=$tna_cut_start=$tna_sewin_start=$tna_exfact_start="";
    $tna_date_task_arr=array();
    foreach($tna_start_sql as $row)
    {
		if($row[csf("finishing_start_date")]!="" && $row[csf("finishing_start_date")]!="0000-00-00")
		{
			$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_start_date']=$row[csf("finishing_start_date")];
			$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_end_date']=$row[csf("finishing_end_date")];
		}
		if($row[csf("aop_finishing_start_date")]!="" && $row[csf("aop_finishing_start_date")]!="0000-00-00")
		{
			$tna_date_task_arr[$row[csf("po_number_id")]]['aop_finishing_start_date']=$row[csf("aop_finishing_start_date")];
			$tna_date_task_arr[$row[csf("po_number_id")]]['aop_finishing_end_date']=$row[csf("aop_finishing_end_date")];
		}
		if($row[csf("yd_finishing_start_date")]!="" && $row[csf("yd_finishing_start_date")]!="0000-00-00")
		{
			$tna_date_task_arr[$row[csf("po_number_id")]]['yd_finishing_start_date']=$row[csf("yd_finishing_start_date")];
			$tna_date_task_arr[$row[csf("po_number_id")]]['yd_finishing_end_date']=$row[csf("yd_finishing_end_date")];
		}
    }
    //------------------------------ Query for TNA end-----------------------------------
    ?>
    <!-- <fieldset id="div_size_color_matrix" style="max-width:700;">
        <legend>TNA Information</legend>
        <table width="100%" style="border:1px solid black;font-size:12px" border="1" cellpadding="2" cellspacing="0" rules="all">
            <tr>
                <td rowspan="2" align="center" width="100" valign="top">SL</td>
                <td width="280" rowspan="2"  align="center" valign="top"><b>Order No</b></td>
                <td colspan="2" align="center" valign="top"><b>Finishing Fabric In Solid</b></td>
                <td colspan="2" align="center" valign="top"><b>Finishing Fabric In AOP </b></td>
                <td colspan="2" align="center" valign="top"><b>Finishing Fabric In YD </b></td>
            </tr>
            <tr>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
            </tr>
            <?
            $i=1;
            foreach($tna_date_task_arr as $order_id=>$row)
            {
				?>
				<tr>
                    <td width="100"><? echo $i; ?></td>
                    <td><? echo $po_num_arr[$order_id]; ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['aop_finishing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['aop_finishing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['yd_finishing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['yd_finishing_end_date']); ?></td>
				</tr>
				<?
				$i++;
            }
			
            ?>
        </table>
    </fieldset> -->
    <div  style="margin-top:-50px;"><?  echo signature_table(132, $cbo_company_name, "1333px",1); ?></div>
    <div id="page_break_div"> </div>
    <div><? echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no); ?></div>
	<?
        $html = ob_get_contents();
		ob_clean();
		list($is_mail_send,$mail)=explode('___',$mail_send_data);
		if($is_mail_send==1){
			require_once('../../../mailer/class.phpmailer.php');
			require_once('../../../auto_mail/setting/mail_setting.php');
			$mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
				
			$mailToArr=array();
			$mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
			//echo $mailSql;die;
			$mailSqlRes=sql_select($mailSql);
			foreach($mailSqlRes as $rows){
				if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
			}
			
			
			$mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=97 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
			//echo $mailSql;die;
			$mailSqlRes=sql_select($mailSql);
			foreach($mailSqlRes as $rows){
				if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
			}
			if($mail!=''){$mailToArr[]=$mail;}
			
			$to=implode(',',$mailToArr);
			$subject="Trims Booking Multy Job";
			$header=mailHeader();
			echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
			
		}
		else{
			echo $html;
		}
		exit();
}

if($action=="show_trim_booking_report10"){
	extract($_REQUEST);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$team_member_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$location_name_arr=return_library_array( "select company_id,location_name from lib_location where status_active=1 and is_deleted=0",'company_id','location_name');
	$trim_group= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$color_library=return_library_array( "select id,color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name"  );
	$trim_type= return_library_array("select id, trim_type from lib_item_group",'id','trim_type');
	$nameArray=sql_select( "select a.booking_no, a.is_approved,a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.source, a.remarks, a.revised_no from wo_booking_mst a where a.booking_no=$txt_booking_no and a.status_active =1 and a.is_deleted=0");
		foreach( $nameArray as $row)
		{
			$is_approved=$row[csf('is_approved')];
		}
		ob_start();
	?>
	<div style="width:1033px" align="center">
        <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black; margin-bottom:20px;" align="left">
            <tr>
                <td width="100">
					<? if($link==1){?>
                    <img  src='../../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
                    <? }else{?>
                    <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
                    <? }?>
                </td>
                <td width="1000">
                    <table width="100%" cellpadding="0" cellspacing="0" >
                        <tr>
                            <td align="center" style="font-size:20px;">
                            <?php
							echo $company_library[$cbo_company_name];
								?>
                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:14px">
                            <?
                            $nameArray=sql_select( "select id, plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                            foreach ($nameArray as $result){
								if($result[csf('plot_no')])echo $result[csf('plot_no')].', ';
								if($result[csf('level_no')])echo $result[csf('level_no')].', ';
								if($result[csf('road_no')])echo $result[csf('road_no')].', ';
								if($result[csf('block_no')])echo $result[csf('block_no')].', ';
								if($result[csf('city')])echo $result[csf('city')].', ';
								if($result[csf('zip_code')])echo $result[csf('zip_code')].', ';
								if($result[csf('province')])echo $result[csf('province')].', ';
								echo $country_arr[$result[csf('country_id')]];
                            }
                            ?>
                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:20px">
                            <strong>
                            <?
                            if(str_replace("'","",$cbo_isshort)==2){
								$isshort="";
                            }
                            else if(str_replace("'","",$cbo_isshort)==1){
								$isshort="[Short]";
                            }

                            if ($report_title !=""){
								echo $report_title." ".$isshort;
                            }
                            else {
								echo "Main Trims Booking ".$isshort;
                            }
                            ?>
                            &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <font style="color:#F00">
                            <? //if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";};
							 if($is_approved ==1){ echo "(Approved)";} 
							 else if($is_approved ==3){ echo "(Partial Approved)";} else{echo "";};
							 ?>
                            </font>
                            </strong>
                            </td>
                        </tr>
                    </table>
                </td>
                <td width="250" id="barcode_img_id">
                </td>
            </tr>
        </table>
		<?
		$booking_grand_total=0;
		$grand_total_as_per_gmts_color=0;
		$grand_item_desctiption_total=0;
		$uom_arr_check=array();
		$group_arr_check=array();
		$currency_id="";

		$po_num_arr=array();
		$po_id_arr=array();
		$po_status_arr=array();
		$job_no_string_arr=array();
		$buyer_string_arr=array();
		$style_ref_no_string_arr=array();
		$dealing_marchant_string_arr=array();
		$job_style_arr=array();
		$costing_per_arr=array();
		$nameArray_buyer=sql_select( "select  b.job_no,b.delivery_date,a.buyer_name,a.style_ref_no,a.dealing_marchant,c.id  as po_id,c.po_number,c.shiping_status,c.shipment_date,c.pub_shipment_date,d.costing_per   from wo_po_details_master a, wo_booking_dtls b, wo_po_break_down c ,wo_pre_cost_mst d where a.job_no=b.job_no and a.job_no=c.job_no_mst and a.job_no=d.job_no and b.po_break_down_id=c.id and b.booking_no=$txt_booking_no and b.booking_type=2 order by c.shipment_date desc");
        foreach ($nameArray_buyer as $result_buy)
		{
			$job_no_string_arr[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$buyer_string_arr[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$style_ref_no_string_arr[$result_buy[csf('style_ref_no')]]=$result_buy[csf('style_ref_no')];
			$job_style_arr[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$dealing_marchant_string_arr[$result_buy[csf('dealing_marchant')]]=$team_member_arr[$result_buy[csf('dealing_marchant')]];
			$po_num_arr[$result_buy[csf('po_id')]]=$result_buy[csf('po_number')];
			$po_id_arr[$result_buy[csf('po_id')]]=$result_buy[csf('po_id')];
			$po_status_arr[]=$result_buy[csf('shiping_status')];
			$min_shipdate=$result_buy[csf('shipment_date')];
			$costing_per_arr[$result_buy[csf('job_no')]]=$result_buy[csf('costing_per')];
			
		}

		$deliver_sql=sql_select( "select  b.po_break_down_id,b.delivery_date   from  wo_booking_dtls b where  b.booking_no=$txt_booking_no and b.status_active=1 ");
        foreach ($deliver_sql as $row)
		{
			
			$deliver_date_arr[$row[csf('po_break_down_id')]]=$row[csf('delivery_date')];
		}
		//print_r($deliver_date_arr);
		$job_no=implode(",",$job_no_string_arr);
		$buyer_string=implode(",",$buyer_string_arr);
		$style_ref=implode(",",$style_ref_no_string_arr);
		$deling_marchent=implode(",",$dealing_marchant_string_arr);
		$po_id=implode(",",$po_id_arr);


		$sql_date="SELECT a.task_finish_date,a.po_number_id,a.task_number from tna_process_mst a, wo_po_break_down b where a.po_number_id = b.id and a.status_active=1 and b.is_deleted=0 and A.TASK_NUMBER in (70,71) and (b.id in($po_id))  group by a.task_finish_date,a.po_number_id,a.task_number,a.task_category";
		//echo $sql_date;

		$date_arr=array();

		$sql_result=sql_select($sql_date);
		foreach ($sql_result as $row) 
		{
			$date_arr[$row[csf('po_number_id')]][$row[csf('task_number')]]=$row[csf('task_finish_date')];
		}

		$po_status_arr=array_unique($po_status_arr);
		$shipping_status=0;
		if(count($po_status_arr)==1){
			$shipping_status=$po_status_arr[0];
		}
		else if(count($po_status_arr)>1){
			$shipping_status=2;
		}

		//TNA Information
		$tna_start_sql=sql_select( "select id,po_number_id,
								(case when task_number=31 then task_start_date else null end) as fab_booking_start_date,
								(case when task_number=31 then task_finish_date else null end) as fab_booking_end_date,
								(case when task_number=32 then task_start_date else null end) as trims_booking_start_date,
								(case when task_number=32 then task_finish_date else null end) as trims_booking_end_date,
								(case when task_number=70 then task_start_date else null end) as Sew_Trims_rcv_start_date,
								(case when task_number=70 then task_finish_date else null end) as Sew_Trims_rcv_end_date,
								(case when task_number=84 then task_start_date else null end) as cutting_start_date,
								(case when task_number=84 then task_finish_date else null end) as cutting_end_date,
								(case when task_number=71 then task_start_date else null end) as fin_Trims_rcv_start_date,
								(case when task_number=71 then task_finish_date else null end) as fin_Trims_rcv_end_date,
								(case when task_number=86 then task_start_date else null end) as sewing_start_date,
								(case when task_number=86 then task_finish_date else null end) as sewing_end_date,
								(case when task_number=110 then task_start_date else null end) as exfact_start_date,
								(case when task_number=110 then task_finish_date else null end) as exfact_end_date
		from tna_process_mst
		where status_active=1 and po_number_id in($po_id)");
		$tna_fab_start=$tna_knit_start=$tna_dyeing_start=$tna_fin_start=$tna_cut_start=$tna_sewin_start=$tna_exfact_start="";
		$tna_date_task_arr=array();
		foreach($tna_start_sql as $row){
			if($row[csf("fab_booking_start_date")]!="" && $row[csf("fab_booking_start_date")]!="0000-00-00"){
				if($tna_fab_start==""){
					$tna_fab_start=$row[csf("fab_booking_start_date")];
				}
			}
			if($row[csf("trims_booking_start_date")]!="" && $row[csf("trims_booking_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['trims_booking_start_date']=$row[csf("trims_booking_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['trims_booking_end_date']=$row[csf("trims_booking_end_date")];
					}
					if($row[csf("Sew_Trims_rcv_start_date")]!="" && $row[csf("Sew_Trims_rcv_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['Sew_Trims_rcv_start_date']=$row[csf("Sew_Trims_rcv_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['Sew_Trims_rcv_end_date']=$row[csf("Sew_Trims_rcv_end_date")];
					}
					if($row[csf("cutting_start_date")]!="" && $row[csf("cutting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_start_date']=$row[csf("cutting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_end_date']=$row[csf("cutting_end_date")];
					}
					if($row[csf("fin_Trims_rcv_start_date")]!="" && $row[csf("fin_Trims_rcv_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['fin_Trims_rcv_start_date']=$row[csf("fin_Trims_rcv_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['fin_Trims_rcv_end_date']=$row[csf("fin_Trims_rcv_end_date")];
					}
					if($row[csf("sewing_start_date")]!="" && $row[csf("sewing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_start_date']=$row[csf("sewing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_end_date']=$row[csf("sewing_end_date")];
					}
					if($row[csf("exfact_start_date")]!="" && $row[csf("exfact_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_start_date']=$row[csf("exfact_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_end_date']=$row[csf("exfact_end_date")];
					}
		}

		$tna_start_date="";
		$min_tna_date=return_field_value(" min(a.task_start_date) as min_start_date","tna_process_mst a, lib_tna_task b"," b.task_name=a.task_number and po_number_id in ($po_id) and task_name=32","min_start_date");
		$sql_order=sql_select("select order_quantity,color_number_id,size_number_id,po_break_down_id,country_id from wo_po_color_size_breakdown  where po_break_down_id in($po_id ) and status_active=1");
		//echo "select order_quantity,color_number_id,size_number_id,po_break_down_id,country_id from wo_po_color_size_breakdown  where po_break_down_id in($po_id ) and status_active=1";
		$po_qty_po_level=array();
		$order_size_qty=array();
		$order_color_size_qty=array();
		$order_color_qty=array();
		$order_qty_arr=array();
		foreach($sql_order as $val){
			$order_color_qty[$val[csf('po_break_down_id')]][$val[csf('country_id')]][$val[csf('color_number_id')]]+=$val[csf('order_quantity')];
			$order_size_qty[$val[csf('po_break_down_id')]][$val[csf('country_id')]][$val[csf('size_number_id')]]+=$val[csf('order_quantity')];
			$order_color_size_qty[$val[csf('po_break_down_id')]][$val[csf('country_id')]][$val[csf('color_number_id')]][$val[csf('size_number_id')]]+=$val[csf('order_quantity')];
			$order_qty_arr[$val[csf('po_break_down_id')]][$val[csf('country_id')]]+=$val[csf('order_quantity')];
			$po_qty_po_level[$val[csf('po_break_down_id')]]+=$val[csf('order_quantity')];
			$order_country_arr[$val[csf('po_break_down_id')]].=$val[csf('country_id')].',';
		}

		//'MM-DD-YYYY'
		if($db_type==0) $select_update_date="max(date( b.update_date)) as update_date"; else $select_update_date="max(to_char( b.update_date,'DD-MM-YYYY')) as update_date";
		$nameArray=sql_select("select a.booking_no,a.delivery_date as mst_delivery_date,a.booking_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,min(b.delivery_date) as delivery_date,a.pay_mode,a.source,a.remarks, $select_update_date
		from wo_booking_mst a , wo_booking_dtls b
		where a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.booking_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0
		group by a.booking_no,a.booking_date,a.delivery_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.pay_mode,a.source,a.remarks");
		 
		
        foreach ($nameArray as $result){
			$varcode_booking_no=$result[csf('booking_no')];
        ?>
       <table width="100%" style="border:1px solid black" align="left">
            <tr>
                <td colspan="6" valign="top"></td>
            </tr>
            <tr>
                <td width="100" style="font-size:16px"><b>Buyer Name</b></td>
                <td width="200" >:&nbsp;<? echo   rtrim($buyer_string,", "); ?>&nbsp;&nbsp;&nbsp;</td>
                <td width="100" style="font-size:16px"><b>Attention :</b></td>
                <td width="200"><?  echo $result[csf('attention')];?></td>
                <td width="100"><span style="font-size:16px"><b>Booking No</b></span></td>
                <td>:&nbsp;<? echo $result[csf('booking_no')];?></td>
            </tr>
            <tr>
                <td style="font-size:16px"><b>Supplier Name </b>   </td>
                <td><p>:&nbsp;<?
				if($result[csf('pay_mode')]==5 || $result[csf('pay_mode')]==3){
					echo $company_library[$result[csf('supplier_id')]];
					}
					else{
					echo $supplier_name_arr[$result[csf('supplier_id')]];
					}
				//echo $supplier_name_arr[$result[csf('supplier_id')]];?></p> </td>
                <td style="font-size:16px; word-break:break-all;"><b>Supplier Add. </b>   </td>
                <td><p style="word-break:break-all;">:&nbsp; <? echo $supplier_address_arr[$result[csf('supplier_id')]];?></p></td>
                <td><span style="font-size:16px"><b>Source</b></span></td>
                <td>:&nbsp;<? echo $source[$result[csf('source')]]; ?></td>
            </tr>
            <tr>
                <td style="font-size:16px"><b>Pay Mode</b>   </td>
                <td>:&nbsp; <? echo $pay_mode[$result[csf('pay_mode')]]; ?></td>
                <td style="font-size:16px"><b>Currency</b></td>
                <td>:&nbsp; <? $currency_id=$result[csf('currency_id')]; echo $currency[$result[csf('currency_id')]]; ?></td>
               	<td><span style="font-size:16px"><b>Exch. Rate</b></span></td>
                <td>:&nbsp;<? echo $exchange_rate=$result[csf('exchange_rate')]; ?></td>
            </tr>
           </table>

           <table width="100%" style="border:1px solid black; margin:20px 0px 20px 0px" align="left">
            <tr>
                <td colspan="6" valign="top"></td>
            </tr>
             <tr>
                <td width="100" style="font-size:16px"><b>Booking Date </b>   </td>
                <td width="110">:&nbsp;<? echo change_date_format($result[csf('booking_date')],'dd-mm-yyyy','-');?>&nbsp;&nbsp;&nbsp; </td>
                <td width="100" style="font-size:16px"><b>TNA Start Date</b></td>
                <td width="110">:&nbsp;<? if($min_tna_date!="") echo change_date_format($min_tna_date,'dd-mm-yyyy','-'); ?> </td>
                <?
				$wo_tna_datediff=datediff( "d", $result[csf('booking_date')], $min_tna_date);
				if($wo_tna_datediff<1) $wo_caption="After";  else $wo_caption="Before";
				?>
                <td width="100"><span style="font-size:16px"><b>WO Prepared  <? echo $wo_caption; ?></b></span></td>
                <td width="110">:&nbsp;<? echo abs($wo_tna_datediff); ?></td>
            </tr>

              <tr>
                <td style="font-size:16px"><b>Delivery Date </b>   </td>
                <td>:&nbsp;<? echo change_date_format($result[csf('mst_delivery_date')],'dd-mm-yyyy','-');?> </td>
                <td style="font-size:16px"><b>Shipment Date</b></td>
                <td>:&nbsp;<? if($min_shipdate!="") echo change_date_format($min_shipdate,'dd-mm-yyyy','-'); ?>&nbsp;&nbsp;&nbsp;</td>
                <td><span style="font-size:16px"><b>Ship.days in Hand</b></span></td>
                <td>:&nbsp;<? echo datediff( "d",date("d-m-Y"),$min_shipdate);?></td>
            </tr>
            <tr>
                <td style="font-size:16px"><b>Last Update</b> </td>
                <td style="font-size:12px">:&nbsp;<? if($result[csf('update_date')]!="" && $result[csf('update_date')]!="0000-00-00") echo change_date_format($result[csf('update_date')]);?></td>
                <td style="font-size:16px"></td>
                <td ></td>
                <td ><span style="font-size:16px"><b>Ex-factory Status</b></span></td>
                <td style="font-size:16px">:&nbsp;<? echo $shipment_status[$shipping_status];?></td>
            </tr>
            <tr>
                <td style="font-size:16px"><b>Remarks</b> </td>
                <td style="font-size:16px">:&nbsp;<? echo $result[csf('remarks')];?></td>
                <td style="font-size:12px"></td>
                <td ></td>

            </tr>
        </table>
        <br/>
		<?
        }
        ?>



          <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?
		$total_order_qty=0;
		$nameArray_job_po=sql_select( "select a.job_no,a.po_break_down_id, max(b.po_quantity) as po_quantity from wo_booking_dtls a,wo_po_break_down b  where a.booking_no=$txt_booking_no and a.booking_type=2 and a.po_break_down_id=b.id and b.status_active=1 and b.is_deleted=0  group by a.job_no,a.po_break_down_id order by a.job_no,a.po_break_down_id ");

		foreach($nameArray_job_po as $nameArray_job_po_row){
		//$all_po_qty=sql_select("select sum(order_quantity) as po_total,po_break_down_id from wo_po_color_size_breakdown where po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and status_active=1 and is_deleted=0 group by po_break_down_id");
		//$costing_per=return_field_value("costing_per", "wo_pre_cost_mst", "job_no='".$nameArray_job_po_row[csf('job_no')]."'");
		//$style_ref=return_field_value("style_ref_no", "wo_po_details_master", "job_no='".$nameArray_job_po_row[csf('job_no')]."'");
		$total_order_qty+=$po_qty_po_level[$nameArray_job_po_row[csf('po_break_down_id')]];
		$style_ref=$job_style_arr[$nameArray_job_po_row[csf('job_no')]];
		$costing_per=$costing_per_arr[$nameArray_job_po_row[csf('job_no')]];
		if($costing_per==1){
			$costing_per_qty=12;
		}
		else if($costing_per==2){
			$costing_per_qty=1;
		}
		else if($costing_per==3){
			$costing_per_qty=24;
		}
		else if($costing_per==4){
			$costing_per_qty=36;
		}
		else if($costing_per==5){
			$costing_per_qty=48;
		}

		$nameArray_item=sql_select( "select  id,trim_group,country_id_string,pre_cost_fabric_cost_dtls_id as trims_cost_dtlsid from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]."  and sensitivity=1 and status_active=1 and is_deleted=0 and wo_qnty>0 order by trim_group ");
	   if(count($nameArray_item)>0){
        ?>
        &nbsp;
        <table style="border:1px solid black" align="left" class=""  cellpadding="0" width="100%" cellspacing="0" rules="all" >
           <tr>
                <td colspan="11" align="">
                <strong><?
				$style_sting=$style_ref;

				$date_del=0;
				if($trim_type[$nameArray_item[0][csf('trim_group')]]==1)
				{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][70];
				}
				else{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][71];
				}

				echo "Job NO:".$nameArray_job_po_row[csf('job_no')]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; Style Ref:".$style_ref." &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; PO No:" .$po_num_arr[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO Qty:" .$po_qty_po_level[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp;Delivery Date:".change_date_format($deliver_date_arr[$nameArray_job_po_row[csf('po_break_down_id')]]);?></strong>
                </td>
            </tr>
            <tr>
                <td colspan="11" align="">
                <strong>As Per Garments Color</strong>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Order Qty.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cone Length</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cost/Dzn(USD)</strong></td>
            </tr>
            <?
			$i=0;
			$trim_amount_arr=array();
			$sql_trim_amount=sql_select("select id, calculatorstring,cons_uom,trim_group,job_no,description, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."' and  status_active=1 and is_deleted=0 ");
			foreach($sql_trim_amount as $item){
				$calculatorstring=explode("_",$item[csf('calculatorstring')]);
				$trim_amount_arr[$item[csf("job_no")]][$item[csf("trim_group")]][$item[csf("description")]]['amount']=$item[csf("amount")];
				$trims_cons_gmts_per_arr[$item[csf('trim_group')]][$item[csf('id')]]['cone_len']=$calculatorstring[2];
			}

            foreach($nameArray_item as $result_item){
				$i++;

				$nameArray_item_description=sql_select( "select b.description, b.brand_supplier,b.item_color, b.color_number_id ,min(b.color_size_table_id) as color_size_table_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and  a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=1 and   a.id= ".$result_item[csf('id')]." and a.trim_group=".$result_item[csf('trim_group')]." and b.requirment !=0 and b.requirment>0 group by b.description, b.brand_supplier,b.item_color, b.color_number_id order by color_size_table_id ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center"  style="border:1px solid black; font-weight:bold;" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				$group_arr_check[$result_item[csf('trim_group')]]=$result_item[csf('trim_group')];
				echo $trim_group[$result_item[csf('trim_group')]]."<br/>";

				$country_arr=explode(",",$result_item[csf('country_id_string')]);
				$country_name_string="";
				for($co=0; $co <count($country_arr);$co++){
				$country_name_string.=$country_library[$country_arr[$co]].",";
				}
				echo rtrim($country_name_string,',');
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription){
					$country_order_qty=0;
					$country=rtrim($order_country_arr[$nameArray_job_po_row[csf('po_break_down_id')]],',');
					$countryArr=array_unique(explode(",",$country));
					/*for($coa=0; $coa <count($country_arr);$coa++){

						$country_order_qty+=$order_color_qty[$nameArray_job_po_row[csf('po_break_down_id')]][$country_arr[$coa]][$result_itemdescription[csf('color_number_id')]];
					}*/
					for($coa=0; $coa <count($countryArr);$coa++){
						$country_order_qty+=$order_color_qty[$nameArray_job_po_row[csf('po_break_down_id')]][$countryArr[$coa]][$result_itemdescription[csf('color_number_id')]];
					}
                ?>
                <td style="border:1px solid black"><?  echo $result_itemdescription[csf('description')]; ?> </td>
                <td style="border:1px solid black" align="right"><? echo $country_order_qty; ?> </td>
                <td style="border:1px solid black;">
               <? echo $color_library[$result_itemdescription[csf('color_number_id')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?
			    echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_arr_check[$order_uom_arr[$result_item[csf('trim_group')]]]=$order_uom_arr[$result_item[csf('trim_group')]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? 
				$cone_len=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_item[csf('trims_cost_dtlsid')]]['cone_len'];
				echo number_format($cone_len,0); ?> </td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],6); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?
				$trim_amount= $trim_amount_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf("trim_group")]][$result_itemdescription[csf('description')]]['amount'];
				echo ($trim_amount*$costing_per_qty)/12;
				?>
                </td>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="3"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><? echo number_format($item_desctiption_total ,2); $grand_item_desctiption_total+=$item_desctiption_total;  ?></td>
                <td style="border:1px solid black;  text-align:right"></td>
                <td style="border:1px solid black;  text-align:right"></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right; font-weight:bold;">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
            </tr>
            <?
            }
            ?>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->



        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  id,pre_cost_fabric_cost_dtls_id as trims_cost_dtlsid,trim_group,country_id_string from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and sensitivity=2 and status_active=1 and is_deleted=0 and wo_qnty>0 order by trim_group ");
		if(count($nameArray_item)>0){
        ?>

        <table style="border:1px solid black" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                <strong><? 
                $date_del=0;
				if($trim_type[$nameArray_item[0][csf('trim_group')]]==1)
				{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][70];
				}
				else{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][71];
				}
                 echo "Job NO:".$nameArray_job_po_row[csf('job_no')]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Style Ref:&nbsp; ".$style_ref."  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO No:" .$po_num_arr[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO Qty:" .$po_qty_po_level[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; Delivery Date:".change_date_format($deliver_date_arr[$nameArray_job_po_row[csf('po_break_down_id')]]);?></strong>
                </td>
            </tr>
            <tr>
                <td colspan="12" align="">
                <strong>Size Sensitive </strong>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Order Qty.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Size</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                 <td style="border:1px solid black" align="center"><strong>Cone length</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cost/Dzn(USD)</strong></td>
            </tr>
            <?
			$i=0;
			$trim_amount_arr=array();
			$uom_arr_check=array();
			$sql_trim_amount=sql_select("select  id,calculatorstring,cons_uom,trim_group,job_no,description, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."' and  status_active=1 and is_deleted=0 ");

			foreach($sql_trim_amount as $item){
				$calculatorstring=explode("_",$item[csf('calculatorstring')]);
				$trim_amount_arr[$item[csf("job_no")]][$item[csf("trim_group")]][$item[csf("description")]]['amount']=$item[csf("amount")];
				$trims_cons_gmts_per_arr[$item[csf('trim_group')]][$item[csf('id')]]['cone_len']=$calculatorstring[2];
			}

            foreach($nameArray_item as $result_item){
			$i++;
			$nameArray_item_description=sql_select( "select b.description, b.brand_supplier,b.item_size,b.gmts_sizes,min(b.color_size_table_id) as color_size_table_id, sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id=b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=2 and  a.id= ".$result_item[csf('id')]." and a.trim_group=".$result_item[csf('trim_group')]." and b.requirment>0 group by b.description, b.brand_supplier,b.item_size, b.gmts_sizes order by color_size_table_id");
			$sql_trim_amount=sql_select("select  cons_uom, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."'  and trim_group=".$result_item[csf('trim_group')]." ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black; font-weight:bold;" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				$group_arr_check[$result_item[csf('trim_group')]]=$result_item[csf('trim_group')];
				echo $trim_group[$result_item[csf('trim_group')]]."<br/>";
				$country_arr=explode(",",$result_item[csf('country_id_string')]);
				$country_name_string="";
				for($co=0; $co <count($country_arr);$co++){
					$country_name_string.=$country_library[$country_arr[$co]].",";
				}
				echo rtrim($country_name_string,',');
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
					$country=rtrim($order_country_arr[$nameArray_job_po_row[csf('po_break_down_id')]],',');
					$countryArr=array_unique(explode(",",$country));
					$country_order_qty=0;
					/*for($coa=0; $coa <count($country_arr);$coa++){
					 $country_order_qty+=$order_size_qty[$nameArray_job_po_row[csf('po_break_down_id')]][$country_arr[$coa]][$result_itemdescription[csf('gmts_sizes')]];
					}*/
					for($coa=0; $coa <count($countryArr);$coa++){
					 $country_order_qty+=$order_size_qty[$nameArray_job_po_row[csf('po_break_down_id')]][$countryArr[$coa]][$result_itemdescription[csf('gmts_sizes')]];
					}
                ?>
                <td style="border:1px solid black"><? echo $result_itemdescription[csf('description')]; ?> </td>
                <td style="border:1px solid black" align="right"><? echo $country_order_qty;?> </td>
                <td style="border:1px solid black; text-align:right">
              <? echo $result_itemdescription[csf('item_size')];?>
                </td>
                <td style="border:1px solid black; text-align:right">
              <? echo $size_library[$result_itemdescription[csf('gmts_sizes')]];?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?
				 echo number_format($result_itemdescription[csf('cons')],2);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_arr_check[$order_uom_arr[$result_item[csf('trim_group')]]]=$order_uom_arr[$result_item[csf('trim_group')]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? 
				$cone_len=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_item[csf('trims_cost_dtlsid')]]['cone_len'];
				echo number_format($cone_len,0); ?> </td>
                  <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],6); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                ?>
                </td>
                <td style="border:1px solid black; text-align:right"><? $trim_amount= $trim_amount_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf("trim_group")]][$result_itemdescription[csf('description')]]['amount'];echo ($trim_amount*$costing_per_qty)/12;  ?></td>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><? echo number_format($item_desctiption_total,2); $grand_item_desctiption_total+=$item_desctiption_total;  ?></td>
                 <td style="border:1px solid black;  text-align:right"></td>
                  <td style="border:1px solid black;  text-align:right"></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right; font-weight:bold;">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
            </tr>
            <?
            }
            ?>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select  id,pre_cost_fabric_cost_dtls_id as trims_cost_dtlsid,trim_group,country_id_string from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and sensitivity=3 and status_active=1 and is_deleted=0 and wo_qnty>0 order by trim_group ");
		if(count($nameArray_item)>0){
        ?>
        <table style="border:1px solid black" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
           <tr>
                <td colspan="12" align="">
                <strong><?

                $date_del=0;
				if($trim_type[$nameArray_item[0][csf('trim_group')]]==1)
				{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][70];
				}
				else{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][71];
				}	

                 echo "Job NO:".$nameArray_job_po_row[csf('job_no')]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Style Ref:&nbsp; ".$style_ref." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO No:" .$po_num_arr[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO Qty:" .$po_qty_po_level[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; Delivery Date:".change_date_format($deliver_date_arr[$nameArray_job_po_row[csf('po_break_down_id')]]);?></strong>
                </td>
            </tr>
            <tr>
                <td colspan="12" align="">
                <strong>Contrast Color</strong>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Order Qty.</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Conde Length</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cost/Dzn(USD)</strong></td>
            </tr>
            <?
			$i=0;
			$trim_amount_arr=array();$uom_arr_check=array();
			$sql_trim_amount=sql_select("select  id,calculatorstring,cons_uom,trim_group,job_no,description, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."' and  status_active=1 and is_deleted=0 ");

			foreach($sql_trim_amount as $item){
				$trim_amount_arr[$item[csf("job_no")]][$item[csf("trim_group")]][$item[csf("description")]]['amount']=$item[csf("amount")];
				$calculatorstring=explode("_",$item[csf('calculatorstring')]);
				$trims_cons_gmts_per_arr[$item[csf('trim_group')]][$item[csf('id')]]['cone_len']=$calculatorstring[2];
			}
            foreach($nameArray_item as $result_item){
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and  a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=3 and  a.id= ".$result_item[csf('id')]." and a.trim_group=".$result_item[csf('trim_group')]." and b.requirment !=0  order by trim_group ", "item_color", "color_number_id"  );
				$nameArray_item_description=sql_select( "select b.description, b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,min(b.color_size_table_id) as color_size_table_id,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=3 and  a.id= ".$result_item[csf('id')]." and a.trim_group=".$result_item[csf('trim_group')]." and b.requirment !=0 group by b.description, b.brand_supplier,b.item_color,b.color_number_id order by color_size_table_id ");
				$sql_trim_amount=sql_select("select  cons_uom, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."'  and trim_group=".$result_item[csf('trim_group')]." ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black; font-weight:bold;" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				$group_arr_check[$result_item[csf('trim_group')]]=$result_item[csf('trim_group')];
				echo $trim_group[$result_item[csf('trim_group')]]."<br/>";
				$country_arr=explode(",",$result_item[csf('country_id_string')]);
				$country_name_string="";
				for($co=0; $co <count($country_arr);$co++){
					$country_name_string.=$country_library[$country_arr[$co]].",";
				}
				echo rtrim($country_name_string,',');
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription){
					
					$country=rtrim($order_country_arr[$nameArray_job_po_row[csf('po_break_down_id')]],',');
					$countryArr=array_unique(explode(",",$country));
					
					$country_order_qty=0;
					/*for($coa=0; $coa <count($country_arr);$coa++){
					 $country_order_qty+=$order_color_qty[$nameArray_job_po_row[csf('po_break_down_id')]][$country_arr[$coa]][$gmtcolor_library[$result_itemdescription[csf('item_color')]]];
					}*/
					for($coa=0; $coa <count($countryArr);$coa++){
					 $country_order_qty+=$order_color_qty[$nameArray_job_po_row[csf('po_break_down_id')]][$countryArr[$coa]][$gmtcolor_library[$result_itemdescription[csf('item_color')]]];
					}
                ?>
                <td style="border:1px solid black"><? echo $result_itemdescription[csf('description')]; ?> </td>
                <td style="border:1px solid black" align="right"><? echo $country_order_qty; ?> </td>
                <td style="border:1px solid black">
               <? echo $color_library[$result_itemdescription[csf('color_number_id')]]; ?>
                </td>
                <td style="border:1px solid black">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?
				echo number_format($result_itemdescription[csf('cons')],2);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_arr_check[$order_uom_arr[$result_item[csf('trim_group')]]]=$order_uom_arr[$result_item[csf('trim_group')]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? 
				$cone_len=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_item[csf('trims_cost_dtlsid')]]['cone_len'];
				echo number_format($cone_len,0); ?> </td>
                 <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],6); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                ?>
                </td>
                <td style="border:1px solid black; text-align:right"><? $trim_amount= $trim_amount_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf("trim_group")]][$result_itemdescription[csf('description')]]['amount'];echo ($trim_amount*$costing_per_qty)/12;  ?></td>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><? echo number_format($item_desctiption_total,2); $grand_item_desctiption_total+=$item_desctiption_total;  ?></td>
                <td style="border:1px solid black;text-align:center"></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right; font-weight:bold;">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
            </tr>
            <?
            }
            ?>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?

		$nameArray_item=sql_select( "select  id,pre_cost_fabric_cost_dtls_id as trims_dtlsid,trim_group,country_id_string from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and sensitivity=4 and status_active=1 and is_deleted=0 and wo_qnty>0 order by trim_group ");
	   if(count($nameArray_item)>0)
		{
        ?>

        <table style="border:1px solid black" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
             <tr>
                <td colspan="14" align="">
                <strong><?

                $date_del=0;
				if($trim_type[$nameArray_item[0][csf('trim_group')]]==1)
				{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][70];
				}
				else{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][71];
				}

                 echo "Job NO:".$nameArray_job_po_row[csf('job_no')]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Style Ref:&nbsp; ".$style_ref." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO No:" .$po_num_arr[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO Qty:" .$po_qty_po_level[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; Delivery Date:".change_date_format($deliver_date_arr[$nameArray_job_po_row[csf('po_break_down_id')]]);?></strong>
                </td>
            </tr>
            <tr>
                <td colspan="14" align="">
                <strong>Color & size sensitive </strong>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Order Qty.</strong> </td>

                <td style="border:1px solid black"><strong>Gmts Color</strong> </td>
                <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Size</strong></td>

                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cone Length</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cost/Dzn(USD)</strong></td>
            </tr>
            <?
			$i=0;
			$trim_amount_arr=array();
			$sql_trim_amount=sql_select("select  id,calculatorstring,cons_uom,trim_group,job_no,description, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."' and  status_active=1 and is_deleted=0 ");

			foreach($sql_trim_amount as $item)
            {
				
				$trim_amount_arr[$item[csf("job_no")]][$item[csf("trim_group")]][$item[csf("description")]]['amount']=$item[csf("amount")];
				$calculatorstring=explode("_",$item[csf('calculatorstring')]);
				$trims_cons_gmts_per_arr[$item[csf('trim_group')]][$item[csf('id')]]['cone_len']=$calculatorstring[2];
			}
            foreach($nameArray_item as $result_item)
            {
			$i++;
			$nameArray_color=sql_select( "select  b.item_color,b.color_number_id,b.item_size,b.gmts_sizes,min(b.color_size_table_id) as color_size_table_id,b.description, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id   and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and  a.id= ".$result_item[csf('id')]." and a.trim_group=".$result_item[csf('trim_group')]." and a.sensitivity=4 and b.requirment !=0 group by b.item_color,b.color_number_id,b.item_size,b.gmts_sizes,b.description, b.brand_supplier order by color_size_table_id ");
            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and sensitivity=4   and trim_group=".$result_item[csf('trim_group')]." order by trim_group ");
			$sql_trim_amount=sql_select("select  cons_uom, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."'  and trim_group=".$result_item[csf('trim_group')]." ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_color)); ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black; font-weight:bold;" rowspan="<? echo (count($nameArray_color)); ?>">
                <?
				$group_arr_check[$result_item[csf('trim_group')]]=$result_item[csf('trim_group')];
				echo $trim_group[$result_item[csf('trim_group')]]."<br/>";
				$country_arr=explode(",",$result_item[csf('country_id_string')]);
				$country_name_string="";
				for($co=0; $co <count($country_arr);$co++)
				{
				 $country_name_string.=$country_library[$country_arr[$co]].",";
				}
				echo rtrim($country_name_string,',');
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
				$uom_arr_check=array();
				foreach($nameArray_color as $result_color)
                {
					$country=rtrim($order_country_arr[$nameArray_job_po_row[csf('po_break_down_id')]],',');
					$countryArr=array_unique(explode(",",$country));
					
					$country_order_qty=0;
				/*	for($coa=0; $coa <count($country_arr);$coa++)
					{
					 $country_order_qty+=$order_color_size_qty[$nameArray_job_po_row[csf('po_break_down_id')]][$country_arr[$coa]][$result_color[csf('color_number_id')]][$result_color[csf('gmts_sizes')]];
					}*/
					for($coa=0; $coa <count($countryArr);$coa++)
					{
					 $country_order_qty+=$order_color_size_qty[$nameArray_job_po_row[csf('po_break_down_id')]][$countryArr[$coa]][$result_color[csf('color_number_id')]][$result_color[csf('gmts_sizes')]];
					}
					?>
					<td style="border:1px solid black" ><? echo $result_color[csf('description')]; ?> </td>
					<td style="border:1px solid black" align="right" ><? echo $country_order_qty; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('item_color')]]; ?> </td>
					<td style="border:1px solid black; text-align:right">
					<? echo $result_color[csf('item_size')]; ?>
					</td>
                    <td style="border:1px solid black; text-align:right">
					<? echo $size_library[$result_color[csf('gmts_sizes')]]; ?>
					</td>
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('cons')],2);
					$item_desctiption_total += $result_color[csf('cons')] ;
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_arr_check[$order_uom_arr[$result_item[csf('trim_group')]]]= $order_uom_arr[$result_item[csf('trim_group')]];?></td>
					<td style="border:1px solid black; text-align:right">
					<?
					$cone_len=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_item[csf('trims_dtlsid')]]['cone_len'];
					echo number_format($cone_len,0);
					?>
                     </td>
                     <td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('rate')],6);
					?>
                     </td>
					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,2);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					?>
					</td>
                    <td style="border:1px solid black; text-align:right"><? $trim_amount= $trim_amount_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf("trim_group")]][$result_color[csf('description')]]['amount']; echo ($trim_amount*$costing_per_qty)/12;  ?></td>
				</tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="8"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><? echo number_format($item_desctiption_total,2); $grand_item_desctiption_total+=$item_desctiption_total; ?></td>
                <td style="border:1px solid black;  text-align:right"></td>
                <td style="border:1px solid black;  text-align:right"></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right; font-weight:bold;">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
            </tr>
            <?
            }

            ?>
        </table>
        <br/>
       <?
		}
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->


         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  id,trim_group,pre_cost_fabric_cost_dtls_id as trims_cost_dtlsid,country_id_string from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and sensitivity=0 and status_active=1 and is_deleted=0 and wo_qnty>0 order by trim_group ");
		if(count($nameArray_item)>0)
		{
        ?>
        <table  style="border:1px solid black" align="left" class=""  cellpadding="0" width="100%" cellspacing="0" rules="all" >

            <tr>
                <td colspan="11" align="">
                <strong><?

                $date_del=0;
				if($trim_type[$nameArray_item[0][csf('trim_group')]]==1)
				{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][70];
				}
				else{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][71];
				}
                 echo "Job NO:".$nameArray_job_po_row[csf('job_no')]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Style Ref:&nbsp; ".$style_ref." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO No:" .$po_num_arr[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO Qty:" .$po_qty_po_level[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; Delivery Date:" .change_date_format($deliver_date_arr[$nameArray_job_po_row[csf('po_break_down_id')]]);?></strong>
                </td>
            </tr>
            <tr>
                <td colspan="11" align="">
                <strong>No Sensitivity</strong>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Order Qty.</strong> </td>
                <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td align="center" style="border:1px solid black"><strong> Qnty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Conde Length</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cost/Dzn(USD)</strong></td>
            </tr>
            <?
			$i=0;
			$trim_amount_arr=array();
			$sql_trim_amount=sql_select("select  id,calculatorstring,cons_uom,trim_group,job_no,description, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."' and  status_active=1 and is_deleted=0 ");

			foreach($sql_trim_amount as $item)
            {
				$trim_amount_arr[$item[csf("job_no")]][$item[csf("trim_group")]][$item[csf("description")]]['amount']=$item[csf("amount")];
				$calculatorstring=explode("_",$item[csf('calculatorstring')]);
				$trims_cons_gmts_per_arr[$item[csf('trim_group')]][$item[csf('id')]]['cone_len']=$calculatorstring[2];
			}
			$grand_color_total=0;$uom_arr_check=array();
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$nameArray_item_description=sql_select( "select  b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and  a.id= ".$result_item[csf('id')]." and a.trim_group=".$result_item[csf('trim_group')]." and a.sensitivity=0 group by b.description, b.brand_supplier,b.item_color");

            $sql_trim_amount=sql_select("select  cons_uom, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."'  and trim_group=".$result_item[csf('trim_group')]." ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black; font-weight:bold;" rowspan="<? echo count($nameArray_item_description)+1; ?>">

                <?
				$group_arr_check[$result_item[csf('trim_group')]]=$result_item[csf('trim_group')];
				echo $trim_group[$result_item[csf('trim_group')]]."<br/>";
				$country_arr=explode(",",$result_item[csf('country_id_string')]);
				$country_name_string="";
				for($co=0; $co <count($country_arr);$co++)
				{
				 $country_name_string.=$country_library[$country_arr[$co]].",";
				}
				echo rtrim($country_name_string,',');
				?>
                </td>
                <?
                $color_tatal=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
					$country=rtrim($order_country_arr[$nameArray_job_po_row[csf('po_break_down_id')]],',');
					$countryArr=array_unique(explode(",",$country));
                $item_desctiption_total=0;
				$country_order_qty=0;
				/*for($coa=0; $coa <count($country_arr);$coa++)
				{
				 $country_order_qty+=$order_qty_arr[$nameArray_job_po_row[csf('po_break_down_id')]][$country_arr[$coa]];
				}*/
				for($coa=0; $coa <count($countryArr);$coa++)
				{
				 $country_order_qty+=$order_qty_arr[$nameArray_job_po_row[csf('po_break_down_id')]][$countryArr[$coa]];
				}

                ?>
                <td style="border:1px solid black"><? echo $result_itemdescription[csf('description')]; ?> </td>
                <td style="border:1px solid black" align="right"><? echo $country_order_qty; ?> </td>
                <td style="border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
                <?
				if($db_type==0)
				{
				$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=0 and  a.id= ".$result_item[csf('id')]." and a.trim_group=". $result_item[csf('trim_group')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
				}
				if($db_type==2)
				{
				$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=0 and  a.id= ".$result_item[csf('id')]." and a.trim_group=". $result_item[csf('trim_group')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
				}

                foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right;">
                <?
                if($result_color_size_qnty[csf('cons')]!= "")
                {
                echo number_format($result_color_size_qnty[csf('cons')],2);
                $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                $color_tatal+=$result_color_size_qnty[csf('cons')];
                }
                else echo "";
                ?>
                </td>
                <?
                }
                ?>

                <td style="border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; if($order_uom_arr[$result_item[csf('trim_group')]]>0) $uom_arr_check[]=$order_uom_arr[$result_item[csf('trim_group')]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? 
				$cone_len=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_item[csf('trims_cost_dtlsid')]]['cone_len'];
				echo number_format($cone_len,0); ?> </td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],6); ?> </td>
                <td style="border:1px solid black; text-align:right;">
                <?
                $amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                ?>
                </td>
                <td style="border:1px solid black; text-align:right;"><? $trim_amount= $trim_amount_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf("trim_group")]][$result_itemdescription[csf('description')]]['amount']; echo ($trim_amount*$costing_per_qty)/12;  ?></td>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="3"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;">
                <?
                if($color_tatal !='')
                {
                echo number_format($color_tatal,2);
				$grand_item_desctiption_total+= $color_tatal;
                }
                ?>
                </td>
                <td style="border:1px solid black;"></td>
                <td style="border:1px solid black;"></td>
                <td style="border:1px solid black; text-align:right"></td>
               <td style="border:1px solid black; text-align:right; font-weight:bold;">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                
                
                
            </tr>
            <?
            }
            ?>
        </table>
        <?
		}
		}
		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->
       &nbsp;
       <?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1){
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2){
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3){
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>
       <table  width="100%" class=""  style="border:1px solid black" cellpadding="0" cellspacing="0" rules="all" align="left">
            <tr style="border:1px solid black;">
                <td width="14%"  style="border:1px solid black; text-align:right; font-weight:bold; ">Total Order Qty:</td>
				<td width="17%"  style="border:1px solid black; text-align:right; font-weight:bold; "><? echo number_format($total_order_qty,2);?></td>
                <td width="22%" style="border:1px solid black;  text-align:right; font-weight:bold; "> Grand Total:</td>
                <td width="9%" style="border:1px solid black;  text-align:right; font-weight:bold; ">
				<?
				if(count($uom_arr_check)<2 && count($group_arr_check)<2){
					echo number_format($grand_item_desctiption_total,2);
				}
				?>
                </td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold; padding-right:160px;"><? echo number_format($grand_total_as_per_gmts_color,2);?></td>
            </tr>
            <tr style="border:1px solid black;">
                <td colspan="4" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                <td style="border:1px solid black;"><? echo number_to_words(def_number_format($grand_total_as_per_gmts_color,2,""),$mcurrency, $dcurrency);?></td>
            </tr>
       </table>
       &nbsp;

         <? echo get_spacial_instruction($txt_booking_no);?>

    <br>
    <?
	if(str_replace("'","",$show_comment)==1){
	?>
    <table cellspacing="0" cellpadding="0" style="border:1px solid black" rules="all" width="100%" class=""  align="left">
            <thead>
            	<tr>
                	<th colspan="9" style="font-size:18px; font-weight:bold;">Comments</th>
                </tr>
                <tr style="border:1px solid black">
                    <th width="30" style="border:1px solid black">SL</th>
                    <th width="120" style="border:1px solid black">Item</th>
                    <th width="120" style="border:1px solid black">PO No</th>
                    <th width="80" style="border:1px solid black">Pre-Cost Value</th>
                    <th width="80" style="border:1px solid black">Current Trims Value</th>
                    <th width="80" style="border:1px solid black">Main Trims Value</th>
                    <th width="80" style="border:1px solid black">Short Trims Value</th>
                    <th width="80" style="border:1px solid black">Sample Trims Value</th>
                    <th width="80" style="border:1px solid black">Total</th>
                    <th width="80" style="border:1px solid black">Balance</th>
                    <th style="border:1px solid black">Comments </th>
                </tr>
            </thead>
           <tbody>
           <?
					$condition= new condition();
					if($po_id!='' || $po_id!=0)
					{
						$condition->po_id("in($po_id)");
					}
					$condition->init();
					$trim= new trims($condition);
					//echo $trim->getQuery();die;
					$trims_costing_arr=$trim->getAmountArray_by_orderAndItemid();

					$sql_lib_item_group_array=array();
					$main_booking_array=array();
					$main_booking_array2=array();
					$sql_lib_item_group=sql_select("select id, item_name,conversion_factor,order_uom as cons_uom from lib_item_group");
					foreach($sql_lib_item_group as $row_sql_lib_item_group){
						$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][item_name]=$row_sql_lib_item_group[csf('item_name')];
						$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][conversion_factor]=$row_sql_lib_item_group[csf('conversion_factor')];
						$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][cons_uom]=$row_sql_lib_item_group[csf('cons_uom')];
					}

					$sql="select job_no,po_break_down_id,pre_cost_fabric_cost_dtls_id,trim_group,country_id_string from wo_booking_dtls where booking_no=$txt_booking_no and status_active=1 and is_deleted=0 group by job_no,po_break_down_id,pre_cost_fabric_cost_dtls_id,trim_group,country_id_string";

					$i=1;
					$total_amount=0;
					$pre_amount=0;
					$pre_amount_total=0;
					$cu_woq_amount_total=0;
					$cu_woq_amount_short_total=0;
					$cu_woq_amount_sample_total=0;
					$total_value_total=0;
					$trims_balance_total=0;
                    $nameArray=sql_select( $sql );
                    foreach ($nameArray as $selectResult){
						$costing_per=return_field_value("costing_per", "wo_pre_cost_mst", "job_no='".$selectResult[csf('job_no')]."'");
						if($costing_per==1){
							$costing_per_qty=12;
						}
						else if($costing_per==2){
							$costing_per_qty=1;
						}
						else if($costing_per==3){
							$costing_per_qty=24;
						}
						else if($costing_per==4){
							$costing_per_qty=36;
						}
						else if($costing_per==5){
							$costing_per_qty=48;
						}
						if($selectResult[csf('country_id_string')]!="") $contry_cond=" and c.country_id in(".$selectResult[csf('country_id_string')].")"; else $contry_cond="";
						$sql_po_qty=sql_select("select sum(c.order_quantity) as order_quantity,(sum(c.order_quantity)/a.total_set_qnty) as order_quantity_set  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and b.id=c.po_break_down_id and  b.id='".$selectResult[csf('po_break_down_id')]."' $contry_cond  and a.status_active=1 and b.status_active=1 and c.status_active=1 group by b.id,a.total_set_qnty");
						list($sql_po_qty_row)=$sql_po_qty;
						$po_qty=$sql_po_qty_row[csf('order_quantity_set')];

						$sql_cons_data=sql_select("select a.rate,b.cons from wo_pre_cost_trim_cost_dtls a , wo_pre_cost_trim_co_cons_dtls b where a.id=b.wo_pre_cost_trim_cost_dtls_id and  a.id='".$selectResult[csf('pre_cost_fabric_cost_dtls_id')]."' and b.po_break_down_id='".$selectResult[csf('po_break_down_id')]."' and a.is_deleted=0  and a.status_active=1");
						list($sql_cons_data_row)=$sql_cons_data;
						$pre_cons=$sql_cons_data_row[csf('cons')];
						$pre_rate=$sql_cons_data_row[csf('rate')];

						$pre_req_qnty=def_number_format(($pre_cons*($po_qty/$costing_per_qty))/$sql_lib_item_group_array[$selectResult[csf('trim_group')]][conversion_factor],2,"");
					//	$pre_amount=$pre_req_qnty*$pre_rate;
						


						$booking_no=str_replace("'","",$txt_booking_no);
						$booking_id=return_field_value("id","wo_booking_mst","booking_type=2 and booking_no='$booking_no'","id");
						$prev_book_cond="";
						if($booking_id>0) $prev_book_cond=" and a.id<$booking_id";


						$prev_wo_amt=sql_select("select sum(b.amount) as prev_amount, b.exchange_rate from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no and b.booking_no!=$txt_booking_no and b.po_break_down_id='".$selectResult[csf('po_break_down_id')]."' and b.pre_cost_fabric_cost_dtls_id='".$selectResult[csf('pre_cost_fabric_cost_dtls_id')]."' $prev_book_cond and  b.booking_type=2 and b.is_short=2 and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 group by b.exchange_rate");
						$prev_wo_amount=0;
						foreach($prev_wo_amt as $row)
						{
							$prev_wo_amount+=$row[csf("prev_amount")]/$row[csf("exchange_rate")];
						}


						$sql_cu_woq=sql_select("select sum(c.amount) as amount,sum(c.cons) as cons, b.exchange_rate ,c.rate
						from wo_booking_mst a, wo_booking_dtls b , wo_trim_book_con_dtls c
						where a.booking_no=b.booking_no and b.id=c.wo_trim_booking_dtls_id and b.booking_no=$txt_booking_no and b.po_break_down_id='".$selectResult[csf('po_break_down_id')]."' and c.status_active=1 and c.is_deleted=0   and b.pre_cost_fabric_cost_dtls_id='".$selectResult[csf('pre_cost_fabric_cost_dtls_id')]."'  and  b.booking_type=2 and  b.is_short=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.exchange_rate,c.rate");

						// $sql_cu_woq=sql_select("select sum(b.amount) as amount, b.exchange_rate from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and b.booking_no=$txt_booking_no and b.po_break_down_id='".$selectResult[csf('po_break_down_id')]."' and b.pre_cost_fabric_cost_dtls_id='".$selectResult[csf('pre_cost_fabric_cost_dtls_id')]."'  and  b.booking_type=2 and  b.is_short=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.exchange_rate");



						$cureent_wo_amt=0*1;
						foreach($sql_cu_woq as $row)
						{
							$cureent_wo_amt+=$row[csf("amount")]/$row[csf("exchange_rate")];
						}

						$cu_woq_amount=($cureent_wo_amt+$prev_wo_amount);

						

						$pre_amount=$trims_costing_arr[$selectResult[csf('po_break_down_id')]][$selectResult[csf('trim_group')]];
						if($pre_amount==0 || $pre_amount==""){
							$pre_amount=$cu_woq_amount;
						}


						$sql_cu_woq_short=sql_select("select sum(amount) as amount  from wo_booking_dtls where po_break_down_id='".$selectResult[csf('po_break_down_id')]."' and pre_cost_fabric_cost_dtls_id='".$selectResult[csf('pre_cost_fabric_cost_dtls_id')]."'  and  booking_type=2 and is_short=1 and status_active=1 and is_deleted=0");
						list($sql_cu_woq_row_short)=$sql_cu_woq_short;
						$cu_woq_amount_short=$sql_cu_woq_row_short[csf('amount')];

						$sql_cu_woq_sample=sql_select("select sum(amount) as amount  from wo_booking_dtls where po_break_down_id='".$selectResult[csf('po_break_down_id')]."' and pre_cost_fabric_cost_dtls_id='".$selectResult[csf('pre_cost_fabric_cost_dtls_id')]."'  and  booking_type=5 and status_active=1 and is_deleted=0");
						list($sql_cu_woq_row_sample)=$sql_cu_woq_sample;
						$cu_woq_amount_sample=$sql_cu_woq_row_sample[csf('amount')];
						$totCUAmt=$cu_woq_amount+$cu_woq_amount_short+$cu_woq_amount_sample;
						//echo $totCUAmt.','.$cu_woq_amount_short.','.$cu_woq_amount_sample.'<br> ';
						if($cu_woq_amount_short==0 || $cu_woq_amount_short=='')  $cu_woq_amount_short=0;else $cu_woq_amount_short=$cu_woq_amount_short/$exchange_rate;
						if($cu_woq_amount_sample==0 || $cu_woq_amount_sample=='')  $cu_woq_amount_sample=0;else $cu_woq_amount_sample=$cu_woq_amount_sample/$exchange_rate;
						//if($totCUAmt==0 || $totCUAmt=='')  $total_value=0;
						 $total_value=($cu_woq_amount)+($cu_woq_amount_short)+($cu_woq_amount_sample);
						
						$trims_balance=$pre_amount-$total_value;
						?>
						<tr style="border:1px solid black">
                            <td style="border:1px solid black"><? echo $i;?></td>
                            <td style="border:1px solid black"><? echo $trim_group[$selectResult[csf('trim_group')]];?></td>
                            <td style="border:1px solid black"><? echo $po_num_arr[$selectResult[csf('po_break_down_id')]];?>  </td>
                            <td align="right" style="border:1px solid black"><? echo number_format($pre_amount,2);$pre_amount_total+=$pre_amount; ?></td>
                            <td align="right" style="border:1px solid black"><? echo number_format($cureent_wo_amt,2);$totcureent_wo_amt+=$cureent_wo_amt; ?></td>
                            <td align="right" style="border:1px solid black"><? echo number_format($cu_woq_amount,2);$cu_woq_amount_total+=$cu_woq_amount;?></td>
                            <td align="right" title="<? echo $cu_woq_amount_short.'='.$exchange_rate;?>" style="border:1px solid black"><? if($cu_woq_amount_short=='' || $cu_woq_amount_short==0) {  echo $cu_woq_amount_short=0;
							$cu_woq_amount_short_total+=0;}
							else { echo number_format($cu_woq_amount_short/$exchange_rate,2); $cu_woq_amount_short_total+=($cu_woq_amount_short/$exchange_rate); }
							?></td>
                            <td align="right" style="border:1px solid black"><? if($cu_woq_amount_sample=='' || $cu_woq_amount_sample==0) {
								echo $cu_woq_amount_sample=0;
								$cu_woq_amount_sample_total+=0;
							}
							else { echo number_format($cu_woq_amount_sample/$exchange_rate,2);
							$cu_woq_amount_sample_total+=($cu_woq_amount_sample/$exchange_rate);
							}
							?></td>
                            <td align="right" style="border:1px solid black"><? if($total_value=='' || $total_value==0) echo 0;else echo number_format($total_value,2);$total_value_total+=$total_value?></td>
                              <td align="right" style="border:1px solid black"><? if($trims_balance=='' || $trims_balance==0) echo 0; 
							if($trims_balance<o.ooo1){
								echo 00.00;
							}else{
							echo number_format($trims_balance,2,'.','');$trims_balance_total+=$trims_balance;}
							?></td>
                            <?
                                $pre_amount_req=number_format($pre_amount,2,'.','');
								$total_value_req=number_format($total_value,2,'.','');
								?>
                            <td align="right" style="border:1px solid black" title="<? echo "PreCost=".$pre_amount_req.',Wo Cost='.$total_value_req;?>">
                            <?
                           /* if($pre_amount==($total_value)) echo "At Per";
                            if($pre_amount>($total_value)) echo "Less Booking";
                            if($pre_amount<($total_value)) echo "Over Booking";*/
							if($pre_amount_req==($total_value_req)) echo "At Per";
								elseif($pre_amount_req>($total_value_req)) echo "Less Booking";
								elseif($pre_amount_req<($total_value_req)) echo "Over Booking";
                            ?>
                            </td>
						</tr>
						<?
                        $i++;
                    }
					?>
		</tbody>
        <tfoot>
         <tr align="right">
                    <th colspan="3" style="border:1px solid black">Total:</th>
                    <th style="border:1px solid black"><? echo number_format($pre_amount_total,2); ?></th>
                    <th style="border:1px solid black"><? echo number_format($totcureent_wo_amt,2); ?></th>
                    <th style="border:1px solid black"><? echo number_format($cu_woq_amount_total,2); ?></th>
                    <th style="border:1px solid black"><?  if($cu_woq_amount_short_total=='' || $cu_woq_amount_short_total==0) echo 0;else echo number_format($cu_woq_amount_short_total,2); ?></th>
                    <th style="border:1px solid black"><?  if($cu_woq_amount_sample_total=='' || $cu_woq_amount_sample_total==0) echo 0;else echo number_format($cu_woq_amount_sample_total,2); ?></th>
                    <th style="border:1px solid black"><? if($total_value_total=='' || $total_value_total==0) echo 0; echo number_format($total_value_total,2); ?></th>
                    <th style="border:1px solid black"><? if($trims_balance_total=='' || $trims_balance_total==0) echo 0; echo number_format($trims_balance_total,2); ?></th>
                    <th style="border:1px solid black"></th>
         </tr>
         </tfoot>
    </table>
    <?
	}
	?>
           <br>
        <!--<div style="max-width:1000;">-->
      	<style>
			.rpt_ntable{
				border:1px solid black;
			}
			.rpt_ntable tr{
				border:1px solid black;
			}
			.rpt_ntable tr td{
				border:1px solid black;
			}
		</style>
        <table width="100%"  class="rpt_ntable"  cellpadding="0" cellspacing="0" rules="all"  align="left">
          <tr><td colspan="14" align="center"><b>TNA Information</b></td></tr>
            <tr>
            	<td rowspan="2" align="center" valign="top">SL</td>
            	<td width="180" rowspan="2"  align="center" valign="top"><b>Order No</b></td>
                <td colspan="2" align="center" valign="top"><b>Trims Book[SnF]</b></td>
                <td colspan="2" align="center" valign="top"><b>Sew Trims Rcv.</b></td>
                <td colspan="2" align="center" valign="top"><b>Cutting</b></td>
                <td colspan="2" align="center" valign="top"><b>Fin Trims Rcv. </b></td>
                <td colspan="2" align="center" valign="top"><b>Sewing </b></td>
                <td colspan="2"  align="center" valign="top"><b>Ex-factory </b></td>
            </tr>
            <tr>
            	<td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>

            </tr>
            <?
			$i=1;
			foreach($tna_date_task_arr as $order_id=>$row){
				?>
                <tr>
                	<td><? echo $i; ?></td>
                    <td><? echo $po_num_arr[$order_id]; ?></td>
                	<td align="center"><? echo change_date_format($row['trims_booking_start_date']); ?></td>
                    <td  align="center"><? echo change_date_format($row['trims_booking_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['Sew_Trims_rcv_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['Sew_Trims_rcv_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['cutting_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['cutting_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['fin_Trims_rcv_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['fin_Trims_rcv_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['sewing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['sewing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['exfact_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['exfact_end_date']); ?></td>
                </tr>
                <?
				$i++;
			}
			?>

            <tr>

            </tr>

        </table>

        <br>

        <table cellspacing="0" cellpadding="0" rules="all" width="100%" class=""  align="left">
        	<tr>
            	<td>
				<?
					echo signature_table(2, $cbo_company_name, "1030px");
					echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
				?>
                </td>
            </tr>
        </table>
        <!--</div>  -->

    </div>
	<?
	if($link==1){
		?>
		<script type="text/javascript" src="../../../js/jquery.js"></script>
		<script type="text/javascript" src="../../../js/jquerybarcode.js"></script>
		<?
	}
	else{
		?>
		<script type="text/javascript" src="../../js/jquery.js"></script>
		<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
		<?
	}
	?>
	<script>
	fnc_generate_Barcode('<? echo $varcode_booking_no; ?>','barcode_img_id');
	</script>
	<?
       $html = ob_get_contents();
	   ob_clean();

	   list($is_mail_send,$mail)=explode('___',$mail_send_data);
	   if($is_mail_send==1){
		   require_once('../../../mailer/class.phpmailer.php');
		   require_once('../../../auto_mail/setting/mail_setting.php');
		   $mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
			   
		   $mailToArr=array();
		   $mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
		   //echo $mailSql;die;
		   $mailSqlRes=sql_select($mailSql);
		   foreach($mailSqlRes as $rows){
			   if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		   }
		   
		   
		   $mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=97 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
		   //echo $mailSql;die;
		   $mailSqlRes=sql_select($mailSql);
		   foreach($mailSqlRes as $rows){
			   if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		   }
		   if($mail!=''){$mailToArr[]=$mail;}
		   $to=implode(',',$mailToArr);
		   
		   $subject="Trims Booking Multy Job";
		   $header=mailHeader();
		   echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
		   
	   }
	   else{
		   echo $html;
	   }
	   exit();
}


if ($action=="unapp_request_popup"){
	$menu_id=$_SESSION['menu_id'];
	$user_id=$_SESSION['logic_erp']['user_id'];

	echo load_html_head_contents("Un Approval Request","../../../", 1, 1, $unicode);
	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));

	$data_all=explode('_',$data);
	$booking_no=$data_all[0];
	$unapp_request=$data_all[1];

	$wo_id=return_field_value("id", "wo_booking_mst", "booking_no='$booking_no' and status_active=1 and is_deleted=0");
	if($unapp_request=="")
	{
		 $sql_request="select MAX(id) as id from fabric_booking_approval_cause where page_id='$menu_id' and entry_form=8 and user_id='$user_id' and booking_id='$wo_id' and approval_type=2 and status_active=1 and is_deleted=0";


		$nameArray_request=sql_select($sql_request);
		foreach($nameArray_request as $row)
		{
			$unapp_request=return_field_value("approval_cause", "fabric_booking_approval_cause", "id='".$row[csf('id')]."' and status_active=1 and is_deleted=0");
		}
	}
	?>
    <script>

		$( document ).ready(function() {
			document.getElementById("unappv_request").value='<? echo $unapp_request; ?>';
		});

		var permission='<? echo $permission; ?>';

		function fnc_appv_entry(operation)
		{
			var unappv_request = $('#unappv_request').val();

			if (form_validation('unappv_request','Un Approval Request')==false)
			{
				if (unappv_request=='')
				{
					alert("Please write request.");
				}
				return;
			}
			else
			{

				var data="action=save_update_delete_unappv_request&operation="+operation+get_submitted_data_string('unappv_request*wo_id*page_id*user_id',"../../../");
				//alert (data);return;
				freeze_window(operation);
				http.open("POST","trims_booking_multi_job_controllerurmi.php",true);
				http.setRequestHeader("Content-type","application/x-www-form-urlencoded");
				http.send(data);
				http.onreadystatechange=fnc_appv_entry_Reply_info;
			}
		}

		function fnc_appv_entry_Reply_info()
		{
			if(http.readyState == 4)
			{
				var reponse=trim(http.responseText).split('**');
				show_msg(reponse[0]);

				set_button_status(1, permission, 'fnc_appv_entry',1);
				release_freezing();

			}
		}

		function fnc_close()
		{
			unappv_request= $("#unappv_request").val();

			document.getElementById('hidden_appv_cause').value=unappv_request;

			parent.emailwindow.hide();
		}

    </script>
    <body>
		<div align="center" style="width:100%;">
        <? echo load_freeze_divs ("../../",$permission,1); ?>
        <form name="size_1" id="size_1">
			<fieldset style="width:450px;">
            <table align="center" cellspacing="0" width="450" class="rpt_table" border="1" rules="all" id="size_tbl" >
                <tr id="row_1">
                    <td width="150" align="center" >
                    	<textarea name="unappv_request" id="unappv_request" class="text_area" style="width:430px; height:100px;" maxlength="500" title="Maximum 500 Character"></textarea>
                        <Input type="hidden" name="wo_id" class="text_boxes" ID="wo_id" value="<? echo $wo_id; ?>" style="width:30px" />
                        <Input type="hidden" name="page_id" class="text_boxes" ID="page_id" value="<? echo $menu_id; ?>" style="width:30px" />
                        <Input type="hidden" name="user_id" class="text_boxes" ID="user_id" value="<? echo $user_id; ?>" style="width:30px" />
                    </td>
                </tr>
            </table>

            <table align="center" cellspacing="0" width="450" class="rpt_table" border="1" rules="all" id="" >

                <tr>
                    <td align="center" class="button_container">
                        <?
                            if($id_up!='')
                            {
                                echo load_submit_buttons($permission, "fnc_appv_entry", 1,0,"reset_form('size_1','','','','','');",1);
                            }
                            else
                            {
                                echo load_submit_buttons($permission, "fnc_appv_entry", 0,0,"reset_form('size_1','','','','','');",1);
                            }
                        ?>
                        <input type="hidden" name="hidden_appv_cause" id="hidden_appv_cause" class="text_boxes /">

                    </td>
                </tr>
                <tr>
                    <td align="center">
                        <input type="button" name="close" class="formbutton" value="Close" id="main_close" onClick="fnc_close();" style="width:100px" />
                    </td>
                </tr>
            </table>
            </fieldset>
            </form>
        </div>
    </body>
    <script src="../../../includes/functions_bottom.js" type="text/javascript"></script>
    </html>
    <?
	exit();
}

if ($action=="save_update_delete_unappv_request"){

	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	if ($operation==0)  // Insert Here
	{
		$con = connect();
		if($db_type==0)
		{
			mysql_query("BEGIN");
		}

		$approved_no=return_field_value("MAX(approved_no)","approval_history","entry_form=8 and mst_id=$wo_id");

		$unapproved_request=return_field_value("id","fabric_booking_approval_cause","page_id=$page_id and entry_form=8 and user_id=$user_id and booking_id=$wo_id and approval_type=2 and approval_no=$approved_no");

		if($unapproved_request=="")
		{

			$id_mst=return_next_id( "id", "fabric_booking_approval_cause", 1 ) ;

			$field_array="id,page_id,entry_form,user_id,booking_id,approval_type,approval_no,approval_cause,inserted_by,insert_date,status_active,is_deleted";
			$data_array="(".$id_mst.",".$page_id.",8,".$user_id.",".$wo_id." ,2,".$approved_no.",".$unappv_request.",".$_SESSION['logic_erp']['user_id'].",'".$pc_date_time."',1,0)";
			$rID=sql_insert("fabric_booking_approval_cause",$field_array,$data_array,0);

			if($db_type==0)
			{
				if($rID )
				{
					mysql_query("COMMIT");
					echo "0**".$rID."**".str_replace("'","",$wo_id)."**".str_replace("'","",$unappv_request)."**".str_replace("'","",$user_id);
				}
				else
				{
					mysql_query("ROLLBACK");
					echo "10**".$rID;
				}
			}
			if($db_type==2)
			{
				if($rID )
				{
					oci_commit($con);
					echo "0**".$rID."**".str_replace("'","",$wo_id)."**".str_replace("'","",$unappv_request)."**".str_replace("'","",$user_id);
				}
				else
				{
					oci_rollback($con);
					echo "10**".$rID;
				}
			}
			if($db_type==1 )
			{

				echo "0**".$rID."**".$wo_id;
			}
			disconnect($con);
			die;
		}
		else
		{
			$con = connect();
			if($db_type==0)
			{
				mysql_query("BEGIN");
			}

			$field_array="page_id*entry_form*user_id*booking_id*approval_type*approval_no*approval_cause*updated_by*update_date*status_active*is_deleted";
			$data_array="".$page_id."*8*".$user_id."*".$wo_id."*2*".$approved_no."*".$unappv_request."*".$_SESSION['logic_erp']['user_id']."*'".$pc_date_time."'*1*0";

			 $rID=sql_update("fabric_booking_approval_cause",$field_array,$data_array,"id","".$unapproved_request."",0);

			if($db_type==0)
			{
				if($rID )
				{
					mysql_query("COMMIT");
					echo "1**".$rID."**".str_replace("'","",$wo_id)."**".str_replace("'","",$unappv_request)."**".str_replace("'","",$user_id);
				}
				else
				{
					mysql_query("ROLLBACK");
					echo "10**".$rID;
				}
			}

			if($db_type==2)
			{
				if($rID )
				{
					oci_commit($con);
					echo "1**".$rID."**".str_replace("'","",$wo_id)."**".str_replace("'","",$unappv_request)."**".str_replace("'","",$user_id);
				}
				else
				{
					oci_rollback($con);
					echo "10**".$rID;
				}
			}
			if($db_type==1 )
			{
				echo "1**".$rID."**".str_replace("'","",$wo_id);
			}
			disconnect($con);
			die;
		}
	}
	if ($operation==1)  // Update Here
	{

	}
}

if($action=="show_trim_booking_report13")
{
	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);
	$path=str_replace("'","",$path);
	
	if(empty($path))
	{
		$path='../../';
	}

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from lib_country",'id','country_name');
	//$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');

	//$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");
	$lib_user=return_library_array("select id,user_full_name from user_passwd","id","user_full_name");

	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;

	$supplier_data=sql_select("SELECT id,supplier_name,address_1, contact_no, email from lib_supplier where status_active=1 and is_deleted=0");
	foreach ($supplier_data as $row) {
		$supplier_name_arr[$row[csf('id')]]=$row[csf('supplier_name')];
		$supplier_address_arr[$row[csf('id')]]=$row[csf('address_1')];
		$supplier_info_arr[$row[csf('id')]]['tel']=$row[csf('contact_no')];
		$supplier_info_arr[$row[csf('id')]]['email']=$row[csf('email')];
	}

	$booking_grand_total=0; $currency_id="";

	$buyer_string=array(); $style_owner=array(); $job_no=array(); $style_ref=array(); $all_dealing_marcent=array(); $season=array(); $order_repeat_no=array(); $po_id_arr=array(); $trimsDtlsIdArr=array();

	$nameArray_buyer=sql_select( "select  a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, b.po_break_down_id, b.pre_cost_fabric_cost_dtls_id from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
	foreach ($nameArray_buyer as $result_buy){
		$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
		$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
		$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
		$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
		$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
		//$season[$result_buy[csf('job_no')]]=$season_arr[$result_buy[csf('season_matrix')]];
		$season_matrix=$result_buy[csf('season_matrix')];
		$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
		if($season_matrix!=0 && $season_buyer_wise==0 )
		{
			$season_matrix_con=$season_matrix;
		}
		else if($season_buyer_wise!=0 && $season_matrix==0)
		{
			$season_matrix_con=$season_buyer_wise;
		}
		$seasons_name.=$season_arr[$season_matrix_con].',';
		$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
		$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

		$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];
		$trimsDtlsIdArr[$result_buy[csf('pre_cost_fabric_cost_dtls_id')]]=$result_buy[csf('pre_cost_fabric_cost_dtls_id')];
	}
	$trmsDtlsIdCond=where_con_using_array($trimsDtlsIdArr,0,'master_tble_id');
	$trimsImge_arr=return_library_array("select master_tble_id, image_location from common_photo_library where form_name='pre_cost_trimsv3' and file_type=1 $trmsDtlsIdCond",'master_tble_id','image_location');
	
	$style_sting=implode(",",array_unique($style_ref));
	$job_no_str = "'" . implode( "','", $job_no ) . "'";
	$job_no=implode(",",$job_no);
	$seasons_names=rtrim($seasons_name,',');

	$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));
	$poid_arr=array_unique($po_id_arr);

	$order_rept_no=rtrim($order_rept_no,',');
	$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));
	$main_fabric_approved = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and a.job_no in (".$job_no_str.") and b.entry_form=7 and a.status_active =1 and a.is_deleted=0 order by b.id asc");

	$po_no=array(); $file_no=array(); $ref_no=array(); $po_quantity=array();
	$pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';
	$nameArray_job=sql_select( "select b.job_no_mst, b.id, b.pub_shipment_date, b.po_number, b.grouping, b.file_no, sum(b.po_quantity) as po_quantity from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst, b.id, b.pub_shipment_date, b.po_number, b.grouping, b.file_no");
	foreach ($nameArray_job as $result_job){
		$po_no[$result_job[csf('job_no_mst')]][$result_job[csf('id')]]=$result_job[csf('po_number')];
		$file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
		$ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
		$po_quantity[$result_job[csf('id')]]=$result_job[csf('po_quantity')];
	//	$tot_po_quantity+=$result_job[csf('po_quantity')];
		$job_ref_no[$result_job[csf('job_no_mst')]].=$result_job[csf('grouping')].',';
		$job_file_no[$result_job[csf('job_no_mst')]].=$result_job[csf('file_no')].',';
		$po_no_arr[$result_job[csf('job_no_mst')]]['po_id'].=$result_job[csf('id')].',';
		$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
		$int_ref_no.=$result_job[csf('grouping')].',';
		if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];

	}
		//echo $po_idss.'DDDDDDDDD';
	$sql_job=sql_select( "select b.job_no_mst,b.id as po_id, b.po_quantity as po_quantity  from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.") ");
	foreach ($sql_job as $row)
	{
		$job_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('po_id')]]+=$row[csf('po_quantity')];
		$tot_po_quantity+=$row[csf('po_quantity')];
	}

	$nameArray=sql_select( "select a.booking_no, a.is_approved, a.pay_mode, a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.source, a.remarks, a.revised_no, a.delivery_address, a.tenor, a.inserted_by, a.insert_date from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
	foreach( $nameArray as $row)
	{
		$varcode_booking_no=$row[csf('booking_no')];
		$booking_date=$row[csf('booking_date')];
		$delivery_date=$row[csf('delivery_date')];
		$pay_mode_id=$row[csf('pay_mode')];
		$supplier_id=$row[csf('supplier_id')];
		$currency_id=$row[csf('currency_id')];
		$buyer_id=$row[csf('buyer_id')];
		$exchange_rate=$row[csf('exchange_rate')];
		$attention=$row[csf('attention')];
		$remarks=$row[csf('remarks')];
		$revised_no=$row[csf('revised_no')];
		$source_id=$row[csf('source')];
		$is_approved=$row[csf('is_approved')];
		$delivery_address=$row[csf('delivery_address')];
		$tenor=$row[csf('tenor')];
	}
	$approved_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name, b.id from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0 order by b.id asc");

	 $sql_date_update=sql_select("SELECT a.updated_by, a.booking_no, a.update_date
				  FROM wo_booking_dtls a, wo_booking_dtls b
				 WHERE a.booking_no = b.booking_no AND a.update_date >= b.update_date
				 and a.booking_no='$txt_booking_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.update_date desc");
	 $sql_date_insert=sql_select("SELECT a.inserted_by, a.booking_no,a.insert_date
						  FROM wo_booking_dtls a, wo_booking_dtls b
						 WHERE a.booking_no = b.booking_no AND a.insert_date <= b.insert_date
						 and a.booking_no='$txt_booking_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.insert_date");
	
	ob_start();
	
	?>
	<style type="text/css">
		.container table {
		  border-collapse: collapse;
		  border: solid 1px #000;
		}
		.container table td {
		  border: solid 1px #000;
		}
		.no-border-right {
		  border-right: solid 1px #FFF;		  
		}
	</style>
			<?
            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website,contact_no from lib_company where id=$cbo_company_name");
            foreach ($nameArray as $result){              
                if($result[csf('plot_no')]!='')
                {
                    $plot_no=$result[csf('plot_no')];
                }
                if($result[csf('level_no')]!='')
                {
                    $level_no=$result[csf('level_no')];
                }
                if($result[csf('road_no')]!='')
                {
                    $road_no=$result[csf('road_no')];
                }
                if($result[csf('block_no')]!='')
                {
                    $block_no=$result[csf('block_no')];
                }
                if($result[csf('city')]!='')
                {
                    $city=$result[csf('city')];
                }
                $company_address[$result[csf('id')]]['address']=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
                $company_address[$result[csf('id')]]['tel']=$result[csf('contact_no')];
                $company_address[$result[csf('id')]]['email']=$result[csf('email')];
            }
        ?>
			<table border="1" align="left" class="rpt_table container"  cellpadding="0" width="1000" cellspacing="0" rules="all" style="padding-bottom: 10px">
       		<tr>
       			<td colspan="2" width="100" class="no-border-right"><img src='<?=$path?>/<? echo $imge_arr[$cbo_company_name]; ?>' height='60' width='100'  /></td>
       			<td colspan="4" width="900">
                <div style="font-size: 20px; font-weight: bold; width:50%; text-align: center;"><?=$company_library[$cbo_company_name]; ?></div>
                <div style="font-size: 16px; width:50%; text-align: center;"><?=$company_address[$cbo_company_name]['address'] ?><br>TEL# <? echo $company_address[$cbo_company_name]['tel'] ?><br>E-Mail: <? echo $company_address[$cbo_company_name]['email'] ?></div></td>
       		</tr>
       		<tr>
       			<td colspan="6" align="center" style="font-size: 18px; font-weight: bold;">Trims Purchase Order- <?=$txt_booking_no ?></td>
       		</tr>
       		<tr>
       			<td colspan="3">Beneficiary:</td>
       			<td colspan="3">Consignee:</td>
       		</tr>
       		<tr>
       			<td colspan="3" style="word-break:break-all"><span style="font-weight: bold;"><?
                    if($pay_mode_id==5 || $pay_mode_id==3){
                        echo $company_library[$supplier_id];
                    }
                    else{
                        echo $supplier_name_arr[$supplier_id];
                    }
                    ?></span><br><?
	                if($pay_mode_id==5 || $pay_mode_id==3){
	                    echo $company_address[$supplier_id]['address'];
	                }
	                else{
	                    echo $supplier_address_arr[$supplier_id];
	                }
                ?><br>TEL# <?
	                if($pay_mode_id==5 || $pay_mode_id==3){
	                    echo $company_address[$supplier_id]['tel'];
	                }
	                else{
	                    echo $supplier_info_arr[$supplier_id]['tel'];
	                }
                ?><br>E-mail: <?
	                if($pay_mode_id==5 || $pay_mode_id==3){
	                    echo $company_address[$supplier_id]['email'];
	                }
	                else{
	                    echo $supplier_info_arr[$supplier_id]['email'];
	                }
                ?></td>
       			<td colspan="3" style="word-break:break-all"><span style="font-weight: bold;"><?=$company_library[$cbo_company_name]; ?></span><br><?=$company_address[$cbo_company_name]['address'] ?><br>TEL# <?=$company_address[$cbo_company_name]['tel'] ?><br>E-Mail: <?=$company_address[$cbo_company_name]['email'] ?></td>
       		</tr>
       		<tr>
       			<th width="120" align="left">Issue Date</th>
       			<td width="150"><?=change_date_format($booking_date); ?></td>
       			<th width="120" align="left">Delivery Date</th>
       			<td width="150"><?=change_date_format($delivery_date); ?></td>
       			<th width="120" align="left">Buyer</th>
       			<td><?=$buyer_name_arr[$buyer_id]; ?></td>
       		</tr>
            <tr>
            	<th align="left">Contact Person</th>
       			<td><?=$attention; ?></td>
            	<td>Delivery Address</td>
                <td style="word-break:break-all" colspan="3"><?=$delivery_address; ?></td>
            </tr>
            <tr>
            	<td>Tenor</td>
                <td><?=$tenor; ?></td>
                <td>Remarks</td>
                <td colspan="5" style="word-break:break-all"><?=$remarks; ?></td>
            </tr>
        </table>
		&nbsp;</br>
        <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?
		$precost_arr=array(); $trims_qtyPerUnit_arr=array();

		$precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0");
        $calUom="";
		foreach($precost_sql as $precost_row){
			if($precost_row[csf('cal_parameter')]==1){
			   $calUom="Mtr";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==2){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==3){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==4){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==5){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==6){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==7){
			   $calUom="Pcs";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==8){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else{
				$calUom=0;
			}
			 $trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
		}
		$booking_country_arr=array();
		$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,sensitivity,country_id_string from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0");
		foreach($nameArray_booking_country as $nameArray_booking_country_row){
			$country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
			$tocu=count($country_id_string);
			for($cu=0;$cu<$tocu;$cu++){
				$booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
			}
		}

		$nameArray_job_po=sql_select( "select job_no from wo_booking_dtls  where booking_no='$txt_booking_no' and status_active =1 and is_deleted=0 group by job_no order by job_no ");
		foreach($nameArray_job_po as $nameArray_job_po_row){
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$nameArray_job_po_row[csf('job_no')]."'   and sensitivity=1 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
	    if(count($nameArray_item)>0){
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];//$po_quantity[$poid]; 
			}
        ?>
		<br>
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="1000px" cellspacing="0" rules="all" >
            <tr>
               
                        <td colspan="5" align="left"><strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; if($ref_nos!='' ) echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;else " ";if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;  Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                        <td colspan="5" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                   
            </tr>
            <tr>
                <td style="border:1px solid black" width="30"><strong>SL</strong> </td>
                <td style="border:1px solid black" width="100"><strong>Item Group</strong> </td>
                <td style="border:1px solid black" width="50"><strong>IMG</strong> </td>
                <td style="border:1px solid black" width="140"><strong>Item Description</strong> </td>
                <td style="border:1px solid black" width="70"><strong>Brand/ Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black" width="170"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black" width="60"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center" width="70"><strong>WO Qty</strong></td>
                <td style="border:1px solid black" align="center" width="50"><strong>UOM</strong></td>
				  <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center" width="60"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center" width="80"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center" width="120"><strong>Remarks</strong></td>
                <? }?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item){
			$i++;
            $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, min(b.id) as bid, b.description, b.brand_supplier, b.item_color, sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.rate*b.requirment) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<?=count($nameArray_item_description)+1; ?>"><?=$i; ?></td>
                <td align="center" style="border:1px solid black" rowspan="<?=count($nameArray_item_description)+1; ?>">
					<?
                    echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
                    echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
                    ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<?=count($nameArray_item_description)+1; ?>"><img src='<?=$path?>/<?=$trimsImge_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]; ?>' height='50' width='50' /></td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription){
                ?>
                <td style="border:1px solid black"><?  if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?

				echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_itemdescription[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right" title="Avg Rate"><? echo number_format( $result_itemdescription[csf('amount')]/$result_itemdescription[csf('cons')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('amount')];
				// $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>

                 <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

					echo number_format($item_desctiption_total ,0);
				 ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="9"><strong>Total</strong></td>
				  <? if($show_comment==1) {?>
				 <td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->


        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=2 and  status_active =1 and  is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="1000px" cellspacing="0" rules="all" style="margin-top: 10px">
            <tr>
                
                <td colspan="5"><strong>Size Sensitive (<?="Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <?="Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; echo "&nbsp;&nbsp;Int Ref.:".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp; Po Qty..:".$po_no_qty; ?></strong></td>
                <td colspan="5" style="word-break:break-all; font-weight:bold;">Po No: <?=implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
               
            </tr>
            <tr>
                <td width="30" style="border:1px solid black"><strong>Sl</strong> </td>
                <td width="100" style="border:1px solid black"><strong>Item Group</strong> </td>
                <td width="50" style="border:1px solid black"><strong>IMG</strong> </td>
                <td width="140" style="border:1px solid black"><strong>Item Description</strong> </td>
                <td width="70" style="border:1px solid black"><strong>Brand/ Supplier Ref.</strong> </td>
                <td width="70" align="center" style="border:1px solid black"><strong>Article No</strong></td>
                <td width="70" align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td width="60" align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td width="70" style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td width="50" style="border:1px solid black" align="center"><strong>UOM</strong></td>
				 <? if($show_comment==1) {?>
                <td width="60" style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td width="80" style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td width="110" style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
			$i++;
			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,b.article_number,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size,b.article_number order by bid");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<?=count($nameArray_item_description)+1; ?>"><?=$i ; ?></td>
                <td align="center" style="border:1px solid black" rowspan="<?=count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][2]);
				?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<?=count($nameArray_item_description)+1; ?>"><img src='<?=$path?>/<?=$trimsImge_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]; ?>' height='50' width='50' /></td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black">
				<?
				if($result_itemdescription[csf('article_number')]!="no article"){
					echo $result_itemdescription[csf('article_number')];
				}else{
					echo "-";
				}
				?>
                </td>
                <td style="border:1px solid black; text-align:left"><?=$result_itemdescription[csf('item_size')]; ?></td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <td style="border:1px solid black; text-align:right"><?=number_format($result_itemdescription[csf('cons')],4);

                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_itemdescription[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];

				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                <td style="border:1px solid black; text-align:right"><p><?=$trims_remark; ?> </p></td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold"><?

					echo number_format($item_desctiption_total,0);
				 ?></td>
                 <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
				 <? if($show_comment==1) {?>
					<td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=3 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>
        <table border="1" align="left" cellpadding="0" width="1000px" cellspacing="0" rules="all" style="margin-top: 10px">
            <tr>
                
                <td colspan="5"><strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td colspan="5" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                
            </tr>
            <tr>
                <td width="20" style="border:1px solid black"><strong>Sl</strong> </td>
                <td width="100" style="border:1px solid black"><strong>Item Group</strong> </td>
                <td width="50" style="border:1px solid black"><strong>IMG</strong> </td>
                <td width="140" style="border:1px solid black"><strong>Item Description</strong> </td>
                <td width="70" style="border:1px solid black"><strong>Brand/ Supplier Ref.</strong> </td>
                <td width="100" align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td width="100" align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td width="50" align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td width="70" style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td width="50" style="border:1px solid black" align="center"><strong>UOM</strong></td>
				 <? if($show_comment==1) {?>
                <td width="60" style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td width="80" style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <td width="110" style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by trim_group ", "item_color", "color_number_id"  );

			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,b.color_number_id order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
				?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<?=count($nameArray_item_description)+1; ?>"><img src='<?=$path?>/<?=$trimsImge_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]; ?>' height='50' width='50' /></td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   echo $color_library[$result_itemdescription[csf('color_number_id')]];
			   ?>
                </td>
               <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>

                <td style="border:1px solid black; text-align:right">
				<?
				echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_itemdescription[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];

				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?></p> </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				echo number_format($item_desctiption_total,0);
				 ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
				<? if($show_comment==1) {?>
				<td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group");
	   if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));

			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="1000px" cellspacing="0" rules="all" style="margin-top: 10px">
            <tr>
               
                <td colspan="5" ><strong>Color & size sensitive (<? echo "Job NO: ".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]] ;echo "&nbsp;&nbsp;Int Ref.:&nbsp;".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td colspan="5" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
               
            </tr>
            <tr>
                <td width="20" style="border:1px solid black"><strong>SL</strong> </td>
                <td width="90" style="border:1px solid black"><strong>Item Group </strong> </td>
                <td width="50" style="border:1px solid black"><strong>IMG</strong> </td>
                <td width="120" style="border:1px solid black"><strong>Item Description</strong> </td>
                <td width="70" style="border:1px solid black"><strong>Brand/ Supplier Ref.</strong> </td>
                <td width="70" style="border:1px solid black"><strong>Article No.</strong> </td>
                <td width="80" style="border:1px solid black"><strong>Item Color</strong> </td>
                <td width="80" style="border:1px solid black;"><strong>Gmts Color</strong> </td>
                <td width="50" style="border:1px solid black;"><strong>Gmts Size</strong> </td>

                <td width="50" align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td width="40" align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td width="60" style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td width="40" style="border:1px solid black" align="center"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td width="50" style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td width="60" style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;

            foreach($nameArray_item as $result_item)
            {

				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by trim_group ", "item_color", "color_number_id"  );

			 $nameArray_color=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.color_number_id as gmt_color, b.item_color as color_number_id,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount, min(c.color_order) as color_order, min(c.size_order) as size_order,c.article_number from wo_booking_dtls a, wo_trim_book_con_dtls b,wo_po_color_size_breakdown c  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and b.po_break_down_id=c.po_break_down_id and b.color_number_id=c.color_number_id and b.gmts_sizes=c.size_number_id and  c.id=b.color_size_table_id and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=4 and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.color_number_id, b.item_color,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,c.article_number order by c.article_number,color_order,size_order");



            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]." and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  status_active =1 and is_deleted=0 order by trim_group ");

            if(count($nameArray_color)>0){
            	$i++; ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][4]);
				?>
                </td>
                 <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>"><img src='<?=$path?>/<?=$trimsImge_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]; ?>' height='50' width='50' /></td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                /*echo '<pre>';
            	print_r($nameArray_color);*/

				foreach($nameArray_color as $result_color)
                {
					?>
					<td style="border:1px solid black" ><? if($result_color[csf('description')]){echo $result_color[csf('description')];} ?> </td>
					<td style="border:1px solid black" ><? if($result_color[csf('brand_supplier')]){echo $result_color[csf('brand_supplier')]; }?> </td>
                    <td style="border:1px solid black">
					<?
					if($result_color[csf('article_number')]!="no article"){
						echo $result_color[csf('article_number')];
					}else{
						echo "-";
					}
					?>
                    </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('gmt_color')]];?> </td>
                    <td style="border:1px solid black; text-align:left">
					<? echo $size_library[$result_color[csf('gmts_sizes')]]; ?>
					</td>
					<td style="border:1px solid black; text-align:left">
					<? echo $result_color[csf('item_size')]; ?>
					</td>
                    <td style="border:1px solid black; text-align:left">
				   <?
				   $calUom=$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][2];
			       $calQty=explode("_",$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				   if($calUom && end($calQty)){
					   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
				   }
                   ?>
                    </td>

					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('cons')],4);
					$item_desctiption_total += $result_color[csf('cons')] ;
					$trims_item_arr[$result_item[csf('trim_group')]][$result_color[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_color[csf('cons')];
					$trims_item_arr[$result_item[csf('trim_group')]][$result_color[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_color[csf('amount')];
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]];  ?></td>
					<? if($show_comment==1) {?>
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('rate')],4);
					?>
                     </td>

					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,2);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					$trims_remark=$trims_remark_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
					?>
					</td>

                    <td style="border:1px solid black;text-align:center"><? echo $trims_remark; ?> </td>
                    <? } ?>
				</tr>
            	<?
            	}
            	?>
            	<tr>
	                <td style="border:1px solid black;  text-align:right" colspan="11"><strong> Item Total</strong></td>
	                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					echo number_format($item_desctiption_total,0);  ?></td>
	                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
					<? if($show_comment==1) {?>
	                <td style="border:1px solid black; text-align:right"></td>

	                <td style="border:1px solid black; text-align:right">
	                <?
	                echo number_format($total_amount_as_per_gmts_color,2);
	                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
	                ?>
	                </td>

	                <td>&nbsp;  </td>
	                <? } ?>
            	</tr>
            <?
            }
        	}

            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="<? echo ($show_comment==1) ? 14 : 12; ?>"><strong>Total</strong></td>
				<? if($show_comment==1) {?>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp;  </td>
                <? } else{ ?>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                <? } ?>
            </tr>
        </table>
        <br/>
       <?
		}
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->

         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=0 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				//echo $poid.', ';
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}

			//$po_quantity[$result_job[csf('id')]];
			if($show_comment==1) $tdColspan=7; else $tdColspan=4;
        ?>
        <table border="1" align="left" class="rpt_table" cellpadding="0" width="1000px" cellspacing="0" style=""  rules="all">
            <tr>
                <td colspan="5" style="word-break:break-all; "><strong>NO sensitive  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td colspan="<?=$tdColspan;?>" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
            </tr>
            <tr>
                <td width="20" style="border:1px solid black"><strong>SL</strong> </td>
                <td width="120" style="border:1px solid black"><strong>Item Group</strong> </td>
                <td width="50" style="border:1px solid black"><strong>IMG</strong> </td>
                <td width="140" style="border:1px solid black"><strong>Item Description</strong> </td>
                <td width="100" style="border:1px solid black"><strong>Brand/ Supplier Ref.</strong> </td>
                <td width="140" style="border:1px solid black"><strong>Item Color</strong> </td>
                <td width="70" align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td width="60" align="center" style="border:1px solid black"><strong>Qty</strong></td>
                <td width="50" style="border:1px solid black" align="center"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td width="60" style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td width="80" style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <td width="110" style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                 <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color");
				?>
				<tr>
					<td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>"><? echo $i; ?></td>
					<td align="center" style="word-break:break-all; border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
						<?
						echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
						echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);
						?>
					</td>
                    <td align="center" style="border:1px solid black" rowspan="<?=count($nameArray_item_description)+1; ?>"><img src='<?=$path?>/<?=$trimsImge_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]; ?>' height='50' width='50' /></td>
					<?
					$color_tatal=0;
					$total_amount_as_per_gmts_color=0;
					foreach($nameArray_item_description as $result_itemdescription)
					{
						$item_desctiption_total=0;
						?>
						<td style="word-break:break-all; border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
						<td style="word-break:break-all; border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
						<td style="word-break:break-all; border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
						<td style="word-break:break-all; border:1px solid black; text-align:left">
						<?
						$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
						$calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
						$calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
						if($calUom && end($calQty)){
						echo "1 ".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]." = ".prev($calQty)." ".$calUom;
						?>
						</td>
						<?
					}

					if($db_type==0)
					{
					 $nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
					}
					if($db_type==2)
					{
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons,sum(b.amount) as amount  from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
					}

					foreach($nameArray_color_size_qnty as $result_color_size_qnty)
					{
						?>
						<td style="word-break:break-all; border:1px solid black; text-align:right">
						<?
						if($result_color_size_qnty[csf('cons')]!= "")
						{
							echo number_format($result_color_size_qnty[csf('cons')],4);
							$item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
							$color_tatal+=$result_color_size_qnty[csf('cons')];
							$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_color_size_qnty[csf('cons')];
							$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_color_size_qnty[csf('amount')];
						}
						else echo "";
						?>
						</td>
						<?
					}
					?>
					<td style="word-break:break-all; border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
					<? if($show_comment==1)
					{
						?>
						<td style="word-break:break-all; border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
						<td style="word-break:break-all; border:1px solid black; text-align:right">
						<?
							$amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
							$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
						?>
						</td>
						<td style="word-break:break-all; border:1px solid black; text-align:right"><? echo $trims_remark; ?> </td>
					<? } ?>
				</tr>
				<?
				}
				?>
				<tr>
					<td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
					<td style="border:1px solid black;  text-align:right; font-weight:bold;"><? if($color_tatal !='') echo number_format($color_tatal,0); ?></td>
					<td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
					<? if($show_comment==1)
					{?>
						<td style="border:1px solid black; text-align:right"></td>
						<td style="border:1px solid black; text-align:right">
						<?
						echo number_format($total_amount_as_per_gmts_color,2);
						$grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
						?>
						</td>
						<td>&nbsp;</td>
					<? } ?>
				</tr>
				<?
				}
				?>
				<tr>
					<td align="right" style="border:1px solid black" colspan="9"><strong>Total</strong></td>
					<? if($show_comment==1) {?>
					<td>&nbsp;</td>
					<td style="border:1px solid black;  text-align:right"><? echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
					<td>&nbsp;</td>
				</tr>
        <? } ?>
        </table>
        <?
		}
		}
		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->
		<br>
		<table border="1" align="left" class="rpt_table"  cellpadding="0" width="50%" cellspacing="0" rules="all" >
				<tr>
					<td style="border:1px solid black" align="center" colspan="6"><strong>Summary Report</strong> </td>
						
					</tr>
					<tr>
					<td style="border:1px solid black" align="center"><strong>Sl</strong> </td>
						<td style="border:1px solid black" align="center"><strong>Item Group</strong> </td>
						<td style="border:1px solid black" align="center"><strong>Description</strong> </td>
						<td style="border:1px solid black" align="center"><strong>Order Uom</strong> </td>
						
						<td style="border:1px solid black" align="center"><strong>Total Qnty</strong> </td>
						<? if($show_comment==1) {?>
						<td style="border:1px solid black" align="center"><strong>Total Amount</strong> </td>
						<? } ?>
					</tr>
					<?
					// print_r($trims_item_arr);
					$t=1;$total_item_cons=$total_item_amount=0;
					foreach($trims_item_arr as $trim_id=>$trim_data )
					{
						foreach($trim_data as $trimdesc =>$trim_desc )
						{
							foreach($trim_desc as $uom_id=>$val )
							{
					?>
					<tr>
						<td style="border:1px solid black"> <? echo $t; ?> </td>
							<td align="center" style="border:1px solid black"> <? echo $trim_group_library[$trim_id];?> </td>
							<td align="center" style="border:1px solid black"> <? echo $trimdesc;?> </td>
							<td align="center" style="border:1px solid black"> <? echo $unit_of_measurement[$uom_id];?> </td>
							<td align="right" style="border:1px solid black"> <? echo number_format($val['cons'],0);?> </td>
							<? if($show_comment==1) {?>
							<td align="right" style="border:1px solid black"> <? echo number_format($val['amount'],2);?> </td>
							<? } ?>
						</tr>
						<?
							$t++;
							$total_item_cons+=$val['cons'];
							$total_item_amount+=$val['amount'];
							}
					    	}
						}
						?>
					<tr>
					<? if($show_comment==1) {?>
					<td colspan="5" align="right"> <b>Total</b> </td>
					
					<td align="right"><b> <? echo number_format($total_item_amount,2);?></b> </td>
					<? } ?>
					</tr>

		</table>




       <?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>

           <table border="1" align="left" class="rpt_table" cellpadding="0" width="1000" cellspacing="0" rules="all">
		   <? if($show_comment==1) {?>
                <tr style="border:1px solid black;">
                    <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                    <td width="70%" style="border:1px solid black; text-align:left"><? echo number_format($booking_grand_total,2);?></td>
                </tr>
                <tr style="border:1px solid black;">
                    <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                    <td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
                </tr>
				<? } ?>
           </table>
         <br/>
        <table width="1000">
            <tr>
                <td width="390" style="word-break:break-all"><? echo get_spacial_instruction($txt_booking_no); ?></td>
                <td width="10">&nbsp;</td>
                <td width="450" valign="top">
                    <table width="440" class="rpt_table" border="1" cellpadding="0" cellspacing="0" rules="all">
                        <tr style="border:1px solid black;">
                            <td colspan="4" style="border:1px solid black;">Approval Status</td>
                        </tr>
                        <tr style="border:1px solid black;">
                            <td width="20" style="border:1px solid black;">Sl</td>
                            <td width="180" style="border:1px solid black;">Name</td>
                            <td width="100" style="border:1px solid black;">Approval Date</td>
                            <td style="border:1px solid black;">Approval No</td>
                        </tr>
                        <?
                        $i;
                        foreach($approved_array as $row){
                            ?>
                            <tr style="border:1px solid black;">
                                <td style="border:1px solid black;"><? echo $i;?></td>
                                <td style="border:1px solid black;"><? echo $row[csf('user_full_name')];?></td>
                                <td style="border:1px solid black;"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); ;?></td>
                                <td style="border:1px solid black;"><? echo $row[csf('approved_no')];?></td>
                            </tr>
                            <?
                            $i++;
                        }
                        ?>
                    </table>
                </td>
            </tr>
        </table>
	  <br>
    <div  style="margin-top:-50px;">
         <?=signature_table(132, $cbo_company_name, "1000px",1); ?>
   </div>
     <!-- <div id="page_break_div"></div> -->
    <div>
		<?="****".custom_file_name($txt_booking_no,$style_sting,$job_no); ?>
    </div>
	<?
       $html = ob_get_contents();
	   ob_clean();
	   list($is_mail_send,$mail)=explode('___',$mail_send_data);
	   if($is_mail_send==1){
		   require_once('../../../mailer/class.phpmailer.php');
		   require_once('../../../auto_mail/setting/mail_setting.php');
		   $mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
			   
		   $mailToArr=array();
		   $mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
		   //echo $mailSql;die;
		   $mailSqlRes=sql_select($mailSql);
		   foreach($mailSqlRes as $rows){
			   if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		   }
		   
		   
		   $mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=97 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
		   //echo $mailSql;die;
		   $mailSqlRes=sql_select($mailSql);
		   foreach($mailSqlRes as $rows){
			   if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		   }
		   if($mail!=''){$mailToArr[]=$mail;}
		   $to=implode(',',$mailToArr);
		   
		   $subject="Trims Booking Multy Job";
		   $header=mailHeader();
		   echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
		   
	   }
	   else{
		   echo $html;
	   }
	   exit();
}

if($action=="show_trim_booking_report16")
{
	extract($_REQUEST);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	//$order_file_no_arr=return_library_array("select po_number,file_no  from wo_po_break_down","po_number","file_no");
	//$order_ref_no_arr=return_library_array("select po_number,grouping  from wo_po_break_down","po_number","grouping");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	//$po_qnty_tot=return_field_value( "sum(po_quantity)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	ob_start();
	?>
	<div style="width:1333px" align="center">
       <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black">
           <tr>
               <td width="100">
              <? if($link==1){?>
               <img  src='../../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
               <? }else{?>
               <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
               <? }?>
               </td>
               <td width="1000">
                    <table width="100%" cellpadding="0" cellspacing="0" >
                        <tr>
                            <td align="center" style="font-size:20px;">
                              <?php
    							echo $company_library[$cbo_company_name];
    						?>
                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:14px">
                            <?
                            $nameArray=sql_select( "select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                            foreach ($nameArray as $result)
                            {
                            ?>
                                            Plot No: <? echo $result[csf('plot_no')]; ?>
                                            Level No: <? echo $result[csf('level_no')]?>
                                            Road No: <? echo $result[csf('road_no')]; ?>
                                            Block No: <? echo $result[csf('block_no')];?>
                                            City No: <? echo $result[csf('city')];?>
                                            Zip Code: <? echo $result[csf('zip_code')]; ?>
                                            Province No: <?php echo $result[csf('province')]; ?>
                                            Country: <? echo $country_arr[$result[csf('country_id')]]; ?><br>
                                            Email Address: <? echo $result[csf('email')];?>
                                            Website No: <? echo $result[csf('website')];
                            }
                                            ?>
                               </td>
                            </tr>
                            <tr>
                            <td align="center" style="font-size:20px">
                                 <strong>
								<?
								if(str_replace("'","",$cbo_isshort)==2)
								{
								$isshort="";
								}
								if(str_replace("'","",$cbo_isshort)==1)
								{
								$isshort="[Short]";
								}
								if ($report_title !="")
								{
									echo $report_title." ".$isshort;
								}
								else
								{
									echo "Main Trims Booking ".$isshort;
								}
								?>
                                &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <font style="color:#F00">
								<? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?>
                                </font>
                                </strong>
                             </td>
                            </tr>
                      </table>
                </td>
                 <td width="250" id="barcode_img_id">

               </td>
            </tr>
       </table>
		<?

		$booking_grand_total=0;
		$job_no="";
		$currency_id="";
		$nameArray_job=sql_select( "select distinct b.job_no  from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and a.booking_no=$txt_booking_no  and a.status_active=1 and b.status_active=1");
        foreach ($nameArray_job as $result_job)
        {

			$job_no.=$result_job[csf('job_no')].", ";
		}
		$buyer_string="";

		$nameArray_buyer=sql_select( "select distinct a.buyer_name  from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no=$txt_booking_no  and a.status_active=1 and b.status_active=1");
        foreach ($nameArray_buyer as $result_buy)
        {
			$buyer_string.=$buyer_name_arr[$result_buy[csf('buyer_name')]].",";
		}

		$po_no="";
		$po_number=array();
		$nameArray_job=sql_select( "select b.id, b.po_number,b.file_no,b.grouping from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no=$txt_booking_no  and a.status_active=1 and b.status_active=1  group by b.id, b.po_number,b.file_no,b.grouping");
        foreach ($nameArray_job as $result_job)
        {
			$po_no.=$result_job[csf('po_number')].", ";
			$po_number[$result_job[csf('id')]]=$result_job[csf('po_number')];
			$po_idArr[$result_job[csf('id')]]=$result_job[csf('id')];
			
			$order_file_no_arr[$result_job[csf('po_number')]]=$result_job[csf('file_no')];
			$order_ref_no_arr[$result_job[csf('po_number')]]=$result_job[csf('grouping')];
		}
		$style_ref="";
		$nameArray_style=sql_select( "select distinct a.style_ref_no  from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no=$txt_booking_no  and a.status_active=1 and b.status_active=1");
        foreach ($nameArray_style as $result_style)
        {
			$style_ref.=$result_style[csf('style_ref_no')].", ";
		}
        $nameArray=sql_select( "select a.booking_no,a.booking_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.delivery_date,a.source,a.remarks,a.pay_mode  from wo_booking_mst a where  a.booking_no=$txt_booking_no");
        foreach ($nameArray as $result)
        {
			$varcode_booking_no=$result[csf('booking_no')];
        ?>
       <table width="100%" style="border:1px solid black">
            <tr>
                <td colspan="6" valign="top"></td>
            </tr>
            <tr>
                <td width="100" style="font-size:12px"><b>Booking No </b>   </td>
                <td width="110">:&nbsp;<? echo $result[csf('booking_no')];?> </td>
                <td width="100" style="font-size:12px"><b>Booking Date</b></td>
                <td width="110">:&nbsp;<? echo change_date_format($result[csf('booking_date')],'dd-mm-yyyy','-');?>&nbsp;&nbsp;&nbsp;</td>
                <td width="100"><span style="font-size:16px"><b>Delivery Date</b></span></td>
                <td width="110">:&nbsp;<? echo change_date_format($result[csf('delivery_date')],'dd-mm-yyyy','-');?></td>
            </tr>
            <tr>
                <td width="100" style="font-size:12px"><b>Currency</b></td>
                <td width="110">:&nbsp;<? $currency_id=$result[csf('currency_id')]; echo $currency[$result[csf('currency_id')]]; ?></td>
                <td  width="100" style="font-size:12px"><b>Conversion Rate</b></td>
                <td  width="110" >:&nbsp;<? echo $result[csf('exchange_rate')]; ?></td>
                <td  width="100" style="font-size:12px"><b>Source</b></td>
                <td  width="110" >:&nbsp;<? echo $source[$result[csf('source')]]; ?></td>
            </tr>
            <tr>
                <td width="100" style="font-size:12px"><b>Supplier Name</b>   </td>
                <td width="110">:&nbsp;<?
				if($result[csf('pay_mode')]==5 || $result[csf('pay_mode')]==3){
					echo $company_library[$result[csf('supplier_id')]];
					}
					else{
					echo $supplier_name_arr[$result[csf('supplier_id')]];
					}
				//echo $supplier_name_arr[$result[csf('supplier_id')]];?>    </td>
                <td width="100" style="font-size:12px"><b>Supplier Address</b></td>
               	<td  colspan="3">:&nbsp;<? echo $supplier_address_arr[$result[csf('supplier_id')]];?></td>

            </tr>
            <tr>
                <td width="100" style="font-size:12px"><b>Buyer</b>   </td>
                <td width="110">:&nbsp;
				<?
				echo rtrim($buyer_string,", ");
				?>
                </td>
                <td width="110" style="font-size:12px"><b>Style</b> </td>
                <td  width="100" style="font-size:12px" colspan="3">:&nbsp;<? echo rtrim($style_ref,", "); ?> </td>


            </tr>
            <tr>
                <td width="100" style="font-size:12px"><b>Job No</b>   </td>
                <td width="110">:&nbsp;
				<?
				echo rtrim($job_no,", ");
				?>
                </td>

               	<td width="110" style="font-size:12px"><b>PO No</b> </td>
                <td  width="100" style="font-size:12px" colspan="3">:&nbsp;<? echo rtrim($po_no,", "); ?> </td>
            </tr>
             <tr>
                <td width="100" style="font-size:12px"><b>File No</b> </td>
                 <td>:&nbsp;
				<?
				$po_data=explode(",",$po_no);
				$file_no='';$ref_no='';
				foreach($po_data as $po_id)
				{
					if($file_no=='')	$file_no=$order_file_no_arr[$po_id];else $file_no.=','.$order_file_no_arr[$po_id];
					if($ref_no=='')	$ref_no=$order_ref_no_arr[$po_id];else $ref_no.=','.$order_ref_no_arr[$po_id];
				}
				//$order_file_no_arr
				echo rtrim($file_no,',');
				?>
                </td>

                <td width="100" style="font-size:12px"><b>Remarks</b>   </td>
                <td width="110">:&nbsp;
				<?
				echo $result[csf('remarks')];
				?>
                </td>
                <td width="110" style="font-size:12px"><b>Pay Mode</b> </td>
                <td  width="100" style="font-size:12px" >:&nbsp;<? echo $pay_mode[$result[csf('pay_mode')]]; ?> </td>

            </tr>
            <tr>
            <td>Ref. No </td> <td colspan="5">:&nbsp; <?
				echo rtrim($ref_no,',');
				?> </td>
            </tr>
        </table>
        <br/>
		<?
        }
        ?>
          <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?

		$nameArray_job_po=sql_select( "select a.job_no,a.po_break_down_id,sum(distinct b.po_quantity) as po_quantity from wo_booking_dtls a, wo_po_break_down b  where a.booking_no=$txt_booking_no and a.po_break_down_id=b.id and b.status_active=1 and b.is_deleted=0  group by a.job_no,a.po_break_down_id order by a.job_no,a.po_break_down_id ");
		foreach($nameArray_job_po as $nameArray_job_po_row)
		{

        $nameArray_item=sql_select( "select distinct trim_group from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]."  and sensitivity=1 order by trim_group ");
        $nameArray_color=sql_select( "select  b.color_number_id, min(b.color_size_table_id) as  color_size_table_id from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=1 group by b.color_number_id order by color_size_table_id");
		//echo "select  b.color_number_id, min(b.color_size_table_id) as  color_size_table_id from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=1 group by b.color_number_id order by color_size_table_id";
		if(count($nameArray_color)>0)
		{
        ?>
        &nbsp;
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
           <tr>
                <td colspan="<? echo count($nameArray_color)+8; ?>" align="">
                <strong><? echo "Job NO:".$nameArray_job_po_row[csf('job_no')]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO No:" .$po_number[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO Qty:" .$nameArray_job_po_row[csf('po_quantity')];?></strong>
                </td>
            </tr>
            <tr>
                <td colspan="<? echo count($nameArray_color)+8; ?>" align="">
                <strong>As Per Garments Color</strong>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand Supplier</strong> </td>
                <?
                foreach($nameArray_color  as $result_color)
                {	     ?>
                <td align="center" style="border:1px solid black"><strong><? echo $color_library[$result_color[csf('color_number_id')]];?></strong></td>
                <?	}    ?>
                <td style="border:1px solid black" align="center"><strong>Total</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
            $nameArray_item_description=sql_select( "select b.description, b.brand_supplier,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=1 and a.trim_group=".$result_item[csf('trim_group')]." group by b.description, b.brand_supplier order by trim_group ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $trim_group_library[$result_item[csf('trim_group')]]; ?>
                </td>
                <?
                $color_tatal=array();
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
                $item_desctiption_total=0;
                ?>
                <td style="border:1px solid black"><? echo $result_itemdescription[csf('description')]; ?> </td>
                <td style="border:1px solid black"><? echo $result_itemdescription[csf('brand_supplier')]; ?> </td>
                <?
                foreach($nameArray_color  as $result_color)
                {
					if($db_type==0)
					{

                $nameArray_color_size_qnty=sql_select( "select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=1 and a.trim_group=". $result_item[csf('trim_group')]." and b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='". $result_itemdescription[csf('brand_supplier')]."' and b.color_number_id=".$result_color[csf('color_number_id')]."");
					}
					if($db_type==2)
					{

              $nameArray_color_size_qnty=sql_select( "select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=1 and a.trim_group=". $result_item[csf('trim_group')]." and nvl(b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('". $result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.color_number_id,0)=nvl(".$result_color[csf('color_number_id')].",0)");
					}

                foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right">
                <?
                if($result_color_size_qnty[csf('cons')]!= "")
                {
					echo number_format($result_color_size_qnty[csf('cons')],2);
					$item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
					if (array_key_exists($result_color[csf('color_number_id')], $color_tatal))
					{
						$color_tatal[$result_color[csf('color_number_id')]]+=$result_color_size_qnty[csf('cons')];
					}
					else
					{
						$color_tatal[$result_color[csf('color_number_id')]]=$result_color_size_qnty[csf('cons')];
					}
                }
                else echo "";
                ?>
                </td>
                <?
                }
                }
                ?>

                <td style="border:1px solid black; text-align:right"><? echo number_format($item_desctiption_total,2); ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                ?>
                </td>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="2"><strong> Item Total</strong></td>
                <?
                foreach($nameArray_color  as $result_color)
                {

                ?>
                <td style="border:1px solid black;  text-align:right">
                <?
                if($color_tatal[$result_color[csf('color_number_id')]] !='')
                {
                echo number_format($color_tatal[$result_color[csf('color_number_id')]],2);
                }
                ?>
                </td>
            <?
            }
            ?>
                <td style="border:1px solid black;  text-align:right"><? echo number_format(array_sum($color_tatal),2);  ?></td>
                <td style="border:1px solid black;  text-align:right"><? //echo number_format(array_sum($color_tatal),2);  ?></td>
                <td style="border:1px solid black; text-align:right"><? //echo number_format(round($color_total),0); ?></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="<? echo count($nameArray_color)+7; ?>"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
            </tr>
        </table>
        <br/>
        <?

		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->

        <!--==============================================AS PER GMTS SIZE START=========================================  -->
		<?
        $nameArray_item=sql_select( "select distinct trim_group from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and sensitivity=2 order by trim_group ");
        $nameArray_size=sql_select( "select  b.item_size  as gmts_sizes, min(b.color_size_table_id) as color_size_table_id from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no=$txt_booking_no and a.sensitivity=2 group by b.item_size order by color_size_table_id");
		if(count($nameArray_item)>0)
		{
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="<? echo count($nameArray_size)+8; ?>" align="">
                <strong><? echo "Job NO:".$nameArray_job_po_row[csf('job_no')]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO No:" .$po_number[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO Qty:" .$nameArray_job_po_row[csf('po_quantity')];?></strong>
                </td>
            </tr>
            <tr>
                <td colspan="<? echo count($nameArray_size)+8; ?>" align="">
                <strong>As Per Garments Size </strong>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand Supplier</strong> </td>
                <?
                foreach($nameArray_size  as $result_size)
                {	     ?>
                <td align="center" style="border:1px solid black"><strong><? echo $result_size[csf('gmts_sizes')];?></strong></td>
                <?	}    ?>
                <td style="border:1px solid black" align="center"><strong>Total</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_size=0;
            foreach($nameArray_item as $result_item)
            {
			$i++;
            //$nameArray_item_description=sql_select( "select distinct description,brand_supplier,rate,uom from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=2 and trim_group=".$result_item[csf('trim_group')]." order by trim_group ");
			$nameArray_item_description=sql_select( "select b.description, b.brand_supplier,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." group by b.description, b.brand_supplier");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $trim_group_library[$result_item[csf('trim_group')]]; ?>
                </td>
                <?
                $size_tatal=array();
               $total_amount_as_per_gmts_color=0;$total_amount_as_per_gmts_size=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
                $item_desctiption_total=0;
                ?>
                <td style="border:1px solid black"><? echo $result_itemdescription[csf('description')]; ?> </td>
                <td style="border:1px solid black"><? echo $result_itemdescription[csf('brand_supplier')]; ?> </td>
                <?
                foreach($nameArray_size  as $result_size)
                {
					if($db_type==0)
					{
						//echo "select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=2 and a.trim_group=". $result_item[csf('trim_group')]." and b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='". $result_itemdescription[csf('brand_supplier')]."' and b.item_size='".$result_size[csf('gmts_sizes')]."'";
                $nameArray_size_size_qnty=sql_select( "select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=2 and a.trim_group=". $result_item[csf('trim_group')]." and b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='". $result_itemdescription[csf('brand_supplier')]."' and b.item_size='".$result_size[csf('gmts_sizes')]."'");
					}
					if($db_type==2)
					{
                $nameArray_size_size_qnty=sql_select( "select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=2 and a.trim_group=". $result_item[csf('trim_group')]." and nvl(b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('". $result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_size,0)=nvl('".$result_size[csf('gmts_sizes')]."',0)");
					}
                foreach($nameArray_size_size_qnty as $result_size_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right">
                <?
                if($result_size_size_qnty[csf('cons')]!= "")
                {
					echo number_format($result_size_size_qnty[csf('cons')],2);
					$item_desctiption_total += $result_size_size_qnty[csf('cons')] ;
					if (array_key_exists($result_size[csf('gmts_sizes')], $size_tatal))
					{
						$size_tatal[$result_size[csf('gmts_sizes')]]+=$result_size_size_qnty[csf('cons')];
					}
					else
					{
						$size_tatal[$result_size[csf('gmts_sizes')]]=$result_size_size_qnty[csf('cons')];
					}
                }
                else echo "";
                ?>
                </td>
                <?
                }
                }
                ?>

                <td style="border:1px solid black; text-align:right"><? echo number_format($item_desctiption_total,2); ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">

                <?
                $amount_as_per_gmts_size = $item_desctiption_total*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_size,2);
                $total_amount_as_per_gmts_size+=$amount_as_per_gmts_size;
                ?>
                </td>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="2"><strong> Item Total</strong></td>
                <?
                foreach($nameArray_size  as $result_size)
                {

                ?>
                <td style="border:1px solid black;  text-align:right">
                <?
                if($size_tatal[$result_size[csf('gmts_sizes')]] !='')
                {
                	echo number_format($size_tatal[$result_size[csf('gmts_sizes')]],2);
                }
                ?>
                </td>
            <?
            }
            ?>
                <td style="border:1px solid black;  text-align:right"><? echo number_format(array_sum($size_tatal),2);  ?></td>
                 <td style="border:1px solid black;  text-align:right"><? //echo number_format(array_sum($color_tatal),2);  ?></td>
                <td style="border:1px solid black; text-align:right"><? //echo number_format(round($color_total),0); ?></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_size,2);
                $grand_total_as_per_gmts_size+=$total_amount_as_per_gmts_size;
                ?>
                </td>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="<? echo count($nameArray_size)+7; ?>"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_size,2); $booking_grand_total+=$grand_total_as_per_gmts_size; ?></td>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER SIZE  END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no=$txt_booking_no and a.sensitivity=3", "item_color", "color_number_id"  );

        $nameArray_item=sql_select( "select distinct trim_group from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and sensitivity=3 order by trim_group ");

        $nameArray_color=sql_select( "select  b.item_color as color_number_id, b.color_number_id as gmts_color, min(b.color_size_table_id) as  color_size_table_id from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=3 and b.cons >0 group by b.item_color ,b.color_number_id order by color_size_table_id ");
		if(count($nameArray_color)>0)
		{
        ?>
        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
           <tr>
                <td colspan="<? echo count($nameArray_color)+9; ?>" align="">
                <strong><? echo "Job NO:".$nameArray_job_po_row[csf('job_no')]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO No:" .$po_number[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO Qty:" .$nameArray_job_po_row[csf('po_quantity')];?></strong>
                </td>
            </tr>
            <tr>
                <td colspan="<? echo count($nameArray_color)+9; ?>" align="">
                <strong>Contrast Color</strong>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black" rowspan="2"><strong>Sl</strong> </td>
                <td style="border:1px solid black" rowspan="2"><strong>Item Group</strong> </td>
                <td style="border:1px solid black" rowspan="2"><strong>Item Description</strong> </td>
                <td style="border:1px solid black" rowspan="2"><strong>Brand Supplier</strong> </td>
                <td style="border:1px solid black"><strong>Gmts Color</strong> </td>
                <?
                foreach($nameArray_color  as $result_color)
                {	     ?>
                <td align="center" style="border:1px solid black"><strong><? echo $color_library[$result_color[csf('gmts_color')]];?></strong></td>
                <?	}    ?>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>Total</strong></td>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center" rowspan="2"><strong>Amount</strong></td>
            </tr>
             <tr>
                <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <?
                foreach($nameArray_color  as $result_color)
                {	     ?>
                <td align="center" style="border:1px solid black"><strong><? echo $color_library[$result_color[csf('color_number_id')]];?></strong></td>
                <?	}    ?>

            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
            //$nameArray_item_description=sql_select( "select distinct description,brand_supplier,rate,uom from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=3 and trim_group=".$result_item[csf('trim_group')]." order by trim_group ");
			$nameArray_item_description=sql_select( "select b.description, b.brand_supplier,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=3 and a.trim_group=".$result_item[csf('trim_group')]." group by b.description, b.brand_supplier order by trim_group ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $trim_group_library[$result_item[csf('trim_group')]]; ?>
                </td>
                <?
                $color_tatal=array();
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
                $item_desctiption_total=0;
                ?>
                <td style="border:1px solid black"><? echo $result_itemdescription[csf('description')]; ?> </td>
                <td style="border:1px solid black" colspan="2"><? echo $result_itemdescription[csf('brand_supplier')]; ?> </td>
                <?
                foreach($nameArray_color  as $result_color)
                {
					if($db_type==0)
				    {
                $nameArray_color_size_qnty=sql_select( "select sum(b.cons) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=3 and a.trim_group=". $result_item[csf('trim_group')]." and b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='". $result_itemdescription[csf('brand_supplier')]."' and b.item_color=".$result_color[csf('color_number_id')]." and b.color_number_id=".$result_color[csf('gmts_color')]."");
					}
					if($db_type==2)
				    {
                $nameArray_color_size_qnty=sql_select( "select sum(b.cons) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=3 and a.trim_group=". $result_item[csf('trim_group')]." and nvl(b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('". $result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl(".$result_color[csf('color_number_id')].",0) and nvl(b.color_number_id,0)=nvl(".$result_color[csf('gmts_color')].",0)");
					}
                foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right">
                <?
                if($result_color_size_qnty[csf('cons')]!= "")
                {
					echo number_format($result_color_size_qnty[csf('cons')],2);
					$item_desctiption_total += $result_color_size_qnty[csf('cons')] ;

					if (array_key_exists($result_color[csf('color_number_id')], $color_tatal))
					{
						$color_tatal[$result_color[csf('color_number_id')]][$result_color[csf('gmts_color')]]+=$result_color_size_qnty[csf('cons')];
					}
					else
					{
						$color_tatal[$result_color[csf('color_number_id')]][$result_color[csf('gmts_color')]]=$result_color_size_qnty[csf('cons')];
					}
                }
                else echo "";
                ?>
                </td>
                <?
                }
                }
                ?>

                <td style="border:1px solid black; text-align:right"><? echo number_format($item_desctiption_total,2); ?></td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                ?>
                </td>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="3"><strong> Item Total</strong></td>
                <?
				$item_total=0;
                foreach($nameArray_color  as $result_color)
                {

                ?>
                <td style="border:1px solid black;  text-align:right">
                <?
                if($color_tatal[$result_color[csf('color_number_id')]][$result_color[csf('gmts_color')]] !='')
                {
                echo number_format($color_tatal[$result_color[csf('color_number_id')]][$result_color[csf('gmts_color')]],2);
				$item_total+=$color_tatal[$result_color[csf('color_number_id')]][$result_color[csf('gmts_color')]];
                }
                ?>
                </td>
            <?
            }
            ?>
                <td style="border:1px solid black;  text-align:right"><? echo number_format($item_total,2);  ?></td>
                <td style="border:1px solid black;text-align:center"></td>
                <td style="border:1px solid black; text-align:right"><? //echo number_format(round($color_total),0); ?></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="<? echo count($nameArray_color)+8; ?>"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
        $nameArray_item=sql_select( "select distinct trim_group from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and sensitivity=4  and  status_active=1  order by trim_group ");
        $nameArray_size=sql_select( "select  b.item_size  as gmts_sizes, min(b.color_size_table_id) as color_size_table_id  from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]."  and a.status_active=1 and b.status_active=1 and a.sensitivity=4 group by b.item_size order by color_size_table_id");


		if(count($nameArray_size)>0)
		{
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
             <tr>
                <td colspan="<? echo count($nameArray_size)+10;?>" align="">
                <strong><? echo "Job NO:".$nameArray_job_po_row[csf('job_no')]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO No:" .$po_number[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO Qty:" .$nameArray_job_po_row[csf('po_quantity')];?></strong>
                </td>
            </tr>
            <tr>
                <td colspan="<? echo count($nameArray_size)+10; ?>" align="">
                <strong>Color & size sensitive </strong>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>

                <td style="border:1px solid black"><strong>Item Color</strong> </td>
                 <td style="border:1px solid black"><strong>Gmts Color</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand Supplier</strong> </td>
                <?
                foreach($nameArray_size  as $result_size)
                {	     ?>
                <td align="center" style="border:1px solid black"><strong><? echo $result_size[csf('gmts_sizes')];?></strong></td>
                <?	}    ?>
                <td style="border:1px solid black" align="center"><strong>Total</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
			$i++;
			$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.trim_group=".$result_item[csf('trim_group')]." and a.sensitivity=4  and a.status_active=1 and b.status_active=1", "item_color", "color_number_id"  );
			 /*$nameArray_color=sql_select( "select distinct b.item_color as color_number_id,b.description, b.brand_supplier from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=$txt_booking_no and a.trim_group=".$result_item[csf('trim_group')]." and a.sensitivity=4"); */
			 $nameArray_color=sql_select( "select  b.item_color,b.color_number_id,b.description, b.brand_supplier, min(b.color_size_table_id) as  color_size_table_id,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.trim_group=".$result_item[csf('trim_group')]." and a.sensitivity=4  and a.status_active=1 and b.status_active=1 group by b.item_color,b.color_number_id,b.description, b.brand_supplier order by color_size_table_id");

            $nameArray_item_description=sql_select( "select distinct trim_group from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]."  and status_active=1  order by trim_group ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <? echo $trim_group_library[$result_item[csf('trim_group')]]; ?>
                </td>
                <?


                $color_tatal=array();
                $total_amount_as_per_gmts_color=0;
				foreach($nameArray_color as $result_color)
                {
					$item_desctiption_total=0;
					?>
					<td style="border:1px solid black"><? echo $color_library[$result_color[csf('item_color')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
					<td style="border:1px solid black" ><? echo $result_color[csf('description')]; ?> </td>
					<td style="border:1px solid black" ><? echo $result_color[csf('brand_supplier')]; ?> </td>
					<?
					foreach($nameArray_size  as $result_size)
					{
						if($db_type==0)
				        {
						$nameArray_size_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=4 and a.trim_group=". $result_item[csf('trim_group')]." and  b.description='". $result_color[csf('description')]."' and b.brand_supplier='".$result_color[csf('brand_supplier')]."'  and b.item_size='".$result_size[csf('gmts_sizes')]."' and b.item_color=".$result_color[csf('item_color')]." and b.color_number_id=".$result_color[csf('color_number_id')]."  and a.status_active=1 and b.status_active=1");
						}
						if($db_type==2)
				        {
						$nameArray_size_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=4 and a.trim_group=". $result_item[csf('trim_group')]." and nvl( b.description,0)=nvl('". $result_color[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_color[csf('brand_supplier')]."',0)  and nvl(b.item_size,0)=nvl('".$result_size[csf('gmts_sizes')]."',0) and nvl(b.item_color,0)=nvl(".$result_color[csf('item_color')].",0) and nvl(b.color_number_id,0)=nvl(".$result_color[csf('color_number_id')].",0)  and a.status_active=1 and b.status_active=1");
						}
						foreach($nameArray_size_size_qnty as $result_size_size_qnty)
						{
							?>
							<td style="border:1px solid black; text-align:right">
							<?
							if($result_size_size_qnty[csf('cons')]!= "")
							{
								echo number_format($result_size_size_qnty[csf('cons')],2);
								$item_desctiption_total += $result_size_size_qnty[csf('cons')] ;

								if (array_key_exists($result_size[csf('gmts_sizes')], $color_tatal))
								{
									$color_tatal[$result_size[csf('gmts_sizes')]]+=$result_size_size_qnty[csf('cons')];
								}
								else
								{
									$color_tatal[$result_size[csf('gmts_sizes')]]=$result_size_size_qnty[csf('cons')];
								}
							}
							else echo "";
							?>
							</td>
							<?
						}
					}
					?>
					<td style="border:1px solid black; text-align:right"><? echo number_format($item_desctiption_total,2); ?></td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
					<td style="border:1px solid black; text-align:right">
					<?
					$rate =$result_color[csf('amount')]/$item_desctiption_total;;
					echo number_format($rate,2);
					?>
                     </td>
					<td style="border:1px solid black; text-align:right">
					<?
					//$amount_as_per_gmts_color = $item_desctiption_total*  $result_color[csf('rate')];
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,2);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					?>
					</td>
				</tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="6"><strong> Item Total</strong></td>
                <?
                foreach($nameArray_size  as $result_size)
                {

                ?>
                <td style="border:1px solid black;  text-align:right">
                <?
                if($color_tatal[$result_size[csf('gmts_sizes')]] !='')
                {
                echo number_format($color_tatal[$result_size[csf('gmts_sizes')]],2);
                }
                ?>
                </td>
            <?
            }
            ?>
                <td style="border:1px solid black;  text-align:right"><? echo number_format(array_sum($color_tatal),2);  ?></td>
                <td style="border:1px solid black;  text-align:right"><? //echo number_format(array_sum($color_tatal),2);  ?></td>
                <td style="border:1px solid black; text-align:right"><? //echo number_format(round($color_total),0); ?></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
            </tr>
            <?
            }

            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="<? echo count($nameArray_size)+9; ?>"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->


         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
        $nameArray_item=sql_select( "select distinct trim_group from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and sensitivity=0 order by trim_group ");
		
        //$nameArray_color=sql_select( "select distinct b.color_number_id from wo_trims_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=$txt_booking_no and a.sensitivity=1");
		//$nameArray_color= array();
		if(count($nameArray_item)>0)
		{
        ?>
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="8" align="">
                <strong><? echo "Job NO:".$nameArray_job_po_row[csf('job_no')]."&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO No:" .$po_number[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO Qty:" .$nameArray_job_po_row[csf('po_quantity')];?></strong>
                </td>
            </tr>
            <tr>
                <td colspan="8" align="">
                <strong>No Sensitivity</strong>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand Supplier</strong> </td>
                <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td align="center" style="border:1px solid black"><strong> Qnty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$nameArray_item_description=sql_select( "select  b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.trim_group=".$result_item[csf('trim_group')]." and a.sensitivity=0 group by b.description, b.brand_supplier,b.item_color");

            //$nameArray_item_description=sql_select( "select distinct description,brand_supplier,rate,uom from wo_booking_dtls  where booking_no=$txt_booking_no and sensitivity=0 and trim_group=".$result_item[csf('trim_group')]." order by trim_group ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">

                <? echo $trim_group_library[$result_item[csf('trim_group')]]; ?>
                </td>
                <?
                $color_tatal=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
                $item_desctiption_total=0;
                ?>
                <td style="border:1px solid black"><? echo $result_itemdescription[csf('description')]; ?> </td>
                <td style="border:1px solid black"><? echo $result_itemdescription[csf('brand_supplier')]; ?> </td>
                 <td style="border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
                <?
                //$nameArray_color_size_qnty=sql_select( "select sum(b.cons) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=$txt_booking_no and a.sensitivity=0 and a.trim_group=". $result_item['trim_group']." and a.description='". $result_itemdescription['description']."'");
				/*if($db_type==0)
				{
				$nameArray_color_size_qnty=sql_select( "select sum(wo_qnty) as cons from wo_booking_dtls     where    booking_no=$txt_booking_no and sensitivity=0 and trim_group=". $result_item[csf('trim_group')]." and description='". $result_itemdescription[csf('description')]."'");
				}

				if($db_type==2)
				{
					echo "select sum(wo_qnty) as cons from wo_booking_dtls     where    booking_no=$txt_booking_no and sensitivity=0 and trim_group=". $result_item[csf('trim_group')]." and nvl(description,0)=nvl('". $result_itemdescription[csf('description')]."',0)";
				$nameArray_color_size_qnty=sql_select( "select sum(wo_qnty) as cons from wo_booking_dtls     where    booking_no=$txt_booking_no and sensitivity=0 and trim_group=". $result_item[csf('trim_group')]." and nvl(description,0)=nvl('". $result_itemdescription[csf('description')]."',0)");
				}*/

				if($db_type==0)
				{
				$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=0 and a.trim_group=". $result_item[csf('trim_group')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
				}
				if($db_type==2)
				{
				$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=0 and a.trim_group=". $result_item[csf('trim_group')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
				}

                foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right">
                <?
                if($result_color_size_qnty[csf('cons')]!= "")
                {
                echo number_format($result_color_size_qnty[csf('cons')],2);
                $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                $color_tatal+=$result_color_size_qnty[csf('cons')];
                }
                else echo "";
                ?>
                </td>
                <?
                }
                ?>

                <td style="border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                ?>
                </td>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="3"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right">
                <?
                if($color_tatal !='')
                {
                echo number_format($color_tatal,2);
                }
                ?>
                </td>
                <td style="border:1px solid black;"></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="8"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
            </tr>
        </table>
        <?
		//print_r($color_tatal);
		}
		}

		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->
       &nbsp;
       <?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>
	   <? if($show_comment==1) {?>
       <table  width="100%" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
       
	   <tr style="border:1px solid black;">
	
                <th width="70%" style="border:1px solid black; text-align:right">Total Booking Amount</th><td width="30%" style="border:1px solid black; text-align:right"><? echo number_format($booking_grand_total,2);?></td>
			
            </tr>
            <tr style="border:1px solid black;">
		
                <th width="70%" style="border:1px solid black; text-align:right">Total Booking Amount (in word)</th><td width="30%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
			
            </tr>
			
       </table>
	   <? } ?>
          &nbsp;
        <table width="100%">
        <tr>
        <td width="49%">
		

         <? echo get_spacial_instruction($txt_booking_no);?>
    </td>
    <td width="2%"></td>

    <td width="49%">
    <?
	//if($show_comment==1)
	if(str_replace("'","",$show_comment)==1)
	{
	?>
    <table cellspacing="0" cellpadding="0" border="1" rules="all" width="100%" class="rpt_table" >
                <thead>
                    <th width="40">SL</th>
                    <th width="150">Item</th>
                    <th width="150">PO No</th>
                    <th width="150">Pre-Cost Value</th>
                    <th width="">WO Value </th>

                </thead>
       <tbody>
       <?
					 $po_id=implode(",",$po_idArr);
					$sql_lib_item_group_array=array();
					$sql_lib_item_group=sql_select("select id, item_name,conversion_factor,order_uom as cons_uom from lib_item_group");
					foreach($sql_lib_item_group as $row_sql_lib_item_group)
					{
						$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][item_name]=$row_sql_lib_item_group[csf('item_name')];
						$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][conversion_factor]=$row_sql_lib_item_group[csf('conversion_factor')];
						$sql_lib_item_group_array[$row_sql_lib_item_group[csf('id')]][cons_uom]=$row_sql_lib_item_group[csf('cons_uom')];
					}
					$sql_po_qty=sql_select("select sum(c.order_quantity) as order_quantity,(sum(c.order_quantity)/a.total_set_qnty) as order_quantity_set  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and b.id=c.po_break_down_id and  b.id in($po_id)  and a.status_active=1 and b.status_active=1 and c.status_active=1 group by b.id,a.total_set_qnty");
						//list($sql_po_qty_row)=$sql_po_qty;
						//$po_qty=$sql_po_qty_row[csf('order_quantity_set')];
						$po_qty=0;
						foreach($sql_po_qty as $row)
						{
							$po_qty+=$row[csf('order_quantity_set')];
						}
						unset($sql_po_qty);
						$sql_cons_data=sql_select("select a.id,a.rate,b.cons from wo_pre_cost_trim_cost_dtls a , wo_pre_cost_trim_co_cons_dtls b where a.id=b.wo_pre_cost_trim_cost_dtls_id and   b.po_break_down_id in($po_id)  and a.is_deleted=0  and a.status_active=1");
						//list($sql_cons_data_row)=$sql_cons_data;
						foreach($sql_cons_data as $row)
						{
							$pre_trims_arr[$row[csf('id')]]['cons']+=$row[csf('cons')];
							$pre_trims_arr[$row[csf('id')]]['rate']=$row[csf('rate')];
						}
						unset($sql_cons_data);
						$sql_cu_woq=sql_select("select pre_cost_fabric_cost_dtls_id,(amount) as amount  from wo_booking_dtls where po_break_down_id in($po_id)    and  booking_type=2 and status_active=1 and is_deleted=0");
						 foreach($sql_cu_woq as $row)
						{
							$wo_trims_arr[$row[csf('pre_cost_fabric_cost_dtls_id')]]['amount']+=$row[csf('amount')];
							 
						}
						unset($sql_cu_woq);
						

					$sql="select job_no,po_break_down_id,pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls where booking_no=$txt_booking_no and status_active=1 and is_deleted=0 group by job_no,po_break_down_id,pre_cost_fabric_cost_dtls_id,trim_group";
					$exchange_rate=return_field_value("exchange_rate", " wo_booking_dtls", "booking_no=".$txt_booking_no." and exchange_rate>0 and status_active=1 ");
					$i=1;
					$total_amount=0;
                    $nameArray=sql_select( $sql );
                    foreach ($nameArray as $selectResult)
                    {
						$costing_per=return_field_value("costing_per", "wo_pre_cost_mst", "job_no='".$selectResult[csf('job_no')]."'");

						if($costing_per==1)
						{
							$costing_per_qty=12;
						}
						else if($costing_per==2)
						{
							$costing_per_qty=1;
						}
						else if($costing_per==3)
						{
							$costing_per_qty=24;
						}
						else if($costing_per==4)
						{
							$costing_per_qty=36;
						}
						else if($costing_per==5)
						{
							$costing_per_qty=48;
						}

						/*$sql_po_qty=sql_select("select sum(c.order_quantity) as order_quantity,(sum(c.order_quantity)/a.total_set_qnty) as order_quantity_set  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and b.id=c.po_break_down_id and  b.id='".$selectResult[csf('po_break_down_id')]."'  and a.status_active=1 and b.status_active=1 and c.status_active=1 group by b.id,a.total_set_qnty");
						list($sql_po_qty_row)=$sql_po_qty;
						$po_qty=$sql_po_qty_row[csf('order_quantity_set')];*/

						/*$sql_cons_data=sql_select("select a.rate,b.cons from wo_pre_cost_trim_cost_dtls a , wo_pre_cost_trim_co_cons_dtls b where a.id=b.wo_pre_cost_trim_cost_dtls_id and  a.id='".$selectResult[csf('pre_cost_fabric_cost_dtls_id')]."' and b.po_break_down_id='".$selectResult[csf('po_break_down_id')]."' and a.is_deleted=0  and a.status_active=1");
						list($sql_cons_data_row)=$sql_cons_data;
						$pre_cons=$sql_cons_data_row[csf('cons')];
						$pre_rate=$sql_cons_data_row[csf('rate')];*/
						
						$pre_cons=$pre_trims_arr[$selectResult[csf('pre_cost_fabric_cost_dtls_id')]]['cons'];
						$pre_rate=$pre_trims_arr[$selectResult[csf('pre_cost_fabric_cost_dtls_id')]]['rate'];
						
						
						$pre_req_qnty=def_number_format(($pre_cons*($po_qty/$costing_per_qty))/$sql_lib_item_group_array[$selectResult[csf('trim_group')]][conversion_factor],5,"");
						$pre_amount=$pre_req_qnty*$pre_rate;

						/*$sql_cu_woq=sql_select("select sum(amount) as amount  from wo_booking_dtls where po_break_down_id='".$selectResult[csf('po_break_down_id')]."' and pre_cost_fabric_cost_dtls_id='".$selectResult[csf('pre_cost_fabric_cost_dtls_id')]."'  and  booking_type=2 and status_active=1 and is_deleted=0");
						list($sql_cu_woq_row)=$sql_cu_woq;*/
						//$cu_woq_amount=$sql_cu_woq_row[csf('amount')];
						$cu_woq_amount=$wo_trims_arr[$selectResult[csf('pre_cost_fabric_cost_dtls_id')]]['amount'];
	   ?>
                    <tr>
                    <td width="40"><? echo $i;?></td>
                    <td width="150">
					<? echo $trim_group_library[$selectResult[csf('trim_group')]];?>
                    </td>
                    <td width="150">
					<? echo $po_number[$selectResult[csf('po_break_down_id')]];?>
                    </td>
                    <td width="150" align="right">
                     <? echo number_format($pre_amount,4); ?>
                    </td>
                    <td width="" align="right">
                     <? echo number_format($cu_woq_amount/$exchange_rate,5);?>
                    </td>

                    </tr>
	   <?
	   $i++;
					}
       ?>
	</tbody>
    </table>
    <?
	}
	?>
    </td>
    </tr>
    </table>

    </div>
    <div>
		<?
        	echo signature_table(132, $cbo_company_name, "1330px");
        ?>
    </div>
    <?

	if($link==1)
	{?>
	<script type="text/javascript" src="../../../js/jquery.js"></script>
	<script type="text/javascript" src="../../../js/jquerybarcode.js"></script>
	<?
	}
	else
	{
	?>
	<script type="text/javascript" src="../../js/jquery.js"></script>
	<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
	<? }?>

	<script>
	fnc_generate_Barcode('<? echo $varcode_booking_no; ?>','barcode_img_id');
	</script>
	<?
	
	$html = ob_get_contents();
	ob_clean();
	list($is_mail_send,$mail)=explode('___',$mail_send_data);
	if($is_mail_send==1){
		require_once('../../../mailer/class.phpmailer.php');
		require_once('../../../auto_mail/setting/mail_setting.php');
		$mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
			
		$mailToArr=array();
		$mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
		//echo $mailSql;die;
		$mailSqlRes=sql_select($mailSql);
		foreach($mailSqlRes as $rows){
			if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		}
		
		
		$mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=98 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
		//echo $mailSql;die;
		$mailSqlRes=sql_select($mailSql);
		foreach($mailSqlRes as $rows){
			if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		}
		
		if($mail!=''){$mailToArr[]=$mail;}
		$to=implode(',',$mailToArr);
		$subject="  Trims Booking Multi Job ";
		$header=mailHeader();
		echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
		
	}
	else{
		echo $html;
	}
	exit();

}
if($action=="show_trim_booking_report18") //Zakaria joy (12/03/22)
{
	extract($_REQUEST);
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);
	$cbo_level=str_replace("'","",$cbo_level);
	$level_arr = array(1=>"PO Level",2=>"Job Level");
	$color_library=return_library_array("select id, color_name from lib_color", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$marchentrArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info ","id","team_member_name");
	$marchentr_email = return_library_array("select id,team_member_email from lib_mkt_team_member_info ","id","team_member_email");
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	$pro_sub_dept_array=return_library_array( "select id,sub_department_name from lib_pro_sub_deparatment",'id','sub_department_name');
	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");
	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id='$cbo_company_name'","image_location");
	$address = "";
	$add_info = "";
	$nameArray=sql_select("select plot_no, level_no, road_no, block_no, country_id, province, city, zip_code, email, website from lib_company where id=$cbo_company_name");
	if($nameArray[0][csf('plot_no')] != ''){
		$address.=$nameArray[0][csf('plot_no')].',';
	}
	if($nameArray[0][csf('level_no')] != ''){
		$address.=$nameArray[0][csf('level_no')].',';
	}
	if($nameArray[0][csf('road_no')] != ''){
		$address.=$nameArray[0][csf('road_no')].',';
	}
	if($nameArray[0][csf('block_no')] != ''){
		$address.=$nameArray[0][csf('block_no')].'<br>';
	}
	if($nameArray[0][csf('city')] != ''){
		$address.=$nameArray[0][csf('city')].',';
	}
	if($nameArray[0][csf('zip_code')] != 0 && $nameArray[0][csf('zip_code')] != ''){
		$address.='-'.$nameArray[0][csf('zip_code')].',';
	}
	if($nameArray[0][csf('province')] != ''){
		$address.=$nameArray[0][csf('province')].','.$country_arr[$nameArray[0][csf('country_id')]];
	}
	if($nameArray[0][csf('email')] != ''){
		$add_info.='Email: '.$nameArray[0][csf('email')];
	}
	if($nameArray[0][csf('website')] != ''){
		$add_info.=', Website: '.$nameArray[0][csf('website')];
	}

	
	/* Second Table Data */
	$po_booking_info=sql_select( "SELECT  a.style_ref_no,a.style_description, a.job_no, a.style_owner, a.buyer_name, a.client_id, a.dealing_marchant, a.season, a.season_matrix, a.total_set_qnty, a.product_dept, a.product_code, a.pro_sub_dep, a.gmts_item_id, a.order_repeat_no, a.qlty_label, c.internal_ref from wo_po_details_master a join wo_booking_dtls b on a.job_no=b.job_no left join wo_order_entry_internal_ref c on a.job_no=c.job_no where b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
	$job_data_arr=array();
	foreach ($po_booking_info as $result_buy){
		$job_data_attr = array('job_no','total_set_qnty','product_dept','product_code','pro_sub_dep','gmts_item_id','style_ref_no','style_description','dealing_marchant','season_matrix','order_repeat_no','qlty_label','client_id','internal_ref');
		foreach ($job_data_attr as $attr) {
			$job_data_arr[$result_buy[csf('job_no')]][$attr] = $result_buy[csf($attr)];
			$job_data_header_arr[$attr][] = $result_buy[csf($attr)];
			if($attr == 'product_dept'){
				$job_data_arr[$result_buy[csf('job_no')]][$attr]=$product_dept[$result_buy[csf($attr)]];
			}
			if($attr == 'pro_sub_dep'){
				$job_data_arr[$result_buy[csf('job_no')]][$attr]=$pro_sub_dept_array[$result_buy[csf($attr)]];
			}
			if($attr == 'dealing_marchant'){
				$job_data_arr[$attr][$result_buy[csf('job_no')]]=$marchentrArr[$result_buy[csf($attr)]];
			}
			if($attr == 'season_matrix'){
				$job_data_arr[$result_buy[csf('job_no')]][$attr]=$season_arr[$result_buy[csf($attr)]];
			}
			if($attr == 'qlty_label'){
				$job_data_arr[$result_buy[csf('job_no')]][$attr]=$quality_label[$result_buy[csf($attr)]];
			}
		}
		$job_data_arr['job_no_in'][$result_buy[csf('job_no')]]="'".$result_buy[csf('job_no')]."'";
		$job_data_arr['dealing_marchant_email'][$result_buy[csf('job_no')]]=$marchentr_email[$result_buy[csf('dealing_marchant')]];
	}
	/* echo '<pre>';
	print_r($job_data_arr); die; */
	$job_no= implode(", ",array_unique($job_data_arr['job_no']));
	$job_no_in= implode(", ",array_unique($job_data_arr['job_no_in']));
	$product_depertment=implode(", ",array_unique($job_data_arr['product_dept']));
	$product_code=implode(", ",array_unique($job_data_arr['product_code']));
	$pro_sub_dep=implode(", ",array_unique($job_data_arr['pro_sub_dep']));
	//$gmts_item_id=implode(", ",array_unique($job_data_arr['gmts_item_id']));
	$gmts_item_id=implode(", ",array_unique($job_data_header_arr['gmts_item_id']));
	$grouping=implode(", ",array_unique($job_data_header_arr['internal_ref']));
	$style_sting=implode(", ",array_unique($job_data_arr['style_ref_no']));
	$style_description=implode(", ",array_unique($job_data_arr['style_description']));
	$dealing_marchant=implode(", ",array_unique($job_data_arr['dealing_marchant']));
	$dealing_marchant_email=implode(", ",array_unique($job_data_arr['dealing_marchant_email']));
	$season_matrix=implode(", ",array_unique($job_data_arr['season_matrix']));
	$order_repeat_no= implode(",",array_unique($job_data_arr['order_repeat_no']));
	$qlty_label= implode(", ",array_unique($job_data_arr['qlty_label']));
	$client_id= implode(", ",array_unique($job_data_arr['client_id']));

	//echo $job_no; die;

	$booking_master_info=sql_select( "SELECT a.buyer_id, a.booking_no, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.po_break_down_id, a.colar_excess_percent, a.cuff_excess_percent,  a.is_apply_last_update, a.fabric_source, a.rmg_process_breakdown, a.insert_date, a.update_date, a.uom, a.remarks, a.pay_mode, a.fabric_composition,a.source,a.delivery_address, a.ship_mode from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0 ");
	$booking_grand_total=0;
	$currency_id="";

	if($booking_master_info[0][csf('pay_mode')]==5){
		$supplier_info=sql_select("SELECT a.company_name as supplier_name , a.contract_person, a.contact_no, a.email, a.plot_no as address_1, a.level_no as address_2 from lib_company a join wo_booking_mst b on a.id=b.supplier_id where b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
	}
	else{
		$supplier_info=sql_select("SELECT a.supplier_name, a.contact_person as contract_person, a.contact_no, a.email, a.address_1, a.address_2 from lib_supplier a join wo_booking_mst b on a.id=b.supplier_id where b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
	}
	foreach($supplier_info as $row){
		$contact_person_data=$row[csf('contract_person')];
		$contact_no=$row[csf('contact_no')];
		$contact_email=$row[csf('email')];
		$supplier_address=$row[csf('address_1')].' '.$row[csf('address_2')];
	}
	ob_start();

	?>
	<html>
	<head>
	</head>
	<?
		$booking_date=$booking_master_info[0][csf('update_date')];
		if($booking_date=="" || $booking_date=="0000-00-00 00:00:00"){
		$booking_date=$booking_master_info[0][csf('insert_date')];
		}
	?>
	<table style="border:1px solid black; table-layout: fixed; " width="100%">
		<tr>
			<td rowspan="5" width="20%"><?php if ($image_location != '') {?> <img src="../../<? echo $image_location; ?>" height="70" width="100"></td><?php }?>
		</tr>
		<tr>
			<td style="font-size:20px; text-align: center;" width="60%"><strong><? echo $company_library[$cbo_company_name]; ?></strong></td>
		</tr>
		<tr>
			<td style="font-size:16px; text-align: center;"><?php echo $address; ?>	</td>		
			<td rowspan="4" style="text-align: right; font-size:16px; font-weight: bold;" width="20%">Booking No. :<? echo $booking_master_info[0][csf('booking_no')];?><? echo "(".$fabric_source[$booking_master_info[0][csf('fabric_source')]].")"?><br>Date: <? echo change_date_format($booking_date,'dd-mm-yyyy','-','');?>
			</td>
		</tr>
		<tr>
			<td style="font-size:16px; text-align: center;"><?php echo $add_info ?></td>
		</tr>
		<tr>
			<td style="text-align: center; font-size:16px; text-decoration: underline; font-weight: bold;">Main Trims Purchase Order</td>
		</tr>
	</table>
	<?
	foreach ($booking_master_info as $result) {
		$currency_id=$result[csf('currency_id')];
		$booking_date=$result[csf('update_date')];
			if($booking_date=="" || $booking_date=="0000-00-00 00:00:00"){
				$booking_date=$result[csf('insert_date')];
			}
	 	?>
		<table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" style="margin-top: 5px; margin-bottom: 5px" >
			<tr>
				<th colspan="5" style="text-align: left">To,<br><?= $supplier_name_arr[$result[csf('supplier_id')]] ?></th>
			</tr>
	        <tr>
				<th width="175" style="text-align: left">Address</th>
	            <td colspan="2">
				<? if($result[csf('pay_mode')]==5){
				echo $address;
				}
				else{
				echo $supplier_address;
				} ?>
				</td>
	            <th width="175" style="text-align: left">Buyer Name</th>
	            <td width="175"><? $buyer_name_str=""; if($client_id!=0) $buyer_name_str=$buyer_name_arr[$result[csf('buyer_id')]]."-".$buyer_name_arr[$client_id]; else $buyer_name_str=$buyer_name_arr[$result[csf('buyer_id')]]; echo $buyer_name_str; ?></td>
	        </tr>
	        <tr>
				<th style="text-align: left">Contact Person</th>
	            <td colspan="2"><? echo $contact_person_data ?></td>
				<th style="text-align: left">Dealing Merchant </th>
	            <td><? echo $dealing_marchant; ?></td>
	        	
	        </tr>
	        <tr>
				<th style="text-align: left">Email</th>
	            <td colspan="2"><? echo $contact_email ?></td>
	            <th style="text-align: left">Currency</th>
	            <td><?echo $currency[$result[csf('currency_id')]]; ?></td>
	        </tr>
			<tr>
				<th style="text-align: left">Contact No</th>
	            <td colspan="2"><?= $contact_no  ?></td>
	            <th style="text-align: left">Pay Mode</th>
	            <td><? echo $pay_mode[$result[csf('pay_mode')]]; ?></td>
	        </tr>
			<tr>
	            <td colspan="3"></td>
	            <th style="text-align: left">Delivery Date</th>
	            <td><?echo change_date_format($result[csf('delivery_date')],'dd-mm-yyyy','-',''); ?></td>
	        </tr>
	        <tr>
	        	<th style="text-align: left">Remarks </th>
	            <td colspan="4"><? echo $result[csf('remarks')] ?></td>
	        </tr>
	    </table>
		<?
	}?>
	<?
	$booking_country_arr=array();
	$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,sensitivity,country_id_string from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0");
	foreach($nameArray_booking_country as $nameArray_booking_country_row){
		$country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
		$tocu=count($country_id_string);
		for($cu=0;$cu<$tocu;$cu++){
			$booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
		}
	}

	$no_sensitive_arr = array();
	$color_size_arr = array();
	$contrast_color_arr = array();
	$size_sensitive_arr = array();
	$as_per_gmts_color_arr = array();
	?>
	<!--===================================AS PER GMTS COLOR START===========================  -->
	<?
		$as_per_gmts_color = sql_select("SELECT b.job_id, a.pre_cost_fabric_cost_dtls_id, a.hs_code, e.id, b.pub_shipment_date,b.id as po_id, b.po_number, b.grouping,b.po_quantity as po_quantity, a.trim_group, c.cons_uom, e.brand_supplier as brand_sup_ref, e.description, e.rate, e.amount, d.style_ref_no, e.item_color, e.item_ref, c.id as trim_id, c.calculatorstring,c.remark, f.cal_parameter,sum(e.requirment) as booking_cons ,e.color_number_id ,e.item_size, e.gmts_sizes ,e.article_number from wo_booking_dtls a, wo_po_break_down b , wo_pre_cost_trim_cost_dtls c , wo_po_details_master d, wo_trim_book_con_dtls e, lib_item_group f where a.id= e.wo_trim_booking_dtls_id and a.booking_no=e.booking_no and a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0 and a.trim_group = f.id and a.pre_cost_fabric_cost_dtls_id = c.id and a.job_no=d.job_no and a.sensitivity=1 and e.requirment !=0 and e.status_active=1 and e.is_deleted=0 group by b.job_id, e.id, b.pub_shipment_date,b.id,b.po_quantity, b.po_number,b.grouping, a.pre_cost_fabric_cost_dtls_id, a.trim_group, c.cons_uom, e.brand_supplier, e.description, e.rate, e.amount, d.style_ref_no, e.item_color,c.calculatorstring,c.remark,f.cal_parameter ,e.color_number_id,e.item_size, e.gmts_sizes,e.article_number, a.hs_code,e.item_ref, c.id order by b.po_number");
		if(count($as_per_gmts_color)>0){
			foreach ($as_per_gmts_color as $key => $value) {
				$aspergmtskey=$value[csf('trim_group')].'**'.$value[csf('job_id')].'**'.trim($value[csf('hs_code')]);
				$gmts_color_attr =array('trim_group','hs_code','style_ref_no');
				foreach ($gmts_color_attr as $attr) {
					$as_per_gmts_color_arr[$aspergmtskey][$attr] = $value[csf($attr)];
				}
				$as_per_gmts_color_arr[$aspergmtskey]['po_wise'][$value[csf('po_id')]]['po_number']=$value[csf('po_number')];
				$as_per_gmts_color_arr[$aspergmtskey]['po_wise'][$value[csf('po_id')]]['grouping']=$value[csf('grouping')];
				$as_per_gmts_color_arr[$aspergmtskey]['po_wise'][$value[csf('po_id')]]['trim_wise'][$value[csf('trim_id')]]['description']=$value[csf('description')];
				$sub_gmts_color_attr = array('id', 'pub_shipment_date', 'grouping', 'po_quantity', 'trim_group', 'cons_uom', 'brand_sup_ref', 'description', 'rate', 'amount','item_color','calculatorstring','remark','cal_parameter','booking_cons','color_number_id','gmts_sizes','item_size','article_number','po_id','item_ref','job_id');
				foreach ($sub_gmts_color_attr as $attr) {
					$as_per_gmts_color_arr[$aspergmtskey]['po_wise'][$value[csf('po_id')]]['trim_wise'][$value[csf('trim_id')]]['trim_dtls'][$value[csf('id')]][$attr] = $value[csf($attr)];					
				}
				$as_per_gmts_po_arr[$value[csf('po_id')]]=$value[csf('po_id')];
			}
		}
		if(count($as_per_gmts_color_arr)>0){
			foreach($as_per_gmts_color_arr as $strdata=>$gmtscolordata){
				foreach($gmtscolordata['po_wise'] as $poid=>$powisedata){
					foreach($powisedata['trim_wise'] as $trimid=>$trimwisedata){
						foreach($trimwisedata['trim_dtls'] as $rowdata){
							$as_per_gmts_row[$strdata]['row_span']+=1;
							$as_per_gmts_row[$strdata.'**'.$poid]['po_span']+=1;
							$as_per_gmts_row[$strdata.'**'.$poid.'**'.$trimid]['trim_span']+=1;
						}
					}
				}
			}
		}
		if(count($as_per_gmts_po_arr)>0){
			$po_id_cond=where_con_using_array($as_per_gmts_po_arr,1,'a.po_break_down_id');
			$as_per_gmts_color_sample = sql_select("SELECT b.job_id, a.pre_cost_fabric_cost_dtls_id, a.hs_code, e.id, b.id as po_id, a.trim_group, c.cons_uom, e.item_color, c.id as trim_id, e.cons as booking_cons ,e.color_number_id  from wo_booking_dtls a, wo_po_break_down b , wo_pre_cost_trim_cost_dtls c , wo_po_details_master d, wo_trim_book_con_dtls e, lib_item_group f where a.id= e.wo_trim_booking_dtls_id and a.booking_no=e.booking_no and a.po_break_down_id=b.id and a.status_active =1 and a.is_deleted=0 and a.trim_group = f.id and a.pre_cost_fabric_cost_dtls_id = c.id and a.job_no=d.job_no and a.sensitivity=1 
		   and e.cons !=0 and e.status_active=1 and e.is_deleted=0 and a.booking_type=5 $po_id_cond group by b.job_id, a.pre_cost_fabric_cost_dtls_id, a.hs_code, e.id, b.id , a.trim_group, 
		   c.cons_uom,  e.item_color, c.id ,e.color_number_id, e.cons  order by b.id");
		   if(count($as_per_gmts_color_sample)>0){
			   foreach($as_per_gmts_color_sample as $row){
				   $gmts_sample_key=$row[csf('trim_group')].'**'.$row[csf('job_id')].'**'.$row[csf('trim_id')].'**'.$row[csf('po_id')].'**'.$row[csf('item_color')];				   
				$as_per_gmts_color_sample_arr[$gmts_sample_key]+=$row[csf('booking_cons')];
			   }			   
		   }
		} 
		
		/* echo '<pre>';
		print_r($as_per_gmts_color_sample_arr); die; */
	?>
    <!--===================================AS PER GMTS COLOR END=============================  -->
    <!--==================================Size Sensitive START===============================  -->
	<?
		$size_sensitive = sql_select("SELECT b.job_id, a.pre_cost_fabric_cost_dtls_id, a.hs_code, e.id, b.pub_shipment_date,b.id as po_id, b.po_number, b.grouping,b.po_quantity as po_quantity, a.trim_group, c.cons_uom, e.brand_supplier as brand_sup_ref, e.description, e.rate, e.amount, d.style_ref_no, e.item_color, e.item_ref, c.id as trim_id, c.calculatorstring,c.remark, f.cal_parameter,sum(e.requirment) as booking_cons ,e.color_number_id ,e.item_size, e.gmts_sizes ,e.article_number from wo_booking_dtls a, wo_po_break_down b , wo_pre_cost_trim_cost_dtls c , wo_po_details_master d, wo_trim_book_con_dtls e, lib_item_group f where a.id= e.wo_trim_booking_dtls_id and a.booking_no=e.booking_no and a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0 and a.trim_group = f.id and a.pre_cost_fabric_cost_dtls_id = c.id and a.job_no=d.job_no and a.sensitivity=2 and e.requirment !=0 and e.status_active=1 and e.is_deleted=0 group by b.job_id, e.id, b.pub_shipment_date,b.id,b.po_quantity, b.po_number,b.grouping, a.pre_cost_fabric_cost_dtls_id, a.trim_group, c.cons_uom, e.brand_supplier, e.description, e.rate, e.amount, d.style_ref_no, e.item_color,c.calculatorstring,c.remark,f.cal_parameter ,e.color_number_id,e.item_size, e.gmts_sizes,e.article_number, a.hs_code,e.item_ref, c.id order by b.po_number");
		foreach ($size_sensitive as $key => $value) {
			$as_per_size_po_arr[$value[csf('po_id')]]=$value[csf('po_id')];
		}
		if(count($as_per_size_po_arr)>0){
			$po_id_cond=where_con_using_array($as_per_size_po_arr,1,'a.po_break_down_id');
			$as_per_size_color_sample = sql_select("SELECT b.job_id, a.pre_cost_fabric_cost_dtls_id, a.hs_code, e.id, b.id as po_id, a.trim_group, c.cons_uom, e.item_color, c.id as trim_id, e.cons as booking_cons ,e.color_number_id, e.item_size  from wo_booking_dtls a, wo_po_break_down b , wo_pre_cost_trim_cost_dtls c , wo_po_details_master d, wo_trim_book_con_dtls e, lib_item_group f where a.id= e.wo_trim_booking_dtls_id and a.booking_no=e.booking_no and a.po_break_down_id=b.id and a.status_active =1 and a.is_deleted=0 and a.trim_group = f.id and a.pre_cost_fabric_cost_dtls_id = c.id and a.job_no=d.job_no and a.sensitivity=2 and e.cons !=0 and e.status_active=1 and e.is_deleted=0 and a.booking_type=5 $po_id_cond group by b.job_id, a.pre_cost_fabric_cost_dtls_id, a.hs_code, e.id, b.id , a.trim_group, c.cons_uom,  e.item_color, c.id ,e.color_number_id, e.cons, e.item_size  order by b.id");
		   if(count($as_per_size_color_sample)>0){
			   foreach($as_per_size_color_sample as $row){
				   $size_sample_key=$row[csf('trim_group')].'**'.$row[csf('job_id')].'**'.$row[csf('trim_id')].'**'.$row[csf('po_id')].'**'.trim($row[csf('item_size')]);				   
				$as_per_size_color_sample_arr[$size_sample_key]+=$row[csf('booking_cons')];
			   }			   
		   }
		}

		if(count($size_sensitive)>0){
			foreach ($size_sensitive as $key => $value) {
				$aspersizekey=$value[csf('trim_group')].'**'.$value[csf('job_id')].'**'.trim($value[csf('hs_code')]);
				$size_sensitive_attr =array('trim_group','hs_code','style_ref_no');
				foreach ($size_sensitive_attr as $attr) {
					$size_sensitive_arr[$aspersizekey][$attr] = $value[csf($attr)];
				}
				$size_sensitive_arr[$aspersizekey]['po_wise'][$value[csf('po_id')]]['po_number']=$value[csf('po_number')];
				$size_sensitive_arr[$aspersizekey]['po_wise'][$value[csf('po_id')]]['grouping']=$value[csf('grouping')];
				$size_sensitive_arr[$aspersizekey]['po_wise'][$value[csf('po_id')]]['trim_wise'][$value[csf('trim_id')]]['description']=$value[csf('description')];
				$sub_size_sensitive_attr = array('id', 'pub_shipment_date', 'grouping', 'po_quantity', 'trim_group', 'cons_uom', 'brand_sup_ref', 'description', 'rate', 'amount','item_color','calculatorstring','remark','cal_parameter','color_number_id','gmts_sizes','item_size','article_number','po_id','item_ref');
				$trim_size_key=$value[csf('item_size')];
				$sizesamplekey=$value[csf('trim_group')].'**'.$value[csf('job_id')].'**'.$value[csf('trim_id')].'**'.$value[csf('po_id')].'**'.trim($value[csf('item_size')]);
				$sampleqty=0;
				if($as_per_gmts_color_sample_arr[$sizesamplekey]>0){
					$sampleqty=$as_per_size_color_sample_arr[$sizesamplekey];
				}
				foreach ($sub_size_sensitive_attr as $attr) {
					$size_sensitive_arr[$aspersizekey]['po_wise'][$value[csf('po_id')]]['trim_wise'][$value[csf('trim_id')]]['trim_dtls'][$trim_size_key][$attr] = $value[csf($attr)];					
				}
				$size_sensitive_arr[$aspersizekey]['po_wise'][$value[csf('po_id')]]['trim_wise'][$value[csf('trim_id')]]['trim_dtls'][$trim_size_key]['booking_cons'] += $value[csf('booking_cons')];				
				$size_sensitive_arr[$aspersizekey]['po_wise'][$value[csf('po_id')]]['trim_wise'][$value[csf('trim_id')]]['trim_dtls'][$trim_size_key]['sampleqty'] += $sampleqty;				
			}
		}
		if(count($size_sensitive_arr)>0){
			foreach($size_sensitive_arr as $strdata=>$sizecolordata){
				foreach($sizecolordata['po_wise'] as $poid=>$powisedata){
					foreach($powisedata['trim_wise'] as $trimid=>$trimwisedata){
						foreach($trimwisedata['trim_dtls'] as $rowdata){
							$as_per_size_row[$strdata]['row_span']+=1;
							$as_per_size_row[$strdata.'**'.$poid]['po_span']+=1;
							$as_per_size_row[$strdata.'**'.$poid.'**'.$trimid]['trim_span']+=1;
						}
					}
				}
			}
		}		
		/* echo '<pre>';
		print_r($size_sensitive_arr); die; */

	?>
    <!--==============================Size Sensitive END====================================  -->
    <!--==============================AS PER CONTRAST COLOR START===========================  -->
	<?
		$contrast_color = sql_select("SELECT b.job_id, a.pre_cost_fabric_cost_dtls_id, a.hs_code, e.id, b.pub_shipment_date,b.id as po_id, b.po_number, b.grouping,b.po_quantity as po_quantity, a.trim_group, c.cons_uom, e.brand_supplier as brand_sup_ref, e.description, e.rate, e.amount, d.style_ref_no, e.item_color, e.item_ref, c.id as trim_id, c.calculatorstring,c.remark, f.cal_parameter,sum(e.requirment) as booking_cons ,e.color_number_id ,e.item_size, e.gmts_sizes ,e.article_number from wo_booking_dtls a, wo_po_break_down b , wo_pre_cost_trim_cost_dtls c , wo_po_details_master d, wo_trim_book_con_dtls e, lib_item_group f where a.id= e.wo_trim_booking_dtls_id and a.booking_no=e.booking_no and a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0 and a.trim_group = f.id and a.pre_cost_fabric_cost_dtls_id = c.id and a.job_no=d.job_no and a.sensitivity=3 and e.requirment !=0 and e.status_active=1 and e.is_deleted=0 group by b.job_id, e.id, b.pub_shipment_date,b.id,b.po_quantity, b.po_number,b.grouping, a.pre_cost_fabric_cost_dtls_id, a.trim_group, c.cons_uom, e.brand_supplier, e.description, e.rate, e.amount, d.style_ref_no, e.item_color,c.calculatorstring,c.remark,f.cal_parameter ,e.color_number_id,e.item_size, e.gmts_sizes,e.article_number, a.hs_code,e.item_ref, c.id order by b.po_number");
		foreach ($contrast_color as $key => $value) {
			$as_per_contrast_po_arr[$value[csf('po_id')]]=$value[csf('po_id')];
		}
		if(count($as_per_contrast_po_arr)>0){
			$po_id_cond=where_con_using_array($as_per_size_po_arr,1,'a.po_break_down_id');
			$contrast_color_sample = sql_select("SELECT b.job_id, a.pre_cost_fabric_cost_dtls_id, a.hs_code, e.id, b.id as po_id, a.trim_group, c.cons_uom, e.item_color, c.id as trim_id, e.cons as booking_cons ,e.color_number_id  from wo_booking_dtls a, wo_po_break_down b , wo_pre_cost_trim_cost_dtls c , wo_po_details_master d, wo_trim_book_con_dtls e, lib_item_group f where a.id= e.wo_trim_booking_dtls_id and a.booking_no=e.booking_no and a.po_break_down_id=b.id and a.status_active =1 and a.is_deleted=0 and a.trim_group = f.id and a.pre_cost_fabric_cost_dtls_id = c.id and a.job_no=d.job_no and a.sensitivity=3 
		   and e.cons !=0 and e.status_active=1 and e.is_deleted=0 and a.booking_type=5 $po_id_cond group by b.job_id, a.pre_cost_fabric_cost_dtls_id, a.hs_code, e.id, b.id , a.trim_group, 
		   c.cons_uom,  e.item_color, c.id ,e.color_number_id, e.cons  order by b.id");
		   if(count($contrast_color_sample)>0){
			   foreach($contrast_color_sample as $row){
				   $size_sample_key=$row[csf('trim_group')].'**'.$row[csf('job_id')].'**'.$row[csf('trim_id')].'**'.$row[csf('po_id')].'**'.$row[csf('item_color')];				   
					$contrast_sample_arr[$size_sample_key]+=$row[csf('booking_cons')];
			   }			   
		   }
		}

		if(count($contrast_color)>0){
			foreach ($contrast_color as $key => $value) {
				$contrastkey=$value[csf('trim_group')].'**'.$value[csf('job_id')].'**'.trim($value[csf('hs_code')]);
				$contrast_sensitive_attr =array('trim_group','hs_code','style_ref_no');
				foreach ($contrast_sensitive_attr as $attr) {
					$contrast_color_arr[$contrastkey][$attr] = $value[csf($attr)];
				}
				$contrast_color_arr[$contrastkey]['po_wise'][$value[csf('po_id')]]['po_number']=$value[csf('po_number')];
				$contrast_color_arr[$contrastkey]['po_wise'][$value[csf('po_id')]]['grouping']=$value[csf('grouping')];
				$contrast_color_arr[$contrastkey]['po_wise'][$value[csf('po_id')]]['trim_wise'][$value[csf('trim_id')]]['description']=$value[csf('description')];
				$sub_contrast_sensitive_attr = array('id', 'pub_shipment_date', 'grouping', 'po_quantity', 'trim_group', 'cons_uom', 'brand_sup_ref', 'description', 'rate', 'amount','item_color','calculatorstring','remark','cal_parameter','color_number_id','gmts_sizes','item_size','article_number','po_id','item_ref');
				$trim_contrast_key=$value[csf('color_number_id')].'*'.$value[csf('item_color')];
				$contrastsamplekey=$value[csf('trim_group')].'**'.$value[csf('job_id')].'**'.$value[csf('trim_id')].'**'.$value[csf('po_id')].'**'.$value[csf('item_color')];
				$sampleqty=0;
				if($contrast_sample_arr[$contrastsamplekey]>0){
					$sampleqty=$contrast_sample_arr[$contrastsamplekey];
				}
				foreach ($sub_contrast_sensitive_attr as $attr) {
					$contrast_color_arr[$contrastkey]['po_wise'][$value[csf('po_id')]]['trim_wise'][$value[csf('trim_id')]]['trim_dtls'][$trim_contrast_key][$attr] = $value[csf($attr)];					
				}
				$contrast_color_arr[$contrastkey]['po_wise'][$value[csf('po_id')]]['trim_wise'][$value[csf('trim_id')]]['trim_dtls'][$trim_contrast_key]['booking_cons'] += $value[csf('booking_cons')];				
				$contrast_color_arr[$contrastkey]['po_wise'][$value[csf('po_id')]]['trim_wise'][$value[csf('trim_id')]]['trim_dtls'][$trim_contrast_key]['sampleqty'] += $sampleqty;				
			}
		}
		if(count($contrast_color_arr)>0){
			foreach($contrast_color_arr as $strdata=>$contrastcolordata){
				foreach($contrastcolordata['po_wise'] as $poid=>$powisedata){
					foreach($powisedata['trim_wise'] as $trimid=>$trimwisedata){
						foreach($trimwisedata['trim_dtls'] as $rowdata){
							$as_per_contrast_row[$strdata]['row_span']+=1;
							$as_per_contrast_row[$strdata.'**'.$poid]['po_span']+=1;
							$as_per_contrast_row[$strdata.'**'.$poid.'**'.$trimid]['trim_span']+=1;
						}
					}
				}
			}
		}
		//echo "<pre>".print_r($size_sensitive_arr, true); die;
	?>
    <!--=============================AS PER CONTRAST COLOR ==================================  -->
    <!--=============================AS PER GMTS Color & SIZE START==========================  -->
	<?
		$color_size = sql_select("SELECT b.job_id, a.pre_cost_fabric_cost_dtls_id, a.hs_code, e.id, b.pub_shipment_date,b.id as po_id, b.po_number, b.grouping,b.po_quantity as po_quantity, a.trim_group, c.cons_uom, e.brand_supplier as brand_sup_ref, e.description, e.rate, e.amount, d.style_ref_no, e.item_color, e.item_ref, c.id as trim_id, c.calculatorstring,c.remark, f.cal_parameter,sum(e.requirment) as booking_cons ,e.color_number_id ,e.item_size, e.gmts_sizes ,e.article_number, min(g.color_order) as color_order, min(g.size_order) as size_order from wo_booking_dtls a, wo_po_break_down b , wo_pre_cost_trim_cost_dtls c , wo_po_details_master d, wo_trim_book_con_dtls e, lib_item_group f, wo_po_color_size_breakdown g where a.id= e.wo_trim_booking_dtls_id and a.booking_no=e.booking_no and a.po_break_down_id=b.id and  e.po_break_down_id=g.po_break_down_id and  e.color_number_id=g.color_number_id and e.gmts_sizes=g.size_number_id and  g.id=e.color_size_table_id and a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0 and a.trim_group = f.id and a.pre_cost_fabric_cost_dtls_id = c.id and a.job_no=d.job_no and a.sensitivity=4 and e.requirment !=0 and e.status_active=1 and e.is_deleted=0 group by b.job_id, e.id, b.pub_shipment_date,b.id,b.po_quantity, b.po_number,b.grouping, a.pre_cost_fabric_cost_dtls_id, a.trim_group, c.cons_uom, e.brand_supplier, e.description, e.rate, e.amount, d.style_ref_no, e.item_color,c.calculatorstring,c.remark,f.cal_parameter ,e.color_number_id,e.item_size, e.gmts_sizes, e.article_number, a.hs_code,e.item_ref, c.id order by e.id");
		foreach ($color_size as $key => $value) {
			$colorsizekey_po_arr[$value[csf('po_id')]]=$value[csf('po_id')];
		}
		if(count($colorsizekey_po_arr)>0){
			$po_id_cond=where_con_using_array($colorsizekey_po_arr,1,'a.po_break_down_id');
			$colorsize_sample = sql_select("SELECT b.job_id, a.pre_cost_fabric_cost_dtls_id, a.hs_code, e.id, b.id as po_id, a.trim_group, c.cons_uom, e.item_color, c.id as trim_id, e.cons as booking_cons ,e.color_number_id, e.gmts_sizes  from wo_booking_dtls a, wo_po_break_down b , wo_pre_cost_trim_cost_dtls c , wo_po_details_master d, wo_trim_book_con_dtls e, lib_item_group f where a.id= e.wo_trim_booking_dtls_id and a.booking_no=e.booking_no and a.po_break_down_id=b.id and a.status_active =1 and a.is_deleted=0 and a.trim_group = f.id and a.pre_cost_fabric_cost_dtls_id = c.id and a.job_no=d.job_no and a.sensitivity=4 
		   and e.cons !=0 and e.status_active=1 and e.is_deleted=0 and a.booking_type=5 $po_id_cond group by b.job_id, a.pre_cost_fabric_cost_dtls_id, a.hs_code, e.id, b.id , a.trim_group, 
		   c.cons_uom,  e.item_color, c.id ,e.color_number_id, e.cons  order by b.id");
		   if(count($colorsize_sample)>0){
			   foreach($colorsize_sample as $row){
				   $colorsize_sample_key=$row[csf('trim_group')].'**'.$row[csf('job_id')].'**'.$row[csf('trim_id')].'**'.$row[csf('po_id')].'**'.$row[csf('item_color')].'**'.$row[csf('color_number_id')].'**'.$row[csf('gmts_sizes')];				   
					$colorsize_sample_arr[$colorsize_sample_key]+=$row[csf('booking_cons')];
			   }			   
		   }
		}
		if(count($color_size)>0){
			foreach ($color_size as $key => $value) {
				$colorsizekey=$value[csf('trim_group')].'**'.$value[csf('job_id')].'**'.trim($value[csf('hs_code')]);
				$color_size_attr =array('trim_group','hs_code','style_ref_no');
				foreach ($color_size_attr as $attr) {
					$color_size_arr[$colorsizekey][$attr] = $value[csf($attr)];
				}
				$color_size_arr[$colorsizekey]['po_wise'][$value[csf('po_id')]]['po_number']=$value[csf('po_number')];
				$color_size_arr[$colorsizekey]['po_wise'][$value[csf('po_id')]]['grouping']=$value[csf('grouping')];
				$color_size_arr[$colorsizekey]['po_wise'][$value[csf('po_id')]]['trim_wise'][$value[csf('trim_id')]]['description']=$value[csf('description')];
				$sub_color_size_attr = array('id', 'pub_shipment_date', 'grouping', 'po_quantity', 'trim_group', 'cons_uom', 'brand_sup_ref', 'description', 'rate', 'amount','item_color','calculatorstring','remark','cal_parameter','color_number_id','gmts_sizes','item_size','article_number','po_id','item_ref');
				$trim_key=$value[csf('article_number')].'*'.$value[csf('color_number_id')].'*'.$value[csf('item_size')];
				$colorsizesamplekey=$value[csf('trim_group')].'**'.$value[csf('job_id')].'**'.$value[csf('trim_id')].'**'.$value[csf('po_id')].'**'.$value[csf('item_color')].'**'.$value[csf('color_number_id')].'**'.$value[csf('gmts_sizes')];;
				$sampleqty=0;
				if($colorsize_sample_arr[$colorsizesamplekey]>0){
					$sampleqty=$colorsize_sample_arr[$colorsizesamplekey];
					$color_size_arr[$colorsizekey]['po_wise'][$value[csf('po_id')]]['trim_wise'][$value[csf('trim_id')]]['trim_dtls'][$trim_key]['sampleqty'] += $sampleqty;
				}
				foreach ($sub_color_size_attr as $attr) {					
					//$color_size_arr[$colorsizekey]['po_wise'][$value[csf('po_id')]]['trim_wise'][$value[csf('trim_id')]]['trim_dtls'][$value[csf('id')]][$attr] = $value[csf($attr)];					
					$color_size_arr[$colorsizekey]['po_wise'][$value[csf('po_id')]]['trim_wise'][$value[csf('trim_id')]]['trim_dtls'][$trim_key][$attr] = $value[csf($attr)];				
				}
									
				$color_size_arr[$colorsizekey]['po_wise'][$value[csf('po_id')]]['trim_wise'][$value[csf('trim_id')]]['trim_dtls'][$trim_key]['booking_cons'] += $value[csf('booking_cons')];	
				
			}
		}
		if(count($color_size_arr)>0){
			foreach($color_size_arr as $strdata=>$colorsizedata){
				foreach($colorsizedata['po_wise'] as $poid=>$powisedata){
					foreach($powisedata['trim_wise'] as $trimid=>$trimwisedata){
						foreach($trimwisedata['trim_dtls'] as $rowdata){
							$colorsizekey_row[$strdata]['row_span']+=1;
							$colorsizekey_row[$strdata.'**'.$poid]['po_span']+=1;
							$colorsizekey_row[$strdata.'**'.$poid.'**'.$trimid]['trim_span']+=1;
						}
					}
				}
			}
		}
		
		/* echo '<pre>';
		print_r($color_size_arr); die; */
   	?>
    <!--===================================AS PER Color & SIZE ==============================  -->
    <!--===================================NO SENSITIBITY START===============================  -->
	<?
		$no_sensitive_item = sql_select("SELECT b.job_id, a.pre_cost_fabric_cost_dtls_id, a.hs_code, e.id, b.pub_shipment_date,b.id as po_id, b.po_number, b.grouping,b.po_quantity as po_quantity, a.trim_group, c.cons_uom, e.brand_supplier as brand_sup_ref, e.description, e.rate, e.amount, d.style_ref_no, e.item_color, e.item_ref, c.id as trim_id, c.calculatorstring,c.remark, f.cal_parameter,sum(e.requirment) as booking_cons ,e.color_number_id ,e.item_size, e.gmts_sizes ,e.article_number from wo_booking_dtls a, wo_po_break_down b , wo_pre_cost_trim_cost_dtls c , wo_po_details_master d, wo_trim_book_con_dtls e, lib_item_group f where a.id= e.wo_trim_booking_dtls_id and a.booking_no=e.booking_no and a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0 and a.trim_group = f.id and a.pre_cost_fabric_cost_dtls_id = c.id and a.job_no=d.job_no and a.sensitivity=0 and e.requirment !=0 and e.status_active=1 and e.is_deleted=0 group by b.job_id, e.id, b.pub_shipment_date,b.id,b.po_quantity, b.po_number,b.grouping, a.pre_cost_fabric_cost_dtls_id, a.trim_group, c.cons_uom, e.brand_supplier, e.description, e.rate, e.amount, d.style_ref_no, e.item_color,c.calculatorstring,c.remark,f.cal_parameter ,e.color_number_id,e.item_size, e.gmts_sizes,e.article_number, a.hs_code,e.item_ref, c.id order by b.po_number");
		if(count($no_sensitive_item)>0){
			foreach ($no_sensitive_item as $key => $value) {
				$sensitivekey=$value[csf('trim_group')].'**'.$value[csf('job_id')].'**'.trim($value[csf('hs_code')]);
				$sensitive_attr =array('trim_group','hs_code','style_ref_no');
				foreach ($sensitive_attr as $attr) {
					$no_sensitive_arr[$sensitivekey][$attr] = $value[csf($attr)];
				}
				$no_sensitive_arr[$sensitivekey]['po_wise'][$value[csf('po_id')]]['po_number']=$value[csf('po_number')];
				$no_sensitive_arr[$sensitivekey]['po_wise'][$value[csf('po_id')]]['grouping']=$value[csf('grouping')];
				$no_sensitive_arr[$sensitivekey]['po_wise'][$value[csf('po_id')]]['trim_wise'][$value[csf('trim_id')]]['description']=$value[csf('description')];
				$sub_sensitive_attr = array('id', 'pub_shipment_date', 'grouping', 'po_quantity', 'trim_group', 'cons_uom', 'brand_sup_ref', 'description', 'rate', 'amount','item_color','calculatorstring','remark','cal_parameter','booking_cons','color_number_id','gmts_sizes','item_size','article_number','po_id','item_ref');
				foreach ($sub_sensitive_attr as $attr) {
					$no_sensitive_arr[$sensitivekey]['po_wise'][$value[csf('po_id')]]['trim_wise'][$value[csf('trim_id')]]['trim_dtls'][$value[csf('id')]][$attr] = $value[csf($attr)];					
				}
				$nosensitive_po_arr[$value[csf('po_id')]]=$value[csf('po_id')];
			}
		}
		if(count($no_sensitive_arr)>0){
			foreach($no_sensitive_arr as $strdata=>$nosensitivedata){
				foreach($nosensitivedata['po_wise'] as $poid=>$powisedata){
					foreach($powisedata['trim_wise'] as $trimid=>$trimwisedata){
						foreach($trimwisedata['trim_dtls'] as $rowdata){
							$nosensitivedata_row[$strdata]['row_span']+=1;
							$nosensitivedata_row[$strdata.'**'.$poid]['po_span']+=1;
							$nosensitivedata_row[$strdata.'**'.$poid.'**'.$trimid]['trim_span']+=1;
						}
					}
				}
			}
		}
		if(count($nosensitive_po_arr)>0){
			$po_id_cond=where_con_using_array($nosensitive_po_arr,1,'a.po_break_down_id');
			$nosensitive_color_sample = sql_select("SELECT b.job_id, a.pre_cost_fabric_cost_dtls_id, a.hs_code, e.id, b.id as po_id, a.trim_group, c.cons_uom, e.item_color, c.id as trim_id, e.cons as booking_cons ,e.color_number_id, e.item_size  from wo_booking_dtls a, wo_po_break_down b , wo_pre_cost_trim_cost_dtls c , wo_po_details_master d, wo_trim_book_con_dtls e, lib_item_group f where a.id= e.wo_trim_booking_dtls_id and a.booking_no=e.booking_no and a.po_break_down_id=b.id and a.status_active =1 and a.is_deleted=0 and a.trim_group = f.id and a.pre_cost_fabric_cost_dtls_id = c.id and a.job_no=d.job_no and a.sensitivity=0 and e.cons !=0 and e.status_active=1 and e.is_deleted=0 and a.booking_type=5 $po_id_cond group by b.job_id, a.pre_cost_fabric_cost_dtls_id, a.hs_code, e.id, b.id , a.trim_group, c.cons_uom,  e.item_color, c.id ,e.color_number_id, e.cons, e.item_size  order by b.id");
		   if(count($nosensitive_color_sample)>0){
			   foreach($nosensitive_color_sample as $row){
				   $size_sample_key=$row[csf('trim_group')].'**'.$row[csf('job_id')].'**'.$row[csf('trim_id')].'**'.$row[csf('po_id')].'**'.trim($row[csf('item_color')]);				   
				$nosensitive_color_sample_arr[$size_sample_key]+=$row[csf('booking_cons')];
			   }			   
		   }
		}
		/*echo '<pre>';
		print_r($no_sensitive_arr); die;*/

	$cal_parameter_arr = array(1=>"Mtr",2=>"Pcs",3=>"Pcs",4=>"Pcs",5=>"Yds",6=>"Yds",7=>"Pcs",8=>"Yds");
	$grand_total_value=0;
	if(count($as_per_gmts_color_arr) > 0){ ?>		
			<table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" style="margin-bottom: 10px" >
				<tr>
				<? $header ='As Per Garments Color'?>
                <td colspan="<? echo ($show_comment==1 ? '17':'16') ?>"><strong><? echo $header ?></strong></td>
            	</tr>
            	<tr>
                <th>Sl</th>
                <th>Item Group</th>
                <th>HS Code</th>
                <th>Style No.</th>
                <th>Order NO</th>
                <th>Int Ref.</th>
                <th>Description</th>
                <th>Article No</th>
                <th>Item Color</th>
                <th>Qty per Unit</th>
                <th>Bulk Qty</th>
                <th>Sample Qty</th>
                <th title="Bulk Qty+Sample Qty">Total Qty</th>
                <th>Unit</th>
                <th>Rate</th>
                <th>Total Value</th>
                <? if($show_comment==1) {?>
                <th>Remarks</th>
                <? } ?>
            </tr>
			<? 
			$gcolor=1; $i=1;
			foreach($as_per_gmts_color_arr as $keystr=>$data_arr){ ?>
				<tr>
				<td rowspan="<? echo $as_per_gmts_row[$keystr]['row_span']+1 ?>"><? echo $i; ?></td>
				<td rowspan="<? echo $as_per_gmts_row[$keystr]['row_span']+1 ?>"><? echo $trim_group_library[$data_arr['trim_group']];?> </td>
				<td rowspan="<? echo $as_per_gmts_row[$keystr]['row_span']+1 ?>"><? echo $data_arr['hs_code'];?> </td>
				<td rowspan="<? echo $as_per_gmts_row[$keystr]['row_span']+1 ?>"><? echo $data_arr['style_ref_no'];?> </td>
				<? 
				$po_wise_total_qty=0; $po_wise_total_value=0;
				foreach($data_arr['po_wise'] as $poid=>$po_data_arr){
					?>
					
					<td rowspan="<? echo $as_per_gmts_row[$keystr.'**'.$poid]['po_span'] ?>"><? echo $po_data_arr['po_number'];?> </td>
					<td rowspan="<? echo $as_per_gmts_row[$keystr.'**'.$poid]['po_span'] ?>"><? echo $po_data_arr['grouping'];?> </td>
					<? foreach($po_data_arr['trim_wise'] as $trimid=>$trimdata){
						 ?>
						<td rowspan="<? echo $as_per_gmts_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><? echo $trimdata['description'];?> </td>
						<?
						$tgcolor=1;
						foreach($trimdata['trim_dtls'] as $rowdtls){
							$gmtssamplekey=$rowdtls['trim_group'].'**'.$rowdtls['job_id'].'**'.$trimid.'**'.$poid.'**'.$rowdtls['item_color'];
							$sampleqty=0;
							if($as_per_gmts_color_sample_arr[$gmtssamplekey]>0){
								$sampleqty=$as_per_gmts_color_sample_arr[$gmtssamplekey];
							}
							
							$calQty=explode("_",$rowdtls['calculatorstring']);
							if($rowdtls['cal_parameter'] && end($calQty)){
							$per_unit= "1".$unit_of_measurement[$order_uom_arr[$rowdtls['trim_group']]]."=".$calQty[2]." ".$cal_parameter_arr[$rowdtls['cal_parameter']];
							}
							else{
								$per_unit = '';
							}
							$total_qty=$sampleqty+$rowdtls['booking_cons'];
							$amount=$total_qty*$rowdtls['rate'];
							$po_wise_total_qty +=$total_qty;
							$po_wise_total_value +=$amount;
						 ?>
							<td><?= $rowdtls['item_ref'] ?></td>
							<td><?= $color_library[$rowdtls['item_color']] ?></td>
							<? if($tgcolor==1){ ?>
							<td rowspan="<? echo $as_per_gmts_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><?= $per_unit ?></td>
							<? } ?>
							<td align="right"><?= $rowdtls['booking_cons'] ?></td>
							<td align="right" ><?= fn_number_format($sampleqty,2) ?></td>
							<td align="right"><?= fn_number_format($total_qty,4)  ?></td>
							<? if($tgcolor==1){ ?>
							<td rowspan="<? echo $as_per_gmts_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><?= $unit_of_measurement[$rowdtls['cons_uom']]  ?></td>
							<? } ?>
							<td align="right"><?= $rowdtls['rate'] ?></td>
							<td align="right"><?= fn_number_format($amount,4) ?></td>
							<? if($tgcolor==1){ ?>
							<td rowspan="<? echo $as_per_gmts_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><?= $rowdtls['remark'] ?></td>
							<? } ?>
							</tr>
						<? 
							$gcolor++;
							$tgcolor++;
							$grand_total_value+=$amount;
						} 
						?>
					<? }  ?>
				<? } ?>
				<tr>
				<th colspan="6" align="right">Item Total</th>
				<th></th>
				<th></th>
				<th align="right"><?= fn_number_format($po_wise_total_qty,4) ?></th>
				<td></td>
				<td></td>
				<th align="right"><?= fn_number_format($po_wise_total_value,4)  ?></th>
				<td></td>
				</tr>
			<? $i++; } ?>
			</table><?
	}
	if(count($size_sensitive_arr) > 0){ ?>		
		<table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" style="margin-bottom: 10px" >
			<tr>
			<? $header ='Size Sensitive'?>
			<td colspan="<? echo ($show_comment==1 ? '17':'16') ?>"><strong><? echo $header ?></strong></td>
			</tr>
			<tr>
			<th>Sl</th>
			<th>Item Group</th>
			<th>HS Code</th>
			<th>Style No.</th>
			<th>Order NO</th>
			<th>Int Ref.</th>
			<th>Description</th>
			<th>Article No</th>
			<th>Item Size</th>
			<th>Qty per Unit</th>
			<th>Bulk Qty</th>
			<th>Sample Qty</th>
			<th title="Bulk Qty+Sample Qty">Total Qty</th>
			<th>Unit</th>
			<th>Rate</th>
			<th>Total Value</th>
			<? if($show_comment==1) {?>
			<th>Remarks</th>
			<? } ?>
		</tr>
		<? 
		$scolor=1; $i=1;
		foreach($size_sensitive_arr as $keystr=>$data_arr){ ?>
			<tr>
			<td rowspan="<? echo $as_per_size_row[$keystr]['row_span']+1 ?>"><? echo $i; ?></td>
			<td rowspan="<? echo $as_per_size_row[$keystr]['row_span']+1 ?>"><? echo $trim_group_library[$data_arr['trim_group']];?> </td>
			<td rowspan="<? echo $as_per_size_row[$keystr]['row_span']+1 ?>"><? echo $data_arr['hs_code'];?> </td>
			<td rowspan="<? echo $as_per_size_row[$keystr]['row_span']+1 ?>"><? echo $data_arr['style_ref_no'];?> </td>
			<? 
			$po_wise_total_qty=0; $po_wise_total_value=0;
			foreach($data_arr['po_wise'] as $poid=>$po_data_arr){
				?>			
				<td rowspan="<? echo $as_per_size_row[$keystr.'**'.$poid]['po_span'] ?>"><? echo $po_data_arr['po_number'];?> </td>
				<td rowspan="<? echo $as_per_size_row[$keystr.'**'.$poid]['po_span'] ?>"><? echo $po_data_arr['grouping'];?> </td>
				<? foreach($po_data_arr['trim_wise'] as $trimid=>$trimdata){
					 ?>
					<td rowspan="<? echo $as_per_size_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><? echo $trimdata['description'];?> </td>
					<?
					$tscolor=1;
					foreach($trimdata['trim_dtls'] as $rowdtls){
							
						$calQty=explode("_",$rowdtls['calculatorstring']);
						if($rowdtls['cal_parameter'] && end($calQty)){
						$per_unit= "1".$unit_of_measurement[$order_uom_arr[$rowdtls['trim_group']]]."=".$calQty[2]." ".$cal_parameter_arr[$rowdtls['cal_parameter']];
						}
						else{
							$per_unit = '';
						}
						$sampleqty=$rowdtls['sampleqty'];
						$total_qty=$sampleqty+$rowdtls['booking_cons'];
						$amount=$total_qty*$rowdtls['rate'];
						$po_wise_total_qty +=$total_qty;
						$po_wise_total_value +=$amount;
					 ?>
						<td><?= $rowdtls['item_ref'] ?></td>
						<td><?= $rowdtls['item_size'] ?></td>
						<? if($tscolor==1){ ?>
						<td rowspan="<? echo $as_per_size_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><?= $per_unit ?></td>
						<? } ?>
						<td align="right"><?= $rowdtls['booking_cons'] ?></td>
						<td align="right"><?= fn_number_format($sampleqty,2) ?></td>
						<td align="right"><?= fn_number_format($total_qty,4)  ?></td>
						<? if($tscolor==1){ ?>
						<td rowspan="<? echo $as_per_size_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><?= $unit_of_measurement[$rowdtls['cons_uom']]  ?></td>
						<? } ?>
						<td align="right"><?= $rowdtls['rate'] ?></td>
						<td align="right"><?= fn_number_format($amount,4) ?></td>
						<? if($tscolor==1){ ?>
						<td rowspan="<? echo $as_per_size_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><?= $rowdtls['remark'] ?></td>
						<? } ?>
						</tr>
					<? 
						$scolor++;
						$tscolor++;
						$grand_total_value+=$amount;
					} 
					?>
				<? }  ?>
			<? } ?>
			<tr>
			<th colspan="6" align="right">Item Total</th>
			<th></th>
			<th></th>
			<th align="right"><?= fn_number_format($po_wise_total_qty,4) ?></th>
			<td></td>
			<td></td>
			<th align="right"><?= fn_number_format($po_wise_total_value,4)  ?></th>
			<td></td>
			</tr>
		<? $i++; } ?>
		</table><?
	}
	if(count($contrast_color_arr) > 0){ ?>		
		<table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" style="margin-bottom: 10px" >
			<tr>
			<? $header ='Contrast Color'?>
			<td colspan="<? echo ($show_comment==1 ? '17':'16') ?>"><strong><? echo $header ?></strong></td>
			</tr>
			<tr>
			<th>Sl</th>
			<th>Item Group</th>
			<th>HS Code</th>
			<th>Style No.</th>
			<th>Order NO</th>
			<th>Int Ref.</th>
			<th>Description</th>
			<th>Article No</th>
			<th>Gmts Color</th>
			<th>Item Color</th>			
			<th>Qty per Unit</th>
			<th>Bulk Qty</th>
			<th>Sample Qty</th>
			<th title="Bulk Qty+Sample Qty">Total Qty</th>
			<th>Unit</th>
			<th>Rate</th>
			<th>Total Value</th>
			<? if($show_comment==1) {?>
			<th>Remarks</th>
			<? } ?>
		</tr>
		<? 
		$scolor=1; $i=1; $po_wise_total_qty=0; 
		foreach($contrast_color_arr as $keystr=>$data_arr){ ?>
			<tr>
			<td rowspan="<? echo $as_per_contrast_row[$keystr]['row_span']+1 ?>"><? echo $i; ?></td>
			<td rowspan="<? echo $as_per_contrast_row[$keystr]['row_span']+1 ?>"><? echo $trim_group_library[$data_arr['trim_group']];?> </td>
			<td rowspan="<? echo $as_per_contrast_row[$keystr]['row_span']+1 ?>"><? echo $data_arr['hs_code'];?> </td>
			<td rowspan="<? echo $as_per_contrast_row[$keystr]['row_span']+1 ?>"><? echo $data_arr['style_ref_no'];?> </td>
			<? 
			$po_wise_total_qty=0; $po_wise_total_value=0; $po_wise_total_value=0;
			foreach($data_arr['po_wise'] as $poid=>$po_data_arr){
				?>			
				<td rowspan="<? echo $as_per_contrast_row[$keystr.'**'.$poid]['po_span'] ?>"><? echo $po_data_arr['po_number'];?> </td>
				<td rowspan="<? echo $as_per_contrast_row[$keystr.'**'.$poid]['po_span'] ?>"><? echo $po_data_arr['grouping'];?> </td>
				<? foreach($po_data_arr['trim_wise'] as $trimid=>$trimdata){
					 ?>
					<td rowspan="<? echo $as_per_contrast_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><? echo $trimdata['description'];?> </td>
					<?
					$tscolor=1;
					foreach($trimdata['trim_dtls'] as $rowdtls){						
						$calQty=explode("_",$rowdtls['calculatorstring']);
						if($rowdtls['cal_parameter'] && end($calQty)){
						$per_unit= "1".$unit_of_measurement[$order_uom_arr[$rowdtls['trim_group']]]."=".$calQty[2]." ".$cal_parameter_arr[$rowdtls['cal_parameter']];
						}
						else{
							$per_unit = '';
						}
						$sampleqty=$rowdtls['sampleqty'];
						$total_qty=$sampleqty+$rowdtls['booking_cons'];
						$amount=$total_qty*$rowdtls['rate'];
						$po_wise_total_qty +=$total_qty;
						$po_wise_total_value +=$amount;
					 ?>
						<td><?= $rowdtls['item_ref'] ?></td>
						<td><?= $color_library[$rowdtls['color_number_id']] ?></td>
						<td><?= $color_library[$rowdtls['item_color']] ?></td>						
						<? if($tscolor==1){ ?>
						<td rowspan="<? echo $as_per_contrast_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><?= $per_unit ?></td>
						<? } ?>
						<td align="right"><?= $rowdtls['booking_cons'] ?></td>
						<td align="right" title="<?= $gmtssamplekey ?>"><?= fn_number_format($sampleqty,2) ?></td>
						<td align="right"><?= fn_number_format($total_qty,4)  ?></td>
						<? if($tscolor==1){ ?>
						<td rowspan="<? echo $as_per_contrast_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><?= $unit_of_measurement[$rowdtls['cons_uom']]  ?></td>
						<? } ?>
						<td align="right"><?= $rowdtls['rate'] ?></td>
						<td align="right"><?= fn_number_format($amount,4) ?></td>
						<? if($tscolor==1){ ?>
						<td rowspan="<? echo $as_per_contrast_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><?= $rowdtls['remark'] ?></td>
						<? } ?>
						</tr>
					<? 
						$scolor++;
						$tscolor++;
						$grand_total_value+=$amount;
					} 
					?>
				<? }  ?>
			<? } ?>
			<tr>
			<th colspan="7" align="right">Item Total</th>
			<th></th>
			<th></th>
			<th align="right"><?= fn_number_format($po_wise_total_qty,4) ?></th>
			<td></td>
			<td></td>
			<th align="right"><?= fn_number_format($po_wise_total_value,4)  ?></th>
			<td></td>
			</tr>
		<? $i++; } ?>
		</table><?
	}
	if(count($color_size_arr) > 0){ ?>		
		<table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" style="margin-bottom: 10px" >
			<tr>
			<? $header ='Color & size sensitive'?>
			<td colspan="<? echo ($show_comment==1 ? '17':'16') ?>"><strong><? echo $header ?></strong></td>
			</tr>
			<tr>
			<th>Sl</th>
			<th>Item Group</th>
			<th>HS Code</th>
			<th>Style No.</th>
			<th>Order NO</th>
			<th>Int Ref.</th>
			<th>Description</th>
			<th>Article No</th>
			<th>Gmts Color</th>
			<th>Item Color</th>			
			<th>Item Size</th>
			<th>Qty per Unit</th>
			<th>Bulk Qty</th>
			<th>Sample Qty</th>
			<th title="Bulk Qty+Sample Qty">Total Qty</th>
			<th>Unit</th>
			<th>Rate</th>
			<th>Total Value</th>
			<? if($show_comment==1) {?>
			<th>Remarks</th>
			<? } ?>
		</tr>
		<? 
		$scolor=1; $i=1; //$po_wise_total_qty=0;  $po_wise_total_value=0;
		foreach($color_size_arr as $keystr=>$data_arr){ ?>
			<tr>
			<td rowspan="<? echo $colorsizekey_row[$keystr]['row_span']+1 ?>"><? echo $i; ?></td>
			<td rowspan="<? echo $colorsizekey_row[$keystr]['row_span']+1 ?>"><? echo $trim_group_library[$data_arr['trim_group']];?> </td>
			<td rowspan="<? echo $colorsizekey_row[$keystr]['row_span']+1 ?>"><? echo $data_arr['hs_code'];?> </td>
			<td rowspan="<? echo $colorsizekey_row[$keystr]['row_span']+1 ?>"><? echo $data_arr['style_ref_no'];?> </td>
			<? 
			$po_wise_total_qty=0; $po_wise_total_value=0; 
			foreach($data_arr['po_wise'] as $poid=>$po_data_arr){
				?>			
				<td rowspan="<? echo $colorsizekey_row[$keystr.'**'.$poid]['po_span'] ?>"><? echo $po_data_arr['po_number'];?> </td>
				<td rowspan="<? echo $colorsizekey_row[$keystr.'**'.$poid]['po_span'] ?>"><? echo $po_data_arr['grouping'];?> </td>
				<? foreach($po_data_arr['trim_wise'] as $trimid=>$trimdata){
					 ?>
					<td rowspan="<? echo $colorsizekey_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><? echo $trimdata['description'];?> </td>
					<?
					$tscolor=1;
					foreach($trimdata['trim_dtls'] as $rowdtls){

						$calQty=explode("_",$rowdtls['calculatorstring']);
						if($rowdtls['cal_parameter'] && end($calQty)){
						$per_unit= "1".$unit_of_measurement[$order_uom_arr[$rowdtls['trim_group']]]."=".$calQty[2]." ".$cal_parameter_arr[$rowdtls['cal_parameter']];
						}
						else{
							$per_unit = '';
						}
						$sampleqty=$rowdtls['sampleqty'];
						$total_qty=$sampleqty+$rowdtls['booking_cons'];
						$amount=$total_qty*$rowdtls['rate'];
						$po_wise_total_qty +=$total_qty;
						$po_wise_total_value +=$amount;
					 ?>
						<td><?= $rowdtls['item_ref'] ?></td>
						<td><?= $color_library[$rowdtls['color_number_id']] ?></td>
						<td><?= $color_library[$rowdtls['item_color']] ?></td>						
						<td><?= $rowdtls['item_size'] ?></td>
						<? if($tscolor==1){ ?>
						<td rowspan="<? echo $colorsizekey_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><?= $per_unit ?></td>
						<? } ?>
						<td align="right"><?= $rowdtls['booking_cons'] ?></td>
						<td align="right"><?= fn_number_format($sampleqty,2) ?></td>
						<td align="right"><?= fn_number_format($total_qty,4)  ?></td>
						<? if($tscolor==1){ ?>
						<td rowspan="<? echo $colorsizekey_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><?= $unit_of_measurement[$rowdtls['cons_uom']]  ?></td>
						<? } ?>
						<td align="right"><?= $rowdtls['rate'] ?></td>
						<td align="right"><?= fn_number_format($amount,4) ?></td>
						<? if($tscolor==1){ ?>
						<td rowspan="<? echo $colorsizekey_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><?= $rowdtls['remark'] ?></td>
						<? } ?>
						</tr>
					<? 
						$scolor++;
						$tscolor++;
						$grand_total_value+=$amount;
					} 
					?>
				<? }  ?>
			<? } ?>
			<tr>
			<th colspan="8" align="right">Item Total</th>
			<th></th>
			<th></th>
			<th align="right"><?= fn_number_format($po_wise_total_qty,4) ?></th>
			<td></td>
			<td></td>
			<th align="right"><?= fn_number_format($po_wise_total_value,4)  ?></th>
			<td></td>
			</tr>
		<? $i++; } ?>
		</table><?
	}
	if(count($no_sensitive_arr) > 0){ ?>		
		<table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" style="margin-bottom: 10px" >
			<tr>
			<? $header ='NO sensitive'?>
			<td colspan="<? echo ($show_comment==1 ? '17':'16') ?>"><strong><? echo $header ?></strong></td>
			</tr>
			<tr>
			<th>Sl</th>
			<th>Item Group</th>
			<th>HS Code</th>
			<th>Style No.</th>
			<th>Order NO</th>
			<th>Int Ref.</th>
			<th>Description</th>
			<th>Article No</th>
			<th>Item Color</th>
			<th>Qty per Unit</th>
			<th>Bulk Qty</th>
			<th>Sample Qty</th>
			<th title="Bulk Qty+Sample Qty">Total Qty</th>
			<th>Unit</th>
			<th>Rate</th>
			<th>Total Value</th>
			<? if($show_comment==1) {?>
			<th>Remarks</th>
			<? } ?>
		</tr>
		<? 
		$scolor=1; $i=1; 
		foreach($no_sensitive_arr as $keystr=>$data_arr){ ?>
			<tr>
			<td rowspan="<? echo $nosensitivedata_row[$keystr]['row_span']+1 ?>"><? echo $i; ?></td>
			<td rowspan="<? echo $nosensitivedata_row[$keystr]['row_span']+1 ?>"><? echo $trim_group_library[$data_arr['trim_group']];?> </td>
			<td rowspan="<? echo $nosensitivedata_row[$keystr]['row_span']+1 ?>"><? echo $data_arr['hs_code'];?> </td>
			<td rowspan="<? echo $nosensitivedata_row[$keystr]['row_span']+1 ?>"><? echo $data_arr['style_ref_no'];?> </td>
			<? 
			$po_wise_total_qty=0; $po_wise_total_value=0; 
			foreach($data_arr['po_wise'] as $poid=>$po_data_arr){
				?>			
				<td rowspan="<? echo $nosensitivedata_row[$keystr.'**'.$poid]['po_span'] ?>"><? echo $po_data_arr['po_number'];?> </td>
				<td rowspan="<? echo $nosensitivedata_row[$keystr.'**'.$poid]['po_span'] ?>"><? echo $po_data_arr['grouping'];?> </td>
				<? foreach($po_data_arr['trim_wise'] as $trimid=>$trimdata){
					 ?>
					<td rowspan="<? echo $nosensitivedata_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><? echo $trimdata['description'];?> </td>
					<?
					$tscolor=1;
					foreach($trimdata['trim_dtls'] as $rowdtls){
						$nosenamplekey=$rowdtls['trim_group'].'**'.$rowdtls['job_id'].'**'.$trimid.'**'.$poid.'**'.$rowdtls['item_color'];
						$sampleqty=0;
						if($nosensitive_color_sample_arr[$nosenamplekey]>0){
							$sampleqty=$nosensitive_color_sample_arr[$nosenamplekey];
						} 
						
						$calQty=explode("_",$rowdtls['calculatorstring']);
						if($rowdtls['cal_parameter'] && end($calQty)){
						$per_unit= "1".$unit_of_measurement[$order_uom_arr[$rowdtls['trim_group']]]."=".$calQty[2]." ".$cal_parameter_arr[$rowdtls['cal_parameter']];
						}
						else{
							$per_unit = '';
						}
						$total_qty=$sampleqty+$rowdtls['booking_cons'];
						$amount=$total_qty*$rowdtls['rate'];
						$po_wise_total_qty +=$total_qty;
						$po_wise_total_value +=$amount;
					 ?>
						<td><?= $rowdtls['item_ref'] ?></td>
						<td><?= $color_library[$rowdtls['item_color']] ?></td>
						<? if($tscolor==1){ ?>
						<td rowspan="<? echo $nosensitivedata_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><?= $per_unit ?></td>
						<? } ?>
						<td align="right"><?= $rowdtls['booking_cons'] ?></td>
						<td align="right"><?= fn_number_format($sampleqty,2) ?></td>
						<td align="right"><?= fn_number_format($total_qty,4)  ?></td>
						<? if($tscolor==1){ ?>
						<td rowspan="<? echo $nosensitivedata_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><?= $unit_of_measurement[$rowdtls['cons_uom']]  ?></td>
						<? } ?>
						<td align="right"><?= $rowdtls['rate'] ?></td>
						<td align="right"><?= fn_number_format($amount,4) ?></td>
						<? if($tscolor==1){ ?>
						<td rowspan="<? echo $nosensitivedata_row[$keystr.'**'.$poid.'**'.$trimid]['trim_span'] ?>"><?= $rowdtls['remark'] ?></td>
						<? } ?>
						</tr>
					<? 
						$scolor++;
						$tscolor++;
						$grand_total_value+=$amount;
					} 
					?>
				<? }  ?>
			<? } ?>
			<tr>
			<th colspan="6" align="right">Item Total</th>
			<th></th>
			<th></th>
			<th align="right"><?= fn_number_format($po_wise_total_qty,4) ?></th>
			<td></td>
			<td></td>
			<th align="right"><?= fn_number_format($po_wise_total_value,4)  ?></th>
			<td></td>
			</tr>
		<? $i++; } ?>
		</table><?
	}
	

 ?>
   <?
   $mcurrency="";
   $dcurrency="";
   if($currency_id==1)
   {
	$mcurrency='Taka';
	$dcurrency='Paisa';
   }
   if($currency_id==2)
   {
	$mcurrency='USD';
	$dcurrency='CENTS';
   }
   if($currency_id==3)
   {
	$mcurrency='EURO';
	$dcurrency='CENTS';
   }
   ?>
    <table width="100%" style="margin-top:1px">
       <tr>
       <td>
       <table width="100%" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                <td width="70%" style="border:1px solid black; text-align:left"><? echo number_format($grand_total_value,2);?></td>
            </tr>
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                <td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($grand_total_value,2,""),$mcurrency, $dcurrency);?></td>
            </tr>
       </table>
       </td>
       </tr>
    </table>
    <br/>
    <table width="100%">
        <tr>
        <td width="49%">
        <?
            echo get_spacial_instruction($txt_booking_no);
        ?>
        </td>
        <td width="2%"></td>
    <?
     $data_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
    ?>
        <td width="49%" valign="top">
            <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">

                <tr style="border:1px solid black;">
                    <td colspan="3" style="border:1px solid black;">Approval Status</td>
                    </tr>
                    <tr style="border:1px solid black;">
                    <td width="3%" style="border:1px solid black;">Sl</td><td width="50%" style="border:1px solid black;">Name</td><td width="27%" style="border:1px solid black;">Approval Date</td><td width="20%" style="border:1px solid black;">Approval No</td>
                    </tr>


                <?
                $i;
                foreach($data_array as $row){
                ?>
                <tr style="border:1px solid black;">
                    <td width="3%" style="border:1px solid black;"><? echo $i;?></td><td width="50%" style="border:1px solid black;"><? echo $row[csf('user_full_name')];?></td><td width="27%" style="border:1px solid black;"><? echo change_date_format($row[csf('approved_date')],"dd-mm-yyyy","-");?></td><td width="20%" style="border:1px solid black;"><? echo $row[csf('approved_no')];?></td>
                    </tr>
                    <?
                    $i++;
                }
                    ?>

            </table>
    </td>
    </tr>
	</table>
   	 </tbody>
     </table>
     <!--class="footer_signature"-->
    <div  style="margin-top:-50px;">
         <?
          echo signature_table(132, $cbo_company_name, "1333px",1);
		 ?>
   </div>

      <div id="page_break_div">
   	 </div>
    <div>
		<?
			//echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>

  </html>
	<?

	$user_id=$_SESSION['logic_erp']['user_id'];
	$report_cat=00;
	$html = ob_get_contents();
		ob_clean();
		//$new_link=create_delete_report_file( $html, 2, $delete, "../../../" );
		foreach (glob("tb*.xls") as $filename) {
		//if( @filemtime($filename) < (time()-$seconds_old) )
		@unlink($filename);
		}
		//---------end------------//
		$name=time();
		$filename="tb".$user_id."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc, $html);
		//echo "$filename****$html****$report_cat";
		
		//exit();
		list($is_mail_send,$mail)=explode('___',$mail_send_data);
		if($is_mail_send==1){
			require_once('../../../mailer/class.phpmailer.php');
			require_once('../../../auto_mail/setting/mail_setting.php');
			$mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
				
			$mailToArr=array();
			$mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
			//echo $mailSql;die;
			$mailSqlRes=sql_select($mailSql);
			foreach($mailSqlRes as $rows){
				if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
			}
			
			
			$mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=98 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
			//echo $mailSql;die;
			$mailSqlRes=sql_select($mailSql);
			foreach($mailSqlRes as $rows){
				if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
			}
			if($mail!=''){$mailToArr[]=$mail;}
			
			$to=implode(',',$mailToArr);
			 $subject=" Trims Booking Multi Job  ";
			$header=mailHeader();
			echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
			
		}
		else{
			echo "$html****$filename****$report_cat";
		}
		exit();

}




if($action=="show_trim_booking_report20") // Aziz-29-3-2022 and update mamun 08-06-2022 //button as like 19
{

	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');

	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");

	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;
		$booking_grand_total=0;
		$currency_id="";


		$buyer_string=array();
		$style_owner=array();
		$job_no=array();
		$style_ref=array();
		$all_dealing_marcent=array();
		$season=array();
		$order_repeat_no=array();
		$po_id_arr=array();

		$nameArray_buyer=sql_select( "select  a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, b.po_break_down_id from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
        foreach ($nameArray_buyer as $result_buy){
			$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
			$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
			$season_matrix=$result_buy[csf('season_matrix')];
			$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
			if($season_matrix!=0 && $season_buyer_wise==0 )
			{
				$season_matrix_con=$season_matrix;
			}
			else if($season_buyer_wise!=0 && $season_matrix==0)
			{
				$season_matrix_con=$season_buyer_wise;
			}
			$seasons_name.=$season_arr[$season_matrix_con].',';
			$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
			$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

			$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];
		}
		$style_sting=implode(",",array_unique($style_ref));
		$job_no_str = "'" . implode( "','", $job_no ) . "'";
		$job_no=implode(",",$job_no);
		$seasons_names=rtrim($seasons_name,',');

		$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));
		$poid_arr=array_unique($po_id_arr);

		$order_rept_no=rtrim($order_rept_no,',');
		$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));

		$po_no=array();
		$file_no=array();
		$ref_no=array();
		$po_quantity=array();
		$pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';
		$nameArray_job=sql_select( "select max(a.update_date) as update_date,b.job_no_mst,b.id,a.pre_cost_fabric_cost_dtls_id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, sum(b.po_quantity) as po_quantity ,b.shipment_date from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping,a.pre_cost_fabric_cost_dtls_id, b.file_no,b.shipment_date ");
        foreach ($nameArray_job as $result_job){
			$po_no_arr[$result_job[csf('id')]]=$result_job[csf('po_number')];
			$PretrimsDtlsIdArr[$result_job[csf('pre_cost_fabric_cost_dtls_id')]]=$result_job[csf('pre_cost_fabric_cost_dtls_id')];
			$job_file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
			$job_ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
			$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
			if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];
			$revised_update_date=explode(" ",$result_job[csf('update_date')]);
			$revised_date=strtotime($revised_update_date[0]);
			$shipdate_arr[$result_job[csf('id')]]=$result_job[csf('shipment_date')];
		}
		$sql_job=sql_select( "select b.job_no_mst,b.id as po_id,c.color_number_id,c.size_number_id, c.order_quantity as po_quantity  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where a.id=b.job_id and a.id=c.job_id and c.po_break_down_id=b.id and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and  c.status_active =1 and c.is_deleted=0 and b.id in(".$po_idss.") ");
		
		foreach ($sql_job as $row)
		{
			$job_po_qty_arr[$row[csf('po_id')]]+=$row[csf('po_quantity')];
			$color_size_qty_arr[$row[csf('po_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]+=$row[csf('po_quantity')];
			$tot_po_quantity+=$row[csf('po_quantity')];
		}

        $nameArray=sql_select( "select a.booking_no, a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_address, a.delivery_date, a.source, a.remarks, a.revised_no,a.update_date from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
		foreach( $nameArray as $row)
		{
			$varcode_booking_no=$row[csf('booking_no')];
			$booking_date=$row[csf('booking_date')];
			$delivery_date=$row[csf('delivery_date')];
			$pay_mode_id=$row[csf('pay_mode')];
			$supplier_id=$row[csf('supplier_id')];
			$currency_id=$row[csf('currency_id')];
			$buyer_id=$row[csf('buyer_id')];
			$exchange_rate=$row[csf('exchange_rate')];
			$attention=$row[csf('attention')];
			$remarks=$row[csf('remarks')];
			$delivery_address=$row[csf('delivery_address')];

			$revised_no=$row[csf('revised_no')];
			$mst_update_date=explode(" ",$row[csf('update_date')]);
			$mst_revised_date=strtotime($mst_update_date[0]);


			$source_id=$row[csf('source')];
		}
		if($revised_date!="" && $mst_revised_date!="")
		{
			$max_revised_date_time=max($revised_date,$mst_revised_date);
			$max_revised_date=date('d-m-Y',$max_revised_date_time);
		}
		else if($revised_date!="" && $mst_revised_date=="")
		{
			//$max_revised_date=$revised_date;
			$max_revised_date=date('d-m-Y',$revised_date);
		}
		else if($mst_revised_date!="" && $revised_date=="")
		{

			$max_revised_date=date('d-m-Y',$mst_revised_date);
		}
		$main_fabric_approved = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and a.job_no in (".$job_no_str.") and b.entry_form=7 and a.status_active =1 and a.is_deleted=0 order by b.id asc");
		
 ob_start();
	?>

 <body>
	<div style="width:1333px" align="center">
		<?php	//ob_start();	?>
		<table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
           <tr>
               <td width="20px">
                    <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
                    <tr>
                    <td width="50" >
					   <? if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                                <img  src='../../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />

                       <?
                           }
                           else
                           {
                       ?>
                                <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                       <?	}
                       }
                       else
                       { ?>
                         <img  src='../<? echo $imge_arr[$cbo_company_name]; ?>' height='30%' width='50%' />
                      <? }
                       ?>
                   </td>
                    <td width="40px" align="center">
                    &nbsp;  &nbsp;  &nbsp;
                    </td>
                    <td width="30px"   align="center">

                   <b style="font-size:25px;"> <?
                    echo $company_library[$cbo_company_name]; ?>
                    </b>
                    <br>
                    <label>
                    	<?
                            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                            foreach ($nameArray as $result){
                          ?>
                              <?  if($result[csf('plot_no')]!='') echo $result[csf('plot_no')]; else echo '';?> &nbsp;
                                <? echo $result[csf('level_no')];?> &nbsp;
                                 <? echo $result[csf('road_no')]; ?>  &nbsp;
                                <? echo $result[csf('block_no')];?>  &nbsp;
                                <? echo $result[csf('city')];?>  &nbsp;
                                <? echo $result[csf('zip_code')]; ?>  &nbsp;
                                 <?php echo $result[csf('province')]; ?>  &nbsp;
                                <? echo $country_arr[$result[csf('country_id')]]; ?> &nbsp;<br/>
                                <? echo $result[csf('email')];?>  &nbsp;
                                <? echo $result[csf('website')];
								if($result[csf('plot_no')]!='')
								{
									$plot_no=$result[csf('plot_no')];
								}
								if($result[csf('level_no')]!='')
								{
									$level_no=$result[csf('level_no')];
								}
								if($result[csf('road_no')]!='')
								{
									$road_no=$result[csf('road_no')];
								}
								if($result[csf('block_no')]!='')
								{
									$block_no=$result[csf('block_no')];
								}
								if($result[csf('city')]!='')
								{
									$city=$result[csf('city')];
								}
								$company_address[$result[csf('id')]]=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
                            }
						?>
                        </label>
                        <br/>
                        <b style="font-size:20px;">
                         <?php echo $report_title; ?>
                        </b>
                    </td>
                     <td width="10px" align="center" style="font-size:20px;">
                      <table width="80%" align="right" cellpadding="0" cellspacing="0" style="border:0px solid black">
                      	<tr>
                            <td width="80">  Booking No:&nbsp; <?php echo $varcode_booking_no; ?>  </td>
                        </tr>
                        <tr>
                            <td>  Booking Date:&nbsp; <?php echo change_date_format($booking_date); ?>  </td>
                        </tr>
                        <?
                        if($revised_no>0)
						{
						?>
                        <tr>
                            <td>  Revised No:&nbsp; <?php echo $revised_no . '&nbsp(Date:' . change_date_format($max_revised_date) . ')'; ?>  </td>
                        </tr>
                        <?
						}
                        if(str_replace("'","",$id_approved_id) ==1)
						 {
						 ?>
                          <tr>
                             <td>Approved Status :&nbsp;  <? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </td>
                         </tr>
                         <?
						}
						 ?>
                      </table>

                     </td>
                   </tr>
                   </table>
               </td>
            </tr>
       </table>
	   <table width="100%" style="border:0px solid black;table-layout: fixed;">
				<tr>
					<td colspan="6" valign="top"></td>
				</tr>
				<tr>
					<td width="100" style="font-size:18px"><span><b>To, </b></span>  </td>
					<td width="110" colspan="5" style="font-size:18px">&nbsp;<span></span></td>
				</tr>
				<tr>

					<td width="210" colspan="2" style="font-size:18px">&nbsp; <b>
					<?
					if($pay_mode_id==5 || $pay_mode_id==3){
						echo $company_library[$supplier_id];
					}
					else{
						echo $supplier_name_arr[$supplier_id];
					}
					?></b>
					</td>
                    <td  width="100" style="font-size:12px"><b>Buyer.</b></td>
					<td  width="110" >:&nbsp;<? echo $buyer_name_arr[$buyer_id]; ?></td>
                    <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
					<td width="110">:&nbsp;<?  echo change_date_format($delivery_date); ?></td>
				</tr>
				<tr>

					<td width="110" colspan="2" rowspan="2" style="font-size:18px">Address :&nbsp;
					<?
					if($pay_mode_id==5 || $pay_mode_id==3){
						$address=$company_address[$supplier_id];
					}
					else{
						$address=$supplier_address_arr[$supplier_id];
					}
					echo $address;
					?></b>
					</td>
					<td width="100" style="font-size:12px"><b>PO Qty.</b>   </td>
					<td width="110">:&nbsp;<? echo $tot_po_quantity; ?></td>
                     <td style="font-size:12px" ><b>Delivery To </b>   </td>
					<td style="">:&nbsp;
					<?
						echo $delivery_address;
					?>
					</td>

				</tr>
                <tr>

                    <td width="100" style="font-size:12px"><b>Season</b> </td>
					<td width="110">:&nbsp;<? echo $seasons_names; ?></td>

                    <td width="100" style="font-size:12px"><b>Currency</b></td>
					<td width="110">:&nbsp;<?  echo $currency[$currency_id]; ?></td>

                </tr>
                <tr>
                    <td style="font-size:12px" ><b>Attention </b>   </td>
					<td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
					<?
						echo $attention;
					?>
					</td>
                    <td width="100" style="font-size:12px"><b>Order Repeat </b> </td>
					<td width="110">:&nbsp;<? echo $order_rept_no; ?></td>
                    <td  style="font-size:12px"><b>Pay mode</b></td>
                	<td>:&nbsp;<? echo $pay_mode[$pay_mode_id];?></td>

                </tr>

				 <tr>
                    <td style="font-size:12px"><b>Source</b></td>
                	<td>:&nbsp;<? echo $source[$source_id];?></td>
                    <td style="font-size:12px"><b>Dealing Merchant</b></td>
					<td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
					<?
						echo implode(",",array_unique($all_dealing_marcent));
					?>
					</td>
				</tr>
				<tr>
					<td width="100" style="font-size:12px"><b>Remarks</b>  </td>
					<td width="110" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" >:&nbsp;<? echo $remarks; ?></td>
					<td width="130" style="font-size:12px" align="left"><b>Main Fabric Booking 1<sup>st</sup> Approved Date</b></td>
                	<td align="left">:&nbsp;<?  echo change_date_format($main_fabric_approved[0][csf('approved_date')]); ?></td>

				</tr>
			</table>


			   <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?

		$precost_arr=array();
		$trims_qtyPerUnit_arr=array();

		$precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0");
        $calUom="";
		foreach($precost_sql as $precost_row){
			if($precost_row[csf('cal_parameter')]==1){
			   $calUom="Mtr";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==2){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==3){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==4){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==5){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==6){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==7){
			   $calUom="Pcs";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==8){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else{
				$calUom=0;
			}
			 $trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
		}
		$booking_country_arr=array();
		$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,po_break_down_id as po_id,sensitivity,country_id_string,delivery_date from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0");
		foreach($nameArray_booking_country as $nameArray_booking_country_row){

			$po_delivery_date_arr[$nameArray_booking_country_row[csf('po_id')]]=$nameArray_booking_country_row[csf('delivery_date')];

			$country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
			$tocu=count($country_id_string);
			for($cu=0;$cu<$tocu;$cu++){
				$booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
			}
		}

		$nameArray_job_po=sql_select( "select job_no,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and status_active =1 and is_deleted=0 group by job_no,po_break_down_id order by job_no ");
		foreach($nameArray_job_po as $nameArray_job_po_row){
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]."   and sensitivity=1 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id  order by trim_group ");
	    if(count($nameArray_item)>0){

			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];
			$shipdate=$shipdate_arr[$nameArray_job_po_row[csf('po_id')]];
        ?>
        &nbsp;
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >

            <tr>
                <td colspan="11" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" align="left"><strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; if($ref_nos!='' ) echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;else " "; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;  Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]].' &nbsp;&nbsp;&nbsp; '; echo "&nbsp;&nbsp;Shipment Date:&nbsp;".change_date_format($shipdate); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>



                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? }?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item){
			$i++;
            $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description,b.article_number, b.brand_supplier,b.item_color,a.gmts_color_id,b.gmts_sizes,b.item_size,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_id')]."  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id,b.item_color,a.gmts_color_id,b.gmts_sizes,b.item_size, b.description,b.article_number, b.brand_supplier,b.item_color order by bid ");
			
			$item_desctiption_total=0;
			$total_amount_as_per_gmts_color=0;
			$item_rowspan=0;
		

			foreach($nameArray_item_description as $result_itemdescription){

			?>
            <tr>
                <td style="border:1px solid black" >
                	<? echo $i; ?>
                </td>
                <td align="center"  style="border:1px solid black" >
					<?
					echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
					echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
					?>
                </td>
             
                <td style="border:1px solid black"><?  if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>

                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>


                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?
				$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];


				echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$po_id=$nameArray_job_po_row[csf('po_id')];
				$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['wo_qty']+=$result_itemdescription[csf('cons')];
				$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                  <? if($show_comment==1) {?>
                 <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

					echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                  <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="9"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->


        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id as po_id  from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]." and sensitivity=2 and  status_active =1 and  is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id  order by trim_group ");
		if(count($nameArray_item)>0)
		{

			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];

			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];
			$shipdate=$shipdate_arr[$nameArray_job_po_row[csf('po_id')]];

        ?>
		  <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                 <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Size Sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; echo "&nbsp;&nbsp;Int Ref.:".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp; Po Qty..:".$po_no_qty; ?></strong></td>
                <td width="40%" style="margin-left:210px; font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]].'&nbsp; &nbsp; ';echo "&nbsp;Shipment Date:&nbsp;".change_date_format($shipdate);  ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Article No</strong></td>
                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
			$i++;//
			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,b.article_number,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$result_item[csf('po_id')]." and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size,b.article_number order by b.article_number,bid");
			
			$item_desctiption_total=0;
			$total_amount_as_per_gmts_color=0;
			foreach($nameArray_item_description as $result_itemdescription)
			{

			?>
            <tr>
                <td style="border:1px solid black" >
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" >
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][2]);
				?>
                </td>
              
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black">
				<?
				if($result_itemdescription[csf('article_number')]!="no article"){
					echo $result_itemdescription[csf('article_number')];
				}else{
					echo "-";
				}
				?>
                </td>
                <td style="border:1px solid black; text-align:left">
              <? echo $result_itemdescription[csf('item_size')];?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>


                <td style="border:1px solid black; text-align:right">
				<?

				echo number_format($result_itemdescription[csf('cons')],4);

                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				
				$po_id=$result_item[csf('po_id')];
				$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['wo_qty']+=$result_itemdescription[csf('cons')];
				$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">

                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold"><?

					echo number_format($item_desctiption_total,4);
				 ?></td>
                 <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

		 <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]."  and sensitivity=3 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id order by trim_group ");
		if(count($nameArray_item)>0)
		{

			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			//$job_no=$nameArray_job_po_row[csf('job_no')];
			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];
			$shipdate=$shipdate_arr[$nameArray_job_po_row[csf('po_id')]];

        ?>
        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="11" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" style="font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]]; echo "&nbsp;&nbsp;&nbsp;Shipment Date:&nbsp;".change_date_format($shipdate); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$result_item[csf('po_id')]."  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by trim_group ", "item_color", "color_number_id"  );

			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.article_number,b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$result_item[csf('po_id')]." and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.article_number,b.brand_supplier,b.item_color,b.color_number_id order by bid ");
			
			$item_desctiption_total=0;
			$total_amount_as_per_gmts_color=0;
			foreach($nameArray_item_description as $result_itemdescription)
			{

			?>
            <tr>
                <td style="border:1px solid black" >
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" >
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
				?>
                </td>
               
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>

                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   echo $color_library[$result_itemdescription[csf('color_number_id')]];
			   ?>
                </td>
               <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>

                <td style="border:1px solid black; text-align:right">
				<?

				echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				
				$po_id=$result_item[csf('po_id')];
				$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['wo_qty']+=$result_itemdescription[csf('cons')];
				$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				
				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?></p> </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

				echo number_format($item_desctiption_total,4);
				 ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]." and sensitivity=4 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id order by po_break_down_id,trim_group");
	   if(count($nameArray_item)>0)
		{


			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];
			$shipdate=$shipdate_arr[$nameArray_job_po_row[csf('po_id')]];

        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%" ><strong>Color & size sensitive (<? echo "Job NO: ".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]] ;echo "&nbsp;&nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" style="font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]];echo "&nbsp;&nbsp;&nbsp;Shipment Date:&nbsp;".change_date_format($shipdate); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group </strong> </td>


                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td style="border:1px solid black"><strong>Grmnts Order Qty</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td style="border:1px solid black; width:170px;"><strong>Gmts Color</strong> </td>
                <td style="border:1px solid black;"><strong>Gmts Size</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
               
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.po_break_down_id=".$result_item[csf('po_id')]." and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by trim_group ", "item_color", "color_number_id"  );

			 $nameArray_color=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.color_number_id as gmt_color, b.item_color as color_number_id,b.item_size,b.gmts_sizes,b.description,b.article_number, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount, min(c.color_order) as color_order, min(c.size_order) as size_order,c.article_number from wo_booking_dtls a, wo_trim_book_con_dtls b,wo_po_color_size_breakdown c  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and b.po_break_down_id=c.po_break_down_id and b.color_number_id=c.color_number_id and b.gmts_sizes=c.size_number_id and  c.id=b.color_size_table_id and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'   and a.po_break_down_id=".$result_item[csf('po_id')]." and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=4 and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.color_number_id, b.item_color,b.item_size,b.gmts_sizes,b.description,b.article_number, b.brand_supplier,c.article_number order by c.article_number,color_order,size_order");



            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]."  and po_break_down_id=".$result_item[csf('po_id')]."  and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  status_active =1 and is_deleted=0 order by trim_group ");

			
			$item_desctiption_total=0;
			$total_amount_as_per_gmts_color=0;
			foreach($nameArray_color as $result_color)
			{
				?>
            <tr>
                <td style="border:1px solid black" >
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][4]);
				?>
                </td>
               

					<td style="border:1px solid black" ><? if($result_color[csf('description')]){echo $result_color[csf('description')];} ?> </td>
					<td style="border:1px solid black" ><? if($result_color[csf('brand_supplier')]){echo $result_color[csf('brand_supplier')]; }?> </td>
                    <td style="border:1px solid black">
					<?
					$color_size_qty=$color_size_qty_arr[$result_item[csf('po_id')]][$result_color[csf('gmt_color')]][$result_color[csf('gmts_sizes')]];
					echo $color_size_qty;
					?>
                    </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('gmt_color')]];?> </td>
                    <td style="border:1px solid black; text-align:left">
					<? echo $size_library[$result_color[csf('gmts_sizes')]]; ?>
					</td>
					<td style="border:1px solid black; text-align:left">
					<? echo $result_color[csf('item_size')]; ?>
					</td>
                    <td style="border:1px solid black; text-align:left">
				   <?
				   $calUom=$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][2];
			       $calQty=explode("_",$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				   if($calUom && end($calQty)){
					   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
				   }
                   ?>
                    </td>

					<td style="border:1px solid black; text-align:right">
					<?

					echo number_format($result_color[csf('cons')],4);

					$item_desctiption_total += $result_color[csf('cons')] ;
					$po_id=$result_item[csf('po_id')];
					$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['wo_qty']+=$result_color[csf('cons')];
					$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['amount']+=$result_color[csf('cons')]*$result_color[csf('rate')];
				
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]];  ?></td>
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('rate')],4);
					?>
                     </td>
					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,2);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					$trims_remark=$trims_remark_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
					?>
					</td>
                    
				</tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="10"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

				echo number_format($item_desctiption_total,4);  ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                
            </tr>
            <?
            }

            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="13"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 
            </tr>
        </table>
        <br/>
       <?
		}
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->



         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id as po_id from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_id')]." and sensitivity=0 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group,po_break_down_id order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$ref_nos=$job_ref_no[$nameArray_job_po_row[csf('po_id')]];
			$file_nos=$job_file_no[$nameArray_job_po_row[csf('po_id')]];
			$po_no_qty=0;
			$po_no_qty=$job_po_qty_arr[$nameArray_job_po_row[csf('po_id')]];
			$po_delivery_date=$po_delivery_date_arr[$nameArray_job_po_row[csf('po_id')]];
			$shipdate=$shipdate_arr[$nameArray_job_po_row[csf('po_id')]];
        ?>
        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                <table width="100%" style="table-layout: fixed;">
                <tr>
                <td width="60%"><strong>NO sensitive  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";  echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo $po_no_arr[$nameArray_job_po_row[csf('po_id')]];echo "&nbsp;&nbsp;&nbsp;Shipment Date:&nbsp;".change_date_format($shipdate); ?></td>
                </tr>
                </table>
                 </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
				<td style="border:1px solid black"><strong>Article No.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td align="center" style="border:1px solid black"><strong> Qnty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>
                 <? if($show_comment==1) {?>
                 <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                 <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description,b.article_number, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.po_break_down_id=".$result_item[csf('po_id')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description,b.article_number, b.brand_supplier,b.item_color");
			
                $color_tatal=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
                $item_desctiption_total=0;
                ?>
            <tr>
                <td style="border:1px solid black" >
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" >

                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);

				?>
                </td>
              
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
				 <td style="border:1px solid black"><?
				  if($result_itemdescription[csf('article_number')]!="no article"){
						echo $result_itemdescription[csf('article_number')];
					}else{
						echo "-";
					}
				  ?>
				   </td>

                <td style="border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <?
				if($db_type==0)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.po_break_down_id=". $result_item[csf('po_id')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
						}
						if($db_type==2)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]."  and a.po_break_down_id=". $result_item[csf('po_id')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
						}

                foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right">
                <?
				//print_r($uom_arr);
				$uom_id=$order_uom_arr[$result_item[csf('trim_group')]];
				//echo $order_uom_id.'DD';
                if($result_color_size_qnty[csf('cons')]!= "")
                {

               echo number_format($result_color_size_qnty[csf('cons')],4);
                $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                $color_tatal+=$result_color_size_qnty[csf('cons')];
				
				$po_id=$result_item[csf('po_id')];
					$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['wo_qty']+=$result_color_size_qnty[csf('cons')];
					$trim_cons_arr[$result_item[csf('trim_group')]][$po_id]['amount']+=$result_color_size_qnty[csf('cons')]*$result_color_size_qnty[csf('rate')];
					
                }
                else echo "";
                ?>
                </td>
                <?
                }
                ?>

                <td style="border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                 <td style="border:1px solid black; text-align:right"><? echo $trims_remark; ?> </td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;">
                <?
                if($color_tatal !='')
                {

						 echo number_format($color_tatal,4);
                }
                ?>
                </td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
                <td  style="border:1px solid black;  text-align:right"><strong><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></strong></td>
                 <? if($show_comment==1) {?>
                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <?
		}
		}
		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->

       <?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>
       <br/>
       <table width="100%" style="margin-top:1px">
       <tr>
       <td>
       <table width="100%" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                <td width="70%" style="border:1px solid black; text-align:left"><strong><? echo number_format($booking_grand_total,2);?></strong></td>
            </tr>
            <tr style="border:1px solid black;">
                <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                <td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
            </tr>
       </table>
       </td>
       </tr>
       </table>
         <br/>
        <table width="100%">
        <tr>
        <td width="49%">
			
		
		
	<table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
	<thead>
		<tr style="border:1px solid black;">
			<th width="3%" style="border:1px solid black;font-size:35px;">Sl</th><th width="97%" style="border:1px solid black;font-size:35px;">Special Instruction</th>
		</tr>
	</thead>
	<tbody>
 <?
	
	$data_array = sql_select("select id, terms,terms_prefix from  wo_booking_terms_condition where booking_no='$txt_booking_no' and entry_form=87   order by id");

	
		$i = 0;
		foreach ($data_array as $row) {
			$i++;
			?>
			<tr id="settr_1" align="" style="border:1px solid black;">
				<td style="border:1px solid black; font-size:40px;"><?=$i;?></td>
				<td style="border:1px solid black;font-size:40px;"><?=$row[csf('terms')];?></td>
			</tr>
		<?}
	

	?>
	</tbody>
	</table>
        
	<?
        	// echo get_spacial_instruction($txt_booking_no);
        ?>
    	</td>
    <td width="2%"></td>
    <?
	 $data_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");

	?>
    <td width="49%" valign="top">
        <table  width="50%" class="rpt_table"  style="float:left" border="1" cellpadding="0" cellspacing="0" rules="all">

            <tr style="border:1px solid black;">
                <td colspan="3" style="border:1px solid black;font-size:30px">Approval Status</td>
                </tr>
                <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;font-size:30px">Sl</td><td width="50%" style="border:1px solid black;font-size:30px">Name</td><td width="27%" style="border:1px solid black;font-size:30px">Approval Date</td><td width="20%" style="border:1px solid black;font-size:30px">Approval No</td>
            </tr>


            <?
			$i;
			foreach($data_array as $row){
			?>
             <tr style="border:1px solid black;font-size:30px">
                <td width="3%" style="border:1px solid black;font-size:30px"><? echo $i;?></td><td width="50%" style="border:1px solid black;font-size:30px"><? echo $row[csf('user_full_name')];?></td><td width="27%" style="border:1px solid black;font-size:30px"><? echo change_date_format($row[csf('approved_date')],"dd-mm-yyyy","-");?></td><td width="20%" style="border:1px solid black;font-size:30px"><? echo $row[csf('approved_no')];?></td>
             </tr>
                <?
				$i++;
			}
				?>

        </table>
        <br>
        <table  width="700px" class="rpt_table" style="float:left"  border="1" cellpadding="0" cellspacing="0" rules="all">

            <tr style="border:1px solid black;">
                <td colspan="3" style="border:1px solid black; text-align:center;font-size:30px">Item Image</td>
                </tr>
                <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;font-size:30px"> <?
				 
				$trimsDtlsId=implode(",",$PretrimsDtlsIdArr);
				 
				$item_imge_arr=sql_select("select a.master_tble_id,a.image_location from   common_photo_library a,wo_pre_cost_trim_cost_dtls b where  to_char(b.id)=a.master_tble_id and  a.form_name='pre_cost_trimsv2' and a.file_type=1 and b.id in($trimsDtlsId)");
			
			
				?>
				 <p>
			<?	foreach($item_imge_arr as $row)
			   {
				 if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                               <img  src='../../../<? echo $row[csf('image_location')]; ?>' height='75px' width='170px' />  &nbsp;

                       <?
                           }
                           else
                           {
                       ?>
                               <img  src='../../../<? echo $row[csf('image_location')]; ?>' height='500px' width='700px' />&nbsp;
                       <?	}
                       }
                       else
                       { ?>
                           <img  src='../<? echo $row[csf('image_location')]; ?>' height='75px' width='170px' />&nbsp;
                      <? }

				  }
                       ?>
					   </p></td>
                
                </tr>


            <?
			$i;
			foreach($data_array as $row){
			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td><td width="50%" style="border:1px solid black;"><? echo $row[csf('user_full_name')];?></td><td width="27%" style="border:1px solid black;"><? echo change_date_format($row[csf('approved_date')],"dd-mm-yyyy","-");?></td><td width="20%" style="border:1px solid black;"><? echo $row[csf('approved_no')];?></td>
                </tr>
                <?
				$i++;
			}
				?>

        </table>
    </td>
    </tr>
    
    	<tr>
        <td>
        	<table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">

            <tr style="border:1px solid black;">
                <tr style="border:1px solid black;">
                <td width="20%" style="border:1px solid black;font-weight:bold;font-size:30px"><strong>Item Name</strong></td>
                <td width="30%" style="border:1px solid black;font-weight:bold;font-size:30px"><strong>PO Number</strong></td>
                <td width="15%" style="border:1px solid black;font-weight:bold;font-size:30px"><strong>PO Qty</strong></td>
                <td width="20%" style="border:1px solid black;font-weight:bold;font-size:30px"><strong>WO Qty</strong></td>
                <td width="10%" style="border:1px solid black;font-weight:bold;font-size:30px"><strong>Rate</strong></td>
                <td width="20%" style="border:1px solid black;font-weight:bold;font-size:30px"><strong>Amount</strong></td>
                    
                </tr>


            <?
			$i;$tot_po_qty=$tot_wo_qty=$tot_wo_amount=0;
			foreach($trim_cons_arr as $item_id=>$item_data){
				foreach($item_data as $poId=>$row){
					
					$po_no_qty=$job_po_qty_arr[$poId];
			?>
            <tr style="border:1px solid black;">
                <td  style="border:1px solid black;font-size:30px;"><? echo $trim_group_library[$item_id];?></td>
                <td  style="border:1px solid black;font-size:30px;"><? echo $po_no_arr[$poId];?></td>
                <td align="right" style="border:1px solid black;font-size:30px;"><? echo number_format($po_no_qty,0);?></td>
                <td  align="right" style="border:1px solid black;font-size:30px;"><? echo number_format($row[('wo_qty')],2);?></td>
               
                <td  align="right" style="border:1px solid black;font-size:30px;"><? echo number_format($row[('amount')]/$row[('wo_qty')],4);?></td>
                <td  align="right" style="border:1px solid black;font-size:30px;"><? echo number_format($row[('amount')],2);?></td>
                </tr>
                <?
				$i++;
				$tot_po_qty+=$po_no_qty;
				$tot_wo_qty+=$row[('wo_qty')];
				$tot_wo_amount+=$row[('amount')];
				}
			}
				?>
             <tr style="border:1px solid black;">

                <td  colspan="2" style="border:1px solid black;font-size:30px; text-align:right">Total</td>
                <td align="right" style="border:1px solid black;font-size:30px;"><strong><? echo number_format($tot_po_qty,2);?></strong></td>
                <td align="right" style="border:1px solid black;font-size:30px;"><strong><? echo number_format($tot_wo_qty,2);?></strong></td>
                <td style="border:1px solid black;font-size:30px; text-align:left"><strong><? //echo number_format($tot_po_qty,2);?></strong></td>                
                <td align="right" style="border:1px solid black;font-size:30px;"><strong><? echo number_format($tot_wo_amount,2);?></strong></td>
                
             </tr>

        </table>
        
        </td>
        </tr>
    </table>



    </div>

 </body>
	 
		

     <br>
    <div>

		<?


			$reportBody=ob_get_contents();
			$report_signature=signature_table1(132, $cbo_company_name,"1350");
			ob_end_clean();

			$user_id=$_SESSION['logic_erp']['user_id'];
	
	
			foreach (glob("../../../auto_mail/tmp/multiple_trims_booking_v2_".$user_id.".pdf") as $filename) {			
				@unlink($filename);
			}
			
			$att_file_arr=array();
			require('../../../ext_resource/mpdf60/mpdf.php');
			$mpdf = new mPDF('', 'A4', '', '', 10, 10, 10, 35, 3, 3);	
			$mpdf->SetHTMLFooter($report_signature);
			$mpdf->WriteHTML($reportBody,2);
			$user_id=$_SESSION['logic_erp']['user_id'];
			$REAL_FILE_NAME = 'multiple_trims_booking_v2_'.$user_id.'.pdf';
			$file_path='../../../auto_mail/tmp/'.$REAL_FILE_NAME;
			$mpdf->Output($file_path, 'F');
			$att_file_arr[]='../../../auto_mail/tmp/'.$REAL_FILE_NAME.'**'.$REAL_FILE_NAME;
        	
			// echo signature_table(132, $cbo_company_name, "1330px");
			
		
		 echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>

		<?
		

		if($link == 1){
			?>
			<script type="text/javascript" src="../../../js/jquery.js"></script>
			<script type="text/javascript" src="../../../js/jquerybarcode.js"></script>
		<?
		}else {
			?>
			<script type="text/javascript" src="../../js/jquery.js"></script>
			<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
			<?
		}
			?>
		<script>
		fnc_generate_Barcode('<? echo $varcode_booking_no; ?>','barcode_img_id');

		</script>
	
		<?
	
 		
		$report_category=101;	
		
		foreach (glob("tb*.xls") as $filename) {@unlink($filename);	}
		//---------end------------//
		$name=time();
		$filename="tb".$user_id."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc, $reportBody);
		
		
		list($is_mail_send,$mail)=explode('___',$mail_send_data);
		if($is_mail_send==1){
			require_once('../../../mailer/class.phpmailer.php');
			require_once('../../../auto_mail/setting/mail_setting.php');
			$mailBody = preg_replace("/<img[^>]+\>/i", " ", $reportBody); 
				
			$mailToArr=array();
			$mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
			//echo $mailSql;die;
			$mailSqlRes=sql_select($mailSql);
			foreach($mailSqlRes as $rows){
				if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
			}
			
			
			$mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=98 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
			//echo $mailSql;die;
			$mailSqlRes=sql_select($mailSql);
			foreach($mailSqlRes as $rows){
				if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
			}
			if($mail!=''){$mailToArr[]=$mail;}
			
			$to=implode(',',$mailToArr);
			$subject=" Trims Booking Multi Job";
			$header=mailHeader();
			echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
			
		}
		else{
			echo "$reportBody####$filename####$report_category";
		}
		exit();
}

if($action=="show_trim_booking_report21") //mamun 19-06-2022 //13043
{
	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');

	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");

	$exchange_arr=return_library_array("select job_no,exchange_rate from wo_pre_cost_mst","job_no","exchange_rate");


	
	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;
	//$revised_no_data=sql_select("select a.revised_no  from wo_booking_mst a where  a.booking_no=$txt_booking_no and  a.status_active =1 and a.is_deleted=0");
	//list($revised_no_row)=$revised_no_data;

	$supplier_data=sql_select("SELECT id,supplier_name,address_1, contact_no, email from lib_supplier where status_active=1 and is_deleted=0");
	foreach ($supplier_data as $row) {
		$supplier_name_arr[$row[csf('id')]]=$row[csf('supplier_name')];
		$supplier_address_arr[$row[csf('id')]]=$row[csf('address_1')];
		$supplier_info_arr[$row[csf('id')]]['tel']=$row[csf('contact_no')];
		$supplier_info_arr[$row[csf('id')]]['email']=$row[csf('email')];
	}




		$booking_grand_total=0;
		$currency_id="";


		$buyer_string=array();
		$style_owner=array();
		$job_no=array();
		$style_ref=array();
		$all_dealing_marcent=array();
		$season=array();
		$order_repeat_no=array();
		$po_id_arr=array();

		$nameArray_buyer=sql_select( "select  a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, b.po_break_down_id from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
        foreach ($nameArray_buyer as $result_buy){
			$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
			$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
			//$season[$result_buy[csf('job_no')]]=$season_arr[$result_buy[csf('season_matrix')]];
			$season_matrix=$result_buy[csf('season_matrix')];
			$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
			if($season_matrix!=0 && $season_buyer_wise==0 )
			{
				$season_matrix_con=$season_matrix;
			}
			else if($season_buyer_wise!=0 && $season_matrix==0)
			{
				$season_matrix_con=$season_buyer_wise;
			}
			$seasons_name.=$season_arr[$season_matrix_con].',';
			$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
			$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

			$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];
		}
		$style_sting=implode(",",array_unique($style_ref));
		$job_no_str = "'" . implode( "','", $job_no ) . "'";
		$job_no=implode(",",$job_no);
		$seasons_names=rtrim($seasons_name,',');

		$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));
		$poid_arr=array_unique($po_id_arr);


		$order_rept_no=rtrim($order_rept_no,',');
		$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));
		$main_fabric_approved = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and a.job_no in (".$job_no_str.") and b.entry_form=7 and a.status_active =1 and a.is_deleted=0 order by b.id asc");


		$po_no=array();
		$file_no=array();
		$ref_no=array();
		$po_quantity=array();
		$pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';
		$nameArray_job=sql_select( "select  max(a.update_date) as update_date,b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, sum(b.po_quantity) as po_quantity  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no ");
        foreach ($nameArray_job as $result_job){
			$po_no[$result_job[csf('job_no_mst')]][$result_job[csf('id')]]=$result_job[csf('po_number')];
			$file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
			$ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
			$po_quantity[$result_job[csf('id')]]=$result_job[csf('po_quantity')];
			$poQuantity+=$result_job[csf('po_quantity')];
			$job_ref_no[$result_job[csf('job_no_mst')]].=$result_job[csf('grouping')].',';
			$job_file_no[$result_job[csf('job_no_mst')]].=$result_job[csf('file_no')].',';
			$po_no_arr[$result_job[csf('job_no_mst')]]['po_id'].=$result_job[csf('id')].',';
			$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
			$int_ref_no.=$result_job[csf('grouping')].',';
			if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];
			$revised_update_date=explode(" ",$result_job[csf('update_date')]);
			$revised_date=strtotime($revised_update_date[0]);

		}
			//echo $po_idss.'DDDDDDDDD';
		$sql_job=sql_select( "select a.order_uom, a.total_set_qnty, b.job_no_mst,b.id as po_id, b.po_quantity as po_quantity  from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.") ");
		foreach ($sql_job as $row)
		{
			$job_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('po_id')]]+=$row[csf('po_quantity')];
			$job_uom_arr[$row[csf('job_no_mst')]]=$row[csf('order_uom')];
			$tot_po_quantity+=$row[csf('po_quantity')]*$row[csf('total_set_qnty')];
		}

        $nameArray=sql_select( "select a.booking_no, a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.source, a.remarks, a.revised_no,a.update_date,a.delivery_address,a.tenor from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
		foreach( $nameArray as $row)
		{
			$varcode_booking_no=$row[csf('booking_no')];
			$booking_date=$row[csf('booking_date')];
			$delivery_date=$row[csf('delivery_date')];
			$pay_mode_id=$row[csf('pay_mode')];
			$supplier_id=$row[csf('supplier_id')];
			$currency_id=$row[csf('currency_id')];
			$buyer_id=$row[csf('buyer_id')];
			$exchange_rate=$row[csf('exchange_rate')];
			$attention=$row[csf('attention')];
			$remarks=$row[csf('remarks')];
			$tenor=$row[csf('tenor')];
			$delivery_address=$row[csf('delivery_address')];
			$revised_no=$row[csf('revised_no')];
			$mst_update_date=explode(" ",$row[csf('update_date')]);
			$mst_revised_date=strtotime($mst_update_date[0]);
			$source_id=$row[csf('source')];
		}
		if($revised_date!="" && $mst_revised_date!="")
		{
			$max_revised_date_time=max($revised_date,$mst_revised_date);
			$max_revised_date=date('d-m-Y',$max_revised_date_time);
		}
		else if($revised_date!="" && $mst_revised_date=="")
		{
			$max_revised_date=date('d-m-Y',$revised_date);
		}
		else if($mst_revised_date!="" && $revised_date=="")
		{
			$max_revised_date=date('d-m-Y',$mst_revised_date);
		}
		$approved_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name, b.id from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0 order by b.id asc");





		
            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website,contact_no from lib_company where id=$cbo_company_name");
            foreach ($nameArray as $result){              
                if($result[csf('plot_no')]!='')
                {
                    $plot_no=$result[csf('plot_no')];
                }
                if($result[csf('level_no')]!='')
                {
                    $level_no=$result[csf('level_no')];
                }
                if($result[csf('road_no')]!='')
                {
                    $road_no=$result[csf('road_no')];
                }
                if($result[csf('block_no')]!='')
                {
                    $block_no=$result[csf('block_no')];
                }
                if($result[csf('city')]!='')
                {
                    $city=$result[csf('city')];
                }
                $company_address[$result[csf('id')]]['address']=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
                $company_address[$result[csf('id')]]['tel']=$result[csf('contact_no')];
                $company_address[$result[csf('id')]]['email']=$result[csf('email')];
            }
       ob_start(); 
	?>

      <table border="1" align="left" class="rpt_table container"  cellpadding="0" width="1200" cellspacing="0" rules="all" style="padding-bottom: 10px">
       		<tr>
       		
       			<td colspan="8" width="1000">
				<div><img src='<?=$path?>/<? echo $imge_arr[$cbo_company_name]; ?>' height='60' width='100' align="left"/></div>
                <div style="font-size: 20px; font-weight: bold; width:50%; text-align: center;margin-left:25%"><?=$company_library[$cbo_company_name]; ?></div>
                <div style="font-size: 16px; width:50%; text-align: center;margin-left:25%"><?=$company_address[$cbo_company_name]['address'] ?><br>TEL# <? echo $company_address[$cbo_company_name]['tel'] ?><br>E-Mail: <? echo $company_address[$cbo_company_name]['email'] ?></div></td>
       		</tr>
       		<tr>
       			<td colspan="8" align="center" style="font-size: 18px; font-weight: bold;">Trims Purchase Order- <?=$txt_booking_no ?></td>
       		</tr>
       		<tr>
       			<td colspan="3">Beneficiary:</td>
				<td colspan="2" rowspan="2"></td>			
       			<td colspan="3">Consignee:</td>
       		</tr>
       		<tr>
       			<td colspan="3" style="word-break:break-all"><span style="font-weight: bold;"><?
                    if($pay_mode_id==5 || $pay_mode_id==3){
                        echo $company_library[$supplier_id];
                    }
                    else{
                        echo $supplier_name_arr[$supplier_id];
                    }
                    ?></span><br><?
	                if($pay_mode_id==5 || $pay_mode_id==3){
	                    echo $company_address[$supplier_id]['address'];
	                }
	                else{
	                    echo $supplier_address_arr[$supplier_id];
	                }
                ?><br>TEL# <?
	                if($pay_mode_id==5 || $pay_mode_id==3){
	                    echo $company_address[$supplier_id]['tel'];
	                }
	                else{
	                    echo $supplier_info_arr[$supplier_id]['tel'];
	                }
                ?><br>E-mail: <?
	                if($pay_mode_id==5 || $pay_mode_id==3){
	                    echo $company_address[$supplier_id]['email'];
	                }
	                else{
	                    echo $supplier_info_arr[$supplier_id]['email'];
	                }
                ?></td>
				
       			<td colspan="3" style="word-break:break-all"><span style="font-weight: bold;"><?=$company_library[$cbo_company_name]; ?></span><br><?=$company_address[$cbo_company_name]['address'] ?><br>TEL# <?=$company_address[$cbo_company_name]['tel'] ?><br>E-Mail: <?=$company_address[$cbo_company_name]['email'] ?></td>
       		</tr>
       		<tr>
       			<th width="120" align="left">Issue Date</th>
       			<td width="150"><?=change_date_format($booking_date); ?></td>
				<th width="120" align="left">Buyer</th>
       			<td width="120"><?=$buyer_name_arr[$buyer_id]; ?></td>
				   <th width="120" align="left">Po Qnty</th>
       			<td><?=$poQuantity; ?></td>
       			<th width="120" align="left">Delivery Date</th>
       			<td width="150"><?=change_date_format($delivery_date); ?></td>
       		
       		</tr>
			   <tr>
			    <th width="120" align="left">Dealing Merchant</th>
                <td width="150"><?	echo implode(",",array_unique($all_dealing_marcent));?></td>
            	<th align="left">Tenor</th>
                <td width="120"><?=$tenor; ?></td>
				<th align="left">Source</th>
                <td width="120"><?=$source[$source_id]; ?></td>
				<th align="left">Pay Mode</th>
                <td><?=$pay_mode[$pay_mode_id]; ?></td>
            </tr>
            <tr>
            	<th align="left">Attention</th>
       			<td><?=$attention; ?></td>
            	<th align="left">Delivery Address</th>
                <td style="word-break:break-all" colspan="3"><?=$delivery_address; ?></td>
				<th align="left">Currency</td>
                <td><?=$currency[$currency_id]; ?></td>
            </tr>
            <tr>
            	
                <th align="left">Remarks</th>
                <td colspan="7" style="word-break:break-all;font-size:20px"><b><?=$remarks; ?></b></td>
            </tr>
       </table>
		<br>
		<br>
 <!--    	<table width="1333px"  cellpadding="0" cellspacing="0" style="border:0px solid black" >
    <tr>
    <th>

    </th>
    </tr>
     <tr>
     <td> -->
          <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?
  //getQtyArray_by_orderPrecostdtlsidAndGmtscolor
   //$condition->company_name("=$cbo_company_name");
   $condition= new condition();
	  if($po_idss !=''){
	 $condition->po_id("in($po_idss)");
	}
	$condition->init();
	$trim= new trims($condition);

	//echo $trim->getQuery();die;
	$trim_req_qty_arr=$trim->getQtyArray_by_orderPrecostdtlsidAndGmtscolor();
	$trim_req_size_qty_arr=$trim->getQtyArray_by_orderPrecostdtlsidAndGmtssize();
	$trim_req_color_size_qty_arr=$trim->getQtyArray_by_OrderPrecostdtlsidGmtscolorAndGmtssize();
	$costPerArr=$condition->getCostingPerArr();


	//print_r($trim_req_color_size_qty_arr);
		$precost_arr=array();
		$trims_qtyPerUnit_arr=array();

		$precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0");
        $calUom="";
		foreach($precost_sql as $precost_row){
			if($precost_row[csf('cal_parameter')]==1){
			   $calUom="Mtr";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==2){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==3){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==4){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==5){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==6){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==7){
			   $calUom="Pcs";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==8){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else{
				$calUom=0;
			}
			 $trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
		}
		$booking_country_arr=array();
		$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,sensitivity,country_id_string,remark from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0");
		foreach($nameArray_booking_country as $row){
			if($row[csf('remark')]!="")
			{
			 $booking_remarkArr[$row[csf('pre_cost_fabric_cost_dtls_id')]]=$row[csf('remark')];
			}
			$country_id_string=explode(",",$row[csf('country_id_string')]);
			$tocu=count($country_id_string);
			for($cu=0;$cu<$tocu;$cu++){
				$booking_country_arr[$row[csf('pre_cost_fabric_cost_dtls_id')]][$row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
			}
		}
		$data_array_color="select a.job_no_mst,a.id as po_id,b.order_quantity, b.item_number_id,b.color_number_id, b.size_number_id from  wo_po_break_down a, wo_po_color_size_breakdown b where a.job_no_mst=b.job_no_mst and a.id=b.po_break_down_id and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and a.id in($po_idss) order by a.id";
		$result_color=sql_select($data_array_color);
		 foreach($result_color as $row)
		 {
			 $color_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('color_number_id')]]+=$row[csf('order_quantity')];
			 $item_color_qty_arr[$row[csf('job_no_mst')]][$row[csf('item_number_id')]][$row[csf('color_number_id')]]+=$row[csf('order_quantity')];
			  $size_qty_arr[$row[csf('job_no_mst')]][$row[csf('item_number_id')]][$row[csf('size_number_id')]]+=$row[csf('order_quantity')];
			 $color_size_qty_arr[$row[csf('job_no_mst')]][$row[csf('item_number_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]+=$row[csf('order_quantity')];

			 $job_qty_arr[$row[csf('job_no_mst')]][$row[csf('item_number_id')]]+=$row[csf('order_quantity')];
		 }

		$trim_pre=sql_select( "select a.id as trim_cost_id,a.trim_group,c.cons,a.job_no,a.cons_uom,c.item_number_id,c.po_break_down_id,c.color_number_id,c.size_number_id from wo_pre_cost_trim_cost_dtls a,wo_pre_cost_trim_co_cons_dtls c   where a.id=c.wo_pre_cost_trim_cost_dtls_id and c.cons>0 and c.po_break_down_id in($po_idss) and  a.status_active =1 and a.is_deleted=0 and  c.status_active =1 and c.is_deleted=0  order by a.job_no ");
		foreach($trim_pre as $row)
		{
			$trim_item_arr[$row[csf('job_no')]][$row[csf('trim_group')]]=$row[csf('cons_uom')];
			$trim_item_arr2[$row[csf('trim_cost_id')]].=$row[csf('item_number_id')].',';
			$trim_req_qty=$trim_req_qty_arr[$row[csf('po_break_down_id')]][$row[csf('trim_cost_id')]][$row[csf('color_number_id')]];
			$trim_size_req_qty=$trim_req_size_qty_arr[$row[csf('po_break_down_id')]][$row[csf('trim_cost_id')]][$row[csf('size_number_id')]];
			$trim_color_size_req_qty=$trim_req_color_size_qty_arr[$row[csf('po_break_down_id')]][$row[csf('trim_cost_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]];
			//echo $trim_req_qty.'<br>';
			if($trim_color_size_req_qty>0)
			{
			$trim_color_req_qty_arr[$row[csf('trim_cost_id')]][$row[csf('color_number_id')]]+=$trim_color_size_req_qty;
			$trim_item_req_qty_arr[$row[csf('trim_cost_id')]]+=$trim_color_size_req_qty;
			$trim_item_size_req_qty_arr[$row[csf('trim_cost_id')]][$row[csf('size_number_id')]]+=$trim_color_size_req_qty;
			}
			//$trim_color_req_qty_arr[$row[csf('trim_cost_id')]][$row[csf('color_number_id')]]+=$row[csf('cons')];
			$trim_size_req_qty_arr[$row[csf('trim_cost_id')]][$row[csf('size_number_id')]]+=$trim_size_req_qty;
			$trim_color_size_req_qty_arr[$row[csf('trim_cost_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]+=$trim_color_size_req_qty;

		}
		//print_r($trim_color_req_qty_arr);
		$nameArray_job_po=sql_select( "select job_no from wo_booking_dtls  where booking_no='$txt_booking_no' and status_active =1 and is_deleted=0 group by job_no order by job_no ");
		foreach($nameArray_job_po as $nameArray_job_po_row){
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$nameArray_job_po_row[csf('job_no')]."'   and sensitivity=1 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
	    if(count($nameArray_item)>0){
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];//$po_quantity[$poid];
			}
        ?>

		<br>
        <table border="1" align="left" class="rpt_table"  style="margin-top:20px"cellpadding="0" width="1200" cellspacing="0" rules="all" >
            <tr>
               
                <td  align="left" colspan="8"><strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; if($ref_nos!='' ) echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;else " "; if($seasons_names!='' ) echo " &nbsp;Season:&nbsp;".$seasons_names;else " "; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;  Po Qty.:&nbsp;".$po_no_qty.'['.$unit_of_measurement[$job_uom_arr[$nameArray_job_po_row[csf('job_no')]]].']'; ?></strong></td>
                <td  colspan="7" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                
              
                
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td align="center" style="border:1px solid black"><strong>Avg.Cons./DZN</strong></td>
                <td align="center" style="border:1px solid black"><strong>Cons.UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				<td style="border:1px solid black" align="center"><strong>Rate<br>(BDT)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount<br>(BDT)</strong></td>
				  <? if($show_comment==1) {?>

				
                <td style="border:1px solid black" align="center"><strong>Rate(USD)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount(USD)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? }?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item){
			$i++;
            $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_color,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color order by bid ");
			$trim_uom=$trim_item_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf('trim_group')]];
			
			 

			$costPerQty=$costPerArr[$nameArray_job_po_row[csf('job_no')]];

            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center"  style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				?>
                </td>
                <?
				$item_desctiption_total=$item_desctiption_color_total=$item_color_po_qty_total=$item_color_req_qty_total=0;
                $total_amount_as_per_gmts_color=0;$total_bd_amount=0;
                foreach($nameArray_item_description as $result_itemdescription){
					$item_color=$result_itemdescription[csf('item_color')];
					$trim_item=rtrim($trim_item_arr2[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]],',');
					$trim_item_id=array_unique(explode(",",$trim_item));
					$jobno=$nameArray_job_po_row[csf('job_no')];
					$color_po_qty=0;
					foreach($trim_item_id as $item)
					{
					$color_po_qty+=$item_color_qty_arr[$jobno][$item][$item_color];
					}
					// $job_qty=$job_qty_arr[$nameArray_job_po_row[csf('job_no')]];
					//$color_po_qty=$color_po_qty_arr[$nameArray_job_po_row[csf('job_no')]][$item_color];
					//echo  $color_po_qty.'='. $job_qty.'<br>';
					$color_trimreq=$trim_color_req_qty_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][$result_itemdescription[csf('item_color')]];
				//	$color_trim_cons=$trim_color_req_qty_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][$result_itemdescription[csf('item_color')]];
					$color_trim_req=($color_trimreq/$color_po_qty)*$costPerQty;

                ?>
                <td style="border:1px solid black"><?  if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left" title="<? echo $trim_item;?>">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td align="center" style="border:1px solid black;">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                 <td title="Color Req Qty/Item Color Qty*Cost Per(<? echo $color_trimreq.'/'.$color_po_qty.'*'.$costPerQty;?>)" style="border:1px solid black; text-align:right">
               <? echo number_format($color_trim_req,4);
			   $item_desctiption_color_total += $color_trim_req ;
			   $item_color_po_qty_total += $color_po_qty ;
			   $item_color_req_qty_total += $color_trimreq ;//$item_color_po_qty_total=$item_color_req_qty_total=0;
			    ?>
                </td>
                 <td align="center" style="border:1px solid black;">
               <? echo $unit_of_measurement[$trim_uom]; ?>
                </td>

                <td style="border:1px solid black; text-align:right">
				<?
				echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_itemdescription[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				 <? 
				 $bd_rate=$exchange_arr[$jobno]*$result_itemdescription[csf('rate')];
				 $bd_amount=$result_itemdescription[csf('cons')]*$bd_rate;
				 $total_bd_amount+=$result_itemdescription[csf('cons')]*$bd_rate;
				 ?>
				<td style="border:1px solid black; text-align:right"><? echo number_format($bd_rate,4); ?> </td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($bd_amount,4); ?></td>
				<?
				 
				 
				 if($show_comment==1) {
					  $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
					
					  
					?>
            
				<td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
              
				echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
				$remark= $booking_remarkArr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]];
               if($trims_remark!="") $trims_remark=$trims_remark;else $trims_remark=$remark;
			    ?>
                </td>

                 <td  style="border:1px solid black; text-align:center"><p><? echo $trims_remark; ?> </p></td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                 <td title="<? echo '('.$item_color_req_qty_total.'/'.$item_color_po_qty_total.')*'.$costPerQty;?>" style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					echo number_format(($item_color_req_qty_total/$item_color_po_qty_total)*$costPerQty,4);//number_format($item_desctiption_color_total ,4);
				 ?></td>
                  <td style="border:1px solid black;  text-align:right; font-weight:bold;"></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				<td style="border:1px solid black; text-align:right"></td>
				<td style="border:1px solid black; text-align:right"><b><?=number_format($total_bd_amount,2);?></b></td>
				 <? if($show_comment==1) {?>
				
                <td style="border:1px solid black; text-align:right"></td>
                <td style="border:1px solid black; text-align:right"><b>
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?></b>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="12"><strong>Total</strong></td>
				  <? if($show_comment==1) {?>
				 <td> </td>

                <td  style="border:1px solid black;  text-align:right;font-size:18px;"><b><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></b></td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->


        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=2 and  status_active =1 and  is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" style="margin-top:20px" width="1200" cellspacing="0" rules="all" >
            <tr>
               
                 
               
                <td colspan="9"><strong>Size Sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; echo "&nbsp;&nbsp;Int Ref.:".$ref_nos; if($seasons_names!='' ) echo " &nbsp;Season:&nbsp;".$seasons_names;else " ";  if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp; Po Qty.:".$po_no_qty.'['.$unit_of_measurement[$job_uom_arr[$nameArray_job_po_row[csf('job_no')]]].']'; ?></strong></td>
                <td colspan="7" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;margin-left:210px; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
               
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Article No</strong></td>
                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>Avg.Cons./DZN</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cons.UOM</strong></td>

                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				
				<td style="border:1px solid black" align="center"><strong>Rate<br>(BDT)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount<br>(BDT)</strong></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount(USD)</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
			$i++;
			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,b.gmts_sizes,b.article_number,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size,b.gmts_sizes,b.article_number order by bid");
			$trim_uom=$trim_item_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf('trim_group')]];
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][2]);
				?>
                </td>
                <?
                $item_desctiption_total=$item_desctiption_size_total=$item_po_desctiption_size_total=$item_req_desctiption_size_total=0;
                $total_amount_as_per_gmts_color=0;$total_bd_amount=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
					//$trim_size_req_qty_arr[$row[csf('trim_cost_id')]][$row[csf('size_number_id')]]
					//$color_trim_req=$trim_size_req_qty_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][$result_itemdescription[csf('gmts_sizes')]];
					//$trim_item_size_req_qty_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][$row[csf('size_number_id')]];
					$costPerQty=$costPerArr[$nameArray_job_po_row[csf('job_no')]];
					//$color_id=$result_itemdescription[csf('color_number_id')];
					$trim_item=rtrim($trim_item_arr2[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]],',');
					$trim_item_id=array_unique(explode(",",$trim_item));
					$gmts_sizes=$result_itemdescription[csf('gmts_sizes')];
					$jobno=$nameArray_job_po_row[csf('job_no')];
					$size_po_qty=0;
					foreach($trim_item_id as $item)
					{
					$size_po_qty+=$size_qty_arr[$jobno][$item][$gmts_sizes];
					}

					$trim_sizereq=$trim_item_size_req_qty_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][$result_itemdescription[csf('gmts_sizes')]];
					//$job_qty=$job_qty_arr[$nameArray_job_po_row[csf('job_no')]];
					$trim_size_req=($trim_sizereq/$size_po_qty)*$costPerQty;

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black">
				<?
				if($result_itemdescription[csf('article_number')]!="no article"){
					echo $result_itemdescription[csf('article_number')];
				}else{
					echo "-";
				}
				?>
                </td>
                <td style="border:1px solid black; text-align:left">
              <? echo $result_itemdescription[csf('item_size')];?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <td  title="Item Size Req Qty/Item Size Qty*Cost Per(<? echo $trim_sizereq.'/'.$size_po_qty.'*'.$costPerQty;?>)" style="border:1px solid black; text-align:right">
               <? echo number_format($trim_size_req,4);
			   $item_desctiption_size_total += $trim_size_req ;
			   $item_po_desctiption_size_total += $size_po_qty ;//
			   $item_req_desctiption_size_total += $trim_sizereq ;

			    ?>
                </td>
                 <td align="center" style="border:1px solid black;">
               <? echo $unit_of_measurement[$trim_uom]; ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?
					  echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_itemdescription[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];

				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>

				<? 
				 $bd_rate=$exchange_arr[$jobno]*$result_itemdescription[csf('rate')];
				 $bd_amount=$result_itemdescription[csf('cons')]*$bd_rate;
				 $total_bd_amount+=$result_itemdescription[csf('cons')]*$bd_rate;
				 ?>
				<td style="border:1px solid black; text-align:right"><? echo number_format($bd_rate,4); ?> </td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($bd_amount,4); ?></td>

				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">

                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
				$remark= $booking_remarkArr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]];
               if($trims_remark!="") $trims_remark=$trims_remark;else $trims_remark=$remark;
                ?>
                </td>

                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td  title="<? echo '('.$item_req_desctiption_size_total.'/'.$item_po_desctiption_size_total.')*'.$costPerQty;?>" style="border:1px solid black;  text-align:right; font-weight:bold"><?

					echo number_format(($item_req_desctiption_size_total/$item_po_desctiption_size_total)*$costPerQty,4);
				 ?></td>
                   <td style="border:1px solid black;  text-align:right; font-weight:bold"><?

					//echo number_format($item_desctiption_total,4);
				 ?></td>
                   <td style="border:1px solid black;  text-align:right; font-weight:bold"><?

					echo number_format($item_desctiption_total,4);
				 ?></td>
                 <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				 <td style="border:1px solid black; text-align:right"></td>
				<td style="border:1px solid black; text-align:right"><b><?=number_format($total_bd_amount,2);?></b></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right"><b>
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?></b>
                </td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="13"><strong>Total</strong></td>
				 <? if($show_comment==1) {?>
					<td> </td>

                <td  style="border:1px solid black;  text-align:right;font-size:18px;"><b><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></b></td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=3 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>
        <table border="1" align="left" cellpadding="0" style="margin-top:20px" width="1200" cellspacing="0" rules="all" >
            <tr>
               
                <td colspan="9"><strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($seasons_names!='' ) echo " &nbsp;Season:&nbsp;".$seasons_names;else " ";  if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty.'['.$unit_of_measurement[$job_uom_arr[$nameArray_job_po_row[csf('job_no')]]].']'; ?></strong></td>
                <td colspan="7"style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
               
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>

                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>Avg.Cons./DZN</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cons.UOM</strong></td>

                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				
				<td style="border:1px solid black" align="center"><strong>Rate<br>(BDT)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount<br>(BDT)</strong></td>

				 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount(USD)</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by trim_group ", "item_color", "color_number_id"  );

			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,b.color_number_id order by bid ");

			$trim_uom=$trim_item_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf('trim_group')]];
			?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
				?>
                </td>
                <?
                $item_desctiption_total=$item_desctiption_color_total=$item_req_desctiption_color_total=$item_po_desctiption_color_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

				$costPerQty=$costPerArr[$nameArray_job_po_row[csf('job_no')]];
				$color_id=$result_itemdescription[csf('color_number_id')];

				$trim_item=rtrim($trim_item_arr2[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]],',');
				$trim_item_id=array_unique(explode(",",$trim_item));
				$jobno=$nameArray_job_po_row[csf('job_no')];
				$color_po_qty=0;
				foreach($trim_item_id as $item)
				{
				$color_po_qty+=$item_color_qty_arr[$jobno][$item][$color_id];
				}

				$color_trimreq=$trim_color_req_qty_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][$color_id];
				//$job_qty=$job_qty_arr[$nameArray_job_po_row[csf('job_no')]];

				$color_trim_req=($color_trimreq/$color_po_qty)*$costPerQty;


                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   echo $color_library[$result_itemdescription[csf('color_number_id')]];
			   ?>
                </td>
               <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                 <td title="Color Req Qty/Color PO Qty*Cost Per(<? echo $color_trimreq.'/'.$color_po_qty.'*'.$costPerQty;?>)" style="border:1px solid black; text-align:right">
               <? echo number_format($color_trim_req,4);
			   $item_desctiption_color_total += $color_trim_req ;
			   $item_req_desctiption_color_total += $color_trimreq ;
			   $item_po_desctiption_color_total += $color_po_qty ;
			    ?>
                </td>
                 <td align="center" style="border:1px solid black;">
               <? echo $unit_of_measurement[$trim_uom]; ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?
				echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_itemdescription[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];

				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				 <? 
				 $bd_rate=$exchange_arr[$jobno]*$result_itemdescription[csf('rate')];
				 $bd_amount=$result_itemdescription[csf('cons')]*$bd_rate;
				 $total_bd_amount+=$result_itemdescription[csf('cons')]*$bd_rate;
				 ?>
				<td style="border:1px solid black; text-align:right"><? echo number_format($bd_rate,4); ?> </td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($bd_amount,4); ?></td>


				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,4);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
				$remark= $booking_remarkArr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]];
               if($trims_remark!="") $trims_remark=$trims_remark;else $trims_remark=$remark;
                ?>
                </td>

                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?></p> </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td title="Color Req Qty/Color PO Qty*Cost Per(<? echo $item_req_desctiption_color_total.'/'.$item_po_desctiption_color_total.'*'.$costPerQty;?>)" style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				echo number_format(($item_req_desctiption_color_total/$item_po_desctiption_color_total)*$costPerQty,4);
				 ?></td>
                  <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				//echo number_format($item_desctiption_total,4);
				 ?></td>
                  <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				echo number_format($item_desctiption_total,4);
				 ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $uom_text; ?></td>
				<td style="border:1px solid black; text-align:right"></td>
				<td style="border:1px solid black; text-align:right"><b><?=number_format($total_bd_amount,2);?></b></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right"><b>
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?></b>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="13"><strong>Total</strong></td>
				<? if($show_comment==1) {?>
				<td> </td>

                <td  style="border:1px solid black;  text-align:right;font-size:18px;"><b><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></b></td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group");
	   if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));

			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" style="margin-top:20px" width="1200" cellspacing="0" rules="all" >
            <tr>
                
                <td colspan="12" ><strong>Color & size sensitive (<? echo "Job NO: ".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]] ;if($seasons_names!='' ) echo " &nbsp;Season:&nbsp;".$seasons_names;else " ";  echo "&nbsp;&nbsp;Int Ref.:&nbsp;".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty.'['.$unit_of_measurement[$job_uom_arr[$nameArray_job_po_row[csf('job_no')]]].']';?></strong></td>
                <td colspan="7" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
               
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group </strong> </td>


                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td style="border:1px solid black"><strong>Article No.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td style="border:1px solid black; "><strong>Gmts Color</strong> </td>
                <td style="border:1px solid black;"><strong>Gmts Size</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                 <td align="center" style="border:1px solid black"><strong>Cons.</strong></td>
                <td align="center" style="border:1px solid black"><strong>Cons.UOM</strong></td>

                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				<td style="border:1px solid black" align="center"><strong>Rate<br>(BDT)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount<br>(BDT)</strong></td>

				<? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount(USD)</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by trim_group ", "item_color", "color_number_id"  );

			 $nameArray_color=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.color_number_id as gmt_color, b.item_color as color_number_id,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount, min(c.color_order) as color_order, min(c.size_order) as size_order,c.article_number from wo_booking_dtls a, wo_trim_book_con_dtls b,wo_po_color_size_breakdown c  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and b.po_break_down_id=c.po_break_down_id and b.color_number_id=c.color_number_id and b.gmts_sizes=c.size_number_id and  c.id=b.color_size_table_id and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=4 and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.color_number_id, b.item_color,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,c.article_number order by c.article_number,color_order,size_order");



            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]." and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  status_active =1 and is_deleted=0 order by trim_group ");
            if(count($nameArray_color)>0){
            	$i++; ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <?
				$trim_uom=$trim_item_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf('trim_group')]];
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][4]);
				?>
                </td>
                <?
				$item_desctiption_total=$item_desctiption_color_size_total=$item_po_desctiption_color_size_total=$item_req_desctiption_color_size_total=0;
                $total_amount_as_per_gmts_color=0;$total_bd_amount=0;
				foreach($nameArray_color as $result_color)
                {
					$costPerQty=$costPerArr[$nameArray_job_po_row[csf('job_no')]];
					$color_id=$result_color[csf('color_number_id')];
					$gmts_sizes=$result_color[csf('gmts_sizes')];

					$trim_item=rtrim($trim_item_arr2[$result_color[csf('pre_cost_fabric_cost_dtls_id')]],',');
					$trim_item_id=array_unique(explode(",",$trim_item));
					$jobno=$nameArray_job_po_row[csf('job_no')];
					$color_po_qty=0;
					foreach($trim_item_id as $item)
					{
					$color_po_qty+=$color_size_qty_arr[$jobno][$item][$color_id][$gmts_sizes];
					}

					$color_trimreq=$trim_color_size_req_qty_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][$color_id][$result_color[csf('gmts_sizes')]];
					$job_qty=$job_qty_arr[$nameArray_job_po_row[csf('job_no')]];
					$color_size_trim_req=($color_trimreq/$color_po_qty)*$costPerQty;

					//$color_size_trim_req=$trim_color_size_req_qty_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][$result_color[csf('gmt_color')]][$result_color[csf('gmts_sizes')]];

					?>

					<td style="border:1px solid black" ><? if($result_color[csf('description')]){echo $result_color[csf('description')];} ?> </td>
					<td style="border:1px solid black" ><? if($result_color[csf('brand_supplier')]){echo $result_color[csf('brand_supplier')]; }?> </td>
                    <td style="border:1px solid black">
					<?
					if($result_color[csf('article_number')]!="no article"){
						echo $result_color[csf('article_number')];
					}else{
						echo "-";
					}
					?>
                    </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('gmt_color')]];?> </td>
                    <td style="border:1px solid black; text-align:left">
					<? echo $size_library[$result_color[csf('gmts_sizes')]]; ?>
					</td>
					<td style="border:1px solid black; text-align:left">
					<? echo $result_color[csf('item_size')]; ?>
					</td>
                    <td style="border:1px solid black; text-align:left">
				   <?
				   $calUom=$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][2];
			       $calQty=explode("_",$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				   if($calUom && end($calQty)){
					   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
				   }
                   ?>
                    </td>
                    <td title="Color Size Req Qty/Color Size Qty*Cost Per(<? echo $color_trimreq.'/'.$color_po_qty.'*'.$costPerQty;?>)" style="border:1px solid black; text-align:right">
				   <? echo number_format($color_size_trim_req,4);
                   $item_desctiption_color_size_total += $color_size_trim_req ;
				    $item_po_desctiption_color_size_total += $color_po_qty ;
					 $item_req_desctiption_color_size_total += $color_trimreq ;
                    ?>
                    </td>
                     <td align="center" style="border:1px solid black;">
                   <? echo $unit_of_measurement[$trim_uom]; ?>
                    </td>

					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('cons')],4);
					$item_desctiption_total += $result_color[csf('cons')] ;
					$trims_item_arr[$result_item[csf('trim_group')]][$result_color[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_color[csf('cons')];
					$trims_item_arr[$result_item[csf('trim_group')]][$result_color[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_color[csf('amount')];
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]];  ?></td>
					<? 
					$bd_rate=$exchange_arr[$jobno]*$result_itemdescription[csf('rate')];
					$bd_amount=$result_itemdescription[csf('cons')]*$bd_rate;
					$total_bd_amount+=$result_itemdescription[csf('cons')]*$bd_rate;
					?>
					<td style="border:1px solid black; text-align:right"><? echo number_format($bd_rate,4); ?> </td>
					<td style="border:1px solid black; text-align:right"><? echo number_format($bd_amount,4); ?></td>


					<? if($show_comment==1) {?>
					<td style="border:1px solid black; text-align:right">
					<?

					echo number_format($result_color[csf('rate')],4);
					?>
                     </td>

					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,4);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					$trims_remark=$trims_remark_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
					$remark= $booking_remarkArr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]];
              		 if($trims_remark!="") $trims_remark=$trims_remark;else $trims_remark=$remark;
					?>
					</td>

                    <td style="border:1px solid black;text-align:center"><? echo $trims_remark; ?> </td>
                    <? } ?>
				</tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="10"><strong> Item Total</strong></td>
                 <td title="Color Size Req Qty/Color Size Qty*Cost Per(<? echo $item_req_desctiption_color_size_total.'/'.$item_po_desctiption_color_size_total.'*'.$costPerQty;?>)" style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				echo number_format(($item_req_desctiption_color_size_total/$item_po_desctiption_color_size_total)*$costPerQty,4);
				 ?></td>
                  <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				//echo number_format($item_desctiption_total,4);
				 ?></td>

                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				echo number_format($item_desctiption_total,4);  ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				<td style="border:1px solid black; text-align:right"></td>
				<td style="border:1px solid black; text-align:right"><b><?=number_format($total_bd_amount,2);?></b></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right"><b>
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?></b>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
        }

            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="<? echo ($show_comment==1) ? 17 : 15; ?>"><strong>Total</strong></td>
				<? if($show_comment==1) {?>

                <td  style="border:1px solid black;  text-align:right;font-size:18px"><b><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></b></td>

                <td>&nbsp;  </td>
                <? } else{ ?>
                <td  style="border:1px solid black;  text-align:right;font-size:18px"><b><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></b></td>
                <? } ?>
            </tr>
        </table>
        <br/>
       <?
		}
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->

         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=0 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				//echo $poid.', ';
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}

			//$po_quantity[$result_job[csf('id')]];
        ?>
        <table border="1" align="left" class="rpt_table" style="margin-top:20px" cellpadding="0" width="1200" cellspacing="0" rules="all" >
            <tr>
               
                    <td colspan="8"><strong>NO sensitive  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];if($seasons_names!='' ) echo " &nbsp;Season:&nbsp;".$seasons_names;else " ";  echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty.'['.$unit_of_measurement[$job_uom_arr[$nameArray_job_po_row[csf('job_no')]]].']'; ?></strong></td>
                    <td colspan="7" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap; font-weight:bold;">Po No: <? echo implode(",",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                   
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td align="center" style="border:1px solid black"><strong>Avg.Cons./DZN</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cons.UOM</strong></td>
                <td align="center" style="border:1px solid black"><strong> Qnty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				<td style="border:1px solid black" align="center"><strong>Rate<br>(BDT)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount<br>(BDT)</strong></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount(USD)</strong></td>

                 <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                 <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color");

	$trim_uom=$trim_item_arr[$nameArray_job_po_row[csf('job_no')]][$result_item[csf('trim_group')]];
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">

                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);

				?>
                </td>
                <?
                $color_tatal=0;
                $total_amount_as_per_gmts_color=$item_req_desctiption_color_total=$item_po_desctiption_color_total=0;$total_bd_amount=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

				$costPerQty=$costPerArr[$nameArray_job_po_row[csf('job_no')]];

				$trim_item=rtrim($trim_item_arr2[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]],',');
				$trim_item_id=array_unique(explode(",",$trim_item));
				$jobno=$nameArray_job_po_row[csf('job_no')];
				$color_po_qty=0;
				foreach($trim_item_id as $item)
				{
				$color_po_qty+=$job_qty_arr[$jobno][$item];
				}

				//$color_id=$result_itemdescription[csf('color_number_id')];
				$trim_trimreq=$trim_item_req_qty_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]];
				//$job_qty=$job_qty_arr[$nameArray_job_po_row[csf('job_no')]];
				$trim_color_req=($trim_trimreq/$color_po_qty)*$costPerQty;

				//$trim_color_req=$trim_color_req_qty_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][$result_itemdescription[csf('item_color')]];
                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <td title="Item Req Qty/Job Item Qty*Cost Per(<? echo $trim_trimreq.'/'.$color_po_qty.'*'.$costPerQty;?>)" style="border:1px solid black; text-align:right">
				   <? echo number_format($trim_color_req,4);
                   $item_desctiption_color_total += $trim_color_req ;
				    $item_req_desctiption_color_total += $trim_trimreq ;
					 $item_po_desctiption_color_total += $color_po_qty ;
                    ?>
                    </td>
                     <td align="center" style="border:1px solid black;">
                   <? echo $unit_of_measurement[$trim_uom]; ?>
                    </td>

                <?
				if($db_type==0)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
						}
						if($db_type==2)
				        {
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons,sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
						}

                foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right">
                <?
                if($result_color_size_qnty[csf('cons')]!= "")
                {

               echo number_format($result_color_size_qnty[csf('cons')],4);
                $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                $color_tatal+=$result_color_size_qnty[csf('cons')];

				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_color_size_qnty[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_color_size_qnty[csf('amount')];//*$result_itemdescription[csf('rate')];
                }
                else echo "";
                ?>
                </td>
                <?
                }
                ?>

                <td style="border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				<? 
				 $bd_rate=$exchange_arr[$jobno]*$result_itemdescription[csf('rate')];
				 $bd_amount=$result_itemdescription[csf('cons')]*$bd_rate;
				 $total_bd_amount+=$result_itemdescription[csf('cons')]*$bd_rate;
				 ?>
				<td style="border:1px solid black; text-align:right"><? echo number_format($bd_rate,4); ?> </td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($bd_amount,4); ?></td>


					<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_color_size_qnty[csf('amount')];// $item_desctiption_total*  $result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,4);//amount
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$remark= $booking_remarkArr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]];
              	if($trims_remark!="") $trims_remark=$trims_remark;else $trims_remark=$remark;
                ?>
                </td>

                 <td style="border:1px solid black; text-align:right"><? echo $trims_remark; ?> </td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td  title="Item Req Qty/Job Item Qty*Cost Per(<? echo $item_req_desctiption_color_total.'/'.$item_po_desctiption_color_total.'*'.$costPerQty;?>)" style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				echo number_format((($item_req_desctiption_color_total/$item_po_desctiption_color_total)*$costPerQty),4);
				 ?></td>
                  <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				//echo number_format($item_desctiption_total,4);
				 ?></td>

                <td style="border:1px solid black;  text-align:right; font-weight:bold;">
                <?
                if($color_tatal !='')
                {

						 echo number_format($color_tatal,4);
                }
                ?>
                </td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				<td style="border:1px solid black; text-align:right"></td>
				<td style="border:1px solid black; text-align:right"><b><?=number_format($total_bd_amount,2);?></b></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right"><b>
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?></b>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="12"><strong>Total</strong></td>
					<? if($show_comment==1) {?>
					<td> </td>

                <td  style="border:1px solid black;  text-align:right;font-size:18px"><b><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></b></td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <?
		}
		}
		?>
        </td>
         </tr>
     </table>
     <br>
      <table border="1" align="left" class="rpt_table" style="margin-top:20px" cellpadding="0" width="1200" cellspacing="0" rules="all" >

			<tr>
              <td style="border:1px solid black" align="center" colspan="6"><strong>Summary</strong> </td>
              
             </tr>
            <tr>
              <td style="border:1px solid black" align="center"><strong>Sl</strong> </td>
                <td style="border:1px solid black" align="center"><strong>Item Group</strong> </td>
				<td style="border:1px solid black" align="center"><strong>Item Description</strong> </td>
                <td style="border:1px solid black" align="center"><strong>Order Uom</strong> </td>
                <td style="border:1px solid black" align="center"><strong>Total Qnty</strong> </td>
                <td style="border:1px solid black" align="center"><strong>Total Amount</strong> </td>
             </tr>
             <?
			// print_r($trims_item_arr);
			 $t=1;$total_item_cons=$total_item_amount=0;
             foreach($trims_item_arr as $trim_id=>$trim_data )
			 {
				$item_cons_tot=array();
				$item_amount_tot=array();
				foreach($trim_data as $trim_desc_id=>$trim_uom_data )
				{
				  	foreach($trim_uom_data as $uom_id=>$val )
			 		{
			 ?>
             <tr>
                <td style="border:1px solid black"> <? echo $t; ?> </td>
                    <td align="center" style="border:1px solid black"> <? echo $trim_group_library[$trim_id];?> </td>
					<td align="center" style="border:1px solid black"> <? echo $trim_desc_id;?> </td>
                    <td align="center" style="border:1px solid black"> <? echo $unit_of_measurement[$uom_id];?> </td>
                    <td align="right" style="border:1px solid black"> <? echo number_format($val['cons'],4);?> </td>
                    <td align="right" style="border:1px solid black"> <? echo number_format($val['amount'],2);?> </td>
                </tr>
                <?
			 		$t++;
					$total_item_cons+=$val['cons'];
					$total_item_amount+=$val['amount'];
					$item_cons_tot[$trim_desc_id]+=$val['cons'];
					$item_amount_tot[$trim_desc_id]+=$val['amount'];
					}
					?>
				<tr>
               		<td colspan="4" align="right"> <b>Item Total</b> </td>
					<td align="right"><b> <? echo number_format($item_cons_tot[$trim_desc_id],2);?></b> </td>
					<td align="right"><b> <? echo number_format($item_amount_tot[$trim_desc_id],2);?></b> </td>
               </tr>
				<?
				}
				
				}
				?>
               <tr>
               		<td colspan="4" align="right"> <b>Total</b> </td>
					<td align="right"><b> <? echo number_format($total_item_cons,2);?></b> </td>
					<td align="right"><b> <? echo number_format($total_item_amount,2);?></b> </td>
               </tr>

      </table>

        <!--==============================================NO NENSITIBITY END=========================================  -->

       <?
	   //$trims_item_arr[$result_item[csf('trim_group')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_color_size_qnty[csf('cons')];
	//	$trims_item_arr[$result_item[csf('trim_group')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>
       <br/>
       <table width="1200" style="margin-top:1px">
           <tr>
           <td>
           <table width="1000" class="rpt_table"  border="1" cellpadding="0" cellspacing="0" rules="all">
                <tr style="border:1px solid black;">
                    <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                    <td width="70%" style="border:1px solid black; text-align:left"><b><? echo number_format($booking_grand_total,2);?></b></td>
                </tr>
                <tr style="border:1px solid black;">
                    <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                    <td width="70%" style="border:1px solid black;"><b><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></b></td>
                </tr>
           </table>
           </td>
           </tr>
       </table>
         <br/>
            <table width="1200">
                <tr>
                <td width="49%">
                <?
                    echo get_spacial_instruction($txt_booking_no);
                ?>
                </td>
                <td width="2%"></td>
                <td width="49%" valign="top">
                    <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">

                        <tr style="border:1px solid black;">
                            <td colspan="3" style="border:1px solid black;">Approval Status</td>
                            </tr>
                            <tr style="border:1px solid black;">
                            <td width="3%" style="border:1px solid black;">Sl</td><td width="50%" style="border:1px solid black;">Name</td><td width="27%" style="border:1px solid black;">Approval Date</td><td width="20%" style="border:1px solid black;">Approval No</td>
                            </tr>


                        <?
                        $i;
                        foreach($approved_array as $row){
                        ?>
                        <tr style="border:1px solid black;">
                            <td width="3%" style="border:1px solid black;"><? echo $i;?></td><td width="50%" style="border:1px solid black;"><? echo $row[csf('user_full_name')];?></td><td width="27%" style="border:1px solid black;"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); ;?></td><td width="20%" style="border:1px solid black;"><? echo $row[csf('approved_no')];?></td>
                            </tr>
                            <?
                            $i++;
                        }
                            ?>

                    </table>
            </td>
            </tr>
        </table>
		 <br>
	  <br>
        



     <!--class="footer_signature"-->
    <div  style="margin-top:-50px;">
         <?
          echo signature_table(132, $cbo_company_name, "1333px",1);
		 ?>
   </div>
      <div id="page_break_div">
   	 </div>
    <div>

		<?
        	//echo signature_table(2, $cbo_company_name, "1330px");
			echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>

	<?
	$html = ob_get_contents();
	ob_clean();
	list($is_mail_send,$mail)=explode('___',$mail_send_data);
	if($is_mail_send==1){
		require_once('../../../mailer/class.phpmailer.php');
		require_once('../../../auto_mail/setting/mail_setting.php');
		$mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
			
		$mailToArr=array();
		$mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
		//echo $mailSql;die;
		$mailSqlRes=sql_select($mailSql);
		foreach($mailSqlRes as $rows){
			if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		}
		
		
		$mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=98 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
		//echo $mailSql;die;
		$mailSqlRes=sql_select($mailSql);
		foreach($mailSqlRes as $rows){
			if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		}
		
		if($mail!=''){$mailToArr[]=$mail;}
		$to=implode(',',$mailToArr);
		$subject="  Trims Booking Multi Job ";
		$header=mailHeader();
		echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
		
	}
	else{
		echo $html;
	}
	exit();
}
if($action=="show_trim_booking_report22")//mamun 19-06-2022 //13043
{
	extract($_REQUEST);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$team_member_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$location_name_arr=return_library_array( "select company_id,location_name from lib_location where status_active=1 and is_deleted=0",'company_id','location_name');
	$trim_group= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$color_library=return_library_array( "select id,color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name"  );
	$trim_type= return_library_array("select id, trim_type from lib_item_group",'id','trim_type');
	$exchange_arr=return_library_array("select job_no,exchange_rate from wo_pre_cost_mst","job_no","exchange_rate");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");

	$nameArray=sql_select( "select a.booking_no, a.is_approved,a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.source, a.remarks, a.revised_no from wo_booking_mst a where a.booking_no=$txt_booking_no and a.status_active =1 and a.is_deleted=0");

		foreach( $nameArray as $row)
		{
			$is_approved=$row[csf('is_approved')];
		}

		$supplier_data=sql_select("SELECT id,supplier_name,address_1, contact_no, email from lib_supplier where status_active=1 and is_deleted=0");
		foreach ($supplier_data as $row) {
			$supplier_name_arr[$row[csf('id')]]=$row[csf('supplier_name')];
			$supplier_address_arr[$row[csf('id')]]=$row[csf('address_1')];
			$supplier_info_arr[$row[csf('id')]]['tel']=$row[csf('contact_no')];
			$supplier_info_arr[$row[csf('id')]]['email']=$row[csf('email')];
		}
	?>
	<div style="width:1033px" align="center">
	
		<?
		$booking_grand_total=0;
		$grand_total_as_per_gmts_color=0;
		$grand_item_desctiption_total=0;
		$poQuantity=0;
		$uom_arr_check=array();
		$group_arr_check=array();
		$currency_id="";

		$po_num_arr=array();
		$po_id_arr=array();
		$po_status_arr=array();
		$job_no_string_arr=array();
		$buyer_string_arr=array();
		$style_ref_no_string_arr=array();
		$dealing_marchant_string_arr=array();
		$job_style_arr=array();
		$costing_per_arr=array();
		$nameArray_buyer=sql_select( "select  b.job_no,b.delivery_date,a.buyer_name,a.style_ref_no,a.dealing_marchant,c.id  as po_id,c.po_number,c.shiping_status,c.shipment_date,c.pub_shipment_date,d.costing_per   ,c.po_quantity,a.season_matrix,a.season_buyer_wise from wo_po_details_master a, wo_booking_dtls b, wo_po_break_down c ,wo_pre_cost_mst d where a.job_no=b.job_no and a.job_no=c.job_no_mst and a.job_no=d.job_no and b.po_break_down_id=c.id and b.booking_no=$txt_booking_no and b.booking_type=2 group by b.job_no,b.delivery_date,a.buyer_name,a.style_ref_no,a.dealing_marchant,c.id,c.po_number,c.shiping_status,c.shipment_date,c.pub_shipment_date,d.costing_per,a.season_matrix,a.season_buyer_wise,c.po_quantity  order by c.shipment_date desc");
        foreach ($nameArray_buyer as $result_buy)
		{
			$job_no_string_arr[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$buyer_string_arr[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$style_ref_no_string_arr[$result_buy[csf('style_ref_no')]]=$result_buy[csf('style_ref_no')];
			$job_style_arr[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$dealing_marchant_string_arr[$result_buy[csf('dealing_marchant')]]=$team_member_arr[$result_buy[csf('dealing_marchant')]];
			$po_num_arr[$result_buy[csf('po_id')]]=$result_buy[csf('po_number')];
			$po_id_arr[$result_buy[csf('po_id')]]=$result_buy[csf('po_id')];
			$po_status_arr[]=$result_buy[csf('shiping_status')];
			$min_shipdate=$result_buy[csf('shipment_date')];
			$costing_per_arr[$result_buy[csf('job_no')]]=$result_buy[csf('costing_per')];
			$poQuantity+=$result_buy[csf('po_quantity')];

			

			$season_matrix=$result_buy[csf('season_matrix')];
			$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
			if($season_matrix!=0 && $season_buyer_wise==0 )
			{
				$season_matrix_con=$season_matrix;
			}
			else if($season_buyer_wise!=0 && $season_matrix==0)
			{
				$season_matrix_con=$season_buyer_wise;
			}
			$seasons_name.=$season_arr[$season_matrix_con].',';

			
		}

	
		$deliver_sql=sql_select( "select  b.po_break_down_id,b.delivery_date   from  wo_booking_dtls b where  b.booking_no=$txt_booking_no and b.status_active=1 ");
        foreach ($deliver_sql as $row)
		{
			
			$deliver_date_arr[$row[csf('po_break_down_id')]]=$row[csf('delivery_date')];
		}
		//print_r($deliver_date_arr);
		$job_no=implode(",",$job_no_string_arr);
		$buyer_string=implode(",",$buyer_string_arr);
		$style_ref=implode(",",$style_ref_no_string_arr);
		$deling_marchent=implode(",",$dealing_marchant_string_arr);
		$po_id=implode(",",$po_id_arr);
		$seasons_names=rtrim($seasons_name,',');

		$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));


		$sql_date="SELECT a.task_finish_date,a.po_number_id,a.task_number from tna_process_mst a, wo_po_break_down b where a.po_number_id = b.id and a.status_active=1 and b.is_deleted=0 and A.TASK_NUMBER in (70,71) and (b.id in($po_id))  group by a.task_finish_date,a.po_number_id,a.task_number,a.task_category";
		//echo $sql_date;

		$date_arr=array();

		$sql_result=sql_select($sql_date);
		foreach ($sql_result as $row) 
		{
			$date_arr[$row[csf('po_number_id')]][$row[csf('task_number')]]=$row[csf('task_finish_date')];
		}

		$po_status_arr=array_unique($po_status_arr);
		$shipping_status=0;
		if(count($po_status_arr)==1){
			$shipping_status=$po_status_arr[0];
		}
		else if(count($po_status_arr)>1){
			$shipping_status=2;
		}

		//TNA Information
		$tna_start_sql=sql_select( "select id,po_number_id,
								(case when task_number=31 then task_start_date else null end) as fab_booking_start_date,
								(case when task_number=31 then task_finish_date else null end) as fab_booking_end_date,
								(case when task_number=32 then task_start_date else null end) as trims_booking_start_date,
								(case when task_number=32 then task_finish_date else null end) as trims_booking_end_date,
								(case when task_number=70 then task_start_date else null end) as Sew_Trims_rcv_start_date,
								(case when task_number=70 then task_finish_date else null end) as Sew_Trims_rcv_end_date,
								(case when task_number=84 then task_start_date else null end) as cutting_start_date,
								(case when task_number=84 then task_finish_date else null end) as cutting_end_date,
								(case when task_number=71 then task_start_date else null end) as fin_Trims_rcv_start_date,
								(case when task_number=71 then task_finish_date else null end) as fin_Trims_rcv_end_date,
								(case when task_number=86 then task_start_date else null end) as sewing_start_date,
								(case when task_number=86 then task_finish_date else null end) as sewing_end_date,
								(case when task_number=110 then task_start_date else null end) as exfact_start_date,
								(case when task_number=110 then task_finish_date else null end) as exfact_end_date
		from tna_process_mst
		where status_active=1 and po_number_id in($po_id)");
		$tna_fab_start=$tna_knit_start=$tna_dyeing_start=$tna_fin_start=$tna_cut_start=$tna_sewin_start=$tna_exfact_start="";
		$tna_date_task_arr=array();
		foreach($tna_start_sql as $row){
			if($row[csf("fab_booking_start_date")]!="" && $row[csf("fab_booking_start_date")]!="0000-00-00"){
				if($tna_fab_start==""){
					$tna_fab_start=$row[csf("fab_booking_start_date")];
				}
			}
			if($row[csf("trims_booking_start_date")]!="" && $row[csf("trims_booking_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['trims_booking_start_date']=$row[csf("trims_booking_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['trims_booking_end_date']=$row[csf("trims_booking_end_date")];
					}
					if($row[csf("Sew_Trims_rcv_start_date")]!="" && $row[csf("Sew_Trims_rcv_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['Sew_Trims_rcv_start_date']=$row[csf("Sew_Trims_rcv_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['Sew_Trims_rcv_end_date']=$row[csf("Sew_Trims_rcv_end_date")];
					}
					if($row[csf("cutting_start_date")]!="" && $row[csf("cutting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_start_date']=$row[csf("cutting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_end_date']=$row[csf("cutting_end_date")];
					}
					if($row[csf("fin_Trims_rcv_start_date")]!="" && $row[csf("fin_Trims_rcv_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['fin_Trims_rcv_start_date']=$row[csf("fin_Trims_rcv_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['fin_Trims_rcv_end_date']=$row[csf("fin_Trims_rcv_end_date")];
					}
					if($row[csf("sewing_start_date")]!="" && $row[csf("sewing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_start_date']=$row[csf("sewing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_end_date']=$row[csf("sewing_end_date")];
					}
					if($row[csf("exfact_start_date")]!="" && $row[csf("exfact_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_start_date']=$row[csf("exfact_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_end_date']=$row[csf("exfact_end_date")];
					}
		}

		$tna_start_date="";
		$min_tna_date=return_field_value(" min(a.task_start_date) as min_start_date","tna_process_mst a, lib_tna_task b"," b.task_name=a.task_number and po_number_id in ($po_id) and task_name=32","min_start_date");
		$sql_order=sql_select("select order_quantity,color_number_id,size_number_id,po_break_down_id,country_id from wo_po_color_size_breakdown  where po_break_down_id in($po_id ) and status_active=1");
		//echo "select order_quantity,color_number_id,size_number_id,po_break_down_id,country_id from wo_po_color_size_breakdown  where po_break_down_id in($po_id ) and status_active=1";
		$po_qty_po_level=array();
		$order_size_qty=array();
		$order_color_size_qty=array();
		$order_color_qty=array();
		$order_qty_arr=array();
		foreach($sql_order as $val){
			$order_color_qty[$val[csf('po_break_down_id')]][$val[csf('country_id')]][$val[csf('color_number_id')]]+=$val[csf('order_quantity')];
			$order_size_qty[$val[csf('po_break_down_id')]][$val[csf('country_id')]][$val[csf('size_number_id')]]+=$val[csf('order_quantity')];
			$order_color_size_qty[$val[csf('po_break_down_id')]][$val[csf('country_id')]][$val[csf('color_number_id')]][$val[csf('size_number_id')]]+=$val[csf('order_quantity')];
			$order_qty_arr[$val[csf('po_break_down_id')]][$val[csf('country_id')]]+=$val[csf('order_quantity')];
			$po_qty_po_level[$val[csf('po_break_down_id')]]+=$val[csf('order_quantity')];
			$order_country_arr[$val[csf('po_break_down_id')]].=$val[csf('country_id')].',';
		}

		$nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website,contact_no from lib_company where id=$cbo_company_name");
		foreach ($nameArray as $result){              
			if($result[csf('plot_no')]!='')
			{
				$plot_no=$result[csf('plot_no')];
			}
			if($result[csf('level_no')]!='')
			{
				$level_no=$result[csf('level_no')];
			}
			if($result[csf('road_no')]!='')
			{
				$road_no=$result[csf('road_no')];
			}
			if($result[csf('block_no')]!='')
			{
				$block_no=$result[csf('block_no')];
			}
			if($result[csf('city')]!='')
			{
				$city=$result[csf('city')];
			}
			$company_address[$result[csf('id')]]['address']=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
			$company_address[$result[csf('id')]]['tel']=$result[csf('contact_no')];
			$company_address[$result[csf('id')]]['email']=$result[csf('email')];
		}


		//'MM-DD-YYYY'
		if($db_type==0) $select_update_date="max(date( b.update_date)) as update_date"; else $select_update_date="max(to_char( b.update_date,'DD-MM-YYYY')) as update_date";
		$nameArray=sql_select("select a.booking_no,a.delivery_date as mst_delivery_date,a.booking_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,min(b.delivery_date) as delivery_date,a.pay_mode,a.source,a.remarks,a.tenor,a.delivery_address, $select_update_date
		from wo_booking_mst a , wo_booking_dtls b
		where a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.booking_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0
		group by a.booking_no,a.booking_date,a.delivery_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.pay_mode,a.source,a.remarks,a.tenor,a.delivery_address");
		 
		
        foreach ($nameArray as $result){
			$varcode_booking_no=$result[csf('booking_no')];
			$supplier_id=$result[csf('supplier_id')];


		ob_start();
        ?>
        <table border="1" align="left" class="rpt_table container"  cellpadding="0" width="1200" cellspacing="0" rules="all" style="padding-bottom: 10px">
       		<tr>
       	
       			<td colspan="8" width="1000">
					<div><img src='<?=$path?>/<? echo $imge_arr[$cbo_company_name]; ?>' height='60' align="left" width='100'  /></div>
                <div style="font-size: 20px; font-weight: bold; width:50%; text-align: center;margin-left:25%"><?=$company_library[$cbo_company_name]; ?></div>
                <div style="font-size: 16px; width:50%; text-align: center;margin-left:25%"><?=$company_address[$cbo_company_name]['address'] ?><br>TEL# <? echo $company_address[$cbo_company_name]['tel'] ?><br>E-Mail: <? echo $company_address[$cbo_company_name]['email'] ?></div></td>
       		</tr>
       		<tr>
       			<td colspan="8" align="center" style="font-size: 18px; font-weight: bold;">Trims Purchase Order- <?=$txt_booking_no ?></td>
       		</tr>
       		<tr>
       			<td colspan="3">Beneficiary:</td>
				<td colspan="2" rowspan="2"></td>			
       			<td colspan="3">Consignee:</td>
       		</tr>
       		<tr>
       			<td colspan="3" style="word-break:break-all"><span style="font-weight: bold;"><?
                    if($pay_mode_id==5 || $pay_mode_id==3){
                        echo $company_library[$supplier_id];
                    }
                    else{
                        echo $supplier_name_arr[$supplier_id];
                    }
                    ?></span><br><?
	                if($pay_mode_id==5 || $pay_mode_id==3){
	                    echo $company_address[$supplier_id]['address'];
	                }
	                else{
	                    echo $supplier_address_arr[$supplier_id];
	                }
                ?><br>TEL# <?
	                if($pay_mode_id==5 || $pay_mode_id==3){
	                    echo $company_address[$supplier_id]['tel'];
	                }
	                else{
	                    echo $supplier_info_arr[$supplier_id]['tel'];
	                }
                ?><br>E-mail: <?
	                if($pay_mode_id==5 || $pay_mode_id==3){
	                    echo $company_address[$supplier_id]['email'];
	                }
	                else{
	                    echo $supplier_info_arr[$supplier_id]['email'];
	                }
                ?></td>
				
       			<td colspan="3" style="word-break:break-all"><span style="font-weight: bold;"><?=$company_library[$cbo_company_name]; ?></span><br><?=$company_address[$cbo_company_name]['address'] ?><br>TEL# <?=$company_address[$cbo_company_name]['tel'] ?><br>E-Mail: <?=$company_address[$cbo_company_name]['email'] ?></td>
       		</tr>
       		<tr>
       			<th width="120" align="left">Issue Date</th>
       			<td width="150"><?=change_date_format($result[csf('booking_date')],'dd-mm-yyyy','-'); ?></td>
				<th width="120" align="left">Buyer</th>
       			<td width="120"><?= rtrim($buyer_string,", ");; ?></td>
				<th width="120" align="left">Po Qnty</th>
       			<td width="120"><?=$poQuantity; ?></td>
       			<th width="120" align="left">Delivery Date</th>
       			<td width="150"><?=change_date_format($result[csf('mst_delivery_date')],'dd-mm-yyyy','-');; ?></td>
       		
       		</tr>
			   <tr>
			    <th width="120" align="left">Dealing Merchant</th>
                <td width="150"><?	echo $deling_marchent;?></td>
            	<th align="left">Tenor</th>
                <td width="120"><?=$result[csf('tenor')]; ?></td>
				<th align="left">Source</th>
                <td width="120"><?=$source[$result[csf('source')]];; ?></td>
				<th align="left">Pay Mode</th>
                <td><?=$pay_mode[$result[csf('pay_mode')]];; ?></td>
            </tr>
            <tr>
            	<th align="left">Attention</th>
       			<td><?=$result[csf('attention')];; ?></td>
            	<th align="left">Delivery Address</th>
                <td style="word-break:break-all" colspan="3"><?=$result[csf('delivery_address')]; ?></td>
				<th align="left">Currency</td>
                <td><?=$currency_id=$result[csf('currency_id')]; echo $currency[$result[csf('currency_id')]]; ?></td>
            </tr>
            <tr>
            	
                <th align="left">Remarks</th>
                <td colspan="7" style="word-break:break-all;font-size:20px"><?=$result[csf('remarks')];; ?></td>
            </tr>
        </table>






				</br>        </br>       
		<?
        }
        ?>



          <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?
		$total_order_qty=0;
		$nameArray_job_po=sql_select( "select a.job_no,a.po_break_down_id, max(b.po_quantity) as po_quantity from wo_booking_dtls a,wo_po_break_down b  where a.booking_no=$txt_booking_no and a.booking_type=2 and a.po_break_down_id=b.id and b.status_active=1 and b.is_deleted=0  group by a.job_no,a.po_break_down_id order by a.job_no,a.po_break_down_id ");

		foreach($nameArray_job_po as $nameArray_job_po_row){
		//$all_po_qty=sql_select("select sum(order_quantity) as po_total,po_break_down_id from wo_po_color_size_breakdown where po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and status_active=1 and is_deleted=0 group by po_break_down_id");
		//$costing_per=return_field_value("costing_per", "wo_pre_cost_mst", "job_no='".$nameArray_job_po_row[csf('job_no')]."'");
		//$style_ref=return_field_value("style_ref_no", "wo_po_details_master", "job_no='".$nameArray_job_po_row[csf('job_no')]."'");
		$total_order_qty+=$po_qty_po_level[$nameArray_job_po_row[csf('po_break_down_id')]];
		$style_ref=$job_style_arr[$nameArray_job_po_row[csf('job_no')]];
		$costing_per=$costing_per_arr[$nameArray_job_po_row[csf('job_no')]];
		if($costing_per==1){
			$costing_per_qty=12;
		}
		else if($costing_per==2){
			$costing_per_qty=1;
		}
		else if($costing_per==3){
			$costing_per_qty=24;
		}
		else if($costing_per==4){
			$costing_per_qty=36;
		}
		else if($costing_per==5){
			$costing_per_qty=48;
		}

		$nameArray_item=sql_select( "select  id,trim_group,country_id_string,pre_cost_fabric_cost_dtls_id as trims_cost_dtlsid from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]."  and sensitivity=1 and status_active=1 and is_deleted=0 and wo_qnty>0 order by trim_group ");
	   if(count($nameArray_item)>0){
        ?>
        &nbsp;
        <table style="border:1px solid black" align="left" class="" style="margin-top:20px" cellpadding="0" width="1200" cellspacing="0" rules="all" >
           <tr>
                <td colspan="12" align="">
                <strong><?
				$style_sting=$style_ref;

				$date_del=0;
				if($trim_type[$nameArray_item[0][csf('trim_group')]]==1)
				{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][70];
				}
				else{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][71];
				}

				echo "Job NO:".$nameArray_job_po_row[csf('job_no')]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; Style Ref:".$style_ref." &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Seasons:".$seasons_names." &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; PO No:" .$po_num_arr[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO Qty:" .$po_qty_po_level[$nameArray_job_po_row[csf('po_break_down_id')]];?></strong>
                </td>
            </tr>
            <tr>
                <td colspan="12" align="">
                <strong>As Per Garments Color</strong>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Order Qty.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cone Length</strong></td>
				<td style="border:1px solid black" align="center"><strong>Rate<br>(BDT)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount<br>(BDT)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount<br>(USD)</strong></td>
              
            </tr>
            <?
			$i=0;
			$trim_amount_arr=array();
			$sql_trim_amount=sql_select("select id, calculatorstring,cons_uom,trim_group,job_no,description, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."' and  status_active=1 and is_deleted=0 ");
			foreach($sql_trim_amount as $item){
				$calculatorstring=explode("_",$item[csf('calculatorstring')]);
				$trim_amount_arr[$item[csf("job_no")]][$item[csf("trim_group")]][$item[csf("description")]]['amount']=$item[csf("amount")];
				$trims_cons_gmts_per_arr[$item[csf('trim_group')]][$item[csf('id')]]['cone_len']=$calculatorstring[2];
			}

            foreach($nameArray_item as $result_item){
				$i++;

				$nameArray_item_description=sql_select( "select b.description, b.brand_supplier,b.item_color, b.color_number_id ,min(b.color_size_table_id) as color_size_table_id,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and  a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=1 and   a.id= ".$result_item[csf('id')]." and a.trim_group=".$result_item[csf('trim_group')]." and b.requirment !=0 and b.requirment>0 group by b.description, b.brand_supplier,b.item_color, b.color_number_id order by color_size_table_id ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center"  style="border:1px solid black; font-weight:bold;" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				$group_arr_check[$result_item[csf('trim_group')]]=$result_item[csf('trim_group')];
				echo $trim_group[$result_item[csf('trim_group')]]."<br/>";

				$country_arr=explode(",",$result_item[csf('country_id_string')]);
				$country_name_string="";
				for($co=0; $co <count($country_arr);$co++){
				$country_name_string.=$country_library[$country_arr[$co]].",";
				}
				echo rtrim($country_name_string,',');
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;$total_bd_amount=0;
                foreach($nameArray_item_description as $result_itemdescription){
					$country_order_qty=0;
					$country=rtrim($order_country_arr[$nameArray_job_po_row[csf('po_break_down_id')]],',');
					$countryArr=array_unique(explode(",",$country));
					/*for($coa=0; $coa <count($country_arr);$coa++){

						$country_order_qty+=$order_color_qty[$nameArray_job_po_row[csf('po_break_down_id')]][$country_arr[$coa]][$result_itemdescription[csf('color_number_id')]];
					}*/
					for($coa=0; $coa <count($countryArr);$coa++){
						$country_order_qty+=$order_color_qty[$nameArray_job_po_row[csf('po_break_down_id')]][$countryArr[$coa]][$result_itemdescription[csf('color_number_id')]];
					}
                ?>
                <td style="border:1px solid black"><?  echo $result_itemdescription[csf('description')]; ?> </td>
                <td style="border:1px solid black" align="right"><? echo $country_order_qty; ?> </td>
                <td style="border:1px solid black;">
               <? echo $color_library[$result_itemdescription[csf('color_number_id')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?
			    echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$grand_total_wo_qnty+=$result_itemdescription[csf('cons')] ;
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_itemdescription[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_arr_check[$order_uom_arr[$result_item[csf('trim_group')]]]=$order_uom_arr[$result_item[csf('trim_group')]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? 
				$cone_len=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_item[csf('trims_cost_dtlsid')]]['cone_len'];
				echo number_format($cone_len,0); ?> </td>
				<? 
					$jobno=$nameArray_job_po_row[csf('job_no')];
				 $bd_rate=$exchange_arr[$jobno]*$result_itemdescription[csf('rate')];
				 $bd_amount=$result_itemdescription[csf('cons')]*$bd_rate;
				 $total_bd_amount+=$result_itemdescription[csf('cons')]*$bd_rate;
				 ?>
				<td style="border:1px solid black; text-align:right"><? echo number_format($bd_rate,4); ?> </td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($bd_amount,4); ?></td>

                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],6); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				
				$grand_total_amount_usd+=$amount_as_per_gmts_color;
                ?>
                </td>
              
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="3"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><? echo number_format($item_desctiption_total ,2); $grand_item_desctiption_total+=$item_desctiption_total;  ?></td>
                <td style="border:1px solid black;  text-align:right"></td>
                <td style="border:1px solid black;  text-align:right"></td>
				<td style="border:1px solid black; text-align:right"></td>
				<td style="border:1px solid black; text-align:right"><b><?=number_format($total_bd_amount,2);?></b></td>
                <td style="border:1px solid black; text-align:right"></td>
				<td style="border:1px solid black; text-align:right"><b><?=number_format($total_amount_as_per_gmts_color,2);?></b></td>
               
            </tr>
            <?
            }
            ?>
        </table>
        
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->



        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  id,pre_cost_fabric_cost_dtls_id as trims_cost_dtlsid,trim_group,country_id_string from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and sensitivity=2 and status_active=1 and is_deleted=0 and wo_qnty>0 order by trim_group ");
		if(count($nameArray_item)>0){

        ?>

	
        <table style="border:1px solid black;margin-top:20px" align="left"  cellpadding="0" width="1200" cellspacing="0" rules="all" >
            <tr>
                <td colspan="13" align="">
                <strong><? 
                $date_del=0;
				if($trim_type[$nameArray_item[0][csf('trim_group')]]==1)
				{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][70];
				}
				else{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][71];
				}
                 echo "Job NO:".$nameArray_job_po_row[csf('job_no')]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Style Ref:&nbsp; ".$style_ref."  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Seasons:".$seasons_names." &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; PO No:" .$po_num_arr[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO Qty:" .$po_qty_po_level[$nameArray_job_po_row[csf('po_break_down_id')]];?></strong>
                </td>
            </tr>
            <tr>
                <td colspan="13" align="">
                <strong>Size Sensitive </strong>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Order Qty.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Size</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                 <td style="border:1px solid black" align="center"><strong>Cone length</strong></td>
				 <td style="border:1px solid black" align="center"><strong>Rate<br>(BDT)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount<br>(BDT)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount<br>(USD)</strong></td>
                
            </tr>
            <?
			$i=0;
			$trim_amount_arr=array();
			$uom_arr_check=array();
			$sql_trim_amount=sql_select("select  id,calculatorstring,cons_uom,trim_group,job_no,description, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."' and  status_active=1 and is_deleted=0 ");

			foreach($sql_trim_amount as $item){
				$calculatorstring=explode("_",$item[csf('calculatorstring')]);
				$trim_amount_arr[$item[csf("job_no")]][$item[csf("trim_group")]][$item[csf("description")]]['amount']=$item[csf("amount")];
				$trims_cons_gmts_per_arr[$item[csf('trim_group')]][$item[csf('id')]]['cone_len']=$calculatorstring[2];
			}

            foreach($nameArray_item as $result_item){
			$i++;
			$nameArray_item_description=sql_select( "select b.description, b.brand_supplier,b.item_size,b.gmts_sizes,min(b.color_size_table_id) as color_size_table_id, sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id=b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=2 and  a.id= ".$result_item[csf('id')]." and a.trim_group=".$result_item[csf('trim_group')]." and b.requirment>0 group by b.description, b.brand_supplier,b.item_size, b.gmts_sizes order by color_size_table_id");
			$sql_trim_amount=sql_select("select  cons_uom, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."'  and trim_group=".$result_item[csf('trim_group')]." ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black; font-weight:bold;" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				$group_arr_check[$result_item[csf('trim_group')]]=$result_item[csf('trim_group')];
				echo $trim_group[$result_item[csf('trim_group')]]."<br/>";
				$country_arr=explode(",",$result_item[csf('country_id_string')]);
				$country_name_string="";
				for($co=0; $co <count($country_arr);$co++){
					$country_name_string.=$country_library[$country_arr[$co]].",";
				}
				echo rtrim($country_name_string,',');
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;$total_bd_amount=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
					$country=rtrim($order_country_arr[$nameArray_job_po_row[csf('po_break_down_id')]],',');
					$countryArr=array_unique(explode(",",$country));
					$country_order_qty=0;
					/*for($coa=0; $coa <count($country_arr);$coa++){
					 $country_order_qty+=$order_size_qty[$nameArray_job_po_row[csf('po_break_down_id')]][$country_arr[$coa]][$result_itemdescription[csf('gmts_sizes')]];
					}*/
					for($coa=0; $coa <count($countryArr);$coa++){
					 $country_order_qty+=$order_size_qty[$nameArray_job_po_row[csf('po_break_down_id')]][$countryArr[$coa]][$result_itemdescription[csf('gmts_sizes')]];
					}
                ?>
                <td style="border:1px solid black"><? echo $result_itemdescription[csf('description')]; ?> </td>
                <td style="border:1px solid black" align="right"><? echo $country_order_qty;?> </td>
                <td style="border:1px solid black; text-align:right">
              <? echo $result_itemdescription[csf('item_size')];?>
                </td>
                <td style="border:1px solid black; text-align:right">
              <? echo $size_library[$result_itemdescription[csf('gmts_sizes')]];?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?
				 echo number_format($result_itemdescription[csf('cons')],2);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$grand_total_wo_qnty+=$result_itemdescription[csf('cons')] ;
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_itemdescription[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_arr_check[$order_uom_arr[$result_item[csf('trim_group')]]]=$order_uom_arr[$result_item[csf('trim_group')]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? 
				$cone_len=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_item[csf('trims_cost_dtlsid')]]['cone_len'];
				echo number_format($cone_len,0); ?> </td>
 <? 
				 $jobno=$nameArray_job_po_row[csf('job_no')];
				 $bd_rate=$exchange_arr[$jobno]*$result_itemdescription[csf('rate')];
				 $bd_amount=$result_itemdescription[csf('cons')]*$bd_rate;
				 $total_bd_amount+=$result_itemdescription[csf('cons')]*$bd_rate;
				 ?>
				<td style="border:1px solid black; text-align:right"><? echo number_format($bd_rate,4); ?> </td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($bd_amount,4); ?></td>

                  <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],6); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				
				$grand_total_amount_usd+=$amount_as_per_gmts_color;
                ?>
                </td>
               
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><? echo number_format($item_desctiption_total,2); $grand_item_desctiption_total+=$item_desctiption_total;  ?></td>
                 <td style="border:1px solid black;  text-align:right"></td>
                  <td style="border:1px solid black;  text-align:right"></td>
				  <td style="border:1px solid black; text-align:right"></td>
				<td style="border:1px solid black; text-align:right"><b><?=number_format($total_bd_amount,2);?></b></td>
                <td style="border:1px solid black; text-align:right"></td>
				<td style="border:1px solid black; text-align:right"><b><?=number_format($total_amount_as_per_gmts_color,2);?></b></td>
                
            </tr>
            <?
            }
            ?>
        </table>
        </br>
		</br>
        <?
		}
		?>

        <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select  id,pre_cost_fabric_cost_dtls_id as trims_cost_dtlsid,trim_group,country_id_string from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and sensitivity=3 and status_active=1 and is_deleted=0 and wo_qnty>0 order by trim_group ");
		if(count($nameArray_item)>0){
        ?>
        <table style="border:1px solid black;margin-top:20px" align="left"  cellpadding="0" width="1200" cellspacing="0" rules="all" >
           <tr>
                <td colspan="13" align="">
                <strong><?

                $date_del=0;
				if($trim_type[$nameArray_item[0][csf('trim_group')]]==1)
				{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][70];
				}
				else{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][71];
				}	

                 echo "Job NO:".$nameArray_job_po_row[csf('job_no')]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Style Ref:&nbsp; ".$style_ref." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Seasons:".$seasons_names." &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;PO No:" .$po_num_arr[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO Qty:" .$po_qty_po_level[$nameArray_job_po_row[csf('po_break_down_id')]];?></strong>
                </td>
            </tr>
            <tr>
                <td colspan="13" align="">
                <strong>Contrast Color</strong>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Order Qty.</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Conde Length</strong></td>
				<td style="border:1px solid black" align="center"><strong>Rate<br>(BDT)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount<br>(BDT)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount<br>(USD)</strong></td>
                
            </tr>
            <?
			$i=0;
			$trim_amount_arr=array();$uom_arr_check=array();
			$sql_trim_amount=sql_select("select  id,calculatorstring,cons_uom,trim_group,job_no,description, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."' and  status_active=1 and is_deleted=0 ");

			foreach($sql_trim_amount as $item){
				$trim_amount_arr[$item[csf("job_no")]][$item[csf("trim_group")]][$item[csf("description")]]['amount']=$item[csf("amount")];
				$calculatorstring=explode("_",$item[csf('calculatorstring')]);
				$trims_cons_gmts_per_arr[$item[csf('trim_group')]][$item[csf('id')]]['cone_len']=$calculatorstring[2];
			}
            foreach($nameArray_item as $result_item){
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and  a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=3 and  a.id= ".$result_item[csf('id')]." and a.trim_group=".$result_item[csf('trim_group')]." and b.requirment !=0  order by trim_group ", "item_color", "color_number_id"  );
				$nameArray_item_description=sql_select( "select b.description, b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,min(b.color_size_table_id) as color_size_table_id,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=3 and  a.id= ".$result_item[csf('id')]." and a.trim_group=".$result_item[csf('trim_group')]." and b.requirment !=0 group by b.description, b.brand_supplier,b.item_color,b.color_number_id order by color_size_table_id ");
				$sql_trim_amount=sql_select("select  cons_uom, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."'  and trim_group=".$result_item[csf('trim_group')]." ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black; font-weight:bold;" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				$group_arr_check[$result_item[csf('trim_group')]]=$result_item[csf('trim_group')];
				echo $trim_group[$result_item[csf('trim_group')]]."<br/>";
				$country_arr=explode(",",$result_item[csf('country_id_string')]);
				$country_name_string="";
				for($co=0; $co <count($country_arr);$co++){
					$country_name_string.=$country_library[$country_arr[$co]].",";
				}
				echo rtrim($country_name_string,',');
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;$total_bd_amount=0;
                foreach($nameArray_item_description as $result_itemdescription){
					
					$country=rtrim($order_country_arr[$nameArray_job_po_row[csf('po_break_down_id')]],',');
					$countryArr=array_unique(explode(",",$country));
					
					$country_order_qty=0;
					/*for($coa=0; $coa <count($country_arr);$coa++){
					 $country_order_qty+=$order_color_qty[$nameArray_job_po_row[csf('po_break_down_id')]][$country_arr[$coa]][$gmtcolor_library[$result_itemdescription[csf('item_color')]]];
					}*/
					for($coa=0; $coa <count($countryArr);$coa++){
					 $country_order_qty+=$order_color_qty[$nameArray_job_po_row[csf('po_break_down_id')]][$countryArr[$coa]][$gmtcolor_library[$result_itemdescription[csf('item_color')]]];
					}
                ?>
                <td style="border:1px solid black"><? echo $result_itemdescription[csf('description')]; ?> </td>
                <td style="border:1px solid black" align="right"><? echo $country_order_qty; ?> </td>
                <td style="border:1px solid black">
               <? echo $color_library[$result_itemdescription[csf('color_number_id')]]; ?>
                </td>
                <td style="border:1px solid black">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?
				echo number_format($result_itemdescription[csf('cons')],2);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				$grand_total_wo_qnty+=$result_itemdescription[csf('cons')] ;
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_itemdescription[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_arr_check[$order_uom_arr[$result_item[csf('trim_group')]]]=$order_uom_arr[$result_item[csf('trim_group')]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? 
				$cone_len=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_item[csf('trims_cost_dtlsid')]]['cone_len'];
				echo number_format($cone_len,0); ?> </td>
				<? 
				 $jobno=$nameArray_job_po_row[csf('job_no')];
				 $bd_rate=$exchange_arr[$jobno]*$result_itemdescription[csf('rate')];
				 $bd_amount=$result_itemdescription[csf('cons')]*$bd_rate;
				 $total_bd_amount+=$result_itemdescription[csf('cons')]*$bd_rate;
				 ?>
				<td style="border:1px solid black; text-align:right"><? echo number_format($bd_rate,4); ?> </td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($bd_amount,4); ?></td>

                 <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],6); ?> </td>
                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;

	
				$grand_total_amount_usd+=$amount_as_per_gmts_color;
                ?>
                </td>
               
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><? echo number_format($item_desctiption_total,2); $grand_item_desctiption_total+=$item_desctiption_total;  ?></td>
                <td style="border:1px solid black;text-align:center"></td>
                <td style="border:1px solid black; text-align:right"></td>
               
				<td style="border:1px solid black; text-align:right"></td>
				<td style="border:1px solid black; text-align:right"><b><?=number_format($total_bd_amount,2);?></b></td>
                <td style="border:1px solid black; text-align:right"></td>
				<td style="border:1px solid black; text-align:right"><b><?=number_format($total_amount_as_per_gmts_color,2);?></b></td>
               
            </tr>
            <?
            }
            ?>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?

		$nameArray_item=sql_select( "select  id,pre_cost_fabric_cost_dtls_id as trims_dtlsid,trim_group,country_id_string from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and sensitivity=4 and status_active=1 and is_deleted=0 and wo_qnty>0 order by trim_group ");
	   if(count($nameArray_item)>0)
		{
        ?>
		</br></br>

        <table style="border:1px solid black;margin-top:20px" align="left"  cellpadding="0" width="1200" cellspacing="0" rules="all" >
             <tr>
                <td colspan="15" align="">
                <strong><?

                $date_del=0;
				if($trim_type[$nameArray_item[0][csf('trim_group')]]==1)
				{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][70];
				}
				else{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][71];
				}

                 echo "Job NO:".$nameArray_job_po_row[csf('job_no')]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Style Ref:&nbsp; ".$style_ref." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Seasons:".$seasons_names." &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;PO No:" .$po_num_arr[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO Qty:" .$po_qty_po_level[$nameArray_job_po_row[csf('po_break_down_id')]];?></strong>
                </td>
            </tr>
            <tr>
                <td colspan="15" align="">
                <strong>Color & size sensitive </strong>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Order Qty.</strong> </td>

                <td style="border:1px solid black"><strong>Gmts Color</strong> </td>
                <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Size</strong></td>

                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Cone Length</strong></td>
				<td style="border:1px solid black" align="center"><strong>Rate<br>(BDT)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount<br>(BDT)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount<br>(USD)</strong></td>
                
            </tr>
            <?
			$i=0;
			$trim_amount_arr=array();
			$sql_trim_amount=sql_select("select  id,calculatorstring,cons_uom,trim_group,job_no,description, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."' and  status_active=1 and is_deleted=0 ");

			foreach($sql_trim_amount as $item)
            {
				
				$trim_amount_arr[$item[csf("job_no")]][$item[csf("trim_group")]][$item[csf("description")]]['amount']=$item[csf("amount")];
				$calculatorstring=explode("_",$item[csf('calculatorstring')]);
				$trims_cons_gmts_per_arr[$item[csf('trim_group')]][$item[csf('id')]]['cone_len']=$calculatorstring[2];
			}
            foreach($nameArray_item as $result_item)
            {
			$i++;
			$nameArray_color=sql_select( "select  b.item_color,b.color_number_id,b.item_size,b.gmts_sizes,min(b.color_size_table_id) as color_size_table_id,b.description, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id   and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and  a.id= ".$result_item[csf('id')]." and a.trim_group=".$result_item[csf('trim_group')]." and a.sensitivity=4 and b.requirment !=0 group by b.item_color,b.color_number_id,b.item_size,b.gmts_sizes,b.description, b.brand_supplier order by color_size_table_id ");
            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and sensitivity=4   and trim_group=".$result_item[csf('trim_group')]." order by trim_group ");
			$sql_trim_amount=sql_select("select  cons_uom, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."'  and trim_group=".$result_item[csf('trim_group')]." ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_color)); ?>">
                <? echo $i ; ?>
                </td>
                <td align="center" style="border:1px solid black; font-weight:bold;" rowspan="<? echo (count($nameArray_color)); ?>">
                <?
				$group_arr_check[$result_item[csf('trim_group')]]=$result_item[csf('trim_group')];
				echo $trim_group[$result_item[csf('trim_group')]]."<br/>";
				$country_arr=explode(",",$result_item[csf('country_id_string')]);
				$country_name_string="";
				for($co=0; $co <count($country_arr);$co++)
				{
				 $country_name_string.=$country_library[$country_arr[$co]].",";
				}
				echo rtrim($country_name_string,',');
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
				$uom_arr_check=array();
				$total_bd_amount=0;
				foreach($nameArray_color as $result_color)
                {
					$country=rtrim($order_country_arr[$nameArray_job_po_row[csf('po_break_down_id')]],',');
					$countryArr=array_unique(explode(",",$country));
					
					$country_order_qty=0;
				/*	for($coa=0; $coa <count($country_arr);$coa++)
					{
					 $country_order_qty+=$order_color_size_qty[$nameArray_job_po_row[csf('po_break_down_id')]][$country_arr[$coa]][$result_color[csf('color_number_id')]][$result_color[csf('gmts_sizes')]];
					}*/
					for($coa=0; $coa <count($countryArr);$coa++)
					{
					 $country_order_qty+=$order_color_size_qty[$nameArray_job_po_row[csf('po_break_down_id')]][$countryArr[$coa]][$result_color[csf('color_number_id')]][$result_color[csf('gmts_sizes')]];
					}
					?>
					<td style="border:1px solid black" ><? echo $result_color[csf('description')]; ?> </td>
					<td style="border:1px solid black" align="right" ><? echo $country_order_qty; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('item_color')]]; ?> </td>
					<td style="border:1px solid black; text-align:right">
					<? echo $result_color[csf('item_size')]; ?>
					</td>
                    <td style="border:1px solid black; text-align:right">
					<? echo $size_library[$result_color[csf('gmts_sizes')]]; ?>
					</td>
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('cons')],2);
					$item_desctiption_total += $result_color[csf('cons')] ;
					$grand_total_wo_qnty+=$result_color[csf('cons')] ;
					$trims_item_arr[$result_item[csf('trim_group')]][$result_color[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_color[csf('cons')];
					$trims_item_arr[$result_item[csf('trim_group')]][$result_color[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_color[csf('amount')];
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_arr_check[$order_uom_arr[$result_item[csf('trim_group')]]]= $order_uom_arr[$result_item[csf('trim_group')]];?></td>
					<td style="border:1px solid black; text-align:right">
					<?
					$cone_len=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_item[csf('trims_dtlsid')]]['cone_len'];
					echo number_format($cone_len,0);
					?>
                     </td>
					 <? 
				 $jobno=$nameArray_job_po_row[csf('job_no')];
				 $bd_rate=$exchange_arr[$jobno]*$result_color[csf('rate')];
				 $bd_amount=$result_color[csf('amount')]*$bd_rate;
				 $total_bd_amount+=$result_color[csf('amount')]*$bd_rate;
				 ?>
				<td style="border:1px solid black; text-align:right"><? echo number_format($bd_rate,4); ?> </td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($bd_amount,4); ?></td>
                     <td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('rate')],6);
					?>
                     </td>
					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,2);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					
					$grand_total_amount_usd+=$amount_as_per_gmts_color;
					?>
					</td>

				</tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="8"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><? echo number_format($item_desctiption_total,2); $grand_item_desctiption_total+=$item_desctiption_total; ?></td>
                <td style="border:1px solid black;  text-align:right"></td>
                <td style="border:1px solid black;  text-align:right"></td>
				<td style="border:1px solid black; text-align:right"></td>
				<td style="border:1px solid black; text-align:right"><b><?=number_format($total_bd_amount,2);?></b></td>
                <td style="border:1px solid black; text-align:right"></td>
				<td style="border:1px solid black; text-align:right"><b><?=number_format($total_amount_as_per_gmts_color,2);?></b></td>
               
            </tr>
            <?
            }

            ?>
        </table>
        <br/>
       <?
		}
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->


         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  id,trim_group,pre_cost_fabric_cost_dtls_id as trims_cost_dtlsid,country_id_string from wo_booking_dtls  where booking_no=$txt_booking_no and job_no='".$nameArray_job_po_row[csf('job_no')]."' and po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and sensitivity=0 and status_active=1 and is_deleted=0 and wo_qnty>0 order by trim_group ");
		if(count($nameArray_item)>0)
		{
        ?>
        <table  style="border:1px solid black;margin-top:20px" align="left" class=""  cellpadding="0" width="1200" cellspacing="0" rules="all" >

            <tr>
                <td colspan="12" align="">
                <strong><?

                $date_del=0;
				if($trim_type[$nameArray_item[0][csf('trim_group')]]==1)
				{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][70];
				}
				else{
					$date_del=$date_arr[$nameArray_job_po_row[csf('po_break_down_id')]][71];
				}
                 echo "Job NO:".$nameArray_job_po_row[csf('job_no')]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; Style Ref:&nbsp; ".$style_ref." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Seasons:".$seasons_names." &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;PO No:" .$po_num_arr[$nameArray_job_po_row[csf('po_break_down_id')]]." &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PO Qty:" .$po_qty_po_level[$nameArray_job_po_row[csf('po_break_down_id')]];?></strong>
                </td>
            </tr>
            <tr>
                <td colspan="13" align="">
                <strong>No Sensitivity</strong>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black"><strong>Sl</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Order Qty.</strong> </td>
                <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td align="center" style="border:1px solid black"><strong> Qnty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
                <td style="border:1px solid black" align="center"><strong>Conde Length</strong></td>
				
				<td style="border:1px solid black" align="center"><strong>Rate<br>(BDT)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount<br>(BDT)</strong></td>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td style="border:1px solid black" align="center"><strong>Amount<br>(USD)</strong></td>
               
            </tr>
            <?
			$i=0;
			$trim_amount_arr=array();
			$sql_trim_amount=sql_select("select  id,calculatorstring,cons_uom,trim_group,job_no,description, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."' and  status_active=1 and is_deleted=0 ");

			foreach($sql_trim_amount as $item)
            {
				$trim_amount_arr[$item[csf("job_no")]][$item[csf("trim_group")]][$item[csf("description")]]['amount']=$item[csf("amount")];
				$calculatorstring=explode("_",$item[csf('calculatorstring')]);
				$trims_cons_gmts_per_arr[$item[csf('trim_group')]][$item[csf('id')]]['cone_len']=$calculatorstring[2];
			}
			$grand_color_total=0;$uom_arr_check=array();
            foreach($nameArray_item as $result_item)
            {
				$i++;

				$nameArray_item_description=sql_select( "select  b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and  a.id= ".$result_item[csf('id')]." and a.trim_group=".$result_item[csf('trim_group')]." and a.sensitivity=0 group by b.description, b.brand_supplier,b.item_color");

            $sql_trim_amount=sql_select("select  cons_uom, cons_dzn_gmts, rate, amount from  wo_pre_cost_trim_cost_dtls where job_no='".$nameArray_job_po_row[csf('job_no')]."'  and trim_group=".$result_item[csf('trim_group')]." ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
                <td align="center" style="border:1px solid black; font-weight:bold;" rowspan="<? echo count($nameArray_item_description)+1; ?>">

                <?
				$group_arr_check[$result_item[csf('trim_group')]]=$result_item[csf('trim_group')];
				echo $trim_group[$result_item[csf('trim_group')]]."<br/>";
				$country_arr=explode(",",$result_item[csf('country_id_string')]);
				$country_name_string="";
				for($co=0; $co <count($country_arr);$co++)
				{
				 $country_name_string.=$country_library[$country_arr[$co]].",";
				}
				echo rtrim($country_name_string,',');
				?>
                </td>
                <?
                $color_tatal=0;
                $total_amount_as_per_gmts_color=0;$total_bd_amount=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {
					$country=rtrim($order_country_arr[$nameArray_job_po_row[csf('po_break_down_id')]],',');
					$countryArr=array_unique(explode(",",$country));
                $item_desctiption_total=0;
				$country_order_qty=0;
				/*for($coa=0; $coa <count($country_arr);$coa++)
				{
				 $country_order_qty+=$order_qty_arr[$nameArray_job_po_row[csf('po_break_down_id')]][$country_arr[$coa]];
				}*/
				for($coa=0; $coa <count($countryArr);$coa++)
				{
				 $country_order_qty+=$order_qty_arr[$nameArray_job_po_row[csf('po_break_down_id')]][$countryArr[$coa]];
				}

                ?>
                <td style="border:1px solid black"><? echo $result_itemdescription[csf('description')]; ?> </td>
                <td style="border:1px solid black" align="right"><? echo $country_order_qty; ?> </td>
                <td style="border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
                <?
				if($db_type==0)
				{
				$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=0 and  a.id= ".$result_item[csf('id')]." and a.trim_group=". $result_item[csf('trim_group')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
				}
				if($db_type==2)
				{
				$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no=$txt_booking_no and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.po_break_down_id=".$nameArray_job_po_row[csf('po_break_down_id')]." and a.sensitivity=0 and  a.id= ".$result_item[csf('id')]." and a.trim_group=". $result_item[csf('trim_group')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
				}

                foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                {
                ?>
                <td style="border:1px solid black; text-align:right;">
                <?
                if($result_color_size_qnty[csf('cons')]!= "")
                {
                echo number_format($result_color_size_qnty[csf('cons')],2);
                $item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
                $color_tatal+=$result_color_size_qnty[csf('cons')];
				$grand_total_wo_qnty+=$result_color_size_qnty[csf('cons')] ;
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['cons']+=$result_color_size_qnty[csf('cons')];
				$trims_item_arr[$result_item[csf('trim_group')]][$result_itemdescription[csf('description')]][$order_uom_arr[$result_item[csf('trim_group')]]]['amount']+=$result_color_size_qnty[csf('amount')];//*$result_itemdescription[csf('rate')];
                }
                else echo "";
                ?>
                </td>
                <?
                }
                ?>

                <td style="border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; if($order_uom_arr[$result_item[csf('trim_group')]]>0) $uom_arr_check[]=$order_uom_arr[$result_item[csf('trim_group')]]; ?></td>
                <td style="border:1px solid black; text-align:right"><? 
				$cone_len=$trims_cons_gmts_per_arr[$result_item[csf('trim_group')]][$result_item[csf('trims_cost_dtlsid')]]['cone_len'];
				echo number_format($cone_len,0); ?> </td>
				 <? 
				 $jobno=$nameArray_job_po_row[csf('job_no')];
				 $bd_rate=$exchange_arr[$jobno]*$result_itemdescription[csf('rate')];
				 $bd_amount=$item_desctiption_total*$bd_rate;
				 $total_bd_amount+=$item_desctiption_total*$bd_rate;
				 ?>
				<td style="border:1px solid black; text-align:right"><? echo number_format($bd_rate,4); ?> </td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($bd_amount,4); ?></td>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],6); ?> </td>
                <td style="border:1px solid black; text-align:right;">
                <?
                $amount_as_per_gmts_color = $item_desctiption_total*$result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				
				$grand_total_amount_usd+=$amount_as_per_gmts_color;
                ?>
                </td>
              
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="3"><strong> Item Total</strong></td>
				<td style="border:1px solid black; text-align:right"></td>
				<td style="border:1px solid black; text-align:right"><b><?=number_format($total_bd_amount,2);?></b></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;">
                <?
                if($color_tatal !='')
                {
                echo number_format($color_tatal,2);
				$grand_item_desctiption_total+= $color_tatal;
                }
                ?>
                </td>
                <td style="border:1px solid black;"></td>
                <td style="border:1px solid black;"></td>
                <td style="border:1px solid black; text-align:right"></td>
               <td style="border:1px solid black; text-align:right; font-weight:bold;">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>
				
                
                
                
            </tr>
            <?
            }
            ?>
        </table>
        <?
		}
		}
		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->
       &nbsp;
       <?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1){
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2){
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3){
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	 
	   ?>
       <table  width="1200" class=""  style="border:1px solid black;margin-top:20px"  cellpadding="0" cellspacing="0" rules="all" align="left">
            <tr style="border:1px solid black;">
                <td width="14%"  style="border:1px solid black; text-align:right; font-weight:bold; ">Total Order Qty:</td>
				<td width="14%"  style="border:1px solid black; text-align:right; font-weight:bold; "><? echo number_format($total_order_qty,2);?></td>
                <td width="13%" style="border:1px solid black;  text-align:right; font-weight:bold; "> Total WO Qty:</td>
                <td width="9%" style="border:1px solid black;  text-align:right; font-weight:bold; "><?	echo number_format($grand_total_wo_qnty,2);		?>
                </td>
				<td width="12%" style="border:1px solid black;  text-align:right; font-weight:bold; "> Total Amount:</td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold; padding-right:160px;"><? echo number_format($grand_total_amount_usd,2);?></td>
            </tr>
            <tr style="border:1px solid black;">
                <td colspan="5" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                <td style="border:1px solid black;"><? echo number_to_words(def_number_format($grand_total_amount_usd,2,""),$mcurrency, $dcurrency);?></td>
            </tr>
       </table>
	   &nbsp;
	   &nbsp;
	   <table border="1" align="left" class="rpt_table" style="margin-top:20px" cellpadding="0" width="1200" cellspacing="0" rules="all" >

				<tr>
				<td style="border:1px solid black" align="center" colspan="6"><strong>Summary</strong> </td>
				
				</tr>
				<tr>
				<td style="border:1px solid black" align="center"><strong>Sl</strong> </td>
					<td style="border:1px solid black" align="center"><strong>Item Group</strong> </td>
					<td style="border:1px solid black" align="center"><strong>Item Description</strong> </td>
					<td style="border:1px solid black" align="center"><strong>Order Uom</strong> </td>
					<td style="border:1px solid black" align="center"><strong>Total Qnty</strong> </td>
					<td style="border:1px solid black" align="center"><strong>Total Amount</strong> </td>
				</tr>
				<?
				// print_r($trims_item_arr);
				$t=1;$total_item_cons=$total_item_amount=0;
				foreach($trims_item_arr as $trim_id=>$trim_data )
				{
					$item_cons_tot=array();
					$item_amount_tot=array();
					foreach($trim_data as $trim_desc_id=>$trim_uom_data )
					{
						foreach($trim_uom_data as $uom_id=>$val )
						{
				?>
				<tr>
					<td style="border:1px solid black"> <? echo $t; ?> </td>
						<td align="center" style="border:1px solid black"> <? echo $trim_group[$trim_id];?> </td>
						<td align="center" style="border:1px solid black"> <? echo $trim_desc_id;?> </td>
						<td align="center" style="border:1px solid black"> <? echo $unit_of_measurement[$uom_id];?> </td>
						<td align="right" style="border:1px solid black"> <? echo number_format($val['cons'],4);?> </td>
						<td align="right" style="border:1px solid black"> <? echo number_format($val['amount'],2);?> </td>
					</tr>
					<?
						$t++;
						$total_item_cons+=$val['cons'];
						$total_item_amount+=$val['amount'];
						$item_cons_tot[$trim_desc_id]+=$val['cons'];
						$item_amount_tot[$trim_desc_id]+=$val['amount'];
						}
						?>
					<tr>
						<td colspan="4" align="right"> <b>Item Total</b> </td>
						<td align="right"><b> <? echo number_format($item_cons_tot[$trim_desc_id],2);?></b> </td>
						<td align="right"><b> <? echo number_format($item_amount_tot[$trim_desc_id],2);?></b> </td>
				</tr>
					<?
					}
					
					}
					?>
				<tr>
						<td colspan="4" align="right"> <b>Total</b> </td>
						<td align="right"><b> <? echo number_format($total_item_cons,2);?></b> </td>
						<td align="right"><b> <? echo number_format($total_item_amount,2);?></b> </td>
				</tr>

				</table>
       &nbsp;

         <? echo get_spacial_instruction($txt_booking_no);?>

    <br>
   
           <br>
        <!--<div style="max-width:1000;">-->
      	<style>
			.rpt_ntable{
				border:1px solid black;
			}
			.rpt_ntable tr{
				border:1px solid black;
			}
			.rpt_ntable tr td{
				border:1px solid black;
			}
		</style>
      

        <br>

        <table cellspacing="0" cellpadding="0" rules="all" width="100%" class=""  align="left">
        	<tr>
            	<td>
				<?
					echo signature_table(2, $cbo_company_name, "1030px");
					echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
				?>
                </td>
            </tr>
        </table>
        <!--</div>  -->

    </div>
	<?
	if($link==1){
		?>
		<script type="text/javascript" src="../../../js/jquery.js"></script>
		<script type="text/javascript" src="../../../js/jquerybarcode.js"></script>
		<?
	}
	else{
		?>
		<script type="text/javascript" src="../../js/jquery.js"></script>
		<script type="text/javascript" src="../../js/jquerybarcode.js"></script>
		<?
	}
	?>
	<script>
	fnc_generate_Barcode('<? echo $varcode_booking_no; ?>','barcode_img_id');
	</script>
	<?
   $html = ob_get_contents();
   ob_clean();
   list($is_mail_send,$mail)=explode('___',$mail_send_data);
   if($is_mail_send==1){
	   require_once('../../../mailer/class.phpmailer.php');
	   require_once('../../../auto_mail/setting/mail_setting.php');
	   $mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
		   
	   $mailToArr=array();
	   $mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
	   //echo $mailSql;die;
	   $mailSqlRes=sql_select($mailSql);
	   foreach($mailSqlRes as $rows){
		   if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
	   }
	   
	   
	   $mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=98 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
	   //echo $mailSql;die;
	   $mailSqlRes=sql_select($mailSql);
	   foreach($mailSqlRes as $rows){
		   if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
	   }
	   if($mail!=''){$mailToArr[]=$mail;}
	   
	   $to=implode(',',$mailToArr);
		$subject=" Trims Booking Multi Job ";
	   $header=mailHeader();
	   echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
	   
   }
   else{
	   echo $html;
   }
   exit();




}

if($action=="show_trim_booking_report23")//mamun 29-06-2022 //14378 copy button 2
{
	//extract($_REQUEST);
	extract(check_magic_quote_gpc($_REQUEST));
	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$id_approved_id=str_replace("'","",$id_approved_id);
	$report_type=str_replace("'","",$report_type);
	$show_comment=str_replace("'","",$show_comment);

	$color_library=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
	$size_library=return_library_array("select id, size_name from  lib_size where status_active=1 and is_deleted=0", "id", "size_name");
	$company_library=return_library_array("select id, company_name from lib_company", "id", "company_name");
	$trim_group_library= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$trims_imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='pre_cost_trimsv2' and file_type=1 ",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');

	$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$order_uom_arr=return_library_array("select id,order_uom  from lib_item_group","id","order_uom");
	$deling_marcent_arr=return_library_array("select id,team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");
	$lib_user=return_library_array("select id,user_full_name from user_passwd","id","user_full_name");

	$nameArray_approved=sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0");
	list($nameArray_approved_row)=$nameArray_approved;
	//$revised_no_data=sql_select("select a.revised_no  from wo_booking_mst a where  a.booking_no=$txt_booking_no and  a.status_active =1 and a.is_deleted=0");
	//list($revised_no_row)=$revised_no_data;
		$booking_grand_total=0; $currency_id="";

		$buyer_string=array(); $style_owner=array(); $job_no=array(); $style_ref=array(); $all_dealing_marcent=array(); $season=array(); $order_repeat_no=array(); $po_id_arr=array();

		$nameArray_buyer=sql_select( "select  a.style_ref_no, a.job_no, a.style_owner, a.buyer_name, a.dealing_marchant, a.season, a.season_matrix, a.season_buyer_wise, a.order_repeat_no, b.po_break_down_id,a.product_code from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");
        foreach ($nameArray_buyer as $result_buy){
			$buyer_string[$result_buy[csf('buyer_name')]]=$buyer_name_arr[$result_buy[csf('buyer_name')]];
			$style_owner[$result_buy[csf('job_no')]]=$company_library[$result_buy[csf('style_owner')]];
			$job_no[$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
			$style_ref[$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
			$product_code_arr[$result_buy[csf('job_no')]]=$result_buy[csf('product_code')];
			$all_dealing_marcent[$result_buy[csf('job_no')]]=$deling_marcent_arr[$result_buy[csf('dealing_marchant')]];
			//$season[$result_buy[csf('job_no')]]=$season_arr[$result_buy[csf('season_matrix')]];
			$season_matrix=$result_buy[csf('season_matrix')];
			$season_buyer_wise=$result_buy[csf('season_buyer_wise')];
			if($season_matrix!=0 && $season_buyer_wise==0 )
			{
				$season_matrix_con=$season_matrix;
			}
			else if($season_buyer_wise!=0 && $season_matrix==0)
			{
				$season_matrix_con=$season_buyer_wise;
			}
			$seasons_name.=$season_arr[$season_matrix_con].',';
			$order_rept_no.=$result_buy[csf('order_repeat_no')].',';
			$order_repeat_no[$result_buy[csf('order_repeat_no')]]=$result_buy[csf('order_repeat_no')];

			$po_id_arr[$result_buy[csf('po_break_down_id')]]=$result_buy[csf('po_break_down_id')];
		}
		$style_sting=implode(",",array_unique($style_ref));
		$product_code=implode(",",array_unique($product_code_arr));
		$job_no_str = "'" . implode( "','", $job_no ) . "'";
		$job_no=implode(",",$job_no);
		$seasons_names=rtrim($seasons_name,',');

		$seasons_names=implode(",",array_unique(explode(",",$seasons_names)));
		$poid_arr=array_unique($po_id_arr);

		$order_rept_no=rtrim($order_rept_no,',');
		$order_rept_no=implode(",",array_unique(explode(",",$order_rept_no)));
		$main_fabric_approved = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and a.job_no in (".$job_no_str.") and b.entry_form=7 and a.status_active =1 and a.is_deleted=0 order by b.id asc");


		$po_no=array(); $file_no=array(); $ref_no=array(); $po_quantity=array();
		$pub_shipment_date='';$int_ref_no='';$tot_po_quantity=0;$po_idss='';
		$nameArray_job=sql_select( "select b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no, sum(b.po_quantity) as po_quantity  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and  a.status_active =1 and a.is_deleted=0 group by b.job_no_mst,b.id,b.pub_shipment_date, b.po_number,b.grouping, b.file_no ");
        foreach ($nameArray_job as $result_job){
			$po_no[$result_job[csf('job_no_mst')]][$result_job[csf('id')]]=$result_job[csf('po_number')];
			$file_no[$result_job[csf('id')]]=$result_job[csf('file_no')];
			$ref_no[$result_job[csf('id')]]=$result_job[csf('grouping')];
			$po_quantity[$result_job[csf('id')]]=$result_job[csf('po_quantity')];
		//	$tot_po_quantity+=$result_job[csf('po_quantity')];
			$job_ref_no[$result_job[csf('job_no_mst')]].=$result_job[csf('grouping')].',';
			$job_file_no[$result_job[csf('job_no_mst')]].=$result_job[csf('file_no')].',';
			$po_no_arr[$result_job[csf('job_no_mst')]]['po_id'].=$result_job[csf('id')].',';
			$pub_shipment_date.=$result_job[csf('pub_shipment_date')].',';
			$int_ref_no.=$result_job[csf('grouping')].',';
			if($po_idss=='') $po_idss=$result_job[csf('id')];else $po_idss.=",".$result_job[csf('id')];

		}
			//echo $po_idss.'DDDDDDDDD';
		$sql_job=sql_select( "select b.job_no_mst,b.id as po_id, b.po_quantity as po_quantity  from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and  a.status_active =1 and a.is_deleted=0 and  b.status_active =1 and b.is_deleted=0 and b.id in(".$po_idss.") ");
		foreach ($sql_job as $row)
		{
			$job_po_qty_arr[$row[csf('job_no_mst')]][$row[csf('po_id')]]+=$row[csf('po_quantity')];
			$tot_po_quantity+=$row[csf('po_quantity')];
		}

        $nameArray=sql_select( "select a.booking_no, a.is_approved,a.pay_mode,a.buyer_id, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_address, a.delivery_date, a.source, a.remarks, a.revised_no,a.inserted_by,a.insert_date from wo_booking_mst a where a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0");
		foreach( $nameArray as $row)
		{
			$varcode_booking_no=$row[csf('booking_no')];
			$booking_date=$row[csf('booking_date')];
			$delivery_date=$row[csf('delivery_date')];
			$pay_mode_id=$row[csf('pay_mode')];
			$supplier_id=$row[csf('supplier_id')];
			$currency_id=$row[csf('currency_id')];
			$buyer_id=$row[csf('buyer_id')];
			$exchange_rate=$row[csf('exchange_rate')];
			$attention=$row[csf('attention')];
			$remarks=$row[csf('remarks')];
			$delivery_address=$row[csf('delivery_address')];
			$revised_no=$row[csf('revised_no')];
			$source_id=$row[csf('source')];
			$is_approved=$row[csf('is_approved')];
		}
		$approved_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name, b.id from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no='$txt_booking_no' and b.entry_form=8 and  a.status_active =1 and a.is_deleted=0 order by b.id asc");

	 $sql_date_update=sql_select("SELECT a.updated_by, a.booking_no,a.update_date
				  FROM wo_booking_dtls a, wo_booking_dtls b
				 WHERE a.booking_no = b.booking_no AND a.update_date >= b.update_date
				 and a.booking_no='$txt_booking_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.update_date desc");
	 $sql_date_insert=sql_select("SELECT a.inserted_by, a.booking_no,a.insert_date
						  FROM wo_booking_dtls a, wo_booking_dtls b
						 WHERE a.booking_no = b.booking_no AND a.insert_date <= b.insert_date
						 and a.booking_no='$txt_booking_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.insert_date");
	
	ob_start();
	
	?>
	<table width="100%"  cellpadding="0" cellspacing="0" style="border:0px solid black">
       		<tr>
                <td width="20px">
                    <table width="100%" cellpadding="0" cellspacing="0" style="border:0px solid black">
                    <tr>
                    <td width="50" >
                       <? if($report_type==1)
                       {
                           if($link == 1)
                           {
                       ?>
                                <img  src='../../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />

                       <?
                           }
                           else
                           {
                       ?>
                                <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
                       <?	}
                       }
                       else
                       { ?>
                         <img  src='../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
                      <? }
                       ?>
                   </td>
                    <td width="40px" align="center">
                    &nbsp;  &nbsp;  &nbsp;
                    </td>
                    <td width="30px"   align="center">

                   <b style="font-size:25px;"> <?
                    echo $company_library[$cbo_company_name]; ?>
                    </b>
                    <br>
                    <label>
                        <?
                            $nameArray=sql_select( "select id,plot_no,level_no,road_no,block_no,bin_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                            foreach ($nameArray as $result){
                            ?>
                              <?  if($result[csf('plot_no')]!='') echo $result[csf('plot_no')]; else echo '';?> &nbsp;
                                <? echo $result[csf('level_no')];?> &nbsp;
                                 <? echo $result[csf('road_no')]; ?>  &nbsp;
                                <? echo $result[csf('block_no')];?>  &nbsp;
                                <? echo $result[csf('city')];?>  &nbsp;
                                <? echo $result[csf('zip_code')]; ?>  &nbsp;
                                 <?php echo $result[csf('province')]; ?>  &nbsp;
                                <? echo $country_arr[$result[csf('country_id')]]; ?> &nbsp;<br/>
                                <? echo $result[csf('email')];?>  &nbsp;
                                <? echo $result[csf('website')];
                                if($result[csf('plot_no')]!='')
                                {
                                    $plot_no=$result[csf('plot_no')];
                                }
                                if($result[csf('level_no')]!='')
                                {
                                    $level_no=$result[csf('level_no')];
                                }
                                if($result[csf('road_no')]!='')
                                {
                                    $road_no=$result[csf('road_no')];
                                }
                                if($result[csf('block_no')]!='')
                                {
                                    $block_no=$result[csf('block_no')];
                                }
                                if($result[csf('city')]!='')
                                {
                                    $city=$result[csf('city')];
                                }
                                $company_address[$result[csf('id')]]=$plot_no.'&nbsp'.$level_no.'&nbsp'.$road_no.'&nbsp'.$block_no.'&nbsp'.$city;
								if($result[csf('bin_no')]!='') echo "<br> BIN:".$result[csf('bin_no')];
                            }
                        ?>
                        </label>
                        <br/>
                        <b style="font-size:20px;">
                         <?php echo $report_title; ?>
                        </b>
                    </td>
                     <td width="10px" align="center" style="font-size:20px;">
                      <table width="80%" align="right" cellpadding="0" cellspacing="0" style="border:0px solid black">
                        <tr>
                            <td width="80">  Booking No:&nbsp; <?php echo $varcode_booking_no; ?>  </td>
                        </tr>
                        <tr>
                            <td>  Booking Date:&nbsp; <?php echo change_date_format($booking_date); ?>  </td>
                        </tr>
                        <?
                        if($revised_no>0)
                        {
                        ?>
                        <tr>
                            <td>  Revised No:&nbsp; <?php echo $revised_no; ?>  </td>
                        </tr>
                        <?
                        }
                        //if(str_replace("'","",$id_approved_id) ==1)
                        // {
                         ?>
                          <tr>
                              <td>Approved Status :&nbsp;  <? 
							 if($is_approved ==1){ echo "(Approved)";} 
							 else if($is_approved ==3){ echo "(Partial Approved)";} else{echo "";}; ?> 
                             </td>
                         </tr>
						 <tr>
							<td>Product No :&nbsp;<?=$product_code;?></td>
						</tr>
                         <?
                       // }
                         ?>
                      </table>
                     </td>
                   </tr>
                   </table>
                </td>
        	</tr>
            <tr>
            <td>

            	<table width="1320"  style="border:0px solid black;table-layout: fixed;">
                <tr>
                    <td colspan="6" valign="top"> </td>
                </tr>
                <tr>
                    <td width="100" style="font-size:18px" align="left"><span><b>To, </b></span>  </td>
                    <td width="110" colspan="5" style="font-size:18px">&nbsp;<span></span></td>
                </tr>
            	<tr>
                    <td width="210" colspan="2" align="left" style="font-size:18px">&nbsp; <b>
                    <?
                    if($pay_mode_id==5 || $pay_mode_id==3){
                        echo $company_library[$supplier_id];
                    }
                    else{
                        echo $supplier_name_arr[$supplier_id];
                    }
                    ?></b>
                    </td>
                    <td  width="100" style="font-size:12px"><b>Buyer</b></td>
                    <td  width="110" align="left">:&nbsp;<? echo $buyer_name_arr[$buyer_id]; ?></td>
                    <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
                    <td width="110" align="left">:&nbsp;<?  echo change_date_format($delivery_date); ?></td>
           	   </tr>
              <tr>
                <td width="100" colspan="2" rowspan="2" align="left" style="font-size:18px">Address :&nbsp;
                <b>
                <?
                if($pay_mode_id==5 || $pay_mode_id==3){
                    $address=$company_address[$supplier_id];
                }
                else{
                    $address=$supplier_address_arr[$supplier_id];
                }
                echo $address;
                ?></b>
                </td>
                <td width="100" style="font-size:12px"><b>PO Qty.</b> </td>
                <td width="110" align="left">:&nbsp;<? echo $tot_po_quantity; ?></td>
                <td style="font-size:12px" ><b>Delivery To </b> </td>
                <td style="" align="left">:&nbsp;
                <?
                    echo $delivery_address;
                ?>
                </td>
             </tr>
            <tr>
                <td width="100" style="font-size:12px"><b>Season</b> </td>
                <td width="110" align="left">:&nbsp;<? echo $seasons_names; ?></td>
                <td width="100" style="font-size:12px"><b>Currency</b></td>
                <td width="110" align="left">:&nbsp;<?  echo $currency[$currency_id]; ?></td>
            </tr>
            <tr>
                <td width="100" style="font-size:12px" align="left"><b>Attention </b>   </td>
                <td align="left" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
                <?
                    echo $attention;

                ?>
                </td>
                <td width="100" style="font-size:12px"><b>Order Repeat </b> </td>
                <td width="110" align="left">:&nbsp;<? echo $order_rept_no; ?></td>
                <td  style="font-size:12px"><b>Pay mode</b></td>
                <td align="left">:&nbsp;<? echo $pay_mode[$pay_mode_id];?></td>
            </tr>
             <tr>
                <td width="100" style="font-size:12px" align="left"><b>Source</b></td>
                <td align="left" >:&nbsp;<? echo $source[$source_id];?></td>
                <td style="font-size:12px"><b>Dealing Merchant</b></td>
                <td align="left" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;">:&nbsp;
                <?
                    echo implode(",",array_unique($all_dealing_marcent));
                ?>
                </td>
                <td>Insert By</td>
                <td title="<?=$sql_date_insert[0][csf('insert_date')];?>">:&nbsp;<?=$lib_user[$sql_date_insert[0][csf('inserted_by')]]?></td>
            </tr>
            <tr>
                <td width="100" style="font-size:12px" align="left"><b>Remarks</b>  </td>
                <td align="left" width="110" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;" >:&nbsp;<? echo $remarks; ?></td>
                <td width="130" style="font-size:12px" align="left"><b>Main Fabric Booking 1<sup>st</sup> Approved Date</b></td>
                <td align="left">:&nbsp;<?  echo change_date_format($main_fabric_approved[0][csf('approved_date')]); ?></td>
                <td>Last Update By</td>
                <td title="<?=$sql_date_update[0][csf('update_date')];?>">:&nbsp;<?=$lib_user[$sql_date_update[0][csf('updated_by')]]?> </td>
            </tr>
            </table>
            </td>
            </tr>
          	</table>
          <!--==============================================AS PER GMTS COLOR START=========================================  -->
		<?

		$precost_arr=array();
		$trims_qtyPerUnit_arr=array();

		$precost_sql=sql_select("select a.id, a.job_no,a.trim_group,a.calculatorstring,a.remark, c.cal_parameter from wo_pre_cost_trim_cost_dtls a,wo_booking_dtls b, lib_item_group c where a.job_no=b.job_no and a.trim_group=b.trim_group and a.trim_group=c.id and b.booking_no='$txt_booking_no' and a.id=b.pre_cost_fabric_cost_dtls_id and  b.status_active =1 and b.is_deleted=0");
        $calUom="";
		foreach($precost_sql as $precost_row){
			if($precost_row[csf('cal_parameter')]==1){
			   $calUom="Mtr";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==2){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==3){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==4){
			   $calUom="Pcs";
			}
			else if($precost_row[csf('cal_parameter')]==5){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==6){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==7){
			   $calUom="Pcs";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else if($precost_row[csf('cal_parameter')]==8){
			   $calUom="Yds";
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][1]=$precost_row[csf('calculatorstring')];
			   $trims_qtyPerUnit_arr[$precost_row[csf('id')]][2]=$calUom;
			}
			else{
				$calUom=0;
			}
			 $trims_remark_arr[$precost_row[csf('id')]]['remark']=$precost_row[csf('remark')];
		}
		$booking_country_arr=array();
		$nameArray_booking_country=sql_select( "select pre_cost_fabric_cost_dtls_id,sensitivity,country_id_string from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0");
		foreach($nameArray_booking_country as $nameArray_booking_country_row){
			$country_id_string=explode(",",$nameArray_booking_country_row[csf('country_id_string')]);
			$tocu=count($country_id_string);
			for($cu=0;$cu<$tocu;$cu++){
				$booking_country_arr[$nameArray_booking_country_row[csf('pre_cost_fabric_cost_dtls_id')]][$nameArray_booking_country_row[csf('sensitivity')]][$country_id_string[$cu]]=$country_arr[$country_id_string[$cu]];
			}
		}

		$nameArray_job_po=sql_select( "select job_no from wo_booking_dtls  where booking_no='$txt_booking_no' and status_active =1 and is_deleted=0 group by job_no order by job_no ");
		foreach($nameArray_job_po as $nameArray_job_po_row){
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and  status_active =1 and is_deleted=0 and job_no='".$nameArray_job_po_row[csf('job_no')]."'   and sensitivity=1 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
	    if(count($nameArray_item)>0){
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];//$po_quantity[$poid]; 
			}
        ?>

        <table border="1" align="left" class="rpt_table"  cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="13" align="">
                <table width="100%" >
                <tr>
                <td width="60%" align="left"><strong>As Per Garments Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; if($ref_nos!='' ) echo " &nbsp;Int Ref.:&nbsp;".$ref_nos;else " ";if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;  Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black" width="25"><strong>Sl</strong> </td>
				<td style="border:1px solid black" width="100"><strong>Internal Ref.</strong> </td>
				<td style="border:1px solid black" width="100"><strong>Image</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				  <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? }?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item){
			$i++;
            $nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_color,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.rate*b.requirment) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=1  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
				<td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">  <?echo $ref_nos;?>
                </td>
				<td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
				<img  src='../../<? echo $trims_imge_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]; ?>' height='90px' width='100px' />
                </td>
                <td align="center"  style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription){
                ?>
                <td style="border:1px solid black"><?  if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>
                <td style="border:1px solid black; text-align:right">
				<?

				echo number_format($result_itemdescription[csf('cons')],4);
				$item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right" title="Avg Rate"><? echo number_format( $result_itemdescription[csf('amount')]/$result_itemdescription[csf('cons')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('amount')];
				// $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>

                 <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                 <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="4"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?

					echo number_format($item_desctiption_total ,4);
				 ?></td>
                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
				  <? if($show_comment==1) {?>
				 <td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>
        <!--==============================================AS PER GMTS COLOR END=========================================  -->


        <!--==============================================Size Sensitive START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=2 and  status_active =1 and  is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group  order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="14" align="">
                 <table width="100%" >
                <tr>
                <td width="60%"><strong>Size Sensitive (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]]; echo "&nbsp;&nbsp;Int Ref.:".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp; Po Qty..:".$po_no_qty; ?></strong></td>
                <td width="40%" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td style="border:1px solid black" width="25"><strong>Sl</strong> </td>
				<td style="border:1px solid black" width="100"><strong>Internal Ref.</strong> </td>
				<td style="border:1px solid black" width="100"><strong>Image</strong> </td>
				<td style="border:1px solid black"><strong>Item Group</strong> </td>
                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                 <td align="center" style="border:1px solid black"><strong>Article No</strong></td>
                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
			$i++;
			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.description, b.brand_supplier,b.item_size,b.article_number,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and   a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=2 and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_size,b.article_number order by bid");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i ; ?>
                </td>
				<td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $ref_nos; ?>
                </td>
				<td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <img  src='../../<? echo $trims_imge_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]; ?>' height='90px' width='100px' />
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][2]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black">
				<?
				if($result_itemdescription[csf('article_number')]!="no article"){
					echo $result_itemdescription[csf('article_number')];
				}else{
					echo "-";
				}
				?>
                </td>
                <td style="border:1px solid black; text-align:left">
              <? echo $result_itemdescription[csf('item_size')];?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>


                <td style="border:1px solid black; text-align:right">
				<?

					  echo number_format($result_itemdescription[csf('cons')],4);

                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                <td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">

                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>

                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?> </p></td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold"><?

					echo number_format($item_desctiption_total,4);
				 ?></td>
                 <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="11"><strong>Total</strong></td>
				 <? if($show_comment==1) {?>
					<td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp; </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================Size Sensitive END=========================================  -->

         <!--==============================================AS PER CONTRAST COLOR START=========================================  -->
		<?
		 $nameArray_item=sql_select( "select pre_cost_fabric_cost_dtls_id, trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=3 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));

			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>
        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="12" align="">
                <table width="100%" >
                <tr>
                <td width="60%"><strong>Contrast Color (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " ";echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="40%" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td width="25" style="border:1px solid black"><strong>Sl</strong> </td>
				<td style="border:1px solid black" width="100"><strong>Internal Ref.</strong> </td>
				<td style="border:1px solid black" width="100"><strong>Image</strong> </td>
                <td style="border:1px solid black"><strong>Item Group</strong> </td>

                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td align="center" style="border:1px solid black"><strong>Item Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Gmts Color</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				$i++;
				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by trim_group ", "item_color", "color_number_id"  );

			$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid,b.description, b.brand_supplier,b.item_color,b.color_number_id,sum(b.requirment) as cons,sum(b.amount) as amount,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=3  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,b.color_number_id order by bid ");
            ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $i; ?>
                </td>
				<td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <? echo $ref_nos;	 ?>
                </td>
				<td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
				<img  src='../../<? echo $trims_imge_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]; ?>' height='90px' width='100px' />
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][3]);
				?>
                </td>
                <?
                $item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                foreach($nameArray_item_description as $result_itemdescription)
                {

                ?>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];}?> </td>
                <td style="border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
                <td style="border:1px solid black; text-align:left">
               <? echo $color_library[$result_itemdescription[csf('item_color')]]; ?>
                </td>
                <td style="border:1px solid black; text-align:left">
               <?
			   echo $color_library[$result_itemdescription[csf('color_number_id')]];
			   ?>
                </td>
               <td style="border:1px solid black; text-align:left">
               <?
			   $calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
			   $calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
			   if($calUom && end($calQty)){
				   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
			   }
			   ?>
                </td>

                <td style="border:1px solid black; text-align:right">
				<?
				echo number_format($result_itemdescription[csf('cons')],4);
                $item_desctiption_total += $result_itemdescription[csf('cons')] ;
				?>
                </td>
                 <td style="border:1px solid black; text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('amount')]/$result_itemdescription[csf('cons')],4); ?> </td>

                <td style="border:1px solid black; text-align:right">
                <?
                $amount_as_per_gmts_color = $result_itemdescription[csf('amount')];//$result_itemdescription[csf('cons')]*$result_itemdescription[csf('rate')];
				echo number_format($amount_as_per_gmts_color,2);
                $total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
				$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
                ?>
                </td>

                <td style="border:1px solid black; text-align:right"><p><? echo $trims_remark; ?></p> </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td style="border:1px solid black;  text-align:right" colspan="5"><strong> Item Total</strong></td>
                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
				echo number_format($item_desctiption_total,4);
				 ?></td>
                <td style="border:1px solid black;text-align:center"><? echo $uom_text; ?></td>
				 <? if($show_comment==1) {?>
                <td style="border:1px solid black; text-align:right"></td>

                <td style="border:1px solid black; text-align:right">
                <?
                echo number_format($total_amount_as_per_gmts_color,2);
                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
                ?>
                </td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
            <?
            }
            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="11"><strong>Total</strong></td>
				<? if($show_comment==1) {?>
				<td> </td>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp;  </td>
                <? } ?>
            </tr>
        </table>
        <br/>
        <?
		}
		?>

        <!--==============================================AS PER CONTRAST COLOR END=========================================  -->

        <!--==============================================AS PER GMTS Color & SIZE START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group");
	   if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));

			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}
        ?>

        <table border="1" align="left" cellpadding="0" width="100%" cellspacing="0" rules="all" >
            <tr>
                <td colspan="16" align="">
                <table width="100%" >
                <tr>
                <td width="60%" ><strong>Color & size sensitive (<? echo "Job NO: ".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]] ;echo "&nbsp;&nbsp;Int Ref.:&nbsp;".$ref_nos;if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo "&nbsp;&nbsp;Po Qty.:&nbsp;".$po_no_qty;?></strong></td>
                <td width="40%" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
                </tr>
                </table>
                </td>
            </tr>
            <tr>
                <td width="25" style="border:1px solid black"><strong>Sl</strong> </td>
				<td style="border:1px solid black" width="100"><strong>Internal Ref.</strong> </td>
				<td style="border:1px solid black" width="100"><strong>Image</strong> </td>

                <td style="border:1px solid black"><strong>Item Group </strong> </td>


                <td style="border:1px solid black"><strong>Item Description</strong> </td>
                <td style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td style="border:1px solid black"><strong>Article No.</strong> </td>
                 <td style="border:1px solid black"><strong>Item Color</strong> </td>
                <td style="border:1px solid black; width:170px;"><strong>Gmts Color</strong> </td>
                <td style="border:1px solid black;"><strong>Gmts Size</strong> </td>

                <td align="center" style="border:1px solid black"><strong>Item Size</strong></td>
                <td align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td style="border:1px solid black" align="center"><strong>WO Qty.</strong></td>
                <td style="border:1px solid black" align="center"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td style="border:1px solid black" align="center"><strong>Rate</strong></td>

                <td style="border:1px solid black" align="center"><strong>Amount</strong></td>

                <td style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;

            foreach($nameArray_item as $result_item)
            {

				$gmtcolor_library=return_library_array( "select b.item_color,b.color_number_id from wo_booking_dtls a,  wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and  a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.sensitivity=4    and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by trim_group ", "item_color", "color_number_id"  );

			 $nameArray_color=sql_select( "select a.pre_cost_fabric_cost_dtls_id,min(b.id) as bid, b.color_number_id as gmt_color, b.item_color as color_number_id,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,sum(b.requirment) as cons,avg(b.rate) as rate, sum(b.amount) as amount, min(c.color_order) as color_order, min(c.size_order) as size_order,c.article_number from wo_booking_dtls a, wo_trim_book_con_dtls b,wo_po_color_size_breakdown c  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no and b.po_break_down_id=c.po_break_down_id and b.color_number_id=c.color_number_id and b.gmts_sizes=c.size_number_id and  c.id=b.color_size_table_id and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."' and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=4 and b.requirment !=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.color_number_id, b.item_color,b.item_size,b.gmts_sizes,b.description, b.brand_supplier,c.article_number order by c.article_number,color_order,size_order");



            $nameArray_item_description=sql_select( "select distinct uom from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=4 and trim_group=".$result_item[csf('trim_group')]." and pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  status_active =1 and is_deleted=0 order by trim_group ");

            if(count($nameArray_color)>0){
            	$i++; ?>
            <tr>
                <td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <? echo $i ; ?>
                </td>
				<td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <? echo $ref_nos;	?>
                </td>
				<td style="border:1px solid black" rowspan="<? echo   (count($nameArray_item_description)*count($nameArray_color)); ?>">
				<img  src='../../<? echo $trims_imge_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]; ?>' height='90px' width='100px' />
                </td>
                <td align="center" style="border:1px solid black" rowspan="<? echo (count($nameArray_item_description)*count($nameArray_color)); ?>">
                <?
				echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
				echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][4]);
				?>
                </td>
                <?
				$item_desctiption_total=0;
                $total_amount_as_per_gmts_color=0;
                /*echo '<pre>';
            	print_r($nameArray_color);*/

				foreach($nameArray_color as $result_color)
                {
					?>

					<td style="border:1px solid black" ><? if($result_color[csf('description')]){echo $result_color[csf('description')];} ?> </td>
					<td style="border:1px solid black" ><? if($result_color[csf('brand_supplier')]){echo $result_color[csf('brand_supplier')]; }?> </td>
                    <td style="border:1px solid black">
					<?
					if($result_color[csf('article_number')]!="no article"){
						echo $result_color[csf('article_number')];
					}else{
						echo "-";
					}
					?>
                    </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; ?> </td>
                    <td style="border:1px solid black"><? echo $color_library[$result_color[csf('gmt_color')]];?> </td>
                    <td style="border:1px solid black; text-align:left">
					<? echo $size_library[$result_color[csf('gmts_sizes')]]; ?>
					</td>
					<td style="border:1px solid black; text-align:left">
					<? echo $result_color[csf('item_size')]; ?>
					</td>
                    <td style="border:1px solid black; text-align:left">
				   <?
				   $calUom=$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][2];
			       $calQty=explode("_",$trims_qtyPerUnit_arr[$result_color[csf('pre_cost_fabric_cost_dtls_id')]][1]);
				   if($calUom && end($calQty)){
					   echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
				   }
                   ?>
                    </td>

					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('cons')],4);
					$item_desctiption_total += $result_color[csf('cons')] ;
					?>
                    </td>
					<td style="border:1px solid black;text-align:center"><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]];  ?></td>
					<? if($show_comment==1) {?>
					<td style="border:1px solid black; text-align:right">
					<?
					echo number_format($result_color[csf('rate')],4);
					?>
                     </td>

					<td style="border:1px solid black; text-align:right">
					<?
					$amount_as_per_gmts_color =$result_color[csf('amount')];
					echo number_format($amount_as_per_gmts_color,2);
					$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
					$trims_remark=$trims_remark_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
					?>
					</td>

                    <td style="border:1px solid black;text-align:center"><? echo $trims_remark; ?> </td>
                    <? } ?>
				</tr>
            	<?
            	}
            	?>
            	<tr>
	                <td style="border:1px solid black;  text-align:right" colspan="10"><strong> Item Total</strong></td>
	                <td style="border:1px solid black;  text-align:right; font-weight:bold;"><?
					echo number_format($item_desctiption_total,4);  ?></td>
	                <td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
					<? if($show_comment==1) {?>
	                <td style="border:1px solid black; text-align:right"></td>

	                <td style="border:1px solid black; text-align:right">
	                <?
	                echo number_format($total_amount_as_per_gmts_color,2);
	                $grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
	                ?>
	                </td>

	                <td>&nbsp;  </td>
	                <? } ?>
            	</tr>
            <?
            }
        	}

            ?>
            <tr>
                <td align="right" style="border:1px solid black"  colspan="<? echo ($show_comment==1) ? 15 : 13; ?>"><strong>Total</strong></td>
				<? if($show_comment==1) {?>

                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>

                <td>&nbsp;  </td>
                <? } else{ ?>
                <td  style="border:1px solid black;  text-align:right"><?  echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
                <? } ?>
            </tr>
        </table>
        <br/>
       <?
		}
	   ?>
        <!--==============================================AS PER Color & SIZE  END=========================================  -->

         <!--==============================================NO NENSITIBITY START=========================================  -->
		<?
		$nameArray_item=sql_select( "select  pre_cost_fabric_cost_dtls_id,trim_group from wo_booking_dtls  where booking_no='$txt_booking_no' and job_no='".$nameArray_job_po_row[csf('job_no')]."'  and sensitivity=0 and  status_active =1 and is_deleted=0 group by pre_cost_fabric_cost_dtls_id,trim_group order by trim_group ");
		  
		if(count($nameArray_item)>0)
		{
			$po_ids=rtrim($po_no_arr[$nameArray_job_po_row[csf('job_no')]]['po_id']);
			$po_ids=array_unique(explode(",",$po_ids));
			$ref_nos=rtrim($job_ref_no[$nameArray_job_po_row[csf('job_no')]],',');
			$ref_nos=implode(",",array_unique(explode(",",$ref_nos)));
			$file_nos=rtrim($job_file_no[$nameArray_job_po_row[csf('job_no')]],',');
			$file_nos=implode(",",array_unique(explode(",",$file_nos)));
			$po_no_qty=0;
			$job_no=$nameArray_job_po_row[csf('job_no')];
			foreach($po_ids as $poid)
			{
				//echo $poid.', ';
				$po_no_qty+=$job_po_qty_arr[$job_no][$poid];
			}

			//$po_quantity[$result_job[csf('id')]];
			if($show_comment==1) $tdColspan=6; else $tdColspan=3;
        ?>
        <table border="1" align="left" class="rpt_table" cellpadding="0" width="1520" cellspacing="0"  rules="all" >
            <tr>
                <td colspan="7" width="845" style="word-break:break-all; "><strong>NO sensitive  (<? echo "Job NO:".$nameArray_job_po_row[csf('job_no')];?>) <? echo "Style NO:".$style_ref[$nameArray_job_po_row[csf('job_no')]];echo " &nbsp;Int Ref.:&nbsp;".$ref_nos; if($file_nos!='' || $file_nos!=0 ) echo " &nbsp;File No.:&nbsp;".$file_nos;else " "; echo " &nbsp;Po Qty.:&nbsp;".$po_no_qty; ?></strong></td>
                <td width="530" colspan="<?=$tdColspan;?>" style="word-break:break-all; font-weight:bold;">Po No: <? echo implode(", ",$po_no[$nameArray_job_po_row[csf('job_no')]]); ?></td>
            </tr>
            <tr>
                <td width="25" style="border:1px solid black"><strong>Sl</strong> </td>
                <td width="100" style="border:1px solid black"><strong>Internal Ref.</strong> </td>
				<td width="100" style="border:1px solid black"><strong>Image</strong> </td>
				<td width="120" style="border:1px solid black"><strong>Item Group</strong> </td>
                <td width="200" style="border:1px solid black"><strong>Item Description</strong> </td>
                <td width="150" style="border:1px solid black"><strong>Brand/Supplier Ref.</strong> </td>
                <td width="150" style="border:1px solid black"><strong>Item Color</strong> </td>
                <td width="80" align="center" style="border:1px solid black"><strong>Qty per Unit</strong></td>
                <td width="100" align="center" style="border:1px solid black"><strong>Qty</strong></td>
                <td width="80" style="border:1px solid black" align="center"><strong>UOM</strong></td>
				<? if($show_comment==1) {?>
                <td width="80" style="border:1px solid black" align="center"><strong>Rate</strong></td>
                <td width="100" style="border:1px solid black" align="center"><strong>Amount</strong></td>
                <td width="220" style="border:1px solid black" align="center"><strong>Remarks</strong></td>
                 <? } ?>
            </tr>
            <?
			$i=0;
            $grand_total_as_per_gmts_color=0;
            foreach($nameArray_item as $result_item)
            {
				
				$i++;
				$nameArray_item_description=sql_select( "select a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color,avg(b.rate) as rate, sum(b.amount) as amount from wo_booking_dtls a, wo_trim_book_con_dtls b where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.trim_group=".$result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.pre_cost_fabric_cost_dtls_id, b.description, b.brand_supplier,b.item_color");
				?>
				<tr>
					<td style="border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>"><? echo $i; ?></td>
					<td align="center" style="word-break:break-all; border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
						<?		echo $ref_nos;			?>
					</td>
					<td align="center" style="word-break:break-all; border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
							<img  src='../../<? echo $trims_imge_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]]; ?>' height='90px' width='100px' />
							
					</td>
					<td align="center" style="word-break:break-all; border:1px solid black" rowspan="<? echo count($nameArray_item_description)+1; ?>">
						<?
						echo $trim_group_library[$result_item[csf('trim_group')]]."<br/>";
						echo implode(",",$booking_country_arr[$result_item[csf('pre_cost_fabric_cost_dtls_id')]][0]);
						?>
					</td>
					<?
					$color_tatal=0;
					$total_amount_as_per_gmts_color=0;
					foreach($nameArray_item_description as $result_itemdescription)
					{
						$item_desctiption_total=0;
						?>
						<td style="word-break:break-all; border:1px solid black"><? if($result_itemdescription[csf('description')]){ echo $result_itemdescription[csf('description')];} ?> </td>
						<td style="word-break:break-all; border:1px solid black"><? if($result_itemdescription[csf('brand_supplier')]){echo $result_itemdescription[csf('brand_supplier')];} ?> </td>
						<td style="word-break:break-all; border:1px solid black"><? echo $color_library[$result_itemdescription[csf('item_color')]]; ?> </td>
						<td style="word-break:break-all; border:1px solid black; text-align:left">
						<?
						$trims_remark=$trims_remark_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]]['remark'];
						$calUom=$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][2];
						$calQty=explode("_",$trims_qtyPerUnit_arr[$result_itemdescription[csf('pre_cost_fabric_cost_dtls_id')]][1]);
						if($calUom && end($calQty)){
						echo "1".$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]."=".prev($calQty)." ".$calUom;
						?>
						</td>
						<?
					}

					if($db_type==0)
					{
					 $nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id and a.booking_no=b.booking_no  and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and  b.description='". $result_itemdescription[csf('description')]."' and b.brand_supplier='".$result_itemdescription[csf('brand_supplier')]."' and b.item_color='".$result_itemdescription[csf('item_color')]."'");
					}
					if($db_type==2)
					{
						$nameArray_color_size_qnty=sql_select("select sum(b.requirment) as cons from wo_booking_dtls a, wo_trim_book_con_dtls b  where a.id= b.wo_trim_booking_dtls_id  and a.booking_no=b.booking_no and a.booking_no='$txt_booking_no' and a.job_no='".$nameArray_job_po_row[csf('job_no')]."'  and a.sensitivity=0 and  a.status_active =1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.trim_group=". $result_item[csf('trim_group')]." and a.pre_cost_fabric_cost_dtls_id=".$result_item[csf('pre_cost_fabric_cost_dtls_id')]." and nvl( b.description,0)=nvl('". $result_itemdescription[csf('description')]."',0) and nvl(b.brand_supplier,0)=nvl('".$result_itemdescription[csf('brand_supplier')]."',0) and nvl(b.item_color,0)=nvl('".$result_itemdescription[csf('item_color')]."',0)");
					}

					foreach($nameArray_color_size_qnty as $result_color_size_qnty)
					{
						?>
						<td style="word-break:break-all; border:1px solid black; text-align:right">
						<?
						if($result_color_size_qnty[csf('cons')]!= "")
						{
							echo number_format($result_color_size_qnty[csf('cons')],4);
							$item_desctiption_total += $result_color_size_qnty[csf('cons')] ;
							$color_tatal+=$result_color_size_qnty[csf('cons')];
						}
						else echo "";
						?>
						</td>
						<?
					}
					?>
					<td style="word-break:break-all; border:1px solid black; text-align:center "><? echo $unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; $uom_text=$unit_of_measurement[$order_uom_arr[$result_item[csf('trim_group')]]]; ?></td>
					<? if($show_comment==1)
					{
						?>
						<td style="word-break:break-all; border:1px solid black; text-align:right"><? echo number_format($result_itemdescription[csf('rate')],4); ?> </td>
						<td style="word-break:break-all; border:1px solid black; text-align:right">
						<?
							$amount_as_per_gmts_color = $item_desctiption_total*  $result_itemdescription[csf('rate')];echo number_format($amount_as_per_gmts_color,2);
							$total_amount_as_per_gmts_color+=$amount_as_per_gmts_color;
						?>
						</td>
						<td style="word-break:break-all; border:1px solid black; text-align:right"><? echo $trims_remark; ?> </td>
					<? } ?>
				</tr>
				<?
				}
				?>
				<tr>
					<td style="border:1px solid black; text-align:right"></td>
					<td style="border:1px solid black;  text-align:right" colspan="3"><strong> Item Total</strong></td>
					<td style="border:1px solid black;  text-align:right; font-weight:bold;"><? if($color_tatal !='') echo number_format($color_tatal,4); ?></td>
					<td style="border:1px solid black;  text-align:center"><? echo $uom_text; ?></td>
					<? if($show_comment==1)
					{?>
						<td style="border:1px solid black; text-align:right"></td>
						<td style="border:1px solid black; text-align:right">
						<?
						echo number_format($total_amount_as_per_gmts_color,2);
						$grand_total_as_per_gmts_color+=$total_amount_as_per_gmts_color;
						?>
						</td>
						<td>&nbsp;</td>
					<? } ?>
				</tr>
				<?
				}
				?>
				<tr>
					<td align="right" style="border:1px solid black"  colspan="10"><strong>Total</strong></td>
					<? if($show_comment==1) {?>
					<td>&nbsp;</td>
					<td style="border:1px solid black;  text-align:right"><? echo number_format($grand_total_as_per_gmts_color,2); $booking_grand_total+=$grand_total_as_per_gmts_color; ?></td>
					<td>&nbsp;</td>
				</tr>
        <? } ?>
        </table>
        <?
		}
		}
		?>
        <!--==============================================NO NENSITIBITY END=========================================  -->

		

       <?
       $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>

           <table border="1" align="left" class="rpt_table" cellpadding="0" width="1320" cellspacing="0" rules="all">
                <tr style="border:1px solid black;">
                    <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount</td>
                    <td width="70%" style="border:1px solid black; text-align:left"><? echo number_format($booking_grand_total,2);?></td>
                </tr>
                <tr style="border:1px solid black;">
                    <td width="30%" style="border:1px solid black; text-align:left">Total Booking Amount (in word)</td>
                    <td width="70%" style="border:1px solid black;"><? echo number_to_words(def_number_format($booking_grand_total,2,""),$mcurrency, $dcurrency);?></td>
                </tr>
           </table>
         <br/>
        <table width="1320">
            <tr>
                <td width="470" style="word-break:break-all"><? echo get_spacial_instruction($txt_booking_no); ?></td>
                <td width="10">&nbsp;</td>
                <td width="450" valign="top">
                    <table width="440" class="rpt_table" border="1" cellpadding="0" cellspacing="0" rules="all">
                        <tr style="border:1px solid black;">
                            <td colspan="4" style="border:1px solid black;">Approval Status</td>
                        </tr>
                        <tr style="border:1px solid black;">
                            <td width="20" style="border:1px solid black;">Sl</td>
                            <td width="180" style="border:1px solid black;">Name</td>
                            <td width="100" style="border:1px solid black;">Approval Date</td>
                            <td style="border:1px solid black;">Approval No</td>
                        </tr>
                        <?
                        $i;
                        foreach($approved_array as $row){
                            ?>
                            <tr style="border:1px solid black;">
                                <td style="border:1px solid black;"><? echo $i;?></td>
                                <td style="border:1px solid black;"><? echo $row[csf('user_full_name')];?></td>
                                <td style="border:1px solid black;"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); ;?></td>
                                <td style="border:1px solid black;"><? echo $row[csf('approved_no')];?></td>
                            </tr>
                            <?
                            $i++;
                        }
                        ?>
                    </table>
                </td>
            </tr>
        </table>
	  <br>
        <?
        //------------------------------ Query for TNA start-----------------------------------

	//------------------------------ Query for TNA end-----------------------------------
		?>
    <div  style="margin-top:-50px;">
         <?
          echo signature_table(132, $cbo_company_name, "1320px",1);
		 ?>
   </div>
     <!-- <div id="page_break_div"></div> -->
    <div>
		<?
        	//echo signature_table(2, $cbo_company_name, "1330px");
			echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
        ?>
    </div>
	<?
  	$html = ob_get_contents();
	  ob_clean();
	  list($is_mail_send,$mail)=explode('___',$mail_send_data);
	  if($is_mail_send==1){
		  require_once('../../../mailer/class.phpmailer.php');
		  require_once('../../../auto_mail/setting/mail_setting.php');
		  $mailBody = preg_replace("/<img[^>]+\>/i", " ", $html); 
			  
		  $mailToArr=array();
		  $mailSql = "select b.EMAIL  from wo_booking_mst a,LIB_SUPPLIER b where b.id=a.supplier_id and a.booking_no=$txt_booking_no";
		  //echo $mailSql;die;
		  $mailSqlRes=sql_select($mailSql);
		  foreach($mailSqlRes as $rows){
			  if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		  }
		  
		  
		  $mailSql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=97 and b.mail_user_setup_id=c.id  and c.IS_DELETED=0 and c.STATUS_ACTIVE=1";
		  //echo $mailSql;die;
		  $mailSqlRes=sql_select($mailSql);
		  foreach($mailSqlRes as $rows){
			  if($rows[EMAIL]){$mailToArr[]=$rows[EMAIL];}
		  }
		  
		  if($mail!=''){$mailToArr[]=$mail;}
		  $to=implode(',',$mailToArr);
		  $subject="Trims Booking Multy Job";
		  $header=mailHeader();
		  echo sendMailMailer( $to, $subject, $mailBody, $from_mail,$att_file_arr );
		  
	  }
	  else{
		  echo $html;
	  }
	  exit();
  
	
}
?>