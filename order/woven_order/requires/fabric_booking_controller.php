<?
/*-------------------------------------------- Comments
Version                  :  V1
Purpose			         : 	This form will create Woven Garments Fabric Booking
Functionality	         :
JS Functions	         :
Created by		         :	Monzu
Creation date 	         : 	27-12-2012
Requirment Client        :
Requirment By            :
Requirment type          :
Requirment               :
Affected page            :
Affected Code            :
DB Script                :
Updated by 		         :
Update date		         :
QC Performed BY	         :
QC Date			         :
Comments		         : From this version oracle conversion is start
						   Date 08-08-15, Merchandizing >Main Fabric booking > Fabric booking booking GR > Cuff - Color Size Breakdown in Pcs > Contrast color is not showing. Issue id=5749 update by jahid
-----------------------------------------------------*/
header('Content-type:text/html; charset=utf-8');
session_start();
if( $_SESSION['logic_erp']['user_id'] == "" ) header("location:login.php");
include('../../../includes/common.php');
include('../../../includes/class3/class.conditions.php');
include('../../../includes/class3/class.reports.php');
//include('../../../includes/class4/class.fabrics.php');
include('../../../includes/class3/class.yarns.php');
include('../../../includes/class3/class.trims.php');
include('../../../includes/class3/class.conversions.php');

$data=$_REQUEST['data'];
$action=$_REQUEST['action'];
$permission=$_SESSION['page_permission'];
$user_id=$_SESSION['logic_erp']['user_id'];
$buyer_cond=set_user_lavel_filtering(' and buy.id','buyer_id');
$company_cond=set_user_lavel_filtering(' and comp.id','company_id');

$isYarnPurchseValidate=1;//Issue Id --- ISD-20-22313 for Fakir Apparels Ltd.

//---------------------------------------------------- Start---------------------------------------------------------------------------
$color_library=return_library_array( "select id,color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
$size_library=return_library_array( "select id,size_name from lib_size where status_active=1 and is_deleted=0", "id", "size_name");
$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
$marchentrArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info ","id","team_member_name");

//$order_uom_id_arr=return_library_array( "select job_no,order_uom_id from wo_pre_cost_dtls",'job_no','order_uom_id');
//$exchange_rate_arr=return_library_array( "select booking_no,exchange_rate from   wo_booking_mst ",'booking_no','exchange_rate');

if ($action=="load_drop_down_buyer")
{
	echo create_drop_down( "cbo_buyer_name", 130, "select buy.id,buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active=1 and buy.is_deleted=0 $buyer_cond and b.buyer_id=buy.id and b.tag_company='$data' and buy.id in (select  buyer_id from  lib_buyer_party_type where party_type in (1,3,21,90)) order by buyer_name","id,buyer_name", 1, "-- Select Buyer --", $selected, "","1","" );
}

if ($action=="load_drop_down_buyer_popup")
{
	echo create_drop_down( "cbo_buyer_name", 130, "select buy.id,buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active=1 and buy.is_deleted=0 $buyer_cond and b.buyer_id=buy.id and b.tag_company='$data' and buy.id in (select  buyer_id from  lib_buyer_party_type where party_type in (1,3,21,90)) order by buyer_name","id,buyer_name", 1, "-- Select Buyer --", $selected, "","0","" );
}

if ($action=="load_drop_down_suplier")
{
	if($data==5 || $data==3){
	echo create_drop_down( "cbo_supplier_name", 130, "select id,company_name from lib_company where status_active=1 and is_deleted=0 order by company_name", "id,company_name",1, "-- Select Supplier --", "", "validate_suplier()",0,"" );
	}
	else{
	echo create_drop_down( "cbo_supplier_name", 130, "select a.id,a.supplier_name from lib_supplier a, lib_supplier_party_type b where a.id=b.supplier_id and b.party_type=9 and   a.status_active =1 and a.is_deleted=0 order by supplier_name","id,supplier_name", 1, "-- Select Supplier --", $selected, "fill_attention(this.value)",0 );
	}
}
if($action=="get_attention_name")
{
	$data=explode("_",$data);
	$contact_person='';
	if($data[1] !=5){
		$sql=sql_select("select id,contact_person from lib_supplier  where id=$data[0] and  status_active =1 and is_deleted=0");
	}
	if($data[1] ==5){
		$sql=sql_select("select id,contract_person as contact_person from  lib_company  where id=$data[0] and  status_active =1 and is_deleted=0");
	}
	foreach($sql as $row){
		$contact_person=$row[csf('contact_person')];
	}
	if($data[1]==3) //In House
	{
		echo ' ';
	}
	else
	{
		echo $contact_person;
	}

	//die;
}

function load_drop_down_suplier($data){
	$cbo_supplier_name='';
	if($data==5 || $data==3){
	$cbo_supplier_name= create_drop_down( "cbo_supplier_name", 130, "select id,company_name from lib_company where status_active=1 and is_deleted=0 order by company_name", "id,company_name",1, "-- Select Supplier --", "", "validate_suplier()",0,"" );
	}
	else{
	$cbo_supplier_name= create_drop_down( "cbo_supplier_name", 130, "select a.id,a.supplier_name from lib_supplier a, lib_supplier_party_type b where a.id=b.supplier_id and b.party_type=9 and   a.status_active =1 and a.is_deleted=0 order by supplier_name","id,supplier_name", 1, "-- Select Supplier --", $selected, "",0 );
	}
	return $cbo_supplier_name;
}

if($action=="check_conversion_rate")
{
	$data=explode("**",$data);
	if($db_type==0)
	{
		$conversion_date=change_date_format($data[1], "Y-m-d", "-",1);
	}
	else
	{
		$conversion_date=change_date_format($data[1], "d-M-y", "-",1);
	}
	$currency_rate=set_conversion_rate( $data[0], $conversion_date ,$data[2] );
	echo "1"."_".$currency_rate;
	exit();
}

if($action=="check_month_maintain")
{
	//echo $data;
	$sql_result=sql_select("select tna_integrated from variable_order_tracking where company_name='$data' and variable_list=14 and status_active=1 and is_deleted=0");
	$maintain_setting=$sql_result[0][csf('tna_integrated')];

	if($maintain_setting==1) echo "1"."_";
	else echo "0"."_";

	exit();
}

if ($action=="fabric_booking_popup")
{
	echo load_html_head_contents("Booking Search","../../../", 1, 1, $unicode);
	?>
	<script>
		function set_checkvalue()
		{
			if(document.getElementById('chk_job_wo_po').value==0) document.getElementById('chk_job_wo_po').value=1;
			else document.getElementById('chk_job_wo_po').value=0;
		}

		function js_set_value(booking_no)
		{
			document.getElementById('selected_booking').value=booking_no;
			parent.emailwindow.hide();
		}
	</script>
	</head>
	<body>
        <div align="center" style="width:100%;" >
        <form name="searchorderfrm_1"  id="searchorderfrm_1" autocomplete="off">
            <table  cellspacing="0" cellpadding="0" border="1" class="rpt_table" align="center" rules="all">
                <thead>
                    <tr>
                        <th colspan="11">
                        <?
                        // echo create_drop_down( "cbo_search_category", 140, $string_search_type,'', 1, "-- Search Catagory --" );
                        ?>

                        </th>
                    </tr>
                    <tr>
                        <th width="150" class="must_entry_caption">Company Name</th>
                        <th width="150">Buyer Name</th>
                        <th width="80">Booking No</th>
                        <th width="80">Job No</th>
                        <th width="80">File No</th>
                        <th width="80">Internal Ref.</th>
                        <th width="80">Style Ref </th>
                        <th width="80">Order No</th>
                        <th width="140" colspan="2">Date Range</th>
                        <th><input type="checkbox" value="0" onClick="set_checkvalue()" id="chk_job_wo_po">WO without Dtls</th>
                    </tr>
                </thead>
                <tr class="general">
                    <td>
                    <input type="hidden" id="cbo_search_category">
                    <input type="hidden" id="selected_booking">
                    <?
                    echo create_drop_down( "cbo_company_mst", 150, "select id,company_name from lib_company comp where status_active=1 and is_deleted=0 and core_business not in(3) $company_cond order by company_name","id,company_name",1, "-- Select Company --", '', "load_drop_down( 'size_color_breakdown_controller', this.value, 'load_drop_down_buyer', 'buyer_td' );");
                    ?>
                    </td>
                    <td id="buyer_td"><?=create_drop_down( "cbo_buyer_name", 172, $blank_array,"", 1, "-- Select Buyer --" );?></td>
                    <td><input name="txt_booking_prifix" id="txt_booking_prifix" class="text_boxes" style="width:70px"></td>
                    <td><input name="txt_job_prifix" id="txt_job_prifix" class="text_boxes" style="width:70px"></td>
                    <td><input name="txt_file_no" id="txt_file_no" class="text_boxes" style="width:70px"></td>
                    <td><input name="txt_internal_ref" id="txt_internal_ref" class="text_boxes" style="width:70px"></td>
                    <td><input name="txt_style" id="txt_style" class="text_boxes" style="width:70px"></td>
                    <td><input name="txt_order_search" id="txt_order_search" class="text_boxes" style="width:70px"></td>
                    <td><input name="txt_date_from" id="txt_date_from" class="datepicker" style="width:60px"></td>
                    <td><input name="txt_date_to" id="txt_date_to" class="datepicker" style="width:60px"></td>
                    <td align="center">
                    <input type="button" name="button2" class="formbutton" value="Show" onClick="show_list_view ( document.getElementById('cbo_company_mst').value+'_'+document.getElementById('cbo_buyer_name').value+'_'+document.getElementById('txt_date_from').value+'_'+document.getElementById('txt_date_to').value+'_'+document.getElementById('txt_job_prifix').value+'_'+document.getElementById('cbo_year_selection').value+'_'+document.getElementById('txt_booking_prifix').value+'_'+document.getElementById('cbo_search_category').value+'_'+document.getElementById('txt_file_no').value+'_'+document.getElementById('txt_internal_ref').value+'_'+document.getElementById('txt_style').value+'_'+document.getElementById('txt_order_search').value+'_'+document.getElementById('chk_job_wo_po').value, 'create_booking_search_list_view', 'search_div', 'fabric_booking_controller','setFilterGrid(\'list_view\',-1)')" style="width:100px;" /></td>
                </tr>
                <tr>
                    <td colspan="11" align="center" valign="middle"><?=load_month_buttons(1); ?></td>
                </tr>
            </table>
            <div id="search_div"></div>
        </form>
        </div>
	</body>
	<script src="../../../includes/functions_bottom.js" type="text/javascript"></script>
	</html>
	<?
	exit();
}

if ($action=="create_booking_search_list_view")
{
	$data=explode('_',$data);
	if ($data[0]!=0) $company=" and a.company_id='$data[0]'"; else { echo "Please Select Company First."; die; }
	if ($data[1]!=0) $buyer=" and a.buyer_id='$data[1]'"; else $buyer="";
	if($db_type==0) $year_cond=" and SUBSTRING_INDEX(b.insert_date, '-', 1)=$data[5]";
	if($db_type==2) $year_cond=" and to_char(b.insert_date,'YYYY')=$data[5]";
	if($db_type==0) $booking_year_cond=" and SUBSTRING_INDEX(a.insert_date, '-', 1)=$data[5]";
	if($db_type==2) $booking_year_cond=" and to_char(a.insert_date,'YYYY')=$data[5]";
	if($data[7]==1)
	{
		if (str_replace("'","",$data[6])!="") $booking_cond=" and a.booking_no_prefix_num='$data[6]'    "; else  $booking_cond="";
		if (str_replace("'","",$data[4])!="") $job_cond=" and b.job_no_prefix_num='$data[4]'  "; else  $job_cond="";
		if (trim($data[10])!="") $style_cond=" and b.style_ref_no ='$data[10]'"; //else  $style_cond="";
		if (str_replace("'","",$data[11])!="") $order_cond=" and c.po_number = '$data[11]'  "; //else  $order_cond="";
	}
	if($data[7]==2)
	{
		if (str_replace("'","",$data[6])!="") $booking_cond=" and a.booking_no_prefix_num like '$data[6]%'  $booking_year_cond  "; else  $booking_cond="";
		if (str_replace("'","",$data[4])!="") $job_cond=" and b.job_no_prefix_num like '$data[4]%'  $year_cond  "; else  $job_cond="";
		if (trim($data[10])!="") $style_cond=" and b.style_ref_no like '$data[10]%'"; //else  $style_cond="";
		if (str_replace("'","",$data[11])!="") $order_cond=" and c.po_number like '$data[11]%'  "; //else  $order_cond="";
	}

	if($data[7]==3)
	{
		if (str_replace("'","",$data[6])!="") $booking_cond=" and a.booking_no_prefix_num like '%$data[6]'  $booking_year_cond  "; else  $booking_cond="";
		if (str_replace("'","",$data[4])!="") $job_cond=" and b.job_no_prefix_num like '%$data[4]'  $year_cond  "; else  $job_cond="";
		if (trim($data[10])!="") $style_cond=" and b.style_ref_no like'%$data[10]'"; //else  $style_cond="";
		if (str_replace("'","",$data[11])!="") $order_cond=" and c.po_number like '%$data[11]'  "; //else  $order_cond="";
	}
	if($data[7]==4 || $data[7]==0)
	{
		if (str_replace("'","",$data[6])!="") $booking_cond=" and a.booking_no_prefix_num like '%$data[6]%'  $booking_year_cond  "; else  $booking_cond="";
		if (str_replace("'","",$data[4])!="") $job_cond=" and b.job_no_prefix_num like '%$data[4]%'  $year_cond  "; else  $job_cond="";
		if (trim($data[10])!="") $style_cond=" and b.style_ref_no like '%$data[10]%'"; //else  $style_cond="";
		if (str_replace("'","",$data[11])!="") $order_cond=" and c.po_number like '%$data[11]%'  "; //else  $order_cond="";
	}

	$file_no = str_replace("'","",$data[8]);
	$internal_ref = str_replace("'","",$data[9]);
	if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and c.file_no='".trim($file_no)."' ";
	if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and c.grouping='".trim($internal_ref)."' ";

	if($db_type==0){
		if ($data[2]!="" &&  $data[3]!="") $booking_date  = "and a.booking_date  between '".change_date_format($data[2], "yyyy-mm-dd", "-")."' and '".change_date_format($data[3], "yyyy-mm-dd", "-")."'"; else $booking_date ="";
	}
	if($db_type==2){
		if ($data[2]!="" &&  $data[3]!="") $booking_date  = "and a.booking_date  between '".change_date_format($data[2], "yyyy-mm-dd", "-",1)."' and '".change_date_format($data[3], "yyyy-mm-dd", "-",1)."'"; else $booking_date ="";
	}

	$approved=array(0=>"No",1=>"Yes",3=>"Yes");
	$is_ready=array(0=>"No",1=>"Yes",2=>"No");
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer",'id','short_name');
	$comp=return_library_array( "select id, company_short_name from lib_company",'id','company_short_name');
	$suplier=return_library_array( "select id, short_name from lib_supplier",'id','short_name');

	if($data[12]==0)
	{
		$sql= "select a.booking_no,a.pay_mode, a.booking_no_prefix_num, a.booking_date, a.company_id, a.buyer_id, a.item_category, a.fabric_source, a.supplier_id, a.is_approved, a.ready_to_approved, b.job_no_prefix_num, b.style_ref_no, b.gmts_item_id, c.id as po_break_down_id, c.po_number, c.file_no, c.grouping as int_ref_no
			from wo_booking_mst a, wo_booking_dtls p, wo_po_details_master b ,wo_po_break_down c
			where a.job_no=p.job_no and a.booking_no=p.booking_no and a.entry_form=86 and p.po_break_down_id=c.id and b.job_no=c.job_no_mst and a.booking_type=1 and a.is_short=2 and  a.status_active=1 and a.is_deleted=0 and p.status_active=1 and p.is_deleted=0 ". set_user_lavel_filtering(' and a.buyer_id','buyer_id')."  $company $buyer $job_cond $booking_date $booking_cond  $file_no_cond  $internal_ref_cond $style_cond $order_cond order by a.id DESC";
	}
	else if($data[12]==1)
	{
		$sql= "select a.booking_no, a.pay_mode,a.booking_no_prefix_num, a.booking_date, a.company_id, a.buyer_id, a.item_category, a.fabric_source, a.supplier_id, a.is_approved, a.ready_to_approved
			from wo_booking_mst a
			where a.entry_form=86 and a.booking_type=1 and a.is_short=2 and a.status_active=1 and a.is_deleted=0 ". set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $company $buyer  $booking_date $booking_cond and a.id not in(select a.id
			from wo_booking_mst a, wo_booking_dtls p, wo_po_details_master b ,wo_po_break_down c
			where a.job_no=p.job_no and a.booking_no=p.booking_no and p.po_break_down_id=c.id and b.job_no=c.job_no_mst and a.booking_type=1 and a.is_short=2 and  a.status_active=1 and a.is_deleted=0 and p.status_active=1 and p.is_deleted=0 ". set_user_lavel_filtering(' and a.buyer_id','buyer_id')."  $company $buyer $job_cond $booking_date $booking_cond  $file_no_cond  $internal_ref_cond $style_cond $order_cond) order by a.id DESC";
	}

	$sql_result=sql_select($sql);
	$booking_data=array();
	foreach($sql_result as $row)
	{
		$booking_data[$row[csf("booking_no")]]["booking_no"]=$row[csf("booking_no")];
		$booking_data[$row[csf("booking_no")]]["booking_no_prefix_num"]=$row[csf("booking_no_prefix_num")];
		$booking_data[$row[csf("booking_no")]]["booking_date"]=$row[csf("booking_date")];
		$booking_data[$row[csf("booking_no")]]["company_id"]=$row[csf("company_id")];
		$booking_data[$row[csf("booking_no")]]["buyer_id"]=$row[csf("buyer_id")];
		$booking_data[$row[csf("booking_no")]]["item_category"]=$row[csf("item_category")];
		$booking_data[$row[csf("booking_no")]]["pay_mode"]=$row[csf("pay_mode")];

		$booking_data[$row[csf("booking_no")]]["fabric_source"]=$row[csf("fabric_source")];
		$booking_data[$row[csf("booking_no")]]["supplier_id"]=$row[csf("supplier_id")];

		if($row[csf("is_approved")]==3) $is_approved=1; else $is_approved=$row[csf("is_approved")];

		$booking_data[$row[csf("booking_no")]]["is_approved"]=$is_approved;
		$booking_data[$row[csf("booking_no")]]["ready_to_approved"]=$row[csf("ready_to_approved")];
		$booking_data[$row[csf("booking_no")]]["job_no_prefix_num"]=$row[csf("job_no_prefix_num")];
		$booking_data[$row[csf("booking_no")]]["style_ref_no"]=$row[csf("style_ref_no")];
		$booking_data[$row[csf("booking_no")]]["gmts_item_id"]=$row[csf("gmts_item_id")];

		$booking_data[$row[csf("booking_no")]]["po_break_down_id"].=$row[csf("po_break_down_id")].",";
		$booking_data[$row[csf("booking_no")]]["po_number"].=$row[csf("po_number")].",";
		$booking_data[$row[csf("booking_no")]]["file_no"].=$row[csf("file_no")].",";
		$booking_data[$row[csf("booking_no")]]["int_ref_no"].=$row[csf("int_ref_no")].",";
	}

	?>
    <table width="1260" class="rpt_table" border="1" cellpadding="0" cellspacing="0" rules="all">
        <thead>
            <tr>
                <th width="30">Sl</th>
                <th width="50">Booking No</th>
                <th width="60">Booking Date</th>
                <th width="70">Company</th>
                <th width="70">Buyer</th>
                <th width="50">Job No.</th>
                <th width="100">Style Ref.</th>
                <th width="120">Gmts Item</th>
                <th width="120">PO number</th>
                <th width="100">Internal Ref</th>
                <th width="100">File No</th>
                <th width="80">Fabric Nature</th>
                <th width="80">Fabric Source</th>
                <th width="80">Supplier</th>
                <th width="50">Approved</th>
                <th>Is-Ready</th>
            </tr>
        </thead>
    </table>
    <div style="max-height:300px; overflow-y:scroll; width:1260px" >
    <table width="1240" class="rpt_table" id="list_view" border="1" rules="all">
        <tbody>
        <?
		$i=1;
		foreach($booking_data as $row)
		{
			if ($i%2==0)$bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
			?>
        	<tr bgcolor="<? echo $bgcolor; ?>" style="cursor:pointer;" onClick="js_set_value('<? echo $row[("booking_no")]; ?>')">
            	<td width="30" align="center"><? echo $i; ?></td>
                <td width="50" align="center"><p><? echo $row[("booking_no_prefix_num")]; ?>&nbsp;</p></td>
                <td width="60" align="center"><? if($row[("booking_date")]!="" && $row[("booking_date")]!="0000-00-00")  echo change_date_format($row[("booking_date")]);  ?></td>
                <td width="70"><p><? echo $comp[$row[("company_id")]]; ?>&nbsp;</p></td>
                <td width="70"><p><? echo $buyer_arr[$row[("buyer_id")]]; ?>&nbsp;</p></td>
                <td width="50" align="center"><p><? echo $row[("job_no_prefix_num")]; ?>&nbsp;</p></td>
                <td width="100" style="word-break:break-all"><p><? echo $row[("style_ref_no")]; ?>&nbsp;</p></td>
                <td width="120" style="word-break:break-all"><p>
				<?
				$garments_item_arr=explode(",",$row[("gmts_item_id")]);
				$all_garments_item="";
				foreach($garments_item_arr as $item_id)
				{
					$all_garments_item.=$garments_item[$item_id].",";
				}
				echo chop($all_garments_item,",");
				?>&nbsp;</p></td>
                <td width="120" style="word-break:break-all"><p><?  echo implode(",",array_unique(explode(",",chop($row[("po_number")],","))));  ?>&nbsp;</p></td>
                <td width="100"style="word-break:break-all"><p><?  echo implode(",",array_unique(explode(",",chop($row[("int_ref_no")],","))));  ?>&nbsp;</p></td>
                <td width="100" style="word-break:break-all"><p><?  echo implode(",",array_unique(explode(",",chop($row[("file_no")],","))));  ?>&nbsp;</p></td>
                <td width="80"><p><? echo $item_category[$row[("item_category")]]; ?>&nbsp;</p></td>
                <td width="80"><p><? echo $fabric_source[$row[("fabric_source")]]; ?>&nbsp;</p></td>
                <td width="80"><p><?
				if($row[("pay_mode")]==3 || $row[("pay_mode")]==5)
				{
					echo $comp[$row[("supplier_id")]];
				}
				else echo $suplier[$row[("supplier_id")]];; ?>&nbsp;</p></td>
                <td width="50"><p><? echo $approved[$row[("is_approved")]]; ?>&nbsp;</p></td>
                <td><p><? echo $is_ready[$row[("ready_to_approved")]]; ?>&nbsp;</p></td>
            </tr>
            <?
			$i++;
		}
		?>
        </tbody>
    </table>
    </div>
    <?
	exit();
}

if ($action=="populate_data_from_search_popup")
{
     $sql= "select id, booking_no, booking_date, company_id, buyer_id, job_no, po_break_down_id, item_category, fabric_source, currency_id, exchange_rate, pay_mode, booking_month, supplier_id, attention, booking_percent, delivery_date, source, booking_year, colar_excess_percent, cuff_excess_percent, is_approved, ready_to_approved, is_apply_last_update, rmg_process_breakdown, fabric_composition, uom, remarks from wo_booking_mst where booking_no='$data'";
	 //echo $sql; die;
	 $data_array=sql_select($sql);

	 foreach ($data_array as $row)
	 {
		echo "document.getElementById('txt_order_no_id').value = '".$row[csf("po_break_down_id")]."';\n";
		echo "document.getElementById('cbo_company_name').value = '".$row[csf("company_id")]."';\n";
		echo "document.getElementById('cbo_buyer_name').value = '".$row[csf("buyer_id")]."';\n";
		echo "document.getElementById('txt_job_no').value = '".$row[csf("job_no")]."';\n";
		echo "document.getElementById('txt_booking_no').value = '".$row[csf("booking_no")]."';\n";
		echo "document.getElementById('update_id').value = '".$row[csf("id")]."';\n";
		echo "document.getElementById('cbo_fabric_natu').value = '".$row[csf("item_category")]."';\n";
		echo "document.getElementById('cbo_fabric_source').value = '".$row[csf("fabric_source")]."';\n";
		echo "document.getElementById('cbo_currency').value = '".$row[csf("currency_id")]."';\n";
		echo "document.getElementById('txt_exchange_rate').value = '".$row[csf("exchange_rate")]."';\n";
		echo "document.getElementById('cbo_pay_mode').value = '".$row[csf("pay_mode")]."';\n";
		echo "document.getElementById('txt_booking_date').value = '".change_date_format($row[csf("booking_date")],'dd-mm-yyyy','-')."';\n";
		echo "document.getElementById('cbo_booking_month').value = '".$row[csf("booking_month")]."';\n";
		echo "document.getElementById('txt_attention').value = '".$row[csf("attention")]."';\n";
		echo "document.getElementById('txt_booking_percent').value = '".$row[csf("booking_percent")]."';\n";

		//echo "document.getElementById('txt_remark').value = '".$row[csf("remarks")]."';\n";

		echo "document.getElementById('txt_delivery_date').value = '".change_date_format($row[csf("delivery_date")],'dd-mm-yyyy','-')."';\n";

		$tna_integrated=return_field_value("tna_integrated","variable_order_tracking","company_name='".$row[csf("company_id")]."' and variable_list=14 and status_active=1 and is_deleted=0","tna_integrated");
		if($tna_integrated==1 && ($row[csf("pay_mode")]==3 || $row[csf("pay_mode")]==5) )
		{
			echo "$('#txt_delivery_date').attr('disabled',true);\n";
		}
		else
		{
			echo "$('#txt_delivery_date').attr('disabled',false);\n";
		}

	    echo "document.getElementById('cbo_source').value = '".$row[csf("source")]."';\n";
		echo "document.getElementById('cbo_booking_year').value = '".$row[csf("booking_year")]."';\n";
		echo "document.getElementById('txt_colar_excess_percent').value = '".$row[csf("colar_excess_percent")]."';\n";
		echo "document.getElementById('txt_cuff_excess_percent').value = '".$row[csf("cuff_excess_percent")]."';\n";

		if($row[csf("is_approved")]==3) $is_approved=1; else $is_approved=$row[csf("is_approved")];

		echo "document.getElementById('id_approved_id').value = '".$is_approved."';\n";
		echo "document.getElementById('cbo_ready_to_approved').value = '".$row[csf("ready_to_approved")]."';\n";
		echo "document.getElementById('processloss_breck_down').value = '".$row[csf("rmg_process_breakdown")]."';\n";
		echo "document.getElementById('txt_fabriccomposition').value = '".$row[csf("fabric_composition")]."';\n";
		$supplier_dropdwan=load_drop_down_suplier($row[csf("pay_mode")]);
		echo "document.getElementById('sup_td').innerHTML = '".$supplier_dropdwan."';\n";
		echo "document.getElementById('cbo_supplier_name').value = '".$row[csf("supplier_id")]."';\n";
		echo "document.getElementById('cbouom').value = '".$row[csf("uom")]."';\n";


		if($db_type==2) $group_concat_all=" listagg(cast(b.grouping as varchar2(4000)),',') within group (order by b.grouping) as grouping,
	                                    listagg(cast(b.file_no as varchar2(4000)),',') within group (order by b.file_no) as file_no  ";
		else { $group_concat_all="group_concat(b.grouping) as grouping, group_concat(b.file_no) as file_no";}

		$data_array3=sql_select("select a.job_no,a.company_name,a.buyer_name,$group_concat_all from wo_po_details_master a, wo_po_break_down b where b.id in (".$row[csf("po_break_down_id")].") and a.job_no=b.job_no_mst group by a.job_no,a.company_name,a.buyer_name");
		foreach($data_array3 as $inv)
		{
			$grouping=implode(",",array_unique(explode(",",$inv[csf("grouping")])));
			$file_no=implode(",",array_unique(explode(",",$inv[csf("file_no")])));
			echo "document.getElementById('txt_file_no').value = '".$file_no."';\n";
			echo "document.getElementById('txt_intarnal_ref').value = '".$grouping."';\n";
		}
		$approval_cause='';
		$menu_id=$_SESSION['menu_id'];
		$user_id=$_SESSION['logic_erp']['user_id'];
		$sql_request="select MAX(id) as id, approval_cause from fabric_booking_approval_cause where page_id='$menu_id' and entry_form=7 and user_id='$user_id' and booking_id=".$row[csf("id")]." and approval_type=2 and status_active=1 and is_deleted=0 group by approval_cause";


		$nameArray_request=sql_select($sql_request);
		foreach($nameArray_request as $approw)
		{
			$approval_cause=$approw[csf("approval_cause")];
		}

		if($row[csf("is_approved")]==1)
		{
			echo "document.getElementById('app_sms2').innerHTML = 'This booking is approved.';\n";
			echo "document.getElementById('txt_un_appv_request').disabled = '".false."';\n";
			echo "document.getElementById('txt_un_appv_request').value = '".$approval_cause."';\n";
		}
		else if($row[csf("is_approved")]==3)
		{
			echo "document.getElementById('app_sms2').innerHTML = 'This booking is partial approved.';\n";
			echo "document.getElementById('txt_un_appv_request').disabled = '".false."';\n";
			echo "document.getElementById('txt_un_appv_request').value = '".$approval_cause."';\n";
		}
		else
		{
			echo "document.getElementById('app_sms2').innerHTML = '';\n";
			echo "document.getElementById('txt_un_appv_request').disabled = '".true."';\n";
			echo "document.getElementById('txt_un_appv_request').value = '';\n";
		}

		$po_no="";
		$sql_po= "select po_number from  wo_po_break_down  where id in(".$row[csf('po_break_down_id')].")";
		$data_array_po=sql_select($sql_po);
		foreach ($data_array_po as $row_po)
		{
			$po_no.=$row_po[csf('po_number')].",";
		}
		echo "document.getElementById('txt_order_no').value = '".substr($po_no, 0, -1)."';\n";
		$po_m="";
		$sql_m= "select dealing_marchant from   wo_po_details_master  where job_no='".$row[csf("job_no")]."'";
		$data_array_m=sql_select($sql_m);
		foreach ($data_array_m as $row_m)
		{
			$po_m=$row_m[csf('dealing_marchant')];
		}
		if($row[csf("is_apply_last_update")]==2)
		{
			echo "document.getElementById('app_sms3').innerHTML = 'Booking Info not synchronized with order entry and pre-costing. order entry or pre-costing has updated after booking entry.  Contact to ".$marchentrArr[$po_m]."';\n";
		}
		else
		{
			echo "document.getElementById('app_sms3').innerHTML = '';\n";
		}

		$colar_culff_percent=return_field_value("colar_culff_percent", "variable_order_tracking", "company_name='".$row[csf("company_id")]."'  and variable_list=40 and status_active=1 and is_deleted=0");
		if($colar_culff_percent==1)
		{
			echo "$('#txt_colar_excess_percent').removeAttr('disabled')".";\n";
			echo "$('#txt_cuff_excess_percent').removeAttr('disabled')".";\n";
		}
		if($colar_culff_percent==2)
		{
			echo "$('#txt_colar_excess_percent').attr('disabled','true')".";\n";
		    echo "$('#txt_cuff_excess_percent').attr('disabled','true')".";\n";
		}

		$sql_delevary=sql_select("select task_number,max(task_finish_date) as task_finish_date from tna_process_mst where po_number_id in(".$row[csf("po_break_down_id")].") and task_number in(73) and is_deleted = 0 and status_active=1 group by task_number");
		foreach($sql_delevary as $row_delevary)
		{
		   //echo "document.getElementById('txt_delivery_date').value = '".change_date_format($row_delevary[csf("task_finish_date")],'dd-mm-yyyy','-')."';\n";
		   echo "document.getElementById('txt_tna_date').value = '".change_date_format($row_delevary[csf("task_finish_date")],'dd-mm-yyyy','-')."';\n";
		}
	 }
	 exit();
}

if ($action=="order_search_popup")
{
	echo load_html_head_contents("Order Search","../../../", 1, 1, $unicode);
	extract($_REQUEST);
	?>
	<script>
		//var cbo_level='<?// echo $cbo_level; ?>';
		var selected_id = new Array, selected_name = new Array();
		function check_all_data()
		{
			var tbl_row_count = document.getElementById( 'list_view' ).rows.length;
			tbl_row_count = tbl_row_count;
			for( var i = 1; i <= tbl_row_count; i++ )
			{
				js_set_value( i );
			}
		}
		
		function set_all()
		{
			var old=document.getElementById('hidd_oldRow_no').value; 
			//alert(old)
			/*if(old!="")
			{   
				old=old.split(",");
				for(var k=0; k<old.length; k++)
				{   
					//js_set_value( old[k] );*/
					
					$('#list_view tr').each(function(index, element) {
						if( $('#'+this.id).attr('bgcolor')=='yellow' )
						{
							var nid=this.id;//.replace( 'tr_', "");  
							//alert(nid)
							var strval=nid.split("_");
							var str_data=$('#txtindividualid_'+strval[1]).val();
							var str_all=str_data.split("_");
							var str=str_all[0];
							var str_po=str_all[1];
							document.getElementById('job_no').value=str_all[2];
							//alert(nid);
							//var nid=nid.replace( 'tr_', ""); 
							toggle( nid, '#FFFFCC');
							//alert(nid);
							if( jQuery.inArray( str , selected_id ) == -1 )
							{
								selected_id.push( str );
								selected_name.push( str_po );
							}
							else
							{
								for( var i = 0; i < selected_id.length; i++ )
								{
									if( selected_id[i] == str ) break;
								}
				
								selected_id.splice( i, 1 );
								selected_name.splice( i, 1 );
									//alert(selected_id.length)
								if(selected_id.length==0)
								{
									document.getElementById('job_no').value="";
								}
							}
							var id = '' ; var name = '';
							for( var i = 0; i < selected_id.length; i++ )
							{
								id += selected_id[i] + ',';
								name += selected_name[i] + ',';
							}
							id = id.substr( 0, id.length - 1 );
							name = name.substr( 0, name.length - 1 );
							$('#po_number_id').val( id );
							$('#po_number').val( name );
							 
							/*if( jQuery.inArray(  nid , selected_id ) == -1) 
							{
								//selected_id_listed.push( nid );
								
								selected_id.push( str );
								selected_name.push( str_po );
							}
							else
							{
								for( var i = 0; i < selected_id.length; i++ ) {
									if( selected_id[i] == nid  ) break;
								}
								selected_id.splice( i, 1 );
							}*/
						}
					});
/*				} 
			}
*/		}

		function toggle( x, origColor )
		{
			var newColor = 'yellow';
			document.getElementById(x).style.backgroundColor = ( newColor == document.getElementById(x).style.backgroundColor )? origColor : newColor;
		}

		function js_set_value( str_data,tr_id,selectable,sc_lc_check,isYarnAllo )//str_data,tr_id,selectable,sc_lc_check,isYarnAllo
		{
			//var str_data=$('#txtindividualid_'+tr_id).val();
			//alert(tr_id)
			/*var str_all=str_data.split("_");
			var str=str_all[0];
			var str_po=str_all[1];
			var selectable=str_all[3];
			var sc_lc_check=str_all[4];
			var isYarnAllo=str_all[5];*/
			//alert(str_all[6]);
			if(selectable==0){
				alert("Fabric booking TNA date is over of this PO.\nTNA date need to revise to create the Fabric Booking.");
				return;
			}
			if(sc_lc_check==1){
				alert("SC/LC is not found against your selected PO,Please ensure it then try again");
				return;
			}
			if(isYarnAllo==1){
				alert("Yarn Allocation Found Against Your Selected PO.\n Please try again or Contract With MIS.");
				return;
			}
			//var str_all=str_data.split("_");
			var str_all=str_data.split("_");
			var str=str_all[0];
			var str_po=str_all[1];
			//alert(document.getElementById('job_no').value+'='+str_all[2]);
			if ( document.getElementById('job_no').value!="" && document.getElementById('job_no').value!=str_all[2] )
			{
				alert('Job Mixing Not Allowed')
				return;
			}
			
			toggle( tr_id, '#FFFFCC');
			
			document.getElementById('job_no').value=str_all[2];

			if( jQuery.inArray( str , selected_id ) == -1 )
			{
				selected_id.push( str );
				selected_name.push( str_po );
			}
			else
			{
				for( var i = 0; i < selected_id.length; i++ )
				{
					if( selected_id[i] == str ) break;
				}

				selected_id.splice( i, 1 );
				selected_name.splice( i, 1 );
					//alert(selected_id.length)
				if(selected_id.length==0)
				{
					document.getElementById('job_no').value="";
				}
			}
			var id = '' ; var name = '';
			for( var i = 0; i < selected_id.length; i++ )
			{
				id += selected_id[i] + ',';
				name += selected_name[i] + ',';
			}
			id = id.substr( 0, id.length - 1 );
			name = name.substr( 0, name.length - 1 );
			$('#po_number_id').val( id );
			$('#po_number').val( name );
		}
	</script>
	</head>
	<body>
        <div align="center" style="width:100%;" >
			<?
				$booking_month=0;
				if(str_replace("'","",$cbo_booking_month)<10) $booking_month.=str_replace("'","",$cbo_booking_month); else $booking_month=str_replace("'","",$cbo_booking_month);
				$start_date="01"."-".$booking_month."-".str_replace("'","",$cbo_booking_year);
				$end_date=cal_days_in_month(CAL_GREGORIAN, $booking_month, str_replace("'","",$cbo_booking_year))."-".$booking_month."-".str_replace("'","",$cbo_booking_year);
				if($booking_month!=0)
				{
					$start_date=$start_date; $end_date=$end_date;
				}
				else
				{
					$start_date=''; $end_date='';
				}
				
				$exjob=explode("-",$txt_job_no);
				$jobPre=$exjob[2]*1;
				if($jobPre==0) $jobPre="";
            ?>
            <form name="searchpofrm_1" id="searchpofrm_1">
                <table width="950" class="rpt_table" align="center" rules="all">
                    <thead>
                        <tr>
                            <th colspan="10"><?=create_drop_down( "cbo_string_search_type", 200, $string_search_type,'', 1, "-Searching Type-",1); ?></th>
                        </tr>
                        <tr>
                            <th width="140">Company Name</th>
                            <th width="172">Buyer Name</th>
                            <th width="70">Job No</th>
                            <th width="70">Internal Ref</th>
                            <th width="70">File No</th>
                            <th width="80">Style Ref </th>
                            <th width="80">Order No</th>
                            <th width="130" colspan="2">Date Range</th>
                            <th>&nbsp;</th>
                        </tr>
                    </thead>
                    <tr class="general">
                        <td><?=create_drop_down( "cbo_company_mst", 140, "select id,company_name from lib_company comp where status_active=1 and is_deleted=0 and core_business not in(3) $company_cond order by company_name","id,company_name",1, "- Select Company -", str_replace("'","",$cbo_company_name), "load_drop_down( 'fabric_booking_controller', this.value, 'load_drop_down_buyer_popup', 'buyer_td' );"); ?></td>
                        <td id="buyer_td"><?=create_drop_down( "cbo_buyer_name", 172, "select buy.id,buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active=1 and buy.is_deleted=0 $buyer_cond and b.buyer_id=buy.id and b.tag_company=$cbo_company_name and buy.id in (select  buyer_id from  lib_buyer_party_type where party_type in (1,3,21,90)) order by buyer_name","id,buyer_name", 1, "-- Select Buyer --", str_replace("'","",$cbo_buyer_name), "" ); ?></td>
                        <td><input name="txt_job_prifix" id="txt_job_prifix" class="text_boxes" style="width:60px" value="<?=$jobPre; ?>"></td>
                        <td><input name="txt_internal_ref" id="txt_internal_ref" class="text_boxes" style="width:60px"></td>
                        <td><input name="txt_file_no" id="txt_file_no" class="text_boxes" style="width:60px"></td>
                        <td><input name="txt_style" id="txt_style" class="text_boxes" style="width:70px"></td>
                        <td><input name="txt_order_search" id="txt_order_search" class="text_boxes" style="width:70px"></td>
                        <td><input name="txt_date_from" id="txt_date_from" class="datepicker" style="width:60px" value="<?=$start_date; ?>"/></td>
                        <td><input name="txt_date_to" id="txt_date_to" class="datepicker" style="width:60px" value="<?=$end_date; ?>"/></td>
                        <td align="center">
                        <input type="button" name="button2" class="formbutton" value="Show" onClick="show_list_view ( document.getElementById('cbo_company_mst').value+'_'+document.getElementById('cbo_buyer_name').value+'_'+document.getElementById('txt_date_from').value+'_'+document.getElementById('txt_date_to').value+'_'+document.getElementById('txt_job_prifix').value+'_'+document.getElementById('txt_order_search').value+'_'+document.getElementById('txt_style').value+'_'+document.getElementById('cbo_string_search_type').value+'_'+document.getElementById('txt_internal_ref').value+'_'+document.getElementById('txt_file_no').value+'_'+'<?=$txt_booking_no; ?>'+'_'+'<?=$txt_order_no_id; ?>'+'_'+'<?=$txt_job_no; ?>','create_po_search_list_view','search_div','fabric_booking_controller','setFilterGrid(\'list_view\',-1); set_all();');" style="width:70px;" />
                        </td>
                    </tr>
                    <tr>
                        <td align="center" valign="top" colspan="10">
                            <input type="hidden" id="po_number_id" value="<?=$txt_order_no_id; ?>">
                            <input type="hidden" id="job_no" value="<?=$txt_job_no; ?>">
                        </td>
                    </tr>
                    <tr>
                        <td colspan="10" align="center">
                        	<strong>Selected PO Number:</strong> &nbsp;<input type="text" class="text_boxes" readonly style="width:750px" id="po_number" value="<?=$txt_order_no; ?>">
                        </td>
                    </tr>
                    <tr>
                        <td colspan="10" align="center"><input type="button" name="close" onClick="parent.emailwindow.hide();" class="formbutton" value="Close" style="width:100px" /></td>
                    </tr>
                </table>
                <div id="search_div"></div>
            </form>
        </div>
	</body>
	<script src="../../../includes/functions_bottom.js" type="text/javascript"></script>
	</html>
	<?
	exit();
}

if($action=="create_po_search_list_view")
{
	$data=explode('_',$data);
	if ($data[0]!=0) $company=" and a.company_name='$data[0]'"; else { echo "Please Select Company First."; die; }
	if ($data[1]!=0) $buyer=" and a.buyer_name='$data[1]'"; else $buyer=""; //{ echo "Please Select Buyer First."; die; }

	$job_cond=""; $order_cond=""; $style_cond="";
	if($data[7]==1)
	{
		if (str_replace("'","",$data[4])!="") $job_cond=" and a.job_no_prefix_num='$data[4]'"; //else  $job_cond="";
		if (str_replace("'","",$data[5])!="") $order_cond=" and b.po_number = '$data[5]'  "; //else  $order_cond="";
		if (trim($data[6])!="") $style_cond=" and a.style_ref_no ='$data[6]'"; //else  $style_cond="";
	}
	else if($data[7]==2)
	{
		if (str_replace("'","",$data[4])!="") $job_cond=" and a.job_no_prefix_num like '$data[4]%'"; //else  $job_cond="";
		if (str_replace("'","",$data[5])!="") $order_cond=" and b.po_number like '$data[5]%'  "; //else  $order_cond="";
		if (trim($data[6])!="") $style_cond=" and a.style_ref_no like '$data[6]%'  "; //else  $style_cond="";
	}
	else if($data[7]==3)
	{
		if (str_replace("'","",$data[4])!="") $job_cond=" and a.job_no_prefix_num like '%$data[4]'"; //else  $job_cond="";
		if (str_replace("'","",$data[5])!="") $order_cond=" and b.po_number like '%$data[5]'  "; //else  $order_cond="";
		if (trim($data[6])!="") $style_cond=" and a.style_ref_no like '%$data[6]'"; //else  $style_cond="";
	}
	else if($data[7]==4 || $data[7]==0)
	{
		if (str_replace("'","",$data[4])!="") $job_cond=" and a.job_no_prefix_num like '%$data[4]%'"; //else  $job_cond="";
		if (str_replace("'","",$data[5])!="") $order_cond=" and b.po_number like '%$data[5]%'  "; //else  $order_cond="";
		if (trim($data[6])!="") $style_cond=" and a.style_ref_no like '%$data[6]%'"; //else  $style_cond="";
	}

	$internal_ref = str_replace("'","",$data[8]);
	$file_no = str_replace("'","",$data[9]);
	$booking_no = str_replace("'","",$data[10]);
	$existingpoid = str_replace("'","",$data[11]);
	$job_no = str_replace("'","",$data[12]);
	//echo $job_no.'DSSA';
	if ($job_no=="") $job_no_cond=""; else $job_no_cond=" and a.job_no='".trim($job_no)."' ";
	if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and b.file_no='".trim($file_no)."' ";
	if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and b.grouping like '%".trim($internal_ref)."%' ";

	if($db_type==0)
	{
		if ($data[2]!="" &&  $data[3]!="") $shipment_date = "and b.pub_shipment_date between '".change_date_format($data[2], "yyyy-mm-dd", "-")."' and '".change_date_format($data[3], "yyyy-mm-dd", "-")."'"; else $shipment_date ="";
	}
	else if($db_type==2)
	{
		if ($data[2]!="" &&  $data[3]!="") $shipment_date = "and b.pub_shipment_date between '".change_date_format($data[2], "yyyy-mm-dd", "-",1)."' and '".change_date_format($data[3], "yyyy-mm-dd", "-",1)."'"; else $shipment_date ="";
	}

	/*$sql=sql_select("select approval_need,allow_partial from approval_setup_mst a,approval_setup_dtls b where a.id=b.mst_id and a.company_id=$data[0] and b.page_id=25 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.setup_date");
	$app_nessity=2;

	// foreach($sql as $row){
	// 	$app_nessity=$row[csf('approval_need')];
	// }
	// if($app_nessity==1) $appCond=" and c.approved=1"; else $appCond="";
	
	if($sql[0][csf("approval_need")]==1 && $sql[0][csf("allow_partial")]==1){
		$app_nessity="and c.approved in (1,2,3)";
	}else{
		$app_nessity="and c.approved in (1)";
	}*/
$sql=sql_select("select approval_need from approval_setup_mst a,approval_setup_dtls b where a.id=b.mst_id and a.company_id=$data[0] and b.page_id=25 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.setup_date");
	$app_nessity=2;
	foreach($sql as $row){
		$app_nessity=$row[csf('approval_need')];
	}
	if($app_nessity==1){
		$appCond=" and c.approved=1";
	}else{
		$appCond="";
	}
	
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer",'id','short_name');
	$comp=return_library_array( "select id, company_short_name from lib_company",'id','company_short_name');
	$arr=array (1=>$comp,2=>$buyer_arr);
	$sql= "select a.job_no_prefix_num,a.company_name,a.buyer_name,a.style_ref_no,a.job_quantity,b.id, b.po_number,b.grouping,b.file_no,b.po_quantity,b.shipment_date,a.job_no from wo_po_details_master a, wo_po_break_down b, wo_pre_cost_mst c where a.job_no=b.job_no_mst and a.job_no=c.job_no".set_user_lavel_filtering(' and a.buyer_name','buyer_id')." and a.status_active=1 and b.status_active=1 and b.shiping_status not in(3) $job_no_cond  $appCond $shipment_date $company $buyer $job_cond $order_cond $style_cond $file_no_cond $internal_ref_cond order by a.job_no";
	//echo $sql;
	?>
    <table width="940" class="rpt_table" border="1" cellpadding="0" cellspacing="0" rules="all" >
        <thead>
            <tr>
                <th width="30">Sl</th>
                <th width="60">Job No</th>
                <th width="60">Company</th>
                <th width="50">Buyer</th>
                <th width="100">Style Ref.</th>
                <th width="100">Internal Ref.</th>
                <th width="100">File No</th>
                <th width="70">Job Qty</th>
                <th width="150">PO number</th>
                <th width="80">Po Qty</th>
                <th width="">Shipment Date</th>
            </tr>
        </thead>
    </table>
    <div style="max-height:280px; overflow-y:scroll; width:940px">
        <table width="920" class="rpt_table" id="list_view" border="1" rules="all">
        <?
		$sc_lc_variable=2;
		$sc_lc_variable=return_field_value("excut_source", "variable_order_tracking", "company_name=$data[0]  and variable_list=73 and status_active=1 and is_deleted=0");
			//echo $sc_lc_variable;

		$tna_integrated=return_field_value("tna_integrated", "variable_order_tracking", "company_name=$data[0]  and variable_list=14 and status_active=1 and is_deleted=0");
		if($sc_lc_variable==1)
		{
			$sql_sc=sql_select("select b.id,d.wo_po_break_down_id from wo_po_details_master a, wo_po_break_down b, com_sales_contract_order_info d where a.job_no=b.job_no_mst  and b.id= d.wo_po_break_down_id and a.status_active=1 and b.status_active=1  $shipment_date $company $buyer $job_cond $order_cond $style_cond $file_no_cond $internal_ref_cond order by a.job_no");
			$sc_Arr=array();
			foreach($sql_sc as $row){
				$sc_Arr[$row[csf('wo_po_break_down_id')]]=$row[csf('wo_po_break_down_id')];
			}
			unset($sql_sc);
			
			$sql_lc=sql_select("select b.id,d.wo_po_break_down_id from wo_po_details_master a, wo_po_break_down b , com_export_lc_order_info d where a.job_no=b.job_no_mst  and b.id= d.wo_po_break_down_id and a.status_active=1 and b.status_active=1  $shipment_date $company $buyer $job_cond $order_cond $style_cond $file_no_cond $internal_ref_cond order by a.job_no");
			$lc_Arr=array();
			foreach($sql_lc as $row){
				$lc_Arr[$row[csf('wo_po_break_down_id')]]=$row[csf('wo_po_break_down_id')];
			}
			unset($sql_lc);
		}
		
		$sqlt=sql_select("select b.id,a.job_no,d.task_start_date, d.task_finish_date from wo_po_details_master a, wo_po_break_down b, wo_pre_cost_mst c , tna_process_mst d where a.job_no=b.job_no_mst and a.job_no=c.job_no and a.job_no=d.job_no and b.id= d.po_number_id and d.task_number = 31 and a.status_active=1 and b.status_active=1  $shipment_date $company $buyer $job_cond $order_cond $style_cond $file_no_cond $internal_ref_cond order by a.job_no");
		$tnaArr=array();
		foreach($sqlt as $row){
			$tnaArr[$row[csf('id')]]=$row[csf('task_finish_date')];
		}
		unset($sqlt);
		
		$sqltBooking=sql_select("select b.id from  wo_po_details_master a, wo_po_break_down b, wo_booking_dtls c  where a.job_no=b.job_no_mst and a.job_no=c.job_no  and b.id= c.po_break_down_id and b.status_active=1 and c.booking_type=1 and c.status_active=1 and c.booking_no='$booking_no' $shipment_date $company $buyer $job_cond $order_cond $style_cond $file_no_cond $internal_ref_cond order by a.job_no");
		//echo "select b.id from  wo_po_details_master a,wo_po_break_down b, wo_booking_dtls c  where a.job_no=b.job_no_mst and a.job_no=c.job_no  and b.id= c.po_break_down_id and b.status_active=1  $shipment_date $company $buyer $job_cond $order_cond $style_cond $file_no_cond $internal_ref_cond order by a.job_no";
		$BookingArr=array();
		foreach($sqltBooking as $row){
			$BookingArr[$row[csf('id')]]=$row[csf('id')];
		}
		unset($sqltBooking);
		
		//echo $booking_no.'SD';
		$yarnAlloArr=array();
		if($booking_no!="")
		{
			$yarnAllo=sql_select("select po_break_down_id from inv_material_allocation_dtls where booking_no='$booking_no' and status_active=1 and is_deleted=0");
			//echo "select po_break_down_id from inv_material_allocation_dtls where booking_no='$booking_no' and status_active=1 and is_deleted=0";
			foreach($yarnAllo as $yrow){
				$yarnAlloArr[$yrow[csf('po_break_down_id')]]=$yrow[csf('po_break_down_id')];
			}
			unset($yarnAllo);
		}

		$sql= "select a.job_no_prefix_num, a.company_name, a.buyer_name, a.style_ref_no, a.job_quantity, b.id, b.po_number, b.grouping, b.file_no, b.po_quantity, b.shipment_date, a.job_no from wo_po_details_master a, wo_po_break_down b, wo_pre_cost_mst c where a.job_no=b.job_no_mst and a.job_no=c.job_no".set_user_lavel_filtering(' and a.buyer_name','buyer_id')." and b.shiping_status not in(3) and a.status_active=1 and b.status_active=1 $appCond $shipment_date $company $buyer $job_cond $order_cond $style_cond $file_no_cond $internal_ref_cond $job_no_cond  order by a.id DESC";
		//echo $sql;
		$i=1;
		$sqlD=sql_select($sql); $oldpoid=explode(",",$existingpoid); $selectedporow="";
		foreach($sqlD as $row)
		{
			if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
			$selectable=1;
			$tnad=strtotime($tnaArr[$row[csf('id')]]);
			$bod=strtotime(date("d-m-Y"));
			
			if($tnad < $bod && $tna_integrated==1){
				$bgcolor="#F00"; $selectable=0;
			}else{
				$bgcolor=$bgcolor; $selectable=1;
			}
			$sc_lc_check=0;
			if($sc_lc_variable==1)//Fabric Booking Control With SC/LC --Yes
			{
				//$sc_po=$sc_po=0;
				$sc_po=$sc_Arr[$row[csf('id')]];
				$lc_po=$lc_Arr[$row[csf('id')]];
				//echo $sc_po.'='.$lc_po.'<br>';
				
				if($sc_po || $lc_po) {
					$sc_lc_check=0; $msg="";
				}
				else { 
					$sc_lc_check=1; $msg="SC/LC is not found against your selected PO,Please ensure it then try again.";
				}
			}
			
			$isYarnAllo=0;
			if($yarnAlloArr[$row[csf("id")]]!=""){
				$isYarnAllo=1; 
				$bgcolor="yellow"; 
				$font_color="#00CC66";
				$msg="Allocation Found.";
			}
			else {
				$isYarnAllo=0;
				$font_color='';
			}
			
			if($BookingArr[$row[csf('id')]]!="") $bgcolor="yellow";// don't remove 
			
			//print_r($oldpoid);
			
			if(in_array($row[csf("id")],$oldpoid)) 
			{ 
				if($selectedporow=="") $selectedporow=$i; else $selectedporow.=",".$i;
			}
			
			?>
             <tr style="color:<?=$font_color;?>" bgcolor="<?=$bgcolor; ?>" style="cursor:pointer;" id="tr_<?=$i; ?>" onClick="js_set_value('<?=$row[csf("id")]."_".$row[csf("po_number")]."_".$row[csf("job_no")]; ?>',this.id,<?=$selectable; ?>,<?=$sc_lc_check; ?>,<?=$isYarnAllo; ?>);">
                <td width="30"><?=$i; ?>
                	<input type="hidden" name="txtindividualid_<?=$i; ?>" id="txtindividualid_<?=$i; ?>" value="<?=$row[csf("id")]."_".$row[csf("po_number")]."_".$row[csf("job_no")]."_".$selectable."_".$sc_lc_check."_".$isYarnAllo; ?>"/>
                </td>
                <td width="60" style="word-break:break-all"><?=$row[csf("job_no_prefix_num")]; ?></td>
                <td width="60" style="word-break:break-all"><?=$comp[$row[csf("company_name")]]; ?></td>
                <td width="50" style="word-break:break-all"><?=$buyer_arr[$row[csf("buyer_name")]]; ?></td>
                <td width="100" style="word-break:break-all"><?=$row[csf("style_ref_no")]; ?></td>
                <td width="100" style="word-break:break-all"><?=$row[csf("grouping")]; ?></td>
                <td width="100" style="word-break:break-all"><?=$row[csf("file_no")]; ?></td>
                <td width="70" align="right"><?=$row[csf("job_quantity")]; ?></td>
                <td width="150" style="word-break:break-all" title="<?=$msg; ?>"><p><?=$row[csf("po_number")]; ?> </p></td>
                <td width="80" align="right"><?=$row[csf("po_quantity")]; ?></td>
                <td style="word-break:break-all"><?=change_date_format($row[csf("shipment_date")],"dd-mm-yyyy",'-'); ?></td>
            </tr>
            <?
			$i++;
		}
		?>
        <input type="hidden" name="hidd_oldRow_no" id="hidd_oldRow_no" value="<?=$selectedporow; ?>"/>
        </table>
    </div>
    <?
	exit();
}

if ($action=="populate_order_data_from_search_popup")
{

	// $company2=return_field_value("company_id","wo_booking_mst","booking_no ='".$data."' and is_deleted=0 and status_active=1");
	//$print_report_format1=return_field_value("format_id","lib_report_template","template_name ='".$company2."' and module_id=2 and report_id=2 and is_deleted=0 and status_active=1");
	$data_ref=explode("**",$data);

	if($db_type==2) $group_concat_all=" listagg(cast(b.grouping as varchar2(4000)),',') within group (order by b.grouping) as grouping,
	                                    listagg(cast(b.file_no as varchar2(4000)),',') within group (order by b.file_no) as file_no  ";
	else { $group_concat_all="group_concat(b.grouping) as grouping, group_concat(b.file_no) as file_no";}

	$data_array=sql_select("select a.job_no,a.company_name,a.buyer_name,$group_concat_all from wo_po_details_master a, wo_po_break_down b where b.id in (".$data_ref[0].") and a.job_no=b.job_no_mst group by a.job_no,a.company_name,a.buyer_name");
	foreach ($data_array as $row)
	{

		//$print_report_format_ids=return_field_value("format_id","lib_report_template","template_name ='".$row[csf("company_name")]."' and module_id=2 and report_id=1 and is_deleted=0 and status_active=1");
		$grouping=implode(",",array_unique(explode(",",$row[csf("grouping")])));
		$file_no=implode(",",array_unique(explode(",",$row[csf("file_no")])));
		echo "document.getElementById('cbo_company_name').value = '".$row[csf("company_name")]."';\n";
		//echo "document.getElementById('report_ids').value = '".$print_report_format_ids."';\n";
		echo "document.getElementById('cbo_buyer_name').value = '".$row[csf("buyer_name")]."';\n";
		echo "document.getElementById('txt_job_no').value = '".$row[csf("job_no")]."';\n";
		echo "document.getElementById('txt_intarnal_ref').value = '".$grouping."';\n";
		echo "document.getElementById('txt_file_no').value = '".$file_no."';\n";
		$booking_no="";
		$sql= sql_select("select booking_no from wo_booking_mst  where job_no='".$row[csf("job_no")]."' and booking_type=1");
		foreach($sql as $sql_row)
		{
			$booking_no.=$sql_row[csf('booking_no')].", ";
		}

		if($booking_no=="")
		{
			 echo "document.getElementById('app_sms3').innerHTML = '';\n";
		}
		else
		{
			echo "document.getElementById('app_sms3').innerHTML = 'Booking No ".rtrim($booking_no ,", ")." is found against  this Job No';\n";
		}

		$colar_culff_percent=return_field_value("colar_culff_percent", "variable_order_tracking", "company_name='".$row[csf("company_name")]."'  and variable_list=40 and status_active=1 and is_deleted=0");
		if($colar_culff_percent==1)
		{
			echo "$('#txt_colar_excess_percent').removeAttr('disabled')".";\n";
			echo "$('#txt_cuff_excess_percent').removeAttr('disabled')".";\n";
		}
		if($colar_culff_percent==2)
		{
			echo "$('#txt_colar_excess_percent').attr('disabled','true')".";\n";
		    echo "$('#txt_cuff_excess_percent').attr('disabled','true')".";\n";
		}
	}

	$sql_delevary=sql_select("select task_number,max(task_finish_date) as task_finish_date from tna_process_mst where po_number_id in(".$data_ref[0].") and task_number in(73) and is_deleted = 0 and 	status_active=1 group by task_number");
	foreach($sql_delevary as $row_delevary)
	{
	   echo "document.getElementById('txt_delivery_date').value = '".change_date_format($row_delevary[csf("task_finish_date")],'dd-mm-yyyy','-')."';\n";
	   echo "document.getElementById('txt_tna_date').value = '".change_date_format($row_delevary[csf("task_finish_date")],'dd-mm-yyyy','-')."';\n";
	}

	$company_id=$data_array[0][csf("company_name")];
	if($company_id<0) $company_id=0;
	$tna_integrated=return_field_value("tna_integrated","variable_order_tracking","company_name='$company_id' and variable_list=14 and status_active=1 and is_deleted=0","tna_integrated");
	if($tna_integrated==1 && ($data_ref[1]==3 || $data_ref[1]==5) )
	{
		echo "$('#txt_delivery_date').attr('disabled',true);\n";
	}
	else
	{
		echo "$('#txt_delivery_date').attr('disabled',false);\n";
	}
	exit();
}

if ($action=="generate_fabric_booking")
{
	extract($_REQUEST);
	?>
	<table width="1700" class="rpt_table" border="0" rules="all">
        <thead>
            <tr>
                <th width="30">SL</th>
                <th width="100">PO Number</th>
                <th width="120">Gmts Item</th>
                <th width="100">Body Part</th>
                <th width="80">Color Type</th>
                <th width="100">Construction</th>
                <th width="100">Composition</th>
                <th width="50">GSM</th>
                <th width="70">Dia/Width</th>
                <th width="60">Proces Loss</th>
                <th width="50">Item Size</th>
                <th width="120">Col. Sensivity</th>
                <th width="80">Gmts. Color</th>
                <th width="80">Fab. Color</th>
                <th width="60">Gmts. Size</th>
                <th width="70">Gmts. Qty [Plan Cut]</th>
                <th width="80">Fin Fab Qty</th>
                <th width="80">Gray Qty</th>
                <th width="50">Rate</th>
                <th width="80">Amount</th>
                <th width="60">Colar/ Cuff percent</th>
                <th>&nbsp;</th>
            </tr>
        </thead>
	</table>
    <div style=" max-height:200px; overflow-y:scroll; width:1700px"  align="left">
        <table width="1683" class="rpt_table" id="tbl_fabric_booking" border="0" rules="all">
            <tbody>
            <?
            $txt_order_no_id=str_replace("'","",$txt_order_no_id);
            $cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
            $cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
            $cbouom=str_replace("'","",$cbouom);
			$txt_booking_no=str_replace("'","",$txt_booking_no);
			if($txt_booking_no) $bookingCond="and a.booking_no!='$txt_booking_no'";else $bookingCond="";
			//echo $txt_booking_no.'B';
           // $company2=return_field_value("company_name","wo_po_details_master a, wo_po_break_down b","b.id in(".$txt_order_no_id.") and b.job_no_mst=a.job_no  and b.is_deleted=0 and b.status_active=1");
			//$po_number=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number");
			
			//$paln_cut_qnty_array=return_library_array( "select min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".$txt_order_no_id.") and is_deleted=0 and status_active=1 group by color_number_id,size_number_id,item_number_id,po_break_down_id", "id", "plan_cut_qnty");
			
			$job_sql=sql_select("select a.company_name, a.job_no, b.id, b.po_number, min(c.id) as cid, sum(c.plan_cut_qnty) as plan_cut_qnty from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where b.id in(".$txt_order_no_id.") and b.job_no_mst=a.job_no and b.id=c.po_break_down_id and b.job_no_mst=c.job_no_mst and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 group by a.company_name, a.job_no, b.id, b.po_number, c.color_number_id, c.size_number_id, c.item_number_id");
			$company2=0; $po_number=array(); $paln_cut_qnty_array=array(); $popaln_cut_qnty_array=array();
			foreach($job_sql as $jrow)
			{
				$company2=$jrow[csf("company_name")];
				$po_number[$jrow[csf("id")]]=$jrow[csf("po_number")];
				$paln_cut_qnty_array[$jrow[csf("cid")]]=$jrow[csf("plan_cut_qnty")];
				$popaln_cut_qnty_array[$jrow[csf("id")]]+=$jrow[csf("plan_cut_qnty")];
			}
			unset($job_sql);

            $print_report_format_ids2=return_field_value("format_id","lib_report_template","template_name='".$company2."'  and module_id=2 and report_id=1 and is_deleted=0 and status_active=1");
            //echo $print_report_format_ids2;
            $format_ids=explode(",",$print_report_format_ids2);

            if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
            if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
            if ($cbouom!=0) $cbouom_cond="and a.uom='$cbouom'";

            $txt_booking_percent=str_replace("'","",$txt_booking_percent);
			
			$booking_sql=sql_select("select b.id, sum(a.grey_fab_qnty) as grey_fab_qnty, sum(a.fin_fab_qnty) as fin_fab_qnty from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and  a.po_break_down_id in(".$txt_order_no_id.") and a.booking_type=1 and a.status_active=1 and a.is_deleted=0 group by b.id ");
			$finish_fabric_qnty_array=array(); $grey_fabric_qnty_array=array();
			foreach($booking_sql as $brow)
			{
				$finish_fabric_qnty_array[$brow[csf("id")]]=$brow[csf("fin_fab_qnty")];
				$grey_fabric_qnty_array[$brow[csf("id")]]=$brow[csf("grey_fab_qnty")];
			}
			unset($booking_sql);
			
			//echo "select sum(a.grey_fab_qnty) as grey_fab_qnty,b.id from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and  a.po_break_down_id in(".$txt_order_no_id.")  and a.booking_type=1 and a.status_active=1 and a.is_deleted=0 and a.grey_fab_qnty>0 $bookingCond group by b.id";

            $item_ratio_array=return_library_array( "select gmts_item_id,set_item_ratio from wo_po_details_mas_set_details  where job_no =$txt_job_no", "gmts_item_id", "set_item_ratio");

            $nameArray=sql_select("select a.id as pre_cost_fabric_cost_dtls_id, a.job_no, a.item_number_id, a.body_part_id, a.fab_nature_id, a.fabric_source, a.color_type_id, a.gsm_weight, a.construction, a.composition, a.color_size_sensitive, a.costing_per, a.color, a.color_break_down, a.avg_cons, a.rate, b.id, b.po_break_down_id, b.color_size_table_id, b.color_number_id, b.gmts_sizes as size_number_id, b.dia_width, b.item_size, b.cons, b.process_loss_percent, b.requirment, b.pcs
            FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b
            WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and b.po_break_down_id in (".$txt_order_no_id.")  $cbo_fabric_natu $cbo_fabric_source_cond $cbouom_cond and a.status_active=1 and a.is_deleted=0 order by a.id, b.color_size_table_id");
			
			$powiseCostingPerReqQtyArr=array();
			foreach($nameArray as $nrow)
			{
				$req_grey_fab_qty=0; $reqGreyFabQty=0; $costing_per=0;
				if($nrow[csf("costing_per")]==1) $costing_per=12;
				else if($nrow[csf("costing_per")]==2) $costing_per=1;
				else if($nrow[csf("costing_per")]==3) $costing_per=24;
				else if($nrow[csf("costing_per")]==4) $costing_per=36;
				else if($nrow[csf("costing_per")]==5) $costing_per=48;
				else $costing_per=0;
		
				$req_grey_fab_qty =($paln_cut_qnty_array[$nrow[csf("color_size_table_id")]]/$item_ratio_array[$nrow[csf("item_number_id")]])*($nrow[csf("requirment")]/$costing_per);
				
				$powiseCostingPerReqQtyArr[$nrow[csf("pre_cost_fabric_cost_dtls_id")]][$nrow[csf("po_break_down_id")]]['greyreqqty']+=$req_grey_fab_qty;
			}
			
            $count=0; $arr_fab_co_si=array();
            if (count($nameArray)>0 )
            {
                foreach ($nameArray as $result)
                {
                    $constrast_color_arr=array();
                    if($result[csf("color_size_sensitive")]==3)
                    {
                        $constrast_color=explode('__',$result[csf("color_break_down")]);
                        for($i=0;$i<count($constrast_color);$i++)
                        {
                            $constrast_color2=explode('_',$constrast_color[$i]);
                            $constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
                        }
                    }
                    if ($count%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    $bala_fin_fab_qnty=0; $bala_grey_fab_qnty=0; $costing_per_pre=$planQty=$itemRatio=$finReqQty=$greyReqQty=0;
					$pre_cons=$result[csf("avg_cons")];
                    if($result[csf("costing_per")]==1) $costing_per_pre=12;
                    else if($result[csf("costing_per")]==2) $costing_per_pre=1;
                    else if($result[csf("costing_per")]==3) $costing_per_pre=24;
                    else if($result[csf("costing_per")]==4) $costing_per_pre=36;
                    else if($result[csf("costing_per")]==5) $costing_per_pre=48;
					$planQty=$paln_cut_qnty_array[$result[csf("color_size_table_id")]];
					$itemRatio=$item_ratio_array[$result[csf("item_number_id")]];
					
					$finReqQty=($planQty/($costing_per_pre*$itemRatio))*$result[csf("cons")];
					$greyReqQty=($planQty/($costing_per_pre*$itemRatio))*$result[csf("requirment")];

                    $bala_fin_fab_qnty =def_number_format((($finReqQty*$txt_booking_percent)/100),5,"");
                    $bala_grey_fab_qnty =def_number_format((($greyReqQty*$txt_booking_percent)/100),5,"");
					//echo $bala_fin_fab_qnty.'='.$bala_grey_fab_qnty.'='.$finish_fabric_qnty_array[$result[csf("id")]].'='.$grey_fabric_qnty_array[$result[csf("id")]].'<br>';

                    $finBalReqQty=def_number_format($finReqQty-$finish_fabric_qnty_array[$result[csf("id")]],5,"");
                    $greyBalReqQty=def_number_format($greyReqQty-$grey_fabric_qnty_array[$result[csf("id")]],5,"");
					
				//echo $finBalReqQty.'='.$greyBalReqQty.'='.$bala_fin_fab_qnty.'='.$bala_grey_fab_qnty.'='.$finish_fabric_qnty_array[$result[csf("id")]].'='.$grey_fabric_qnty_array[$result[csf("id")]].'<br>';
					$itempoWiseReqQty=0;
			
					$itempoWiseReqQty=def_number_format(($powiseCostingPerReqQtyArr[$result[csf("pre_cost_fabric_cost_dtls_id")]][$result[csf("po_break_down_id")]]['greyreqqty']/($popaln_cut_qnty_array[$result[csf("po_break_down_id")]]/$item_ratio_array[$result[csf("item_number_id")]]))*$costing_per_pre,5,"");
					
                    if($finBalReqQty>0 || $greyBalReqQty>0)
                    {
                        $count++;
                        ?>
                        <tr bgcolor="<?=$bgcolor; ?>" onClick="change_color('tr_<?=$count; ?>','<?=$bgcolor; ?>');" id="tr_<?=$count; ?>">
                            <td width="30"><?=$count;?></td>
                            <td width="100"><?=$po_number[$result[csf("po_break_down_id")]];?><input type="hidden" id="pobreakdownid_<?=$count; ?>" style="width:20px;" value="<?=$result[csf("po_break_down_id")]; ?>"/></td>
                            <td width="120"><?=$garments_item[$result[csf("item_number_id")]];?></td>
                            <td width="100"><?=$body_part[$result[csf("body_part_id")]];?><input type="hidden" id="bodypartid_<?=$count; ?>" style="width:20px;" value="<?=$result[csf("body_part_id")]; ?>"/></td>
                            <td width="80"><?=$color_type[$result[csf("color_type_id")]];?> <input type="hidden" id="colortype_<?=$count; ?>" style="width:20px;" value="<?=$result[csf("color_type_id")]; ?>"/></td>
                            <td width="100"><?=$result[csf("construction")]; ?>
                                <input type="hidden" id="construction_<?=$count; ?>" style="width:20px;" value="<?=$result[csf("construction")]; ?>"/>
                                <input type="hidden" id="precostfabriccostdtlsid_<?=$count; ?>" style="width:20px;" value="<?=$result[csf("pre_cost_fabric_cost_dtls_id")]; ?>"/>
                            </td>
                            <td width="100"><?=$result[csf("composition")]; ?>
                                <input type="hidden" id="composition_<?=$count; ?>" style="width:20px;" value="<?=$result[csf("composition")]; ?>"/>
                                <input type="hidden" id="cotaid_<?=$count; ?>" style="width:20px;" value="<?=$result[csf("color_size_table_id")]; ?>"/>
                                <input type="hidden" id="preconskg_<?=$count; ?>" style="width:20px;" value="<?=$itempoWiseReqQty; ?>"/>
                            </td>
                            <td width="50"><?=$result[csf("gsm_weight")]; ?><input type="hidden" id="gsmweight_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("gsm_weight")]; ?>"/></td>
                            </td>
                            <td width="70"><?=$result[csf("dia_width")]; ?><input type="hidden" id="diawidth_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("dia_width")]; ?>"/></td>
                            <td width="60"><?=$result[csf("process_loss_percent")]; ?><input type="hidden" id="processlosspercent_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("process_loss_percent")]; ?>"/></td>
                            <td width="50" style="word-break:break-all"><?=$result[csf("item_size")];?></td>
                            <td width="120"><?=$size_color_sensitive[$result[csf("color_size_sensitive")]]; ?></td>
                            <td width="80"><? if($result[csf("color_size_sensitive")]!=0) echo $color_library[$result[csf("color_number_id")]]; ?></td>
                            <td width="80"><? $color_id="";
                                if($result[csf("color_size_sensitive")]==3)
                                {
                                    echo $constrast_color_arr[$result[csf("color_number_id")]];
                                    $color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$result[csf('pre_cost_fabric_cost_dtls_id')]." and gmts_color_id=".$result[csf('color_number_id')]."");
                                }
                                else if($result[csf("color_size_sensitive")]==0)
                                {
                                    echo $color_library[$result[csf("color")]];
                                    $color_id=$result[csf("color")];
                                }
                                else
                                {
                                    echo $color_library[$result[csf("color_number_id")]];
                                    $color_id=$result[csf("color_number_id")];
                                }
                                ?>
                                <input type="hidden" id="gmtscolorid_<?=$count; ?>" style="width:20px;" value="<?=$result[csf("color_number_id")]; ?>"/>
                                <input type="hidden" id="colorid_<?=$count; ?>" style="width:20px;" value="<?=$color_id; ?>"/>
                                <input type="hidden" id="pregreyReqQty_<?=$count; ?>" style="width:20px;" value="<?=$pre_cons; ?>"/>
                            </td>
                            <td width="60"><?=$size_library[$result[csf("size_number_id")]]; ?><input type="hidden" id="gmtssizeid_<?=$count; ?>" style="width:20px;" value="<? echo $result[csf("size_number_id")]; ?>"/></td>
                            <td align="right" width="70"><?=$paln_cut_qnty_array[$result[csf("color_size_table_id")]]; ?></td>
                            <td align="right" width="80"><input type="text" id="finscons_<?=$count; ?>" name="finscons_<?=$count; ?>" style=" width:100%; height:100%; border:none; text-align:right; background-color:<? echo $bgcolor; ?>;font-family:verdana; font-size:11px" onChange="validate_value( <? echo $count ;?>,'finish')" value="<?  echo $bala_fin_fab_qnty; ?>" placeholder="<? echo $bala_fin_fab_qnty; $tot_bala_fin_fab_qnty+=$bala_fin_fab_qnty; ?>"/>
                            </td>
                            <td align="right" width="80"><input type="text" id="greycons_<? echo $count; ?>" name="greycons_<? echo $count; ?>" style=" width:100%; height:100%; border:none; text-align:right; background-color:<? echo $bgcolor; ?>;font-family:verdana; font-size:11px" onChange="validate_value( <? echo $count ;?>,'grey')" value="<? echo $bala_grey_fab_qnty;?>" placeholder="<? echo $bala_grey_fab_qnty; $tot_bala_grey_fab_qnty+=$bala_grey_fab_qnty;?>"/>
                            </td>
                            <td align="right" width="50"><input type="text" id="rate_<? echo $count; ?>" style=" width:100%; height:100%; border:none; text-align:right; background-color:<? echo $bgcolor; ?>;font-family:verdana; font-size:11px" onChange="validate_value( <? echo $count ;?>,'rate')"  value="<? echo $result[csf("rate")]; ?>" <? if ($cbo_fabric_source==1){ echo "readonly";} else { echo "";}  ?>/> </td>
                            <td align="right" width="80"> <input type="text" id="amount_<? echo $count; ?>" style=" width:100%; height:100%; border:none; text-align:right; background-color:<? echo $bgcolor; ?>;font-family:verdana; font-size:11px"  value="<? echo def_number_format(($result[csf("rate")]*$bala_grey_fab_qnty),2,''); ?>" readonly/></td>
                            <td align="right" width="60">
                                <?
                                    $colarculfpercentreadonly="";
                                    if($result[csf("body_part_id")]==2 || $result[csf("body_part_id")]==3 || $result[csf("body_part_id")]==40) $colarculfpercentreadonly="";
                                    else $colarculfpercentreadonly="readonly";
                                ?>
                                <input type="text" id="colarculfpercent_<? echo $count; ?>" style=" width:100%; height:100%; border:none; text-align:right; background-color:<? echo $bgcolor; ?>;font-family:verdana; font-size:11px"  value="<? //echo $result[csf("id")]; ?>" <? echo $colarculfpercentreadonly; ?>  onChange="copy_colarculfpercent(<? echo $count; ?>)" /></td>
                            <td align="right"><input type="text" id="updateid_<? echo $count; ?>" style=" width:100%; height:100%; border:none; text-align:right; background-color:<? echo $bgcolor; ?>;font-family:verdana; font-size:11px" value="" readonly/></td>
                        </tr>
                        <?
                    }
                } // if count namearray end
            } // for each name arra
            ?>
            </tbody>
        </table>
    </div>
    <?
	if($count==0)
	{
		$value ="Full Booked";
		$display="";
	}
	else
	{
		$value ="";
		$display="none";
	}
	?>
    <table width="1700" class="rpt_table" border="0" rules="all">
        <tfoot>
            <tr>
            	<td width="50" align="center" colspan="22" id="full_booked" style="font-size:50; font-weight:bold; display:<? $display; ?>"><? echo $value; ?></td>
            </tr>
            <tr>
                <th width="30">&nbsp;</th>
                <th width="100">&nbsp;</th>
                <th width="120">&nbsp;</th>
                <th width="100">&nbsp;</th>
                <th width="80">&nbsp;</th>
                <th width="100">&nbsp;</th>
                <th width="100">&nbsp;</th>
                <th width="50">&nbsp;</th>
                <th width="70">&nbsp;</th>
                <th width="60">&nbsp;</th>
                <th width="50">&nbsp;</th>
                <th width="120">&nbsp;</th>
                <th width="80">&nbsp;</th>
                <th width="80">&nbsp;</th>
                <th width="60">&nbsp;</th>
                <th width="70">&nbsp;</th>
                <th width="80"><? echo number_format($tot_bala_fin_fab_qnty,4);?></th>
                <th width="80"><? echo number_format($tot_bala_grey_fab_qnty,4);?></th>
                <th width="50">&nbsp;</th>
                <th width="80">&nbsp;</th>
                <th width="60">&nbsp;</th>
                <th>&nbsp;</th>
            </tr>
        </tfoot>
    </table>
    <table width="1700" class="rpt_table" border="0" rules="all">
        <tr>
            <td align="center" width="100%" colspan="22" class="button_container">
				<? echo load_submit_buttons( $permission, "fnc_fabric_booking_dtls",0,0,"",2) ;

                foreach($format_ids as $row_id)
                {
					if($row_id==1)
					{
						?>
						<input type="button" value="Fabric Booking GR" onClick="generate_fabric_report_gr('show_fabric_booking_report_gr')" style="width:150px;" name="print_gr" id="print_gr" class="formbutton" />
						<input type="hidden" id="booking_option" name="booking_option" /><input type="hidden" id="booking_option_no" name="booking_option_no" />
						<input type="hidden" id="booking_option_id" name="booking_option_id" />
						<?
					}
					if($row_id==2)
					{
						?>
						<input type="button" value="Print Booking F1" onClick="generate_fabric_report('show_fabric_booking_report')"  style="width:130px;" name="print" id="print" class="formbutton" />
						<?
					}
					if($row_id==3)
					{
						?>
						<input type="button" value="Print Booking F2" onClick="generate_fabric_report('show_fabric_booking_report3')"  style="width:130px;" name="print_booking3" id="print_booking3" class="formbutton" />
						<?
					}
					if($row_id==4)
					{
						?>
						<input type="button" value="Print For Cut F1" onClick="generate_fabric_report('show_fabric_booking_report1')"  style="width:130px;" name="print_booking1" id="print_booking1" class="formbutton" />
						<?
					}
					if($row_id==5)
					{
						?>
						<input type="button" value="Print For Cut F2" onClick="generate_fabric_report('show_fabric_booking_report2')"  style="width:130px;" name="print_booking2" id="print_booking2" class="formbutton" />
						<?
					}
					if($row_id==6)
					{
						?>
						<input type="button" value="Fabric Booking F1" onClick="generate_fabric_report('show_fabric_booking_report4')"  style="width:130px;" name="print_booking4" id="print_booking4" class="formbutton" />
						<?
					}
					if($row_id==7)
					{
						?>
						<input type="button" value="Fabric booking F2" onClick="generate_fabric_report('show_fabric_booking_report5')"  style="width:130px;" name="print_booking5" id="print_booking5" class="formbutton" />
						<?
					}
					if($row_id==28)
					{
						?>
						<input type="button" value="Fabric booking AKH" onClick="generate_fabric_report('show_fabric_booking_report_akh')"  style="width:130px;" name="print_booking_akh" id="print_booking_akh" class="formbutton" />
						<?
					}
					if($row_id==45)
					{
						?>
						<input type="button" value="Fabric booking Urmi" onClick="generate_fabric_report('show_fabric_booking_report_urmi')"  style="width:130px;" name="print_booking_urmi" id="print_booking_urmi" class="formbutton" />
						<?
					}
					if($row_id==53)
					{
						?>
						<input type="button" value="Fabric booking JK" onClick="generate_fabric_report('show_fabric_booking_report_jk')"  style="width:130px;" name="print_booking_jk" id="print_booking_jk" class="formbutton" />
						<?
					}
					if($row_id==73)//for bpkw --issue id ISD-20-20851
					{
						?>
						<input type="button" value="Print B6" onClick="generate_fabric_report('show_fabric_booking_report_b6')"  style="width:70px;" name="print_booking_b6" id="print_booking_b6" class="formbutton" />
						<?
					}
                }
                ?>
            </td>
        </tr>
    </table>
    <?
	exit();
}

if ($action=="show_fabric_booking")
{
	extract($_REQUEST);
	?>
    <table width="2020" class="rpt_table" border="0" rules="all">
        <thead>
            <tr>
                <th width="30">SL</th>
                <th width="120">PO Number</th>
                <th width="140">Gmts Item</th>
                <th width="120">Body Part</th>
                <th width="100">Color Type</th>
                <th width="100">Construction</th>
                <th width="100">Composition</th>
                <th width="50">GSM</th>
                <th width="80">Dia/Width</th>
                <th width="80">Proces Loss</th>
                <th width="50">Item Size</th>
                <th width="150">Col. Sensivity</th>
                <th width="100">Gmts.Color</th>
                <th width="100">Fab.Color</th>
                <th width="100">Gmts. Sizes</th>
                <th width="100">Gmts. Quantity (Plan Cut)</th>
                <th width="100">Fin Fab Qnty</th>
                <th width="100">Gray Qnty</th>
                <th width="50">Rate</th>
                <th width="100">Amount</th>
                <th width="60">Colar/ Cuff percent</th>
                <th></th>
            </tr>
        </thead>
    </table>
    <div style=" max-height:200px; overflow-y:scroll; width:2020px"  align="left">
    <table width="2003" class="rpt_table" id="tbl_fabric_booking" border="0" rules="all">
        <tbody>
	<?
	$company=return_field_value("company_id","wo_booking_mst","booking_no='".str_replace("'","",$txt_booking_no)."' and is_deleted=0 and status_active=1");
	//$po_number=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number");
	$txt_order_no_id=str_replace("'","",$txt_order_no_id);
	$job_sql=sql_select("select a.company_name, a.job_no, b.id, b.po_number, min(c.id) as cid, sum(c.plan_cut_qnty) as plan_cut_qnty from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where b.id in(".$txt_order_no_id.") and b.job_id=a.id and b.id=c.po_break_down_id and b.job_id=c.job_id and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 group by a.company_name, a.job_no, b.id, b.po_number, c.color_number_id, c.size_number_id, c.item_number_id");
	//echo "select a.company_name, a.job_no, b.id, b.po_number, min(c.id) as cid, sum(c.plan_cut_qnty) as plan_cut_qnty from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where b.id in(".$txt_order_no_id.") and b.job_no_mst=a.job_no and b.id=c.po_break_down_id and b.job_no_mst=c.job_no_mst and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 group by a.company_name, a.job_no, b.id, b.po_number, c.color_number_id, c.size_number_id, c.item_number_id";
	$company2=0; $po_number=array(); $paln_cut_qnty_array=array(); $popaln_cut_qnty_array=array();
	foreach($job_sql as $jrow)
	{
		$company2=$jrow[csf("company_name")];
		$po_number[$jrow[csf("id")]]=$jrow[csf("po_number")];
		$paln_cut_qnty_array[$jrow[csf("cid")]]=$jrow[csf("plan_cut_qnty")];
		$popaln_cut_qnty_array[$jrow[csf("id")]]+=$jrow[csf("plan_cut_qnty")];
	}
	unset($job_sql);
	
	$item_ratio_array=return_library_array( "select gmts_item_id, set_item_ratio from wo_po_details_mas_set_details  where job_no =$txt_job_no", "gmts_item_id", "set_item_ratio");

	//$print_report_format_ids=return_field_value("format_id","user_priviledge_report_setting","company_id ='".$company."' and  user_id=$user_id  and module_id=2 and report_id=1  and is_deleted=0 and status_active=1");
	$print_report_format_ids=return_field_value("format_id"," lib_report_template","template_name ='".$company."'  and module_id=2 and report_id=1  and is_deleted=0 and status_active=1");
	//echo "select format_id from lib_report_template where template_name ='".$company."'  and module_id=2 and report_id=1  and is_deleted=0 and status_active=1";
	$format_id=explode(",",$print_report_format_ids);

	$txt_booking_no=str_replace("'","",$txt_booking_no);
	$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
	$cbouom=str_replace("'","",$cbouom);
	$tot_finish_fab_qnty=0;
	$tot_grey_fab_qnty=0;
	if($type==1)
	{
		$txt_order_no_id=str_replace("'","",$txt_order_no_id);
		$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
		$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
		if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
		if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
		if ($cbouom!=0) $cbouom_cond="and a.uom='$cbouom'";
		
		$booking_dtls_sql="SELECT a.id as booking_dtls_id, b.id, a.fabric_color_id, a.fin_fab_qnty, a.grey_fab_qnty, a.amount, a.rate, a.colar_cuff_per from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_pre_cost_fabric_cost_dtls c where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id in(".$txt_order_no_id.") and a.booking_no='$txt_booking_no' and a.booking_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
		$booking_dtls_res=sql_select($booking_dtls_sql);
		$booking_dtls_id_array=array(); $fabric_color_array=array(); $finish_fabric_qnty_array=array(); $grey_fabric_qnty_array=array(); $grey_fabric_amount_array=array(); $grey_fabric_rate_array=array(); $colar_cuff_percent_array=array();

		foreach($booking_dtls_res as $row)
		{
			$booking_dtls_id_array[$row[csf("id")]]=$row[csf("booking_dtls_id")];
			//$job_no=$row[csf("job_no")];
			$fabric_color_array[$row[csf("id")]]=$row[csf("fabric_color_id")];
			$finish_fabric_qnty_array[$row[csf("id")]]+=$row[csf("fin_fab_qnty")];
			$grey_fabric_qnty_array[$row[csf("id")]]+=$row[csf("grey_fab_qnty")];
			$grey_fabric_amount_array[$row[csf("id")]]=$row[csf("amount")];
			$grey_fabric_rate_array[$row[csf("id")]]['rate']=$row[csf("rate")];
			$colar_cuff_percent_array[$row[csf("id")]]['colar_cuff_per']=$row[csf("colar_cuff_per")];
		}
		unset($booking_dtls_res);
	
		//$paln_cut_qnty_array=return_library_array( "select min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".$txt_order_no_id.") and is_deleted=0 and status_active=1 group by color_mst_id,size_mst_id,item_mst_id,po_break_down_id", "id", "plan_cut_qnty");
		//$paln_cut_qnty_array=return_library_array( "select min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".$txt_order_no_id.") and is_deleted=0 and status_active=1 group by color_number_id,size_number_id,item_number_id,po_break_down_id", "id", "plan_cut_qnty");
	
		//$booking_dtls_id_array=return_library_array( "select a.id as booking_dtls_id,b.id from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and  a.po_break_down_id in(".$txt_order_no_id.") and a.booking_no='$txt_booking_no' and a.booking_type=1 and a.status_active=1 and a.is_deleted=0", "id", "booking_dtls_id");
	
		//$fabric_color_array=return_library_array( "select a.id as booking_dtls_id,a.fabric_color_id,b.id from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and  a.po_break_down_id in(".$txt_order_no_id.") and a.booking_no='$txt_booking_no' and a.booking_type=1 and a.status_active=1 and a.is_deleted=0", "id", "fabric_color_id");
	
		//$finish_fabric_qnty_array=return_library_array( "select sum(a.fin_fab_qnty) as fin_fab_qnty,b.id from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and  a.po_break_down_id in(".$txt_order_no_id.") and a.booking_no='$txt_booking_no' and a.booking_type=1 and a.status_active=1 and a.is_deleted=0 group by b.id", "id", "fin_fab_qnty");
	
		//$grey_fabric_qnty_array=return_library_array( "select sum(a.grey_fab_qnty) as grey_fab_qnty,b.id from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and  a.po_break_down_id in(".$txt_order_no_id.") and a.booking_no='$txt_booking_no' and a.booking_type=1 and a.status_active=1 and a.is_deleted=0 group by b.id", "id", "grey_fab_qnty");
	
		//$grey_fabric_amount_array=return_library_array( "select a.id as booking_dtls_id,a.amount,b.id from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and  a.po_break_down_id in(".$txt_order_no_id.") and a.booking_no='$txt_booking_no' and a.booking_type=1 and a.status_active=1 and a.is_deleted=0", "id", "amount");
	
		//$grey_fabric_rate_array=return_library_array( "select a.id as booking_dtls_id,a.rate,b.id from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and  a.po_break_down_id in(".$txt_order_no_id.") and a.booking_no='$txt_booking_no' and a.booking_type=1 and a.status_active=1 and a.is_deleted=0", "id", "rate");
		
		
	
		//$colar_cuff_percent_array=return_library_array( "select a.id as booking_dtls_id,a.colar_cuff_per,b.id from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and  a.po_break_down_id in(".$txt_order_no_id.") and a.booking_no='$txt_booking_no' and a.booking_type=1 and a.status_active=1 and a.is_deleted=0", "id", "colar_cuff_per");
	
		$name_sql="select a.id as pre_cost_fabric_cost_dtls_id, a.job_no, a.item_number_id, a.body_part_id, a.fab_nature_id, a.fabric_source, a.color_type_id, a.gsm_weight, a.construction, a.composition, a.color_size_sensitive, a.costing_per, a.color, a.color_break_down, a.avg_cons, a.rate, b.id, b.po_break_down_id, b.color_size_table_id, b.color_number_id, b.gmts_sizes as size_number_id, b.dia_width, b.item_size, b.cons, b.process_loss_percent, b.requirment, b.pcs FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and b.po_break_down_id in (".$txt_order_no_id.")  $cbo_fabric_natu $cbo_fabric_source_cond $cbouom_cond and a.status_active=1 and a.is_deleted=0 order by a.id,b.color_size_table_id";
		//echo $name_sql;
	
		$nameArray=sql_select($name_sql);
		
		$powiseCostingPerReqQtyArr=array();
		foreach($nameArray as $nrow)
		{
			$req_grey_fab_qty=0; $costing_per=0;
			if($nrow[csf("costing_per")]==1) $costing_per=12;
			else if($nrow[csf("costing_per")]==2) $costing_per=1;
			else if($nrow[csf("costing_per")]==3) $costing_per=24;
			else if($nrow[csf("costing_per")]==4) $costing_per=36;
			else if($nrow[csf("costing_per")]==5) $costing_per=48;
			else $costing_per=0;
	
			$req_grey_fab_qty =($paln_cut_qnty_array[$nrow[csf("color_size_table_id")]]/$item_ratio_array[$nrow[csf("item_number_id")]])*($nrow[csf("requirment")]/$costing_per);
			//echo $paln_cut_qnty_array[$nrow[csf("color_size_table_id")]].'=='.$item_ratio_array[$nrow[csf("item_number_id")]].'=='.$nrow[csf("requirment")].'=='.$req_grey_fab_qty.'<br>';
			
			$powiseCostingPerReqQtyArr[$nrow[csf("pre_cost_fabric_cost_dtls_id")]][$nrow[csf("po_break_down_id")]]['greyreqqty']+=$req_grey_fab_qty;
		}
		//print_r($powiseCostingPerReqQtyArr);
        
        $count=0;
		if (count($nameArray)>0 )
        {
			foreach ($nameArray as $result)
			{
                $constrast_color_arr=array();
                if($result[csf("color_size_sensitive")]==3)
                {
                    $constrast_color=explode('__',$result[csf("color_break_down")]);
                    for($i=0;$i<count($constrast_color);$i++)
                    {
                        $constrast_color2=explode('_',$constrast_color[$i]);
                        $constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
                    }
                }
				$pre_cons=$result[csf("avg_cons")];
				
				$costing_per=0;
				if($result[csf("costing_per")]==1) $costing_per=12;
				else if($result[csf("costing_per")]==2) $costing_per=1;
				else if($result[csf("costing_per")]==3) $costing_per=24;
				else if($result[csf("costing_per")]==4) $costing_per=36;
				else if($result[csf("costing_per")]==5) $costing_per=48;
				else $costing_per=0;
				
			    if ($count%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				
				$itempoWiseReqQty=0;
			
				$itempoWiseReqQty=def_number_format(($powiseCostingPerReqQtyArr[$result[csf("pre_cost_fabric_cost_dtls_id")]][$result[csf("po_break_down_id")]]['greyreqqty']/($popaln_cut_qnty_array[$result[csf("po_break_down_id")]]/$item_ratio_array[$result[csf("item_number_id")]]))*$costing_per,5,"");
				//echo $powiseCostingPerReqQtyArr[$result[csf("pre_cost_fabric_cost_dtls_id")]][$result[csf("po_break_down_id")]]['greyreqqty'].'=='.$popaln_cut_qnty_array[$result[csf("po_break_down_id")]].'=='.$item_ratio_array[$result[csf("item_number_id")]].'=='.$costing_per.'<br>';

				if($finish_fabric_qnty_array[$result[csf("id")]]>0  || $grey_fabric_qnty_array[$result[csf("id")]]> 0  )
				{
					$count++;
					?>
                	<tr bgcolor="<?=$bgcolor; ?>" onClick="change_color('tr_<?=$count; ?>','<?=$bgcolor;?>');" id="tr_<?=$count; ?>">
                        <td width="30" onClick="select_id_for_delete_item(<? echo $count; ?>)"> <? echo $count;   ?></td>
                        <td width="120"><? echo $po_number[$result[csf("po_break_down_id")]];?> <input type="hidden" id="pobreakdownid_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("po_break_down_id")]; ?>"/></td>
                        <td width="140"><? echo $garments_item[$result[csf("item_number_id")]];?></td>
                        <td width="120">
						<? echo $body_part[$result[csf("body_part_id")]];?>
                        <input  type="hidden" id="bodypartid_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("body_part_id")]; ?>"/>
                        </td>
                        <td width="100"><? echo $color_type[$result[csf("color_type_id")]];?> <input type="hidden" id="colortype_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("color_type_id")]; ?>"/></td>
                        <td width="100"><? echo $result[csf("construction")]; ?>
                        <input type="hidden" id="construction_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("construction")]; ?>"/>
                        <input type="hidden" id="precostfabriccostdtlsid_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("pre_cost_fabric_cost_dtls_id")]; ?>"/></td>
                        <td width="100"><?=$result[csf("composition")]; ?>
                        <input type="hidden" id="composition_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("composition")]; ?>"/>
                        <input type="hidden" id="cotaid_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("color_size_table_id")]; ?>"/>
                        <input type="hidden" id="preconskg_<? echo $count; ?>" style="width:20px;" value="<?=$itempoWiseReqQty; ?>"/>
                        </td>
                        <td width="50"><?=$result[csf("gsm_weight")]; ?> <input type="hidden" id="gsmweight_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("gsm_weight")]; ?>"/></td>
                        <td width="80"><?=$result[csf("dia_width")]; ?><input type="hidden" id="diawidth_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("dia_width")]; ?>"/></td>
                         <td width="80"><?=$result[csf("process_loss_percent")]; ?> <input type="hidden" id="processlosspercent_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("process_loss_percent")]; ?>"/></td>
                        <td width="50"><?=$result[csf("item_size")];?></td>
                        <td width="150"><?=$size_color_sensitive[$result[csf("color_size_sensitive")]];  ?></td>
                        <td width="100">
						<?
						if($result[csf("color_size_sensitive")]!=0)
						{
						echo $color_library[$result[csf("color_number_id")]];
						//echo $result[csf("color_number_id")];
						}
						?>
                        </td>
                        <td width="100">
						<?
						$color_id="";
						if($type==1)
						{
							echo $color_library[$fabric_color_array[$result[csf("id")]]];
							$color_id=$fabric_color_array[$result[csf("id")]];
						}
						else if($type==2)
						{
							if($result[csf("color_size_sensitive")]==3)
							{
								//print_r($constrast_color_arr);
							echo $constrast_color_arr[$result[csf("color_number_id")]];
							$color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$result['job_no']."' and pre_cost_fabric_cost_dtls_id=".$result['pre_cost_fabric_cost_dtls_id']." and gmts_color_id=".$result['color_number_id']."");
							}
							else if($result[csf("color_size_sensitive")]==0)
							{
							echo $color_library[$result[csf("color")]];
							$color_id=$result[csf("color")];
							}
							else
							{
							echo $color_library[$result[csf("color_number_id")]];
							$color_id=$result[csf("color_number_id")];
							}
						}
						?>
                        <input type="hidden" id="gmtscolorid_<?=$count; ?>" style="width:20px;" value="<?=$result[csf("color_number_id")]; ?>"/>
                        <input type="hidden" id="colorid_<?=$count; ?>" style="width:20px;" value="<?=$color_id; ?>"/>
                        <input type="hidden" id="pregreyReqQty_<?=$count; ?>" style="width:20px;" value="<?=$pre_cons; ?>"/>
                        </td>
                        <td width="100">
						<? echo $size_library[$result[csf("size_number_id")]]; ?>
                         <input  type="hidden" id="gmtssizeid_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("size_number_id")]; ?>"/>
                        </td>
                        <td align="right" width="100"> <? echo $paln_cut_qnty_array[$result[csf("color_size_table_id")]]; ?></td>
                        <td align="right" width="100">
                        <input type="text" title="<? echo $result[csf("cons")]; ?>"   id="finscons_<? echo $count; ?>" name="finscons_<? echo $count; ?>" style=" width:100%; height:100%; border:none; text-align:right; background-color:<? echo $bgcolor; ?>;font-family:verdana; font-size:11px"  onChange="validate_value( <? echo $count ;?>,'finish')" value="<?  echo $finish_fabric_qnty_array[$result[csf("id")]]; $tot_finish_fab_qnty+=$finish_fabric_qnty_array[$result[csf("id")]];  ?>" placeholder="<? // echo def_number_format($result[csf("fin_fab_qnty")]-$result[csf("efin_fab_qnty")],2,'');?>"/>
                        </td>
                        <td align="right" width="100">
                        <input type="text" id="greycons_<?=$count; ?>" name="greycons_<?=$count; ?>" style=" width:100%; height:100%; border:none; text-align:right; background-color:<?=$bgcolor; ?>;font-family:verdana; font-size:11px"  onChange="validate_value( <?=$count;?>,'grey');" value="<?=$grey_fabric_qnty_array[$result[csf("id")]]; $tot_grey_fab_qnty+=$grey_fabric_qnty_array[$result[csf("id")]];?>" placeholder="<? //=def_number_format($result[csf("grey_fab_qnty")],2,'');?>"/>
                        </td>
                        <td align="right" width="50"><input type="text" id="rate_<? echo $count; ?>" style=" width:100%; height:100%; border:none; text-align:right; background-color:<? echo $bgcolor; ?>;font-family:verdana; font-size:11px" onChange="validate_value( <? echo $count ;?>,'rate')"  value="<? echo $grey_fabric_rate_array[$result[csf("id")]]['rate']; ?>" <? if ($cbo_fabric_source==1){ echo "readonly";} else { echo "";}  ?>/></td>
                        <td align="right" width="100"> <input type="text" id="amount_<? echo $count; ?>" style=" width:100%; height:100%; border:none; text-align:right; background-color:<? echo $bgcolor; ?>;font-family:verdana; font-size:11px"  value="<? echo $grey_fabric_amount_array[$result[csf("id")]]; $tot_grey_fab_amount+=$grey_fabric_amount_array[$result[csf("id")]]; ?>" readonly/></td>
                        <?
						$colarculfpercentreadonly=""; 
						if($result[csf("body_part_id")]==2 || $result[csf("body_part_id")]==3 || $result[csf("body_part_id")]==40) $colarculfpercentreadonly="";
						else $colarculfpercentreadonly="readonly";
						?>
                        <td align="right" width="60"><input type="text" id="colarculfpercent_<?=$count; ?>" style=" width:100%; height:100%; border:none; text-align:right; background-color:<?=$bgcolor; ?>;font-family:verdana; font-size:11px" value="<?=$colar_cuff_percent_array[$result[csf("id")]]['colar_cuff_per']; ?>" <?=$colarculfpercentreadonly; ?> onChange="copy_colarculfpercent(<?=$count; ?>);" /> </td>
                        <td align="right"><input type="text" id="updateid_<?=$count; ?>" style="width:100%; height:100%; border:none; text-align:right; background-color:<?=$bgcolor; ?>;font-family:verdana; font-size:11px" value="<?=$booking_dtls_id_array [$result[csf("id")]]; ?>" readonly disabled /></td>
                    </tr>
                <?
			}
		} // if count namearray end
	} // for each name arra
	}
	if($type==2)
	{
		$con = connect();
		if($db_type==0)
		{
			mysql_query("BEGIN");
		}
		execute_query( "update wo_booking_mst set is_apply_last_update=1  where  booking_no ='".$txt_booking_no."' and status_active=1 and is_deleted=0",0);
	
		$rID= execute_query( "update wo_booking_dtls set fin_fab_qnty=0, grey_fab_qnty=0 where  booking_no ='".$txt_booking_no."' and status_active=1 and is_deleted=0",0);
		if($db_type==0)
		{
			if($rID){
			mysql_query("COMMIT");
			}
			else{
			mysql_query("ROLLBACK");
			}
		}
		else if($db_type==2 || $db_type==1 )
		{
			if($rID){
			oci_commit($con);
			}
			else{
			oci_rollback($con);
			}
		}
	
		$txt_order_no_id=str_replace("'","",$txt_order_no_id);
		$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
		$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
		$cbouom=str_replace("'","",$cbouom);
	
		if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
		if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
		if ($cbouom!=0) $cbouom_cond="and a.uom='$cbouom'";
		$txt_booking_percent=str_replace("'","",$txt_booking_percent);
		
		$booking_dtls_sql="SELECT a.id as booking_dtls_id, b.id, a.fabric_color_id, a.fin_fab_qnty, a.grey_fab_qnty, a.amount, a.rate, a.colar_cuff_per from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_pre_cost_fabric_cost_dtls c where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id in(".$txt_order_no_id.") and a.booking_no='$txt_booking_no' and a.booking_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
		$booking_dtls_res=sql_select($booking_dtls_sql);
		$booking_dtls_id_array=array(); $fabric_color_array=array(); $finish_fabric_qnty_array=array(); $grey_fabric_qnty_array=array(); $grey_fabric_amount_array=array(); $grey_fabric_rate_array=array(); $colar_cuff_percent_array=array();

		foreach($booking_dtls_res as $row)
		{
			$booking_dtls_id_array[$row[csf("id")]]=$row[csf("booking_dtls_id")];
			//$job_no=$row[csf("job_no")];
			$fabric_color_array[$row[csf("id")]]=$row[csf("fabric_color_id")];
			$finish_fabric_qnty_array[$row[csf("id")]]+=$row[csf("fin_fab_qnty")];
			$grey_fabric_qnty_array[$row[csf("id")]]+=$row[csf("grey_fab_qnty")];
			$grey_fabric_amount_array[$row[csf("id")]]=$row[csf("amount")];
			$grey_fabric_rate_array[$row[csf("id")]]['rate']=$row[csf("rate")];
			$colar_cuff_percent_array[$row[csf("id")]]['colar_cuff_per']=$row[csf("colar_cuff_per")];
		}
		unset($booking_dtls_res);
	
		$nameArray=sql_select("select a.id as pre_cost_fabric_cost_dtls_id, a.job_no, a.item_number_id, a.body_part_id, a.fab_nature_id, a.fabric_source, a.color_type_id, a.gsm_weight, a.construction, a.composition, a.color_size_sensitive, a.costing_per,a.avg_cons, a.color, a.color_break_down, a.rate, b.id, b.po_break_down_id, b.color_size_table_id, b.color_number_id, b.gmts_sizes as size_number_id, b.dia_width, b.item_size, b.cons, b.process_loss_percent, b.requirment, b.pcs FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and b.po_break_down_id in (".$txt_order_no_id.")  $cbo_fabric_natu $cbo_fabric_source_cond $cbouom_cond and a.status_active=1 and a.is_deleted=0 order by a.id,b.color_size_table_id");
		
		$powiseCostingPerReqQtyArr=array();
		foreach($nameArray as $nrow)
		{
			$req_grey_fab_qty=0; $costing_per=0;
			if($nrow[csf("costing_per")]==1) $costing_per=12;
			else if($nrow[csf("costing_per")]==2) $costing_per=1;
			else if($nrow[csf("costing_per")]==3) $costing_per=24;
			else if($nrow[csf("costing_per")]==4) $costing_per=36;
			else if($nrow[csf("costing_per")]==5) $costing_per=48;
			else $costing_per=0;
	
			$req_grey_fab_qty =($paln_cut_qnty_array[$nrow[csf("color_size_table_id")]]/$item_ratio_array[$nrow[csf("item_number_id")]])*($nrow[csf("requirment")]/$costing_per);
			//echo $paln_cut_qnty_array[$nrow[csf("color_size_table_id")]].'=='.$item_ratio_array[$nrow[csf("item_number_id")]].'=='.$nrow[csf("requirment")].'=='.$req_grey_fab_qty.'<br>';
			
			$powiseCostingPerReqQtyArr[$nrow[csf("pre_cost_fabric_cost_dtls_id")]][$nrow[csf("po_break_down_id")]]['greyreqqty']+=$req_grey_fab_qty;
		}
		$count=0;
		foreach ($nameArray as $result)
		{
			if (count($nameArray)>0 )
			{
				$constrast_color_arr=array();
				if($result[csf("color_size_sensitive")]==3)
				{
					$constrast_color=explode('__',$result[csf("color_break_down")]);
					for($i=0;$i<count($constrast_color);$i++)
					{
						$constrast_color2=explode('_',$constrast_color[$i]);
						$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
					}
				}
				
				$bala_fin_fab_qnty=0; $bala_grey_fab_qnty=0; $costing_per_pre=$planQty=$itemRatio=$finReqQty=$greyReqQty=0;
			
				if($result[csf("costing_per")]==1) $costing_per_pre=12;
				else if($result[csf("costing_per")]==2) $costing_per_pre=1;
				else if($result[csf("costing_per")]==3) $costing_per_pre=24;
				else if($result[csf("costing_per")]==4) $costing_per_pre=36;
				else if($result[csf("costing_per")]==5) $costing_per_pre=48;
				$planQty=$paln_cut_qnty_array[$result[csf("color_size_table_id")]];
				$itemRatio=$item_ratio_array[$result[csf("item_number_id")]];
				
				$finReqQty=($planQty/($costing_per_pre*$itemRatio))*$result[csf("cons")];
				$greyReqQty=($planQty/($costing_per_pre*$itemRatio))*$result[csf("requirment")];
	
				$bala_fin_fab_qnty =def_number_format((($finReqQty*$txt_booking_percent)/100),5,"");
				$bala_grey_fab_qnty =def_number_format((($greyReqQty*$txt_booking_percent)/100),5,"");
				//echo $bala_fin_fab_qnty.'='.$bala_grey_fab_qnty.'='.$finish_fabric_qnty_array[$result[csf("id")]].'='.$grey_fabric_qnty_array[$result[csf("id")]].'<br>';
	
				$finBalReqQty=def_number_format($finReqQty-$finish_fabric_qnty_array[$result[csf("id")]],5,"");
				$greyBalReqQty=def_number_format($greyReqQty-$grey_fabric_qnty_array[$result[csf("id")]],5,"");
				$pre_cons=$result[csf("avg_cons")];
				if ($count%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				
				$itempoWiseReqQty=0;
			
				$itempoWiseReqQty=def_number_format(($powiseCostingPerReqQtyArr[$result[csf("pre_cost_fabric_cost_dtls_id")]][$result[csf("po_break_down_id")]]['greyreqqty']/($popaln_cut_qnty_array[$result[csf("po_break_down_id")]]/$item_ratio_array[$result[csf("item_number_id")]]))*$costing_per,5,"");
				if($finBalReqQty >0  || $greyBalReqQty > 0  )
				{
					$count++;
					?>
					<tr bgcolor="<?=$bgcolor; ?>" onClick="change_color('tr_<?=$count; ?>','<?=$bgcolor;?>');" id="tr_<?=$count; ?>">
						<td width="30" onClick="select_id_for_delete_item(<? echo $count; ?>)"> <? echo $count; ?></td>
						<td width="120"><?=$po_number[$result[csf("po_break_down_id")]];?> <input type="hidden" id="pobreakdownid_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("po_break_down_id")]; ?>"/></td>
						<td width="140"><?=$garments_item[$result[csf("item_number_id")]];?></td>
						<td width="120"><? echo $body_part[$result[csf("body_part_id")]];?>
							<input  type="hidden" id="bodypartid_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("body_part_id")]; ?>"/>
						</td>
						<td width="100"><? echo $color_type[$result[csf("color_type_id")]];?> <input type="hidden" id="colortype_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("color_type_id")]; ?>"/></td>
						<td width="100"><? echo $result[csf("construction")]; ?>
							<input type="hidden" id="construction_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("construction")]; ?>"/>
							<input type="hidden" id="precostfabriccostdtlsid_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("pre_cost_fabric_cost_dtls_id")]; ?>"/></td>
						<td width="100"><? echo $result[csf("composition")]; ?>
							<input type="hidden" id="composition_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("composition")]; ?>"/>
							<input type="hidden" id="cotaid_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("color_size_table_id")]; ?>"/>
							<input type="hidden" id="preconskg_<?=$count; ?>" style="width:20px;" value="<?=$itempoWiseReqQty; ?>"/>
						</td>
						<td width="50"><?  echo $result[csf("gsm_weight")]; ?> <input type="hidden" id="gsmweight_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("gsm_weight")]; ?>"/></td>
						<td width="80"><?  echo $result[csf("dia_width")]; ?><input type="hidden" id="diawidth_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("dia_width")]; ?>"/></td>
						<td width="80"><?  echo $result[csf("process_loss_percent")]; ?> <input type="hidden" id="processlosspercent_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("process_loss_percent")]; ?>"/></td>
						<td width="50"><p><?  echo $result[csf("item_size")];?></p></td>
						<td width="150"><? echo $size_color_sensitive[$result[csf("color_size_sensitive")]];  ?></td>
						<td width="100"><? if($result[csf("color_size_sensitive")]!=0) echo $color_library[$result[csf("color_number_id")]]; ?></td>
						<td width="100">
						<?
						$color_id="";
						if($type==1)
						{
							echo $color_library[$fabric_color_array[$result[csf("id")]]];
							$color_id=$fabric_color_array[$result[csf("id")]];
						}
						else if($type==2)
						{
							if($result[csf("color_size_sensitive")]==3)
							{
								echo $constrast_color_arr[$result[csf("color_number_id")]];
								$color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$result[csf('pre_cost_fabric_cost_dtls_id')]." and gmts_color_id=".$result[csf('color_number_id')]."");
							}
							else if($result[csf("color_size_sensitive")]==0)
							{
								echo $color_library[$result[csf("color")]];
								$color_id=$result[csf("color")];
							}
							else
							{
								echo $color_library[$result[csf("color_number_id")]];
								$color_id=$result[csf("color_number_id")];
							}
						}
						?>
						<input  type="hidden" id="gmtscolorid_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("color_number_id")]; ?>"/>
                        <input  type="hidden" id="colorid_<? echo $count; ?>" style="width:20px;" value="<? echo $color_id; ?>"/>
                        
                        <input  type="hidden" id="pregreyReqQty_<? echo $count; ?>" style="width:20px;" value="<? echo $pre_cons; ?>"/>
						</td>
						<td width="100"><? echo $size_library[$result[csf("size_number_id")]]; ?>
							<input  type="hidden" id="gmtssizeid_<? echo $count; ?>" style="width:20px;" value="<? echo $result[csf("size_number_id")]; ?>"/>
						</td>
						<td align="right" width="100"> <? echo $paln_cut_qnty_array[$result[csf("color_size_table_id")]]; ?></td>
						<td align="right" width="100">
							<input type="text"   id="finscons_<? echo $count; ?>" name="finscons_<? echo $count; ?>" style=" width:100%; height:100%; border:none; text-align:right; background-color:<? echo $bgcolor; ?>;font-family:verdana; font-size:11px"  onChange="validate_value( <? echo $count ;?>,'finish')" value="<?  echo $bala_fin_fab_qnty; $tot_finish_fab_qnty+=$bala_fin_fab_qnty;  ?>" /></td>
						<td align="right" width="100">
							<input type="text"   id="greycons_<? echo $count; ?>" name="greycons_<? echo $count; ?>" style=" width:100%; height:100%; border:none; text-align:right; background-color:<? echo $bgcolor; ?>;font-family:verdana; font-size:11px"  onChange="validate_value( <? echo $count ;?>,'grey')" value="<?   echo  $bala_grey_fab_qnty; $tot_grey_fab_qnty+=$bala_grey_fab_qnty;?>" />
						</td>
						<td align="right" width="50"><input type="text" id="rate_<? echo $count; ?>" style=" width:100%; height:100%; border:none; text-align:right; background-color:<? echo $bgcolor; ?>;font-family:verdana; font-size:11px" onChange="validate_value( <? echo $count ;?>,'rate')"  value="<? echo $result[csf("rate")]; ?>" <? if ($cbo_fabric_source==1){ echo "readonly";} else { echo "";}  ?>/></td>
						<td align="right" width="100"> <input type="text" id="amount_<? echo $count; ?>" style=" width:100%; height:100%; border:none; text-align:right; background-color:<? echo $bgcolor; ?>;font-family:verdana; font-size:11px"  value="<? echo def_number_format(($result[csf("rate")]*$bala_grey_fab_qnty),2,''); ?>" readonly/></td>
						<?
						$colarculfpercentreadonly="";
						if($result[csf("body_part_id")]==2 || $result[csf("body_part_id")]==3 || $result[csf("body_part_id")]==40) $colarculfpercentreadonly=""; else $colarculfpercentreadonly="readonly";
						?>
						<td align="right" width="60"><input type="text" id="colarculfpercent_<?=$count; ?>" style=" width:100%; height:100%; border:none; text-align:right; background-color:<?=$bgcolor; ?>;font-family:verdana; font-size:11px" value="<?=$colar_cuff_percent_array[$result[csf("id")]]['colar_cuff_per']; ?>" <?=$colarculfpercentreadonly; ?> onChange="copy_colarculfpercent(<?=$count; ?>);" /></td>
						<td align="right">
							<input type="text" id="updateid_<? echo $count; ?>" style=" width:100%; height:100%; border:none; text-align:right; background-color:<? echo $bgcolor; ?>;font-family:verdana; font-size:11px"  value="<? echo $booking_dtls_id_array [$result[csf("id")]]; ?>" readonly />
						</td>
					</tr>
					<?
				}
			}
		}
	}
	?>
	</tbody>
    </table>
    </div>
     <?
    if($count==0)
	{
		$value ="Full Booked"; $display="";
	}
	else
	{
		$value =""; $display="none";
	}
	?>
    <table width="2020" class="rpt_table" border="0" rules="all">
        <tfoot>
            <tr>
            	<td width="30" align="center" colspan="21" id="full_booked" style="font-size:50; font-weight:bold; display:<? $display; ?>"><? echo $value; ?></td>
            </tr>
            <tr>
                <th width="30"></th>
                <th width="120"></th>
                <th width="140"></th>
                <th width="120"></th>
                <th width="100"></th>
                <th width="100"></th>
                <th width="100"></th>
                <th width="50"></th>
                <th width="80"></th>
                <th width="80"></th>
                <th width="50"></th>
                <th width="150"></th>
                <th width="100"></th>
                <th width="100"></th>
                <th width="100"></th>
                <th width="100"></th>
                <th width="100"><? echo number_format($tot_finish_fab_qnty,4);?></th>
                <th width="100"><? echo number_format($tot_grey_fab_qnty,4); ?></th>
                <th width="50"></th>
                <th width="100"><? echo number_format($tot_grey_fab_amount,2); ?></th>
                <th width="60"></th>
                <th></th>
            </tr>
        </tfoot>
    </table>
    <table width="2020" class="rpt_table" border="0" rules="all">
        <tr>
            <td align="center" width="100%" colspan="19" class="button_container">
				<?
                echo load_submit_buttons( $permission, "fnc_fabric_booking_dtls",0,0,"",2) ;
				
                foreach($format_id as $row_id)
                {
					if($row_id==1)
					{
						?>
						<input type="button" value="Fabric Booking GR" onClick="generate_fabric_report_gr('show_fabric_booking_report_gr')"  style="width:150px" name="print_gr" id="print_gr" class="formbutton" />
						<input type="hidden" id="booking_option" name="booking_option" /><input type="hidden" id="booking_option_no" name="booking_option_no" />
						<input type="hidden" id="booking_option_id" name="booking_option_id" />
						<?
					}
					if($row_id==2)
					{
						?><input type="button" value="Print Booking F1" onClick="generate_fabric_report('show_fabric_booking_report')"  style="width:130px" name="print" id="print" class="formbutton" /><?
					}
					if($row_id==3)
					{
						?><input type="button" value="Print Booking F2" onClick="generate_fabric_report('show_fabric_booking_report3')"  style="width:130px" name="print_booking3" id="print_booking3" class="formbutton" /><?
					}
					if($row_id==4)
					{
						?><input type="button" value="Print For Cut F1" onClick="generate_fabric_report('show_fabric_booking_report1')"  style="width:130px" name="print_booking1" id="print_booking1" class="formbutton" /><?
					}
					if($row_id==5)
					{
						?><input type="button" value="Print For Cut F2" onClick="generate_fabric_report('show_fabric_booking_report2')"  style="width:130px" name="print_booking2" id="print_booking2" class="formbutton" /><?
					}
					if($row_id==6)
					{
						?><input type="button" value="Fabric Booking F1" onClick="generate_fabric_report('show_fabric_booking_report4')"  style="width:130px" name="print_booking4" id="print_booking4" class="formbutton" /><?
					}
					if($row_id==7)
					{
						?><input type="button" value="Fabric booking F2" onClick="generate_fabric_report('show_fabric_booking_report5')"  style="width:130px" name="print_booking5" id="print_booking5" class="formbutton" /><?
					}
					if($row_id==28)
					{
						?><input type="button" value="Fabric booking AKH" onClick="generate_fabric_report('show_fabric_booking_report_akh')"  style="width:130px;" name="print_booking_akh" id="print_booking_akh" class="formbutton" /><?
					}
					if($row_id==45)
					{
						?><input type="button" value="Fabric booking Urmi" onClick="generate_fabric_report('show_fabric_booking_report_urmi')"  style="width:130px;" name="print_booking_urmi" id="print_booking_urmi" class="formbutton" /><?
					}
					if($row_id==53)
					{
						?><input type="button" value="Fabric booking JK" onClick="generate_fabric_report('show_fabric_booking_report_jk')"  style="width:130px;" name="print_booking_jk" id="print_booking_jk" class="formbutton" /><?
					}
					if($row_id==73)//for bpkw --issue id ISD-20-20851
					{
						?>
						<input type="button" value="Print B6" onClick="generate_fabric_report('show_fabric_booking_report_b6')" style="width:70px;" name="print_booking_b6" id="print_booking_b6" class="formbutton" />
						<?
					}
                }
                ?>
                <input type="button" class="formbutton" style="width:200px" value="Apply Last Update" onClick="fnc_show_booking(2)">
            </td>
        </tr>
    </table>
	<?
	exit();
}

if ($action=="save_update_delete")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	
	if($isYarnPurchseValidate==2 && str_replace("'","",$cbo_ready_to_approved)==1)
	{
		$sqlYreq="select id from inv_purchase_requisition_dtls where job_no=$txt_job_no and status_active=1 and is_deleted=0";
		$sqlYreqRes=sql_select($sqlYreq);
		if(count($sqlYreqRes)<1)
		{
			echo "yarnPurReq**".str_replace("'","",$txt_booking_no)."**".$booking_no;
			disconnect($con);die;
		}
	}

	if ($operation==0)  // Insert Here
	{
		$con = connect();
		if($db_type==0)
		{
			mysql_query("BEGIN");
		}
		if($db_type==0)
		{
			$new_booking_no=explode("*",return_mrr_number( str_replace("'","",$cbo_company_name), '', 'Fb', date("Y",time()), 5, "select booking_no_prefix, booking_no_prefix_num from wo_booking_mst where company_id=$cbo_company_name and booking_type=1 and YEAR(insert_date)=".date('Y',time())." order by id desc ", "booking_no_prefix", "booking_no_prefix_num" ));
		}
		else if($db_type==2)
		{
			$new_booking_no=explode("*",return_mrr_number( str_replace("'","",$cbo_company_name), '', 'Fb', date("Y",time()), 5, "select booking_no_prefix, booking_no_prefix_num from wo_booking_mst where company_id=$cbo_company_name and booking_type=1 and to_char(insert_date,'YYYY')=".date('Y',time())." order by id desc ", "booking_no_prefix", "booking_no_prefix_num" ));
		}
		$id=return_next_id( "id", "wo_booking_mst", 1 ) ;
		$field_array="id,booking_type,is_short,booking_no_prefix,booking_no_prefix_num,booking_no,company_id,buyer_id,job_no,po_break_down_id,item_category,fabric_source,currency_id,exchange_rate,pay_mode,source,booking_date,delivery_date,booking_month,booking_year,supplier_id,attention,booking_percent,colar_excess_percent,cuff_excess_percent,ready_to_approved,inserted_by,insert_date,rmg_process_breakdown,fabric_composition,uom,entry_form";
		 $data_array ="(".$id.",1,2,'".$new_booking_no[1]."',".$new_booking_no[2].",'".$new_booking_no[0]."',".$cbo_company_name.",".$cbo_buyer_name.",".$txt_job_no.",".$txt_order_no_id.",".$cbo_fabric_natu.",".$cbo_fabric_source.",".$cbo_currency.",".$txt_exchange_rate.",".$cbo_pay_mode.",".$cbo_source.",".$txt_booking_date.",".$txt_delivery_date.",".$cbo_booking_month.",".$cbo_booking_year.",".$cbo_supplier_name.",".$txt_attention.",".$txt_booking_percent.",".$txt_colar_excess_percent.",".$txt_cuff_excess_percent.",".$cbo_ready_to_approved.",".$_SESSION['logic_erp']['user_id'].",'".$pc_date_time."',".$processloss_breck_down.",".$txt_fabriccomposition.",".$cbouom.",86)";
		 $rID=sql_insert("wo_booking_mst",$field_array,$data_array,0);
		if($db_type==0)
		{
			if($rID){
				mysql_query("COMMIT");
				echo "0**".$new_booking_no[0]."**".$id;
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**";
			}
		}
		else if($db_type==2 || $db_type==1 )
		{
			if($rID){
				oci_commit($con);
				echo "0**".$new_booking_no[0]."**".$id;
			}
			else{
				oci_rollback($con);
				echo "10**";
			}
		}
		disconnect($con);
		die;
	}
	else if ($operation==1)   // Update Here
	{
		$con = connect();
		if($db_type==0)
		{
			mysql_query("BEGIN");
		}

		$is_approved=0;
		$sql=sql_select("select is_approved from wo_booking_mst where booking_no=$txt_booking_no");
		foreach($sql as $row){
			if($row[csf('is_approved')]==3) $is_approved=1; else $is_approved=$row[csf('is_approved')];
		}
		if($is_approved==1){
			echo "approved**".str_replace("'","",$txt_booking_no);
			disconnect($con);die;
		}

		$pi_number=return_field_value( "pi_number", "com_pi_master_details a,com_pi_item_details b"," a.id=b.pi_id  and b.work_order_no=$txt_booking_no  and a.status_active=1 and  a.is_deleted=0  and b.status_active=1 and  b.is_deleted=0");
		if($pi_number){
			echo "pi1**".str_replace("'","",$txt_booking_no)."**".$pi_number;
			disconnect($con);die;
		}
		
		/*$yarnAllo=sql_select("select id from inv_material_allocation_mst where booking_no=$txt_booking_no and status_active=1 and is_deleted=0");
		if(count($yarnAllo)>0){
			echo "yarnallocation**".str_replace("'","",$txt_booking_no);
			disconnect($con);die;
		}*/

		$receive_mrr=0;
		$sqlre=sql_select("select recv_number from inv_receive_master where booking_no=$txt_booking_no  and status_active=1 and is_deleted=0");
		foreach($sqlre as $rows){
			$receive_mrr=$rows[csf('recv_number')];
		}
		if($receive_mrr){
			echo "rec1**".str_replace("'","",$txt_booking_no)."**".$receive_mrr;
			disconnect($con);die;
		}

		$issue_mrr=0;
		$sqlis=sql_select("select issue_number from inv_issue_master where booking_no=$txt_booking_no  and status_active=1 and is_deleted=0");
		foreach($sqlis as $rows){
			$issue_mrr=$rows[csf('issue_number')];
		}
		if($issue_mrr){
			echo "iss1**".str_replace("'","",$txt_booking_no)."**".$issue_mrr;
			disconnect($con);die;
		}

		/*if (is_duplicate_field( "sample_type_id", "wo_po_sample_approval_info", "job_no_mst=$txt_job_no and sample_type_id=$cbo_sample_type and id!=$update_id and is_deleted=0" ) == 1)
		{
			echo "11**0";
			die;
		}*/
		$field_array="buyer_id*job_no*po_break_down_id*item_category*fabric_source*currency_id*exchange_rate*pay_mode*source*booking_date*delivery_date*booking_month*booking_year*supplier_id*attention*booking_percent*colar_excess_percent*cuff_excess_percent*ready_to_approved*updated_by*update_date*rmg_process_breakdown*fabric_composition*uom";
		 $data_array ="".$cbo_buyer_name."*".$txt_job_no."*".$txt_order_no_id."*".$cbo_fabric_natu."*".$cbo_fabric_source."*".$cbo_currency."*".$txt_exchange_rate."*".$cbo_pay_mode."*".$cbo_source."*".$txt_booking_date."*".$txt_delivery_date."*".$cbo_booking_month."*".$cbo_booking_year."*".$cbo_supplier_name."*".$txt_attention."*".$txt_booking_percent."*".$txt_colar_excess_percent."*".$txt_cuff_excess_percent."*".$cbo_ready_to_approved."*".$_SESSION['logic_erp']['user_id']."*'".$pc_date_time."'*".$processloss_breck_down."*".$txt_fabriccomposition."*".$cbouom."";
		$rID=sql_update("wo_booking_mst",$field_array,$data_array,"id","".$update_id."",0);

		if($db_type==0)
		{
			if($rID ){
				mysql_query("COMMIT");
				echo "1**".str_replace("'","",$txt_booking_no)."**".str_replace("'","",$update_id);
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**".str_replace("'","",$txt_booking_no)."**".str_replace("'","",$update_id);
			}
		}
		else if($db_type==2 || $db_type==1 )
		{
			if($rID ){
				oci_commit($con);
				echo "1**".str_replace("'","",$txt_booking_no)."**".str_replace("'","",$update_id);
			}
			else{
				oci_roolback($con);
				echo "10**".str_replace("'","",$txt_booking_no)."**".str_replace("'","",$update_id);
			}
		}
		disconnect($con);
		die;
	}
	else if ($operation==2)   // Delete Here
	{
		$con = connect();
		if($db_type==0)
		{
			mysql_query("BEGIN");
		}
		$is_approved=0;
		$sql=sql_select("select is_approved from wo_booking_mst where booking_no=$txt_booking_no");
		foreach($sql as $row){
			if($row[csf('is_approved')]==3) $is_approved=1; else $is_approved=$row[csf('is_approved')];
		}
		if($is_approved==1){
			echo "approved**".str_replace("'","",$txt_booking_no);
			disconnect($con);die;
		}
		$yarnAllo=sql_select("select id from inv_material_allocation_mst where booking_no=$txt_booking_no and status_active=1 and is_deleted=0");
		if(count($yarnAllo)>0){
			echo "yarnallocation**".str_replace("'","",$txt_booking_no);
			disconnect($con);die;
		}

		$pi_number=return_field_value( "pi_number", "com_pi_master_details a,com_pi_item_details b"," a.id=b.pi_id and b.work_order_no=$txt_booking_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and  b.is_deleted=0");
		if($pi_number){
			echo "pi1**".str_replace("'","",$txt_booking_no)."**".$pi_number;
			disconnect($con);die;
		}

		$pplbook=0;
		$ppl=sql_select("select b.id from ppl_planning_info_entry_mst a, ppl_planning_info_entry_dtls b where a.id=b.mst_id and a.booking_no=$txt_booking_no and a.is_sales!=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.id");
		foreach($ppl as $pplrow){
			$pplbook=$pplrow[csf('id')];
		}

		if($pplbook!=0){
			echo "PPL**".str_replace("'","",$txt_booking_no)."**".$pplbook;
			disconnect($con);die;
		}

		$sales_order=0;
		$sqls=sql_select("select job_no from fabric_sales_order_mst where sales_booking_no=$txt_booking_no  and status_active=1 and is_deleted=0");
		foreach($sqls as $rows){
			$sales_order=$rows[csf('job_no')];
		}
		if($sales_order){
			echo "sal1**".str_replace("'","",$txt_booking_no)."**".$sales_order;
		disconnect($con);	die;
		}

		$receive_mrr=0;
		$sqlre=sql_select("select recv_number from inv_receive_master where booking_no=$txt_booking_no and status_active=1 and is_deleted=0");
		foreach($sqlre as $rows){
			$receive_mrr=$rows[csf('recv_number')];
		}
		if($receive_mrr){
			echo "rec1**".str_replace("'","",$txt_booking_no)."**".$receive_mrr;
			disconnect($con);die;
		}

		$issue_mrr=0;
		$sqlis=sql_select("select issue_number from inv_issue_master where booking_no=$txt_booking_no and status_active=1 and is_deleted=0");
		foreach($sqlis as $rows){
			$issue_mrr=$rows[csf('issue_number')];
		}
		if($issue_mrr){
			echo "iss1**".str_replace("'","",$txt_booking_no)."**".$issue_mrr;
			disconnect($con);die;
		}

		$field_array="updated_by*update_date*status_active*is_deleted";
		$data_array="".$_SESSION['logic_erp']['user_id']."*'".$pc_date_time."'*'0'*'1'";
		$rID=sql_delete("wo_booking_mst",$field_array,$data_array,"booking_no","".$txt_booking_no."",1);
		$rID=execute_query( "update wo_booking_dtls set status_active=0,is_deleted =1 where  booking_no =$txt_booking_no and status_active=1 and is_deleted =0",0);
		if($db_type==0)
		{
			if($rID ){
				mysql_query("COMMIT");
				echo "2**".str_replace("'","",$txt_booking_no);
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**".str_replace("'","",$txt_booking_no);
			}
		}
		else if($db_type==2 || $db_type==1 )
		{
			if($rID ){
				oci_commit($con);
				echo "2**".str_replace("'","",$txt_booking_no);
			}
			else{
				oci_rollback($con);
				echo "10**".str_replace("'","",$txt_booking_no);
			}
		}
		disconnect($con);
		die;
	}
}

if($action=="save_update_delete_dtls")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));

	if ($operation==0)  // Insert Here
	{
		$con = connect();
		if($db_type==0)
		{
			mysql_query("BEGIN");
		}

		$is_approved=0;
		$sql=sql_select("select is_approved from wo_booking_mst where booking_no=$txt_booking_no");
		foreach($sql as $row){
			if($row[csf('is_approved')]==3){
				$is_approved=1;
			}else{
				$is_approved=$row[csf('is_approved')];
			}
		}
		if($is_approved==1){
			echo "approved**".str_replace("'","",$txt_booking_no);
			disconnect($con);die;
		}
		// if  ( check_table_status( $_SESSION['menu_id'], 1 )==0 ) { echo "15**0"; die;}
		
		 $counter=0;
		 $fail=0;
		 $add_comma=1;
		 $id=return_next_id( "id", "wo_booking_dtls", 1 ) ;
		 $poids=str_replace("'","",$txt_order_no_id);
		 
		 $qr=execute_query( "update wo_booking_dtls set status_active=3, is_deleted=2 where booking_no=$txt_booking_no and booking_type=1 and status_active=1 and is_deleted=0",0);
		 
		 $field_array="id, job_no,booking_mst_id, po_break_down_id, pre_cost_fabric_cost_dtls_id, color_size_table_id, precons, booking_no, booking_type, is_short, gmts_color_id,fabric_color_id,req_qty, fin_fab_qnty, grey_fab_qnty, rate, amount, color_type, construction, copmposition, gsm_weight, dia_width, process_loss_percent, colar_cuff_per, inserted_by, insert_date"; $poIds="";
		 for ($i=1;$i<=$total_row;$i++)
		 {
			 $counter++;
			 $pobreakdownid="pobreakdownid_".$i;
			 $precostfabriccostdtlsid="precostfabriccostdtlsid_".$i;
			 $gmtscolorid="gmtscolorid_".$i;
			 $colorid="colorid_".$i;
			 $cotaid="cotaid_".$i;
			 $preconskg="preconskg_".$i;
			 $pregreyReqQty="pregreyReqQty_".$i;
			 $finscons="finscons_".$i;
			 $greycons="greycons_".$i;
			 $rate="rate_".$i;
			 $amount="amount_".$i;
			 $colortype="colortype_".$i;
			 $construction="construction_".$i;
			 $composition="composition_".$i;
			 $gsmweight="gsmweight_".$i;
			 $diawidth="diawidth_".$i;
			 $processlosspercent="processlosspercent_".$i;
			 $colarculfpercent="colarculfpercent_".$i;
			 $updateid="updateid_".$i;
			 $poIds.=str_replace("'","",$pobreakdownid).",";

			if ($add_comma!=1) $data_array .=",";
			$data_array .="(".$id.",".$txt_job_no.",".$update_id.",".$$pobreakdownid.",".$$precostfabriccostdtlsid.",".$$cotaid.",".$$preconskg.",".$txt_booking_no.",1,2,".$$gmtscolorid.",".$$colorid.",".$$pregreyReqQty.",".$$finscons.",".$$greycons.",".$$rate.",".$$amount.",".$$colortype.",".$$construction.",".$$composition.",".$$gsmweight.",".$$diawidth.",".$$processlosspercent.",".$$colarculfpercent.",".$_SESSION['logic_erp']['user_id'].",'".$pc_date_time."')";
			$add_comma++;
			$id=$id+1;
			if ($data_array!="" && $counter==100)
			{
				$counter=0;
				$rID=sql_insert("wo_booking_dtls",$field_array,$data_array,1);
				$data_array="";
				$add_comma=1;
				if( $rID && $fail==0) { $rID=1;  } else { $rID=0; $fail=1; }
			}
		 }
		 
		 if ($data_array!="" && $counter!=100)
		 {
			$counter=0;
			$rID=sql_insert("wo_booking_dtls",$field_array,$data_array,1);
			//echo "10**0**insert into wo_booking_dtls (".$field_array.") values ".$data_array;die;
			$data_array="";
			$add_comma=1;
			if( $rID && $fail==0) { $rID=1;  } else { $rID=0; $fail=1; }
		 }
		// echo "10**".$rID.'=='.$fail;die;
		//$rID=sql_insert("wo_booking_dtls",$field_array,$data_array,1);
		 //check_table_status( $_SESSION['menu_id'],0);
		 
		 
		if($db_type==0)
		{
			if($rID ){
				mysql_query("COMMIT");
				echo "0**".$new_booking_no[0];
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**".$new_booking_no[0];
			}
		}
		else if($db_type==2 || $db_type==1 )
		{
			if($rID ){
				oci_commit($con);
				echo "0**".$new_booking_no[0];
			}
			else{
				oci_rollback($con);
				echo "10**".$new_booking_no[0];
			}
		}
		disconnect($con);
		die;
	}
	else if ($operation==1)  // Insert Here
	{
		$con = connect();
		if($db_type==0)
		{
			mysql_query("BEGIN");
		}
		$approval_necessity_setup=return_field_value("approval_need","approval_setup_mst a,approval_setup_dtls b","a.id=b.mst_id and a.company_id=$cbo_company_name and b.page_id=25 and a.status_active=1 and a.is_deleted=0  order by a.setup_date desc","approval_need");
		 if($approval_necessity_setup==1)
		 {
			 $is_job_approved=return_field_value( "approved", "wo_pre_cost_mst"," job_no=$txt_job_no and status_active=1 and is_deleted=0");
			 if($is_job_approved!=1)
			 {
				 echo "appNSet**";
				 check_table_status( $_SESSION['menu_id'],0);
				disconnect($con); die;
			 }
		 }
		$is_approved=0;
		$sql=sql_select("select is_approved from wo_booking_mst where booking_no=$txt_booking_no");
		foreach($sql as $row){
			if($row[csf('is_approved')]==3) $is_approved=1; else $is_approved=$row[csf('is_approved')];
		}
		if($is_approved==1){
			echo "approved**".str_replace("'","",$txt_booking_no);
			disconnect($con);die;
		}
		
		/*$yarnAllo=sql_select("select id from inv_material_allocation_mst where booking_no=$txt_booking_no and status_active=1 and is_deleted=0");
		if(count($yarnAllo)>0){
			echo "yarnallocation**".str_replace("'","",$txt_booking_no);
			disconnect($con);die;
		}*/

		$pi_number=return_field_value( "pi_number", "com_pi_master_details a,com_pi_item_details b"," a.id=b.pi_id and b.work_order_no=$txt_booking_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and  b.is_deleted=0");
		if($pi_number){
			echo "pi1**".str_replace("'","",$txt_booking_no)."**".$pi_number;
			die;
		}

		$receive_mrr=0;
		$sqlre=sql_select("select recv_number from inv_receive_master where booking_no=$txt_booking_no and status_active=1 and is_deleted=0");
		foreach($sqlre as $rows){
			$receive_mrr=$rows[csf('recv_number')];
		}
		if($receive_mrr){
			echo "rec1**".str_replace("'","",$txt_booking_no)."**".$receive_mrr;
			disconnect($con);die;
		}

		$issue_mrr=0;
		$sqlis=sql_select("select issue_number from inv_issue_master where booking_no=$txt_booking_no and status_active=1 and is_deleted=0");
		foreach($sqlis as $rows){
			$issue_mrr=$rows[csf('issue_number')];
		}
		if($issue_mrr){
			echo "iss1**".str_replace("'","",$txt_booking_no)."**".$issue_mrr;
			disconnect($con);die;
		}
		 //if  ( check_table_status( $_SESSION['menu_id'], 1 )==0 ) { echo "15**1"; die;}
		 $id=return_next_id( "id", "wo_booking_dtls", 1 ) ;
		 $add_comma=0;
		 $counter=0;
		 $counterup=0;
		 $fail=0;
		 $fail_up=0;
		 $field_array="id, job_no, booking_mst_id,po_break_down_id, pre_cost_fabric_cost_dtls_id, color_size_table_id, precons, booking_no, booking_type, is_short,gmts_color_id, fabric_color_id,req_qty, fin_fab_qnty, grey_fab_qnty, rate, amount, color_type, construction, copmposition, gsm_weight, dia_width, process_loss_percent, colar_cuff_per, inserted_by, insert_date";

		 $field_array_up="job_no*po_break_down_id*pre_cost_fabric_cost_dtls_id*color_size_table_id*precons*booking_no*booking_type*is_short*gmts_color_id*fabric_color_id*req_qty*fin_fab_qnty*grey_fab_qnty*rate*amount*color_type*construction*copmposition*gsm_weight*dia_width*process_loss_percent*colar_cuff_per*updated_by*update_date";
		 for ($i=1;$i<=$total_row;$i++)
		 {
			 $pobreakdownid="pobreakdownid_".$i;
			 $precostfabriccostdtlsid="precostfabriccostdtlsid_".$i;
			 $colorid="colorid_".$i;
			 $gmtscolorid="gmtscolorid_".$i;
			 $cotaid="cotaid_".$i;
			 $pregreyReqQty="pregreyReqQty_".$i;
			 $preconskg="preconskg_".$i;
			 $finscons="finscons_".$i;
			 $greycons="greycons_".$i;
			 $rate="rate_".$i;
			 $amount="amount_".$i;
			 $colortype="colortype_".$i;
			 $construction="construction_".$i;
			 $composition="composition_".$i;
			 $gsmweight="gsmweight_".$i;
			 $diawidth="diawidth_".$i;
			 $processlosspercent="processlosspercent_".$i;
			 $colarculfpercent="colarculfpercent_".$i;
			 $updateid="updateid_".$i;

			 if(str_replace("'",'',$$updateid)!="")
			 {
				$counterup++;
				$id_arr[]=str_replace("'",'',$$updateid);
				$data_array_up[str_replace("'",'',$$updateid)] =explode("*",("".$txt_job_no."*".$$pobreakdownid."*".$$precostfabriccostdtlsid."*".$$cotaid."*".$$preconskg."*".$txt_booking_no."*1*2*".$$gmtscolorid."*".$$colorid."*".$$pregreyReqQty."*".$$finscons."*".$$greycons."*".$$rate."*".$$amount."*".$$colortype."*".$$construction."*".$$composition."*".$$gsmweight."*".$$diawidth."*".$$processlosspercent."*".$$colarculfpercent."*".$_SESSION['logic_erp']['user_id']."*'".$pc_date_time."'"));

				if (count($data_array_up)>0 && $counterup==100)
				{
					$counterup=0;
					$rID=execute_query(bulk_update_sql_statement( "wo_booking_dtls", "id", $field_array_up, $data_array_up, $id_arr ));
					$id_arr=array();
					$data_array_up=array();

					if( $rID && $fail_up==0) { $rID=1;  } else { $rID=0; $fail_up=1; }
				}

			 }


			if(str_replace("'",'',$$updateid)=="")
			{
				// $field_array="id, job_no, po_break_down_id, pre_cost_fabric_cost_dtls_id, color_size_table_id, precons, booking_no, booking_type, is_short, fabric_color_id,req_qty, fin_fab_qnty, grey_fab_qnty, rate, amount, color_type, construction, copmposition, gsm_weight, dia_width, process_loss_percent, colar_cuff_per, inserted_by, insert_date";
				$counter++;
				if ($add_comma!=0) $data_array .=",";
				$data_array .="(".$id.",".$txt_job_no.",".$update_id.",".$$pobreakdownid.",".$$precostfabriccostdtlsid.",".$$cotaid.",".$$preconskg.",".$txt_booking_no.",1,2,".$$gmtscolorid.",".$$colorid.",".$$pregreyReqQty.",".$$finscons.",".$$greycons.",".$$rate.",".$$amount.",".$$colortype.",".$$construction.",".$$composition.",".$$gsmweight.",".$$diawidth.",".$$processlosspercent.",".$$colarculfpercent.",".$_SESSION['logic_erp']['user_id'].",'".$pc_date_time."')";
				$id=$id+1;
				$add_comma++;
				if ($data_array!="" && $counter==100)
			    {
					$counter=0;
					$rID=sql_insert("wo_booking_dtls",$field_array,$data_array,1);
					$data_array="";
					$add_comma=0;
					if( $rID && $fail==0) { $rID=1;  } else { $rID=0; $fail=1; }
			    }

			}
		 }
		 if ($data_array!="" && $counter!=100)
		 {
			$counter=0;
			$rID=sql_insert("wo_booking_dtls",$field_array,$data_array,1);
			//echo "10**0**insert into wo_booking_dtls (".$field_array.") values ".$data_array;die;
			$data_array="";
			$add_comma=0;
			if( $rID && $fail==0) { $rID=1;  } else { $rID=0; $fail=1; }
		 }
		 if (count($data_array_up)>0 && $counterup!=100)
				{
					$counterup=0;
					$rID=execute_query(bulk_update_sql_statement( "wo_booking_dtls", "id", $field_array_up, $data_array_up, $id_arr ));
					$id_arr=array();
					$data_array_up=array();

					if( $rID && $fail_up==0) { $rID=1;  } else { $rID=0; $fail_up=1; }
				}
		//echo  bulk_update_sql_statement( "wo_booking_dtls", "id", $field_array_up, $data_array_up, $id_arr ); die;
		//$rID=execute_query(bulk_update_sql_statement( "wo_booking_dtls", "id", $field_array_up, $data_array_up, $id_arr ));
		/*if($data_array !="")
		 {
		  $rID=sql_insert("wo_booking_dtls",$field_array,$data_array,1);
		 }*/

		//echo "10**".$rID;die;
		 //$rID=sql_insert("wo_booking_dtls",$field_array,$data_array,1);
		/// check_table_status( $_SESSION['menu_id'],0);
		if($db_type==0)
		{
			if($rID ){
				mysql_query("COMMIT");
				echo "1**".str_replace(",","",$txt_booking_no);
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**".str_replace(",","",$txt_booking_no);
			}
		}
		else if($db_type==2 || $db_type==1 )
		{
			if($rID ){
				oci_commit($con);
				echo "1**".str_replace(",","",$txt_booking_no);
			}
			else{
				oci_rollback($con);
				echo "10**".str_replace(",","",$txt_booking_no);
			}
		}
		disconnect($con);
		die;
	}
	else if ($operation==2)  // Insert Here
	{
		$con = connect();
		if($db_type==0)
		{
			mysql_query("BEGIN");
		}

		$is_approved=0;
		$sql=sql_select("select is_approved from wo_booking_mst where booking_no=$txt_booking_no");
		foreach($sql as $row){
			if($row[csf('is_approved')]==3){
				$is_approved=1;
			}else{
				$is_approved=$row[csf('is_approved')];
			}
		}
		if($is_approved==1){
			echo "approved**".str_replace("'","",$txt_booking_no);
			disconnect($con);die;
		}
		
		$yarnAllo=sql_select("select id from inv_material_allocation_mst where booking_no=$txt_booking_no and status_active=1 and is_deleted=0");
		if(count($yarnAllo)>0){
			echo "yarnallocation**".str_replace("'","",$txt_booking_no);
			disconnect($con);die;
		}

		$pi_number=return_field_value( "pi_number", "com_pi_master_details a,com_pi_item_details b"," a.id=b.pi_id and b.work_order_no=$txt_booking_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and  b.is_deleted=0");
		if($pi_number){
			echo "pi1**".str_replace("'","",$txt_booking_no)."**".$pi_number;
			disconnect($con);die;
		}

		$pplbook=0;
		$ppl=sql_select("select b.id from ppl_planning_info_entry_mst a, ppl_planning_info_entry_dtls b where a.id=b.mst_id and a.booking_no=$txt_booking_no and a.is_sales!=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.id");
		foreach($ppl as $pplrow){
			$pplbook=$pplrow[csf('id')];
		}

		if($pplbook!=0){
			echo "PPL**".str_replace("'","",$txt_booking_no)."**".$pplbook;
			disconnect($con);die;
		}

		$sales_order=0;
		$sqls=sql_select("select job_no from fabric_sales_order_mst where sales_booking_no=$txt_booking_no  and status_active=1 and is_deleted=0");
		foreach($sqls as $rows){
			$sales_order=$rows[csf('job_no')];
		}
		if($sales_order){
			echo "sal1**".str_replace("'","",$txt_booking_no)."**".$sales_order;
			disconnect($con);die;
		}

		$receive_mrr=0;
		$sqlre=sql_select("select recv_number from inv_receive_master where booking_no=$txt_booking_no and status_active=1 and is_deleted=0");
		foreach($sqlre as $rows){
			$receive_mrr=$rows[csf('recv_number')];
		}
		if($receive_mrr){
			echo "rec1**".str_replace("'","",$txt_booking_no)."**".$receive_mrr;
			disconnect($con);die;
		}

		$issue_mrr=0;
		$sqlis=sql_select("select issue_number from inv_issue_master where booking_no=$txt_booking_no and status_active=1 and is_deleted=0");
		foreach($sqlis as $rows){
			$issue_mrr=$rows[csf('issue_number')];
		}
		if($issue_mrr){
			echo "iss1**".str_replace("'","",$txt_booking_no)."**".$issue_mrr;
			disconnect($con);die;
		}

		if($selected_id_for_delete=="")
		{
			$rID=execute_query( "update wo_booking_dtls set status_active=0,is_deleted =1 where  booking_no =$txt_booking_no and status_active=1 and is_deleted =0",0);
		}
		else
		{
			$rID=execute_query( "update wo_booking_dtls set status_active=0,is_deleted =1 where  id in(".str_replace("'","",$selected_id_for_delete).")  and status_active=1 and is_deleted =0",0);
			//echo "update wo_booking_dtls set status_active=0,is_deleted =1 where  id in(".str_replace("'","",$selected_id_for_delete).")";
		}
		if($db_type==0)
		{
			if($rID ){
				mysql_query("COMMIT");
				echo "2**".str_replace(",","",$txt_booking_no);
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**".str_replace(",","",$txt_booking_no);
			}
		}
		else if($db_type==2 || $db_type==1 )
		{
			if($rID ){
				oci_commit($con);
				echo "2**".str_replace(",","",$txt_booking_no);
			}
			else{
				oci_rollback($con);
				echo "10**".str_replace(",","",$txt_booking_no);
			}
		}
		disconnect($con);
		die;
	}
}

if($action=="check_is_booking_used")
{
	//die;
	$exdata=explode('__',$data);
	$txt_booking_no="'".$exdata[0]."'";
	if($data!="")
	{
		 $approval_necessity_setup=return_field_value("approval_need","approval_setup_mst a,approval_setup_dtls b","a.id=b.mst_id and a.company_id='$exdata[1]' and b.page_id=25 and a.status_active=1 and a.is_deleted=0  order by a.setup_date desc","approval_need");
		 if($approval_necessity_setup==1)
		 {
			 $is_job_approved=return_field_value( "approved", "wo_pre_cost_mst"," job_no='$exdata[2]' and status_active=1 and is_deleted=0");
			 if($is_job_approved!=1)
			 {
				echo "appNSet**";
				disconnect($con); die;
			 }
		 }

		$is_approved=0;
		$sql=sql_select("select is_approved from wo_booking_mst where booking_no=$txt_booking_no");
		foreach($sql as $row){
			if($row[csf('is_approved')]==3){
				$is_approved=1;
			}else{
				$is_approved=$row[csf('is_approved')];
			}
		}
		
		if($is_approved==1){
			echo "approved**".str_replace("'","",$txt_booking_no);
			disconnect($con);die;
		}
		
		if($exdata[3]==0)
		{
			$yarnAllo=sql_select("select id from inv_material_allocation_mst where booking_no=$txt_booking_no and status_active=1 and is_deleted=0 and entry_form=0");
			if(count($yarnAllo)>0){
				echo "yarnallocation**".str_replace("'","",$txt_booking_no);
				disconnect($con);die;
			}
		}
		
		$pi_number=return_field_value( "pi_number", "com_pi_master_details a,com_pi_item_details b"," a.id=b.pi_id and b.work_order_no=$txt_booking_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and  b.is_deleted=0");
		if($pi_number){
			echo "pi1**".str_replace("'","",$txt_booking_no)."**".$pi_number;
			disconnect($con);die;
		}

		/*$pplbook=0;
		$ppl=sql_select("select b.id from ppl_planning_info_entry_mst a, ppl_planning_info_entry_dtls b where a.id=b.mst_id and a.booking_no=$txt_booking_no and a.is_sales!=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.id");
		foreach($ppl as $pplrow){
			$pplbook=$pplrow[csf('id')];
		}

		if($pplbook!=0){
			echo "PPL**".str_replace("'","",$txt_booking_no)."**".$pplbook;
			die;
		}

		$sales_order=0;
		$sqls=sql_select("select job_no from fabric_sales_order_mst where sales_booking_no=$txt_booking_no");
		foreach($sqls as $rows){
			$sales_order=$rows[csf('job_no')];
		}
		if($sales_order){
			echo "sal1**".str_replace("'","",$txt_booking_no)."**".$sales_order;
			die;
		}*/

		$receive_mrr=0;
		$sqlre=sql_select("select recv_number from inv_receive_master where booking_no=$txt_booking_no");
		foreach($sqlre as $rows){
			$receive_mrr=$rows[csf('recv_number')];
		}
		if($receive_mrr){
			echo "rec1**".str_replace("'","",$txt_booking_no)."**".$receive_mrr;
			disconnect($con);die;
		}

		$issue_mrr=0;
		$sqlis=sql_select("select issue_number from inv_issue_master where booking_no=$txt_booking_no");
		foreach($sqlis as $rows){
			$issue_mrr=$rows[csf('issue_number')];
		}
		if($issue_mrr){
			echo "iss1**".str_replace("'","",$txt_booking_no)."**".$issue_mrr;
			disconnect($con);die;
		}
	}
	exit();
}

if($action=="delete_booking_item")
{
	$con = connect();
	if($db_type==0)
	{
		mysql_query("BEGIN");
	}
	$rID = execute_query( "update wo_booking_dtls set status_active=0,is_deleted=1 where  booking_no ='$data'",0);
	if($db_type==0)
	{
		if($rID ){
			mysql_query("COMMIT");
			echo "0**".str_replace(",","",$txt_booking_no);
		}
		else{
			mysql_query("ROLLBACK");
			echo "10**".str_replace(",","",$txt_booking_no);
		}
	}
	else if($db_type==2 || $db_type==1 )
	{
		if($rID ){
			oci_commit($con);
			echo "0**".str_replace(",","",$txt_booking_no);
		}
		else{
			oci_rollback($con);
			echo "10**".str_replace(",","",$txt_booking_no);
		}
	}
}

if($action=="booking_surch_option")
{
	extract($_REQUEST);
	echo load_html_head_contents("Popup Info","../../../", '', '', $unicode);
	?>
    <script>

		var selected_id = new Array;
		var selected_name = new Array;
		var selected_no = new Array;
    	function check_all_data()
		{
			//var tbl_row_count = document.getElementById( 'list_view' ).rows.length;
			var tbl_row_count = $('#list_view tbody tr').length;
			var onclickString=paramArr=functionParam="";
			for( var i = 1; i <= tbl_row_count; i++ )
			{
				onclickString = $('#tr_' + i).attr('onclick');
				paramArr = onclickString.split("'");
				functionParam = paramArr[1];
				js_set_value( functionParam );

			}
		}

		function toggle( x, origColor ) {
			var newColor = 'yellow';
			if ( x.style ) {
				x.style.backgroundColor = ( newColor == x.style.backgroundColor )? origColor : newColor;
			}
		}

		function js_set_value( strCon )
		{
			//alert(strCon);
			var splitSTR = strCon.split("_");
			var str_or = splitSTR[0];
			var selectID = splitSTR[1];
			var selectDESC = splitSTR[2];
			//$('#txt_individual_id' + str).val(splitSTR[1]);
			//$('#txt_individual' + str).val('"'+splitSTR[2]+'"');

			toggle( document.getElementById( 'tr_' + str_or ), '#FFFFCC' );

			if( jQuery.inArray( str_or, selected_no ) == -1 ) {
				selected_id.push( selectID );
				selected_name.push( selectDESC );
				selected_no.push( str_or );
			}
			else {
				for( var i = 0; i < selected_id.length; i++ ) {
					if( selected_id[i] == selectID ) break;
				}
				selected_id.splice( i, 1 );
				selected_name.splice( i, 1 );
				selected_no.splice( i, 1 );
			}
			var id = ''; var name = ''; var job = ''; var num='';
			for( var i = 0; i < selected_id.length; i++ ) {
				id += selected_id[i] + ',';
				name += selected_name[i] + ',';
				num += selected_no[i] + ',';
			}
			id 		= id.substr( 0, id.length - 1 );
			name 	= name.substr( 0, name.length - 1 );
			num 	= num.substr( 0, num.length - 1 );
			//alert(num);
			$('#txt_selected_id').val( id );
			$('#txt_selected').val( name );
			$('#txt_selected_no').val( num );
		}

		function frm_close()
		{
			parent.emailwindow.hide();
		}
    </script>
    <?
	$select_rpt_option_arr=array(1=>"Size and Color Breakdown",2=>"Main Booking Info",3=>"Collar / Cuff -  Colour Size Brakedown in Pcs",4=>"Yarn Required Summary",5=>"Allocated Yarn",6=>"Conversion Charge",7=>"Embellishment",8=>"Approved Instructions",9=>"Special  Instruction",10=>"Comments",11=>"TNA Information");
	//echo $sql;die;
	?>

    <div style="width:500px;">
    <table width="500" cellpadding="0" cellspacing="0" class="rpt_table" border="1" rules="all" id="list_view" align="left">
    	<thead>
        	<tr>
                <th width="50">Sl</th>
                <th>Report Option</th>
            </tr>
        </thead>
        <tbody>
			<?
            $i=1;
            foreach($select_rpt_option_arr as $id=>$val)
            {
                if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                ?>
                <tr bgcolor="<? echo $bgcolor; ?>" id="tr_<? echo $i; ?>" onClick="js_set_value('<? echo $i."_".$id."_".$val; ?>')" style="cursor:pointer">
                    <td width="50"  align="center"><? echo $i; ?></td>
                    <td><? echo $val; ?></td>
                </tr>
                <?
                $i++;
            }
            ?>
            <tr>
                <td  style="vertical-align:middle; padding-left:20px;" colspan="2"><input type="checkbox" id="all_check" onClick="check_all_data('all_check')" />&nbsp;Check All / Un-Check All
                <input type='hidden' id='txt_selected_id' />
                <input type='hidden' id='txt_selected' />
                <input type='hidden' id='txt_selected_no' />
                </td>
            </tr>
        </tbody>
    </table>
    <br>
    <div style="width:100%"><p align="center"><input type="button" id="btn_close" class="formbutton" style="width:100px;" value="Close" onClick="frm_close();" ></p></div>
    </div>

    <script language="javascript" type="text/javascript">
	var category_no='<? echo $booking_option_no;?>';
	var category_id='<? echo $booking_option_id;?>';
	var category_des='<? echo $booking_option;?>';
	var cate_ref="";
	if(category_no!="")
	{
		category_no_arr=category_no.split(",");
		category_id_arr=category_id.split(",");
		category_des_arr=category_des.split(",");
		var str_ref="";
		for(var k=0;k<category_no_arr.length; k++)
		{
			cate_ref=category_no_arr[k]+'_'+category_id_arr[k]+'_'+category_des_arr[k];
			js_set_value(cate_ref);
		}
	}
	</script>
    <?
	exit();
}

if($action=="terms_condition_popup")
{
	echo load_html_head_contents("Order Search","../../../", 1, 1, $unicode);
	extract($_REQUEST);
?>
	<script>
function add_break_down_tr(i)
 {
	var row_num=$('#tbl_termcondi_details tr').length-1;
	if (row_num!=i)
	{
		return false;
	}
	else
	{
		i++;

		 $("#tbl_termcondi_details tr:last").clone().find("input,select").each(function() {
			$(this).attr({
			  'id': function(_, id) { var id=id.split("_"); return id[0] +"_"+ i },
			  'name': function(_, name) { return name + i },
			  'value': function(_, value) { return value }
			});
		  }).end().appendTo("#tbl_termcondi_details");
		 $('#increase_'+i).removeAttr("onClick").attr("onClick","add_break_down_tr("+i+");");
		  $('#decrease_'+i).removeAttr("onClick").attr("onClick","fn_deletebreak_down_tr("+i+")");
		  $('#termscondition_'+i).val("");
	}

}

function fn_deletebreak_down_tr(rowNo)
{


		var numRow = $('table#tbl_termcondi_details tbody tr').length;
		if(numRow==rowNo && rowNo!=1)
		{
			$('#tbl_termcondi_details tbody tr:last').remove();
		}

}

function fnc_fabric_booking_terms_condition( operation )
{
	    var row_num=$('#tbl_termcondi_details tr').length-1;
		var data_all="";
		for (var i=1; i<=row_num; i++)
		{

			if (form_validation('termscondition_'+i,'Term Condition')==false)
			{
				return;
			}

			data_all=data_all+get_submitted_data_string('txt_booking_no*termscondition_'+i,"../../../",i);
		}
		var data="action=save_update_delete_fabric_booking_terms_condition&operation="+operation+'&total_row='+row_num+data_all;
		freeze_window(operation);
		http.open("POST","fabric_booking_controller.php",true);
		http.setRequestHeader("Content-type","application/x-www-form-urlencoded");
		http.send(data);
		http.onreadystatechange = fnc_fabric_booking_terms_condition_reponse;
}

function fnc_fabric_booking_terms_condition_reponse()
{

	if(http.readyState == 4)
	{
	    var reponse=trim(http.responseText).split('**');
			if (reponse[0].length>2) reponse[0]=10;
			release_freezing();
			if(reponse[0]==0 || reponse[0]==1)
			{
				parent.emailwindow.hide();
			}
	}
}
    </script>

</head>

<body>
<div align="center" style="width:100%;" >
 <? echo load_freeze_divs ("../../../",$permission);  ?>
<fieldset>
        	<form id="termscondi_1" autocomplete="off">
           <input type="hidden" id="txt_booking_no" name="txt_booking_no" value="<? echo str_replace("'","",$txt_booking_no) ?>"/>


            <table width="650" cellspacing="0" class="rpt_table" border="0" id="tbl_termcondi_details" rules="all">
                	<thead>
                    	<tr>
                        	<th width="50">Sl</th><th width="530">Terms</th><th ></th>
                        </tr>
                    </thead>
                    <tbody>
                    <?
					$data_array=sql_select("select id, terms from  wo_booking_terms_condition where booking_no=$txt_booking_no");// quotation_id='$data'
					if ( count($data_array)>0)
					{
						$i=0;
						foreach( $data_array as $row )
						{
							$i++;
							?>
                            	<tr id="settr_1" align="center">
                                    <td>
                                    <? echo $i;?>
                                    </td>
                                    <td>
                                    <input type="text" id="termscondition_<? echo $i;?>"   name="termscondition_<? echo $i;?>" style="width:95%"  class="text_boxes"  value="<? echo $row[csf('terms')]; ?>"  />
                                    </td>
                                    <td>
                                    <input type="button" id="increase_<? echo $i; ?>" style="width:30px" class="formbutton" value="+" onClick="add_break_down_tr(<? echo $i; ?> )" />
                                    <input type="button" id="decrease_<? echo $i; ?>" style="width:30px" class="formbutton" value="-" onClick="javascript:fn_deletebreak_down_tr(<? echo $i; ?>);" />
                                    </td>
                                </tr>
                            <?
						}
					}
					else
					{
					$data_array=sql_select("select id, terms from  lib_terms_condition where is_default=1");// quotation_id='$data'
					foreach( $data_array as $row )
						{
							$i++;
					?>
                    <tr id="settr_1" align="center">
                                    <td>
                                    <? echo $i;?>
                                    </td>
                                    <td>
                                    <input type="text" id="termscondition_<? echo $i;?>"   name="termscondition_<? echo $i;?>" style="width:95%"  class="text_boxes"  value="<? echo $row[csf('terms')]; ?>"  />
                                    </td>
                                    <td>
                                    <input type="button" id="increase_<? echo $i; ?>" style="width:30px" class="formbutton" value="+" onClick="add_break_down_tr(<? echo $i; ?> )" />
                                    <input type="button" id="decrease_<? echo $i; ?>" style="width:30px" class="formbutton" value="-" onClick="javascript:fn_deletebreak_down_tr(<? echo $i; ?> );" />
                                    </td>
                                </tr>
                    <?
						}
					}
					?>
                </tbody>
                </table>

                <table width="650" cellspacing="0" class="" border="0">
                	<tr>
                        <td align="center" height="15" width="100%"> </td>
                    </tr>
                	<tr>
                        <td align="center" width="100%" class="button_container">
						        <?
									echo load_submit_buttons( $permission, "fnc_fabric_booking_terms_condition", 0,0 ,"reset_form('termscondi_1','','','','')",1) ;
									?>
                        </td>
                    </tr>
                </table>
            </form>
        </fieldset>
</div>
</body>
<script src="../../../includes/functions_bottom.js" type="text/javascript"></script>
</html>
<?
}

if($action=="dtm_popup")
{
	echo load_html_head_contents("DTM Search","../../../", 1, 1, $unicode);
	extract($_REQUEST);
	?>
<script>

function trims_popup(page_link,title,i)
{
	var job_no=$('#txt_job_no').val();
	var booking_no=$('#txt_booking_no').val();
	var selected_no=$('#txt_order_no_id').val();
	var fabric=$('#fabric_'+i).val();
	var color=$('#color_'+i).val();
	var fabric_cost_id=$('#fabric_cost_id_'+i).val();


	if(booking_no=='')
	{
		alert('Booking  Not Found.');
		$('#txt_booking_no').focus();
		return;
	}

	page_link=page_link+'&job_no='+job_no+'&booking_no='+booking_no+'&selected_no='+selected_no+'&fabric='+fabric+'&color='+color+'&fabric_cost_id='+fabric_cost_id+'&index='+i;
	emailwindow=dhtmlmodal.open('EmailBox', 'iframe', page_link, title, 'width=800px,height=300px,center=1,resize=1,scrolling=0','../../')

}
</script>
<?
//echo $job_no."_".$booking_no."_".$selected_no;
//$sql=sql_select("select id,booking_id,booking_no,pre_cost_fabric_cost_id,fabric_color,precost_trim_cost_id,item_group,qty from wo_dye_to_match where booking_no='$booking_no'");
$dtm_arr=array();
$sql=sql_select("select pre_cost_fabric_cost_id,fabric_color,sum(qty) as qty  from wo_dye_to_match where booking_no='$booking_no' group by pre_cost_fabric_cost_id,fabric_color");
foreach($sql as $row){
	$dtm_arr[$row[csf('pre_cost_fabric_cost_id')]][$row[csf('fabric_color')]]=$row[csf('qty')];
}


$trims_matches_sql=sql_select("select a.id,a.body_part_id, a.composition, a.construction,a.gsm_weight,d.fabric_color_id,min(c.id) as cid,sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
			WHERE a.job_no=b.job_no and
			a.id=b.pre_cost_fabric_cost_dtls_id and
			c.job_no_mst=a.job_no and
			c.id=b.color_size_table_id and
			b.po_break_down_id=d.po_break_down_id and
			b.color_size_table_id=d.color_size_table_id and
			b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
			d.booking_no ='$booking_no' and
			d.status_active=1 and
			d.is_deleted=0
			group by a.id,a.body_part_id, a.composition, a.construction,a.gsm_weight,d.fabric_color_id order by a.id, cid ");

?>



</head>
<body>
<div align="center" style="width:100%;" >
<input type="hidden" id="txt_job_no" name="txt_job_no" value="<? echo $job_no;  ?>"/>
<input type="hidden" id="txt_booking_no" name="txt_booking_no" value="<? echo $booking_no;  ?>"/>
<input type="hidden" id="txt_order_no_id" name="txt_order_no_id" value="<? echo $selected_no;  ?>"/>
	<table width="800" cellspacing="0" class="rpt_table" border="0" id="tbl_trims_dyes_match1" rules="all">
	<thead>
	  <tr>
		<th width="40">S/L</th>
		<th width="300">Fabric Driscription</th>
		<th width="150">Color</th>
		<th width="100">Fabric Qnty.</th>
		<th width="100">Trims</th>
	  </tr>
	</thead>
	<tbody>
	<?

	$i=1;
	foreach($trims_matches_sql as $row)
	 {
	 ?>
	  <tr>
	  	<td width="40"><? echo $i; ?></td>
	  	<td width="300">
        <input class="text_boxes" type="text" style="width:300px;"  name="fabric_<? echo $i; ?>" id="fabric_<? echo $i; ?>" value="<? echo $body_part[$row[csf('body_part_id')]].",".$row[csf('construction')].",".$row[csf('composition')].",".$row[csf('gsm_weight')];?>" readonly/>
         <input class="text_boxes" type="hidden" style="width:300px;"  name="fabric_cost_id_<? echo $i; ?>" id="fabric_cost_id_<? echo $i; ?>" value="<? echo $row[csf('id')];?>" readonly/>
        </td>
	  	<td width="150">
        <? echo $color_library[$row[csf('fabric_color_id')]];?>
        <input class="text_boxes" type="hidden" style="width:150px;"  name="color_<? echo $i; ?>" id="color_<? echo $i; ?>" value="<? echo $row[csf('fabric_color_id')];?>" readonly/>
        </td>
	  	<td width="100" align="right">
		<? echo $row[csf('fin_fab_qnty')];?>
        </td>
	  	<td width="100"><input class="text_boxes" type="text" style="width:100px;"  name="trims_<? echo $i; ?>" id="trims_<? echo $i; ?>" value="<? echo $dtm_arr[$row[csf('id')]][$row[csf('fabric_color_id')]] ?>" onDblClick="trims_popup('fabric_booking_controller.php?action=trims_popup','Trims Item',<? echo $i ?>)" readonly/></td>
	  </tr>
	  <? $i++;

	  } ?>
	</tbody>
	</table>
</div>
</body>
<script src="../../../includes/functions_bottom.js" type="text/javascript"></script>
</html>
<?
}


if($action=="trims_popup")
{
	echo load_html_head_contents("DTM Search","../../../", 1, 1, $unicode);
	extract($_REQUEST);
	?>
<script>
function fnc_fabric_dye_to_match( operation )
{

	var job_no=$('#txt_job_no').val();
	var booking_no=$('#txt_booking_no').val();
	var selected_no=$('#txt_order_no_id').val();
	var fabric=$('#fabric').val();
	var color=$('#color').val();
	var fabric_cost_id=$('#fabric_cost_id').val();
	var index=$('#index').val();

	    var row_num=$('#tbl_trims_dyes_match tbody tr').length;
		var data_all="";
		for (var i=1; i<=row_num; i++)
		{

			data_all=data_all+get_submitted_data_string('trim_group_'+i+'*pre_cost_trim_cost_id_'+i+'*dyeqty_'+i+'*color_'+i,"../../../",i);

		}
		//alert(data_all); return;
		var data="action=save_update_delete_dye_to_match&operation="+operation+'&total_row='+row_num+data_all+'&booking_no='+booking_no+'&fabric='+fabric+'&color='+color+'&fabric_cost_id='+fabric_cost_id;
		freeze_window(operation);
		http.open("POST","fabric_booking_controller.php",true);
		http.setRequestHeader("Content-type","application/x-www-form-urlencoded");
		http.send(data);
		http.onreadystatechange = fnc_fabric_booking_terms_condition_reponse;
}

function fnc_fabric_booking_terms_condition_reponse()
{

	if(http.readyState == 4)
	{
	        var reponse=trim(http.responseText).split('**');
			 if(trim(reponse[0])=='approved')
			 {
				 alert("This booking is approved");
				 release_freezing();
				 return;
			 }
			if (reponse[0].length>2) reponse[0]=10;
			release_freezing();
			if(reponse[0]==0 || reponse[0]==1)
			{
				var index=$('#index').val();
				parent.document.getElementById('trims_'+index).value=reponse[1];
				parent.emailwindow.hide();
			}
	}
}
</script>
<?
$lib_item_group_arr=return_library_array( "select item_name, id from lib_item_group where item_category=4 and is_deleted=0  and  status_active=1 order by item_name", "id", "item_name");

$dtm_arr=array();
$dtm_arr_item_color=array();
$sql=sql_select("select pre_cost_fabric_cost_id,fabric_color,precost_trim_cost_id,item_color,sum(qty) as qty from wo_dye_to_match where booking_no='$booking_no' and pre_cost_fabric_cost_id='$fabric_cost_id' group by pre_cost_fabric_cost_id,fabric_color,item_color,precost_trim_cost_id");

foreach($sql as $row){
	$dtm_arr[$row[csf('pre_cost_fabric_cost_id')]][$row[csf('fabric_color')]][$row[csf('precost_trim_cost_id')]]=$row[csf('qty')];
	$dtm_arr_item_color[$row[csf('pre_cost_fabric_cost_id')]][$row[csf('fabric_color')]][$row[csf('precost_trim_cost_id')]]=$row[csf('item_color')];
}
$trims_matches_sql=sql_select("select a.id,a.job_no,a.trim_group,a.description,a.cons_uom FROM wo_pre_cost_trim_cost_dtls a, wo_pre_cost_trim_co_cons_dtls b,  wo_booking_dtls c
			WHERE
			a.job_no=b.job_no and
			a.job_no=c.job_no and
			a.id=b.wo_pre_cost_trim_cost_dtls_id and
			b.po_break_down_id=c.po_break_down_id and
			c.booking_no ='$booking_no' and
			b.po_break_down_id in($selected_no)
			group by a.id,a.job_no,a.trim_group,a.description,a.cons_uom
			");

$condition= new condition();
					if(str_replace("'","",$job_no) !=''){
					$condition->job_no("='$job_no'");
					}
					if(str_replace("'","",$selected_no) !=''){
						$condition->po_id("in($selected_no)");
					}
					$condition->init();
					$trim= new trims($condition);
					//echo $trim->getQuery();
					$totalqtyarray_arr=$trim->getQtyArray_by_jobAndPrecostdtlsid();
?>
</head>
<body>
<div align="center" style="width:100%;" >
 <? echo load_freeze_divs ("../../../",$permission);  ?>
<fieldset>
<form id="dtm_1">
<input type="hidden" id="txt_job_no" name="txt_job_no" value="<? echo $job_no;  ?>"/>
<input type="hidden" id="txt_booking_no" name="txt_booking_no" value="<? echo $booking_no;  ?>"/>
<input type="hidden" id="txt_order_no_id" name="txt_order_no_id" value="<? echo $selected_no;  ?>"/>
<input type="hidden" id="fabric" name="txt_order_no_id" value="<? echo $fabric;  ?>"/>
<input type="hidden" id="color" name="color" value="<? echo $color;  ?>"/>
<input type="hidden" id="fabric_cost_id" name="fabric_cost_id" value="<? echo $fabric_cost_id;  ?>"/>
<input type="hidden" id="index" name="index" value="<? echo $index;  ?>"/>
	<table width="700" cellspacing="0" class="rpt_table" border="0" id="tbl_trims_dyes_match" rules="all">
	<thead>
	  <tr>
		<th width="40">S/L</th>
		<th width="150">Item Group</th>
		<th width="150">Item Color</th>
        <th width="150">Item Driscription</th>
		<th width="100">Req. Qty.</th>
		<th width="60">Uom</th>
        <th width="60">Dye Qnty</th>
	  </tr>
	</thead>
	<tbody>
	<?

	$i=1;
	foreach($trims_matches_sql as $row)
	 {
	 $item_color=$dtm_arr_item_color[$fabric_cost_id][$color][$row[csf('id')]];
	 if($item_color==""){
		 $item_color=$color;
	 }
	 ?>
	  <tr>
	  	<td width="40"><? echo $i; ?></td>
	  	<td width="150">
        <? echo $lib_item_group_arr[$row[csf('trim_group')]];?>
        <input class="text_boxes" type="hidden" style="width:150px;"  name="trim_group_<? echo $i; ?>" id="trim_group_<? echo $i; ?>" value="<? echo $row[csf('trim_group')];?>" readonly/>
         <input class="text_boxes" type="hidden" style="width:150px;"  name="pre_cost_trim_cost_id_<? echo $i; ?>" id="pre_cost_trim_cost_id_<? echo $i; ?>" value="<? echo $row[csf('id')];?>" readonly/>
        </td>
	  	<td width="150">
        <? //echo $color_library[$color];?>
        <input class="text_boxes" type="text" style="width:150px;"  name="color_<? echo $i; ?>" id="color_<? echo $i; ?>" value="<? echo $color_library[$item_color];?>"/>
        </td>
	  	<td width="120">
		<? echo $row[csf('description')];?>
        </td>
	  	<td width="100">
        <input class="text_boxes_numeric" type="text" style="width:100px;"  name="reqqty_<? echo $i; ?>" id="reqqty_<? echo $i; ?>" value="<? echo $totalqtyarray_arr[$row[csf('job_no')]][$row[csf('id')]]; ?>" readonly/>
        </td>
        <td width="60">
        <input class="text_boxes" type="text" style="width:60px;"  name="uom_<? echo $i; ?>" id="uom_<? echo $i; ?>" value="<? echo $unit_of_measurement[$row[csf('cons_uom')]]; ?>" readonly/>
        </td>
        <td width="60">
        <input class="text_boxes_numeric" type="text" style="width:60px;"  name="dyeqty_<? echo $i; ?>" id="dyeqty_<? echo $i; ?>" value="<? echo $dtm_arr[$fabric_cost_id][$color][$row[csf('id')]] ?>"/>
        </td>
	  </tr>
	  <? $i++;

	  } ?>
	</tbody>
	</table>
    </form>
    <table width="650" cellspacing="0" class="" border="0">
        <tr>
            <td align="center" height="15" width="100%"> </td>
        </tr>
        <tr>
            <td align="center" width="100%" class="button_container">
            <?
            echo load_submit_buttons( $permission, "fnc_fabric_dye_to_match", 0,0 ,"reset_form('dtm_1','','','','')",1) ;
            ?>
            </td>
        </tr>
    </table>
    </fieldset>
</div>
</body>
<script src="../../../includes/functions_bottom.js" type="text/javascript"></script>
</html>
<?
}

if($action=="save_update_delete_dye_to_match")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	if ($operation==0)
	{
		$con = connect();
		if($db_type==0)
		{
			mysql_query("BEGIN");
		}
		$booking_id=return_field_value( "id", "wo_booking_mst","booking_no ='$booking_no'");

		$is_approved=0;
		$sql=sql_select("select is_approved from wo_booking_mst where booking_no='$booking_no'");
		foreach($sql as $row){
			if($row[csf('is_approved')]==3){
				$is_approved=1;
			}else{
				$is_approved=$row[csf('is_approved')];
			}
		}
		if($is_approved==1){
			echo "approved**".str_replace("'","",$txt_booking_no);
			disconnect($con);die;
		}
				//var data="action=save_update_delete_dye_to_match&operation="+operation+'&total_row='+row_num+data_all+'&booking_no='+booking_no+'&fabric='+fabric+'&color='+color;
				//data_all=data_all+get_submitted_data_string('trim_group_'+i+'*pre_cost_trim_cost_id_'+i+'*dyeqty_'+i,"../../../",i);

		if  ( check_table_status( $_SESSION['menu_id'], 1 )==0 ) { echo "15**0"; disconnect($con);die;}
		$id=return_next_id( "id", "wo_dye_to_match", 1 ) ;
		$field_array="id,booking_id,booking_no,pre_cost_fabric_cost_id,fabric_color,item_color,precost_trim_cost_id,item_group,qty";
		$total_dye_qty=0;
		$new_array_color=array();
		for ($i=1;$i<=$total_row;$i++)
		{
			$trim_group="trim_group_".$i;
			$pre_cost_trim_cost_id="pre_cost_trim_cost_id_".$i;
			$dyeqty="dyeqty_".$i;
			$item_color="color_".$i;
			if(str_replace("'","",$$item_color)!="")
			{
				if (!in_array(str_replace("'","",$$item_color),$new_array_color)){
					$color_id = return_id( str_replace("'","",$$item_color), $color_library, "lib_color", "id,color_name","86");
					$new_array_color[$color_id]=str_replace("'","",$$item_color);
				}
				else $color_id =  array_search(str_replace("'","",$$item_color), $new_array_color);
			}
			else $color_id=0;
			
			if ($i!=1) $data_array .=",";
			$data_array .="(".$id.",".$booking_id.",'".$booking_no."','".$fabric_cost_id."','".$color."','".$color_id."',".$$pre_cost_trim_cost_id.",".$$trim_group.",".$$dyeqty.")";
			$total_dye_qty+=str_replace("'"," ",$$dyeqty);
			$id=$id+1;
		}
		$rID_de3=execute_query( "delete from wo_dye_to_match where  pre_cost_fabric_cost_id ='".$fabric_cost_id."' and fabric_color= '".$color."'",0);
		$rID=sql_insert("wo_dye_to_match",$field_array,$data_array,1);
		check_table_status( $_SESSION['menu_id'],0);
		if($db_type==0)
		{
			if($rID ){
			mysql_query("COMMIT");
			echo "0**".$total_dye_qty;
			}
			else{
			mysql_query("ROLLBACK");
			echo "10**".$total_dye_qty;
			}
		}

		if($db_type==2 || $db_type==1 )
		{
			if($rID ){
			oci_commit($con);
			echo "0**".$total_dye_qty;
			}
			else{
			oci_rollback($con);
			echo "10**".$total_dye_qty;
			}
		}
		disconnect($con);
		die;
	}
}


if($action=="rmg_process_loss_popup")
{
	echo load_html_head_contents("Order Search","../../../", 1, 1, $unicode);
	extract($_REQUEST);
?>
	<script>
function js_set_value_set()
{

	  var cutting_per=$('#cutting_per').val();
	  if(cutting_per=="")
	  {
		cutting_per=0;
	  }

	  var embbroidery_per=$('#embbroidery_per').val();
	  if(embbroidery_per=="")
	  {
		embbroidery_per=0;
	  }

	  var printing_per=$('#printing_per').val();
	  if(printing_per=="")
	  {
		printing_per=0;
	  }

	  var wash_per=$('#wash_per').val();
	  if(wash_per=="")
	  {
		wash_per=0;
	  }

	  var sew_per=$('#sew_per').val();
	  if(sew_per=="")
	  {
		sew_per=0;
	  }

	  var fin_per=$('#fin_per').val();
	  if(fin_per=="")
	  {
		fin_per=0;
	  }

	var knitt_per=$('#knitt_per').val();
	  if(knitt_per=="")
	  {
		knitt_per=0;
	  }

	  var dying_per=$('#dying_per').val();
	  if(dying_per=="")
	  {
		dying_per=0;
	  }

	  var extracutt_per=$('#extracutt_per').val();
	  if(extracutt_per=="")
	  {
		extracutt_per=0;
	  }

	  var other_per=$('#other_per').val();
	  if(other_per=="")
	  {
		other_per=0;
	  }

	  var neck_sleev_printing_per=$('#neck_sleev_printing_per').val();
	  if(neck_sleev_printing_per=="")
	  {
		neck_sleev_printing_per=0;
	  }

	  var gmt_other_per=$('#gmt_other_per').val();
	  if(gmt_other_per=="")
	  {
		gmt_other_per=0;
	  }


	  var yarn_dyeing_per=$('#yarn_dyeing_per').val();
	  if(yarn_dyeing_per=="")
	  {
		yarn_dyeing_per=0;
	  }

	  var all_over_print_per=$('#all_over_print_per').val();
	  if(all_over_print_per=="")
	  {
		all_over_print_per=0;
	  }


	  var lay_wash_per=$('#lay_wash_per').val();
	  if(lay_wash_per=="")
	  {
		lay_wash_per=0;
	  }

	  var gmtfinish_per=$('#gmtfinish_per').val();
	  if(gmtfinish_per=="")
	  {
		gmtfinish_per=0;
	  }




	 var processloss_breck_down=cutting_per+'_'+embbroidery_per+'_'+printing_per+'_'+wash_per+'_'+sew_per+'_'+fin_per+'_'+knitt_per+'_'+dying_per+'_'+extracutt_per+'_'+other_per+'_'+neck_sleev_printing_per+'_'+gmt_other_per+'_'+yarn_dyeing_per+'_'+all_over_print_per+'_'+lay_wash_per+'_'+gmtfinish_per;
	 document.getElementById('processloss_breck_down').value=processloss_breck_down;
	 parent.emailwindow.hide();
}
    </script>

</head>

<body>
<div align="center" style="width:100%;" >
 <? echo load_freeze_divs ("../../../",$permission);  ?>
 <?
 $data=explode("_",$processloss_breck_down);
 ?>
<fieldset>
    <form autocomplete="off">
    <input style="width:60px;" type="hidden" class="text_boxes"  name="processloss_breck_down" id="processloss_breck_down" />
    <table width="180" class="rpt_table" border="1" rules="all">
               <tr>
                <td width="130">
               Cut Panel rejection <!--  Extra Cutting %  breack Down 8-->
                </td>
                <td>
                <input style="width:60px;" type="text" class="text_boxes_numeric"  name="extracutt_per" id="extracutt_per" value="<? echo $data[8];  ?>"  />
                </td>
                </tr>
                <tr>
                <td width="130">
                 Chest Printing <!-- Printing % breack Down 2-->
                </td>
                <td>
                <input style="width:60px;" type="text" class="text_boxes_numeric"  name="printing_per" id="printing_per" value="<? echo $data[2];  ?>" />
                </td>
                </tr>


                <tr>
                <td width="130">
                 Neck/Sleeve Printing <!-- new breack Down 10-->
                </td>
                <td>
                <input style="width:60px;" type="text" class="text_boxes_numeric"  name="neck_sleev_printing_per" id="neck_sleev_printing_per" value="<? echo $data[10];  ?>" />
                </td>
                </tr>


                <tr>
                <td width="130">
                Embroidery  <!-- Embroidery  % breack Down 1-->
                </td>
                <td>
                <input style="width:60px;" type="text" class="text_boxes_numeric"  name="embbroidery_per" id="embbroidery_per" value="<? echo $data[1];  ?>"  />
                </td>
                </tr>


                <tr>
                <td width="130">
                Sewing/Input <!-- Sewing % breack Down 4-->
                </td>
                <td>
                <input style="width:60px;" type="text" class="text_boxes_numeric"  name="sew_per" id="sew_per" value="<? echo $data[4];  ?>" />
                </td>
                </tr>

                <tr>
                <td width="130">
                Garments Wash  <!-- Washing % breack Down 3-->
                </td>
                <td>
                <input style="width:60px;" type="text" class="text_boxes_numeric"  name="wash_per" id="wash_per"  value="<? echo $data[3];  ?>" />
                </td>
                </tr>

                <tr>
                <td width="130">
                Gmts Finishing  <!-- Washing % breack Down 3-->
                </td>
                <td>
                <input style="width:60px;" type="text" class="text_boxes_numeric"  name="gmtfinish_per" id="gmtfinish_per"  value="<? echo $data[15];  ?>" />
                </td>
                </tr>


                <tr>
                <td width="130">
                 Others  <!-- New breack Down 11-->
                </td>
                <td>
                <input style="width:60px;" type="text" class="text_boxes_numeric"  name="gmt_other_per" id="gmt_other_per" value="<? echo $data[11];  ?>"  />
                </td>
                </tr>

                <tr>
                <td width="130">
                 Knitting   <!-- Knitting % breack Down 6-->
                </td>
                <td>
                <input style="width:60px;" type="text" class="text_boxes_numeric"  name="knitt_per" id="knitt_per" value="<? echo $data[6];  ?>"  />
                </td>
                </tr>

                <tr>
                <td width="130">
                 Yarn Dyeing   <!-- New breack Down 12-->
                </td>
                <td>
                <input style="width:60px;" type="text" class="text_boxes_numeric"  name="yarn_dyeing_per" id="yarn_dyeing_per" value="<? echo $data[12];  ?>"  />
                </td>
                </tr>

                <tr>
                <td width="130">
                Dyeing & Finishing   <!-- Finishing % breack Down 5-->
                </td>
                <td>
                <input style="width:60px;" type="text" class="text_boxes_numeric"  name="fin_per" id="fin_per" value="<? echo $data[5];  ?>"  />
                </td>
                </tr>


                <tr>
                <td width="130">
                All Over Print  <!-- New breack Down 13-->
                </td>
                <td>
                <input style="width:60px;" type="text" class="text_boxes_numeric"  name="all_over_print_per" id="all_over_print_per" value="<? echo $data[13];  ?>"  />
                </td>
                </tr>

                <tr>
                <td width="130">
                Lay Wash (Fabric)  <!-- New breack Down 14-->
                </td>
                <td>
                <input style="width:60px;" type="text" class="text_boxes_numeric"  name="lay_wash_per" id="lay_wash_per" value="<? echo $data[14];  ?>"  />
                </td>
                </tr>


                <tr>
                <td width="130">
                 Dying  <!--breack Down 7-->
                </td>
                <td>
                <input style="width:60px;" type="text" class="text_boxes_numeric"  name="dying_per" id="dying_per" value="<? echo $data[7];  ?>"  />
                </td>
                </tr>
                <tr>
                <td width="130">
                 Cutting (Febric) <!-- Cutting % breack Down 0-->
                </td>
                <td>
                <input style="width:60px;" type="text" class="text_boxes_numeric"  name="cutting_per" id="cutting_per" value="<? echo $data[0];  ?>" />
                </td>
                </tr>
                <tr>
                <td width="130">
                 Others <!--breack Down 9-->
                </td>
                <td>
                <input style="width:60px;" type="text" class="text_boxes_numeric"  name="other_per" id="other_per" value="<? echo $data[9];  ?>"  />
                </td>
                </tr>

                <tr>
               <td align="center"  class="button_container" colspan="2">
			    <input type="button" class="formbutton" value="Close" onClick="js_set_value_set()"/>
                 </td>
                </tr>
           </table>
    </form>
</fieldset>
</div>
</body>
<script src="../../../includes/functions_bottom.js" type="text/javascript"></script>
</html>
<?
}

if($action=="save_update_delete_fabric_booking_terms_condition")
{
$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));

	if ($operation==0)  // Insert Here
	{
		$con = connect();
		if($db_type==0)
		{
			mysql_query("BEGIN");
		}

		if  ( check_table_status( $_SESSION['menu_id'], 1 )==0 ) { echo "15**0"; disconnect($con);die;}
		 $id=return_next_id( "id", "wo_booking_terms_condition", 1 ) ;
		 $field_array="id,booking_no,terms";
		 for ($i=1;$i<=$total_row;$i++)
		 {
			 $termscondition="termscondition_".$i;
			if ($i!=1) $data_array .=",";
			$data_array .="(".$id.",".$txt_booking_no.",".$$termscondition.")";
			$id=$id+1;
		 }
		// echo  $data_array;
		$rID_de3=execute_query( "delete from wo_booking_terms_condition where  booking_no =".$txt_booking_no."",0);

		 $rID=sql_insert("wo_booking_terms_condition",$field_array,$data_array,1);
		 check_table_status( $_SESSION['menu_id'],0);
		if($db_type==0)
		{
			if($rID ){
				mysql_query("COMMIT");
				echo "0**".$new_booking_no[0];
			}
			else{
				mysql_query("ROLLBACK");
				echo "10**".$new_booking_no[0];
			}
		}

		if($db_type==2 || $db_type==1 )
		{
			if($rID ){
				oci_commit($con);
				echo "0**".$new_booking_no[0];
			}
			else{
				oci_rollback($con);
				echo "10**".$new_booking_no[0];
			}
		}
		disconnect($con);
		die;
	}
}
if($action=="show_fabric_booking_report_gr")
{
	extract($_REQUEST);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
	$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
	if(str_replace("'","",$cbo_booking_gr)!="")
	{
		$booking_check_array=explode(",",$cbo_booking_gr);
	}
	$cbo_booking_gr_arr=array();
	if(count($booking_check_array)>0)
	{
		foreach($booking_check_array as $val)
		{
			$cbo_booking_gr_arr[$val]=$val;
		}
	}

	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	//$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$marchentrArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info ","id","team_member_name");

	//$fac_marchentrArr = return_library_array("select id,factory_marchant from lib_mkt_team_member_info ","id","factory_marchant");
	$po_number=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number");

	$brand_arr=return_library_array( "select id, brand_name from lib_brand", "id", "brand_name");
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$location_name_arr=return_library_array( "select id,location_name from lib_location",'id','location_name');
	//$po_qnty_tot=return_field_value( "sum(plan_cut) as po_tot_qnty", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")","po_tot_qnty");

	//echo "select sum(plan_cut) as po_tot_qnty from wo_po_break_down where id in(".str_replace("'","",$txt_order_no_id).") <br>";

	//$po_qnty_tot1=return_field_value( "sum(po_quantity)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	$pro_sub_dept_array=return_library_array( "select id,sub_department_name from lib_pro_sub_deparatment",'id','sub_department_name');
	?>
	<div style="width:1330px" align="center">
    <?php
//echo "select max(b.approved_no) as approved_no,a.is_approved, count(id) as revised_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 group by a.is_approved";
$nameArray_approved = sql_select("select max(b.approved_no) as approved_no,a.is_approved, count(b.id) as revised_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 group by a.is_approved");
list($nameArray_approved_row) = $nameArray_approved;
$nameArray_approved_date = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
list($nameArray_approved_date_row) = $nameArray_approved_date;
$nameArray_approved_comments = sql_select("select b.comments as comments from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
list($nameArray_approved_comments_row) = $nameArray_approved_comments;
?>

                <?
				$job_no='';
				$total_set_qnty=0;
				$colar_excess_percent=0;
				$cuff_excess_percent=0;
				$rmg_process_breakdown=0;
                /*$nameArray=sql_select( "select a.booking_no,a.booking_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.delivery_date,a.po_break_down_id,a.colar_excess_percent,a.cuff_excess_percent,a.delivery_date,a.is_apply_last_update,a.fabric_source,a.rmg_process_breakdown,a.insert_date,a.update_date,b.job_no,b.buyer_name, b.style_ref_no ,b.gmts_item_id,b.order_uom,b.total_set_qnty,b.style_description,b.season,b.product_dept,b.product_code,b.pro_sub_dep,b.dealing_marchant
				from wo_booking_mst a, wo_po_details_master b
				where  a.job_no=b.job_no and a.booking_no=$txt_booking_no");*/
				$booking_po_id=str_replace("'","",$txt_order_no_id);


				if($db_type==0)
				{
					$nameArray=sql_select( "select a.booking_no,a.uom, a.booking_date, a.supplier_id, a.is_approved, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.po_break_down_id, a.colar_excess_percent, a.cuff_excess_percent, a.delivery_date, a.is_apply_last_update, a.pay_mode, a.fabric_source, a.rmg_process_breakdown, a.insert_date, a.update_date, a.item_category, b.job_no, b.buyer_name, b.style_ref_no, b.gmts_item_id, b.order_uom, b.total_set_qnty, b.style_description, b.agent_name, b.product_dept, b.product_code, b.pro_sub_dep, b.dealing_marchant, b.factory_marchant, group_concat(c.po_number) as po_number_all, MIN(c.pub_shipment_date) as pub_shipment_date, group_concat(DATEDIFF(c.pub_shipment_date,c.po_received_date)) as date_diff, MIN(c.pub_shipment_date) as  pub_shipment_date, MIN(c.insert_date) as po_insert_date, group_concat(c.shiping_status) as shiping_status, sum(c.po_quantity*b.total_set_qnty) as po_qnty_pce, sum(c.plan_cut*b.total_set_qnty) as plan_cut
				from wo_booking_mst a, wo_po_details_master b, wo_po_break_down c
				where  a.job_no=b.job_no and b.job_no=c.job_no_mst and a.booking_no=$txt_booking_no and c.id in($booking_po_id)
				group by a.booking_no,a.uom, a.booking_date, a.supplier_id, a.is_approved, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.po_break_down_id, a.colar_excess_percent, a.cuff_excess_percent, a.delivery_date, a.is_apply_last_update, a.fabric_source, a.pay_mode, a.rmg_process_breakdown, a.insert_date, a.update_date, a.item_category, b.job_no, b.buyer_name, b.style_ref_no, b.gmts_item_id, b.order_uom, b.total_set_qnty, b.style_description, b.agent_name, b.product_dept, b.product_code, b.pro_sub_dep, b.dealing_marchant, b.factory_marchant");
				}
				else//LISTAGG(cast(b.id as varchar2(4000)), ',') WITHIN GROUP (ORDER BY b.id) as po_id
				{
					$nameArray=sql_select( "select a.booking_no,a.uom, a.booking_date, a.supplier_id,a.brand_id, a.is_approved, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.po_break_down_id, a.colar_excess_percent, a.cuff_excess_percent, a.delivery_date, a.is_apply_last_update, a.fabric_source, a.pay_mode, a.rmg_process_breakdown, a.insert_date, a.update_date, a.item_category, b.job_no, b.buyer_name, b.style_ref_no, b.gmts_item_id, b.order_uom, b.total_set_qnty, b.style_description, b.agent_name, b.product_dept, b.product_code, b.pro_sub_dep, b.dealing_marchant, b.factory_marchant, LISTAGG(cast(c.po_number as varchar2(4000)), ', ') WITHIN GROUP (ORDER BY c.po_number) as po_number_all, LISTAGG(cast(c.pub_shipment_date as varchar2(4000)), ',') WITHIN GROUP (ORDER BY c.pub_shipment_date)  as pub_shipment_date, LISTAGG(cast((c.pub_shipment_date-c.po_received_date) as varchar2(4000)), ',') WITHIN GROUP (ORDER BY c.pub_shipment_date,c.po_received_date) as  date_diff, MIN(c.pub_shipment_date) as  pub_shipment_date, MIN(c.insert_date) as po_insert_date, LISTAGG(cast(c.shiping_status as varchar2(4000)), ',') WITHIN GROUP (ORDER BY c.shiping_status) as shiping_status, sum(c.po_quantity*b.total_set_qnty) as po_qnty_pce,sum(c.plan_cut*b.total_set_qnty) as plan_cut
				from wo_booking_mst a, wo_po_details_master b, wo_po_break_down c
				where  a.job_no=b.job_no and b.job_no=c.job_no_mst and a.booking_no=$txt_booking_no and c.id in($booking_po_id)
				group by a.booking_no,a.uom, a.booking_date, a.supplier_id,a.brand_id, a.is_approved, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.po_break_down_id, a.colar_excess_percent, a.cuff_excess_percent, a.delivery_date, a.is_apply_last_update, a.fabric_source, a.pay_mode, a.rmg_process_breakdown, a.insert_date, a.update_date, a.item_category, b.job_no, b.buyer_name, b.style_ref_no, b.gmts_item_id, b.order_uom, b.total_set_qnty, b.style_description, b.agent_name, b.product_dept, b.product_code, b.pro_sub_dep, b.dealing_marchant, b.factory_marchant");
				}

				/*echo "select sum(order_quantity) as order_quantity,sum(plan_cut_qnty) as plan_cut_qnty
				from wo_po_color_size_breakdown where po_break_down_id in($booking_po_id) <br>";
				echo "select sum(plan_cut) as po_tot_qnty ";*/
				//$po_qnty_tot=return_field_value( "sum(plan_cut) as po_tot_qnty", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")","po_tot_qnty");

				$po_plancut_sql=sql_select("select sum(order_quantity) as order_quantity,sum(plan_cut_qnty) as plan_cut_qnty
				from wo_po_color_size_breakdown where po_break_down_id in($booking_po_id) and status_active=1 and is_deleted=0");

				//echo $po_plancut_sql;die;




				$po_id_all=$nameArray[0][csf('po_break_down_id')];
				$item_cat_id=$nameArray[0][csf('item_category')];
				$is_approved=$nameArray[0][csf('is_approved')];

				//$po_num_arr=return_library_array("select id,po_number from wo_po_break_down where id in($po_id_all)",'id','po_number');
				$sql_po=sql_select("select id,po_number,is_confirmed from wo_po_break_down where id in($po_id_all)");
				//echo "select id,po_number,is_confirmed from wo_po_break_down where id in($po_id_all)";

				foreach($sql_po as $row)
				{
					$po_num_arr[$row[csf('id')]]=$row[csf('po_number')];
					$po_status_arr[$row[csf('id')]]=$order_status[$row[csf('is_confirmed')]];
				}

				$tna_start_sql=sql_select( "select id,po_number_id,
								(case when task_number=31 then task_start_date else null end) as fab_booking_start_date,
								(case when task_number=31 then task_finish_date else null end) as fab_booking_end_date,
								(case when task_number=60 then task_start_date else null end) as knitting_start_date,
								(case when task_number=60 then task_finish_date else null end) as knitting_end_date,
								(case when task_number=61 then task_start_date else null end) as dying_start_date,
								(case when task_number=61 then task_finish_date else null end) as dying_end_date,
								(case when task_number=73 then task_start_date else null end) as finishing_start_date,
								(case when task_number=73 then task_finish_date else null end) as finishing_end_date,
								(case when task_number=84 then task_start_date else null end) as cutting_start_date,
								(case when task_number=84 then task_finish_date else null end) as cutting_end_date,
								(case when task_number=86 then task_start_date else null end) as sewing_start_date,
								(case when task_number=86 then task_finish_date else null end) as sewing_end_date,
								(case when task_number=110 then task_start_date else null end) as exfact_start_date,
								(case when task_number=110 then task_finish_date else null end) as exfact_end_date,
								(case when task_number=47 then task_start_date else null end) as yarn_rec_start_date,
								(case when task_number=47 then task_finish_date else null end) as yarn_rec_end_date,
								(case when task_number=50 then task_start_date else null end) as yarn_issue_start_date,
								(case when task_number=50 then task_finish_date else null end) as yarn_issue_end_date
								from tna_process_mst
								where status_active=1 and po_number_id in($po_id_all)");



				$tnaSql = "select  0 as id,po_number_id,
				min(case when task_number in(60,212,323,178) then task_start_date else null end) as knitting_start_date ,
				max(case when task_number in(60,212,323,178) then task_finish_date else null end) as knitting_end_date
				from tna_process_mst where status_active=1 and po_number_id in($po_id_all) and task_number in(60,212,323,178)
				group by po_number_id";	
				$tnaSql_res=sql_select($tnaSql);
				$tna_date_task_arr=array();	
				foreach($tnaSql_res as $row)
				{
					if($row[csf("knitting_start_date")]!="" && $row[csf("knitting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_start_date']=$row[csf("knitting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_end_date']=$row[csf("knitting_end_date")];
					}
				}



				$tna_fab_start=$tna_knit_start=$tna_dyeing_start=$tna_fin_start=$tna_cut_start=$tna_sewin_start=$tna_exfact_start="";
				foreach($tna_start_sql as $row)
				{
					if($row[csf("fab_booking_start_date")]!="" && $row[csf("fab_booking_start_date")]!="0000-00-00")
					{
						if($tna_fab_start=="")
						{
							$tna_fab_start=$row[csf("fab_booking_start_date")];
						}
						$tna_date_task_arr[$row[csf("po_number_id")]]['fab_booking_start_date']=$row[csf("fab_booking_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['fab_booking_end_date']=$row[csf("fab_booking_end_date")];
					}


					if($row[csf("knitting_start_date")]!="" && $row[csf("knitting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_start_date']=$row[csf("knitting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_end_date']=$row[csf("knitting_end_date")];
					}
					if($row[csf("dying_start_date")]!="" && $row[csf("dying_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['dying_start_date']=$row[csf("dying_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['dying_end_date']=$row[csf("dying_end_date")];
					}
					if($row[csf("finishing_start_date")]!="" && $row[csf("finishing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_start_date']=$row[csf("finishing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_end_date']=$row[csf("finishing_end_date")];
					}
					if($row[csf("cutting_start_date")]!="" && $row[csf("cutting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_start_date']=$row[csf("cutting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_end_date']=$row[csf("cutting_end_date")];
					}
					if($row[csf("sewing_start_date")]!="" && $row[csf("sewing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_start_date']=$row[csf("sewing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_end_date']=$row[csf("sewing_end_date")];
					}
					if($row[csf("exfact_start_date")]!="" && $row[csf("exfact_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_start_date']=$row[csf("exfact_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_end_date']=$row[csf("exfact_end_date")];
					}
					if($row[csf("yarn_rec_start_date")]!="" && $row[csf("yarn_rec_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_start_date']=$row[csf("yarn_rec_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_end_date']=$row[csf("yarn_rec_end_date")];
					}
					if($row[csf("yarn_issue_start_date")]!="" && $row[csf("yarn_issue_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['yarn_issue_start_date']=$row[csf("yarn_issue_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['yarn_issue_end_date']=$row[csf("yarn_issue_end_date")];
					}
				}

				?>
           <!--    Header Company Information         -->
           <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black" >
               <tr>
                   <td width="100">
                   <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
                   </td>
                   <td width="1250">
                        <table width="100%" cellpadding="0" cellspacing="0"  >
                            <tr>
                                <td align="center" style="font-size:20px;">
                                  <?php
echo $company_library[$cbo_company_name];
?>
                                </td>
                                 <td rowspan="3" width="250" id="barcode_img_id">

                                 </td>
                                <td rowspan="3" width="250">

                                   <span style="font-size:18px"><b> Job No:&nbsp;&nbsp;<? echo trim($txt_job_no,"'"); ?></b></span><br/>
                                    <?
                                    if($nameArray_approved_row[csf('approved_no')]==1 && $nameArray_approved_row[csf('is_approved')]==0){
                                        ?>
                                        <b> Revised No :  <? echo $nameArray_approved_row[csf('revised_no')]; //echo $nameArray_approved_row[csf('approved_no')]; ?></b>
                                          <br/>
                                          Approved Date: <? echo $nameArray_approved_date_row[csf('approved_date')]; ?>
                                        <?

                                    }
                                     if($nameArray_approved_row[csf('approved_no')]>1 && $nameArray_approved_row[csf('is_approved')]==0)
                                     {
                                     ?>
                                     <b> Revised No: <? echo $nameArray_approved_row[csf('revised_no')];//echo $nameArray_approved_row[csf('approved_no')]-1; ?></b>
                                      <br/>
                                      Approved Date: <? echo $nameArray_approved_date_row[csf('approved_date')]; ?>
                                      <?
                                     }
                                    ?>
                                    <?
                                    if($nameArray_approved_row[csf('approved_no')]>1 && ($nameArray_approved_row[csf('is_approved')]==1 || $nameArray_approved_row[csf('is_approved')]==3))
                                     {
                                     ?>
                                     <b> Revised No: <? echo $nameArray_approved_row[csf('revised_no')]-1;//echo $nameArray_approved_row[csf('approved_no')]-1; ?></b>
                                      <br/>
                                      Approved Date: <? echo $nameArray_approved_date_row[csf('approved_date')]; ?>
                                      <?
                                     }
                                    ?>
                                </td>
                            </tr>
                            <tr>
                                <td align="center" style="font-size:14px">
                                <?
                                $companyArray=sql_select( "select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
                                //$location=return_field_value("location_name","lib_location","id=$data[3]" );
                                //$nameArray=sql_select("select location_name from wo_po_details_master where job_no=$txt_job_no");
                                if($txt_job_no!="")
                                {
                                 $location=return_field_value( "location_name", "wo_po_details_master","job_no=$txt_job_no");
                                }
                                else
                                {
                                $location="";
                                }

                                foreach ($companyArray as $result)
                                {
                                 echo  $location_name_arr[$location];
                                ?>

                                   <!-- Plot No: <? //echo $result[csf('plot_no')]; ?>
                                    Level No: <? //echo $result[csf('level_no')]?>
                                    Road No: <? //echo $result[csf('road_no')]; ?>
                                    Block No: <? //echo $result[csf('block_no')];?>
                                    City No: <? //echo $result[csf('city')];?>
                                    Zip Code: <? //echo $result[csf('zip_code')]; ?>
                                    Province No: <?php //echo $result[csf('province')];?>
                                    Country: <? //echo $country_arr[$result[csf('country_id')]]; ?> --><br>
                                    Email Address: <? echo $result[csf('email')];?>
                                    Website No: <? echo $result[csf('website')]; ?>

                                    <?

                                }

                                ?>
                                   </td>
                                </tr>
                                <tr>
                                <td align="center" style="font-size:20px">
                                    <strong><? if($report_title !=""){ echo $report_title;} else { echo "General Work Order";} echo " (".$item_category[$item_cat_id].") "; ?> &nbsp; &nbsp;&nbsp;<font style="color:#F00"><? if($is_approved==1) { echo "(Approved)";} else if($is_approved==3){ echo "(Partial Approved)";} else{echo "";};  ?> </font></strong>
                                 </td>
                                </tr>
                          </table>
                    </td>
                </tr>
           </table>
                <?
				//echo $nameArray;die;
				$tna_start_date="";
				foreach ($nameArray as $result)
				{
					$uom_id=$result[csf('uom')];
					//echo $uom_id.'DSD';
					if($result[csf('brand_id')]!=""){$clone_add= "/";
						$brand_name=$clone_add.$brand_arr[$result[csf('brand_id')]];
					}
					else{ echo $brand_name="";}
					$total_set_qnty=$result[csf('total_set_qnty')];
					$agent_name_id=$result[csf('agent_name')];
					$colar_excess_percent=$result[csf('colar_excess_percent')];
				    $cuff_excess_percent=$result[csf('cuff_excess_percent')];
					$rmg_process_breakdown=$result[csf('rmg_process_breakdown')];
					$po_no="";
					$shipment_date="";
					$shiping_status_arr=explode(",",$result[csf('shiping_status')]);
					$shiping_status_arr=array_unique($shiping_status_arr);
					if(count($shiping_status_arr)==1 && $shiping_status_arr[0]==3)
					{

						$shiping_status= "Full shipment";
					}
					else if(count($shiping_status_arr)==1 && $shiping_status_arr[0]==1)
					{
						$shiping_status= "Full Pending";
					}
					else
					{
						$shiping_status= "Partial shipment";
					}

					$varcode_booking_no=$result[csf('booking_no')];
					$po_qnty_tot+=$result[csf('plan_cut')];
					if($agent_name_id) $agent_name=" (".$buyer_name_arr[$agent_name_id].")";
					else $agent_name="";
					$uom_name=$unit_of_measurement[$uom_id];
				?>



            <table width="1330" style="border:1px solid black">
                <tr>
                	<td colspan="6" valign="top" style="font-size:18px; color:#F00"><? if($result[csf('is_apply_last_update')]==2){echo "Booking Info not synchronized with order entry and pre-costing. order entry or pre-costing has updated after booking entry.  Contact to ".$marchentrArr[$result[csf('dealing_marchant')]]; } else{ echo "";} ?></td>
                </tr>
                <tr>
				<td width="150"><span style="font-size:14px"><b>Buyer/Agent/Brand</b></span></td>
                    <td width="300">:&nbsp;<span style="font-size:18px"><b><? echo $buyer_name_arr[$result[csf('buyer_name')]].$agent_name.$brand_name; ?></b></span></td>
                    <td width="150"><span style="font-size:12px"><b>Dept.</b></span></td>
                    <td width="300">:&nbsp;<? echo $product_dept[$result[csf('product_dept')]] ; if($result[csf('product_code')] !=""){ echo " (".$result[csf('product_code')].")";} if($result[csf('pro_sub_dep')] !=0){ echo " (".$pro_sub_dept_array[$result[csf('pro_sub_dep')]].")";}?></td>
                    <td width="150" style="font-size:18px"><b>Booking No </b>   </td>
                    <td style="font-size:18px">:&nbsp;<b><? echo $result[csf('booking_no')];?></b><? echo "(".$fabric_source[$result[csf('fabric_source')]].")"?></td>
                </tr>
                <tr>
                    <td  style="font-size:12px"><b>Garments Item</b></td>
                    <td>:&nbsp;
                    <?
                    $gmts_item_name="";
                    $gmts_item=explode(',',$result[csf('gmts_item_id')]);
                    for($g=0;$g<=count($gmts_item); $g++)
                    {
                    $gmts_item_name.= $garments_item[$gmts_item[$g]].",";
                    }
                    echo rtrim($gmts_item_name,',');
                    ?>
                    </td>
                    <td  style="font-size:12px"><b>Lead Time </b>   </td>
                    <td>:&nbsp;<?  echo rtrim($result[csf('date_diff')],",");?> </td>
                    <td style="font-size:12px"><b>Supplier Name</b>   </td>
                    <td>:&nbsp;<?
					if($result[csf('pay_mode')]==5 || $result[csf('pay_mode')]==3){
					echo $company_library[$result[csf('supplier_id')]];
					}
					else{
					echo $supplier_name_arr[$result[csf('supplier_id')]];
					}
					// echo $supplier_name_arr[$result[csf('supplier_id')]];?>    </td>
                </tr>
                <tr>
                    <td style="font-size:18px"><b>Style Ref.</b>   </td>
                    <td style="font-size:18px">:&nbsp;<b><? echo $result[csf('style_ref_no')];?> </b>   </td>
                    <td style="font-size:12px"><b>Style Des.</b></td>
                    <td >:&nbsp;<? echo $result[csf('style_description')]; $job_no= $result[csf('job_no')];?></td>
                    <td style="font-size:12px"><b>Attention</b></td>
                    <td >:&nbsp;<? echo $result[csf('attention')]; ?></td>
                </tr>
                <tr>
                    <td><span style="font-size:18px"><b>Order Qnty</b></span></td>
                    <td style="font-size:18px">:&nbsp;<b><?  echo $po_plancut_sql[0][csf("order_quantity")]." Pcs";
					//echo number_format($result[csf('po_qnty_pce')],0)." ".$unit_of_measurement[$result[csf('order_uom')]] ; ?></b></td>
                    <td style="font-size:16px"><b>Plan Cut Qty</b></td>
                    <td style="font-size:16px">:&nbsp;<b><?

					    echo $po_plancut_sql[0][csf("plan_cut_qnty")]." Pcs";

					// echo number_format($result[csf('plan_cut')],0)." ".$unit_of_measurement[$result[csf('order_uom')]] ; ?></b></td>
                    <td style="font-size:12px"><b>Factory Merchant</b></td>
                    <td>:&nbsp;<? echo $marchentrArr[$result[csf('factory_marchant')]]; ?></td>
                </tr>
                <tr>
                    <td style="font-size:18px;" valign="top"><b>Order No</b></td>
                    <td style="font-size:18px;" colspan="3" valign="top">:&nbsp;<b><? echo $result[csf('po_number_all')];//echo rtrim($po_no,", "); ?></b></td>
                    <td style="font-size:12px" valign="top"><b>Currency</b></td>
                    <td valign="top">:&nbsp;<? echo $currency[$result[csf('currency_id')]]; $currency_id=$result[csf('currency_id')]; $exchang_rate=$result[csf('exchange_rate')]; ?></td>
                </tr>
            </table>
            <br>
            <table width="100%" style="border:1px solid black" >
                <tr>
                    <td width="150" style="font-size:12px"><b>Booking Release Date</b></td>
                    <td width="300">:&nbsp;
                    <?
                    /*$booking_date=$result[csf('update_date')];
                    if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
                    {
                    	$booking_date=$result[csf('insert_date')];
                    }*/
					$booking_date=$result[csf('booking_date')];
                    echo change_date_format($booking_date,'dd-mm-yyyy','-','');
                    ?>&nbsp;&nbsp;&nbsp;</td>
                    <td  width="150" style="font-size:12px"><b>TNA Start Date</b></td>
                    <td  width="300" >:&nbsp;<? echo change_date_format($tna_fab_start); ?></td>
                    <?
					$daysInHand.=(datediff('d',date('d-m-Y',time()),$result[csf('pub_shipment_date')])-1).",";
					 if($tna_fab_start!="")
					 {
					 	$wo_perpare_after=(datediff('d',$tna_fab_start,$booking_date)-1);
					 }
					 if($wo_perpare_after<1) $prep_caption="Before"; else  $prep_caption="After";
					?>
                    <td width="150" style="font-size:16px"><b>WO Prepared <? echo $prep_caption; ?> </b>   </td>
                    <td style="font-size:18px">:&nbsp;<b>
					<?

					 echo abs($wo_perpare_after).' Days';
					 ?></b>
					</td>
                </tr>
                <tr>
                    <td style="font-size:18px"><b>Delivery Date</b></td>
                    <td style="font-size:18px; font-weight:bold;">:&nbsp;<? if($result[csf('delivery_date')]!="" && $result[csf('delivery_date')]!='0000-00-00') echo change_date_format( $result[csf('delivery_date')]);?></td>
                    <td style="font-size:12px"><b>Shipment Date</b></td>
                    <td > :&nbsp;<? if($result[csf('pub_shipment_date')]!="" && $result[csf('pub_shipment_date')]!='0000-00-00')  echo change_date_format($result[csf('pub_shipment_date')]);//echo rtrim($shipment_date,", "); ?></td>
                    <td style="font-size:18px"><b>Ship.days in Hand</b></td>
                    <td style="font-size:18px"> :&nbsp;<b><? echo rtrim($daysInHand,',').' Days'; ?></b></td>
                </tr>
                <?
                /*
				if($db_type==0)
				{
					$last_update_date=return_field_value("max(date(update_date)) as update_date","wo_booking_dtls","status_active=1 and is_deleted=0 and booking_no=$txt_booking_no","update_date");
				}
				else
				{
					$last_update_date=return_field_value("max(to_char(update_date,'DD-MM-YYYY')) as update_date","wo_booking_dtls","status_active=1 and is_deleted=0 and booking_no=$txt_booking_no","update_date");
				}
				*/
				$last_update_dateA=return_field_value("max(update_date) as update_date","wo_booking_dtls","status_active=1 and is_deleted=0 and booking_no=$txt_booking_no and update_date is not null","update_date");
				//echo "select max(update_date) as update_date from wo_booking_dtls where status_active=1 and is_deleted=0 and booking_no=$txt_booking_no and update_date is not null";			
				//echo $last_update_dateA.'='; 
				if($last_update_dateA!="")
				{
				$last_update_dateAll=date("d-M-Y",strtotime($last_update_dateA));
				}
				else $last_update_dateAll="";
				if($last_update_dateAll!="")
				{
				$last_update_date=$last_update_dateAll;
				}
				else $last_update_date="";
				?>
                <tr>
                    <td style="font-size:18px" title="Date-<? echo date("d-M-Y",strtotime($last_update_dateA));?>"><b>Last Update</b></td>
                    <td style="font-size:18px">:&nbsp;<b><? if($last_update_date!="" && $last_update_date!="0000-00-00") echo change_date_format($last_update_date);?></b></td>
                    <td style="font-size:18px"><b>Ex-factory status</b></td>
                    <td style="font-size:18px">:&nbsp;<b><? echo $shiping_status;?></b></td>
                </tr>
            </table>
            <?
			}
			// motivation end!!

			?>
            <table width="100%" >
            	<tr>
                	<td width="30%" valign="top">
                        <?
                        $rmg_process_breakdown_arr=explode('_',$rmg_process_breakdown)
                        ?>
                        <fieldset id="" >
                        <legend>RMG Process Loss % </legend>
                            <table width="180" class="rpt_table" border="1" rules="all">
                            <?
                            if(number_format($rmg_process_breakdown_arr[8],2)>0)
                            {
                                ?>
                                    <tr>
                                        <td width="130">
                                        Cut Panel rejection <!-- Extra Cutting % breack Down 8-->
                                        </td>
                                        <td align="right">
                                        <?
                                        echo number_format($rmg_process_breakdown_arr[8],2);
                                        ?>
                                        </td>
                                    </tr>
                                <?
                            }
                            if(number_format($rmg_process_breakdown_arr[2],2)>0)
                            {
                                ?>
                                <tr>
                                    <td width="130">
                                    Chest Printing <!-- Printing % breack Down 2-->
                                    </td>
                                    <td align="right">
                                    <?
                                    echo number_format($rmg_process_breakdown_arr[2],2);
                                    ?>
                                    </td>
                                </tr>
                                <?
                            }
                            if(number_format($rmg_process_breakdown_arr[10],2)>0)
                            {
                                ?>
                                <tr>
                                    <td width="130">
                                    Neck/Sleeve Printing <!-- New breack Down 10-->
                                    </td>
                                    <td align="right">
                                    <?
                                    echo number_format($rmg_process_breakdown_arr[10],2);
                                    ?>
                                    </td>
                                </tr>
                                <?
                            }
                            if(number_format($rmg_process_breakdown_arr[1],2)>0)
                            {
                                ?>
                                <tr>
                                    <td width="130">
                                    Embroidery   <!-- Embroidery  % breack Down 1-->
                                    </td>
                                    <td align="right">
                                    <?
                                    echo number_format($rmg_process_breakdown_arr[1],2);
                                    ?>
                                    </td>
                                </tr>
                                <?
                            }
                            if(number_format($rmg_process_breakdown_arr[4],2)>0)
                            {
                                ?>
                                <tr>
                                    <td width="130">
                                    Sewing /Input<!-- Sewing % breack Down 4-->
                                    </td>
                                    <td align="right">
                                    <?
                                    echo number_format($rmg_process_breakdown_arr[4],2);
                                    ?>
                                    </td>
                                </tr>
                                <?
                            }
                            if(number_format($rmg_process_breakdown_arr[3],2)>0)
                            {
                                ?>
                                <tr>
                                    <td width="130">
                                    Garments Wash <!-- Washing %breack Down 3-->
                                    </td>
                                    <td align="right">
                                    <?
                                    echo number_format($rmg_process_breakdown_arr[3],2);
                                    ?>
                                    </td>
                                </tr>
                                <?
                            }
                            if(number_format($rmg_process_breakdown_arr[15],2)>0)
                            {
                                ?>
                                <tr>
                                    <td width="130">
                                    Gmts Finishing <!-- Washing %breack Down 3-->
                                    </td>
                                    <td align="right">
                                    <?
                                    echo number_format($rmg_process_breakdown_arr[15],2);
                                    ?>
                                    </td>
                                </tr>
                                <?
                            }
                            if(number_format($rmg_process_breakdown_arr[11],2)>0)
                            {
                                ?>
                                <tr>
                                    <td width="130">
                                    Others <!-- New breack Down 11-->
                                    </td>
                                    <td align="right">
                                    <?
                                    echo number_format($rmg_process_breakdown_arr[11],2);
                                    ?>
                                    </td>
                                </tr>
                                <?
                            }
                            $gmts_pro_sub_tot=$rmg_process_breakdown_arr[8]+$rmg_process_breakdown_arr[2]+$rmg_process_breakdown_arr[10]+$rmg_process_breakdown_arr[1]+$rmg_process_breakdown_arr[4]+$rmg_process_breakdown_arr[3]+$rmg_process_breakdown_arr[11]+$rmg_process_breakdown_arr[15];
                            if($gmts_pro_sub_tot>0)
                            {
                                ?>
                                <tr>
                                    <td width="130">
                                    Sub Total <!-- New breack Down 11-->
                                    </td>
                                    <td align="right">
                                    <?

                                    echo number_format($gmts_pro_sub_tot,2);
                                    ?>
                                    </td>
                                </tr>
                                <?
                            }
                            ?>
                            </table>
                        </fieldset>
                    </td>
                    <td width="30%"  valign="top">
                    	<fieldset id="" >
                        <legend>Fabric Process Loss % </legend>
                        <table width="100%" class="rpt_table" border="1" rules="all">
                        <?
                        if(number_format($rmg_process_breakdown_arr[6],2)>0)
                        {
							?>
							<tr>
								<td width="130">
								Knitting  <!--  Knitting % breack Down 6-->
								</td>
								<td align="right">
								<?
								echo number_format($rmg_process_breakdown_arr[6],2);
								?>
								</td>
								</tr>
								<?
								}
								if(number_format($rmg_process_breakdown_arr[12],2)>0)
								{
								?>
								<tr>
								<td width="130">
								Yarn Dyeing  <!--  New breack Down 12-->
								</td>
								<td align="right">
								<?
								echo number_format($rmg_process_breakdown_arr[12],2);
								?>
								</td>
							</tr>
							<?
                        }
                        if(number_format($rmg_process_breakdown_arr[5],2)>0)
                        {
							?>
							<tr>
								<td width="130">
								Dyeing & Finishing  <!-- Finishing % breack Down 5-->
								</td>
								<td align="right">
								<?
								echo number_format($rmg_process_breakdown_arr[5],2);
								?>
								</td>
							</tr>
							<?
                        }
                        if(number_format($rmg_process_breakdown_arr[13],2)>0)
                        {
							?>
							<tr>
								<td width="130">
								All Over Print <!-- new  breack Down 13-->
								</td>
								<td align="right">
								<?
								echo number_format($rmg_process_breakdown_arr[13],2);
								?>
								</td>
							</tr>
							<?
                        }
                        if(number_format($rmg_process_breakdown_arr[14],2)>0)
                        {
							?>
							<tr>
                                <td width="130">
                                Lay Wash (Fabric) <!-- new  breack Down 14-->
                                </td>
                                <td align="right">
                                <?
                                echo number_format($rmg_process_breakdown_arr[14],2);
                                ?>
                                </td>
							</tr>
							<?
                        }
                        if(number_format($rmg_process_breakdown_arr[7],2)>0)
                        {
							?>
							<tr>
                                <td width="130">
                                Dying   <!-- breack Down 7-->
                                </td>
                                <td align="right">
                                <?
                                echo number_format($rmg_process_breakdown_arr[7],2);
                                ?>
                                </td>
							</tr>
							<?
                        }
                        if(number_format($rmg_process_breakdown_arr[0],2)>0)
                        {
							?>
							<tr>
                                <td width="130">
                                Cutting (Fabric) <!-- Cutting % breack Down 0-->
                                </td>
                                <td align="right">
                                <?
                                echo number_format($rmg_process_breakdown_arr[0],2);
                                ?>
                                </td>
							</tr>
							<?
                        }
                        if(number_format($rmg_process_breakdown_arr[9],2)>0)
                        {
							?>
							<tr>
                                <td width="130">
                                Others  <!-- Others% breack Down 9-->
                                </td>
                                <td align="right">
                                <?
                                echo number_format($rmg_process_breakdown_arr[9],2);
                                ?>
                                </td>
							</tr>
							<?
                        }
                        $fab_proce_sub_tot=$rmg_process_breakdown_arr[6]+$rmg_process_breakdown_arr[12]+$rmg_process_breakdown_arr[5]+$rmg_process_breakdown_arr[13]+$rmg_process_breakdown_arr[14]+$rmg_process_breakdown_arr[7]+$rmg_process_breakdown_arr[0]+$rmg_process_breakdown_arr[9];
                        if(fab_proce_sub_tot>0)
                        {
							?>
							<tr>
                                <td width="130">
                                Sub Total  <!-- Others% breack Down 9-->
                                </td>
                                <td align="right">
                                <?

                                echo number_format($fab_proce_sub_tot,2);
                                ?>
                                </td>
							</tr>
							<?
                        }
                        if($gmts_pro_sub_tot+$fab_proce_sub_tot>0)
                        {
							?>
							<tr>
                                <td width="130">
                                Grand Total  <!-- Others% breack Down 9-->
                                </td>
                                <td align="right">
                                <?
                                echo number_format($gmts_pro_sub_tot+$fab_proce_sub_tot,2);
                                ?>
                                </td>
							</tr>
							<?
                        }
                        ?>
                        </table>
                        </fieldset>
                    </td>
                    <td valign="top">
						<?
                        $nameArray_imge =sql_select("SELECT image_location FROM common_photo_library where master_tble_id='$job_no' and file_type=1");
                        ?>
                        <fieldset id="" >
                        <legend>Image </legend>
                        <table width="310">
                            <tr>
                            <?
                            $img_counter = 0;
                            foreach($nameArray_imge as $result_imge)
                            {
                                if($path=="")
                                {
                                $path='../../';
                                }

                                ?>
                                <td>
                                    <!--<img src="../../<? //echo $result_imge[csf('image_location')]; ?>" width="90" height="100" border="2" />-->
                                    <img src="<? echo $path.$result_imge[csf('image_location')]; ?>" width="80" height="60" border="2" />
                                </td>
                                <?

                                $img_counter++;
                            }
                            ?>
                            </tr>
                       </table>
                       </fieldset>
                    </td>
                </tr>
            </table>

            <?
		//	$po_ship_date_arr=return_library_array( "select id,pub_shipment_date from   wo_po_break_down ",'id','pub_shipment_date');
			$sql_po=sql_select("select id,po_number,pub_shipment_date,insert_date from   wo_po_break_down ");
			foreach($sql_po as $row)
			{
				$insert_date=explode(" ",$row[csf('insert_date')]);
				$po_ship_date_arr[$row[csf('id')]]=$row[csf('pub_shipment_date')];
				$po_number_arr[$row[csf('id')]]=$row[csf('po_number')];
				$po_insert_date_arr[$row[csf('id')]]=$insert_date[0];
			}

			/*echo '<pre>';
			print_r($cbo_booking_gr_arr); die;*/
			if(count($cbo_booking_gr_arr)>0)
			{
					if($cbo_booking_gr_arr[1]!="")
					{
						if($cbo_fabric_source==1 || $cbo_fabric_source==2 || $cbo_fabric_source==3)
						{
						 $nameArray_size=sql_select( "select distinct size_number_id  from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  	is_deleted=0 and status_active=1  order by size_number_id desc");
					   ?>
						<table width="100%" >
							<tr>
								<td width="100%">


								<table  class="rpt_table"  border="1" align="left" cellpadding="0" width="900" cellspacing="0" rules="all" >
								<caption><strong style="float:left">Size and Color Breakdown</strong> </caption>
									<tr>
										<td style="border:1px solid black"><strong>PO NO.</strong></td>
										<td style="border:1px solid black"><strong>PO Insert Date</strong></td>
										<td style="border:1px solid black"><strong>PO Status</strong></td>
										<td style="border:1px solid black"><strong>Ship Date</strong></td>
										<td style="border:1px solid black"><strong>Gmts Item</strong></td>
										<td style="border:1px solid black"><strong>Color/Size</strong></td>
									<?
										foreach($nameArray_size  as $result_size)
										{	     ?>
										<td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
									<?	}    ?>
										<td style="border:1px solid black; width:130px" align="center"><strong> Total Order Qty(Pcs)</strong></td>
										<td style="border:1px solid black; width:80px" align="center"><strong> Excess %</strong></td>
										<td style="border:1px solid black; width:130px" align="center"><strong> Total Plan Cut Qty(Pcs)</strong></td>
									</tr>
									<?
									$color_size_order_qnty_array=array();
									$color_size_qnty_array=array();
									$size_tatal=array();
									$size_tatal_order=array();
									$order_id=explode(",",str_replace("'","",$txt_order_no_id));
									for($or=0;$or<count($order_id); $or++)
									{
									for($c=0;$c<count($gmts_item); $c++)
									{
									$item_size_tatal=array();
									$item_size_tatal_order=array();
									$item_grand_total=0;
									$item_grand_total_order=0;
									$nameArray_color=sql_select( "select distinct color_number_id from wo_po_color_size_breakdown where  item_number_id=$gmts_item[$c] and po_break_down_id =$order_id[$or] and is_deleted=0 and status_active=1 order by color_number_id");
									?>
								   <!-- <tr>
									<td style="border:1px solid black" colspan="<? echo count($nameArray_size)+3;?>"><strong><? echo $garments_item[$gmts_item[$c]];?></strong></td>

									</tr>-->
									<?
									foreach($nameArray_color as $result_color)
									{
									?>
									<tr>
										<td align="center" style="border:1px solid black"><? echo $po_number_arr[$order_id[$or]]; // echo $row_num_tr; ?></td>
										<td align="center" style="border:1px solid black"><? echo change_date_format($po_insert_date_arr[$order_id[$or]]); // echo $row_num_tr; ?></td>
										<td align="center" style="border:1px solid black"><? echo $po_status_arr[$order_id[$or]]; // echo $row_num_tr; ?></td>
										 <td align="center" style="border:1px solid black"><? echo change_date_format($po_ship_date_arr[$order_id[$or]],"dd-mm-yyyy","-"); // echo $row_num_tr; ?></td>
										  <td align="center" style="border:1px solid black"><? echo $garments_item[$gmts_item[$c]]; // echo $row_num_tr; ?></td>
										<td align="center" style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; // echo $row_num_tr; ?></td>
										<?
										$color_total=0;
										$color_total_order=0;

										foreach($nameArray_size  as $result_size)
										{
										$nameArray_color_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id =$order_id[$or] and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$result_color[csf('color_number_id')]."  and item_number_id=$gmts_item[$c] and  status_active=1 and is_deleted =0 order by size_number_id");
										foreach($nameArray_color_size_qnty as $result_color_size_qnty)
										{

										?>
											<td style="border:1px solid black; text-align:right">
											<?
												if($result_color_size_qnty[csf('plan_cut_qnty')]!= "")
												{
													 echo number_format($result_color_size_qnty[csf('order_quantity')],0);
													 $color_total += $result_color_size_qnty[csf('plan_cut_qnty')] ;
													 $color_total_order += $result_color_size_qnty[csf('order_quantity')] ;
													 $item_grand_total+=$result_color_size_qnty[csf('plan_cut_qnty')];
													 $item_grand_total_order+=$result_color_size_qnty[csf('order_quantity')];
													 $grand_total +=$result_color_size_qnty[csf('plan_cut_qnty')];
													 $grand_total_order +=$result_color_size_qnty[csf('order_quantity')];
													 $color_size_qnty_array[$result_size[csf('size_number_id')]][$result_color['color_number_id']]=$result_color_size_qnty[csf('plan_cut_qnty')];
													 $color_size_order_qnty_array[$result_size[csf('size_number_id')]][$result_color[csf('color_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
													 if (array_key_exists($result_size[csf('size_number_id')], $size_tatal))
													 {
															$size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
															$size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
													 }
													 else
													 {
														$size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
														$size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
													 }
													 if (array_key_exists($result_size[csf('size_number_id')], $item_size_tatal))
													 {
															$item_size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
															$item_size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
													 }
													 else
													 {
														$item_size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
														$item_size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
													 }
												}
												else echo "0";
											 ?>
											</td>

									<?
										}
										}
										?>
										<td style="border:1px solid black; text-align:right"><? echo number_format(round($color_total_order),0); ?></td>
										 <td style="border:1px solid black; text-align:right"><? $excexss_per=($color_total-$color_total_order)/$color_total_order*100; echo number_format($excexss_per,2)." %"; ?></td>
										 <td style="border:1px solid black; text-align:right"><? echo number_format(round($color_total),0); ?></td>
									</tr>
									<?
									}
									?>
									<tr>
									  <td align="center" style="border:1px solid black"><strong></strong></td>
									   <td align="center" style="border:1px solid black"><strong></strong></td>
									  <td align="center" style="border:1px solid black"><strong></strong></td>
									  <td align="center" style="border:1px solid black"><strong></strong></td>
									   <td align="center" style="border:1px solid black"><strong></strong></td>
									 <td align="center" style="border:1px solid black"><strong>Sub Total</strong></td>
										<?
										foreach($nameArray_size  as $result_size)
										{
										?>
										<td style="border:1px solid black;  text-align:right"><? echo $item_size_tatal_order[$result_size[csf('size_number_id')]];  ?></td>
										<?
										}
										?>
										<td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($item_grand_total_order),0); ?></td>
										<td  style="border:1px solid black;  text-align:right"><? $excess_item_gra_tot=($item_grand_total-$item_grand_total_order)/$item_grand_total_order*100; echo number_format($excess_item_gra_tot,2)." %"; ?></td>
										<td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($item_grand_total),0); ?></td>
									</tr>
									<?
									}
									}
									?>
									 <tr>
										<td style="border:1px solid black" align="center" colspan="<? echo count($nameArray_size)+6; ?>"><strong>&nbsp;</strong></td>
									</tr>
									<!--<tr>-->
									<tr>
									<td align="center" style="border:1px solid black"><strong></strong></td>
									<td align="center" style="border:1px solid black"><strong></strong></td>
									<td align="center" style="border:1px solid black"><strong></strong></td>
									<td align="center" style="border:1px solid black"><strong></strong></td>
									<td align="center" style="border:1px solid black"><strong></strong></td>
										<td align="center" style="border:1px solid black"><strong>Grand Total</strong></td>
										<?
										foreach($nameArray_size  as $result_size)
										{
										?>
										<td style="border:1px solid black;  text-align:right"><? echo $size_tatal_order[$result_size[csf('size_number_id')]];  ?></td>
										<?
										}
										?>
										<td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($grand_total_order),0); ?></td>
										<td  style="border:1px solid black;  text-align:right">
										<?
										$excess_gra_tot= ($po_qnty_tot-$grand_total_order)/$grand_total_order*100; echo number_format($excess_gra_tot,2)." %";
										?>
                                        </td>
										<td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($po_qnty_tot),0); ?></td>
									</tr>
								</table>
								</td>
							</tr>
					   </table>
						<?
						}// if($cbo_fabric_source==1) end
					}

			  ?>
			  <br/>

			<!--  Here will be the main portion  -->
			<?

	$gmtsitem_ratio_array=array();
	$grmnt_items = "";
    $grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no='$job_no'");
	foreach($grmts_sql as $key=>$val)
	{
		$grmnt_items .=$garments_item[$val[csf("gmts_item_id")]].",";
		$gmtsitem_ratio_array[$val[csf('job_no')]][$val[csf('gmts_item_id')]]=$val[csf('set_item_ratio')];
	}
	$grmnt_items = rtrim($grmnt_items,",");
			$costing_per="";
			$costing_per_qnty=0;
			$costing_per_id=return_field_value( "costing_per", "wo_pre_cost_mst","job_no ='$job_no'");
			if($costing_per_id==1)
			{
				$costing_per="1 Dzn";
				$costing_per_qnty=12;
			}
			if($costing_per_id==2)
			{
				$costing_per="1 Pcs";
				$costing_per_qnty=1;
			}
			if($costing_per_id==3)
			{
				$costing_per="2 Dzn";
				$costing_per_qnty=24;
			}
			if($costing_per_id==4)
			{
				$costing_per="3 Dzn";
				$costing_per_qnty=36;
			}
			if($costing_per_id==5)
			{
				$costing_per="4 Dzn";
				$costing_per_qnty=48;
			}
			$process_loss_method=return_field_value( "process_loss_method", "wo_pre_cost_fabric_cost_dtls","job_no='$job_no'");

			?>

			<?
			if($cbo_booking_gr_arr[2]!="")
			{
				if($cbo_fabric_source==1 || $cbo_fabric_source==3)
				{
					$nameArray_fabric_description= sql_select("SELECT a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type, b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent , avg(b.requirment) as requirment FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and b.po_break_down_id in($booking_po_id)  and b.requirment>0 and d.status_active=1 and d.is_deleted=0 group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by a.body_part_id,b.dia_width"); 
					?>

				 <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
				 <tr align="center">
				 <th colspan="3" align="left">Body Part</th>
					<?
					foreach($nameArray_fabric_description  as $result_fabric_description)
					{
						if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
						else         		               echo "<td  colspan='2'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
					}
					?>
					<td  rowspan="8" width="50"><p>Total Finish Fabric(<? echo $uom_name;?>) <? //if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
					<td  rowspan="8" width="50"><p>Total Grey Fabric(<? echo $uom_name;?>) <? //if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
					<td  rowspan="8" width="50"><p>Process Loss % </p></td>
				   </tr>
				 <tr align="center"><th colspan="3" align="left">Color Type</th>
					<?
					foreach($nameArray_fabric_description  as $result_fabric_description)
					{
						if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
						else         		               echo "<td  colspan='2'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
					}
					?>
					<!--<td  rowspan="8" width="50"><p>Total  Finish Fabric (KG)</p></td> <td  rowspan="8" width="50"><p>Total Grey Fabric (KG)</p></td>-->
						 <!--<td  rowspan="7" width="50"><p>Process Loss % </p></td>-->
				   </tr>
					<tr align="center"><th colspan="3" align="left">Fabric Construction</th>
					<?
					foreach($nameArray_fabric_description  as $result_fabric_description)
					{
						if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='2'>&nbsp</td>";
						else         		               echo "<td  colspan='2'>". $result_fabric_description[csf('construction')]."</td>";
					}
					?>


				   </tr>
					<tr align="center"><th   colspan="3" align="left">Fabric Composition</th>
					<?
					foreach($nameArray_fabric_description as $result_fabric_description)
					{
						if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='2' >&nbsp</td>";
						else         		               echo "<td colspan='2' >".$result_fabric_description[csf('composition')]."</td>";
					}
					?>

				   </tr>
				   <tr align="center"><th  colspan="3" align="left">GSM</th>
					<?
					foreach($nameArray_fabric_description  as $result_fabric_description)
					{
						if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='2'>&nbsp</td>";
						else         		       echo "<td colspan='2' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
					}
					?>

				   </tr>
				   <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
					<?
					foreach($nameArray_fabric_description as $result_fabric_description)
					{
						if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='2'>&nbsp</td>";
						else         		              echo "<td colspan='2' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
					}
					?>

				   </tr>
				   <tr>
				   <th  colspan="<? echo  count($nameArray_fabric_description)*2+3; ?>" align="left" style="height:30px">&nbsp;</th>
				   </tr>

				   <tr>
						<!--<th  width="120" align="left">Gmts. Color</th>-->
						<th  width="120" align="left">Fabric Color</th>
						<th  width="120" align="left">Body Color</th>
						<th  width="120" align="left">Lab Dip No</th>
					<?
					foreach($nameArray_fabric_description as $result_fabric_description)
					{
						  echo "<th width='50'>Finish</th><th width='50' >Gray</th>";
					}
					?>

				   </tr>
				   <?

					  $gmt_color_library=array();
					  $gmt_color_data=sql_select("select b.gmts_color_id, b.contrast_color_id
					  FROM
					  wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b
					  WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.fabric_source =$cbo_fabric_source and
					  a.job_no ='$job_no'");
					  foreach( $gmt_color_data as $gmt_color_row)
					  {

						$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
					  }

						$grand_total_fin_fab_qnty=0;
						$grand_total_grey_fab_qnty=0;
						$grand_totalcons_per_finish=0;
						$grand_totalcons_per_grey=0;
						$color_wise_wo_sql=sql_select("SELECT fabric_color_id FROM wo_booking_dtls WHERE booking_no =$txt_booking_no and status_active=1 and is_deleted=0 group by fabric_color_id"); 
						foreach($color_wise_wo_sql as $color_wise_wo_result)
						{
							?>
							<tr>
							<td  width="120" align="left">
							<?
							echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];


							?>
							</td>
							<td>
							<?
							echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
							?>
							</td>
							<td  width="120" align="left">
							<?
							$order_id=str_replace("'","",$txt_order_no_id);
							$lapdip_no="";
							$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."'  and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]." and po_break_down_id in($booking_po_id) and status_active=1 and is_deleted=0");
							if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
							?>
							</td>
							<?
							$total_fin_fab_qnty=0;
							$total_grey_fab_qnty=0;

						foreach($nameArray_fabric_description as $result_fabric_description)
						{

							if($db_type==0)
							{
								$color_wise_wo_sql_qnty=sql_select("SELECT  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and a.construction='".$result_fabric_description[csf('construction')]."' and a.composition='".$result_fabric_description[csf('composition')]."' and a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and b.dia_width='".$result_fabric_description[csf('dia_width')]."' and d.fabric_color_id='".$color_wise_wo_result[csf('fabric_color_id')]."' and d.status_active=1 and d.is_deleted=0 ");
							}
							if($db_type==2)
							{
								$color_wise_wo_sql_qnty=sql_select("SELECT  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and a.construction='".$result_fabric_description[csf('construction')]."' and a.composition='".$result_fabric_description[csf('composition')]."' and a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and b.dia_width='".$result_fabric_description[csf('dia_width')]."' and nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and d.status_active=1 and d.is_deleted=0 ");
							}

							list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
						?>
						<td width='50' align='right'>
						<?
						if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
						{
						echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;
						$total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('fin_fab_qnty')];
						}
						?>
						</td>
						<td width='50' align='right' >
						<?
						if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
						{
						echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2);
						$total_grey_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
						}
						?>
						</td>
						<?
						}
						?>
						<td align="right"><? echo number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
						<td align="right"><? echo number_format($total_grey_fab_qnty,2); $grand_total_grey_fab_qnty+=$total_grey_fab_qnty;?></td>

						<td align="right">
						<?
						if($process_loss_method==1)
						{
							$process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_fin_fab_qnty)*100;
						}

						if($process_loss_method==2)
						{
							$process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_grey_fab_qnty)*100;
						}
						echo number_format($process_percent,2);

						?>

						</td>
						</tr>
					 <?
					}
					?>
					<tr style=" font-weight:bold">
					<!--<td  width="120" align="left">&nbsp;</td>-->
					<th  width="120" align="left">&nbsp;</th>
					<td  width="120" align="left">&nbsp;</td>
					<td  width="120" align="left"><strong>Total</strong></td>
					<?
						foreach($nameArray_fabric_description as $result_fabric_description)
						{
							
							$color_wise_wo_sql_qnty=sql_select("SELECT  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and a.construction='".$result_fabric_description[csf('construction')]."' and a.composition='".$result_fabric_description[csf('composition')]."' and a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and b.dia_width='".$result_fabric_description[csf('dia_width')]."' and d.status_active=1 and d.is_deleted=0 ");
							list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
						?>
						<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;?></td><td width='50' align='right' > <? echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2);?></td>
						<?
						}
						?>
						<td align="right"><? echo number_format($grand_total_fin_fab_qnty,2);?></td>
						<td align="right"><? echo number_format($grand_total_grey_fab_qnty,2);?></td>
						<td align="right">
						<?
						if($process_loss_method==1)// markup
						{
							$totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_fin_fab_qnty)*100;
						}

						if($process_loss_method==2) //margin
						{
							$totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_grey_fab_qnty)*100;
						}
						echo number_format($totalprocess_percent,2);
						?>
						</td>
						</tr>
						<tr style="font-weight:bold">
					<!--<td  width="120" align="left">&nbsp;</td>-->
					<td  width="120" align="left">&nbsp;</td>
					<td  width="120" align="left">&nbsp;</td>
					<td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
					<?
						foreach($nameArray_fabric_description as $result_fabric_description)
						{
							
							$color_wise_wo_sql_qnty=sql_select("SELECT  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and a.construction='".$result_fabric_description[csf('construction')]."' and a.composition='".$result_fabric_description[csf('composition')]."' and a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and b.dia_width='".$result_fabric_description[csf('dia_width')]."' and d.status_active=1 and d.is_deleted=0 "); 
							list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

						?>
						<td width='50' align='right'><?   echo number_format(($color_wise_wo_result_qnty[csf('fin_fab_qnty')]/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td><td width='50' align='right' > <? echo number_format(($color_wise_wo_result_qnty[csf('grey_fab_qnty')]/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
						<?
						}
						?>
						<td align="right"><? echo number_format(($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4); $grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4)?></td>
						<td align="right"><? echo number_format(($grand_total_grey_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4);$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4)?></td>
						<td align="right">
						<?
						if($process_loss_method==1)
						{
							$totalprocess_percent_dzn=(($grand_total_grey_fab_qnty_dzn-$grand_total_fin_fab_qnty_dzn)/$grand_total_fin_fab_qnty_dzn)*100;
						}

						if($process_loss_method==2)
						{
							$totalprocess_percent_dzn=(($grand_total_grey_fab_qnty_dzn-$grand_total_fin_fab_qnty_dzn)/$grand_total_grey_fab_qnty_dzn)*100;
						}
						echo number_format($totalprocess_percent_dzn,2);
						?>
						</td>
						</tr>
				</table>
				<?
				}

				if($cbo_fabric_source==2 )
				{

					$nameArray_fabric_description= sql_select("SELECT a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type , b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent, avg(b.requirment) as requirment FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and d.status_active=1 and d.is_deleted=0 group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by a.body_part_id,b.dia_width");
				 ?>

				 <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
				 <tr align="center">
				 <th colspan="3" align="left">Body Part</th>
					<?
					foreach($nameArray_fabric_description  as $result_fabric_description)
					{
						if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
						else         		               echo "<td  colspan='3'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
					}
					?>
					<td  rowspan="8" width="50"><p>Total Fabric(<? echo $uom_name;?>) <? //if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
					<td  rowspan="8" width="50"><p>Avg Rate (<? echo $uom_name;?>) <? //if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
					<td  rowspan="8" width="50"><p>Amount </p></td>
				   </tr>
				 <tr align="center"><th colspan="3" align="left">Color Type</th>
					<?
					foreach($nameArray_fabric_description  as $result_fabric_description)
					{
						if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
						else         		               echo "<td  colspan='3'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
					}
					?>
					<!--<td  rowspan="8" width="50"><p>Total  Finish Fabric (KG)</p></td> <td  rowspan="8" width="50"><p>Total Grey Fabric (KG)</p></td>-->
						 <!--<td  rowspan="7" width="50"><p>Process Loss % </p></td>-->
				   </tr>
					<tr align="center"><th colspan="3" align="left">Fabric Construction</th>
					<?
					foreach($nameArray_fabric_description  as $result_fabric_description)
					{
						if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='3'>&nbsp</td>";
						else         		               echo "<td  colspan='3'>". $result_fabric_description[csf('construction')]."</td>";
					}
					?>


				   </tr>
					<tr align="center"><th   colspan="3" align="left">Fabric Composition</th>
					<?
					foreach($nameArray_fabric_description as $result_fabric_description)
					{
						if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='3' >&nbsp</td>";
						else         		               echo "<td colspan='3' >".$result_fabric_description[csf('composition')]."</td>";
					}
					?>

				   </tr>
				   <tr align="center"><th  colspan="3" align="left">GSM</th>
					<?
					foreach($nameArray_fabric_description  as $result_fabric_description)
					{
						if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='3'>&nbsp</td>";
						else         		       echo "<td colspan='3' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
					}
					?>

				   </tr>
				   <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
					<?
					foreach($nameArray_fabric_description as $result_fabric_description)
					{
						if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='3'>&nbsp</td>";
						else         		              echo "<td colspan='3' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
					}
					?>

				   </tr>
				   <tr>
				   <th  colspan="<? echo  count($nameArray_fabric_description)*3+3; ?>" align="left" style="height:30px">&nbsp;</th>
				   </tr>

				   <tr>
						<!--<th  width="120" align="left">Gmts. Color</th>-->
						<th  width="120" align="left">Fabric Color</th>
						<th  width="120" align="left">Body Color</th>
						<th  width="120" align="left">Lab Dip No</th>
					<?
					foreach($nameArray_fabric_description as $result_fabric_description)
					{
						  echo "<th width='50'>Fab. Qty</th><th width='50' >Rate</th><th width='50' >Amount</th>";
					}
					?>

				   </tr>
				   <?

					  /*$gmt_color_library=return_library_array( "select gmts_color_id,contrast_color_id
					  FROM
					  wo_pre_cos_fab_co_color_dtls
					  WHERE
					  job_no ='$job_no'", "contrast_color_id", "gmts_color_id");*/
					  $gmt_color_library=array();
					  $gmt_color_data=sql_select("select b.gmts_color_id, b.contrast_color_id
					  FROM
					  wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b
					  WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.fabric_source =$cbo_fabric_source and
					  a.job_no ='$job_no'");
					  foreach( $gmt_color_data as $gmt_color_row)
					  {
						//$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
						$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
					  }

						$grand_total_fin_fab_qnty=0;
						$grand_total_amount=0;
						//$grand_totalcons_per_finish=0;
						//$grand_totalcons_per_grey=0;
						$color_wise_wo_sql=sql_select("select fabric_color_id, avg(rate) as dtls_rate
													  FROM
													  wo_booking_dtls
													  WHERE
													  booking_no =$txt_booking_no and
													  status_active=1 and
													  is_deleted=0
													  group by fabric_color_id");
					foreach($color_wise_wo_sql as $color_wise_wo_result)
					{
					?>
						<tr>
					   <!-- <td  width="120" align="left">
						<?

						//echo $color_library[$color_wise_wo_result['fabric_color_id']];

						?></td>-->
						<td  width="120" align="left">
						<?
						echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];


						?>
						</td>
						<td>
						<?
						//echo $color_library[$gmt_color_library[$color_wise_wo_result['fabric_color_id']]];
						//echo rtrim($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]],",");
						echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
						?>
						</td>
						<td  width="120" align="left">
						<?
						$lapdip_no="";
						//$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
						$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."'  and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]." and po_break_down_id in($booking_po_id) and status_active=1 and is_deleted=0");
						//echo "lapdip_no from wo_po_lapdip_approval_info where job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result['fabric_color_id']."";
						if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
						?>
						</td>
						<?
						$total_fin_fab_qnty=0;
						$total_amount=0;

						foreach($nameArray_fabric_description as $result_fabric_description)
						{
							
							if($db_type==0)
							{
								$color_wise_wo_sql_qnty=sql_select("SELECT  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,sum(d.grey_fab_qnty*d.rate) as amount, avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and a.construction='".$result_fabric_description[csf('construction')]."' and a.composition='".$result_fabric_description[csf('composition')]."' and a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and b.dia_width='".$result_fabric_description[csf('dia_width')]."' and d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and d.status_active=1 and d.is_deleted=0 "); }
							if($db_type==2)
							{

								if($result_fabric_description[csf('gsm_weight')]!="") $gsm_cond=" a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and "; else $gsm_cond="";


								$color_wise_wo_sql_qnty=sql_select("SELECT  sum(d.fin_fab_qnty) as fin_fab_qnty, sum(d.grey_fab_qnty) as grey_fab_qnty,sum(d.grey_fab_qnty*d.rate) as amount, avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and a.construction='".$result_fabric_description[csf('construction')]."' and a.composition='".$result_fabric_description[csf('composition')]."' and $gsm_cond b.dia_width='".$result_fabric_description[csf('dia_width')]."' and nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and d.status_active=1 and d.is_deleted=0"); }
							list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
						?>
						<td width='50' align='right'>
						<?
						if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
						{
						echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2) ;
						$total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
						}
						?>
						</td>
						<td width='50' align='right' >
						<?
						if($color_wise_wo_result_qnty[csf('rate')]!="")
						{
							echo number_format($color_wise_wo_result_qnty[csf('amount')]/$color_wise_wo_result_qnty[csf('grey_fab_qnty')],2);
							//$total_grey_fab_qnty+=$color_wise_wo_result_qnty['grey_fab_qnty'];
						}
						?>
						</td>
						<td width='50' align='right' >
						<?
						$amount=$color_wise_wo_result_qnty[csf('amount')];//$color_wise_wo_result_qnty[csf('grey_fab_qnty')]*$color_wise_wo_result_qnty[csf('rate')];
						if($amount!="")
						{
						echo number_format($amount,2);
						$total_amount+=$amount;
						}
						?>
						</td>
						<?
						}
						?>
						<td align="right"><? echo number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
						<td align="right"><? echo number_format($total_amount/$total_fin_fab_qnty,2); $grand_total_amount+=$total_amount;?></td>
						<td align="right">
						<?
						echo number_format($total_amount,2);

						?>
						</td>
						</tr>
					 <?
					}
					?>
					<tr style=" font-weight:bold">
					<!--<td  width="120" align="left">&nbsp;</td>-->
					<th  width="120" align="left">&nbsp;</th>
					<td  width="120" align="left">&nbsp;</td>
					<td  width="120" align="left"><strong>Total</strong></td>
					<?
						foreach($nameArray_fabric_description as $result_fabric_description)
						{
							
							if($result_fabric_description[csf('gsm_weight')]!="") $gsm_cond=" a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and "; else $gsm_cond="";
							$color_wise_wo_sql_qnty=sql_select("SELECT  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and a.construction='".$result_fabric_description[csf('construction')]."' and a.composition='".$result_fabric_description[csf('composition')]."' and $gsm_cond b.dia_width='".$result_fabric_description[csf('dia_width')]."' and d.status_active=1 and d.is_deleted=0 ");
							list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
						?>
						<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2) ;?></td>
						<td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
						<td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
						<?
						}
						?>
						<td align="right"><? echo number_format($grand_total_fin_fab_qnty,2);?></td>
						<td align="right"><? echo number_format($grand_total_amount/$grand_total_fin_fab_qnty,2);?></td>
						<td align="right">
						<?
						echo number_format($grand_total_amount,2);
						?>
						</td>
						</tr>
						<tr style="font-weight:bold">
					<!--<td  width="120" align="left">&nbsp;</td>-->
					<th  width="120" align="left">&nbsp;</th>
					<td  width="120" align="left">&nbsp;</td>
					<td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
					<?
						foreach($nameArray_fabric_description as $result_fabric_description)
						{
							if($result_fabric_description[csf('gsm_weight')]!="") $gsm_cond=" a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and "; else $gsm_cond="";
							$color_wise_wo_sql_qnty=sql_select("SELECT  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and a.construction='".$result_fabric_description[csf('construction')]."' and a.composition='".$result_fabric_description[csf('composition')]."' and $gsm_cond b.dia_width='".$result_fabric_description[csf('dia_width')]."' and d.status_active=1 and d.is_deleted=0 "); 
							list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

						?>
						<td width='50' align='right'><?  echo number_format(($color_wise_wo_result_qnty[csf('fin_fab_qnty')]/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td>
						<td width='50' align='right' > <? echo number_format(($color_wise_wo_result_qnty[csf('grey_fab_qnty')]/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
						<td width='50' align='right' > <? echo number_format(($color_wise_wo_result_qnty[csf('grey_fab_qnty')]/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
						<?
						}
						?>
						<td align="right">
						<?
						$consumption_per_unit_fab=($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
						echo number_format($consumption_per_unit_fab,4);
						//$grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4)
						?>
						</td>
						<td align="right">
						<?
						$consumption_per_unit_amuont=($grand_total_amount/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
						//echo number_format(($consumption_per_unit_amuont/$consumption_per_unit_fab),2);
						//$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4)
						?>
						</td>
						<td align="right">
						<?
						//echo number_format($consumption_per_unit_amuont,2);
						?>
						</td>
						</tr>
				</table>
				<?
				}

			}
			?>
				<br/>
				<?

				if($cbo_fabric_source==1 || $cbo_fabric_source==3)
				{
					if($cbo_booking_gr_arr[3]!="")
					{
						$lab_dip_color_arr=array();
						$lab_dip_color_sql=sql_select("select pre_cost_fabric_cost_dtls_id, gmts_color_id, contrast_color_id from wo_pre_cos_fab_co_color_dtls where job_no='$txt_job_no'");
						foreach($lab_dip_color_sql as $row)
						{
							$lab_dip_color_arr[$row[csf('pre_cost_fabric_cost_dtls_id')]][$row[csf('gmts_color_id')]]=$row[csf('contrast_color_id')];
						}
						$order_plan_qty_arr=array();
						$color_wise_wo_sql_qnty=sql_select( "select color_number_id, size_number_id,item_number_id, (plan_cut_qnty) as plan_cut_qnty, (order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in ($booking_po_id) and status_active=1 and is_deleted =0 ");
						foreach($color_wise_wo_sql_qnty as $row)
						{
							$order_plan_qty_arr[$row[csf('item_number_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]['plan']+=$row[csf('plan_cut_qnty')];
							$order_plan_qty_arr[$row[csf('item_number_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]['order']+=$row[csf('order_quantity')];
						}

						$collar_cuff_percent_arr=array();
						$collar_cuff_body_arr=array();
						$collar_cuff_color_arr=array();
						$collar_cuff_size_arr=array();
						$collar_cuff_item_size_arr=array();
						$color_size_sensitive_arr=array();

						$collar_cuff_sql="SELECT a.id,a.item_number_id, a.color_size_sensitive, a.color_break_down, b.color_number_id, b.gmts_sizes, b.item_size, c.size_number_id, d.colar_cuff_per, e.body_part_full_name, e.body_part_type FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c, wo_booking_dtls d, lib_body_part e WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=e.id and e.body_part_type in (40,50) and c.id=d.color_size_table_id and d.color_size_table_id=b.color_size_table_id  and d.po_break_down_id=c.po_break_down_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 and b.cons>0 order by  c.size_order"; //echo $collar_cuff_sql;
						$collar_cuff_sql_res=sql_select($collar_cuff_sql);

						foreach($collar_cuff_sql_res as $collar_cuff_row)
						{
							$collar_cuff_percent_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('color_number_id')]][$collar_cuff_row[csf('gmts_sizes')]]=$collar_cuff_row[csf('colar_cuff_per')];
							$collar_cuff_body_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]]=$collar_cuff_row[csf('body_part_full_name')];
							$collar_cuff_size_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('size_number_id')]]=$collar_cuff_row[csf('size_number_id')];
							$collar_cuff_item_size_arr[$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('size_number_id')]]=$collar_cuff_row[csf('item_size')];
							$color_size_sensitive_arr[$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('id')]][$collar_cuff_row[csf('color_number_id')]][$collar_cuff_row[csf('color_size_sensitive')]]=$collar_cuff_row[csf('color_break_down')];
							$item_id_arr[$collar_cuff_row[csf('id')]]=$collar_cuff_row[csf('item_number_id')];

						}
						//print_r($collar_cuff_percent_arr[40]) ;
						unset($collar_cuff_sql_res);
						//$count_collar_cuff=count($collar_cuff_size_arr);
						foreach($collar_cuff_body_arr as $body_type=>$body_name)
						{
							foreach($body_name as $body_val)
							{
								$count_collar_cuff=count($collar_cuff_size_arr[$body_type][$body_val]);
								$pre_grand_tot_collar=0; $pre_grand_tot_collar_order_qty=0;

								?>
			                    <div style="max-height:1330px; overflow:auto; float:left; padding-top:5px; margin-left:5px; margin-bottom:5px; position:relative;">
								<table width="625" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
			                        <tr>
			                        	<td colspan="<? echo $count_collar_cuff+3; ?>" align="center"><b><? echo $body_val; ?> - Color Size Brakedown in Pcs.</b></td>
			                        </tr>
			                        <tr>
			                            <td width="100">Size</td>
											<?
			                                foreach($collar_cuff_size_arr[$body_type][$body_val]  as $size_number_id)
			                                {
												?>
												<td align="center" style="border:1px solid black"><strong><? echo $size_library[$size_number_id];?></strong></td>
												<?
			                                }
			                                ?>
			                            <td width="60" rowspan="2" align="center"><strong>Total</strong></td>
			                            <td rowspan="2" align="center"><strong>Extra %</strong></td>
			                        </tr>
			                        <tr>
			                            <td style="font-size:12px"><? echo $body_val; ?> Size</td>
			                            <?
			                            foreach($collar_cuff_item_size_arr[$body_val]  as $size_number_id=>$size_number)
			                            {
											if($size_number_id>0)
											{
												/* foreach($size_number  as $item_size=>$val)
												 {*/
													?>
													<td align="center" style="border:1px solid black"><strong><? echo $size_number;?></strong></td>
													<?
												// }
											}
											else
											{
												?>
												<td align="center" style="border:1px solid black"><strong>&nbsp;</strong></td>
												<?
											}
			                            }

			                            $pre_size_total_arr=array();
			                            foreach($color_size_sensitive_arr[$body_val] as $pre_cost_id=>$pre_cost_data)
			                            {
											foreach($pre_cost_data as $color_number_id=>$color_number_data)
											{
												foreach($color_number_data as $color_size_sensitive=>$color_break_down)
												{
													$pre_color_total_collar=0;
													$pre_color_total_collar_order_qnty=0;
													$process_loss_method=$process_loss_method;
													$constrast_color_arr=array();
													if($color_size_sensitive==3)
													{
														$constrast_color=explode('__',$color_break_down);
														for($i=0;$i<count($constrast_color);$i++)
														{
															$constrast_color2=explode('_',$constrast_color[$i]);
															$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
														}
													}
													?>
													<tr>
														<td>
															<?
			                                                if( $color_size_sensitive==3)
			                                                {
			                                                    echo strtoupper ($constrast_color_arr[$color_number_id]) ;
			                                                    $lab_dip_color_id=$lab_dip_color_arr[$pre_cost_id][$color_number_id];
			                                                }
			                                                else
			                                                {
			                                                    echo $color_library[$color_number_id];
			                                                    $lab_dip_color_id=$color_number_id;
			                                                }
			                                                ?>
														</td>
														<?
														foreach($collar_cuff_size_arr[$body_type][$body_val] as $size_number_id)
														{
															$item_id=$item_id_arr[$pre_cost_id];
															?>
															<td align="center" style="border:1px solid black">
																<? $plan_cut=0; $collerqty=0; $collar_ex_per=0;
																if($body_type==50) $plan_cut=($order_plan_qty_arr[$item_id][$color_number_id][$size_number_id]['plan'])*2;
																else $plan_cut=$order_plan_qty_arr[$item_id][$color_number_id][$size_number_id]['plan'];
			                                                    $ord_qty=$order_plan_qty_arr[$item_id][$color_number_id][$size_number_id]['order'];

			                                                    $collar_ex_per=$collar_cuff_percent_arr[$body_type][$body_val][$color_number_id][$size_number_id];
			                                                    // echo $collar_ex_per.'=';

															    if($body_type==50) { if($collar_ex_per==0 || $collar_ex_per=="") $collar_ex_per=$cuff_excess_percent; else $collar_ex_per=$collar_ex_per; }
			                                                    else if($body_type==40) { if($collar_ex_per==0 || $collar_ex_per=="") $collar_ex_per=$colar_excess_percent; else $collar_ex_per=$collar_ex_per; }
			                                                    $colar_excess_per=number_format(($plan_cut*$collar_ex_per)/100,6,".",",");
			                                                    $collerqty=($plan_cut+$colar_excess_per);

			                                                    //$collerqty=number_format(($requirment/$costing_per_qnty)*$plan_cut,2,'.','');

			                                                    echo number_format($collerqty);
			                                                    $pre_size_total_arr[$size_number_id]+=$collerqty;
			                                                    $pre_color_total_collar+=$collerqty;
			                                                    $pre_color_total_collar_order_qnty+=$plan_cut;

			                                                    //$pre_grand_tot_collar_order_qty+=$plan_cut;
			                                                    ?>
															</td>
															<?
														}
														?>

														<td align="center"><? echo number_format($pre_color_total_collar); ?></td>
														<td align="center"><? echo number_format((($pre_color_total_collar-$pre_color_total_collar_order_qnty)/$pre_color_total_collar_order_qnty)*100,2); ?></td>
													</tr>
													<?
													$pre_grand_collar_ex_per+=$collar_ex_per;
													$pre_grand_tot_collar+=$pre_color_total_collar;
													$pre_grand_tot_collar_order_qty+=$pre_color_total_collar_order_qnty;
												}
											}
										}
										?>
			                        </tr>
			                        <tr>
			                            <td>Size Total</td>
											<?
			                                foreach($pre_size_total_arr  as $size_qty)
			                                {
												?>
												<td style="border:1px solid black;  text-align:center"><? echo number_format($size_qty); ?></td>
												<?
			                                }
			                                ?>
			                            <td style="border:1px solid black; text-align:center"><? echo number_format($pre_grand_tot_collar); ?></td>
			                            <td align="center" style="border:1px solid black"><? echo number_format((($pre_grand_tot_collar-$pre_grand_tot_collar_order_qty)/$pre_grand_tot_collar_order_qty)*100,2); ?></td>
			                        </tr>
								</table>
			                </div>
			                <br/>
			                <?
			            }
        			}
				}
				?>

				<br/>
				<?

		$txt_po_breack_down_id=str_replace("'","",$txt_order_no_id);
		/*$yarn_data_array=array();

		$sql_y=sql_select("SELECT c.item_number_id,c.order_quantity ,c.plan_cut_qnty,f.job_no,f.color,f.count_id,f.copm_one_id,f.percent_one,f.copm_two_id,f.percent_two,f.type_id,f.cons_ratio,f.cons_qnty,f.avg_cons_qnty,f.rate,f.amount,e.requirment   from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c,wo_pre_cost_fabric_cost_dtls d,wo_pre_cos_fab_co_avg_con_dtls e,wo_pre_cost_fab_yarn_cost_dtls f where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst and a.job_no=d.job_no and a.job_no=e.job_no and a.job_no=f.job_no and b.id=c.po_break_down_id and d.id=e.pre_cost_fabric_cost_dtls_id and c.po_break_down_id=e.po_break_down_id and c.item_number_id= d.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.gmts_sizes and d.id=f.fabric_cost_dtls_id and a.job_no='".$job_no."' and b.id in ($txt_po_breack_down_id) and e.cons !=0    and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1");
		//C.COLOR_NUMBER_ID=E.COLOR_NUMBER_ID and C.SIZE_NUMBER_ID=E.GMTS_SIZES and D.ID=F.FABRIC_COST_DTLS_ID

		foreach($sql_y as $sql_y_r)
		{

			$set_item_ratio=$gmtsitem_ratio_array[$sql_y_r[csf('job_no')]][$sql_y_r[csf('item_number_id')]];
			//$cons_qnty = def_number_format(($sql_y_r[csf("cons_qnty")]*($sql_y_r[csf("plan_cut_qnty")]/($order_price_per_dzn*$set_item_ratio))),5,"");
			$cons_qnty = def_number_format((($sql_y_r[csf("requirment")]*$sql_y_r[csf("cons_ratio")]/100)*($sql_y_r[csf("plan_cut_qnty")]/($costing_per_qnty*$set_item_ratio))),5,"");
			$avg_cons_qnty = def_number_format(($sql_y_r[csf("avg_cons_qnty")]*($sql_y_r[csf("plan_cut_qnty")]/($order_price_per_dzn*$set_item_ratio))),5,"");
			//$amount = $sql_y_r[csf("amount")]*($sql_y_r[csf("plan_cut_qnty")]/($order_price_per_dzn*$set_item_ratio));
			 $amount = def_number_format(($cons_qnty*$sql_y_r[csf("rate")]),5,"");
			//$amount = def_number_format(($avg_cons_qnty*$sql_y_r[csf("rate")]),5,"");

			$yarn_data_array[$sql_y_r[csf("count_id")]][$sql_y_r[csf("copm_one_id")]][$sql_y_r[csf("percent_one")]][$sql_y_r[csf("copm_two_id")]][$sql_y_r[csf("percent_two")]][$sql_y_r[csf("type_id")]][$sql_y_r[csf("color")]][$sql_y_r[csf("rate")]][qnty]+=$cons_qnty;
			$yarn_data_array[$sql_y_r[csf("count_id")]][$sql_y_r[csf("copm_one_id")]][$sql_y_r[csf("percent_one")]][$sql_y_r[csf("copm_two_id")]][$sql_y_r[csf("percent_two")]][$sql_y_r[csf("type_id")]][$sql_y_r[csf("color")]][$sql_y_r[csf("rate")]][avg_qnty]+=$avg_cons_qnty;
			$yarn_data_array[$sql_y_r[csf("count_id")]][$sql_y_r[csf("copm_one_id")]][$sql_y_r[csf("percent_one")]][$sql_y_r[csf("copm_two_id")]][$sql_y_r[csf("percent_two")]][$sql_y_r[csf("type_id")]][$sql_y_r[csf("color")]][$sql_y_r[csf("rate")]][amount]+=$amount;
		}*/
		$lib_yarn_count=return_library_array( "select yarn_count,id from lib_yarn_count", "id", "yarn_count"  );
		//Mysql
		/*$sql = "select id, count_id, copm_one_id, percent_one, copm_two_id, percent_two, type_id, cons_ratio, sum(cons_qnty) as cons_qnty, rate, sum(amount) as amount from wo_pre_cost_fab_yarn_cost_dtls where job_no=".$txt_job_no." group by count_id, copm_one_id, percent_one, copm_two_id, percent_two, type_id, rate";*/
				//oracle
				 // $sql = "select min(id) as id, count_id, copm_one_id, percent_one, copm_two_id, percent_two, color,type_id, min(cons_ratio) as cons_ratio, sum(cons_qnty) as cons_qnty, rate, sum(amount) as amount from wo_pre_cost_fab_yarn_cost_dtls where job_no='".$job_no."' group by count_id, copm_one_id, percent_one, copm_two_id, percent_two, color,type_id, rate";
				/* $yarn_sql="SELECT MIN (a.id) AS id, a.count_id, a.copm_one_id, a.percent_one, a.copm_two_id,  a.percent_two,
		        a.type_id,  SUM (a.cons_qnty) AS yarn_required,  AVG (a.rate) AS rate, listagg (CAST (a.fabric_cost_dtls_id AS VARCHAR2 (4000)), ',')
		            WITHIN GROUP (ORDER BY   a.fabric_cost_dtls_id) AS cost_dtls, AVG (a.cons_ratio) AS cons_ratio, sum (b.grey_fab_qnty*a.cons_ratio/100) AS grey_req
		         FROM wo_pre_cost_fab_yarn_cost_dtls a, wo_booking_dtls b WHERE a.job_no = '$job_no' AND a.status_active = 1 and a.is_deleted = 0 and a.fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id  and a.job_no=b.job_no and b.status_active=1 and b.is_deleted=0  and b.booking_no=$txt_booking_no
				GROUP BY a.count_id,
				         a.copm_one_id,
				        a.percent_one,
				         a.copm_two_id,
				         a.percent_two,
				         a.type_id";*/
						 $yarn_sql_array=sql_select("SELECT min(a.id) as id ,a.count_id, a.copm_one_id, a.percent_one,a.copm_two_id, a.percent_two,a.color, a.type_id, a.supplier_id,  sum (b.grey_fab_qnty*a.cons_ratio/100) AS yarn_required, AVG(a.rate) as rate from wo_pre_cost_fab_yarn_cost_dtls a, wo_booking_dtls b where a.job_no=b.job_no and a.fabric_cost_dtls_id=b. pre_cost_fabric_cost_dtls_id and a.job_no='$job_no' and b.booking_no =$txt_booking_no  and  a.status_active=1 and a.is_deleted=0 and  b.status_active=1 and b.is_deleted=0 group by a.count_id, a.copm_one_id, a.percent_one, a.copm_two_id, a.percent_two, a.color, a.type_id, a.supplier_id order by id");
						 
		       // $data_array=sql_select($yarn_sql);
				
		        
				?>
				<table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
					<tr>
						<td width="49%" valign="top">
						<?
						if($cbo_booking_gr_arr[4]!="")
						{
							?>
							 <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
								<tr align="center">
								<td colspan="5"><b>Yarn Required Summary (Pre Cost)</b></td>
								</tr>
								<tr align="center">
								<td>Sl</td>
								<td>Yarn Description</td>
								<td>Qty</td>
								<?
								if($show_yarn_rate==1)
								{
									?>
									<td>Rate</td>
									<?
								}
								?>
                                <td>Amount</td>
								
							</tr>
							<?
							$i=0;
							$total_yarn=0;$$tot_amt=$tot_qty=0;
							foreach($yarn_sql_array  as $row)
							{

								$i++;
							?>
							<tr align="center">
								<td><? echo $i; ?></td>
								<td>
								<?
								$yarn_des=$lib_yarn_count[$row[csf('count_id')]]." ".$composition[$row[csf('copm_one_id')]]." ".$row[csf('percent_one')]."%  ";
								if($row['copm_two_id'] !=0)
								{
									$yarn_des.=$composition[$row[csf('copm_two_id')]]." ".$row[csf('percent_two')]."%";
								}
								$yarn_des.=$color_library[$row[csf('color')]]." ";
								$yarn_des.=$yarn_type[$row[csf('type_id')]];
								echo $yarn_des;
								?>
								</td>
								<td><? echo number_format($row[csf('yarn_required')],4); ?></td>
								<?
								if($show_yarn_rate==1)
								{
								?>
								 <td><? echo number_format($row[csf('rate')],4); ?></td>
								 <?
								}
								 ?>
								<td><? echo number_format($row[csf('rate')]*$row[csf('yarn_required')],4); ?></td>
							</tr>
							<?
							$tot_amt+=$row[csf('rate')]*$row[csf('yarn_required')];
							$tot_qty+=$row[csf('yarn_required')];
							}
							?>
							<tr align="center">
								<td>&nbsp; </td>
								<td align="right">Total</td>
								<td><? echo number_format($tot_qty,4); ?></td>
								<?
								if($show_yarn_rate==1)
								{
									?>
									<td></td>
									<?
								}
								?>
								<td><? echo number_format($tot_amt,4); ?></td>
							</tr>
							</table>
							<?
						}
						?>
						</td>
						<td width="2%">
						</td>
						<td width="49%" valign="top" align="center">
						<?
						if($cbo_booking_gr_arr[5]!="")
						{
							$yarn_sql_array=sql_select("SELECT min(a.id) as id, a.item_id, sum(a.qnty) as qnty ,min(b.supplier_id) as supplier_id,min(b.lot) as lot from inv_material_allocation_dtls a,product_details_master b where a.item_id=b.id and a.booking_no=$txt_booking_no and  a.status_active=1 and a.is_deleted=0 group by a.item_id order by a.id");
							if(count($yarn_sql_array)>0)
							{
							?>
							   <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
								<tr align="center">
								<td colspan="7"><b>Allocated Yarn</b></td>

								</tr>
								<tr align="center">
								<td>Sl</td>
								<td>Yarn Description</td>
								<td>Brand</td>
								<td>Lot</td>


								<td>Allocated Qty (Kg)</td>
								</tr>
								<?
								$total_allo=0;
								$item=return_library_array( "select id, product_name_details from   product_details_master",'id','product_name_details');
								$supplier=return_library_array( "select id, short_name from   lib_supplier",'id','short_name');
								
								$i=0;
								$total_yarn=0;
								foreach($yarn_sql_array  as $row)
								{

									$i++;
								?>
								<tr align="center">
								<td><? echo $i; ?></td>
								<td>
								<?

								echo $item[$row[csf('item_id')]];
								?>
								</td>
								<td>
								<?

								echo $supplier[$row[csf('supplier_id')]];
								?>
								</td>
								<td>
								<?

								echo $row[csf('lot')];
								?>
								</td>
								<td align="right"><? echo number_format($row[csf('qnty')],4); $total_allo+= $row[csf('qnty')];?></td>
								</tr>
								<?
								}
								?>
								<tr align="center">
								<td>Total</td>
								<td></td>


								<td></td>
								<td></td>
								<td align="right"><? echo number_format($total_allo,4); ?></td>
								</tr>
								</table>
								<?
							}
							else
							{
								$is_yarn_allocated=return_field_value("allocation", "variable_settings_inventory", "company_name=$cbo_company_name and variable_list=18 and item_category_id=1");
								if($is_yarn_allocated==1)
								{
								?>
								<font style=" font-size:30px"><!--<b> Draft</b>--></font>
								<?
								}
								else
								{
									echo "";
								}
							}
						}

						?>
						</td>
					</tr>
				</table>
				<br/>

				<?
				$txt_po_breack_down_id=str_replace("'","",$txt_order_no_id);
				$condition= new condition();
				if(str_replace("'","",$job_no) !=''){
					$condition->job_no("='$job_no'");
				}
				if(str_replace("'",'',$txt_po_breack_down_id) !=""){
					$condition->po_id("in($txt_po_breack_down_id)");
				}
				$condition->init();
				$conversion= new conversion($condition);
				//echo $conversion->getQuery();
				$conv_data_qty_arr=$conversion->getQtyArray_by_jobAndConversionid();
				$conversion= new conversion($condition);
				$conv_data_amt_arr=$conversion->getAmountArray_by_jobAndConversionid();

				$conversion_data=sql_select("select a.body_part_id,a.fab_nature_id, a.color_type_id,b.job_no,b.id,b.cons_process,b.fabric_description,b.charge_unit,b.color_break_down,b.amount from wo_pre_cost_fab_conv_cost_dtls b,wo_pre_cost_fabric_cost_dtls a where b.job_no='$job_no'  and a.job_no=b.job_no  and a.id=b.fabric_description and b.status_active=1 and b.is_deleted=0 order by  b.cons_process");
				$exchange_rate=return_field_value("exchange_rate", "wo_pre_cost_mst", "job_no='$job_no' and status_active=1 and is_deleted=0 ");
				?>

      <?

				
				 $fabric_description_arr=return_library_array( "select id,fabric_description from wo_pre_cost_fabric_cost_dtls",'id','fabric_description');

				?>
				<table  width="650"  border="0" cellpadding="0" cellspacing="0" align="left" >
					<tr>
						<td width="49%" valign="top">
							<?
							if($cbo_booking_gr_arr[6]!="")
							{
								?>
								<style type="text/css">

									hr {
										border: 0;
										background-color: #000;
										height: 1px;
									}
								</style>
								<table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
								 <tr align="center">
                <td colspan="5"><b>Conversion Charge</b></td>
                </tr>
                <tr style="font-weight:bold">
                    <td width="350">Fabric Description</td>
                    <td width="100">Process</td>
                    <td width="100">Required</td>
                    <td width="100">Rate</td>
                    <td width="100">Amount</td>
                </tr>
            <?
            $total_conversion_cost=0;
			$total_conversion_cost_dzn=0;
			$total_conversion_cost_kg=0;
			$total_convsion_qty=0;
			$total_avg_convsion_qty=0;
			$grand_total_conv_qnty=0;
			$grand_total_avg_convsion_qty=0;
			$grand_total_conversion_cost=0;
			$process_array_check=array();
			$k=1;
            foreach( $conversion_data as $row )
            {
				$process_id=$row[csf("cons_process")];
				$cqty=$conv_data_qty_arr[$row[csf("job_no")]][$row[csf('id')]];
				$camt=$conv_data_amt_arr[$row[csf("job_no")]][$row[csf('id')]];
				if($cqty>0){
				if (!in_array($process_id,$process_array_check) )
						{
							if($k!=1)
							{
								?>
                               <tr>
                                    <td>&nbsp;</td>
                                    <td><strong>Sub. Total : </strong></td>
                                    <td align="right"><strong><? echo number_format($total_convsion_qty,4); ?></strong></td>
                                    <td>&nbsp;</td>
                                    <td align="right"><strong><? echo number_format($total_conversion_cost,2); ?></td>
                                </tr>
                                <?
							}
							?>
                            <?
							unset($total_convsion_qty);
							unset($total_avg_convsion_qty);
							unset($total_conversion_cost);
							$process_array_check[]=$process_id;
							$k++;
						}

			?>
                <tr>
                    <td align="left"><? echo  $body_part[$row[csf("body_part_id")]].', '.$color_type[$row[csf("color_type_id")]].', '.$fabric_description_arr[$row[csf("fabric_description")]];  ?></td>
                    <td align="left"><? echo $conversion_cost_head_array[$row[csf("cons_process")]]; ?></td>
                    <td align="right"><? echo number_format($cqty,4); ?></td>
                    <td align="right"><? echo number_format($row[csf("charge_unit")],4); ?></td>
                    <td align="right"><? echo number_format($camt,2); ?></td>
                </tr>
            <?
			$total_convsion_qty+=$cqty;
            $total_conversion_cost += $camt;
			$grand_total_conv_qnty+=$cqty;
			$grand_total_conversion_cost+= $camt;
			$total_conversion_cost_dzn+=$row[csf('amount')];
			$total_conversion_cost_kg=$grand_total_conversion_cost/$total_avg_yarn_qty;//$grand_total_avg_convsion_qty;
            }
			}
            ?>
            <tr class="rpt_bottom" style="font-weight:bold">
                <td>&nbsp;</td>
                <td align="right">Sub. Total</td>
                <td align="right"><? echo number_format($total_convsion_qty,4); ?></td>
                <td>&nbsp;</td>
                <td align="right"><? echo number_format($total_conversion_cost,2); ?></td>
            </tr>
            <tr class="rpt_bottom" style="font-weight:bold">
                <td colspan="2" align="right">Grand Total</td>
                <td align="right"><? //echo number_format($grand_total_conv_qnty,4); ?></td>
                <td>&nbsp;</td>
                <td align="right"><? echo number_format($grand_total_conversion_cost,2); ?></td>
            </tr>
								</table>
								<?
							}
							?>

						</td>


					</tr>
				</table>
				<br/>


				<?

				?>
				<br>
				<table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
					<tr>
						<td width="49%" valign="top">
						<?
						if($cbo_booking_gr_arr[7]!="")
						{
							$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
							if(count($sql_embelishment)>0)
							{
							?>
								<table  width="100%"  border="1" style="margin:5px" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
								<tr align="center">
								<td colspan="7"><b>Embelishment (Pre Cost)</b></td>

								</tr>
								<tr align="center">
								<td>Sl</td>
								<td>Embelishment Name</td>
								<td>Embelishment Type</td>
								<td>Cons <? echo $costing_per; ?> Gmts</td>
								<td>Rate</td>
								<td>Amount</td>

								</tr>
								<?
								$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
								$i=0;
								//$total_yarn=0;
								foreach($sql_embelishment  as $row_embelishment)
								{

									$i++;
								?>
								<tr align="center">
								<td><? echo $i; ?></td>
								<td>
								<?
								echo $emblishment_name_array[$row_embelishment[csf('emb_name')]];
								?>
								</td>
								<td>
								<?
								if($row_embelishment[csf('emb_name')]==1)
								{
								echo $emblishment_print_type[$row_embelishment[csf('emb_type')]];
								}
								if($row_embelishment[csf('emb_name')]==2)
								{
								echo $emblishment_embroy_type[$row_embelishment[csf('emb_type')]];
								}
								if($row_embelishment[csf('emb_name')]==3)
								{
								echo $emblishment_wash_type[$row_embelishment[csf('emb_type')]];
								}
								if($row_embelishment[csf('emb_name')]==4)
								{
								echo $emblishment_spwork_type[$row_embelishment[csf('emb_type')]];
								}
								if($row_embelishment[csf('emb_name')]==5)
								{
								echo $row_embelishment[csf('emb_type')];
								}
								?>

								</td>
								<td>
								<?
								echo $row_embelishment[csf('cons_dzn_gmts')];
								?>
								</td>
								<td>
								<?
								echo $row_embelishment[csf('rate')];
								?>
								</td>

								<td>
								<?
								echo $row_embelishment[csf('amount')];
								?>
								</td>


								</tr>
								<?
								}
								?>
								</table>
								<?
							}
						}
						?>
						</td>
						<td width="2%">
						</td>
						<td width="49%" valign="top" align="center">
						<?
							$sql_approv=sql_select("select b.cost_component_id,b.approved_by,b.approved_date from precost_component_app_mst b,wo_pre_cost_mst a where a.job_id=b.job_id and a.job_no='$job_no' and a.status_active=1 and 	a.is_deleted=0 and b.cost_component_id=1" );
							//echo "select b.cost_component_id,b.approved_by,b.approved_date from precost_component_app_mst b,wo_pre_cost_mst a where a.job_id=b.job_id and b.job_no='$job_no' and b.status_active=1 and 	b.is_deleted=0 and b.cost_component_id=1";
								foreach($sql_approv as $row)
								{
									$approved_by=$row[csf('approved_by')];
								}

						//if($cbo_booking_gr_arr[8]!="")
						//{
							?>
							<table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
								<tr align="center">
								<td><b>Approved Instructions  </b></td>
								</tr>
								<tr>
								<td>
								<b style="color:#00CC33">
								 <?  if($approved_by) echo "This fabric booking budget electronic approved by knitting and dyeing, So no need take manual signature in fabric booking."; ?> </b>
								</td>
								</tr>
							</table>
							<?
						//}
						?>
						</td>
					</tr>
				</table>
				<br/>
				<table   align="left"  width="49%"  border="0" cellpadding="0" cellspacing="0" >
					<tr>
						
						
						<td width="49%" valign="top" align="center">
						<?
						  $poSql = "select ID,PO_NUMBER,JOB_ID from WO_PO_BREAK_DOWN where job_no_mst='$job_no' and id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1"; 
						$poSqlRes = sql_select($poSql);
						foreach($poSqlRes as $rows)
						{
							$job_id=$rows['JOB_ID'];
						}
					
					
						$commentsSql = "select a.PO_NUMBER,b.MST_DTLS_ID ,b.COMMENTS,b.INSERTED_BY,b.INSERT_DATE  FROM  WO_PO_BREAK_DOWN a,COMMON_COMMENTS_LIBRARY b where a.job_no_mst='$job_no' and a.id in(".str_replace("'","",$txt_order_no_id).") and a.is_deleted=0 and a.status_active=1 and b.MST_ID=a.JOB_ID and b.TYPE=1  and b.FORM_NAME='component_wise_precost_app' GROUP BY a.PO_NUMBER,b.MST_DTLS_ID ,b.COMMENTS,b.INSERTED_BY,b.INSERT_DATE";
						$commentsSqlRes = sql_select($commentsSql);
						$commentsDataArr=array();
						foreach($commentsSqlRes as $commentsRow){
							$inserted_date=change_date_format($commentsRow['INSERT_DATE'],"dd-mm-yyyy","-");
							$commentsDataArr[$commentsRow['INSERTED_BY']][$inserted_date][$commentsRow['MST_DTLS_ID']]['COMMENTS'] = $commentsRow['COMMENTS'];
							$commentsDataArr[$commentsRow['INSERTED_BY']][$inserted_date][$commentsRow['MST_DTLS_ID']]['PO_NUMBER'] = $commentsRow['PO_NUMBER'];
						}
						$user_arr=return_library_array( "select id,user_name from   user_passwd ",'id','user_name');
						if($cbo_booking_gr_arr[8]!="")
						{
							?>
							<table style="margin:5px" width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
								<tr align="center">
								<td colspan=4><b>PO Wise Fabric Comments: </b></td>
								</tr>
								<tr>
									<td width="100" align="center">USER Name </td>
									<td width="100" align="center">Date </td>
									<td width="100" align="center">PO NO </td>
									<td width="200" align="center">Comments </td>
						        </tr>
								<?php

								foreach ($commentsDataArr as $insertWiseData=>$insertData) { 			
									foreach ($insertData as $insertDateWiseData => $insertDateData) { 
										foreach ($insertDateData as $mstId => $value) { 
										$insert_wise_rowspan[$insertWiseData]+=1;
										}
									}
								}
								foreach ($commentsDataArr as $insertWiseData=>$insertData) { 
									foreach ($insertData as $insertDateWiseData => $insertDateData) { 
									$k=1;
										foreach ($insertDateData as $mstId => $value) { 
												 
									?>
									<tr>
									<?
									if($k==1){?>
										<td width="100" style="font-size: 16px;" align="center" rowspan="<?=$insert_wise_rowspan[$insertWiseData] ?>"><? echo  $user_arr[$insertWiseData];?></td>
										<td width="100" style="font-size: 16px;" align="center" rowspan="<?=$insert_wise_rowspan[$insertWiseData] ?>"><? echo  $insertDateWiseData;?></td>
										<? $k++;}?>
										<td width="100" style="font-size: 16px;" align="center"><? echo $value['PO_NUMBER']; ?></td>
										<td width="200" style="font-size: 16px;" align="center"><? echo $value['COMMENTS']; ?></td>
										<?
									}
									$k++;
								}
								}
								?>
							</table>
							<?
						}
						?>
						</td>
					</tr>
				</table>
				<br/>
				<br/>
				<?
				}// fabric Source End

				if($cbo_fabric_source==1 || $cbo_fabric_source==2 || $cbo_fabric_source==3)
				{

					?>
					<table  width="100%"  border="0" cellpadding="0" cellspacing="0">
					<tr>
						<td width="49%" valign="top">
						<?
						if($cbo_booking_gr_arr[9]!="")
						{
							?>
							<table  width="100%"  border="1" cellpadding="0" cellspacing="0">
								<thead>
								<tr>
								<th width="3%"></th><th width="97%" align="left"><u>Special Instruction</u></th>
								</tr>
								</thead>
								<tbody>
								<?
								$data_array=sql_select("select id, terms from  wo_booking_terms_condition where booking_no=$txt_booking_no");// quotation_id='$data'
								if ( count($data_array)>0)
								{
									$i=0;
									foreach( $data_array as $row )
									{
										$i++;
										?>
										<tr id="settr_1" valign="top">
										<td style="vertical-align:top">
										<? echo $i;?>
										</td>
										<td>
										<strong style="font-size:20px"> <? echo $row[csf('terms')]; ?></strong>
										</td>
										</tr>
										<?
									}
								}
								/*else
								{
								$i=0;
								$data_array=sql_select("select id, terms from  lib_terms_condition");// quotation_id='$data'
								foreach( $data_array as $row )
								{
								$i++;
								?>
								<tr id="settr_1" align="">
								<td valign="top">
								<? echo $i;?>
								</td>
								<td>
								<? echo $row['terms']; ?>
								</td>

								</tr>
								<?
								}
								} */
								?>
								</tbody>
							</table>
							<?
						}
						?>
						</td>
						<td width="2%">
						</td>
						<td width="49%" valign="top">
						<?
						if($cbo_booking_gr_arr[10]!="")
						{
							?>
							<table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
							<tr align="center">
								<td colspan="10"><b>Comments</b></td>
							</tr>
							<tr align="center">
                                <td>Sl</td>
                                <td>Po NO</td>
                                <td>Ship Date</td>
                                <td>Pre-Cost Qty</td>
                                <td>Mn.Book Qty</td>
                                <td>Sht.Book Qty</td>
                                <td>Smp.Book Qty</td>
                                <td>Tot.Book Qty</td>
                                <td>Balance</td>
                                <td>Comments</td>
							</tr>
							<?
							$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
							$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
							if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
							if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
							$paln_cut_qnty_array=return_library_array( "select min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id,size_number_id,item_number_id,po_break_down_id", "id", "plan_cut_qnty");

							$item_ratio_array=return_library_array( "select gmts_item_id,set_item_ratio from wo_po_details_mas_set_details  where job_no =$txt_job_no", "gmts_item_id", "set_item_ratio");
							$nameArray=sql_select("
							select
							a.id,
							a.item_number_id,
							a.costing_per,
							b.po_break_down_id,
							b.color_size_table_id,
							b.requirment,
							c.po_number,
							c.id as po_id
						FROM
							wo_pre_cost_fabric_cost_dtls a,
							wo_pre_cos_fab_co_avg_con_dtls b,
							wo_po_break_down c
						WHERE
							a.job_no=b.job_no and
							a.job_no=c.job_no_mst and
							a.id=b.pre_cost_fabric_cost_dtls_id and
							b.po_break_down_id=c.id and
							b.po_break_down_id in (".str_replace("'","",$txt_order_no_id).")  $cbo_fabric_natu $cbo_fabric_source_cond and a.status_active=1 and a.is_deleted=0
							order by id");
							$count=0;
							$tot_grey_req_as_pre_cost_arr=array();
							foreach ($nameArray as $result)
							{
								if (count($nameArray)>0 )
								{
									if($result[csf("costing_per")]==1)
									{
										$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(12*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
									}
									if($result[csf("costing_per")]==2)
									{
										$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(1*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
									}
									if($result[csf("costing_per")]==3)
									{
										$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(24*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
									}
									if($result[csf("costing_per")]==4)
									{
										$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(36*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
									}
									if($result[csf("costing_per")]==5)
									{
										$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(48*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
									}
									$tot_grey_req_as_pre_cost_arr[$result[csf("po_id")]]+=$tot_grey_req_as_pre_cost;
								}
							}
							$total_pre_cost=0;
							$total_booking_qnty_main=0;
							$total_booking_qnty_short=0;
							$total_booking_qnty_sample=0;
							$total_tot_bok_qty=0;
							$tot_balance=0;

							/*$booking_qnty=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and booking_type in(1,4)  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by a.po_break_down_id", "po_break_down_id", "grey_fab_qnty");*/
							//$booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and a.is_short=2 and c.item_category=2 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
							//echo "select a.po_break_down_id as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and a.is_short=2 and c.item_category=2 and a.status_active=1 and a.is_deleted=0 group by a.po_break_down_id order by po_break_down_id";

							$booking_qnty_main=return_library_array( "select a.po_break_down_id as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and a.is_short=2 and c.item_category=$item_cat_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.po_break_down_id order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

							$booking_qnty_short=return_library_array( "select a.po_break_down_id as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and c.item_category=$item_cat_id and a.is_short=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.po_break_down_id order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
							$booking_qnty_sample=return_library_array( "select a.po_break_down_id as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c,wo_pre_cost_fabric_cost_dtls d   where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.pre_cost_fabric_cost_dtls_id=d.id and  d.job_no= b.job_no_mst  and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =4 and c.fabric_source=$cbo_fabric_source and c.item_category=$item_cat_id  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.po_break_down_id order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
							$sql_data=sql_select( "select a.id as id,  a.po_number, max(a.pub_shipment_date) as pub_shipment_date,sum(a.plan_cut) as plan_cut  from wo_po_break_down a,wo_pre_cost_sum_dtls b,wo_pre_cost_mst c where a.job_no_mst=b.job_no and a.job_no_mst=c.job_no and a.id in(".str_replace("'","",$txt_order_no_id).") group by a.id, a.po_number order by id");
							foreach($sql_data  as $row)
							{
								$col++;
								?>
								<tr align="center">
                                    <td><? echo $col; ?></td>
                                    <td><? echo $row[csf("po_number")]; ?></td>
                                     <td><? echo change_date_format($row[csf("pub_shipment_date")],"dd-mm-yyyy",'-'); ?></td>
                                    <td align="right"><? echo number_format($tot_grey_req_as_pre_cost_arr[$row[csf("id")]],2); $total_pre_cost+=$tot_grey_req_as_pre_cost_arr[$row[csf("id")]]; ?></td>
                                    <td align="right"><? echo number_format($booking_qnty_main[$row[csf("id")]],2); $total_booking_qnty_main+=$booking_qnty_main[$row[csf("id")]];?></td>
                                    <td align="right"><? echo number_format($booking_qnty_short[$row[csf("id")]],2); $total_booking_qnty_short+=$booking_qnty_short[$row[csf("id")]];?></td>
                                    <td align="right"><? echo number_format($booking_qnty_sample[$row[csf("id")]],2); $total_booking_qnty_sample+=$booking_qnty_sample[$row[csf("id")]];?></td>
                                    <td align="right"><? $tot_bok_qty=$booking_qnty_main[$row[csf("id")]]+$booking_qnty_short[$row[csf("id")]]+$booking_qnty_sample[$row[csf("id")]]; echo number_format($tot_bok_qty,2); $total_tot_bok_qty+=$tot_bok_qty;?></td>
                                    <td align="right">
                                    <? $balance= def_number_format($tot_grey_req_as_pre_cost_arr[$row[csf("id")]]-$tot_bok_qty,2,""); echo number_format($balance,2); $tot_balance+= $balance?>
                                    </td>
                                    <td>
                                    <?
                                    if( $balance>0)
                                    {
                                        echo "Less Booking";
                                    }
                                    else if ($balance<0)
                                    {
                                        echo "Over Booking";
                                    }
                                    else
                                    {
                                        echo "";
                                    }
                                    ?>
                                    </td>
								</tr>
								<?
							}
							?>
							<tfoot>
							<tr>
							<td colspan="3">Total:</td>
							<td align="right"><? echo number_format($total_pre_cost,2); ?></td>
							<td align="right"><? echo number_format($total_booking_qnty_main,2); ?></td>
							<td align="right"><? echo number_format($total_booking_qnty_short,2); ?></td>
							<td align="right"><? echo number_format($total_booking_qnty_sample,2); ?></td>
							 <td align="right"><? echo number_format($total_tot_bok_qty,2); ?></td>
							<td align="right"><? echo number_format($tot_balance,2); ?></td>
							<td></td>
							</tr>
							</tfoot>
							</table>
							<?
						}
						?>
						</td>
					</tr>
				</table>
				<br>
				<?
				if($cbo_booking_gr_arr[11]!="")
				{
					?>
					<fieldset id="div_size_color_matrix" style="max-width:1000;">
					<legend>TNA Information</legend>
					<!--<span style="font-size:180; font-weight:bold;"></span>-->
					<table width="100%" style="border:1px solid black;font-size:12px" border="1" cellpadding="2" cellspacing="0" rules="all">
						<tr>
							<td rowspan="2" align="center" valign="top">SL</td>
							<td width="180" rowspan="2"  align="center" valign="top"><b>Order No</b></td>
							<td colspan="2" align="center" valign="top"><b>Fabric Booking</b></td>
                            <td colspan="2" align="center" valign="top"><b>Yarn Issue</b></td>
							<td colspan="2" align="center" valign="top"><b>Knitting</b></td>
							<td colspan="2" align="center" valign="top"><b>Dyeing</b></td>
							<td colspan="2" align="center" valign="top"><b>Finishing Fabric</b></td>
							<td colspan="2" align="center" valign="top"><b>Cutting </b></td>
							<td colspan="2" align="center" valign="top"><b>Sewing </b></td>
							<td colspan="2"  align="center" valign="top"><b>Ex-factory </b></td>
						</tr>
						<tr>
							<td width="70" align="center" valign="top"><b>Start Date</b></td>
							<td width="70" align="center" valign="top"><b>End Date</b></td>
                            <td width="70" align="center" valign="top"><b>Start Date</b></td>
							<td width="70" align="center" valign="top"><b>End Date</b></td>
							<td width="70" align="center" valign="top"><b>Start Date</b></td>
							<td width="70" align="center" valign="top"><b>End Date</b></td>
							<td width="70" align="center" valign="top"><b>Start Date</b></td>
							<td width="70" align="center" valign="top"><b>End Date</b></td>
							<td width="70" align="center" valign="top"><b>Start Date</b></td>
							<td width="70" align="center" valign="top"><b>End Date</b></td>
							<td width="70" align="center" valign="top"><b>Start Date</b></td>
							<td width="70" align="center" valign="top"><b>End Date</b></td>
							<td width="70" align="center" valign="top"><b>Start Date</b></td>
							<td width="70" align="center" valign="top"><b>End Date</b></td>
							<td width="70" align="center" valign="top"><b>Start Date</b></td>
							<td width="70" align="center" valign="top"><b>End Date</b></td>

						</tr>
						<?
						$i=1;
						foreach($tna_date_task_arr as $order_id=>$row)
						{
							 //$tna_date_task_arr//knitting_start_date dying_start_date finishing_start_date cutting_start_date sewing_start_date exfact_start_date
							?>
							<tr>
								<td><? echo $i; ?></td>
								<td><? echo $po_num_arr[$order_id]; ?></td>
								<td align="center"><? echo change_date_format($row['fab_booking_start_date']); ?></td>
								<td  align="center"><? echo change_date_format($row['fab_booking_end_date']); ?></td>
                                <td align="center"><? echo change_date_format($row['yarn_issue_start_date']); ?></td>
								<td  align="center"><? echo change_date_format($row['yarn_issue_end_date']); ?></td>
								<td align="center"><? echo change_date_format($row['knitting_start_date']); ?></td>
								<td  align="center"><? echo change_date_format($row['knitting_end_date']); ?></td>
								<td align="center"><? echo change_date_format($row['dying_start_date']); ?></td>
								<td align="center"><? echo change_date_format($row['dying_end_date']); ?></td>
								<td align="center"><? echo change_date_format($row['finishing_start_date']); ?></td>
								<td align="center"><? echo change_date_format($row['finishing_end_date']); ?></td>
								<td align="center"><? echo change_date_format($row['cutting_start_date']); ?></td>
								<td align="center"><? echo change_date_format($row['cutting_end_date']); ?></td>
								<td align="center"><? echo change_date_format($row['sewing_start_date']); ?></td>
								<td align="center"><? echo change_date_format($row['sewing_end_date']); ?></td>
								<td align="center"><? echo change_date_format($row['exfact_start_date']); ?></td>
								<td align="center"><? echo change_date_format($row['exfact_end_date']); ?></td>
							</tr>
							<?
							$i++;
						}
						?>

					</table>
					</fieldset>
					<?
				}
				}
			}
			else
			{
						if($cbo_fabric_source==1 || $cbo_fabric_source==2 || $cbo_fabric_source==3)
						{
						 $nameArray_size=sql_select( "select distinct size_number_id from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  	is_deleted=0 and status_active=1  order by size_number_id desc");
						 $po_number=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number");
						 $po_ship_date_arr=return_library_array( "select id,pub_shipment_date from   wo_po_break_down ",'id','pub_shipment_date');
					   ?>
						<table width="100%" >
							<tr>
								<td width="100%">
								<div id="div_size_color_matrix" style="float:left; max-width:1000;">
								<fieldset id="div_size_color_matrix" style="max-width:1000;">
								<legend>Size and Color Breakdown </legend>
								<table  class="rpt_table"  border="1" align="left" cellpadding="0" width="750" cellspacing="0" rules="all" >
									<tr>
										<td style="border:1px solid black"><strong>PO NO.</strong></td>
										<td style="border:1px solid black"><strong>PO Status</strong></td>
										<td style="border:1px solid black"><strong>Ship Date</strong></td>
										<td style="border:1px solid black"><strong>Gmts Item</strong></td>
										<td style="border:1px solid black"><strong>Color/Size</strong></td>
									<?
										foreach($nameArray_size  as $result_size)
										{	     ?>
										<td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
									<?	}    ?>
										<td style="border:1px solid black; width:130px" align="center"><strong> Total Order Qty(Pcs)</strong></td>
										<td style="border:1px solid black; width:80px" align="center"><strong> Excess %</strong></td>
										<td style="border:1px solid black; width:130px" align="center"><strong> Total Plan Cut Qty(Pcs)</strong></td>
									</tr>
									<?
									$color_size_order_qnty_array=array();
									$color_size_qnty_array=array();
									$size_tatal=array();
									$size_tatal_order=array();
									$order_id=explode(",",str_replace("'","",$txt_order_no_id));
									for($or=0;$or<count($order_id); $or++)
									{
									for($c=0;$c<count($gmts_item); $c++)
									{
									$item_size_tatal=array();
									$item_size_tatal_order=array();
									$item_grand_total=0;
									$item_grand_total_order=0;
									$nameArray_color=sql_select( "select distinct color_number_id from wo_po_color_size_breakdown where  item_number_id=$gmts_item[$c] and po_break_down_id =$order_id[$or] and is_deleted=0 and status_active=1 order by color_number_id");
									?>
								   <!-- <tr>
									<td style="border:1px solid black" colspan="<? echo count($nameArray_size)+3;?>"><strong><? echo $garments_item[$gmts_item[$c]];?></strong></td>

									</tr>-->
									<?
									foreach($nameArray_color as $result_color)
									{
									?>
									<tr>
										<td align="center" style="border:1px solid black"><? echo $po_number_arr[$order_id[$or]]; // echo $row_num_tr; ?></td>
										<td align="center" style="border:1px solid black"><? echo $po_status_arr[$order_id[$or]]; // echo $row_num_tr; ?></td>
										 <td align="center" style="border:1px solid black"><? echo change_date_format($po_ship_date_arr[$order_id[$or]],"dd-mm-yyyy","-"); // echo $row_num_tr; ?></td>
										  <td align="center" style="border:1px solid black"><? echo $garments_item[$gmts_item[$c]]; // echo $row_num_tr; ?></td>
										<td align="center" style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; // echo $row_num_tr; ?></td>
										<?
										$color_total=0;
										$color_total_order=0;

										foreach($nameArray_size  as $result_size)
										{
										$nameArray_color_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id =$order_id[$or] and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$result_color[csf('color_number_id')]."  and item_number_id=$gmts_item[$c] and  status_active=1 and is_deleted =0 order by size_number_id");
										foreach($nameArray_color_size_qnty as $result_color_size_qnty)
										{

										?>
											<td style="border:1px solid black; text-align:right">
											<?
												if($result_color_size_qnty[csf('plan_cut_qnty')]!= "")
												{
													 echo number_format($result_color_size_qnty[csf('order_quantity')],0);
													 $color_total += $result_color_size_qnty[csf('plan_cut_qnty')] ;
													 $color_total_order += $result_color_size_qnty[csf('order_quantity')] ;
													 $item_grand_total+=$result_color_size_qnty[csf('plan_cut_qnty')];
													 $item_grand_total_order+=$result_color_size_qnty[csf('order_quantity')];
													 $grand_total +=$result_color_size_qnty[csf('plan_cut_qnty')];
													 $grand_total_order +=$result_color_size_qnty[csf('order_quantity')];
													 $color_size_qnty_array[$result_size[csf('size_number_id')]][$result_color['color_number_id']]=$result_color_size_qnty[csf('plan_cut_qnty')];
													 $color_size_order_qnty_array[$result_size[csf('size_number_id')]][$result_color[csf('color_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
													 if (array_key_exists($result_size[csf('size_number_id')], $size_tatal))
													 {
															$size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
															$size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
													 }
													 else
													 {
														$size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
														$size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
													 }
													 if (array_key_exists($result_size[csf('size_number_id')], $item_size_tatal))
													 {
															$item_size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
															$item_size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
													 }
													 else
													 {
														$item_size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
														$item_size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
													 }
												}
												else echo "0";
											 ?>
											</td>

									<?
										}
										}
										?>
										<td style="border:1px solid black; text-align:right"><? echo number_format(round($color_total_order),0); ?></td>
										 <td style="border:1px solid black; text-align:right"><? $excexss_per=($color_total-$color_total_order)/$color_total_order*100; echo number_format($excexss_per,2)." %"; ?></td>
										 <td style="border:1px solid black; text-align:right"><? echo number_format(round($color_total),0); ?></td>
									</tr>
									<?
									}
									?>
									<tr>
									  <td align="center" style="border:1px solid black"><strong></strong></td>
									  <td align="center" style="border:1px solid black"><strong></strong></td>
									  <td align="center" style="border:1px solid black"><strong></strong></td>
									    <td align="center" style="border:1px solid black"><strong></strong></td>
										<td align="center" style="border:1px solid black"><strong>Sub Total</strong></td>
										<?
										foreach($nameArray_size  as $result_size)
										{
										?>
										<td style="border:1px solid black;  text-align:right"><? echo $item_size_tatal_order[$result_size[csf('size_number_id')]];  ?></td>
										<?
										}
										?>
										<td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($item_grand_total_order),0); ?></td>
										<td  style="border:1px solid black;  text-align:right"><? $excess_item_gra_tot=($item_grand_total-$item_grand_total_order)/$item_grand_total_order*100; echo number_format($excess_item_gra_tot,2)." %"; ?></td>
										<td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($item_grand_total),0); ?></td>
									</tr>
									<?
									}
									}
									?>
									 <tr>
										<td style="border:1px solid black" align="center" colspan="<? echo count($nameArray_size)+5; ?>"><strong>&nbsp;</strong></td>
									</tr>
									<!--<tr>-->
									<tr>
									<td align="center" style="border:1px solid black"><strong></strong></td>
									<td align="center" style="border:1px solid black"><strong></strong></td>
									<td align="center" style="border:1px solid black"><strong></strong></td>
									<td align="center" style="border:1px solid black"><strong></strong></td>
										<td align="center" style="border:1px solid black"><strong>Grand Total</strong></td>
										<?
										foreach($nameArray_size  as $result_size)
										{
										?>
										<td style="border:1px solid black;  text-align:right"><? echo $size_tatal_order[$result_size[csf('size_number_id')]];  ?></td>
										<?
										}
										?>
										<td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($grand_total_order),0); ?></td>
										<td  style="border:1px solid black;  text-align:right"><? $excess_gra_tot= ($po_qnty_tot-$grand_total_order)/$grand_total_order*100; echo number_format($excess_gra_tot,2)." %"; ?></td>
										<td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($po_qnty_tot),0); ?></td>
									</tr>
								</table>
									</fieldset>
									</div>
								</td>
							</tr>
					   </table>
						<?
						}// if($cbo_fabric_source==1) end

			  ?>
			  <br/>

			<!--  Here will be the main portion  -->
			<?
			$costing_per="";
			$costing_per_qnty=0;
			$costing_per_id=return_field_value( "costing_per", "wo_pre_cost_mst","job_no ='$job_no'");
			if($costing_per_id==1)
			{
				$costing_per="1 Dzn";
				$costing_per_qnty=12;
			}
			if($costing_per_id==2)
			{
				$costing_per="1 Pcs";
				$costing_per_qnty=1;
			}
			if($costing_per_id==3)
			{
				$costing_per="2 Dzn";
				$costing_per_qnty=24;
			}
			if($costing_per_id==4)
			{
				$costing_per="3 Dzn";
				$costing_per_qnty=36;
			}
			if($costing_per_id==5)
			{
				$costing_per="4 Dzn";
				$costing_per_qnty=48;
			}
			$process_loss_method=return_field_value( "process_loss_method", "wo_pre_cost_fabric_cost_dtls","job_no='$job_no'");

			?>

			<?
				if($cbo_fabric_source==1 )
				{
				$nameArray_fabric_description= sql_select("select a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type, b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent , avg(b.requirment) as requirment FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				d.status_active=1 and
				d.is_deleted=0
				group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by a.body_part_id,b.dia_width");
				 ?>

				 <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
				 <tr align="center">
				 <th colspan="3" align="left">Body Part</th>
					<?
					foreach($nameArray_fabric_description  as $result_fabric_description)
					{
						if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
						else         		               echo "<td  colspan='2'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
					}
					?>
					<td  rowspan="9" width="50"><p>Total  Finish Fabric <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
					<td  rowspan="9" width="50"><p>Total Grey Fabric <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
					<td  rowspan="9" width="50"><p>Process Loss % </p></td>
				   </tr>
				 <tr align="center"><th colspan="3" align="left">Color Type</th>
					<?
					foreach($nameArray_fabric_description  as $result_fabric_description)
					{
						if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
						else         		               echo "<td  colspan='2'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
					}
					?>
					<!--<td  rowspan="8" width="50"><p>Total  Finish Fabric (KG)</p></td> <td  rowspan="8" width="50"><p>Total Grey Fabric (KG)</p></td>-->
						 <!--<td  rowspan="7" width="50"><p>Process Loss % </p></td>-->
				   </tr>
					<tr align="center"><th colspan="3" align="left">Fabric Construction</th>
					<?
					foreach($nameArray_fabric_description  as $result_fabric_description)
					{
						if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='2'>&nbsp</td>";
						else         		               echo "<td  colspan='2'>". $result_fabric_description[csf('construction')]."</td>";
					}
					?>


				   </tr>
					<tr align="center"><th   colspan="3" align="left">Fabric Composition</th>
					<?
					foreach($nameArray_fabric_description as $result_fabric_description)
					{
						if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='2' >&nbsp</td>";
						else         		               echo "<td colspan='2' >".$result_fabric_description[csf('composition')]."</td>";
					}
					?>

				   </tr>
				   <tr align="center"><th  colspan="3" align="left">GSM</th>
					<?
					foreach($nameArray_fabric_description  as $result_fabric_description)
					{
						if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='2'>&nbsp</td>";
						else         		       echo "<td colspan='2' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
					}
					?>

				   </tr>
				   <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
					<?
					foreach($nameArray_fabric_description as $result_fabric_description)
					{
						if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='2'>&nbsp</td>";
						else         		              echo "<td colspan='2' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
					}
					?>

				   </tr>
				   <tr align="center"><th   colspan="3" align="left">Consumption For <? echo $costing_per; ?></th>
					<?
					foreach($nameArray_fabric_description as $result_fabric_description)
					{
						if( $result_fabric_description[csf('requirment')] == "")   echo "<td colspan='2'>&nbsp</td>";
						else         		              echo "<td colspan='2' align='center'>Fin: ".number_format($result_fabric_description[csf('cons')],4).", Grey: ".number_format($result_fabric_description[csf('requirment')],4)."</td>";
					}
					?>

				   </tr>
				   <tr>
				   <th  colspan="<? echo  count($nameArray_fabric_description)*2+3; ?>" align="left" style="height:30px">&nbsp;</th>
				   </tr>

				   <tr>
						<!--<th  width="120" align="left">Gmts. Color</th>-->
						<th  width="120" align="left">Fabric Color</th>
						<th  width="120" align="left">Body Color</th>
						<th  width="120" align="left">Lab Dip No</th>
					<?
					foreach($nameArray_fabric_description as $result_fabric_description)
					{
						  echo "<th width='50'>Finish</th><th width='50' >Gray</th>";
					}
					?>

				   </tr>
				   <?

					  /*$gmt_color_library=return_library_array( "select gmts_color_id,contrast_color_id
					  FROM
					  wo_pre_cos_fab_co_color_dtls
					  WHERE
					  job_no ='$job_no'", "contrast_color_id", "gmts_color_id");*/
					  $gmt_color_library=array();
					  $gmt_color_data=sql_select("select b.gmts_color_id, b.contrast_color_id
					  FROM
					  wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b
					  WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.fabric_source =$cbo_fabric_source and
					  a.job_no ='$job_no'");
					  foreach( $gmt_color_data as $gmt_color_row)
					  {
						//$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
						$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
					  }

						$grand_total_fin_fab_qnty=0;
						$grand_total_grey_fab_qnty=0;
						$grand_totalcons_per_finish=0;
						$grand_totalcons_per_grey=0;
						$color_wise_wo_sql=sql_select("select fabric_color_id
													  FROM
													  wo_booking_dtls
													  WHERE
													  booking_no =$txt_booking_no and
													  status_active=1 and
													  is_deleted=0
													  group by fabric_color_id");
					foreach($color_wise_wo_sql as $color_wise_wo_result)
					{
					?>
						<tr>
					   <!-- <td  width="120" align="left">
						<?

						//echo $color_library[$color_wise_wo_result['fabric_color_id']];

						?></td>-->
						<td  width="120" align="left">
						<?
						echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];


						?>
						</td>
						<td>
						<?
						//echo $color_library[$gmt_color_library[$color_wise_wo_result['fabric_color_id']]];
						//echo rtrim($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]],",");
						echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
						?>
						</td>
						<td  width="120" align="left">
						<?
						$order_id=str_replace("'","",$txt_order_no_id);
						$lapdip_no="";
						$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."'  and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
						//echo "lapdip_no from wo_po_lapdip_approval_info where job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result['fabric_color_id']."";
						if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
						?>
						</td>
						<?
						$total_fin_fab_qnty=0;
						$total_grey_fab_qnty=0;

						foreach($nameArray_fabric_description as $result_fabric_description)
						{
							/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
							  FROM
							  view_wo_fabric_booking_data_park a,
							  wo_booking_dtls b
							  WHERE
							  b.booking_no =$txt_booking_no  and
							  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
							  a.po_break_down_id=b.po_break_down_id and
							  a.color_size_table_id=b.color_size_table_id and
							  a.color_type_id='".$result_fabric_description['color_type_id']."' and
							  a.construction='".$result_fabric_description['construction']."' and
							  a.composition='".$result_fabric_description['composition']."' and
							  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
							  a.dia_width='".$result_fabric_description['dia_width']."' and
							  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
							  b.fabric_color_id=".$color_wise_wo_result['fabric_color_id']." and
							  b.status_active=1 and
							  b.is_deleted=0");*/
							if($db_type==0)
							{
							$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
							WHERE a.job_no=b.job_no and
							a.id=b.pre_cost_fabric_cost_dtls_id and
							c.job_no_mst=a.job_no and
							c.id=b.color_size_table_id and
							b.po_break_down_id=d.po_break_down_id and
							b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
							d.booking_no =$txt_booking_no and
							a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
							a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
							a.construction='".$result_fabric_description[csf('construction')]."' and
							a.composition='".$result_fabric_description[csf('composition')]."' and
							a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
							b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
							d.fabric_color_id='".$color_wise_wo_result[csf('fabric_color_id')]."' and
							d.status_active=1 and
							d.is_deleted=0
							");
							}
							if($db_type==2)
							{
							if($result_fabric_description[csf('gsm_weight')]!="") $gsm_cond=" a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and "; else $gsm_cond="";
							$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
							WHERE a.job_no=b.job_no and
							a.id=b.pre_cost_fabric_cost_dtls_id and
							c.job_no_mst=a.job_no and
							c.id=b.color_size_table_id and
							b.po_break_down_id=d.po_break_down_id and
							b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
							d.booking_no =$txt_booking_no and
							a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
							a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
							a.construction='".$result_fabric_description[csf('construction')]."' and
							a.composition='".$result_fabric_description[csf('composition')]."' and
							$gsm_cond
							b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
							nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
							d.status_active=1 and
							d.is_deleted=0
							");
							}

							list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
						?>
						<td width='50' align='right'>
						<?
						if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
						{
						echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;
						$total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('fin_fab_qnty')];
						}
						?>
						</td>
						<td width='50' align='right' >
						<?
						if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
						{
						echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2);
						$total_grey_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
						}
						?>
						</td>
						<?
						}
						?>
						<td align="right"><? echo number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
						<td align="right"><? echo number_format($total_grey_fab_qnty,2); $grand_total_grey_fab_qnty+=$total_grey_fab_qnty;?></td>

						<td align="right">
						<?
						if($process_loss_method==1)
						{
							$process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_fin_fab_qnty)*100;
						}

						if($process_loss_method==2)
						{
							$process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_grey_fab_qnty)*100;
						}
						echo number_format($process_percent,2);

						?>

						</td>
						</tr>
					 <?
					}
					?>
					<tr style=" font-weight:bold">
					<!--<td  width="120" align="left">&nbsp;</td>-->
					<th  width="120" align="left">&nbsp;</th>
					<td  width="120" align="left">&nbsp;</td>
					<td  width="120" align="left"><strong>Total</strong></td>
					<?
						foreach($nameArray_fabric_description as $result_fabric_description)
						{
							/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
															  FROM
															  view_wo_fabric_booking_data_park a,
															  wo_booking_dtls b
															  WHERE
															  b.booking_no =$txt_booking_no  and
															  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
															  a.po_break_down_id=b.po_break_down_id and
															  a.color_size_table_id=b.color_size_table_id and
															  a.color_type_id='".$result_fabric_description['color_type_id']."' and
															  a.construction='".$result_fabric_description['construction']."' and
															  a.composition='".$result_fabric_description['composition']."' and
															  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
															  a.dia_width='".$result_fabric_description['dia_width']."' and
															  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
															  b.status_active=1 and
															  b.is_deleted=0
															  ");*/
							if($result_fabric_description[csf('gsm_weight')]!="") $gsm_cond=" a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and "; else $gsm_cond="";
							$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
															WHERE a.job_no=b.job_no and
															a.id=b.pre_cost_fabric_cost_dtls_id and
															c.job_no_mst=a.job_no and
															c.id=b.color_size_table_id and
															b.po_break_down_id=d.po_break_down_id and
															b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
															d.booking_no =$txt_booking_no and
															a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
															a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
															a.construction='".$result_fabric_description[csf('construction')]."' and
															a.composition='".$result_fabric_description[csf('composition')]."' and
															$gsm_cond
															b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
															d.status_active=1 and
															d.is_deleted=0
															");
							list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
						?>
						<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;?></td><td width='50' align='right' > <? echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2);?></td>

						<?
						}
						?>
						<td align="right"><? echo number_format($grand_total_fin_fab_qnty,2);?></td>
						<td align="right"><? echo number_format($grand_total_grey_fab_qnty,2);?></td>
						<td align="right">
						<?
						if($process_loss_method==1)// markup
						{
							$totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_fin_fab_qnty)*100;
						}

						if($process_loss_method==2) //margin
						{
							$totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_grey_fab_qnty)*100;
						}
						echo number_format($totalprocess_percent,2);
						?>
						</td>
						</tr>
						<tr style="font-weight:bold">
					<!--<td  width="120" align="left">&nbsp;</td>-->
					<th  width="120" align="left">&nbsp;</th>
					<td  width="120" align="left">&nbsp;</td>
					<td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
					<?
						foreach($nameArray_fabric_description as $result_fabric_description)
						{
							/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
															  FROM
															  view_wo_fabric_booking_data_park a,
															  wo_booking_dtls b
															  WHERE
															  b.booking_no =$txt_booking_no  and
															  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
															  a.po_break_down_id=b.po_break_down_id and
															  a.color_size_table_id=b.color_size_table_id and
															  a.color_type_id='".$result_fabric_description['color_type_id']."' and
															  a.construction='".$result_fabric_description['construction']."' and
															  a.composition='".$result_fabric_description['composition']."' and
															  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
															  a.dia_width='".$result_fabric_description['dia_width']."' and
															  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
															  b.status_active=1 and
															  b.is_deleted=0
															  ");*/
							if($result_fabric_description[csf('gsm_weight')]!="") $gsm_cond=" a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and "; else $gsm_cond="";
							$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
															WHERE a.job_no=b.job_no and
															a.id=b.pre_cost_fabric_cost_dtls_id and
															c.job_no_mst=a.job_no and
															c.id=b.color_size_table_id and
															b.po_break_down_id=d.po_break_down_id and
															b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
															d.booking_no =$txt_booking_no and
															a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
															a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
															a.construction='".$result_fabric_description[csf('construction')]."' and
															a.composition='".$result_fabric_description[csf('composition')]."' and
															$gsm_cond
															b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
															d.status_active=1 and
															d.is_deleted=0
															");
							list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

						?>
						<td width='50' align='right'><?  //echo number_format(($color_wise_wo_result_qnty['fin_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td><td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
						<?
						}
						?>
						<td align="right"><? echo number_format(($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4); $grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4)?></td>
						<td align="right"><? echo number_format(($grand_total_grey_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4);$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4)?></td>
						<td align="right">
						<?
						if($process_loss_method==1)
						{
							$totalprocess_percent_dzn=(($grand_total_grey_fab_qnty_dzn-$grand_total_fin_fab_qnty_dzn)/$grand_total_fin_fab_qnty_dzn)*100;
						}

						if($process_loss_method==2)
						{
							$totalprocess_percent_dzn=(($grand_total_grey_fab_qnty_dzn-$grand_total_fin_fab_qnty_dzn)/$grand_total_grey_fab_qnty_dzn)*100;
						}
						echo number_format($totalprocess_percent_dzn,2);
						?>
						</td>
						</tr>
				</table>
				<?
				}
				/*$nameArray_fabric_description= sql_select("SELECT a.color_type_id,a.construction,a.composition,a.gsm_weight,a.dia_width,a.process_loss_percent FROM view_wo_fabric_booking_data_park a,wo_booking_dtls b where b.booking_no =$txt_booking_no and a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and b.status_active=1 and
			b.is_deleted=0  group by a.color_type_id,a.construction,a.composition,a.gsm_weight,a.dia_width,process_loss_percent order by a.pre_cost_fabric_cost_dtls_id");*/
				if($cbo_fabric_source==2)
				{

					$nameArray_fabric_description= sql_select("select a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type , b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent, avg(b.requirment) as requirment
					FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
					WHERE a.job_no=b.job_no and
					a.id=b.pre_cost_fabric_cost_dtls_id and
					c.job_no_mst=a.job_no and
					c.id=b.color_size_table_id and
					b.po_break_down_id=d.po_break_down_id and
					b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
					d.booking_no =$txt_booking_no and
					d.status_active=1 and
					d.is_deleted=0
					group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by a.body_part_id,b.dia_width");

				 ?>

				 <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
				 <tr align="center">
				 <th colspan="3" align="left">Body Part</th>
					<?
					foreach($nameArray_fabric_description  as $result_fabric_description)
					{
						if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
						else         		               echo "<td  colspan='3'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
					}
					?>
					<td  rowspan="9" width="50"><p>Total Fabric <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
					<td  rowspan="9" width="50"><p>Avg Rate <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
					<td  rowspan="9" width="50"><p>Amount </p></td>
				   </tr>
				 <tr align="center"><th colspan="3" align="left">Color Type</th>
					<?
					foreach($nameArray_fabric_description  as $result_fabric_description)
					{
						if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
						else         		               echo "<td  colspan='3'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
					}
					?>
					<!--<td  rowspan="8" width="50"><p>Total  Finish Fabric (KG)</p></td> <td  rowspan="8" width="50"><p>Total Grey Fabric (KG)</p></td>-->
						 <!--<td  rowspan="7" width="50"><p>Process Loss % </p></td>-->
				   </tr>
					<tr align="center"><th colspan="3" align="left">Fabric Construction</th>
					<?
					foreach($nameArray_fabric_description  as $result_fabric_description)
					{
						if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='3'>&nbsp</td>";
						else         		               echo "<td  colspan='3'>". $result_fabric_description[csf('construction')]."</td>";
					}
					?>


				   </tr>
					<tr align="center"><th   colspan="3" align="left">Fabric Composition</th>
					<?
					foreach($nameArray_fabric_description as $result_fabric_description)
					{
						if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='3' >&nbsp</td>";
						else         		               echo "<td colspan='3' >".$result_fabric_description[csf('composition')]."</td>";
					}
					?>

				   </tr>
				   <tr align="center"><th  colspan="3" align="left">GSM</th>
					<?
					foreach($nameArray_fabric_description  as $result_fabric_description)
					{
						if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='3'>&nbsp</td>";
						else         		       echo "<td colspan='3' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
					}
					?>

				   </tr>
				   <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
					<?
					foreach($nameArray_fabric_description as $result_fabric_description)
					{
						if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='3'>&nbsp</td>";
						else         		              echo "<td colspan='3' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
					}
					?>

				   </tr>
				   <tr align="center"><th   colspan="3" align="left">Consumption For <? echo $costing_per; ?></th>
					<?
					foreach($nameArray_fabric_description as $result_fabric_description)
					{
						if( $result_fabric_description[csf('requirment')] == "")   echo "<td colspan='3'>&nbsp</td>";
						else         		              echo "<td colspan='3' align='center'>Fin: ".number_format($result_fabric_description[csf('cons')],2).", Grey: ".number_format($result_fabric_description[csf('requirment')],2)."</td>";
					}
					?>

				   </tr>
				   <tr>
				   <th  colspan="<? echo  count($nameArray_fabric_description)*3+3; ?>" align="left" style="height:30px">&nbsp;</th>
				   </tr>

				   <tr>
						<!--<th  width="120" align="left">Gmts. Color</th>-->
						<th  width="120" align="left">Fabric Color</th>
						<th  width="120" align="left">Body Color</th>
						<th  width="120" align="left">Lab Dip No</th>
					<?
					foreach($nameArray_fabric_description as $result_fabric_description)
					{
						  echo "<th width='50'>Fab. Qty</th><th width='50' >Rate</th><th width='50' >Amount</th>";
					}
					?>

				   </tr>
				   <?

					  /*$gmt_color_library=return_library_array( "select gmts_color_id,contrast_color_id
					  FROM
					  wo_pre_cos_fab_co_color_dtls
					  WHERE
					  job_no ='$job_no'", "contrast_color_id", "gmts_color_id");*/
					  $gmt_color_library=array();
					  $gmt_color_data=sql_select("select b.gmts_color_id, b.contrast_color_id
					  FROM
					  wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b
					  WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.fabric_source =$cbo_fabric_source and
					  a.job_no ='$job_no'");
					  foreach( $gmt_color_data as $gmt_color_row)
					  {
						//$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
						$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
					  }

						$grand_total_fin_fab_qnty=0;
						$grand_total_amount=0;
						//$grand_totalcons_per_finish=0;
						//$grand_totalcons_per_grey=0;
						$color_wise_wo_sql=sql_select("select fabric_color_id, avg(rate) as dtls_rate
													  FROM
													  wo_booking_dtls
													  WHERE
													  booking_no =$txt_booking_no and
													  status_active=1 and
													  is_deleted=0
													  group by fabric_color_id");
					foreach($color_wise_wo_sql as $color_wise_wo_result)
					{
					?>
						<tr>
					   <!-- <td  width="120" align="left">
						<?

						//echo $color_library[$color_wise_wo_result['fabric_color_id']];

						?></td>-->
						<td  width="120" align="left">
						<?
						echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];


						?>
						</td>
						<td>
						<?
						//echo $color_library[$gmt_color_library[$color_wise_wo_result['fabric_color_id']]];
						//echo rtrim($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]],",");
						echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
						?>
						</td>
						<td  width="120" align="left">
						<?
						$lapdip_no="";
						$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
						//echo "lapdip_no from wo_po_lapdip_approval_info where job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result['fabric_color_id']."";
						if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
						?>
						</td>
						<?
						$total_fin_fab_qnty=0;
						$total_amount=0;

						foreach($nameArray_fabric_description as $result_fabric_description)
						{
							/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
							  FROM
							  view_wo_fabric_booking_data_park a,
							  wo_booking_dtls b
							  WHERE
							  b.booking_no =$txt_booking_no  and
							  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
							  a.po_break_down_id=b.po_break_down_id and
							  a.color_size_table_id=b.color_size_table_id and
							  a.color_type_id='".$result_fabric_description['color_type_id']."' and
							  a.construction='".$result_fabric_description['construction']."' and
							  a.composition='".$result_fabric_description['composition']."' and
							  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
							  a.dia_width='".$result_fabric_description['dia_width']."' and
							  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
							  b.fabric_color_id=".$color_wise_wo_result['fabric_color_id']." and
							  b.status_active=1 and
							  b.is_deleted=0");
							echo "select  sum(d.fin_fab_qnty) as fin_fab_qnty, sum(d.grey_fab_qnty) as grey_fab_qnty, avg(d.rate) as rate
								FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
								WHERE a.job_no=b.job_no and
								a.id=b.pre_cost_fabric_cost_dtls_id and
								c.job_no_mst=a.job_no and
								c.id=b.color_size_table_id and
								b.po_break_down_id=d.po_break_down_id and
								b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
								d.booking_no =$txt_booking_no and
								a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
								a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
								a.construction='".$result_fabric_description[csf('construction')]."' and
								a.composition='".$result_fabric_description[csf('composition')]."' and
								a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
								b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
								nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
								d.status_active=1 and
								d.is_deleted=0 <br>";*/
							if($db_type==0)
							{
								$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty, avg(d.rate) as rate
								FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
								WHERE a.job_no=b.job_no and
								a.id=b.pre_cost_fabric_cost_dtls_id and
								c.job_no_mst=a.job_no and
								c.id=b.color_size_table_id and
								b.po_break_down_id=d.po_break_down_id and
								b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
								d.booking_no =$txt_booking_no and
								a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
								a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
								a.construction='".$result_fabric_description[csf('construction')]."' and
								a.composition='".$result_fabric_description[csf('composition')]."' and
								a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
								b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
								d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
								d.status_active=1 and
								d.is_deleted=0 ");
							}
							if($db_type==2)
							{
								if($result_fabric_description[csf('gsm_weight')]!="") $gsm_cond=" a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and "; else $gsm_cond="";
								$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty, sum(d.grey_fab_qnty) as grey_fab_qnty, avg(d.rate) as rate
								FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
								WHERE a.job_no=b.job_no and
								a.id=b.pre_cost_fabric_cost_dtls_id and
								c.job_no_mst=a.job_no and
								c.id=b.color_size_table_id and
								b.po_break_down_id=d.po_break_down_id and
								b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
								d.booking_no =$txt_booking_no and
								a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
								a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
								a.construction='".$result_fabric_description[csf('construction')]."' and
								a.composition='".$result_fabric_description[csf('composition')]."' and
								$gsm_cond
								b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
								nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
								d.status_active=1 and
								d.is_deleted=0");
							}
							list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
						?>
						<td width='50' align='right'>
						<?
						if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
						{
						echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2) ;
						$total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
						}
						?>
						</td>
						<td width='50' align='right' >
						<?
						if($color_wise_wo_result_qnty[csf('rate')]!="")
						{
							echo number_format($color_wise_wo_result_qnty[csf('rate')],2);
							//$total_grey_fab_qnty+=$color_wise_wo_result_qnty['grey_fab_qnty'];
						}
						?>
						</td>
						<td width='50' align='right' >
						<?
						$amount=$color_wise_wo_result_qnty[csf('grey_fab_qnty')]*$color_wise_wo_result_qnty[csf('rate')];
						if($amount!="")
						{
						echo number_format($amount,2);
						$total_amount+=$amount;
						}
						?>
						</td>
						<?
						}
						?>
						<td align="right"><? echo number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
						<td align="right"><? echo number_format($total_amount/$total_fin_fab_qnty,2); $grand_total_amount+=$total_amount;?></td>
						<td align="right">
						<?
						echo number_format($total_amount,2);

						?>
						</td>
						</tr>
					 <?
					}
					?>
					<tr style=" font-weight:bold">
					<!--<td  width="120" align="left">&nbsp;</td>-->
					<th  width="120" align="left">&nbsp;</th>
					<td  width="120" align="left">&nbsp;</td>
					<td  width="120" align="left"><strong>Total</strong></td>
					<?
						foreach($nameArray_fabric_description as $result_fabric_description)
						{
							/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
															  FROM
															  view_wo_fabric_booking_data_park a,

															  wo_booking_dtls b
															  WHERE
															  b.booking_no =$txt_booking_no  and
															  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
															  a.po_break_down_id=b.po_break_down_id and
															  a.color_size_table_id=b.color_size_table_id and
															  a.color_type_id='".$result_fabric_description['color_type_id']."' and
															  a.construction='".$result_fabric_description['construction']."' and
															  a.composition='".$result_fabric_description['composition']."' and
															  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
															  a.dia_width='".$result_fabric_description['dia_width']."' and
															  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
															  b.status_active=1 and
															  b.is_deleted=0
															  ");*/
							if($result_fabric_description[csf('gsm_weight')]!="") $gsm_cond=" a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and "; else $gsm_cond="";
							$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
															WHERE a.job_no=b.job_no and
															a.id=b.pre_cost_fabric_cost_dtls_id and
															c.job_no_mst=a.job_no and
															c.id=b.color_size_table_id and
															b.po_break_down_id=d.po_break_down_id and
															b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
															d.booking_no =$txt_booking_no and
															a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
															a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
															a.construction='".$result_fabric_description[csf('construction')]."' and
															a.composition='".$result_fabric_description[csf('composition')]."' and
															$gsm_cond
															b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
															d.status_active=1 and
															d.is_deleted=0
															");
							list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
						?>
						<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2) ;?></td>
						<td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
						<td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
						<?
						}
						?>
						<td align="right"><? echo number_format($grand_total_fin_fab_qnty,2);?></td>
						<td align="right"><? echo number_format($grand_total_amount/$grand_total_fin_fab_qnty,2);?></td>
						<td align="right">
						<?
						echo number_format($grand_total_amount,2);
						?>
						</td>
						</tr>
						<tr style="font-weight:bold">
					<!--<td  width="120" align="left">&nbsp;</td>-->
					<th  width="120" align="left">&nbsp;</th>
					<td  width="120" align="left">&nbsp;</td>
					<td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
					<?
						foreach($nameArray_fabric_description as $result_fabric_description)
						{
							/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
															  FROM
															  view_wo_fabric_booking_data_park a,
															  wo_booking_dtls b
															  WHERE
															  b.booking_no =$txt_booking_no  and
															  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
															  a.po_break_down_id=b.po_break_down_id and
															  a.color_size_table_id=b.color_size_table_id and
															  a.color_type_id='".$result_fabric_description['color_type_id']."' and
															  a.construction='".$result_fabric_description['construction']."' and
															  a.composition='".$result_fabric_description['composition']."' and
															  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
															  a.dia_width='".$result_fabric_description['dia_width']."' and
															  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
															  b.status_active=1 and
															  b.is_deleted=0
															  ");*/
							if($result_fabric_description[csf('gsm_weight')]!="") $gsm_cond=" a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and "; else $gsm_cond="";
							$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
															WHERE a.job_no=b.job_no and
															a.id=b.pre_cost_fabric_cost_dtls_id and
															c.job_no_mst=a.job_no and
															c.id=b.color_size_table_id and
															b.po_break_down_id=d.po_break_down_id and
															b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
															d.booking_no =$txt_booking_no and
															a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
															a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
															a.construction='".$result_fabric_description[csf('construction')]."' and
															a.composition='".$result_fabric_description[csf('composition')]."' and
															$gsm_cond
															b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
															d.status_active=1 and
															d.is_deleted=0
															");
							list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

						?>
						<td width='50' align='right'><?  //echo number_format(($color_wise_wo_result_qnty['fin_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td>
						<td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
						<td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
						<?
						}
						?>
						<td align="right">
						<?
						$consumption_per_unit_fab=($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
						echo number_format($consumption_per_unit_fab,4);
						//$grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4)
						?>
						</td>
						<td align="right">
						<?
						$consumption_per_unit_amuont=($grand_total_amount/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
						//echo number_format(($consumption_per_unit_amuont/$consumption_per_unit_fab),2);
						//$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4)
						?>
						</td>
						<td align="right">
						<?
						//echo number_format($consumption_per_unit_amuont,2);
						?>
						</td>
						</tr>
				</table>
				<?
				}

			?>
				<br/>
				<?

				if($cbo_fabric_source==1)
				{
						$lab_dip_color_arr=array();
			$lab_dip_color_sql=sql_select("select pre_cost_fabric_cost_dtls_id, gmts_color_id, contrast_color_id from wo_pre_cos_fab_co_color_dtls where job_no='$txt_job_no'");
			foreach($lab_dip_color_sql as $row)
			{
				$lab_dip_color_arr[$row[csf('pre_cost_fabric_cost_dtls_id')]][$row[csf('gmts_color_id')]]=$row[csf('contrast_color_id')];
			}
			$order_plan_qty_arr=array();
			$color_wise_wo_sql_qnty=sql_select( "select color_number_id, size_number_id, sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in ($booking_po_id) and status_active=1 and is_deleted =0 group by color_number_id, size_number_id");
			foreach($color_wise_wo_sql_qnty as $row)
			{
				$order_plan_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]]['plan']=$row[csf('plan_cut_qnty')];
				$order_plan_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]]['order']=$row[csf('order_quantity')];
			}

			$collar_cuff_percent_arr=array();
			$collar_cuff_body_arr=array();
			$collar_cuff_color_arr=array();
			$collar_cuff_size_arr=array();
			$collar_cuff_item_size_arr=array();
			$color_size_sensitive_arr=array();

			$collar_cuff_sql="select a.id, a.color_size_sensitive, a.color_break_down, b.color_number_id, b.gmts_sizes, b.item_size, c.size_number_id, d.colar_cuff_per, e.body_part_full_name, e.body_part_type
			FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c, wo_booking_dtls d, lib_body_part e

			WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=e.id and e.body_part_type in (40,50) and c.id=d.color_size_table_id and d.color_size_table_id=b.color_size_table_id  and d.po_break_down_id=c.po_break_down_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 order by  c.size_order";
			//echo $collar_cuff_sql;
			$collar_cuff_sql_res=sql_select($collar_cuff_sql);

			foreach($collar_cuff_sql_res as $collar_cuff_row)
			{
				$collar_cuff_percent_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('color_number_id')]][$collar_cuff_row[csf('gmts_sizes')]]=$collar_cuff_row[csf('colar_cuff_per')];
				$collar_cuff_body_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]]=$collar_cuff_row[csf('body_part_full_name')];
				$collar_cuff_size_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('size_number_id')]]=$collar_cuff_row[csf('size_number_id')];
				$collar_cuff_item_size_arr[$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('size_number_id')]][$collar_cuff_row[csf('item_size')]]=$collar_cuff_row[csf('item_size')];
				$color_size_sensitive_arr[$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('id')]][$collar_cuff_row[csf('color_number_id')]][$collar_cuff_row[csf('color_size_sensitive')]]=$collar_cuff_row[csf('color_break_down')];

			}
			//print_r($collar_cuff_percent_arr[40]) ;
			unset($collar_cuff_sql_res);
			//$count_collar_cuff=count($collar_cuff_size_arr);
			foreach($collar_cuff_body_arr as $body_type=>$body_name)
			{
				foreach($body_name as $body_val)
				{
					$count_collar_cuff=count($collar_cuff_size_arr[$body_type][$body_val]);
					$pre_grand_tot_collar=0; $pre_grand_tot_collar_order_qty=0;

					?>
                    <div style="max-height:1330px; overflow:auto; float:left; padding-top:5px; margin-left:5px; margin-bottom:5px; position:relative;">
					<table width="625" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                        <tr>
                        	<td colspan="<? echo $count_collar_cuff+3; ?>" align="center"><b><? echo $body_val; ?> - Color Size Brakedown in Pcs.</b></td>
                        </tr>
                        <tr>
                            <td width="100">Size</td>
								<?
                                foreach($collar_cuff_size_arr[$body_type][$body_val]  as $size_number_id)
                                {
									?>
									<td align="center" style="border:1px solid black"><strong><? echo $size_library[$size_number_id];?></strong></td>
									<?
                                }
                                ?>
                            <td width="60" rowspan="2" align="center"><strong>Total</strong></td>
                            <td rowspan="2" align="center"><strong>Extra %</strong></td>
                        </tr>
                        <tr>
                            <td style="font-size:12px"><? echo $body_val; ?> Size</td>
                            <?
                            foreach($collar_cuff_item_size_arr[$body_val]  as $size_number_id=>$size_number)
                            {
								if(count($size_number)>0)
								{
									 foreach($size_number  as $item_size=>$val)
									 {
										?>
										<td align="center" style="border:1px solid black"><strong><? echo $item_size;?></strong></td>
										<?
									 }
								}
								else
								{
									?>
									<td align="center" style="border:1px solid black"><strong>&nbsp;</strong></td>
									<?
								}
                            }

                            $pre_size_total_arr=array();
                            foreach($color_size_sensitive_arr[$body_val] as $pre_cost_id=>$pre_cost_data)
                            {
								foreach($pre_cost_data as $color_number_id=>$color_number_data)
								{
									foreach($color_number_data as $color_size_sensitive=>$color_break_down)
									{
										$pre_color_total_collar=0;
										$pre_color_total_collar_order_qnty=0;
										$process_loss_method=$process_loss_method;
										$constrast_color_arr=array();
										if($color_size_sensitive==3)
										{
											$constrast_color=explode('__',$color_break_down);
											for($i=0;$i<count($constrast_color);$i++)
											{
												$constrast_color2=explode('_',$constrast_color[$i]);
												$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
											}
										}
										?>
										<tr>
											<td>
												<?
                                                if( $color_size_sensitive==3)
                                                {
                                                    echo strtoupper ($constrast_color_arr[$color_number_id]) ;
                                                    $lab_dip_color_id=$lab_dip_color_arr[$pre_cost_id][$color_number_id];
                                                }
                                                else
                                                {
                                                    echo $color_library[$color_number_id];
                                                    $lab_dip_color_id=$color_number_id;
                                                }
                                                ?>
											</td>
											<?
											foreach($collar_cuff_size_arr[$body_type][$body_val] as $size_number_id)
											{
												?>
												<td align="center" style="border:1px solid black">
													<? $plan_cut=0; $collerqty=0; $collar_ex_per=0;
													if($body_type==50) $plan_cut=($order_plan_qty_arr[$color_number_id][$size_number_id]['plan'])*2;
													else $plan_cut=$order_plan_qty_arr[$color_number_id][$size_number_id]['plan'];
                                                    $ord_qty=$order_plan_qty_arr[$color_number_id][$size_number_id]['order'];

                                                    $collar_ex_per=$collar_cuff_percent_arr[$body_type][$body_val][$color_number_id][$size_number_id];
                                                    // echo $collar_ex_per.'=';

												    if($body_type==50) { if($collar_ex_per==0 || $collar_ex_per=="") $collar_ex_per=$cuff_excess_percent; else $collar_ex_per=$collar_ex_per; }
                                                    else if($body_type==40) { if($collar_ex_per==0 || $collar_ex_per=="") $collar_ex_per=$colar_excess_percent; else $collar_ex_per=$collar_ex_per; }
                                                    $colar_excess_per=number_format(($plan_cut*$collar_ex_per)/100,6,".",",");
                                                    $collerqty=($plan_cut+$colar_excess_per);

                                                    //$collerqty=number_format(($requirment/$costing_per_qnty)*$plan_cut,2,'.','');

                                                    echo number_format($collerqty);
                                                    $pre_size_total_arr[$size_number_id]+=$collerqty;
                                                    $pre_color_total_collar+=$collerqty;
                                                    $pre_color_total_collar_order_qnty+=$plan_cut;

                                                    //$pre_grand_tot_collar_order_qty+=$plan_cut;
                                                    ?>
												</td>
												<?
											}
											?>

											<td align="center"><? echo number_format($pre_color_total_collar); ?></td>
											<td align="center"><? echo number_format((($pre_color_total_collar-$pre_color_total_collar_order_qnty)/$pre_color_total_collar_order_qnty)*100,2); ?></td>
										</tr>
										<?
										$pre_grand_collar_ex_per+=$collar_ex_per;
										$pre_grand_tot_collar+=$pre_color_total_collar;
										$pre_grand_tot_collar_order_qty+=$pre_color_total_collar_order_qnty;
									}
								}
							}
							?>
                        </tr>
                        <tr>
                            <td>Size Total</td>
								<?
                                foreach($pre_size_total_arr  as $size_qty)
                                {
									?>
									<td style="border:1px solid black;  text-align:center"><? echo number_format($size_qty); ?></td>
									<?
                                }
                                ?>
                            <td style="border:1px solid black; text-align:center"><? echo number_format($pre_grand_tot_collar); ?></td>
                            <td align="center" style="border:1px solid black"><? echo number_format((($pre_grand_tot_collar-$pre_grand_tot_collar_order_qty)/$pre_grand_tot_collar_order_qty)*100,2); ?></td>
                        </tr>
					</table>
                </div>
                <br/>
                <?
            }
        }

		?>

				<br/>
				<?
				$yarn_count_arr=return_library_array( "select id,yarn_count from lib_yarn_count",'id','yarn_count');
			//	$yarn_sql_array=sql_select("SELECT min(id) as id ,count_id, copm_one_id, percent_one,copm_two_id, percent_two, color,type_id, sum(cons_qnty) as yarn_required, AVG(rate) as rate from wo_pre_cost_fab_yarn_cost_dtls where job_no='$job_no' and  status_active=1 and is_deleted=0 group by count_id,copm_one_id,percent_one, copm_two_id,percent_two,color,type_id order by id");
			/* $yarn_sql="SELECT MIN (a.id) AS id, a.count_id, a.copm_one_id, a.percent_one, a.copm_two_id,  a.percent_two,
		        a.type_id,  SUM (a.cons_qnty) AS yarn_required,  AVG (a.rate) AS rate, listagg (CAST (a.fabric_cost_dtls_id AS VARCHAR2 (4000)), ',')
		            WITHIN GROUP (ORDER BY   a.fabric_cost_dtls_id) AS cost_dtls, AVG (a.cons_ratio) AS cons_ratio, sum (b.grey_fab_qnty*a.cons_ratio/100) AS grey_req
		         FROM wo_pre_cost_fab_yarn_cost_dtls a, wo_booking_dtls b WHERE a.job_no = '$job_no' AND a.status_active = 1 and a.is_deleted = 0 and a.fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id  and a.job_no=b.job_no and b.status_active=1 and b.is_deleted=0  and b.booking_no=$txt_booking_no
				GROUP BY a.count_id,
				         a.copm_one_id,
				        a.percent_one,
				         a.copm_two_id,
				         a.percent_two,
				         a.type_id";*/
						  $yarn_sql_array=sql_select("SELECT min(a.id) as id ,a.count_id, a.copm_one_id, a.percent_one,a.copm_two_id, a.percent_two,a.color, a.type_id, a.supplier_id,  sum (b.grey_fab_qnty*a.cons_ratio/100) AS yarn_required, AVG(a.rate) as rate from wo_pre_cost_fab_yarn_cost_dtls a, wo_booking_dtls b where a.job_no=b.job_no and a.fabric_cost_dtls_id=b. pre_cost_fabric_cost_dtls_id and a.job_no='$job_no' and b.booking_no =$txt_booking_no and   a.status_active=1 and a.is_deleted=0 and   b.status_active=1 and b.is_deleted=0 group by a.count_id, a.copm_one_id, a.percent_one, a.copm_two_id, a.percent_two, a.color, a.type_id, a.supplier_id order by id");
						 
		      
				?>
				<table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
					<tr>
						<td width="49%" valign="top">
							<table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
								<tr align="center">
								<td colspan="5"><b>Yarn Required Summary (Pre Cost)</b></td>
								</tr>
								<tr align="center">
								<td>Sl</td>
								<td>Yarn Description</td>
								<td>Qty</td>
								<?
								if($show_yarn_rate==1)
								{
									?>
									<td>Rate</td>
									<?
								}
								?>
                                <td>Amount</td>
								
							</tr>
							<?
							$i=0;
							$total_yarn=0;$$tot_amt=$tot_qty=0;
							foreach($yarn_sql_array  as $row)
							{

								$i++;
							?>
							<tr align="center">
								<td><? echo $i; ?></td>
								<td>
								<?
								$yarn_des=$yarn_count_arr[$row[csf('count_id')]]." ".$composition[$row[csf('copm_one_id')]]." ".$row[csf('percent_one')]."%  ";
								if($row['copm_two_id'] !=0)
								{
									$yarn_des.=$composition[$row[csf('copm_two_id')]]." ".$row[csf('percent_two')]."%";
								}
								$yarn_des.=$color_library[$row[csf('color')]]." ";
								$yarn_des.=$yarn_type[$row[csf('type_id')]];
								echo $yarn_des;
								?>
								</td>
								<td><? echo number_format($row[csf('yarn_required')],4); ?></td>
								<?
								if($show_yarn_rate==1)
								{
								?>
								 <td><? echo number_format($row[csf('rate')],4); ?></td>
								 <?
								}
								 ?>
								<td><? echo number_format($row[csf('rate')]*$row[csf('yarn_required')],4); ?></td>
							</tr>
							<?
							$tot_amt+=$row[csf('rate')]*$row[csf('yarn_required')];
							$tot_qty+=$row[csf('yarn_required')];
							}
							?>
							<tr align="center">
								<td>&nbsp; </td>
								<td align="right">Total</td>
								<td><? echo number_format($tot_qty,4); ?></td>
								<?
								if($show_yarn_rate==1)
								{
									?>
									<td></td>
									<?
								}
								?>
								<td><? echo number_format($tot_amt,4); ?></td>
							</tr>
							</table>
						</td>
						<td width="2%">
						</td>
						<td width="49%" valign="top" align="center">
						<?
							$yarn_sql_array=sql_select("SELECT min(a.id) as id, a.item_id, sum(a.qnty) as qnty ,min(b.supplier_id) as supplier_id,min(b.lot) as lot from inv_material_allocation_dtls a,product_details_master b where a.item_id=b.id and a.booking_no=$txt_booking_no and  a.status_active=1 and a.is_deleted=0 group by a.item_id order by a.id");
							if(count($yarn_sql_array)>0)
							{
							?>
							   <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
								<tr align="center">
								<td colspan="7"><b>Allocated Yarn</b></td>

								</tr>
								<tr align="center">
								<td>Sl</td>
								<td>Yarn Description</td>
								<td>Brand</td>
								<td>Lot</td>


								<td>Allocated Qty (Kg)</td>
								</tr>
								<?
								$total_allo=0;
								$item=return_library_array( "select id, product_name_details from   product_details_master",'id','product_name_details');
								$supplier=return_library_array( "select id, short_name from   lib_supplier",'id','short_name');
								//$yarn_sql_array=sql_select("SELECT a.item_id, a.qnty,b.supplier_id,b.lot from inv_material_allocation_dtls a,product_details_master b where a.item_id=b.id and a.booking_no=$txt_booking_no and  a.status_active=1 and a.is_deleted=0");
								$i=0;
								$total_yarn=0;
								foreach($yarn_sql_array  as $row)
								{

									$i++;
								?>
								<tr align="center">
								<td><? echo $i; ?></td>
								<td>
								<?

								echo $item[$row[csf('item_id')]];
								?>
								</td>
								<td>
								<?

								echo $supplier[$row[csf('supplier_id')]];
								?>
								</td>
								<td>
								<?

								echo $row[csf('lot')];
								?>
								</td>
								<td align="right"><? echo number_format($row[csf('qnty')],4); $total_allo+= $row[csf('qnty')];?></td>
								</tr>
								<?
								}
								?>
								<tr align="center">
								<td>Total</td>
								<td></td>


								<td></td>
								<td></td>
								<td align="right"><? echo number_format($total_allo,4); ?></td>
								</tr>
								</table>
								<?
							}
							else
							{
								$is_yarn_allocated=return_field_value("allocation", "variable_settings_inventory", "company_name=$cbo_company_name and variable_list=18 and item_category_id=1");
								if($is_yarn_allocated==1)
								{
								?>
								<font style=" font-size:30px"><b> Draft</b></font>
								<?
								}
								else
								{
									echo "";
								}
							}
						?>
						</td>
					</tr>
				</table>
				<br/>

				<?

				$conversion_data=sql_select("select a.body_part_id,a.fab_nature_id, a.color_type_id,b.job_no,b.cons_process,b.fabric_description,b.charge_unit,b.color_break_down,b.amount from wo_pre_cost_fab_conv_cost_dtls b,wo_pre_cost_fabric_cost_dtls a where b.job_no='$job_no'  and a.job_no=b.job_no  and a.id=b.fabric_description and b.status_active=1 and b.is_deleted=0");

				$exchange_rate=return_field_value("exchange_rate", "wo_pre_cost_mst", "job_no='$job_no' and status_active=1 and is_deleted=0 ");
				//$fab_nature_id=return_field_value("fab_nature_id", "wo_pre_cost_fabric_cost_dtls", "job_no='$job_no' and status_active=1 and is_deleted=0 ");

				$fabric_description_arr=return_library_array( "select id,fabric_description from wo_pre_cost_fabric_cost_dtls",'id','fabric_description');
				?>
				<table  width="650"  border="0" cellpadding="0" cellspacing="0" align="left" >
					<tr>
						<td width="49%" valign="top">
								<style type="text/css">

									hr {
										border: 0;
										background-color: #000;
										height: 1px;
									}
								</style>
								<table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
								<tr align="center">
									<td colspan="7"><b>Conversion Charge</b></td>

									</tr>
									<tr align="center">
									<td width="30">Sl</td>
									<td width="210">Fabric Description</td>
									<td width="50">UOM</td>
									<td width="100">Process</td>
									<td width="100">Color</td>
									<td width="70"><div style="word-break:break-all; font-size:small">Charge/Unit(USD)</div></td>
									<td width="70"><div style="word-break:break-all; font-size:small">Charge/Unit(Tk.)</div></td>
								</tr>
								<?
								$i=0;
								$total_amount=0;
								foreach($conversion_data  as $row)
								{

									$i++;
									 $color_break_down=explode("__",$row[csf('color_break_down')]);
									 $color_arr=$color_break_down[0];
									 $unit_charge=$color_break_down[1];

									  $fabric_nature_id=$row[csf('fab_nature_id')];

									//$color_id= explode("_",$color_arr);

									// print_r($color_break_down);
									$color='';	$color_unit_rate='';
									foreach($color_break_down as $color_row)
									{
										$color_data=explode("_",$color_row);
										if($color=='')
										{
										  $color=$color_data[0];
										}
										else
										{
											  $color.=','.$color_data[0];
										}

										if($color_unit_rate=='')
										{
										  $color_unit_rate=$color_data[1];
										}
										else
										{
											  $color_unit_rate.=','.$color_data[1];
										}

										//$color_id=rtrim(explode(",",$color));

									}
									//echo rtrim("hello,",',');
									//echo $color;


								?>
								<tr align="center">
									<td width="30"><? echo $i; ?></td>
									<td width="220">

									<?



									echo  $body_part[$row[csf("body_part_id")]].', '.$color_type[$row[csf("color_type_id")]].', '.$fabric_description_arr[$row[csf("fabric_description")]]; //$fabric_description_arr[$row[csf('fabric_description')]];
									?>

									</td>
									<td width="50"><? if( $fabric_nature_id==2) echo "Kg";else echo "Yds";//echo $unit_of_measurement[$order_uom_id_arr[$row[csf('job_no')]]]; ?></td>
									<td width="100"><? echo $conversion_cost_head_array[$row[csf('cons_process')]]; ?></td>

								   <?
									if($row[csf('cons_process')]==31)
									{
									?>
									 <td width="100">

									  <div style="word-break:break-all; font-size:medium">
									<?
										$color_name="";$color_k=0;
										$data_color=explode(",",$color);
										$color_data1=count($data_color);
										foreach($data_color as $val)
										{ $color_k++;
											//$color_name=date("F",strtotime($key));
											echo $color_library[$val];
											// echo "K".'<hr>';
										   if($color_data1!=$color_k)
										   echo '<hr>';

										}
									?>
									</div>
									 </td>
									 <?
									 }
									 else
									 { ?>

									 <td width="100">


									 </td>
									 <? }

									if($row[csf('cons_process')]==31)
									{
									?>

									<td width="70" title="Unit As Per">
									<div style="word-break:break-all; font-size:medium">
									<?
										$color_name="";	$color_m="";

										$data_color=explode(",",$color);
										$data_color_unit_rate=explode(",",$color_unit_rate);
										//print_r($data_color_unit_rate);
										$color_data2=count($data_color);
										foreach($data_color_unit_rate as $val)
										{ $color_m++;
											//$color_name=date("F",strtotime($key));
											//foreach($data_color_unit_rate as $per_unit)
											//{
												 echo number_format($val,4);
											//}

											 // echo number_format($row[csf('charge_unit')],4);
											// echo "K".'<hr>';
										   if($color_data2!=$color_m)
										   echo '<hr>';
										}
									?>
									</div>
									</td>
									<?
									}
									else
									{ ?>
									<td width="70">
									<? echo number_format($row[csf('charge_unit')],4); ?>
									</td>

									<? }


									if($row[csf('cons_process')]==31)
									{
									?>

									 <td width="70">
									 <div style="word-break:break-all; font-size:medium">
									<?
										$color_name="";$color_td=0;
										$data_color=explode(",",$color);
										$data_color_unit_rate=explode(",",$color_unit_rate);
										$color_data=count($data_color);
										foreach($data_color_unit_rate as $val)
										{ $color_td++;
											//$color_name=date("F",strtotime($key));
											 echo number_format($val*$exchange_rate,4);
											 $total_amount+=$val*$exchange_rate;
											// echo "K".'<hr>';
										   if($color_data!=$color_td)
										   echo '<hr>';
										}
									?>
									</div>
									</td>
									<?
									}
									else
									{ ?>
									<td width="70">
									 <?
									 $total_amount+=$row[csf('charge_unit')]*$exchange_rate;
									  echo number_format($row[csf('charge_unit')]*$exchange_rate,4); ?>
									</td>

									<? }
									?>
								</tr>
								<?
								}
								?>
								<tr align="center">


									<td colspan="6" align="right">Total</td>
									<td><? echo number_format($total_amount,4); ?></td>
								</tr>
								</table>

						</td>


					</tr>
				</table>
				<br/>
				<table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
					<tr>
						<td width="49%" valign="top">
						<?
							$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
							if(count($sql_embelishment)>0)
							{
							?>
								<table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
								<tr align="center">
								<td colspan="7"><b>Embelishment (Pre Cost)</b></td>

								</tr>
								<tr align="center">
								<td>Sl</td>
								<td>Embelishment Name</td>
								<td>Embelishment Type</td>
								<td>Cons <? echo $costing_per; ?> Gmts</td>
								<td>Rate</td>
								<td>Amount</td>

								</tr>
								<?
								$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
								$i=0;
								//$total_yarn=0;
								foreach($sql_embelishment  as $row_embelishment)
								{

									$i++;
								?>
								<tr align="center">
								<td><? echo $i; ?></td>
								<td>
								<?
								echo $emblishment_name_array[$row_embelishment[csf('emb_name')]];
								?>
								</td>
								<td>
								<?
								if($row_embelishment[csf('emb_name')]==1)
								{
								echo $emblishment_print_type[$row_embelishment[csf('emb_type')]];
								}
								if($row_embelishment[csf('emb_name')]==2)
								{
								echo $emblishment_embroy_type[$row_embelishment[csf('emb_type')]];
								}
								if($row_embelishment[csf('emb_name')]==3)
								{
								echo $emblishment_wash_type[$row_embelishment[csf('emb_type')]];
								}
								if($row_embelishment[csf('emb_name')]==4)
								{
								echo $emblishment_spwork_type[$row_embelishment[csf('emb_type')]];
								}
								if($row_embelishment[csf('emb_name')]==5)
								{
								echo $row_embelishment[csf('emb_type')];
								}
								?>

								</td>
								<td>
								<?
								echo $row_embelishment[csf('cons_dzn_gmts')];
								?>
								</td>
								<td>
								<?
								echo $row_embelishment[csf('rate')];
								?>
								</td>

								<td>
								<?
								echo $row_embelishment[csf('amount')];
								?>
								</td>


								</tr>
								<?
								}
								?>
							 <!--   <tr align="center">
								<td>Total</td>
								<td></td>
								<td></td>
								<td></td>

								<td></td>

								<td></td>

								</tr>-->
								</table>
								<?
							}
						?>
						</td>
						<td width="2%">
						</td>
						<td width="49%" valign="top" align="center">
							<table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
								<tr align="center">
								<td><b>Approved Instructions</b></td>
								</tr>
								<tr>
								<td>
								<?  echo $nameArray_approved_comments_row[csf('comments')];  ?>
								</td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
				<br/>

				<?
				}// fabric Source End

				if($cbo_fabric_source==1 || $cbo_fabric_source==2)
				{

					?>
					<table  width="100%"  border="0" cellpadding="0" cellspacing="0">
					<tr>
						<td width="49%" valign="top">
							<table  width="100%"  border="1" cellpadding="0" cellspacing="0">
								<thead>
								<tr>
								<th width="3%"></th><th width="97%" align="left"><u>Special Instruction</u></th>
								</tr>
								</thead>
								<tbody>
								<?
								$data_array=sql_select("select id, terms from  wo_booking_terms_condition where booking_no=$txt_booking_no");// quotation_id='$data'
								if ( count($data_array)>0)
								{
									$i=0;
									foreach( $data_array as $row )
									{
										$i++;
										?>
										<tr id="settr_1" valign="top">
										<td style="vertical-align:top">
										<? echo $i;?>
										</td>
										<td>
										<strong style="font-size:20px"> <? echo $row[csf('terms')]; ?></strong>
										</td>
										</tr>
										<?
									}
								}
								/*else
								{
								$i=0;
								$data_array=sql_select("select id, terms from  lib_terms_condition");// quotation_id='$data'
								foreach( $data_array as $row )
								{
								$i++;
								?>
								<tr id="settr_1" align="">
								<td valign="top">
								<? echo $i;?>
								</td>
								<td>
								<? echo $row['terms']; ?>
								</td>

								</tr>
								<?
								}
								} */
								?>
								</tbody>
							</table>
						</td>
						<td width="2%">
						</td>
						<td width="49%" valign="top">
						<?

							?>
							<table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
							<tr align="center">
							<td colspan="10"><b>Comments</b></td>

							</tr>
							<tr align="center">
							<td>Sl</td>
							<td>Po NO</td>
							<td>Ship Date</td>
							<td>Pre-Cost Qty</td>
							<td>Mn.Book Qty</td>
							<td>Sht.Book Qty</td>
							<td>Smp.Book Qty</td>
							<td>Tot.Book Qty</td>
							<td>Balance</td>
							<td>Comments</td>
							</tr>
							<?
							$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
							$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
							if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
							if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
							$paln_cut_qnty_array=return_library_array( "select min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id,size_number_id,item_number_id,po_break_down_id", "id", "plan_cut_qnty");
							$item_ratio_array=return_library_array( "select gmts_item_id,set_item_ratio from wo_po_details_mas_set_details  where job_no =$txt_job_no", "gmts_item_id", "set_item_ratio");

							$nameArray=sql_select("
							select
							a.id,
							a.item_number_id,
							a.costing_per,
							b.po_break_down_id,
							b.color_size_table_id,
							b.requirment,
							c.po_number,
							c.id as po_id
						FROM
							wo_pre_cost_fabric_cost_dtls a,
							wo_pre_cos_fab_co_avg_con_dtls b,
							wo_po_break_down c
						WHERE
							a.job_no=b.job_no and
							a.job_no=c.job_no_mst and
							a.id=b.pre_cost_fabric_cost_dtls_id and
							b.po_break_down_id=c.id and
							b.po_break_down_id in (".str_replace("'","",$txt_order_no_id).")  $cbo_fabric_natu $cbo_fabric_source_cond and a.status_active=1 and a.is_deleted=0
							order by id");
							$count=0;
							$tot_grey_req_as_pre_cost_arr=array();
							foreach ($nameArray as $result)
							{
								if (count($nameArray)>0 )
								{
									if($result[csf("costing_per")]==1)
									{
										$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(12*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
									}
									if($result[csf("costing_per")]==2)
									{
										$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(1*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
									}
									if($result[csf("costing_per")]==3)
									{
										$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(24*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
									}
									if($result[csf("costing_per")]==4)
									{
										$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(36*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
									}
									if($result[csf("costing_per")]==5)
									{
										$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(48*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
									}
									$tot_grey_req_as_pre_cost_arr[$result[csf("po_id")]]+=$tot_grey_req_as_pre_cost;
								}
							}
							$total_pre_cost=0;
							$total_booking_qnty_main=0;
							$total_booking_qnty_short=0;
							$total_booking_qnty_sample=0;
							$total_tot_bok_qty=0;
							$tot_balance=0;

							/*$booking_qnty=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and booking_type in(1,4)  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by a.po_break_down_id", "po_break_down_id", "grey_fab_qnty");*/
							//$booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and a.is_short=2 and c.item_category=2 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
							//echo "select a.po_break_down_id as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and a.is_short=2 and c.item_category=2 and a.status_active=1 and a.is_deleted=0 group by a.po_break_down_id order by po_break_down_id";
							$booking_qnty_main=return_library_array( "select a.po_break_down_id as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and a.is_short=2 and c.item_category=$item_cat_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.po_break_down_id order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

							$booking_qnty_short=return_library_array( "select a.po_break_down_id as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and c.item_category=$item_cat_id and a.is_short=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.po_break_down_id order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
							$booking_qnty_sample=return_library_array( "select a.po_break_down_id as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c,wo_pre_cost_fabric_cost_dtls d   where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.pre_cost_fabric_cost_dtls_id=d.id and  d.job_no= b.job_no_mst  and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =4 and c.fabric_source=$cbo_fabric_source and c.item_category=$item_cat_id  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.po_break_down_id order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
							$sql_data=sql_select( "select a.id as id,  a.po_number, max(a.pub_shipment_date) as pub_shipment_date,sum(a.plan_cut) as plan_cut  from wo_po_break_down a,wo_pre_cost_sum_dtls b,wo_pre_cost_mst c where a.job_no_mst=b.job_no and a.job_no_mst=c.job_no and a.id in(".str_replace("'","",$txt_order_no_id).") group by a.id, a.po_number order by id");
							foreach($sql_data  as $row)
							{
							$col++;
							?>
							<tr align="center">
							<td><? echo $col; ?></td>
							<td><? echo $row[csf("po_number")]; ?></td>
							 <td><? echo change_date_format($row[csf("pub_shipment_date")],"dd-mm-yyyy",'-'); ?></td>
							<td align="right"><? echo number_format($tot_grey_req_as_pre_cost_arr[$row[csf("id")]],2); $total_pre_cost+=$tot_grey_req_as_pre_cost_arr[$row[csf("id")]]; ?></td>
							<td align="right"><? echo number_format($booking_qnty_main[$row[csf("id")]],2); $total_booking_qnty_main+=$booking_qnty_main[$row[csf("id")]];?></td>
							<td align="right"><? echo number_format($booking_qnty_short[$row[csf("id")]],2); $total_booking_qnty_short+=$booking_qnty_short[$row[csf("id")]];?></td>
							<td align="right"><? echo number_format($booking_qnty_sample[$row[csf("id")]],2); $total_booking_qnty_sample+=$booking_qnty_sample[$row[csf("id")]];?></td>
							<td align="right"><? $tot_bok_qty=$booking_qnty_main[$row[csf("id")]]+$booking_qnty_short[$row[csf("id")]]+$booking_qnty_sample[$row[csf("id")]]; echo number_format($tot_bok_qty,2); $total_tot_bok_qty+=$tot_bok_qty;?></td>
							<td align="right">
							<? $balance= def_number_format($tot_grey_req_as_pre_cost_arr[$row[csf("id")]]-$tot_bok_qty,2,""); echo number_format($balance,2); $tot_balance+= $balance?>
							</td>
							<td>
							<?
							if( $balance>0)
							{
								echo "Less Booking";
							}
							else if ($balance<0)
							{
								echo "Over Booking";
							}
							else
							{
								echo "";
							}
							?>
							</td>
							</tr>
							<?
							}
							?>
							<tfoot>
							<tr>
							<td colspan="3">Total:</td>
							<td align="right"><? echo number_format($total_pre_cost,2); ?></td>
							<td align="right"><? echo number_format($total_booking_qnty_main,2); ?></td>
							<td align="right"><? echo number_format($total_booking_qnty_short,2); ?></td>
							<td align="right"><? echo number_format($total_booking_qnty_sample,2); ?></td>
							 <td align="right"><? echo number_format($total_tot_bok_qty,2); ?></td>
							<td align="right"><? echo number_format($tot_balance,2); ?></td>
							<td></td>
							</tr>
							</tfoot>
							</table>
						</td>
					</tr>
				</table>
				<br>
					<fieldset id="div_size_color_matrix" style="max-width:1000;">
					<legend>TNA Information</legend>
					<!--<span style="font-size:180; font-weight:bold;"></span>-->
					<table width="100%" style="border:1px solid black;font-size:12px" border="1" cellpadding="2" cellspacing="0" rules="all">
						<tr>
							<td rowspan="2" align="center" valign="top">SL</td>
							<td width="180" rowspan="2"  align="center" valign="top"><b>Order No</b></td>
							<td colspan="2" align="center" valign="top"><b>Fabric Booking</b></td>
                            <td colspan="2" align="center" valign="top"><b>Yarn Issue</b></td>
							<td colspan="2" align="center" valign="top"><b>Knitting</b></td>
							<td colspan="2" align="center" valign="top"><b>Dyeing</b></td>
							<td colspan="2" align="center" valign="top"><b>Finishing Fabric</b></td>
							<td colspan="2" align="center" valign="top"><b>Cutting </b></td>
							<td colspan="2" align="center" valign="top"><b>Sewing </b></td>
							<td colspan="2"  align="center" valign="top"><b>Ex-factory </b></td>
						</tr>
						<tr>
							<td width="70" align="center" valign="top"><b>Start Date</b></td>
							<td width="70" align="center" valign="top"><b>End Date</b></td>
                            <td width="70" align="center" valign="top"><b>Start Date</b></td>
							<td width="70" align="center" valign="top"><b>End Date</b></td>
							<td width="70" align="center" valign="top"><b>Start Date</b></td>
							<td width="70" align="center" valign="top"><b>End Date</b></td>
							<td width="70" align="center" valign="top"><b>Start Date</b></td>
							<td width="70" align="center" valign="top"><b>End Date</b></td>
							<td width="70" align="center" valign="top"><b>Start Date</b></td>
							<td width="70" align="center" valign="top"><b>End Date</b></td>
							<td width="70" align="center" valign="top"><b>Start Date</b></td>
							<td width="70" align="center" valign="top"><b>End Date</b></td>
							<td width="70" align="center" valign="top"><b>Start Date</b></td>
							<td width="70" align="center" valign="top"><b>End Date</b></td>
							<td width="70" align="center" valign="top"><b>Start Date</b></td>
							<td width="70" align="center" valign="top"><b>End Date</b></td>

						</tr>
						<?
						$i=1;
						foreach($tna_date_task_arr as $order_id=>$row)
						{
							 //$tna_date_task_arr//knitting_start_date dying_start_date finishing_start_date cutting_start_date sewing_start_date exfact_start_date
							?>
							<tr>
								<td><? echo $i; ?></td>
								<td><? echo $po_num_arr[$order_id]; ?></td>
								<td align="center"><? echo change_date_format($row['fab_booking_start_date']); ?></td>
								<td  align="center"><? echo change_date_format($row['fab_booking_end_date']); ?></td>
                                <td align="center"><? echo change_date_format($row['yarn_issue_start_date']); ?></td>
								<td  align="center"><? echo change_date_format($row['yarn_issue_end_date']); ?></td>
								<td align="center"><? echo change_date_format($row['knitting_start_date']); ?></td>
								<td  align="center"><? echo change_date_format($row['knitting_end_date']); ?></td>
								<td align="center"><? echo change_date_format($row['dying_start_date']); ?></td>
								<td align="center"><? echo change_date_format($row['dying_end_date']); ?></td>
								<td align="center"><? echo change_date_format($row['finishing_start_date']); ?></td>
								<td align="center"><? echo change_date_format($row['finishing_end_date']); ?></td>
								<td align="center"><? echo change_date_format($row['cutting_start_date']); ?></td>
								<td align="center"><? echo change_date_format($row['cutting_end_date']); ?></td>
								<td align="center"><? echo change_date_format($row['sewing_start_date']); ?></td>
								<td align="center"><? echo change_date_format($row['sewing_end_date']); ?></td>
								<td align="center"><? echo change_date_format($row['exfact_start_date']); ?></td>
								<td align="center"><? echo change_date_format($row['exfact_end_date']); ?></td>
							</tr>
							<?
							$i++;
						}
						?>

					</table>
					</fieldset>
					<?
				}
			}

		?>

         <!--<br><br><br><br>-->
         <?
		 	echo signature_table(1, $cbo_company_name, "1330px");
		 ?>

       </div>

    <script type="text/javascript" src="../../js/jquery.js"></script>
    <script type="text/javascript" src="../../js/jquerybarcode.js"></script>
    <script>
		fnc_generate_Barcode('<? echo $varcode_booking_no; ?>','barcode_img_id');
	</script>
       <?
	   exit();
}
//show_fabric_booking_report_akh
if($action=="show_fabric_booking_report_akh")
{
	extract($_REQUEST);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
	$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
	$txt_job_no=str_replace("'","",$txt_job_no);
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	//$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$marchentrArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info ","id","team_member_name");
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$location_name_arr=return_library_array( "select id,location_name from lib_location",'id','location_name');
	$po_qnty_tot=return_field_value( "sum(plan_cut) as po_tot_qnty", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")","po_tot_qnty");
	$po_qnty_tot1=return_field_value( "sum(po_quantity)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	$pro_sub_dept_array=return_library_array( "select id,sub_department_name from lib_pro_sub_deparatment",'id','sub_department_name');
	?>
	<div style="width:1330px" align="center">
    <?php
$nameArray_approved = sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7");
list($nameArray_approved_row) = $nameArray_approved;
$nameArray_approved_date = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
list($nameArray_approved_date_row) = $nameArray_approved_date;
$nameArray_approved_comments = sql_select("select b.comments as comments from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
list($nameArray_approved_comments_row) = $nameArray_approved_comments;

//$nameArray_approved=sql_select( "select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7");
//list($nameArray_approved_row)=$nameArray_approved;

/*
<?
$nameArray_imge =sql_select("SELECT image_location FROM common_photo_library where master_tble_id='$txt_job_no' and file_type=1");
?>
<img src="../../<? echo $row[0][csf('image_location')]; ?>" width="100" height="100"/>
 */
?>										<!--    Header Company Information         -->
       <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black" >
           <tr>
               <td width="100">
               <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='50px' width='70px' />
               </td>
               <td width="1250">
                    <table width="100%" cellpadding="0" cellspacing="0"  >
                        <tr>
                            <td align="center" width="280px" style="font-size:20px;">
							<?
                            echo $company_library[$cbo_company_name];
                            ?>
                            </td>
							 <td align="left" width="120px" style="font-size:20px;">
							<?
							if(str_replace("'","",$id_approved_id) ==1)
							{
							$approved_date=$nameArray_approved_date_row[csf('approved_date')];
							$approved_date=explode(" ",$approved_date);
							$approveddate= $approved_date[0];
							$approved_time= $approved_date[1];
							$ampm_time= $approved_date[2];
							echo 'Approved Date: &nbsp;'.change_date_format($approveddate).', '.$approved_time.' '.$ampm_time;
							}
							 ?>
                            </td>

                        </tr>
                        <tr>
                            <td align="center" width="280px" style="font-size:20px">
                                <strong><?

								 if($report_title !=""){ echo $report_title;} else { echo "General Work Order";}?> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style="color:#F00"><? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </font></strong>
                             </td>

                              <td rowspan="2" width="120" style=" font-size:xx-large">
                                <?
								 if($nameArray_approved_row[csf('approved_no')]>1)
								 {
								 ?>
								 <strong> Revised No: <? echo $nameArray_approved_row[csf('approved_no')]-1; ?></strong>
								  <?
								 }
							  	?>


                            </td>
                        </tr>
                  </table>
                </td>
            </tr>
       </table>
                <?
				$job_no='';
				$total_set_qnty=0;
				$colar_excess_percent=0;
				$cuff_excess_percent=0;
				$rmg_process_breakdown=0;

                /*$nameArray=sql_select( "select a.booking_no,a.booking_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.delivery_date,a.po_break_down_id,a.colar_excess_percent,a.cuff_excess_percent,a.delivery_date,a.is_apply_last_update,a.fabric_source,a.rmg_process_breakdown,a.insert_date,a.update_date,b.job_no,b.buyer_name, b.style_ref_no ,b.gmts_item_id,b.order_uom,b.total_set_qnty,b.style_description,b.season,b.product_dept,b.product_code,b.pro_sub_dep,b.dealing_marchant
				from wo_booking_mst a, wo_po_details_master b
				where  a.job_no=b.job_no and a.booking_no=$txt_booking_no");*/

				$booking_po_id=str_replace("'","",$txt_order_no_id);
				if($db_type==0)
				{
					$nameArray=sql_select( "select a.booking_no,a.booking_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.delivery_date,a.po_break_down_id,a.colar_excess_percent,a.cuff_excess_percent,a.delivery_date,a.is_apply_last_update,a.fabric_source,a.rmg_process_breakdown,a.insert_date,a.update_date,b.job_no,b.buyer_name, b.style_ref_no ,b.gmts_item_id,b.order_uom,b.total_set_qnty,b.style_description,b.product_dept,b.product_code,b.pro_sub_dep,b.dealing_marchant,group_concat(c.po_number) as po_number_all,MIN(c.pub_shipment_date) as pub_shipment_date, group_concat(DATEDIFF(c.pub_shipment_date,c.po_received_date)) as  date_diff, MIN(c.pub_shipment_date) as  pub_shipment_date, MIN(c.insert_date) as po_insert_date,group_concat(c.shiping_status) as shiping_status, sum(c.po_quantity*b.total_set_qnty) as po_qnty_pce,sum(c.plan_cut*b.total_set_qnty) as plan_cut
				from wo_booking_mst a, wo_po_details_master b, wo_po_break_down c
				where  a.job_no=b.job_no and b.job_no=c.job_no_mst and a.booking_no=$txt_booking_no and c.id in($booking_po_id)
				group by a.booking_no,a.booking_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.delivery_date,a.po_break_down_id,a.colar_excess_percent,a.cuff_excess_percent,a.delivery_date,a.is_apply_last_update,a.fabric_source,a.rmg_process_breakdown,a.insert_date,a.update_date,b.job_no,b.buyer_name, b.style_ref_no ,b.gmts_item_id,b.order_uom,b.total_set_qnty,b.style_description,b.product_dept,b.product_code,b.pro_sub_dep,b.dealing_marchant ");
				}
				else//LISTAGG(cast(b.id as varchar2(4000)), ',') WITHIN GROUP (ORDER BY b.id) as po_id
				{
					$nameArray=sql_select( "select a.booking_no,a.booking_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.delivery_date,a.po_break_down_id,a.colar_excess_percent,a.cuff_excess_percent,a.delivery_date,a.is_apply_last_update,a.fabric_source,a.rmg_process_breakdown,a.insert_date,a.update_date, a.fabric_composition,b.job_no,b.buyer_name, b.style_ref_no ,b.gmts_item_id,b.order_uom,b.total_set_qnty,b.style_description,b.product_dept,b.product_code,b.pro_sub_dep,b.dealing_marchant, LISTAGG(cast(c.po_number as varchar2(4000)), ',') WITHIN GROUP (ORDER BY c.po_number) as po_number_all, LISTAGG(cast(c.pub_shipment_date as varchar2(4000)), ',') WITHIN GROUP (ORDER BY c.pub_shipment_date)  as pub_shipment_date, LISTAGG(cast((c.pub_shipment_date-c.po_received_date) as varchar2(4000)), ',') WITHIN GROUP (ORDER BY c.pub_shipment_date,c.po_received_date) as  date_diff, MIN(c.pub_shipment_date) as  pub_shipment_date, MIN(c.insert_date) as po_insert_date, LISTAGG(cast(c.shiping_status as varchar2(4000)), ',') WITHIN GROUP (ORDER BY c.shiping_status) as shiping_status, sum(c.po_quantity*b.total_set_qnty) as po_qnty_pce,sum(c.plan_cut*b.total_set_qnty) as plan_cut
				from wo_booking_mst a, wo_po_details_master b, wo_po_break_down c
				where  a.job_no=b.job_no and b.job_no=c.job_no_mst and a.booking_no=$txt_booking_no and c.id in($booking_po_id)
				group by a.booking_no,a.booking_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.delivery_date,a.po_break_down_id,a.colar_excess_percent,a.cuff_excess_percent,a.delivery_date,a.is_apply_last_update,a.fabric_source,a.rmg_process_breakdown,a.insert_date,a.update_date, a.fabric_composition,b.job_no,b.buyer_name, b.style_ref_no ,b.gmts_item_id,b.order_uom,b.total_set_qnty,b.style_description,b.product_dept,b.product_code,b.pro_sub_dep,b.dealing_marchant ");
				}



				/*echo "select sum(order_quantity) as order_quantity,sum(plan_cut_qnty) as plan_cut_qnty
				from wo_po_color_size_breakdown where po_break_down_id in($booking_po_id) <br>";
				echo "select sum(plan_cut) as po_tot_qnty ";*/
				//$po_qnty_tot=return_field_value( "sum(plan_cut) as po_tot_qnty", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")","po_tot_qnty");

				$po_plancut_sql=sql_select("select sum(order_quantity) as order_quantity,sum(plan_cut_qnty) as plan_cut_qnty
				from wo_po_color_size_breakdown where po_break_down_id in($booking_po_id) and status_active=1 and is_deleted=0");

				//echo $po_plancut_sql;die;
				if($db_type==2) $group_concat_all=" listagg(cast(b.grouping as varchar2(4000)),',') within group (order by b.grouping) as grouping,
				listagg(cast(b.file_no as varchar2(4000)),',') within group (order by b.file_no) as file_no  ";
				else { $group_concat_all="group_concat(b.grouping) as grouping, group_concat(b.file_no) as file_no";}
				$data_array3=sql_select("select a.job_no,a.style_description,a.company_name,a.buyer_name,$group_concat_all from wo_po_details_master a, wo_po_break_down b where b.id in ($booking_po_id) and a.job_no=b.job_no_mst group by a.job_no,a.style_description,a.company_name,a.buyer_name");




				/*$po_id_all=$nameArray[0][csf('po_break_down_id')];
				$po_num_arr=return_library_array("select id,po_number from wo_po_break_down where id in($po_id_all)",'id','po_number');
				$tna_start_sql=sql_select( "select id,po_number_id,
								(case when task_number=31 then task_start_date else null end) as fab_booking_start_date,
								(case when task_number=31 then task_finish_date else null end) as fab_booking_end_date,
								(case when task_number=60 then task_start_date else null end) as knitting_start_date,
								(case when task_number=60 then task_finish_date else null end) as knitting_end_date,
								(case when task_number=61 then task_start_date else null end) as dying_start_date,
								(case when task_number=61 then task_finish_date else null end) as dying_end_date,
								(case when task_number=73 then task_start_date else null end) as finishing_start_date,
								(case when task_number=73 then task_finish_date else null end) as finishing_end_date,
								(case when task_number=84 then task_start_date else null end) as cutting_start_date,
								(case when task_number=84 then task_finish_date else null end) as cutting_end_date,
								(case when task_number=86 then task_start_date else null end) as sewing_start_date,
								(case when task_number=86 then task_finish_date else null end) as sewing_end_date,
								(case when task_number=110 then task_start_date else null end) as exfact_start_date,
								(case when task_number=110 then task_finish_date else null end) as exfact_end_date
								from tna_process_mst
								where status_active=1 and po_number_id in($po_id_all)");
				$tna_fab_start=$tna_knit_start=$tna_dyeing_start=$tna_fin_start=$tna_cut_start=$tna_sewin_start=$tna_exfact_start="";
				$tna_date_task_arr=array();
				foreach($tna_start_sql as $row)
				{
					if($row[csf("fab_booking_start_date")]!="" && $row[csf("fab_booking_start_date")]!="0000-00-00")
					{
						if($tna_fab_start=="")
						{
							$tna_fab_start=$row[csf("fab_booking_start_date")];
						}
					}


					if($row[csf("knitting_start_date")]!="" && $row[csf("knitting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_start_date']=$row[csf("knitting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_end_date']=$row[csf("knitting_end_date")];
					}
					if($row[csf("dying_start_date")]!="" && $row[csf("dying_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['dying_start_date']=$row[csf("dying_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['dying_end_date']=$row[csf("dying_end_date")];
					}
					if($row[csf("finishing_start_date")]!="" && $row[csf("finishing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_start_date']=$row[csf("finishing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_end_date']=$row[csf("finishing_end_date")];
					}
					if($row[csf("cutting_start_date")]!="" && $row[csf("cutting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_start_date']=$row[csf("cutting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_end_date']=$row[csf("cutting_end_date")];
					}
					if($row[csf("sewing_start_date")]!="" && $row[csf("sewing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_start_date']=$row[csf("sewing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_end_date']=$row[csf("sewing_end_date")];
					}
					if($row[csf("exfact_start_date")]!="" && $row[csf("exfact_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_start_date']=$row[csf("exfact_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_end_date']=$row[csf("exfact_end_date")];
					}
				}*/
				//echo $nameArray;die;

				$tna_start_date="";
				foreach ($nameArray as $result)
				{
					$total_set_qnty=$result[csf('total_set_qnty')];
					$colar_excess_percent=$result[csf('colar_excess_percent')];
					$cuff_excess_percent=$result[csf('cuff_excess_percent')];
					$rmg_process_breakdown=$result[csf('rmg_process_breakdown')];

					/*$colar_excess_percent=$result[csf('colar_excess_percent')];
				    $cuff_excess_percent=$result[csf('cuff_excess_percent')];
					$rmg_process_breakdown=$result[csf('rmg_process_breakdown')];
					$po_no="";
					$shipment_date="";
					$shiping_status_arr=explode(",",$result[csf('shiping_status')]);
					$shiping_status_arr=array_unique($shiping_status_arr);
					if(count($shiping_status_arr)==1 && $shiping_status_arr[0]==3)
					{

						$shiping_status= "Full shipment";
					}
					else if(count($shiping_status_arr)==1 && $shiping_status_arr[0]==1)
					{
						$shiping_status= "Full Pending";
					}
					else
					{
						$shiping_status= "Partial shipment";
					}*/

					/*$sql_po= "select po_number,MIN(pub_shipment_date) pub_shipment_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by po_number";
					$data_array_po=sql_select($sql_po);
					foreach ($data_array_po as $row_po)
					{
						$po_no.=$row_po[csf('po_number')].", ";
						$shipment_date.=change_date_format($row_po[csf('pub_shipment_date')],'dd-mm-yyyy','-').", ";
					}*/
					/*$lead_time="";
					if($db_type==0)
					{
						$sql_lead_time= "select DATEDIFF(pub_shipment_date,po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}
					if($db_type==2)
					{
						$sql_lead_time= "select (pub_shipment_date-po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}
					$data_array_lead_time=sql_select($sql_lead_time);
					foreach ($data_array_lead_time as $row_lead_time)
					{
						$lead_time.=$row_lead_time[csf('date_diff')].",";
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}*/

					/*$po_received_date="";
					$sql_po_received_date= "select MIN(po_received_date) as po_received_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					$data_array_po_received_date=sql_select($sql_po_received_date);
					foreach ($data_array_po_received_date as $row_po_received_date)
					{
						$po_received_date=change_date_format($row_po_received_date[csf('po_received_date')],'dd-mm-yyyy','-');
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}*/

					/*$sql_po= "select po_number,MIN(pub_shipment_date) pub_shipment_date, MIN(insert_date) as insert_date,shiping_status from wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by po_number,shiping_status";
					$data_array_po=sql_select($sql_po);
					foreach ($data_array_po as $rows)
					{
						$daysInHand.=(datediff('d',date('d-m-Y',time()),$rows[csf('pub_shipment_date')])-1).",";
						$booking_date=$result[csf('update_date')];
						if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
						{
							$booking_date=$result[csf('insert_date')];
						}
						$WOPreparedAfter.=(datediff('d',$rows[csf('insert_date')],$booking_date)-1).",";

						if($rows[csf('shiping_status')]==1)
						{
						$shiping_status.= "FP".",";
						}
						else if($rows[csf('shiping_status')]==2)
						{
						$shiping_status.= "PS".",";
						}
						else if($rows[csf('shiping_status')]==3)
						{
						$shiping_status.= "FS".",";
						}

					}*/
				?>
            <table width="1330" style="border:1px solid black" >
                <tr>
                	<td colspan="6" valign="top" style="font-size:18px; color:#F00"><? if($result[csf('is_apply_last_update')]==2){echo "Booking Info not synchronized with order entry and pre-costing. order entry or pre-costing has updated after booking entry.  Contact to ".$marchentrArr[$result[csf('dealing_marchant')]]; } else{ echo "";} ?></td>
                </tr>
                <tr>
                    <td width="150"><span style="font-size:18px"><b>Buyer/Agent Name</b></span></td>
                    <td width="300">:&nbsp;<span style="font-size:18px"><b><? echo $buyer_name_arr[$result[csf('buyer_name')]]; ?></b></span></td>
                    <td style="font-size:18px" width="150"><b>Style Ref.</b>   </td>
                    <td style="font-size:18px" width="300">:&nbsp;<b><? echo $result[csf('style_ref_no')];?> </b>   </td>
                    <td width="150"><span style="font-size:18px"><b>Order Qnty</b></span></td>
                    <td style="font-size:18px">:&nbsp;<b><?  echo $po_qnty_tot1." ".$unit_of_measurement[$result[csf('order_uom')]];
					//echo number_format($result[csf('po_qnty_pce')],0)." ".$unit_of_measurement[$result[csf('order_uom')]] ; ?></b></td>
                </tr>
                <tr>
                    <td  style="font-size:12px"><b>Garments Item</b></td>
                    <td>:&nbsp;
                    <?
                    $gmts_item_name="";
                    $gmts_item=explode(',',$result[csf('gmts_item_id')]);
                    for($g=0;$g<=count($gmts_item); $g++)
                    {
                    $gmts_item_name.= $garments_item[$gmts_item[$g]].",";
                    }
                    echo rtrim($gmts_item_name,',');
                    ?>
                    </td>
                    <td  style="font-size:12px"><b>Booking Release Date</b></td>
                    <td >:&nbsp;
                    <?
                    $booking_date=$result[csf('update_date')];
                    if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
                    {
                    	$booking_date=$result[csf('insert_date')];
                    }
                    echo change_date_format($booking_date,'dd-mm-yyyy','-','');
                    ?>&nbsp;</td>
                    <td style="font-size:12px"><b>Dealing Merchant</b></td>
                    <td>:&nbsp;<? echo $marchentrArr[$result[csf('dealing_marchant')]]; ?></td>
                </tr>
                <tr>
                    <td style="font-size:18px"><b>Dept.</b></td>
                    <td style="font-size:18px">:&nbsp;<b><? echo $product_dept[$result[csf('product_dept')]] ; if($result[csf('product_code')] !=""){ echo " (".$result[csf('product_code')].")";} if($result[csf('pro_sub_dep')] !=0){ echo " (".$pro_sub_dept_array[$result[csf('pro_sub_dep')]].")";}?></b></td>
                    <td style="font-size:12px"><b>Delivery Date</b></td>
                    <td >:&nbsp;<? echo change_date_format( $result[csf('delivery_date')],'dd-mm-yyyy','-');?></td>
                    <td style="font-size:12px"><b>Shipment Date</b></td>
                    <td >:&nbsp;<? echo change_date_format( $result[csf('pub_shipment_date')],'dd-mm-yyyy','-');?></td>
                </tr>
                <tr>
                    <td style="font-size:18px"><b>Order No</b></td>
                    <td style="font-size:18px"  colspan="3">:&nbsp;<b><? echo $result[csf('po_number_all')];//echo rtrim($po_no,", "); ?></b></td>
                    <td style="font-size:12px"><b>Job No</b></td>
                    <td >:&nbsp;<? echo $result[csf('job_no')];?></td>
                </tr>
                <tr>
                    <td style="font-size:18px"><b>Internal Ref No</b></td>
                    <td style="font-size:18px"> :&nbsp;<b><? echo implode(",",array_unique(explode(",",$data_array3[0][csf("grouping")]))); ?></b></td>
                    <td style="font-size:18px"><b>File no</b></td>
                    <td style="font-size:18px"> :&nbsp;<b><? echo  implode(",",array_unique(explode(",",$data_array3[0][csf("file_no")])));?></b></td>
                    <td style="font-size:18px"><b>Booking No </b>   </td>
                    <td style="font-size:18px">:&nbsp;<b><? echo $result[csf('booking_no')];?></b><? echo "(".$fabric_source[$result[csf('fabric_source')]].")"?></td>
                </tr>
                <tr>

                   <td style="font-size:18px"><b>Fab. Composition</b></td>
                    <td style="font-size:18px"> :&nbsp;<b><? echo $result[csf('fabric_composition')]; ?></b></td>
                     <td style="font-size:18px"><b>Style Description</b></td>
                    <td style="font-size:18px"> :&nbsp;<b><? echo $data_array3[0][csf("style_description")]; ?></b></td>


                     <td style="font-size:18px"><b>Booking Date</b></td>
                    <td style="font-size:18px"> :&nbsp;<b><? echo change_date_format($result[csf('booking_date')]); ?></b></td>

                </tr>


            </table>
            <?
			}

			if($cbo_fabric_source==1 || $cbo_fabric_source==2)
			{
				$nameArray_size=sql_select( "select distinct size_number_id from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  	is_deleted=0 and status_active=1  order by size_number_id desc");
				$color_size_order_qnty_array=array();
				$color_size_qnty_array=array();
				$size_tatal=array();
				$size_tatal_order=array();
				$order_id=explode(",",str_replace("'","",$txt_order_no_id));
				for($or=0;$or<count($order_id); $or++)
				{
					for($c=0;$c<count($gmts_item); $c++)
					{
						$item_size_tatal=array();
						$item_size_tatal_order=array();
						$item_grand_total=0;
						$item_grand_total_order=0;
						$nameArray_color=sql_select( "select distinct color_number_id from wo_po_color_size_breakdown where  item_number_id=$gmts_item[$c] and po_break_down_id =$order_id[$or] and is_deleted=0 and status_active=1 order by color_number_id");
						foreach($nameArray_color as $result_color)
						{
							$color_total=0;
							$color_total_order=0;

							foreach($nameArray_size  as $result_size)
							{
								$nameArray_color_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id =$order_id[$or] and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$result_color[csf('color_number_id')]."  and item_number_id=$gmts_item[$c] and  status_active=1 and is_deleted =0 order by size_number_id");
								foreach($nameArray_color_size_qnty as $result_color_size_qnty)
								{
									if($result_color_size_qnty[csf('plan_cut_qnty')]!= "")
									{
										//echo number_format($result_color_size_qnty[csf('order_quantity')],0);
										$color_total += $result_color_size_qnty[csf('plan_cut_qnty')] ;
										$color_total_order += $result_color_size_qnty[csf('order_quantity')] ;
										$item_grand_total+=$result_color_size_qnty[csf('plan_cut_qnty')];
										$item_grand_total_order+=$result_color_size_qnty[csf('order_quantity')];
										$grand_total +=$result_color_size_qnty[csf('plan_cut_qnty')];
										$grand_total_order +=$result_color_size_qnty[csf('order_quantity')];
										$color_size_qnty_array[$result_size[csf('size_number_id')]][$result_color['color_number_id']]=$result_color_size_qnty[csf('plan_cut_qnty')];
										$color_size_order_qnty_array[$result_size[csf('size_number_id')]][$result_color[csf('color_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
										if (array_key_exists($result_size[csf('size_number_id')], $size_tatal))
										{
											$size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
											$size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
										}
										else
										{
											$size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
											$size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
										}
										if (array_key_exists($result_size[csf('size_number_id')], $item_size_tatal))
										{
											$item_size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
											$item_size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
										}
										else
										{
											$item_size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
											$item_size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
										}
									}
									//else echo "0";
								}
							}
						}
					}
				}

				/*$nameArray_imge =sql_select("SELECT image_location FROM common_photo_library where master_tble_id='$job_no' and file_type=1");
				?>
				<div id="div_size_color_matrix" style="float:left;">
				<fieldset id="" >
				<legend>Image </legend>
				<table width="310">
				<tr>
				<?
				$img_counter = 0;
				foreach($nameArray_imge as $result_imge)
				{
				if($path=="")
				{
				$path='../../';
				}

				?>
				<td>
				<!--<img src="../../<? //echo $result_imge[csf('image_location')]; ?>" width="90" height="100" border="2" />-->
				<img src="<? echo $path.$result_imge[csf('image_location')]; ?>" width="90" height="100" border="2" />
				</td>
				<?

				$img_counter++;
				}
				?>
				</tr>
				</table>
				</fieldset>
				</div>
				</td>
				</tr>
				</table>
				<?*/


			}// if($cbo_fabric_source==1) end

	  ?>

      <br/>
      <!--  Here will be the main portion  -->
     <?
	 $costing_per="";
	 $costing_per_qnty=0;
	 $costing_per_id=return_field_value( "costing_per", "wo_pre_cost_mst","job_no ='".$txt_job_no."'");
	 if($costing_per_id==1)
			{
				$costing_per="1 Dzn";
				$costing_per_qnty=12;

			}
			if($costing_per_id==2)
			{
				$costing_per="1 Pcs";
				$costing_per_qnty=1;

			}
			if($costing_per_id==3)
			{
				$costing_per="2 Dzn";
				$costing_per_qnty=24;

			}
			if($costing_per_id==4)
			{
				$costing_per="3 Dzn";
				$costing_per_qnty=36;

			}
			if($costing_per_id==5)
			{
				$costing_per="4 Dzn";
				$costing_per_qnty=48;

			}
			$process_loss_method=return_field_value( "process_loss_method", "wo_pre_cost_fabric_cost_dtls","job_no='$txt_job_no'");

	 ?>

     <?

	/*$nameArray_fabric_description= sql_select("SELECT a.color_type_id,a.construction,a.composition,a.gsm_weight,a.dia_width,a.process_loss_percent FROM view_wo_fabric_booking_data_park a,wo_booking_dtls b where b.booking_no =$txt_booking_no and a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and b.status_active=1 and
b.is_deleted=0  group by a.color_type_id,a.construction,a.composition,a.gsm_weight,a.dia_width,process_loss_percent order by a.pre_cost_fabric_cost_dtls_id");*/
if($cbo_fabric_source==1)
{


$nameArray_fabric_description= sql_select("select  min(a.id) as id, a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type, b.dia_width, sum((c.plan_cut_qnty/b.pcs)*b.cons) as cons, sum(c.plan_cut_qnty) as plan_cut, avg(b.pcs) as pcs, avg(b.process_loss_percent) as process_loss_percent , avg(b.requirment) as requirment
FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
WHERE a.job_no=b.job_no and
a.id=b.pre_cost_fabric_cost_dtls_id and
c.job_no_mst=a.job_no and
c.id=b.color_size_table_id and
b.po_break_down_id=d.po_break_down_id and
b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
d.booking_no =$txt_booking_no and
d.status_active=1 and
d.is_deleted=0
group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by id");

/* monju vai
$nameArray_fabric_description= sql_select("select  min(a.id) as id, a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type, b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent , avg(b.requirment) as requirment, d.pre_cost_fabric_cost_dtls_id
FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
WHERE a.job_no=b.job_no and
a.id=b.pre_cost_fabric_cost_dtls_id and
c.job_no_mst=a.job_no and
c.id=b.color_size_table_id and
b.po_break_down_id=d.po_break_down_id and
b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
d.booking_no =$txt_booking_no and
d.status_active=1 and
d.is_deleted=0
group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width, d.pre_cost_fabric_cost_dtls_id order by d.pre_cost_fabric_cost_dtls_id");*/

/*$nameArray_fabric_description= sql_select("select min(a.id) as fabric_cost_dtls_id, a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type, b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent , avg(b.requirment) as requirment FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
WHERE a.job_no=b.job_no and
a.id=b.pre_cost_fabric_cost_dtls_id and
c.job_no_mst=a.job_no and
c.id=b.color_size_table_id and
b.po_break_down_id=d.po_break_down_id and
b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
d.booking_no =$txt_booking_no and
d.status_active=1 and
d.is_deleted=0
group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by fabric_cost_dtls_id,a.body_part_id,b.dia_width");*/

	 ?>

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
     <tr align="center">
     <th colspan="3" align="left">Body Part</th>
        <?
		//var_dump($nameArray_fabric_description);die;
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
		}
		?>
        <td  rowspan="9" width="50"><p>Total Grey Fabric <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
        <td  rowspan="9" width="50"><p>Total  Finish Fabric <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
        <td  rowspan="9" width="50"><p>Process Loss % </p></td>
       </tr>
     <tr align="center"><th colspan="3" align="left">Color Type</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
		}
		?>
        <!--<td  rowspan="8" width="50"><p>Total  Finish Fabric (KG)</p></td> <td  rowspan="8" width="50"><p>Total Grey Fabric (KG)</p></td>-->
             <!--<td  rowspan="7" width="50"><p>Process Loss % </p></td>-->
       </tr>
        <tr align="center"><th colspan="3" align="left">Fabric Construction</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>". $result_fabric_description[csf('construction')]."</td>";
		}
		?>


       </tr>
        <tr align="center"><th   colspan="3" align="left">Fabric Composition</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='2' >&nbsp</td>";
			else         		               echo "<td colspan='2' >".$result_fabric_description[csf('composition')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th  colspan="3" align="left">GSM</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='2'>&nbsp</td>";
			else         		       echo "<td colspan='2' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='2'>&nbsp</td>";
			else         		              echo "<td colspan='2' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Consumption For <? echo $costing_per; ?></th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			$cons=0;
			$cons=($result_fabric_description[csf('cons')]/$result_fabric_description[csf('plan_cut')])*$result_fabric_description[csf('pcs')];
			if( $result_fabric_description[csf('requirment')] == "")   echo "<td colspan='2'>&nbsp</td>";
			else         		              echo "<td colspan='2' align='center'>Fin: ".number_format($cons,4)."</td>";
		}
		?>

       </tr>
       <tr>
       <th  colspan="<? echo  count($nameArray_fabric_description)*2+3; ?>" align="left" style="height:30px">&nbsp;</th>
       </tr>

       <tr>
            <!--<th  width="120" align="left">Gmts. Color</th>-->
            <th  width="120" align="left">Fabric Color</th>
            <th  width="120" align="left">Body Color</th>
            <th  width="120" align="left">Lab Dip No</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			  echo "<th width='50'>Grey</th><th width='50'>Finish</th>";
		}
		?>

       </tr>
       <?

		  /*$gmt_color_library=return_library_array( "select gmts_color_id,contrast_color_id
		  FROM
		  wo_pre_cos_fab_co_color_dtls
		  WHERE
		  job_no ='$job_no'", "contrast_color_id", "gmts_color_id");*/
		  $gmt_color_library=array();
		  $gmt_color_data=sql_select("select b.gmts_color_id, b.contrast_color_id
		  FROM
		  wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b
		  WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.fabric_source =$cbo_fabric_source and
		  a.job_no ='$txt_job_no' and b.status_active=1 and a.status_active=1");
		  foreach( $gmt_color_data as $gmt_color_row)
		  {
			//$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
			$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];

		  }

	        $grand_total_fin_fab_qnty=0;
			$grand_total_grey_fab_qnty=0;
			$grand_totalcons_per_finish=0;
			$grand_totalcons_per_grey=0;
			$color_wise_wo_sql=sql_select("select fabric_color_id
										  FROM
										  wo_booking_dtls
										  WHERE
										  booking_no =$txt_booking_no and
										  status_active=1 and
                                          is_deleted=0
										  group by fabric_color_id");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
		?>
			<tr>
           <!-- <td  width="120" align="left">
			<?

			//echo $color_library[$color_wise_wo_result['fabric_color_id']];

			?></td>-->
            <td  width="120" align="left">
			<?
			echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];
			?>
            </td>
            <td>
            <?
			//echo $color_library[$gmt_color_library[$color_wise_wo_result['fabric_color_id']]];
			//echo rtrim($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]],",");
			echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
			?>
            </td>
            <td width="120" align="left">
			<?
			$order_id=str_replace("'","",$txt_order_no_id);
			$lapdip_no="";
			$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$txt_job_no."'  and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
			//echo "lapdip_no from wo_po_lapdip_approval_info where job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result['fabric_color_id']."";
			if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_grey_fab_qnty=0;

			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
				  FROM
				  view_wo_fabric_booking_data_park a,
				  wo_booking_dtls b
				  WHERE
				  b.booking_no =$txt_booking_no  and
				  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
				  a.po_break_down_id=b.po_break_down_id and
				  a.color_size_table_id=b.color_size_table_id and
				  a.color_type_id='".$result_fabric_description['color_type_id']."' and
				  a.construction='".$result_fabric_description['construction']."' and
				  a.composition='".$result_fabric_description['composition']."' and
				  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
				  a.dia_width='".$result_fabric_description['dia_width']."' and
				  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
				  b.fabric_color_id=".$color_wise_wo_result['fabric_color_id']." and
				  b.status_active=1 and
				  b.is_deleted=0");*/
				if($db_type==0)
				{
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				d.fabric_color_id='".$color_wise_wo_result[csf('fabric_color_id')]."' and
				d.status_active=1 and
				d.is_deleted=0  and
				c.status_active=1 and
				c.is_deleted=0 ");
				}
				if($db_type==2)
				{
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
				d.status_active=1 and
				d.is_deleted=0 and
				c.status_active=1 and
				c.is_deleted=0 ");
				}

				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
				?>

				<td width='50' align='right' >
				<?
				if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
				{
					echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],0);
					$total_grey_fab_qnty+=number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],0,'','');
				}
				?>
				</td>
				<td width='50' align='right'>
				<?
				if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
				{
					echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],0) ;
					$total_fin_fab_qnty+=number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],0,'','') ;
				}
				?>
				</td>
				<?
			}
			?>
            <td align="right"><? echo number_format($total_grey_fab_qnty,0); $grand_total_grey_fab_qnty+=number_format($total_grey_fab_qnty,0,'','');?></td>
            <td align="right">
			<?
			echo number_format($total_fin_fab_qnty,0); $grand_total_fin_fab_qnty+=number_format($total_fin_fab_qnty,0,'','');
			?>
            </td>

            <td align="right">
            <?
			if($process_loss_method==1)
			{
				$process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_fin_fab_qnty)*100;
			}

			if($process_loss_method==2)
			{
				$process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_grey_fab_qnty)*100;
			}
			echo number_format($process_percent,0);

			?>
            </td>
            </tr>
         <?

		}
		?>
        <tr style=" font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Total</strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {

				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0  and
												c.status_active=1 and
												c.is_deleted=0  ");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right' > <? echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],0);?></td>
            <td width='50' align='right'><? echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],0) ;?></td>
            <?
			}
			?>
            <td align="right"><? echo number_format($grand_total_grey_fab_qnty,0);?></td>
            <td align="right"><? echo number_format($grand_total_fin_fab_qnty,0);?></td>
            <td align="right">
            <?
            if($process_loss_method==1)// markup
			{
				$totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_fin_fab_qnty)*100;
			}

			if($process_loss_method==2) //margin
			{
				$totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_grey_fab_qnty)*100;
			}
			//echo number_format($totalprocess_percent,0);
			?>
            </td>
            </tr>
            <tr style="font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0  and
												c.status_active=1 and
												c.is_deleted=0 ");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

			?>
			<td width='50' align='right'><?  //echo number_format(($color_wise_wo_result_qnty['fin_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td><td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <?
			}
			?>
            <td align="right">
			<?
			//echo $grand_total_grey_fab_qnty;
			echo number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4);
			$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4)
			?>
            </td>
            <td align="right">
			<?
			echo number_format(($grand_total_fin_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4);
			$grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$$grand_total)*($total_set_qnty*$costing_per_qnty),4);
			?></td>
            <td align="right">
            <?
            if($process_loss_method==1)
			{
				$totalprocess_percent_dzn=(($grand_total_grey_fab_qnty_dzn-$grand_total_fin_fab_qnty_dzn)/$grand_total_fin_fab_qnty_dzn)*100;
			}

			if($process_loss_method==2)
			{
				$totalprocess_percent_dzn=(($grand_total_grey_fab_qnty_dzn-$grand_total_fin_fab_qnty_dzn)/$grand_total_grey_fab_qnty_dzn)*100;
			}
			//echo number_format($totalprocess_percent_dzn,2);
			?>
            </td>
            </tr>
    </table>
    <?
	}
	/*$nameArray_fabric_description= sql_select("SELECT a.color_type_id,a.construction,a.composition,a.gsm_weight,a.dia_width,a.process_loss_percent FROM view_wo_fabric_booking_data_park a,wo_booking_dtls b where b.booking_no =$txt_booking_no and a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and b.status_active=1 and
b.is_deleted=0  group by a.color_type_id,a.construction,a.composition,a.gsm_weight,a.dia_width,process_loss_percent order by a.pre_cost_fabric_cost_dtls_id");*/
	if($cbo_fabric_source==2)
	{
	$nameArray_fabric_description= sql_select("select min(a.id) as id, a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type , b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent, avg(b.requirment) as requirment
	FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
	WHERE a.job_no=b.job_no and
	a.id=b.pre_cost_fabric_cost_dtls_id and
	c.job_no_mst=a.job_no and
	c.id=b.color_size_table_id and
	b.po_break_down_id=d.po_break_down_id and
	b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
	d.booking_no =$txt_booking_no and
	d.status_active=1 and
	d.is_deleted=0
	group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width
	order by id");
		 ?>

		 <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
		 <tr align="center">
		 <th colspan="3" align="left">Body Part</th>
			<?
			foreach($nameArray_fabric_description  as $result_fabric_description)
			{
				if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
				else         		               echo "<td  colspan='3'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
			}
			?>
			<td  rowspan="9" width="50"><p>Total Fabric <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
			<td  rowspan="9" width="50"><p>Avg Rate <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
			<td  rowspan="9" width="50"><p>Amount </p></td>
		   </tr>
		 <tr align="center"><th colspan="3" align="left">Color Type</th>
			<?
			foreach($nameArray_fabric_description  as $result_fabric_description)
			{
				if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
				else         		               echo "<td  colspan='3'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
			}
			?>
			<!--<td  rowspan="8" width="50"><p>Total  Finish Fabric (KG)</p></td> <td  rowspan="8" width="50"><p>Total Grey Fabric (KG)</p></td>-->
				 <!--<td  rowspan="7" width="50"><p>Process Loss % </p></td>-->
		   </tr>
			<tr align="center"><th colspan="3" align="left">Fabric Construction</th>
			<?
			foreach($nameArray_fabric_description  as $result_fabric_description)
			{
				if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='3'>&nbsp</td>";
				else         		               echo "<td  colspan='3'>". $result_fabric_description[csf('construction')]."</td>";
			}
			?>


		   </tr>
			<tr align="center"><th   colspan="3" align="left">Fabric Composition</th>
			<?
			foreach($nameArray_fabric_description as $result_fabric_description)
			{
				if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='3' >&nbsp</td>";
				else         		               echo "<td colspan='3' >".$result_fabric_description[csf('composition')]."</td>";
			}
			?>

		   </tr>
		   <tr align="center"><th  colspan="3" align="left">GSM</th>
			<?
			foreach($nameArray_fabric_description  as $result_fabric_description)
			{
				if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='3'>&nbsp</td>";
				else         		       echo "<td colspan='3' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
			}
			?>

		   </tr>
		   <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
			<?
			foreach($nameArray_fabric_description as $result_fabric_description)
			{
				if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='3'>&nbsp</td>";
				else         		              echo "<td colspan='3' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
			}
			?>

		   </tr>
		   <tr align="center"><th   colspan="3" align="left">Consumption For <? echo $costing_per; ?></th>
			<?
			foreach($nameArray_fabric_description as $result_fabric_description)
			{
				if( $result_fabric_description[csf('requirment')] == "")   echo "<td colspan='3'>&nbsp</td>";
				else         		              echo "<td colspan='3' align='center'>Fin: ".number_format($result_fabric_description[csf('cons')],2)."</td>";
			}
			?>

		   </tr>
		   <tr>
		   <th  colspan="<? echo  count($nameArray_fabric_description)*3+3; ?>" align="left" style="height:30px">&nbsp;</th>
		   </tr>

		   <tr>
				<!--<th  width="120" align="left">Gmts. Color</th>-->
				<th  width="120" align="left">Fabric Color</th>
				<th  width="120" align="left">Body Color</th>
				<th  width="120" align="left">Lab Dip No</th>
			<?
			foreach($nameArray_fabric_description as $result_fabric_description)
			{
				  echo "<th width='50'>Fab. Qty</th><th width='50' >Rate</th><th width='50' >Amount</th>";
			}
			?>

		   </tr>
		   <?

			  /*$gmt_color_library=return_library_array( "select gmts_color_id,contrast_color_id
			  FROM
			  wo_pre_cos_fab_co_color_dtls
			  WHERE
			  job_no ='$job_no'", "contrast_color_id", "gmts_color_id");*/

			  $gmt_color_library=array();
			  $gmt_color_data=sql_select("select b.gmts_color_id, b.contrast_color_id
			  FROM
			  wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b
			  WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.fabric_source =$cbo_fabric_source and
			  a.job_no ='$txt_job_no'");
			  foreach( $gmt_color_data as $gmt_color_row)
			  {
				//$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
				$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
			  }

				$grand_total_fin_fab_qnty=0;
				$grand_total_amount=0;
				//$grand_totalcons_per_finish=0;
				//$grand_totalcons_per_grey=0;
				$color_wise_wo_sql=sql_select("select fabric_color_id
											  FROM
											  wo_booking_dtls
											  WHERE
											  booking_no =$txt_booking_no and
											  status_active=1 and
											  is_deleted=0
											  group by fabric_color_id");
			foreach($color_wise_wo_sql as $color_wise_wo_result)
			{
			?>
				<tr>
			   <!-- <td  width="120" align="left">
				<?

				//echo $color_library[$color_wise_wo_result['fabric_color_id']];

				?></td>-->
				<td  width="120" align="left">
				<?
				echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];


				?>
				</td>
				<td>
				<?
				//echo $color_library[$gmt_color_library[$color_wise_wo_result['fabric_color_id']]];
				//echo rtrim($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]],",");
				echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
				?>
				</td>
				<td  width="120" align="left">
				<?
				$lapdip_no="";
				$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$txt_job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
				//echo "lapdip_no from wo_po_lapdip_approval_info where job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result['fabric_color_id']."";
				if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
				?>
				</td>
				<?
				$total_fin_fab_qnty=0;
				$total_amount=0;

				foreach($nameArray_fabric_description as $result_fabric_description)
				{
					/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
					  FROM
					  view_wo_fabric_booking_data_park a,
					  wo_booking_dtls b
					  WHERE
					  b.booking_no =$txt_booking_no  and
					  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
					  a.po_break_down_id=b.po_break_down_id and
					  a.color_size_table_id=b.color_size_table_id and
					  a.color_type_id='".$result_fabric_description['color_type_id']."' and
					  a.construction='".$result_fabric_description['construction']."' and
					  a.composition='".$result_fabric_description['composition']."' and
					  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
					  a.dia_width='".$result_fabric_description['dia_width']."' and
					  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
					  b.fabric_color_id=".$color_wise_wo_result['fabric_color_id']." and
					  b.status_active=1 and
					  b.is_deleted=0");*/
					if($result_fabric_description[csf('gsm_weight')]!="") $gsm_cond=" a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and  "; else $gsm_cond="";
					if($db_type==0)
					{
					$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty, avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
					WHERE a.job_no=b.job_no and
					a.id=b.pre_cost_fabric_cost_dtls_id and
					c.job_no_mst=a.job_no and
					c.id=b.color_size_table_id and
					b.po_break_down_id=d.po_break_down_id and
					b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
					d.booking_no =$txt_booking_no and
					a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
					a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
					a.construction='".$result_fabric_description[csf('construction')]."' and
					a.composition='".$result_fabric_description[csf('composition')]."' and
					$gsm_cond
					b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
					d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
					d.status_active=1 and
					d.is_deleted=0  and
					c.status_active=1 and
					c.is_deleted=0 ");
					}
					if($db_type==2)
					{


					$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty, sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
					WHERE a.job_no=b.job_no and
					a.id=b.pre_cost_fabric_cost_dtls_id and
					c.job_no_mst=a.job_no and
					c.id=b.color_size_table_id and
					b.po_break_down_id=d.po_break_down_id and
					b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
					d.booking_no =$txt_booking_no and
					a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
					a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
					a.construction='".$result_fabric_description[csf('construction')]."' and
					a.composition='".$result_fabric_description[csf('composition')]."' and
					$gsm_cond
					b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
					nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
					d.status_active=1 and
					d.is_deleted=0 and
					c.status_active=1 and
					c.is_deleted=0 ");
					}



					list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
				?>
				<td width='50' align='right'>
				<?
				if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
				{
				echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],0) ;
				$total_fin_fab_qnty+=number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],0,'.','');
				}
				?>
				</td>
				<td width='50' align='right' >
				<?
				if($color_wise_wo_result_qnty[csf('rate')]!="")
				{
				echo number_format($color_wise_wo_result_qnty[csf('rate')],4);
				//$total_grey_fab_qnty+=$color_wise_wo_result_qnty['grey_fab_qnty'];
				}
				?>
				</td>
				<td width='50' align='right' >
				<?
				$amount=$color_wise_wo_result_qnty[csf('grey_fab_qnty')]*$color_wise_wo_result_qnty[csf('rate')];
				if($amount!="")
				{
				echo number_format($amount,0);
				$total_amount+=$amount;
				}
				?>
				</td>
				<?
				}
				?>
				<td align="right"><? echo number_format($total_fin_fab_qnty,0); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
				<td align="right"><? echo number_format($total_amount/$total_fin_fab_qnty,0); $grand_total_amount+=$total_amount;?></td>
				<td align="right">
				<?
				echo number_format($total_amount,0);

				?>
				</td>
				</tr>
			 <?
			}
			?>
			<tr style=" font-weight:bold">
			<!--<td  width="120" align="left">&nbsp;</td>-->
			<th  width="120" align="left">&nbsp;</th>
			<td  width="120" align="left">&nbsp;</td>
			<td  width="120" align="left"><strong>Total</strong></td>
			<?
				foreach($nameArray_fabric_description as $result_fabric_description)
				{
					/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
													  FROM
													  view_wo_fabric_booking_data_park a,

													  wo_booking_dtls b
													  WHERE
													  b.booking_no =$txt_booking_no  and
													  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
													  a.po_break_down_id=b.po_break_down_id and
													  a.color_size_table_id=b.color_size_table_id and
													  a.color_type_id='".$result_fabric_description['color_type_id']."' and
													  a.construction='".$result_fabric_description['construction']."' and
													  a.composition='".$result_fabric_description['composition']."' and
													  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
													  a.dia_width='".$result_fabric_description['dia_width']."' and
													  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
													  b.status_active=1 and
													  b.is_deleted=0
													  ");*/
					$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
													WHERE a.job_no=b.job_no and
													a.id=b.pre_cost_fabric_cost_dtls_id and
													c.job_no_mst=a.job_no and
													c.id=b.color_size_table_id and
													b.po_break_down_id=d.po_break_down_id and
													b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
													d.booking_no =$txt_booking_no and
													a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
													a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
													a.construction='".$result_fabric_description[csf('construction')]."' and
													a.composition='".$result_fabric_description[csf('composition')]."' and
													a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
													b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
													d.status_active=1 and
													d.is_deleted=0  and
													c.status_active=1 and
													c.is_deleted=0  ");
					list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
				?>
				<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2) ;?></td>
				<td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
				<td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
				<?
				}
				?>
				<td align="right"><? echo number_format($grand_total_fin_fab_qnty,2);?></td>
				<td align="right"><? echo number_format($grand_total_amount/$grand_total_fin_fab_qnty,2);?></td>
				<td align="right">
				<?
				echo number_format($grand_total_amount,2);
				?>
				</td>
				</tr>
				<tr style="font-weight:bold">
			<!--<td  width="120" align="left">&nbsp;</td>-->
			<th  width="120" align="left">&nbsp;</th>
			<td  width="120" align="left">&nbsp;</td>
			<td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
			<?
				foreach($nameArray_fabric_description as $result_fabric_description)
				{
					/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
													  FROM
													  view_wo_fabric_booking_data_park a,
													  wo_booking_dtls b
													  WHERE
													  b.booking_no =$txt_booking_no  and
													  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
													  a.po_break_down_id=b.po_break_down_id and
													  a.color_size_table_id=b.color_size_table_id and
													  a.color_type_id='".$result_fabric_description['color_type_id']."' and
													  a.construction='".$result_fabric_description['construction']."' and
													  a.composition='".$result_fabric_description['composition']."' and
													  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
													  a.dia_width='".$result_fabric_description['dia_width']."' and
													  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
													  b.status_active=1 and
													  b.is_deleted=0
													  ");*/
					$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
													WHERE a.job_no=b.job_no and
													a.id=b.pre_cost_fabric_cost_dtls_id and
													c.job_no_mst=a.job_no and
													c.id=b.color_size_table_id and
													b.po_break_down_id=d.po_break_down_id and
													b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
													d.booking_no =$txt_booking_no and
													a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
													a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
													a.construction='".$result_fabric_description[csf('construction')]."' and
													a.composition='".$result_fabric_description[csf('composition')]."' and
													a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
													b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
													d.status_active=1 and
													d.is_deleted=0  and
													c.status_active=1 and
													c.is_deleted=0  ");
					list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

				?>
				<td width='50' align='right'><?  //echo number_format(($color_wise_wo_result_qnty['fin_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td>
				<td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
				<td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
				<?
				}
				?>
				<td align="right">
				<?
				$consumption_per_unit_fab=($grand_total_fin_fab_qnty/$po_qnty_tot1)*($total_set_qnty*$costing_per_qnty);
				echo number_format($consumption_per_unit_fab,4);
				//$grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4)
				?>
				</td>
				<td align="right">
				<?
				$consumption_per_unit_amuont=($grand_total_amount/$po_qnty_tot1)*($total_set_qnty*$costing_per_qnty);
				//echo number_format(($consumption_per_unit_amuont/$consumption_per_unit_fab),2);
				//$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4)
				?>
				</td>
				<td align="right">
				<?
				//echo number_format($consumption_per_unit_amuont,2);
				?>
				</td>
				</tr>
		</table>
		<?
		}
		?>
        <br/>
        <?
		if($cbo_fabric_source==1)
		{
			$size_total_arr=array();
		?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
        <tr>
        <?
		$colar_percent_size_wise_array=array();
		$colar_percent_size_wise_sql=sql_select( "select a.colar_cuff_per,b.color_number_id,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id    and a.booking_no=$txt_booking_no and a.booking_type=1 and c.body_part_id in(2) and a.status_active=1 and a.is_deleted=0");
		$colar_excess_percent_arr=array();
		foreach($colar_percent_size_wise_sql as $colar_percent_size_wise_row)
		{
			$colar_percent_size_wise_array[$colar_percent_size_wise_row[csf('color_number_id')]][$colar_percent_size_wise_row[csf('gmts_sizes')]]=$colar_percent_size_wise_row[csf('colar_cuff_per')];
			//$colar_excess_percent_arr[$colar_percent_size_wise_row[csf('gmts_sizes')]]+=$colar_percent_size_wise_row[csf('colar_cuff_per')];

		}


		//print_r($colar_percent_size_wise_array);

		$nameArray_item_size=sql_select( "select min(c.id) as id,b.item_size,c.size_number_id, min(c.size_order) as sizeorder FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id  and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by sizeorder");
		if(count($nameArray_item_size)>0)
		{
        ?>
        <td width="49%">
        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
        <tr>
        <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Collar -  Colour Size Brakedown in Pcs</b></td>
        </tr>
        <tr>
        <td width="70">Size</td>

        <?

		/*$nameArray_item_size=sql_select( "select b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by c.size_number_id,b.item_size order by c.size_number_id");*/
		foreach($nameArray_item_size  as $result_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
		<?
        }
        ?>
        <td rowspan="2" align="center"><strong>Total</strong></td>
        <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
        </tr>
        <tr>
        <td>Collar Size</td>

        <?
        foreach($nameArray_item_size  as $result_item_size)
		{
			?>
			<td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
			<?
        }
		$color_wise_wo_sql=sql_select("select a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id,sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 and c.status_active=1 and c.is_deleted=0 group by c.color_number_id,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method order by a.id
");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
			$color_total_collar=0;
			$color_total_collar_order_qnty=0;
			$process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
			$constrast_color_arr=array();
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				$constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
				for($i=0;$i<count($constrast_color);$i++)
				{
					$constrast_color2=explode('_',$constrast_color[$i]);
					$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
				}
			}
		?>
			<tr>
            <td>
            <?
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]) ;
				$lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
			}
			else
			{
				echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
				$lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
			}
			?>

            </td>
            <?
            foreach($nameArray_item_size  as $result_size)
			{
				?>
				<td align="center" style="border:1px solid black">
				<?
				//$color_wise_wo_sql_qnty=sql_select("select c.color_number_id,sum(c.order_quantity) as order_quantity, sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 and c.color_number_id='".$color_wise_wo_result['color_number_id']."' and c.size_number_id='".$result_size['size_number_id']."'");

				//$color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0 ");
				$color_wise_wo_sql_qnty=sql_select( "select sum(a.plan_cut_qnty) as plan_cut_qnty, sum(a.order_quantity) as order_quantity  from wo_po_color_size_breakdown a, wo_pre_cost_fabric_cost_dtls b,wo_pre_cos_fab_co_avg_con_dtls c where a.job_no_mst=b.job_no and a.job_no_mst=c.job_no and a.item_number_id=b.item_number_id and b.id=c.pre_cost_fabric_cost_dtls_id and a.id=c.color_size_table_id and  a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  a.size_number_id =".$result_size[csf('size_number_id')]." and a.color_number_id =".$color_wise_wo_result[csf('color_number_id')]." and c.item_size= '".$result_size[csf('item_size')]."'  and  a.status_active=1 and a.is_deleted =0 ");


				list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
				$plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
				$colar_excess_per=($plan_cut*$colar_percent_size_wise_array[$color_wise_wo_result[csf('color_number_id')]][$result_size[csf('size_number_id')]])/100;
				echo number_format($plan_cut+$colar_excess_per,0);
				$size_total_arr[$result_size[csf('size_number_id')]]+=number_format($plan_cut+$colar_excess_per,0,'','');
				$color_total_collar+=$plan_cut+$colar_excess_per;
				$color_total_collar_order_qnty+=$plan_cut;
				$grand_total_collar+=$plan_cut+$colar_excess_per;
				$grand_total_collar_order_qnty+=$plan_cut;
				?>
                </td>
				<?
			}
			?>

            <td align="center"><? echo number_format($color_total_collar,0); ?></td>
            <td align="center"><? echo number_format(((number_format($color_total_collar,0,'','')-$color_total_collar_order_qnty)/$color_total_collar_order_qnty)*100,2); ?></td>
            </tr>
            <?
		    }
			?>

            <tr>
                <td>Size Total</td>

                <?
                foreach($nameArray_item_size  as $result_size)
                {
                ?>
                <td style="border:1px solid black;  text-align:center">
				<?
				//$colar_excess_pers=($size_tatal[$result_size[csf('size_number_id')]]*$colar_excess_percent)/100;
				echo number_format($size_total_arr[$result_size[csf('size_number_id')]],0);
				?>
                </td>
                <?
                }
                ?>
                <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_collar,0); ?></td>
                <td align="center" style="border:1px solid black"> <? echo number_format(((number_format($grand_total_collar,0,'','')-$grand_total_collar_order_qnty)/$grand_total_collar_order_qnty)*100,2); ?></td>
            </tr>
        </table>
        </td>
        <td width="2%">
        </td>
        <?
        }
		?>

        <?
		$cuff_percent_size_wise_array=$cuff_size_total=array();
		$cuff_percent_size_wise_sql=sql_select( "select a.colar_cuff_per,b.color_number_id,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id  and a.booking_no=$txt_booking_no and a.booking_type=1 and c.body_part_id in(3) and a.status_active=1 and a.is_deleted=0");
		foreach($cuff_percent_size_wise_sql as $cuff_percent_size_wise_row)
		{
			$cuff_percent_size_wise_array[$cuff_percent_size_wise_row[csf('color_number_id')]][$cuff_percent_size_wise_row[csf('gmts_sizes')]]=$cuff_percent_size_wise_row[csf('colar_cuff_per')];
		}

		//print_r($cuff_percent_size_wise_array);
		$nameArray_item_size=sql_select( "select min(c.id) as id, b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=3  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by id");

		if(count($nameArray_item_size)>0)
		{
        ?>
        <td width="49%">
        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
        <tr>
        <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Cuff -  Colour Size Brakedown in Pcs</b></td>
        </tr>
        <tr>
        <td width="70">Size</td>

        <?
		foreach($nameArray_item_size  as $result_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
		<?
        }
        ?>
        <td rowspan="2" align="center"><strong>Total</strong></td>
        <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
        </tr>
        <tr>
        <td>Cuff Size</td>

        <?
        foreach($nameArray_item_size  as $result_item_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
		<?
        }
        ?>
         <?

			$color_wise_wo_sql=sql_select("select a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id,sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=3  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and  d.status_active=1 and d.is_deleted=0 group by c.color_number_id ,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method order by a.id
");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
			$color_total_cuff=0;
			$color_total_cuff_order_qnty=0;
			$process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
			$constrast_color_arr=array();
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				$constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
				for($i=0;$i<count($constrast_color);$i++)
				{
					$constrast_color2=explode('_',$constrast_color[$i]);
					$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
				}
			}
		?>
			<tr>
            <td>
            <?
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]) ;
				$lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
			}
			else
			{
				echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
				$lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
			}
			?>

            </td>
            <?
            foreach($nameArray_item_size  as $result_size)
			{
				?>
				<td align="center" style="border:1px solid black">

				<?
				/*$color_wise_wo_sql_qnty=sql_select("select c.color_number_id,sum(c.order_quantity) as order_quantity, sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=3 and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 and c.color_number_id='".$color_wise_wo_result['color_number_id']."' and c.size_number_id='".$result_size['size_number_id']."'");*/


				//$color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0");

				$color_wise_wo_sql_qnty=sql_select( "select sum(a.plan_cut_qnty) as plan_cut_qnty, sum(a.order_quantity) as order_quantity  from wo_po_color_size_breakdown a, wo_pre_cost_fabric_cost_dtls b,wo_pre_cos_fab_co_avg_con_dtls c where a.job_no_mst=b.job_no and a.job_no_mst=c.job_no and a.item_number_id=b.item_number_id and b.id=c.pre_cost_fabric_cost_dtls_id and a.id=c.color_size_table_id and  a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  a.size_number_id =".$result_size[csf('size_number_id')]." and a.color_number_id =".$color_wise_wo_result[csf('color_number_id')]." and c.item_size= '".$result_size[csf('item_size')]."'  and  a.status_active=1 and a.is_deleted =0 ");


				list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
				$plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
				$cuff_excess_per=(($plan_cut*2)*$cuff_percent_size_wise_array[$color_wise_wo_result[csf('color_number_id')]][$result_size[csf('size_number_id')]])/100;
				echo number_format($plan_cut*2+$cuff_excess_per,0);
				$cuff_size_total[$result_size[csf('size_number_id')]]+=number_format($plan_cut*2+$cuff_excess_per,0,'','');
				//echo $cuff_percent_size_wise_array[$color_wise_wo_result[csf('color_number_id')]][$result_size[csf('size_number_id')]];
				$color_total_cuff+=$plan_cut*2+$cuff_excess_per;
				$color_total_cuff_order_qnty+=$plan_cut*2;
				$grand_total_cuff+=$plan_cut*2+$cuff_excess_per;
				$grand_total_cuff_order_qnty+=$plan_cut*2;

				/*$cuff_excess_per=(($plan_cut_qnty[csf('plan_cut_qnty')]*2)*$cuff_excess_percent)/100;
				echo number_format($plan_cut_qnty[csf('plan_cut_qnty')]*2+$cuff_excess_per,0);
				$color_total_cuff+=$plan_cut_qnty[csf('plan_cut_qnty')]*2+$cuff_excess_per;
				$color_total_cuff_order_qnty+=$plan_cut_qnty[csf('order_quantity')]*2;
				$grand_total_cuff+=$plan_cut_qnty[csf('plan_cut_qnty')]*2+$cuff_excess_per;
				$grand_total_cuff_order_qnty+=$plan_cut_qnty[csf('order_quantity')]*2;*/

				?>

                </td>
				<?
			}
			?>

            <td align="center"><? echo number_format($color_total_cuff,0); ?></td>
            <td align="center"><? echo number_format(((number_format($color_total_cuff,0,'','')-$color_total_cuff_order_qnty)/$color_total_cuff_order_qnty)*100,2); ?></td>
            </tr>
            <?
		    }
			?>
            <tr>
                <td>Size Total</td>

                <?
                foreach($nameArray_item_size  as $result_size)
                {
                   /* $nameArray_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =$result_size[size_number_id]  and status_active=1 and is_deleted =0 order by id");
                foreach($nameArray_size_qnty as $result_size_qnty)
                {*/
                ?>
                <td style="border:1px solid black;  text-align:center">
				<?
				//$cuff_excess_pers=(($size_tatal[$result_size[csf('size_number_id')]]*2)*$cuff_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]*2+$cuff_excess_pers,0);
				//echo $size_tatal[$result_size[csf('size_number_id')]];
				echo number_format($cuff_size_total[$result_size[csf('size_number_id')]],0);
				?></td>
                <?
                //}
                }
                ?>
                <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_cuff,0); ?></td>
                <td align="center" style="border:1px solid black"> <? echo number_format(((number_format($grand_total_cuff,0,'','')-$grand_total_cuff_order_qnty)/$grand_total_cuff_order_qnty)*100,2); ?></td>
            </tr>
        </table>
        </td>
        <?
				}
		?>
        </tr>

        <tr>
        <?
		$placket_percent_size_wise_sql=sql_select( "select a.colar_cuff_per,b.color_number_id,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id    and a.booking_no=$txt_booking_no and a.booking_type=1 and c.body_part_id in(40) and a.status_active=1 and a.is_deleted=0");
		$placket_percent_size_wise_array=array();
		foreach($placket_percent_size_wise_sql as $placket_percent_size_wise_row)
		{
			$placket_percent_size_wise_array[$placket_percent_size_wise_row[csf('color_number_id')]][$placket_percent_size_wise_row[csf('gmts_sizes')]]=$placket_percent_size_wise_row[csf('colar_cuff_per')];

		}


		//print_r($colar_percent_size_wise_array);

		$nameArray_item_size=sql_select( "select min(c.id) as id,b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=40  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id  and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by id");
		if(count($nameArray_item_size)>0)
		{
        ?>
        <td width="49%">
        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
        <tr>
        <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Placket - Colour Size Brakedown in Pcs</b></td>
        </tr>
        <tr>
        <td width="70">Size</td>
        <?
		/*$nameArray_item_size=sql_select( "select b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by c.size_number_id,b.item_size order by c.size_number_id");*/
		foreach($nameArray_item_size  as $result_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
		<?
        }
        ?>
        <td rowspan="2" align="center"><strong>Total</strong></td>
        <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
        </tr>
        <tr>
        <td>Placket Size</td>

        <?
        foreach($nameArray_item_size  as $result_item_size)
		{
			?>
			<td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
			<?
        }
		$color_wise_wo_sql=sql_select("select a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id,sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=40  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 and c.status_active=1 and c.is_deleted=0 group by c.color_number_id,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method order by a.id
");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
			$color_total_placket=0;
			$color_total_placket_order_qnty=0;
			$process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
			$constrast_color_arr=array();
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				$constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
				for($i=0;$i<count($constrast_color);$i++)
				{
					$constrast_color2=explode('_',$constrast_color[$i]);
					$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
				}
			}
		?>
			<tr>
            <td>
            <?
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]) ;
				$lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
			}
			else
			{
				echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
				$lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
			}
			?>

            </td>
            <?
            foreach($nameArray_item_size  as $result_size)
			{
				?>
				<td align="center" style="border:1px solid black">
				<?
				$color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0 ");

				list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
				$plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
				$plcket_excess_per=($plan_cut*$placket_percent_size_wise_array[$color_wise_wo_result[csf('color_number_id')]][$result_size[csf('size_number_id')]])/100;
				echo number_format($plan_cut+$plcket_excess_per,0);
				$size_total_arr[$result_size[csf('size_number_id')]]+=number_format($plan_cut+$plcket_excess_per,0,'','');
				$color_total_placket+=$plan_cut+$plcket_excess_per;
				$color_total_placket_order_qnty+=$plan_cut;
				$grand_total_placket+=$plan_cut+$plcket_excess_per;
				$grand_total_placket_order_qnty+=$plan_cut;
				?>
                </td>
				<?
			}
			?>

            <td align="center"><? echo number_format($color_total_placket,0); ?></td>
            <td align="center"><? echo number_format(((number_format($color_total_placket,0,'','')-$color_total_placket_order_qnty)/$color_total_placket_order_qnty)*100,2); ?></td>
            </tr>
            <?
		    }
			?>

            <tr>
                <td>Size Total</td>

                <?
                foreach($nameArray_item_size  as $result_size)
                {
                ?>
                <td style="border:1px solid black;  text-align:center">
				<?
				//$colar_excess_pers=($size_tatal[$result_size[csf('size_number_id')]]*$colar_excess_percent)/100;
				echo number_format($size_total_arr[$result_size[csf('size_number_id')]],0);
				?>
                </td>
                <?
                }
                ?>
                <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_placket,0); ?></td>
                <td align="center" style="border:1px solid black"> <? echo number_format(((number_format($grand_total_placket,0,'','')-$grand_total_placket_order_qnty)/$grand_total_placket_order_qnty)*100,2); ?></td>
            </tr>
        </table>
        </td>
        <td width="2%"></td>
        <?
        }
		?>
        </tr>

        </table>
        <?
		$yarn_count_arr=return_library_array( "select id,yarn_count from lib_yarn_count",'id','yarn_count');
		//$yarn_sql_array=sql_select("SELECT min(id) as id ,count_id, copm_one_id, percent_one,copm_two_id, percent_two,color, type_id, sum(cons_qnty) as yarn_required, AVG(rate) as rate, supplier_id from wo_pre_cost_fab_yarn_cost_dtls where job_no='$txt_job_no' and  status_active=1 and is_deleted=0 group by count_id,copm_one_id,percent_one, copm_two_id,percent_two,color,type_id, supplier_id order by id");

		//$yarn_sql_array=sql_select("SELECT min(a.id) as id ,a.count_id, a.copm_one_id, a.percent_one,a.copm_two_id, a.percent_two,a.color, a.type_id, sum(a.cons_qnty) as yarn_required, AVG(a.rate) as rate from wo_pre_cost_fab_yarn_cost_dtls a, wo_booking_dtls b where a.job_no=b.job_no and a.fabric_cost_dtls_id=b. pre_cost_fabric_cost_dtls_id and a.job_no='$txt_job_no' and  a.status_active=1 and a.is_deleted=0 group by a.count_id,a.copm_one_id,a.percent_one,a.copm_two_id, a.percent_two,a.color,a.type_id order by id");
		$yarn_sql_array=sql_select("SELECT min(a.id) as id, a.count_id, a.copm_one_id, a.percent_one, a.copm_two_id, a.percent_two, a.color, a.type_id, sum(distinct a.cons_qnty) as yarn_required, AVG(a.rate) as rate, a.supplier_id from wo_pre_cost_fab_yarn_cost_dtls a, wo_booking_dtls b where a.job_no=b.job_no and a.fabric_cost_dtls_id=b. pre_cost_fabric_cost_dtls_id and a.job_no='$txt_job_no' and b.booking_no =$txt_booking_no  and  a.status_active=1 and a.is_deleted=0  and  b.status_active=1 and b.is_deleted=0 group by a.count_id,a.copm_one_id,a.percent_one,a.copm_two_id, a.percent_two,a.color,a.type_id, a.supplier_id order by id");



		?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
            <tr>
	            <td width="49%" style="border:solid; border-color:#000; border-width:thin" valign="top">
                    <table  width="100%"  border="0" cellpadding="0" cellspacing="0">
                	<thead>
                    	<tr>
                        	<th width="3%"></th><th width="97%" align="left"><u>Special Instruction</u></th>
                        </tr>
                    </thead>
                    <tbody>
                    <?
					$data_array=sql_select("select id, terms from  wo_booking_terms_condition where booking_no=$txt_booking_no");// quotation_id='$data'
					if ( count($data_array)>0)
					{
						$i=0;
						foreach( $data_array as $row )
						{
							$i++;
							?>
                            <tr id="settr_1" valign="top">
                                <td style="vertical-align:top">
                                <? echo $i;?>
                                </td>
                                <td>
                               <strong style="font-size:20px"> <? echo $row[csf('terms')]; ?></strong>
                                </td>
                            </tr>
                            <?
						}
					}
					/*else
					{
				    $i=0;
					$data_array=sql_select("select id, terms from  lib_terms_condition");// quotation_id='$data'
					foreach( $data_array as $row )
						{
							$i++;
					?>
                    <tr id="settr_1" align="">
                                    <td valign="top">
                                    <? echo $i;?>
                                    </td>
                                    <td>
                                    <? echo $row['terms']; ?>
                                    </td>

                                </tr>
                    <?
						}
					} */
					?>
                </tbody>
                </table>
                </td>
                 <td width="2%">
                </td>
                <td width="49%" valign="top">
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                        <td colspan="7"><b>Yarn Required Summary (Pre Cost)</b></td>

                        </tr>
                        <tr align="center">
                        <td>Sl</td>
                        <td>Yarn Description</td>
                        <td>Supplier</td>
                        <?
                        if($show_yarn_rate==1)
                        {
							?>
							<td>Rate</td>
							<?
                        }
                        ?>
                        <td>Cons for <? echo $costing_per; ?> Gmts</td>
                    </tr>
                    <?
					$i=0;
					$total_yarn=0;
					foreach($yarn_sql_array  as $row)
                    {

						$i++;
					?>
                    <tr align="center">
                        <td><? echo $i; ?></td>
                        <td>
                        <?
                        $yarn_des=$yarn_count_arr[$row[csf('count_id')]]." ".$composition[$row[csf('copm_one_id')]]." ".$row[csf('percent_one')]."%  ";
                        if($row['copm_two_id'] !=0)
                        {
                            $yarn_des.=$composition[$row[csf('copm_two_id')]]." ".$row[csf('percent_two')]."%";
                        }
						$yarn_des.=$color_library[$row[csf('color')]]." ";
                        $yarn_des.=$yarn_type[$row[csf('type_id')]];
                        //echo $yarn_count_arr[$row['count_id']]." ".$composition[$row['copm_one_id']]." ".$row['percent_one']."%  ".$composition[$row['copm_two_id']]." ".$row['percent_two']."%  ".$yarn_type[$row['type_id']];
                        echo $yarn_des;
                        ?>
                        </td>
                        <td><? echo $supplier_name_arr[$row[csf('supplier_id')]] ;?></td>
                        <?
                        if($show_yarn_rate==1)
                        {
                        ?>
                         <td><? echo number_format($row[csf('rate')],4); ?></td>
                         <?
                        }
                         ?>
                        <td><? echo number_format($row[csf('yarn_required')],4); ?></td>
                    </tr>
                    <?
					}
					?>
                    <tr align="center">
                        <td>Total</td>
                        <td></td>
                        <td></td>
                        <?
                        if($show_yarn_rate==1)
                        {
							?>
							<td></td>
							<?
                        }
                        ?>
                        <td></td>
                    </tr>
                    </table>
                </td>

               <!-- <td width="49%" valign="top" align="center"> -->
                <?
				/*
				$yarn_sql_array=sql_select("SELECT min(a.id) as id, a.item_id, sum(a.qnty) as qnty ,min(b.supplier_id) as supplier_id,min(b.lot) as lot from inv_material_allocation_dtls a,product_details_master b where a.item_id=b.id and a.booking_no=$txt_booking_no and  a.status_active=1 and a.is_deleted=0 group by a.item_id order by a.id");
				if(count($yarn_sql_array)>0)
				{
				?>
                   <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td colspan="7"><b>Allocated Yarn</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Yarn Description</td>
                    <td>Brand</td>
                    <td>Lot</td>


                    <td>Allocated Qty (Kg)</td>
                    </tr>
                    <?
					$total_allo=0;
					$item=return_library_array( "select id, product_name_details from   product_details_master",'id','product_name_details');
					$supplier=return_library_array( "select id, short_name from   lib_supplier",'id','short_name');
					//$yarn_sql_array=sql_select("SELECT a.item_id, a.qnty,b.supplier_id,b.lot from inv_material_allocation_dtls a,product_details_master b where a.item_id=b.id and a.booking_no=$txt_booking_no and  a.status_active=1 and a.is_deleted=0");
					$i=0;
					$total_yarn=0;
					foreach($yarn_sql_array  as $row)
                    {

						$i++;
					?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
					<?

					echo $item[$row[csf('item_id')]];
					?>
                    </td>
                    <td>
                    <?

					echo $supplier[$row[csf('supplier_id')]];
					?>
                    </td>
                    <td>
					<?

					echo $row[csf('lot')];
					?>
                    </td>
                    <td align="right"><? echo number_format($row[csf('qnty')],4); $total_allo+= $row[csf('qnty')];?></td>
                    </tr>
                    <?
					}
					?>
                    <tr align="center">
                    <td>Total</td>
                    <td></td>


                    <td></td>
                    <td></td>
                    <td align="right"><? echo number_format($total_allo,4); ?></td>
                    </tr>
                    </table>
                    <?
				}
				else
				{
					$is_yarn_allocated=return_field_value("allocation", "variable_settings_inventory", "company_name=$cbo_company_name and variable_list=18 and item_category_id=1");
					if($is_yarn_allocated==1)
					{
					?>
					<font style=" font-size:30px"><b> Draft</b></font>
                    <?
					}
					else
					{
						echo "";
					}
				}
				*/
					?>
              <!--  </td> -->
            </tr>
        </table>
        <br/>
        <?


		}// fabric Source End
		if($cbo_fabric_source==1 || $cbo_fabric_source==2)
		{
			?>
            <table  width="100%"  border="0" cellpadding="0" cellspacing="0">
            <tr>
            	 <td width="49%" valign="top">
	            </td>
               <!-- <td width="49%" valign="top">
                </td>-->
                <td width="2%">
                </td>
	            <td width="49%" style="border:solid; border-color:#000; border-width:thin; float:left;" valign="top">
                 <table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                        <tr align="center">
                        	<td style="width:800px;" colspan="10"><b>Picture</b></td>
                        </tr>
                        <tr align="center">
                            <td colspan="10">
                            <?
							$nameArray_imge =sql_select("SELECT image_location FROM common_photo_library where master_tble_id='$txt_job_no' and file_type=1");
							foreach($nameArray_imge as $result_imge)
							{
								?>
                                <img  src='../../<? echo $result_imge[csf('image_location')]; ?>' height='60px' width='80px' border="2" />
								<?
							}
							?>
							</tr>
							</table>
							</fieldset>
							</div>
                            </td>
                        </tr>
                    </table>
                </td>

            </tr>
        </table>
        <br>
        <?
        //------------------------------ Query for TNA start-----------------------------------
				$po_id_all=str_replace("'","",$txt_order_no_id);
				$po_num_arr=return_library_array("select id,po_number from wo_po_break_down where id in($po_id_all)",'id','po_number');
				$tna_start_sql=sql_select( "select id,po_number_id,
								(case when task_number=31 then task_start_date else null end) as fab_booking_start_date,
								(case when task_number=31 then task_finish_date else null end) as fab_booking_end_date,
								(case when task_number=60 then task_start_date else null end) as knitting_start_date,
								(case when task_number=60 then task_finish_date else null end) as knitting_end_date,
								(case when task_number=61 then task_start_date else null end) as dying_start_date,
								(case when task_number=61 then task_finish_date else null end) as dying_end_date,
								(case when task_number=73 then task_start_date else null end) as finishing_start_date,
								(case when task_number=73 then task_finish_date else null end) as finishing_end_date,
								(case when task_number=84 then task_start_date else null end) as cutting_start_date,
								(case when task_number=84 then task_finish_date else null end) as cutting_end_date,
								(case when task_number=86 then task_start_date else null end) as sewing_start_date,
								(case when task_number=86 then task_finish_date else null end) as sewing_end_date,
								(case when task_number=110 then task_start_date else null end) as exfact_start_date,
								(case when task_number=110 then task_finish_date else null end) as exfact_end_date,
								(case when task_number=47 then task_start_date else null end) as yarn_rec_start_date,
								(case when task_number=47 then task_finish_date else null end) as yarn_rec_end_date
								from tna_process_mst
								where status_active=1 and po_number_id in($po_id_all)");
				$tna_fab_start=$tna_knit_start=$tna_dyeing_start=$tna_fin_start=$tna_cut_start=$tna_sewin_start=$tna_exfact_start="";
				$tna_date_task_arr=array();
				foreach($tna_start_sql as $row)
				{
					if($row[csf("fab_booking_start_date")]!="" && $row[csf("fab_booking_start_date")]!="0000-00-00")
					{
						if($tna_fab_start=="")
						{
							$tna_fab_start=$row[csf("fab_booking_start_date")];
						}
					}


					if($row[csf("knitting_start_date")]!="" && $row[csf("knitting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_start_date']=$row[csf("knitting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_end_date']=$row[csf("knitting_end_date")];
					}
					if($row[csf("dying_start_date")]!="" && $row[csf("dying_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['dying_start_date']=$row[csf("dying_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['dying_end_date']=$row[csf("dying_end_date")];
					}
					if($row[csf("finishing_start_date")]!="" && $row[csf("finishing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_start_date']=$row[csf("finishing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_end_date']=$row[csf("finishing_end_date")];
					}
					if($row[csf("cutting_start_date")]!="" && $row[csf("cutting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_start_date']=$row[csf("cutting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_end_date']=$row[csf("cutting_end_date")];
					}
					if($row[csf("sewing_start_date")]!="" && $row[csf("sewing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_start_date']=$row[csf("sewing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_end_date']=$row[csf("sewing_end_date")];
					}
					if($row[csf("exfact_start_date")]!="" && $row[csf("exfact_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_start_date']=$row[csf("exfact_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_end_date']=$row[csf("exfact_end_date")];
					}
					if($row[csf("yarn_rec_start_date")]!="" && $row[csf("yarn_rec_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_start_date']=$row[csf("yarn_rec_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_end_date']=$row[csf("yarn_rec_end_date")];
					}
				}

	//------------------------------ Query for TNA end-----------------------------------
		?>
        <fieldset id="div_size_color_matrix" style="max-width:1000;">
        <legend>TNA Information</legend>
        <!--<span style="font-size:180; font-weight:bold;"></span>-->
        <table width="100%" style="border:1px solid black;font-size:12px" border="1" cellpadding="2" cellspacing="0" rules="all">
            <tr>
            	<td rowspan="2" align="center" valign="top">SL</td>
            	<td width="180" rowspan="2"  align="center" valign="top"><b>Order No</b></td>
                <td colspan="2" align="center" valign="top"><b>Yarn Receive</b></td>
                <td colspan="2" align="center" valign="top"><b>Knitting</b></td>
                <td colspan="2" align="center" valign="top"><b>Dyeing</b></td>
                <td colspan="2" align="center" valign="top"><b>Finishing Fabric</b></td>
                <td colspan="2" align="center" valign="top"><b>Cutting </b></td>
                <td colspan="2" align="center" valign="top"><b>Sewing </b></td>
                <td colspan="2"  align="center" valign="top"><b>Ex-factory </b></td>
            </tr>
            <tr>
            	<td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>

            </tr>
            <?
			$i=1;
			foreach($tna_date_task_arr as $order_id=>$row)
			{
				 //$tna_date_task_arr//knitting_start_date dying_start_date finishing_start_date cutting_start_date sewing_start_date exfact_start_date
				?>
                <tr>
                	<td><? echo $i; ?></td>
                    <td><? echo $po_num_arr[$order_id]; ?></td>
                	<td align="center"><? echo change_date_format($row['yarn_rec_start_date']); ?></td>
                    <td  align="center"><? echo change_date_format($row['yarn_rec_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['knitting_start_date']); ?></td>
                    <td  align="center"><? echo change_date_format($row['knitting_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['dying_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['dying_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['cutting_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['cutting_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['sewing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['sewing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['exfact_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['exfact_end_date']); ?></td>
                </tr>
                <?
				$i++;
			}
			?>

        </table>
        </fieldset>
            <?
		}
		?>

         <!--<br><br><br><br>-->
         <?
		 	echo signature_table(1, $cbo_company_name, "1330px");
		 ?>

       </div>
       <?
}


if($action=="show_fabric_booking_report_jk")
{
	extract($_REQUEST);
	 $cbo_company_name=str_replace("'","",$cbo_company_name);
	$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
	$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);

	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1 and master_tble_id='$cbo_company_name'",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	//$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$marchentrArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info ","id","team_member_name");
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$location_name_arr=return_library_array( "select id,location_name from lib_location",'id','location_name');
	$po_qnty_tot=return_field_value( "sum(plan_cut)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	$po_qnty_tot1=return_field_value( "sum(po_quantity)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	$pro_sub_dept_array=return_library_array( "select id,sub_department_name from lib_pro_sub_deparatment",'id','sub_department_name');
	?>
	<div style="width:1330px" align="center">
    <?php
$nameArray_approved = sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7");
list($nameArray_approved_row) = $nameArray_approved;
$nameArray_approved_date = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
list($nameArray_approved_date_row) = $nameArray_approved_date;
$nameArray_approved_comments = sql_select("select b.comments as comments from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
list($nameArray_approved_comments_row) = $nameArray_approved_comments;
$path = str_replace("'", "", $path);
if ($path != "") {
	$path = $path;
} else {
	$path = "../../";
}

?>										<!--    Header Company Information         -->
       <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black" >
           <tr>
               <td width="100">
               <img  src='<? echo $path.$imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
               </td>
               <td width="1250">
                    <table width="100%" cellpadding="0" cellspacing="0"  >
                        <tr>
                            <td align="center" style="font-size:20px;">
                              <?php
echo $company_library[$cbo_company_name];
?>
                            </td>
                            <td rowspan="3" width="250">

                               <span style="font-size:18px"><b> Job No:&nbsp;&nbsp;<? echo trim($txt_job_no,"'"); ?></b></span><br/>
                                <?
								 if($nameArray_approved_row[csf('approved_no')]>1)
								 {
								 ?>
								 <b> Revised No: <? echo $nameArray_approved_row[csf('approved_no')]-1; ?></b>
                                  <br/>
								  Approved Date: <? echo $nameArray_approved_date_row[csf('approved_date')]; ?>
								  <?
								 }
							  	?>


                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:14px">
                            <?
                            $nameArray=sql_select( "select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
							//$location=return_field_value("location_name","lib_location","id=$data[3]" );
							//$nameArray=sql_select("select location_name from wo_po_details_master where job_no=$txt_job_no");
							if($txt_job_no!="")
							{
							 $location=return_field_value( "location_name", "wo_po_details_master","job_no='$txt_job_no'");
							}
							else
							{
							$location="";
							}

							foreach ($nameArray as $result)
                            {
							 echo  $location_name_arr[$location];
                            ?>

                               <!-- Plot No: <? //echo $result[csf('plot_no')]; ?>
                                Level No: <? //echo $result[csf('level_no')]?>
                                Road No: <? //echo $result[csf('road_no')]; ?>
                                Block No: <? //echo $result[csf('block_no')];?>
                                City No: <? //echo $result[csf('city')];?>
                                Zip Code: <? //echo $result[csf('zip_code')]; ?>
                                Province No: <?php //echo $result[csf('province')];?>
                                Country: <? //echo $country_arr[$result[csf('country_id')]]; ?> --><br>
                                Email Address: <? echo $result[csf('email')];?>
                                Website No: <? echo $result[csf('website')]; ?>

                                <?

                            }

                            ?>
                               </td>
                            </tr>
                            <tr>
                            <td align="center" style="font-size:20px">
                                <strong><? if($report_title !=""){ echo $report_title;} else { echo "General Work Order";}?> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style="color:#F00"><? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </font></strong>
                             </td>

                              <td   style=" font-size:xx-large">
                                <?
								 if($nameArray_approved_row[csf('approved_no')]>1)
								 {
								 ?>
								 <strong> Revised No: <? echo $nameArray_approved_row[csf('approved_no')]-1; ?></strong>
								  <?
								 }
							  	?>


                            </td>
                            </tr>
                      </table>
                </td>
            </tr>
       </table>
                <?
				$job_no='';
				$total_set_qnty=0;
				$colar_excess_percent=0;
				$cuff_excess_percent=0;
				$rmg_process_breakdown=0;
                $nameArray=sql_select( "select a.booking_no,a.booking_date,a.supplier_id,a.pay_mode,a.currency_id,a.exchange_rate,a.attention,a.delivery_date,a.po_break_down_id,a.colar_excess_percent,a.cuff_excess_percent,a.delivery_date,a.is_apply_last_update,a.fabric_source,a.rmg_process_breakdown,a.insert_date,a.update_date,a.uom,b.job_no,b.buyer_name, b.style_ref_no ,b.gmts_item_id,b.order_uom,b.total_set_qnty,b.style_description,b.product_dept,b.product_code,b.pro_sub_dep,b.dealing_marchant from wo_booking_mst a, wo_po_details_master b where  a.job_no=b.job_no and a.booking_no=$txt_booking_no");
				foreach ($nameArray as $result)
				{
					$total_set_qnty=$result[csf('total_set_qnty')];
					$colar_excess_percent=$result[csf('colar_excess_percent')];
				    $cuff_excess_percent=$result[csf('cuff_excess_percent')];
					$rmg_process_breakdown=$result[csf('rmg_process_breakdown')];
					$booking_uom=$result[csf('uom')];
					$po_no="";
					$shipment_date="";
					$sql_po= "select po_number,MIN(pub_shipment_date) pub_shipment_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by po_number";
					$data_array_po=sql_select($sql_po);
					foreach ($data_array_po as $row_po)
					{
						$po_no.=$row_po[csf('po_number')].", ";
						$shipment_date.=change_date_format($row_po[csf('pub_shipment_date')],'dd-mm-yyyy','-').", ";
					}
					$lead_time="";
					if($db_type==0)
					{
					$sql_lead_time= "select DATEDIFF(pub_shipment_date,po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}
					if($db_type==2)
					{
					$sql_lead_time= "select (pub_shipment_date-po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}
					$data_array_lead_time=sql_select($sql_lead_time);
					foreach ($data_array_lead_time as $row_lead_time)
					{
						$lead_time.=$row_lead_time[csf('date_diff')].",";
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}
					$po_received_date="";
					$sql_po_received_date= "select MIN(po_received_date) as po_received_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					$data_array_po_received_date=sql_select($sql_po_received_date);
					foreach ($data_array_po_received_date as $row_po_received_date)
					{
						$po_received_date=change_date_format($row_po_received_date[csf('po_received_date')],'dd-mm-yyyy','-');
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}






					$sql_po= "select po_number,MIN(pub_shipment_date) pub_shipment_date, MIN(insert_date) as insert_date,shiping_status from wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by po_number,shiping_status";
					$data_array_po=sql_select($sql_po);
					foreach ($data_array_po as $rows)
					{
						$daysInHand.=(datediff('d',date('d-m-Y',time()),$rows[csf('pub_shipment_date')])-1).",";
						$booking_date=$result[csf('update_date')];
						if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
						{
							$booking_date=$result[csf('insert_date')];
						}
						$WOPreparedAfter.=(datediff('d',$rows[csf('insert_date')],$booking_date)-1).",";

						if($rows[csf('shiping_status')]==1)
						{
						$shiping_status.= "FP".",";
						}
						else if($rows[csf('shiping_status')]==2)
						{
						$shiping_status.= "PS".",";
						}
						else if($rows[csf('shiping_status')]==3)
						{
						$shiping_status.= "FS".",";
						}

					}

				if($db_type==2) $group_concat_all=" listagg(cast(b.grouping as varchar2(4000)),',') within group (order by b.grouping) as grouping,
	                                    listagg(cast(b.file_no as varchar2(4000)),',') within group (order by b.file_no) as file_no  ";
				else { $group_concat_all="group_concat(b.grouping) as grouping, group_concat(b.file_no) as file_no";}
				$data_array3=sql_select("select a.job_no,a.company_name,a.buyer_name,$group_concat_all from wo_po_details_master a, wo_po_break_down b where b.id in (".$result[csf('po_break_down_id')].") and a.job_no=b.job_no_mst group by a.job_no,a.company_name,a.buyer_name");
				//$sql_grouping= "select grouping, file_no  from wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by ";

				?>
       <table width="100%" style="border:1px solid black" >
            <tr>
                <td colspan="6" valign="top" style="font-size:18px; color:#F00"><? if($result[csf('is_apply_last_update')]==2){echo "Booking Info not synchronized with order entry and pre-costing. order entry or pre-costing has updated after booking entry.  Contact to ".$marchentrArr[$result[csf('dealing_marchant')]]; } else{ echo "";} ?></td>
            </tr>
            <tr>
                <td width="100"><span style="font-size:18px"><b>Buyer/Agent Name</b></span></td>
                <td width="110">:&nbsp;<span style="font-size:18px"><b><? echo $buyer_name_arr[$result[csf('buyer_name')]]; ?></b></span></td>
                <td width="100"><span style="font-size:12px"><b>Dept.</b></span></td>
                <td width="110">:&nbsp;<? echo $product_dept[$result[csf('product_dept')]] ; if($result[csf('product_code')] !=""){ echo " (".$result[csf('product_code')].")";} if($result[csf('pro_sub_dep')] !=0){ echo " (".$pro_sub_dept_array[$result[csf('pro_sub_dep')]].")";}?></td>
                <td width="100"><span style="font-size:12px"><b>Order Qnty</b></span></td>
                <td width="110">:&nbsp;
				<?  echo $po_qnty_tot1." ".$unit_of_measurement[$result[csf('order_uom')]] ; ?>
                </td>
            </tr>
            <tr>

                <td width="100" style="font-size:12px"><b>Garments Item</b></td>
                <td width="110">:&nbsp;
				<?
				$gmts_item_name="";
				$gmts_item=explode(',',$result[csf('gmts_item_id')]);
				for($g=0;$g<=count($gmts_item); $g++)
				{
					$gmts_item_name.= $garments_item[$gmts_item[$g]].",";
				}
				echo rtrim($gmts_item_name,',');
				?>
                </td>
                <td width="100" style="font-size:12px"><b>Booking Release Date</b></td>
                <td width="110">:&nbsp;
				<?
				$booking_date=$result[csf('update_date')];
				if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
				{
					$booking_date=$result[csf('insert_date')];
				}
				echo change_date_format($booking_date,'dd-mm-yyyy','-','');
				?>&nbsp;&nbsp;&nbsp;</td>
                <td width="100" style="font-size:18px"><b>Style Ref.</b>   </td>
                <td width="110" style="font-size:18px">:&nbsp;<b><? echo $result[csf('style_ref_no')];?> </b>   </td>
            </tr>
             <tr>
                <td  width="100" style="font-size:12px"><b>Style Des.</b></td>
                <td  width="110" >:&nbsp;<? echo $result[csf('style_description')]; $job_no= $result[csf('job_no')];?></td>
                <td width="100" style="font-size:12px"><b>Lead Time </b>   </td>
                <td width="110">:&nbsp;<?  echo rtrim($lead_time,",");?> </td>
                <td width="100" style="font-size:12px"><b>Dealing Merchant</b></td>
                <td width="110">:&nbsp;<? echo $marchentrArr[$result[csf('dealing_marchant')]]; ?></td>
            </tr>

            <tr>
                <td width="100" style="font-size:12px"><b>Supplier Name</b>   </td>
                <td width="110">:&nbsp;<?
				if($result[csf('pay_mode')]==5 || $result[csf('pay_mode')]==3){
						echo $company_library[$result[csf('supplier_id')]];
					}
					else{
					echo $supplier_name_arr[$result[csf('supplier_id')]];
					}
				//echo $supplier_name_arr[$result[csf('supplier_id')]];?>    </td>
                <td width="100" style="font-size:12px"><b>Fab. Delv. Date</b></td>
               	<td width="110">:&nbsp;<? echo change_date_format( $result[csf('delivery_date')],'dd-mm-yyyy','-');?></td>
                <td width="100" style="font-size:18px"><b>Booking No </b>   </td>
                <td width="110" style="font-size:18px">:&nbsp;<b><? echo $result[csf('booking_no')];?></b><? echo "(".$fabric_source[$result[csf('fabric_source')]].")"?></td>



            </tr>
            <tr>
                <td width="100" style="font-size:12px"><b>Season</b></td>
                <td width="110">:&nbsp;<? echo $result[csf('season')]; ?></td>
                <td  width="100" style="font-size:12px"><b>Attention</b></td>
                <td  width="110" >:&nbsp;<? echo $result[csf('attention')]; ?></td>
                <td  width="100" style="font-size:12px"><b>PO Received Date</b></td>
                <td  width="110" >:&nbsp;<? echo $po_received_date; ?></td>



            </tr>
           <tr>
               <td width="100" style="font-size:18px"><b>Order No</b></td>
               <td width="110" style="font-size:18px" colspan="5">:&nbsp;<b><? echo rtrim($po_no,", "); ?></b></td>

            </tr>
            <tr>
               <td width="100" style="font-size:12px"><b>Shipment Date</b></td>
                <td width="110" colspan="5"> :&nbsp;<? echo rtrim($shipment_date,", "); ?></td>

            </tr>

            </tr>
            <tr>
               <td width="100" style="font-size:12px"><b>WO Prepared After</b></td>
               <td width="110"> :&nbsp;<? echo rtrim($WOPreparedAfter,',').' Days' ?></td>

               <td width="100" style="font-size:12px"><b>Ship.days in Hand</b></td>
               <td width="110"> :&nbsp;<? echo rtrim($daysInHand,',').' Days'?></td>

               <td width="100" style="font-size:12px"><b>Ex-factory status</b></td>
               <td width="110"> :&nbsp;<? echo rtrim($shiping_status,','); ?></td>

            </tr>
        </table>
           <?
			}


			if($cbo_fabric_source==1)
			{
			//$nameArray_size=sql_select( "select distinct size_number_id from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  	is_deleted=0 and status_active=1 order by size_number_id");
			//$nameArray_size=sql_select( "select  size_number_id,min(id) as id,	min(size_order) as size_order from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  	is_deleted=0 and status_active=1 group by size_number_id order by id");
			$nameArray_size=sql_select( "select  size_number_id,min(id) as id,	min(size_order) as size_order from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  	is_deleted=0 and status_active=1 group by size_number_id order by size_order");

		   ?>
            <table width="100%" >
		    <tr>
            <td width="800">
                <div id="div_size_color_matrix" style="float:left; max-width:1000;">
            	<fieldset id="div_size_color_matrix" style="max-width:1000;">
 				<legend>Size and Color Breakdown</legend>
 				<table  class="rpt_table"  border="1" align="left" cellpadding="0" width="750" cellspacing="0" rules="all" >
                    <tr>
                        <td style="border:1px solid black"><strong>Color/Size</strong></td>
                    <?
						foreach($nameArray_size  as $result_size)
                        {	     ?>
                        <td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
                    <?	}    ?>
                        <td style="border:1px solid black; width:130px" align="center"><strong> Total Order Qty(Pcs)</strong></td>
                        <td style="border:1px solid black; width:80px" align="center"><strong> Excess %</strong></td>
                        <td style="border:1px solid black; width:130px" align="center"><strong> Total Plan Cut Qty(Pcs)</strong></td>
                    </tr>
                    <?
					$color_size_order_qnty_array=array();
					$color_size_qnty_array=array();
					$size_tatal=array();
					$size_tatal_order=array();
					for($c=0;$c<count($gmts_item); $c++)
				    {
					$item_size_tatal=array();
					$item_size_tatal_order=array();
					$item_grand_total=0;
					$item_grand_total_order=0;
					//$nameArray_color=sql_select( "select distinct color_number_id from wo_po_color_size_breakdown where  item_number_id=$gmts_item[$c] and po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 order by color_number_id");
					//$nameArray_color=sql_select( "select  color_number_id,min(id) as id,min(color_order) as color_order from wo_po_color_size_breakdown where  item_number_id=$gmts_item[$c] and po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id  order by id");
					$nameArray_color=sql_select( "select  color_number_id,min(id) as id,min(color_order) as color_order from wo_po_color_size_breakdown where  item_number_id=$gmts_item[$c] and po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id  order by color_order");
					?>
                    <tr>
                    <td style="border:1px solid black" colspan="<? echo count($nameArray_size)+3;?>"><strong><? echo $garments_item[$gmts_item[$c]];?></strong></td>

                    </tr>
                    <?
					foreach($nameArray_color as $result_color)
                    {
                    ?>
                    <tr>
                        <td align="center" style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; // echo $row_num_tr; ?></td>
                        <?
						$color_total=0;
						$color_total_order=0;

						foreach($nameArray_size  as $result_size)
						{
						$nameArray_color_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as  order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$result_color[csf('color_number_id')]."  and item_number_id=$gmts_item[$c] and  status_active=1 and is_deleted =0");
						foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                        {
                        ?>
                            <td style="border:1px solid black; text-align:right">
							<?
								if($result_color_size_qnty[csf('plan_cut_qnty')]!= "")
								{
									 echo number_format($result_color_size_qnty[csf('order_quantity')],0);
									 $color_total += $result_color_size_qnty[csf('plan_cut_qnty')] ;
									 $color_total_order += $result_color_size_qnty[csf('order_quantity')] ;
									 $item_grand_total+=$result_color_size_qnty[csf('plan_cut_qnty')];
									 $item_grand_total_order+=$result_color_size_qnty[csf('order_quantity')];
								     $grand_total +=$result_color_size_qnty[csf('plan_cut_qnty')];
									 $grand_total_order +=$result_color_size_qnty[csf('order_quantity')];

									 $color_size_qnty_array[$result_size[csf('size_number_id')]][$result_color[csf('color_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
									 $color_size_order_qnty_array[$result_size[csf('size_number_id')]][$result_color[csf('color_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
									 if (array_key_exists($result_size[csf('size_number_id')], $size_tatal))
									 {
											$size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
											$size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
									 }
									 else
									 {
										$size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
										$size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
									 }
									 if (array_key_exists($result_size[csf('size_number_id')], $item_size_tatal))
									 {
											$item_size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
											$item_size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
									 }
									 else
									 {
										$item_size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
										$item_size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
									 }
								}
								else echo "0";
							 ?>
							</td>

                    <?
						}
                        }
                        ?>
                          <td style="border:1px solid black; text-align:right"><?  echo number_format(round($color_total_order),0); ?></td>

                         <td style="border:1px solid black; text-align:right"><? $excexss_per=($color_total-$color_total_order)/$color_total_order*100; echo number_format($excexss_per,2)." %"; ?>
                         </td>
                        <td style="border:1px solid black; text-align:right"><? echo number_format(round($color_total),0); ?></td>
                    </tr>
                    <?
                    }
					?>

                        <td align="center" style="border:1px solid black"><strong>Sub Total</strong></td>
                        <?
						foreach($nameArray_size  as $result_size)
                        {
                        ?>
                        <td style="border:1px solid black;  text-align:right"><? echo $item_size_tatal_order[$result_size[csf('size_number_id')]];  ?></td>
                        <?
                        }
                        ?>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($item_grand_total_order),0); ?></td>
                        <td  style="border:1px solid black;  text-align:right"><? $excess_item_gra_tot=($item_grand_total-$item_grand_total_order)/$item_grand_total_order*100; echo number_format($excess_item_gra_tot,2)." %"; ?></td>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($item_grand_total),0); ?></td>
                    </tr>
                    <?
					}
                    ?>
                     <tr>
                        <td style="border:1px solid black" align="center" colspan="<? echo count($nameArray_size)+3; ?>"><strong>&nbsp;</strong></td>
                        </tr>
                    <tr>
                    <tr>
                        <td align="center" style="border:1px solid black"><strong>Grand Total</strong></td>
                        <?
						foreach($nameArray_size  as $result_size)
                        {
                        ?>
                        <td style="border:1px solid black;  text-align:right"><? echo $size_tatal_order[$result_size[csf('size_number_id')]];  ?></td>
                        <?
                        }
                        ?>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($grand_total_order),0); ?></td>
                        <td  style="border:1px solid black;  text-align:right"><? $excess_gra_tot= ($grand_total-$grand_total_order)/$grand_total_order*100; echo number_format($excess_gra_tot,2)." %"; ?></td>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($grand_total),0); ?></td>
                    </tr>
                </table>
                </fieldset>
                </div>
                </td>
                <td width="200" valign="top" align="left">
                <div id="div_size_color_matrix" style="float:left;">
                <?
				$rmg_process_breakdown_arr=explode('_',$rmg_process_breakdown)
				?>
            	 	<fieldset id="" >
 				<legend>RMG Process Loss % </legend>
            	<table width="180" class="rpt_table" border="1" rules="all">
                <?
				if(number_format($rmg_process_breakdown_arr[8],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Cut Panel rejection <!-- Extra Cutting % breack Down 8-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[8],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[2],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Chest Printing <!-- Printing % breack Down 2-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[2],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[10],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Neck/Sleeve Printing <!-- New breack Down 10-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[10],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[1],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Embroidery   <!-- Embroidery  % breack Down 1-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[1],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[4],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Sewing /Input<!-- Sewing % breack Down 4-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[4],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[3],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Garments Wash <!-- Washing %breack Down 3-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[3],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[15],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Gmts Finishing <!-- Washing %breack Down 3-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[15],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[11],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Others <!-- New breack Down 11-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[11],2);
				?>
                </td>
                </tr>
                <?
                }
				$gmts_pro_sub_tot=$rmg_process_breakdown_arr[8]+$rmg_process_breakdown_arr[2]+$rmg_process_breakdown_arr[10]+$rmg_process_breakdown_arr[1]+$rmg_process_breakdown_arr[4]+$rmg_process_breakdown_arr[3]+$rmg_process_breakdown_arr[11]+$rmg_process_breakdown_arr[15];
				if($gmts_pro_sub_tot>0)
				{
				?>
                <tr>
                <td width="130">
                Sub Total <!-- New breack Down 11-->
                </td>
                <td align="right">
                <?

				echo number_format($gmts_pro_sub_tot,2);
				?>
                </td>
                </tr>
                <?
				}
				?>
                </table>
                </fieldset>


                <fieldset id="" >
 				<legend>Fabric Process Loss % </legend>
            	<table width="180" class="rpt_table" border="1" rules="all">
                 <?
				if(number_format($rmg_process_breakdown_arr[6],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Knitting  <!--  Knitting % breack Down 6-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[6],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[12],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Yarn Dyeing  <!--  New breack Down 12-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[12],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[5],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Dyeing & Finishing  <!-- Finishing % breack Down 5-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[5],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[13],2)>0)
				{
				?>
                <tr>
                <td width="130">
                All Over Print <!-- new  breack Down 13-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[13],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[14],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Lay Wash (Fabric) <!-- new  breack Down 14-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[14],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[7],2)>0)
				{
				?>
                 <tr>
                <td width="130">
                Dying   <!-- breack Down 7-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[7],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[0],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Cutting (Fabric) <!-- Cutting % breack Down 0-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[0],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[9],2)>0)
				{
				?>
                <tr>
                <td width="130">
               Others  <!-- Others% breack Down 9-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[9],2);
				?>
                </td>
                </tr>
                <?
				}
				$fab_proce_sub_tot=$rmg_process_breakdown_arr[6]+$rmg_process_breakdown_arr[12]+$rmg_process_breakdown_arr[5]+$rmg_process_breakdown_arr[13]+$rmg_process_breakdown_arr[14]+$rmg_process_breakdown_arr[7]+$rmg_process_breakdown_arr[0]+$rmg_process_breakdown_arr[9];
				if(fab_proce_sub_tot>0)
				{
				?>
                <tr>
                <td width="130">
                Sub Total  <!-- Others% breack Down 9-->
                </td>
                <td align="right">
                <?

				echo number_format($fab_proce_sub_tot,2);
				?>
                </td>
                </tr>
                <?
				}
				if($gmts_pro_sub_tot+$fab_proce_sub_tot>0)
				{
				?>
                 <tr>
                <td width="130">
                Grand Total  <!-- Others% breack Down 9-->
                </td>
                <td align="right">
                <?
				echo number_format($gmts_pro_sub_tot+$fab_proce_sub_tot,2);
				?>
                </td>
                </tr>
                <?
				}
				?>
           </table>
           </fieldset>
           </div>
                </td>
            <td width="330" valign="top" align="left">
            <?
			$nameArray_imge =sql_select("SELECT image_location FROM common_photo_library where master_tble_id='$job_no' and file_type=1");
			?>
            <div id="div_size_color_matrix" style="float:left;">
            	<fieldset id="" >
 				<legend>Image </legend>
            	<table width="310">
                <tr>
                <?
				$img_counter = 0;
                foreach($nameArray_imge as $result_imge)
				{
				    if($path=="")
                    {
                    $path='../../';
                    }

					?>
					<td>
						<!--<img src="../../<? //echo $result_imge[csf('image_location')]; ?>" width="90" height="100" border="2" />-->
                        <img src="<? echo $path.$result_imge[csf('image_location')]; ?>" width="90" height="100" border="2" />
					</td>
					<?

					$img_counter++;
				}
				?>
                </tr>
           </table>
           </fieldset>
           </div>
          </td>
        </tr>
       </table>
        <?
			}// if($cbo_fabric_source==1) end

	  ?>
      <br/>

      <!--  Here will be the main portion  -->
     <?
	 $costing_per="";
	 $costing_per_qnty=0;
	 $costing_per_id=return_field_value( "costing_per", "wo_pre_cost_mst","job_no ='$job_no'");
	 if($costing_per_id==1)
			{
				$costing_per="1 Dzn";
				$costing_per_qnty=12;

			}
			if($costing_per_id==2)
			{
				$costing_per="1 Pcs";

				$costing_per_qnty=1;

			}
			if($costing_per_id==3)
			{
				$costing_per="2 Dzn";
				$costing_per_qnty=24;

			}
			if($costing_per_id==4)
			{
				$costing_per="3 Dzn";
				$costing_per_qnty=36;

			}
			if($costing_per_id==5)
			{
				$costing_per="4 Dzn";
				$costing_per_qnty=48;

			}
			$process_loss_method=return_field_value( "process_loss_method", "wo_pre_cost_fabric_cost_dtls","job_no='$job_no'");;

	 ?>

     <?

	/*$nameArray_fabric_description= sql_select("SELECT a.color_type_id,a.construction,a.composition,a.gsm_weight,a.dia_width,a.process_loss_percent FROM view_wo_fabric_booking_data_park a,wo_booking_dtls b where b.booking_no =$txt_booking_no and a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and b.status_active=1 and
b.is_deleted=0  group by a.color_type_id,a.construction,a.composition,a.gsm_weight,a.dia_width,process_loss_percent order by a.pre_cost_fabric_cost_dtls_id");*/
if($cbo_fabric_source==1)
{



	$nameArray_fabric_description= sql_select("select min(a.id) as fabric_cost_dtls_id, max(a.lib_yarn_count_deter_id) as determin_id,a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type, b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent , avg(b.requirment) as requirment FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
	WHERE a.job_no=b.job_no and
	a.id=b.pre_cost_fabric_cost_dtls_id and
	c.job_no_mst=a.job_no and
	c.id=b.color_size_table_id and
	b.po_break_down_id=d.po_break_down_id and
	b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
	d.booking_no =$txt_booking_no and
	d.status_active=1 and
	d.is_deleted=0
	group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by fabric_cost_dtls_id,a.body_part_id,b.dia_width");
	 ?>

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
     <tr align="center">
     <th colspan="3" align="left">Body Part</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
		}
		?>
        <td  rowspan="9" width="50"><p>Total  Finish Fabric (<? echo $unit_of_measurement[$booking_uom];?>)</p></td>
        <td  rowspan="9" width="50"><p>Total Grey Fabric (<? echo $unit_of_measurement[$booking_uom];?>)</p></td>
        <td  rowspan="9" width="50"><p>Process Loss % </p></td>
       </tr>
     <tr align="center"><th colspan="3" align="left">Color Type</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
		}
		?>
        <!--<td  rowspan="8" width="50"><p>Total  Finish Fabric (KG)</p></td> <td  rowspan="8" width="50"><p>Total Grey Fabric (KG)</p></td>-->
             <!--<td  rowspan="7" width="50"><p>Process Loss % </p></td>-->
       </tr>
        <tr align="center"><th colspan="3" align="left">Fabric Construction</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>". $result_fabric_description[csf('construction')]."</td>";
		}
		?>


       </tr>
        <tr align="center"><th   colspan="3" align="left">Fabric Composition / Yarn Type</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='2' >&nbsp</td>";
			else         		               echo "<td colspan='2' >".$result_fabric_description[csf('composition')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th  colspan="3" align="left">GSM</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='2'>&nbsp</td>";
			else         		       echo "<td colspan='2' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='2'>&nbsp</td>";
			else         		              echo "<td colspan='2' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Consumption For <? echo $costing_per; ?></th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('requirment')] == "")   echo "<td colspan='2'>&nbsp</td>";
			else         		              echo "<td colspan='2' align='center'>Fin: ".number_format($result_fabric_description[csf('cons')],4).", Grey: ".number_format($result_fabric_description[csf('requirment')],4)."</td>";
		}
		?>

       </tr>
       <tr>
       <th  colspan="<? echo  count($nameArray_fabric_description)*2+3; ?>" align="left" style="height:30px">&nbsp;</th>
       </tr>

       <tr>
            <!--<th  width="120" align="left">Gmts. Color</th>-->
            <th  width="120" align="left">Fabric Color</th>
            <th  width="120" align="left">Body Color</th>
            <th  width="120" align="left">Lab Dip No</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			  echo "<th width='50'>Finish</th><th width='50' >Grey</th>";
		}
		?>

       </tr>
       <?

		  $gmt_color_library=array();
		  $gmt_color_data=sql_select("select b.gmts_color_id, b.contrast_color_id
		  FROM
		  wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b
		  WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.fabric_source =$cbo_fabric_source and
		  a.job_no ='$job_no'");
		  foreach( $gmt_color_data as $gmt_color_row)
		  {
			//$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
			$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];

		  }

	        $grand_total_fin_fab_qnty=0;
			$grand_total_grey_fab_qnty=0;
			$grand_totalcons_per_finish=0;
			$grand_totalcons_per_grey=0;

			$color_wise_wo_sql=sql_select("select fabric_color_id
										  FROM
										  wo_booking_dtls
										  WHERE
										  booking_no =$txt_booking_no and
										  status_active=1 and
                                          is_deleted=0
										  group by fabric_color_id");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
		?>
			<tr>
           <!-- <td  width="120" align="left">
			<?

			//echo $color_library[$color_wise_wo_result['fabric_color_id']];

			?></td>-->
            <td  width="120" align="left">
			<?
			echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];


			?>
            </td>
            <td>
            <?
			echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
			?>
            </td>
            <td  width="120" align="left">
			<?
			$lapdip_no="";
			$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
			//echo "lapdip_no from wo_po_lapdip_approval_info where job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result['fabric_color_id']."";
			if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_grey_fab_qnty=0;

			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				if($db_type==0)
				{
					$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
					WHERE a.job_no=b.job_no and
					a.id=b.pre_cost_fabric_cost_dtls_id and
					c.job_no_mst=a.job_no and
					c.id=b.color_size_table_id and
					b.po_break_down_id=d.po_break_down_id and
					b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
					d.booking_no =$txt_booking_no and
					a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
					a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
					a.construction='".$result_fabric_description[csf('construction')]."' and
					a.composition='".$result_fabric_description[csf('composition')]."' and
					a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
					b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
					d.fabric_color_id='".$color_wise_wo_result[csf('fabric_color_id')]."' and
					d.status_active=1 and
					d.is_deleted=0 ");
				}
				if($db_type==2)
				{
					$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
					WHERE a.job_no=b.job_no and
					a.id=b.pre_cost_fabric_cost_dtls_id and
					c.job_no_mst=a.job_no and
					c.id=b.color_size_table_id and
					b.po_break_down_id=d.po_break_down_id and
					b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
					d.booking_no =$txt_booking_no and
					a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
					a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
					a.construction='".$result_fabric_description[csf('construction')]."' and
					a.composition='".$result_fabric_description[csf('composition')]."' and
					a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
					b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
					nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
					d.status_active=1 and
					d.is_deleted=0 ");
				}

				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'>
			<?
			if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			{
				echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;
				$total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('fin_fab_qnty')];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
			{
				if($process_loss_method==1)
				{
					$process_loss_percent=(($color_wise_wo_result_qnty[csf('grey_fab_qnty')]-$color_wise_wo_result_qnty[csf('fin_fab_qnty')])/$color_wise_wo_result_qnty[csf('fin_fab_qnty')])*100;
				}

				if($process_loss_method==2)
				{
					$process_loss_percent=(($color_wise_wo_result_qnty[csf('grey_fab_qnty')]-$color_wise_wo_result_qnty[csf('fin_fab_qnty')])/$color_wise_wo_result_qnty[csf('grey_fab_qnty')])*100;
				}
				echo number_format($process_loss_percent,2)."%<br>";
				echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2);
				$total_grey_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];


			}
			?>
            </td>
            <?
			}
			?>
            <td align="right"><? echo number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
            <td align="right"><? echo number_format($total_grey_fab_qnty,2); $grand_total_grey_fab_qnty+=$total_grey_fab_qnty;?></td>

            <td align="right">
            <?
			if($process_loss_method==1)
			{
				$process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_fin_fab_qnty)*100;
			}

			if($process_loss_method==2)
			{
				$process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_grey_fab_qnty)*100;
			}
			echo number_format($process_percent,2);

			?>
            </td>
            </tr>
         <?
		}
		?>
        <tr style=" font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Total</strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;?></td><td width='50' align='right' > <? echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2);?></td>
            <?
			}
			?>
            <td align="right"><? echo number_format($grand_total_fin_fab_qnty,2);?></td>
            <td align="right"><? echo number_format($grand_total_grey_fab_qnty,2);?></td>
            <td align="right">
            <?
            if($process_loss_method==1)// markup
			{
				$totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_fin_fab_qnty)*100;
			}

			if($process_loss_method==2) //margin
			{
				$totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_grey_fab_qnty)*100;
			}
			echo number_format($totalprocess_percent,2);
			?>
            </td>
            </tr>
            <tr style="font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

			?>
			<td width='50' align='right'><?  //echo number_format(($color_wise_wo_result_qnty['fin_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td><td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <?
			}
			?>
            <td align="right">
			<?
			//echo $grand_total_fin_fab_qnty;
			echo number_format(($grand_total_fin_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4);
			$grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4);
			?>
            </td>
            <td align="right"><? echo number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4);$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4)?></td>
            <td align="right">
            <?
            if($process_loss_method==1)
			{
				$totalprocess_percent_dzn=(($grand_total_grey_fab_qnty_dzn-$grand_total_fin_fab_qnty_dzn)/$grand_total_fin_fab_qnty_dzn)*100;
			}

			if($process_loss_method==2)
			{
				$totalprocess_percent_dzn=(($grand_total_grey_fab_qnty_dzn-$grand_total_fin_fab_qnty_dzn)/$grand_total_grey_fab_qnty_dzn)*100;
			}
			echo number_format($totalprocess_percent_dzn,2);
			?>
            </td>
            </tr>
    </table>
    <?
	}

	if($cbo_fabric_source==2)
	{
	$nameArray_fabric_description= sql_select("select min(a.id) as fabric_cost_dtls_id,  a.lib_yarn_count_deter_id as determin_id,a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type , b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent, avg(b.requirment) as requirment  FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
	WHERE a.job_no=b.job_no and
	a.id=b.pre_cost_fabric_cost_dtls_id and
	c.job_no_mst=a.job_no and
	c.id=b.color_size_table_id and
	b.po_break_down_id=d.po_break_down_id and
	b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
	d.booking_no =$txt_booking_no and
	d.status_active=1 and
	d.is_deleted=0
	group by a.body_part_id,a.lib_yarn_count_deter_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by fabric_cost_dtls_id,a.body_part_id,b.dia_width");
	 ?>

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
     <tr align="center">
     <th colspan="3" align="left">Body Part</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
			else         		               echo "<td  colspan='3'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
		}
		?>
        <td  rowspan="9" width="50"><p>Total Fabric (<? echo $unit_of_measurement[$booking_uom];?>)</p></td>
        <td  rowspan="9" width="50"><p>Avg Rate (<? echo $unit_of_measurement[$booking_uom];?>)</p></td>
        <td  rowspan="9" width="50"><p>Amount </p></td>
       </tr>
     <tr align="center"><th colspan="3" align="left">Color Type</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
			else         		               echo "<td  colspan='3'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
		}
		?>
        <!--<td  rowspan="8" width="50"><p>Total  Finish Fabric (KG)</p></td> <td  rowspan="8" width="50"><p>Total Grey Fabric (KG)</p></td>-->
             <!--<td  rowspan="7" width="50"><p>Process Loss % </p></td>-->
       </tr>
        <tr align="center"><th colspan="3" align="left">Fabric Construction</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='3'>&nbsp</td>";
			else         		               echo "<td  colspan='3'>". $result_fabric_description[csf('construction')]."</td>";
		}
		?>


       </tr>
        <tr align="center"><th   colspan="3" align="left">Fabric Composition</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='3' >&nbsp</td>";
			else         		               echo "<td colspan='3' >".$result_fabric_description[csf('composition')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th  colspan="3" align="left">GSM</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		       echo "<td colspan='3' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		              echo "<td colspan='3' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Consumption For <? echo $costing_per; ?></th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('requirment')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		              echo "<td colspan='3' align='center'>Fin: ".number_format($result_fabric_description[csf('cons')],2).", Grey: ".number_format($result_fabric_description[csf('requirment')],2)."</td>";
		}
		?>

       </tr>
       <tr>
       <th  colspan="<? echo  count($nameArray_fabric_description)*3+3; ?>" align="left" style="height:30px">&nbsp;</th>
       </tr>

       <tr>
            <!--<th  width="120" align="left">Gmts. Color</th>-->
            <th  width="120" align="left">Fabric Color</th>
            <th  width="120" align="left">Body Color</th>
            <th  width="120" align="left">Lab Dip No</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			  echo "<th width='50'>Fab. Qty</th><th width='50' >Rate</th><th width='50' >Amount</th>";
		}
		?>

       </tr>
       <?

		  /*$gmt_color_library=return_library_array( "select gmts_color_id,contrast_color_id
		  FROM
		  wo_pre_cos_fab_co_color_dtls
		  WHERE
		  job_no ='$job_no'", "contrast_color_id", "gmts_color_id");*/
		  $gmt_color_library=array();
		  $gmt_color_data=sql_select("select b.gmts_color_id, b.contrast_color_id
		  FROM
		  wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b
		  WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.fabric_source =$cbo_fabric_source and
		  a.job_no ='$job_no'");
		  foreach( $gmt_color_data as $gmt_color_row)
		  {
			//$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
			$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
		  }

	        $grand_total_fin_fab_qnty=0;
			$grand_total_amount=0;
			//$grand_totalcons_per_finish=0;
			//$grand_totalcons_per_grey=0;
			$color_wise_wo_sql=sql_select("select fabric_color_id
										  FROM
										  wo_booking_dtls
										  WHERE
										  booking_no =$txt_booking_no and
										  status_active=1 and
                                          is_deleted=0
										  group by fabric_color_id");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
		?>
			<tr>
           <!-- <td  width="120" align="left">
			<?

			//echo $color_library[$color_wise_wo_result['fabric_color_id']];

			?></td>-->
            <td  width="120" align="left">
			<?
			echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];


			?>
            </td>
            <td>
            <?
			//echo $color_library[$gmt_color_library[$color_wise_wo_result['fabric_color_id']]];
			//echo rtrim($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]],",");
			echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
			?>
            </td>
            <td  width="120" align="left">
			<?
			$lapdip_no="";
			$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
			//echo "lapdip_no from wo_po_lapdip_approval_info where job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result['fabric_color_id']."";
			if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_amount=0;

			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				if($db_type==0)
				{
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty, avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
				d.status_active=1 and
				d.is_deleted=0
				");
				}
				if($db_type==2)
				{

				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
				d.status_active=1 and
				d.is_deleted=0
				");
				}
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'>
			<?
			if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2) ;
			$total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('rate')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('rate')],2);
			//$total_grey_fab_qnty+=$color_wise_wo_result_qnty['grey_fab_qnty'];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			$amount=$color_wise_wo_result_qnty[csf('grey_fab_qnty')]*$color_wise_wo_result_qnty[csf('rate')];
			if($amount!="")
			{
			echo number_format($amount,2);
			$total_amount+=$amount;
			}
			?>
            </td>
            <?
			}
			?>
            <td align="right"><? echo number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
            <td align="right"><? echo number_format($total_amount/$total_fin_fab_qnty,2); $grand_total_amount+=$total_amount;?></td>
            <td align="right">
            <?
			echo number_format($total_amount,2);

			?>
            </td>
            </tr>
         <?
		}
		?>
        <tr style=" font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Total</strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,

												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2) ;?></td>
            <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
            <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
            <?
			}
			?>
            <td align="right"><? echo number_format($grand_total_fin_fab_qnty,2);?></td>
            <td align="right"><? echo number_format($grand_total_amount/$grand_total_fin_fab_qnty,2);?></td>
            <td align="right">
            <?
			echo number_format($grand_total_amount,2);
			?>
            </td>
            </tr>
            <tr style="font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

			?>
			<td width='50' align='right'><?  //echo number_format(($color_wise_wo_result_qnty['fin_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td>
            <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <?
			}
			?>
            <td align="right">
			<?
			$consumption_per_unit_fab=($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
			echo number_format($consumption_per_unit_fab,4);
			//$grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4)
			?>
            </td>
            <td align="right">
			<?
			$consumption_per_unit_amuont=($grand_total_amount/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
			echo number_format(($consumption_per_unit_amuont/$consumption_per_unit_fab),2);
			//$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4)
			?>
            </td>
            <td align="right">
            <?
			echo number_format($consumption_per_unit_amuont,2);
			?>
            </td>
            </tr>
    </table>
    <?
	}
	?>
        <br/>
        <?
		if($cbo_fabric_source==1)
		{
		?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
        <tr>
        <?

		//echo "select a.colar_cuff_per,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id    and a.booking_no=$txt_booking_no and a.booking_type=1 c.body_part_id in(2) and a.status_active=1 and a.is_deleted=0";
		//$colar_percent_size_wise_array=return_library_array( "select a.colar_cuff_per,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id    and a.booking_no=$txt_booking_no and a.booking_type=1 and c.body_part_id in(2) and a.status_active=1 and a.is_deleted=0", "gmts_sizes", "colar_cuff_per");


		$colar_percent_size_wise_array=array();
		$colar_percent_size_wise_sql=sql_select( "select a.colar_cuff_per,b.color_number_id,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id    and a.booking_no=$txt_booking_no and a.booking_type=1 and c.body_part_id in(2) and a.status_active=1 and a.is_deleted=0");
		$colar_excess_percent_arr=array();
		foreach($colar_percent_size_wise_sql as $colar_percent_size_wise_row)
		{
			$colar_percent_size_wise_array[$colar_percent_size_wise_row[csf('color_number_id')]][$colar_percent_size_wise_row[csf('gmts_sizes')]]=$colar_percent_size_wise_row[csf('colar_cuff_per')];
			//$colar_excess_percent_arr[$colar_percent_size_wise_row[csf('gmts_sizes')]]+=$colar_percent_size_wise_row[csf('colar_cuff_per')];

		}

		//print_r($colar_percent_size_wise_array);
		$nameArray_item_size=sql_select( "select min(c.id) as id,b.item_size,c.size_number_id,	min(c.size_order) as size_order FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id  and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by size_order");


		if(count($nameArray_item_size)>0)
		{
        ?>
        <td width="49%">
        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
        <tr>
        <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Collar -  Colour Size Brakedown in Pcs</b></td>
        </tr>
        <tr>
        <td width="70">Size</td>

        <?

		/*$nameArray_item_size=sql_select( "select b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by c.size_number_id,b.item_size order by c.size_number_id");*/
		foreach($nameArray_item_size  as $result_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
		<?
        }
        ?>
        <td rowspan="2" align="center"><strong>Total</strong></td>
        <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
        </tr>
        <tr>
        <td>Collar Size</td>

        <?
        foreach($nameArray_item_size  as $result_item_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
		<?
        }
        ?>
         <?

			//$color_wise_wo_sql=sql_select("select a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id,sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by c.color_number_id,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method order by a.id ");

		$color_wise_wo_sql=sql_select("select a.id, a.job_no, a.color_size_sensitive, a.color_break_down, a.process_loss_method, c.color_number_id , c.color_order, sum(c.plan_cut_qnty) as plan_cut_qnty
		FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c, wo_booking_dtls d
		WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 and c.status_active=1 and c.is_deleted=0
		group by c.color_number_id, c.color_order, a.id, a.job_no, a.color_size_sensitive,a.color_break_down, a.process_loss_method
		order by c.color_order ");

		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
			$color_total_collar=0;
			$color_total_collar_order_qnty=0;
			$process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
			$constrast_color_arr=array();
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				$constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
				for($i=0;$i<count($constrast_color);$i++)
				{
					$constrast_color2=explode('_',$constrast_color[$i]);
					$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
				}
			}
		?>
			<tr>
            <td>
            <?
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]) ;
				$lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
			}
			else
			{
				echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
				$lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
			}
			?>

            </td>
            <?
            foreach($nameArray_item_size  as $result_size)
			{
				?>
				<td align="center" style="border:1px solid black">
				<?

				$color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0 ");




				list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
				$plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
				$colar_excess_per=($plan_cut*$colar_percent_size_wise_array[$color_wise_wo_result[csf('color_number_id')]][$result_size[csf('size_number_id')]])/100;
				echo number_format($plan_cut+$colar_excess_per,0);
				$size_total_arr[$result_size[csf('size_number_id')]]+=number_format($plan_cut+$colar_excess_per,0,'','');
				$color_total_collar+=$plan_cut+$colar_excess_per;
				$color_total_collar_order_qnty+=$plan_cut;
				$grand_total_collar+=$plan_cut+$colar_excess_per;
				$grand_total_collar_order_qnty+=$plan_cut;



				?>
                </td>
				<?
			}
			?>

            <td align="center"><? echo number_format($color_total_collar,0); ?></td>
            <td align="center"><? echo number_format((($color_total_collar-$color_total_collar_order_qnty)/$color_total_collar_order_qnty)*100,2); ?></td>
            </tr>
            <?
		    }
			?>
            <tr>
                <td>Size Total</td>

                <?
                foreach($nameArray_item_size  as $result_size)
                {
                ?>
                <td style="border:1px solid black;  text-align:center">
				<?
				//$colar_excess_pers=($size_tatal[$result_size[csf('size_number_id')]]*$colar_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]+$colar_excess_pers,0);
				echo number_format($size_total_arr[$result_size[csf('size_number_id')]],0);

				?></td>
                <?
                }
                ?>
                <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_collar,0); ?></td>
                <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_collar-$grand_total_collar_order_qnty)/$grand_total_collar_order_qnty)*100,2); ?></td>
            </tr>
        </table>
        </td>
        <td width="2%">
        </td>
        <?
        }

		$cuff_percent_size_wise_array=$cuff_size_total=array();
		$cuff_percent_size_wise_sql=sql_select( "select a.colar_cuff_per,b.color_number_id,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id  and a.booking_no=$txt_booking_no and a.booking_type=1 and c.body_part_id in(3) and a.status_active=1 and a.is_deleted=0");
		foreach($cuff_percent_size_wise_sql as $cuff_percent_size_wise_row)
		{
			$cuff_percent_size_wise_array[$cuff_percent_size_wise_row[csf('color_number_id')]][$cuff_percent_size_wise_row[csf('gmts_sizes')]]=$cuff_percent_size_wise_row[csf('colar_cuff_per')];
		}


		//print_r($cuff_percent_size_wise_array);
		$nameArray_item_size=sql_select( "select min(c.id) as id, b.item_size,c.size_number_id,	min(c.size_order) as size_order FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=3  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by size_order");


		if(count($nameArray_item_size)>0)
		{
        ?>
        <td width="49%">
        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
        <tr>
        <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Cuff -  Colour Size Brakedown in Pcs</b></td>
        </tr>
        <tr>
        <td width="70">Size</td>

        <?
		foreach($nameArray_item_size  as $result_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
		<?
        }
        ?>
        <td rowspan="2" align="center"><strong>Total</strong></td>
        <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
        </tr>
        <tr>
        <td>Cuff Size</td>

        <?
        foreach($nameArray_item_size  as $result_item_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
		<?
        }
        ?>
         <?

			$color_wise_wo_sql=sql_select("select a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id, c.color_order, sum(c.plan_cut_qnty) as plan_cut_qnty
			FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d
			WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=3  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and  d.status_active=1 and d.is_deleted=0
			group by c.color_number_id, c.color_order ,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method
			order by c.color_order");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
			$color_total_cuff=0;
			$color_total_cuff_order_qnty=0;
			$process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
			$constrast_color_arr=array();
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				$constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
				for($i=0;$i<count($constrast_color);$i++)
				{
					$constrast_color2=explode('_',$constrast_color[$i]);
					$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
				}
			}
		?>
			<tr>
            <td>
            <?
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]);
				$lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
			}
			else
			{
				echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
				$lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
			}
			?>

            </td>
            <?
            foreach($nameArray_item_size  as $result_size)
			{
				?>
				<td align="center" style="border:1px solid black">

				<?


				$color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0");



				list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
				$plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
				$cuff_excess_per=(($plan_cut*2)*$cuff_percent_size_wise_array[$color_wise_wo_result[csf('color_number_id')]][$result_size[csf('size_number_id')]])/100;
				echo number_format($plan_cut*2+$cuff_excess_per,0);
				$cuff_size_total[$result_size[csf('size_number_id')]]+=number_format($plan_cut*2+$cuff_excess_per,0,'','');
				//echo $cuff_percent_size_wise_array[$color_wise_wo_result[csf('color_number_id')]][$result_size[csf('size_number_id')]];
				$color_total_cuff+=$plan_cut*2+$cuff_excess_per;
				$color_total_cuff_order_qnty+=$plan_cut*2;
				$grand_total_cuff+=$plan_cut*2+$cuff_excess_per;
				$grand_total_cuff_order_qnty+=$plan_cut*2;
				?>

                </td>
				<?
			}
			?>

            <td align="center"><? echo number_format($color_total_cuff,0); ?></td>
            <td align="center"><? echo number_format((($color_total_cuff-$color_total_cuff_order_qnty)/$color_total_cuff_order_qnty)*100,2); ?></td>
            </tr>
            <?
		    }
			?>
            <tr>
                <td>Size Total</td>

                <?
                foreach($nameArray_item_size  as $result_size)
                {
                   /* $nameArray_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =$result_size[size_number_id]  and status_active=1 and is_deleted =0 order by id");
                foreach($nameArray_size_qnty as $result_size_qnty)
                {*/
                ?>
                <td style="border:1px solid black;  text-align:center">
				<?
				//$cuff_excess_pers=(($size_tatal[$result_size[csf('size_number_id')]]*2)*$cuff_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]*2+$cuff_excess_pers,0);
				echo number_format($cuff_size_total[$result_size[csf('size_number_id')]],0);
				?></td>
                <?
                //}
                }
                ?>
                <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_cuff,0); ?></td>
                <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_cuff-$grand_total_cuff_order_qnty)/$grand_total_cuff_order_qnty)*100,2); ?></td>
            </tr>
        </table>
        </td>
        <?
				}
		?>
        </tr>
        </table>
        <br/>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
        <tr>
        <?

		//echo "select a.colar_cuff_per,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id    and a.booking_no=$txt_booking_no and a.booking_type=1 c.body_part_id in(2) and a.status_active=1 and a.is_deleted=0";
		//$colar_percent_size_wise_array=return_library_array( "select a.colar_cuff_per,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id    and a.booking_no=$txt_booking_no and a.booking_type=1 and c.body_part_id in(2) and a.status_active=1 and a.is_deleted=0", "gmts_sizes", "colar_cuff_per");


		$colar_percent_size_wise_array=array();
		$colar_tipping_percent_size_wise_sql=sql_select( "select a.colar_cuff_per,b.color_number_id,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id    and a.booking_no=$txt_booking_no and a.booking_type=1 and c.body_part_id in(172) and a.status_active=1 and a.is_deleted=0");
		$colar_tipping_excess_percent_arr=array();
		foreach($colar_tipping_percent_size_wise_sql as $colar_percent_size_wise_row)
		{
			$colar_tipping_excess_percent_arr[$colar_percent_size_wise_row[csf('color_number_id')]][$colar_percent_size_wise_row[csf('gmts_sizes')]]=$colar_percent_size_wise_row[csf('colar_cuff_per')];
			//$colar_excess_percent_arr[$colar_percent_size_wise_row[csf('gmts_sizes')]]+=$colar_percent_size_wise_row[csf('colar_cuff_per')];

		}

		//print_r($colar_tipping_excess_percent_arr);
		$nameArray_item_size=sql_select( "select min(c.id) as id,b.item_size,c.size_number_id,	min(c.size_order) as size_order FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=172  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id  and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by size_order");


		if(count($nameArray_item_size)>0)
		{
        ?>
        <td width="49%">
        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
        <tr>
        <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Collar Tipping -  Colour Size Brakedown in Pcs</b></td>
        </tr>
        <tr>
        <td width="70">Size</td>

        <?

		/*$nameArray_item_size=sql_select( "select b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by c.size_number_id,b.item_size order by c.size_number_id");*/
		foreach($nameArray_item_size  as $result_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
		<?
        }
        ?>
        <td rowspan="2" align="center"><strong>Total</strong></td>
        <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
        </tr>
        <tr>
        <td>Collar Size</td>

        <?
        foreach($nameArray_item_size  as $result_item_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
		<?
        }

		$color_wise_wo_sql=sql_select("select a.id, a.job_no, a.color_size_sensitive, a.color_break_down, a.process_loss_method, c.color_number_id , c.color_order, sum(c.plan_cut_qnty) as plan_cut_qnty
		FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c, wo_booking_dtls d
		WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=172 and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 and c.status_active=1 and c.is_deleted=0
		group by c.color_number_id, c.color_order, a.id, a.job_no, a.color_size_sensitive,a.color_break_down, a.process_loss_method
		order by c.color_order ");

		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
			$color_total_collar=0;
			$color_total_collar_order_qnty=0;
			$process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
			$constrast_color_arr=array();
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				$constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
				for($i=0;$i<count($constrast_color);$i++)
				{
					$constrast_color2=explode('_',$constrast_color[$i]);
					$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
				}
			}
		?>
			<tr>
            <td>
            <?
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]) ;
				$lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
			}
			else
			{
				echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
				$lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
			}
			?>

            </td>
            <?
            foreach($nameArray_item_size  as $result_size)
			{
				?>
				<td align="center" style="border:1px solid black">
				<?

				$color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0 ");




				list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
				$plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
				$colar_tipping_excess_per=($plan_cut*$colar_tipping_excess_percent_arr[$color_wise_wo_result[csf('color_number_id')]][$result_size[csf('size_number_id')]])/100;
				echo number_format($plan_cut+$colar_tipping_excess_per,0);
				$collar_tiff_size_total_arr[$result_size[csf('size_number_id')]]+=number_format($plan_cut+$colar_tipping_excess_per,0,'','');
				$color_tipping_total_collar+=$plan_cut+$colar_tipping_excess_per;
				$color_tipping_total_collar_order_qnty+=$plan_cut;
				$grand_total_collar_tipping+=$plan_cut+$colar_tipping_excess_per;
				$grand_total_collar_tipping_order_qnty+=$plan_cut;



				?>
                </td>
				<?
			}
			?>

            <td align="center"><? echo number_format($color_tipping_total_collar,0); ?></td>
            <td align="center"><? echo number_format((($color_tipping_total_collar-$color_tipping_total_collar_order_qnty)/$color_tipping_total_collar_order_qnty)*100,2); ?></td>
            </tr>
            <?
		    }
			?>
            <tr>
                <td>Size Total</td>

                <?
                foreach($nameArray_item_size  as $result_size)
                {
                ?>
                <td style="border:1px solid black;  text-align:center">
				<?
				//$colar_excess_pers=($size_tatal[$result_size[csf('size_number_id')]]*$colar_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]+$colar_excess_pers,0);
				echo number_format($collar_tiff_size_total_arr[$result_size[csf('size_number_id')]],0);

				?></td>
                <?
                }
                ?>
                <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_collar_tipping,0); ?></td>
                <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_collar_tipping-$grand_total_collar_tipping_order_qnty)/$grand_total_collar_tipping_order_qnty)*100,2); ?></td>
            </tr>
        </table>
        </td>
        <td width="2%">
        </td>
        <?
        }

		$cuff_tipping_percent_size_wise_array=$cuff_size_total=array();
		$cuff_tipping_percent_size_wise_sql=sql_select( "select a.colar_cuff_per,b.color_number_id,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id  and a.booking_no=$txt_booking_no and a.booking_type=1 and c.body_part_id in(214) and a.status_active=1 and a.is_deleted=0");
		foreach($cuff_tipping_percent_size_wise_sql as $cuff_percent_size_wise_row)
		{
			$cuff_tipping_percent_size_wise_array[$cuff_percent_size_wise_row[csf('color_number_id')]][$cuff_percent_size_wise_row[csf('gmts_sizes')]]=$cuff_percent_size_wise_row[csf('colar_cuff_per')];
		}


		//print_r($cuff_tipping_percent_size_wise_array);
		$nameArray_item_size=sql_select( "select min(c.id) as id, b.item_size,c.size_number_id,	min(c.size_order) as size_order FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=214  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by size_order");


		if(count($nameArray_item_size)>0)
		{
        ?>
        <td width="49%">
        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
        <tr>
        <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Cuff -  Colour Size Brakedown in Pcs</b></td>
        </tr>
        <tr>
        <td width="70">Size</td>

        <?
		foreach($nameArray_item_size  as $result_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
		<?
        }
        ?>
        <td rowspan="2" align="center"><strong>Total</strong></td>
        <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
        </tr>
        <tr>
        <td>Cuff Size</td>

        <?
        foreach($nameArray_item_size  as $result_item_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
		<?
        }
        ?>
         <?

			$color_wise_wo_sql=sql_select("select a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id, c.color_order, sum(c.plan_cut_qnty) as plan_cut_qnty
			FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d
			WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=214  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and  d.status_active=1 and d.is_deleted=0
			group by c.color_number_id, c.color_order ,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method
			order by c.color_order");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
			$color_total_cuff=0;
			$color_total_cuff_order_qnty=0;
			$process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
			$constrast_color_arr=array();
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				$constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
				for($i=0;$i<count($constrast_color);$i++)
				{
					$constrast_color2=explode('_',$constrast_color[$i]);
					$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
				}
			}
		?>
			<tr>
            <td>
            <?
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]);
				$lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
			}
			else
			{
				echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
				$lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
			}
			?>

            </td>
            <?
            foreach($nameArray_item_size  as $result_size)
			{
				?>
				<td align="center" style="border:1px solid black">

				<?


				$color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0");



				list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
				$plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
				$cuff_tipping_excess_per=(($plan_cut*2)*$cuff_tipping_percent_size_wise_array[$color_wise_wo_result[csf('color_number_id')]][$result_size[csf('size_number_id')]])/100;
				echo number_format($plan_cut*2+$cuff_tipping_excess_per,0);
				$cuff_tiffing_size_total[$result_size[csf('size_number_id')]]+=number_format($plan_cut*2+$cuff_tipping_excess_per,0,'','');
				//echo $cuff_tipping_percent_size_wise_array[$color_wise_wo_result[csf('color_number_id')]][$result_size[csf('size_number_id')]];
				$color_total_cuff_tiffing+=$plan_cut*2+$cuff_tipping_excess_per;
				$color_total_cuff_tiffing_order_qnty+=$plan_cut*2;
				$grand_total_cuff_tiffing+=$plan_cut*2+$cuff_tipping_excess_per;
				$grand_total_cuff_tiffing_order_qnty+=$plan_cut*2;
				?>

                </td>
				<?
			}
			?>

            <td align="center"><? echo number_format($color_total_cuff_tiffing,0); ?></td>
            <td align="center"><? echo number_format((($color_total_cuff_tiffing-$color_total_cuff_tiffing_order_qnty)/$color_total_cuff_tiffing_order_qnty)*100,2); ?></td>
            </tr>
            <?
		    }
			?>
            <tr>
                <td>Size Total</td>

                <?
                foreach($nameArray_item_size  as $result_size)
                {
                   /* $nameArray_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =$result_size[size_number_id]  and status_active=1 and is_deleted =0 order by id");
                foreach($nameArray_size_qnty as $result_size_qnty)
                {*/
                ?>
                <td style="border:1px solid black;  text-align:center">
				<?
				//$cuff_excess_pers=(($size_tatal[$result_size[csf('size_number_id')]]*2)*$cuff_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]*2+$cuff_excess_pers,0);
				echo number_format($cuff_tiffing_size_total[$result_size[csf('size_number_id')]],0);
				?></td>
                <?
                //}
                }
                ?>
                <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_cuff_tiffing,0); ?></td>
                <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_cuff_tiffing-$grand_total_cuff_tiffing_order_qnty)/$grand_total_cuff_tiffing_order_qnty)*100,2); ?></td>
            </tr>
        </table>
        </td>
        <?
				}
		?>
        </tr>
        </table>
        <br/>
        <?

		$condition= new condition();
		if(str_replace("'","",$job_no) !=''){
			$condition->job_no("='$job_no'");
		}
		$condition->init();
		$yarn= new yarn($condition);
		$yarn_data_array=$yarn->getCountCompositionPercentTypeColorAndRateWiseYarnQtyAndAmountArray();

		$yarn_count_arr=return_library_array( "select id,yarn_count from lib_yarn_count",'id','yarn_count');
		$yarn_sql_array=sql_select("SELECT min(id) as id ,count_id, copm_one_id, percent_one,copm_two_id, percent_two, color, type_id, sum(cons_qnty) as yarn_required, AVG(rate) as rate from wo_pre_cost_fab_yarn_cost_dtls where job_no='$job_no' and  status_active=1 and is_deleted=0 group by count_id,copm_one_id,percent_one, copm_two_id,percent_two,color,type_id order by id");
		?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
            <tr>
                <td width="49%" valign="top">
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    	<td colspan="5"><b>Yarn Required Summary (Pre Cost)</b></td>
                    </tr>
                    <tr align="center">
                        <td>Sl</td>
                        <td>Yarn Description</td>
                        <?
                        if($show_yarn_rate==1)
                        {
                        ?>
                        <td>Rate</td>
                        <?
                        }
                        ?>
                        <td>Cons for <? echo $costing_per; ?> Gmts</td>
                        <td>Total (KG)</td>
                    </tr>
                    <?
					$i=0;
					$total_yarn=0;
					foreach($yarn_sql_array  as $row)
                    {
						$i++;
						$rowcons_qnty = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['qty'];
						?>
						<tr align="center">
                            <td><? echo $i; ?></td>
                            <td>
                            <?
                            $yarn_des=$yarn_count_arr[$row[csf('count_id')]]." ".$composition[$row[csf('copm_one_id')]]." ".$row[csf('percent_one')]."%  ";
                            if($row['copm_two_id'] !=0)
                            {
                                $yarn_des.=$composition[$row[csf('copm_two_id')]]." ".$row[csf('percent_two')]."%";
                            }
                            $yarn_des.=$color_library[$row[csf('color')]]." ";
                            $yarn_des.=$yarn_type[$row[csf('type_id')]];
                            //echo $yarn_count_arr[$row['count_id']]." ".$composition[$row['copm_one_id']]." ".$row['percent_one']."%  ".$composition[$row['copm_two_id']]." ".$row['percent_two']."%  ".$yarn_type[$row['type_id']];
                            echo $yarn_des;
                            ?>
                            </td>
                            <?
                            if($show_yarn_rate==1)
                            {
                            ?>
                             <td><? echo number_format($row[csf('rate')],4); ?></td>
                             <?
                            }
                             ?>
                            <td><? echo number_format($row[csf('yarn_required')],4); ?></td>

                            <!--<td><? //echo number_format(($row['yarn_required']/$po_qnty_tot)*$costing_per_qnty,2); ?></td>-->
                            <td align="right"><? echo number_format($rowcons_qnty,2); $total_yarn+=$rowcons_qnty; ?></td>
						</tr>
						<?
					}
					?>
                    <tr align="center">
                        <td></td>
                        <td></td>
                        <?
                        if($show_yarn_rate==1)
                        {
                        ?>
                        <td></td>
                        <?
                        }
                        ?>
                        <td align="right">Total : </td>
                        <td align="right"><? echo number_format($total_yarn,2); ?></td>
                    </tr>
                    </table>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top" align="center">
                <?
				$yarn_sql_array=sql_select("SELECT min(a.id) as id, a.item_id, sum(a.qnty) as qnty ,min(b.supplier_id) as supplier_id,min(b.lot) as lot from inv_material_allocation_dtls a,product_details_master b where a.item_id=b.id and a.booking_no=$txt_booking_no and  a.status_active=1 and a.is_deleted=0 group by a.item_id order by a.id");
				if(count($yarn_sql_array)>0)
				{
				?>
                   <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td colspan="7"><b>Allocated Yarn</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Yarn Description</td>
                    <td>Brand</td>
                    <td>Lot</td>


                    <td>Allocated Qty (Kg)</td>
                    </tr>
                    <?
					$total_allo=0;
					$item=return_library_array( "select id, product_name_details from   product_details_master",'id','product_name_details');
					$supplier=return_library_array( "select id, short_name from   lib_supplier",'id','short_name');
					//$yarn_sql_array=sql_select("SELECT a.item_id, a.qnty,b.supplier_id,b.lot from inv_material_allocation_dtls a,product_details_master b where a.item_id=b.id and a.booking_no=$txt_booking_no and  a.status_active=1 and a.is_deleted=0");
					$i=0;
					$total_yarn=0;
					foreach($yarn_sql_array  as $row)
                    {

						$i++;
					?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
					<?

					echo $item[$row[csf('item_id')]];
					?>
                    </td>
                    <td>
                    <?

					echo $supplier[$row[csf('supplier_id')]];
					?>
                    </td>
                    <td>
					<?

					echo $row[csf('lot')];
					?>
                    </td>
                    <td align="right"><? echo number_format($row[csf('qnty')],4); $total_allo+= $row[csf('qnty')];?></td>
                    </tr>
                    <?
					}
					?>
                    <tr align="center">
                    <td>Total</td>
                    <td></td>


                    <td></td>
                    <td></td>
                    <td align="right"><? echo number_format($total_allo,4); ?></td>
                    </tr>
                    </table>
                    <?
				}
				else
				{
					$is_yarn_allocated=return_field_value("allocation", "variable_settings_inventory", "company_name=$cbo_company_name and variable_list=18 and item_category_id=1");
					if($is_yarn_allocated==1)
					{
					?>
					<font style=" font-size:30px"><b> Draft</b></font>
                    <?
					}
					else
					{
						echo "";
					}
				}
					?>
                </td>
            </tr>
        </table>
        <br/>


        <?
		$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
		?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
            <tr>
                <td width="49%" valign="top">
                <?
				if(count($sql_embelishment)>0)
				{
				?>
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td colspan="7"><b>Embelishment (Pre Cost)</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Embelishment Name</td>
                    <td>Embelishment Type</td>
                    <td>Cons <? echo $costing_per; ?> Gmts</td>
                    <td>Rate</td>
                    <td>Amount</td>

                    </tr>
                    <?
					$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
					$i=0;
					//$total_yarn=0;
					foreach($sql_embelishment  as $row_embelishment)
                    {

						$i++;
					?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
					<?
					echo $emblishment_name_array[$row_embelishment[csf('emb_name')]];
					?>
                    </td>
                    <td>
                    <?
					if($row_embelishment[csf('emb_name')]==1)
					{
					echo $emblishment_print_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==2)
					{
					echo $emblishment_embroy_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==3)
					{
					echo $emblishment_wash_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==4)
					{
					echo $emblishment_spwork_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==5)
					{
					echo $row_embelishment[csf('emb_type')];
					}
					?>

                    </td>
                    <td>
                    <?
					echo $row_embelishment[csf('cons_dzn_gmts')];
					?>
                    </td>
                    <td>
					<?
					echo $row_embelishment[csf('rate')];
					?>
                    </td>

                    <td>
					<?
					echo $row_embelishment[csf('amount')];
					?>
                    </td>


                    </tr>
                    <?
					}
					?>
                 <!--   <tr align="center">
                    <td>Total</td>
                    <td></td>
                    <td></td>
                    <td></td>

                    <td></td>

                    <td></td>

                    </tr>-->
                    </table>
                    <?
				}
					?>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top" align="center">
                <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td><b>Approved Instructions</b></td>

                    </tr>
                    <tr>
                    <td>
                <?  echo $nameArray_approved_comments_row[csf('comments')];  ?>
                </td>
                </tr>
                </table>

                </td>
            </tr>
        </table>
        <br/>



        <table  width="100%"  border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td width="49%" style="border:solid; border-color:#000; border-width:thin" valign="top">
                    <table  width="100%"  border="0" cellpadding="0" cellspacing="0">
                	<thead>
                    	<tr>
                        	<th width="3%"></th><th width="97%" align="left"><u>Special Instruction</u></th>
                        </tr>
                    </thead>
                    <tbody>
                    <?
					$data_array=sql_select("select id, terms from  wo_booking_terms_condition where booking_no=$txt_booking_no");// quotation_id='$data'
					if ( count($data_array)>0)
					{
						$i=0;
						foreach( $data_array as $row )
						{
							$i++;
							?>
                            	<tr id="settr_1" valign="top">
                                    <td style="vertical-align:top">
                                    <? echo $i;?>
                                    </td>
                                    <td>
                                   <strong style="font-size:20px"> <? echo $row[csf('terms')]; ?></strong>
                                    </td>
                                </tr>
                            <?
						}
					}
					/*else
					{
				    $i=0;
					$data_array=sql_select("select id, terms from  lib_terms_condition");// quotation_id='$data'
					foreach( $data_array as $row )
						{
							$i++;
					?>
                    <tr id="settr_1" align="">
                                    <td valign="top">
                                    <? echo $i;?>
                                    </td>
                                    <td>
                                    <? echo $row['terms']; ?>
                                    </td>

                                </tr>
                    <?
						}
					} */
					?>
                </tbody>
                </table>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top">
                   <table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                   <tr align="center">
                    <td colspan="10"><b>Comments</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Po NO</td>
                    <td>Ship Date</td>
                    <td>Pre-Cost Qty</td>
                    <td>Mn.Book Qty</td>
                    <td>Sht.Book Qty</td>
                    <td>Smp.Book Qty</td>
                    <td>Tot.Book Qty</td>
                    <td>Balance</td>
                    <td>Comments</td>
                    </tr>
                    <?
	$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
	$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
	if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
	if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
	$paln_cut_qnty_array=return_library_array( "select min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id,size_number_id,item_number_id,po_break_down_id", "id", "plan_cut_qnty");

	$item_ratio_array=return_library_array( "select gmts_item_id,set_item_ratio from wo_po_details_mas_set_details  where job_no =$txt_job_no", "gmts_item_id", "set_item_ratio");

	//------------------------------ Query for TNA start-----------------------------------
				$po_id_all=str_replace("'","",$txt_order_no_id);
				$po_num_arr=return_library_array("select id,po_number from wo_po_break_down where id in($po_id_all)",'id','po_number');
				$tna_start_sql=sql_select( "select id,po_number_id,
								(case when task_number=31 then task_start_date else null end) as fab_booking_start_date,
								(case when task_number=31 then task_finish_date else null end) as fab_booking_end_date,
								(case when task_number=60 then task_start_date else null end) as knitting_start_date,
								(case when task_number=60 then task_finish_date else null end) as knitting_end_date,
								(case when task_number=61 then task_start_date else null end) as dying_start_date,
								(case when task_number=61 then task_finish_date else null end) as dying_end_date,
								(case when task_number=73 then task_start_date else null end) as finishing_start_date,
								(case when task_number=73 then task_finish_date else null end) as finishing_end_date,
								(case when task_number=84 then task_start_date else null end) as cutting_start_date,
								(case when task_number=84 then task_finish_date else null end) as cutting_end_date,
								(case when task_number=86 then task_start_date else null end) as sewing_start_date,
								(case when task_number=86 then task_finish_date else null end) as sewing_end_date,
								(case when task_number=110 then task_start_date else null end) as exfact_start_date,
								(case when task_number=110 then task_finish_date else null end) as exfact_end_date,
								(case when task_number=47 then task_start_date else null end) as yarn_rec_start_date,
								(case when task_number=47 then task_finish_date else null end) as yarn_rec_end_date
								from tna_process_mst
								where status_active=1 and po_number_id in($po_id_all)");
				$tna_fab_start=$tna_knit_start=$tna_dyeing_start=$tna_fin_start=$tna_cut_start=$tna_sewin_start=$tna_exfact_start="";
				$tna_date_task_arr=array();
				foreach($tna_start_sql as $row)
				{
					if($row[csf("fab_booking_start_date")]!="" && $row[csf("fab_booking_start_date")]!="0000-00-00")
					{
						if($tna_fab_start=="")
						{
							$tna_fab_start=$row[csf("fab_booking_start_date")];
						}
					}


					if($row[csf("knitting_start_date")]!="" && $row[csf("knitting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_start_date']=$row[csf("knitting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_end_date']=$row[csf("knitting_end_date")];
					}
					if($row[csf("dying_start_date")]!="" && $row[csf("dying_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['dying_start_date']=$row[csf("dying_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['dying_end_date']=$row[csf("dying_end_date")];
					}
					if($row[csf("finishing_start_date")]!="" && $row[csf("finishing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_start_date']=$row[csf("finishing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_end_date']=$row[csf("finishing_end_date")];
					}
					if($row[csf("cutting_start_date")]!="" && $row[csf("cutting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_start_date']=$row[csf("cutting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_end_date']=$row[csf("cutting_end_date")];
					}
					if($row[csf("sewing_start_date")]!="" && $row[csf("sewing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_start_date']=$row[csf("sewing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_end_date']=$row[csf("sewing_end_date")];
					}
					if($row[csf("exfact_start_date")]!="" && $row[csf("exfact_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_start_date']=$row[csf("exfact_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_end_date']=$row[csf("exfact_end_date")];
					}
					if($row[csf("yarn_rec_start_date")]!="" && $row[csf("yarn_rec_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_start_date']=$row[csf("yarn_rec_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_end_date']=$row[csf("yarn_rec_end_date")];
					}
				}

	//------------------------------ Query for TNA end-----------------------------------

	$nameArray=sql_select("
	select
	a.id,
	a.item_number_id,
	a.costing_per,
	b.po_break_down_id,
	b.color_size_table_id,
	b.requirment,
	c.po_number
FROM
	wo_pre_cost_fabric_cost_dtls a,
	wo_pre_cos_fab_co_avg_con_dtls b,
	wo_po_break_down c
WHERE
	a.job_no=b.job_no and
	a.job_no=c.job_no_mst and
    a.id=b.pre_cost_fabric_cost_dtls_id and
	b.po_break_down_id=c.id and
	b.po_break_down_id in (".str_replace("'","",$txt_order_no_id).")  $cbo_fabric_natu $cbo_fabric_source_cond and a.status_active=1 and a.is_deleted=0
	order by id");

	$count=0;
	$tot_grey_req_as_pre_cost_arr=array();
	foreach ($nameArray as $result)
	{
		if (count($nameArray)>0 )
		{
            if($result[csf("costing_per")]==1)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(12*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			if($result[csf("costing_per")]==2)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(1*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			if($result[csf("costing_per")]==3)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(24*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			if($result[csf("costing_per")]==4)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(36*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			if($result[csf("costing_per")]==5)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(48*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			$tot_grey_req_as_pre_cost_arr[$result[csf("po_number")]]+=$tot_grey_req_as_pre_cost;
        }
    }
	                $total_pre_cost=0;
					$total_booking_qnty_main=0;
					$total_booking_qnty_short=0;
					$total_booking_qnty_sample=0;
					$total_tot_bok_qty=0;
					$tot_balance=0;

					/*$booking_qnty=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and booking_type in(1,4)  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by a.po_break_down_id", "po_break_down_id", "grey_fab_qnty");*/
					//$booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and a.is_short=2 and c.item_category=2 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

					$booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and a.is_short=2 and c.item_category=2 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

					$booking_qnty_short=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and c.item_category=2 and a.is_short=1 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
					$booking_qnty_sample=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c  where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =4 and c.fabric_source=$cbo_fabric_source and c.item_category=2  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
					$sql_data=sql_select( "select max(a.id) as id,  a.po_number,max(a.pub_shipment_date) as pub_shipment_date,sum(a.plan_cut) as plan_cut  from wo_po_break_down a,wo_pre_cost_sum_dtls b,wo_pre_cost_mst c where a.job_no_mst=b.job_no and a.job_no_mst=c.job_no and a.id in(".str_replace("'","",$txt_order_no_id).") group by a.po_number order by id");
					foreach($sql_data  as $row)
                    {
					$col++;
					?>
                    <tr align="center">
                    <td><? echo $col; ?></td>
                    <td><? echo $row[csf("po_number")]; ?></td>
                     <td><? echo change_date_format($row[csf("pub_shipment_date")],"dd-mm-yyyy",'-'); ?></td>
                    <td align="right"><? echo number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]],2); $total_pre_cost+=$tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]; ?></td>
                    <td align="right"><? echo number_format($booking_qnty_main[$row[csf("id")]],2); $total_booking_qnty_main+=$booking_qnty_main[$row[csf("id")]];?></td>
                    <td align="right"><? echo number_format($booking_qnty_short[$row[csf("id")]],2); $total_booking_qnty_short+=$booking_qnty_short[$row[csf("id")]];?></td>
                    <td align="right"><? echo number_format($booking_qnty_sample[$row[csf("id")]],2); $total_booking_qnty_sample+=$booking_qnty_sample[$row[csf("id")]];?></td>
                    <td align="right"><? $tot_bok_qty=$booking_qnty_main[$row[csf("id")]]+$booking_qnty_short[$row[csf("id")]]+$booking_qnty_sample[$row[csf("id")]]; echo number_format($tot_bok_qty,2); $total_tot_bok_qty+=$tot_bok_qty;?></td>
                    <td align="right">
					<? $balance= def_number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]-$tot_bok_qty,2,""); echo number_format($balance,2); $tot_balance+= $balance?>
                    </td>
                    <td>
					<?
					if( $balance>0)
					{
						echo "Less Booking";
					}
					else if ($balance<0)
					{
						echo "Over Booking";
					}
					else
					{
						echo "";
					}
					?>
                    </td>
                    </tr>
                    <?
					}
					?>
                    <tfoot>
                    <tr>
                    <td colspan="3">Total:</td>
                    <td align="right"><? echo number_format($total_pre_cost,2); ?></td>
                    <td align="right"><? echo number_format($total_booking_qnty_main,2); ?></td>
                    <td align="right"><? echo number_format($total_booking_qnty_short,2); ?></td>
                    <td align="right"><? echo number_format($total_booking_qnty_sample,2); ?></td>
                     <td align="right"><? echo number_format($total_tot_bok_qty,2); ?></td>
                    <td align="right"><? echo number_format($tot_balance,2); ?></td>
                    <td></td>
                    </tr>
                    </tfoot>
                    </table>
                </td>

            </tr>
        </table>
       <br>

<fieldset id="div_size_color_matrix" style="max-width:1000;">
        <legend>TNA Information</legend>
        <!--<span style="font-size:180; font-weight:bold;"></span>-->
        <table width="100%" style="border:1px solid black;font-size:12px" border="1" cellpadding="2" cellspacing="0" rules="all">
            <tr>
            	<td rowspan="2" align="center" valign="top">SL</td>
            	<td width="180" rowspan="2"  align="center" valign="top"><b>Order No</b></td>
                <td colspan="2" align="center" valign="top"><b>Yarn Receive</b></td>
                <td colspan="2" align="center" valign="top"><b>Knitting</b></td>
                <td colspan="2" align="center" valign="top"><b>Dyeing</b></td>
                <td colspan="2" align="center" valign="top"><b>Finishing Fabric</b></td>
                <td colspan="2" align="center" valign="top"><b>Cutting </b></td>
                <td colspan="2" align="center" valign="top"><b>Sewing </b></td>
                <td colspan="2"  align="center" valign="top"><b>Ex-factory </b></td>
            </tr>
            <tr>
            	<td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>

            </tr>
            <?
			$i=1;
			foreach($tna_date_task_arr as $order_id=>$row)
			{
				 //$tna_date_task_arr//knitting_start_date dying_start_date finishing_start_date cutting_start_date sewing_start_date exfact_start_date
				?>
                <tr>
                	<td><? echo $i; ?></td>
                    <td><? echo $po_num_arr[$order_id]; ?></td>
                    <td align="center"><? echo change_date_format($row['yarn_rec_start_date']); ?></td>
                    <td  align="center"><? echo change_date_format($row['yarn_rec_end_date']); ?></td>
                	<td align="center"><? echo change_date_format($row['knitting_start_date']); ?></td>
                    <td  align="center"><? echo change_date_format($row['knitting_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['dying_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['dying_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['cutting_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['cutting_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['sewing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['sewing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['exfact_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['exfact_end_date']); ?></td>
                </tr>
                <?
				$i++;
			}
			?>

        </table>
        </fieldset>



        <?
		}// fabric Source End

		if($cbo_fabric_source==2)
		{
			?>
            <table  width="100%"  border="1" cellpadding="0" cellspacing="0">
                <thead>
                    <tr>
                    	<th width="3%"></th><th width="97%" align="left"><u>Special Instruction</u></th>
                    </tr>
                </thead>
                <tbody>
                <?
                $data_array=sql_select("select id, terms from  wo_booking_terms_condition where booking_no=$txt_booking_no");// quotation_id='$data'
                if ( count($data_array)>0)
                {
                    $i=0;
                    foreach( $data_array as $row )
                    {
                        $i++;
                        ?>
                        <tr id="settr_1" valign="top">
                            <td style="vertical-align:top">
                            <? echo $i;?>
                            </td>
                            <td>
                            <strong style="font-size:20px"> <? echo $row[csf('terms')]; ?></strong>
                            </td>
                        </tr>
                        <?
                    }
                }
                ?>
                </tbody>
            </table>
            <?
		}
		echo signature_table(1, $cbo_company_name, "1330px");
		?>
       </div>
       <?

}



if($action=="show_fabric_booking_report_urmi")
{
	extract($_REQUEST);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
	$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	//$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$marchentrArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info ","id","team_member_name");
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$location_name_arr=return_library_array( "select id,location_name from lib_location",'id','location_name');
	$po_qnty_tot=return_field_value( "sum(plan_cut)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	$po_qnty_tot1=return_field_value( "sum(po_quantity)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	$pro_sub_dept_array=return_library_array( "select id,sub_department_name from lib_pro_sub_deparatment",'id','sub_department_name');
	?>
	<div style="width:1330px" align="center">
    <?php
$nameArray_approved = sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7");
list($nameArray_approved_row) = $nameArray_approved;
$nameArray_approved_date = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
list($nameArray_approved_date_row) = $nameArray_approved_date;
$nameArray_approved_comments = sql_select("select b.comments as comments from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
list($nameArray_approved_comments_row) = $nameArray_approved_comments;
?>										<!--    Header Company Information         -->
       <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black" >
           <tr>
               <td width="100">
               <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
               </td>
               <td width="1250">
                    <table width="100%" cellpadding="0" cellspacing="0"  >
                        <tr>
                            <td align="center" style="font-size:20px;">
                              <?php
echo $company_library[$cbo_company_name];
?>
                            </td>
                            <td rowspan="3" width="250">

                               <span style="font-size:18px"><b> Job No:&nbsp;&nbsp;<? echo trim($txt_job_no,"'"); ?></b></span><br/>
                                <?
								 if($nameArray_approved_row[csf('approved_no')]>1)
								 {
								 ?>
								 <b> Revised No: <? echo $nameArray_approved_row[csf('approved_no')]-1; ?></b>
                                  <br/>
								  Approved Date: <? echo $nameArray_approved_date_row[csf('approved_date')]; ?>
								  <?
								 }
							  	?>


                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:14px">
                            <?
                            $nameArray=sql_select( "select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
							//$location=return_field_value("location_name","lib_location","id=$data[3]" );
							//$nameArray=sql_select("select location_name from wo_po_details_master where job_no=$txt_job_no");
							if($txt_job_no!="")
							{
							 $location=return_field_value( "location_name", "wo_po_details_master","job_no='$txt_job_no'");
							}
							else
							{
							$location="";
							}

							foreach ($nameArray as $result)
                            {
							 echo  $location_name_arr[$location];
                            ?>

                               <!-- Plot No: <? //echo $result[csf('plot_no')]; ?>
                                Level No: <? //echo $result[csf('level_no')]?>
                                Road No: <? //echo $result[csf('road_no')]; ?>
                                Block No: <? //echo $result[csf('block_no')];?>
                                City No: <? //echo $result[csf('city')];?>
                                Zip Code: <? //echo $result[csf('zip_code')]; ?>
                                Province No: <?php //echo $result[csf('province')];?>
                                Country: <? //echo $country_arr[$result[csf('country_id')]]; ?> --><br>
                                Email Address: <? echo $result[csf('email')];?>
                                Website No: <? echo $result[csf('website')]; ?>

                                <?

                            }

                            ?>
                               </td>
                            </tr>
                            <tr>
                            <td align="center" style="font-size:20px">
                                <strong><? if($report_title !=""){ echo $report_title;} else { echo "General Work Order";}?> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style="color:#F00"><? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </font></strong>
                             </td>
                            </tr>
                      </table>
                </td>
            </tr>
       </table>
                <?
				$uom=0;
				$job_no='';
				$total_set_qnty=0;
				$colar_excess_percent=0;
				$cuff_excess_percent=0;
				$rmg_process_breakdown=0;
                $nameArray=sql_select( "select a.booking_no,a.booking_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.delivery_date,a.po_break_down_id,a.colar_excess_percent,a.cuff_excess_percent,a.delivery_date,a.is_apply_last_update,a.fabric_source,a.pay_mode,a.rmg_process_breakdown,a.insert_date,a.update_date,a.uom,b.job_no,b.buyer_name, b.style_ref_no ,b.gmts_item_id,b.order_uom,b.total_set_qnty,b.style_description,b.season_matrix,b.order_repeat_no,b.product_dept,b.product_code,b.pro_sub_dep,b.dealing_marchant, b.qlty_label from wo_booking_mst a, wo_po_details_master b where  a.job_no=b.job_no and a.booking_no=$txt_booking_no");
				foreach ($nameArray as $result)
				{
					$total_set_qnty=$result[csf('total_set_qnty')];
					$colar_excess_percent=$result[csf('colar_excess_percent')];
				    $cuff_excess_percent=$result[csf('cuff_excess_percent')];
					$rmg_process_breakdown=$result[csf('rmg_process_breakdown')];
					$po_no="";
					$shipment_date="";
					$sql_po= "select po_number,MIN(pub_shipment_date) pub_shipment_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by po_number";
					$data_array_po=sql_select($sql_po);
					foreach ($data_array_po as $row_po)
					{
						$po_no.=$row_po[csf('po_number')].", ";
						$shipment_date.=change_date_format($row_po[csf('pub_shipment_date')],'dd-mm-yyyy','-').", ";
					}
					$lead_time="";
					if($db_type==0)
					{
					$sql_lead_time= "select DATEDIFF(pub_shipment_date,po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}
					if($db_type==2)
					{
					$sql_lead_time= "select (pub_shipment_date-po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}
					$data_array_lead_time=sql_select($sql_lead_time);
					foreach ($data_array_lead_time as $row_lead_time)
					{
						$lead_time.=$row_lead_time[csf('date_diff')].",";
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}
					$po_received_date="";
					$sql_po_received_date= "select MIN(po_received_date) as po_received_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					$data_array_po_received_date=sql_select($sql_po_received_date);
					foreach ($data_array_po_received_date as $row_po_received_date)
					{
						$po_received_date=change_date_format($row_po_received_date[csf('po_received_date')],'dd-mm-yyyy','-');
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}






					$sql_po= "select po_number,MIN(pub_shipment_date) pub_shipment_date, MIN(insert_date) as insert_date,shiping_status from wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by po_number,shiping_status";
					$data_array_po=sql_select($sql_po);
					foreach ($data_array_po as $rows)
					{
						$daysInHand.=(datediff('d',date('d-m-Y',time()),$rows[csf('pub_shipment_date')])-1).",";
						$booking_date=$result[csf('update_date')];
						if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
						{
							$booking_date=$result[csf('insert_date')];
						}
						$WOPreparedAfter.=(datediff('d',$rows[csf('insert_date')],$booking_date)-1).",";

						if($rows[csf('shiping_status')]==1)
						{
						$shiping_status.= "FP".",";
						}
						else if($rows[csf('shiping_status')]==2)
						{
						$shiping_status.= "PS".",";
						}
						else if($rows[csf('shiping_status')]==3)
						{
						$shiping_status.= "FS".",";
						}

					}

				if($db_type==2) $group_concat_all=" listagg(cast(b.grouping as varchar2(4000)),',') within group (order by b.grouping) as grouping,
	                                    listagg(cast(b.file_no as varchar2(4000)),',') within group (order by b.file_no) as file_no  ";
				else { $group_concat_all="group_concat(b.grouping) as grouping, group_concat(b.file_no) as file_no";}
				$data_array3=sql_select("select a.job_no,a.company_name,a.buyer_name,$group_concat_all from wo_po_details_master a, wo_po_break_down b where b.id in (".$result[csf('po_break_down_id')].") and a.job_no=b.job_no_mst group by a.job_no,a.company_name,a.buyer_name");
				//$sql_grouping= "select grouping, file_no  from wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by ";

				?>
       <table width="100%" style="border:1px solid black" >
            <tr>
                <td colspan="6" valign="top" style="font-size:18px; color:#F00"><? if($result[csf('is_apply_last_update')]==2){echo "Booking Info not synchronized with order entry and pre-costing. order entry or pre-costing has updated after booking entry.  Contact to ".$marchentrArr[$result[csf('dealing_marchant')]]; } else{ echo "";} ?></td>
            </tr>
            <tr>
                <td width="200"><span style="font-size:18px"><b>Buyer/Agent Name</b></span></td>
                <td width="220">:&nbsp;<span style="font-size:18px"><b><? echo $buyer_name_arr[$result[csf('buyer_name')]]; ?></b></span></td>
                <td width="200"><span style="font-size:12px"><b>Dept.</b></span></td>
                <td width="220">:&nbsp;<? echo $product_dept[$result[csf('product_dept')]] ; if($result[csf('product_code')] !=""){ echo " (".$result[csf('product_code')].")";} if($result[csf('pro_sub_dep')] !=0){ echo " (".$pro_sub_dept_array[$result[csf('pro_sub_dep')]].")";}?></td>
                <td width="200"><span style="font-size:12px"><b>Order Qnty</b></span></td>
                <td>:&nbsp; <?  echo $po_qnty_tot1." ".$unit_of_measurement[$result[csf('order_uom')]] ; ?> </td>
            </tr>
            <tr>

                <td style="font-size:12px"><b>Garments Item</b></td>
                <td>:&nbsp;
				<?
				$gmts_item_name="";
				$gmts_item=explode(',',$result[csf('gmts_item_id')]);
				for($g=0;$g<=count($gmts_item); $g++)
				{
					$gmts_item_name.= $garments_item[$gmts_item[$g]].",";
				}
				echo rtrim($gmts_item_name,',');
				?>
                </td>
                <td style="font-size:12px"><b>Booking Release Date</b></td>
                <td>:&nbsp;
				<?
				$booking_date=$result[csf('update_date')];
				if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
				{
					$booking_date=$result[csf('insert_date')];
				}
				echo change_date_format($booking_date,'dd-mm-yyyy','-','');
				?>&nbsp;&nbsp;&nbsp;</td>
                <td style="font-size:18px"><b>Style Ref.</b>   </td>
                <td style="font-size:18px">:&nbsp;<b><? echo $result[csf('style_ref_no')];?> </b>   </td>
            </tr>
             <tr>
                <td style="font-size:12px"><b>Style Des.</b></td>
                <td>:&nbsp;<? echo $result[csf('style_description')]; $job_no= $result[csf('job_no')];?></td>
                <td style="font-size:12px"><b>Lead Time </b>   </td>
                <td>:&nbsp;<?  echo rtrim($lead_time,",");?> </td>
                <td style="font-size:12px"><b>Dealing Merchant</b></td>
                <td>:&nbsp;<? echo $marchentrArr[$result[csf('dealing_marchant')]]; ?></td>
            </tr>

            <tr>
                <td style="font-size:12px"><b>Supplier Name</b>   </td>
                <td>:&nbsp;<?
				if($result[csf('pay_mode')]==5 || $result[csf('pay_mode')]==3){
						echo $company_library[$result[csf('supplier_id')]];
					}
					else{
					echo $supplier_name_arr[$result[csf('supplier_id')]];
					}
				//echo $supplier_name_arr[$result[csf('supplier_id')]];?>    </td>
                <td style="font-size:12px"><b>Delivery Date</b></td>
               	<td>:&nbsp;<? echo change_date_format( $result[csf('delivery_date')],'dd-mm-yyyy','-');?></td>
                <td style="font-size:18px"><b>Booking No </b>   </td>
                <td style="font-size:18px">:&nbsp;<b><? echo $result[csf('booking_no')];?></b><? echo "(".$fabric_source[$result[csf('fabric_source')]].")"?> <? //echo "(".$unit_of_measurement[$result[csf('uom')]].")"; $uom=$result[csf('uom')];?></td>



            </tr>
            <tr>
                <td style="font-size:12px"><b>Season</b></td>
                <td>:&nbsp;<? $season_matrix=return_field_value("season_name","lib_buyer_season","id=".$result[csf('season_matrix')],"season_name");echo $season_matrix; ?></td>
                <td  style="font-size:12px"><b>Attention</b></td>
                <td  >:&nbsp;<? echo $result[csf('attention')]; ?></td>
                <td  style="font-size:12px"><b>Po Received Date</b></td>
                <td  >:&nbsp;<? echo $po_received_date; ?></td>



            </tr>
           <tr>
               <td style="font-size:18px"><b>Order No</b></td>
               <td style="font-size:18px" colspan="3">:&nbsp;<b><? echo rtrim($po_no,", "); ?></b></td>
               <td  style="font-size:12px"><b>Repeat No</b></td>
               <td  >:&nbsp;<? echo $result[csf('order_repeat_no')]; ?></td>
            </tr>
            <tr>
               <td style="font-size:12px"><b>Shipment Date</b></td>
                <td colspan="3"> :&nbsp;<? echo rtrim($shipment_date,", "); ?></td>
                <td  style="font-size:12px"><b>Quality Label</b></td>
               <td  >:&nbsp;<? echo $quality_label[$result[csf('qlty_label')]]; ?></td>

            </tr>

            </tr>
            <tr>
               <td style="font-size:12px"><b>WO Prepared After</b></td>
               <td> :&nbsp;<? echo rtrim($WOPreparedAfter,',').' Days' ?></td>

               <td style="font-size:12px"><b>Ship.days in Hand</b></td>
               <td> :&nbsp;<? echo rtrim($daysInHand,',').' Days'?></td>

               <td style="font-size:12px"><b>Ex-factory status</b></td>
               <td> :&nbsp;<? echo rtrim($shiping_status,','); ?></td>

            </tr>
           <tr>
               <td style="font-size:18px"><b>Internal Ref No</b></td>
               <td style="font-size:18px"> :&nbsp;<b><? echo implode(",",array_unique(explode(",",$data_array3[0][csf("grouping")]))); ?></b></td>
               <td style="font-size:18px"><b>File no</b></td>
               <td style="font-size:18px"> :&nbsp;<b><? echo  implode(",",array_unique(explode(",",$data_array3[0][csf("file_no")])));?></b></td>
               <td style="font-size:18px"><b>Currency</b></td>
               <td style="font-size:18px"> :&nbsp;<b><? echo  $currency[$result[csf("currency_id")]];?></b></td>
            </tr>
        </table>
           <?
			}
			if($cbo_fabric_source==1 || $cbo_fabric_source==2)
			{
			//$nameArray_size=sql_select( "select distinct size_number_id from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  	is_deleted=0 and status_active=1 order by size_number_id");
			//$nameArray_size=sql_select( "select  size_number_id,min(id) as id,	min(size_order) as size_order from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  	is_deleted=0 and status_active=1 group by size_number_id order by id");
			$nameArray_size=sql_select( "select  size_number_id,min(id) as id,	min(size_order) as size_order from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  	is_deleted=0 and status_active=1 group by size_number_id order by size_order");

		   ?>
            <table width="100%" >
		    <tr>
            <td width="800">
                <div id="div_size_color_matrix" style="float:left; max-width:1000;">
            	<fieldset id="div_size_color_matrix" style="max-width:1000;">
 				<legend>Size and Color Breakdown</legend>
 				<table  class="rpt_table"  border="1" align="left" cellpadding="0" width="750" cellspacing="0" rules="all" >
                    <tr>
                        <td style="border:1px solid black"><strong>Color/Size</strong></td>
                    <?
						foreach($nameArray_size  as $result_size)
                        {	     ?>
                        <td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
                    <?	}    ?>
                        <td style="border:1px solid black; width:130px" align="center"><strong> Total Order Qty(Pcs)</strong></td>
                        <td style="border:1px solid black; width:80px" align="center"><strong> Excess %</strong></td>
                        <td style="border:1px solid black; width:130px" align="center"><strong> Total Plan Cut Qty(Pcs)</strong></td>
                    </tr>
                    <?
					$color_size_order_qnty_array=array();
					$color_size_qnty_array=array();
					$size_tatal=array();
					$size_tatal_order=array();
					for($c=0;$c<count($gmts_item); $c++)
				    {
					$item_size_tatal=array();
					$item_size_tatal_order=array();
					$item_grand_total=0;
					$item_grand_total_order=0;
					//$nameArray_color=sql_select( "select distinct color_number_id from wo_po_color_size_breakdown where  item_number_id=$gmts_item[$c] and po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 order by color_number_id");
					//$nameArray_color=sql_select( "select  color_number_id,min(id) as id,min(color_order) as color_order from wo_po_color_size_breakdown where  item_number_id=$gmts_item[$c] and po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id  order by id");
					$nameArray_color=sql_select( "select  color_number_id,min(id) as id,min(color_order) as color_order from wo_po_color_size_breakdown where  item_number_id=$gmts_item[$c] and po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id  order by color_order");
					?>
                    <tr>
                    <td style="border:1px solid black" colspan="<? echo count($nameArray_size)+3;?>"><strong><? echo $garments_item[$gmts_item[$c]];?></strong></td>

                    </tr>
                    <?
					foreach($nameArray_color as $result_color)
                    {
                    ?>
                    <tr>
                        <td align="center" style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; // echo $row_num_tr; ?></td>
                        <?
						$color_total=0;
						$color_total_order=0;

						foreach($nameArray_size  as $result_size)
						{
						$nameArray_color_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as  order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$result_color[csf('color_number_id')]."  and item_number_id=$gmts_item[$c] and  status_active=1 and is_deleted =0");
						foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                        {
                        ?>
                            <td style="border:1px solid black; text-align:right">
							<?
								if($result_color_size_qnty[csf('plan_cut_qnty')]!= "")
								{
									 echo number_format($result_color_size_qnty[csf('order_quantity')],0);
									 $color_total += $result_color_size_qnty[csf('plan_cut_qnty')] ;
									 $color_total_order += $result_color_size_qnty[csf('order_quantity')] ;
									 $item_grand_total+=$result_color_size_qnty[csf('plan_cut_qnty')];
									 $item_grand_total_order+=$result_color_size_qnty[csf('order_quantity')];
								     $grand_total +=$result_color_size_qnty[csf('plan_cut_qnty')];
									 $grand_total_order +=$result_color_size_qnty[csf('order_quantity')];

									 $color_size_qnty_array[$result_size[csf('size_number_id')]][$result_color[csf('color_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
									 $color_size_order_qnty_array[$result_size[csf('size_number_id')]][$result_color[csf('color_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
									 if (array_key_exists($result_size[csf('size_number_id')], $size_tatal))
									 {
											$size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
											$size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
									 }
									 else
									 {
										$size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
										$size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
									 }
									 if (array_key_exists($result_size[csf('size_number_id')], $item_size_tatal))
									 {
											$item_size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
											$item_size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
									 }
									 else
									 {
										$item_size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
										$item_size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
									 }
								}
								else echo "0";
							 ?>
							</td>

                    <?
						}
                        }
                        ?>
                          <td style="border:1px solid black; text-align:right"><?  echo number_format(round($color_total_order),0); ?></td>

                         <td style="border:1px solid black; text-align:right"><? $excexss_per=($color_total-$color_total_order)/$color_total_order*100; echo number_format($excexss_per,2)." %"; ?>
                         </td>
                        <td style="border:1px solid black; text-align:right"><? echo number_format(round($color_total),0); ?></td>
                    </tr>
                    <?
                    }
					?>

                        <td align="center" style="border:1px solid black"><strong>Sub Total</strong></td>
                        <?
						foreach($nameArray_size  as $result_size)
                        {
                        ?>
                        <td style="border:1px solid black;  text-align:right"><? echo $item_size_tatal_order[$result_size[csf('size_number_id')]];  ?></td>
                        <?
                        }
                        ?>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($item_grand_total_order),0); ?></td>
                        <td  style="border:1px solid black;  text-align:right"><? $excess_item_gra_tot=($item_grand_total-$item_grand_total_order)/$item_grand_total_order*100; echo number_format($excess_item_gra_tot,2)." %"; ?></td>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($item_grand_total),0); ?></td>
                    </tr>
                    <?
					}
                    ?>
                     <tr>
                        <td style="border:1px solid black" align="center" colspan="<? echo count($nameArray_size)+3; ?>"><strong>&nbsp;</strong></td>
                        </tr>
                    <tr>
                    <tr>
                        <td align="center" style="border:1px solid black"><strong>Grand Total</strong></td>
                        <?
						foreach($nameArray_size  as $result_size)
                        {
                        ?>
                        <td style="border:1px solid black;  text-align:right"><? echo $size_tatal_order[$result_size[csf('size_number_id')]];  ?></td>
                        <?
                        }
                        ?>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($grand_total_order),0); ?></td>
                        <td  style="border:1px solid black;  text-align:right"><? $excess_gra_tot= ($grand_total-$grand_total_order)/$grand_total_order*100; echo number_format($excess_gra_tot,2)." %"; ?></td>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($grand_total),0); ?></td>
                    </tr>
                </table>
                </fieldset>
                </div>
                </td>
                <td width="200" valign="top" align="left">
                <div id="div_size_color_matrix" style="float:left;">
                <?
				$rmg_process_breakdown_arr=explode('_',$rmg_process_breakdown)
				?>
            	 	<fieldset id="" >
 				<legend>RMG Process Loss % </legend>
            	<table width="180" class="rpt_table" border="1" rules="all">
                <?
				if(number_format($rmg_process_breakdown_arr[8],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Cut Panel rejection <!-- Extra Cutting % breack Down 8-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[8],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[2],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Chest Printing <!-- Printing % breack Down 2-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[2],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[10],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Neck/Sleeve Printing <!-- New breack Down 10-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[10],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[1],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Embroidery   <!-- Embroidery  % breack Down 1-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[1],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[4],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Sewing /Input<!-- Sewing % breack Down 4-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[4],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[3],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Garments Wash <!-- Washing %breack Down 3-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[3],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[15],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Gmts Finishing <!-- Washing %breack Down 3-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[15],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[11],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Others <!-- New breack Down 11-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[11],2);
				?>
                </td>
                </tr>
                <?
                }
				$gmts_pro_sub_tot=$rmg_process_breakdown_arr[8]+$rmg_process_breakdown_arr[2]+$rmg_process_breakdown_arr[10]+$rmg_process_breakdown_arr[1]+$rmg_process_breakdown_arr[4]+$rmg_process_breakdown_arr[3]+$rmg_process_breakdown_arr[11]+$rmg_process_breakdown_arr[15];
				if($gmts_pro_sub_tot>0)
				{
				?>
                <tr>
                <td width="130">
                Sub Total <!-- New breack Down 11-->
                </td>
                <td align="right">
                <?

				echo number_format($gmts_pro_sub_tot,2);
				?>
                </td>
                </tr>
                <?
				}
				?>
                </table>
                </fieldset>


                <fieldset id="" >
 				<legend>Fabric Process Loss % </legend>
            	<table width="180" class="rpt_table" border="1" rules="all">
                 <?
				if(number_format($rmg_process_breakdown_arr[6],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Knitting  <!--  Knitting % breack Down 6-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[6],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[12],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Yarn Dyeing  <!--  New breack Down 12-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[12],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[5],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Dyeing & Finishing  <!-- Finishing % breack Down 5-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[5],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[13],2)>0)
				{
				?>
                <tr>
                <td width="130">
                All Over Print <!-- new  breack Down 13-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[13],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[14],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Lay Wash (Fabric) <!-- new  breack Down 14-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[14],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[7],2)>0)
				{
				?>
                 <tr>
                <td width="130">
                Dying   <!-- breack Down 7-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[7],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[0],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Cutting (Fabric) <!-- Cutting % breack Down 0-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[0],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[9],2)>0)
				{
				?>
                <tr>
                <td width="130">
               Others  <!-- Others% breack Down 9-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[9],2);
				?>
                </td>
                </tr>
                <?
				}
				$fab_proce_sub_tot=$rmg_process_breakdown_arr[6]+$rmg_process_breakdown_arr[12]+$rmg_process_breakdown_arr[5]+$rmg_process_breakdown_arr[13]+$rmg_process_breakdown_arr[14]+$rmg_process_breakdown_arr[7]+$rmg_process_breakdown_arr[0]+$rmg_process_breakdown_arr[9];
				if(fab_proce_sub_tot>0)
				{
				?>
                <tr>
                <td width="130">
                Sub Total  <!-- Others% breack Down 9-->
                </td>
                <td align="right">
                <?

				echo number_format($fab_proce_sub_tot,2);
				?>
                </td>
                </tr>
                <?
				}
				if($gmts_pro_sub_tot+$fab_proce_sub_tot>0)
				{
				?>
                 <tr>
                <td width="130">
                Grand Total  <!-- Others% breack Down 9-->
                </td>
                <td align="right">
                <?
				echo number_format($gmts_pro_sub_tot+$fab_proce_sub_tot,2);
				?>
                </td>
                </tr>
                <?
				}
				?>
           </table>
           </fieldset>
           </div>
                </td>
            <td width="330" valign="top" align="left">
            <?
			$nameArray_imge =sql_select("SELECT image_location FROM common_photo_library where master_tble_id='$job_no' and file_type=1");
			?>
            <div id="div_size_color_matrix" style="float:left;">
            	<fieldset id="" >
 				<legend>Image </legend>
            	<table width="310">
                <tr>
                <?
				$img_counter = 0;
                foreach($nameArray_imge as $result_imge)
				{
				    if($path=="")
                    {
                    $path='../../';
                    }

					?>
					<td>
						<!--<img src="../../<? //echo $result_imge[csf('image_location')]; ?>" width="90" height="100" border="2" />-->
                        <img src="<? echo $path.$result_imge[csf('image_location')]; ?>" width="90" height="100" border="2" />
					</td>
					<?

					$img_counter++;
				}
				?>
                </tr>
           </table>
           </fieldset>
           </div>
          </td>
        </tr>
       </table>
        <?
			}// if($cbo_fabric_source==1) end

	  ?>
      <br/>

      <!--  Here will be the main portion  -->
     <?
	 $costing_per="";
	 $costing_per_qnty=0;
	 $costing_per_id=return_field_value( "costing_per", "wo_pre_cost_mst","job_no ='$job_no'");
	 if($costing_per_id==1)
			{
				$costing_per="1 Dzn";
				$costing_per_qnty=12;

			}
			if($costing_per_id==2)
			{
				$costing_per="1 Pcs";
				$costing_per_qnty=1;

			}
			if($costing_per_id==3)
			{
				$costing_per="2 Dzn";
				$costing_per_qnty=24;

			}
			if($costing_per_id==4)
			{
				$costing_per="3 Dzn";
				$costing_per_qnty=36;

			}
			if($costing_per_id==5)
			{
				$costing_per="4 Dzn";
				$costing_per_qnty=48;

			}
			$process_loss_method=return_field_value( "process_loss_method", "wo_pre_cost_fabric_cost_dtls","job_no='$job_no'");;

	if($cbo_fabric_source==1)
	{
	$nameArray_fabric_description= sql_select("select min(a.id) as fabric_cost_dtls_id, a.item_number_id, a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type , b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent, avg(b.requirment) as requirment  FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
	WHERE a.job_no=b.job_no and
	a.id=b.pre_cost_fabric_cost_dtls_id and
	c.job_no_mst=a.job_no and
	c.id=b.color_size_table_id and
	b.po_break_down_id=d.po_break_down_id and
	b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
	d.booking_no =$txt_booking_no and
	a.uom=12 and
	d.status_active=1 and
	d.is_deleted=0
	group by a.item_number_id,a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by fabric_cost_dtls_id,a.body_part_id,b.dia_width");
	if(count($nameArray_fabric_description)>0){
	 ?>

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
     <caption>Fabric Details in KG</caption>
     <tr align="center">
     <th colspan="3" align="left">Item Name</th>
        <?

		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
		if( $result_fabric_description[csf('body_part_id')] == "")
			echo "<td colspan='3'>&nbsp</td>";
		else
			echo "<td colspan='3'>". $garments_item[$result_fabric_description[csf('item_number_id')]]."</td>";
		}
		?>
        <td  rowspan="10" width="50"><p>Total Finish Fabric (Kg)<? //echo "(".$unit_of_measurement[$uom].")"; //if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>

            <td  rowspan="10" width="50"><p>Avg Rate <? echo "(".$unit_of_measurement[$uom].")"; //if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
            <td  rowspan="10" width="50"><p>Amount </p></td>

       </tr>
     <tr align="center">
     <th colspan="3" align="left">Body Part</th>
        <?

		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
		if( $result_fabric_description[csf('body_part_id')] == "")
			echo "<td colspan='3'>&nbsp</td>";
		else
			echo "<td colspan='3'>".$body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
		}
		?>
       </tr>
     <tr align="center"><th colspan="3" align="left">Color Type</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
			else         		               echo "<td  colspan='3'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
		}
		?>
       </tr>
        <tr align="center"><th colspan="3" align="left">Fabric Construction</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='3'>&nbsp</td>";
			else         		               echo "<td  colspan='3'>". $result_fabric_description[csf('construction')]."</td>";
		}
		?>


       </tr>
        <tr align="center"><th   colspan="3" align="left">Fabric Composition</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='3' >&nbsp</td>";
			else         		               echo "<td colspan='3' >".$result_fabric_description[csf('composition')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th  colspan="3" align="left">GSM</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		       echo "<td colspan='3' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		              echo "<td colspan='3' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Consumption For <? echo $costing_per; ?></th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('cons')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		              echo "<td colspan='3' align='center'>Fin: ".number_format($result_fabric_description[csf('cons')],2)."</td>";
		}
		?>

       </tr>
       <tr>
       <th  colspan="<? echo  count($nameArray_fabric_description)*3+3; ?>" align="left" style="height:30px">&nbsp;</th>
       </tr>

       <tr>
            <!--<th  width="120" align="left">Gmts. Color</th>-->
            <th  width="120" align="left">Fabric Color</th>
            <th  width="120" align="left">Body Color</th>
            <th  width="120" align="left">Lab Dip No</th>
        <?

			foreach($nameArray_fabric_description as $result_fabric_description)
			{
				  echo "<th width='50'>Fab. Qty</th><th width='50' >Rate</th><th width='50' >Amount</th>";
			}


		?>

       </tr>
       <?

		  /*$gmt_color_library=return_library_array( "select gmts_color_id,contrast_color_id
		  FROM
		  wo_pre_cos_fab_co_color_dtls
		  WHERE
		  job_no ='$job_no'", "contrast_color_id", "gmts_color_id");*/
		  $gmt_color_library=array();
		  $gmt_color_data=sql_select("select b.gmts_color_id, b.contrast_color_id
		  FROM
		  wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b
		  WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.uom=12  and a.fabric_source =$cbo_fabric_source and
		  a.job_no ='$job_no'");
		  foreach( $gmt_color_data as $gmt_color_row)
		  {
			//$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
			$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
		  }

	        $grand_total_fin_fab_qnty=0;
			$grand_total_amount=0;
			//$grand_totalcons_per_finish=0;
			//$grand_totalcons_per_grey=0;
			$color_wise_wo_sql=sql_select("select b.fabric_color_id
										  FROM
										  wo_pre_cost_fabric_cost_dtls a,
										  wo_booking_dtls b
										  WHERE
										  a.id=b.pre_cost_fabric_cost_dtls_id and
										  a.uom=12 and
										  b.booking_no =$txt_booking_no and
										  b.status_active=1 and
                                          b.is_deleted=0
										  group by b.fabric_color_id");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
		?>
			<tr>
           <!-- <td  width="120" align="left">
			<?

			//echo $color_library[$color_wise_wo_result['fabric_color_id']];

			?></td>-->
            <td  width="120" align="left">
			<?
			echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];


			?>
            </td>
            <td>
            <?
			//echo $color_library[$gmt_color_library[$color_wise_wo_result['fabric_color_id']]];
			//echo rtrim($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]],",");
			echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
			?>
            </td>
            <td  width="120" align="left">
			<?
			$lapdip_no="";
			$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
			//echo "lapdip_no from wo_po_lapdip_approval_info where job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result['fabric_color_id']."";
			if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_amount=0;

			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
				  FROM
				  view_wo_fabric_booking_data_park a,
				  wo_booking_dtls b
				  WHERE
				  b.booking_no =$txt_booking_no  and
				  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
				  a.po_break_down_id=b.po_break_down_id and
				  a.color_size_table_id=b.color_size_table_id and
				  a.color_type_id='".$result_fabric_description['color_type_id']."' and
				  a.construction='".$result_fabric_description['construction']."' and
				  a.composition='".$result_fabric_description['composition']."' and
				  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
				  a.dia_width='".$result_fabric_description['dia_width']."' and
				  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
				  b.fabric_color_id=".$color_wise_wo_result['fabric_color_id']." and
				  b.status_active=1 and
				  b.is_deleted=0");*/

				if($db_type==0)
				{
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty, avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.uom=12 and
				a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
				d.status_active=1 and
				d.is_deleted=0
				");
				}
				if($db_type==2)
				{

				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.uom=12 and
				a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
				d.status_active=1 and
				d.is_deleted=0
				");
				}
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'>
			<?
			if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
			{
				echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],0) ;
				$total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('rate')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('rate')],4);
			//$total_grey_fab_qnty+=$color_wise_wo_result_qnty['grey_fab_qnty'];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			$amount=$color_wise_wo_result_qnty[csf('grey_fab_qnty')]*$color_wise_wo_result_qnty[csf('rate')];
			if($amount!="")
			{
			echo number_format($amount,0);
			$total_amount+=$amount;
			}
			?>
            </td>
            <?
			}
			?>
            <td align="right"><? echo number_format($total_fin_fab_qnty,0); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
            <td align="right"><? echo number_format($total_amount/$total_fin_fab_qnty,2); $grand_total_amount+=$total_amount;?></td>
            <td align="right">
            <?
			echo number_format($total_amount,0);

			?>
            </td>
            </tr>
         <?
		}
		?>
        <tr style=" font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Total</strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,

												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.uom=12 and
												a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],0) ;?></td>
            <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
            <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
            <?
			}
			?>
            <td align="right"><? echo number_format($grand_total_fin_fab_qnty,0);?></td>
            <td align="right"><? echo number_format($grand_total_amount/$grand_total_fin_fab_qnty,2);?></td>
            <td align="right">
            <?
			echo number_format($grand_total_amount,0);
			?>
            </td>
            </tr>
            <tr style="font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/


				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.uom=12 and
												a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

			?>
			<td width='50' align='right'><?  //echo number_format(($color_wise_wo_result_qnty['fin_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td>
            <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <?
			}
			?>
            <td align="right">
			<?
			$consumption_per_unit_fab=($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
			echo number_format($consumption_per_unit_fab,0);
			//$grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4)
			?>
            </td>
            <td align="right">
			<?
			$consumption_per_unit_amuont=($grand_total_amount/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
			echo number_format(($consumption_per_unit_amuont/$consumption_per_unit_fab),2);
			//$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4)
			?>
            </td>
            <td align="right" title="Only Allow Round Figer">
            <?
			echo number_format($consumption_per_unit_amuont,0);
			?>
            </td>
            </tr>
    </table>
    <br/>
    <?
	}
	//===========================

	$nameArray_fabric_description= sql_select("select min(a.id) as fabric_cost_dtls_id, a.item_number_id, a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type , b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent, avg(b.requirment) as requirment  FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
	WHERE a.job_no=b.job_no and
	a.id=b.pre_cost_fabric_cost_dtls_id and
	c.job_no_mst=a.job_no and
	c.id=b.color_size_table_id and
	b.po_break_down_id=d.po_break_down_id and
	b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
	d.booking_no =$txt_booking_no and
	a.uom=27 and
	d.status_active=1 and
	d.is_deleted=0
	group by a.item_number_id,a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by fabric_cost_dtls_id,a.body_part_id,b.dia_width");
	if(count($nameArray_fabric_description)>0){
	 ?>

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
     <caption>Fabric Details in Yds</caption>
     <tr align="center">
     <th colspan="3" align="left">Item Name</th>
        <?

		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
		if( $result_fabric_description[csf('body_part_id')] == "")
			echo "<td colspan='3'>&nbsp</td>";
		else
			echo "<td colspan='3'>". $garments_item[$result_fabric_description[csf('item_number_id')]]."</td>";
		}
		?>
        <td  rowspan="10" width="50"><p>Total Finish Fabric (Yds)<? //echo "(".$unit_of_measurement[$uom].")"; //if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>

            <td  rowspan="10" width="50"><p>Avg Rate (Yds) <? //echo "(".$unit_of_measurement[$uom].")"; //if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
            <td  rowspan="10" width="50"><p>Amount </p></td>

       </tr>
     <tr align="center">
     <th colspan="3" align="left">Body Part</th>
        <?

		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
		if( $result_fabric_description[csf('body_part_id')] == "")
			echo "<td colspan='3'>&nbsp</td>";
		else
			echo "<td colspan='3'>".$body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
		}
		?>
       </tr>
     <tr align="center"><th colspan="3" align="left">Color Type</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
			else         		               echo "<td  colspan='3'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
		}
		?>
       </tr>
        <tr align="center"><th colspan="3" align="left">Fabric Construction</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='3'>&nbsp</td>";
			else         		               echo "<td  colspan='3'>". $result_fabric_description[csf('construction')]."</td>";
		}
		?>


       </tr>
        <tr align="center"><th   colspan="3" align="left">Fabric Composition</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='3' >&nbsp</td>";
			else         		               echo "<td colspan='3' >".$result_fabric_description[csf('composition')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th  colspan="3" align="left">GSM</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		       echo "<td colspan='3' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		              echo "<td colspan='3' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Consumption For <? echo $costing_per; ?></th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('cons')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		              echo "<td colspan='3' align='center'>Fin: ".number_format($result_fabric_description[csf('cons')],2)."</td>";
		}
		?>

       </tr>
       <tr>
       <th  colspan="<? echo  count($nameArray_fabric_description)*3+3; ?>" align="left" style="height:30px">&nbsp;</th>
       </tr>

       <tr>
            <!--<th  width="120" align="left">Gmts. Color</th>-->
            <th  width="120" align="left">Fabric Color</th>
            <th  width="120" align="left">Body Color</th>
            <th  width="120" align="left">Lab Dip No</th>
        <?

			foreach($nameArray_fabric_description as $result_fabric_description)
			{
				  echo "<th width='50'>Fab. Qty</th><th width='50' >Rate</th><th width='50' >Amount</th>";
			}


		?>

       </tr>
       <?

		  /*$gmt_color_library=return_library_array( "select gmts_color_id,contrast_color_id
		  FROM
		  wo_pre_cos_fab_co_color_dtls
		  WHERE
		  job_no ='$job_no'", "contrast_color_id", "gmts_color_id");*/
		  $gmt_color_library=array();
		  $gmt_color_data=sql_select("select b.gmts_color_id, b.contrast_color_id
		  FROM
		  wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b
		  WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.uom=27  and a.fabric_source =$cbo_fabric_source and
		  a.job_no ='$job_no'");
		  foreach( $gmt_color_data as $gmt_color_row)
		  {
			//$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
			$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
		  }

	        $grand_total_fin_fab_qnty=0;
			$grand_total_amount=0;
			//$grand_totalcons_per_finish=0;
			//$grand_totalcons_per_grey=0;
			$color_wise_wo_sql=sql_select("select b.fabric_color_id
										  FROM
										  wo_pre_cost_fabric_cost_dtls a,
										  wo_booking_dtls b
										  WHERE
										  a.id=b.pre_cost_fabric_cost_dtls_id and
										  a.uom=27 and
										  b.booking_no =$txt_booking_no and
										  b.status_active=1 and
                                          b.is_deleted=0
										  group by b.fabric_color_id");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
		?>
			<tr>
           <!-- <td  width="120" align="left">
			<?

			//echo $color_library[$color_wise_wo_result['fabric_color_id']];

			?></td>-->
            <td  width="120" align="left">
			<?
			echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];


			?>
            </td>
            <td>
            <?
			//echo $color_library[$gmt_color_library[$color_wise_wo_result['fabric_color_id']]];
			//echo rtrim($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]],",");
			echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
			?>
            </td>
            <td  width="120" align="left">
			<?
			$lapdip_no="";
			$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
			//echo "lapdip_no from wo_po_lapdip_approval_info where job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result['fabric_color_id']."";
			if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_amount=0;

			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
				  FROM
				  view_wo_fabric_booking_data_park a,
				  wo_booking_dtls b
				  WHERE
				  b.booking_no =$txt_booking_no  and
				  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
				  a.po_break_down_id=b.po_break_down_id and
				  a.color_size_table_id=b.color_size_table_id and
				  a.color_type_id='".$result_fabric_description['color_type_id']."' and
				  a.construction='".$result_fabric_description['construction']."' and
				  a.composition='".$result_fabric_description['composition']."' and
				  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
				  a.dia_width='".$result_fabric_description['dia_width']."' and
				  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
				  b.fabric_color_id=".$color_wise_wo_result['fabric_color_id']." and
				  b.status_active=1 and
				  b.is_deleted=0");*/

				if($db_type==0)
				{
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty, avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.uom=27 and
				a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
				d.status_active=1 and
				d.is_deleted=0
				");
				}
				if($db_type==2)
				{

				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.uom=27 and
				a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
				d.status_active=1 and
				d.is_deleted=0
				");
				}
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'>
			<?
			if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
			{
				echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],0) ;
				$total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('rate')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('rate')],4);
			//$total_grey_fab_qnty+=$color_wise_wo_result_qnty['grey_fab_qnty'];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			$amount=$color_wise_wo_result_qnty[csf('grey_fab_qnty')]*$color_wise_wo_result_qnty[csf('rate')];
			if($amount!="")
			{
			echo number_format($amount,0);
			$total_amount+=$amount;
			}
			?>
            </td>
            <?
			}
			?>
            <td align="right"><? echo number_format($total_fin_fab_qnty,0); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
            <td align="right"><? echo number_format($total_amount/$total_fin_fab_qnty,2); $grand_total_amount+=$total_amount;?></td>
            <td align="right">
            <?
			echo number_format($total_amount,0);

			?>
            </td>
            </tr>
         <?
		}
		?>
        <tr style=" font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Total</strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,

												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.uom=27 and
												a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],0) ;?></td>
            <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
            <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
            <?
			}
			?>
            <td align="right"><? echo number_format($grand_total_fin_fab_qnty,0);?></td>
            <td align="right"><? echo number_format($grand_total_amount/$grand_total_fin_fab_qnty,2);?></td>
            <td align="right">
            <?
			echo number_format($grand_total_amount,0);
			?>
            </td>
            </tr>
            <tr style="font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/


				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.uom=27 and
												a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

			?>
			<td width='50' align='right'><?  //echo number_format(($color_wise_wo_result_qnty['fin_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td>
            <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <?
			}
			?>
            <td align="right">
			<?
			$consumption_per_unit_fab=($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
			echo number_format($consumption_per_unit_fab,0);
			//$grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4)
			?>
            </td>
            <td align="right">
			<?
			$consumption_per_unit_amuont=($grand_total_amount/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
			echo number_format(($consumption_per_unit_amuont/$consumption_per_unit_fab),2);
			//$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4)
			?>
            </td>
            <td align="right" title="Only Allow Round Figer">
            <?
			echo number_format($consumption_per_unit_amuont,0);
			?>
            </td>
            </tr>
    </table>
    <?
	}
	}


	if($cbo_fabric_source==2){
	$nameArray_fabric_description= sql_select("select min(a.id) as fabric_cost_dtls_id, a.item_number_id, a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type , b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent, avg(b.requirment) as requirment  FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
	WHERE a.job_no=b.job_no and
	a.id=b.pre_cost_fabric_cost_dtls_id and
	c.job_no_mst=a.job_no and
	c.id=b.color_size_table_id and
	b.po_break_down_id=d.po_break_down_id and
	b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
	d.booking_no =$txt_booking_no and
	a.uom=12 and
	d.status_active=1 and
	d.is_deleted=0
	group by a.item_number_id,a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by fabric_cost_dtls_id,a.body_part_id,b.dia_width");
	if(count($nameArray_fabric_description)>0){
	 ?>

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
     <caption>Fabric Details in KG</caption>
     <tr align="center">
     <th colspan="3" align="left">Item Name</th>
        <?

		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
		if( $result_fabric_description[csf('body_part_id')] == "")
			echo "<td colspan='3'>&nbsp</td>";
		else
			echo "<td colspan='3'>". $garments_item[$result_fabric_description[csf('item_number_id')]]."</td>";
		}
		?>
        <td  rowspan="10" width="50"><p>Total Finish Fabric (Kg)<? //echo "(".$unit_of_measurement[$uom].")"; //if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>

            <td  rowspan="10" width="50"><p>Avg Rate <? echo "(".$unit_of_measurement[$uom].")"; //if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
            <td  rowspan="10" width="50"><p>Amount </p></td>

       </tr>
     <tr align="center">
     <th colspan="3" align="left">Body Part</th>
        <?

		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
		if( $result_fabric_description[csf('body_part_id')] == "")
			echo "<td colspan='3'>&nbsp</td>";
		else
			echo "<td colspan='3'>".$body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
		}
		?>
       </tr>
     <tr align="center"><th colspan="3" align="left">Color Type</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
			else         		               echo "<td  colspan='3'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
		}
		?>
       </tr>
        <tr align="center"><th colspan="3" align="left">Fabric Construction</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='3'>&nbsp</td>";
			else         		               echo "<td  colspan='3'>". $result_fabric_description[csf('construction')]."</td>";
		}
		?>


       </tr>
        <tr align="center"><th   colspan="3" align="left">Fabric Composition</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='3' >&nbsp</td>";
			else         		               echo "<td colspan='3' >".$result_fabric_description[csf('composition')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th  colspan="3" align="left">GSM</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		       echo "<td colspan='3' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		              echo "<td colspan='3' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Consumption For <? echo $costing_per; ?></th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('cons')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		              echo "<td colspan='3' align='center'>Fin: ".number_format($result_fabric_description[csf('cons')],2)."</td>";
		}
		?>

       </tr>
       <tr>
       <th  colspan="<? echo  count($nameArray_fabric_description)*3+3; ?>" align="left" style="height:30px">&nbsp;</th>
       </tr>

       <tr>
            <!--<th  width="120" align="left">Gmts. Color</th>-->
            <th  width="120" align="left">Fabric Color</th>
            <th  width="120" align="left">Body Color</th>
            <th  width="120" align="left">Lab Dip No</th>
        <?
		if($cbo_fabric_source==2)
		{
			foreach($nameArray_fabric_description as $result_fabric_description)
			{
				  echo "<th width='50'>Fab. Qty</th><th width='50' >Rate</th><th width='50' >Amount</th>";
			}
		}
		else
		{
			foreach($nameArray_fabric_description as $result_fabric_description)
			{
				  echo "<th width='50'>Fab. Qty</th>";
			}
		}

		?>

       </tr>
       <?

		  /*$gmt_color_library=return_library_array( "select gmts_color_id,contrast_color_id
		  FROM
		  wo_pre_cos_fab_co_color_dtls
		  WHERE
		  job_no ='$job_no'", "contrast_color_id", "gmts_color_id");*/
		  $gmt_color_library=array();
		  $gmt_color_data=sql_select("select b.gmts_color_id, b.contrast_color_id
		  FROM
		  wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b
		  WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.uom=12  and a.fabric_source =$cbo_fabric_source and
		  a.job_no ='$job_no'");
		  foreach( $gmt_color_data as $gmt_color_row)
		  {
			//$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
			$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
		  }

	        $grand_total_fin_fab_qnty=0;
			$grand_total_amount=0;
			//$grand_totalcons_per_finish=0;
			//$grand_totalcons_per_grey=0;
			$color_wise_wo_sql=sql_select("select b.fabric_color_id
										  FROM
										  wo_pre_cost_fabric_cost_dtls a,
										  wo_booking_dtls b
										  WHERE
										  a.id=b.pre_cost_fabric_cost_dtls_id and
										  a.uom=12 and
										  b.booking_no =$txt_booking_no and
										  b.status_active=1 and
                                          b.is_deleted=0
										  group by b.fabric_color_id");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
		?>
			<tr>
           <!-- <td  width="120" align="left">
			<?

			//echo $color_library[$color_wise_wo_result['fabric_color_id']];

			?></td>-->
            <td  width="120" align="left">
			<?
			echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];


			?>
            </td>
            <td>
            <?
			//echo $color_library[$gmt_color_library[$color_wise_wo_result['fabric_color_id']]];
			//echo rtrim($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]],",");
			echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
			?>
            </td>
            <td  width="120" align="left">
			<?
			$lapdip_no="";
			$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
			//echo "lapdip_no from wo_po_lapdip_approval_info where job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result['fabric_color_id']."";
			if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_amount=0;

			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
				  FROM
				  view_wo_fabric_booking_data_park a,
				  wo_booking_dtls b
				  WHERE
				  b.booking_no =$txt_booking_no  and
				  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
				  a.po_break_down_id=b.po_break_down_id and
				  a.color_size_table_id=b.color_size_table_id and
				  a.color_type_id='".$result_fabric_description['color_type_id']."' and
				  a.construction='".$result_fabric_description['construction']."' and
				  a.composition='".$result_fabric_description['composition']."' and
				  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
				  a.dia_width='".$result_fabric_description['dia_width']."' and
				  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
				  b.fabric_color_id=".$color_wise_wo_result['fabric_color_id']." and
				  b.status_active=1 and
				  b.is_deleted=0");*/

				if($db_type==0)
				{
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty, avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.uom=12 and
				a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
				d.status_active=1 and
				d.is_deleted=0
				");
				}
				if($db_type==2)
				{

				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.uom=12 and
				a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
				d.status_active=1 and
				d.is_deleted=0
				");
				}
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'>
			<?
			if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
			{
				echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],0) ;
				$total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('rate')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('rate')],4);
			//$total_grey_fab_qnty+=$color_wise_wo_result_qnty['grey_fab_qnty'];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			$amount=$color_wise_wo_result_qnty[csf('grey_fab_qnty')]*$color_wise_wo_result_qnty[csf('rate')];
			if($amount!="")
			{
			echo number_format($amount,0);
			$total_amount+=$amount;
			}
			?>
            </td>
            <?
			}
			?>
            <td align="right"><? echo number_format($total_fin_fab_qnty,0); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
            <td align="right"><? echo number_format($total_amount/$total_fin_fab_qnty,2); $grand_total_amount+=$total_amount;?></td>
            <td align="right">
            <?
			echo number_format($total_amount,0);

			?>
            </td>
            </tr>
         <?
		}
		?>
        <tr style=" font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Total</strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,

												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.uom=12 and
												a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],0) ;?></td>
            <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
            <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
            <?
			}
			?>
            <td align="right"><? echo number_format($grand_total_fin_fab_qnty,0);?></td>
            <td align="right"><? echo number_format($grand_total_amount/$grand_total_fin_fab_qnty,2);?></td>
            <td align="right">
            <?
			echo number_format($grand_total_amount,0);
			?>
            </td>
            </tr>
            <tr style="font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/


				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.uom=12 and
												a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

			?>
			<td width='50' align='right'><?  //echo number_format(($color_wise_wo_result_qnty['fin_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td>
            <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <?
			}
			?>
            <td align="right">
			<?
			$consumption_per_unit_fab=($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
			echo number_format($consumption_per_unit_fab,0);
			//$grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4)
			?>
            </td>
            <td align="right">
			<?
			$consumption_per_unit_amuont=($grand_total_amount/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
			echo number_format(($consumption_per_unit_amuont/$consumption_per_unit_fab),2);
			//$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4)
			?>
            </td>
            <td align="right" title="Only Allow Round Figer">
            <?
			echo number_format($consumption_per_unit_amuont,0);
			?>
            </td>
            </tr>
    </table>
    <br/>
    <?
	}
	//===========================

	$nameArray_fabric_description= sql_select("select min(a.id) as fabric_cost_dtls_id, a.item_number_id, a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type , b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent, avg(b.requirment) as requirment  FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
	WHERE a.job_no=b.job_no and
	a.id=b.pre_cost_fabric_cost_dtls_id and
	c.job_no_mst=a.job_no and
	c.id=b.color_size_table_id and
	b.po_break_down_id=d.po_break_down_id and
	b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
	d.booking_no =$txt_booking_no and
	a.uom=27 and
	d.status_active=1 and
	d.is_deleted=0
	group by a.item_number_id,a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by fabric_cost_dtls_id,a.body_part_id,b.dia_width");
	if(count($nameArray_fabric_description)>0){
	 ?>

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
     <caption>Fabric Details in Yds</caption>
     <tr align="center">
     <th colspan="3" align="left">Item Name</th>
        <?

		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
		if( $result_fabric_description[csf('body_part_id')] == "")
			echo "<td colspan='3'>&nbsp</td>";
		else
			echo "<td colspan='3'>". $garments_item[$result_fabric_description[csf('item_number_id')]]."</td>";
		}
		?>
        <td  rowspan="10" width="50"><p>Total Finish Fabric (Yds)<? //echo "(".$unit_of_measurement[$uom].")"; //if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
        <?
		if($cbo_fabric_source==2)
		{
			?>
            <td  rowspan="10" width="50"><p>Avg Rate (Yds) <? //echo "(".$unit_of_measurement[$uom].")"; //if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
            <td  rowspan="10" width="50"><p>Amount </p></td>
            <?
		}
		?>
       </tr>
     <tr align="center">
     <th colspan="3" align="left">Body Part</th>
        <?

		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
		if( $result_fabric_description[csf('body_part_id')] == "")
			echo "<td colspan='3'>&nbsp</td>";
		else
			echo "<td colspan='3'>".$body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
		}
		?>
       </tr>
     <tr align="center"><th colspan="3" align="left">Color Type</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
			else         		               echo "<td  colspan='3'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
		}
		?>
       </tr>
        <tr align="center"><th colspan="3" align="left">Fabric Construction</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='3'>&nbsp</td>";
			else         		               echo "<td  colspan='3'>". $result_fabric_description[csf('construction')]."</td>";
		}
		?>


       </tr>
        <tr align="center"><th   colspan="3" align="left">Fabric Composition</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='3' >&nbsp</td>";
			else         		               echo "<td colspan='3' >".$result_fabric_description[csf('composition')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th  colspan="3" align="left">GSM</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		       echo "<td colspan='3' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		              echo "<td colspan='3' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Consumption For <? echo $costing_per; ?></th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('cons')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		              echo "<td colspan='3' align='center'>Fin: ".number_format($result_fabric_description[csf('cons')],2)."</td>";
		}
		?>

       </tr>
       <tr>
       <th  colspan="<? echo  count($nameArray_fabric_description)*3+3; ?>" align="left" style="height:30px">&nbsp;</th>
       </tr>

       <tr>
            <!--<th  width="120" align="left">Gmts. Color</th>-->
            <th  width="120" align="left">Fabric Color</th>
            <th  width="120" align="left">Body Color</th>
            <th  width="120" align="left">Lab Dip No</th>
        <?
		if($cbo_fabric_source==2)
		{
			foreach($nameArray_fabric_description as $result_fabric_description)
			{
				  echo "<th width='50'>Fab. Qty</th><th width='50' >Rate</th><th width='50' >Amount</th>";
			}
		}
		else
		{
			foreach($nameArray_fabric_description as $result_fabric_description)
			{
				  echo "<th width='50'>Fab. Qty</th>";
			}
		}

		?>

       </tr>
       <?

		  /*$gmt_color_library=return_library_array( "select gmts_color_id,contrast_color_id
		  FROM
		  wo_pre_cos_fab_co_color_dtls
		  WHERE
		  job_no ='$job_no'", "contrast_color_id", "gmts_color_id");*/
		  $gmt_color_library=array();
		  $gmt_color_data=sql_select("select b.gmts_color_id, b.contrast_color_id
		  FROM
		  wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b
		  WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.uom=27  and a.fabric_source =$cbo_fabric_source and
		  a.job_no ='$job_no'");
		  foreach( $gmt_color_data as $gmt_color_row)
		  {
			//$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
			$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
		  }

	        $grand_total_fin_fab_qnty=0;
			$grand_total_amount=0;
			//$grand_totalcons_per_finish=0;
			//$grand_totalcons_per_grey=0;
			$color_wise_wo_sql=sql_select("select b.fabric_color_id
										  FROM
										  wo_pre_cost_fabric_cost_dtls a,
										  wo_booking_dtls b
										  WHERE
										  a.id=b.pre_cost_fabric_cost_dtls_id and
										  a.uom=27 and
										  b.booking_no =$txt_booking_no and
										  b.status_active=1 and
                                          b.is_deleted=0
										  group by b.fabric_color_id");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
		?>
			<tr>
           <!-- <td  width="120" align="left">
			<?

			//echo $color_library[$color_wise_wo_result['fabric_color_id']];

			?></td>-->
            <td  width="120" align="left">
			<?
			echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];


			?>
            </td>
            <td>
            <?
			//echo $color_library[$gmt_color_library[$color_wise_wo_result['fabric_color_id']]];
			//echo rtrim($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]],",");
			echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
			?>
            </td>
            <td  width="120" align="left">
			<?
			$lapdip_no="";
			$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
			//echo "lapdip_no from wo_po_lapdip_approval_info where job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result['fabric_color_id']."";
			if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_amount=0;

			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
				  FROM
				  view_wo_fabric_booking_data_park a,
				  wo_booking_dtls b
				  WHERE
				  b.booking_no =$txt_booking_no  and
				  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
				  a.po_break_down_id=b.po_break_down_id and
				  a.color_size_table_id=b.color_size_table_id and
				  a.color_type_id='".$result_fabric_description['color_type_id']."' and
				  a.construction='".$result_fabric_description['construction']."' and
				  a.composition='".$result_fabric_description['composition']."' and
				  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
				  a.dia_width='".$result_fabric_description['dia_width']."' and
				  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
				  b.fabric_color_id=".$color_wise_wo_result['fabric_color_id']." and
				  b.status_active=1 and
				  b.is_deleted=0");*/

				if($db_type==0)
				{
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty, avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.uom=27 and
				a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
				d.status_active=1 and
				d.is_deleted=0
				");
				}
				if($db_type==2)
				{

				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.uom=27 and
				a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
				d.status_active=1 and
				d.is_deleted=0
				");
				}
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'>
			<?
			if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
			{
				echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],0) ;
				$total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('rate')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('rate')],4);
			//$total_grey_fab_qnty+=$color_wise_wo_result_qnty['grey_fab_qnty'];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			$amount=$color_wise_wo_result_qnty[csf('grey_fab_qnty')]*$color_wise_wo_result_qnty[csf('rate')];
			if($amount!="")
			{
			echo number_format($amount,0);
			$total_amount+=$amount;
			}
			?>
            </td>
            <?
			}
			?>
            <td align="right"><? echo number_format($total_fin_fab_qnty,0); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
            <td align="right"><? echo number_format($total_amount/$total_fin_fab_qnty,2); $grand_total_amount+=$total_amount;?></td>
            <td align="right">
            <?
			echo number_format($total_amount,0);

			?>
            </td>
            </tr>
         <?
		}
		?>
        <tr style=" font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Total</strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,

												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.uom=27 and
												a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],0) ;?></td>
            <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
            <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
            <?
			}
			?>
            <td align="right"><? echo number_format($grand_total_fin_fab_qnty,0);?></td>
            <td align="right"><? echo number_format($grand_total_amount/$grand_total_fin_fab_qnty,2);?></td>
            <td align="right">
            <?
			echo number_format($grand_total_amount,0);
			?>
            </td>
            </tr>
            <tr style="font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/


				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.uom=27 and
												a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

			?>
			<td width='50' align='right'><?  //echo number_format(($color_wise_wo_result_qnty['fin_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td>
            <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <?
			}
			?>
            <td align="right">
			<?
			$consumption_per_unit_fab=($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
			echo number_format($consumption_per_unit_fab,0);
			//$grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4)
			?>
            </td>
            <td align="right">
			<?
			$consumption_per_unit_amuont=($grand_total_amount/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
			echo number_format(($consumption_per_unit_amuont/$consumption_per_unit_fab),2);
			//$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4)
			?>
            </td>
            <td align="right" title="Only Allow Round Figer">
            <?
			echo number_format($consumption_per_unit_amuont,0);
			?>
            </td>
            </tr>
    </table>
    <?
	}
	}
	?>
        <br/>

        <?

		if($cbo_fabric_source==1 || $cbo_fabric_source==2){
		?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
        <tr>
        <?
		//echo "select a.colar_cuff_per,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id    and a.booking_no=$txt_booking_no and a.booking_type=1 c.body_part_id in(2) and a.status_active=1 and a.is_deleted=0";
		$colar_percent_size_wise_array=return_library_array( "select a.colar_cuff_per,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id    and a.booking_no=$txt_booking_no and a.booking_type=1 and c.body_part_id in(2) and a.status_active=1 and a.is_deleted=0", "gmts_sizes", "colar_cuff_per");
		//print_r($colar_percent_size_wise_array);
		$nameArray_item_size=sql_select( "select min(c.id) as id,b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id  and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by id");
		if(count($nameArray_item_size)>0)
		{
        ?>
        <td width="49%">
        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
        <tr>
        <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Collar -  Colour Size Brakedown in Pcs</b></td>
        </tr>
        <tr>
        <td width="70">Size</td>

        <?

		/*$nameArray_item_size=sql_select( "select b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by c.size_number_id,b.item_size order by c.size_number_id");*/
		foreach($nameArray_item_size  as $result_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
		<?
        }
        ?>
        <td rowspan="2" align="center"><strong>Total</strong></td>
        <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
        </tr>
        <tr>
        <td>Collar Size</td>

        <?
        foreach($nameArray_item_size  as $result_item_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
		<?
        }
        ?>
         <?

			$color_wise_wo_sql=sql_select("select a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id,sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by c.color_number_id,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method order by a.id
");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
			$color_total_collar=0;
			$color_total_collar_order_qnty=0;
			$process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
			$constrast_color_arr=array();
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				$constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
				for($i=0;$i<count($constrast_color);$i++)
				{
					$constrast_color2=explode('_',$constrast_color[$i]);
					$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
				}
			}
		?>
			<tr>
            <td>
            <?
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]) ;
				$lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
			}
			else
			{
				echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
				$lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
			}
			?>

            </td>
            <?
            foreach($nameArray_item_size  as $result_size)
			{
				?>
				<td align="center" style="border:1px solid black">
				<?
				$color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0");

				list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
				$plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
				$colar_excess_per=($plan_cut*$colar_excess_percent)/100;
				echo number_format($plan_cut+$colar_excess_per,0);
				$color_total_collar+=$plan_cut+$colar_excess_per;
				$color_total_collar_order_qnty+=$plan_cut;
				$grand_total_collar+=$plan_cut+$colar_excess_per;
				$grand_total_collar_order_qnty+=$plan_cut;
				?>
                </td>
				<?
			}
			?>

            <td align="center"><? echo number_format($color_total_collar,0); ?></td>
            <td align="center"><? echo number_format((($color_total_collar-$color_total_collar_order_qnty)/$color_total_collar_order_qnty)*100,2); ?></td>
            </tr>
            <?
		    }
			?>
            <tr>
                <td>Size Total</td>

                <?
                foreach($nameArray_item_size  as $result_size)
                {
                ?>
                <td style="border:1px solid black;  text-align:center"><? $colar_excess_pers=($size_tatal[$result_size[csf('size_number_id')]]*$colar_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]+$colar_excess_pers,0); ?></td>
                <?
                }
                ?>
                <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_collar,0); ?></td>
                <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_collar-$grand_total_collar_order_qnty)/$grand_total_collar_order_qnty)*100,2); ?></td>
            </tr>
        </table>
        </td>
        <td width="2%">
        </td>
        <?
        }
		?>

        <?
		$cuff_percent_size_wise_array=return_library_array( "select a.colar_cuff_per,b.gmts_sizes from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b,wo_pre_cost_fabric_cost_dtls c  where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id    and a.booking_no=$txt_booking_no and a.booking_type=1 and c.body_part_id in(3) and a.status_active=1 and a.is_deleted=0", "gmts_sizes", "colar_cuff_per");
		//print_r($cuff_percent_size_wise_array);
		$nameArray_item_size=sql_select( "select min(c.id) as id, b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=3  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by id");

		if(count($nameArray_item_size)>0)
		{
        ?>
        <td width="49%">
        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
        <tr>
        <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Cuff -  Colour Size Brakedown in Pcs</b></td>
        </tr>
        <tr>
        <td width="70">Size</td>

        <?
		foreach($nameArray_item_size  as $result_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
		<?
        }
        ?>
        <td rowspan="2" align="center"><strong>Total</strong></td>
        <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
        </tr>
        <tr>
        <td>Cuff Size</td>

        <?
        foreach($nameArray_item_size  as $result_item_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
		<?
        }
        ?>
         <?

			$color_wise_wo_sql=sql_select("select a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id,sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=3  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and  d.status_active=1 and d.is_deleted=0 group by c.color_number_id ,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method order by a.id
");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
			$color_total_cuff=0;
			$color_total_cuff_order_qnty=0;
			$process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
			$constrast_color_arr=array();
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				$constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
				for($i=0;$i<count($constrast_color);$i++)
				{
					$constrast_color2=explode('_',$constrast_color[$i]);
					$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
				}
			}
			//print_r($constrast_color_arr);
		?>
			<tr>
            <td>
            <?
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				///echo $color_wise_wo_result[csf('color_number_id')];
				echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]);
				$lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
			}
			else
			{
				echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
				$lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
			}
			?>

            </td>
            <?
            foreach($nameArray_item_size  as $result_size)
			{
				?>
				<td align="center" style="border:1px solid black">

				<?
				/*$color_wise_wo_sql_qnty=sql_select("select c.color_number_id,sum(c.order_quantity) as order_quantity, sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=3 and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 and c.color_number_id='".$color_wise_wo_result['color_number_id']."' and c.size_number_id='".$result_size['size_number_id']."'");*/
				$color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0");

				list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
				$plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
				$cuff_excess_per=(($plan_cut*2)*$cuff_excess_percent)/100;
				echo number_format($plan_cut*2+$cuff_excess_per,0);
				$color_total_cuff+=$plan_cut*2+$cuff_excess_per;
				$color_total_cuff_order_qnty+=$plan_cut*2;
				$grand_total_cuff+=$plan_cut*2+$cuff_excess_per;
				$grand_total_cuff_order_qnty+=$plan_cut*2;

				/*$cuff_excess_per=(($plan_cut_qnty[csf('plan_cut_qnty')]*2)*$cuff_excess_percent)/100;
				echo number_format($plan_cut_qnty[csf('plan_cut_qnty')]*2+$cuff_excess_per,0);
				$color_total_cuff+=$plan_cut_qnty[csf('plan_cut_qnty')]*2+$cuff_excess_per;
				$color_total_cuff_order_qnty+=$plan_cut_qnty[csf('order_quantity')]*2;
				$grand_total_cuff+=$plan_cut_qnty[csf('plan_cut_qnty')]*2+$cuff_excess_per;
				$grand_total_cuff_order_qnty+=$plan_cut_qnty[csf('order_quantity')]*2;*/

				?>

                </td>
				<?
			}
			?>

            <td align="center"><? echo number_format($color_total_cuff,0); ?></td>
            <td align="center"><? echo number_format((($color_total_cuff-$color_total_cuff_order_qnty)/$color_total_cuff_order_qnty)*100,2); ?></td>
            </tr>
            <?
		    }
			?>
            <tr>
                <td>Size Total</td>

                <?
                foreach($nameArray_item_size  as $result_size)
                {
                   /* $nameArray_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =$result_size[size_number_id]  and status_active=1 and is_deleted =0 order by id");
                foreach($nameArray_size_qnty as $result_size_qnty)
                {*/
                ?>
                <td style="border:1px solid black;  text-align:center"><? $cuff_excess_pers=(($size_tatal[$result_size[csf('size_number_id')]]*2)*$cuff_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]*2+$cuff_excess_pers,0); ?></td>
                <?
                //}
                }
                ?>
                <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_cuff,0); ?></td>
                <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_cuff-$grand_total_cuff_order_qnty)/$grand_total_cuff_order_qnty)*100,2); ?></td>
            </tr>
        </table>
        </td>
        <?
				}
		?>
        </tr>
        </table>
        <br/>

        <table  width="100%"  border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td width="49%" style="border:solid; border-color:#000; border-width:thin" valign="top">
                    <table  width="100%"  border="0" cellpadding="0" cellspacing="0">
                	<thead>
                    	<tr>
                        	<th width="3%"></th><th width="97%" align="left"><u>Special Instruction</u></th>
                        </tr>
                    </thead>
                    <tbody>
                    <?
					$data_array=sql_select("select id, terms from  wo_booking_terms_condition where booking_no=$txt_booking_no");// quotation_id='$data'
					if ( count($data_array)>0)
					{
						$i=0;
						foreach( $data_array as $row )
						{
							$i++;
							?>
                            	<tr id="settr_1" valign="top">
                                    <td style="vertical-align:top">
                                    <? echo $i;?>
                                    </td>
                                    <td>
                                   <strong style="font-size:20px"> <? echo $row[csf('terms')]; ?></strong>
                                    </td>
                                </tr>
                            <?
						}
					}
					/*else
					{
				    $i=0;
					$data_array=sql_select("select id, terms from  lib_terms_condition");// quotation_id='$data'
					foreach( $data_array as $row )
						{
							$i++;
					?>
                    <tr id="settr_1" align="">
                                    <td valign="top">
                                    <? echo $i;?>
                                    </td>
                                    <td>
                                    <? echo $row['terms']; ?>
                                    </td>

                                </tr>
                    <?
						}
					} */
					?>
                </tbody>
                </table>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top">
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                        <tr align="center">
                        <td><b>Approved Instructions</b></td>

                        </tr>
                        <tr>
                        <td>
                    <?  echo $nameArray_approved_comments_row[csf('comments')];  ?>
                    </td>
                    </tr>
                    </table>
                	<br />
                   <!--<table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                   <tr align="center">
                    <td colspan="10"><b>Comments</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Po NO</td>
                    <td>Ship Date</td>
                    <td>Pre-Cost Qty</td>
                    <td>Mn.Book Qty</td>
                    <td>Sht.Book Qty</td>
                    <td>Smp.Book Qty</td>
                    <td>Tot.Book Qty</td>
                    <td>Balance</td>
                    <td>Comments</td>
                    </tr>
                    <?
	$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
	$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
	if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
	if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
	$paln_cut_qnty_array=return_library_array( "select min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id,size_number_id,item_number_id,po_break_down_id", "id", "plan_cut_qnty");

	$item_ratio_array=return_library_array( "select gmts_item_id,set_item_ratio from wo_po_details_mas_set_details  where job_no =$txt_job_no", "gmts_item_id", "set_item_ratio");



	$nameArray=sql_select("
	select
	a.id,
	a.item_number_id,
	a.costing_per,
	b.po_break_down_id,
	b.color_size_table_id,
	b.requirment,
	c.po_number
FROM
	wo_pre_cost_fabric_cost_dtls a,
	wo_pre_cos_fab_co_avg_con_dtls b,
	wo_po_break_down c
WHERE
	a.job_no=b.job_no and
	a.job_no=c.job_no_mst and
    a.id=b.pre_cost_fabric_cost_dtls_id and
	b.po_break_down_id=c.id and
	b.po_break_down_id in (".str_replace("'","",$txt_order_no_id).")  $cbo_fabric_natu $cbo_fabric_source_cond and a.status_active=1 and a.is_deleted=0
	order by id");

	$count=0;
	$tot_grey_req_as_pre_cost_arr=array();
	foreach ($nameArray as $result)
	{
		if (count($nameArray)>0 )
		{
            if($result[csf("costing_per")]==1)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(12*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			if($result[csf("costing_per")]==2)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(1*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			if($result[csf("costing_per")]==3)
			{

				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(24*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			if($result[csf("costing_per")]==4)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(36*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			if($result[csf("costing_per")]==5)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(48*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			$tot_grey_req_as_pre_cost_arr[$result[csf("po_number")]]+=$tot_grey_req_as_pre_cost;
        }
    }
	                $total_pre_cost=0;
					$total_booking_qnty_main=0;
					$total_booking_qnty_short=0;
					$total_booking_qnty_sample=0;
					$total_tot_bok_qty=0;
					$tot_balance=0;

					/*$booking_qnty=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and booking_type in(1,4)  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by a.po_break_down_id", "po_break_down_id", "grey_fab_qnty");*/
					//$booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and a.is_short=2 and c.item_category=2 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

					$booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and a.is_short=2 and c.item_category=2 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

					$booking_qnty_short=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and c.item_category=2 and a.is_short=1 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
					$booking_qnty_sample=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c  where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =4 and c.fabric_source=$cbo_fabric_source and c.item_category=2  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
					$sql_data=sql_select( "select max(a.id) as id,  a.po_number,max(a.pub_shipment_date) as pub_shipment_date,sum(a.plan_cut) as plan_cut  from wo_po_break_down a,wo_pre_cost_sum_dtls b,wo_pre_cost_mst c where a.job_no_mst=b.job_no and a.job_no_mst=c.job_no and a.id in(".str_replace("'","",$txt_order_no_id).") group by a.po_number order by id");
					foreach($sql_data  as $row)
                    {
					$col++;
					?>
                    <tr align="center">
                    <td><? echo $col; ?></td>
                    <td><? echo $row[csf("po_number")]; ?></td>
                     <td><? echo change_date_format($row[csf("pub_shipment_date")],"dd-mm-yyyy",'-'); ?></td>
                    <td align="right"><? echo number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]],2); $total_pre_cost+=$tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]; ?></td>
                    <td align="right"><? echo number_format($booking_qnty_main[$row[csf("id")]],2); $total_booking_qnty_main+=$booking_qnty_main[$row[csf("id")]];?></td>
                    <td align="right"><? echo number_format($booking_qnty_short[$row[csf("id")]],2); $total_booking_qnty_short+=$booking_qnty_short[$row[csf("id")]];?></td>
                    <td align="right"><? echo number_format($booking_qnty_sample[$row[csf("id")]],2); $total_booking_qnty_sample+=$booking_qnty_sample[$row[csf("id")]];?></td>
                    <td align="right"><? $tot_bok_qty=$booking_qnty_main[$row[csf("id")]]+$booking_qnty_short[$row[csf("id")]]+$booking_qnty_sample[$row[csf("id")]]; echo number_format($tot_bok_qty,2); $total_tot_bok_qty+=$tot_bok_qty;?></td>
                    <td align="right">
					<? $balance= def_number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]-$tot_bok_qty,2,""); echo number_format($balance,2); $tot_balance+= $balance?>
                    </td>
                    <td>
					<?
					if( $balance>0)
					{
						echo "Less Booking";
					}
					else if ($balance<0)
					{
						echo "Over Booking";
					}
					else
					{
						echo "";
					}
					?>
                    </td>
                    </tr>
                    <?
					}
					?>
                    <tfoot>
                    <tr>
                    <td colspan="3">Total:</td>
                    <td align="right"><? echo number_format($total_pre_cost,2); ?></td>
                    <td align="right"><? echo number_format($total_booking_qnty_main,2); ?></td>
                    <td align="right"><? echo number_format($total_booking_qnty_short,2); ?></td>
                    <td align="right"><? echo number_format($total_booking_qnty_sample,2); ?></td>
                     <td align="right"><? echo number_format($total_tot_bok_qty,2); ?></td>
                    <td align="right"><? echo number_format($tot_balance,2); ?></td>
                    <td></td>
                    </tr>
                    </tfoot>
                    </table>-->
                </td>

            </tr>
        </table>
       <br>
        <?
		}// fabric Source End
		?>

         <!--<br><br><br><br>-->
         <?
		 	echo signature_table(1, $cbo_company_name, "1330px");
		 ?>

       </div>
       <?

}


if($action=="show_fabric_booking_report" || $action=="show_fabric_booking_report_b6")//show_fabric_booking_report_b6 for bpkw issue id ISD-20-20851
{
	extract($_REQUEST);
	 $cbo_company_name=str_replace("'","",$cbo_company_name);
	$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
	$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);

	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1 and master_tble_id='$cbo_company_name'",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	//$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$marchentrArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info ","id","team_member_name");
	$lib_buyer_season = return_library_array("select id,season_name from lib_buyer_season ","id","season_name");
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$location_name_arr=return_library_array( "select id,location_name from lib_location",'id','location_name');
	$po_qnty_tot=return_field_value( "sum(plan_cut)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	$po_qnty_tot1=return_field_value( "sum(po_quantity)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	$pro_sub_dept_array=return_library_array( "select id,sub_department_name from lib_pro_sub_deparatment",'id','sub_department_name');
	$booking_po_id=str_replace("'","",$txt_order_no_id);
	$uom_id=return_field_value( "uom", "wo_booking_mst","status_active=1 and is_deleted=0 and booking_no=$txt_booking_no");
	?>
	<div style="width:1330px" align="center">
    <?php
	$nameArray_approved = sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7");
	list($nameArray_approved_row) = $nameArray_approved;
	$nameArray_approved_date = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
	list($nameArray_approved_date_row) = $nameArray_approved_date;
	$nameArray_approved_comments = sql_select("select b.comments as comments from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
	list($nameArray_approved_comments_row) = $nameArray_approved_comments;
	$path = str_replace("'", "", $path);
	if ($path != "") {
		$path = $path;
	} else {
		$path = "../../";
	}

	?>										<!--    Header Company Information         -->
       <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black" >
           <tr>
               <td width="100">
                <img  src='<? echo $path.$imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
               <!--<img  src='../../<? //echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />-->
               </td>
               <td width="1250">
                    <table width="100%" cellpadding="0" cellspacing="0"  >
                        <tr>
                            <td align="center" style="font-size:20px;">
                              <?php
								echo $company_library[$cbo_company_name];
								?>
                            </td>
                            <td rowspan="3" width="250">

                               <span style="font-size:18px"><b> Job No:&nbsp;&nbsp;<? echo trim($txt_job_no,"'"); ?></b></span><br/>
                                <?
								 if($nameArray_approved_row[csf('approved_no')]>1)
								 {
								 ?>
								 <b> Revised No: <? echo $nameArray_approved_row[csf('approved_no')]-1; ?></b>
                                  <br/>
								  Approved Date: <? echo $nameArray_approved_date_row[csf('approved_date')]; ?>
								  <?
								 }
							  	?>


                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:14px">
                            <?
                            $nameArray=sql_select( "select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
							//$location=return_field_value("location_name","lib_location","id=$data[3]" );
							//$nameArray=sql_select("select location_name from wo_po_details_master where job_no=$txt_job_no");
							if($txt_job_no!="")
							{
							 $location=return_field_value( "location_name", "wo_po_details_master","job_no=$txt_job_no");
							}
							else
							{
							$location="";
							}

							foreach ($nameArray as $result)
                            {
							 echo  $location_name_arr[$location];
                            ?>

                               <!-- Plot No: <? //echo $result[csf('plot_no')]; ?>
                                Level No: <? //echo $result[csf('level_no')]?>
                                Road No: <? //echo $result[csf('road_no')]; ?>
                                Block No: <? //echo $result[csf('block_no')];?>
                                City No: <? //echo $result[csf('city')];?>
                                Zip Code: <? //echo $result[csf('zip_code')]; ?>
                                Province No: <?php //echo $result[csf('province')];?>
                                Country: <? //echo $country_arr[$result[csf('country_id')]]; ?> --><br>
                                Email Address: <? echo $result[csf('email')];?>
                                Website No: <? echo $result[csf('website')]; ?>

                                <?

                            }

                            ?>
                               </td>
                            </tr>
                            <tr>
                            <td align="center" style="font-size:20px">
                                <strong><? if($report_title !=""){ echo $report_title;} else { echo "General Work Order";}?> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style="color:#F00"><? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </font></strong>
                             </td>
                            </tr>
                      </table>
                </td>
            </tr>
       </table>
                <?
				$sample_booking_arr=array();
				$namesamplefab=sql_select( "select a.booking_no , sum(b.grey_fab_qnty) as grey_fab_qnty  from wo_booking_mst a, wo_booking_dtls b where  a.job_no=b.job_no and a.booking_no=b.booking_no  and a.tagged_booking_no=$txt_booking_no group by a.booking_no");
				foreach($namesamplefab as $namesamplefabrow){
					$sample_booking_arr['booking_no'][$namesamplefabrow[csf('booking_no')]]=$namesamplefabrow[csf('booking_no')];
					$sample_booking_arr['grey_fab_qnty'][$namesamplefabrow[csf('booking_no')]]=$namesamplefabrow[csf('grey_fab_qnty')];
				}
				$sample_booking_no=implode($sample_booking_arr['booking_no']);
				$sample_booking_qty=array_sum($sample_booking_arr['grey_fab_qnty']);

				$job_no='';
				$total_set_qnty=0;
				$colar_excess_percent=0;
				$cuff_excess_percent=0;
				$rmg_process_breakdown=0;

                $nameArray=sql_select( "SELECT a.booking_no,a.booking_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.delivery_date,a.po_break_down_id,a.colar_excess_percent,a.cuff_excess_percent,a.delivery_date,a.is_apply_last_update,a.fabric_source,a.pay_mode,a.item_category,a.rmg_process_breakdown,a.insert_date,a.update_date,b.job_no,b.buyer_name, b.style_ref_no ,b.gmts_item_id,b.order_uom,b.total_set_qnty,b.style_description,b.product_dept,b.product_code,b.pro_sub_dep,b.dealing_marchant,b.season_buyer_wise from wo_booking_mst a, wo_po_details_master b where  a.job_no=b.job_no and a.booking_no=$txt_booking_no");
				foreach ($nameArray as $result)
				{
					$total_set_qnty=$result[csf('total_set_qnty')];
					$colar_excess_percent=$result[csf('colar_excess_percent')];
				    $cuff_excess_percent=$result[csf('cuff_excess_percent')];
					$rmg_process_breakdown=$result[csf('rmg_process_breakdown')];
					$po_no="";
					$shipment_date="";
					$sql_po= "select po_number,MIN(pub_shipment_date) pub_shipment_date, sc_lc from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by po_number,sc_lc";
					$sc_lc_arr=array();
					$data_array_po=sql_select($sql_po);
					foreach ($data_array_po as $row_po)
					{
						$po_no.=$row_po[csf('po_number')].", ";
						$sc_lc_arr[$row_po[csf('sc_lc')]]=$row_po[csf('sc_lc')];
						$shipment_date.=change_date_format($row_po[csf('pub_shipment_date')],'dd-mm-yyyy','-').", ";
					}
					$lead_time="";
					if($db_type==0)
					{
					$sql_lead_time= "select DATEDIFF(pub_shipment_date,po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}
					if($db_type==2)
					{
					$sql_lead_time= "select (pub_shipment_date-po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}
					$data_array_lead_time=sql_select($sql_lead_time);
					foreach ($data_array_lead_time as $row_lead_time)
					{
						$lead_time.=$row_lead_time[csf('date_diff')].",";
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}
					$po_received_date="";
					$sql_po_received_date= "select MIN(po_received_date) as po_received_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					$data_array_po_received_date=sql_select($sql_po_received_date);
					foreach ($data_array_po_received_date as $row_po_received_date)
					{
						$po_received_date=change_date_format($row_po_received_date[csf('po_received_date')],'dd-mm-yyyy','-');
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}






					$sql_po= "select po_number,MIN(pub_shipment_date) pub_shipment_date, MIN(insert_date) as insert_date,shiping_status from wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by po_number,shiping_status";
					$data_array_po=sql_select($sql_po);
					foreach ($data_array_po as $rows)
					{
						$daysInHand.=(datediff('d',date('d-m-Y',time()),$rows[csf('pub_shipment_date')])-1).",";
						$booking_date=$result[csf('update_date')];
						if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
						{
							$booking_date=$result[csf('insert_date')];
						}
						$WOPreparedAfter.=(datediff('d',$rows[csf('insert_date')],$booking_date)-1).",";

						if($rows[csf('shiping_status')]==1)
						{
						$shiping_status.= "FP".",";
						}
						else if($rows[csf('shiping_status')]==2)
						{
						$shiping_status.= "PS".",";
						}
						else if($rows[csf('shiping_status')]==3)
						{
						$shiping_status.= "FS".",";
						}

					}

				if($db_type==2) $group_concat_all=" listagg(cast(b.grouping as varchar2(4000)),',') within group (order by b.grouping) as grouping,
	                                    listagg(cast(b.file_no as varchar2(4000)),',') within group (order by b.file_no) as file_no  ";
				else { $group_concat_all="group_concat(b.grouping) as grouping, group_concat(b.file_no) as file_no";}
				$data_array3=sql_select("select a.job_no,a.company_name,a.buyer_name,$group_concat_all from wo_po_details_master a, wo_po_break_down b where b.id in (".$result[csf('po_break_down_id')].") and a.job_no=b.job_no_mst group by a.job_no,a.company_name,a.buyer_name");
				//$sql_grouping= "select grouping, file_no  from wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by ";

				?>
       <table width="100%" style="border:1px solid black" >
            <tr>
                <td colspan="6" valign="top" style="font-size:18px; color:#F00"><? if($result[csf('is_apply_last_update')]==2){echo "Booking Info not synchronized with order entry and pre-costing. order entry or pre-costing has updated after booking entry.  Contact to ".$marchentrArr[$result[csf('dealing_marchant')]]; } else{ echo "";} ?></td>
            </tr>
            <tr>
                <td width="100"><span style="font-size:18px"><b>Buyer/Agent Name</b></span></td>
                <td width="110">:&nbsp;<span style="font-size:18px"><b><? echo $buyer_name_arr[$result[csf('buyer_name')]]; ?></b></span></td>
                <td width="100"><span style="font-size:12px"><b>Dept.</b></span></td>
                <td width="110">:&nbsp;<? echo $product_dept[$result[csf('product_dept')]] ; if($result[csf('product_code')] !=""){ echo " (".$result[csf('product_code')].")";} if($result[csf('pro_sub_dep')] !=0){ echo " (".$pro_sub_dept_array[$result[csf('pro_sub_dep')]].")";}?></td>
                <td width="100"><span style="font-size:12px"><b>Order Qnty</b></span></td>
                <td width="110">:&nbsp;
				<?  echo $po_qnty_tot1." ".$unit_of_measurement[$result[csf('order_uom')]] ; ?>
                </td>
            </tr>
            <tr>

                <td width="100" style="font-size:12px"><b>Garments Item</b></td>
                <td width="110">:&nbsp;
				<?
				$gmts_item_name="";
				$gmts_item=explode(',',$result[csf('gmts_item_id')]);
				for($g=0;$g<=count($gmts_item); $g++)
				{
					$gmts_item_name.= $garments_item[$gmts_item[$g]].",";
				}
				echo rtrim($gmts_item_name,',');
				?>
                </td>
                <td width="100" style="font-size:12px"><b>Booking Release Date</b></td>
                <td width="110">:&nbsp;
				<?
				$booking_date=$result[csf('update_date')];
				if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
				{
					$booking_date=$result[csf('insert_date')];
				}
				echo change_date_format($booking_date,'dd-mm-yyyy','-','');
				?>&nbsp;&nbsp;&nbsp;</td>
                <td width="100" style="font-size:18px"><b>Style Ref.</b>   </td>
                <td width="110" style="font-size:18px">:&nbsp;<b><? echo $result[csf('style_ref_no')];?> </b>   </td>
            </tr>
             <tr>
                <td  width="100" style="font-size:12px"><b>Style Des.</b></td>
                <td  width="110" >:&nbsp;<? echo $result[csf('style_description')]; $job_no= $result[csf('job_no')];?></td>
                <td width="100" style="font-size:12px"><b>Lead Time </b>   </td>
                <td width="110">:&nbsp;<?  echo rtrim($lead_time,",");?> </td>
                <td width="100" style="font-size:12px"><b>Dealing Merchant</b></td>
                <td width="110">:&nbsp;<? echo $marchentrArr[$result[csf('dealing_marchant')]]; ?></td>
            </tr>

            <tr>
                <td width="100" style="font-size:12px"><b>Supplier Name</b>   </td>
                <td width="110">:&nbsp;<?
				if($result[csf('pay_mode')]==5 || $result[csf('pay_mode')]==3){
						echo $company_library[$result[csf('supplier_id')]];
					}
					else{
					echo $supplier_name_arr[$result[csf('supplier_id')]];
					}
				//echo $supplier_name_arr[$result[csf('supplier_id')]];?>    </td>
              <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
               	<td width="110">:&nbsp;<? echo change_date_format( $result[csf('delivery_date')],'dd-mm-yyyy','-');?></td>
                <td width="100" style="font-size:18px"><b>Booking No </b>   </td>
                <td width="110" style="font-size:18px">:&nbsp;<b><? echo $result[csf('booking_no')];?></b><? echo "(".$fabric_source[$result[csf('fabric_source')]].")"?></td>



            </tr>
            <tr>
                <td width="100" style="font-size:12px"><b>Season</b></td>
                <td width="110">:&nbsp;<? echo $lib_buyer_season[$result[csf('season_buyer_wise')]]; ?></td>
                <td  width="100" style="font-size:12px"><b>Attention</b></td>
                <td  width="110" >:&nbsp;<? echo $result[csf('attention')]; ?></td>
                <td  width="100" style="font-size:12px"><b>Po Received Date</b></td>
                <td  width="110" >:&nbsp;<? echo $po_received_date; ?></td>



            </tr>
           <tr>
               <td width="100" style="font-size:18px"><b>Order No</b></td>
               <td width="110" style="font-size:18px" colspan="5">:&nbsp;<b><? echo rtrim($po_no,", "); ?></b></td>     

            </tr>
            <tr>
               <td width="100" style="font-size:18px"><b>Shipment Date</b></td>
               <td width="110" colspan="5" style="font-size:18px"> :&nbsp;<? echo rtrim($shipment_date,", "); ?></td>
            </tr>

              <tr>
                <td width="100" style="font-size:18px"><b>Fabric Nature</b></td>
                <td  width="110" style="font-size:18px">:&nbsp;<? echo $item_category[$result[csf('item_category')]]; ?></td>
                <td width="100" style="font-size:18px"><b>Pay Mode</b></td>
                <td  width="110" style="font-size:18px">:&nbsp;<? echo $pay_mode[$result[csf('pay_mode')]]; ?></td>
                <td width="100" style="font-size:18px"><b></b></td>
                <td  width="110" >&nbsp;</td>
            </tr>

            </tr>
            <tr>
               <td width="100" style="font-size:12px"><b>WO Prepared After</b></td>
               <td width="110"> :&nbsp;<? echo rtrim($WOPreparedAfter,',').' Days' ?></td>

               <td width="100" style="font-size:12px"><b>Ship.days in Hand</b></td>
               <td width="110"> :&nbsp;<? echo rtrim($daysInHand,',').' Days'?></td>

               <td width="100" style="font-size:12px"><b>Ex-factory status</b></td>
               <td width="110"> :&nbsp;<? echo rtrim($shiping_status,','); ?></td>

            </tr>
           <tr>
               <td width="100" style="font-size:18px"><b>Internal Ref No</b></td>
               <td width="110" style="font-size:18px"> :&nbsp;<b><? echo implode(",",array_unique(explode(",",$data_array3[0][csf("grouping")]))); ?></b></td>

               <td width="100" style="font-size:18px"><b>File no</b></td>
               <td width="110" style="font-size:18px"> :&nbsp;<b><? echo  implode(",",array_unique(explode(",",$data_array3[0][csf("file_no")])));?></b></td>
               <td width="100" style="font-size:18px">SC/LC</td>
               <td width="110" style="font-size:18px">:&nbsp;<? echo implode(", ", $sc_lc_arr); ?></td>
            </tr>

              <?php if ($sample_booking_no != '') {?>
                <tr>
                    <td colspan="5" align="center">
                  <strong> <? echo "Fabric of Sample Fabric Booking No:".$sample_booking_no.", Total Fabric=".$sample_booking_qty." KG,will be Dyed with this fabric."; ?> </strong>
                    </td>
                </tr>
                <?php }?>

        </table>
           <?

			}
			if($cbo_fabric_source==1)
			{
			//$nameArray_size=sql_select( "select distinct size_number_id from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  	is_deleted=0 and status_active=1 order by size_number_id");
			//$nameArray_size=sql_select( "select  size_number_id,min(id) as id,	min(size_order) as size_order from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  	is_deleted=0 and status_active=1 group by size_number_id order by id");
			$nameArray_size=sql_select( "select  size_number_id,min(id) as id,	min(size_order) as size_order from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  	is_deleted=0 and status_active=1 group by size_number_id order by size_order");

		   ?>
            <table width="100%" >
		    <tr>
            <td width="800">
                <div id="div_size_color_matrix" style="float:left; max-width:1000;">
            	<fieldset id="div_size_color_matrix" style="max-width:1000;">
 				<legend>Size and Color Breakdown</legend>
 				<table  class="rpt_table"  border="1" align="left" cellpadding="0" width="750" cellspacing="0" rules="all" >
                    <tr>
                        <td style="border:1px solid black"><strong>Color/Size</strong></td>
                    <?
						foreach($nameArray_size  as $result_size)
                        {	     ?>
                        <td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
                    <?	}    ?>
                        <td style="border:1px solid black; width:130px" align="center"><strong> Total Order Qty(Pcs)</strong></td>
                        <td style="border:1px solid black; width:80px" align="center"><strong> Excess %</strong></td>
                        <td style="border:1px solid black; width:130px" align="center"><strong> Total Plan Cut Qty(Pcs)</strong></td>
                    </tr>
                    <?
					$color_size_order_qnty_array=array();
					$color_size_qnty_array=array();
					$size_tatal=array();
					$size_tatal_order=array();
					for($c=0;$c<count($gmts_item); $c++)
				    {
					$item_size_tatal=array();
					$item_size_tatal_order=array();
					$item_grand_total=0;
					$item_grand_total_order=0;
					//$nameArray_color=sql_select( "select distinct color_number_id from wo_po_color_size_breakdown where  item_number_id=$gmts_item[$c] and po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 order by color_number_id");
					//$nameArray_color=sql_select( "select  color_number_id,min(id) as id,min(color_order) as color_order from wo_po_color_size_breakdown where  item_number_id=$gmts_item[$c] and po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id  order by id");
					$nameArray_color=sql_select( "select  color_number_id,min(id) as id,min(color_order) as color_order from wo_po_color_size_breakdown where  item_number_id=$gmts_item[$c] and po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id  order by color_order");
					?>
                    <tr>
                    <td style="border:1px solid black" colspan="<? echo count($nameArray_size)+3;?>"><strong><? echo $garments_item[$gmts_item[$c]];?></strong></td>

                    </tr>
                    <?
					foreach($nameArray_color as $result_color)
                    {
                    ?>
                    <tr>
                        <td align="center" style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; // echo $row_num_tr; ?></td>
                        <?
						$color_total=0;
						$color_total_order=0;

						foreach($nameArray_size  as $result_size)
						{
						$nameArray_color_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as  order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$result_color[csf('color_number_id')]."  and item_number_id=$gmts_item[$c] and  status_active=1 and is_deleted =0");
						foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                        {
                        ?>
                            <td style="border:1px solid black; text-align:right">
							<?
								if($result_color_size_qnty[csf('plan_cut_qnty')]!= "")
								{
									 echo number_format($result_color_size_qnty[csf('order_quantity')],0);
									 $color_total += $result_color_size_qnty[csf('plan_cut_qnty')] ;
									 $color_total_order += $result_color_size_qnty[csf('order_quantity')] ;
									 $item_grand_total+=$result_color_size_qnty[csf('plan_cut_qnty')];
									 $item_grand_total_order+=$result_color_size_qnty[csf('order_quantity')];
								     $grand_total +=$result_color_size_qnty[csf('plan_cut_qnty')];
									 $grand_total_order +=$result_color_size_qnty[csf('order_quantity')];

									 $color_size_qnty_array[$result_size[csf('size_number_id')]][$result_color[csf('color_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
									 $color_size_order_qnty_array[$result_size[csf('size_number_id')]][$result_color[csf('color_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
									 if (array_key_exists($result_size[csf('size_number_id')], $size_tatal))
									 {
											$size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
											$size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
									 }
									 else
									 {
										$size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
										$size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
									 }
									 if (array_key_exists($result_size[csf('size_number_id')], $item_size_tatal))
									 {
											$item_size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
											$item_size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
									 }
									 else
									 {
										$item_size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
										$item_size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
									 }
								}
								else echo "0";
							 ?>
							</td>

                    <?
						}
                        }
                        ?>
                          <td style="border:1px solid black; text-align:right"><?  echo number_format(round($color_total_order),0); ?></td>

                         <td style="border:1px solid black; text-align:right"><? $excexss_per=($color_total-$color_total_order)/$color_total_order*100; echo number_format($excexss_per,2)." %"; ?>
                         </td>
                        <td style="border:1px solid black; text-align:right"><? echo number_format(round($color_total),0); ?></td>
                    </tr>
                    <?
                    }
					?>

                        <td align="center" style="border:1px solid black"><strong>Sub Total</strong></td>
                        <?
						foreach($nameArray_size  as $result_size)
                        {
                        ?>
                        <td style="border:1px solid black;  text-align:right"><? echo $item_size_tatal_order[$result_size[csf('size_number_id')]];  ?></td>
                        <?
                        }
                        ?>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($item_grand_total_order),0); ?></td>
                        <td  style="border:1px solid black;  text-align:right"><? $excess_item_gra_tot=($item_grand_total-$item_grand_total_order)/$item_grand_total_order*100; echo number_format($excess_item_gra_tot,2)." %"; ?></td>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($item_grand_total),0); ?></td>
                    </tr>
                    <?
					}
                    ?>
                     <tr>
                        <td style="border:1px solid black" align="center" colspan="<? echo count($nameArray_size)+3; ?>"><strong>&nbsp;</strong></td>
                        </tr>
                    <tr>
                    <tr>
                        <td align="center" style="border:1px solid black"><strong>Grand Total</strong></td>
                        <?
						foreach($nameArray_size  as $result_size)
                        {
                        ?>
                        <td style="border:1px solid black;  text-align:right"><? echo $size_tatal_order[$result_size[csf('size_number_id')]];  ?></td>
                        <?
                        }
                        ?>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($grand_total_order),0); ?></td>
                        <td  style="border:1px solid black;  text-align:right"><? $excess_gra_tot= ($grand_total-$grand_total_order)/$grand_total_order*100; echo number_format($excess_gra_tot,2)." %"; ?></td>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($grand_total),0); ?></td>
                    </tr>
                </table>
                </fieldset>
                </div>
                </td>
                <td width="200" valign="top" align="left">
                <div id="div_size_color_matrix" style="float:left;">
                <?
				$rmg_process_breakdown_arr=explode('_',$rmg_process_breakdown)
				?>
            	 	<fieldset id="" >
 				<legend>RMG Process Loss % </legend>
            	<table width="180" class="rpt_table" border="1" rules="all">
                <?
				if(number_format($rmg_process_breakdown_arr[8],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Cut Panel rejection <!-- Extra Cutting % breack Down 8-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[8],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[2],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Chest Printing <!-- Printing % breack Down 2-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[2],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[10],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Neck/Sleeve Printing <!-- New breack Down 10-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[10],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[1],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Embroidery   <!-- Embroidery  % breack Down 1-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[1],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[4],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Sewing /Input<!-- Sewing % breack Down 4-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[4],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[3],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Garments Wash <!-- Washing %breack Down 3-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[3],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[15],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Gmts Finishing <!-- Washing %breack Down 3-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[15],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[11],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Others <!-- New breack Down 11-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[11],2);
				?>
                </td>
                </tr>
                <?
                }
				$gmts_pro_sub_tot=$rmg_process_breakdown_arr[8]+$rmg_process_breakdown_arr[2]+$rmg_process_breakdown_arr[10]+$rmg_process_breakdown_arr[1]+$rmg_process_breakdown_arr[4]+$rmg_process_breakdown_arr[3]+$rmg_process_breakdown_arr[11]+$rmg_process_breakdown_arr[15];
				if($gmts_pro_sub_tot>0)
				{
				?>
                <tr>
                <td width="130">
                Sub Total <!-- New breack Down 11-->
                </td>
                <td align="right">
                <?

				echo number_format($gmts_pro_sub_tot,2);
				?>
                </td>
                </tr>
                <?
				}
				?>
                </table>
                </fieldset>


                <fieldset id="" >
 				<legend>Fabric Process Loss % </legend>
            	<table width="180" class="rpt_table" border="1" rules="all">
                 <?
				if(number_format($rmg_process_breakdown_arr[6],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Knitting  <!--  Knitting % breack Down 6-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[6],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[12],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Yarn Dyeing  <!--  New breack Down 12-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[12],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[5],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Dyeing & Finishing  <!-- Finishing % breack Down 5-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[5],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[13],2)>0)
				{
				?>
                <tr>
                <td width="130">
                All Over Print <!-- new  breack Down 13-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[13],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[14],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Lay Wash (Fabric) <!-- new  breack Down 14-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[14],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[7],2)>0)
				{
				?>
                 <tr>
                <td width="130">
                Dying   <!-- breack Down 7-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[7],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[0],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Cutting (Fabric) <!-- Cutting % breack Down 0-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[0],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[9],2)>0)
				{
				?>
                <tr>
                <td width="130">
               Others  <!-- Others% breack Down 9-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[9],2);
				?>
                </td>
                </tr>
                <?
				}
				$fab_proce_sub_tot=$rmg_process_breakdown_arr[6]+$rmg_process_breakdown_arr[12]+$rmg_process_breakdown_arr[5]+$rmg_process_breakdown_arr[13]+$rmg_process_breakdown_arr[14]+$rmg_process_breakdown_arr[7]+$rmg_process_breakdown_arr[0]+$rmg_process_breakdown_arr[9];
				if($fab_proce_sub_tot>0)
				{
				?>
                <tr>
                <td width="130">
                Sub Total  <!-- Others% breack Down 9-->
                </td>
                <td align="right">
                <?

				echo number_format($fab_proce_sub_tot,2);
				?>
                </td>
                </tr>
                <?
				}
				if($gmts_pro_sub_tot+$fab_proce_sub_tot>0)
				{
				?>
                 <tr>
                <td width="130">
                Grand Total  <!-- Others% breack Down 9-->
                </td>
                <td align="right">
                <?
				echo number_format($gmts_pro_sub_tot+$fab_proce_sub_tot,2);
				?>
                </td>
                </tr>
                <?
				}
				?>
           </table>
           </fieldset>
           </div>
                </td>
            <td width="330" valign="top" align="left">
            <?
			$nameArray_imge =sql_select("SELECT image_location FROM common_photo_library where master_tble_id='$job_no' and file_type=1");
			?>
            <div id="div_size_color_matrix" style="float:left;">
            	<fieldset id="" >
 				<legend>Image </legend>
            	<table width="310">
                <tr>
                <?
				$img_counter = 0;
                foreach($nameArray_imge as $result_imge)
				{
				    if($path=="")
                    {
                    $path='../../';
                    }

					?>
					<td>
						<!--<img src="../../<? //echo $result_imge[csf('image_location')]; ?>" width="90" height="100" border="2" />-->
                        <img src="<? echo $path.$result_imge[csf('image_location')]; ?>" width="90" height="100" border="2" />
					</td>
					<?

					$img_counter++;
				}
				?>
                </tr>
           </table>
           </fieldset>
           </div>
          </td>
        </tr>
       </table>
        <?
			}// if($cbo_fabric_source==1) end

	  ?>
      <br/>

      <!--  Here will be the main portion  -->
     <?
	 $costing_per="";
	 $costing_per_qnty=0;
	 $costing_per_id=return_field_value( "costing_per", "wo_pre_cost_mst","job_no ='$job_no'");
	 if($costing_per_id==1)
			{
				$costing_per="1 Dzn";
				$costing_per_qnty=12;

			}
			if($costing_per_id==2)
			{
				$costing_per="1 Pcs";

				$costing_per_qnty=1;

			}
			if($costing_per_id==3)
			{
				$costing_per="2 Dzn";
				$costing_per_qnty=24;

			}
			if($costing_per_id==4)
			{
				$costing_per="3 Dzn";
				$costing_per_qnty=36;

			}
			if($costing_per_id==5)
			{
				$costing_per="4 Dzn";
				$costing_per_qnty=48;

			}
			$process_loss_method=return_field_value( "process_loss_method", "wo_pre_cost_fabric_cost_dtls","job_no='$job_no'");

	/*$nameArray_fabric_description= sql_select("SELECT a.color_type_id,a.construction,a.composition,a.gsm_weight,a.dia_width,a.process_loss_percent FROM view_wo_fabric_booking_data_park a,wo_booking_dtls b where b.booking_no =$txt_booking_no and a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and b.status_active=1 and
	b.is_deleted=0  group by a.color_type_id,a.construction,a.composition,a.gsm_weight,a.dia_width,process_loss_percent order by a.pre_cost_fabric_cost_dtls_id");*/
	if($cbo_fabric_source==1)
	{
	$nameArray_fabric_description= sql_select("select min(a.id) as fabric_cost_dtls_id, a.lib_yarn_count_deter_id as determin_id,a.item_number_id,a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight, min(a.width_dia_type) as width_dia_type,b.remarks, b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent , avg(b.requirment) as requirment FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
	WHERE a.job_no=b.job_no and
	a.id=b.pre_cost_fabric_cost_dtls_id and
	c.job_no_mst=a.job_no and
	c.id=b.color_size_table_id and
	b.po_break_down_id=d.po_break_down_id and
	b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
	d.booking_no =$txt_booking_no and
	d.status_active=1 and
	d.is_deleted=0

	group by a.body_part_id,a.lib_yarn_count_deter_id,a.color_type_id,a.item_number_id,a.construction,a.composition,a.gsm_weight,b.remarks,b.dia_width order by fabric_cost_dtls_id,a.body_part_id,b.dia_width");

		 ?>

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" style="font-family:Arial Narrow;" >
     <tr align="center">
     <th colspan="3" align="left">Body Part</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='5'>&nbsp</td>";
			else         		               echo "<td  colspan='5'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
		}
		?>
        <!--<td  rowspan="10" width="50"><p>Total  Finish Fabric <?// if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
        <td  rowspan="10" width="50"><p>Total Grey Fabric <?// if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>-->
        <td  rowspan="10" width="50"><p>Total  Finish Fabric (<? echo $unit_of_measurement[$uom_id];?>)</p></td>
        <td  rowspan="10" width="50"><p>Total Grey Fabric (<? echo $unit_of_measurement[$uom_id];?>)</p></td>
        <td  rowspan="10" width="50"><p>Process Loss % </p></td>
       

        <td  rowspan="10" width="50"><p>Avg Rate <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
        <td  rowspan="10" width="50"><p>Amount </p></td>
       </tr>
     <tr align="center"><th colspan="3" align="left">Color Type</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='5'>&nbsp</td>";
			else         		               echo "<td  colspan='5'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
		}
		?>
        <!--<td  rowspan="8" width="50"><p>Total  Finish Fabric (KG)</p></td> <td  rowspan="8" width="50"><p>Total Grey Fabric (KG)</p></td>-->
             <!--<td  rowspan="7" width="50"><p>Process Loss % </p></td>-->
       </tr>

        <tr align="center"><th colspan="3" align="left">Fabric Construction</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='5'>&nbsp</td>";
			else         		               echo "<td  colspan='5'>". $result_fabric_description[csf('construction')]."</td>";
		}
		?>


       </tr>
        <tr align="center"><th   colspan="3" align="left">Fabric Composition</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='5' >&nbsp</td>";
			else         		               echo "<td colspan='5' >".$result_fabric_description[csf('composition')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th  colspan="3" align="left">GSM</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='5'>&nbsp</td>";
			else         		       echo "<td colspan='5' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th  colspan="3" align="left">Stitch Length</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			$determin_id=$result_fabric_description[csf('determin_id')];
			$s_length=return_field_value( "stitch_length", "fabric_mapping","mst_id=$determin_id");;
			if( $result_fabric_description[csf('determin_id')] == "")   echo "<td colspan='5'>&nbsp</td>";
			else         		       echo "<td colspan='5' align='center'>". $s_length."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='5'>&nbsp</td>";
			else         		              echo "<td colspan='5' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Consumption For <? echo $costing_per; ?></th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('requirment')] == "")   echo "<td colspan='5'>&nbsp</td>";
			else         		              echo "<td colspan='5' align='center'>Fin: ".number_format($result_fabric_description[csf('cons')],4).", Grey: ".number_format($result_fabric_description[csf('requirment')],4)."</td>";
		}
		?>

       </tr>
       <tr>
       <th  colspan="<? echo  count($nameArray_fabric_description)*5+3; ?>" align="left" style="height:30px">&nbsp;</th>
       </tr>

       <tr>
            <!--<th  width="120" align="left">Gmts. Color</th>-->
            <th  width="120" align="left">Fabric Color</th>
            <th  width="120" align="left">Body Color</th>
            <th  width="120" align="left">Lab Dip No</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			  echo "<th width='50'>Finish KG</th><th width='50'>Finish MTR</th><th width='50' >Rate</th><th width='50' >Amount</th><th width='50' >Grey</th>";
		}
		?>

       </tr>
       <?
	   	$color_wise_wo_sql="select a.item_number_id, a.body_part_id, a.color_type_id, a.construction, a.composition, a.gsm_weight, a.lib_yarn_count_deter_id, b.dia_width, b.remarks, d.fabric_color_id, d.fin_fab_qnty as fin_fab_qnty, d.grey_fab_qnty as grey_fab_qnty,d.rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and d.status_active=1 and  d.is_deleted=0 ";

		$color_wise_wo_sql_res=sql_select($color_wise_wo_sql); $fin_grey_qty_arr=array(); $fin_grey_color_qty_arr=array();
		foreach($color_wise_wo_sql_res as $row)
		{
			$fin_grey_qty_arr[$row[csf('item_number_id')]][$row[csf('body_part_id')]][$row[csf('color_type_id')]][$row[csf('construction')]][$row[csf('composition')]][$row[csf('gsm_weight')]][$row[csf('lib_yarn_count_deter_id')]][$row[csf('dia_width')]][$row[csf('remarks')]]['fin']+=$row[csf('fin_fab_qnty')];
			$fin_grey_qty_arr[$row[csf('item_number_id')]][$row[csf('body_part_id')]][$row[csf('color_type_id')]][$row[csf('construction')]][$row[csf('composition')]][$row[csf('gsm_weight')]][$row[csf('lib_yarn_count_deter_id')]][$row[csf('dia_width')]][$row[csf('remarks')]]['grey']+=$row[csf('grey_fab_qnty')];
			$fin_grey_qty_arr[$row[csf('item_number_id')]][$row[csf('body_part_id')]][$row[csf('color_type_id')]][$row[csf('construction')]][$row[csf('composition')]][$row[csf('gsm_weight')]][$row[csf('lib_yarn_count_deter_id')]][$row[csf('dia_width')]][$row[csf('remarks')]]['rate']=$row[csf('rate')];

			$fin_grey_color_qty_arr[$row[csf('item_number_id')]][$row[csf('body_part_id')]][$row[csf('color_type_id')]][$row[csf('construction')]][$row[csf('composition')]][$row[csf('gsm_weight')]][$row[csf('lib_yarn_count_deter_id')]][$row[csf('dia_width')]][$row[csf('remarks')]][$row[csf('fabric_color_id')]]['fin']+=$row[csf('fin_fab_qnty')];
			$fin_grey_color_qty_arr[$row[csf('item_number_id')]][$row[csf('body_part_id')]][$row[csf('color_type_id')]][$row[csf('construction')]][$row[csf('composition')]][$row[csf('gsm_weight')]][$row[csf('lib_yarn_count_deter_id')]][$row[csf('dia_width')]][$row[csf('remarks')]][$row[csf('fabric_color_id')]]['grey']+=$row[csf('grey_fab_qnty')];
			$fin_grey_color_qty_arr[$row[csf('item_number_id')]][$row[csf('body_part_id')]][$row[csf('color_type_id')]][$row[csf('construction')]][$row[csf('composition')]][$row[csf('gsm_weight')]][$row[csf('lib_yarn_count_deter_id')]][$row[csf('dia_width')]][$row[csf('remarks')]][$row[csf('fabric_color_id')]]['rate']=$row[csf('rate')];

		}
		unset($color_wise_wo_sql_res);

				/*a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				a.lib_yarn_count_deter_id='".$result_fabric_description[csf('determin_id')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				b.remarks='".$result_fabric_description[csf('remarks')]."' and
				nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and*/


		$grand_total_amount=0;

		$gmt_color_library=array();
		$gmt_color_data=sql_select("select b.gmts_color_id, b.contrast_color_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.fabric_source =$cbo_fabric_source and a.job_no ='$job_no'");
		foreach( $gmt_color_data as $gmt_color_row)
		{
			$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
		}
		
		$lab_dip_no_arr=array();
		$lab_dip_no_sql=sql_select("select lapdip_no, color_name_id from wo_po_lapdip_approval_info where job_no_mst='$job_no' and status_active=1 and is_deleted=0 and approval_status=3");
		foreach($lab_dip_no_sql as $row)
		{
			$lab_dip_no_arr[$row[csf('color_name_id')]]=$row[csf('lapdip_no')];
		}
		unset($lab_dip_no_sql);

		$grand_total_fin_fab_qnty=0; $grand_total_grey_fab_qnty=0; $grand_totalcons_per_finish=0; $grand_totalcons_per_grey=0;
		$color_wise_wo_sql=sql_select("select fabric_color_id FROM wo_booking_dtls WHERE booking_no =$txt_booking_no and status_active=1 and is_deleted=0 group by fabric_color_id");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
			$body_color=implode(",",array_filter(array_unique($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]])));
			
		?>
			<tr>
            <td width="120" align="left"><? echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]]; ?></td>
            <td><? if($body_color=="") echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]]; else echo $body_color; ?></td>
            <td width="120" align="left">
			<?
			$lapdip_no="";
			$lapdip_no=$lab_dip_no_arr[$color_wise_wo_result[csf('fabric_color_id')]];
			//return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and status_active=1 and is_deleted=0 and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
			if($lapdip_no=="") echo "&nbsp;"; else echo $lapdip_no;
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_grey_fab_qnty=0;
			$color_wise_amount=0;
			$color_wise_rate=0;
			$color_count=0;
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*if($db_type==0)
				{
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.uom=12 and
				a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				a.lib_yarn_count_deter_id='".$result_fabric_description[csf('determin_id')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				b.remarks='".$result_fabric_description[csf('remarks')]."' and
				d.fabric_color_id='".$color_wise_wo_result[csf('fabric_color_id')]."' and
				d.status_active=1 and
				d.is_deleted=0
				");
				}
				if($db_type==2)
				{
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.uom=12 and
				a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				a.lib_yarn_count_deter_id='".$result_fabric_description[csf('determin_id')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				b.remarks='".$result_fabric_description[csf('remarks')]."' and
				nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
				d.status_active=1 and
				d.is_deleted=0
				");
				}*/
				$color_wo_fin_qnty=0; $color_wo_grey_qnty=0;
				$color_wo_fin_qnty=$fin_grey_color_qty_arr[$result_fabric_description[csf('item_number_id')]][$result_fabric_description[csf('body_part_id')]][$result_fabric_description[csf('color_type_id')]][$result_fabric_description[csf('construction')]][$result_fabric_description[csf('composition')]][$result_fabric_description[csf('gsm_weight')]][$result_fabric_description[csf('determin_id')]][$result_fabric_description[csf('dia_width')]][$result_fabric_description[csf('remarks')]][$color_wise_wo_result[csf('fabric_color_id')]]['fin'];

				$color_wo_grey_qnty=$fin_grey_color_qty_arr[$result_fabric_description[csf('item_number_id')]][$result_fabric_description[csf('body_part_id')]][$result_fabric_description[csf('color_type_id')]][$result_fabric_description[csf('construction')]][$result_fabric_description[csf('composition')]][$result_fabric_description[csf('gsm_weight')]][$result_fabric_description[csf('determin_id')]][$result_fabric_description[csf('dia_width')]][$result_fabric_description[csf('remarks')]][$color_wise_wo_result[csf('fabric_color_id')]]['grey'];
				$color_rate=$fin_grey_color_qty_arr[$result_fabric_description[csf('item_number_id')]][$result_fabric_description[csf('body_part_id')]][$result_fabric_description[csf('color_type_id')]][$result_fabric_description[csf('construction')]][$result_fabric_description[csf('composition')]][$result_fabric_description[csf('gsm_weight')]][$result_fabric_description[csf('determin_id')]][$result_fabric_description[csf('dia_width')]][$result_fabric_description[csf('remarks')]][$color_wise_wo_result[csf('fabric_color_id')]]['rate'];
				$color_amout=$color_rate*$color_wo_grey_qnty;
				$color_wise_amount+=$color_amout;
				$color_wise_rate+=$color_rate;
				$color_count+=1;

				$dia=$result_fabric_description[csf('dia_width')];
				$gsm=$result_fabric_description[csf('gsm_weight')];
				//list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
				$fin_mtr=$color_wo_fin_qnty /($dia * 2.54 / 100) /($gsm/1000);
			?>
			<td width='50' align='center' style="font-size:18px;">
			<?
			if($color_wo_fin_qnty!="")
			{
			echo number_format($color_wo_fin_qnty,2) ;
			$total_fin_fab_qnty+=$color_wo_fin_qnty;
			}
			?>
            </td>
            <td width='50' align='center' style="font-size:18px;"><? echo number_format($fin_mtr,2) ;?></td>
            <td width='50' align='center' style="font-size:18px;"><? echo number_format($color_rate,2) ;?></td>
            <td width='50' align='center' style="font-size:18px;"><? echo number_format($color_amout,2) ;?></td>
            <td width='50' align='center' style="font-size:18px;">
			<?
			if($color_wo_grey_qnty!="")
			{
			echo number_format($color_wo_grey_qnty,2);
			$total_grey_fab_qnty+=$color_wo_grey_qnty;
			}
			?>
            </td>
            <?
			}
			if($process_loss_method==1)
			{
				$process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_fin_fab_qnty)*100;
				$markup_margin='Grant Tot Grey-Grand Tot Fin Qty/Tot Fin Qty*100';
			}

			if($process_loss_method==2)
			{
				$process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_grey_fab_qnty)*100;
				$markup_margin='Grant Tot Grey-Grand Tot Fin Qty/Tot Gray Qty*100';
			}
			?>
            <td align="center" style="font-size:18px;"><? echo number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
            <td align="center" style="font-size:18px;"><? echo number_format($total_grey_fab_qnty,2); $grand_total_grey_fab_qnty+=$total_grey_fab_qnty;?></td>

            <td align="center" style="font-size:18px;" title="<? echo $markup_margin;?>">
            <?
			
			echo number_format($process_percent,2);

			?>
            </td>
            <td align="right"><?echo number_format($color_wise_amount/$total_grey_fab_qnty,2);?></td>
             <td align="right"><?echo number_format($color_wise_amount,2);?></td>
            </tr>
         <?
		}
		?>
        <tr style=" font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Total</strong></td>
        <?
        	$grand_total_amount=0;
        	$grand_total_rate=0;
        	$grand_total_count=0;
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {

				$wo_fin_qnty=0; $wo_grey_qnty=0;
				$wo_fin_qnty=$fin_grey_qty_arr[$result_fabric_description[csf('item_number_id')]][$result_fabric_description[csf('body_part_id')]][$result_fabric_description[csf('color_type_id')]][$result_fabric_description[csf('construction')]][$result_fabric_description[csf('composition')]][$result_fabric_description[csf('gsm_weight')]][$result_fabric_description[csf('determin_id')]][$result_fabric_description[csf('dia_width')]][$result_fabric_description[csf('remarks')]]['fin'];

				$rate=$fin_grey_qty_arr[$result_fabric_description[csf('item_number_id')]][$result_fabric_description[csf('body_part_id')]][$result_fabric_description[csf('color_type_id')]][$result_fabric_description[csf('construction')]][$result_fabric_description[csf('composition')]][$result_fabric_description[csf('gsm_weight')]][$result_fabric_description[csf('determin_id')]][$result_fabric_description[csf('dia_width')]][$result_fabric_description[csf('remarks')]]['rate'];

				$wo_grey_qnty=$fin_grey_qty_arr[$result_fabric_description[csf('item_number_id')]][$result_fabric_description[csf('body_part_id')]][$result_fabric_description[csf('color_type_id')]][$result_fabric_description[csf('construction')]][$result_fabric_description[csf('composition')]][$result_fabric_description[csf('gsm_weight')]][$result_fabric_description[csf('determin_id')]][$result_fabric_description[csf('dia_width')]][$result_fabric_description[csf('remarks')]]['grey'];

				$amount=$wo_grey_qnty*$rate;
				$grand_total_amount+=$amount;
				$dia=$result_fabric_description[csf('dia_width')];
				$gsm=$result_fabric_description[csf('gsm_weight')];
				$grand_total_rate+=$rate;
        		$grand_total_count+=1;
				//list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
				$fin_mtr=$wo_fin_qnty /($dia * 2.54 / 100) /($gsm/1000);
				/*$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.uom=12 and
												a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												a.lib_yarn_count_deter_id='".$result_fabric_description[csf('determin_id')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												b.remarks='".$result_fabric_description[csf('remarks')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty*/
			?>
			<td width='50' align='center' style="font-size:18px;"><?  echo number_format($wo_fin_qnty,2) ;?></td>
			<td width='50' align='center' style="font-size:18px;" title="fin (kg) /(dia x 2.54 / 100) /(gsm/1000)"><?  echo number_format($fin_mtr,2) ;?></td>
			<td width='50' align='center' style="font-size:18px;"><?  echo number_format($rate,2) ;?></td>
			<td width='50' align='center' style="font-size:18px;"><?  echo number_format($amount,2) ;?></td>
			<td width='50' align='center' style="font-size:18px;" > <? echo number_format($wo_grey_qnty,2);?></td>
            <?
			}
			if($process_loss_method==1)
			{
				$markup_margin='Grant Tot Grey Dzn-Grand Tot Fin Qty Dzn/Tot Fin Qty Dzn*100';
			}

			if($process_loss_method==2)
			{
				
				$markup_margin='Grant Tot Grey Dzn-Grand Tot Fin Qty Dzn/Tot Grey Qty Dzn*100';
			}
			?>
            <td align="center" style="font-size:18px;"><? echo number_format($grand_total_fin_fab_qnty,2);?></td>
            <td align="center" style="font-size:18px;"><? echo number_format($grand_total_grey_fab_qnty,2);?></td>
            <td align="center" style="font-size:18px;" title="<? echo $markup_margin;?>">
            <?
            if($process_loss_method==1)// markup
			{
				$totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_fin_fab_qnty)*100;
			}

			if($process_loss_method==2) //margin
			{
				$totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_grey_fab_qnty)*100;
			}
			echo number_format($totalprocess_percent,2);
			
			?>
            </td>
            <td align="right"><?echo number_format($grand_total_amount/$grand_total_grey_fab_qnty,2);?></td>
             <td align="right"><? echo number_format($grand_total_amount,2);?> </td>
            

            </tr>
            <tr style="font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {

				/*$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.uom=12 and
												a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												a.lib_yarn_count_deter_id='".$result_fabric_description[csf('determin_id')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												b.remarks='".$result_fabric_description[csf('remarks')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty*/

			?>
			<td width='50' align='center' style="font-size:18px;"><?  //echo number_format(($color_wise_wo_result_qnty['fin_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td>
			<td width='50' align='center' style="font-size:18px;"><?  ?></td>
			<td width='50' align='center' style="font-size:18px;"><?  ?></td>
			<td width='50' align='center' style="font-size:18px;"><?  ?></td>
			<td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <?
			}
			?>
            <td align="center" style="font-size:18px;">
			<?
			//echo $grand_total_fin_fab_qnty;
			echo number_format(($grand_total_fin_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4);
			$grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4);
			?>
            </td>
            <td align="center" style="font-size:18px;"><? echo number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4);$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4)?></td>
            <td align="center" style="font-size:18px;">
            <?
            $totalprocess_percent_dzn=0;
            if($process_loss_method==1)
			{
				$totalprocess_percent_dzn=(($grand_total_grey_fab_qnty_dzn-$grand_total_fin_fab_qnty_dzn)/$grand_total_fin_fab_qnty_dzn)*100;
			}

			if($process_loss_method==2)
			{
				$totalprocess_percent_dzn=(($grand_total_grey_fab_qnty_dzn-$grand_total_fin_fab_qnty_dzn)/$grand_total_grey_fab_qnty_dzn)*100;
			}
			echo number_format($totalprocess_percent_dzn,2);
			?>
            </td>
             <td align="right">
			<?
			$consumption_per_unit_amuont=($grand_total_amount/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
			echo number_format(($consumption_per_unit_amuont/$grand_total_grey_fab_qnty_dzn),2);
			
			?>
            </td>
            <td align="right">
            <?
			echo number_format($consumption_per_unit_amuont,2);
			?>
            </td>
            </tr>
    </table>
    <?
	}
	/*$nameArray_fabric_description= sql_select("SELECT a.color_type_id,a.construction,a.composition,a.gsm_weight,a.dia_width,a.process_loss_percent FROM view_wo_fabric_booking_data_park a,wo_booking_dtls b where b.booking_no =$txt_booking_no and a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and b.status_active=1 and
	b.is_deleted=0  group by a.color_type_id,a.construction,a.composition,a.gsm_weight,a.dia_width,process_loss_percent order by a.pre_cost_fabric_cost_dtls_id");*/
	if($cbo_fabric_source==2)
	{
	$nameArray_fabric_description= sql_select("select min(a.id) as fabric_cost_dtls_id,  a.lib_yarn_count_deter_id as determin_id,a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type , b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent, avg(b.requirment) as requirment  FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
	WHERE a.job_no=b.job_no and
	a.id=b.pre_cost_fabric_cost_dtls_id and
	c.job_no_mst=a.job_no and
	c.id=b.color_size_table_id and
	b.po_break_down_id=d.po_break_down_id and
	b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
	d.booking_no =$txt_booking_no and
	d.status_active=1 and
	d.is_deleted=0
	group by a.body_part_id,a.lib_yarn_count_deter_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by fabric_cost_dtls_id,a.body_part_id,b.dia_width");
	 ?>

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
     <tr align="center">
     <th colspan="3" align="left">Body Part</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
			else         		               echo "<td  colspan='3'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
		}
		?>
        <td  rowspan="10" width="50"><p>Total Fabric (<? echo $unit_of_measurement[$uom_id];//if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?>)</p></td>
        <td  rowspan="10" width="50"><p>Avg Rate (<? echo $unit_of_measurement[$uom_id];//if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?>)</p></td>
        <td  rowspan="10" width="50"><p>Amount </p></td>
       </tr>
     <tr align="center"><th colspan="3" align="left">Color Type</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
			else         		               echo "<td  colspan='3'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
		}
		?>
        <!--<td  rowspan="8" width="50"><p>Total  Finish Fabric (KG)</p></td> <td  rowspan="8" width="50"><p>Total Grey Fabric (KG)</p></td>-->
             <!--<td  rowspan="7" width="50"><p>Process Loss % </p></td>-->
       </tr>
        <tr align="center"><th colspan="3" align="left">Fabric Construction</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='3'>&nbsp</td>";
			else         		               echo "<td  colspan='3'>". $result_fabric_description[csf('construction')]."</td>";
		}
		?>


       </tr>
        <tr align="center"><th   colspan="3" align="left">Fabric Composition</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='3' >&nbsp</td>";
			else         		               echo "<td colspan='3' >".$result_fabric_description[csf('composition')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th  colspan="3" align="left">GSM</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		       echo "<td colspan='3' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th  colspan="3" align="left">Stitch Length</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			$determin_id=$result_fabric_description[csf('determin_id')];
			$s_length=return_field_value( "stitch_length", "fabric_mapping","mst_id=$determin_id");;
			if( $result_fabric_description[csf('determin_id')] == "")   echo "<td colspan='2'>&nbsp</td>";
			else         		       echo "<td colspan='2' align='center'>". $s_length."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		              echo "<td colspan='3' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Consumption For <? echo $costing_per; ?></th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('requirment')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		              echo "<td colspan='3' align='center'>Fin: ".number_format($result_fabric_description[csf('cons')],2).", Grey: ".number_format($result_fabric_description[csf('requirment')],2)."</td>";
		}
		?>

       </tr>
       <tr>
       <th  colspan="<? echo  count($nameArray_fabric_description)*3+3; ?>" align="left" style="height:30px">&nbsp;</th>
       </tr>

       <tr>
            <!--<th  width="120" align="left">Gmts. Color</th>-->
            <th  width="120" align="left">Fabric Color</th>
            <th  width="120" align="left">Body Color</th>
            <th  width="120" align="left">Lab Dip No</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			  echo "<th width='50'>Fab. Qty</th><th width='50' >Rate</th><th width='50' >Amount</th>";
		}
		?>

       </tr>
       <?

		  /*$gmt_color_library=return_library_array( "select gmts_color_id,contrast_color_id
		  FROM
		  wo_pre_cos_fab_co_color_dtls
		  WHERE
		  job_no ='$job_no'", "contrast_color_id", "gmts_color_id");*/
		  $gmt_color_library=array();
		  $gmt_color_data=sql_select("select b.gmts_color_id, b.contrast_color_id
		  FROM
		  wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b
		  WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.fabric_source =$cbo_fabric_source and
		  a.job_no ='$job_no'");
		  foreach( $gmt_color_data as $gmt_color_row)
		  {
			//$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
			$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
		  }

	        $grand_total_fin_fab_qnty=0;
			$grand_total_amount=0;
			//$grand_totalcons_per_finish=0;
			//$grand_totalcons_per_grey=0;
			$color_wise_wo_sql=sql_select("select fabric_color_id
										  FROM
										  wo_booking_dtls
										  WHERE
										  booking_no =$txt_booking_no and
										  status_active=1 and
                                          is_deleted=0
										  group by fabric_color_id");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
		?>
			<tr>
           <!-- <td  width="120" align="left">
			<?

			//echo $color_library[$color_wise_wo_result['fabric_color_id']];

			?></td>-->
            <td  width="120" align="left">
			<?
			echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];


			?>
            </td>
            <td>
            <?
			//echo $color_library[$gmt_color_library[$color_wise_wo_result['fabric_color_id']]];
			//echo rtrim($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]],",");
			echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
			?>
            </td>
            <td  width="120" align="left">
			<?
			$lapdip_no="";
			$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
			//echo "lapdip_no from wo_po_lapdip_approval_info where job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result['fabric_color_id']."";
			if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_amount=0;

			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
				  FROM
				  view_wo_fabric_booking_data_park a,
				  wo_booking_dtls b
				  WHERE
				  b.booking_no =$txt_booking_no  and
				  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
				  a.po_break_down_id=b.po_break_down_id and
				  a.color_size_table_id=b.color_size_table_id and
				  a.color_type_id='".$result_fabric_description['color_type_id']."' and
				  a.construction='".$result_fabric_description['construction']."' and
				  a.composition='".$result_fabric_description['composition']."' and
				  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
				  a.dia_width='".$result_fabric_description['dia_width']."' and
				  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
				  b.fabric_color_id=".$color_wise_wo_result['fabric_color_id']." and
				  b.status_active=1 and
				  b.is_deleted=0");*/
				if($db_type==0)
				{
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty, avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
				d.status_active=1 and
				d.is_deleted=0
				");
				}
				if($db_type==2)
				{

				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
				d.status_active=1 and
				d.is_deleted=0
				");
				}
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'>
			<?
			if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2) ;
			$total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('rate')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('rate')],2);
			//$total_grey_fab_qnty+=$color_wise_wo_result_qnty['grey_fab_qnty'];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			$amount=$color_wise_wo_result_qnty[csf('grey_fab_qnty')]*$color_wise_wo_result_qnty[csf('rate')];
			if($amount!="")
			{
			echo number_format($amount,2);
			$total_amount+=$amount;
			}
			?>
            </td>
            <?
			}
			?>
            <td align="right"><? echo number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
            <td align="right"><? echo number_format($total_amount/$total_fin_fab_qnty,2); $grand_total_amount+=$total_amount;?></td>
            <td align="right">
            <?
			echo number_format($total_amount,2);

			?>
            </td>
            </tr>
         <?
		}
		?>
        <tr style=" font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Total</strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,

												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2) ;?></td>
            <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
            <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
            <?
			}
			?>
            <td align="right"><? echo number_format($grand_total_fin_fab_qnty,2);?></td>
            <td align="right"><? echo number_format($grand_total_amount/$grand_total_fin_fab_qnty,2);?></td>
            <td align="right">
            <?
			echo number_format($grand_total_amount,2);
			?>
            </td>
            </tr>
            <tr style="font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

			?>
			<td width='50' align='right'><?  //echo number_format(($color_wise_wo_result_qnty['fin_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td>
            <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <?
			}
			?>
            <td align="right">
			<?
			$consumption_per_unit_fab=($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
			echo number_format($consumption_per_unit_fab,4);
			//$grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4)
			?>
            </td>
            <td align="right">
			<?
			$consumption_per_unit_amuont=($grand_total_amount/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
			echo number_format(($consumption_per_unit_amuont/$consumption_per_unit_fab),2);
			//$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4)
			?>
            </td>
            <td align="right">
            <?
			echo number_format($consumption_per_unit_amuont,2);
			?>
            </td>
            </tr>
    </table>
      <br>
        <?
     $desg_name=return_library_array( "select id, custom_designation from lib_designation", "id", "custom_designation"  );
	 $data_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name,c.designation from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no=$txt_booking_no and b.entry_form=7 order by b.id asc");
	?>
       <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>
            <tr style="border:1px solid black;">
                <th colspan="3" style="border:1px solid black;">Approval Status</th>
                </tr>
                <tr style="border:1px solid black;">
                <th width="3%" style="border:1px solid black;">Sl</th><th width="50%" style="border:1px solid black;">Name/Designation</th><th width="27%" style="border:1px solid black;">Approval Date</th><th width="20%" style="border:1px solid black;">Approval No</th>
                </tr>
            </thead>
            <tbody>
            <?
			$s=1;
			foreach($data_array as $row){
			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $s;?></td><td width="50%" style="border:1px solid black;"><? echo $row[csf('user_full_name')].'/'.$desg_name[$row[csf('designation')]];?></td><td width="27%" style="border:1px solid black;"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); //echo change_date_format($row[csf('approved_date')],"dd-mm-yyyy","-");?></td><td width="20%" style="border:1px solid black;"><? echo $row[csf('approved_no')];?></td>
                </tr>
                <?
				$s++;
			}
				?>
            </tbody>
        </table>
    <?
	}
	?>
        <br/>
        <?
		if($cbo_fabric_source==1){
		$lab_dip_color_arr=array();

			$lab_dip_color_sql=sql_select("select pre_cost_fabric_cost_dtls_id, gmts_color_id, contrast_color_id from wo_pre_cos_fab_co_color_dtls where job_no='$job_no'");
			foreach($lab_dip_color_sql as $row)
			{
				$lab_dip_color_arr[$row[csf('pre_cost_fabric_cost_dtls_id')]][$row[csf('gmts_color_id')]]=$row[csf('contrast_color_id')];
			}
			$order_plan_qty_arr=array();
			$color_wise_wo_sql_qnty=sql_select( "select color_number_id, size_number_id, sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in ($booking_po_id) and status_active=1 and is_deleted =0 group by color_number_id, size_number_id");
			foreach($color_wise_wo_sql_qnty as $row)
			{
				$order_plan_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]]['plan']=$row[csf('plan_cut_qnty')];
				$order_plan_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]]['order']=$row[csf('order_quantity')];
			}

			$collar_cuff_percent_arr=array();
			$collar_cuff_body_arr=array();
			$collar_cuff_color_arr=array();
			$collar_cuff_size_arr=array();
			$collar_cuff_item_size_arr=array();
			$color_size_sensitive_arr=array();

			$collar_cuff_sql="select a.id, a.color_size_sensitive, a.color_break_down, b.color_number_id, b.gmts_sizes, b.item_size, c.size_number_id, d.colar_cuff_per, e.body_part_full_name, e.body_part_type
			FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c, wo_booking_dtls d, lib_body_part e

			WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=e.id and e.body_part_type in (40,50) and c.id=d.color_size_table_id and d.color_size_table_id=b.color_size_table_id  and d.po_break_down_id=c.po_break_down_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 order by  c.size_order";
			//echo $collar_cuff_sql;
			$collar_cuff_sql_res=sql_select($collar_cuff_sql);

			foreach($collar_cuff_sql_res as $collar_cuff_row)
			{
				$collar_cuff_percent_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('color_number_id')]][$collar_cuff_row[csf('gmts_sizes')]]=$collar_cuff_row[csf('colar_cuff_per')];
				$collar_cuff_body_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]]=$collar_cuff_row[csf('body_part_full_name')];
				$collar_cuff_size_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('size_number_id')]]=$collar_cuff_row[csf('size_number_id')];
				$collar_cuff_item_size_arr[$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('size_number_id')]][$collar_cuff_row[csf('item_size')]]=$collar_cuff_row[csf('item_size')];
				$color_size_sensitive_arr[$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('id')]][$collar_cuff_row[csf('color_number_id')]][$collar_cuff_row[csf('color_size_sensitive')]]=$collar_cuff_row[csf('color_break_down')];

			}
			//print_r($collar_cuff_percent_arr[40]) ;
			unset($collar_cuff_sql_res);
			//$count_collar_cuff=count($collar_cuff_size_arr);
			foreach($collar_cuff_body_arr as $body_type=>$body_name)
			{
				foreach($body_name as $body_val)
				{
					$count_collar_cuff=count($collar_cuff_size_arr[$body_type][$body_val]);
					$pre_grand_tot_collar=0; $pre_grand_tot_collar_order_qty=0;

					?>
                    <div style="max-height:1330px; overflow:auto; float:left; padding-top:5px; margin-left:5px; margin-bottom:5px; position:relative;">
					<table width="625" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                        <tr>
                        	<td colspan="<? echo $count_collar_cuff+3; ?>" align="center"><b><? echo $body_val; ?> - Color Size Brakedown in Pcs.</b></td>
                        </tr>
                        <tr>
                            <td width="100">Size</td>
								<?
                                foreach($collar_cuff_size_arr[$body_type][$body_val]  as $size_number_id)
                                {
									?>
									<td align="center" style="border:1px solid black"><strong><? echo $size_library[$size_number_id];?></strong></td>
									<?
                                }
                                ?>
                            <td width="60" rowspan="2" align="center"><strong>Total</strong></td>
                            <td rowspan="2" align="center"><strong>Extra %</strong></td>
                        </tr>
                        <tr>
                            <td style="font-size:12px"><? echo $body_val; ?> Size</td>
                            <?
                            foreach($collar_cuff_item_size_arr[$body_val]  as $size_number_id=>$size_number)
                            {
								if(count($size_number)>0)
								{
									 foreach($size_number  as $item_size=>$val)
									 {
										?>
										<td align="center" style="border:1px solid black"><strong><? echo $item_size;?></strong></td>
										<?
									 }
								}
								else
								{
									?>
									<td align="center" style="border:1px solid black"><strong>&nbsp;</strong></td>
									<?
								}
                            }

                            $pre_size_total_arr=array();
                            foreach($color_size_sensitive_arr[$body_val] as $pre_cost_id=>$pre_cost_data)
                            {
								foreach($pre_cost_data as $color_number_id=>$color_number_data)
								{
									foreach($color_number_data as $color_size_sensitive=>$color_break_down)
									{
										$pre_color_total_collar=0;
										$pre_color_total_collar_order_qnty=0;
										$process_loss_method=$process_loss_method;
										$constrast_color_arr=array();
										if($color_size_sensitive==3)
										{
											$constrast_color=explode('__',$color_break_down);
											for($i=0;$i<count($constrast_color);$i++)
											{
												$constrast_color2=explode('_',$constrast_color[$i]);
												$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
											}
										}
										?>
										<tr>
											<td>
												<?
                                                if( $color_size_sensitive==3)
                                                {
                                                    echo strtoupper ($constrast_color_arr[$color_number_id]) ;
                                                    $lab_dip_color_id=$lab_dip_color_arr[$pre_cost_id][$color_number_id];
                                                }
                                                else
                                                {
                                                    echo $color_library[$color_number_id];
                                                    $lab_dip_color_id=$color_number_id;
                                                }
                                                ?>
											</td>
											<?
											foreach($collar_cuff_size_arr[$body_type][$body_val] as $size_number_id)
											{
												?>
												<td align="center" style="border:1px solid black">
													<? $plan_cut=0; $collerqty=0; $collar_ex_per=0;
													if($body_type==50) $plan_cut=($order_plan_qty_arr[$color_number_id][$size_number_id]['plan'])*2;
													else $plan_cut=$order_plan_qty_arr[$color_number_id][$size_number_id]['plan'];
                                                    $ord_qty=$order_plan_qty_arr[$color_number_id][$size_number_id]['order'];

                                                    $collar_ex_per=$collar_cuff_percent_arr[$body_type][$body_val][$color_number_id][$size_number_id];
                                                    // echo $collar_ex_per.'=';

												    if($body_type==50) { if($collar_ex_per==0 || $collar_ex_per=="") $collar_ex_per=$cuff_excess_percent; else $collar_ex_per=$collar_ex_per; }
                                                    else if($body_type==40) { if($collar_ex_per==0 || $collar_ex_per=="") $collar_ex_per=$colar_excess_percent; else $collar_ex_per=$collar_ex_per; }
                                                    $colar_excess_per=($plan_cut*$collar_ex_per)/100;
                                                    $collerqty=($plan_cut+$colar_excess_per);

                                                    //$collerqty=number_format(($requirment/$costing_per_qnty)*$plan_cut,2,'.','');

                                                    echo number_format($collerqty);
                                                    $pre_size_total_arr[$size_number_id]+=$collerqty;
                                                    $pre_color_total_collar+=$collerqty;
                                                    $pre_color_total_collar_order_qnty+=$plan_cut;

                                                    //$pre_grand_tot_collar_order_qty+=$plan_cut;
                                                    ?>
												</td>
												<?
											}
											$msg_ttl="Total Colar Size($pre_color_total_collar)-(Tot Size Plan Cut($pre_color_total_collar_order_qnty)/Tot Size Plan Cut($pre_color_total_collar_order_qnty))*100";
											?>

											<td align="center"><? echo number_format($pre_color_total_collar); ?></td>
											<td align="center" title="<? echo $msg_ttl;?>"><? echo number_format((($pre_color_total_collar-$pre_color_total_collar_order_qnty)/$pre_color_total_collar_order_qnty)*100,2); ?></td>
										</tr>
										<?
										$pre_grand_collar_ex_per+=$collar_ex_per;
										$pre_grand_tot_collar+=$pre_color_total_collar;
										$pre_grand_tot_collar_order_qty+=$pre_color_total_collar_order_qnty;
									}
								}
							}
							?>
                        </tr>
                        <tr>
                            <td>Size Total</td>
								<?
                                foreach($pre_size_total_arr  as $size_qty)
                                {
									?>
									<td style="border:1px solid black;  text-align:center"><? echo number_format($size_qty); ?></td>
									<?
                                }
                                ?>
                            <td style="border:1px solid black; text-align:center"><? echo number_format($pre_grand_tot_collar); ?></td>
                            <td align="center" style="border:1px solid black"><? echo number_format((($pre_grand_tot_collar-$pre_grand_tot_collar_order_qty)/$pre_grand_tot_collar_order_qty)*100,2); ?></td>
                        </tr>
					</table>
                </div>
                <br/>
                <?
            }
        }
		?>
        <br/>
        <?
		$yarn_count_arr=return_library_array( "select id,yarn_count from lib_yarn_count",'id','yarn_count');
		//$yarn_sql_array=sql_select("SELECT min(id) as id ,count_id, copm_one_id, percent_one,copm_two_id, percent_two,color, type_id, sum(cons_qnty) as yarn_required, AVG(rate) as rate from wo_pre_cost_fab_yarn_cost_dtls where job_no='$job_no' and  status_active=1 and is_deleted=0 group by count_id,copm_one_id,percent_one, copm_two_id,percent_two,color,type_id order by id");

		if($db_type==2 || $db_type==1)
		{
			$yarn_sql_array=sql_select("SELECT min(id) as id ,count_id, copm_one_id, percent_one,copm_two_id, percent_two, type_id, sum(cons_qnty) as yarn_required, AVG(rate) as rate,listagg(cast(fabric_cost_dtls_id as varchar2(4000)),',') within group (order by fabric_cost_dtls_id) as cost_dtls,listagg(cast(cons_ratio as varchar2(4000)),',') within group (order by cons_ratio) as cons_ratio from wo_pre_cost_fab_yarn_cost_dtls where job_no='$job_no' and  status_active=1 and is_deleted=0 group by count_id,copm_one_id,percent_one, copm_two_id,percent_two,type_id order by id");
		}
		else
		{
		  $yarn_sql_array=sql_select("SELECT min(id) as id ,count_id, copm_one_id, percent_one,copm_two_id, percent_two, type_id, sum(cons_qnty) as yarn_required, AVG(rate) as rate,group_concat(fabric_cost_dtls_id) as cost_dtls,group_concat(cons_ratio) as cons_ratio from wo_pre_cost_fab_yarn_cost_dtls where job_no='$job_no' and  status_active=1 and is_deleted=0 group by count_id,copm_one_id,percent_one, copm_two_id,percent_two,type_id order by id");
		}


		?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
            <tr>
                <td width="49%" valign="top">
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td colspan="7"><b>Yarn Required Summary (Pre Cost)</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Yarn Description</td>
                    <td>Brand</td>
                    <td>Lot</td>
                    <?
					if($show_yarn_rate==1)
					{
					?>
                    <td>Rate</td>
                    <?
					}
					?>
                    <td>Cons for <? echo $costing_per; ?> Gmts</td>
                    <td>Total (KG)</td>
                    </tr>
                    <?
					$i=0;
					$total_yarn=0;
					foreach($yarn_sql_array  as $row)
                    {

						$i++;
						$fabric_cost_id=$row[csf('cost_dtls')];
						$tot_booking_grey=sql_select("select sum(grey_fab_qnty) as grey_qty  from wo_booking_dtls where status_active=1 and is_deleted=0 and job_no='$job_no' and booking_no=$txt_booking_no and pre_cost_fabric_cost_dtls_id in($fabric_cost_id)");
					?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
					<?
					$yarn_des=$yarn_count_arr[$row[csf('count_id')]]." ".$composition[$row[csf('copm_one_id')]]." ".$row[csf('percent_one')]."%  ";
					if($row['copm_two_id'] !=0)
					{
						$yarn_des.=$composition[$row[csf('copm_two_id')]]." ".$row[csf('percent_two')]."%";
					}
					$yarn_des.=$color_library[$row[csf('color')]]." ";
					$yarn_des.=$yarn_type[$row[csf('type_id')]];
					//echo $yarn_count_arr[$row['count_id']]." ".$composition[$row['copm_one_id']]." ".$row['percent_one']."%  ".$composition[$row['copm_two_id']]." ".$row['percent_two']."%  ".$yarn_type[$row['type_id']];
					echo $yarn_des;
					?>
                    </td>
                    <td></td>
                    <td></td>
                    <?
					if($show_yarn_rate==1)
					{
					?>
                     <td><? echo number_format($row[csf('rate')],4); ?></td>
                     <?
					}
					 ?>
                    <td><? echo number_format($row[csf('yarn_required')],4); ?></td>

                    <!--<td><? //echo number_format(($row['yarn_required']/$po_qnty_tot)*$costing_per_qnty,2); ?></td>-->
                    <td align="right"><? $total_kg=$tot_booking_grey[0][csf("grey_qty")] * ($row[csf("cons_ratio")]/100); echo number_format($total_kg,2); ?> </td>
                    </tr>
                    <?
                    $total_yarn += $total_kg;
					}
					?>
                    <tr align="center">
                    <td>Total</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <?
					if($show_yarn_rate==1)
					{
					?>
                    <td></td>
                    <?
                    }
					?>
                    <td></td>
                    <td align="right"><? //echo number_format($total_yarn,2); ?></td>
                    </tr>
                    </table>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top" align="center">
                <?
				$yarn_sql_array=sql_select("SELECT min(a.id) as id, a.item_id, sum(a.qnty) as qnty ,min(b.supplier_id) as supplier_id,min(b.lot) as lot from inv_material_allocation_dtls a,product_details_master b where a.item_id=b.id and a.booking_no=$txt_booking_no and  a.status_active=1 and a.is_deleted=0 group by a.item_id order by a.id");
				if(count($yarn_sql_array)>0)
				{
				?>
                   <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td colspan="7"><b>Allocated Yarn</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Yarn Description</td>
                    <td>Brand</td>
                    <td>Lot</td>


                    <td>Allocated Qty (Kg)</td>
                    </tr>
                    <?
					$total_allo=0;
					$item=return_library_array( "select id, product_name_details from   product_details_master",'id','product_name_details');
					$supplier=return_library_array( "select id, short_name from   lib_supplier",'id','short_name');
					//$yarn_sql_array=sql_select("SELECT a.item_id, a.qnty,b.supplier_id,b.lot from inv_material_allocation_dtls a,product_details_master b where a.item_id=b.id and a.booking_no=$txt_booking_no and  a.status_active=1 and a.is_deleted=0");
					$i=0;
					$total_yarn=0;
					foreach($yarn_sql_array  as $row)
                    {

						$i++;
					?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
					<?

					echo $item[$row[csf('item_id')]];
					?>
                    </td>
                    <td>
                    <?

					echo $supplier[$row[csf('supplier_id')]];
					?>
                    </td>
                    <td>
					<?

					echo $row[csf('lot')];
					?>
                    </td>
                    <td align="right"><? echo number_format($row[csf('qnty')],4); $total_allo+= $row[csf('qnty')];?></td>
                    </tr>
                    <?
					}
					?>
                    <tr align="center">
                    <td>Total</td>
                    <td></td>


                    <td></td>
                    <td></td>
                    <td align="right"><? echo number_format($total_allo,4); ?></td>
                    </tr>
                    </table>
                    <?
				}
				else
				{
					$is_yarn_allocated=return_field_value("allocation", "variable_settings_inventory", "company_name=$cbo_company_name and variable_list=18 and item_category_id=1");
					if($is_yarn_allocated==1)
					{
					?>
					<font style=" font-size:30px"><b> Draft</b></font>
                    <?
					}
					else
					{
						echo "";
					}
				}
					?>
                </td>
            </tr>
        </table>
        <br/>
        
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
            <tr>
                <td width="49%" valign="top">
                <?
				if($action=="show_fabric_booking_report")
				{
					$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and is_deleted=0");
					if(count($sql_embelishment)>0)
					{
					?>
						<table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                            <tr align="center">
                            	<td colspan="7"><b>Embelishment (Pre Cost)</b></td>
                            </tr>
                            <tr align="center">
                                <td>Sl</td>
                                <td>Embelishment Name</td>
                                <td>Embelishment Type</td>
                                <td>Cons <? echo $costing_per; ?> Gmts</td>
                                <td>Rate</td>
                                <td>Amount</td>
                            </tr>
                            <?
                            $i=0;
                            //$total_yarn=0;
                            foreach($sql_embelishment  as $row_embelishment)
                            {
                                $i++;
                                ?>
                                <tr align="center">
                                    <td><? echo $i; ?></td>
                                    <td><? echo $emblishment_name_array[$row_embelishment[csf('emb_name')]]; ?></td>
                                    <td>
                                    <?
                                    if($row_embelishment[csf('emb_name')]==1) echo $emblishment_print_type[$row_embelishment[csf('emb_type')]];
                                    if($row_embelishment[csf('emb_name')]==2) echo $emblishment_embroy_type[$row_embelishment[csf('emb_type')]];
                                    if($row_embelishment[csf('emb_name')]==3) echo $emblishment_wash_type[$row_embelishment[csf('emb_type')]];
                                    if($row_embelishment[csf('emb_name')]==4) echo $emblishment_spwork_type[$row_embelishment[csf('emb_type')]];
                                    if($row_embelishment[csf('emb_name')]==5) echo $row_embelishment[csf('emb_type')];
                                    ?>
                                    </td>
                                    <td><? echo $row_embelishment[csf('cons_dzn_gmts')]; ?></td>
                                    <td><? echo $row_embelishment[csf('rate')]; ?></td>
                                    <td><? echo $row_embelishment[csf('amount')]; ?></td>
                                </tr>
                                <?
                            }
                            ?>
						</table>
						<?
					}
				}
				?>
                </td>
                <td width="2%">&nbsp;</td>
                <td width="49%" valign="top" align="center">
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                        <tr align="center">
                        	<td><b>Approved Instructions</b></td>
                        </tr>
                        <tr>
                        	<td><?  echo $nameArray_approved_comments_row[csf('comments')]; ?></td>
                    	</tr>
                    </table>
                </td>
            </tr>
        </table>
        <br/>

     


        <table  width="100%"  border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td width="49%" style="border:solid; border-color:#000; border-width:thin" valign="top">
                    <table  width="100%"  border="0" cellpadding="0" cellspacing="0">
                	<thead>
                    	<tr>
                        	<th width="3%"></th><th width="97%" align="left"><u>Special Instruction</u></th>
                        </tr>
                    </thead>
                    <tbody>
                    <?
					$data_array=sql_select("select id, terms from  wo_booking_terms_condition where booking_no=$txt_booking_no");// quotation_id='$data'
					if ( count($data_array)>0)
					{
						$i=0;
						foreach( $data_array as $row )
						{
							$i++;
							?>
                            	<tr id="settr_1" valign="top">
                                    <td style="vertical-align:top">
                                    <? echo $i;?>
                                    </td>
                                    <td>
                                   <strong style="font-size:20px"> <? echo $row[csf('terms')]; ?></strong>
                                    </td>
                                </tr>
                            <?
						}
					}
					/*else
					{
				    $i=0;
					$data_array=sql_select("select id, terms from  lib_terms_condition");// quotation_id='$data'
					foreach( $data_array as $row )
						{
							$i++;
					?>
                    <tr id="settr_1" align="">
                                    <td valign="top">
                                    <? echo $i;?>
                                    </td>
                                    <td>
                                    <? echo $row['terms']; ?>
                                    </td>

                                </tr>
                    <?
						}
					} */
					?>
                </tbody>
                </table>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top">
                   <table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                   <tr align="center">
                    <td colspan="10"><b>Comments</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Po NO</td>
                    <td>Ship Date</td>
                    <td>Pre-Cost Qty</td>
                    <td>Mn.Book Qty</td>
                    <td>Sht.Book Qty</td>
                    <td>Smp.Book Qty</td>
                    <td>Tot.Book Qty</td>
                    <td>Balance</td>
                    <td>Comments</td>
                    </tr>
                    <?
	$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
	$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
	if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
	if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
	$paln_cut_qnty_array=return_library_array( "select min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id,size_number_id,item_number_id,po_break_down_id", "id", "plan_cut_qnty");

	$item_ratio_array=return_library_array( "select gmts_item_id,set_item_ratio from wo_po_details_mas_set_details  where job_no =$txt_job_no", "gmts_item_id", "set_item_ratio");

	//------------------------------ Query for TNA start-----------------------------------
				$po_id_all=str_replace("'","",$txt_order_no_id);
				$po_num_arr=return_library_array("select id,po_number from wo_po_break_down where id in($po_id_all)",'id','po_number');
				$tna_start_sql=sql_select( "select id,po_number_id,
								(case when task_number=31 then task_start_date else null end) as fab_booking_start_date,
								(case when task_number=31 then task_finish_date else null end) as fab_booking_end_date,
								(case when task_number=60 then task_start_date else null end) as knitting_start_date,
								(case when task_number=60 then task_finish_date else null end) as knitting_end_date,
								(case when task_number=61 then task_start_date else null end) as dying_start_date,
								(case when task_number=61 then task_finish_date else null end) as dying_end_date,
								(case when task_number=73 then task_start_date else null end) as finishing_start_date,
								(case when task_number=73 then task_finish_date else null end) as finishing_end_date,
								(case when task_number=84 then task_start_date else null end) as cutting_start_date,
								(case when task_number=84 then task_finish_date else null end) as cutting_end_date,
								(case when task_number=86 then task_start_date else null end) as sewing_start_date,
								(case when task_number=86 then task_finish_date else null end) as sewing_end_date,
								(case when task_number=110 then task_start_date else null end) as exfact_start_date,
								(case when task_number=110 then task_finish_date else null end) as exfact_end_date,
								(case when task_number=47 then task_start_date else null end) as yarn_rec_start_date,
								(case when task_number=47 then task_finish_date else null end) as yarn_rec_end_date
								from tna_process_mst
								where status_active=1 and po_number_id in($po_id_all)");
				$tna_fab_start=$tna_knit_start=$tna_dyeing_start=$tna_fin_start=$tna_cut_start=$tna_sewin_start=$tna_exfact_start="";
				$tna_date_task_arr=array();
				foreach($tna_start_sql as $row)
				{
					if($row[csf("fab_booking_start_date")]!="" && $row[csf("fab_booking_start_date")]!="0000-00-00")
					{
						if($tna_fab_start=="")
						{
							$tna_fab_start=$row[csf("fab_booking_start_date")];
						}
					}


					if($row[csf("knitting_start_date")]!="" && $row[csf("knitting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_start_date']=$row[csf("knitting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_end_date']=$row[csf("knitting_end_date")];
					}
					if($row[csf("dying_start_date")]!="" && $row[csf("dying_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['dying_start_date']=$row[csf("dying_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['dying_end_date']=$row[csf("dying_end_date")];
					}
					if($row[csf("finishing_start_date")]!="" && $row[csf("finishing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_start_date']=$row[csf("finishing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_end_date']=$row[csf("finishing_end_date")];
					}
					if($row[csf("cutting_start_date")]!="" && $row[csf("cutting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_start_date']=$row[csf("cutting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_end_date']=$row[csf("cutting_end_date")];
					}
					if($row[csf("sewing_start_date")]!="" && $row[csf("sewing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_start_date']=$row[csf("sewing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_end_date']=$row[csf("sewing_end_date")];
					}
					if($row[csf("exfact_start_date")]!="" && $row[csf("exfact_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_start_date']=$row[csf("exfact_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_end_date']=$row[csf("exfact_end_date")];
					}
					if($row[csf("yarn_rec_start_date")]!="" && $row[csf("yarn_rec_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_start_date']=$row[csf("yarn_rec_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_end_date']=$row[csf("yarn_rec_end_date")];
					}
				}

	//------------------------------ Query for TNA end-----------------------------------

	$nameArray=sql_select("
	select
	a.id,
	a.item_number_id,
	a.costing_per,
	b.po_break_down_id,
	b.color_size_table_id,
	b.requirment,
	c.po_number
	FROM
		wo_pre_cost_fabric_cost_dtls a,
		wo_pre_cos_fab_co_avg_con_dtls b,
		wo_po_break_down c
	WHERE
		a.job_no=b.job_no and
		a.job_no=c.job_no_mst and
   		a.id=b.pre_cost_fabric_cost_dtls_id and
		b.po_break_down_id=c.id and
		b.po_break_down_id in (".str_replace("'","",$txt_order_no_id).")  $cbo_fabric_natu $cbo_fabric_source_cond and a.status_active=1 and a.is_deleted=0
		order by id");

	$count=0;
	$tot_grey_req_as_pre_cost_arr=array();
	foreach ($nameArray as $result)
	{
		if (count($nameArray)>0 )
		{
            if($result[csf("costing_per")]==1)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(12*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			if($result[csf("costing_per")]==2)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(1*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			if($result[csf("costing_per")]==3)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(24*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			if($result[csf("costing_per")]==4)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(36*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			if($result[csf("costing_per")]==5)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(48*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			$tot_grey_req_as_pre_cost_arr[$result[csf("po_number")]]+=$tot_grey_req_as_pre_cost;
        }
    }
	                $total_pre_cost=0;
					$total_booking_qnty_main=0;
					$total_booking_qnty_short=0;
					$total_booking_qnty_sample=0;
					$total_tot_bok_qty=0;
					$tot_balance=0;

					/*$booking_qnty=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and booking_type in(1,4)  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by a.po_break_down_id", "po_break_down_id", "grey_fab_qnty");*/
					//$booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and a.is_short=2 and c.item_category=2 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

					$booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and a.is_short=2 and c.item_category=2 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

					$booking_qnty_short=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and c.item_category=2 and a.is_short=1 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
					$booking_qnty_sample=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c  where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =4 and c.fabric_source=$cbo_fabric_source and c.item_category=2  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
					$sql_data=sql_select( "select max(a.id) as id,  a.po_number,max(a.pub_shipment_date) as pub_shipment_date,sum(a.plan_cut) as plan_cut  from wo_po_break_down a,wo_pre_cost_sum_dtls b,wo_pre_cost_mst c where a.job_no_mst=b.job_no and a.job_no_mst=c.job_no and a.id in(".str_replace("'","",$txt_order_no_id).") group by a.po_number order by id");
					foreach($sql_data  as $row)
                    {
					$col++;
					?>
                    <tr align="center">
                    <td><? echo $col; ?></td>
                    <td><? echo $row[csf("po_number")]; ?></td>
                     <td><? echo change_date_format($row[csf("pub_shipment_date")],"dd-mm-yyyy",'-'); ?></td>
                    <td align="right"><? echo number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]],2); $total_pre_cost+=$tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]; ?></td>
                    <td align="right"><? echo number_format($booking_qnty_main[$row[csf("id")]],2); $total_booking_qnty_main+=$booking_qnty_main[$row[csf("id")]];?></td>
                    <td align="right"><? echo number_format($booking_qnty_short[$row[csf("id")]],2); $total_booking_qnty_short+=$booking_qnty_short[$row[csf("id")]];?></td>
                    <td align="right"><? echo number_format($booking_qnty_sample[$row[csf("id")]],2); $total_booking_qnty_sample+=$booking_qnty_sample[$row[csf("id")]];?></td>
                    <td align="right"><? $tot_bok_qty=$booking_qnty_main[$row[csf("id")]]+$booking_qnty_short[$row[csf("id")]]+$booking_qnty_sample[$row[csf("id")]]; echo number_format($tot_bok_qty,2); $total_tot_bok_qty+=$tot_bok_qty;?></td>
                    <td align="right">
					<? $balance= def_number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]-$tot_bok_qty,2,""); echo number_format($balance,2); $tot_balance+= $balance?>
                    </td>
                    <td>
					<?
					if( $balance>0)
					{
						echo "Less Booking";
					}
					else if ($balance<0)
					{
						echo "Over Booking";
					}
					else
					{
						echo "";
					}
					?>
                    </td>
                    </tr>
                    <?
					}
					?>
                    <tfoot>
                    <tr>
                    <td colspan="3">Total:</td>
                    <td align="right"><? echo number_format($total_pre_cost,2); ?></td>
                    <td align="right"><? echo number_format($total_booking_qnty_main,2); ?></td>
                    <td align="right"><? echo number_format($total_booking_qnty_short,2); ?></td>
                    <td align="right"><? echo number_format($total_booking_qnty_sample,2); ?></td>
                     <td align="right"><? echo number_format($total_tot_bok_qty,2); ?></td>
                    <td align="right"><? echo number_format($tot_balance,2); ?></td>
                    <td></td>
                    </tr>
                    </tfoot>
                    </table>
                    <br>
                    <table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">

                    	<thead>
                    		<tr>
                    			<th colspan="6">Booking Info Sample & Short</th>
                    		</tr>
                    		<tr>
                    			<th>Sl</th>
                    			<th width="120">Booking No</th>
                    			<th width="90" style="word-break: break-all;">Booking<br>Date</th>
                    			<th width="210">Po No</th>
                    			<th width="90" style="word-break: break-all;">Booking Qty(Finish)</th>
                    			<th >Booking Type</th>
                    		</tr>
                    	</thead>
                    	<tbody>
                    		<?php 

                    		$sample_short_booking_sql="SELECT d.booking_no,
														      d.booking_type,
														      a.booking_date,
														      sum(d.fin_fab_qnty) as qnty,
														      c.po_number
															FROM wo_booking_mst a, wo_po_break_down c, wo_booking_dtls d
															 WHERE     d.po_break_down_id = c.id
															       AND a.booking_no = d.booking_no
															       AND c.id = d.po_break_down_id
															       AND a.job_no = c.job_no_mst
															       AND ( (a.booking_type = 1 AND a.is_short = 1 AND a.entry_form = 88)
															            OR (    a.booking_type = 4
															                AND a.is_short = 2
															                AND a.entry_form IS NULL))
															       AND a.status_active = 1
															       AND a.is_deleted = 0
															       AND d.status_active = 1
															       AND d.is_deleted = 0
															       AND a.job_no = '$job_no'
															 group by d.booking_no,
															       d.booking_type,
															       a.booking_date,
															       c.po_number" ;

							//echo $sample_short_booking_sql;
			                $res_sam_short=sql_select($sample_short_booking_sql);
			                $i=1;
			                foreach ($res_sam_short as $row) 
			                {
			                	$booking_type='';
			                	if($row[csf('booking_type')]==1)
			                	{
			                		$booking_type='Short';
			                	}
			                	else
			                	{
			                		$booking_type='Sample';
			                	}
			                	?>
			                		<tr>
			                			<td><?=$i?></td>
			                			<td><?=$row[csf('booking_no')]; ?></td>
			                			<td><?=change_date_format($row[csf('booking_date')]); ?></td>
			                			<td style="word-break: break-all;"><?=$row[csf('po_number')]; ?></td>
			                			<td align="right"><?=number_format($row[csf('qnty')],2); ?></td>
			                			<td align="center"><?=$booking_type; ?></td>
			                		</tr>
			                	<?
			                	$i++;
			                }
							?>
                    		
                    	</tbody>
                    </table>
                </td>

            </tr>
        </table>
       <br>

	<table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
        <caption> <strong style="float:left"> Stripe Details</strong></caption>
        <?
		$color_name_arr=return_library_array( "select id,color_name from lib_color where status_active=1 and is_deleted=0",'id','color_name');
		$sql_stripe=("select c.id,c.composition,c.construction,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,sum(b.grey_fab_qnty) as fab_qty,b.dia_width,d.color_number_id as color_number_id,d.id as did,d.stripe_color,d.fabreqtotkg as fabreqtotkg ,d.measurement as measurement ,d.yarn_dyed from wo_booking_dtls b, wo_pre_cost_fabric_cost_dtls c,wo_pre_stripe_color d where c.id=b.pre_cost_fabric_cost_dtls_id and c.job_no=b.job_no and d.pre_cost_fabric_cost_dtls_id=c.id and d.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and b.job_no=d.job_no and b.job_no='$job_no'  and d.job_no='$job_no' and b.booking_no=$txt_booking_no  and c.color_type_id in (2,6) and b.status_active=1  and c.is_deleted=0 and c.status_active=1  and d.is_deleted=0 and d.status_active=1  and 	b.is_deleted=0  group by c.id,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,d.color_number_id,d.id,d.stripe_color,d.yarn_dyed,d.fabreqtotkg ,d.measurement,c.composition,c.construction,b.dia_width order by c.id,d.id ");
	//echo $sql_stripe;


		$result_data=sql_select($sql_stripe);
		foreach($result_data as $row){
			$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['stripe_color'][$row[csf('did')]]=$row[csf('stripe_color')];
			$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['measurement'][$row[csf('did')]]=$row[csf('measurement')];
			$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['fabreqtotkg'][$row[csf('did')]]=$row[csf('fabreqtotkg')];
			$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['yarn_dyed'][$row[csf('did')]]=$row[csf('yarn_dyed')];

			$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['composition']=$row[csf('composition')];
			$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['construction']=$row[csf('construction')];
			$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['gsm_weight']=$row[csf('gsm_weight')];
			$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['color_type_id']=$row[csf('color_type_id')];
			$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['dia_width']=$row[csf('dia_width')];
		}
		?>
            <tr>
                <th width="30"> SL</th>
                <th width="100"> Body Part</th>
                <th width="80"> Fabric Color</th>
                <th width="70"> Fabric Qty(KG)</th>
                <th width="70"> Stripe Color</th>
                <th width="70"> Stripe Measurement</th>
                <th  width="70"> Qty.(KG)</th>
                <th  width="70"> Y/D Req.</th>
            </tr>
            <?
			$i=1;$total_fab_qty=0;$total_fabreqtotkg=0;$fab_data_array=array();
            foreach($stripe_arr as $body_id=>$body_data){
				foreach($body_data as $color_id=>$color_val){
					$rowspan=count($color_val['stripe_color']);
					$composition=$stripe_arr2[$body_id][$color_id]['composition'];
					$construction=$stripe_arr2[$body_id][$color_id]['construction'];
					$gsm_weight=$stripe_arr2[$body_id][$color_id]['gsm_weight'];
					$color_type_id=$stripe_arr2[$body_id][$color_id]['color_type_id'];
					$dia_width=$stripe_arr2[$body_id][$color_id]['dia_width'];
					if($db_type==0) $color_id_cond="IFNULL(d.fabric_color_id,0)=IFNULL('".$color_id."',0) and";
					else if ( $db_type==2) $color_id_cond="nvl(d.fabric_color_id,0)=nvl('".$color_id."',0) and";
					$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
						WHERE a.job_no=b.job_no and
						a.id=b.pre_cost_fabric_cost_dtls_id and
						c.job_no_mst=a.job_no and
						c.id=b.color_size_table_id and
						b.po_break_down_id=d.po_break_down_id and
						b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
						d.booking_no =$txt_booking_no and
						a.body_part_id='".$body_id."' and
						a.color_type_id='".$color_type_id."' and
						a.construction='".$construction."' and
						a.composition='".$composition."' and
						a.gsm_weight='".$gsm_weight."' and
						$color_id_cond
						d.status_active=1 and
						d.is_deleted=0
						");
						list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty;
					?>
					<tr>
					<?
					$color_qty=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
					?>
                        <td rowspan="<? echo $rowspan;?>"> <? echo $i; ?></td>
                        <td rowspan="<? echo $rowspan;?>"> <? echo $body_part[$body_id]; ?></td>
                        <td rowspan="<? echo $rowspan;?>"> <? echo $color_name_arr[$color_id]; ?></td>
                        <td rowspan="<? echo $rowspan;?>" align="right"> <? echo number_format($color_qty,2); ?></td>
					<?
					$total_fab_qty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
					foreach($color_val['stripe_color'] as $strip_color_id=>$s_color_val)
					{
						$measurement=$color_val['measurement'][$strip_color_id];
						$fabreqtotkg=$color_val['fabreqtotkg'][$strip_color_id];
						$yarn_dyed=$color_val['yarn_dyed'][$strip_color_id];
						?>
						<td><?  echo  $color_name_arr[$s_color_val]; ?></td>
						<td align="right"> <? echo  number_format($measurement,2); ?></td>
						<td align="right"> <? echo  number_format($fabreqtotkg,2); ?></td>
						<td> <? echo  $yes_no[$yarn_dyed]; ?></td>
					</tr>
						<?
						$total_fabreqtotkg+=$fabreqtotkg;
					}
					$i++;
				}
			}
			?>
        <tfoot>
        <tr>
            <td colspan="3">Total </td>
            <td align="right"><? echo  number_format($total_fab_qty,2); ?> </td>
            <td></td>
            <td></td>
            <td align="right"><? echo  number_format($total_fabreqtotkg,2); ?> </td>
            <td> </td>
        </tr>
        </tfoot>
   </table>



    <br>
        <?
     $desg_name=return_library_array( "select id, custom_designation from lib_designation", "id", "custom_designation"  );
	 $data_array=sql_select("select b.approved_by,b.approved_no, b.approved_date, c.user_full_name,c.designation from  wo_booking_mst a , approval_history b, user_passwd c where a.id=b.mst_id and b.approved_by=c.id and a.booking_no=$txt_booking_no and b.entry_form=7 order by b.id asc");
	?>
       <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>
            <tr style="border:1px solid black;">
                <th colspan="3" style="border:1px solid black;">Approval Status</th>
                </tr>
                <tr style="border:1px solid black;">
                <th width="3%" style="border:1px solid black;">Sl</th><th width="50%" style="border:1px solid black;">Name/Designation</th><th width="27%" style="border:1px solid black;">Approval Date</th><th width="20%" style="border:1px solid black;">Approval No</th>
                </tr>
            </thead>
            <tbody>
            <?
			$s=1;
			foreach($data_array as $row){
			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $s;?></td><td width="50%" style="border:1px solid black;"><? echo $row[csf('user_full_name')].'/'.$desg_name[$row[csf('designation')]];?></td><td width="27%" style="border:1px solid black;"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); //echo change_date_format($row[csf('approved_date')],"dd-mm-yyyy","-");?></td><td width="20%" style="border:1px solid black;"><? echo $row[csf('approved_no')];?></td>
                </tr>
                <?
				$s++;
			}
				?>
            </tbody>
        </table>

        </br>


	<fieldset id="div_size_color_matrix" style="max-width:1000;">
        <legend>TNA Information</legend>
        <!--<span style="font-size:180; font-weight:bold;"></span>-->
        <table width="100%" style="border:1px solid black;font-size:12px" border="1" cellpadding="2" cellspacing="0" rules="all">
            <tr>
            	<td rowspan="2" align="center" valign="top">SL</td>
            	<td width="180" rowspan="2"  align="center" valign="top"><b>Order No</b></td>
                <td colspan="2" align="center" valign="top"><b>Yarn Receive</b></td>
                <td colspan="2" align="center" valign="top"><b>Knitting</b></td>
                <td colspan="2" align="center" valign="top"><b>Dyeing</b></td>
                <td colspan="2" align="center" valign="top"><b>Finishing Fabric</b></td>
                <td colspan="2" align="center" valign="top"><b>Cutting </b></td>
                <td colspan="2" align="center" valign="top"><b>Sewing </b></td>
                <td colspan="2"  align="center" valign="top"><b>Ex-factory </b></td>
            </tr>
            <tr>
            	<td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>

            </tr>
            <?
			$i=1;
			foreach($tna_date_task_arr as $order_id=>$row)
			{
				 //$tna_date_task_arr//knitting_start_date dying_start_date finishing_start_date cutting_start_date sewing_start_date exfact_start_date
				?>
                <tr>
                	<td><? echo $i; ?></td>
                    <td><? echo $po_num_arr[$order_id]; ?></td>
                    <td align="center"><? echo change_date_format($row['yarn_rec_start_date']); ?></td>
                    <td  align="center"><? echo change_date_format($row['yarn_rec_end_date']); ?></td>
                	<td align="center"><? echo change_date_format($row['knitting_start_date']); ?></td>
                    <td  align="center"><? echo change_date_format($row['knitting_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['dying_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['dying_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['cutting_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['cutting_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['sewing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['sewing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['exfact_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['exfact_end_date']); ?></td>
                </tr>
                <?
				$i++;
			}
			?>

        </table>
        </fieldset>



        <?
		}// fabric Source End
		
        if($isYarnPurchseValidate==2)
		{
			?>
            <br>
			<table align="left" width="350px" style="border:1px solid black;font-size:12px; font-family:Arial Narrow;" border="1" cellspacing="0" rules="all">
				<tr>
					<th colspan="3">Yarn Purchase Requisition Info</th>
				</tr>
				<tr>
					<th width="120">Job No</th>
					<th width="130">Purchase Req. No</th>
					<th>Qty.</th>
				</tr>
                
                <?
				$sqlYarnReq="select a.requ_no, b.job_no, sum(b.quantity) as qty from inv_purchase_requisition_mst a, inv_purchase_requisition_dtls b where a.id=b.mst_id and b.job_no='$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.requ_no, b.job_no";
				$sqlYarnReqRes=sql_select($sqlYarnReq);
				foreach($sqlYarnReqRes as $row)
				{
				?>
                <tr>
					<td width="120"><?=$row[csf("job_no")]; ?></td>
					<td width="130"><?=$row[csf("requ_no")]; ?></td>
					<td align="right"><?=number_format($row[csf("qty")],2); ?></td>
				</tr>
                
                <?
				}
				?>
        	</table>
            <br><br><br>
		<? } ?>

         <!--<br><br><br><br>-->
         <?
		 	echo signature_table(1, $cbo_company_name, "1330px");
		 ?>

       </div>
       <?

}


if($action=="show_fabric_booking_report1")
{

	extract($_REQUEST);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$imge_arr=return_library_array( "select master_tble_id,image_location from common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	//$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$marchentrArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info ","id","team_member_name");
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$location_name_arr=return_library_array( "select id,location_name from lib_location",'id','location_name');
	$po_qnty_tot=return_field_value("sum(plan_cut)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	$po_qnty_tot1=return_field_value("sum(po_quantity)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	?>
	<div style="width:1330px" align="center">
    <?php
$nameArray_approved = sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7");
list($nameArray_approved_row) = $nameArray_approved;
$nameArray_approved_date = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
list($nameArray_approved_date_row) = $nameArray_approved_date;
$nameArray_approved_comments = sql_select("select b.comments as comments from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
list($nameArray_approved_comments_row) = $nameArray_approved_comments;
$path = str_replace("'", "", $path);
if ($path != "") {
	$path = $path;
} else {
	$path = "../../";
}

?>										<!--    Header Company Information         -->
       <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black" >
           <tr>
               <td width="100">
               <img  src='<? echo $path.$imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />

              <!-- <img  src='../../<? //echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />-->
               </td>
               <td width="1250">
                    <table width="100%" cellpadding="0" cellspacing="0"  >
                        <tr>
                            <td align="center" style="font-size:20px;">
                              <?php
echo $company_library[$cbo_company_name];
?>
                            </td>
                            <td rowspan="3" width="250">

                                <!--<a href="requires/fabric_booking_controller.php?filename=welcome.html&action=download_file" style="text-transform:none">Download</a>-->
                               <span style="font-size:18px"><b> Job No:&nbsp;&nbsp;<? echo trim($txt_job_no,"'"); ?></b></span><br/>
                                <?
								 if($nameArray_approved_row[csf('approved_no')]>1)
								 {
								 ?>
								 <b> Revised No: <? echo $nameArray_approved_row[csf('approved_no')]-1; ?></b>
                                  <br/>
								  Approved Date: <? echo $nameArray_approved_date_row[csf('approved_date')]; ?>
								  <?
								 }
							  	?>
                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:14px">
                            <?
                            $nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
							//$nameArray=sql_select("select location_name from wo_po_details_master where job_no=$txt_job_no");

							if($txt_job_no!="")
							{
							 $location=return_field_value( "location_name", "wo_po_details_master","job_no=$txt_job_no");
							}
							else
							{
							$location="";
							}

                            foreach ($nameArray as $result)
                            {
							echo $location_name_arr[$location];
                            ?>
                                <!--Plot No: <? //echo $result[csf('plot_no')]; ?>
                                Level No: <? //echo $result[csf('level_no')]?>
                                Road No: <? //echo $result[csf('road_no')]; ?>
                                Block No: <? //echo $result[csf('block_no')];?>
                                City No: <? //echo $result[csf('city')];?>
                                Zip Code: <? //echo $result[csf('zip_code')]; ?>
                                Province No: <?php //echo $result[csf('province')];?>
                                Country: <? //echo $country_arr[$result[csf('country_id')]]; ?> --><br>
                                Email Address: <? echo $result[csf('email')];?>
                                Website No:   <? echo $result[csf('website')];


                            }
                            ?>
                               </td>
                            </tr>
                            <tr>
                            <td align="center" style="font-size:20px">
                                <strong>Fabric Dia & Garments Size Wise Finish Fabric Requirment<font style="color:#F00"><? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </font></strong>
                             </td>
                            </tr>
                      </table>
                </td>
            </tr>
       </table>
                <?
				$job_no='';
				$total_set_qnty=0;
				$colar_excess_percent=0;
				$cuff_excess_percent=0;
				$rmg_process_breakdown=0;
                $nameArray=sql_select( "select a.booking_no,a.booking_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.delivery_date,a.po_break_down_id,a.colar_excess_percent,a.cuff_excess_percent,a.delivery_date,a.is_apply_last_update,a.fabric_source,a.rmg_process_breakdown,a.insert_date,a.update_date,b.job_no,b.buyer_name, b.style_ref_no ,b.gmts_item_id,b.order_uom,b.total_set_qnty,b.style_description,b.product_dept,b.product_code,b.pro_sub_dep,b.dealing_marchant from wo_booking_mst a, wo_po_details_master b where  a.job_no=b.job_no and a.booking_no=$txt_booking_no");
				foreach ($nameArray as $result)
				{
					$total_set_qnty=$result[csf('total_set_qnty')];
					$colar_excess_percent=$result[csf('colar_excess_percent')];
				    $cuff_excess_percent=$result[csf('cuff_excess_percent')];
					$rmg_process_breakdown=$result[csf('rmg_process_breakdown')];
					$po_no="";
					$shipment_date="";
					$sql_po= "select po_number,MIN(pub_shipment_date) pub_shipment_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by po_number";
					$data_array_po=sql_select($sql_po);
					foreach ($data_array_po as $row_po)
					{
						$po_no.=$row_po[csf('po_number')].", ";
						$shipment_date.=change_date_format($row_po[csf('pub_shipment_date')],'dd-mm-yyyy','-').", ";
					}
					$lead_time="";
                    if($db_type==0)
					{
					$sql_lead_time= "select DATEDIFF(pub_shipment_date,po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}
					if($db_type==2)
					{
					$sql_lead_time= "select (pub_shipment_date-po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}
					$data_array_lead_time=sql_select($sql_lead_time);
					foreach ($data_array_lead_time as $row_lead_time)
					{
						$lead_time.=$row_lead_time[csf('date_diff')].",";
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}
					$po_received_date="";
					$sql_po_received_date= "select MIN(po_received_date) as po_received_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					$data_array_po_received_date=sql_select($sql_po_received_date);
					foreach ($data_array_po_received_date as $row_po_received_date)
					{
						$po_received_date=change_date_format($row_po_received_date[csf('po_received_date')],'dd-mm-yyyy','-');
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}
				?>
       <table width="100%" style="border:1px solid black" >
            <tr>
                <td colspan="6" valign="top" style="font-size:18px; color:#F00"><? if($result[csf('is_apply_last_update')]==2){echo "Booking Info not synchronized with order entry and pre-costing. order entry or pre-costing has updated after booking entry.  Contact to ".$marchentrArr[$result[csf('dealing_marchant')]]; } else{ echo "";} ?></td>
            </tr>
            <tr>
                <td width="100"><span style="font-size:18px"><b>Buyer/Agent Name</b></span></td>
                <td width="110">:&nbsp;<span style="font-size:18px"><b><? echo $buyer_name_arr[$result[csf('buyer_name')]]; ?></b></span></td>
                <td width="100"><span style="font-size:12px"><b>Dept.</b></span></td>
                <td width="110">:&nbsp;<? echo $product_dept[$result[csf('product_dept')]] ; if($result[csf('product_code')] !=""){ echo " (".$result[csf('product_code')].")";} if($result[csf('pro_sub_dep')] !=0){ echo " (".$pro_sub_dept_array[$result[csf('pro_sub_dep')]].")";}?></td>
                <td width="100"><span style="font-size:12px"><b>Order Qnty</b></span></td>
                <td width="110">:&nbsp;
				<?  echo $po_qnty_tot1." ".$unit_of_measurement[$result[csf('order_uom')]] ; ?>
                </td>
            </tr>
            <tr>

                <td width="100" style="font-size:12px"><b>Garments Item</b></td>
                <td width="110">:&nbsp;
				<?
				$gmts_item_name="";
				$gmts_item=explode(',',$result[csf('gmts_item_id')]);
				for($g=0;$g<=count($gmts_item); $g++)
				{
					$gmts_item_name.= $garments_item[$gmts_item[$g]].",";
				}
				echo rtrim($gmts_item_name,',');
				?>
                </td>
                <td width="100" style="font-size:12px"><b>Booking Release Date</b></td>
                <td width="110">:&nbsp;
				<?
				$booking_date=$result[csf('update_date')];
				if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
				{
					$booking_date=$result[csf('insert_date')];
				}
				echo change_date_format($booking_date,'dd-mm-yyyy','-','');
				?>&nbsp;&nbsp;&nbsp;</td>
                <td width="100" style="font-size:18px"><b>Style Ref.</b>   </td>
                <td width="110" style="font-size:18px">:&nbsp;<b><? echo $result[csf('style_ref_no')];?> </b>   </td>

            </tr>
             <tr>



                <td  width="100" style="font-size:12px"><b>Style Des.</b></td>
                <td  width="110" >:&nbsp;<? echo $result[csf('style_description')]; $job_no= $result[csf('job_no')];?></td>
                <td width="100" style="font-size:12px"><b>Lead Time </b>   </td>
                <td width="110">:&nbsp;<?  echo rtrim($lead_time,",");;?> </td>
                <td width="100" style="font-size:12px"><b>Dealing Merchant</b></td>
                <td width="110">:&nbsp;<? echo $marchentrArr[$result[csf('dealing_marchant')]]; ?></td>



            </tr>

            <tr>
                <td width="100" style="font-size:12px"><b>Supplier Name</b>   </td>
                <td width="110">:&nbsp;<? echo $supplier_name_arr[$result[csf('supplier_id')]];?>    </td>
                <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
               	<td width="110">:&nbsp;<? echo change_date_format( $result[csf('delivery_date')],'dd-mm-yyyy','-');?></td>
                <td width="100" style="font-size:18px"><b>Booking No </b>   </td>
                <td width="110" style="font-size:18px">:&nbsp;<b><? echo $result[csf('booking_no')];?></b><? echo "(".$fabric_source[$result[csf('fabric_source')]].")"?></td>



            </tr>
            <tr>
                <td width="100" style="font-size:12px"><b>Season</b></td>
                <td width="110">:&nbsp;<? echo $result[csf('season')]; ?></td>
                <td  width="100" style="font-size:12px"><b>Attention</b></td>
                <td  width="110" >:&nbsp;<? echo $result[csf('attention')]; ?></td>
                <td  width="100" style="font-size:12px"><b>Po Received Date</b></td>
                <td  width="110" >:&nbsp;<? echo $po_received_date; ?></td>



            </tr>
           <tr>
               <td width="100" style="font-size:18px"><b>Order No</b></td>
                <td width="110" style="font-size:18px" colspan="5">:&nbsp;<b><? echo rtrim($po_no,", "); ?></b></td>

            </tr>
            <tr>
               <td width="100" style="font-size:12px"><b>Shipment Date</b></td>
                <td width="110" colspan="5"> :&nbsp;<? echo rtrim($shipment_date,", "); ?></td>

            </tr>

        </table>
        <br/>
           <?
			}

	$po_color_size_qnty_array=array();
	$po_size_qnty_array=array();
	/*$sql="SELECT b.gmts_item_id as item_number_id, c.id as po_id, d.size_number_id, d.color_number_id, d.order_quantity as order_quantity, d.plan_cut_qnty as plan_cut_qnty
	FROM wo_po_details_master a
	LEFT JOIN wo_po_details_mas_set_details b ON a.job_no = b.job_no
	LEFT JOIN wo_po_break_down c ON a.job_no = c.job_no_mst
	AND c.is_deleted =0
	AND c.status_active =1
	LEFT JOIN wo_po_color_size_breakdown d ON c.job_no_mst = d.job_no_mst
	AND c.id = d.po_break_down_id
	AND d.is_deleted =0
	AND d.status_active =1
	WHERE
	a.is_deleted =0
	AND a.status_active=1
	AND c.id in(".str_replace("'","",$txt_order_no_id).")
	";*/
	$sql="SELECT b.gmts_item_id as item_number_id, c.id as po_id, d.size_number_id, d.color_number_id, d.order_quantity as order_quantity, d.plan_cut_qnty as plan_cut_qnty
	FROM wo_po_details_master a, wo_po_details_mas_set_details b , wo_po_break_down c, wo_po_color_size_breakdown d
	WHERE
	a.job_no = b.job_no and
	a.job_no = c.job_no_mst and
	a.job_no = d.job_no_mst and
	b.gmts_item_id=d.item_number_id and
    c.id = d.po_break_down_id and
	c.id in(".str_replace("'","",$txt_order_no_id).") and
	a.is_deleted =0 and
	a.status_active=1 and
	c.is_deleted =0 and
	c.status_active =1 and
	d.is_deleted =0 and
	d.status_active =1
	";
	$sql_data = sql_select($sql);
	foreach( $sql_data as $row)
	{
	$po_color_size_qnty_array[$row[csf('po_id')]][$row[csf('item_number_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]+=$row[csf('plan_cut_qnty')];
	$po_size_qnty_array[$row[csf('size_number_id')]]+=$row[csf('plan_cut_qnty')];
	}

    $nameArray_fabric_description= sql_select("select a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type, b.dia_width, avg(b.process_loss_percent) as  process_loss_percent FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
WHERE a.job_no=b.job_no and
a.id=b.pre_cost_fabric_cost_dtls_id and
c.job_no_mst=a.job_no and
c.id=b.color_size_table_id and
b.po_break_down_id=d.po_break_down_id and
b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
d.booking_no =$txt_booking_no and
a.body_part_id in(1,10,11,14,15,16,17,20,95,109,125,128,131,132,135,149,150,151,152,164,167,171,191) and
d.status_active=1 and
d.is_deleted=0
group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by a.body_part_id,b.dia_width");
	 ?>

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
     <tr align="center">
     <th colspan="6" align="left">Body Part</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
		}
		?>
        <td  rowspan="8" width="50"><p>Total  Finish Fabric <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>


       </tr>
     <tr align="center"><th colspan="6" align="left">Color Type</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
		}
		?>

       </tr>
        <tr align="center"><th colspan="6" align="left">Fabric Construction</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>".$result_fabric_description[csf('construction')]."</td>";
		}
		?>


       </tr>
        <tr align="center"><th   colspan="6" align="left">Fabric Composition</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('composition')] == "")   echo "<td  colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>".$result_fabric_description[csf('composition')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th  colspan="6" align="left">GSM</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='2'>&nbsp</td>";
			else         		       echo "<td  align='center' colspan='2'>". $result_fabric_description[csf('gsm_weight')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="6" align="left">Dia/Width (Inch)</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='2'>&nbsp</td>";
			else         		              echo "<td  align='center' colspan='2'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
		}
		?>
       </tr>

       <tr>
       <th  colspan="<? echo  count($nameArray_fabric_description)*2+6; ?>" align="left" style="height:30px">&nbsp;</th>
       </tr>

       <tr>
            <th  width="50" align="left">Sl</th>
            <th  width="120" align="left">PO No</th>
            <th  width="120" align="left">Gmt Item</th>
            <th  width="120" align="left">Gmt Color</th>
            <th  width="120" align="left">Gmt Size</th>
            <th  width="100" align="left">Plan Cut Qty</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			  echo "<th width='50'>Fab.Color</th><th width='50'>Finish</th>";
		}
		?>

       </tr>
       <?
	   $po_number=return_library_array( "select id, po_number from wo_po_break_down", "id", "po_number");

	    $i=1;
		$total_plan_cut_qnty=0;
		$grand_total_fin_fab_qnty=0;
		$color_wise_wo_sql= sql_select("select b.po_break_down_id, c.item_number_id,c.color_number_id,c.size_number_id, sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
		WHERE a.job_no=b.job_no and
		a.id=b.pre_cost_fabric_cost_dtls_id and
		c.job_no_mst=a.job_no and
		c.id=b.color_size_table_id and
		b.po_break_down_id=d.po_break_down_id and
		b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
		d.booking_no =$txt_booking_no and
		a.body_part_id in(1,10,11,14,15,16,17,20,95,109,125,128,131,132,135,149,150,151,152,164,167,171,191) and
		d.status_active=1 and
		d.is_deleted=0
		group by b.po_break_down_id,c.item_number_id,c.color_number_id,c.size_number_id order by b.po_break_down_id, c.item_number_id,c.color_number_id,c.size_number_id");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
		?>
			<tr>
            <td>
            <?
			echo $i;
			?>
            </td>
            <td>
            <?
			echo $po_number[$color_wise_wo_result[csf('po_break_down_id')]];
			?>
            </td>
            <td>
            <?
			echo $garments_item[$color_wise_wo_result[csf('item_number_id')]];
			?>
            </td>
            <td>
            <?
			echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
			?>
            </td>

            <td  width="120" align="left">
			<?
			echo $size_library[$color_wise_wo_result[csf('size_number_id')]];
			?>
            </td>

            <td  width="100" align="right">
			<?
			$plan_cut_qty=$po_color_size_qnty_array[$color_wise_wo_result[csf('po_break_down_id')]][$color_wise_wo_result[csf('item_number_id')]][$color_wise_wo_result[csf('color_number_id')]][$color_wise_wo_result[csf('size_number_id')]];
			echo $po_color_size_qnty_array[$color_wise_wo_result[csf('po_break_down_id')]][$color_wise_wo_result[csf('item_number_id')]][$color_wise_wo_result[csf('color_number_id')]][$color_wise_wo_result[csf('size_number_id')]];
			$total_plan_cut_qnty+=$po_color_size_qnty_array[$color_wise_wo_result[csf('po_break_down_id')]][$color_wise_wo_result[csf('item_number_id')]][$color_wise_wo_result[csf('color_number_id')]][$color_wise_wo_result[csf('size_number_id')]];
			//echo $color_wise_wo_result['plan_cut_qnty'];
			//$total_plan_cut_qnty+=$color_wise_wo_result['plan_cut_qnty'];
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_grey_fab_qnty=0;
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				$color_wise_wo_sql_qnty=sql_select("select avg(b.cons) as cons,min(d.fabric_color_id) as fabric_color_id, sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				b.po_break_down_id=".$color_wise_wo_result[csf('po_break_down_id')]." and
				c.item_number_id=".$color_wise_wo_result[csf('item_number_id')]." and
				c.color_number_id=".$color_wise_wo_result[csf('color_number_id')]." and
				c.size_number_id=".$color_wise_wo_result[csf('size_number_id')]." and
				d.status_active=1 and
				d.is_deleted=0
				");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
            <td width='50' align='right'>
			<?


			if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			{
			echo $color_library[$color_wise_wo_result_qnty[csf('fabric_color_id')]] ;
			}
			?>
            </td>

			<td width='50' align='right'>
            <span style="border-bottom:1px solid; border-bottom-color:#000; width:100%">
            <?
			if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],4);
			$total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('fin_fab_qnty')];
			}
			?>
            </span>
            <br/>
            <span>
            <?
			if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			{
			//echo number_format($color_wise_wo_result_qnty['fin_fab_qnty'],4);
			echo "<font style='font-size:10px'>Cons:".number_format($color_wise_wo_result_qnty[csf('cons')],4)."</font>";
			//$total_fin_fab_qnty+=$color_wise_wo_result_qnty['fin_fab_qnty'];
			}
			?>
            </span>

            </td>

            <?
			}
			?>
             <td align="right">
			 <? echo number_format($total_fin_fab_qnty,4); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?>
             </td>
            </tr>
         <?
		 $i++;
		}
		?>
        <tr style=" font-weight:bold">

        <td  width="120" align="left" colspan="5"><strong>Total</strong></td>
        <td  width="120" align="right"><? echo $total_plan_cut_qnty; ?></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
            <td width='50' align='right'><?  //echo number_format($color_wise_wo_result_qnty['fin_fab_qnty'],4) ;?></td>
			<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],4) ;?></td>
            <?
			}
			?>
            <td align="right"><? echo number_format($grand_total_fin_fab_qnty,4);?></td>

            </tr>
    </table>
    <br/>
    <?
		$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
		?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
            <tr>
                <td width="49%" valign="top">
                <?
				if(count($sql_embelishment)>0)
				{
				?>
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td colspan="7"><b>Embelishment (Pre Cost)</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Embelishment Name</td>
                    <td>Embelishment Type</td>
                    <td>Cons <? echo $costing_per; ?> Gmts</td>
                    <td>Rate</td>
                    <td>Amount</td>

                    </tr>
                    <?
					$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
					$i=0;
					//$total_yarn=0;
					foreach($sql_embelishment  as $row_embelishment)
                    {

						$i++;
					?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
					<?
					echo $emblishment_name_array[$row_embelishment[csf('emb_name')]];
					?>
                    </td>
                    <td>
                    <?
					if($row_embelishment[csf('emb_name')]==1)
					{
					echo $emblishment_print_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==2)
					{
					echo $emblishment_embroy_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==3)
					{
					echo $emblishment_wash_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==4)
					{
					echo $emblishment_spwork_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==5)
					{
					echo $row_embelishment[csf('emb_type')];
					}
					?>

                    </td>
                    <td>
                    <?
					echo $row_embelishment[csf('cons_dzn_gmts')];
					?>
                    </td>
                    <td>
					<?
					echo $row_embelishment[csf('rate')];
					?>
                    </td>

                    <td>
					<?
					echo $row_embelishment[csf('amount')];
					?>
                    </td>


                    </tr>
                    <?
					}
					?>
                 <!--   <tr align="center">
                    <td>Total</td>
                    <td></td>
                    <td></td>
                    <td></td>

                    <td></td>

                    <td></td>

                    </tr>-->
                    </table>
                    <?
				}
					?>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top" align="center">
                <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td><b>Approved Instructions</b></td>

                    </tr>
                    <tr>
                    <td>
                <?  echo $nameArray_approved_comments_row[csf('comments')];  ?>
                </td>
                </tr>
                </table>

                </td>
            </tr>
        </table>
        <br/>
         <!--<br><br><br><br>-->
         <?
		 	echo signature_table(1, $cbo_company_name, "1330px");
		 ?>
       </div>
       <?
}

if($action=="show_fabric_booking_report2")
{

	extract($_REQUEST);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$imge_arr=return_library_array( "select master_tble_id,image_location from common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	//$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$marchentrArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info ","id","team_member_name");
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$location_name_arr=return_library_array( "select id,location_name from lib_location",'id','location_name');
	$po_qnty_tot=return_field_value("sum(plan_cut)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	$po_qnty_tot1=return_field_value("sum(po_quantity)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	?>
	<div style="width:1330px" align="center">
    <?php
$nameArray_approved = sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7");
list($nameArray_approved_row) = $nameArray_approved;
$nameArray_approved_date = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
list($nameArray_approved_date_row) = $nameArray_approved_date;
$nameArray_approved_comments = sql_select("select b.comments as comments from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
list($nameArray_approved_comments_row) = $nameArray_approved_comments;
$path = str_replace("'", "", $path);
if ($path != "") {
	$path = $path;
} else {
	$path = "../../";
}

?>										<!--    Header Company Information         -->
       <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black" >
           <tr>
               <td width="220">
               <img  src='<? echo $path.$imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />

               </td>
               <td width="1250">
                    <table width="100%" cellpadding="0" cellspacing="0"  >
                        <tr>
                            <td align="center" style="font-size:20px;">
                              <?php
echo $company_library[$cbo_company_name];
?>
                            </td>
                            <td rowspan="3" width="250">

                                <!--<a href="requires/fabric_booking_controller.php?filename=welcome.html&action=download_file" style="text-transform:none">Download</a>-->
                              <span style="font-size:18px"><b> Job No:&nbsp;&nbsp;<? echo trim($txt_job_no,"'"); ?></b></span><br/>
                                <?
								 if($nameArray_approved_row[csf('approved_no')]>1)
								 {
								 ?>
								 <b> Revised No: <? echo $nameArray_approved_row[csf('approved_no')]-1; ?></b>
                                  <br/>
								  Approved Date: <? echo $nameArray_approved_date_row[csf('approved_date')]; ?>
								  <?
								 }
							  	?>
                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:14px">
                            <?
                           $nameArray=sql_select("select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
						   if($txt_job_no!="")
							{
							 $location=return_field_value( "location_name", "wo_po_details_master","job_no=$txt_job_no");
							}
							else
							{
							$location="";
							}

                            foreach ($nameArray as $result)
                            {
								echo $location_name_arr[$location];
                            ?>
                                <!--Plot No: <? //echo $result[csf('plot_no')]; ?>
                                Level No: <? //echo $result[csf('level_no')]?>
                                Road No: <? //echo $result[csf('road_no')]; ?>
                                Block No: <? //echo $result[csf('block_no')];?>
                                City No: <? //echo $result[csf('city')];?>
                                Zip Code: <? //echo $result[csf('zip_code')]; ?>
                                Province No: <?php //echo $result[csf('province')];?>
                                Country: <? //echo $country_arr[$result[csf('country_id')]]; ?>--><br>
                                Email Address: <? echo $result[csf('email')];?>
                                Website No: <? echo $result[csf('website')];


                            }
                            ?>
                               </td>
                            </tr>
                            <tr>
                            <td align="center" style="font-size:20px">
                                <strong>Fabric Dia & Garments Size Wise Finish Fabric Requirment<font style="color:#F00"><? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </font></strong>
                             </td>
                            </tr>
                      </table>
                </td>
            </tr>
       </table>
                <?
				if($db_type==2) $group_concat_all=" listagg(cast(b.grouping as varchar2(4000)),',') within group (order by b.grouping) as grouping,
				listagg(cast(b.file_no as varchar2(4000)),',') within group (order by b.file_no) as file_no  ";
				else { $group_concat_all="group_concat(b.grouping) as grouping, group_concat(b.file_no) as file_no";}
            	$data_array3=sql_select("select a.job_no,a.company_name,a.buyer_name,$group_concat_all from wo_po_details_master a, wo_po_break_down b where b.id in (".str_replace("'","",$txt_order_no_id).") and a.job_no=b.job_no_mst group by a.job_no,a.company_name,a.buyer_name");

				$job_no='';
				$total_set_qnty=0;
				$colar_excess_percent=0;
				$cuff_excess_percent=0;
				$rmg_process_breakdown=0;
                $nameArray=sql_select( "select a.booking_no,a.booking_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.delivery_date,a.po_break_down_id,a.colar_excess_percent,a.cuff_excess_percent,a.delivery_date,a.is_apply_last_update,a.fabric_source,a.fabric_composition,a.rmg_process_breakdown,a.insert_date,a.update_date,b.job_no,b.buyer_name, b.style_ref_no ,b.gmts_item_id,b.order_uom,b.total_set_qnty,b.style_description,b.product_dept,b.product_code,b.pro_sub_dep,b.dealing_marchant from wo_booking_mst a, wo_po_details_master b where  a.job_no=b.job_no and a.booking_no=$txt_booking_no");
				foreach ($nameArray as $result)
				{
					$total_set_qnty=$result[csf('total_set_qnty')];
					$colar_excess_percent=$result[csf('colar_excess_percent')];
				    $cuff_excess_percent=$result[csf('cuff_excess_percent')];
					$rmg_process_breakdown=$result[csf('rmg_process_breakdown')];
					$po_no="";
					$shipment_date="";
					$sql_po= "select po_number,MIN(pub_shipment_date) pub_shipment_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by po_number";
					$data_array_po=sql_select($sql_po);
					foreach ($data_array_po as $row_po)
					{
						$po_no.=$row_po[csf('po_number')].", ";
						$shipment_date.=change_date_format($row_po[csf('pub_shipment_date')],'dd-mm-yyyy','-').", ";
					}
					$lead_time="";

					if($db_type==0)
					{
					$sql_lead_time= "select DATEDIFF(pub_shipment_date,po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}
					if($db_type==2)
					{
					$sql_lead_time= "select (pub_shipment_date-po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}
					$data_array_lead_time=sql_select($sql_lead_time);
					foreach ($data_array_lead_time as $row_lead_time)
					{
						$lead_time.=$row_lead_time[csf('date_diff')].",";
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}
					$po_received_date="";
					$sql_po_received_date= "select MIN(po_received_date) as po_received_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					$data_array_po_received_date=sql_select($sql_po_received_date);
					foreach ($data_array_po_received_date as $row_po_received_date)
					{
						$po_received_date=change_date_format($row_po_received_date[csf('po_received_date')],'dd-mm-yyyy','-');
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}
				?>
       <table width="100%" style="border:1px solid black" >
            <tr>
                <td colspan="6" valign="top" style="font-size:18px; color:#F00"><? if($result[csf('is_apply_last_update')]==2){echo "Booking Info not synchronized with order entry and pre-costing. order entry or pre-costing has updated after booking entry.  Contact to ".$marchentrArr[$result[csf('dealing_marchant')]]; } else{ echo "";} ?></td>
            </tr>
            <tr>
                <td width="100"><span style="font-size:18px"><b>Buyer/Agent Name</b></span></td>
                <td width="110">:&nbsp;<span style="font-size:18px"><b><? echo $buyer_name_arr[$result[csf('buyer_name')]]; ?></b></span></td>
                <td width="100"><span style="font-size:12px"><b>Dept.</b></span></td>
                <td width="110">:&nbsp;<? echo $product_dept[$result[csf('product_dept')]] ; if($result[csf('product_code')] !=""){ echo " (".$result[csf('product_code')].")";} if($result[csf('pro_sub_dep')] !=0){ echo " (".$pro_sub_dept_array[$result[csf('pro_sub_dep')]].")";}?></td>
                <td width="100"><span style="font-size:12px"><b>Order Qnty</b></span></td>
                <td width="110">:&nbsp;
				<?  echo $po_qnty_tot1." ".$unit_of_measurement[$result[csf('order_uom')]] ; ?>
                </td>
            </tr>
            <tr>

                <td width="100" style="font-size:12px"><b>Garments Item</b></td>
                <td width="110">:&nbsp;
				<?
				$gmts_item_name="";
				$gmts_item=explode(',',$result[csf('gmts_item_id')]);
				for($g=0;$g<=count($gmts_item); $g++)
				{
					$gmts_item_name.= $garments_item[$gmts_item[$g]].",";
				}
				echo rtrim($gmts_item_name,',');
				?>
                </td>
                <td width="100" style="font-size:12px"><b>Booking Release Date</b></td>
                <td width="110">:&nbsp;
				<?
				$booking_date=$result[csf('update_date')];
				if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
				{
					$booking_date=$result[csf('insert_date')];
				}
				echo change_date_format($booking_date,'dd-mm-yyyy','-','');
				?>&nbsp;&nbsp;&nbsp;</td>
                <td width="100" style="font-size:18px"><b>Style Ref.</b>   </td>
                <td width="110" style="font-size:18px">:&nbsp;<b><? echo $result[csf('style_ref_no')];?> </b>   </td>

            </tr>
             <tr>



                <td  width="100" style="font-size:12px"><b>Style Des.</b></td>
                <td  width="110" >:&nbsp;<? echo $result[csf('style_description')]; $job_no= $result[csf('job_no')];?></td>
                <td width="100" style="font-size:12px"><b>Lead Time </b>   </td>
                <td width="110">:&nbsp;<?  echo rtrim($lead_time,",");;?> </td>
                <td width="100" style="font-size:12px"><b>Dealing Merchant</b></td>
                <td width="110">:&nbsp;<? echo $marchentrArr[$result[csf('dealing_marchant')]]; ?></td>



            </tr>

            <tr>
                <td width="100" style="font-size:12px"><b>Supplier Name</b>   </td>
                <td width="110">:&nbsp;<? echo $supplier_name_arr[$result[csf('supplier_id')]];?>    </td>
                <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
               	<td width="110">:&nbsp;<? echo change_date_format( $result[csf('delivery_date')],'dd-mm-yyyy','-');?></td>
                <td width="100" style="font-size:18px"><b>Booking No </b>   </td>
                <td width="110" style="font-size:18px">:&nbsp;<b><? echo $result[csf('booking_no')];?></b><? echo "(".$fabric_source[$result[csf('fabric_source')]].")"?></td>



            </tr>
            <tr>
                <td width="100" style="font-size:12px"><b>Season</b></td>
                <td width="110">:&nbsp;<? echo $result[csf('season')]; ?></td>
                <td  width="100" style="font-size:12px"><b>Attention</b></td>
                <td  width="110" >:&nbsp;<? echo $result[csf('attention')]; ?></td>
                <td  width="100" style="font-size:12px"><b>Po Received Date</b></td>
                <td  width="110" >:&nbsp;<? echo $po_received_date; ?></td>



            </tr>
            <tr>
                <td style="font-size:18px"><b>Internal Ref No</b></td>
                <td style="font-size:18px"> :&nbsp;<b><? echo implode(",",array_unique(explode(",",$data_array3[0][csf("grouping")]))); ?></b></td>
                <td style="font-size:18px"><b>File no</b></td>
                <td style="font-size:18px" colspan="3"> :&nbsp;<b><? echo  implode(",",array_unique(explode(",",$data_array3[0][csf("file_no")])));?></b></td>
            </tr>
           <tr>
               <td width="100" style="font-size:18px"><b>Order No</b></td>
                <td width="110" style="font-size:18px" colspan="5">:&nbsp;<b><? echo rtrim($po_no,", "); ?></b></td>

            </tr>
            <tr>
               <td width="100" style="font-size:12px"><b>Shipment Date</b></td>
                <td width="110" colspan="5"> :&nbsp;<? echo rtrim($shipment_date,", "); ?></td>

            </tr>
            <tr>
               <td width="100" style="font-size:12px"><b>Fab. Composition</b></td>
                <td width="110" colspan="5"> :&nbsp;<? echo $result[csf('fabric_composition')];; ?></td>

            </tr>

        </table>
        <br/>
           <?
			}

	$po_color_size_qnty_array=array();
	$po_size_qnty_array=array();
	//$color_wise_row=array();
	/*$sql="SELECT d.size_number_id, d.color_number_id, sum(d.order_quantity) as order_quantity, sum(d.plan_cut_qnty) as plan_cut_qnty
	FROM wo_po_details_master a
	LEFT JOIN wo_po_details_mas_set_details b ON a.job_no = b.job_no
	LEFT JOIN wo_po_break_down c ON a.job_no = c.job_no_mst
	AND c.is_deleted =0
	AND c.status_active =1
	LEFT JOIN wo_po_color_size_breakdown d ON c.job_no_mst = d.job_no_mst
	AND c.id = d.po_break_down_id
	AND d.is_deleted =0
	AND d.status_active =1
	WHERE
	a.is_deleted =0
	AND a.status_active=1
	AND c.id in(".str_replace("'","",$txt_order_no_id).")
	group by d.color_number_id,d.size_number_id";*/
	$sql="SELECT b.gmts_item_id as item_number_id, c.id as po_id, d.size_number_id, d.color_number_id, sum(d.order_quantity) as order_quantity, sum(d.plan_cut_qnty) as plan_cut_qnty,min(d.color_order) as color_order,min(d.size_order) as size_order
	FROM wo_po_details_master a, wo_po_details_mas_set_details b , wo_po_break_down c, wo_po_color_size_breakdown d
	WHERE
	a.job_no = b.job_no and
	a.job_no = c.job_no_mst and
	a.job_no = d.job_no_mst and
	b.gmts_item_id=d.item_number_id and
    c.id = d.po_break_down_id and
	c.id in(".str_replace("'","",$txt_order_no_id).") and
	a.is_deleted =0 and
	a.status_active=1 and
	c.is_deleted =0 and
	c.status_active =1 and
	d.is_deleted =0 and
	d.status_active =1
	group by b.gmts_item_id, c.id, d.size_number_id, d.color_number_id, d.order_quantity, d.plan_cut_qnty order by color_order,size_order
	";
	$sql_data = sql_select($sql);
	foreach( $sql_data as $row)
	{
	$po_color_size_qnty_array[$row[csf('color_number_id')]][$row[csf('size_number_id')]][order_quantity]+=$row[csf('order_quantity')];
	$po_color_size_qnty_array[$row[csf('color_number_id')]][$row[csf('size_number_id')]][plan_cut_qnty]+=$row[csf('plan_cut_qnty')];
	$po_size_qnty_array[$row[csf('size_number_id')]]+=$row[csf('order_quantity')];
	$color_wise_row[$row[csf('color_number_id')]]+=1;
	}
	//print_r($color_wise_row);

    $nameArray_fabric_description= sql_select("select a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
WHERE a.job_no=b.job_no and
a.id=b.pre_cost_fabric_cost_dtls_id and
c.job_no_mst=a.job_no and
c.id=b.color_size_table_id and
b.po_break_down_id=d.po_break_down_id and
b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
d.booking_no =$txt_booking_no and

d.status_active=1 and
d.is_deleted=0
group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight order by a.body_part_id");


	 ?>

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
     <tr align="center">
     <th colspan="7" align="left">Body Part</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='4'>&nbsp</td>";
			else         		               echo "<td  colspan='4'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
		}
		?>
        <td  rowspan="7" width="50"><p>Total  Finish Fabric <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>


       </tr>
     <tr align="center"><th colspan="7" align="left">Color Type</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td colspan='4'>&nbsp</td>";
			else         		               echo "<td  colspan='4'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
		}
		?>

       </tr>
        <tr align="center"><th colspan="7" align="left">Fabric Construction</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='4'>&nbsp</td>";
			else         		               echo "<td  colspan='4'>".$result_fabric_description[csf('construction')]."</td>";
		}
		?>


       </tr>
        <tr align="center"><th   colspan="7" align="left">Fabric Composition</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('composition')] == "")   echo "<td  colspan='4'>&nbsp</td>";
			else         		               echo "<td  colspan='4'>".$result_fabric_description[csf('composition')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th  colspan="7" align="left">GSM</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='4'>&nbsp</td>";
			else         		       echo "<td  align='center' colspan='4'>". $result_fabric_description[csf('gsm_weight')]."</td>";
		}
		?>

       </tr>


       <tr>
       <th  colspan="<? echo  count($nameArray_fabric_description)*4+7; ?>" align="left" style="height:30px">&nbsp;</th>
       </tr>

       <tr>
            <th  width="50" align="left">Sl</th>
            <th  width="120" align="left">Gmt Color</th>
            <th  width="120" align="left">Gmt Size</th>
            <th  width="100" align="left">Article No</th>
            <th  width="120" align="left">Order Qty (Pcs)</th>
            <th  width="100" align="left">Excess Cut %</th>
            <th  width="120" align="left">Plan Cut Qty (Pcs)</th>

        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			  echo "<th width='50'>Fab.Color</th><th width='50'>Dia/Width</th><th width='50'>Cons/pcs</th><th width='50'>Finish</th>";
		}
		?>

       </tr>
       <?
	   $total_ord_cut_qnty=0;
	   $total_plan_cut_qnty=0;
	   //$total_plan_cut_qnty=0;
	   $grand_total_fin_fab_qnty=0;
	    $i=1;
	   foreach($color_wise_row as $key => $value)
	   {

		$color_total_ord_cut_qnty=0;
	    $color_total_plan_cut_qnty=0;
		$color_grand_total_fin_fab_qnty=0;
		$color_wise_wo_sql= sql_select("select c.color_number_id,c.article_number,c.size_number_id, sum(c.order_quantity) as order_quantity, sum(c.plan_cut_qnty) as plan_cut_qnty,
		min(c.color_order) as color_order,min(c.size_order) as size_order
		 FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
		WHERE a.job_no=b.job_no and
		a.id=b.pre_cost_fabric_cost_dtls_id and
		c.job_no_mst=a.job_no and
		c.id=b.color_size_table_id and
		b.po_break_down_id=d.po_break_down_id and
		b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
		d.booking_no =$txt_booking_no and
		c.color_number_id = $key and
		d.status_active=1 and
		d.is_deleted=0
		group by c.color_number_id,c.size_number_id,c.article_number order by color_order,size_order");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
		?>
			<tr>
            <td>
            <?
			echo $i;
			?>
            </td>
            <td>
            <?
			echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
			?>
            </td>
            <td>
            <?
			echo $size_library[$color_wise_wo_result[csf('size_number_id')]];
			?>
            </td>
             <td>
            <?
			 	echo $color_wise_wo_result[csf('article_number')];
			?>
            </td>
            <td align="right">
            <?
			$ord_cut_qty=$po_color_size_qnty_array[$color_wise_wo_result[csf('color_number_id')]][$color_wise_wo_result[csf('size_number_id')]][order_quantity];
			echo number_format($ord_cut_qty,2);
			$total_ord_cut_qnty+=$po_color_size_qnty_array[$color_wise_wo_result[csf('color_number_id')]][$color_wise_wo_result[csf('size_number_id')]][order_quantity];
			$color_total_ord_cut_qnty+=$po_color_size_qnty_array[$color_wise_wo_result[csf('color_number_id')]][$color_wise_wo_result[csf('size_number_id')]][order_quantity];
			?>
            </td>
            <td  width="100" align="right">
			<?
			$excess_per=(($po_color_size_qnty_array[$color_wise_wo_result[csf('color_number_id')]][$color_wise_wo_result[csf('size_number_id')]][plan_cut_qnty]-$ord_cut_qty)/$ord_cut_qty)*100;
			echo number_format($excess_per,2);
			?>
            </td>

            <td  width="120" align="right">
			<?
			$plan_cut_qty=$po_color_size_qnty_array[$color_wise_wo_result[csf('color_number_id')]][$color_wise_wo_result[csf('size_number_id')]][plan_cut_qnty];
			echo number_format($plan_cut_qty,2);
			$total_plan_cut_qnty+=$po_color_size_qnty_array[$color_wise_wo_result[csf('color_number_id')]][$color_wise_wo_result[csf('size_number_id')]][plan_cut_qnty];
			$color_total_plan_cut_qnty+=$po_color_size_qnty_array[$color_wise_wo_result[csf('color_number_id')]][$color_wise_wo_result[csf('size_number_id')]][plan_cut_qnty];
			//echo $color_wise_wo_result['plan_cut_qnty'];
			//$total_plan_cut_qnty+=$color_wise_wo_result['plan_cut_qnty'];
			?>
            </td>


            <?
			$total_fin_fab_qnty=0;
			$total_grey_fab_qnty=0;
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				$color_wise_wo_sql_qnty=sql_select("select sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty, min(a.width_dia_type) as width_dia_type, avg(b.cons) as cons ,min(b.dia_width) as dia_width , min(d.fabric_color_id) as fabric_color_id FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				c.color_number_id=".$color_wise_wo_result[csf('color_number_id')]." and
				c.size_number_id=".$color_wise_wo_result[csf('size_number_id')]." and
				d.status_active=1 and
				d.is_deleted=0
				");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
            <td width='50' align=''>
			<?
			if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			{
			echo $color_library[$color_wise_wo_result_qnty[csf('fabric_color_id')]] ;
			//$total_fin_fab_qnty+=$color_wise_wo_result_qnty['fin_fab_qnty'];
			}
			?>
            </td>
            <td width='50' align=''>
			<?
			if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			{
			echo $color_wise_wo_result_qnty[csf('dia_width')].",".$fabric_typee[$color_wise_wo_result_qnty[csf('width_dia_type')]] ;
			}
			?>
            </td>
            <td width='50' align='right'>
			<?
			if($color_wise_wo_result_qnty[Csf('fin_fab_qnty')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')]/$po_color_size_qnty_array[$color_wise_wo_result[csf('color_number_id')]][$color_wise_wo_result[csf('size_number_id')]][plan_cut_qnty],4);
			//echo $po_color_size_qnty_array[$color_wise_wo_result['color_number_id']][$color_wise_wo_result['size_number_id']][plan_cut_qnty];
			}
			?>
            </td>

			<td width='50' align='right'>

            <?
			if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],4);
			$total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('fin_fab_qnty')];
			}
			?>



            </td>

            <?
			}
			?>
             <td align="right">
			 <? echo number_format($total_fin_fab_qnty,4); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty; $color_grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?>
             </td>
            </tr>
         <?
		 $i++;
		}
		?>
        <tr style=" font-weight:bold; background-color:#CCC">

        <td  width="120" align="left" colspan="4"><strong>Color Total</strong></td>
         <td  width="120" align="right"><? echo $color_total_ord_cut_qnty; ?></td>
         <td  width="120" align="right">
		 <?
		 $color_excess_per_tot=(($color_total_plan_cut_qnty-$color_total_ord_cut_qnty)/$color_total_ord_cut_qnty)*100;
		 echo number_format($color_excess_per_tot,2);
		 ?></td>
        <td  width="120" align="right"><? echo $color_total_plan_cut_qnty; ?></td>

        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												c.color_number_id=".$color_wise_wo_result[csf('color_number_id')]." and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
            <td width='50' align='right'><?  //echo number_format($color_wise_wo_result_qnty['fin_fab_qnty'],4) ;?></td>
            <td width='50' align='right'><?  //echo number_format($color_wise_wo_result_qnty['fin_fab_qnty'],4) ;?></td>
            <td width='50' align='right'><?  //echo number_format($color_wise_wo_result_qnty['fin_fab_qnty'],4) ;?></td>
			<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],4) ;?></td>
            <?
			}
			?>
            <td align="right"><? echo number_format($color_grand_total_fin_fab_qnty,4);?></td>

            </tr>
        <?
	   }
		?>
        <tr style=" font-weight:bold">

        <td  width="120" align="left" colspan="4"><strong>Grand Total</strong></td>
         <td  width="120" align="right"><? echo $total_ord_cut_qnty; ?></td>
         <td  width="120" align="right">
		 <?
		 $excess_per_tot=(($total_plan_cut_qnty-$total_ord_cut_qnty)/$total_ord_cut_qnty)*100;
		 echo number_format($excess_per_tot,2);
		 ?></td>
        <td  width="120" align="right"><? echo $total_plan_cut_qnty; ?></td>

        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and

												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
            <td width='50' align='right'><?  //echo number_format($color_wise_wo_result_qnty['fin_fab_qnty'],4) ;?></td>
            <td width='50' align='right'><?  //echo number_format($color_wise_wo_result_qnty['fin_fab_qnty'],4) ;?></td>
            <td width='50' align='right'><?  //echo number_format($color_wise_wo_result_qnty['fin_fab_qnty'],4) ;?></td>
			<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],4) ;?></td>
            <?
			}
			?>
            <td align="right"><? echo number_format($grand_total_fin_fab_qnty,4);?></td>

            </tr>
    </table>
    <br/>
    <?
		$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
		?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
            <tr>
                <td width="49%" valign="top">
                <?
				if(count($sql_embelishment)>0)
				{
				?>
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td colspan="7"><b>Embelishment (Pre Cost)</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Embelishment Name</td>
                    <td>Embelishment Type</td>
                    <td>Cons <? echo $costing_per; ?> Gmts</td>
                    <td>Rate</td>
                    <td>Amount</td>

                    </tr>
                    <?
					$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
					$i=0;
					//$total_yarn=0;
					foreach($sql_embelishment  as $row_embelishment)
                    {

						$i++;
					?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
					<?
					echo $emblishment_name_array[$row_embelishment[csf('emb_name')]];
					?>
                    </td>
                    <td>
                    <?
					if($row_embelishment[csf('emb_name')]==1)
					{
					echo $emblishment_print_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==2)
					{
					echo $emblishment_embroy_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==3)
					{
					echo $emblishment_wash_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==4)
					{
					echo $emblishment_spwork_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==5)
					{
					echo $row_embelishment[csf('emb_type')];
					}
					?>

                    </td>
                    <td>
                    <?
					echo $row_embelishment[csf('cons_dzn_gmts')];
					?>
                    </td>
                    <td>
					<?
					echo $row_embelishment[csf('rate')];
					?>
                    </td>

                    <td>
					<?
					echo $row_embelishment[csf('amount')];
					?>
                    </td>


                    </tr>
                    <?
					}
					?>
                 <!--   <tr align="center">
                    <td>Total</td>
                    <td></td>
                    <td></td>
                    <td></td>

                    <td></td>

                    <td></td>

                    </tr>-->
                    </table>
                    <?
				}
					?>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top" align="center">
                <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td><b>Approved Instructions</b></td>

                    </tr>
                    <tr>
                    <td>
                <?  echo $nameArray_approved_comments_row[csf('comments')];  ?>
                </td>
                </tr>
                </table>

                </td>
            </tr>
            <tr>
              <td width="2%">&nbsp;
            </td>
            </tr>
            <br/>
            <tr>
            <td width="49%" valign="top" align="center">
            <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                	<thead>
                    	<tr>
                        	<th width="3%"></th><th width="97%" align="left"><u>Special Instruction</u></th>
                        </tr>
                    </thead>
                    <tbody>
                    <?
					$data_array=sql_select("select id, terms from  wo_booking_terms_condition where booking_no=$txt_booking_no");// quotation_id='$data'
					if ( count($data_array)>0)
					{
						$i=0;
						foreach( $data_array as $row )
						{
							$i++;
							?>
                            <tr id="settr_1" valign="top">
                                <td style="vertical-align:top">
                                <? echo $i;?>
                                </td>
                                <td>
                               <strong style="font-size:20px"> <? echo $row[csf('terms')]; ?></strong>
                                </td>
                            </tr>
                            <?
						}
					}
					/*else
					{
				    $i=0;
					$data_array=sql_select("select id, terms from  lib_terms_condition");// quotation_id='$data'
					foreach( $data_array as $row )
						{
							$i++;
					?>
                    <tr id="settr_1" align="">
                                    <td valign="top">
                                    <? echo $i;?>
                                    </td>
                                    <td>
                                    <? echo $row['terms']; ?>
                                    </td>

                                </tr>
                    <?
						}
					} */
					?>
                </tbody>
                </table>
            </td>
            </tr>
        </table>
        <br/>
         <!--<br><br><br><br>-->
         <?
		 	echo signature_table(1, $cbo_company_name, "1330px");
		 ?>
       </div>
       <?
}

if($action=="show_fabric_booking_report3")
{
	extract($_REQUEST);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	//$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$marchentrArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info ","id","team_member_name");
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$location_name_arr=return_library_array( "select id,location_name from lib_location",'id','location_name');
	$po_qnty_tot=return_field_value( "sum(plan_cut)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	$po_qnty_tot1=return_field_value( "sum(po_quantity)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");

	$po_number_arr=return_library_array( "select id,po_number from   wo_po_break_down",'id','po_number');
	$po_ship_date_arr=return_library_array( "select id,pub_shipment_date from   wo_po_break_down ",'id','pub_shipment_date');
	?>
	<div style="width:1330px" align="center">
    <?php
$nameArray_approved = sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7");
list($nameArray_approved_row) = $nameArray_approved;
$nameArray_approved_date = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
list($nameArray_approved_date_row) = $nameArray_approved_date;
$nameArray_approved_comments = sql_select("select b.comments as comments from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
list($nameArray_approved_comments_row) = $nameArray_approved_comments;
$path = str_replace("'", "", $path);
if ($path != "") {
	$path = $path;
} else {
	$path = "../../";
}

?>										<!--    Header Company Information         -->
       <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black" >
           <tr>
               <td width="100">
               <img  src='<? echo $path.$imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />

               </td>
               <td width="1250">
                    <table width="100%" cellpadding="0" cellspacing="0"  >
                        <tr>
                            <td align="center" style="font-size:20px;">
                              <?php
echo $company_library[$cbo_company_name];
?>
                            </td>
                            <td rowspan="3" width="250">

                                <!--<a href="requires/fabric_booking_controller.php?filename=welcome.html&action=download_file" style="text-transform:none">Download</a>-->
                               <span style="font-size:18px"><b> Job No:&nbsp;&nbsp;<? echo trim($txt_job_no,"'"); ?></b></span><br/>

                                <?
								 if($nameArray_approved_row[csf('approved_no')]>1)
								 {
								 ?>
								 <b> Revised No: <? echo $nameArray_approved_row[csf('approved_no')]-1; ?></b>
                                  <br/>
								  Approved Date: <? echo $nameArray_approved_date_row[csf('approved_date')]; ?>
								  <?
								 }
							  	?>


                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:14px">
                            <?
                           $nameArray=sql_select( "select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
							if($txt_job_no!="")
							{
							 $location=return_field_value( "location_name", "wo_po_details_master","job_no=$txt_job_no");
							}
							else
							{
							$location="";
							}
                            foreach ($nameArray as $result)
                            {
								echo $location_name_arr[$location];
                            ?>
                                <!--Plot No: <? //echo $result[csf('plot_no')]; ?>
                                Level No: <? //echo $result[csf('level_no')]?>
                                Road No: <? //echo $result[csf('road_no')]; ?>
                                Block No: <? //echo $result[csf('block_no')];?>
                                City No: <? //echo $result[csf('city')];?>
                                Zip Code: <? //echo $result[csf('zip_code')]; ?>
                                Province No: <?php //echo $result[csf('province')];?>
                                Country: <? //echo $country_arr[$result[csf('country_id')]]; ?>--> <br>
                                Email Address: <? echo $result[csf('email')];?>
                                Website No:   <? echo $result[csf('website')];



                            }
                            ?>
                               </td>
                            </tr>
                            <tr>
                            <td align="center" style="font-size:20px">
                                <strong><? echo $report_title;?> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style="color:#F00"><? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </font></strong>
                             </td>
                            </tr>
                      </table>
                </td>
            </tr>
       </table>
                <?
				$job_no='';
				$total_set_qnty=0;
				$colar_excess_percent=0;
				$cuff_excess_percent=0;
				$rmg_process_breakdown=0;
                $nameArray=sql_select( "select a.booking_no,a.booking_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.delivery_date,a.po_break_down_id,a.colar_excess_percent,a.cuff_excess_percent,a.delivery_date,a.is_apply_last_update,a.fabric_source,a.rmg_process_breakdown,a.insert_date,a.update_date,b.job_no,b.buyer_name, b.style_ref_no ,b.gmts_item_id,b.order_uom,b.total_set_qnty,b.style_description,b.product_dept,b.product_code,b.pro_sub_dep,b.dealing_marchant from wo_booking_mst a, wo_po_details_master b where  a.job_no=b.job_no and a.booking_no=$txt_booking_no");
				foreach ($nameArray as $result)
				{
					$total_set_qnty=$result[csf('total_set_qnty')];
					$colar_excess_percent=$result[csf('colar_excess_percent')];
				    $cuff_excess_percent=$result[csf('cuff_excess_percent')];
					$rmg_process_breakdown=$result[csf('rmg_process_breakdown')];
					$po_no="";
					$shipment_date="";
					$sql_po= "select po_number,MIN(pub_shipment_date) pub_shipment_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by po_number";
					$data_array_po=sql_select($sql_po);
					foreach ($data_array_po as $row_po)
					{
						$po_no.=$row_po[csf('po_number')].", ";
						$shipment_date.=change_date_format($row_po[csf('pub_shipment_date')],'dd-mm-yyyy','-').", ";
					}
					$lead_time=="";
					if($db_type==0)
					{
					$sql_lead_time= "select DATEDIFF(pub_shipment_date,po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}
					if($db_type==2)
					{
					$sql_lead_time= "select (pub_shipment_date-po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}

					$data_array_lead_time=sql_select($sql_lead_time);
					foreach ($data_array_lead_time as $row_lead_time)
					{
						$lead_time.=$row_lead_time[csf('date_diff')].",";
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}
					$po_received_date="";
					$sql_po_received_date= "select MIN(po_received_date) as po_received_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					$data_array_po_received_date=sql_select($sql_po_received_date);
					foreach ($data_array_po_received_date as $row_po_received_date)
					{
						$po_received_date=change_date_format($row_po_received_date[csf('po_received_date')],'dd-mm-yyyy','-');
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}
				?>
       <table width="100%" style="border:1px solid black" >
            <tr>
                <td colspan="6" valign="top" style="font-size:18px; color:#F00"><? if($result[csf('is_apply_last_update')]==2){echo "Booking Info not synchronized with order entry and pre-costing. order entry or pre-costing has updated after booking entry.  Contact to ".$marchentrArr[$result[csf('dealing_marchant')]]; } else{ echo "";} ?></td>
            </tr>
            <tr>
                <td width="100"><span style="font-size:18px"><b>Buyer/Agent Name</b></span></td>
                <td width="110">:&nbsp;<span style="font-size:18px"><b><? echo $buyer_name_arr[$result[csf('buyer_name')]]; ?></b></span></td>
                <td width="100"><span style="font-size:12px"><b>Dept.</b></span></td>
                <td width="110">:&nbsp;<? echo $product_dept[$result[csf('product_dept')]] ; if($result[csf('product_code')] !=""){ echo " (".$result[csf('product_code')].")";} if($result[csf('pro_sub_dep')] !=0){ echo " (".$pro_sub_dept_array[$result[csf('pro_sub_dep')]].")";}?></td>
                <td width="100"><span style="font-size:12px"><b>Order Qnty</b></span></td>
                <td width="110">:&nbsp;
				<?  echo $po_qnty_tot1." ".$unit_of_measurement[$result[csf('order_uom')]] ; ?>
                </td>
            </tr>
            <tr>

                <td width="100" style="font-size:12px"><b>Garments Item</b></td>
                <td width="110">:&nbsp;
				<?
				$gmts_item_name="";
				$gmts_item=explode(',',$result[csf('gmts_item_id')]);
				for($g=0;$g<=count($gmts_item); $g++)
				{
					$gmts_item_name.= $garments_item[$gmts_item[$g]].",";
				}
				echo rtrim($gmts_item_name,',');
				?>
                </td>
                <td width="100" style="font-size:12px"><b>Booking Release Date</b></td>
                <td width="110">:&nbsp;
				<?
				$booking_date=$result[csf('update_date')];
				if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
				{
					$booking_date=$result[csf('insert_date')];
				}
				echo change_date_format($booking_date,'dd-mm-yyyy','-','');
				?>&nbsp;&nbsp;&nbsp;</td>
                <td width="100" style="font-size:18px"><b>Style Ref.</b>   </td>
                <td width="110" style="font-size:18px">:&nbsp;<b><? echo $result[csf('style_ref_no')];?> </b>   </td>

            </tr>
             <tr>



                <td  width="100" style="font-size:12px"><b>Style Des.</b></td>
                <td  width="110" >:&nbsp;<? echo $result[csf('style_description')]; $job_no= $result[csf('job_no')];?></td>
                <td width="100" style="font-size:12px"><b>Lead Time </b>   </td>
                <td width="110">:&nbsp;<?  echo rtrim($lead_time,",");;?> </td>
                <td width="100" style="font-size:12px"><b>Dealing Merchant</b></td>
                <td width="110">:&nbsp;<? echo $marchentrArr[$result[csf('dealing_marchant')]]; ?></td>



            </tr>

            <tr>
                <td width="100" style="font-size:12px"><b>Supplier Name</b>   </td>
                <td width="110">:&nbsp;<? echo $supplier_name_arr[$result[csf('supplier_id')]];?>    </td>
                <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
               	<td width="110">:&nbsp;<? echo change_date_format( $result[csf('delivery_date')],'dd-mm-yyyy','-');?></td>
                <td width="100" style="font-size:18px"><b>Booking No </b>   </td>
                <td width="110" style="font-size:18px">:&nbsp;<b><? echo $result[csf('booking_no')];?></b><? echo "(".$fabric_source[$result[csf('fabric_source')]].")"?></td>



            </tr>
            <tr>
                <td width="100" style="font-size:12px"><b>Season</b></td>
                <td width="110">:&nbsp;<? echo $result[csf('season')]; ?></td>
                <td  width="100" style="font-size:12px"><b>Attention</b></td>
                <td  width="110" >:&nbsp;<? echo $result[csf('attention')]; ?></td>
                <td  width="100" style="font-size:12px"><b>Po Received Date</b></td>
                <td  width="110" >:&nbsp;<? echo $po_received_date; ?></td>



            </tr>
          <!-- <tr>
               <td width="100" style="font-size:18px"><b>Order No</b></td>
                <td width="110" style="font-size:18px" colspan="5">:&nbsp;<b><?// echo rtrim($po_no,", "); ?></b></td>

            </tr>
            <tr>
               <td width="100" style="font-size:12px"><b>Shipment Date</b></td>
                <td width="110" colspan="5"> :&nbsp;<? //echo rtrim($shipment_date,", "); ?></td>

            </tr> -->

        </table>
           <?
			}

			$nameArray_size=sql_select( "select distinct size_number_id from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  	is_deleted=0 and status_active=1 order by size_number_id");
			//$nameArray_color=sql_select( "select distinct color_number_id from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).")");
		   ?>
            <table width="100%" >
		    <tr>
            <td width="800">
                <div id="div_size_color_matrix" style="float:left; max-width:1000;">
            	<fieldset id="div_size_color_matrix" style="max-width:1000;">
 				<legend>Size and Color Breakdown                </legend>
 				<table  class="rpt_table"  border="1" align="left" cellpadding="0" width="750" cellspacing="0" rules="all" >
                    <tr>
                        <td style="border:1px solid black"><strong>PO Namber</strong></td>
                        <td style="border:1px solid black"><strong>Ship Date</strong></td>
                        <td style="border:1px solid black"><strong>Gmts Item</strong></td>
                        <td style="border:1px solid black"><strong>Color/Size</strong></td>
                    <?
						foreach($nameArray_size  as $result_size)
                        {	     ?>
                        <td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
                    <?	}    ?>
                        <td style="border:1px solid black; width:130px" align="center"><strong> Total Order Qty(Pcs)</strong></td>
                        <td style="border:1px solid black; width:80px" align="center"><strong> Excess %</strong></td>
                        <td style="border:1px solid black; width:130px" align="center"><strong> Total Plan Cut Qty(Pcs)</strong></td>
                    </tr>
                    <?
					$color_size_order_qnty_array=array();
					$color_size_qnty_array=array();
					$size_tatal=array();
					$size_tatal_order=array();
					$order_id=explode(",",str_replace("'","",$txt_order_no_id));
					for($or=0;$or<count($order_id); $or++)
				    {
					for($c=0;$c<count($gmts_item); $c++)
				    {
					$item_size_tatal=array();
					$item_size_tatal_order=array();
					$item_grand_total=0;
					$item_grand_total_order=0;
					$nameArray_color=sql_select( "select distinct color_number_id from wo_po_color_size_breakdown where  item_number_id=$gmts_item[$c] and po_break_down_id =$order_id[$or] and is_deleted=0 and status_active=1 order by color_number_id");
					?>
                   <!-- <tr>
                    <td style="border:1px solid black" colspan="<? echo count($nameArray_size)+3;?>"><strong><? echo $garments_item[$gmts_item[$c]];?></strong></td>

                    </tr>-->
                    <?
					foreach($nameArray_color as $result_color)
                    {
                    ?>
                    <tr>
                        <td align="center" style="border:1px solid black"><? echo $po_number_arr[$order_id[$or]]; // echo $row_num_tr; ?></td>
                         <td align="center" style="border:1px solid black"><? echo change_date_format($po_ship_date_arr[$order_id[$or]],"dd-mm-yyyy","-"); // echo $row_num_tr; ?></td>
                          <td align="center" style="border:1px solid black"><? echo $garments_item[$gmts_item[$c]]; // echo $row_num_tr; ?></td>
                        <td align="center" style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; // echo $row_num_tr; ?></td>
                        <?
						$color_total=0;
						$color_total_order=0;

						foreach($nameArray_size  as $result_size)
						{
						$nameArray_color_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id =$order_id[$or] and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$result_color[csf('color_number_id')]."  and item_number_id=$gmts_item[$c] and  status_active=1 and is_deleted =0");
						foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                        {

                        ?>
                            <td style="border:1px solid black; text-align:right">
							<?
								if($result_color_size_qnty[csf('plan_cut_qnty')]!= "")
								{
									 echo number_format($result_color_size_qnty[csf('order_quantity')],0);
									 $color_total += $result_color_size_qnty[csf('plan_cut_qnty')] ;
									 $color_total_order += $result_color_size_qnty[csf('order_quantity')] ;
									 $item_grand_total+=$result_color_size_qnty[csf('plan_cut_qnty')];
									 $item_grand_total_order+=$result_color_size_qnty[csf('order_quantity')];
								     $grand_total +=$result_color_size_qnty[csf('plan_cut_qnty')];
									 $grand_total_order +=$result_color_size_qnty[csf('order_quantity')];
									 $color_size_qnty_array[$result_size[csf('size_number_id')]][$result_color['color_number_id']]=$result_color_size_qnty[csf('plan_cut_qnty')];
									 $color_size_order_qnty_array[$result_size[csf('size_number_id')]][$result_color[csf('color_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
									 if (array_key_exists($result_size[csf('size_number_id')], $size_tatal))
									 {
											$size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
											$size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
									 }
									 else
									 {
										$size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
										$size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
									 }
									 if (array_key_exists($result_size[csf('size_number_id')], $item_size_tatal))
									 {
											$item_size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
											$item_size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
									 }
									 else
									 {
										$item_size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
										$item_size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
									 }
								}
								else echo "0";
							 ?>
							</td>

                    <?
						}
                        }
                        ?>
                        <td style="border:1px solid black; text-align:right"><? echo number_format(round($color_total_order),0); ?></td>
                         <td style="border:1px solid black; text-align:right"><? $excexss_per=($color_total-$color_total_order)/$color_total_order*100; echo number_format($excexss_per,2)." %"; ?></td>
                         <td style="border:1px solid black; text-align:right"><? echo number_format(round($color_total),0); ?></td>
                    </tr>
                    <?
                    }
					?>
                      <td align="center" style="border:1px solid black"><strong></strong></td>
                      <td align="center" style="border:1px solid black"><strong></strong></td>
                      <td align="center" style="border:1px solid black"><strong></strong></td>
                        <td align="center" style="border:1px solid black"><strong>Sub Total</strong></td>
                        <?
						foreach($nameArray_size  as $result_size)
                        {
                        ?>
                        <td style="border:1px solid black;  text-align:right"><? echo $item_size_tatal_order[$result_size[csf('size_number_id')]];  ?></td>
                        <?
                        }
                        ?>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($item_grand_total_order),0); ?></td>
                        <td  style="border:1px solid black;  text-align:right"><? $excess_item_gra_tot=($item_grand_total-$item_grand_total_order)/$item_grand_total_order*100; echo number_format($excess_item_gra_tot,2)." %"; ?></td>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($item_grand_total),0); ?></td>
                    </tr>
                    <?
					}
					}
                    ?>
                     <tr>
                        <td style="border:1px solid black" align="center" colspan="<? echo count($nameArray_size)+4; ?>"><strong>&nbsp;</strong></td>
                        </tr>
                    <tr>
                    <tr>
                    <td align="center" style="border:1px solid black"><strong></strong></td>
                    <td align="center" style="border:1px solid black"><strong></strong></td>
                    <td align="center" style="border:1px solid black"><strong></strong></td>
                        <td align="center" style="border:1px solid black"><strong>Grand Total</strong></td>
                        <?
						foreach($nameArray_size  as $result_size)
                        {
                        ?>
                        <td style="border:1px solid black;  text-align:right"><? echo $size_tatal_order[$result_size[csf('size_number_id')]];  ?></td>
                        <?
                        }
                        ?>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($grand_total_order),0); ?></td>
                        <td  style="border:1px solid black;  text-align:right"><? $excess_gra_tot= ($grand_total-$grand_total_order)/$grand_total_order*100; echo number_format($excess_gra_tot,2)." %"; ?></td>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($grand_total),0); ?></td>
                    </tr>
                </table>
                </fieldset>
                </div>
                </td>
                <td width="200" valign="top" align="left">
                <div id="div_size_color_matrix" style="float:left;">
            	<?
				$rmg_process_breakdown_arr=explode('_',$rmg_process_breakdown)
				?>
            	<fieldset id="" >
 				<legend>RMG Process Loss % </legend>
            	<table width="180" class="rpt_table" border="1" rules="all">
                <?
				if(number_format($rmg_process_breakdown_arr[8],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Cut Panel rejection <!-- Extra Cutting % breack Down 8-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[8],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[2],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Chest Printing <!-- Printing % breack Down 2-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[2],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[10],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Neck/Sleeve Printing <!-- New breack Down 10-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[10],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[1],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Embroidery   <!-- Embroidery  % breack Down 1-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[1],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[4],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Sewing /Input<!-- Sewing % breack Down 4-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[4],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[3],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Garments Wash <!-- Washing %breack Down 3-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[3],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[15],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Gmts Finishing <!-- Washing %breack Down 3-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[15],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[11],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Others <!-- New breack Down 11-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[11],2);
				?>
                </td>
                </tr>
                <?
                }
				$gmts_pro_sub_tot=$rmg_process_breakdown_arr[8]+$rmg_process_breakdown_arr[2]+$rmg_process_breakdown_arr[10]+$rmg_process_breakdown_arr[1]+$rmg_process_breakdown_arr[4]+$rmg_process_breakdown_arr[3]+$rmg_process_breakdown_arr[11]+$rmg_process_breakdown_arr[15];
				if($gmts_pro_sub_tot>0)
				{
				?>
                <tr>
                <td width="130">
                Sub Total <!-- New breack Down 11-->
                </td>
                <td align="right">
                <?

				echo number_format($gmts_pro_sub_tot,2);
				?>
                </td>
                </tr>
                <?
				}
				?>
                </table>
                </fieldset>


                <fieldset id="" >
 				<legend>Fabric Process Loss % </legend>
            	<table width="180" class="rpt_table" border="1" rules="all">
                 <?
				if(number_format($rmg_process_breakdown_arr[6],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Knitting  <!--  Knitting % breack Down 6-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[6],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[12],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Yarn Dyeing  <!--  New breack Down 12-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[12],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[5],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Dyeing & Finishing  <!-- Finishing % breack Down 5-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[5],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[13],2)>0)
				{
				?>
                <tr>
                <td width="130">
                All Over Print <!-- new  breack Down 13-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[13],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[14],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Lay Wash (Fabric) <!-- new  breack Down 14-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[14],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[7],2)>0)
				{
				?>
                 <tr>
                <td width="130">
                Dying   <!-- breack Down 7-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[7],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[0],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Cutting (Fabric) <!-- Cutting % breack Down 0-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[0],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[9],2)>0)
				{
				?>
                <tr>
                <td width="130">
               Others  <!-- Others% breack Down 9-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[9],2);
				?>
                </td>
                </tr>
                <?
				}
				$fab_proce_sub_tot=$rmg_process_breakdown_arr[6]+$rmg_process_breakdown_arr[12]+$rmg_process_breakdown_arr[5]+$rmg_process_breakdown_arr[13]+$rmg_process_breakdown_arr[14]+$rmg_process_breakdown_arr[7]+$rmg_process_breakdown_arr[0]+$rmg_process_breakdown_arr[9];
				if(fab_proce_sub_tot>0)
				{
				?>
                <tr>
                <td width="130">
                Sub Total  <!-- Others% breack Down 9-->
                </td>
                <td align="right">
                <?

				echo number_format($fab_proce_sub_tot,2);
				?>
                </td>
                </tr>
                <?
				}
				if($gmts_pro_sub_tot+$fab_proce_sub_tot>0)
				{
				?>
                 <tr>
                <td width="130">
                Grand Total  <!-- Others% breack Down 9-->
                </td>
                <td align="right">
                <?
				echo number_format($gmts_pro_sub_tot+$fab_proce_sub_tot,2);
				?>
                </td>
                </tr>
                <?
				}
				?>
           </table>
           </fieldset>
           </div>
                </td>
            <td width="330" valign="top" align="left">
            <?
			$nameArray_imge =sql_select("SELECT image_location FROM common_photo_library where master_tble_id='$job_no' and file_type=1");
			?>
            <div id="div_size_color_matrix" style="float:left;">
            	<fieldset id="" >
 				<legend>Image </legend>
            	<table width="310">
                <tr>
                <?
				$img_counter = 0;
                foreach($nameArray_imge as $result_imge)
				{

					?>
					<td>
						<img src="../../<? echo $result_imge[csf('image_location')]; ?>" width="90" height="100" border="2" />
					</td>
					<?

					$img_counter++;
				}
				?>
                </tr>
           </table>
           </fieldset>
           </div>
          </td>
        </tr>
       </table>
      <br/>   									 <!--  Here will be the main portion  -->
     <style>
	 .main_table tr th{
		 border:1px solid black;
		 font-size:13px;
		 outline: 0;
	 }
	  .main_table tr td{
		 border:1px solid black;
		 font-size:13px;
		 outline: 0;
	 }
	 </style>
     <?
	 $costing_per="";
	 $costing_per_qnty=0;
	 $costing_per_id=return_field_value( "costing_per", "wo_pre_cost_mst","job_no ='$job_no'");
	 if($costing_per_id==1)
			{
				$costing_per="1 Dzn";
				$costing_per_qnty=12;

			}
			if($costing_per_id==2)
			{
				$costing_per="1 Pcs";
				$costing_per_qnty=1;

			}
			if($costing_per_id==3)
			{
				$costing_per="2 Dzn";
				$costing_per_qnty=24;

			}
			if($costing_per_id==4)
			{
				$costing_per="3 Dzn";
				$costing_per_qnty=36;

			}
			if($costing_per_id==5)
			{
				$costing_per="4 Dzn";
				$costing_per_qnty=48;

			}
			$process_loss_method=return_field_value( "process_loss_method", "wo_pre_cost_fabric_cost_dtls","job_no='$job_no'");;

	 ?>

     <?

	/*$nameArray_fabric_description= sql_select("SELECT a.color_type_id,a.construction,a.composition,a.gsm_weight,a.dia_width,a.process_loss_percent FROM view_wo_fabric_booking_data_park a,wo_booking_dtls b where b.booking_no =$txt_booking_no and a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and b.status_active=1 and
b.is_deleted=0  group by a.color_type_id,a.construction,a.composition,a.gsm_weight,a.dia_width,process_loss_percent order by a.pre_cost_fabric_cost_dtls_id");*/

$nameArray_fabric_description= sql_select("select a.body_part_id,a.lib_yarn_count_deter_id as determin_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type, b.dia_width,avg(b.cons) as cons, avg(b.process_loss_percent) as process_loss_percent,avg(b.requirment) as  requirment FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
WHERE a.job_no=b.job_no and
a.id=b.pre_cost_fabric_cost_dtls_id and
c.job_no_mst=a.job_no and
c.id=b.color_size_table_id and
b.po_break_down_id=d.po_break_down_id and
b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
d.booking_no =$txt_booking_no and
d.status_active=1 and
d.is_deleted=0
group by a.body_part_id,a.lib_yarn_count_deter_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by a.body_part_id,b.dia_width");
	 ?>

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
     <tr align="center">
     <th colspan="5" align="left">Body Part</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
		}
		?>
        <td  rowspan="10" width="50"><p>Total  Finish Fabric <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
        <td  rowspan="10" width="50"><p>Total Grey Fabric <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
        <td  rowspan="10" width="50"><p>Process Loss % </p></td>
       </tr>
     <tr align="center"><th colspan="5" align="left">Color Type</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
		}
		?>
        <!--<td  rowspan="8" width="50"><p>Total  Finish Fabric (KG)</p></td> <td  rowspan="8" width="50"><p>Total Grey Fabric (KG)</p></td>-->
             <!--<td  rowspan="7" width="50"><p>Process Loss % </p></td>-->
       </tr>
        <tr align="center"><th colspan="5" align="left">Fabric Construction</th>
        <?

		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>". $result_fabric_description[csf('construction')]."</td>";
		}
		?>


       </tr>
        <tr align="center"><th   colspan="5" align="left">Fabric Composition</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='2' >&nbsp</td>";
			else         		               echo "<td colspan='2' >".$result_fabric_description[csf('composition')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th  colspan="5" align="left">GSM</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='2'>&nbsp</td>";
			else         		       echo "<td colspan='2' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th  colspan="5" align="left">Stitch Length</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			$determin_id=$result_fabric_description[csf('determin_id')];
			$s_length=return_field_value( "stitch_length", "fabric_mapping","mst_id=$determin_id");;
			if( $result_fabric_description[csf('determin_id')] == "")   echo "<td colspan='2'>&nbsp</td>";
			else         		       echo "<td colspan='2' align='center'>". $s_length."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="5" align="left">Dia/Width (Inch)</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='2'>&nbsp</td>";
			else         		              echo "<td colspan='2' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="5" align="left">Consumption For <? echo $costing_per; ?></th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('requirment')] == "")   echo "<td colspan='2'>&nbsp</td>";
			else         		              echo "<td colspan='2' align='center'> Fin: ".number_format($result_fabric_description[csf('cons')],2).", Grey: ".number_format($result_fabric_description[csf('requirment')],2)."</td>";
		}
		?>

       </tr>
       <tr>
       <th  colspan="<? echo  count($nameArray_fabric_description)*2+5; ?>" align="left" style="height:30px">&nbsp;</th>
       </tr>

       <tr>
            <th  width="120" align="left">PO Number</th>
            <th  width="120" align="left">Ship Date</th>
            <th  width="120" align="left">Fabric Color</th>
            <th  width="120" align="left">Body Color</th>
            <th  width="120" align="left">Lab Dip No</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			  echo "<th width='50'>Finish</th><th width='50' >Gray</th>";
		}
		?>

       </tr>
       <?

		  /*$gmt_color_library=return_library_array( "select gmts_color_id,contrast_color_id
		  FROM
		  wo_pre_cos_fab_co_color_dtls
		  WHERE
		  job_no ='$job_no'", "contrast_color_id", "gmts_color_id");*/
		  $gmt_color_library=array();
		  $gmt_color_data=sql_select("select gmts_color_id,contrast_color_id
		  FROM
		  wo_pre_cos_fab_co_color_dtls
		  WHERE
		  job_no ='$job_no'");
		  foreach( $gmt_color_data as $gmt_color_row)
		  {
			//$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
			$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];

		  }

	        $grand_total_fin_fab_qnty=0;
			$grand_total_grey_fab_qnty=0;
			$grand_totalcons_per_finish=0;
			$grand_totalcons_per_grey=0;
			$color_wise_wo_sql=sql_select("select fabric_color_id ,po_break_down_id
										  FROM
										  wo_booking_dtls
										  WHERE
										  booking_no =$txt_booking_no and
										  status_active=1 and
                                          is_deleted=0
										  group by po_break_down_id,fabric_color_id order by po_break_down_id");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
		?>
			<tr>
          <td  width="120" align="left">
			<?
			echo $po_number_arr[$color_wise_wo_result[csf('po_break_down_id')]];
			?></td>
             <td  width="120" align="left">
			<?

			echo change_date_format($po_ship_date_arr[$color_wise_wo_result[csf('po_break_down_id')]],"dd-mm-yyyy","-");

			?></td>
            <td  width="120" align="left">
			<?
			echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];


			?>
            </td>
            <td>
            <?
			//echo $color_library[$gmt_color_library[$color_wise_wo_result['fabric_color_id']]];
			//echo rtrim($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]],",");
			echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
			?>
            </td>
            <td  width="120" align="left">
			<?
			$lapdip_no="";
			$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
			//echo "lapdip_no from wo_po_lapdip_approval_info where job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result['fabric_color_id']."";
			if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_grey_fab_qnty=0;

			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
				  FROM
				  view_wo_fabric_booking_data_park a,
				  wo_booking_dtls b
				  WHERE
				  b.booking_no =$txt_booking_no  and
				  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
				  a.po_break_down_id=b.po_break_down_id and
				  a.color_size_table_id=b.color_size_table_id and
				  a.color_type_id='".$result_fabric_description['color_type_id']."' and
				  a.construction='".$result_fabric_description['construction']."' and
				  a.composition='".$result_fabric_description['composition']."' and
				  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
				  a.dia_width='".$result_fabric_description['dia_width']."' and
				  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
				  b.fabric_color_id=".$color_wise_wo_result['fabric_color_id']." and
				  b.status_active=1 and
				  b.is_deleted=0");*/
				if($db_type==0)
				{
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
				b.po_break_down_id=".$color_wise_wo_result[csf('po_break_down_id')]." and
				d.status_active=1 and
				d.is_deleted=0 and
				c.status_active=1 and
				c.is_deleted=0 and
				a.status_active=1 and
				a.is_deleted=0
				");
				}
				if($db_type==2)
				{
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
				b.po_break_down_id=".$color_wise_wo_result[csf('po_break_down_id')]." and
				d.status_active=1 and
				d.is_deleted=0 and
				c.status_active=1 and
				c.is_deleted=0 and
				a.status_active=1 and
				a.is_deleted=0
				");
				}
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'>
			<?
			if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;
			$total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('fin_fab_qnty')];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2);
			$total_grey_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
			}
			?>
            </td>
            <?
			}
			?>
            <td align="right"><? echo number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
            <td align="right"><? echo number_format($total_grey_fab_qnty,2); $grand_total_grey_fab_qnty+=$total_grey_fab_qnty;?></td>

            <td align="right">
            <?
			if($process_loss_method==1)
			{
				$process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_fin_fab_qnty)*100;
			}

			if($process_loss_method==2)
			{
				$process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_grey_fab_qnty)*100;
			}
			echo number_format($process_percent,2);

			?>
            </td>
            </tr>
         <?
		}
		?>
        <tr style=" font-weight:bold">
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left">&nbsp;</td>
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Total</strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0 and
												c.status_active=1 and
												c.is_deleted=0 and
												a.status_active=1 and
												a.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;?></td><td width='50' align='right' > <? echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2);?></td>
            <?
			}
			?>
            <td align="right"><? echo number_format($grand_total_fin_fab_qnty,2);?></td>
            <td align="right"><? echo number_format($grand_total_grey_fab_qnty,2);?></td>
            <td align="right">
            <?
            if($process_loss_method==1)// markup
			{
				$totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_fin_fab_qnty)*100;
			}

			if($process_loss_method==2) //margin
			{
				$totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_grey_fab_qnty)*100;
			}
			echo number_format($totalprocess_percent,2);
			?>
            </td>
            </tr>
            <tr style="font-weight:bold">
        <td  width="120" align="left">&nbsp;</td>
          <td  width="120" align="left">&nbsp;</td>
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0  and
												c.status_active=1 and
												c.is_deleted=0 and
												a.status_active=1 and
												a.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

			?>
			<td width='50' align='right'><?  //echo number_format(($color_wise_wo_result_qnty['fin_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td><td width='50' align='right' > <? // echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <?
			}
			?>
            <td align="right"><? echo number_format(($grand_total_fin_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4); $grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4)?></td>
            <td align="right"><? echo number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4);$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4)?></td>
            <td align="right">
            <?
            if($process_loss_method==1)
			{
				$totalprocess_percent_dzn=(($grand_total_grey_fab_qnty_dzn-$grand_total_fin_fab_qnty_dzn)/$grand_total_fin_fab_qnty_dzn)*100;
			}

			if($process_loss_method==2)
			{
				$totalprocess_percent_dzn=(($grand_total_grey_fab_qnty_dzn-$grand_total_fin_fab_qnty_dzn)/$grand_total_grey_fab_qnty_dzn)*100;
			}
			echo number_format($totalprocess_percent_dzn,2);
			?>
            </td>
            </tr>
    </table>

        <br/>


        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
        <tr>
        <?


		$nameArray_item_size=sql_select( "select min(c.id) as id,b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id  and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by id");
		if(count($nameArray_item_size)>0)
		{
        ?>
        <td width="49%">
        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
        <tr>
        <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Collar -  Colour Size Brakedown in Pcs</b></td>
        </tr>
        <tr>
        <td width="70">Size</td>

        <?

		/*$nameArray_item_size=sql_select( "select b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by c.size_number_id,b.item_size order by c.size_number_id");*/
		foreach($nameArray_item_size  as $result_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
		<?
        }
        ?>
        <td rowspan="2" align="center"><strong>Total</strong></td>
        <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
        </tr>
        <tr>
        <td>Collar Size</td>

        <?
        foreach($nameArray_item_size  as $result_item_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
		<?
        }
        ?>
         <?

			$color_wise_wo_sql=sql_select("select a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id,sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by c.color_number_id,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method order by a.id
");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
			$color_total_collar=0;
			$color_total_collar_order_qnty=0;
			$process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
			$constrast_color_arr=array();
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				$constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
				for($i=0;$i<count($constrast_color);$i++)
				{
					$constrast_color2=explode('_',$constrast_color[$i]);
					$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
				}
			}
		?>
			<tr>
            <td>
            <?
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]) ;
				$lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
			}
			else
			{
				echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
				$lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
			}
			?>

            </td>
            <?
            foreach($nameArray_item_size  as $result_size)
			{
				?>
				<td align="center" style="border:1px solid black">
				<?
				//$color_wise_wo_sql_qnty=sql_select("select c.color_number_id,sum(c.order_quantity) as order_quantity, sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 and c.color_number_id='".$color_wise_wo_result['color_number_id']."' and c.size_number_id='".$result_size['size_number_id']."'");
				$color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0");

				list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
				$colar_excess_per=def_number_format(($plan_cut_qnty[csf('plan_cut_qnty')]*$colar_excess_percent)/100,6,0);
				echo number_format($plan_cut_qnty[csf('plan_cut_qnty')]+$colar_excess_per,0);
				$color_total_collar+=$plan_cut_qnty[csf('plan_cut_qnty')]+$colar_excess_per;
				$color_total_collar_order_qnty+=$plan_cut_qnty[csf('order_quantity')];
				$grand_total_collar+=$plan_cut_qnty[csf('plan_cut_qnty')]+$colar_excess_per;
				$grand_total_collar_order_qnty+=$plan_cut_qnty[csf('order_quantity')];
				?>
                </td>
				<?
			}
			?>

            <td align="center"><? echo number_format($color_total_collar,0); ?></td>
            <td align="center"><? echo number_format((($color_total_collar-$color_total_collar_order_qnty)/$color_total_collar_order_qnty)*100,2); ?></td>
            </tr>
            <?
		    }
			?>
            <tr>
                <td>Size Total</td>

                <?
                foreach($nameArray_item_size  as $result_size)
                {
                ?>
                <td style="border:1px solid black;  text-align:center"><? $colar_excess_pers=($size_tatal[$result_size[csf('size_number_id')]]*$colar_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]+$colar_excess_pers,0); ?></td>
                <?
                }
                ?>
                <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_collar,0); ?></td>
                <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_collar-$grand_total_collar_order_qnty)/$grand_total_collar_order_qnty)*100,2); ?></td>
            </tr>
        </table>
        </td>
        <td width="2%">
        </td>
        <?
        }
		?>

        <?
		$nameArray_item_size=sql_select( "select min(c.id) as id, b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=3  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by id");

		if(count($nameArray_item_size)>0)
		{
        ?>
        <td width="49%">
        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
        <tr>
        <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Cuff -  Colour Size Brakedown in Pcs</b></td>
        </tr>
        <tr>
        <td width="70">Size</td>

        <?
		foreach($nameArray_item_size  as $result_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
		<?
        }
        ?>
        <td rowspan="2" align="center"><strong>Total</strong></td>
        <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
        </tr>
        <tr>
        <td>Cuff Size</td>

        <?
        foreach($nameArray_item_size  as $result_item_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
		<?
        }
        ?>
         <?

			$color_wise_wo_sql=sql_select("select a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id,sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=3  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and  d.status_active=1 and d.is_deleted=0 group by c.color_number_id ,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method order by a.id
");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
			$color_total_cuff=0;
			$color_total_cuff_order_qnty=0;
			$process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
			$constrast_color_arr=array();
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				$constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
				for($i=0;$i<count($constrast_color);$i++)
				{
					$constrast_color2=explode('_',$constrast_color[$i]);
					$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
				}
			}
		?>
			<tr>
            <td>
            <?
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				echo strtoupper ($constrast_color_arr[$color_wise_wo_result['color_number_id']]) ;
				$lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
			}
			else
			{
				echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
				$lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
			}
			?>

            </td>
            <?
            foreach($nameArray_item_size  as $result_size)
			{
				?>
				<td align="center" style="border:1px solid black">

				<?
				/*$color_wise_wo_sql_qnty=sql_select("select c.color_number_id,sum(c.order_quantity) as order_quantity, sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=3 and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 and c.color_number_id='".$color_wise_wo_result['color_number_id']."' and c.size_number_id='".$result_size['size_number_id']."'");*/
				$color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0");

				list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
				$cuff_excess_per=def_number_format((($plan_cut_qnty[csf('plan_cut_qnty')]*2)*$cuff_excess_percent)/100,6,"");
				echo number_format($plan_cut_qnty[csf('plan_cut_qnty')]*2+$cuff_excess_per,0);
				$color_total_cuff+=$plan_cut_qnty[csf('plan_cut_qnty')]*2+$cuff_excess_per;
				$color_total_cuff_order_qnty+=$plan_cut_qnty[csf('order_quantity')]*2;
				$grand_total_cuff+=$plan_cut_qnty[csf('plan_cut_qnty')]*2+$cuff_excess_per;
				$grand_total_cuff_order_qnty+=$plan_cut_qnty[csf('order_quantity')]*2;
				/*echo $color_size_qnty_array[$result_size[size_number_id]][$color_wise_wo_result[color_number_id]]*2;
				$color_total_cuff+=$color_size_qnty_array[$result_size[size_number_id]][$color_wise_wo_result[color_number_id]]*2;
				$color_total_cuff_order_qnty+=$color_size_order_qnty_array[$result_size[size_number_id]][$color_wise_wo_result[color_number_id]]*2;
				$grand_total_cuff+=$color_size_qnty_array[$result_size[size_number_id]][$color_wise_wo_result[color_number_id]]*2;
				$grand_total_cuff_order_qnty+=$color_size_order_qnty_array[$result_size[size_number_id]][$color_wise_wo_result[color_number_id]]*2;*/
				?>

                </td>
				<?
			}
			?>

            <td align="center"><? echo number_format($color_total_cuff,0); ?></td>
            <td align="center"><? echo number_format((($color_total_cuff-$color_total_cuff_order_qnty)/$color_total_cuff_order_qnty)*100,2); ?></td>
            </tr>
            <?
		    }
			?>
            <tr>
                <td>Size Total</td>

                <?
                foreach($nameArray_item_size  as $result_size)
                {
                   /* $nameArray_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =$result_size[size_number_id]  and status_active=1 and is_deleted =0 order by id");
                foreach($nameArray_size_qnty as $result_size_qnty)
                {*/
                ?>
                <td style="border:1px solid black;  text-align:center"><? $cuff_excess_pers=(($size_tatal[$result_size[csf('size_number_id')]]*2)*$cuff_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]*2+$cuff_excess_pers,0); ?></td>
                <?
                //}
                }
                ?>
                <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_cuff,0); ?></td>
                <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_cuff-$grand_total_cuff_order_qnty)/$grand_total_cuff_order_qnty)*100,2); ?></td>
            </tr>
        </table>
        </td>
        <?
				}
		?>
        </tr>
        </table>
        <br/>
        <?
		$yarn_count_arr=return_library_array( "select id,yarn_count from lib_yarn_count",'id','yarn_count');
		$yarn_sql_array=sql_select("SELECT min(id) as id ,count_id, copm_one_id, percent_one,copm_two_id, percent_two, color,type_id, sum(cons_qnty) as yarn_required, AVG(rate) as rate from wo_pre_cost_fab_yarn_cost_dtls where job_no='$job_no' and  status_active=1 and is_deleted=0 group by count_id,copm_one_id,percent_one, copm_two_id,percent_two,color,type_id order by id");
		?>
        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" >
            <tr>
                <td width="49%" valign="top">
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td colspan="7"><b>Yarn Required Summary (Pre Cost)</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Yarn Description</td>
                    <td>Brand</td>
                    <td>Lot</td>
                    <?
					if($show_yarn_rate==1)
					{
					?>
                    <td>Rate</td>
                    <?
					}
					?>
                    <td>Cons for <? echo $costing_per; ?> Gmts</td>
                    <td>Total (KG)</td>
                    </tr>
                    <?
					$i=0;
					$total_yarn=0;
					foreach($yarn_sql_array  as $row)
                    {

						$i++;
					?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
					<?
					$yarn_des=$yarn_count_arr[$row[csf('count_id')]]." ".$composition[$row[csf('copm_one_id')]]." ".$row[csf('percent_one')]."%  ";
					if($row['copm_two_id'] !=0)
					{
						$yarn_des.=$composition[$row[csf('copm_two_id')]]." ".$row[csf('percent_two')]."%";
					}
					$yarn_des.=$color_library[$row[csf('color')]]." ";
					$yarn_des.=$yarn_type[$row[csf('type_id')]];
					//echo $yarn_count_arr[$row['count_id']]." ".$composition[$row['copm_one_id']]." ".$row['percent_one']."%  ".$composition[$row['copm_two_id']]." ".$row['percent_two']."%  ".$yarn_type[$row['type_id']];
					echo $yarn_des;
					?>
                    </td>
                    <td></td>
                    <td></td>
                    <?
					if($show_yarn_rate==1)
					{
					?>
                     <td><? echo number_format($row[csf('rate')],4); ?></td>
                     <?
					}
					 ?>
                    <td><? echo number_format($row[csf('yarn_required')],4); ?></td>

                    <!--<td><? //echo number_format(($row['yarn_required']/$po_qnty_tot)*$costing_per_qnty,2); ?></td>-->
                    <td align="right"><? //echo number_format($row['yarn_required'],2); $total_yarn+=$row['yarn_required']; ?></td>
                    </tr>
                    <?
					}
					?>
                    <tr align="center">
                    <td>Total</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <?
					if($show_yarn_rate==1)
					{
					?>
                    <td></td>
                    <?
                    }
					?>
                    <td></td>
                    <td align="right"><? //echo number_format($total_yarn,2); ?></td>
                    </tr>
                    </table>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top" align="center">
                <?
				$yarn_sql_array=sql_select("SELECT min(a.id) as id, a.item_id, sum(a.qnty) as qnty ,min(b.supplier_id) as supplier_id,min(b.lot) as lot from inv_material_allocation_dtls a,product_details_master b where a.item_id=b.id and a.booking_no=$txt_booking_no and  a.status_active=1 and a.is_deleted=0 group by a.item_id order by a.id");
				if(count($yarn_sql_array)>0)
				{
				?>
                   <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td colspan="7"><b>Allocated Yarn</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Yarn Description</td>
                    <td>Brand</td>
                    <td>Lot</td>


                    <td>Allocated Qty (Kg)</td>
                    </tr>
                    <?
					$total_allo=0;
					$item=return_library_array( "select id, product_name_details from   product_details_master",'id','product_name_details');
					$supplier=return_library_array( "select id, short_name from   lib_supplier",'id','short_name');
					//$yarn_sql_array=sql_select("SELECT a.item_id, a.qnty,b.supplier_id,b.lot from inv_material_allocation_dtls a,product_details_master b where a.item_id=b.id and a.booking_no=$txt_booking_no and  a.status_active=1 and a.is_deleted=0");
					$i=0;
					$total_yarn=0;
					foreach($yarn_sql_array  as $row)
                    {

						$i++;
					?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
					<?

					echo $item[$row[csf('item_id')]];
					?>
                    </td>
                    <td>
                    <?

					echo $supplier[$row[csf('supplier_id')]];
					?>
                    </td>
                    <td>
					<?

					echo $row[csf('lot')];
					?>
                    </td>
                    <td align="right"><? echo number_format($row[csf('qnty')],4); $total_allo+= $row[csf('qnty')];?></td>
                    </tr>
                    <?
					}
					?>
                    <tr align="center">
                    <td>Total</td>
                    <td></td>


                    <td></td>
                    <td></td>
                    <td align="right"><? echo number_format($total_allo,4); ?></td>
                    </tr>
                    </table>
                    <?
				}
				else
				{
					$is_yarn_allocated=return_field_value("allocation", "variable_settings_inventory", "company_name=$cbo_company_name and variable_list=18 and item_category_id=1");
					if($is_yarn_allocated==1)
					{
					?>
					<font style=" font-size:30px"><b> Draft</b></font>
                    <?
					}
					else
					{
						echo "";
					}
				}
					?>
                </td>
            </tr>
        </table>
        <br/>
        <?
		$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
		?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
            <tr>
                <td width="49%" valign="top">
                <?
				if(count($sql_embelishment)>0)
				{
				?>
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td colspan="7"><b>Embelishment (Pre Cost)</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Embelishment Name</td>
                    <td>Embelishment Type</td>
                    <td>Cons <? echo $costing_per; ?> Gmts</td>
                    <td>Rate</td>
                    <td>Amount</td>

                    </tr>
                    <?
					$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
					$i=0;
					//$total_yarn=0;
					foreach($sql_embelishment  as $row_embelishment)
                    {

						$i++;
					?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
					<?
					echo $emblishment_name_array[$row_embelishment[csf('emb_name')]];
					?>
                    </td>
                    <td>
                    <?
					if($row_embelishment[csf('emb_name')]==1)
					{
					echo $emblishment_print_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==2)
					{
					echo $emblishment_embroy_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==3)
					{
					echo $emblishment_wash_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==4)
					{
					echo $emblishment_spwork_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==5)
					{
					echo $row_embelishment[csf('emb_type')];
					}
					?>

                    </td>
                    <td>
                    <?
					echo $row_embelishment[csf('cons_dzn_gmts')];
					?>
                    </td>
                    <td>
					<?
					echo $row_embelishment[csf('rate')];
					?>
                    </td>

                    <td>
					<?
					echo $row_embelishment[csf('amount')];
					?>
                    </td>


                    </tr>
                    <?
					}
					?>
                 <!--   <tr align="center">
                    <td>Total</td>
                    <td></td>
                    <td></td>
                    <td></td>

                    <td></td>

                    <td></td>

                    </tr>-->
                    </table>
                    <?
				}
					?>
                </td>
                <td width="2%">

                </td>
                <td width="49%" valign="top" align="center">
                <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td><b>Approved Instructions</b></td>

                    </tr>
                    <tr>
                    <td>
                <?  echo $nameArray_approved_comments_row[csf('comments')];  ?>
                </td>
                </tr>
                </table>

                </td>
            </tr>
        </table>
        <br/>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td width="49%" style="border:solid; border-color:#000; border-width:thin" valign="top">
                    <table  width="100%"  border="0" cellpadding="0" cellspacing="0">
                	<thead>
                    	<tr>
                        	<th width="3%"></th><th width="97%" align="left"><u>Special Instruction</u></th>
                        </tr>
                    </thead>
                    <tbody>
                    <?
					$data_array=sql_select("select id, terms from  wo_booking_terms_condition where booking_no=$txt_booking_no");// quotation_id='$data'
					if ( count($data_array)>0)
					{
						$i=0;
						foreach( $data_array as $row )
						{
							$i++;
							?>
                            	<tr id="settr_1" valign="top">
                                    <td style="vertical-align:top">
                                    <? echo $i;?>
                                    </td>
                                    <td>
                                   <strong style="font-size:20px"> <? echo $row[csf('terms')]; ?></strong>
                                    </td>
                                </tr>
                            <?
						}
					}
					/*else
					{
				    $i=0;
					$data_array=sql_select("select id, terms from  lib_terms_condition");// quotation_id='$data'
					foreach( $data_array as $row )
						{
							$i++;
					?>
                    <tr id="settr_1" align="">
                                    <td valign="top">
                                    <? echo $i;?>
                                    </td>
                                    <td>
                                    <? echo $row['terms']; ?>
                                    </td>

                                </tr>
                    <?
						}
					} */
					?>
                </tbody>
                </table>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top">
                   <table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                   <tr align="center">
                    <td colspan="10"><b>Comments</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Po NO</td>
                    <td>Ship Date</td>
                    <td>Pre-Cost Qty</td>
                    <td>Mn.Book Qty</td>
                    <td>Sht.Book Qty</td>
                    <td>Smp.Book Qty</td>
                    <td>Tot.Book Qty</td>
                    <td>Balance</td>
                    <td>Comments</td>
                    </tr>
                    <?
	$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
	$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
	if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
	if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
	$paln_cut_qnty_array=return_library_array( "select min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id,size_number_id,item_number_id,po_break_down_id", "id", "plan_cut_qnty");

	$item_ratio_array=return_library_array( "select gmts_item_id,set_item_ratio from wo_po_details_mas_set_details  where job_no =$txt_job_no", "gmts_item_id", "set_item_ratio");
	$nameArray=sql_select("
	select
	a.id,
	a.item_number_id,
	a.costing_per,
	b.po_break_down_id,
	b.color_size_table_id,
	b.requirment,
	c.po_number
FROM
	wo_pre_cost_fabric_cost_dtls a,
	wo_pre_cos_fab_co_avg_con_dtls b,
	wo_po_break_down c
WHERE
	a.job_no=b.job_no and
	a.job_no=c.job_no_mst and
    a.id=b.pre_cost_fabric_cost_dtls_id and
	b.po_break_down_id=c.id and
	b.po_break_down_id in (".str_replace("'","",$txt_order_no_id).")  $cbo_fabric_natu $cbo_fabric_source_cond and a.status_active=1 and a.is_deleted=0
	order by id");
	$count=0;
	$tot_grey_req_as_pre_cost_arr=array();
	foreach ($nameArray as $result)
	{
		if (count($nameArray)>0 )
		{
            if($result[csf("costing_per")]==1)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(12*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			if($result[csf("costing_per")]==2)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(1*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			if($result[csf("costing_per")]==3)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(24*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			if($result[csf("costing_per")]==4)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(36*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			if($result[csf("costing_per")]==5)
			{
				$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(48*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
			}
			$tot_grey_req_as_pre_cost_arr[$result[csf("po_number")]]+=$tot_grey_req_as_pre_cost;
        }
    }
	                $total_pre_cost=0;
					$total_booking_qnty_main=0;
					$total_booking_qnty_short=0;
					$total_booking_qnty_sample=0;
					$total_tot_bok_qty=0;
					$tot_balance=0;
					/*$booking_qnty=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and booking_type in(1,4)  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by a.po_break_down_id", "po_break_down_id", "grey_fab_qnty");*/

					//$booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and booking_type =1 and is_short=2 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

					$booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and a.is_short=2 and c.item_category=2 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

					$booking_qnty_short=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and c.item_category=2 and a.is_short=1 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
					$booking_qnty_sample=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c  where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =4 and c.fabric_source=$cbo_fabric_source and c.item_category=2  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

					$sql_data=sql_select( "select max(a.id) as id,  a.po_number,max(a.pub_shipment_date) as pub_shipment_date,sum(a.plan_cut) as plan_cut  from wo_po_break_down a,wo_pre_cost_sum_dtls b,wo_pre_cost_mst c where a.job_no_mst=b.job_no and a.job_no_mst=c.job_no and a.id in(".str_replace("'","",$txt_order_no_id).") group by a.po_number order by id");
					foreach($sql_data  as $row)
                    {
					$col++;
					?>
                    <tr align="center">
                    <td><? echo $col; ?></td>
                    <td><? echo $row[csf("po_number")]; ?></td>
                     <td><? echo change_date_format($row[csf("pub_shipment_date")],"dd-mm-yyyy",'-'); ?></td>
                    <td align="right"><? echo number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]],2); $total_pre_cost+=$tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]; ?></td>
                    <td align="right"><? echo number_format($booking_qnty_main[$row[csf("id")]],2); $total_booking_qnty_main+=$booking_qnty_main[$row[csf("id")]];?></td>
                    <td align="right"><? echo number_format($booking_qnty_short[$row[csf("id")]],2); $total_booking_qnty_short+=$booking_qnty_short[$row[csf("id")]];?></td>
                    <td align="right"><? echo number_format($booking_qnty_sample[$row[csf("id")]],2); $total_booking_qnty_sample+=$booking_qnty_sample[$row[csf("id")]];?></td>
                    <td align="right"><? $tot_bok_qty=$booking_qnty_main[$row[csf("id")]]+$booking_qnty_short[$row[csf("id")]]+$booking_qnty_sample[$row[csf("id")]]; echo number_format($tot_bok_qty,2); $total_tot_bok_qty+=$tot_bok_qty;?></td>
                    <td align="right">
					<? $balance= def_number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]-$tot_bok_qty,2,""); echo number_format($balance,2); $tot_balance+= $balance?>
                    </td>
                    <td>
					<?
					if( $balance>0)
					{
						echo "Less Booking";
					}
					else if ($balance<0)
					{
						echo "Over Booking";
					}
					else
					{
						echo "";
					}
					?>
                    </td>
                    </tr>
                    <?
					}
					?>
                    <tfoot>

                    <tr>
                    <td colspan="3">Total:</td>

                    <td align="right"><? echo number_format($total_pre_cost,2); ?></td>
                    <td align="right"><? echo number_format($total_booking_qnty_main,2); ?></td>
                    <td align="right"><? echo number_format($total_booking_qnty_short,2); ?></td>
                    <td align="right"><? echo number_format($total_booking_qnty_sample,2); ?></td>
                     <td align="right"><? echo number_format($total_tot_bok_qty,2); ?></td>
                    <td align="right"><? echo number_format($tot_balance,2); ?></td>
                    <td></td>
                    </tr>
                    </tfoot>
                    </table>
                </td>

            </tr>
        </table>

         <!--<br><br><br><br>-->
         <?
		 	echo signature_table(1, $cbo_company_name, "1330px");
		 ?>

       </div>
       <?

}


if($action=="show_fabric_booking_report4")
{
	extract($_REQUEST);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
	$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
	if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
	if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	//$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$marchentrArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info ","id","team_member_name");
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$location_name_arr=return_library_array( "select id,location_name from lib_location",'id','location_name');
	$po_qnty_tot=return_field_value( "sum(plan_cut)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	$po_qnty_tot1=return_field_value( "sum(po_quantity)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");

	$po_number_arr=return_library_array( "select id,po_number from   wo_po_break_down",'id','po_number');
	$po_ship_date_arr=return_library_array( "select id,pub_shipment_date from   wo_po_break_down ",'id','pub_shipment_date');
	$user_arr=return_library_array( "select id,user_name from   user_passwd ",'id','user_name');

	?>
	<div style="width:1330px" align="left">
    	<?php
$nameArray_approved = sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7");
list($nameArray_approved_row) = $nameArray_approved;
$nameArray_approved_date = sql_select("select b.approved_date as approved_date,approved_by from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
list($nameArray_approved_date_row) = $nameArray_approved_date;

$path = str_replace("'", "", $path);
//if($path!="") $path=$path; else $path="../../";
if ($path == "") {
	$path = '../../';
}
?>									<!--    Header Company Information         -->
       <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black" >
           <tr>
               <td width="100">
               <img  src='<? echo $path.$imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
               </td>
               <td width="1250">
                    <table width="100%" cellpadding="0" cellspacing="0"  >
                        <tr>
                            <td align="center" style="font-size:20px;">
                              <?php
echo $company_library[$cbo_company_name];
?>
                            </td>
                            <td rowspan="3" width="250">
                               <span style="font-size:18px"><b> Job No:&nbsp;&nbsp;<? echo trim($txt_job_no,"'"); ?></b></span>
                               <?
								 if($nameArray_approved_row[csf('approved_no')]>1)
								 {
								 ?>
								 <b> Revised No: <? echo $nameArray_approved_row[csf('approved_no')]-1; ?></b>
                                  <br/>
								  Approved Date: <? echo $nameArray_approved_date_row[csf('approved_date')]; ?>


								  <?
								 }
							  	?>
                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:14px">
                            <?
                          $nameArray=sql_select( "select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
						   if($txt_job_no!="")
							{
							 $location=return_field_value( "location_name", "wo_po_details_master","job_no=$txt_job_no");
							}
							else
							{
							$location="";
							}


                            foreach ($nameArray as $result)
                            {
								echo $location_name_arr[$location];

                            ?>
                               <!-- Plot No: <? //echo $result[csf('plot_no')]; ?>
                                Level No: <? //echo $result[csf('level_no')]?>
                                Road No: <? //echo $result[csf('road_no')]; ?>
                                Block No: <? //echo $result[csf('block_no')];?>
                                City No: <? //echo $result[csf('city')];?>
                                Zip Code: <? //echo $result[csf('zip_code')]; ?>
                                Province No: <?php //echo $result[csf('province')];?>
                                Country: <? //echo $country_arr[$result[csf('country_id')]]; ?>--> <br>
                                Email Address: <? echo $result[csf('email')];?>
                                Website No:<? echo $result[csf('website')];

                            }
                            ?>
                               </td>
                            </tr>
                            <tr>
                            <td align="center" style="font-size:20px">
                                <strong><? echo $report_title;?> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style="color:#F00"><? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </font></strong>
                             </td>
                            </tr>
                      </table>
                </td>
            </tr>
       </table>
                <?
				$job_no='';
				$total_set_qnty=0;
				$colar_excess_percent=0;
				$cuff_excess_percent=0;
				$rmg_process_breakdown=0;
				$style_ref_no="";
				$inserted_by="";
				$currency_id="";
                $nameArray=sql_select( "select a.booking_no,a.booking_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.delivery_date,a.po_break_down_id,a.colar_excess_percent,a.cuff_excess_percent,a.delivery_date,a.is_apply_last_update,a.fabric_source,a.currency_id,a.rmg_process_breakdown,a.insert_date,a.inserted_by,a.update_date,b.job_no,b.buyer_name, b.style_ref_no ,b.gmts_item_id,b.order_uom,b.total_set_qnty,b.style_description,b.product_dept,b.product_code,b.pro_sub_dep,b.dealing_marchant,b.quotation_id from wo_booking_mst a, wo_po_details_master b where  a.job_no=b.job_no and a.booking_no=$txt_booking_no");

				$po_id_all=$nameArray[0][csf('po_break_down_id')];


				$po_num_arr=return_library_array("select id,po_number from wo_po_break_down where id in($po_id_all)",'id','po_number');
				$tna_start_sql=sql_select( "select id,po_number_id,
								(case when task_number=31 then task_start_date else null end) as fab_booking_start_date,
								(case when task_number=31 then task_finish_date else null end) as fab_booking_end_date,
								(case when task_number=60 then task_start_date else null end) as knitting_start_date,
								(case when task_number=60 then task_finish_date else null end) as knitting_end_date,
								(case when task_number=61 then task_start_date else null end) as dying_start_date,
								(case when task_number=61 then task_finish_date else null end) as dying_end_date,
								(case when task_number=73 then task_start_date else null end) as finishing_start_date,
								(case when task_number=73 then task_finish_date else null end) as finishing_end_date,
								(case when task_number=84 then task_start_date else null end) as cutting_start_date,
								(case when task_number=84 then task_finish_date else null end) as cutting_end_date,
								(case when task_number=86 then task_start_date else null end) as sewing_start_date,
								(case when task_number=86 then task_finish_date else null end) as sewing_end_date,
								(case when task_number=110 then task_start_date else null end) as exfact_start_date,
								(case when task_number=110 then task_finish_date else null end) as exfact_end_date,
								(case when task_number=47 then task_start_date else null end) as yarn_rec_start_date,
								(case when task_number=47 then task_finish_date else null end) as yarn_rec_end_date
								from tna_process_mst
								where status_active=1 and po_number_id in($po_id_all)");
				$tna_fab_start=$tna_knit_start=$tna_dyeing_start=$tna_fin_start=$tna_cut_start=$tna_sewin_start=$tna_exfact_start="";
				$tna_date_task_arr=array();
				foreach($tna_start_sql as $row)
				{
					if($row[csf("fab_booking_start_date")]!="" && $row[csf("fab_booking_start_date")]!="0000-00-00")
					{
						if($tna_fab_start=="")
						{
							$tna_fab_start=$row[csf("fab_booking_start_date")];
						}
					}


					if($row[csf("knitting_start_date")]!="" && $row[csf("knitting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_start_date']=$row[csf("knitting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_end_date']=$row[csf("knitting_end_date")];
					}
					if($row[csf("dying_start_date")]!="" && $row[csf("dying_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['dying_start_date']=$row[csf("dying_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['dying_end_date']=$row[csf("dying_end_date")];
					}
					if($row[csf("finishing_start_date")]!="" && $row[csf("finishing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_start_date']=$row[csf("finishing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_end_date']=$row[csf("finishing_end_date")];
					}
					if($row[csf("cutting_start_date")]!="" && $row[csf("cutting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_start_date']=$row[csf("cutting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_end_date']=$row[csf("cutting_end_date")];
					}
					if($row[csf("sewing_start_date")]!="" && $row[csf("sewing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_start_date']=$row[csf("sewing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_end_date']=$row[csf("sewing_end_date")];
					}
					if($row[csf("exfact_start_date")]!="" && $row[csf("exfact_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_start_date']=$row[csf("exfact_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_end_date']=$row[csf("exfact_end_date")];
					}
					if($row[csf("yarn_rec_start_date")]!="" && $row[csf("yarn_rec_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_start_date']=$row[csf("yarn_rec_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_end_date']=$row[csf("yarn_rec_end_date")];
					}
				}

				foreach ($nameArray as $result)
				{
					$total_set_qnty=$result[csf('total_set_qnty')];
					$colar_excess_percent=$result[csf('colar_excess_percent')];
				    $cuff_excess_percent=$result[csf('cuff_excess_percent')];
					$rmg_process_breakdown=$result[csf('rmg_process_breakdown')];
					$inserted_by=$result[csf('inserted_by')];
					$currency_id=$result[csf('currency_id')];
					$po_no="";
					$shipment_date="";
					$sql_po= "select po_number,MIN(pub_shipment_date) pub_shipment_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by po_number";
					$data_array_po=sql_select($sql_po);
					foreach ($data_array_po as $row_po)
					{
						$po_no.=$row_po[csf('po_number')].", ";
						$shipment_date.=change_date_format($row_po[csf('pub_shipment_date')],'dd-mm-yyyy','-').", ";
					}
					$lead_time=="";
					if($db_type==0)
					{
					$sql_lead_time= "select DATEDIFF(pub_shipment_date,po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}
					if($db_type==2)
					{
					$sql_lead_time= "select (pub_shipment_date-po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}

					$data_array_lead_time=sql_select($sql_lead_time);
					foreach ($data_array_lead_time as $row_lead_time)
					{
						$lead_time.=$row_lead_time[csf('date_diff')].",";
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}
					$po_received_date="";
					$sql_po_received_date= "select MIN(po_received_date) as po_received_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					$data_array_po_received_date=sql_select($sql_po_received_date);
					foreach ($data_array_po_received_date as $row_po_received_date)
					{
						$po_received_date=change_date_format($row_po_received_date[csf('po_received_date')],'dd-mm-yyyy','-');
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}


					if($db_type==2)
					{
						$group_concat_all=" listagg(cast(b.grouping as varchar2(4000)),',') within group (order by b.grouping) as grouping,
	                                   		listagg(cast(b.file_no as varchar2(4000)),',') within group (order by b.file_no) as file_no  ";
					}
					else
					{
						$group_concat_all="group_concat(b.grouping) as grouping, group_concat(b.file_no) as file_no";
					}
				$data_array3=sql_select("select a.job_no,a.company_name,a.buyer_name,$group_concat_all from wo_po_details_master a, wo_po_break_down b where b.id in (".$result[csf('po_break_down_id')].") and a.job_no=b.job_no_mst group by a.job_no,a.company_name,a.buyer_name");

				   $quot_date="";
					$sql_quot= "select quot_date from  wo_price_quotation  where id ='".$result[csf('quotation_id')]."'";
					$data_array_quot=sql_select($sql_quot);
					foreach ($data_array_quot as $row_quot){
						$quot_date=change_date_format($row_quot[csf('quot_date')],'dd-mm-yyyy','-');
					}
				?>
       <table width="100%" style="border:1px solid black" >
            <tr>
                <td colspan="6" valign="top" style="font-size:18px; color:#F00"><? if($result[csf('is_apply_last_update')]==2){echo "Booking Info not synchronized with order entry and pre-costing. order entry or pre-costing has updated after booking entry.  Contact to ".$marchentrArr[$result[csf('dealing_marchant')]]; } else{ echo "";} ?></td>
            </tr>
            <tr>
                <td width="100"><span style="font-size:18px"><b>Buyer/Agent Name</b></span></td>
                <td width="110">:&nbsp;<span style="font-size:18px"><b><? echo $buyer_name_arr[$result[csf('buyer_name')]]; ?></b></span></td>
                <td width="100"><span style="font-size:12px"><b>Dept.</b></span></td>
                <td width="110">:&nbsp;<? echo $product_dept[$result[csf('product_dept')]] ; if($result[csf('product_code')] !=""){ echo " (".$result[csf('product_code')].")";} if($result[csf('pro_sub_dep')] !=0){ echo " (".$pro_sub_dept_array[$result[csf('pro_sub_dep')]].")";}?></td>
                <td width="100"><span style="font-size:12px"><b>Order Qnty</b></span></td>
                <td width="110">:&nbsp;
				<?  echo $po_qnty_tot1." ".$unit_of_measurement[$result[csf('order_uom')]] ; ?>
                </td>
            </tr>
            <tr>

                <td width="100" style="font-size:12px"><b>Garments Item</b></td>
                <td width="110">:&nbsp;
				<?
				$gmts_item_name="";
				$gmts_item=explode(',',$result[csf('gmts_item_id')]);
				for($g=0;$g<=count($gmts_item); $g++)
				{
					$gmts_item_name.= $garments_item[$gmts_item[$g]].",";
				}
				echo rtrim($gmts_item_name,',');
				?>
                </td>
                <td width="100" style="font-size:12px"><b>Booking Release Date</b></td>
                <td width="110">:&nbsp;
				<?
				$booking_date=$result[csf('update_date')];
				if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
				{
					$booking_date=$result[csf('insert_date')];
				}
				echo change_date_format($booking_date,'dd-mm-yyyy','-','');
				?>&nbsp;&nbsp;&nbsp;
                </td>
                <td width="100" style="font-size:18px"><b>Style Ref.</b>   </td>
                <td width="110" style="font-size:18px">:&nbsp;
                <b>
				<?
				echo $result[csf('style_ref_no')];
				$style_ref_no=$result[csf('style_ref_no')];
				?>
                </b>
                </td>

            </tr>
             <tr>



                <td  width="100" style="font-size:12px"><b>Style Des.</b></td>
                <td  width="110" >:&nbsp;<? echo $result[csf('style_description')]; $job_no= $result[csf('job_no')];?></td>
                <td width="100" style="font-size:12px"><b>Lead Time </b>   </td>
                <td width="110">:&nbsp;<?  echo rtrim($lead_time,",");;?> </td>
                <td width="100" style="font-size:12px"><b>Dealing Merchant</b></td>
                <td width="110">:&nbsp;<? echo $marchentrArr[$result[csf('dealing_marchant')]]; ?></td>



            </tr>

            <tr>
                <td width="100" style="font-size:12px"><b>Supplier Name</b>   </td>
                <td width="110">:&nbsp;<? echo $supplier_name_arr[$result[csf('supplier_id')]];?>    </td>
               <!-- <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
               	<td width="110">:&nbsp;<? //echo change_date_format( $result[csf('delivery_date')],'dd-mm-yyyy','-');?></td> -->
                <td width="100" style="font-size:18px"><b>Booking No </b>   </td>
                <td width="110" style="font-size:18px">:&nbsp;<b><? echo $result[csf('booking_no')];?></b><? echo "(".$fabric_source[$result[csf('fabric_source')]].")"?></td>
                <td width="100" style="font-size:18px"><b>Quotation Id </b>   </td>
                <td width="110" style="font-size:18px">:&nbsp;<b><? echo $result[csf('quotation_id')];?></b><? echo "(Date :".$quot_date.")"?></td>



            </tr>
            <tr>
                <td width="100" style="font-size:12px"><b>Season</b></td>
                <td width="110">:&nbsp;<? echo $result[csf('season')]; ?></td>
                <td  width="100" style="font-size:12px"><b>Attention</b></td>
                <td  width="110" >:&nbsp;<? echo $result[csf('attention')]; ?></td>
                <td  width="100" style="font-size:12px"><b>Po Received Date</b></td>
                <td  width="110" >:&nbsp;<? echo $po_received_date; ?></td>
            </tr>
             <tr>
               <td width="100" style="font-size:12px"><b>Internal Ref No</b></td>
               <td width="110" style="font-size:18px"> :&nbsp;<b><? echo implode(",",array_unique(explode(",",$data_array3[0][csf("grouping")]))); ?></b></td>

               <td width="100" style="font-size:12px"><b>File no</b></td>
               <td width="110" style="font-size:18px"> :&nbsp;<b><? echo  implode(",",array_unique(explode(",",$data_array3[0][csf("file_no")])));?></b></td>
            </tr>
        </table>
           <?
			}
			//echo "select distinct size_number_id from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  	is_deleted=0 and status_active=1 order by size_number_id";
			//$nameArray_size=sql_select( "select distinct size_number_id from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  	is_deleted=0 and status_active=1 order by size_number_id");


			//$nameArray_size=sql_select( "select  size_number_id,min(id) as id from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  	is_deleted=0 and status_active=1 group by size_number_id order by id");

			$nameArray_size=sql_select( "select  size_number_id,min(id) as id,	min(size_order) as size_order from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  	is_deleted=0 and status_active=1 group by size_number_id order by size_order");

		   ?>
            <table width="100%" >
		    <tr>
            <td width="800">
                <div id="div_size_color_matrix" style="float:left; max-width:1000;">
            	<fieldset id="div_size_color_matrix" style="max-width:1000;">
 				<legend>Size and Color Breakdown                </legend>
 				<table  class="rpt_table"  border="1" align="left" cellpadding="0" width="750" cellspacing="0" rules="all" >
                    <tr>
                        <td style="border:1px solid black"><strong>PO Namber</strong></td>
                        <td style="border:1px solid black"><strong>Ship Date</strong></td>
                        <td style="border:1px solid black"><strong>Gmts Item</strong></td>
                        <td style="border:1px solid black"><strong>Style Ref</strong></td>
                        <td style="border:1px solid black"><strong>Color/Size</strong></td>
                    <?
						foreach($nameArray_size  as $result_size)
                        {	     ?>
                        <td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
                    <?	}    ?>
                        <td style="border:1px solid black; width:130px" align="center"><strong> Total Order Qty(Pcs)</strong></td>
                        <td style="border:1px solid black; width:80px" align="center"><strong> Excess %</strong></td>
                        <td style="border:1px solid black; width:130px" align="center"><strong> Total Plan Cut Qty(Pcs)</strong></td>
                    </tr>
                    <?
					$color_size_order_qnty_array=array();
					$color_size_qnty_array=array();
					$size_tatal=array();
					$size_tatal_order=array();
					$order_id=explode(",",str_replace("'","",$txt_order_no_id));
					for($or=0;$or<count($order_id); $or++)
				    {
					for($c=0;$c<count($gmts_item); $c++)
				    {
					$item_size_tatal=array();
					$item_size_tatal_order=array();
					$item_grand_total=0;
					$item_grand_total_order=0;

					//$nameArray_color=sql_select( "select  color_number_id, min(id) as id from wo_po_color_size_breakdown where  item_number_id=$gmts_item[$c] and po_break_down_id =$order_id[$or] and is_deleted=0 and status_active=1 group by color_number_id  order by id");
					$nameArray_color=sql_select( "select  color_number_id,min(id) as id,min(color_order) as color_order from wo_po_color_size_breakdown where  item_number_id=$gmts_item[$c] and po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id  order by color_order");

					?>
                   <!-- <tr>
                    <td style="border:1px solid black" colspan="<? echo count($nameArray_size)+3;?>"><strong><? echo $garments_item[$gmts_item[$c]];?></strong></td>

                    </tr>-->
                    <?
					foreach($nameArray_color as $result_color)
                    {
                    ?>
                    <tr>
                        <td align="center" style="border:1px solid black"><? echo $po_number_arr[$order_id[$or]]; // echo $row_num_tr; ?></td>
                         <td align="center" style="border:1px solid black"><? echo change_date_format($po_ship_date_arr[$order_id[$or]],"dd-mm-yyyy","-"); // echo $row_num_tr; ?></td>
                          <td align="center" style="border:1px solid black"><? echo $garments_item[$gmts_item[$c]]; // echo $row_num_tr; ?></td>
                          <td align="center" style="border:1px solid black"><? echo $style_ref_no; // echo $row_num_tr; ?></td>
                        <td align="center" style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; // echo $row_num_tr; ?></td>
                        <?
						$color_total=0;
						$color_total_order=0;

						foreach($nameArray_size  as $result_size)
						{
						$nameArray_color_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id =$order_id[$or] and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$result_color[csf('color_number_id')]."  and item_number_id=$gmts_item[$c] and  status_active=1 and is_deleted =0");
						foreach($nameArray_color_size_qnty as $result_color_size_qnty)
                        {

                        ?>
                            <td style="border:1px solid black; text-align:right">
							<?
								if($result_color_size_qnty[csf('plan_cut_qnty')]!= "")
								{
									 echo number_format($result_color_size_qnty[csf('order_quantity')],0);
									 $color_total += $result_color_size_qnty[csf('plan_cut_qnty')] ;
									 $color_total_order += $result_color_size_qnty[csf('order_quantity')] ;
									 $item_grand_total+=$result_color_size_qnty[csf('plan_cut_qnty')];
									 $item_grand_total_order+=$result_color_size_qnty[csf('order_quantity')];
								     $grand_total +=$result_color_size_qnty[csf('plan_cut_qnty')];
									 $grand_total_order +=$result_color_size_qnty[csf('order_quantity')];
									 $color_size_qnty_array[$result_size[csf('size_number_id')]][$result_color['color_number_id']]=$result_color_size_qnty[csf('plan_cut_qnty')];
									 $color_size_order_qnty_array[$result_size[csf('size_number_id')]][$result_color[csf('color_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
									 if (array_key_exists($result_size[csf('size_number_id')], $size_tatal))
									 {
											$size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
											$size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
									 }
									 else
									 {
										$size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
										$size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
									 }
									 if (array_key_exists($result_size[csf('size_number_id')], $item_size_tatal))
									 {
											$item_size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
											$item_size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
									 }
									 else
									 {
										$item_size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
										$item_size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
									 }
								}
								else echo "0";
							 ?>
							</td>

                    <?
						}
                        }
                        ?>
                        <td style="border:1px solid black; text-align:right"><? echo number_format(round($color_total_order),0); ?></td>
                         <td style="border:1px solid black; text-align:right"><? $excexss_per=($color_total-$color_total_order)/$color_total_order*100; echo number_format($excexss_per,2)." %"; ?></td>
                         <td style="border:1px solid black; text-align:right"><? echo number_format(round($color_total),0); ?></td>
                    </tr>
                    <?
                    }
					?>
                      <td align="center" style="border:1px solid black"><strong></strong></td>
                      <td align="center" style="border:1px solid black"><strong></strong></td>
                      <td align="center" style="border:1px solid black"><strong></strong></td>
                      <td align="center" style="border:1px solid black"><strong></strong></td>
                      <td align="center" style="border:1px solid black"><strong>Sub Total</strong></td>
                        <?
						foreach($nameArray_size  as $result_size)
                        {
                        ?>
                        <td style="border:1px solid black;  text-align:right"><? echo $item_size_tatal_order[$result_size[csf('size_number_id')]];  ?></td>
                        <?
                        }
                        ?>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($item_grand_total_order),0); ?></td>
                        <td  style="border:1px solid black;  text-align:right"><? $excess_item_gra_tot=($item_grand_total-$item_grand_total_order)/$item_grand_total_order*100; echo number_format($excess_item_gra_tot,2)." %"; ?></td>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($item_grand_total),0); ?></td>
                    </tr>
                    <?
					}
					}
                    ?>
                     <tr>
                        <td style="border:1px solid black" align="center" colspan="<? echo count($nameArray_size)+8; ?>"><strong>&nbsp;</strong></td>
                        </tr>
                    <tr>
                    <tr>
                    <td align="center" style="border:1px solid black"><strong></strong></td>
                    <td align="center" style="border:1px solid black"><strong></strong></td>
                    <td align="center" style="border:1px solid black"><strong></strong></td>
                    <td align="center" style="border:1px solid black"><strong></strong></td>
                        <td align="center" style="border:1px solid black"><strong>Grand Total</strong></td>
                        <?
						foreach($nameArray_size  as $result_size)
                        {
                        ?>
                        <td style="border:1px solid black;  text-align:right"><? echo $size_tatal_order[$result_size[csf('size_number_id')]];  ?></td>
                        <?
                        }
                        ?>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($grand_total_order),0); ?></td>
                        <td  style="border:1px solid black;  text-align:right"><? $excess_gra_tot= ($grand_total-$grand_total_order)/$grand_total_order*100; echo number_format($excess_gra_tot,2)." %"; ?></td>
                        <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($grand_total),0); ?></td>
                    </tr>
                </table>
                </fieldset>
                </div>
                </td>
                <td width="200" valign="top" align="left">
                <div id="div_size_color_matrix" style="float:left;">
            	<?
				$rmg_process_breakdown_arr=explode('_',$rmg_process_breakdown)
				?>
            	 	<fieldset id="" >
 				<legend>RMG Process Loss % </legend>
            	<table width="180" class="rpt_table" border="1" rules="all">
                <?
				if(number_format($rmg_process_breakdown_arr[8],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Cut Panel rejection <!-- Extra Cutting % breack Down 8-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[8],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[2],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Chest Printing <!-- Printing % breack Down 2-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[2],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[10],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Neck/Sleeve Printing <!-- New breack Down 10-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[10],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[1],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Embroidery   <!-- Embroidery  % breack Down 1-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[1],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[4],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Sewing /Input<!-- Sewing % breack Down 4-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[4],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[3],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Garments Wash <!-- Washing %breack Down 3-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[3],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[15],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Gmts Finishing <!-- Washing %breack Down 3-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[15],2);
				?>
                </td>
                </tr>
                <?
                }
				if(number_format($rmg_process_breakdown_arr[11],2)>0)
				{
				?>
                <tr>
                <td width="130">
                 Others <!-- New breack Down 11-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[11],2);
				?>
                </td>
                </tr>
                <?
                }
				$gmts_pro_sub_tot=$rmg_process_breakdown_arr[8]+$rmg_process_breakdown_arr[2]+$rmg_process_breakdown_arr[10]+$rmg_process_breakdown_arr[1]+$rmg_process_breakdown_arr[4]+$rmg_process_breakdown_arr[3]+$rmg_process_breakdown_arr[11]+$rmg_process_breakdown_arr[15];
				if($gmts_pro_sub_tot>0)
				{
				?>
                <tr>
                <td width="130">
                Sub Total <!-- New breack Down 11-->
                </td>
                <td align="right">
                <?

				echo number_format($gmts_pro_sub_tot,2);
				?>
                </td>
                </tr>
                <?
				}
				?>
                </table>
                </fieldset>


                <fieldset id="" >
 				<legend>Fabric Process Loss % </legend>
            	<table width="180" class="rpt_table" border="1" rules="all">
                 <?
				if(number_format($rmg_process_breakdown_arr[6],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Knitting  <!--  Knitting % breack Down 6-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[6],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[12],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Yarn Dyeing  <!--  New breack Down 12-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[12],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[5],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Dyeing & Finishing  <!-- Finishing % breack Down 5-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[5],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[13],2)>0)
				{
				?>
                <tr>
                <td width="130">
                All Over Print <!-- new  breack Down 13-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[13],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[14],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Lay Wash (Fabric) <!-- new  breack Down 14-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[14],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[7],2)>0)
				{
				?>
                 <tr>
                <td width="130">
                Dying   <!-- breack Down 7-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[7],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[0],2)>0)
				{
				?>
                <tr>
                <td width="130">
                Cutting (Fabric) <!-- Cutting % breack Down 0-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[0],2);
				?>
                </td>
                </tr>
                <?
				}
				if(number_format($rmg_process_breakdown_arr[9],2)>0)
				{
				?>
                <tr>
                <td width="130">
               Others  <!-- Others% breack Down 9-->
                </td>
                <td align="right">
                <?
				echo number_format($rmg_process_breakdown_arr[9],2);
				?>
                </td>
                </tr>
                <?
				}
				$fab_proce_sub_tot=$rmg_process_breakdown_arr[6]+$rmg_process_breakdown_arr[12]+$rmg_process_breakdown_arr[5]+$rmg_process_breakdown_arr[13]+$rmg_process_breakdown_arr[14]+$rmg_process_breakdown_arr[7]+$rmg_process_breakdown_arr[0]+$rmg_process_breakdown_arr[9];
				if(fab_proce_sub_tot>0)
				{
				?>
                <tr>
                <td width="130">
                Sub Total  <!-- Others% breack Down 9-->
                </td>
                <td align="right">
                <?

				echo number_format($fab_proce_sub_tot,2);
				?>
                </td>
                </tr>
                <?
				}
				if($gmts_pro_sub_tot+$fab_proce_sub_tot>0)
				{
				?>
                 <tr>
                <td width="130">
                Grand Total  <!-- Others% breack Down 9-->
                </td>
                <td align="right">
                <?
				echo number_format($gmts_pro_sub_tot+$fab_proce_sub_tot,2);
				?>
                </td>
                </tr>
                <?
				}
				?>
           </table>
           </fieldset>
           </div>
                </td>
            <td width="330" valign="top" align="left">
            <?
			$nameArray_imge =sql_select("SELECT image_location FROM common_photo_library where master_tble_id='$job_no' and file_type=1");
			?>
            <div id="div_size_color_matrix" style="float:left;">
            	<fieldset id="" >
 				<legend>Image </legend>
            	<table width="310">
                <tr>
                <?
				$img_counter = 0;
                foreach($nameArray_imge as $result_imge)
				{

					?>
					<td>
						<img src="../../<? echo $result_imge[csf('image_location')]; ?>" width="90" height="100" border="2" />
					</td>
					<?

					$img_counter++;
				}
				?>
                </tr>
           </table>
           </fieldset>
           </div>
          </td>
        </tr>
       </table>
      <br/>
      <?
	  if($cbo_fabric_source==1)
	  {
	  ?><!--  Here will be the main portion  -->
    <strong>Grey Fabric Details</strong>
    <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
    <tr>
    <td width="49%">
     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
       <tr>
            <td  width="120" align="left">Fabric Color</td>
            <td  width="120" align="left">Fabric</td>
            <td  width="120" align="left">Composition</td>
            <td  width="120" align="left">GSM</td>
            <td  width="120" align="left">Process Loss</td>
			<? foreach($nameArray_size  as $result_size){?>
            <td align="center"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
            <? } ?>
            <td   width="50">Total (Kg)</td>
       </tr>
       <?

		$costing_per="";
		$costing_per_qnty=0;
		$costing_per_id=return_field_value( "costing_per", "wo_pre_cost_mst","job_no ='$job_no'");
		if($costing_per_id==1)
		{
		$costing_per="1 Dzn";
		$costing_per_qnty=12;

		}
		if($costing_per_id==2)
		{
		$costing_per="1 Pcs";
		$costing_per_qnty=1;

		}
		if($costing_per_id==3)
		{
		$costing_per="2 Dzn";
		$costing_per_qnty=24;

		}
		if($costing_per_id==4)
		{
		$costing_per="3 Dzn";
		$costing_per_qnty=36;

		}
		if($costing_per_id==5)
		{
		$costing_per="4 Dzn";
		$costing_per_qnty=48;

		}
		$process_loss_method=return_field_value( "process_loss_method", "wo_pre_cost_fabric_cost_dtls","job_no='$job_no'");

		    $wo_pre_cost_fabric_cost_dtls_id=array();
	        $grand_total_fin_fab_qnty=0;
			$grand_total_grey_fab_qnty=0;
			$grand_totalcons_per_finish=0;
			$grand_totalcons_per_grey=0;


			$color_wise_wo_sql=sql_select("select d.fabric_color_id,a.color_type_id, a.id,a.body_part_id, a.composition, a.construction, a.gsm_weight,a.width_dia_type as width_dia_type,a.color_size_sensitive, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent , avg(b.requirment) as requirment ,min(c.id) as cid FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				a.body_part_id in(1,20) and
				d.booking_no =$txt_booking_no and
				d.status_active=1 and
				d.is_deleted=0
				group by a.id,a.color_type_id,a.body_part_id, a.composition, a.construction, a.gsm_weight,a.width_dia_type,a.color_size_sensitive,d.fabric_color_id order by cid ");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {

			$wo_pre_cost_fabric_cost_dtls_id[$color_wise_wo_result[csf('id')]]=$color_wise_wo_result[csf('id')];
			$fabric_color_id="";
			if($color_wise_wo_result[csf('color_size_sensitive')]==3)
			{
			$fabric_color_id=return_field_value( "gmts_color_id", "wo_pre_cos_fab_co_color_dtls","pre_cost_fabric_cost_dtls_id='".$color_wise_wo_result[csf('id')]."' and contrast_color_id='".$color_wise_wo_result[csf('fabric_color_id')]."'");
			}
			else
			{
			$fabric_color_id=$color_wise_wo_result[csf('fabric_color_id')];
			}


			$sql_dia_array=array();
		   $sql_dia=sql_select("Select dia_width,gmts_sizes from wo_pre_cos_fab_co_avg_con_dtls where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and pre_cost_fabric_cost_dtls_id='".$color_wise_wo_result[csf('id')]."' and color_number_id='".$fabric_color_id."'");

		   foreach($sql_dia as $sql_dia_row)
		   {
			$sql_dia_array[$sql_dia_row[csf("gmts_sizes")]][$sql_dia_row[csf("dia_width")]]= $sql_dia_row[csf("dia_width")];
		   }
		?>
			<tr>
            <td  width="120" align="left">
			<?
			echo $fabric_typee[$color_wise_wo_result[csf('width_dia_type')]];
			?>
            </td>
            <td  width="120" align="left">&nbsp;

            </td>
            <td>&nbsp;

            </td>
            <td  width="120" align="left">&nbsp;

            </td>

            <td  width="120" align="left">&nbsp;

            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_grey_fab_qnty=0;

			foreach($nameArray_size  as $result_size)
		    {
			?>

            <td width='50' align='' >&nbsp;
            <?
			$dia=implode(",", $sql_dia_array[$result_size[csf('size_number_id')]]);
			echo $dia;
			?>
            </td>
            <?
			}
			?>

            <td align="right">&nbsp;

            </td>
            </tr>

            <tr>
            <td  width="120" align="left">
			<?
			echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];
			//echo $color_library[$fabric_color_id];

			?>
            </td>
            <td  width="120" align="left">

			<?
			echo $color_wise_wo_result[csf('construction')].','.$color_type[$color_wise_wo_result[csf('color_type_id')]];
			?>
            </td>
            <td>
            <?
			echo $color_wise_wo_result[csf('composition')];
			?>
            </td>
            <td  width="120" align="left">
			<?
			echo $color_wise_wo_result[csf('gsm_weight')];
			?>
            </td>

            <td  width="120" align="left">
			<?
			echo number_format($color_wise_wo_result[csf('process_loss_percent')],4);
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_grey_fab_qnty=0;

			foreach($nameArray_size  as $result_size)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.id='".$color_wise_wo_result[csf('id')]."' and
				c.size_number_id='".$result_size[csf('size_number_id')]."' and
				d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
				d.status_active=1 and
				d.is_deleted=0
				");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>

            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],4);
			$total_grey_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
			}
			?>
            </td>
            <?
			}
			?>

            <td align="right"><? echo number_format($total_grey_fab_qnty,4); $grand_total_grey_fab_qnty+=$total_grey_fab_qnty;?></td>


            </tr>
         <?
		}
		?>
        <tr style=" font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Total</strong></td>
        <?
			foreach($nameArray_size  as $result_size)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id in(1,20) and
												c.size_number_id='".$result_size[csf('size_number_id')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right' > <? echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],4);?></td>
            <?
			}
			?>

            <td align="right"><? echo number_format($grand_total_grey_fab_qnty,4);?></td>

            </tr>
    </table>
 </td>
 <td width="2%"></td>
 <td width="49%" valign="top">
 <?
// $wo_pre_cost_fabric_cost_dtls_id_main_fabric=implode(",", $wo_pre_cost_fabric_cost_dtls_id);
 $wo_pre_cost_fabric_cost_dtls_id_main_fabric=implode(",", $wo_pre_cost_fabric_cost_dtls_id);
 if( $wo_pre_cost_fabric_cost_dtls_id_main_fabric !="")
 {
	 $wo_pre_cost_fabric_cost_dtls_id_main_fabric_cond="and pre_cost_fabric_cost_dtls_id not in($wo_pre_cost_fabric_cost_dtls_id_main_fabric)";
 }
     $nameArray_fabric_description= sql_select("select a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type, b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent , avg(b.requirment) as requirment,min(c.id) as cid FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
WHERE a.job_no=b.job_no and
a.id=b.pre_cost_fabric_cost_dtls_id and
c.job_no_mst=a.job_no and
c.id=b.color_size_table_id and
b.po_break_down_id=d.po_break_down_id and
b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
d.booking_no =$txt_booking_no and
a.body_part_id not in(1,20) and
d.status_active=1 and
d.is_deleted=0
group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by a.body_part_id,b.dia_width,cid");
	 ?>

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
     <tr align="center">
     <td width='50'></td>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>". $body_part[$result_fabric_description[csf('body_part_id')]].",".$result_fabric_description[csf('construction')]."</td>";
		}
		?>



       </tr>


        <tr align="center">
        <td width='50'></td>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='2' >&nbsp</td>";
			else         		               echo "<td colspan='2' >".$result_fabric_description[csf('composition')].",". $color_type[$result_fabric_description[csf('color_type_id')]].",". $result_fabric_description[csf('gsm_weight')]."</td>";
		}
		?>

       </tr>

       <tr align="center">
       <td width='50'></td>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='2'>&nbsp</td>";
			else         		              echo "<td colspan='2' align='center'>".$fabric_typee[$result_fabric_description[csf('width_dia_type')]].",". $result_fabric_description[csf('dia_width')].",".number_format($result_fabric_description[csf('requirment')],4)."</td>";
		}
		?>

       </tr>
       <tr>
       <th width='50'>Gmt Color</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			  echo "<th width='50'>Color</th><th width='50' >Qty</th>";
		}
		?>

       </tr>
       <?

		  $gmt_color_library=array();
		  $gmt_color_data=sql_select("select gmts_color_id,contrast_color_id
		  FROM
		  wo_pre_cos_fab_co_color_dtls
		  WHERE
		  job_no ='$job_no'");
		  foreach( $gmt_color_data as $gmt_color_row)
		  {
			$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
		  }

	        $grand_total_fin_fab_qnty=0;
			$grand_total_grey_fab_qnty=0;
			$grand_totalcons_per_finish=0;
			$grand_totalcons_per_grey=0;
			$color_wise_wo_sql=sql_select("select fabric_color_id
										  FROM
										  wo_booking_dtls
										  WHERE
										  booking_no =$txt_booking_no
										  $wo_pre_cost_fabric_cost_dtls_id_main_fabric_cond and
										  status_active=1 and
                                          is_deleted=0
										  group by fabric_color_id");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
		?>
			<tr>
            <td width='50' align='right'>
			<?
			//if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			//{
				if($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]!="")
				{
					echo rtrim($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]],",");
				}
				else
				{
					echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];
				}
			//}
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_grey_fab_qnty=0;

			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
				d.status_active=1 and
				d.is_deleted=0
				");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>

			<td width='50' align='right'>
			<?
			if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			{
			echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],4);
			$total_grey_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
			}
			?>
            </td>
            <?
			}
			?>




            </tr>
         <?
		}
		?>
        <tr style=" font-weight:bold">

        <td width='50' align='right'></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'></td><td width='50' align='right' > <? echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],4);?></td>
            <?
			}
			?>



            </tr>
    </table>
 </td>
 </tr>
 </table>
    <br/>   									 <!--  Here will be the main portion  -->
    <strong>Finish Fabric Details</strong>
    <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
    <tr>
    <td width="49%">
     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
       <tr>
            <td  width="120" align="left">Fabric Color</td>
            <td  width="120" align="left">Fabric</td>
            <td  width="120" align="left">Composition</td>
            <td  width="120" align="left">GSM</td>
            <td  width="120" align="left">Process Loss</td>
			<?
            foreach($nameArray_size  as $result_size)
            {?>
            <td align="center"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
            <? } ?>
            <td   width="50">Total (Kg)</td>
       </tr>
       <?
	   $wo_pre_cost_fabric_cost_dtls_id=array();
	        $grand_total_fin_fab_qnty=0;
			$grand_total_grey_fab_qnty=0;
			$grand_totalcons_per_finish=0;
			$grand_totalcons_per_grey=0;
			$color_wise_wo_sql=sql_select("select d.fabric_color_id, a.id,a.color_type_id,a.body_part_id, a.composition, a.construction, a.gsm_weight,a.width_dia_type as width_dia_type,a.color_size_sensitive,  avg(b.cons) as cons, avg(b.process_loss_percent) as process_loss_percent , avg(b.requirment) as requirment,min(c.id) as cid  FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				a.body_part_id in(1,20) and
				d.booking_no =$txt_booking_no and
				d.status_active=1 and
				d.is_deleted=0
				group by a.id,a.color_type_id,a.body_part_id, a.composition, a.construction, a.gsm_weight,a.width_dia_type,a.color_size_sensitive,d.fabric_color_id order by cid");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
			$wo_pre_cost_fabric_cost_dtls_id[$color_wise_wo_result[csf('id')]]=$color_wise_wo_result[csf('id')];
			$fabric_color_id="";
			if($color_wise_wo_result[csf('color_size_sensitive')]==3)
			{
			$fabric_color_id=return_field_value( "gmts_color_id", "wo_pre_cos_fab_co_color_dtls","pre_cost_fabric_cost_dtls_id='".$color_wise_wo_result[csf('id')]."' and contrast_color_id='".$color_wise_wo_result[csf('fabric_color_id')]."'");
			}
			else
			{
			$fabric_color_id=$color_wise_wo_result[csf('fabric_color_id')];
			}
			//echo "Select dia_width,gmts_sizes from wo_pre_cos_fab_co_avg_con_dtls where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and pre_cost_fabric_cost_dtls_id='".$color_wise_wo_result[csf('id')]."' and color_number_id='".$fabric_color_id."'";
			$sql_dia_array=array();
		   $sql_dia=sql_select("Select dia_width,gmts_sizes from wo_pre_cos_fab_co_avg_con_dtls where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and pre_cost_fabric_cost_dtls_id='".$color_wise_wo_result[csf('id')]."' and color_number_id='".$fabric_color_id."'");
		   foreach($sql_dia as $sql_dia_row)
		   {
			$sql_dia_array[$sql_dia_row[csf("gmts_sizes")]][$sql_dia_row[csf("dia_width")]]= $sql_dia_row[csf("dia_width")];
		   }
		?>
			<tr>
            <td  width="120" align="left">
			<?
			echo $fabric_typee[$color_wise_wo_result[csf('width_dia_type')]];
			?>
            </td>
            <td  width="120" align="left">&nbsp;

            </td>
            <td>&nbsp;

            </td>
            <td  width="120" align="left">&nbsp;

            </td>

            <td  width="120" align="left">&nbsp;

            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_grey_fab_qnty=0;

			foreach($nameArray_size  as $result_size)
		    {
			?>

            <td width='50' align='' >&nbsp;
			<?
			$dia=implode(",", $sql_dia_array[$result_size[csf('size_number_id')]]);
			echo $dia;
			?>
            </td>
            <?
			}
			?>

            <td align="right">&nbsp;

            </td>


            </tr>



            <tr>
            <td  width="120" align="left">
			<?
			echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];
			//echo $color_library[$fabric_color_id];
			?>
            </td>
            <td  width="120" align="left">
			<?
			echo $color_wise_wo_result[csf('construction')].','.$color_type[$color_wise_wo_result[csf('color_type_id')]];
			?>
            </td>
            <td>
            <?
			echo $color_wise_wo_result[csf('composition')];
			?>
            </td>
            <td  width="120" align="left">
			<?
			echo $color_wise_wo_result[csf('gsm_weight')];
			?>
            </td>

            <td  width="120" align="left">
			<?
			echo number_format($color_wise_wo_result[csf('process_loss_percent')],4);
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_grey_fab_qnty=0;

			foreach($nameArray_size  as $result_size)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.id='".$color_wise_wo_result[csf('id')]."' and
				c.size_number_id='".$result_size[csf('size_number_id')]."' and
				d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
				d.status_active=1 and
				d.is_deleted=0
				");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>

            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],4);
			$total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('fin_fab_qnty')];
			}
			?>
            </td>
            <?
			}
			?>

            <td align="right"><? echo number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>


            </tr>
         <?
		}
		?>
        <tr style=" font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Total</strong></td>
        <?
			foreach($nameArray_size  as $result_size)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(b.cons) as avg_cons FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id in(1,20) and
												c.size_number_id='".$result_size[csf('size_number_id')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right' > <? echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],4);?></td>
            <?
			}
			?>
            <td align="right"><? echo number_format($grand_total_fin_fab_qnty,4);?></td>

            </tr>
            <tr style=" font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Consumption</strong></td>
        <?
			foreach($nameArray_size  as $result_size)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(b.cons) as avg_cons FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id in(1,20) and
												c.size_number_id='".$result_size[csf('size_number_id')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right' > <? echo number_format($color_wise_wo_result_qnty[csf('avg_cons')],4);?></td>
            <?
			}
			?>
            <td align="right"><? //echo number_format($grand_total_fin_fab_qnty,2);?></td>

            </tr>


    </table>
    </td>
    <td width="2%"></td>
    <td width="49%" valign="top">
 <?
// print_r($wo_pre_cost_fabric_cost_dtls_id);
 $wo_pre_cost_fabric_cost_dtls_id_main_fabric=implode(",", $wo_pre_cost_fabric_cost_dtls_id);
 if( $wo_pre_cost_fabric_cost_dtls_id_main_fabric !="")
 {
	 $wo_pre_cost_fabric_cost_dtls_id_main_fabric_cond="and pre_cost_fabric_cost_dtls_id not in($wo_pre_cost_fabric_cost_dtls_id_main_fabric)";
 }

 $nameArray_fabric_description= sql_select("select a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type, b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent , avg(b.requirment) as requirment,min(c.id) as cid FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
WHERE a.job_no=b.job_no and
a.id=b.pre_cost_fabric_cost_dtls_id and
c.job_no_mst=a.job_no and
c.id=b.color_size_table_id and
b.po_break_down_id=d.po_break_down_id and
b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
d.booking_no =$txt_booking_no and
a.body_part_id not in(1,20) and
d.status_active=1 and
d.is_deleted=0
group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by a.body_part_id,b.dia_width,cid");
	 ?>

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
     <tr align="center">
     <td width='50'></td>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>". $body_part[$result_fabric_description[csf('body_part_id')]].",".$result_fabric_description[csf('construction')]."</td>";
		}
		?>



       </tr>

       <tr align="center">
       <td width='50'></td>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='2' >&nbsp</td>";
			else         		               echo "<td colspan='2' >".$result_fabric_description[csf('composition')].",". $color_type[$result_fabric_description[csf('color_type_id')]].",". $result_fabric_description[csf('gsm_weight')]."</td>";
		}
		?>

       </tr>

       <tr align="center">
       <td width='50'></td>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='2'>&nbsp</td>";
			else         		              echo "<td colspan='2' align='center'>".$fabric_typee[$result_fabric_description[csf('width_dia_type')]].",". $result_fabric_description[csf('dia_width')].",".number_format($result_fabric_description[csf('cons')],4)."</td>";
		}
		?>

       </tr>
       <tr>
       <th width='50'>Gmt Color</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			  echo "<th width='50'>Color</th><th width='50' >Qty</th>";
		}
		?>

       </tr>
       <?

		  $gmt_color_library=array();
		  $gmt_color_data=sql_select("select gmts_color_id,contrast_color_id
		  FROM
		  wo_pre_cos_fab_co_color_dtls
		  WHERE
		  job_no ='$job_no'");
		  foreach( $gmt_color_data as $gmt_color_row)
		  {
			$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
		  }

	        $grand_total_fin_fab_qnty=0;
			$grand_total_grey_fab_qnty=0;
			$grand_totalcons_per_finish=0;
			$grand_totalcons_per_grey=0;
			$color_wise_wo_sql=sql_select("select fabric_color_id
										  FROM
										  wo_booking_dtls
										  WHERE
										  booking_no =$txt_booking_no
										  $wo_pre_cost_fabric_cost_dtls_id_main_fabric_cond and
										  status_active=1 and
                                          is_deleted=0
										  group by fabric_color_id");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
		?>
			<tr>
            <td width='50' align='right'>
			<?
			//if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			//{
				if($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]!="")
				{

				echo rtrim($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]],",");
				}
				else
				{
					echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];
				}
			//}
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_grey_fab_qnty=0;

			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
				d.status_active=1 and
				d.is_deleted=0
				");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>

			<td width='50' align='right'>
			<?
			if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			{

			echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],4);
			//$total_grey_fab_qnty+=$color_wise_wo_result_qnty[csf('fin_fab_qnty')];
			}
			?>
            </td>
            <?
			}
			?>




            </tr>
         <?
		}
		?>
        <tr style=" font-weight:bold">
        <td width='50' align='right'></td>

        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'></td><td width='50' align='right' > <? echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],4);?></td>
            <?
			}
			?>



            </tr>
    </table>
 </td>
    </tr>
    </table>
    <?
	  }
	  //=====================================================================Production End==============================================================
	?>

     <?
	 	  //=====================================================================Purchase Start==============================================================

	  if($cbo_fabric_source==2)
	  {
	$color_wise_wo_sql=sql_select("select d.fabric_color_id, a.id,a.body_part_id, a.composition, a.construction, a.gsm_weight,a.width_dia_type as width_dia_type,a.color_size_sensitive, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent , avg(b.requirment) as requirment ,min(c.id) as cid FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				a.body_part_id in(1,20) and
				d.booking_no =$txt_booking_no and
				d.status_active=1 and
				d.is_deleted=0
				group by a.id,a.body_part_id, a.composition, a.construction, a.gsm_weight,a.width_dia_type,a.color_size_sensitive,d.fabric_color_id order by cid ");

	  ?><!--  Here will be the main portion  -->
    <strong>Fabric Details</strong>
    <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
    <tr>
     <?
	if(count($color_wise_wo_sql)>0)
	{
	?>
    <td width="49%">

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
       <tr>
            <td  width="120" align="left">Fabric Color</td>
            <td  width="120" align="left">Fabric</td>
            <td  width="120" align="left">Composition</td>
            <td  width="120" align="left">GSM</td>
            <td  width="120" align="left">Process Loss</td>
			<? foreach($nameArray_size  as $result_size){?>
            <td align="center"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
            <? } ?>
            <td   width="50">Total (Kg)</td>
            <td   width="50">Rate</td>
            <td   width="50">Amount</td>
       </tr>
       <?

		$costing_per="";
		$costing_per_qnty=0;
		$costing_per_id=return_field_value( "costing_per", "wo_pre_cost_mst","job_no ='$job_no'");
		if($costing_per_id==1)
		{
		$costing_per="1 Dzn";
		$costing_per_qnty=12;

		}
		if($costing_per_id==2)
		{
		$costing_per="1 Pcs";
		$costing_per_qnty=1;

		}
		if($costing_per_id==3)
		{
		$costing_per="2 Dzn";
		$costing_per_qnty=24;

		}
		if($costing_per_id==4)
		{
		$costing_per="3 Dzn";
		$costing_per_qnty=36;

		}
		if($costing_per_id==5)
		{
		$costing_per="4 Dzn";
		$costing_per_qnty=48;

		}
		$process_loss_method=return_field_value( "process_loss_method", "wo_pre_cost_fabric_cost_dtls","job_no='$job_no'");

		    $wo_pre_cost_fabric_cost_dtls_id=array();
	        $grand_total_fin_fab_qnty=0;
			$grand_total_grey_fab_qnty=0;
			$grand_totalcons_per_finish=0;
			$grand_totalcons_per_grey=0;
			$grand_total_amount=0;



		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {

			$wo_pre_cost_fabric_cost_dtls_id[$color_wise_wo_result[csf('id')]]=$color_wise_wo_result[csf('id')];
			$fabric_color_id="";
			if($color_wise_wo_result[csf('color_size_sensitive')]==3)
			{
			$fabric_color_id=return_field_value( "gmts_color_id", "wo_pre_cos_fab_co_color_dtls","pre_cost_fabric_cost_dtls_id='".$color_wise_wo_result[csf('id')]."' and contrast_color_id='".$color_wise_wo_result[csf('fabric_color_id')]."'");
			}
			else
			{
			$fabric_color_id=$color_wise_wo_result[csf('fabric_color_id')];
			}


			$sql_dia_array=array();
		   $sql_dia=sql_select("Select dia_width,gmts_sizes from wo_pre_cos_fab_co_avg_con_dtls where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and pre_cost_fabric_cost_dtls_id='".$color_wise_wo_result[csf('id')]."' and color_number_id='".$fabric_color_id."'");

		   foreach($sql_dia as $sql_dia_row)
		   {
			$sql_dia_array[$sql_dia_row[csf("gmts_sizes")]][$sql_dia_row[csf("dia_width")]]= $sql_dia_row[csf("dia_width")];
		   }
		?>
			<tr>
            <td  width="120" align="left">
			<?
			echo $fabric_typee[$color_wise_wo_result[csf('width_dia_type')]];
			?>
            </td>

            <td  width="120" align="left">&nbsp;

            </td>
            <td>&nbsp;

            </td>
            <td  width="120" align="left">&nbsp;

            </td>

            <td  width="120" align="left">&nbsp;

            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_grey_fab_qnty=0;

			foreach($nameArray_size  as $result_size)
		    {
			?>

            <td width='50' align='' >&nbsp;
            <?
			$dia=implode(",", $sql_dia_array[$result_size[csf('size_number_id')]]);
			echo $dia;
			?>
            </td>
            <?
			}
			?>

            <td align="right">&nbsp;

            </td>
            <td align="right">&nbsp;

            </td>
            <td align="right">&nbsp;

            </td>
            </tr>

            <tr>
            <td  width="120" align="left">
			<?
			echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];
			//echo $color_library[$fabric_color_id];

			?>
            </td>
            <td  width="120" align="left">
			<?
			echo $color_wise_wo_result[csf('construction')];
			?>
            </td>
            <td>
            <?
			echo $color_wise_wo_result[csf('composition')];
			?>
            </td>
            <td  width="120" align="left">
			<?
			echo $color_wise_wo_result[csf('gsm_weight')];
			?>
            </td>

            <td  width="120" align="left">
			<?
			echo $color_wise_wo_result[csf('process_loss_percent')];
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_grey_fab_qnty=0;

			foreach($nameArray_size  as $result_size)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.id='".$color_wise_wo_result[csf('id')]."' and
				c.size_number_id='".$result_size[csf('size_number_id')]."' and
				d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
				d.status_active=1 and
				d.is_deleted=0
				");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>

            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],4);
			$total_grey_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
			}
			?>
            </td>
            <?
			}
			?>

            <td align="right"><? echo number_format($total_grey_fab_qnty,4); $grand_total_grey_fab_qnty+=$total_grey_fab_qnty;?></td>
            <td align="right">
			<?
			echo number_format($color_wise_wo_result_qnty[csf('rate')],4);
			//$grand_total_grey_fab_qnty+=$total_grey_fab_qnty;
			?>
            </td>
            <td align="right">
			<?
			$amount=$total_grey_fab_qnty*$color_wise_wo_result_qnty[csf('rate')];
			echo number_format($amount,4);
			$grand_total_amount+=$amount;?>
            </td>


            </tr>
         <?
		}
		?>
        <tr style=" font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Total</strong></td>
        <?
			foreach($nameArray_size  as $result_size)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id in(1,20) and
												c.size_number_id='".$result_size[csf('size_number_id')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right' > <? echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],4);?></td>
            <?
			}
			?>

            <td align="right"><? echo number_format($grand_total_grey_fab_qnty,4);?></td>
            <td align="right"><? echo number_format($grand_total_amount/$grand_total_grey_fab_qnty,4);?></td>
            <td align="right"><? echo number_format($grand_total_amount,4);?></td>

            </tr>
    </table>

 </td>

 <td width="2%"></td>
  <?
	}
	?>
 <td width="49%" valign="top">
 <?
 //print_r($wo_pre_cost_fabric_cost_dtls_id);
 $wo_pre_cost_fabric_cost_dtls_id_main_fabric=implode(",", $wo_pre_cost_fabric_cost_dtls_id);
 if( $wo_pre_cost_fabric_cost_dtls_id_main_fabric !="")
 {
	 $wo_pre_cost_fabric_cost_dtls_id_main_fabric_cond="and pre_cost_fabric_cost_dtls_id not in($wo_pre_cost_fabric_cost_dtls_id_main_fabric)";
 }
 $nameArray_fabric_description= sql_select("select a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type, b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent , avg(b.requirment) as requirment,min(c.id) as cid FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
WHERE a.job_no=b.job_no and
a.id=b.pre_cost_fabric_cost_dtls_id and
c.job_no_mst=a.job_no and
c.id=b.color_size_table_id and
b.po_break_down_id=d.po_break_down_id and
b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
d.booking_no =$txt_booking_no and
a.body_part_id not in(1,20) and
d.status_active=1 and
d.is_deleted=0
group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by a.body_part_id,b.dia_width,cid");
	 ?>

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
     <tr align="center">
     <td width='50'></td>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='4'>&nbsp</td>";
			else         		               echo "<td  colspan='4'>". $body_part[$result_fabric_description[csf('body_part_id')]].",".$result_fabric_description[csf('construction')]."</td>";
		}
		?>



       </tr>


        <tr align="center">
        <td width='50'></td>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='4' >&nbsp</td>";
			else         		               echo "<td colspan='4' >".$result_fabric_description[csf('composition')].",". $color_type[$result_fabric_description[csf('color_type_id')]].",". $result_fabric_description[csf('gsm_weight')]."</td>";
		}
		?>

       </tr>

       <tr align="center">
       <td width='50'></td>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='4'>&nbsp</td>";
			else         		              echo "<td colspan='4' align='center'>".$fabric_typee[$result_fabric_description[csf('width_dia_type')]].",". $result_fabric_description[csf('dia_width')].",".number_format($result_fabric_description[csf('requirment')],4)."</td>";
		}
		?>

       </tr>
       <tr>
       <th width='50'>Gmt Color</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			  echo "<th width='50'>Color</th><th width='50' >Qty</th><th width='50'>Rate</th><th width='50' >Amount</th>";
		}
		?>

       </tr>
       <?

		  $gmt_color_library=array();
		  $gmt_color_data=sql_select("select gmts_color_id,contrast_color_id
		  FROM
		  wo_pre_cos_fab_co_color_dtls
		  WHERE
		  job_no ='$job_no'");
		  foreach( $gmt_color_data as $gmt_color_row)
		  {
			$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
		  }

	        $grand_total_fin_fab_qnty=0;
			$grand_total_grey_fab_qnty=0;
			$grand_totalcons_per_finish=0;
			$grand_totalcons_per_grey=0;
			$color_wise_wo_sql=sql_select("select fabric_color_id
										  FROM
										  wo_booking_dtls
										  WHERE
										  booking_no =$txt_booking_no
										  $wo_pre_cost_fabric_cost_dtls_id_main_fabric_cond and
										  status_active=1 and
                                          is_deleted=0
										  group by fabric_color_id");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
		?>
			<tr>
            <td width='50' align='right'>
			<?
			//if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			//{
				if($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]!="")
				{
					echo rtrim($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]],",");
				}
				else
				{
					echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];
				}
			//}
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_grey_fab_qnty=0;
			$total_amount=0;

			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
				d.status_active=1 and
				d.is_deleted=0
				");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>

			<td width='50' align='right'>
			<?
			if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			{
			echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],4);
			$total_grey_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
			}
			?>
            </td>

            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('rate')],4);
			//$total_grey_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
			}
			?>
            </td>

            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
			{
			$amount=$color_wise_wo_result_qnty[csf('grey_fab_qnty')]*$color_wise_wo_result_qnty[csf('rate')];
			echo number_format($amount,4);
			$total_amount+=$amount;
			}
			?>
            </td>
            <?
			}
			?>




            </tr>
         <?
		}
		?>
        <tr style=" font-weight:bold">

        <td width='50' align='right'></td>
        <?
		$other_fab_total=0;
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'></td>
            <td width='50' align='right' > <? echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],4);?></td>
            <td width='50' align='right' > <? echo number_format($color_wise_wo_result_qnty[csf('rate')],4);?></td>
            <td width='50' align='right' >
			<?
			$fabwise_amount=$color_wise_wo_result_qnty[csf('grey_fab_qnty')]*$color_wise_wo_result_qnty[csf('rate')];
			echo number_format($fabwise_amount,4);
			$other_fab_total+=$fabwise_amount;
			?>
            </td>
            <?
			}
			?>



            </tr>
    </table>
 </td>
 </tr>
 </table>
 <br/>
 <table width="100%" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" border="1">
 <tr>
 <td>
  <?
	   $mcurrency="";
	   $dcurrency="";
	   if($currency_id==1)
	   {
		$mcurrency='Taka';
		$dcurrency='Paisa';
	   }
	   if($currency_id==2)
	   {
		$mcurrency='USD';
		$dcurrency='CENTS';
	   }
	   if($currency_id==3)
	   {
		$mcurrency='EURO';
		$dcurrency='CENTS';
	   }
	   ?>
 <strong>Total Amount (In Words):</strong><? echo number_to_words(def_number_format($grand_total_amount+$other_fab_total,2,""),$mcurrency, $dcurrency);?>
 </td>
 </tr>
 </table>
    <?
	  }
	  //=====================================================================Purchase End==============================================================
	?>


   <br/>
   <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
        <tr>
        <?

		$nameArray_item_size=sql_select( "select b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id  and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by c.id");

		if(count($nameArray_item_size)>0)
		{
        ?>
        <td width="49%">
        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
        <tr>
        <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Collar -  Colour Size Brakedown in Pcs</b></td>
        </tr>
        <tr>
        <td width="70">Size</td>

        <?

		/*$nameArray_item_size=sql_select( "select b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by c.size_number_id,b.item_size order by c.size_number_id");*/
		foreach($nameArray_item_size  as $result_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
		<?
        }
        ?>
        <td rowspan="2" align="center"><strong>Total</strong></td>
        <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
        </tr>
        <tr>
        <td>Collar Size</td>

        <?
        foreach($nameArray_item_size  as $result_item_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
		<?
        }
        ?>
         <?

			$color_wise_wo_sql=sql_select("select a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id,sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by c.color_number_id,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method order by a.id,c.id
");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
			$color_total_collar=0;
			$color_total_collar_order_qnty=0;
			$process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
			$constrast_color_arr=array();
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				$constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
				for($i=0;$i<count($constrast_color);$i++)
				{
					$constrast_color2=explode('_',$constrast_color[$i]);
					$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
				}
			}
		?>
			<tr>
            <td>
            <?
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]) ;
				$lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
			}
			else
			{
				echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
				$lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
			}
			?>

            </td>
            <?
            foreach($nameArray_item_size  as $result_size)
			{
				?>
				<td align="center" style="border:1px solid black">
				<?
				//$color_wise_wo_sql_qnty=sql_select("select c.color_number_id,sum(c.order_quantity) as order_quantity, sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 and c.color_number_id='".$color_wise_wo_result['color_number_id']."' and c.size_number_id='".$result_size['size_number_id']."'");
				$color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0");

				list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
				$colar_excess_per=def_number_format(($plan_cut_qnty[csf('plan_cut_qnty')]*$colar_excess_percent)/100,6,0);
				echo number_format($plan_cut_qnty[csf('plan_cut_qnty')]+$colar_excess_per,0);
				$color_total_collar+=$plan_cut_qnty[csf('plan_cut_qnty')]+$colar_excess_per;
				$color_total_collar_order_qnty+=$plan_cut_qnty[csf('order_quantity')];
				$grand_total_collar+=$plan_cut_qnty[csf('plan_cut_qnty')]+$colar_excess_per;
				$grand_total_collar_order_qnty+=$plan_cut_qnty[csf('order_quantity')];
				?>
                </td>
				<?
			}
			?>

            <td align="center"><? echo number_format($color_total_collar,0); ?></td>
            <td align="center"><? echo number_format((($color_total_collar-$color_total_collar_order_qnty)/$color_total_collar_order_qnty)*100,2); ?></td>
            </tr>
            <?
		    }
			?>
            <tr>
                <td>Size Total</td>

                <?
                foreach($nameArray_item_size  as $result_size)
                {
                ?>
                <td style="border:1px solid black;  text-align:center"><? $colar_excess_pers=($size_tatal[$result_size[csf('size_number_id')]]*$colar_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]+$colar_excess_pers,0); ?></td>
                <?
                }
                ?>
                <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_collar,0); ?></td>
                <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_collar-$grand_total_collar_order_qnty)/$grand_total_collar_order_qnty)*100,2); ?></td>
            </tr>
        </table>
        </td>
        <td width="2%">
        </td>
        <?
        }
		?>

        <?
		$nameArray_item_size=sql_select( "select  b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no  and a.body_part_id=3  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by c.id");

		if(count($nameArray_item_size)>0)
		{
        ?>
        <td width="49%">
        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
        <tr>
        <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Cuff -  Colour Size Brakedown in Pcs</b></td>
        </tr>
        <tr>
        <td width="70">Size</td>

        <?
		foreach($nameArray_item_size  as $result_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
		<?
        }
        ?>
        <td rowspan="2" align="center"><strong>Total</strong></td>
        <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
        </tr>
        <tr>
        <td>Cuff Size</td>

        <?
        foreach($nameArray_item_size  as $result_item_size)
		{
		?>
		<td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
		<?
        }
        ?>
         <?

			$color_wise_wo_sql=sql_select("select a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id,sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=3  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and  d.status_active=1 and d.is_deleted=0 group by c.color_number_id ,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method order by a.id ,c.id
");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
			$color_total_cuff=0;
			$color_total_cuff_order_qnty=0;
			$process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
			$constrast_color_arr=array();
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				$constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
				for($i=0;$i<count($constrast_color);$i++)
				{
					$constrast_color2=explode('_',$constrast_color[$i]);
					$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
				}
			}
		?>
			<tr>
            <td>
            <?
			if($color_wise_wo_result[csf("color_size_sensitive")]==3)
			{
				echo strtoupper ($constrast_color_arr[$color_wise_wo_result['color_number_id']]) ;
				$lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
			}
			else
			{
				echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
				$lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
			}
			?>

            </td>
            <?
            foreach($nameArray_item_size  as $result_size)
			{
				?>
				<td align="center" style="border:1px solid black">

				<?
				/*$color_wise_wo_sql_qnty=sql_select("select c.color_number_id,sum(c.order_quantity) as order_quantity, sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=3 and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.id=d.color_size_table_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 and c.color_number_id='".$color_wise_wo_result['color_number_id']."' and c.size_number_id='".$result_size['size_number_id']."'");*/
				$color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active=1 and is_deleted =0");

				list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
				$cuff_excess_per=def_number_format((($plan_cut_qnty[csf('plan_cut_qnty')]*2)*$cuff_excess_percent)/100,6,"");
				echo number_format($plan_cut_qnty[csf('plan_cut_qnty')]*2+$cuff_excess_per,0);
				$color_total_cuff+=$plan_cut_qnty[csf('plan_cut_qnty')]*2+$cuff_excess_per;
				$color_total_cuff_order_qnty+=$plan_cut_qnty[csf('order_quantity')]*2;
				$grand_total_cuff+=$plan_cut_qnty[csf('plan_cut_qnty')]*2+$cuff_excess_per;
				$grand_total_cuff_order_qnty+=$plan_cut_qnty[csf('order_quantity')]*2;
				/*echo $color_size_qnty_array[$result_size[size_number_id]][$color_wise_wo_result[color_number_id]]*2;
				$color_total_cuff+=$color_size_qnty_array[$result_size[size_number_id]][$color_wise_wo_result[color_number_id]]*2;
				$color_total_cuff_order_qnty+=$color_size_order_qnty_array[$result_size[size_number_id]][$color_wise_wo_result[color_number_id]]*2;
				$grand_total_cuff+=$color_size_qnty_array[$result_size[size_number_id]][$color_wise_wo_result[color_number_id]]*2;
				$grand_total_cuff_order_qnty+=$color_size_order_qnty_array[$result_size[size_number_id]][$color_wise_wo_result[color_number_id]]*2;*/
				?>

                </td>
				<?
			}
			?>

            <td align="center"><? echo number_format($color_total_cuff,0); ?></td>
            <td align="center"><? echo number_format((($color_total_cuff-$color_total_cuff_order_qnty)/$color_total_cuff_order_qnty)*100,2); ?></td>
            </tr>
            <?
		    }
			?>
            <tr>
                <td>Size Total</td>

                <?
                foreach($nameArray_item_size  as $result_size)
                {
                   /* $nameArray_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =$result_size[size_number_id]  and status_active=1 and is_deleted =0 order by id");
                foreach($nameArray_size_qnty as $result_size_qnty)
                {*/
                ?>
                <td style="border:1px solid black;  text-align:center"><? $cuff_excess_pers=(($size_tatal[$result_size[csf('size_number_id')]]*2)*$cuff_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]*2+$cuff_excess_pers,0); ?></td>
                <?
                //}
                }
                ?>
                <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_cuff,0); ?></td>
                <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_cuff-$grand_total_cuff_order_qnty)/$grand_total_cuff_order_qnty)*100,2); ?></td>
            </tr>
        </table>
        </td>
        <?
				}
		?>
        </tr>
        </table>
        <br/>
        <?
		$yarn_count_arr=return_library_array( "select id,yarn_count from lib_yarn_count",'id','yarn_count');
		$yarn_sql_array=sql_select("SELECT min(id) as id ,count_id, copm_one_id, percent_one,copm_two_id, percent_two, type_id, sum(cons_qnty) as yarn_required, AVG(rate) as rate from wo_pre_cost_fab_yarn_cost_dtls where job_no='$job_no' and  status_active=1 and is_deleted=0 group by count_id,copm_one_id,percent_one, copm_two_id,percent_two,type_id order by id");
		?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
            <tr>
                <td width="49%" style="border:solid; border-color:#000; border-width:thin" valign="top">
                    <table  width="100%"  border="0" cellpadding="0" cellspacing="0">
                	<thead>
                    	<tr>
                        	<th width="3%"></th><th width="97%" align="left"><u>Special Instruction</u></th>
                        </tr>
                    </thead>
                    <tbody>
                    <?
					$data_array=sql_select("select id, terms from  wo_booking_terms_condition where booking_no=$txt_booking_no");// quotation_id='$data'
					if ( count($data_array)>0)
					{
						$i=0;
						foreach( $data_array as $row )
						{
							$i++;
							?>
                            	<tr id="settr_1" valign="top">
                                    <td style="vertical-align:top">
                                    <? echo $i;?>
                                    </td>
                                    <td>
                                   <strong style="font-size:20px"> <? echo $row[csf('terms')]; ?></strong>
                                    </td>
                                </tr>
                            <?
						}
					}
					/*else
					{
				    $i=0;
					$data_array=sql_select("select id, terms from  lib_terms_condition");// quotation_id='$data'
					foreach( $data_array as $row )
						{
							$i++;
					?>
                    <tr id="settr_1" align="">
                                    <td valign="top">
                                    <? echo $i;?>
                                    </td>
                                    <td>
                                    <? echo $row['terms']; ?>
                                    </td>

                                </tr>
                    <?
						}
					} */
					?>
                </tbody>
                </table>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top" align="center">
                <?
				$yarn_sql_array=sql_select("SELECT min(a.id) as id, a.item_id, sum(a.qnty) as qnty ,min(b.supplier_id) as supplier_id,min(b.lot) as lot from inv_material_allocation_dtls a,product_details_master b where a.item_id=b.id and a.booking_no=$txt_booking_no and  a.status_active=1 and a.is_deleted=0 group by a.item_id order by a.id");
				if(count($yarn_sql_array)>0)
				{
				?>
                   <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td colspan="7"><b>Allocated Yarn</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Yarn Description</td>
                    <td>Brand</td>
                    <td>Lot</td>


                    <td>Allocated Qty (Kg)</td>
                    </tr>
                    <?
					$total_allo=0;
					$item=return_library_array( "select id, product_name_details from   product_details_master",'id','product_name_details');
					$supplier=return_library_array( "select id, short_name from   lib_supplier",'id','short_name');
					//$yarn_sql_array=sql_select("SELECT a.item_id, a.qnty,b.supplier_id,b.lot from inv_material_allocation_dtls a,product_details_master b where a.item_id=b.id and a.booking_no=$txt_booking_no and  a.status_active=1 and a.is_deleted=0");
					$i=0;
					$total_yarn=0;
					foreach($yarn_sql_array  as $row)
                    {

						$i++;
					?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
					<?

					echo $item[$row[csf('item_id')]];
					?>
                    </td>
                    <td>
                    <?

					echo $supplier[$row[csf('supplier_id')]];
					?>
                    </td>
                    <td>
					<?

					echo $row[csf('lot')];
					?>
                    </td>
                    <td align="right"><? echo number_format($row[csf('qnty')],4); $total_allo+= $row[csf('qnty')];?></td>
                    </tr>
                    <?
					}
					?>
                    <tr align="center">
                    <td>Total</td>
                    <td></td>


                    <td></td>
                    <td></td>
                    <td align="right"><? echo number_format($total_allo,4); ?></td>
                    </tr>
                    </table>
                    <?
				}
				else
				{
					$is_yarn_allocated=return_field_value("allocation", "variable_settings_inventory", "company_name=$cbo_company_name and variable_list=18 and item_category_id=1");
					if($is_yarn_allocated==1)
					{
					?>
					<font style=" font-size:30px"><b> Draft</b></font>
                    <?
					}
					else
					{
						echo "";
					}
				}
					?>
                </td>
            </tr>
        </table>
        <br/>
        <table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                   <tr align="center">
                    <td colspan="10"><b>DTM</b></td>
                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Item</td>
                    <td>Body Color</td>
                    <td>Item Color</td>
                    <td>Dyeing Qty.</td>
                    <td>UOM</td>
                    </tr>
                    <?
					$lib_item_group_arr=return_library_array( "select item_name, id from lib_item_group where item_category=4 and is_deleted=0  and  status_active=1 order by item_name", "id", "item_name");
//echo "select a.fabric_color,a.precost_trim_cost_id,b.trim_group,b.cons_uom,sum(qty) as qty   from wo_dye_to_match a, wo_pre_cost_trim_cost_dtls b where a.precost_trim_cost_id=b.id a.booking_no=$txt_booking_no group by a.fabric_color,a.precost_trim_cost_id,b.item_group,b.cons_uom";
$sql=sql_select("select id from wo_booking_mst where booking_no=$txt_booking_no");
$bookingId=0;
foreach($sql as $row){
	$bookingId= $row[csf('id')];
}
					$co=0;
					$sql_data=sql_select("select a.fabric_color,a.item_color,a.precost_trim_cost_id,b.trim_group,b.cons_uom,sum(qty) as qty   from wo_dye_to_match a, wo_pre_cost_trim_cost_dtls b where a.precost_trim_cost_id=b.id and a.booking_id=$bookingId and a.qty>0 group by a.fabric_color,a.item_color,a.precost_trim_cost_id,b.trim_group,b.cons_uom order by a.fabric_color");
					foreach($sql_data  as $row)
                    {
					$co++;
					?>
                    <tr>
                    <td><? echo $co; ?></td>
                    <td> <? echo $lib_item_group_arr[$row[csf('trim_group')]];?></td>
                    <td><? echo $color_library[$row[csf('fabric_color')]];?></td>
                    <td><? echo $color_library[$row[csf('item_color')]];?></td>
                    <td align="right"><? echo $row[csf('qty')];?></td>
                    <td><? echo $unit_of_measurement[$row[csf('cons_uom')]];?></td>
                    </tr>
                    <?

					}
					?>
                    </table>

        <table  width="100%"  border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td width="49%" valign="top">
                   <table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                   <tr align="center">
                    <td colspan="10"><b>Comments</b></td>
                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Po NO</td>
                    <td>Ship Date</td>
                    <td>Pre-Cost Qty</td>
                    <td>Mn.Book Qty</td>
                    <td>Sht.Book Qty</td>
                    <td>Smp.Book Qty</td>
                    <td>Tot.Book Qty</td>
                    <td>Balance</td>
                    <td>Comments</td>
                    </tr>
                    <?
					$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
					$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
					if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
					if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
					$paln_cut_qnty_array=return_library_array( "select min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id,size_number_id,item_number_id,po_break_down_id", "id", "plan_cut_qnty");

					$item_ratio_array=return_library_array( "select gmts_item_id,set_item_ratio from wo_po_details_mas_set_details  where job_no =$txt_job_no", "gmts_item_id", "set_item_ratio");
					$nameArray=sql_select("
					select
					a.id,
					a.item_number_id,
					a.costing_per,
					b.po_break_down_id,
					b.color_size_table_id,
					b.requirment,
					c.po_number
				FROM
					wo_pre_cost_fabric_cost_dtls a,
					wo_pre_cos_fab_co_avg_con_dtls b,
					wo_po_break_down c
				WHERE
					a.job_no=b.job_no and
					a.job_no=c.job_no_mst and
					a.id=b.pre_cost_fabric_cost_dtls_id and
					b.po_break_down_id=c.id and
					b.po_break_down_id in (".str_replace("'","",$txt_order_no_id).")  $cbo_fabric_natu $cbo_fabric_source_cond and a.status_active=1 and a.is_deleted=0
					order by a.id");
					$count=0;
					$tot_grey_req_as_pre_cost_arr=array();
					foreach ($nameArray as $result)
					{
						if (count($nameArray)>0 )
						{
							if($result[csf("costing_per")]==1)
							{
								$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(12*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
							}
							if($result[csf("costing_per")]==2)
							{
								$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(1*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
							}
							if($result[csf("costing_per")]==3)
							{
								$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(24*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
							}
							if($result[csf("costing_per")]==4)
							{
								$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(36*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
							}
							if($result[csf("costing_per")]==5)
							{
								$tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(48*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
							}
							$tot_grey_req_as_pre_cost_arr[$result[csf("po_number")]]+=$tot_grey_req_as_pre_cost;
						}
					}
	                $total_pre_cost=0;
					$total_booking_qnty_main=0;
					$total_booking_qnty_short=0;
					$total_booking_qnty_sample=0;
					$total_tot_bok_qty=0;
					$tot_balance=0;
					/*$booking_qnty=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and booking_type in(1,4)  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by a.po_break_down_id", "po_break_down_id", "grey_fab_qnty");*/
					//$booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and booking_type =1 and is_short=2 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by a.po_break_down_id", "po_break_down_id", "grey_fab_qnty");
					/*$booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and a.is_short=2 and c.item_category=2 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
					$booking_qnty_short=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and booking_type =1 and is_short=1 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by a.po_break_down_id", "po_break_down_id", "grey_fab_qnty");
					$booking_qnty_sample=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and booking_type =4  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by a.po_break_down_id", "po_break_down_id", "grey_fab_qnty");*/

					$booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and a.is_short=2 and c.item_category=2 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

					$booking_qnty_short=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and c.item_category=2 and a.is_short=1 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
					$booking_qnty_sample=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c  where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =4 and c.fabric_source=$cbo_fabric_source and c.item_category=2  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

					$sql_data=sql_select( "select max(a.id) as id,  a.po_number,max(a.pub_shipment_date) as pub_shipment_date,sum(a.plan_cut) as plan_cut  from wo_po_break_down a,wo_pre_cost_sum_dtls b,wo_pre_cost_mst c where a.job_no_mst=b.job_no and a.job_no_mst=c.job_no and a.id in(".str_replace("'","",$txt_order_no_id).") group by a.po_number order by id");
					foreach($sql_data  as $row)
                    {
					$col++;
					?>
                    <tr align="center">
                    <td><? echo $col; ?></td>
                    <td><? echo $row[csf("po_number")]; ?></td>
                     <td><? echo change_date_format($row[csf("pub_shipment_date")],"dd-mm-yyyy",'-'); ?></td>
                    <td align="right"><? echo number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]],2); $total_pre_cost+=$tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]; ?></td>
                    <td align="right"><? echo number_format($booking_qnty_main[$row[csf("id")]],2); $total_booking_qnty_main+=$booking_qnty_main[$row[csf("id")]];?></td>
                    <td align="right"><? echo number_format($booking_qnty_short[$row[csf("id")]],2); $total_booking_qnty_short+=$booking_qnty_short[$row[csf("id")]];?></td>
                    <td align="right"><? echo number_format($booking_qnty_sample[$row[csf("id")]],2); $total_booking_qnty_sample+=$booking_qnty_sample[$row[csf("id")]];?></td>
                    <td align="right"><? $tot_bok_qty=$booking_qnty_main[$row[csf("id")]]+$booking_qnty_short[$row[csf("id")]]+$booking_qnty_sample[$row[csf("id")]]; echo number_format($tot_bok_qty,2); $total_tot_bok_qty+=$tot_bok_qty;?></td>
                    <td align="right">
					<? $balance= def_number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]-$tot_bok_qty,2,""); echo number_format($balance,2); $tot_balance+= $balance?>
                    </td>
                    <td>
					<?
					if( $balance>0)
					{
						echo "Less Booking";
					}
					else if ($balance<0)
					{
						echo "Over Booking";
					}
					else
					{
						echo "";
					}
					?>

                    </td>
                    </tr>
                    <?
					}
					?>
                    <tfoot>
                    <tr>
                    <td colspan="3">Total:</td>
                    <td align="right"><? echo number_format($total_pre_cost,2); ?></td>
                    <td align="right"><? echo number_format($total_booking_qnty_main,2); ?></td>
                    <td align="right"><? echo number_format($total_booking_qnty_short,2); ?></td>
                    <td align="right"><? echo number_format($total_booking_qnty_sample,2); ?></td>
                     <td align="right"><? echo number_format($total_tot_bok_qty,2); ?></td>
                    <td align="right"><? echo number_format($tot_balance,2); ?></td>
                    <td></td>
                    </tr>
                    </tfoot>
                    </table>
                </td>
            </tr>
        </table>
         <!--<br><br><br><br>-->
         <?
		 	//echo signature_table(1, $cbo_company_name, "1330px");
		 ?>
         <fieldset id="div_size_color_matrix" style="max-width:1000;">
        <legend>TNA Information</legend>
        <!--<span style="font-size:180; font-weight:bold;"></span>-->
        <table width="100%" style="border:1px solid black;font-size:12px" border="1" cellpadding="2" cellspacing="0" rules="all">
            <tr>
            	<td rowspan="2" align="center" valign="top">SL</td>
            	<td width="180" rowspan="2"  align="center" valign="top"><b>Order No</b></td>
                <td colspan="2" align="center" valign="top"><b>Yarn Receive</b></td>
                <td colspan="2" align="center" valign="top"><b>Knitting</b></td>
                <td colspan="2" align="center" valign="top"><b>Dyeing</b></td>
                <td colspan="2" align="center" valign="top"><b>Finishing Fabric</b></td>
                <td colspan="2" align="center" valign="top"><b>Cutting </b></td>
                <td colspan="2" align="center" valign="top"><b>Sewing </b></td>
                <td colspan="2"  align="center" valign="top"><b>Ex-factory </b></td>
            </tr>
            <tr>
            	<td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>

            </tr>
            <?
			$i=1;
			foreach($tna_date_task_arr as $order_id=>$row)
			{
				 //$tna_date_task_arr//knitting_start_date dying_start_date finishing_start_date cutting_start_date sewing_start_date exfact_start_date
				?>
                <tr>
                	<td><? echo $i; ?></td>
                    <td><? echo $po_num_arr[$order_id]; ?></td>
                    <td align="center"><? echo change_date_format($row['yarn_rec_start_date']); ?></td>
                    <td  align="center"><? echo change_date_format($row['yarn_rec_end_date']); ?></td>
                	<td align="center"><? echo change_date_format($row['knitting_start_date']); ?></td>
                    <td  align="center"><? echo change_date_format($row['knitting_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['dying_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['dying_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['cutting_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['cutting_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['sewing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['sewing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['exfact_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['exfact_end_date']); ?></td>
                </tr>
                <?
				$i++;
			}
			?>

        </table>
        </fieldset>
         <?
		 $sql = sql_select("select designation,name from variable_settings_signature where report_id=1 and company_id=$cbo_company_name order by sequence_no" );
	     $count=count($sql);

		$width=1330;
		$td_width=floor($width/$count);

		$standard_width=$count*150;

		if($standard_width>$width) $td_width=150;

		$no_coloumn_per_tr=floor($width/$td_width);
		$col=$count-2;
		$i=1;
		echo '<table width="'.$width.'"><tr><td width="'.$td_width.'" align="center" valign="bottom">'.$user_arr[$inserted_by].'</td><td height="70" colspan="'.$col.'"></td><td width="'.$td_width.'" align="center" valign="bottom">'.$user_arr[$nameArray_approved_date_row[csf('approved_by')]].'</td></tr><tr>';
		foreach($sql as $row)
		{
			echo '<td width="'.$td_width.'" align="center" valign="top"><strong style="text-decoration:overline">'.$row[csf("designation")]."</strong><br>".$row[csf("name")].'</td>';

			if($i%$no_coloumn_per_tr==0) echo '</tr><tr><td height="70" colspan="'.$no_coloumn_per_tr.'"></td><tr>';
			$i++;
		}
		echo '</tr></table>';
		?>
		   </div>
<?

}




if($action=="show_fabric_booking_report5")
{
	extract($_REQUEST);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
	$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	//$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
	$marchentrArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info ","id","team_member_name");
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$location_name_arr=return_library_array( "select id,location_name from lib_location",'id','location_name');
	$po_qnty_tot=return_field_value( "sum(plan_cut)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	$po_qnty_tot1=return_field_value( "sum(po_quantity)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	$pro_sub_dept_array=return_library_array( "select id,sub_department_name from lib_pro_sub_deparatment",'id','sub_department_name');
	?>
	<div style="width:1330px" align="center">
    <?php
$nameArray_approved = sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7");
list($nameArray_approved_row) = $nameArray_approved;
$nameArray_approved_date = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
list($nameArray_approved_date_row) = $nameArray_approved_date;
?>										<!--    Header Company Information         -->
       <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black" >
           <tr>
               <td width="100">
               <img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
               </td>
               <td width="1250">
                    <table width="100%" cellpadding="0" cellspacing="0"  >
                        <tr>
                            <td align="center" style="font-size:20px;">
                              <?php
echo $company_library[$cbo_company_name];
?>
                            </td>
                            <td rowspan="3" width="250">

                               <span style="font-size:18px"><b> Job No:&nbsp;&nbsp;<? echo trim($txt_job_no,"'"); ?></b></span><br/>
                                <?
								 if($nameArray_approved_row[csf('approved_no')]>1)
								 {
								 ?>
								 <b> Revised No: <? echo $nameArray_approved_row[csf('approved_no')]-1; ?></b>
                                  <br/>
								  Approved Date: <? echo $nameArray_approved_date_row[csf('approved_date')]; ?>
								  <?
								 }
							  	?>


                            </td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:14px">
                            <?
                            $nameArray=sql_select( "select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
							//$location=return_field_value("location_name","lib_location","id=$data[3]" );
							//$nameArray=sql_select("select location_name from wo_po_details_master where job_no=$txt_job_no");
							if($txt_job_no!="")
							{
							 $location=return_field_value( "location_name", "wo_po_details_master","job_no=$txt_job_no");
							}
							else
							{
							$location="";
							}

							foreach ($nameArray as $result)
                            {
							 echo  $location_name_arr[$location];
                            ?>

                               <!-- Plot No: <? //echo $result[csf('plot_no')]; ?>
                                Level No: <? //echo $result[csf('level_no')]?>
                                Road No: <? //echo $result[csf('road_no')]; ?>
                                Block No: <? //echo $result[csf('block_no')];?>
                                City No: <? //echo $result[csf('city')];?>
                                Zip Code: <? //echo $result[csf('zip_code')]; ?>
                                Province No: <?php //echo $result[csf('province')];?>
                                Country: <? //echo $country_arr[$result[csf('country_id')]]; ?> --><br>
                                Email Address: <? echo $result[csf('email')];?>
                                Website No: <? echo $result[csf('website')]; ?>

                                <?

                            }

                            ?>
                               </td>
                            </tr>
                            <tr>
                            <td align="center" style="font-size:20px">
                                <strong><? if($report_title !=""){ echo $report_title;} else { echo "General Work Order";}?> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style="color:#F00"><? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </font></strong>
                             </td>
                            </tr>
                      </table>
                </td>
            </tr>
       </table>
                <?
				$job_no='';
				$total_set_qnty=0;
				$colar_excess_percent=0;
				$cuff_excess_percent=0;
				$rmg_process_breakdown=0;
                $nameArray=sql_select( "select a.booking_no,a.booking_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.delivery_date,a.po_break_down_id,a.colar_excess_percent,a.cuff_excess_percent,a.delivery_date,a.is_apply_last_update,a.fabric_source,a.rmg_process_breakdown,a.insert_date,a.update_date,b.job_no,b.buyer_name, b.style_ref_no ,b.gmts_item_id,b.order_uom,b.total_set_qnty,b.style_description,b.product_dept,b.product_code,b.pro_sub_dep,b.dealing_marchant from wo_booking_mst a, wo_po_details_master b where  a.job_no=b.job_no and a.booking_no=$txt_booking_no");
				foreach ($nameArray as $result)
				{
					$total_set_qnty=$result[csf('total_set_qnty')];
					$colar_excess_percent=$result[csf('colar_excess_percent')];
				    $cuff_excess_percent=$result[csf('cuff_excess_percent')];
					$rmg_process_breakdown=$result[csf('rmg_process_breakdown')];
					$po_no="";
					$shipment_date="";
					$sql_po= "select po_number,MIN(pub_shipment_date) pub_shipment_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].") group by po_number";
					$data_array_po=sql_select($sql_po);
					foreach ($data_array_po as $row_po)
					{
						$po_no.=$row_po[csf('po_number')].", ";
						$shipment_date.=change_date_format($row_po[csf('pub_shipment_date')],'dd-mm-yyyy','-').", ";
					}
					$lead_time="";
					if($db_type==0)
					{
					$sql_lead_time= "select DATEDIFF(pub_shipment_date,po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}
					if($db_type==2)
					{
					$sql_lead_time= "select (pub_shipment_date-po_received_date) date_diff from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					}
					$data_array_lead_time=sql_select($sql_lead_time);
					foreach ($data_array_lead_time as $row_lead_time)
					{
						$lead_time.=$row_lead_time[csf('date_diff')].",";
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}
					$po_received_date="";
					$sql_po_received_date= "select MIN(po_received_date) as po_received_date from  wo_po_break_down  where id in(".$result[csf('po_break_down_id')].")";
					$data_array_po_received_date=sql_select($sql_po_received_date);
					foreach ($data_array_po_received_date as $row_po_received_date)
					{
						$po_received_date=change_date_format($row_po_received_date[csf('po_received_date')],'dd-mm-yyyy','-');
						//$shipment_date.=change_date_format($row_po['pub_shipment_date'],'dd-mm-yyyy','-').",";
					}
				?>
       <table width="100%" style="border:1px solid black" >
            <tr>
                <td colspan="6" valign="top" style="font-size:18px; color:#F00"><? if($result[csf('is_apply_last_update')]==2){echo "Booking Info not synchronized with order entry and pre-costing. order entry or pre-costing has updated after booking entry.  Contact to ".$marchentrArr[$result[csf('dealing_marchant')]]; } else{ echo "";} ?></td>
            </tr>
            <tr>
                <td width="100"><span style="font-size:18px"><b>Buyer/Agent Name</b></span></td>
                <td width="110">:&nbsp;<span style="font-size:18px"><b><? echo $buyer_name_arr[$result[csf('buyer_name')]]; ?></b></span></td>
                <td width="100"><span style="font-size:12px"><b>Dept.</b></span></td>
                <td width="110">:&nbsp;<? echo $product_dept[$result[csf('product_dept')]] ; if($result[csf('product_code')] !=""){ echo " (".$result[csf('product_code')].")";} if($result[csf('pro_sub_dep')] !=0){ echo " (".$pro_sub_dept_array[$result[csf('pro_sub_dep')]].")";}?></td>
                <td width="100"><span style="font-size:12px"><b>Order Qnty</b></span></td>
                <td width="110">:&nbsp;
				<?  echo $po_qnty_tot1." ".$unit_of_measurement[$result[csf('order_uom')]] ; ?>
                </td>
            </tr>
            <tr>

                <td width="100" style="font-size:12px"><b>Garments Item</b></td>
                <td width="110">:&nbsp;
				<?
				$gmts_item_name="";
				$gmts_item=explode(',',$result[csf('gmts_item_id')]);
				for($g=0;$g<=count($gmts_item); $g++)
				{
					$gmts_item_name.= $garments_item[$gmts_item[$g]].",";
				}
				echo rtrim($gmts_item_name,',');
				?>
                </td>
                <td width="100" style="font-size:12px"><b>Booking Release Date</b></td>
                <td width="110">:&nbsp;
				<?
				$booking_date=$result[csf('update_date')];
				if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
				{
					$booking_date=$result[csf('insert_date')];
				}
				echo change_date_format($booking_date,'dd-mm-yyyy','-','');
				?>&nbsp;&nbsp;&nbsp;</td>
                <td width="100" style="font-size:18px"><b>Style Ref.</b>   </td>
                <td width="110" style="font-size:18px">:&nbsp;<b><? echo $result[csf('style_ref_no')];?> </b>   </td>

            </tr>
             <tr>



                <td  width="100" style="font-size:12px"><b>Style Des.</b></td>
                <td  width="110" >:&nbsp;<? echo $result[csf('style_description')]; $job_no= $result[csf('job_no')];?></td>
                <td width="100" style="font-size:12px"><b>Lead Time </b>   </td>
                <td width="110">:&nbsp;<?  echo rtrim($lead_time,",");;?> </td>
                <td width="100" style="font-size:12px"><b>Dealing Merchant</b></td>
                <td width="110">:&nbsp;<? echo $marchentrArr[$result[csf('dealing_marchant')]]; ?></td>



            </tr>

            <tr>
                <td width="100" style="font-size:12px"><b>Supplier Name</b>   </td>
                <td width="110">:&nbsp;<? echo $supplier_name_arr[$result[csf('supplier_id')]];?>    </td>
                <td width="100" style="font-size:12px"><b>Delivery Date</b></td>
               	<td width="110">:&nbsp;<? echo change_date_format( $result[csf('delivery_date')],'dd-mm-yyyy','-');?></td>
                <td width="100" style="font-size:18px"><b>Booking No </b>   </td>
                <td width="110" style="font-size:18px">:&nbsp;<b><? echo $result[csf('booking_no')];?></b><? echo "(".$fabric_source[$result[csf('fabric_source')]].")"?></td>



            </tr>
            <tr>
                <td width="100" style="font-size:12px"><b>Season</b></td>
                <td width="110">:&nbsp;<? echo $result[csf('season')]; ?></td>
                <td  width="100" style="font-size:12px"><b>Attention</b></td>
                <td  width="110" >:&nbsp;<? echo $result[csf('attention')]; ?></td>
                <td  width="100" style="font-size:12px"><b>Po Received Date</b></td>
                <td  width="110" >:&nbsp;<? echo $po_received_date; ?></td>



            </tr>
           <tr>
               <td width="100" style="font-size:18px"><b>Order No</b></td>
                <td width="110" style="font-size:18px" colspan="5">:&nbsp;<b><? echo rtrim($po_no,", "); ?></b></td>

            </tr>
            <tr>
               <td width="100" style="font-size:12px"><b>Shipment Date</b></td>
                <td width="110" colspan="5"> :&nbsp;<? echo rtrim($shipment_date,", "); ?></td>

            </tr>

        </table>
           <?
			}
	        ?>
     <br/>
      <!--  Here will be the main portion  -->
     <?
	 $costing_per="";
	 $costing_per_qnty=0;
	 $costing_per_id=return_field_value( "costing_per", "wo_pre_cost_mst","job_no ='$job_no'");
	 if($costing_per_id==1)
			{
				$costing_per="1 Dzn";
				$costing_per_qnty=12;

			}
			if($costing_per_id==2)
			{
				$costing_per="1 Pcs";
				$costing_per_qnty=1;

			}
			if($costing_per_id==3)
			{
				$costing_per="2 Dzn";
				$costing_per_qnty=24;

			}
			if($costing_per_id==4)
			{
				$costing_per="3 Dzn";
				$costing_per_qnty=36;

			}
			if($costing_per_id==5)
			{
				$costing_per="4 Dzn";
				$costing_per_qnty=48;

			}
			$process_loss_method=return_field_value( "process_loss_method", "wo_pre_cost_fabric_cost_dtls","job_no='$job_no'");;

	 ?>

     <?

	/*$nameArray_fabric_description= sql_select("SELECT a.color_type_id,a.construction,a.composition,a.gsm_weight,a.dia_width,a.process_loss_percent FROM view_wo_fabric_booking_data_park a,wo_booking_dtls b where b.booking_no =$txt_booking_no and a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and b.status_active=1 and
b.is_deleted=0  group by a.color_type_id,a.construction,a.composition,a.gsm_weight,a.dia_width,process_loss_percent order by a.pre_cost_fabric_cost_dtls_id");*/
if($cbo_fabric_source==1)
{
$nameArray_fabric_description= sql_select("select a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type, b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent , avg(b.requirment) as requirment FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
WHERE a.job_no=b.job_no and
a.id=b.pre_cost_fabric_cost_dtls_id and
c.job_no_mst=a.job_no and
c.id=b.color_size_table_id and
b.po_break_down_id=d.po_break_down_id and
b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
d.booking_no =$txt_booking_no and
d.status_active=1 and
d.is_deleted=0
group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by a.body_part_id,b.dia_width");
	 ?>

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
     <tr align="center">
     <th colspan="3" align="left">Body Part</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
		}
		?>
        <td  rowspan="8" width="50"><p>Total  Finish Fabric <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
        <td  rowspan="8" width="50"><p>Total Grey Fabric <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
        <td  rowspan="8" width="50"><p>Process Loss % </p></td>
       </tr>
     <tr align="center"><th colspan="3" align="left">Color Type</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
		}
		?>
        <!--<td  rowspan="8" width="50"><p>Total  Finish Fabric (KG)</p></td> <td  rowspan="8" width="50"><p>Total Grey Fabric (KG)</p></td>-->
             <!--<td  rowspan="7" width="50"><p>Process Loss % </p></td>-->
       </tr>
        <tr align="center"><th colspan="3" align="left">Fabric Construction</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='2'>&nbsp</td>";
			else         		               echo "<td  colspan='2'>". $result_fabric_description[csf('construction')]."</td>";
		}
		?>


       </tr>
        <tr align="center"><th   colspan="3" align="left">Fabric Composition</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='2' >&nbsp</td>";
			else         		               echo "<td colspan='2' >".$result_fabric_description[csf('composition')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th  colspan="3" align="left">GSM</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='2'>&nbsp</td>";
			else         		       echo "<td colspan='2' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='2'>&nbsp</td>";
			else         		              echo "<td colspan='2' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
		}
		?>

       </tr>

       <tr>
       <th  colspan="<? echo  count($nameArray_fabric_description)*2+3; ?>" align="left" style="height:30px">&nbsp;</th>
       </tr>

       <tr>
            <!--<th  width="120" align="left">Gmts. Color</th>-->
            <th  width="120" align="left">Fabric Color</th>
            <th  width="120" align="left">Body Color</th>
            <th  width="120" align="left">Lab Dip No</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			  echo "<th width='50'>Finish</th><th width='50' >Gray</th>";
		}
		?>

       </tr>
       <?

		  /*$gmt_color_library=return_library_array( "select gmts_color_id,contrast_color_id
		  FROM
		  wo_pre_cos_fab_co_color_dtls
		  WHERE
		  job_no ='$job_no'", "contrast_color_id", "gmts_color_id");*/
		  $gmt_color_library=array();
		  $gmt_color_data=sql_select("select b.gmts_color_id, b.contrast_color_id
		  FROM
		  wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b
		  WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.fabric_source =$cbo_fabric_source and
		  a.job_no ='$job_no'");
		  foreach( $gmt_color_data as $gmt_color_row)
		  {
			$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
		  }

	        $grand_total_fin_fab_qnty=0;
			$grand_total_grey_fab_qnty=0;
			$grand_totalcons_per_finish=0;
			$grand_totalcons_per_grey=0;
			$color_wise_wo_sql=sql_select("select fabric_color_id
										  FROM
										  wo_booking_dtls
										  WHERE
										  booking_no =$txt_booking_no and
										  status_active=1 and
                                          is_deleted=0
										  group by fabric_color_id");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
		?>
			<tr>
           <!-- <td  width="120" align="left">
			<?

			//echo $color_library[$color_wise_wo_result['fabric_color_id']];

			?></td>-->
            <td  width="120" align="left">
			<?
			echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];


			?>
            </td>
            <td>
            <?
			//echo $color_library[$gmt_color_library[$color_wise_wo_result['fabric_color_id']]];
			echo rtrim($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]],",");
			?>
            </td>
            <td  width="120" align="left">
			<?
			$lapdip_no="";
			$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
			//echo "lapdip_no from wo_po_lapdip_approval_info where job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result['fabric_color_id']."";
			if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_grey_fab_qnty=0;

			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
				  FROM
				  view_wo_fabric_booking_data_park a,
				  wo_booking_dtls b
				  WHERE
				  b.booking_no =$txt_booking_no  and
				  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
				  a.po_break_down_id=b.po_break_down_id and
				  a.color_size_table_id=b.color_size_table_id and
				  a.color_type_id='".$result_fabric_description['color_type_id']."' and
				  a.construction='".$result_fabric_description['construction']."' and
				  a.composition='".$result_fabric_description['composition']."' and
				  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
				  a.dia_width='".$result_fabric_description['dia_width']."' and
				  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
				  b.fabric_color_id=".$color_wise_wo_result['fabric_color_id']." and
				  b.status_active=1 and
				  b.is_deleted=0");*/
				if($db_type==0)
				{
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				d.fabric_color_id='".$color_wise_wo_result[csf('fabric_color_id')]."' and
				d.status_active=1 and
				d.is_deleted=0
				");
				}
				if($db_type==2)
				{
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
				d.status_active=1 and
				d.is_deleted=0
				");
				}

				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'>
			<?
			if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;
			$total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('fin_fab_qnty')];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2);
			$total_grey_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
			}
			?>
            </td>
            <?
			}
			?>
            <td align="right"><? echo number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
            <td align="right"><? echo number_format($total_grey_fab_qnty,2); $grand_total_grey_fab_qnty+=$total_grey_fab_qnty;?></td>

            <td align="right">
            <?
			if($process_loss_method==1)
			{
				$process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_fin_fab_qnty)*100;
			}

			if($process_loss_method==2)
			{
				$process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_grey_fab_qnty)*100;
			}
			echo number_format($process_percent,2);

			?>
            </td>
            </tr>
         <?
		}
		?>
        <tr style=" font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Total</strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;?></td><td width='50' align='right' > <? echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2);?></td>
            <?
			}
			?>
            <td align="right"><? echo number_format($grand_total_fin_fab_qnty,2);?></td>
            <td align="right"><? echo number_format($grand_total_grey_fab_qnty,2);?></td>
            <td align="right">
            <?
            if($process_loss_method==1)// markup
			{
				$totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_fin_fab_qnty)*100;
			}

			if($process_loss_method==2) //margin
			{
				$totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_grey_fab_qnty)*100;
			}
			echo number_format($totalprocess_percent,2);
			?>
            </td>
            </tr>
            <tr style="font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

			?>
			<td width='50' align='right'><?  //echo number_format(($color_wise_wo_result_qnty['fin_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td><td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <?
			}
			?>
            <td align="right"><? echo number_format(($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4); $grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4)?></td>
            <td align="right"><? echo number_format(($grand_total_grey_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4);$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4)?></td>
            <td align="right">
            <?
            if($process_loss_method==1)
			{
				$totalprocess_percent_dzn=(($grand_total_grey_fab_qnty_dzn-$grand_total_fin_fab_qnty_dzn)/$grand_total_fin_fab_qnty_dzn)*100;
			}

			if($process_loss_method==2)
			{
				$totalprocess_percent_dzn=(($grand_total_grey_fab_qnty_dzn-$grand_total_fin_fab_qnty_dzn)/$grand_total_grey_fab_qnty_dzn)*100;
			}
			echo number_format($totalprocess_percent_dzn,2);
			?>
            </td>
            </tr>
    </table>
    <?
	}

	if($cbo_fabric_source==2)
	{

$nameArray_fabric_description= sql_select("select a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,min(a.width_dia_type) as width_dia_type , b.dia_width, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent, avg(b.requirment) as requirment  FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
WHERE a.job_no=b.job_no and
a.id=b.pre_cost_fabric_cost_dtls_id and
c.job_no_mst=a.job_no and
c.id=b.color_size_table_id and
b.po_break_down_id=d.po_break_down_id and
b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
d.booking_no =$txt_booking_no and
d.status_active=1 and
d.is_deleted=0
group by a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,b.dia_width order by a.body_part_id,b.dia_width");
	 ?>

     <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
     <tr align="center">
     <th colspan="3" align="left">Body Part</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
			else         		               echo "<td  colspan='3'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
		}
		?>
        <td  rowspan="8" width="50"><p>Total Fabric <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
        <td  rowspan="8" width="50"><p>Avg Rate <? if(trim($cbo_fabric_natu ,"'")==2){echo "(KG)";}else{echo "(Yds)";} ?></p></td>
        <td  rowspan="8" width="50"><p>Amount </p></td>
       </tr>
     <tr align="center"><th colspan="3" align="left">Color Type</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
			else         		               echo "<td  colspan='3'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
		}
		?>
        <!--<td  rowspan="8" width="50"><p>Total  Finish Fabric (KG)</p></td> <td  rowspan="8" width="50"><p>Total Grey Fabric (KG)</p></td>-->
             <!--<td  rowspan="7" width="50"><p>Process Loss % </p></td>-->
       </tr>
        <tr align="center"><th colspan="3" align="left">Fabric Construction</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='3'>&nbsp</td>";
			else         		               echo "<td  colspan='3'>". $result_fabric_description[csf('construction')]."</td>";
		}
		?>


       </tr>
        <tr align="center"><th   colspan="3" align="left">Fabric Composition</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='3' >&nbsp</td>";
			else         		               echo "<td colspan='3' >".$result_fabric_description[csf('composition')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th  colspan="3" align="left">GSM</th>
        <?
		foreach($nameArray_fabric_description  as $result_fabric_description)
		{
			if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		       echo "<td colspan='3' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
		}
		?>

       </tr>
       <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='3'>&nbsp</td>";
			else         		              echo "<td colspan='3' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
		}
		?>

       </tr>

       <tr>
       <th  colspan="<? echo  count($nameArray_fabric_description)*3+3; ?>" align="left" style="height:30px">&nbsp;</th>
       </tr>

       <tr>
            <!--<th  width="120" align="left">Gmts. Color</th>-->
            <th  width="120" align="left">Fabric Color</th>
            <th  width="120" align="left">Body Color</th>
            <th  width="120" align="left">Lab Dip No</th>
        <?
		foreach($nameArray_fabric_description as $result_fabric_description)
		{
			  echo "<th width='50'>Fab. Qty</th><th width='50' >Rate</th><th width='50' >Amount</th>";
		}
		?>

       </tr>
       <?

		  /*$gmt_color_library=return_library_array( "select gmts_color_id,contrast_color_id
		  FROM
		  wo_pre_cos_fab_co_color_dtls
		  WHERE
		  job_no ='$job_no'", "contrast_color_id", "gmts_color_id");*/
		  $gmt_color_library=array();
		  $gmt_color_data=sql_select("select gmts_color_id,contrast_color_id
		  FROM
		  wo_pre_cos_fab_co_color_dtls
		  WHERE
		  job_no ='$job_no'");
		  foreach( $gmt_color_data as $gmt_color_row)
		  {
			//$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]].=$color_library[$gmt_color_row[csf("gmts_color_id")]]."," ;
			$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
		  }

	        $grand_total_fin_fab_qnty=0;
			$grand_total_amount=0;
			//$grand_totalcons_per_finish=0;
			//$grand_totalcons_per_grey=0;
			$color_wise_wo_sql=sql_select("select fabric_color_id
										  FROM
										  wo_booking_dtls
										  WHERE
										  booking_no =$txt_booking_no and
										  status_active=1 and
                                          is_deleted=0
										  group by fabric_color_id");
		foreach($color_wise_wo_sql as $color_wise_wo_result)
	    {
		?>
			<tr>
           <!-- <td  width="120" align="left">
			<?

			//echo $color_library[$color_wise_wo_result['fabric_color_id']];

			?></td>-->
            <td  width="120" align="left">
			<?
			echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];


			?>
            </td>
            <td>
            <?
			//echo $color_library[$gmt_color_library[$color_wise_wo_result['fabric_color_id']]];
			//echo rtrim($gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]],",");
			echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
			?>
            </td>
            <td  width="120" align="left">
			<?
			$lapdip_no="";
			$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
			//echo "lapdip_no from wo_po_lapdip_approval_info where job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result['fabric_color_id']."";
			if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
			?>
            </td>
            <?
			$total_fin_fab_qnty=0;
			$total_amount=0;

			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
				  FROM
				  view_wo_fabric_booking_data_park a,
				  wo_booking_dtls b
				  WHERE
				  b.booking_no =$txt_booking_no  and
				  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
				  a.po_break_down_id=b.po_break_down_id and
				  a.color_size_table_id=b.color_size_table_id and
				  a.color_type_id='".$result_fabric_description['color_type_id']."' and
				  a.construction='".$result_fabric_description['construction']."' and
				  a.composition='".$result_fabric_description['composition']."' and
				  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
				  a.dia_width='".$result_fabric_description['dia_width']."' and
				  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
				  b.fabric_color_id=".$color_wise_wo_result['fabric_color_id']." and
				  b.status_active=1 and
				  b.is_deleted=0");*/
				if($db_type==0)
				{
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,d.rate avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
				d.status_active=1 and
				d.is_deleted=0
				");
				}
				if($db_type==2)
				{

				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
				WHERE a.job_no=b.job_no and
				a.id=b.pre_cost_fabric_cost_dtls_id and
				c.job_no_mst=a.job_no and
				c.id=b.color_size_table_id and
				b.po_break_down_id=d.po_break_down_id and
				b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
				d.booking_no =$txt_booking_no and
				a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
				a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
				a.construction='".$result_fabric_description[csf('construction')]."' and
				a.composition='".$result_fabric_description[csf('composition')]."' and
				a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
				b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
				nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
				d.status_active=1 and
				d.is_deleted=0
				");
				}
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'>
			<?
			if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;
			$total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('fin_fab_qnty')];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			if($color_wise_wo_result_qnty[csf('rate')]!="")
			{
			echo number_format($color_wise_wo_result_qnty[csf('rate')],2);
			//$total_grey_fab_qnty+=$color_wise_wo_result_qnty['grey_fab_qnty'];
			}
			?>
            </td>
            <td width='50' align='right' >
			<?
			$amount=$color_wise_wo_result_qnty[csf('fin_fab_qnty')]*$color_wise_wo_result_qnty[csf('rate')];
			if($amount!="")
			{
			echo number_format($amount,2);
			$total_amount+=$amount;
			}
			?>
            </td>
            <?
			}
			?>
            <td align="right"><? echo number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
            <td align="right"><? echo number_format($total_amount/$total_fin_fab_qnty,2); $grand_total_amount+=$total_amount;?></td>

            <td align="right">
            <?
			echo number_format($total_amount,2);

			?>
            </td>
            </tr>
         <?
		}
		?>
        <tr style=" font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Total</strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,

												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
			?>
			<td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;?></td>
            <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
            <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
            <?
			}
			?>
            <td align="right"><? echo number_format($grand_total_fin_fab_qnty,2);?></td>
            <td align="right"><? echo number_format($grand_total_amount/$grand_total_fin_fab_qnty,2);?></td>
            <td align="right">
            <?
			echo number_format($grand_total_amount,2);
			?>
            </td>
            </tr>
            <tr style="font-weight:bold">
        <!--<td  width="120" align="left">&nbsp;</td>-->
        <th  width="120" align="left">&nbsp;</th>
        <td  width="120" align="left">&nbsp;</td>
        <td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
        <?
			foreach($nameArray_fabric_description as $result_fabric_description)
		    {
				/*$color_wise_wo_sql_qnty=sql_select("select sum(b.fin_fab_qnty) as fin_fab_qnty,sum(b.grey_fab_qnty) as grey_fab_qnty
												  FROM
												  view_wo_fabric_booking_data_park a,
												  wo_booking_dtls b
												  WHERE
												  b.booking_no =$txt_booking_no  and
												  a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and
												  a.po_break_down_id=b.po_break_down_id and
												  a.color_size_table_id=b.color_size_table_id and
												  a.color_type_id='".$result_fabric_description['color_type_id']."' and
												  a.construction='".$result_fabric_description['construction']."' and
												  a.composition='".$result_fabric_description['composition']."' and
												  a.gsm_weight='".$result_fabric_description['gsm_weight']."' and
												  a.dia_width='".$result_fabric_description['dia_width']."' and
												  a.process_loss_percent='".$result_fabric_description['process_loss_percent']."' and
												  b.status_active=1 and
												  b.is_deleted=0
												  ");*/
				$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
												WHERE a.job_no=b.job_no and
												a.id=b.pre_cost_fabric_cost_dtls_id and
												c.job_no_mst=a.job_no and
												c.id=b.color_size_table_id and
												b.po_break_down_id=d.po_break_down_id and
												b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
												d.booking_no =$txt_booking_no and
												a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
												a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
												a.construction='".$result_fabric_description[csf('construction')]."' and
												a.composition='".$result_fabric_description[csf('composition')]."' and
												a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
												b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
												d.status_active=1 and
												d.is_deleted=0
												");
				list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty

			?>
			<td width='50' align='right'><?  //echo number_format(($color_wise_wo_result_qnty['fin_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td>
            <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
            <?
			}
			?>
            <td align="right">
			<?
			$consumption_per_unit_fab=($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
			echo "(".$grand_total_fin_fab_qnty."/".$po_qnty_tot.")*(".$total_set_qnty."*".$costing_per_qnty.")";
			echo number_format($consumption_per_unit_fab,4);
			//$grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty),4)
			?>
            </td>
            <td align="right">
			<?
			$consumption_per_unit_amuont=($grand_total_amount/$po_qnty_tot)*($total_set_qnty*$costing_per_qnty);
			echo number_format(($consumption_per_unit_amuont/$consumption_per_unit_fab),2);
			//$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4)
			?>
            </td>
            <td align="right">
            <?
			echo number_format($consumption_per_unit_amuont,2);
			?>
            </td>
            </tr>
    </table>
    <?
	}
	?>
        <br/>
        <?
		if($cbo_fabric_source==1){
		?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td width="49%" style="border:solid; border-color:#000; border-width:thin" valign="top">
                    <table  width="100%"  border="0" cellpadding="0" cellspacing="0">
                	<thead>
                    	<tr>
                        	<th width="3%"></th><th width="97%" align="left"><u>Special Instruction</u></th>
                        </tr>
                    </thead>
                    <tbody>
                    <?
					$data_array=sql_select("select id, terms from  wo_booking_terms_condition where booking_no=$txt_booking_no");// quotation_id='$data'
					if ( count($data_array)>0)
					{
						$i=0;
						foreach( $data_array as $row )
						{
							$i++;
							?>
                            	<tr id="settr_1" valign="top">
                                    <td style="vertical-align:top">
                                    <? echo $i;?>
                                    </td>
                                    <td>
                                   <strong style="font-size:20px"> <? echo $row[csf('terms')]; ?></strong>
                                    </td>
                                </tr>
                            <?
						}
					}
					?>
                </tbody>
                </table>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top">

                </td>

            </tr>
        </table>
        <?
		}// fabric Source End
		?>

         <?
		 	echo signature_table(1, $cbo_company_name, "1330px");
		 ?>

       </div>
       <?

}

if($action=="create_file")
{
	$content=$data;
	$file=fopen("welcome.html","w+");
	fwrite($file,$data);
	$file = 'welcome.html';
}


if($action=="download_file")
{
	extract($_REQUEST);
	set_time_limit(0);
	$file_path=$_REQUEST['filename'];
	download_start($file_path, ''.$_REQUEST['filename'].'', 'text/plain');
}

function download_start($file, $name, $mime_type='')
{
	if(file_exists($file))
	{
		echo "file found";
	}
	else
	{
    	die('File not found');
	}

	//Check the file exist or not
	if(!is_readable($file)) die('File not found or inaccessible!');
	$size = filesize($file);
	$name = rawurldecode($name);
	/* MIME type check*/
	$known_mime_types=array(
	  "pdf" => "application/pdf",
	  "txt" => "text/plain",
	  "html" => "text/html",
	  "htm" => "text/html",
	  "exe" => "application/octet-stream",
	  "zip" => "application/zip",
	  "doc" => "application/msword",
	  "xls" => "application/vnd.ms-excel",
	  "ppt" => "application/vnd.ms-powerpoint",
	  "gif" => "image/gif",
	  "png" => "image/png",
	  "jpeg"=> "image/jpg",
	  "jpg" =>  "image/jpg",
	  "php" => "text/plain"
	);

	if($mime_type=='')
	{
		$file_extension = strtolower(substr(strrchr($file,"."),1));
		if(array_key_exists($file_extension, $known_mime_types))
		{
		$mime_type=$known_mime_types[$file_extension];
	    }
		else
		{
			$mime_type="application/force-download";
		}
    }
	//turn off output buffering to decrease cpu usage
	@ob_end_clean();
	// required for IE Only
	if(ini_get('zlib.output_compression'))
	ini_set('zlib.output_compression', 'Off');
	header('Content-Type: ' . $mime_type);
	header('Content-Disposition: attachment; filename="'.$name.'"');
	header("Content-Transfer-Encoding: binary");
	header('Accept-Ranges: bytes');
	/*non-cacheable */
	header("Cache-control: private");
	header('Pragma: private');
	header("Expires: Tue, 15 May 1984 12:00:00 GMT");

	// multipart-download and download resuming support
	if(isset($_SERVER['HTTP_RANGE']))
	{
		list($a, $range) = explode("=",$_SERVER['HTTP_RANGE'],2);
		list($range) = explode(",",$range,2);
		list($range, $range_end) = explode("-", $range);
		$range=intval($range);
		if(!$range_end) {
		 $range_end=$size-1;
		} else {
		 $range_end=intval($range_end);
		}
		$new_length = $range_end-$range+1;
		header("HTTP/1.1 206 Partial Content");
		header("Content-Length: $new_length");
		header("Content-Range: bytes $range-$range_end/$size");
	} else {
		$new_length=$size;
		header("Content-Length: ".$size);
	}

	/* Will output the file itself */
	$chunksize = 1*(1024*1024); //you may want to change this
	$bytes_send = 0;
	if ($file = fopen($file, 'r')){
	if(isset($_SERVER['HTTP_RANGE']))
	fseek($file, $range);

	while(!feof($file) && (!connection_aborted()) && ($bytes_send<$new_length))
	{
		$buffer = fread($file, $chunksize);
		print($buffer); //echo($buffer); // can also possible
		flush();
		$bytes_send += strlen($buffer);
	}
	fclose($file);
	} else
	//If no permissiion
	die('Error - can not open file.');
	//die
	die();
}


if ($action=="unapp_request_popup")
{
	$menu_id=$_SESSION['menu_id'];
	$user_id=$_SESSION['logic_erp']['user_id'];

	echo load_html_head_contents("Un Approval Request","../../../", 1, 1, $unicode);
	extract($_REQUEST);

	$data_all=explode('_',$data);
	$booking_no=$data_all[0];
	$unapp_request=$data_all[1];

	$wo_id=return_field_value("id", "wo_booking_mst", "booking_no='$booking_no' and status_active=1 and is_deleted=0");

	if($unapp_request=="")
	{
		$sql_request="select MAX(id) as id from fabric_booking_approval_cause where page_id='$menu_id' and entry_form=7 and user_id='$user_id' and booking_id='$wo_id' and approval_type=2 and status_active=1 and is_deleted=0";


		$nameArray_request=sql_select($sql_request);
		foreach($nameArray_request as $row)
		{
			$id_up=$row[csf('id')];
			$unapp_request=return_field_value("approval_cause", "fabric_booking_approval_cause", "id='".$row[csf('id')]."' and status_active=1 and is_deleted=0");
		}
	}

	//echo $booking_no.'_'.$unapp_request;


	?>
    <script>

		$( document ).ready(function() {
			document.getElementById("unappv_request").value='<? echo $unapp_request; ?>';
		});

		var permission='<? echo $permission; ?>';

		function fnc_appv_entry(operation)
		{
			var unappv_request = $('#unappv_request').val();

			if (form_validation('unappv_request','Un Approval Request')==false)
			{
				if (unappv_request=='')
				{
					alert("Please write request.");
				}
				return;
			}
			else
			{

				var data="action=save_update_delete_unappv_request&operation="+operation+get_submitted_data_string('unappv_request*wo_id*page_id*user_id*cause_id',"../../../");
				//alert (data);return;
				freeze_window(operation);
				http.open("POST","fabric_booking_controller.php",true);
				http.setRequestHeader("Content-type","application/x-www-form-urlencoded");
				http.send(data);
				http.onreadystatechange=fnc_appv_entry_Reply_info;
			}
		}

		function fnc_appv_entry_Reply_info()
		{
			if(http.readyState == 4)
			{
				// alert(http.responseText);//return;
				var reponse=trim(http.responseText).split('**');
				show_msg(reponse[0]);
				$('#cause_id').val(reponse[5]);

				set_button_status(1, permission, 'fnc_appv_entry',1);
				release_freezing();

				//generate_worder_mail(reponse[2],reponse[3],reponse[4],reponse[5]);
			}
		}

		function fnc_close()
		{
			unappv_request= $("#unappv_request").val();

			document.getElementById('hidden_appv_cause').value=unappv_request;

			parent.emailwindow.hide();
		}

    </script>
    <body>
		<div align="center" style="width:100%;">
        <? echo load_freeze_divs ("../../",$permission,1); ?>
        <form name="size_1" id="size_1">
			<fieldset style="width:450px;">
            <table align="center" cellspacing="0" width="450" class="rpt_table" border="1" rules="all" id="size_tbl" >
                <tr id="row_1">
                    <td width="150" align="center" >
                    	<textarea name="unappv_request" id="unappv_request" class="text_area" style="width:430px; height:100px;" maxlength="500" title="Maximum 500 Character"></textarea>
                        <Input type="hidden" name="wo_id" class="text_boxes" ID="wo_id" value="<? echo $wo_id; ?>" style="width:30px" />
                        <Input type="hidden" name="page_id" class="text_boxes" ID="page_id" value="<? echo $menu_id; ?>" style="width:30px" />
                        <Input type="hidden" name="user_id" class="text_boxes" ID="user_id" value="<? echo $user_id; ?>" style="width:30px" />
                        <Input type="hidden" name="cause_id" class="text_boxes" ID="cause_id" value="<? echo $id_up; ?>" style="width:30px" />
                    </td>
                </tr>
            </table>

            <table align="center" cellspacing="0" width="450" class="rpt_table" border="1" rules="all" id="" >

                <tr>
                    <td align="center" class="button_container">
                        <?
						//print_r ($id_up_all);
                            if($id_up!='')
                            {
                                echo load_submit_buttons($permission, "fnc_appv_entry", 1,0,"reset_form('size_1','','','','','');",1);
                            }
                            else
                            {
                                echo load_submit_buttons($permission, "fnc_appv_entry", 0,0,"reset_form('size_1','','','','','');",1);
                            }
                        ?>
                        <input type="hidden" name="hidden_appv_cause" id="hidden_appv_cause" class="text_boxes /">

                    </td>
                </tr>
                <tr>
                    <td align="center">
                        <input type="button" name="close" class="formbutton" value="Close" id="main_close" onClick="fnc_close();" style="width:100px" />
                    </td>
                </tr>
            </table>
            </fieldset>
            </form>
        </div>
    </body>
    <script src="../../../includes/functions_bottom.js" type="text/javascript"></script>
    </html>
    <?
	exit();
}



if ($action=="save_update_delete_unappv_request")
{

	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));


	//echo "shajjad_".$unappv_request.'_'.$wo_id.'_'.$page_id.'_'.$user_id; die;

	if ($operation==0)  // Insert Here
	{
		$con = connect();
		if($db_type==0)
		{
			mysql_query("BEGIN");
		}

		$approved_no=return_field_value("MAX(approved_no)","approval_history","entry_form=7 and mst_id=$wo_id");

		$unapproved_request=return_field_value("id","fabric_booking_approval_cause","page_id=$page_id and entry_form=7 and user_id=$user_id and booking_id=$wo_id and approval_type=2 and approval_no=$approved_no");

		if($unapproved_request=="")
		{

			$id_mst=return_next_id( "id", "fabric_booking_approval_cause", 1 ) ;

			$field_array="id,page_id,entry_form,user_id,booking_id,approval_type,approval_no,approval_cause,inserted_by,insert_date,status_active,is_deleted";
			$data_array="(".$id_mst.",".$page_id.",7,".$user_id.",".$wo_id." ,2,".$approved_no.",".$unappv_request.",".$_SESSION['logic_erp']['user_id'].",'".$pc_date_time."',1,0)";
			$rID=sql_insert("fabric_booking_approval_cause",$field_array,$data_array,0);
			//echo $rID; die;

			if($db_type==0)
			{
				if($rID )
				{
					mysql_query("COMMIT");
					echo "0**".$rID."**".str_replace("'","",$wo_id)."**".str_replace("'","",$unappv_request)."**".str_replace("'","",$user_id)."**".str_replace("'","",$id_mst);
				}
				else
				{
					mysql_query("ROLLBACK");
					echo "10**".$rID;
				}
			}
			if($db_type==2)
			{
				if($rID )
				{
					oci_commit($con);
					echo "0**".$rID."**".str_replace("'","",$wo_id)."**".str_replace("'","",$unappv_request)."**".str_replace("'","",$user_id)."**".str_replace("'","",$id_mst);
				}
				else
				{
					oci_rollback($con);
					echo "10**".$rID;
				}
			}
			if($db_type==1 )
			{

				echo "0**".$rID."**".$wo_id;
			}
			disconnect($con);
			die;
		}
		else
		{
			$con = connect();
			if($db_type==0)
			{
				mysql_query("BEGIN");
			}

			$field_array="approval_no*approval_cause*updated_by*update_date*status_active*is_deleted";
			$data_array="".$approved_no."*".$unappv_request."*".$_SESSION['logic_erp']['user_id']."*'".$pc_date_time."'*1*0";
			//echo "10**".$data_array;
			$rID=sql_update("fabric_booking_approval_cause",$field_array,$data_array,"id","".$cause_id."",0);

			if($db_type==0)
			{
				if($rID )
				{
					mysql_query("COMMIT");
					echo "1**".$rID."**".str_replace("'","",$wo_id)."**".str_replace("'","",$unappv_request)."**".str_replace("'","",$user_id)."**".str_replace("'","",$cause_id);
				}
				else
				{
					mysql_query("ROLLBACK");
					echo "10**".$rID;
				}
			}

			if($db_type==2)
			{
				if($rID )
				{
					oci_commit($con);
					echo "1**".$rID."**".str_replace("'","",$wo_id)."**".str_replace("'","",$unappv_request)."**".str_replace("'","",$user_id)."**".str_replace("'","",$cause_id);
				}
				else
				{
					oci_rollback($con);
					echo "10**".$rID;
				}
			}
			if($db_type==1 )
			{
				echo "1**".$rID."**".str_replace("'","",$wo_id);
			}
			disconnect($con);
			die;
		}
	}
	else if ($operation==1)  // Update Here
	{
		$con = connect();
		if($db_type==0)
		{
			mysql_query("BEGIN");
		}

		$field_array="approval_no*approval_cause*updated_by*update_date*status_active*is_deleted";
		$data_array="'".$approved_no."'*".$unappv_request."*".$_SESSION['logic_erp']['user_id']."*'".$pc_date_time."'*1*0";
		//echo "10**";
		$rID=sql_update("fabric_booking_approval_cause",$field_array,$data_array,"id","".$cause_id."",0);
		//echo $rID;
		if($db_type==0)
		{
			if($rID )
			{
				mysql_query("COMMIT");
				echo "1**".$rID."**".str_replace("'","",$wo_id)."**".str_replace("'","",$unappv_request)."**".str_replace("'","",$user_id)."**".str_replace("'","",$cause_id);
			}
			else
			{
				mysql_query("ROLLBACK");
				echo "10**".$rID;
			}
		}
		else if($db_type==2)
		{
			if($rID )
			{
				oci_commit($con);
				echo "1**".$rID."**".str_replace("'","",$wo_id)."**".str_replace("'","",$unappv_request)."**".str_replace("'","",$user_id)."**".str_replace("'","",$cause_id);
			}
			else
			{
				oci_rollback($con);
				echo "10**".$rID;
			}
		}
		disconnect($con);
		die;
	}
}
?>