<?
header('Content-type:text/html; charset=utf-8');
session_start();
include('../../../includes/common.php');

include('../../../includes/class4/class.conditions.php');
include('../../../includes/class4/class.reports.php');
include('../../../includes/class4/class.fabrics.php');
include('../../../includes/class4/class.yarns.php');
include('../../../includes/class4/class.trims.php');
include('../../../includes/class4/class.emblishments.php');
include('../../../includes/class4/class.washes.php');


$user_id = $_SESSION['logic_erp']["user_id"];
if( $_SESSION['logic_erp']['user_id'] == "" ) { header("location:login.php"); die; }
$permission=$_SESSION['page_permission'];

$data=$_REQUEST['data'];
$action=$_REQUEST['action'];
$department_library=return_library_array( "select id,department_name from lib_department", "id", "department_name"  );
$season_library=return_library_array( "select id,season_name from lib_buyer_season", "id", "season_name"  );

if($action=="report_formate_setting")
{
	
	$print_report_format=return_field_value("format_id","lib_report_template","template_name in($data) and module_id=2 and report_id=193 and is_deleted=0 and status_active=1");
	//echo "print_report_button_setting('$print_report_format');\n";	
	echo trim($print_report_format); 
	exit();
}

if($action=="load_drop_down_buyer")
{
	echo create_drop_down( "cbo_buyer_id", 100, "select buy.id, buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company in($data) $buyer_cond and buy.id in (select buyer_id from lib_buyer_party_type where party_type in (1,3,21,90)) order by buy.buyer_name","id,buyer_name", 1, "-Select Buyer-", $selected, "load_drop_down('requires/wo_or_fabric_booking_report_controller',this.value, 'load_drop_down_season_buyer', 'season_td');" );   
	
	exit();
}
if ($action=="load_drop_down_season_buyer")
{
	echo create_drop_down( "cbo_season_id", 100, "select id, season_name from lib_buyer_season where buyer_id in ('$data') and status_active =1 and is_deleted=0 order by season_name ASC","id,season_name", 1, "-- Select Season--", "", "" );
	exit();
}

if($action=="job_no_popup")
{
	echo load_html_head_contents("Job Info", "../../../", 1, 1,'','','');
	extract($_REQUEST);
	list($companyID,$buyer_name,$cbo_year_id)=explode('_',$data);
	?>
	<script>
	
	function js_set_value( job_id )
	{
		//alert(job_id)
		document.getElementById('txt_job_id').value=job_id;
		parent.emailwindow.hide();
	}
    </script>
    </head>
    <body>
    <div align="center">
        <form name="styleRef_form" id="styleRef_form">
		<fieldset style="width:580px;">
            <table width="570" cellspacing="0" cellpadding="0" border="1" rules="all" align="center" class="rpt_table" id="tbl_list">
            	<thead>
                    <th>Buyer</th>
                    <th>Search By</th>
                    <th id="search_by_td_up" width="170">Please Enter Job No</th>
                    <th><input type="reset" name="button" class="formbutton" value="Reset" style="width:100px;" onClick="reset_form('styleRef_form','search_div','','','','');"></th> 					<input type="hidden" name="hide_job_id" id="hide_job_id" value="" />
                    <input type="hidden" name="hide_job_no" id="hide_job_no" value="" />
                </thead>
                <tbody>
                	<tr>
                        <td align="center">
                        	 <? 
								echo create_drop_down( "cbo_buyer_name", 140, "select buy.id, buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company=$companyID $buyer_cond and buy.id in (select buyer_id from lib_buyer_party_type where party_type in (1,3,21,90)) order by buy.buyer_name","id,buyer_name",1, "-- All Buyer--",$buyer_name,"",0 );
							?>
                        </td>                 
                        <td align="center">	
                    	<?
                       		$search_by_arr=array(1=>"Job No",2=>"Style Ref");
							$dd="change_search_event(this.value, '0*0', '0*0', '../../') ";							
							echo create_drop_down( "cbo_search_by", 130, $search_by_arr,"",0, "--Select--", "",$dd,0 );
						?>
                        </td>     
                        <td align="center" id="search_by_td">				
                            <input type="text" style="width:130px" class="text_boxes" name="txt_search_common" id="txt_search_common" />	
                        </td> 	
                        <td align="center">
                        	<input type="button" name="button" class="formbutton" value="Show" onClick="show_list_view ('<? echo $companyID; ?>'+'**'+document.getElementById('cbo_buyer_name').value+'**'+document.getElementById('cbo_search_by').value+'**'+document.getElementById('txt_search_common').value+'**'+'<? echo $cbo_year_id; ?>', 'job_no_popup_search_list_view', 'search_div', 'wo_or_fabric_booking_report_controller', 'setFilterGrid(\'list_view\',-1)');" style="width:100px;" />
                    </td>
                    </tr>
            	</tbody>
           	</table>
            <div style="margin-top:15px" id="search_div"></div>
		</fieldset>
	</form>
    </div>
    </body>           
    <script src="../../../includes/functions_bottom.js" type="text/javascript"></script>
    </html>
    <?
	exit(); 
}

if ($action=="job_no_popup_search_list_view")
{
	//echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode);
	extract($_REQUEST);
	list($companyID,$buyer_name,$search_type,$search_value,$cbo_year_id)=explode('**',$data);
	?>	
     <input type="hidden" id="txt_job_id" />
 	<?
	if ($companyID==0) $company_id=""; else $company_id=" and company_name=$companyID";
	if ($buyer_name==0) $buyer_id=""; else $buyer_id=" and buyer_name=$buyer_name";
	if($db_type==0)
	{
		if ($cbo_year_id==0) $year_id_cond=""; else $year_id_cond=" and YEAR(insert_date)=$cbo_year_id";
	}
	elseif($db_type==2)
	{
		if ($cbo_year_id==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(insert_date,'YYYY')=$cbo_year_id";
	}
	
	if($db_type==0)
	{
		$year=" YEAR(insert_date) as year";
	}
	elseif($db_type==2)
	{
		$year=" TO_CHAR(insert_date,'YYYY') as year";
	}
	
	if($search_type==1 && $search_value!=''){
		$search_con=" and job_no like('%$search_value')";	
	}
	else if($search_type==2 && $search_value!=''){
		$search_con=" and style_ref_no like('%$search_value%')";	
	}
	
	
	
	$buyerArr = return_library_array("select id,buyer_name from lib_buyer ","id","buyer_name");
	
	$sql= "select id, job_no, $year, job_no_prefix_num, style_ref_no, buyer_name, style_description from wo_po_details_master where status_active=1 and is_deleted=0 $company_id $buyer_id $search_con $year_id_cond order by id DESC";
	
	$arr=array(3=>$buyerArr);
	echo  create_list_view("list_view", "Job No,Year,Style Ref.,Buyer,Style Description", "70,70,130,140,170","630","320",0, $sql , "js_set_value", "id,job_no", "", 1, "0,0,0,buyer_name,0", $arr , "job_no_prefix_num,year,style_ref_no,buyer_name,style_description", "",'setFilterGrid("list_view",-1);','0,0,0,0,0','') ;
	
	exit();
}

if($action=="wo_no_popup")
{
  	echo load_html_head_contents("Order Info","../../../", 1, 1, '','1','');
	extract($_REQUEST);
	$ex_data=explode('_',$data);
	$company_id=$ex_data[0];
	$buyer_id=$ex_data[1];
	$year_id=$ex_data[2];
	$category_id=$ex_data[3];
	$wo_type=$ex_data[4];
 ?>
	<script>
		function js_set_value(wo_id,wo_no)
		{
			document.getElementById('txt_wo_no').value=wo_no;
			document.getElementById('txt_wo_id').value=wo_id;
			parent.emailwindow.hide();
		}
    </script>
	</head>
	<body>
		<fieldset style="width:620px;margin-left:10px">
        <form name="searchorderfrm_1"  id="searchorderfrm_1" autocomplete="off">
            <table cellpadding="0" cellspacing="0" border="1" rules="all" width="620" class="rpt_table">
                <thead>
                    <th>Buyer</th>
                    <th>Search</th>
                    <th>
                        <input type="reset" name="reset" id="reset" value="Reset" style="width:100px" class="formbutton" />
                        <input type="hidden" name="txt_wo_no" id="txt_wo_no" value="" style="width:50px">
                        <input type="hidden" name="txt_wo_id" id="txt_wo_id" value="" style="width:50px">
                    </th> 
                </thead>
                <tr class="general">
                    <td align="center">
                        <?
							echo create_drop_down( "cbo_buyer_id", 130, "select buy.id, buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company='$company_id' $buyer_cond and buy.id in (select buyer_id from lib_buyer_party_type where party_type in (1,3,21,90)) order by buy.buyer_name","id,buyer_name", 1, "--Select Buyer--", $buyer_id, "" );   	 
                        ?>       
                    </td>
                    <td align="center">				
                        <input type="text" style="width:150px" class="text_boxes"  name="txt_search_common" id="txt_search_common" />	
                    </td> 						
                    <td align="center">
                        <input type="button" name="button2" class="formbutton" value="Show" onClick="show_list_view ( document.getElementById('cbo_buyer_id').value+'_'+<? echo $company_id; ?>+'_'+document.getElementById('txt_search_common').value+'_'+<? echo $year_id; ?>+'_'+<? echo $category_id; ?>+'_'+<? echo $wo_type; ?>, 'create_wo_search_list_view', 'search_div', 'wo_or_fabric_booking_report_controller', 'setFilterGrid(\'list_view\',-1);')" style="width:100px;" />
                    </td>
                </tr>
            </table>
            <div id="search_div" style="margin-top:10px"></div>   
        </form>
    </fieldset>
</body>           
<script src="../../../includes/functions_bottom.js" type="text/javascript"></script>
</html>
<?
}

if ($action=="create_wo_search_list_view")
{
	$data=explode('_',$data);//var_dump($data);
	$item_category=$data[4];
	if($item_category==2 || $item_category==3 || $item_category==4 || $item_category==12 || $item_category==25)
	{
		if ($data[0]==0) $buyer_id=""; else $buyer_id=" and buyer_id=$data[0]";
		if ($data[1]==0) $company_id=""; else $company_id=" and company_id=$data[1]";
		if ($data[2]==0) $search_wo=""; else $search_wo=" and booking_no_prefix_num=$data[2]";
		
		
		if($db_type==0)
		{
			if ($data[3]==0) $year_id_cond=""; else $year_id_cond=" and YEAR(insert_date)=$data[3]";
		}
		elseif($db_type==2)
		{
			if ($data[3]==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(insert_date,'YYYY')=$data[3]";
		}
		
		if ($data[4]==0) $category_id_cond=""; else $category_id_cond=" and item_category=$data[4]";
		if ($data[5]==1 || $data[5]==2)  $wo_type_cond=" and booking_type in (1,2,3) and is_short='$data[5]'"; else $wo_type_cond="";
		if ($data[5]==3) $wo_type_cond_sam="  and booking_type=4"; else $wo_type_cond_sam="";
		
		if($db_type==0)
		{
			$year=" YEAR(insert_date) as year";
		}
		elseif($db_type==2)
		{
			$year=" TO_CHAR(insert_date,'YYYY') as year";
		}
		
		$buyerArr = return_library_array("select id,buyer_name from lib_buyer ","id","buyer_name");
		if($data[5]==0)
		{
			$sql= "select id, booking_no, $year, booking_no_prefix_num, booking_date, buyer_id, booking_type, is_short, 0 as type from wo_booking_mst where status_active=1 and is_deleted=0 $company_id $buyer_id $year_id_cond $search_wo $category_id_cond $wo_type_cond $wo_type_cond_sam
			union all
			SELECT id, booking_no, $year, booking_no_prefix_num, booking_date, buyer_id, booking_type, is_short, 1 as type from wo_non_ord_samp_booking_mst where status_active=1 and is_deleted=0 $company_id $buyer_id $year_id_cond $search_wo $category_id_cond order by id Desc";
		}
		else if ($data[5]==1 || $data[5]==2 || $data[5]==3)
		{
			$sql= "select id, booking_no, $year, booking_no_prefix_num, booking_date, buyer_id, booking_type, is_short, 0 as type from wo_booking_mst where status_active=1 and is_deleted=0 $company_id $buyer_id $year_id_cond $search_wo $category_id_cond $wo_type_cond $wo_type_cond_sam order by id Desc";
		}
		else
		{
			$sql= "SELECT id, booking_no, $year, booking_no_prefix_num, booking_date, buyer_id, booking_type, is_short, 1 as type from wo_non_ord_samp_booking_mst where status_active=1 and is_deleted=0 $company_id $buyer_id $year_id_cond $search_wo $category_id_cond order by id Desc";
		}
		//echo $sql;
	 ?>
		<div>
			<table cellspacing="0" cellpadding="0" border="1" rules="all" width="600" class="rpt_table" >
				<thead>
					<th width="30">SL</th>
					<th width="80">WO No </th>
					<th width="80">Year</th>
					<th width="130">WO Type</th>
					<th width="150">Buyer</th>
					<th width="100">WO Date</th>
				</thead>
			</table>
			<div style="width:618px; overflow-y:scroll; max-height:300px;" id="" align="center">
				<table cellspacing="0" cellpadding="0" border="1" rules="all" width="600" class="rpt_table" id="list_view" >
				<?
					$i=1;
					$nameArray=sql_select( $sql );
					foreach ($nameArray as $selectResult)
					{
						if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						
						if ($selectResult[csf("type")]==0)
						{	
							if ($selectResult[csf("booking_type")]==1 || $selectResult[csf("booking_type")]==2)
							{
								if ($selectResult[csf("is_short")]==1)
								{
									$wo_type="Short";
								}
								else
								{
									$wo_type="Main";
								}
							}
							elseif($selectResult[csf("booking_type")]==4)
							{
								$wo_type="Sample With Order";
							}
						}
						else
						{
							$wo_type="Sample Non Order";
						}					
					?>
						<tr bgcolor="<? echo $bgcolor; ?>" style="text-decoration:none; cursor:pointer" id="search<? echo $i;?>" onClick="js_set_value(<? echo $selectResult[csf('id')]; ?>,'<? echo $selectResult[csf('booking_no')]; ?>')"> 
							<td width="30" align="center"><? echo $i; ?></td>	
							<td width="80" align="center"><p><? echo $selectResult[csf('booking_no_prefix_num')]; ?></p></td>
							<td width="80" align="center"><? echo $selectResult[csf('year')]; ?></td>
							<td width="130"><p><? echo $wo_type; ?></p></td>
							<td width="150"><p><? echo $buyerArr[$selectResult[csf('buyer_id')]]; ?></p></td>
							<td  width="100" align="center"><? echo change_date_format($selectResult[csf('booking_date')]); ?></td>	
						</tr>
					<?
						$i++;
					}
				?>
				</table>
			</div>
		</div>           
		<?
	}
	else if($item_category==24 || $item_category==31)
	{
		if ($data[0]==0) $buyer_id=""; else $buyer_id=" and buyer_id=$data[0]";
		if ($data[1]==0) $company_id=""; else $company_id=" and company_id=$data[1]";
		if ($data[2]==0) $search_wo=""; else $search_wo=" and labtest_prefix_num=$data[2]";
		if ($data[2]==0) $search_wo2=""; else $search_wo2=" and labtest_prefix_num=$data[2]";
		if ($data[2]==0) $search_wo=""; else $search_wo3=" and yarn_dyeing_prefix_num=$data[2]";
		if($db_type==0)
		{
			if ($data[3]==0) $year_id_cond=""; else $year_id_cond=" and YEAR(insert_date)=$data[3]";
		}
		elseif($db_type==2)
		{
			if ($data[3]==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(insert_date,'YYYY')=$data[3]";
		}
		
		if ($data[4]==0) $category_id_cond=""; else $category_id_cond=" and item_category_id=24";
		if ($data[5]==2) $wo_type_cond=" and entry_form=41"; else if ($data[5]==4) $wo_type_cond=" and entry_form=42"; else $wo_type_cond="";
		//if ($data[5]==3) $wo_type_cond_sam="  and booking_type=4"; else $wo_type_cond_sam="";
		
		if($db_type==0) $year=" YEAR(insert_date) as year";
		elseif($db_type==2) $year=" TO_CHAR(insert_date,'YYYY') as year";
		
		$supplierArr = return_library_array("select id,supplier_name from lib_supplier","id","supplier_name");
		
		if($item_category==24){
		$sql= "select id, ydw_no, $year, yarn_dyeing_prefix_num, booking_date, supplier_id, entry_form from wo_yarn_dyeing_mst where status_active=1 and is_deleted=0 $company_id $year_id_cond $search_wo3 $category_id_cond $wo_type_cond order by id Desc";
		}
		else if($item_category==31)
		{
		$sql= "select id, labtest_no as ydw_no, $year, labtest_prefix_num as yarn_dyeing_prefix_num, wo_date as booking_date, supplier_id, entry_form from wo_labtest_mst where status_active=1 and is_deleted=0  and entry_form in (79,274) $company_id $year_id_cond $search_wo2 $wo_type_cond order by id Desc";
		}
		
	?>
		<div>
			<table cellspacing="0" cellpadding="0" border="1" rules="all" width="600" class="rpt_table" >
				<thead>
					<th width="30">SL</th>
					<th width="80">WO No </th>
					<th width="80">Year</th>
					<th width="130">WO Type</th>
					<th width="150">Supplier</th>
					<th width="100">WO Date</th>
				</thead>
			</table>
			<div style="width:618px; overflow-y:scroll; max-height:300px;" id="" align="center">
				<table cellspacing="0" cellpadding="0" border="1" rules="all" width="600" class="rpt_table" id="list_view" >
				<?
					$i=1;
					$nameArray=sql_select( $sql );
					foreach ($nameArray as $selectResult)
					{
						if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						
						if($selectResult[csf("entry_form")]==41) $wo_type="Order";
						else if($selectResult[csf("entry_form")]==42) $wo_type="Non Order";
						else $wo_type="";				
					?>
						<tr bgcolor="<? echo $bgcolor; ?>" style="text-decoration:none; cursor:pointer" id="search<? echo $i;?>" onClick="js_set_value(<? echo $selectResult[csf('id')]; ?>,'<? echo $selectResult[csf('ydw_no')]; ?>')"> 
							<td width="30" align="center"><? echo $i; ?></td>	
							<td width="80" align="center"><p><? echo $selectResult[csf('yarn_dyeing_prefix_num')]; ?></p></td>
							<td width="80" align="center"><? echo $selectResult[csf('year')]; ?></td>
							<td width="130"><p><? echo $wo_type; ?></p></td>
							<td width="150"><p><? echo $supplierArr[$selectResult[csf('supplier_id')]]; ?></p></td>
							<td  width="100" align="center"><? echo change_date_format($selectResult[csf('booking_date')]); ?></td>	
						</tr>
					<?
						$i++;
					}
				?>
				</table>
			</div>
		</div>           
		<?
	}
	exit();
}

if($action=="po_no_popup")
{
	echo load_html_head_contents("Order No Info", "../../../", 1, 1,'','','');
	extract($_REQUEST);
	list($companyID,$buyer,$job)=explode('_',$data);
	?>
     
	<script>
		
	var selected_id = new Array, selected_name = new Array(); selected_attach_id = new Array();
	 
	function toggle( x, origColor ) {
			var newColor = 'yellow';
			if ( x.style ) {
				x.style.backgroundColor = ( newColor == x.style.backgroundColor )? origColor : newColor;
			}
		}
		
	function js_set_value(id)
	{
		//alert (id)
		var str=id.split("_");
		toggle( document.getElementById( 'tr_' + str[0] ), '#FFFFFF' );
		var strdt=str[2];
		str=str[1];
	
		if( jQuery.inArray(  str , selected_id ) == -1 ) {
			selected_id.push( str );
			selected_name.push( strdt );
		}
		else {
			for( var i = 0; i < selected_id.length; i++ ) {
				if( selected_id[i] == str  ) break;
			}
			selected_id.splice( i, 1 );
			selected_name.splice( i,1 );
		}
		var id = '';
		var ddd='';
		for( var i = 0; i < selected_id.length; i++ ) {
			id += selected_id[i] + ',';
			ddd += selected_name[i] + ',';
		}
		id = id.substr( 0, id.length - 1 );
		ddd = ddd.substr( 0, ddd.length - 1 );
		$('#txt_po_id').val( id );
		$('#txt_po_val').val( ddd );
	} 
		  
	
    </script>

</head>

<body>
<div align="center">
	<form name="styleRef_form" id="styleRef_form">
		<fieldset>
            <table cellspacing="0" cellpadding="0" border="1" rules="all" align="center" class="rpt_table" id="tbl_list">
            	<thead>
                    <th>Buyer</th>
                    <th>Search By</th>
                    <th id="search_by_td_up" width="130">Please Enter Order No</th>
                    <th>Shipment Date</th>
                    <th><input type="reset" name="button" class="formbutton" value="Reset"  style="width:100px;"></th> 
                    <input type="hidden" name="hide_order_no" id="hide_order_no" value="" />
                    <input type="hidden" name="hide_order_id" id="hide_order_id" value="" />
                </thead>
                <tbody>
                	<tr>
                        <td align="center">
                        	 <? 
								echo create_drop_down( "cbo_buyer_name", 140, "select buy.id, buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company=$companyID $buyer_cond and buy.id in (select buyer_id from lib_buyer_party_type where party_type in (1,3,21,90)) order by buy.buyer_name","id,buyer_name",1, "-- All Buyer--",$buyer,"",0 );
							?>
                        </td>                 
                        <td align="center">	
                    	<?
                       		$search_by_arr=array(1=>"Order No",2=>"Style Ref",3=>"Job No");
							$dd="change_search_event(this.value, '0*0*0', '0*0*0', '../../') ";							
							echo create_drop_down( "cbo_search_by", 80, $search_by_arr,"",0, "--Select--", "",$dd,0 );
						?>
                        </td>     
                        <td align="center" id="search_by_td">				
                            <input type="text" style="width:80px" class="text_boxes" name="txt_search_common" id="txt_search_common" />	
                        </td> 
                        <td align="center">
                            <input type="text" name="txt_date_from" id="txt_date_from" class="datepicker" style="width:60px" readonly>To
                            <input type="text" name="txt_date_to" id="txt_date_to" class="datepicker" style="width:60px" readonly>
                        </td>	
                        <td align="center">
                        	<input type="button" name="button" class="formbutton" value="Show" onClick="show_list_view ('<? echo $companyID; ?>'+'**'+document.getElementById('cbo_buyer_name').value+'**'+'<? echo $job; ?>'+'**'+document.getElementById('cbo_search_by').value+'**'+document.getElementById('txt_search_common').value+'**'+document.getElementById('txt_date_from').value+'**'+document.getElementById('txt_date_to').value, 'po_no_popup_list_view', 'search_div', 'wo_or_fabric_booking_report_controller', 'setFilterGrid(\'tbl_list_search\',-1)');" style="width:100px;" />
                    	</td>
                    </tr>
                    <tr>
                        <td colspan="5" height="20" valign="middle"><? echo load_month_buttons(1); ?></td>
                    </tr>
            	</tbody>
           	</table>
            <div style="margin-top:15px" id="search_div"></div>
		</fieldset>
	</form>
</div>
</body>           
<script src="../../../includes/functions_bottom.js" type="text/javascript"></script>
</html>
<?
	exit(); 
}

if ($action=="po_no_popup_list_view")
{
	//echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode);
	extract($_REQUEST);
	//echo $data;
	list($company,$buyer,$job,$search_type,$search_value,$start_date,$end_date)=explode('**',$data);
	//print_r ($data);
	
?>	
     <input type="hidden" id="txt_po_id" />
     <input type="hidden" id="txt_po_val" />
     <?
	 if ($company==0) $company_name=""; else $job_num=" and a.company_name='$company'";
	 if ($buyer==0) $buyer_name=""; else $buyer_name=" and a.buyer_name='$buyer'";
	 if ($job=="") $job_num=""; else $job_num=" and b.job_no_mst='$job'";
	
	if($search_type==1 && $search_value!=''){
		$search_con=" and b.po_number like('%".trim($search_value)."')";	
	}
	elseif($search_type==2 && $search_value!=''){
		$search_con=" and a.style_ref_no like('%".trim($search_value)."')";		
	}
	elseif($search_type==3 && $search_value!=''){
		$search_con=" and b.job_no_mst like('%".trim($search_value)."')";		
	}
	
	if($start_date!="" && $end_date!="")
	{
		if($db_type==0)
		{
			$date_cond="and b.pub_shipment_date between '".change_date_format(trim($start_date),"yyyy-mm-dd")."' and '".change_date_format(trim($end_date),"yyyy-mm-dd")."'";
		}
		else
		{
			$date_cond="and b.pub_shipment_date between '".change_date_format(trim($start_date),'','',1)."' and '".change_date_format(trim($end_date),'','',1)."'";	
		}
	}
	else $date_cond="";
	$sql= "select b.id, b.po_number, b.job_no_mst, b.pub_shipment_date,c.gmts_item_id from wo_po_details_master a, wo_po_break_down  b, wo_po_details_mas_set_details c where a.job_no=b.job_no_mst and a.job_no=c.job_no and a.status_active=1 and a.is_deleted=0 $job_num $company_name $buyer_name $search_con $date_cond order by b.id Desc";
	
	$arr=array(3=>$garments_item);
	echo  create_list_view("list_view", "PO No.,Job No.,Pub Shipment Date,Item Name", "100,100,80,150","450","240",0, $sql , "js_set_value", "id,po_number", "", 1, "0,0,0,gmts_item_id", $arr , "po_number,job_no_mst,pub_shipment_date,gmts_item_id", "",'setFilterGrid("list_view",-1);','0,0,3,0','',1) ;
	exit();	 
}

if ($action=="report_generate")
{
	//extract($_REQUEST);
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	$cbo_company=str_replace("'","",$cbo_company_id);
	$cbo_buyer=str_replace("'","",$cbo_buyer_id);
	$cbo_category=str_replace("'","",$cbo_category_id);
	$wo_type=str_replace("'","",$cbo_wo_type);
	$year_id=str_replace("'","",$cbo_year_id);
	$job_year_id=str_replace("'","",$cbo_job_year_id);
	$wo_no=str_replace("'","",$txt_wo_no);
	$wo_id=str_replace("'","",$hidd_wo_id);
	$cbo_season_id=str_replace("'","",$cbo_season_id);
	
	$job_no=str_replace("'","",$txt_job_no);
	$hidd_job=str_replace("'","",$hidd_job_id);
	$po_no=str_replace("'","",$txt_po_no);
	$hidd_po=str_replace("'","",$hidd_po_id);
	$date_from=str_replace("'","",$txt_date_from);
	$date_to=str_replace("'","",$txt_date_to);
	$file_no=str_replace("'","",$txt_file_no);
	$internal_ref=str_replace("'","",$txt_internal_ref);
	$txt_date_category=str_replace("'","",$txt_date_category);
	$cbo_order_status=str_replace("'","",$cbo_order_status);
	
	if($cbo_category==2 || $cbo_category==3 || $cbo_category==4 || $cbo_category==12 || $cbo_category==25)
	{	
		if($db_type==0)
		{
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and YEAR(a.insert_date)=$year_id";
			if ($year_id==0) $year_id_cond_sam=""; else $year_id_cond_sam=" and YEAR(s.insert_date)=$year_id";
		}
		elseif($db_type==2)
		{ 
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(a.insert_date,'YYYY')=$year_id";
			if ($year_id==0) $year_id_cond_sam=""; else $year_id_cond_sam=" and TO_CHAR(s.insert_date,'YYYY')=$year_id";
		}
		if($db_type==0)
		{
			if ($job_year_id==0) $job_year_id_cond=""; else $job_year_id_cond=" and YEAR(c.insert_date)=$job_year_id";
			if ($job_year_id==0) $job_year_id_cond_sam=""; else $job_year_id_cond_sam=" and YEAR(s.insert_date)=$job_year_id";
		}
		elseif($db_type==2)
		{ 
			if ($job_year_id==0) $job_year_id_cond=""; else $job_year_id_cond=" and TO_CHAR(c.insert_date,'YYYY')=$job_year_id";
			if ($job_year_id==0) $job_year_id_cond_sam=""; else $job_year_id_cond_sam=" and TO_CHAR(s.insert_date,'YYYY')=$job_year_id";
		}
		
		if ($cbo_company==0) $company_id=""; else $company_id=" and a.company_id=$cbo_company";
		if ($cbo_company==0) $company_id_sam=""; else $company_id_sam=" and s.company_id=$cbo_company";
		if ($cbo_buyer==0) $buyer_id=""; else $buyer_id=" and a.buyer_id=$cbo_buyer";
		if ($cbo_buyer==0) $buyer_id_sam=""; else $buyer_id_sam=" and s.buyer_id=$cbo_buyer";
		if ($cbo_category==0) $category_id=""; else $category_id=" and a.item_category=$cbo_category";
		if ($cbo_category==0) $category_id_sam=""; else $category_id_sam=" and s.item_category=$cbo_category";
		if ($wo_no=="") $wo_no_cond=""; else $wo_no_cond=" and a.booking_no='$wo_no'";
		if ($wo_no=="") $wo_no_cond_sam=""; else $wo_no_cond_sam=" and s.booking_no='$wo_no'";
		if ($wo_type==1 || $wo_type==2)  $wo_type_cond=" and a.booking_type in (1,2,3) and a.is_short='$wo_type'"; else $wo_type_cond="";
		if ($wo_type==3) $wo_type_cond_sam="  and a.booking_type=4"; else $wo_type_cond_sam="";
		
		if ($job_no=="") $job_num=""; else $job_num=" and b.job_no='$job_no'";
		//if ($po_no=='') $po_no_no=""; else $po_no_no=" and d.po_number in ($po_no)";
		if ($hidd_po=="") $po_id=""; else $po_id=" and d.id in ( $hidd_po )";
		
		//if ($hidd_po=="") $po_id_cond=""; else $po_id_cond=" and b.po_break_down_id in ( $hidd_po )";
		
		if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and d.file_no='".trim($file_no)."' "; 
		if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and d.grouping   like '%".trim($internal_ref)."%'  "; 
		//echo $file_no_cond.'=='.$internal_ref_cond;='".trim($internal_ref)."'
		if ($cbo_season_id==0) $season_cond=""; else $season_cond=" and c.season_buyer_wise in(".$cbo_season_id.") "; 
		
		if($db_type==0)
		{
			if($txt_date_category==1){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".$date_from."' and '".$date_to."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.booking_date between '".$date_from."' and '".$date_to."'";
			}
			else if($txt_date_category==2){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".$date_from."' and '".$date_to."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.delivery_date between '".$date_from."' and '".$date_to."'";
			}
		}
		if($db_type==2)
		{
			if($txt_date_category==1){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.booking_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
			else if($txt_date_category==2){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
		}
	
		$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
		$supplierArr=return_library_array( "select id,supplier_name from lib_supplier", "id", "supplier_name");	
		$buyerArr=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
		$level_arr= array(1=>"PO Level",2=>"Job Level");
		
		if ($cbo_category==4) 
		{
			$colspan=30;
			$tbl_width=3290;
		}
		else if ($cbo_category==12)
		{
			$colspan=29;
			$tbl_width=2820;
		}
		else if ($cbo_category==2)
		{
			$colspan=30;
			$tbl_width=3080;
		}
		else if ($cbo_category==25)
		{
			$colspan=31;
			$tbl_width=3120;
		}
		else
		{
			$colspan=28;
			$tbl_width=2820;
		}
		
		$emb_item_array=array();
		if($cbo_company!=0) $cbo_company_cond="and template_name=$cbo_company";else $cbo_company_cond="";
		if($cbo_category==2 || $cbo_category==3)
		{
			$print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=1 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			
			$print_short_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=2 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$partial_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=35 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$woven_partial_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=138 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$sample_req_non_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=90 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$sample_req_booking_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=142 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$sample_req_booking_withorder_print_report_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=48 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			
			$sample_booking_non_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=4 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$sample_booking_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=3 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			//$format_ids=explode(",",$print_report_format_ids);
		}
		else if($cbo_category==4)
		{
			 
			$print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(5,6,219) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			/*$print_report_format_arr26=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=26 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");*/
			$trim_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(5) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$trim_print_report_format_arr2=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(6) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$trim_print_report_format_arr3=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(219) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$print_report_format_arr26=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=26 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			
		}
		else if($cbo_category==12) // Service Fab. Booking.
		{
			$print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=11 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$print_report_format_aop=return_field_value("format_id"," lib_report_template"," module_id=2 and report_id=49 and is_deleted=0 and status_active=1 $cbo_company_cond");
			$dying_print_report_format_aop=return_field_value("format_id"," lib_report_template"," module_id=2 and report_id=207 and is_deleted=0 and status_active=1 $cbo_company_cond");
			$multi_knit_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=65 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$service_knit_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=12 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$dying_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=207 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
		}
		else if($cbo_category==25) // Service Emb. Booking.
		{
		 $wvn_emb_print_report_format_arr = return_field_value("format_id", "lib_report_template", "module_id=2 and report_id=244 and is_deleted=0 and status_active=1 $cbo_company_cond");
		 $emb_print_report_format_arr = return_field_value("format_id", "lib_report_template", "module_id=2 and report_id=89 and is_deleted=0 and status_active=1 $cbo_company_cond");
		//print_r($dying_print_report_format_aop);
		}

		$tot_fin_fab_qnty=0;

		ob_start();
		?>
		<fieldset>
			<table width="<? echo $tbl_width; ?>"  cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none; font-size:18px;" colspan="<? echo $colspan; ?>">
					<? echo $company_library[str_replace("'","",$cbo_company_id)]; ?>                                
					</td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:16px; font-weight:bold"  colspan="<? echo $colspan; ?>"> <? echo $report_title; if($cbo_category!=0) echo " For ".$item_category[$cbo_category]; ?></td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:12px; font-weight:bold"  colspan="<? echo $colspan; ?>"> <? if( $date_from!="" && $date_to!="" ) echo "From ".change_date_format($date_from)." To ".change_date_format($date_to);?></td>
				</tr>
			</table>
			<table width="<? echo $tbl_width; ?>" cellspacing="0" border="1" class="rpt_table" rules="all">
				<thead>
					<th width="30">SL</th>    
					<th width="100">Company</th>
					<th width="70">Wo No</th>
					<?
					if ( $cbo_category==25)
					{
						?>
                    <th width="100">Embl. Name</th>
					<th width="100">Embl. Type</th>
                        <?
					}?>
                    <th width="70">Pay Mode</th>
                    <?
					if ($cbo_category==3 || $cbo_category==2 || $cbo_category==25 || $cbo_category==4)
					{
						?>
                        <th width="100">PI No</th>
                        <?
					}

					if ($cbo_category==4)
					{
						?>
                       
                        <th width="100">LC Type</th>
                        <th width="100">Pay Term</th>
                        <th width="100">Tenor</th>
                        <?
					}

					if ($cbo_category==12)
					{
						?>
						<th width="100">PI No</th>
                        <th width="100">Process</th>
                        <?
					} ?>
					
					<th width="100">BTB LC NO</th>
					<th width="60">Wo Year</th>
					<th width="70">Wo Date</th>
					<th width="70">Wo Last Update</th>
					<th width="70">Delivery Date</th>
                    <th width="70">Lead Time</th>
					<th width="100">Wo Type</th>
					<th width="100">Ready To Approved</th>
                    <th width="100">Ready To Approved<br>date and time</th>
					<th width="80">Approval Status</th>
                    <th width="100">Last Approval <br>Date time and Person</th>
					<th width="100">Supplier</th>
					<th width="100">Buyer</th>
					<th width="70">Job No.</th>
                    <th width="70">Season</th>
					<th width="60">Job Year</th>
					<th width="100">Style Ref.</th>
					<th width="100">Internal Ref.</th>
					<th width="100">File No.</th>
					<th width="100">Order No</th>
                    <th width="100">Shipment Date</th>
					<th width="80">Item Category</th>
					<th width="70">First Receive Date</th>
					<?
						if ($cbo_category==4)
						{
							?>
								<th width="100">Wo Value</th>
                                <th width="100">Wo value(USD)</th>
                                <th width="100">Receive Value</th>
                                <th width="100">Receive Value(USD)</th>
							<?
						}
						else
						{
							
							if ($cbo_category==25) 
							{ 
							  $head_type="Wo Qty";
							  $head_type2="[USD]";
							}
							else { 
							 $head_type="Wo Qty (Fin.)";
							 $head_type2="";
							}
							?>
								<th width="100"><? echo $head_type;?></th>
								<?
								if ($cbo_category==2)
								{
									?>
			                        <th width="100">WO Value(Fin.)</th>
			                        <?
								}
								if ($cbo_category==25)
								{
									?>
			                        <th width="100">WO UOM</th>
			                        <?
								}
								if ($cbo_category==3 || $cbo_category==25 )
								{
									?>
			                        <th width="100">WO Value<? echo $head_type2;?></th>
			                        <?
								}
								else
								{
									?>
									<th width="100">Wo Qty (Grey)</th>
									<?
								}
								?>
								
							<?
						}
					if($cbo_category==2)//Knit Fab.
					{
						?>
						<th width="80">Sample QTY</th>
						<th width="80">Responsible Dept</th>
						<th width="80">Reason</th>
						<?
					}
					?>
					<th width="80">Level</th>
					<th>Remarks</th>
				</thead>
			</table>
			<div style="max-height:350px; overflow-y:scroll; width:<? echo $tbl_width+20; ?>px" id="scroll_body" >
				<table cellspacing="0" cellpadding="0" border="1" class="rpt_table"  width="<? echo $tbl_width; ?>" rules="all" id="table_body" >
				
				<?
				$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
				$fabric_source_cond="";$fabric_source_cond_nonOrder="";
				if($cbo_category==2 || $cbo_category==4)
				{ 
					if($cbo_fabric_source>0) 
					{
						$fabric_source_cond=" and a.fabric_source=$cbo_fabric_source"; 
					
						if($cbo_fabric_source==1 || $cbo_fabric_source==4){
							$fabric_source_cond_nonOrder=" and t.fabric_source=$cbo_fabric_source"; 
							$select_field="t.fabric_source";
						}
						else
						{
							$fabric_source_cond_nonOrder=" and s.fabric_source=$cbo_fabric_source"; 
							$select_field="s.fabric_source";
						}
					}
					else $select_field="s.fabric_source";
				}
				
				if($db_type==0)
				{
					$year_book=" year(a.insert_date) as year_book";
					$year_book_non=" year(s.insert_date) as year_book";
					$select_job_year=" year(c.insert_date) as job_year"; 
				}
				else
				{
					$year_book=" TO_CHAR(a.insert_date,'YYYY') as year_book";
					$year_book_non=" TO_CHAR(s.insert_date,'YYYY') as year_book";
					$select_job_year=" TO_CHAR(c.insert_date,'YYYY') as job_year";
				}
				if($wo_type==0)
				{
					if($job_no!='' || $hidd_po!='' || $file_no!='' || $internal_ref!='')
					{

						 $sql="Select a.entry_form,a.update_date, a.company_id, a.id as booking_id, a.pay_mode, a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date, a.delivery_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount,b.responsible_dept,b.reason, b.uom as uom,c.season_buyer_wise, c.job_no_prefix_num, c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date, 0 as type ,b.bh_qty,b.rf_qty

						from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d  
						where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $booking_date_cond $wo_no_cond $fabric_source_cond  $job_num $po_id $internal_ref_cond  $file_no_cond $season_cond $year_id_cond $job_year_id_cond";//die;

					
					}
					else
					{
						$sql="(Select a.entry_form,a.update_date,a.company_id,a.id as booking_id, a.pay_mode,a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date as booking_date,a.delivery_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount, b.responsible_dept,b.reason,b.uom as uom,c.season_buyer_wise, c.job_no_prefix_num, c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date, 0 as type ,b.bh_qty,b.rf_qty ,0 as style_id
						from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d
						where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $job_num $po_id $booking_date_cond $wo_no_cond $fabric_source_cond  $job_num $po_id $internal_ref_cond  $file_no_cond $year_id_cond $job_year_id_cond $season_cond) 
						 union all
						 (SELECT s.entry_form_id as entry_form,s.update_date, s.company_id, s.id as booking_id, s.pay_mode, s.booking_type, s.is_short, s.booking_no, $year_book_non, s.booking_no_prefix_num, s.fabric_source, s.booking_date as booking_date, s.delivery_date,null as  delivery_date_dtls, s.is_approved, s.ready_to_approved, s.supplier_id, s.buyer_id, s.item_category, s.currency_id, s.exchange_rate, null as process, t.finish_fabric as fin_fab_qnty, t.grey_fabric as grey_fab_qnty, t.trim_qty as wo_qnty, t.amount as amount, null as responsible_dept, null as reason, t.uom as uom,null as season_buyer_wise, null as job_no_prefix_num, null as job_no, null as job_year, null as style_ref_no, null as garments_nature, 0 as po_break_down_id, null as po_number, null as file_no, null as grouping, null as pub_shipment_date, 1 as type ,t.bh_qty,t.rf_qty,t.style_id
						 FROM wo_non_ord_samp_booking_mst s, wo_non_ord_samp_booking_dtls t 
						 WHERE s.booking_no=t.booking_no and s.status_active =1 and s.is_deleted=0 and t.status_active =1 and t.is_deleted=0 $company_id_sam $buyer_id_sam ".set_user_lavel_filtering(' and s.buyer_id','buyer_id')." $category_id_sam $booking_date_cond_samp $wo_no_cond_sam $year_id_cond_sam $job_year_id_cond_sam $fabric_source_cond_nonOrder) order by booking_date ";//die;//LISTAGG(CAST(b.job_no AS VARCHAR(4000)), ',') WITHIN GROUP (ORDER BY b.job_no) as job_no,
					}
				}
				else
				{
					if ($wo_type==1 || $wo_type==2 || $wo_type==3)
					{
						 $sql="Select a.entry_form,a.update_date, a.company_id, a.id as booking_id, a.pay_mode, a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date,a.delivery_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.responsible_dept, b.reason, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount, b.uom as uom,c.season_buyer_wise, c.job_no_prefix_num, c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date,  0 as type,b.bh_qty,b.rf_qty,a.cbo_level
						 from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d 
						 where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status  $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $job_num $po_id $booking_date_cond $wo_no_cond $wo_type_cond $wo_type_cond_sam $file_no_cond $internal_ref_cond $fabric_source_cond $year_id_cond $job_year_id_cond $season_cond order by a.booking_no";//die;
					}
					else
					{  
						$sql="SELECT s.entry_form_id as entry_form,s.update_date,s.company_id, s.id as booking_id, s.pay_mode, s.booking_type, s.is_short, s.booking_no, $year_book_non, s.booking_no_prefix_num, $select_field , s.booking_date, s.delivery_date, s.is_approved, s.ready_to_approved, s.supplier_id, s.buyer_id, s.item_category, s.currency_id, s.exchange_rate, null as process, t.finish_fabric as fin_fab_qnty, t.grey_fabric as grey_fab_qnty, t.trim_qty as wo_qnty, t.amount as amount, t.uom as uom,null as season_buyer_wise, null as job_no_prefix_num, null as job_no, null as job_year, null as style_ref_no, null as garments_nature, 0 as po_break_down_id, null as po_number, null as file_no, null as grouping, null as pub_shipment_date, 1 as type,  t.bh_qty,t.rf_qty,t.style_id
						FROM wo_non_ord_samp_booking_mst s, wo_non_ord_samp_booking_dtls t 
						WHERE s.booking_no=t.booking_no and s.status_active =1 and s.is_deleted=0 and t.status_active =1 and t.is_deleted=0 $company_id_sam $buyer_id_sam ".set_user_lavel_filtering(' and s.buyer_id','buyer_id')." $category_id_sam $booking_date_cond_samp $wo_no_cond_sam $year_id_cond_sam $job_year_id_cond_sam $fabric_source_cond_nonOrder";//die;
						//echo $sql;die;
					}
				}
				//echo $sql; die;
				$job_check=$order_check=array();
				$sql_result=sql_select($sql); 
				$booking_data=array();$booking_id_arr=array();
				foreach($sql_result as $row)
				{ 
					$booking_id_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
					$po_id_arr[$row[csf("po_break_down_id")]]=$row[csf("po_break_down_id")];
					if($row[csf("type")]==1)
					{
					$req_id_arr[$row[csf("style_id")]]=$row[csf("style_id")];
					}
					
					$booking_data[$row[csf("booking_id")]]["booking_id"]=$row[csf("booking_id")];
					$booking_data[$row[csf("booking_id")]]["booking_type"]=$row[csf("booking_type")];
					$booking_data[$row[csf("booking_id")]]["update_date"]=$row[csf("update_date")];
					$booking_data[$row[csf("booking_id")]]["is_short"]=$row[csf("is_short")];
					$booking_data[$row[csf("booking_id")]]["booking_no"]=$row[csf("booking_no")];
					$booking_data[$row[csf("booking_id")]]["style_id"]=$row[csf("style_id")];
					$booking_data[$row[csf("booking_id")]]["company_id"]=$row[csf("company_id")];
					$booking_data[$row[csf("booking_id")]]["year_book"]=$row[csf("year_book")];
					$booking_data[$row[csf("booking_id")]]["booking_no_prefix_num"]=$row[csf("booking_no_prefix_num")];
					$booking_data[$row[csf("booking_id")]]["entry_form"]=$row[csf("entry_form")];
					$booking_data[$row[csf("booking_id")]]["cbo_level"]=$cbo_level_arr[$row[csf("booking_id")]];
					
					$booking_data[$row[csf("booking_id")]]["fabric_source"]=$row[csf("fabric_source")];
					$booking_data[$row[csf("booking_id")]]["booking_date"]=$row[csf("booking_date")];
					$booking_data[$row[csf("booking_id")]]["update_date"]=$row[csf("update_date")];
					$booking_data[$row[csf("booking_id")]]["delivery_date"]=$row[csf("delivery_date")];
					$booking_data[$row[csf("booking_id")]]["is_approved"]=$row[csf("is_approved")];
					$booking_data[$row[csf("booking_id")]]["ready_to_approved"]=$row[csf("ready_to_approved")];
					$booking_data[$row[csf("booking_id")]]["supplier_id"]=$row[csf("supplier_id")];
					$booking_data[$row[csf("booking_id")]]["buyer_id"]=$row[csf("buyer_id")];
					$booking_data[$row[csf("booking_id")]]["item_category"]=$row[csf("item_category")];
					$booking_data[$row[csf("booking_id")]]["type"]=$row[csf("type")];
					$booking_data[$row[csf("booking_id")]]["pay_mode"]=$row[csf("pay_mode")];
					$booking_data[$row[csf("booking_id")]]["delivery_date_dtls"]=$row[csf("delivery_date_dtls")];
					$booking_data[$row[csf("booking_id")]]["currency_id"]=$row[csf("currency_id")];
					$booking_data[$row[csf("booking_id")]]["process"].=$row[csf("process")].",";
					
					$booking_data[$row[csf("booking_id")]]["fin_fab_qnty"]+=$row[csf("fin_fab_qnty")];
					$booking_data[$row[csf("booking_id")]]["grey_fab_qnty"]+=$row[csf("grey_fab_qnty")];
					$booking_data[$row[csf("booking_id")]]["wo_qnty"]+=$row[csf("wo_qnty")];
					$booking_data[$row[csf("booking_id")]]["amount"]+=$row[csf("amount")];
					$booking_data[$row[csf("booking_id")]]["sample_qnt"]+=($row[csf("bh_qty")]*1+$row[csf("rf_qty")]*1);
					$booking_data[$row[csf("booking_id")]]["uom"]=$row[csf("uom")];
					if($job_check[$row[csf("booking_id")]][$row[csf("job_no")]]=="")
					{
						$booking_data[$row[csf("booking_id")]]["job_no"].=$row[csf("job_no")].",";
						$booking_data[$row[csf("booking_id")]]["job_no_prefix_num"].=$row[csf("job_no_prefix_num")].",";
						$booking_data[$row[csf("booking_id")]]["job_year"].=$row[csf("job_year")].",";
						$booking_data[$row[csf("booking_id")]]["style_ref_no"].=$row[csf("style_ref_no")].",";
						$booking_data[$row[csf("booking_id")]]["season_buyer_wise"].=$season_library[$row[csf("season_buyer_wise")]].",";
						
						$job_check[$row[csf("booking_id")]][$row[csf("job_no")]]=$row[csf("job_no")];
					}
					if($order_check[$row[csf("booking_id")]][$row[csf("po_break_down_id")]]=="")
					{
						$booking_data[$row[csf("booking_id")]]["po_break_down_id"].=$row[csf("po_break_down_id")].",";
						$booking_data[$row[csf("booking_id")]]["po_number"].=$row[csf("po_number")].",";
						$booking_data[$row[csf("booking_id")]]["file_no"].=$row[csf("file_no")].",";
						$booking_data[$row[csf("booking_id")]]["grouping"].=$row[csf("grouping")].",";
						$booking_data[$row[csf("booking_id")]]["pub_shipment_date"].=change_date_format($row[csf("pub_shipment_date")]).",";
						
						$order_check[$row[csf("booking_id")]][$row[csf("po_break_down_id")]]=$row[csf("po_break_down_id")];
					}
					if($row[csf("booking_type")]==1 && $row[csf("is_short")]==1)//responsible_dept,reason
					{
						if($row[csf("reason")]!='')
						{
							$booking_data[$row[csf("booking_id")]]["reason"].=$row[csf("reason")].",";
						}
						if($row[csf("responsible_dept")]!='')
						{
							$resp_dept=explode(",",$row[csf("responsible_dept")]);
							$dept_name="";
							foreach($resp_dept as $dept)
							{
								if($dept_name=="") $dept_name=$department_library[$dept]; else $dept_name.=",".$department_library[$dept];
							}
							$booking_data[$row[csf("booking_id")]]["dept_name"].=$dept_name.",";
						}
					}
				}

				// print_r($booking_id_arr);
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 1, $po_id_arr, $empty_arr);//PO ID Ref from=1
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 2, $booking_id_arr, $empty_arr);//Book ID Ref from=2
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 3, $req_id_arr, $empty_arr);//Req ID Ref from=3
				
				
				$cbo_level_arr=return_library_array( "select b.id,b.cbo_level from wo_booking_mst b,gbl_temp_engine g where  b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37", "id", "cbo_level");

				$nonStyleArr=return_library_array( "select b.id, b.style_ref_no from sample_development_mst b,gbl_temp_engine g where b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=37", "id", "style_ref_no");

				$lc_sql="select a.contract_no,b.wo_po_break_down_id,c.booking_no from com_sales_contract a, com_sales_contract_order_info b, wo_booking_dtls c,gbl_temp_engine g  where a.id=b.com_sales_contract_id and c.po_break_down_id=b.wo_po_break_down_id and c.booking_mst_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
				 //echo $lc_sql;die;
				 $lc_sql_result=sql_select($lc_sql);
				foreach( $lc_sql_result as $row)
				{
					$lc_no_array[$row[csf("booking_no")]]['contract_no']=$row[csf("contract_no")];
				}
				unset($lc_sql_result);
				$emb_sql="select a.emb_name,a.emb_type, b.item_number_id, c.job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b, wo_po_break_down c,gbl_temp_engine g  where a.job_id=b.job_id and c.id=b.po_break_down_id and c.id=g.ref_val and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37   and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 ";
				// $po_id_arr
				 //echo $emb_sql;die;
				$emb_sql_result=sql_select($emb_sql);
				foreach($emb_sql_result as $row)
				{
					$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
					$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
					$emb_item_array[$row[csf("job_no_mst")]]['emb_type']=$row[csf("emb_type")];
				}
				unset($emb_sql_result);

				$only_emb_Name_array=array(); $only_emb_Type_array=array();
				$emb_print_data=array();
				$type_array=array(0=>$blank_array,1=>$emblishment_print_type,2=>$emblishment_embroy_type,3=>$emblishment_wash_type,4=>$emblishment_spwork_type,5=>$emblishment_gmts_type,99=>$blank_array);
				$emb_another_sql="select a.emb_name,a.emb_type, c.booking_no from wo_pre_cost_embe_cost_dtls a, wo_booking_mst c,wo_booking_dtls d,gbl_temp_engine g where a.job_no= d.job_no and c.id=d.booking_mst_id and d.pre_cost_fabric_cost_dtls_id=a.id and  c.id=g.ref_val and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.emb_type>0 and a.status_active=1 and a.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
				// $po_id_arr
				// $emb_another_sql;die;
				$emb_another_sql_result=sql_select($emb_another_sql);
				foreach($emb_another_sql_result as $row)
				{	
					$only_emb_Name_array[$row[csf("booking_no")]].=$emblishment_name_array[$row[csf("emb_name")]]."__";
					$only_emb_Name_Type_array[$row[csf("booking_no")]].=$row[csf("emb_name")]."__";
					$only_emb_Type_array[$row[csf("booking_no")]].=$row[csf("emb_type")]."__";
					$emb_print_data[$row[csf('booking_no')]].=$type_array[$row[csf("emb_name")]][$row[csf('emb_type')]].",";
				}
				//echo "<pre>";print_r($emb_print_data);die;
				unset($emb_another_sql_result);
				

				$wopi_arr=array(); $tem_pi=array();
				//if($cbo_category==4)
				//{
					if($cbo_company>0) $piCond="and a.importer_id=$cbo_company"; else $piCond="";
					//echo "select a.pi_number, b.work_order_no, b.work_order_dtls_id from com_pi_master_details a, com_pi_item_details b where a.id=b.pi_id and a.item_category_id=4 and a.status_active=1 and a.importer_id=$cbo_company and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.work_order_dtls_id>0";
					$sql_wo_pi=sql_select("select a.id,a.pi_number, b.work_order_no, b.work_order_dtls_id from com_pi_master_details a, com_pi_item_details b where a.id=b.pi_id and a.item_category_id in(2,3,4,12,25) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.work_order_dtls_id>0 $piCond");	
					foreach($sql_wo_pi as $rowPi)
					{
						//if($tem_pi[$rowPi[csf('work_order_no')]]=="")
						//{
							$tem_pi[$rowPi[csf('work_order_no')]]=$rowPi[csf('pi_number')];
							$wopi_arr[$rowPi[csf('work_order_no')]].=$rowPi[csf("pi_number")]."__";//.=$rowPi[csf('pi_number')]."**";
							$wopiId_arr[$rowPi[csf('work_order_no')]].=$rowPi[csf("id")]."__";//.=$rowPi[csf('pi_number')]."**";
						//}
						//echo $rowPi[csf('work_order_no')].'--'.$rowPi[csf('pi_number')].'==';
						$pi_number_arr[] = "'".$rowPi[csf('id')]."'";
						$piArr[$rowPi[csf("id")]]=$rowPi[csf("id")];
					}
					//unset($sql_wo_pi);
					fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 4, $piArr, $empty_arr);//PI ID Ref from=4
					$pi_number_string = implode(',',array_unique($pi_number_arr));

					//============== For BTB Lc Data ==================
					if($pi_number_string!="")
					{
						if($cbo_company>0) $comCond="and a.importer_id=$cbo_company"; else $comCond="";
				
						$btb_sql = "SELECT a.id, a.lc_number,a.lc_type_id,a.payterm_id,a.tenor, c.pi_number
						FROM com_btb_lc_master_details a, com_btb_lc_pi b, com_pi_master_details c,gbl_temp_engine g 
						WHERE a.id=b.com_btb_lc_master_details_id and b.pi_id=c.id and c.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=4 and g.entry_form=37 and a.is_deleted = 0 and a.item_basis_id=1 $comCond
						
						UNION ALL
						SELECT a.id, a.lc_number,a.lc_type_id,a.payterm_id,a.tenor,c.pi_number
						FROM com_btb_lc_master_details a, com_btb_lc_pi b, com_pi_master_details c,gbl_temp_engine g 
						WHERE a.id=b.com_btb_lc_master_details_id and b.pi_id=c.id and c.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=4 and g.entry_form=37 and a.is_deleted = 0 and a.item_basis_id=2 $comCond";
						 //echo $btb_sql; die;
						$sql_result=sql_select($btb_sql);
						$btb_pi=array();
						foreach($sql_result as $rows)
						{					
							$btb_pi[$rows[csf('pi_number')]]['lc_number']=$rows[csf('lc_number')];
							$btb_pi[$rows[csf('pi_number')]]['lc_type_id']=$rows[csf('lc_type_id')];
							$btb_pi[$rows[csf('pi_number')]]['payterm_id']=$rows[csf('payterm_id')];
							$btb_pi[$rows[csf('pi_number')]]['tenor']=$rows[csf('tenor')];
						}
						//var_dump($btb_pi);
					}
				//}
				
				//print_r($wopi_arr); die;
				//----------------------
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 10, $piArr, $empty_arr);//PI ID Ref from=10

				if($cbo_category==2 || $cbo_category==3 || $cbo_category==4 ||  $cbo_category==25)
				{
					if ($cbo_company==0) $company_cond_id=""; else $company_cond_id=" and b.company_id=$cbo_company";
					if($cbo_category==2)
					{
						$booking_check_prod=array();
						$prod_1st_sql=sql_select("select a.id as book_id, b.booking_without_order, c.transaction_date as receive_date, c.cons_quantity as rcv_qnty from  wo_booking_mst a, pro_batch_create_mst b , inv_transaction c, gbl_temp_engine g where a.id=b.booking_no_id and b.id=c.pi_wo_batch_no    and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and a.item_category in(2,3)  and c.pi_wo_batch_no>0 and c.status_active=1 and c.item_category in(2,3) and c.transaction_type=1");
						$first_rec_date_prod=array();
						foreach($prod_1st_sql as $row)
						{
							$receive_data_pord[$row[csf("book_id")]][$row[csf("booking_without_order")]].=$row[csf("receive_date")].",";
							$receive_qnty_data_prod[$row[csf("book_id")]][$row[csf("booking_without_order")]][$row[csf("receive_date")]]+=$row[csf("rcv_qnty")];
							if($booking_check[$row[csf("book_id")]]=="")
							{
								$first_rec_date_prod[$row[csf("book_id")]]=$row[csf("receive_date")];
								$booking_check_prod[$row[csf("book_id")]]=$row[csf("receive_date")];
							}
						}
						
						$sql_receive="select b.recv_number,b.booking_id, b.receive_date, b.booking_without_order, c.cons_quantity as rcv_qnty from inv_receive_master b, inv_transaction c,gbl_temp_engine g  where b.id=c.mst_id and b.booking_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and c.transaction_type=1 and b.item_category in(2,3)  and b.receive_basis in(12,2) $company_cond_id";
						 	
						$receive_result=sql_select($sql_receive);
						$receive_data=$receive_qnty_data=$booking_check=array();
						foreach($receive_result as $row)
						{
							$receive_data[$row[csf("booking_id")]][$row[csf("booking_without_order")]].=$row[csf("receive_date")].",";
							$receive_qnty_data[$row[csf("booking_id")]][$row[csf("booking_without_order")]][$row[csf("receive_date")]]+=$row[csf("rcv_qnty")];
							if($booking_check[$row[csf("booking_id")]]=="")
							{
								$first_rec_date[$row[csf("booking_id")]]=$row[csf("receive_date")];
								$booking_check[$row[csf("booking_id")]]=$row[csf("receive_date")];
								$first_rec_no[$row[csf("booking_id")]]=$row[csf("recv_number")];
							}
						}
					}
					else
					{
						$sqlbok="select min(a.recv_number) as recv_number,b.pi_wo_batch_no, min(a.receive_date) as receive_date,min(a.currency_id) as currency_id, sum(b.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,gbl_temp_engine g  where a.id=b.mst_id and b.pi_wo_batch_no=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.entry_form=24 and  b.item_category in(4)  and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(2,12) $company_cond_id group by b.pi_wo_batch_no";	//echo $sql ;die;
						$sql_resultbok=sql_select($sqlbok);
						$booking_pi_check=array();
						foreach($sql_resultbok as $row)
						{
							//if($booking_pi_check[$row[csf("pi_wo_batch_no")]]=="")
							//{
							$first_rec_date[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
							$first_rec_no[$row[csf("pi_wo_batch_no")]]=$row[csf("recv_number")];
							$booking_pi_check[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
							//}
							//$rec_amt_arr[$row[csf("pi_wo_batch_no")]]=$row[csf("rec_amt")];
							//$rec_currency_arr[$row[csf("pi_wo_batch_no")]]=$row[csf("currency_id")];
						}	unset($sql_resultbok);

						$sql_pi="select min(a.recv_number) as recv_number,a.receive_basis,b.pi_wo_batch_no, min(a.receive_date) as receive_date,min(a.currency_id) as currency_id, sum(b.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,gbl_temp_engine g  where a.id=b.mst_id and b.pi_wo_batch_no=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=10 and g.entry_form=37 and a.entry_form=24 and  b.item_category in(4)  and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(1) $company_cond_id group by b.pi_wo_batch_no,a.receive_basis";	//echo $sql_pi ;die;

						$sql_resultpi=sql_select($sql_pi);
						$first_rec_date_pi=array();
						foreach($sql_resultpi as $row)
						{
							$first_rec_date_pi[$row[csf("pi_wo_batch_no")]]['receive_date']=$row[csf("receive_date")];					
							$first_rec_date_pi[$row[csf("pi_wo_batch_no")]]['receive_basis']=$row[csf("receive_basis")];					
						}
						// unset($sql_resultpi);

						// print_r($first_rec_date_pi);
					
							if($cbo_category==3) //Woven Fab
							{
								$pi_recv_sql="select min(a.recv_number) as recv_number,b.pi_wo_batch_no, min(a.receive_date) as receive_date,min(a.currency_id) as currency_id, sum(b.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,gbl_temp_engine g where a.id=b.mst_id and b.pi_wo_batch_no=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.entry_form=17 and  b.item_category in(3)  and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(2,1) $company_cond_id group by b.pi_wo_batch_no";
								
							$wvn_receive_result=sql_select($pi_recv_sql);
							$receive_data=$receive_qnty_data=$booking_check=array();
							foreach($wvn_receive_result as $row)
							{
								$first_rec_date[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
								$first_rec_no[$row[csf("pi_wo_batch_no")]]=$row[csf("recv_number")];
								//$booking_pi_check[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
							}
							unset($wvn_receive_result);
						}
						
					}
				}
				if($cbo_category!=2)
				{
					$sql_recv="SELECT b.pi_wo_batch_no,b.prod_id, (a.currency_id) as currency_id,(c.quantity) as rcv_qnty, (c.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,order_wise_pro_details c,gbl_temp_engine g WHERE a.id=b.mst_id and  b.id=c.trans_id  and c.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and c.trans_type=1 and a.entry_form=24 and c.entry_form=24 and  b.item_category in(4)  and c.status_active=1 and c.is_deleted=0  and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(1,2,12) $company_cond_id ";

						$sql_Recv_result = sql_select($sql_recv);
						$propo_id_check = array();
						foreach($sql_Recv_result as $row)
						{
							if($propo_id_check[$row[csf('prop_id')]]=="")
							{
							$propo_id_check[$row[csf('prop_id')]]=$row[csf('prop_id')];
							$rec_amt_arr[$row[csf("pi_wo_batch_no")]]+=$row[csf("rec_amt")];
							}
							$rec_currency_arr[$row[csf("pi_wo_batch_no")]]=$row[csf("currency_id")];
						}
						unset($sql_Recv_result);
				}
				$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id and b.work_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0	and a.item_category_id in(2,3,12,25) and a.pi_basis_id=1";
				$pi_sql_result=sql_select($pi_sql); 
				$pi_no_arr = array();
				foreach ($pi_sql_result as $value) 
				{
					$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
					$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];
				}
				unset($pi_sql_result);
		
				 $wo_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_booking_mst a, approval_history b,gbl_temp_engine g  where a.id=b.mst_id and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(8,7,32,13,12) order by b.id desc";
				$wo_his_sql_result=sql_select($wo_his_sql);
				//$pi_no_arr = array();
				$user_arr=return_library_array( "select id, user_name from user_passwd", 'id', 'user_name' );	
				foreach ($wo_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_his_sql_result);
				
				$wo_non_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_non_ord_samp_booking_mst a, approval_history b,gbl_temp_engine g where a.id=b.mst_id and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(8,7,32,9) order by b.id desc";
				$wo_non_his_sql_result=sql_select($wo_non_his_sql);
				//$pi_no_arr = array();
			 
				foreach ($wo_non_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_non_his_sql_result);
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3,4,10) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);

				$i=1;$summer_data=array();$job_check=array();
				$tot_wo_currency_usd_amt=$tot_recv_usd_amt=$tot_embl_wo_amount=$tot_sample=0;
						
				foreach($booking_data as $row)
				{
					$variable=$row[("booking_no_prefix_num")];
					$sample_qnt=0;
					$sample_qnt=$row['sample_qnt'];
					$tot_sample+=$row['sample_qnt'];
					if($row[("item_category")]==2 || $cbo_category==3)
					{
						//echo $row[("fabric_source")];die;
						
						if($row[("fabric_source")]==1 || $row[("fabric_source")]==2 || $row[("fabric_source")]==4)
						{
							if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
							if ($row[("type")]==0)
							{	
								if ($row[("booking_type")]==1 || $row[("booking_type")]==2  || $row[("booking_type")]==3  || $row[("booking_type")]==6)
								{
									if ($row[("is_short")]==1)
									{
										$wo_type="Short";
										$wo_typw_id=1;
									}
									else if ($row["entry_form"]==108){
										$wo_type="Partial";
										$wo_typw_id=5;
									}
									else
									{
										$wo_type="Main";
										$wo_typw_id=2;
									}
								}
								elseif($row[("booking_type")]==4)
								{
									$wo_type="Sample With Order";
									$wo_typw_id=3;

								}
							}
							else
							{
								$wo_type="Sample Non Order";
								$wo_typw_id=4;

								       
							}
							// echo $wo_typw_id.'ssd';
							
							$job_no=$style_ref_no=$po_number=$file=$ref=$job_number="";
							
							$p=1;
							$ship_date_arr=array_unique(explode(",",chop($row[("pub_shipment_date")],",")));
							foreach($ship_date_arr as $ship_date)
							{
								if($p==1)
								{
									$min_ship_date=$ship_date;
									$max_ship_date=$ship_date;
								}
								
								if(strtotime($min_ship_date)>strtotime($ship_date)) $min_ship_date=$ship_date;
								if(strtotime($max_ship_date)<strtotime($ship_date)) $max_ship_date=$ship_date;
								$p++;
							}
							
							$all_po_id=implode(",",array_unique(explode(",",chop($row[("po_break_down_id")],","))));
							$job_no=implode(",",array_unique(explode(",",chop($row[("job_no_prefix_num")],","))));
							$job_number=implode(",",array_unique(explode(",",chop($row[("job_no")],","))));
							$job_year=implode(",",array_unique(explode(",",chop($row[("job_year")],","))));
							$style_ref_no=implode(",",array_unique(explode(",",chop($row[("style_ref_no")],","))));
							$po_number=implode(", ",array_unique(explode(",",chop($row[("po_number")],","))));
							$file=implode(",",array_unique(explode(",",chop($row[("file_no")],","))));
							$ref=implode(",",array_unique(explode(",",chop($row[("grouping")],","))));
							$short_reason=implode(",",array_unique(explode(",",chop($row[("reason")],","))));
							$dept_name=implode(",",array_unique(explode(",",chop($row[("dept_name")],","))));
							$season_buyer=implode(",",array_unique(explode(",",chop($row[("season_buyer_wise")],","))));
							
							$cbo_company=$row[("company_id")];
							$print_report_format_ids=$print_report_format_arr[$cbo_company];
							$partial_print_report_format_ids=$partial_print_report_format_arr[$cbo_company];
							$woven_partial_print_report_format_ids=$woven_partial_print_report_format_arr[$cbo_company];
							$sample_req_non_print_report_format_ids=$sample_req_non_print_report_format_arr[$cbo_company];
							$sample_req_booking_report_format_ids=$sample_req_booking_report_format_arr[$cbo_company];
							//echo $sample_req_booking_report_format_ids.'-D-';
							$sample_req_withorder_print_report_ids=$sample_req_booking_withorder_print_report_arr[$cbo_company];
							$sample_booking_without_print_report_ids=$sample_booking_non_print_report_format_arr[$cbo_company];
							$sample_booking_withorder_print_report_ids=$sample_booking_print_report_format_arr[$cbo_company];
							//echo $sample_req_non_print_report_format_ids.'-D-';
							$short_booking_print_report_ids=$print_short_report_format_arr[$cbo_company];
							//echo $short_booking_print_report_ids.'-D-';
							
							$short_format_ids=explode(",",$short_booking_print_report_ids);
							$short_format_first_print_button=array_shift($short_format_ids);
							
							$sample_req_format_ids=explode(",",$sample_req_withorder_print_report_ids);
							$samp_req_wo_first_print_button=array_shift($sample_req_format_ids);

							$sample_req_without_format_ids=explode(",",$sample_req_non_print_report_format_ids);
							$samp_req_without_wo_first_print_button=array_shift($sample_req_without_format_ids);

							$sample_req_booking_format_ids=explode(",",$sample_req_booking_report_format_ids);
							$samp_req_booking_first_print_button=array_shift($sample_req_booking_format_ids);
							
								//echo $samp_req_booking_first_print_button.'DF';
							$sample_req_with_print_ids=explode(",",$sample_req_withorder_print_report_ids);
							$samp_req_with_first_print_button=array_shift($sample_req_with_print_ids);
							//echo $sample_req_format_first_print_button.'DF';
							$sample_booking_without_print_ids=explode(",",$sample_booking_without_print_report_ids);
							$samp_booking_without_first_print_button=array_shift($sample_booking_without_print_ids);
							
							$sample_booking_with_print_ids=explode(",",$sample_booking_withorder_print_report_ids);
							$samp_booking_with_first_print_button=array_shift($sample_booking_with_print_ids);
							//echo $samp_booking_with_first_print_button.'DF';
							$partial_format_ids=explode(",",$partial_print_report_format_ids);
							$woven_partial_format_ids=explode(",",$woven_partial_print_report_format_ids);
							$part_first_print_button=array_shift($partial_format_ids);
							$woven_part_first_print_button=array_shift($woven_partial_format_ids);
							
							$format_ids=explode(",",$print_report_format_ids);
							$print_b_16="";
							foreach ($format_ids as $key => $button_id) {
								if($button_id==719)
								{
									$print_b_16=$button_id;
								}
							}
						
							$first_print_button=array_shift($format_ids);
							$second_print_button= array_shift($format_ids);
							$fabric_nature=0;

							//143,160,220,151,175,155,218,84,85,235 partial
							if($cbo_category==2 || $cbo_category==3)
							{
								if($row["entry_form"]==118)
								{
									if($first_print_button==1)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report_gr";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										
										//part_first_print_button $row["entry_form"]
									}
									else if($first_print_button==2)
									{
										if($wo_typw_id==2)
										{
											$action_type="show_fabric_booking_report";
											$wo_typw_id=73;
										}
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##'  title='PB F1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." <a/>";
									}
									else if($first_print_button==3)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report3";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##'  title='PB F2' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==4)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report1";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##'  title='PFC F1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==5)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report2";
										else $action_type="show_fabric_booking_report";  
										$variable="<a href='##' title='PFC F2' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	    
									}
									else if($first_print_button==6)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report4";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##' title='FB F1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==7)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report5";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##' title='FB F2' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==13)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report13";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##' title='FB F2' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==28)
									{
										$action_type="show_fabric_booking_report_akh"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==45)
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==53)
									{
										$action_type="show_fabric_booking_report_jk";
										
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										
									}
									else if($first_print_button==93)
									{
										$action_type="show_fabric_booking_report_libas"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==786)
									{
										$action_type="show_fabric_booking_report25"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==73)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_mf";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==193)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_print4";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==269)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_knit";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}else if($first_print_button==723)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report17";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==304)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report10";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==849)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_bl1";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==432)
									{
										$action_type="show_fabric_booking_report_fn";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($second_print_button==73)
									{
										$action_type="show_fabric_booking_report_mf";  
										$variable="<a href='##'  title='PB MF' onClick=\"generate_fabric_report('".$second_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==719)
									{
										$action_type="show_fabric_booking_report16";  
										$variable="<a href='##'  title='B16' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($second_print_button==719)
									{
										$action_type="show_fabric_booking_report16";  
										$variable="<a href='##'  title='B16' onClick=\"generate_fabric_report('".$second_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($print_b_16==719)
									{
										$action_type="show_fabric_booking_report16";  
										$variable="<a href='##'  title='B16' onClick=\"generate_fabric_report('".$print_b_16."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==140) //Sampe Req Fab Without Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition Fabric Booking -Without order";
									if($samp_req_without_wo_first_print_button==10)
									{
										$action_type="show_fabric_booking_report";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_without_wo_first_print_button==17)
									{
										$action_type="show_fabric_booking_report_barnali";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==142) //Sampe Req With Booking  
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition With Booking";
									if($samp_req_without_wo_first_print_button==110)
									{
										$action_type="sample_requisition_print";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."','".$row[('style_id')]."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_without_wo_first_print_button==109)
									{
										$action_type="sample_requisition_print1";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."','".$row[('style_id')]."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==139) //Sampe Req Fab With Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition Fabric Booking -With order";
									if($samp_req_wo_first_print_button==155)
									{
										$action_type="show_fabric_booking_report";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(139,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_wo_first_print_button==17)
									{
										$action_type="show_fabric_booking_report2";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(139,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==88) //Sampe Req Fab With Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									//echo $short_format_first_print_button.'X';
									$page_name="Short Fabric Booking";
									if($short_format_first_print_button==136)
									{
										$action_type="print_booking_3";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."','".$row[('style_id')]."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==8)
									{
										$action_type="show_fabric_booking_report";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."','".$row[('style_id')]."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==9)
									{
										$action_type="show_fabric_booking_report3";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."','".$row[('style_id')]."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==244)
									{
										$action_type="show_fabric_booking_report_ntg";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."','".$row[('style_id')]."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==46)
									{
										$action_type="show_fabric_booking_report_urmi";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."','".$row[('style_id')]."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==86) //Main Fabric Booking
								{
									if($first_print_button==1)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report_gr"; else $action_type="show_fabric_booking_report"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}
									else if($first_print_button==73)
									{
										 $action_type="show_fabric_booking_report_b6"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
									else if($first_print_button==53)
									{
										 $action_type="show_fabric_booking_report_jk"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
									else if($first_print_button==45)//
									{
										 $action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
									else if($first_print_button==28)//show_fabric_booking_report_akh
									{
										 $action_type="show_fabric_booking_report_akh"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
								}
								else if($row["entry_form"]==271) //Woven Partial Fabric Booking
								{
									//$variable=$row[("booking_no_prefix_num")];
									//echo $first_print_button.'D';
									if($part_first_print_button==143)
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										
										//part_first_print_button $row["entry_form"]
									}
									else if($part_first_print_button==84)
									{
										
										$action_type="show_fabric_booking_report_urmi_per_job";											
										$variable="<a href='##'  title='PB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." <a/>";			
									}
									else if($part_first_print_button==85)
									{
										$action_type="print_booking_3";
										 
										$variable="<a href='##'  title='PB F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";	
									}
									else if($part_first_print_button==151)
									{
										$action_type="show_fabric_booking_report_advance_attire_ltd";
										$variable="<a href='##'  title='PFC F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($part_first_print_button==160)
									{
										$action_type="print_booking_5";
										$variable="<a href='##' title='PFC F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	    
									}
									else if($part_first_print_button==175)
									{
									   $action_type="print_booking_6";
										
										$variable="<a href='##' title='FB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($part_first_print_button==155)
									{
										$action_type="fabric_booking_report";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==160) //Woven Partial Start
									{
										$action_type="print_booking_5";
										$variable="<a href='##' title='PFC F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]." </a>";	
									}
									else if($woven_part_first_print_button==143)
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										
										//part_first_print_button $row["entry_form"]
									}
									else if($woven_part_first_print_button==84)
									{
										$action_type="show_fabric_booking_report_urmi_per_job";											
										$variable="<a href='##'  title='PB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]." <a/>";			
									}
									else if($woven_part_first_print_button==85)
									{
										$action_type="print_booking_3";
										$variable="<a href='##'  title='PB F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";	
									}
									else if($woven_part_first_print_button==151)
									{
										$action_type="show_fabric_booking_report_advance_attire_ltd";
										
										$variable="<a href='##'  title='PFC F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									
									else if($woven_part_first_print_button==175)
									{
									   $action_type="print_booking_6";
										
										$variable="<a href='##' title='FB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==155)
									{
										$action_type="fabric_booking_report";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==72) //
									{
										$action_type="print6booking";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==84) //
									{
										$action_type="show_fabric_booking_report_urmi_per_job";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									
								} //Woven Partial Booking end
								else if($row["entry_form"]==108) // Partial Fabric Booking
								{
									if ($part_first_print_button==143) // print 1
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==84) // print 2
									{
										$action_type="show_fabric_booking_report_urmi_per_job"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==85) // print 3
									{
										$action_type="print_booking_3"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==151) // print 4
									{
										$action_type="show_fabric_booking_report_advance_attire_ltd"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==160) // print 5
									{
										$action_type="print_booking_5"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==175) // print 6
									{
										$action_type="print_booking_6"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==218) // print 7
									{
										$action_type="print_booking_7"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==220) // print 8
									{
										$action_type="print_booking_northern_new"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==235) // print 9
									{
										$action_type="print_booking_northern_9"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==274) // print 10
									{
										$action_type="print_booking_10"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==241) // print 11
									{
										$action_type="print_booking_11"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==269) // print 12
									{
										$action_type="print_booking_12"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==28) // print 13
									{
										$action_type="print_booking_13"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==280) // print 14
									{
										$action_type="print_booking_14"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==304) // print 15
									{
										$action_type="print_booking_15"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==719) // print 16
									{
										$action_type="print_booking_16"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==723) // print 17
									{
										$action_type="print_booking_17"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==339) // print 18
									{
										$action_type="print_booking_18"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==370) // print 19
									{
										$action_type="print_booking_19"; 
										$variable="<a  href='##' onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==768) // print 20
									{
										$action_type="print_booking_20"; 
										$variable="<a  href='##' onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
								}
								else
								{
									if($row[("booking_type")]==4 && $row[("is_short")]=="")
									{  
										$page_name="Sample Fabric Booking Without order";
										// echo $samp_booking_without_first_print_button.'F'.$row[("is_short")].'<br>';
										// this updated 157 WO oder onclick resolved
										if($sample_booking_without_print_ids[0]==64) //Metro
										{
											// nwwwwwwwwwwwwwwwwwwwwwwwwwwwww   '".$row[('style_id')]."','".$cbo_category."',
											$action_type="show_fabric_booking_report5";  
											$variable="<a href='##' title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."',$fabric_nature,'".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==37) //Akh
										{
											$action_type="show_fabric_booking_report4";  
											$variable="<a href='##' title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$row[('style_id')]."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==36) //Amana
										{
											$action_type="show_fabric_booking_report3"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$row[('style_id')]."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==34) //Print Booking
										{
											$action_type="show_fabric_booking_report"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$row[('style_id')]."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==35) //Print Booking2
										{
											$action_type="show_fabric_booking_report2"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$row[('style_id')]."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==72) //Print FFl
										{
											$action_type="show_fabric_booking_report6"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$row[('style_id')]."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==174) //Print UG
										{
											$action_type="show_fabric_booking_report7"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$row[('style_id')]."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
									}
									if($row[("booking_type")]==4 && $row[("is_short")]==2) //Sample Booking with order
									{  
										$page_name="Sample Fabric Booking With order";
										// echo $samp_booking_without_first_print_button.'F'.$row[("is_short")].'<br>';
										if($samp_booking_with_first_print_button==38) //Print Booking
										{
											$action_type="show_fabric_booking_report";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(89,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($samp_booking_without_first_print_button==39) //Print Booking2
										{
											$action_type="show_fabric_booking_report2";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(89,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($samp_booking_without_first_print_button==64) //Metro
										{
											$action_type="show_fabric_booking_report3"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(89,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}else if($samp_booking_with_first_print_button==16) //Print Booking3
										{
										
											$action_type="show_fabric_booking_report_print_booking_3"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no")]."<a/>";
										}else if($samp_booking_with_first_print_button==177) //Print Booking4
										{
										
											$action_type="show_fabric_booking_report4"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no")]."<a/>";
										}else{ 
											
											
											
											if($wo_typw_id==3 || $wo_typw_id==4){

												$action_type="show_fabric_booking_report2";									
												$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$row[('style_id')]."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no")]."  <a/>";	
											}else{
												$variable=$row[("booking_no")];
											}
			


										}
									}
								}
							} //Fabric Booking End
							
							//143,160,220,151,175,155,218,84,85,235
						    //  if($part_first_print_button==220 && $row["entry_form"]==108)
							/*if($row["entry_form"]==108)
							{
								$action_type="print_booking_northern_new"; 
								$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
							}*/

							//echo $row[("booking_type")];						
						
							//echo $row[("fabric_source")];die;

							

						
							if($row[("fabric_source")]==2)
							{
								$rcv_date_arr=array_unique(explode(",",chop($receive_data[$row[("booking_id")]][$row[("type")]],",")));
								if($row[("booking_type")]==1 && $row[("is_short")]==2)
								{
									$summer_data[1]["book_qnty"]+=$row[("fin_fab_qnty")];
									
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[1]["rcv_qnty_intime"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[1]["rcv_qnty"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								else if($row[("booking_type")]==1 && $row[("is_short")]==1)
								{
									$summer_data[2]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[2]["rcv_qnty_intime"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[2]["rcv_qnty"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								else if($row[("booking_type")]==4 )
								{
									$summer_data[3]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[3]["rcv_qnty_intime"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[3]["rcv_qnty"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
							}
							else if($row[("fabric_source")]==1)
							{
								$rcv_date_arr=array_unique(explode(",",chop($receive_data_pord[$row[("booking_id")]][$row[("type")]],",")));
								if($row[("booking_type")]==1 && $row[("is_short")]==2)
								{
									$summer_data[1]["book_qnty"]+=$row[("fin_fab_qnty")];
									
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[1]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[1]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								else if($row[("booking_type")]==1 && $row[("is_short")]==1)
								{
									$summer_data[2]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[2]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[2]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								
								else if($row[("booking_type")]==4 )
								{
									$summer_data[3]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[3]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[3]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
							}
							else if($row[("fabric_source")]==4)
							{
								$summer_data[4]["book_qnty"]+=$row[("fin_fab_qnty")];
								foreach($rcv_date_arr as $rcv_date)
								{
									if($rcv_date<=$row[("delivery_date")])
									{
										$summer_data[4]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
									$summer_data[4]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
								}
							}
							
							$supplier_name="";
							if($row[("pay_mode")]==3 || $row[("pay_mode")]==5)
							{
								$supplier_name=$company_library[$row[("supplier_id")]];
							}
							else $supplier_name=$supplierArr[$row[("supplier_id")]];
							$ready_to_approved=$row[("ready_to_approved")];
							if($ready_to_approved==1)
							{
							$last_update_date=$row[("update_date")];
							}
							//echo $variable;
							//<a href='#report_details' onClick="generate_fabric_booking_report('<? echo $row[("booking_no")];','show_trim_booking_report');"></a>
							if($row[("delivery_date")]!="" && $row[("delivery_date_dtls")]=="" )  $row[("delivery_date")]=$row[("delivery_date")];else  $row[("delivery_date")]=$row[("delivery_date_dtls")];
							$piWoNo="";
							$piWoNo=implode(",",array_unique(array_filter(explode("__",$wopi_arr[$row["booking_no"]]))));
							$piWoNoId=implode(",",array_unique(array_filter(explode("__",$wopiId_arr[$row["booking_no"]]))));
							?>
							<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
								<td width="30"><? echo $i;?></td>
								<td width="100" align="center"><p><? echo $company_library[$row[("company_id")]]; ?></td>	
								<td width="60" align="center" title="Entry Form=<? echo $row["entry_form"];?>"><? echo $variable; ?><? //echo $row[("booking_no_prefix_num")];?></td>
                                <td width="70" align="center"><p><? echo $pay_mode[$row[("pay_mode")]]; ?></td>	

                                <?
								if ($cbo_category==3 || $cbo_category==2)
								{
									$pi_id=$pi_no_arr[$row[("booking_no")]]['pi_id'];
									?>
										<td width="110" align="center" title="<? echo 'Pi='.$pi_id.', Booking-'.$row[("booking_no")]; ?>"><p><? echo $pi_no_arr[$row[("booking_no")]]['pi_no']; ?></td>
									<? 
								}
								?>                                
								 <td width="100" style="word-break:break-all" align="center"><? echo $btb_pi[$piWoNo]['lc_number'] ?>&nbsp; </td>
								<td width="60" align="center"><p><? echo $row[("year_book")]; ?></td>
								<td width="70" align="center"><p><? echo change_date_format($row[("booking_date")]); ?></p></td>
								<td width="70" align="center"><p><?  $update_date=explode(" ",$row[("update_date")]);echo change_date_format($update_date[0])//echo change_date_format($wo_last_date_arr[$row[("booking_id")]]); ?></p></td>
								<td width="70" align="center"><p><? echo change_date_format($row[("delivery_date")]); ?></p></td>
								<td width="70" align="center"><p>
								<? 
								$lead_time=0;
								if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00")
								{
									$lead_time=datediff("d", $row[("booking_date")], $row[("delivery_date")]);
								}
								if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day";
								?></p></td>
											
								<td width="100" title="wo_type_id=<?=$wo_typw_id;?>"><p><? echo $wo_type;?></p></td>
                                
								<td width="100" align="center"><? echo $yes_no[$row[("ready_to_approved")]]; ?></td>
                              
								 <td width="100" align="center"><? $last_update_date=explode(" ",$last_update_date);echo change_date_format($last_update_date[0]).'<br>'.$last_update_date[1]; ?></td>
								
							 
								<td width="80" align="center"><p><? 
								if($row[("is_approved")]==0){
									echo "Un-Approved";
								}else if($row[("is_approved")]==1){
									echo "Full Approved";
								}else if($row[("is_approved")]==3){
									echo "Partial Approved";
								}
								//echo $approval_type_arr[$row[("is_approved")]]; ?></p></td>
                                <?
                                $approved_date=$last_app_arr[$row[("booking_id")]]['approved_date'];
								$approved_by=$last_app_arr[$row[("booking_id")]]['approved_by'];
								?>
                                 <td width="100" title="bookingId=<? echo $row[("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                                
                                 
								<td width="100"><p><? echo $supplier_name; ?></p></td>
								<td width="100"><p><? echo $buyerArr[$row[("buyer_id")]]; ?></p></td>
								<td width="70"><? echo $job_no;//$row[("job_no_prefix_num")]; ?></td>
                              	 <td width="70"><p><? echo $season_buyer;//$row[("job_no_prefix_num")]; ?>&nbsp;</p></td>
								<td width="60"><? echo $job_year; ?></td>
                                
								<td width="100"><p><? if ($row[("type")]==0) echo $style_ref_no; else echo $nonStyleArr[$row[("style_id")]]; ?></p></td>
								<td width="100"><p><? echo $printButton.$ref; ?></p></td>
								<td width="100"><p><? echo $file; ?></p></td>
								<td width="100"><p><? echo $po_number; ?></p></td>
								<td width="100"><p>
								<?
								if ($row[("type")]==0)
								{
									echo "Max - ". $max_ship_date;
									$order_count=explode(",",$po_number);
									if(count($order_count)>1) echo "<br> Min  - " . $min_ship_date; 
								}
								?></p></td>
								<td width="80"><p><? echo $item_category[$row[("item_category")]]; ?></p></td>
								<? 
								//booking_id
								$td_color="";
								if($row[("booking_type")]==2)
								{
									if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00" && $first_rec_date[$row[("booking_id")]]!="" && $first_rec_date[$row[("booking_id")]]!="0000-00-00")
									{
										if(strtotime($first_rec_date[$row[("booking_id")]])>strtotime($row[("delivery_date")])) $td_color='bgcolor="#FF0000"'; else $td_color='';
									}
									$first_rcv_date=change_date_format($first_rec_date[$row[("booking_id")]]);
								}
								else if($row[("booking_type")]==1 || $row[("booking_type")]==4)
								{
									if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00" && $first_rec_date_prod[$row[("booking_id")]]!="" && $first_rec_date_prod[$row[("booking_id")]]!="0000-00-00")
									{
										if(strtotime($first_rec_date_prod[$row[("booking_id")]])>strtotime($row[("delivery_date")])) $td_color='bgcolor="#FF0000"'; else $td_color='';
									}
									if ($cbo_category==3) //Woven Fabric
									{
										//echo $first_rec_date[$pi_id].'==AA'.$pi_id;
										$first_rcv_date=change_date_format($first_rec_date[$pi_id]);
									}
									else
									{
									$first_rcv_date=change_date_format($first_rec_date_prod[$row[("booking_id")]]);
									}
								}
								 //echo $row[("booking_type")]."***".$row[("type")] ;
								?>
								<td width="70" title="<? echo "Booking No : ".$booking_data[$row[("booking_id")]]["booking_no"].",\nBooking Type:".$row[("booking_type")]."\nFirst Receive No:".$first_rec_no[$row[("booking_id")]];  ?>" align="center" <? echo $td_color; ?> ><p><? echo $first_rcv_date; ?></p></td>
								<?
								if ($cbo_category==4)
								{
									?>
										<td width="100" align="right"><? echo number_format($row[("amount")],2); ?></td>
									<?
								}
								else
								{
									?>
										<td width="100" align="right"><? echo number_format($row[("fin_fab_qnty")],2); ?></td>
										<?
										if($cbo_category==2)
										{ 
											$tot_amount+=$row[("amount")];
											?>
										<td width="100" align="right" title="<? echo $ex_rate;?>"><?  echo number_format($row[("amount")],2); ?></td>
										<?}
										if ($cbo_category==3) 
										{
											$tot_amount+=$row[("amount")];
											?>
											<td width="100" align="right"><? echo number_format($row[("amount")],2); ?> </td>
											<?
										}
										else
										{
											$tot_grey_fab_qnty+=$row[("grey_fab_qnty")];
											?>
											<td width="100" align="right"><? echo number_format($row[("grey_fab_qnty")],2); ?></td>
											<?
										}
								}
								if($cbo_category==2)
								{
									?>
									<td width="80"><p><? echo number_format($sample_qnt,2); ?></p></td>
									<td width="80"><p><? echo $dept_name; ?></p></td>
									<td width="80"><p><? echo $short_reason; ?></p></td>
									<?
								}
								?>
								<td width="80"><? echo $level_arr[$row[("cbo_level")]]; ?></td>
								<td width="">&nbsp;&nbsp;&nbsp;&nbsp;<? //echo $row[("po_number")]; ?></td>
							</tr>
							<?
							$tot_wo_qnty+=$row[("amount")];
							$tot_fin_fab_qnty+=$row[("fin_fab_qnty")];
							
							$i++;
						
						}
					}
					else
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$print_report_format_ids=$print_report_format_arr[$cbo_company];
						$format_ids=explode(",",$print_report_format_ids);
					
						$first_print_button=array_shift($format_ids);
						$second_print_button= array_shift($format_ids);
						if ($row[("type")]==0)
						{	
							if ($row[("booking_type")]==1 || $row[("booking_type")]==2  || $row[("booking_type")]==3  || $row[("booking_type")]==6)
							{
								if ($row[("is_short")]==1)
								{
									$wo_type="Short";
									$wo_typw_id=1;
								}
								else
								{
									$wo_type="Main";
									$wo_typw_id=2;
								}
							}
							elseif($row[("booking_type")]==4)
							{
								$wo_type="Sample With Order";
								$wo_typw_id=3;
							}
						}
						else
						{
							$wo_type="Sample Non Order";
							$wo_typw_id=4;
						}
						$ready_to_approved=$row[("ready_to_approved")];
						if($ready_to_approved==1)
						{
						$last_update_date=$row[("update_date")];
						}
						// echo $wo_typw_id.'ssd';
						$job_no=$style_ref_no=$po_number=$file=$ref=$job_number="";
						$p=1;
						$ship_date_arr=array_unique(explode(",",chop($row[("pub_shipment_date")],",")));
						foreach($ship_date_arr as $ship_date)
						{
							if($p==1)
							{
								$min_ship_date=$ship_date;
								$max_ship_date=$ship_date;
							}
							
							if($min_ship_date>$ship_date) $min_ship_date=$ship_date;
							if($max_ship_date<$ship_date) $max_ship_date=$ship_date;
							$p++;
						}
						
						$all_po_id=implode(",",array_unique(explode(",",chop($row[("po_break_down_id")],","))));
						$job_no=implode(",",array_unique(explode(",",chop($row[("job_no_prefix_num")],","))));
						$season_buyer=implode(",",array_unique(explode(",",chop($row[("season_buyer_wise")],","))));
						//echo $season_buyer.'DDDD';
						$job_number=implode(",",array_unique(explode(",",chop($row[("job_no")],","))));
						$style_ref_no=implode(",",array_unique(explode(",",chop($row[("style_ref_no")],","))));
						$po_number=implode(", ",array_unique(explode(",",chop($row[("po_number")],","))));
						$file=implode(",",array_unique(explode(",",chop($row[("file_no")],","))));
						$ref=implode(",",array_unique(explode(",",chop($row[("grouping")],","))));
						$short_reason=implode(",",array_unique(explode(",",chop($row[("reason")],","))));
						$dept_name=implode(",",array_unique(explode(",",chop($row[("dept_name")],","))));
					    $job_year=implode(",",array_unique(explode(",",chop($row[("job_year")],","))));
					    $cbo_company=$row[("company_id")];
						$print_report_format_ids=$print_report_format_arr[$cbo_company];
						$format_ids=explode(",",$print_report_format_ids);
						$first_print_button=array_shift($format_ids);
						$second_print_button= array_shift($format_ids);

						$knit_print_report_format_ids=$multi_knit_print_report_format_arr[$cbo_company];
						$knit_format_ids=explode(",",$knit_print_report_format_ids);
						$knit_first_print_button=array_shift($knit_format_ids);
						$service_knit_print_report_format_ids=$service_knit_print_report_format_arr[$cbo_company];
						$service_knit_format_ids=explode(",",$service_knit_print_report_format_ids);
						$service_knit_first_print_button=array_shift($service_knit_format_ids);

						$dying_print_report_format_ids=$dying_print_report_format_arr[$cbo_company];						
						$dying_format_ids=explode(",",$dying_print_report_format_ids);						
						$dying_first_print_button=array_shift($dying_format_ids);
						//echo $cbo_company.'='.$dying_first_print_button;
						$trim_format_ids=explode(",",$trim_print_report_format_arr[$cbo_company]);
						$trim_format_ids2=explode(",",$trim_print_report_format_arr2[$cbo_company]);
						$trim_format_ids3=explode(",",$trim_print_report_format_arr3[$cbo_company]);
						$trim_first_print_button=array_shift($trim_format_ids);
						$trim_country_order_v2_button= array_shift($trim_format_ids2);
						$trim_woven_button= array_shift($trim_format_ids3);
				     		//echo $row[("entry_form")].'d'.$trim_woven_button;
						
						if($cbo_category==4) //Accessories Start
						{
							// echo $trim_woven_button.'kk';
							// echo $format_ids26[0].'='.$row["entry_form"];
							if($first_print_button==13 && $row["entry_form"]==272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($first_print_button==774 && $row["entry_form"]==272)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report_wg','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($first_print_button==13 && $row["entry_form"]==262)
							{
							    //  echo $first_print_button.$row["entry_form"].'kk';
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($first_print_button==13 && $row["entry_form"]!=272 && $row["entry_form"]!=262)
							{
								$variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($first_print_button==14 && $row["entry_form"]!=272)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==15 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==16 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==17 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==18 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==19 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==774 && $row["entry_form"]!=493)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print_booking_wg','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							
							$print_report_format_ids26=$print_report_format_arr26[$cbo_company];
							$format_ids26=explode(",",$print_report_format_ids26);
							// echo $format_ids26[0].'D'. $row[("entry_form")];
							if($format_ids26[0]==67 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==746 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report7','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==183 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==177 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report9','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==209 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==85 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report8','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==235 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==174 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report7','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==14 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report16','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							
							if($format_ids26[0]==274 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report10','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							 if($format_ids26[0]==719 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report10','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							else if( $row["entry_form"]==272 && $variable==$row[("booking_no_prefix_num")] )
							{
								if($format_ids26[0]==67 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==183 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==177 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==209 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print_t','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==85 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report8','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==235 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==174 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report7','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==274 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report10','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
							}
							if($trim_country_order_v2_button==177 && $row["entry_form"]==260)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if(($trim_country_order_v2_button==13 || $trim_country_order_v2_button==17) && $row["entry_form"]==260)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if(($trim_country_order_v2_button==14 || $trim_country_order_v2_button==18) && $row["entry_form"]==260)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if(($trim_country_order_v2_button==15 || $trim_country_order_v2_button==19) && $row["entry_form"]==260)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_country_order_v2_button==16 && $row["entry_form"]==260)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_country_order_v2_button==175 && $row["entry_form"]==260)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_country_order_v2_button==176 && $row["entry_form"]==260)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report6','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_country_order_v2_button==174 && $row["entry_form"]==260)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report_gr','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_woven_button[0]==67 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==183 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==177 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==175 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==235 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report9','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==85 && $row["entry_form"]=492 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print_t','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==786 && $row["entry_form"]=492 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print_t7','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button==774 && $row["entry_form"]=492 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report_wg','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
							//else $variable=$row[("booking_no")];
						}
						else if($cbo_category==25)
						{
							//echo $row[("entry_form")].'D';
							
							if($row[("entry_form")]==201)
							{
								//$wvn_emb_print_report_format_arr;
								$emb_format_ids=explode(",",$emb_print_report_format_arr);
								$first_print_button_emb=array_shift($emb_format_ids);
								$action_button="";
								if($first_print_button_emb==13)
								{
									$action_button="show_trim_booking_report2";
								}
								else if($first_print_button_emb==235)
								{
									$action_button="show_trim_booking_report9";
								}
								else if($first_print_button_emb==15)
								{
									$action_button="show_trim_booking_report3";
								}
								else if($first_print_button_emb==16)
								{
									$action_button="show_trim_booking_report4";
								}
								else if($first_print_button_emb==177)
								{
									$action_button="show_trim_booking_report5";
								}
								else if($first_print_button_emb==175)
								{
									$action_button="show_trim_booking_report6";
								}
								else if($first_print_button_emb==746)
								{
									$action_button="show_trim_booking_report7";
								}
							$variable="<a href='##' title='Print Actual' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_button."','".$i."','".$row[("supplier_id")]."','','')\" >".$row[("booking_no_prefix_num")]." </a>"; //actual print
							}
							if($row[("entry_form")]==574)
							{
								//$wvn_emb_print_report_format_arr;
								$knit_format_ids=explode(",",$wvn_emb_print_report_format_arr);
								$first_print_button_wvn=array_shift($knit_format_ids);
								$action_button="";
								if($first_print_button_wvn==13)
								{
									$action_button="show_trim_booking_report2";
								}
								else if($first_print_button_wvn==14)
								{
									$action_button="show_trim_booking_report3";
								}
							$variable="<a href='##' title='Print Actual' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_button."','".$i."','".$row[("supplier_id")]."','','')\" >".$row[("booking_no_prefix_num")]." </a>"; //actual print
							}
							else
							{
								$variable="<a href='##' title='Print Actual' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."','".$row[("supplier_id")]."')\" >".$row[("booking_no_prefix_num")]." </a>";
							}
						}
						else if($cbo_category==12) //Service Fab. Booking...
						{
							
							$format_ids_aop=explode(",",$print_report_format_aop);
							$first_print_button_aop=array_shift($format_ids_aop);
							//$dying_format_ids_aop=explode(",",$dying_print_report_format_aop);
							//$dying_first_print_button_aop=array_shift($dying_format_ids_aop);
							//echo $dying_first_print_button_aop.'kk';
							
							if($first_print_button==11)
							{ 
							 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==12)
							{ 
							 $variable="<a href='##' title='PB1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($dying_format_ids_aop==16)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button_aop==164)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button_aop==163)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							// if($dying_first_print_button_aop==8)
							// { 
							//  $variable="<a href='##' title='SPD' onClick=\"generate_fabric_report('".$dying_first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							// }
							// if($dying_first_print_button_aop==12)
							// { 
							//  $variable="<a href='##' title='SPD' onClick=\"generate_fabric_report('".$dying_first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							// }
							// if($dying_first_print_button_aop==16)
							// { 
							//  $variable="<a href='##' title='SPD' onClick=\"generate_fabric_report('".$dying_first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							// }
							// if($dying_first_print_button_aop==177)
							// { 
							//  $variable="<a href='##' title='SPD' onClick=\"generate_fabric_report('".$dying_first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							// }
							// if($dying_first_print_button_aop==175)
							// { 
							//  $variable="<a href='##' title='SPD' onClick=\"generate_fabric_report('".$dying_first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report15','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							// }
							// if($dying_first_print_button_aop==176)
							// { 
							//  $variable="<a href='##' title='SPD' onClick=\"generate_fabric_report('".$dying_first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report6','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							// }
					
							if($row[("entry_form")]==228) //Multi Job Wise service Booking Knitting
							{
								if($knit_first_print_button==13)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==15)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==16)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report3','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==177)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report4','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==175)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report5','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==176)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report6','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button=='')
								{ 
								 $variable=$row[("booking_no_prefix_num")];
								}								
							}
							if($row[("entry_form")]==182) //service Booking Knitting
							{
								if($service_knit_first_print_button==13)
								{ 
								 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($service_knit_first_print_button==12)
								{ 
								 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($service_knit_first_print_button==15)
								{ 
								 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($service_knit_first_print_button==16)
								{ 
								 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($service_knit_first_print_button==175)
								{ 
								 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($service_knit_first_print_button==176)
								{ 
								 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report6','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($service_knit_first_print_button==746)
								{ 
								 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report7','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								
								if($service_knit_first_print_button=='')
								{ 
								 $variable=$row[("booking_no_prefix_num")];
								}
								
							}
							if($row[("entry_form")]==534) //service Booking Knitting v2
							{
								if($service_knit_first_print_button==175)
								{ 
								 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($service_knit_first_print_button=='')
								{ 
								 $variable=$row[("booking_no_prefix_num")];
								}
								
							}
							if($row[("entry_form")]==232) //Multi Job Wise service Booking Knitting
							{
								if($dying_first_print_button==16)
								{ 
								 $variable="<a href='##' title='SPD' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($dying_first_print_button==12)
								{ 
								 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($dying_first_print_button==8)
								{ 
								 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($dying_first_print_button==177)
								{ 
								 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($dying_first_print_button==175)
								{ 
								 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($dying_first_print_button==176)
								{ 
								 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report6','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button=='')
								{ 
								 $variable=$row[("booking_no_prefix_num")];
								}
								
							}
							
						}
						if($row[("entry_form")]==178){
							$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
						}elseif($row["entry_form"]==262){
							$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
						}


						//$conversion_cost_head_array
						$process_id_all=array_unique(explode(",",chop($row[("process")],",")));
						$all_process="";
						foreach($process_id_all as $process_id)
						{
							$all_process.=$conversion_cost_head_array[$process_id].",";
						}
						$all_process=chop($all_process,",");
						
						$supplier_name="";
						if($row[("pay_mode")]==3 || $row[("pay_mode")]==5)
						{
							$supplier_name=$company_library[$row[("supplier_id")]];
						}
						else $supplier_name=$supplierArr[$row[("supplier_id")]];
						//echo $row[("currency_id")];.// $row[("booking_date")]
						if($row[("booking_type")]==2  && $row[("entry_form")]==43 )  $row[("delivery_date")]=$row[("delivery_date_dtls")];else  $row[("delivery_date")]=$row[("delivery_date_dtls")];
						
						$piWoNo="";
						$piWoNo=implode(",",array_unique(array_filter(explode("__",$wopi_arr[$row["booking_no"]]))));
						$piWoNoId=implode(",",array_unique(array_filter(explode("__",$wopiId_arr[$row["booking_no"]]))));
						?>
						<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
							<td width="30"><? echo $i;?></td>
							<td width="100" align="center"><p><? echo $company_library[$cbo_company]; ?><p></td>
							<td width="70" align="center" title="<?=$row['entry_form']?>"><? echo $variable; ?><? //echo $row[("booking_no_prefix_num")];?></td>
							<?
							if($cbo_category==25)
							{
								$embName=implode(",",array_unique(array_filter(explode("__",$only_emb_Name_array[$row["booking_no"]]))));
								$embNameType=implode(",",array_unique(array_filter(explode("__",$only_emb_Name_Type_array[$row["booking_no"]]))));
								$embType=implode(",",array_unique(array_filter(explode("__",$only_emb_Type_array[$row["booking_no"]]))));
								?>
							<td width="100" align="center"><p><? echo $embName;//$emblishment_name_array[$only_emb_item_array[$row[("booking_no")]]['emb_name']]; ?></p></td>
							<td width="100" align="center"><p>
							<?
								echo chop($emb_print_data[$row["booking_no"]],",");
								 /* $embType=implode(",",array_unique(array_filter(explode("__",$only_emb_item_array[$row[("booking_no")]]['emb_type']))));
								echo $embType;  */
								/* if($only_emb_item_array[$row[("booking_no")]]['emb_name']==1)
								{
								echo $emblishment_print_type[$only_emb_item_array[$row[("booking_no")]]['emb_type']];
								}
								if($only_emb_item_array[$row[("booking_no")]]['emb_name']==2)
								{
								echo $emblishment_embroy_type[$only_emb_item_array[$row[("booking_no")]]['emb_type']];
								}
								if($only_emb_item_array[$row[("booking_no")]]['emb_name']==3)
								{
								echo $emblishment_wash_type[$only_emb_item_array[$row[("booking_no")]]['emb_type']];
								}
								if($only_emb_item_array[$row[("booking_no")]]['emb_name']==4)
								{
								echo $emblishment_spwork_type[$only_emb_item_array[$row[("booking_no")]]['emb_type']];
								}
								if($only_emb_item_array[$row[("booking_no")]]['emb_name']==5)
								{
								echo $emblishment_gmts_type[$only_emb_item_array[$row[("booking_no")]]['emb_type']]; */
								//}
								?>
							</p></td>
							<?
							}?>
                            <td width="70" align="center"><p><? echo $pay_mode[$row[("pay_mode")]]; ?></p></td>						
                            <?
							if($cbo_category==12)
							{?>
								<td width="100" align="center" title="<? echo 'Pi='.$pi_id.', Booking-'.$row[("booking_no")]; ?>"><p><? echo $pi_no_arr[$row[("booking_no")]]['pi_no']; ?></p></td>
                                <td width="100"><p><? echo $all_process; ?>&nbsp;</p></td>
                                <?
							}
							else if($cbo_category==4)
							{
								
								
								//$piWoIdNo=implode(",",array_unique(array_filter(explode("__",$wopiId_arr[$row["booking_no"]]))));
								?>
                                <td width="100" style="word-break:break-all" align="center"><? echo $piWoNo; ?>&nbsp; </td>
                                <td width="100" style="word-break:break-all" align="center"><? echo $lc_type[$btb_pi[$piWoNo]['lc_type_id']]; ?>&nbsp; </td>
                                <td width="100" style="word-break:break-all" align="center"><? echo $pay_term[$btb_pi[$piWoNo]['payterm_id']]; ?>&nbsp; </td>
                                <td width="100" style="word-break:break-all" align="center"><? echo $btb_pi[$piWoNo]['tenor']; ?>&nbsp; </td>
                                <?
							}else if($cbo_category==25)
							{
								?>
                                <td width="100" style="word-break:break-all"><? echo $pi_no_arr[$row[("booking_no")]]['pi_no']; ?>&nbsp;</td>
                                <?
							}
							?>
							 <td width="100" style="word-break:break-all" align="center"><? echo $btb_pi[$piWoNo]['lc_number'] ?>&nbsp; </td>
							<td width="60" align="center"><p><? echo $row[("year_book")]; ?>&nbsp;</p></td>
                            <td width="70" align="center"><? echo change_date_format($row[("booking_date")]);?></td>	
							<td width="70" align="center"><p><? echo change_date_format($row[("update_date")]); ?>&nbsp;</p></td>
							<td width="70" align="center"><p><? echo change_date_format($row[("delivery_date")]); ?>&nbsp;</p></td>
							<td width="70" align="center"><p>
							<?
							$lead_time=0;
							if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00")
							{
								$lead_time=datediff("d", $row[("booking_date")], $row[("delivery_date")]);
							}
							if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day";
							?>&nbsp;</p></td>
							<td width="100"><p><? echo $wo_type;?>&nbsp;</p></td>
							<td width="100" title="MSg=<? echo $row[("ready_to_approved")];?>" align="center"><? echo $yes_no[$row[("ready_to_approved")]]; ?></td>
                              <?
							//if ($cbo_category==4)
							//{
								?>
                             <td width="100" align="center"><? $last_update_date=explode(" ",$last_update_date);echo change_date_format($last_update_date[0]).'<br>'.$last_update_date[1]; ?></td>
                             <?
							//}
							 ?>
							<td width="80"><p><? echo $approval_type_arr[$row[("is_approved")]]; ?>&nbsp;</p></td>
                             <?
							//if ($cbo_category==4)
							//{
								$approved_date=$last_app_arr[$row[("booking_id")]]['approved_date'];
								$approved_by=$last_app_arr[$row[("booking_id")]]['approved_by'];
								?>
                             <td width="100" title="bookingId=<? echo $row[("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                              <?
							//}
							 ?>
							<td width="100" style="word-break:break-all"><p><? echo $supplier_name; ?>&nbsp;</p></td>
							<td width="100" style="word-break:break-all"><p><? echo $buyerArr[$row[("buyer_id")]]; ?>&nbsp;</p></td>
							<td width="70"><p><? echo $job_no;//$row[("job_no_prefix_num")]; ?>&nbsp;</p></td>
                            <td width="70"><p><? echo $season_buyer;//$row[("job_no_prefix_num")]; ?>&nbsp;</p></td>
							<td width="60"><? echo $job_year;// $year; ?></td>
							<td width="100" style="word-break:break-all"><p><? if ($row[("type")]==0) echo $style_ref_no; else echo $nonStyleArr[$style_ref_no]; ?>&nbsp;</p></td>
							<td width="100" style="word-break:break-all"><p><? echo $ref; ?>&nbsp;</p></td>
							<td width="100"><p><? echo $file; ?>&nbsp;</p></td>
							<td width="100" style="word-break:break-all"><p><? echo $po_number; ?>&nbsp;</p></td>
							<td width="100"><p>
							<?
							if ($row[("type")]==0)
							{
								echo "Max - ". $max_ship_date;
								$order_count=explode(",",$po_number);
								if(count($order_count)>1) echo "<br> Min  - " . $min_ship_date; 
							}
							?>&nbsp;</p></td>
							<td width="80" style="word-break:break-all"><p><? echo $item_category[$row[("item_category")]]; ?>&nbsp;</p></td>
							<? 
							//booking_id
							$td_color="";
							
							if(strtotime($first_rec_date[$row[("booking_id")]])>strtotime($row[("delivery_date")])) $td_color='bgcolor="#FF0000"'; else $td_color='';
							$first_rcv_date=change_date_format($first_rec_date[$row[("booking_id")]]);
							
							 //echo $row[("booking_type")]."***".$row[("type")] ;
							?>
							<td width="70" title="<? echo "Booking No : ".$booking_data[$row[("booking_id")]]["booking_no"]."\nFirst Receive No:".$first_rec_no[$row[("booking_id")]]; ?>" align="center" <? echo $td_color; ?> ><p><? if($first_rec_date_pi[$piWoNoId]['receive_basis']==1){echo change_date_format($first_rec_date_pi[$piWoNoId]['receive_date']);
							}else{
								echo change_date_format($first_rec_date[$row[("booking_id")]]);
							}   ?></p></td>
							<?
								if ($cbo_category==4)
								{
									$usd_id=2;
									if($db_type==0) $conversion_date=change_date_format($row[("booking_date")], "Y-m-d", "-",1);
									else $conversion_date=change_date_format($row[("booking_date")], "d-M-y", "-",1);
									$currency_rate=set_conversion_rate($usd_id,$conversion_date );
									if($row[("currency_id")]==2) $wo_currency_usd_amt=$row[("amount")];//USD
									else $wo_currency_usd_amt=$row[("amount")]/$currency_rate;
									$rec_amt=0;
									if($rec_amt_arr[$row["booking_id"]]>0){
										$rec_amt=$rec_amt_arr[$row["booking_id"]];
										$rec_currency=$rec_currency_arr[$row["booking_id"]];
									}else{
										$rec_amt=$rec_amt_arr[$piWoNoId];
										$rec_currency=$rec_currency_arr[$piWoNoId];
									}
							
									//echo $rec_currency.'GG';
									$rec_date=$first_rec_date[$row["booking_id"]];
									if($rec_currency==2) $recv_usd_amt=$rec_amt;//USD
									else $recv_usd_amt=$rec_amt/$currency_rate;
									?>
										<td width="100" align="right"><? echo number_format($row[("amount")],2); ?></td>
                                        <td width="100" align="right" title="Exchange Rate=<? echo $currency_rate;?>"><? echo number_format($wo_currency_usd_amt,2); ?></td>
                                        <td width="100" align="right"><? echo number_format($rec_amt,2); ?></td>
                                        <td width="100" align="right"><? echo number_format($recv_usd_amt,2); ?></td>
									<?
								}
								else
								{
									$currency_id=$row[("currency_id")];
								//echo $currency_id.'dddd,';
									if($cbo_category==25 && $currency_id==1)
									{	
									$cid=2;
									$ex_rate=set_conversion_rate($cid, $row[("booking_date")],$cbo_company);
									$wo_amount=$row[("amount")]/$ex_rate;
									//echo $exchnage_rate.'CCCC';
									} else $wo_amount=$row[("amount")];
									?>
										<td width="100" align="right"><? if ($cbo_category==25 || $cbo_category==12 ) echo number_format($row[("wo_qnty")],2); else echo number_format($row[("fin_fab_qnty")],2); ?></td>
                                       <?
                                        if($cbo_category==25)
										{
										?>
										<td width="100" align="left" ><?  echo $unit_of_measurement[$row[("uom")]]; ?></td>
										<td width="100" align="right" title="<? echo $ex_rate;?>"><?  echo number_format($wo_amount,2); ?></td>
										
									<?
										}
										else
										{ ?>
											<td width="100" align="right"><? if ($cbo_category==25 || $cbo_category==12) echo number_format($row[("wo_qnty")],2); else echo number_format($row[("grey_fab_qnty")],2); ?></td>
									<?	}
								}
								if ($cbo_category==2)
								{
									?>
									<td width="80"><p><?=number_format($sample_qnt,2)?></p></td>
									<td width="80"><p>&nbsp; </p></td>
									<td width="80"><p><? echo $short_reason; ?></p></td>
									<?
								}
							?>
							<td width="80" style="word-break:break-all"><? echo $level_arr[$row[("cbo_level")]]; ?></td>
							<td width="">&nbsp;&nbsp;&nbsp;&nbsp;<? //echo $row[("po_number")]; ?></td>
						</tr>
						<?
						$tot_wo_qnty+=$row[("amount")];
						$tot_rec_amt+=$rec_amt;
						
						$tot_wo_currency_usd_amt+=$wo_currency_usd_amt;
						$tot_recv_usd_amt+=$recv_usd_amt;
						
						if ($cbo_category==25 || $cbo_category==12)//Embllishment
						{
							$tot_fin_fab_qnty+=$row[("wo_qnty")];
							$tot_grey_fab_qnty+=$row[("wo_qnty")];
							$tot_embl_wo_amount+=$wo_amount;
						}
						else
						{
							$tot_fin_fab_qnty+=$row[("fin_fab_qnty")];
							$tot_grey_fab_qnty+=$row[("grey_fab_qnty")];
							$tot_embl_wo_amount+=$wo_amount;
						}
						$i++;
					}
				}
				?>
				</table>
			</div>
			<table width="<? echo $tbl_width; ?>" cellspacing="0" border="1" class="rpt_table" rules="all">
				<tfoot>
					<th width="30">&nbsp;</th>    
					<th width="100">&nbsp;</th>
					<th width="70">&nbsp;</th>
					<?
					if ( $cbo_category==25)
					{
						?>
                    <th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
                        <?
					}?>
                    <th width="70">&nbsp;</th>
                    <?
					if ($cbo_category==3 || $cbo_category==2 || $cbo_category==25 || $cbo_category==4)
					{
						?>
                        <th width="100">&nbsp;</th>
                        <?
					}

					if ($cbo_category==4)
					{
						?>
                        
                        <th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
                        <?
					}

					if ($cbo_category==12)
					{
						?>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
                        <?
					}
					?>
					<th width="100">&nbsp;</th>
					<th width="60">&nbsp;</th>
					<th width="70">&nbsp;</th>
					<th width="70">&nbsp;</th>
					<th width="70">&nbsp;</th>
                    <th width="70">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
                    <th width="100">&nbsp;</th>
					<th width="80">&nbsp;</th>
                    <th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="70">&nbsp;</th>
                    <th width="70">&nbsp;</th>
					<th width="60">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
                    <th width="100">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="70">Total</th>
					<?
						if ($cbo_category==4)
						{
							?>
								<th width="100" align="right" id=""><? //echo number_format($tot_wo_qnty,2); ?></th>
                                <th width="100" align="right" id=""><? echo number_format($tot_wo_currency_usd_amt,2); ?></th>
                                <th width="100" align="right" id=""><? //echo number_format($tot_wo_qnty,2); ?></th>
                                <th width="100" align="right" id=""><? echo number_format($tot_recv_usd_amt,2); ?></th>
							<?
						}
						else
						{
							?>
								<th width="100"><? echo number_format($tot_fin_fab_qnty,2); ?></th>
								<?
								if ($cbo_category==2)
								{
									?>
			                        <th width="100"><? echo number_format($tot_amount,2); ?></th>
			                        <?
								}
								if ($cbo_category==25)
								{
									?>
			                        <th width="100">&nbsp;</th>
			                        <?
								}
								if ($cbo_category==25)
								{
									?>
			                        <th width="100"><? echo number_format($tot_embl_wo_amount,2); ?></th>
			                        <?
								}
								else if ($cbo_category==3)
								{
									?>
			                        <th width="100"><? echo number_format($tot_amount,2); ?></th>
			                        <?
								}
								else
								{
									?>
									<th width="100"><? echo number_format($tot_grey_fab_qnty,2); ?></th>
									<?
								}
								?>
								
							<?
						}
					if($cbo_category==2)//Knit Fab.
					{
						?>
						<th width="80"><?=number_format($tot_sample,2);?></th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<?
					}
					?>
					<th width="80">&nbsp;</th>
					<th>&nbsp;</th>
				</tfoot>
			</table>
            <br>
            <?
			
			if ($cbo_category==2)
			{
				?>
                <table class="rpt_table" width="600" cellpadding="0" cellspacing="0" border="1" rules="all">
                	<thead>
                    	<tr bgcolor="#CCCCCC">
                                <td colspan="6" align="center" style="font-size:16px; font-weight:bold;">Finish Fabric OTD Summary</td>
                            </tr>
                    	<tr>
                        	<th width="100">WO Type</th>
                            <th width="100">Required Qty.</th>
                            <th width="100">On Time Rcvd Qty</th>
                            <th width="100">Total Rcvd Qty</th>
                            <th width="100">Balance</th>
                            <th >OTD %</th>
                        </tr>
                    </thead>
                    <tbody>
                    	<?
						$wo_type_arr=array(1=>"Main",2=>"Short",3=>"Sample",4=>"Non Ord Sample");
						foreach($summer_data as $wo_type=>$val)
						{
							$balance=$val["book_qnty"]-$val["rcv_qnty"];
							$otd_percent=(($val["rcv_qnty_intime"]/$val["book_qnty"])*100);
							?>
                            <tr>
                                <td><? echo $wo_type_arr[$wo_type]; ?></td>
                                <td align="right"><? echo number_format($val["book_qnty"],2); $tot_book_qnty+=$val["book_qnty"]; ?></td>
                                <td align="right"><? echo number_format($val["rcv_qnty_intime"],2); $tot_rcv_qnty_intime+=$val["rcv_qnty_intime"];  ?></td>
                                <td align="right"><? echo number_format($val["rcv_qnty"],2); $tot_rcv_qnty+=$val["rcv_qnty"];  ?></td>
                                <td align="right"><? echo number_format($balance,2); $tot_balance+=$balance;  ?></td>
                                <td align="right"><? echo number_format($otd_percent,2); ?></td>
                            </tr>
                            <?
						}
						?>
                    </tbody>
                    <tfoot>
                    	<tr>
                        	<th>Total</th>
                            <th><? echo number_format($tot_book_qnty,2); ?></th>
                            <th><? echo number_format($tot_rcv_qnty_intime,2); ?></th>
                            <th><? echo number_format($tot_rcv_qnty,2); ?></th>
                            <th><? echo number_format($tot_balance,2); ?></th>
                            <th>&nbsp;</th>
                        </tr>
                    </tfoot>
                </table>
                <?
			}
			?>
		</fieldset>
		<?
	}
	else if ($cbo_category==24)// Service Yarn
	{
		if($db_type==0)
		{
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and YEAR(a.insert_date)=$year_id";
		}
		elseif($db_type==2)
		{ 
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(a.insert_date,'YYYY')=$year_id";
		}
		
		if ($cbo_company==0) $company_id=""; else $company_id=" and a.company_id=$cbo_company";
		if ($cbo_buyer==0) $supplier_cond=""; else $supplier_cond=" and a.supplier_id=$cbo_buyer";
		if ($cbo_category==0) $category_id=""; else $category_id=" and a.item_category=$cbo_category";
		if ($wo_no=="") $wo_no_cond=""; else $wo_no_cond=" and a.ydw_no='$wo_no'";
		
		if ($wo_type==2) $wo_type_cond=" and a.entry_form=41"; else if ($wo_type==4) $wo_type_cond=" and a.entry_form=42"; else $wo_type_cond="";
		
		if ($job_no=="") $job_num=""; else $job_num=" and b.job_no='$job_no'";
		//if ($job_no=="") $job_num_mst=""; else $job_num_mst=" and b.job_no_mst=$job_no";
		if ($po_no=='') $po_no_no=""; else $po_no_no=" and d.po_number in ($po_no)";
		if ($hidd_po=="") $po_id=""; else $po_id=" and d.id in ( $hidd_po )";
		
		if ($hidd_po=="") $po_id_cond=""; else $po_id_cond=" and b.po_break_down_id in ( $hidd_po )";
		
		if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and d.file_no='".trim($file_no)."' "; 
		if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and d.grouping='".trim($internal_ref)."' "; 
		//echo $file_no_cond.'=='.$internal_ref_cond;die;
		
		if($db_type==0)
		{
			if($txt_date_category==1) 
			{	
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".$date_from."' and '".$date_to."'";
			}
			else 
			{
				if($txt_date_category==2) if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".$date_from."' and '".$date_to."'";
			}
		}
		if($db_type==2)
		{
			if($txt_date_category==1) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
			else if($txt_date_category==2) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
		}
	
		
		$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
		$supplierArr=return_library_array( "select id,supplier_name from lib_supplier", "id", "supplier_name");	
		$buyerArr=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
		//$nonStyleArr=return_library_array( "select id, style_ref_no from sample_development_mst", "id", "style_ref_no");		
		
		
		
		ob_start();
		?>
		<fieldset style="width:2310px">
			<table width="2290"  cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none; font-size:18px;" colspan="21">
						<? echo $company_library[str_replace("'","",$cbo_company_id)]; ?>                                
					</td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:16px; font-weight:bold" colspan="21"> <? echo $report_title; if($cbo_category!=0) echo " For ".$item_category[$cbo_category]; ?></td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:12px; font-weight:bold"  colspan="21"> <? if( $date_from!="" && $date_to!="" ) echo "From ".change_date_format($date_from)." To ".change_date_format($date_to);?></td>
				</tr>
			</table>
            <table class="rpt_table" width="2390" cellpadding="0" cellspacing="0" border="1" rules="all">
				<thead>
					<th width="30">SL</th>    
					<th width="100">Comapny</th>
					<th width="60">Wo No</th>
					<th width="60">PI No</th>
					<th width="100">BTB LC No</th>
					<th width="60">Wo Year</th>
					<th width="70">Wo Date</th>
					<th width="70">Deli. Date</th>
                    <th width="70">Lead Time</th>
					<th width="100">Wo Type</th>
					<th width="100">Ready To App.</th>
                    <th width="100">Ready To Approved<br> date and time</th>                    
					<th width="80">App. Status</th>
                    <th width="100">Last Approval <br>Date time and Person</th>
					<th width="100">Supplier</th>
					<th width="100">Buyer</th>
					<th width="110">Job No.</th>
					<th width="60">Job Year</th>
					<th width="100">Style Ref.</th>
					<th width="100">Inter. Ref.</th>
					<th width="100">File No.</th>
					<th width="100">Order No</th>
                    <th width="100">Shipment Date</th>
					<th width="80">Item Cate.</th>
					<th width="70">First Rec. Date</th>
                    <th width="100">Wo Qty</th>
                    <th width="100">W/O Value USD</th>
					<th >Remarks</th>
				</thead>
			</table>
			<div style="max-height:350px; overflow-y:scroll; width:2410px" id="scroll_body" >
				<table cellspacing="0" cellpadding="0" border="1" class="rpt_table"  width="2390" rules="all" id="table_body" >
				<?
				if ($cbo_company==0) $company_cond_id=""; else $company_cond_id=" and b.company_id=$cbo_company";
				if($cbo_category==24)
				{
					$sql="select a.id, a.ydw_no, min(b.receive_date) as receive_date from wo_yarn_dyeing_mst a,inv_receive_master b where a.ydw_no=b.booking_no and b.item_category=1  and b.receive_basis=2 and b.receive_purpose=2 $company_cond_id group by a.id, a.ydw_no";	
					$sql_result=sql_select($sql);
					foreach($sql_result as $row)
					{
						$first_rec_date[$row[csf("id")]]=$row[csf("receive_date")];
					}
				}
				if($db_type==0)
				{	
					$sql="Select a.company_id,a.id as booking_id,a.is_approved,a.ready_to_approved,a.update_date, a.entry_form, a.ydw_no,a.pay_mode, Year(a.insert_date) as year_book, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.supplier_id, b.job_no, b.uom, sum(b.yarn_wo_qty) as wo_qnty,sum(b.amount) as amount, a.currency,b.fab_booking_no from wo_yarn_dyeing_mst a, wo_yarn_dyeing_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $supplier_cond and a.item_category_id=24 $job_num $booking_date_cond $wo_no_cond $wo_type_cond group by a.company_id,a.id,a.update_date, a.entry_form, a.ydw_no, a.insert_date, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.is_approved,a.supplier_id, b.job_no, b.uom order,a.ready_to_approved,b.fab_booking_no , a.currency by a.id Desc";
				}
				else if ($db_type==2)
				{
					$sql="Select a.company_id,a.id as booking_id,a.is_approved,a.ready_to_approved,a.update_date, a.entry_form, a.ydw_no,a.pay_mode, TO_CHAR(a.insert_date,'YYYY') as year_book, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.supplier_id, b.job_no,b.job_no_id, b.uom, sum(b.yarn_wo_qty) as wo_qnty,sum(b.amount) as amount, a.currency,b.fab_booking_no from wo_yarn_dyeing_mst a, wo_yarn_dyeing_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $supplier_cond and a.item_category_id=24 $job_num $booking_date_cond $wo_no_cond $wo_type_cond group by a.company_id,a.id,a.update_date,a.entry_form, a.ydw_no,a.pay_mode, a.insert_date, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.is_approved,a.supplier_id, b.job_no,b.job_no_id, b.uom, a.ready_to_approved,a.currency,b.fab_booking_no order by a.id Desc";
				}
				//echo $sql; //die;
				//echo  $po_id ;die;
				$tot_wo_amount=0;
				$sql_result=sql_select($sql); $i=1;
				foreach ($sql_result as $row) 
				{
					$booking_id_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
					$job_id_arr[$row[csf("job_no_id")]]=$row[csf("job_no_id")];
				}
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 1, $job_id_arr, $empty_arr);//Job ID Ref from=1
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 2, $booking_id_arr, $empty_arr);//Book ID Ref from=2
				 

				$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id and b.work_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0
				and a.item_category_id=24 and a.pi_basis_id=1";
				$pi_sql_result=sql_select($pi_sql);
				$pi_no_arr = array();
				foreach ($pi_sql_result as $value) 
				{
				$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
				$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];
				}
				unset($pi_sql_result);
				/*$sql="select a.job_no,d.id as po_id from wo_po_details_master a, wo_po_break_down d,gbl_temp_engine g where a.id=d.job_id and a.status_active=1 and a.is_deleted=0 and d.status_active=1 and d.is_deleted=0 $internal_ref_cond  $file_no_cond  group by a.job_no,d.id";
				$sql_resultpo=sql_select($sql);
				$po_id_data="";$k=0;
				foreach($sql_resultpo as $row)
				{
				if($k==0)
				{
				$po_data_cond=$row[csf('po_id')];
				$job_data_cond=$row[csf('job_no')];
				}
				else
				{
				$po_data_cond.=",".$row[csf('po_id')];
				$job_data_cond.=",".$row[csf('job_no')];
				} 
				} //echo $job_data_cond;
				if($file_no_cond!="" || $internal_ref!="")
				{  
				$po_data_file_ref=" and b.po_break_down_id in($po_data_cond) "; 
				$job_data_file_ref=" and b.job_no in('$job_data_cond') "; 
				}
				else
				{
				$po_data_file_ref="";
				$job_data_file_ref="";
				}*/

				if($db_type==0)
				{
				$job_sql="select a.job_no_prefix_num, a.job_no, a.buyer_name, Year(a.insert_date) as year, a.style_ref_no, a.garments_nature, 
				group_concat(b.id) as id,
				group_concat(b.po_number) as po_number,
				group_concat(b.file_no) as file_no,
				group_concat(b.grouping) as grouping,
				max(b.pub_shipment_date) as max_ship_date,
				min(b.pub_shipment_date) as min_ship_date
				from wo_po_details_master a, wo_po_break_down b,gbl_temp_engine g where a.job_no=b.job_no_mst and and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.job_no_prefix_num, a.job_no, a.buyer_name, a.insert_date, a.style_ref_no, a.garments_nature";
				}
				elseif($db_type==2)
				{
				  $job_sql="select a.job_no_prefix_num, a.job_no, a.buyer_name, TO_CHAR(a.insert_date,'YYYY') as year, a.style_ref_no, a.garments_nature, 
				 b.id as id,
				 b.po_number as po_number,
				 b.file_no as file_no,
				 b.grouping as grouping,
				(b.pub_shipment_date) as max_ship_date,
				(b.pub_shipment_date) as min_ship_date
				from wo_po_details_master a, wo_po_break_down b,gbl_temp_engine g where a.id=b.job_id and a.id=g.ref_val  and b.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
				}

				$job_sql_result=sql_select($job_sql);
				foreach($job_sql_result as $row)
				{
				$order_no=$row[csf("po_number")];//implode(",",array_unique(explode(",",$row[csf("po_number")])));
				$order_id=$row[csf("id")];//implode(",",array_unique(explode(",",$row[csf("id")])));
				$file_no=$row[csf("file_no")];//implode(",",array_unique(explode(",",$row[csf("file_no")])));
				$int_ref=$row[csf("grouping")];//implode(",",array_unique(explode(",",$row[csf("grouping")])));

				$job_array[$row[csf("job_no")]]['job']=$row[csf("job_no_prefix_num")];
				$job_array[$row[csf("job_no")]]['job_no']=$row[csf("job_no")];
				$job_array[$row[csf("job_no")]]['buyer']=$row[csf("buyer_name")];
				$job_array[$row[csf("job_no")]]['year']=$row[csf("year")];
				$job_array[$row[csf("job_no")]]['style_ref_no']=$row[csf("style_ref_no")];
				$job_array[$row[csf("job_no")]]['garments_nature']=$row[csf("garments_nature")];
				$job_array[$row[csf("job_no")]]['max_ship_date'].=$row[csf("max_ship_date")].',';
				$job_array[$row[csf("job_no")]]['min_ship_date'].=$row[csf("min_ship_date")].',';
				$job_array[$row[csf("job_no")]]['id'].=$order_id.',';
				$job_array[$row[csf("job_no")]]['po_number'].=$order_no.',';
				$job_array[$row[csf("job_no")]]['file'].=$file_no.',';
				$job_array[$row[csf("job_no")]]['ref'].=$int_ref.',';
				}

				$emb_item_array=array();

				$emb_sql="select a.emb_name, b.item_number_id, c.job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b, wo_po_break_down c,gbl_temp_engine g where a.job_id=b.job_id and c.id=b.po_break_down_id  and a.job_id=g.ref_val and b.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
				$emb_sql_result=sql_select($emb_sql);
				foreach($emb_sql_result as $row)
				{
				$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
				$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
				}
				//var_dump($job_array);

				 $wo_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_yarn_dyeing_mst a, approval_history b,gbl_temp_engine g where a.id=b.mst_id and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(30)  order by b.id desc";
				$wo_his_sql_result=sql_select($wo_his_sql);
				//$pi_no_arr = array();
				$user_arr=return_library_array( "select id, user_name from user_passwd", 'id', 'user_name' );	
				foreach ($wo_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_his_sql_result);
				
				/*$wo_non_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_non_ord_samp_booking_mst a, approval_history b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(8,7,32) ".where_con_using_array($booking_id_arr,0,'a.id')." order by b.id desc";
				$wo_non_his_sql_result=sql_select($wo_non_his_sql);
				//$pi_no_arr = array();
			 
				foreach ($wo_non_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_non_his_sql_result);*/
				$lc_sql="select a.contract_no,b.wo_po_break_down_id,c.booking_no from com_sales_contract a, com_sales_contract_order_info b, wo_booking_dtls c,gbl_temp_engine g  where a.id=b.com_sales_contract_id and c.po_break_down_id=b.wo_po_break_down_id and c.booking_mst_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
				 //echo $lc_sql;die;
				 $lc_sql_result=sql_select($lc_sql);
				foreach( $lc_sql_result as $row)
				{
					$lc_no_array[$row[csf("booking_no")]]['contract_no']=$row[csf("contract_no")];
				}
				unset($lc_sql_result);
				$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id  and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0
				and a.item_category_id=24 and a.pi_basis_id=1";
				$pi_sql_result=sql_select($pi_sql);
				$pi_no_arr = array();
				foreach ($pi_sql_result as $value) 
				{
					$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
					$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];
				}
				unset($pi_sql_result);
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				
				foreach($sql_result as $row)
				{
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					if ($row[csf("entry_form")]==41) $wo_type="Order";
					else if ($row[csf("entry_form")]==42) $wo_type="Non Order";
					$job_number=implode(",",array_unique(explode(",",$row[csf("job_no")])));
					$supplier_name="";
					if($row[csf("pay_mode")]==3 || $row[csf("pay_mode")]==5)
					{
						$supplier_name=$company_library[$row[csf("supplier_id")]];
					}
					else $supplier_name=$supplierArr[$row[csf("supplier_id")]];

					$cid=2;
					if($row[csf('currency')]==2)
					{
						$cid=1;
					}
					if($row[csf('ready_to_approved')]==1) //ready
					{
						$last_update_date=$row[csf('update_date')];
					}
					
					$ex_rate=set_conversion_rate($cid, $row[csf("booking_date")],$cbo_company);
					$wo_amount=$row[csf("amount")]/$ex_rate;

					if($cbo_company!=0) $cbo_company_cond="and template_name=$cbo_company";else $cbo_company_cond="";
					//Yarn Dying With Order
					$Yarn_Dyeing_Work_Order=return_field_value("format_id"," lib_report_template"," module_id=2 and report_id=7 and is_deleted=0 and status_active=1 $cbo_company_cond");
					$ydwreportArr= explode(',',$Yarn_Dyeing_Work_Order);
					$ydwreport=$ydwreportArr[0];
					//Yarn Dying Without Order
					$Yarn_Dyeing_Work_without_order=return_field_value("format_id"," lib_report_template"," module_id=2 and report_id=8 and is_deleted=0 and status_active=1 $cbo_company_cond");
					$ydworeportArr= explode(',',$Yarn_Dyeing_Work_without_order);
					$ydworeport=$ydworeportArr[0];
					//Yarn Service Work Order
					$Yarn_Service_Work_order=return_field_value("format_id"," lib_report_template"," module_id=2 and report_id=14 and is_deleted=0 and status_active=1 $cbo_company_cond");
					$yswreportArr= explode(',',$Yarn_Service_Work_order);
					$yswreport=$yswreportArr[0];
					//Yarn Dyeing Work Order Sales
					$Yarn_Dying_Work_order_Sales=return_field_value("format_id"," lib_report_template"," module_id=2 and report_id=228 and is_deleted=0 and status_active=1 $cbo_company_cond");
					$ydw_sales_reportArr= explode(',',$Yarn_Dying_Work_order_Sales);
					$ydw_sales_report=$ydw_sales_reportArr[0];
					//Yarn Dying Work Order Without Lot
					$Yarn_Dyeing_Work_Order_With_Out_Lot=return_field_value("format_id"," lib_report_template"," module_id=2 and report_id=28 and is_deleted=0 and status_active=1 $cbo_company_cond");
					$ydw_lot_reportArr= explode(',',$Yarn_Dyeing_Work_Order_With_Out_Lot);
					$ydw_lot_report=$ydw_lot_reportArr[0];

					if($ydw_lot_report==78){$reporAction="print2";}//Yarn Dying Work Order Without Lot
					else if($ydw_lot_report==77){$reporAction="show_with_multiple_job_without_rate";}
					else if($ydw_lot_report==76){$reporAction="show_with_multiple_job";}
					else if($ydw_lot_report==75){$reporAction="show_without_rate_booking_report";}
					else if($ydw_lot_report==74){$reporAction="show_trim_booking_report";}
					else if($ydw_lot_report==117){$reporAction="show_print2_booking_report";}

					/* if($ydwreport==74){$reporAction="show_trim_booking_report";}//Yarn Dying With Order
					else if($ydwreport==15){$reporAction="show_trim_booking_report_two";}//Yarn Dying With Order */

					if($yswreport==79){$reporAction="show_trim_booking_report";}//Yarn Service With Order
					if($yswreport==80){$reporAction="show_without_rate_booking_report";}//Yarn Service With Order
					else if($yswreport==867){$reporAction="sales_order_report";}//Yarn Service With Order
					else if($yswreport==868){$reporAction="sales_order_report_two";}//Yarn Service With Order

					if($ydworeport==13){$reporAction="show_print_booking_report";}//Yarn Dying Without Order
					//else if($ydworeport==79){$reporAction="show_trim_booking_report";}
					else if($ydworeport==80){$reporAction="show_without_rate_booking_report";}
					else if($ydworeport==81){$reporAction="show_with_multiple_job";}
					else if($ydworeport==82){$reporAction="show_with_multiple_job_without_rate";}

					//if($ydw_sales_report==3){$reporAction="generate_report2";}//Yarn Dyeing Work Order Sales
					//print_r($Yarn_Service_Work_order);die;

					 $variable="<a  href='##'  onClick=\"generate_fabric_report('".$row[csf("entry_form")]."','".$row[csf("ydw_no")]."','".$row[csf("company_id")]."','".$row[csf("booking_id")]."','".$cbo_category."','','','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','','','".$reporAction."','".$i."')\">".$row[csf("yarn_dyeing_prefix_num")]."  <a/>";
					
					?>
					
					<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
						<td width="30"><? echo $i;?></td>
						<td width="100" align="center"><p><? echo $company_library[$row[csf("company_id")]]; ?></td>
						<td width="60" align="center">
							<?
							 echo $variable; 
							 ?>
						</td>
						<td width="60" align="center"><p><? echo $pi_no_arr[$row[csf("ydw_no")]]['pi_no']; ?></td>
						<td width="100" style="word-break:break-all" align="center"><? echo $lc_no_array[$row[("booking_no")]]['contract_no'] ?>&nbsp;</td>
						<td width="60" align="center"><p><? echo $row[csf("year_book")]; ?></td>
						<td width="70"><p style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("booking_date")], "", "",0); ?></p></td>
						<td width="70"><p style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("delivery_date")]); ?></p></td>
                        
                        <td width="70"><p style="word-wrap:break-word; width:70px">
						<? 
						$lead_time=0;
						if($row[csf("delivery_date")]!="" && $row[csf("delivery_date")]!="0000-00-00")
						{
							$lead_time=datediff("d", $row[csf("booking_date")], $row[csf("delivery_date")]);
						}
						if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day"; 
						?></p></td>
                        
						<td width="100"><p><? echo $wo_type;?></p></td>
						<td width="100" align="center"><? echo $yes_no[$row[csf("ready_to_approved")]]; ?></td>
                         <td width="100" align="center"><? $last_update_dateArr=explode(" ",$last_update_date);echo change_date_format($last_update_dateArr[0]).'<br>'.$last_update_dateArr[1]; ?></td>
						<td width="80"><p><? echo $approval_type_arr[$row[csf("is_approved")]]; ?></p></td>
                         <?
							//if ($cbo_category==4)
							//{
								$approved_date=$last_app_arr[$row[csf("booking_id")]]['approved_date'];
								$approved_by=$last_app_arr[$row[csf("booking_id")]]['approved_by'];
								?>
                         <td width="100" title="bookingId=<? echo $row[csf("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                             
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $supplier_name; ?></p></td>
						<td width="100"><p><? echo $buyerArr[$job_array[$job_number]['buyer']]; ?></p></td>
						<td width="110"><p style="word-wrap:break-word; width:110px"><? echo $row[csf("job_no")];//$row[csf("job_no_prefix_num")]; ?></p></td>
						<td width="60"><? echo $job_array[$job_number]['year']; ?></td>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $job_array[$job_number]['style_ref_no']; ?></p></td>
						<?
						$ref_all=rtrim($job_array[$job_number]['ref'],',');
						$ref_all=implode(", ",array_unique(explode(",",$ref_all)));
						$file_all=rtrim($job_array[$job_number]['file'],',');
						$file_all=implode(", ",array_unique(explode(",",$file_all)));
						$po_all=rtrim($job_array[$job_number]['po_number'],',');
						$po_all=implode(", ",array_unique(explode(",",$po_all)));
						?>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $ref_all; ?></p></td>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $file_all; ?></p></td>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $po_all; ?></p></td>
                        <td width="100"><p style="word-wrap:break-word; width:100px">
						<? 
						$max_shipdate=rtrim($job_array[$job_number]['max_ship_date'],',');
						$max_ship_dateArr=explode(",",$max_shipdate);
						$max_ship_date=max($max_ship_dateArr);
						$min_shipdate=rtrim($job_array[$job_number]['min_ship_date'],',');
						$min_shipdateArr=explode(",",$min_shipdate);
						$min_shipdate=min($min_shipdateArr);

						if($max_ship_date!="" && $max_ship_date!="0000-00-00") echo "Max - ".change_date_format($max_ship_date);
						//if($job_array[$job_number]['max_ship_date']!=$job_array[$job_number]['min_ship_date']) echo "<br> " . change_date_format($job_array[$job_number]['min_ship_date']); 
						$po_number=rtrim($job_array[$job_number]['po_number'],',');
						$order_count=explode(",",$po_number);
						if(count($order_count)>1) echo "<br> Min - " . change_date_format($min_shipdate);
						 
						?></p></td>
						<td width="80"><p style="word-wrap:break-word; width:80px"><? echo $item_category[24]; ?></p></td>
						<td width="70" align="center"><p><? echo change_date_format($first_rec_date[$row[csf("booking_id")]]); ?></p></td>
						<td width="100" align="right"><? echo number_format($row[csf("wo_qnty")],2); ?></td>
						<td width="100" align="right"><? echo number_format($wo_amount,2); ?></td>
						<td>&nbsp; </td>
					</tr>
					<?
					$tot_wo_qnty+=$row[csf("wo_qnty")];
					$tot_wo_amount+=$wo_amount;
					$i++;
				}
				?>
				</table>
				<table class="rpt_table" width="2390" cellpadding="0" cellspacing="0" border="1" rules="all">
					<tfoot>
						<th width="30">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="70">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="110">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="80">Total</th>
						<th width="70">&nbsp;</th>
                        <th width="100" align="right" id="tot_fin_fab_qnty"><? echo number_format($tot_wo_qnty,2); ?></th>
                        <th width="100" align="right" id="tot_wo_amount"><? echo number_format($tot_wo_amount,2); ?></th>
						<th>&nbsp;</th>
					</tfoot>
				</table>
			</div>
		</fieldset>
		<?
	}
	
	else if ($cbo_category==31)//31=Services Lab Test
	{
		if($db_type==0)
		{
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and YEAR(a.insert_date)=$year_id";
		}
		elseif($db_type==2)
		{ 
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(a.insert_date,'YYYY')=$year_id";
		}
		
		if ($cbo_company==0) $company_id=""; else $company_id=" and a.company_id=$cbo_company";
		if ($wo_no=="") $wo_no_cond=""; else $wo_no_cond=" and a.labtest_no like '%$wo_no'";
		if ($job_no=="") $job_num=""; else $job_num=" and b.job_no='$job_no'";
		if ($hidd_po=='') $po_no_no=""; else $po_no_no=" and c.order_id in ($hidd_po)";
		
		
		if ($cbo_buyer==0) $supplier_cond=""; else $supplier_cond=" and a.supplier_id=$cbo_buyer";
		if ($cbo_category==0) $category_id=""; else $category_id=" and a.item_category=$cbo_category";
		if ($wo_type==2) $wo_type_cond=" and a.entry_form=41"; else if ($wo_type==4) $wo_type_cond=" and a.entry_form=42"; else $wo_type_cond="";
		
		//if ($job_no=="") $job_num_mst=""; else $job_num_mst=" and b.job_no_mst=$job_no";
		if ($hidd_po=="") $po_id=""; else $po_id=" and d.id in ( $hidd_po )";
		
		if ($hidd_po=="") $po_id_cond=""; else $po_id_cond=" and b.po_break_down_id in ( $hidd_po )";
		
		if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and d.file_no='".trim($file_no)."' "; 
		if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and d.grouping='".trim($internal_ref)."' "; 
		//echo $file_no_cond.'=='.$internal_ref_cond;die;
		
		if($db_type==0)
		{
			if($txt_date_category==1) 
			{	
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.wo_date between '".$date_from."' and '".$date_to."'";
			}
			else 
			{
				if($txt_date_category==2) if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".$date_from."' and '".$date_to."'";
			}
		}
		if($db_type==2)
		{
			if($txt_date_category==1) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.wo_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
			else if($txt_date_category==2) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
		}
	
	
		$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
		$supplierArr=return_library_array( "select id,supplier_name from lib_supplier", "id", "supplier_name");	
		$buyerArr=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
		
		/*$nonStyleArr=return_library_array( "select id, style_ref_no from sample_development_mst", "id", "style_ref_no");		
		
		$sql="select a.job_no,d.id as po_id from wo_po_details_master a, wo_po_break_down d where a.job_no=d.job_no_mst and a.status_active=1 and a.is_deleted=0 and d.status_active=1 and d.is_deleted=0 $internal_ref_cond  $file_no_cond  group by a.job_no,d.id";
		$sql_result=sql_select($sql);
		$po_id_data="";$k=0;
		foreach($sql_result as $row)
		{
			if($k==0)
			{
				$po_data_cond=$row[csf('po_id')];
				 $job_data_cond=$row[csf('job_no')];
			}
			else
			{
				 $po_data_cond.=",".$row[csf('po_id')];
				 $job_data_cond.=",".$row[csf('job_no')];
			} 
		} //echo $job_data_cond;
		
		
		if($file_no_cond!="" || $internal_ref!="")
		{  
		 $po_data_file_ref=" and c.po_break_down_id in($po_data_cond) "; 
		 $job_data_file_ref=" and b.job_no in('$job_data_cond') "; 
		}
		else
		{
			$po_data_file_ref="";
			$job_data_file_ref="";
		}*/
		
	
		
		
	
		//============================start==============issue-23079========12-10-2021=============================================
		// $emb_item_array=array();		
		// $emb_sql="select a.emb_name, b.item_number_id, c.job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b, wo_po_break_down c where a.job_no=b.job_no_mst and c.id=b.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
		// $emb_sql_result=sql_select($emb_sql);
		// foreach($emb_sql_result as $row)
		// {
		// 	$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
		// 	$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
		// }
		//var_dump($job_array);
		//===========================end==============issue-23079========12-10-2021==============================================






		ob_start();
		?>
		<fieldset style="width:2410px">
			<table width="2490"  cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none; font-size:18px;" colspan="21">
						<? echo $company_library[str_replace("'","",$cbo_company_id)]; ?>                                
					</td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:16px; font-weight:bold" colspan="21"> <? echo $report_title; if($cbo_category!=0) echo " For ".$item_category[$cbo_category]; ?></td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:12px; font-weight:bold"  colspan="21"> <? if( $date_from!="" && $date_to!="" ) echo "From ".change_date_format($date_from)." To ".change_date_format($date_to);?></td>
				</tr>
			</table>
            <table class="rpt_table" width="2810" cellpadding="0" cellspacing="0" border="1" rules="all">
				<thead>
					<th width="30">SL</th>    
					<th width="120">Company</th>
					<th width="60">Wo No</th>
					<th width="60">PI No</th>
					<th width="100">BTB LC No</th>
					<th width="100">Wo Year</th>
					<th width="70">Wo Date</th>
					<th width="70">Deli. Date</th>
                    <th width="70">Lead Time</th>
					<th width="100">Wo Type</th>
					<th width="100">Ready To App.</th>
				    <th width="100">Ready To Approved<br> date and time</th>
					<th width="80">App. Status</th>
                    <th width="100">Last Approval <br>Date time and Person</th>
					<th width="120">Supplier</th>
					<th width="120">Buyer</th>
					<th width="110">Job No.</th>
					<th width="60">Job Year</th>
					<th width="100">Style Ref.</th>
					<th width="100">Inter. Ref.</th>
					<th width="100">File No.</th>
					<th width="100">Order No</th>
                    <th width="100">Shipment Date</th>
					<th width="100">Item Cate.</th>
					<th width="70">First Rec. Date</th>
					<th width="100">Required Value</th>
                    <th width="100">WO value</th>
					<th width="100">WO value(USD)</th>
					<th width="100">Balance (USD)</th>
					<th width="100">Remarks</th>
				</thead>
			</table>
			<div style="max-height:350px; overflow-y:scroll; width:2830px" id="scroll_body" >
				<table cellspacing="0" cellpadding="0" border="1" class="rpt_table"  width="2810" rules="all" id="table_body" >
				<?
				if($cbo_company==0) $company_cond_id=""; else $company_cond_id=" and b.company_id=$cbo_company";
				if($cbo_category==24)
				{
					$sql="select a.id, a.ydw_no, min(b.receive_date) as receive_date from wo_yarn_dyeing_mst a,inv_receive_master b where a.ydw_no=b.booking_no and b.item_category=1  and b.receive_basis=2 and b.receive_purpose=2 $company_cond_id group by a.id, a.ydw_no";	
					$sql_result=sql_select($sql);
					foreach($sql_result as $row)
					{
						$first_rec_date[$row[csf("id")]]=$row[csf("receive_date")];
					}
				}
				
				$sql="Select a.company_id,max(a.currency) as currency, a.id as booking_id, a.entry_form,a.pay_mode, TO_CHAR(a.insert_date,'YYYY') as year_book, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id, a.ready_to_approved, b.job_no, sum(b.wo_value) as wo_value,b.po_id,c.order_qty,a.currency,a.ecchange_rate from wo_labtest_mst a, wo_labtest_dtls b,wo_labtest_order_dtls c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $job_num $booking_date_cond $wo_no_cond $wo_type_cond $po_no_no group by a.id,a.company_id, a.entry_form,a.pay_mode, a.insert_date, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id,a.ready_to_approved,  b.job_no,b.po_id,c.order_qty,a.currency,a.ecchange_rate order by  b.job_no ASC";
				$sql_result=sql_select($sql); $i=1;
				$job_no=array();
				foreach ($sql_result as $row) 
				{
					$booking_id_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
					$po_arr[$row[csf("po_id")]]=$row[csf("po_id")];
					$job_no[$row[csf("job_no")]]=$row[csf("job_no")];
					$job_wise_data[$row[csf("job_no")]][]=$row;
				}
				$wopi_arr=array(); $tem_pi=array();
				if($cbo_company>0) $piCond="and a.importer_id=$cbo_company"; else $piCond="";
				$sql_wo_pi=sql_select("select a.id,a.pi_number, b.work_order_id, b.work_order_dtls_id from com_pi_master_details a, com_pi_item_details b where a.id=b.pi_id and a.item_category_id in(31) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.work_order_dtls_id>0 $piCond");
				foreach($sql_wo_pi as $rowPi)
				{
					$wopi_arr[$rowPi[csf('work_order_id')]].=$rowPi[csf("pi_number")]."__";
					$pi_number_arr[] = "'".$rowPi[csf('id')]."'";
					$piArr[$rowPi[csf("id")]]=$rowPi[csf("id")];
				}

				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3,4) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 1, $po_arr, $empty_arr);//PO ID Ref from=1
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 2, $booking_id_arr, $empty_arr);//Book ID Ref from=2
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 4, $piArr, $empty_arr);//PI ID Ref from=4

				
				$job_sql="select a.job_no_prefix_num, a.job_no, a.buyer_name, TO_CHAR(a.insert_date,'YYYY') as year, a.style_ref_no, a.garments_nature,b.id as id, b.po_number as po_number, b.file_no as file_no, b.grouping as grouping, (b.pub_shipment_date) as max_ship_date, (b.pub_shipment_date) as min_ship_date from wo_po_details_master a, wo_po_break_down b,gbl_temp_engine g where a.id=b.job_id and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";

				$job_sql_result=sql_select($job_sql);
				
				foreach($job_sql_result as $row)
				{
					$order_no=$row[csf("po_number")];//implode(",",array_unique(explode(",",$row[csf("po_number")])));
					$order_id=$row[csf("id")];//implode(",",array_unique(explode(",",$row[csf("id")])));
					$file_no=$row[csf("file_no")];//implode(",",array_unique(explode(",",$row[csf("file_no")])));
					$int_ref=$row[csf("grouping")];//implode(",",array_unique(explode(",",$row[csf("grouping")])));
			
					$job_array[$row[csf("job_no")]]['job']=$row[csf("job_no_prefix_num")];
					$job_array[$row[csf("job_no")]]['job_no']=$row[csf("job_no")];
					$job_array[$row[csf("job_no")]]['buyer']=$row[csf("buyer_name")];
					$job_array[$row[csf("job_no")]]['year']=$row[csf("year")];
					$job_array[$row[csf("job_no")]]['style_ref_no']=$row[csf("style_ref_no")];
					$job_array[$row[csf("job_no")]]['garments_nature']=$row[csf("garments_nature")];
					$job_array[$row[csf("job_no")]]['max_ship_date'].=$row[csf("max_ship_date")].',';
					$job_array[$row[csf("job_no")]]['min_ship_date'].=$row[csf("min_ship_date")].',';
					$job_array[$row[csf("job_no")]]['id'].=$order_id.',';
					$job_array[$row[csf("job_no")]]['po_number'].=$order_no.',';
					$job_array[$row[csf("job_no")]]['file'].=$file_no.',';
					$job_array[$row[csf("job_no")]]['ref'].=$int_ref.',';
				}
				

			    //   echo "<pre>";
				//   print_r($job_wise_data);
				//===================================================================================================
				$emb_item_array=array();		
				$emb_sql="select a.emb_name, b.item_number_id, c.job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b, wo_po_break_down c,gbl_temp_engine g  where a.job_id=b.job_id and c.id=b.po_break_down_id and c.id=g.ref_val and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
				$emb_sql_result=sql_select($emb_sql);
				foreach($emb_sql_result as $row)
				{
					$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
					$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];


				}


				//===================================================================================================

				$lab_test_sql="select b.id,b.job_no,b.costing_per_id,b.lab_test,b.lab_test_percent,b.inspection,b.inspection_percent,b.cm_cost,b.cm_cost_percent from wo_pre_cost_dtls b,wo_po_break_down c,gbl_temp_engine g where  b.job_id=c.job_id and c.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and b.status_active=1 and b.is_deleted=0 ";

				//echo $lab_test_sql;
				$lab_test_data=sql_select($lab_test_sql);
				foreach($lab_test_data as $row){

						$lab_test[$row[csf("job_no")]]['lab_test']=$row[csf("lab_test")];
				}

				//=============================================job_qty======================================================

				$job_qty_sql="select a.id,a.job_no,a.job_quantity from wo_po_details_master a,wo_po_break_down c,gbl_temp_engine g where a.id=b.job_id  and c.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and  a.status_active=1 and a.is_deleted=0 ";

				$job_qty_data=sql_select($job_qty_sql);
				foreach($job_qty_data as $row){

						$job_qty_arr[$row[csf("job_no")]]['job_qty']=$row[csf("job_quantity")];
				}

				$wo_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_labtest_mst a, approval_history b,gbl_temp_engine g where a.id=b.mst_id and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(42) order by b.id desc";
				$wo_his_sql_result=sql_select($wo_his_sql);
				//$pi_no_arr = array();
				$user_arr=return_library_array( "select id, user_name from user_passwd", 'id', 'user_name' );	
				foreach ($wo_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_his_sql_result);
				$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_id from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id and b.work_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0
				and a.item_category_id=31 and a.pi_basis_id=1";
				//echo $pi_sql;die;
				$pi_sql_result=sql_select($pi_sql);
				$pi_no_arr = array();
				foreach ($pi_sql_result as $value) 
				{
					$pi_no_arr[$value[csf("work_order_id")]]['pi_no']=$value[csf("pi_number")];
					$pi_no_arr[$value[csf("work_order_id")]]['pi_id']=$value[csf("pi_id")];
				}
				unset($pi_sql_result);
					$pi_number_string = implode(',',array_unique($pi_number_arr));
					//============== For BTB Lc Data ==================
					if($pi_number_string!="")
					{
						if($cbo_company>0) $comCond="and a.importer_id=$cbo_company"; else $comCond="";
						$btb_sql = "SELECT a.id, a.lc_number,a.lc_type_id,a.payterm_id,a.tenor, c.pi_number FROM com_btb_lc_master_details a, com_btb_lc_pi b, com_pi_master_details c,gbl_temp_engine g WHERE a.id=b.com_btb_lc_master_details_id and b.pi_id=c.id and c.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=4 and g.entry_form=37 and a.is_deleted = 0 and a.item_basis_id=1 $comCond
						UNION ALL
						SELECT a.id, a.lc_number,a.lc_type_id,a.payterm_id,a.tenor,c.pi_number FROM com_btb_lc_master_details a, com_btb_lc_pi b, com_pi_master_details c,gbl_temp_engine g WHERE a.id=b.com_btb_lc_master_details_id and b.pi_id=c.id and c.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=4 and g.entry_form=37 and a.is_deleted = 0 and a.item_basis_id=2 $comCond";
						 //echo $btb_sql; die;
						$sql_result=sql_select($btb_sql);
						$btb_pi=array();
						foreach($sql_result as $rows)
						{					
							$btb_pi[$rows[csf('pi_number')]]['lc_number']=$rows[csf('lc_number')];
							$btb_pi[$rows[csf('pi_number')]]['lc_type_id']=$rows[csf('lc_type_id')];
							$btb_pi[$rows[csf('pi_number')]]['payterm_id']=$rows[csf('payterm_id')];
							$btb_pi[$rows[csf('pi_number')]]['tenor']=$rows[csf('tenor')];
						}
						//var_dump($btb_pi);
					}
				// $job_wise_data
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3,4) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				foreach($job_wise_data as $job_id => $job_data)
				{
					foreach($job_data as $row){
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					if ($row[csf("entry_form")]==41 || $row[csf("entry_form")]==79) $wo_type="Order";
					else if ($row[csf("entry_form")]==42) $wo_type="Non Order";
					$job_number=implode(",",array_unique(explode(",",$row[csf("job_no")])));
					$cbo_company=$row[csf("company_id")]; 
					$variable="<a href='##' title='PB' onClick=\"generate_fabric_report('','".$row[csf("booking_id")]."','".$cbo_company."','".$row[csf("currency")]."','".$cbo_category."','".change_date_format($row[csf("wo_date")])."','','','".$cbo_category."','','','','show_trim_booking_report','')\">".$row[csf("labtest_prefix_num")]." </a>";	     					
					$supplier_name="";
					if($row[csf("pay_mode")]==3 || $row[csf("pay_mode")]==5)
					{
						$supplier_name=$company_library[$row[csf("supplier_id")]];
					}
					else $supplier_name=$supplierArr[$row[csf("supplier_id")]];
					if($row[csf('ready_to_approved')]==1) //ready
					{
						$last_update_date=$row[csf('update_date')];
					}
					$usd_id=2;
					if($db_type==0) $conversion_date=change_date_format($row[csf("wo_date")], "Y-m-d", "-",1);
					else $conversion_date=change_date_format($row[csf("wo_date")], "d-M-y", "-",1);
					$currency_rate=set_conversion_rate($usd_id,$conversion_date );
					if($row[csf("currency")]==2) $wo_currency_usd_amt=$row[csf("wo_value")];//USD
					else $wo_currency_usd_amt=$row[csf("wo_value")]/$currency_rate;
					$req_value=($job_qty_arr[$row[csf("job_no")]]['job_qty']/12)*$lab_test[$row[csf("job_no")]]['lab_test'];
					//$piWoNo="";
					//$piWoNo=implode(",",array_unique(array_filter(explode("__",$wopi_arr[$row["booking_id"]]))));
					// $wo_currency_usd_amt=$row[csf("wo_value")]/$row[csf("ecchange_rate")];
					?>
					<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
						<td width="30"><? echo $i;?></td>
						<td width="120" align="center"><p><? echo $company_library[$row[csf("company_id")]]; ?></td>
						<td width="60" align="center"><? echo $variable; ?></td>
						<td width="60" align="center"><p><? echo $pi_no_arr[$row[csf("booking_id")]]['pi_no']; ?></td>
						<td width="100" style="word-break:break-all" align="center"><? echo $btb_pi[$pi_no_arr[$row[csf("booking_id")]]['pi_no']]['lc_number'] ?>&nbsp; </td>
						<td width="100" align="center"><? echo $row[csf("year_book")]; ?></td>					
						<td width="70" style="word-wrap:break-word;"><? echo change_date_format($row[csf("wo_date")], "", "",0); ?></td>
						<td width="70" style="word-wrap:break-word;"><? echo change_date_format($row[csf("delivery_date")]); ?></td>
                        <td width="70" style="word-wrap:break-word;">
						<? 
						$lead_time=0;
						if($row[csf("delivery_date")]!="" && $row[csf("delivery_date")]!="0000-00-00")
						{
							$lead_time=datediff("d", $row[csf("wo_date")], $row[csf("delivery_date")]);
						}
						if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day"; 
						?></td>
						<td width="100"><?=$wo_type; ?></td>
						<td width="100" align="center"><? echo $yes_no[$row[csf("ready_to_approved")]]; ?></td>
                        <td width="100" align="center"><? $last_update_dateArr=explode(" ",$last_update_date);echo change_date_format($last_update_dateArr[0]).'<br>'.$last_update_dateArr[1]; ?></td>
						<td width="80"><p><? echo $approval_type_arr[$row[csf("is_approved")]]; ?></p></td>
                        <?
                       	 $approved_date=$last_app_arr[$row[("booking_id")]]['approved_date'];
						 $approved_by=$last_app_arr[$row[("booking_id")]]['approved_by'];
						?>
                        <td width="100" title="bookingId=<? echo $row[("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>

						<td width="120" style="word-wrap:break-word;"><? echo $supplier_name; ?></td>
						<td width="120"><p><? echo $buyerArr[$job_array[$job_number]['buyer']]; ?></p></td>
						<td width="110" style="word-wrap:break-word;"><? echo $row[csf("job_no")];?></td>
						<td width="60"><? echo $job_array[$job_number]['year']; ?></td>
						<?
						$ref_all=rtrim($job_array[$job_number]['ref'],',');
						$ref_all=implode(", ",array_unique(explode(",",$ref_all)));
						$file_all=rtrim($job_array[$job_number]['file'],',');
						$file_all=implode(", ",array_unique(explode(",",$file_all)));
						$po_alls=rtrim($job_array[$job_number]['po_number'],',');
						$po_all=implode(", ",array_unique(explode(",",$po_alls)));
						?>
						<td width="100" style="word-wrap:break-word;"><? echo $job_array[$job_number]['style_ref_no']; ?></td>
						<td width="100" style="word-wrap:break-word;"><? echo $ref_all; ?></td>
						<td width="100" style="word-wrap:break-word;"><? echo $file_all; ?></td>
						<td width="100" style="word-wrap:break-word;"><? echo $po_all; ?></td>
						<td width="100" style="word-wrap:break-word;">
						<? 
						$max_shipdate=rtrim($job_array[$job_number]['max_ship_date'],',');
						$max_ship_dateArr=explode(",",$max_shipdate);
						$max_ship_date=max($max_ship_dateArr);
						$min_shipdate=rtrim($job_array[$job_number]['min_ship_date'],',');
						$min_shipdateArr=explode(",",$min_shipdate);
						$min_shipdate=min($min_shipdateArr);
						if($max_ship_date!="" && $max_ship_date!="0000-00-00") echo "Max - ".change_date_format($max_ship_date);
						//if($job_array[$job_number]['max_ship_date']!=$job_array[$job_number]['min_ship_date']) echo "<br> " . change_date_format($job_array[$job_number]['min_ship_date']); 
						$order_count=explode(",",$po_all);
						if(count($order_count)>1) echo "<br> Min - " . change_date_format($min_shipdate);
						?></td>
						<td width="100" style="word-wrap:break-word;"><? echo $item_category[31]; ?></td>
						<td width="70" align="center"><p><? echo change_date_format($first_rec_date[$row[csf("booking_id")]]); ?></p></td>
						<? if(isset($balanced_usd_arr[$row[csf("job_no")]]) && $balanced_usd_arr[$row[csf("job_no")]]>0){
								$blance_usd=$balanced_usd_arr[$row[csf("job_no")]];
							}
							else{
								$blance_usd=($job_qty_arr[$row[csf("job_no")]]['job_qty']/12)*$lab_test[$row[csf("job_no")]]['lab_test'];
								} 
							?>
						<td width="100" align="right" title="<?="(".$job_qty_arr[$row[csf("job_no")]]['job_qty']."/12)*".$lab_test[$row[csf("job_no")]]['lab_test'];?>"><? echo number_format($blance_usd,2); ?></td>
						<td width="100" align="right"><? echo number_format($row[csf("wo_value")],2); ?></td>
						<td width="100" align="right" title="<?=$row[csf("wo_value")]."/".$currency_rate;?>"><? echo number_format($wo_currency_usd_amt,2); ?></td>
						<? 
						$balanced_usd_arr[$row[csf("job_no")]] = $blance_usd-$wo_currency_usd_amt;
						?>
						<td width="100" align="right" title="<?=$req_value."-".$wo_currency_usd_amt;?>"><? echo number_format($blance_usd-$wo_currency_usd_amt,2); ?></td>
						<td width="100">&nbsp;</td>
					</tr>
					<?
					$tot_req_qnty+=($job_qty_arr[$row[csf("job_no")]]['job_qty']/12)*$lab_test[$row[csf("job_no")]]['lab_test'];
					$tot_wo_qnty+=$row[csf("wo_value")];
					//$tot_bal_qnty+=$req_value-$wo_currency_usd_amt;
					$tot_bal_qnty=$balanced_usd_arr[$row[csf("job_no")]];
					$tot_wo_currency_usd_amt+=$wo_currency_usd_amt;
					$job_tot_req_qnty+=($job_qty_arr[$row[csf("job_no")]]['job_qty']/12)*$lab_test[$row[csf("job_no")]]['lab_test'];
					$job_tot_wo_qnty+=$row[csf("wo_value")];
					//$tot_bal_qnty+=$req_value-$wo_currency_usd_amt;
					$job_tot_bal_qnty=$balanced_usd_arr[$row[csf("job_no")]];
					$job_tot_wo_currency_usd_amt+=$wo_currency_usd_amt;
					$tot_balance_usd+=$blance_usd-$wo_currency_usd_amt;
					$job_tot_balance_usd+=$blance_usd-$wo_currency_usd_amt;
					$i++;
				}?>
				
					<tr style="background-color:LightGray">
						<td width="30">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="60">&nbsp;</td>
						<td width="60">&nbsp;</td>
						<td width="60">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="70">&nbsp;</td>
                        <td width="70">&nbsp;</td>
						<td width="70">&nbsp;</td>
						<td width="100">&nbsp;</td>
                        <td width="100">&nbsp;</td>
						<td width="100">&nbsp;</td>
                        <td width="80">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="110">&nbsp;</td>
						<td width="60">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="100">&nbsp;</td>
                        <td width="100">&nbsp;</td>
						<td width="100"><b>Total</b></td>
						<td width="80">&nbsp;</td>
						<td width="70">&nbsp;</td>
                        <td width="100" align="right" ><b><? //echo number_format($tot_req_qnty,2); ?></b></td>
						<td width="100" align="right" ><b><? echo number_format($job_tot_wo_qnty,2); ?></b></td>
						<td width="100" align="right"  ><b><? echo number_format($job_tot_wo_currency_usd_amt,2); ?></b></td>
						<td width="100" align="right" ><b><? echo number_format($job_tot_balance_usd,2); ?></b></td>
						<td>&nbsp;</td>
		        	</tr>
					<?
					$job_tot_req_qnty=0;$job_tot_wo_qnty=0;$job_tot_bal_qnty=0;$job_tot_wo_currency_usd_amt=0;$job_tot_balance_usd=0;
			}

				?>
				</table>
				<table class="rpt_table" width="2810" cellpadding="0" cellspacing="0" border="1" rules="all">
					<tfoot>
						<th width="30">&nbsp;</th>
						<th width="120">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="70">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="100">&nbsp;</th>										
                        <th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="120">&nbsp;</th>		
						<th width="120">&nbsp;</th>
						<th width="110">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="100">Total</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="100" align="right" id="value_tot_req_qnty"><? //echo number_format($tot_req_qnty,2); ?></th>
						<th width="100" align="right" id="value_tot_fin_fab_qnty"><? echo number_format($tot_wo_qnty,2); ?></th>
						<th width="100" align="right"  id="usd_tot_fin_fab_qnty"><? echo number_format($tot_wo_currency_usd_amt,2); ?></th>
						<th width="100" align="right"  id="usd_tot_bal_qnty"><? echo number_format($tot_balance_usd,2); ?></th>
						<th width="100">&nbsp;</th>
					</tfoot>
				</table>
			</div>
		</fieldset>
		<?
	}

	$html = ob_get_contents();
    ob_clean();
    //$new_link=create_delete_report_file( $html, 2, $delete, "../../../" );
    foreach (glob("*.xls") as $filename) {
    //if( @filemtime($filename) < (time()-$seconds_old) )
    @unlink($filename);
    }
    //---------end------------//
    $name=time();
    $filename=$user_id."_".$name.".xls";
    $create_new_doc = fopen($filename, 'w');	
    $is_created = fwrite($create_new_doc, $html);
    echo "$html**$filename"; 
	exit();
}

if ($action=="report_generate5")
{
	
	$process = array( &$_POST );
	//print_r($process);
	extract(check_magic_quote_gpc( $process ));
	$cbo_company=str_replace("'","",$cbo_company_id);
	$cbo_buyer=str_replace("'","",$cbo_buyer_id);
	$cbo_category=str_replace("'","",$cbo_category_id);
	$wo_type=str_replace("'","",$cbo_wo_type);
	$year_id=str_replace("'","",$cbo_year_id);
	$job_year_id=str_replace("'","",$cbo_job_year_id);
	$wo_no=str_replace("'","",$txt_wo_no);
	$wo_no_prefix=str_replace("'","",$txt_wo_no);
	$wo_id=str_replace("'","",$hidd_wo_id);
	$cbo_season_id=str_replace("'","",$cbo_season_id);
	
	$job_no=str_replace("'","",$txt_job_no);
	$job_no_prefix=str_replace("'","",$txt_job_no);
	$hidd_job=str_replace("'","",$hidd_job_id);
	$po_no=str_replace("'","",$txt_po_no);
	
	$hidd_po=str_replace("'","",$hidd_po_id);
	$date_from=str_replace("'","",$txt_date_from);
	$date_to=str_replace("'","",$txt_date_to);
	$file_no=str_replace("'","",$txt_file_no);
	$internal_ref=str_replace("'","",$txt_internal_ref);
	$txt_date_category=str_replace("'","",$txt_date_category);
	$cbo_order_status=str_replace("'","",$cbo_order_status);
	
	if($cbo_category==2 || $cbo_category==3 || $cbo_category==4 || $cbo_category==12 || $cbo_category==25)
	{	
		if($db_type==0)
		{
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and YEAR(a.insert_date)=$year_id";
			if ($year_id==0) $year_id_cond_sam=""; else $year_id_cond_sam=" and YEAR(s.insert_date)=$year_id";
		}
		elseif($db_type==2)
		{ 
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(a.insert_date,'YYYY')=$year_id";
			if ($year_id==0) $year_id_cond_sam=""; else $year_id_cond_sam=" and TO_CHAR(s.insert_date,'YYYY')=$year_id";
		}
		if($db_type==0)
		{
			if ($job_year_id==0) $job_year_id_cond=""; else $job_year_id_cond=" and YEAR(c.insert_date)=$job_year_id";
			if ($job_year_id==0) $job_year_id_cond_sam=""; else $job_year_id_cond_sam=" and YEAR(s.insert_date)=$job_year_id";
		}
		elseif($db_type==2)
		{ 
			if ($job_year_id==0) $job_year_id_cond=""; else $job_year_id_cond=" and TO_CHAR(c.insert_date,'YYYY')=$job_year_id";
			if ($job_year_id==0) $job_year_id_cond_sam=""; else $job_year_id_cond_sam=" and TO_CHAR(s.insert_date,'YYYY')=$job_year_id";
		}
		
		if ($cbo_company==0) $company_id=""; else $company_id=" and a.company_id in ($cbo_company)";
		if ($cbo_company==0) $company_id_sam=""; else $company_id_sam=" and s.company_id in ($cbo_company)";
		if ($cbo_buyer==0) $buyer_id=""; else $buyer_id=" and a.buyer_id=$cbo_buyer";
		if ($cbo_buyer==0) $buyer_id_sam=""; else $buyer_id_sam=" and s.buyer_id=$cbo_buyer";
		if ($cbo_category==0) $category_id=""; else $category_id=" and a.item_category=$cbo_category";
		if ($cbo_category==0) $category_id_sam=""; else $category_id_sam=" and s.item_category=$cbo_category";
		if ($wo_no_prefix=="") $wo_no_prefix_cond=""; else $wo_no_prefix_cond=" and a.booking_no_prefix_num like '%$wo_no_prefix'";
		if ($wo_no_prefix=="") $wo_no_prefix_cond_sam=""; else $wo_no_prefix_cond_sam=" and s.booking_no_prefix_num like '%$wo_no_prefix'";
		if ($wo_no=="") $wo_no_cond=""; else $wo_no_cond=" and a.booking_no like '%$wo_no'";
		if ($wo_no=="") $wo_no_cond_sam=""; else $wo_no_cond_sam=" and s.booking_no like '%$wo_no'";
		if ($wo_type==1 || $wo_type==2)  $wo_type_cond=" and a.booking_type in (1,2,3) and a.is_short='$wo_type'"; else $wo_type_cond="";
		if ($wo_type==3) $wo_type_cond_sam="  and a.booking_type=4"; else $wo_type_cond_sam="";
		
		if ($job_no=="") $job_num=""; else $job_num=" and b.job_no like '%$job_no'";
		if ($job_no_prefix=="") $job_no_prefix_con=""; else $job_no_prefix_con=" and c.job_no_prefix_num like '%$job_no_prefix'";
		if ($po_no=='') $po_no_no=""; else $po_no_no=" and d.po_number like '%$po_no'";

		
		//if ($po_no=='') $po_no_no=""; else $po_no_no=" and d.po_number in ('$po_no')";
		//if ($hidd_po=="") $po_id=""; else $po_id=" and d.id in ( $hidd_po )";
		
		//if ($hidd_po=="") $po_id_cond=""; else $po_id_cond=" and b.po_break_down_id in ( $hidd_po )";
		
		if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and d.file_no='".trim($file_no)."' "; 
		if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and d.grouping='".trim($internal_ref)."' "; 
		//echo $file_no_cond.'=='.$internal_ref_cond;die;
		if ($cbo_season_id==0) $season_cond=""; else $season_cond=" and c.season_buyer_wise in(".$cbo_season_id.") "; 
		
		if($db_type==0)
		{
			if($txt_date_category==1){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".$date_from."' and '".$date_to."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.booking_date between '".$date_from."' and '".$date_to."'";
			}
			else if($txt_date_category==2){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".$date_from."' and '".$date_to."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.delivery_date between '".$date_from."' and '".$date_to."'";
			}
		}
		if($db_type==2)
		{
			if($txt_date_category==1){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.booking_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
			else if($txt_date_category==2){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
		}
	
		$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
		$supplierArr=return_library_array( "select id,supplier_name from lib_supplier", "id", "supplier_name");	
		$buyerArr=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
		$level_arr             = array(1=>"PO Level",2=>"Job Level");
		
		if ($cbo_category==4) 
		{
			$colspan=29;
			$tbl_width=3190;
		}
		else if ($cbo_category==12)
		{
			$colspan=27;
			$tbl_width=2620;
		}
		else if ($cbo_category==2)
		{
			$colspan=27;
			$tbl_width=2780;
		}
		else if ($cbo_category==25)
		{
			$colspan=28;
			$tbl_width=2820;
		}
		else
		{
			$colspan=26;
			$tbl_width=2620;
		}
		
		$emb_item_array=array();
		//================================================issue 19461====16-09-2021===============================
			// $emb_sql="select a.emb_name, b.item_number_id, c.job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b, wo_po_break_down c where a.job_no=b.job_no_mst and c.id=b.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
			// $emb_sql_result=sql_select($emb_sql);
			// foreach($emb_sql_result as $row)
			// {
			// 	$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
			// 	$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
			// }
			// unset($emb_sql_result);
			//var_dump($job_array);

		
		//================================================issue 19461====16-09-2021===============================
		if($cbo_company!=0) $cbo_company_cond="and template_name in ($cbo_company)";else $cbo_company_cond="";
		if($cbo_category==2 || $cbo_category==3)
		{
			$print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=1 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
		
			$print_short_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=2 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$partial_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=35 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$woven_partial_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=138 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$sample_req_non_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=90 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$sample_req_booking_withorder_print_report_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=48 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");		
			$sample_booking_non_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=4 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$sample_booking_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=3 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
		}
		else if($cbo_category==4)
		{
			 
			$print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(5,6) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$trim_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(5) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$trim_print_report_format_arr2=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(6) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$trim_print_report_format_arr3=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(219) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$print_report_format_arr26=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=26 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			
		}
		else if($cbo_category==12) // Service Fab. Booking.
		{
			$print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=11 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$print_report_format_aop=return_field_value("format_id"," lib_report_template"," module_id=2 and report_id=49 and is_deleted=0 and status_active=1 $cbo_company_cond");
			$multi_knit_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=65 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
		}
		//print_r($print_report_format_arr);
		$tot_fin_fab_qnty=0;
		//echo $first_print_button.'gg';
		ob_start();
		?>
		<fieldset>
			<table width="<? echo $tbl_width; ?>"  cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none; font-size:18px;" colspan="<? echo $colspan; ?>">
					<? echo $company_library[str_replace("'","",$cbo_company_id)]; ?>                                
					</td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:16px; font-weight:bold"  colspan="<? echo $colspan; ?>"> <? echo $report_title; if($cbo_category!=0) echo " For ".$item_category[$cbo_category]; ?></td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:12px; font-weight:bold"  colspan="<? echo $colspan; ?>"> <? if( $date_from!="" && $date_to!="" ) echo "From ".change_date_format($date_from)." To ".change_date_format($date_to);?></td>
				</tr>
			</table>
			<table width="<? echo $tbl_width; ?>" cellspacing="0" border="1" class="rpt_table" rules="all">
				<thead>
					<th width="30">SL</th>    
					<th width="100">Company</th>
					<th width="70">Wo No</th>
					<?
					if ( $cbo_category==25)
					{
						?>
                    <th width="100">Embl. Name</th>
                        <?
					}?>
                    <th width="70">Pay Mode</th>
                    <?
					if ($cbo_category==3 || $cbo_category==2 || $cbo_category==25 || $cbo_category==4)
					{
						?>
                        <th width="100">PI No</th>
                        <?
					}

					if ($cbo_category==4)
					{
						?>
                        <th width="100">BTB LC</th>
                        <th width="100">LC Type</th>
                        <th width="100">Pay Term</th>
                        <th width="100">Tenor</th>
                        <?
					}

					if ($cbo_category==12)
					{
						?>
						<th width="100">PI No</th>
                        <th width="100">Process</th>
                        <?
					}
					
					?>
					<th width="60">Wo Year</th>
					<th width="70">Wo Date</th>
					<th width="70">Wo Last Update</th>
					<th width="70">Delivery Date</th>
                    <th width="70">Lead Time</th>
					<th width="100">Wo Type</th>
					<th width="100">Ready To Approved</th>
                    <th width="100">Ready To Approved<br>date and time</th>
					<th width="80">Approval Status</th>
                    <th width="100">Last Approval <br>Date time and Person</th>
					<th width="100">Supplier</th>
					<th width="100">Buyer</th>
					<th width="70">Job No.</th>
                    <th width="70">Season</th>
					<th width="60">Job Year</th>
					<th width="100">Style Ref.</th>
					<th width="100">Internal Ref.</th>
					<th width="100">File No.</th>
					<th width="100">Order No</th>
					<th width="80">Item Category</th>
					<th width="70">First Receive Date</th>
					<?
						if ($cbo_category==4)
						{
							?>
								<th width="100">Wo Value</th>
                                <th width="100">Wo value(USD)</th>
                                <th width="100">Receive Value</th>
                                <th width="100">Receive Value(USD)</th>
							<?
						}
						else
						{
							
							if ($cbo_category==25) 
							{ 
							  $head_type="Wo Qty";
							  $head_type2="[USD]";
							}
							else { 
							 $head_type="Wo Qty (Fin.)";
							 $head_type2="";
							}
							?>
								<th width="100"><? echo $head_type;?></th>
								<?
								if ($cbo_category==25)
								{
									?>
			                        <th width="100">WO UOM</th>
			                        <?
								}
								if ($cbo_category==3 || $cbo_category==25)
								{
									?>
			                        <th width="100">WO Value<? echo $head_type2;?></th>
			                        <?
								}
								else
								{
									?>
									<th width="100">Wo Qty (Grey)</th>
									<?
								}
								?>
								
							<?
						}
					if($cbo_category==2)//Knit Fab.
					{
						?>
						<th width="80">Sample QTY</th>
						<th width="80">Responsible Dept</th>
						<th width="80">Reason</th>
						<?
					}
					?>
					<th width="80">Level</th>
					<th>Remarks</th>
				</thead>
			</table>
			<div style="max-height:350px; overflow-y:scroll; width:<? echo $tbl_width+20; ?>px" id="scroll_body" >
				<table cellspacing="0" cellpadding="0" border="1" class="rpt_table"  width="<? echo $tbl_width; ?>" rules="all" id="table_body" >
				<?
				
				
				
				$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
				$fabric_source_cond="";$fabric_source_cond_nonOrder="";
				if($cbo_category==2 || $cbo_category==4)
				{ 
					if($cbo_fabric_source>0) 
					{
						$fabric_source_cond=" and a.fabric_source=$cbo_fabric_source"; 
					
						if($cbo_fabric_source==1 || $cbo_fabric_source==4){
							$fabric_source_cond_nonOrder=" and t.fabric_source=$cbo_fabric_source"; 
							$select_field="t.fabric_source";
						}
						else
						{
							$fabric_source_cond_nonOrder=" and s.fabric_source=$cbo_fabric_source"; 
							$select_field="s.fabric_source";
						}
					}
					else $select_field="s.fabric_source";
				}
				//echo $select_field.'DDD';die;
				//var_dump($receive_qnty_data_prod);die;
				
				if($db_type==0)
				{
					$year_book=" year(a.insert_date) as year_book";
					$year_book_non=" year(s.insert_date) as year_book";
					$select_job_year=" year(c.insert_date) as job_year"; 
				}
				else
				{
					$year_book=" TO_CHAR(a.insert_date,'YYYY') as year_book";
					$year_book_non=" TO_CHAR(s.insert_date,'YYYY') as year_book";
					$select_job_year=" TO_CHAR(c.insert_date,'YYYY') as job_year";
				}

				/*$wo_last_date_sql=sql_select("select id,update_date from wo_booking_mst where is_deleted=0 and  status_active=1");
				foreach($wo_last_date_sql as $val)
				{
					$wo_last_date_arr[$val[csf("id")]]=$val[csf("update_date")];
				}*/
 				//wo_non_ord_samp_booking_dtls
				/* if($wo_type==0)
				{
					if($job_no!='' || $hidd_po!='' || $file_no!='' || $internal_ref!='')
					{

						 $sql="Select a.entry_form,a.update_date, a.company_id, a.id as booking_id, a.pay_mode, a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date, a.delivery_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount,b.responsible_dept,b.reason, b.uom as uom,c.season_buyer_wise, c.job_no_prefix_num, c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date, 0 as type ,b.bh_qty,b.rf_qty

						from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d  
						where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $booking_date_cond $wo_no_cond $fabric_source_cond  $job_num $po_id $internal_ref_cond  $file_no_cond $season_cond $year_id_cond $job_year_id_cond";//die;
					}
					else
					{
						  $sql="(Select a.entry_form,a.update_date,a.company_id,a.id as booking_id, a.pay_mode,a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date as booking_date,a.delivery_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount, b.responsible_dept,b.reason,b.uom as uom,c.season_buyer_wise, c.job_no_prefix_num, c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date, 0 as type ,b.bh_qty,b.rf_qty 
						from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d
						where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $job_num $po_id $booking_date_cond $wo_no_cond $fabric_source_cond  $job_num $po_id $internal_ref_cond  $file_no_cond $year_id_cond $job_year_id_cond $season_cond) 
						 union all
						 (SELECT s.entry_form_id as entry_form,s.update_date, s.company_id, s.id as booking_id, s.pay_mode, s.booking_type, s.is_short, s.booking_no, $year_book_non, s.booking_no_prefix_num, s.fabric_source, s.booking_date as booking_date, s.delivery_date,null as  delivery_date_dtls, s.is_approved, s.ready_to_approved, s.supplier_id, s.buyer_id, s.item_category, s.currency_id, s.exchange_rate, null as process, t.finish_fabric as fin_fab_qnty, t.grey_fabric as grey_fab_qnty, t.trim_qty as wo_qnty, t.amount as amount, null as responsible_dept, null as reason, t.uom as uom,null as season_buyer_wise, null as job_no_prefix_num, null as job_no, null as job_year, null as style_ref_no, null as garments_nature, 0 as po_break_down_id, null as po_number, null as file_no, null as grouping, null as pub_shipment_date, 1 as type ,t.bh_qty,t.rf_qty,t.style_id
						 FROM wo_non_ord_samp_booking_mst s, wo_non_ord_samp_booking_dtls t 
						 WHERE s.booking_no=t.booking_no and s.status_active =1 and s.is_deleted=0 and t.status_active =1 and t.is_deleted=0 $company_id_sam $buyer_id_sam ".set_user_lavel_filtering(' and s.buyer_id','buyer_id')." $category_id_sam $booking_date_cond_samp $wo_no_cond_sam $year_id_cond_sam $job_year_id_cond_sam $fabric_source_cond_nonOrder) order by booking_date ";//die;//LISTAGG(CAST(b.job_no AS VARCHAR(4000)), ',') WITHIN GROUP (ORDER BY b.job_no) as job_no,
					}
				}
				else
				{
					if ($wo_type==1 || $wo_type==2 || $wo_type==3)
					{
						 $sql="Select a.entry_form,a.update_date, a.company_id, a.id as booking_id, a.pay_mode, a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date,a.delivery_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.responsible_dept, b.reason, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount, b.uom as uom,c.season_buyer_wise, c.job_no_prefix_num, c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date,  0 as type,b.bh_qty,b.rf_qty,a.cbo_level
						 from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d 
						 where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status  $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $job_num $po_id $booking_date_cond $wo_no_cond $wo_type_cond $wo_type_cond_sam $file_no_cond $internal_ref_cond $fabric_source_cond $year_id_cond $job_year_id_cond $season_cond order by a.booking_no";//die;
					}
					else
					{  
						$sql="SELECT s.entry_form_id as entry_form,s.update_date,s.company_id, s.id as booking_id, s.pay_mode, s.booking_type, s.is_short, s.booking_no, $year_book_non, s.booking_no_prefix_num, $select_field , s.booking_date, s.delivery_date, s.is_approved, s.ready_to_approved, s.supplier_id, s.buyer_id, s.item_category, s.currency_id, s.exchange_rate, null as process, t.finish_fabric as fin_fab_qnty, t.grey_fabric as grey_fab_qnty, t.trim_qty as wo_qnty, t.amount as amount, t.uom as uom,null as season_buyer_wise, null as job_no_prefix_num, null as job_no, null as job_year, null as style_ref_no, null as garments_nature, 0 as po_break_down_id, null as po_number, null as file_no, null as grouping, null as pub_shipment_date, 1 as type,  t.bh_qty,t.rf_qty,t.style_id
						FROM wo_non_ord_samp_booking_mst s, wo_non_ord_samp_booking_dtls t 
						WHERE s.booking_no=t.booking_no and s.status_active =1 and s.is_deleted=0 and t.status_active =1 and t.is_deleted=0 $company_id_sam $buyer_id_sam ".set_user_lavel_filtering(' and s.buyer_id','buyer_id')." $category_id_sam $booking_date_cond_samp $wo_no_cond_sam $year_id_cond_sam $job_year_id_cond_sam $fabric_source_cond_nonOrder";//die;
					}
				} */
				if($wo_type==0)
				{
					if($job_no!='' || $hidd_po!='' || $file_no!='' || $internal_ref!='' || $po_no_no!='')
					{

						 $sql="Select a.entry_form,a.update_date, a.company_id, a.id as booking_id, a.pay_mode, a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date, a.delivery_date,a.sup_rev_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount,b.responsible_dept,b.reason, b.uom as uom,c.season_buyer_wise, c.job_no_prefix_num, c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date, 0 as type ,b.bh_qty,b.rf_qty,c.factory_marchant

						from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d  
						where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $booking_date_cond $wo_no_cond $wo_no_prefix_cond $fabric_source_cond  $job_num $po_id $internal_ref_cond  $file_no_cond $season_cond $year_id_cond $po_no_no";//die; 
					}
					else
					{
						  $sql="(Select a.entry_form,a.update_date,a.company_id,a.id as booking_id, a.pay_mode,a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date as booking_date,a.delivery_date,a.sup_rev_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount, b.responsible_dept,b.reason,b.uom as uom,c.season_buyer_wise, c.job_no_prefix_num, c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date, 0 as type ,b.bh_qty,b.rf_qty 
						from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d
						where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $job_num $po_id $booking_date_cond $wo_no_cond $wo_no_prefix_cond $fabric_source_cond $job_no_prefix_con $job_num $po_id $internal_ref_cond  $file_no_cond $year_id_cond $season_cond $po_no_no) 
						 union all
						 (SELECT s.entry_form_id as entry_form,s.update_date, s.company_id, s.id as booking_id, s.pay_mode, s.booking_type, s.is_short, s.booking_no, $year_book_non, s.booking_no_prefix_num, s.fabric_source, s.booking_date as booking_date, s.delivery_date,s.sup_rev_date,null as  delivery_date_dtls, s.is_approved, s.ready_to_approved, s.supplier_id, s.buyer_id, s.item_category, s.currency_id, s.exchange_rate, null as process, t.finish_fabric as fin_fab_qnty, t.grey_fabric as grey_fab_qnty, t.trim_qty as wo_qnty, t.amount as amount, null as responsible_dept, null as reason, t.uom as uom,null as season_buyer_wise, null as job_no_prefix_num, null as job_no, null as job_year, null as style_ref_no, null as garments_nature, 0 as po_break_down_id, null as po_number, null as file_no, null as grouping, null as pub_shipment_date, 1 as type ,t.bh_qty,t.rf_qty
						 FROM wo_non_ord_samp_booking_mst s, wo_non_ord_samp_booking_dtls t 
						 WHERE s.booking_no=t.booking_no and s.status_active =1 and s.is_deleted=0 and t.status_active =1 and t.is_deleted=0 $company_id_sam $buyer_id_sam ".set_user_lavel_filtering(' and s.buyer_id','buyer_id')." $category_id_sam $booking_date_cond_samp $wo_no_cond_sam $wo_no_prefix_cond_sam $year_id_cond_sam $fabric_source_cond_nonOrder) order by booking_date ";//die;//LISTAGG(CAST(b.job_no AS VARCHAR(4000)), ',') WITHIN GROUP (ORDER BY b.job_no) as job_no,
					}
				}
				else
				{
					if ($wo_type==1 || $wo_type==2 || $wo_type==3)
					{
						 $sql="Select a.entry_form,a.update_date, a.company_id, a.id as booking_id, a.pay_mode, a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date,a.delivery_date,a.sup_rev_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.responsible_dept, b.reason, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount, b.uom as uom,c.season_buyer_wise, c.job_no_prefix_num, c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date,  0 as type,b.bh_qty,b.rf_qty,c.factory_marchant
						 from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d 
						 where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status  $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $job_no_prefix_con $job_num $po_id $booking_date_cond $wo_no_cond $wo_no_prefix_cond $wo_type_cond $wo_type_cond_sam $file_no_cond $internal_ref_cond $fabric_source_cond $year_id_cond $season_cond $po_no_no order by a.booking_no";//die;
					}
					else
					{  
						$sql="SELECT s.entry_form_id as entry_form,s.update_date,s.company_id, s.id as booking_id, s.pay_mode, s.booking_type, s.is_short, s.booking_no, $year_book_non, s.booking_no_prefix_num, $select_field , s.booking_date, s.delivery_date,s.sup_rev_date, s.is_approved, s.ready_to_approved, s.supplier_id, s.buyer_id, s.item_category, s.currency_id, s.exchange_rate, null as process, t.finish_fabric as fin_fab_qnty, t.grey_fabric as grey_fab_qnty, t.trim_qty as wo_qnty, t.amount as amount, t.uom as uom,null as season_buyer_wise, null as job_no_prefix_num, null as job_no, null as job_year, null as style_ref_no, null as garments_nature, 0 as po_break_down_id, null as po_number, null as file_no, null as grouping, null as pub_shipment_date, 1 as type,  t.bh_qty,t.rf_qty
						FROM wo_non_ord_samp_booking_mst s, wo_non_ord_samp_booking_dtls t 
						WHERE s.booking_no=t.booking_no and s.status_active =1 and s.is_deleted=0 and t.status_active =1 and t.is_deleted=0 $company_id_sam $buyer_id_sam ".set_user_lavel_filtering(' and s.buyer_id','buyer_id')." $category_id_sam $booking_date_cond_samp $wo_no_cond_sam $wo_no_prefix_cond_sam $year_id_cond_sam  $fabric_source_cond_nonOrder";//die;
					}
				}
   //echo $sql; die;
				$job_check=$order_check=array();
				$sql_result=sql_select($sql); 
				$booking_data=array();$booking_id_arr=array();
				foreach($sql_result as $row)
				{ 
					$booking_id_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
					$po_id_arr[$row[csf("po_break_down_id")]]=$row[csf("po_break_down_id")];

					if($row[csf("type")]==1)
					{
					$req_id_arr[$row[csf("style_id")]]=$row[csf("style_id")];
					}
					
					$booking_data[$row[csf("booking_id")]]["booking_id"]=$row[csf("booking_id")];
					$booking_data[$row[csf("booking_id")]]["booking_type"]=$row[csf("booking_type")];
					$booking_data[$row[csf("booking_id")]]["update_date"]=$row[csf("update_date")];
					$booking_data[$row[csf("booking_id")]]["is_short"]=$row[csf("is_short")];
					$booking_data[$row[csf("booking_id")]]["booking_no"]=$row[csf("booking_no")];
					$booking_data[$row[csf("booking_id")]]["company_id"]=$row[csf("company_id")];
					$booking_data[$row[csf("booking_id")]]["year_book"]=$row[csf("year_book")];
					$booking_data[$row[csf("booking_id")]]["booking_no_prefix_num"]=$row[csf("booking_no_prefix_num")];
					$booking_data[$row[csf("booking_id")]]["entry_form"]=$row[csf("entry_form")];
					$booking_data[$row[csf("booking_id")]]["cbo_level"]=$cbo_level_arr[$row[csf("booking_id")]];
					
					$booking_data[$row[csf("booking_id")]]["fabric_source"]=$row[csf("fabric_source")];
					$booking_data[$row[csf("booking_id")]]["booking_date"]=$row[csf("booking_date")];
					$booking_data[$row[csf("booking_id")]]["update_date"]=$row[csf("update_date")];
					$booking_data[$row[csf("booking_id")]]["delivery_date"]=$row[csf("delivery_date")];
					$booking_data[$row[csf("booking_id")]]["is_approved"]=$row[csf("is_approved")];
					$booking_data[$row[csf("booking_id")]]["ready_to_approved"]=$row[csf("ready_to_approved")];
					$booking_data[$row[csf("booking_id")]]["supplier_id"]=$row[csf("supplier_id")];
					$booking_data[$row[csf("booking_id")]]["buyer_id"]=$row[csf("buyer_id")];
					$booking_data[$row[csf("booking_id")]]["item_category"]=$row[csf("item_category")];
					$booking_data[$row[csf("booking_id")]]["type"]=$row[csf("type")];
					$booking_data[$row[csf("booking_id")]]["pay_mode"]=$row[csf("pay_mode")];
					$booking_data[$row[csf("booking_id")]]["delivery_date_dtls"]=$row[csf("delivery_date_dtls")];
					$booking_data[$row[csf("booking_id")]]["currency_id"]=$row[csf("currency_id")];
					$booking_data[$row[csf("booking_id")]]["process"].=$row[csf("process")].",";
					
					$booking_data[$row[csf("booking_id")]]["fin_fab_qnty"]+=$row[csf("fin_fab_qnty")];
					$booking_data[$row[csf("booking_id")]]["grey_fab_qnty"]+=$row[csf("grey_fab_qnty")];
					$booking_data[$row[csf("booking_id")]]["wo_qnty"]+=$row[csf("wo_qnty")];
					$booking_data[$row[csf("booking_id")]]["amount"]+=$row[csf("amount")];
					$booking_data[$row[csf("booking_id")]]["sample_qnt"]+=($row[csf("bh_qty")]*1+$row[csf("rf_qty")]*1);
					$booking_data[$row[csf("booking_id")]]["uom"]=$row[csf("uom")];
					if($job_check[$row[csf("booking_id")]][$row[csf("job_no")]]=="")
					{
						$booking_data[$row[csf("booking_id")]]["job_no"].=$row[csf("job_no")].",";
						$booking_data[$row[csf("booking_id")]]["job_no_prefix_num"].=$row[csf("job_no_prefix_num")].",";
						$booking_data[$row[csf("booking_id")]]["job_year"].=$row[csf("job_year")].",";
						$booking_data[$row[csf("booking_id")]]["style_ref_no"].=$row[csf("style_ref_no")].",";
						$booking_data[$row[csf("booking_id")]]["season_buyer_wise"].=$season_library[$row[csf("season_buyer_wise")]].",";
						
						$job_check[$row[csf("booking_id")]][$row[csf("job_no")]]=$row[csf("job_no")];
					}
					if($order_check[$row[csf("booking_id")]][$row[csf("po_break_down_id")]]=="")
					{
						$booking_data[$row[csf("booking_id")]]["po_break_down_id"].=$row[csf("po_break_down_id")].",";
						$booking_data[$row[csf("booking_id")]]["po_number"].=$row[csf("po_number")].",";
						$booking_data[$row[csf("booking_id")]]["file_no"].=$row[csf("file_no")].",";
						$booking_data[$row[csf("booking_id")]]["grouping"].=$row[csf("grouping")].",";
						$booking_data[$row[csf("booking_id")]]["pub_shipment_date"].=change_date_format($row[csf("pub_shipment_date")]).",";
						
						$order_check[$row[csf("booking_id")]][$row[csf("po_break_down_id")]]=$row[csf("po_break_down_id")];
					}
					if($row[csf("booking_type")]==1 && $row[csf("is_short")]==1)//responsible_dept,reason
					{
						if($row[csf("reason")]!='')
						{
							$booking_data[$row[csf("booking_id")]]["reason"].=$row[csf("reason")].",";
						}
						if($row[csf("responsible_dept")]!='')
						{
							$resp_dept=explode(",",$row[csf("responsible_dept")]);
							$dept_name="";
							foreach($resp_dept as $dept)
							{
								if($dept_name=="") $dept_name=$department_library[$dept]; else $dept_name.=",".$department_library[$dept];
							}
							$booking_data[$row[csf("booking_id")]]["dept_name"].=$dept_name.",";
						}
					}
				}
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3,4) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 1, $po_id_arr, $empty_arr);//PO ID Ref from=1
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 2, $booking_id_arr, $empty_arr);//Book ID Ref from=2
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 4, $req_id_arr, $empty_arr);//Req ID Ref from=4

				$cbo_level_arr=return_library_array( "select b.id,b.cbo_level from wo_booking_mst b,gbl_temp_engine g where  b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37", "id", "cbo_level");

				$nonStyleArr=return_library_array( "select b.id, b.style_ref_no from sample_development_mst b,gbl_temp_engine g where b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=4 and g.entry_form=37", "id", "style_ref_no");


				$wopi_arr=array(); $tem_pi=array();
				if($cbo_category==4)
				{
					if($cbo_company>0) $piCond="and a.importer_id=$cbo_company"; else $piCond="";
					$sql_wo_pi=sql_select("select a.id,a.pi_number, b.work_order_no, b.work_order_dtls_id from com_pi_master_details a, com_pi_item_details b where a.id=b.pi_id and a.item_category_id in(2,3,4,12,25) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.work_order_dtls_id>0 $piCond");
					foreach($sql_wo_pi as $rowPi)
					{
						$tem_pi[$rowPi[csf('work_order_no')]]=$rowPi[csf('pi_number')];
						$wopi_arr[$rowPi[csf('work_order_no')]].=$rowPi[csf("pi_number")]."__";
						$wopiId_arr[$rowPi[csf('work_order_no')]].=$rowPi[csf("id")]."__";
						$pi_number_arr[] = "'".$rowPi[csf('id')]."'";
						$piArr[$rowPi[csf("id")]]=$rowPi[csf("id")];
					}
					//unset($sql_wo_pi);
				
					fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 3, $piArr, $empty_arr);//PI ID Ref from=3
					$pi_number_string = implode(',',array_unique($pi_number_arr));

					//============== For BTB Lc Data ==================
					if($pi_number_string!="")
					{
						if($cbo_company>0) $comCond="and a.importer_id=$cbo_company"; else $comCond="";
				
						$btb_sql = "SELECT a.id, a.lc_number,a.lc_type_id,a.payterm_id,a.tenor, c.pi_number FROM com_btb_lc_master_details a, com_btb_lc_pi b, com_pi_master_details c,gbl_temp_engine g WHERE a.id=b.com_btb_lc_master_details_id and b.pi_id=c.id and c.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=37 and a.is_deleted = 0 and a.item_basis_id=1 $comCond UNION ALL SELECT a.id, a.lc_number,a.lc_type_id,a.payterm_id,a.tenor,c.pi_number FROM com_btb_lc_master_details a, com_btb_lc_pi b, com_pi_master_details c,gbl_temp_engine g WHERE a.id=b.com_btb_lc_master_details_id and b.pi_id=c.id and c.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=37 and a.is_deleted = 0 and a.item_basis_id=2 $comCond";
						$sql_result=sql_select($btb_sql);
						$btb_pi=array();
						foreach($sql_result as $rows)
						{					
							$btb_pi[$rows[csf('pi_number')]]['lc_number']=$rows[csf('lc_number')];
							$btb_pi[$rows[csf('pi_number')]]['lc_type_id']=$rows[csf('lc_type_id')];
							$btb_pi[$rows[csf('pi_number')]]['payterm_id']=$rows[csf('payterm_id')];
							$btb_pi[$rows[csf('pi_number')]]['tenor']=$rows[csf('tenor')];
						}
					}
				}
				
				//print_r($wopi_arr); die;
				//----------------------
				if($cbo_category==2 || $cbo_category==3 || $cbo_category==4 ||  $cbo_category==25)
				{
					if ($cbo_company==0) $company_cond_id=""; else $company_cond_id=" and b.company_id in ($cbo_company)";
					if($cbo_category==2)
					{
						$booking_check_prod=array();
						$prod_1st_sql=sql_select("select a.id as book_id, b.booking_without_order, c.transaction_date as receive_date, c.cons_quantity as rcv_qnty from  wo_booking_mst a, pro_batch_create_mst b , inv_transaction c, gbl_temp_engine g where a.id=b.booking_no_id and b.id=c.pi_wo_batch_no    and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and a.item_category in(2,3)  and c.pi_wo_batch_no>0 and c.status_active=1 and c.item_category in(2,3) and c.transaction_type=1");
						$first_rec_date_prod=array();  
						foreach($prod_1st_sql as $row)
						{
							//$first_rec_date_prod[$row[csf("book_id")]]=$row[csf("receive_date")];
							$receive_data_pord[$row[csf("book_id")]][$row[csf("booking_without_order")]].=$row[csf("receive_date")].",";
							$receive_qnty_data_prod[$row[csf("book_id")]][$row[csf("booking_without_order")]][$row[csf("receive_date")]]+=$row[csf("rcv_qnty")];
							if($booking_check[$row[csf("book_id")]]=="")
							{
								$first_rec_date_prod[$row[csf("book_id")]]=$row[csf("receive_date")];
								$booking_check_prod[$row[csf("book_id")]]=$row[csf("receive_date")];
							}
						}
						
						$sql_receive="select b.recv_number,b.booking_id, b.receive_date, b.booking_without_order, c.cons_quantity as rcv_qnty from inv_receive_master b, inv_transaction c,gbl_temp_engine g  where b.id=c.mst_id and b.booking_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and c.transaction_type=1 and b.item_category in(2,3)  and b.receive_basis in(12,2) $company_cond_id";
						 	
						$receive_result=sql_select($sql_receive);
						$receive_data=$receive_qnty_data=$booking_check=array();
						foreach($receive_result as $row)
						{
							$receive_data[$row[csf("booking_id")]][$row[csf("booking_without_order")]].=$row[csf("receive_date")].",";
							$receive_qnty_data[$row[csf("booking_id")]][$row[csf("booking_without_order")]][$row[csf("receive_date")]]+=$row[csf("rcv_qnty")];
							if($booking_check[$row[csf("booking_id")]]=="")
							{
								$first_rec_date[$row[csf("booking_id")]]=$row[csf("receive_date")];
								$booking_check[$row[csf("booking_id")]]=$row[csf("receive_date")];
								$first_rec_no[$row[csf("booking_id")]]=$row[csf("recv_number")];
							}
						}
						
					}
					else
					{
						 $sql="select min(a.recv_number) as recv_number,b.pi_wo_batch_no, min(a.receive_date) as receive_date,min(a.currency_id) as currency_id, sum(b.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,gbl_temp_engine g  where a.id=b.mst_id and b.pi_wo_batch_no=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.entry_form=24 and  b.item_category in(4)  and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(2,12) $company_cond_id group by b.pi_wo_batch_no";	//echo $sql ;die;
						$sql_result=sql_select($sql);
						$booking_pi_check=array();
						foreach($sql_result as $row)
						{
							//if($booking_pi_check[$row[csf("pi_wo_batch_no")]]=="")
							//{
							$first_rec_date[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
							$first_rec_no[$row[csf("pi_wo_batch_no")]]=$row[csf("recv_number")];
							$booking_pi_check[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
							//}
							//$rec_amt_arr[$row[csf("pi_wo_batch_no")]]=$row[csf("rec_amt")];
							//$rec_currency_arr[$row[csf("pi_wo_batch_no")]]=$row[csf("currency_id")];
						}
						unset($sql_result);
							if($cbo_category==3) //Woven Fab
							{
								 $pi_recv_sql="select min(a.recv_number) as recv_number,b.pi_wo_batch_no, min(a.receive_date) as receive_date,min(a.currency_id) as currency_id, sum(b.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,gbl_temp_engine g where a.id=b.mst_id and b.pi_wo_batch_no=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.entry_form=17 and  b.item_category in(3)  and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(2,1) $company_cond_id group by b.pi_wo_batch_no";
								
							$wvn_receive_result=sql_select($pi_recv_sql);
							$receive_data=$receive_qnty_data=$booking_check=array();
							foreach($wvn_receive_result as $row)
							{
								$first_rec_date[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
								$first_rec_no[$row[csf("pi_wo_batch_no")]]=$row[csf("recv_number")];
								//$booking_pi_check[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
							}
							unset($wvn_receive_result);
						}
						
					}
				}

				$emb_sql="select a.emb_name, b.item_number_id, c.job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b, wo_po_break_down c,gbl_temp_engine g where a.job_id=b.job_id and c.id=b.po_break_down_id  and c.id=g.ref_val and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 ".where_con_using_array($po_id_arr,0,'b.po_break_down_id')."";
				// $po_id_arr
				// echo $emb_sql;
				$emb_sql_result=sql_select($emb_sql);
				foreach($emb_sql_result as $row)
				{
					$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
					$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
				}
				unset($emb_sql_result);

				//$booking_id_arr[$row[csf("booking_id")]]
				//var_dump($booking_data);die;
				//".where_con_using_array($po_id_arr,1,'po_break_down_id')."
				 //echo $sql;
				//echo  $po_id ;die;
				if($cbo_category!=2)
				{
					//$sql_recv="select b.pi_wo_batch_no,b.prod_id, (a.currency_id) as currency_id,(c.quantity) as rcv_qnty, (c.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,order_wise_pro_details c,inv_trims_entry_dtls e where a.id=b.mst_id and  b.id=c.trans_id and e.id=c.dtls_id and e.trans_id=c.trans_id and e.mst_id=a.id and e.prod_id=b.prod_id and c.trans_type=1 and a.entry_form=24 and c.entry_form=24 and  b.item_category in(4)  and c.status_active=1 and c.is_deleted=0 and e.status_active=1 and e.is_deleted=0 and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(2,12) $company_cond_id ".where_con_using_array($po_id_arr,0,'c.po_breakdown_id')."  ";
					$sql_recv="select b.pi_wo_batch_no,b.prod_id, (a.currency_id) as currency_id,(c.quantity) as rcv_qnty, (c.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,order_wise_pro_details c,gbl_temp_engine g where a.id=b.mst_id and  b.id=c.trans_id  and c.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and c.trans_type=1 and a.entry_form=24 and c.entry_form=24 and  b.item_category in(4)  and c.status_active=1 and c.is_deleted=0  and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(1,2,12) $company_cond_id ";

							$sql_Recv_result=sql_select($sql_recv);
							$propo_id_check=array();
							foreach($sql_Recv_result as $row)
							{
								//$first_rec_date[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
								//$first_rec_no[$row[csf("pi_wo_batch_no")]]=$row[csf("recv_number")];
								if($propo_id_check[$row[csf('prop_id')]]=="")
								{
								$propo_id_check[$row[csf('prop_id')]]=$row[csf('prop_id')];
								$rec_amt_arr[$row[csf("pi_wo_batch_no")]]+=$row[csf("rec_amt")];
								}
								$rec_currency_arr[$row[csf("pi_wo_batch_no")]]=$row[csf("currency_id")];
							}
							unset($sql_Recv_result);
				}
				
				$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id and b.work_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and a.item_category_id in(2,3,12,25) and a.pi_basis_id=1";
				$pi_sql_result=sql_select($pi_sql); 
				$pi_no_arr = array();
				foreach ($pi_sql_result as $value) 
				{
					$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
					$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];

				}
				unset($pi_sql_result);
				
		
				// $wo_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_booking_mst a, approval_history b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(8,7,32,13,12) ".where_con_using_array($booking_id_arr,0,'a.id')." order by b.id desc";
				$wo_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_booking_mst a, approval_history b,gbl_temp_engine g  where a.id=b.mst_id and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(8,7,32,13,12,162) order by b.id desc";
				$wo_his_sql_result=sql_select($wo_his_sql);
				$user_arr=return_library_array( "select id, user_name from user_passwd", 'id', 'user_name' );	
				foreach ($wo_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_his_sql_result);
				
				//$wo_non_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_non_ord_samp_booking_mst a, approval_history b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(8,7,32,9) ".where_con_using_array($booking_id_arr,0,'a.id')." order by b.id desc";
				$wo_non_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_non_ord_samp_booking_mst a, approval_history b,gbl_temp_engine g where a.id=b.mst_id and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(8,7,32,9) order by b.id asc";
				$wo_non_his_sql_result=sql_select($wo_non_his_sql);
			 
				foreach ($wo_non_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_non_his_sql_result);
				
				

				$i=1;$summer_data=array();$job_check=array();
				$tot_wo_currency_usd_amt=$tot_recv_usd_amt=$tot_embl_wo_amount=$tot_sample=0;
				
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
						
				foreach($booking_data as $row)
				{
					$variable=$row[("booking_no_prefix_num")];
					$sample_qnt=0;
					$sample_qnt=$row['sample_qnt'];
					$tot_sample+=$row['sample_qnt'];
					if($row[("item_category")]==2 || $cbo_category==3)
					{
						if($row[("fabric_source")]==1 || $row[("fabric_source")]==2 || $row[("fabric_source")]==4 || $row[("fabric_source")]==0)
						{
							if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
							if ($row[("type")]==0)
							{	
								if ($row[("booking_type")]==1 || $row[("booking_type")]==2  || $row[("booking_type")]==3  || $row[("booking_type")]==6)
								{
									if ($row[("is_short")]==1)
									{
										$wo_type="Short";
										$wo_typw_id=1;
									}
									else if ($row["entry_form"]==108){
										$wo_type="Partial";
										$wo_typw_id=5;
									}
									else
									{
										$wo_type="Main";
										$wo_typw_id=2;
									}
								}
								elseif($row[("booking_type")]==4)
								{
									$wo_type="Sample With Order";
									$wo_typw_id=3;

								}
							}
							else
							{
								$wo_type="Sample Non Order";
								$wo_typw_id=4;

								       
							}
							// echo $wo_typw_id.'ssd';
							
							$job_no=$style_ref_no=$po_number=$file=$ref=$job_number="";
							
							$p=1;
							$ship_date_arr=array_unique(explode(",",chop($row[("pub_shipment_date")],",")));
							foreach($ship_date_arr as $ship_date)
							{
								if($p==1)
								{
									$min_ship_date=$ship_date;
									$max_ship_date=$ship_date;
								}
								
								if(strtotime($min_ship_date)>strtotime($ship_date)) $min_ship_date=$ship_date;
								if(strtotime($max_ship_date)<strtotime($ship_date)) $max_ship_date=$ship_date;
								$p++;
							}
							
							$all_po_id=implode(",",array_unique(explode(",",chop($row[("po_break_down_id")],","))));
							$job_no=implode(",",array_unique(explode(",",chop($row[("job_no_prefix_num")],","))));
							$job_number=implode(",",array_unique(explode(",",chop($row[("job_no")],","))));
							$job_year=implode(",",array_unique(explode(",",chop($row[("job_year")],","))));
							$style_ref_no=implode(",",array_unique(explode(",",chop($row[("style_ref_no")],","))));
							$po_number=implode(", ",array_unique(explode(",",chop($row[("po_number")],","))));
							$file=implode(",",array_unique(explode(",",chop($row[("file_no")],","))));
							$ref=implode(",",array_unique(explode(",",chop($row[("grouping")],","))));
							$short_reason=implode(",",array_unique(explode(",",chop($row[("reason")],","))));
							$dept_name=implode(",",array_unique(explode(",",chop($row[("dept_name")],","))));
							$season_buyer=implode(",",array_unique(explode(",",chop($row[("season_buyer_wise")],","))));
							
							$cbo_company=$row[("company_id")];
							$print_report_format_ids=$print_report_format_arr[$cbo_company];
							$partial_print_report_format_ids=$partial_print_report_format_arr[$cbo_company];
							$woven_partial_print_report_format_ids=$woven_partial_print_report_format_arr[$cbo_company];
							$sample_req_non_print_report_format_ids=$sample_req_non_print_report_format_arr[$cbo_company];
							$sample_req_withorder_print_report_ids=$sample_req_booking_withorder_print_report_arr[$cbo_company];
							$sample_booking_without_print_report_ids=$sample_booking_non_print_report_format_arr[$cbo_company];
							$sample_booking_withorder_print_report_ids=$sample_booking_print_report_format_arr[$cbo_company];
							//echo $sample_req_non_print_report_format_ids.'-D-';
							$short_booking_print_report_ids=$print_short_report_format_arr[$cbo_company];
							//echo $short_booking_print_report_ids.'-D-';
							
							$short_format_ids=explode(",",$short_booking_print_report_ids);
							$short_format_first_print_button=array_shift($short_format_ids);
							
							$sample_req_format_ids=explode(",",$sample_req_withorder_print_report_ids);
							$samp_req_wo_first_print_button=array_shift($sample_req_format_ids);

							$sample_req_without_format_ids=explode(",",$sample_req_non_print_report_format_ids);
							$samp_req_without_wo_first_print_button=array_shift($sample_req_without_format_ids);
							
							
							$sample_req_with_print_ids=explode(",",$sample_req_withorder_print_report_ids);
							$samp_req_with_first_print_button=array_shift($sample_req_with_print_ids);
							//echo $sample_req_format_first_print_button.'DF';
							$sample_booking_without_print_ids=explode(",",$sample_booking_without_print_report_ids);
							$samp_booking_without_first_print_button=array_shift($sample_booking_without_print_ids);
							
							$sample_booking_with_print_ids=explode(",",$sample_booking_withorder_print_report_ids);
							$samp_booking_with_first_print_button=array_shift($sample_booking_with_print_ids);
							
							$partial_format_ids=explode(",",$partial_print_report_format_ids);
							$woven_partial_format_ids=explode(",",$woven_partial_print_report_format_ids);
							$part_first_print_button=array_shift($partial_format_ids);
							$woven_part_first_print_button=array_shift($woven_partial_format_ids);
							
							$format_ids=explode(",",$print_report_format_ids);
							$print_b_16="";
							foreach ($format_ids as $key => $button_id) {
								if($button_id==719)
								{
									$print_b_16=$button_id;
								}
							}
						
							$first_print_button=array_shift($format_ids);
							$second_print_button= array_shift($format_ids);
							//$part_first_print_button=array_shift($partial_format_ids);
							//echo $partial_print_report_format_ids.'=DD='.$first_print_button;
							
							
							//print ($part_first_print_button).'='.$row["entry_form"].'---';

							//143,160,220,151,175,155,218,84,85,235 partial
							if($cbo_category==2 || $cbo_category==3)
							{
								if($row["entry_form"]==118)
								{
									
									if($first_print_button==1)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report_gr";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										
										//part_first_print_button $row["entry_form"]
									}
									else if($first_print_button==2)
									{
										if($wo_typw_id==2)
										{
											$action_type="show_fabric_booking_report";
											$wo_typw_id=73;
										}
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##'  title='PB F1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." <a/>";			
									}
									else if($first_print_button==3)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report3";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##'  title='PB F2' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";	
									}
									else if($first_print_button==4)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report1";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##'  title='PFC F1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==5)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report2";
										else $action_type="show_fabric_booking_report";  
										$variable="<a href='##' title='PFC F2' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	    
									}
									else if($first_print_button==6)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report4";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##' title='FB F1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==7)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report5";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##' title='FB F2' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==28)
									{
										$action_type="show_fabric_booking_report_akh"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==45)
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==53)
									{
										$action_type="show_fabric_booking_report_jk";
										
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==93)
									{
										$action_type="show_fabric_booking_report_libas"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==786)
									{
										$action_type="show_fabric_booking_report25"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==73)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_mf";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==193)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_print4";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==269)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_knit";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}else if($first_print_button==723)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report17";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}else if($first_print_button==304)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report10";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==849)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_bl1";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($second_print_button==73)
									{
										$action_type="show_fabric_booking_report_mf";  
										$variable="<a href='##'  title='PB MF' onClick=\"generate_fabric_report('".$second_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==719)
									{
										$action_type="show_fabric_booking_report16";  
										$variable="<a href='##'  title='B16' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($second_print_button==719)
									{
										$action_type="show_fabric_booking_report16";  
										$variable="<a href='##'  title='B16' onClick=\"generate_fabric_report('".$second_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($print_b_16==719)
									{
										$action_type="show_fabric_booking_report16";  
										$variable="<a href='##'  title='B16' onClick=\"generate_fabric_report('".$print_b_16."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==140) //Sampe Req Fab Without Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition Fabric Booking -Without order";
									if($samp_req_without_wo_first_print_button==10)
									{
										$action_type="show_fabric_booking_report";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_without_wo_first_print_button==17)
									{
										$action_type="show_fabric_booking_report_barnali";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==203) //Sampe Req Fab Without Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition With Booking";
									if($samp_req_without_wo_first_print_button==109)
									{
										$action_type="sample_requisition_print";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(203,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_without_wo_first_print_button==111)
									{
										$action_type="sample_requisition_print6";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(203,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==142) //Sampe Req With Booking  
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition With Booking";
									if($samp_req_without_wo_first_print_button==110)
									{
										$action_type="sample_requisition_print";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_without_wo_first_print_button==109)
									{
										$action_type="sample_requisition_print1";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==139) //Sampe Req Fab With Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition Fabric Booking -With order";
									if($samp_req_wo_first_print_button==155)
									{
										$action_type="show_fabric_booking_report";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(139,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_wo_first_print_button==17)
									{
										$action_type="show_fabric_booking_report2";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(139,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==88) //Sampe Req Fab With Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									//echo $short_format_first_print_button.'X';
									$page_name="Short Fabric Booking";
									if($short_format_first_print_button==136)
									{
										$action_type="print_booking_3";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==8)
									{
										$action_type="show_fabric_booking_report";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==9)
									{
										$action_type="show_fabric_booking_report3";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==244)
									{
										$action_type="show_fabric_booking_report_ntg";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==46)
									{
										$action_type="show_fabric_booking_report_urmi";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==86) //Main Fabric Booking
								{
									if($first_print_button==1)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report_gr"; else $action_type="show_fabric_booking_report"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}
									else if($first_print_button==73)
									{
										 $action_type="show_fabric_booking_report_b6"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
									else if($first_print_button==53)
									{
										 $action_type="show_fabric_booking_report_jk"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
									else if($first_print_button==45)//
									{
										 $action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
									else if($first_print_button==28)//show_fabric_booking_report_akh
									{
										 $action_type="show_fabric_booking_report_akh"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
								}
								else if($row["entry_form"]==271) //Woven Partial Fabric Booking
								{
									//$variable=$row[("booking_no_prefix_num")];
									//echo $first_print_button.'D';
									if($part_first_print_button==143)
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										
										//part_first_print_button $row["entry_form"]
									}
									else if($part_first_print_button==84)
									{
										
										$action_type="show_fabric_booking_report_urmi_per_job";											
										$variable="<a href='##'  title='PB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." <a/>";			
									}
									else if($part_first_print_button==85)
									{
										$action_type="print_booking_3";
										 
										$variable="<a href='##'  title='PB F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";	
									}
									else if($part_first_print_button==151)
									{
										$action_type="show_fabric_booking_report_advance_attire_ltd";
										
										$variable="<a href='##'  title='PFC F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($part_first_print_button==160)
									{
										$action_type="print_booking_5";  
										$variable="<a href='##' title='PFC F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	    
									}
									else if($part_first_print_button==175)
									{
									   $action_type="print_booking_6";
										
										$variable="<a href='##' title='FB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($part_first_print_button==155)
									{
										$action_type="fabric_booking_report";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==160) //Woven Partial Start
									{
										$action_type="print_booking_5";  
										$variable="<a href='##' title='PFC F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]." </a>";	
									}
									else if($woven_part_first_print_button==143)
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										
										//part_first_print_button $row["entry_form"]
									}
									else if($woven_part_first_print_button==84)
									{
										
										$action_type="show_fabric_booking_report_urmi_per_job";											
										$variable="<a href='##'  title='PB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]." <a/>";			
									}
									else if($woven_part_first_print_button==85)
									{
										$action_type="print_booking_3";
										 
										$variable="<a href='##'  title='PB F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";	
									}
									else if($woven_part_first_print_button==151)
									{
										$action_type="show_fabric_booking_report_advance_attire_ltd";
										
										$variable="<a href='##'  title='PFC F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									
									else if($woven_part_first_print_button==175)
									{
									   $action_type="print_booking_6";
										
										$variable="<a href='##' title='FB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==155)
									{
										$action_type="fabric_booking_report";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==72) //
									{
										$action_type="print6booking";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==84) //
									{
										$action_type="show_fabric_booking_report_urmi_per_job";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									
								} //Woven Partial Booking end
								else if($row["entry_form"]==108) // Partial Fabric Booking
								{
									if ($part_first_print_button==143) // print 1
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==84) // print 2
									{
										$action_type="show_fabric_booking_report_urmi_per_job"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==85) // print 3
									{
										$action_type="print_booking_3"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==151) // print 4
									{
										$action_type="show_fabric_booking_report_advance_attire_ltd"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==160) // print 5
									{
										$action_type="print_booking_5"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==175) // print 6
									{
										$action_type="print_booking_6"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==218) // print 7
									{
										$action_type="print_booking_7"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==220) // print 8
									{
										$action_type="print_booking_northern_new"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==235) // print 9
									{
										$action_type="print_booking_northern_9"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==274) // print 10
									{
										$action_type="print_booking_10"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==241) // print 11
									{
										$action_type="print_booking_11"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==269) // print 12
									{
										$action_type="print_booking_12"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==28) // print 13
									{
										$action_type="print_booking_13"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==280) // print 14
									{
										$action_type="print_booking_14"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==304) // print 15
									{
										$action_type="print_booking_15"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==719) // print 16
									{
										$action_type="print_booking_16"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==723) // print 17
									{
										$action_type="print_booking_17"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==339) // print 18
									{
										$action_type="print_booking_18"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==370) // print 19
									{
										$action_type="print_booking_19"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==768) // print 20
									{
										$action_type="print_booking_20"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
								}
								else
								{
									if($row[("booking_type")]==4 && $row[("is_short")]=="")
									{  
										$page_name="Sample Fabric Booking Without order";
										// echo $samp_booking_without_first_print_button.'F'.$row[("is_short")].'<br>';
										if($sample_booking_without_print_ids[0]==64) //Metro
										{
											$action_type="show_fabric_booking_report5";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==37) //Akh
										{
											$action_type="show_fabric_booking_report4";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==36) //Amana
										{
											$action_type="show_fabric_booking_report3"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==34) //Print Booking
										{
											$action_type="show_fabric_booking_report"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==35) //Print Booking2
										{
											$action_type="show_fabric_booking_report2"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==72) //Print FFl
										{
											$action_type="show_fabric_booking_report6"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==174) //Print UG
										{
											$action_type="show_fabric_booking_report7"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
									}
									if($row[("booking_type")]==4 && $row[("is_short")]==2) //Sample Booking with order
									{  
										$page_name="Sample Fabric Booking With order two";
										// echo $samp_booking_without_first_print_button.'F'.$row[("is_short")].'<br>';
										if($samp_booking_with_first_print_button==38) //Print Booking
										{
											$action_type="show_fabric_booking_report";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(89,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($samp_booking_without_first_print_button==39) //Print Booking2
										{
											$action_type="show_fabric_booking_report2";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(89,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($samp_booking_without_first_print_button==64) //Metro
										{
											$action_type="show_fabric_booking_report3"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(89,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}else{ 
											
											
											
											if($wo_typw_id==3 || $wo_typw_id==4){

												$action_type="show_fabric_booking_report2";									
												$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no")]."  <a/>";	
											}else{
												$variable=$row[("booking_no")];
											}
			


										}
									}
								}
							} //Fabric Booking End
							
							//143,160,220,151,175,155,218,84,85,235
						    //  if($part_first_print_button==220 && $row["entry_form"]==108)
							/*if($row["entry_form"]==108)
							{
								$action_type="print_booking_northern_new"; 
								$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
							}*/

							//echo $row[("booking_type")];						
						
							//echo $row[("fabric_source")];die;

							

						
							if($row[("fabric_source")]==2)
							{
								$rcv_date_arr=array_unique(explode(",",chop($receive_data[$row[("booking_id")]][$row[("type")]],",")));
								if($row[("booking_type")]==1 && $row[("is_short")]==2)
								{
									$summer_data[1]["book_qnty"]+=$row[("fin_fab_qnty")];
									
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[1]["rcv_qnty_intime"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[1]["rcv_qnty"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								else if($row[("booking_type")]==1 && $row[("is_short")]==1)
								{
									$summer_data[2]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[2]["rcv_qnty_intime"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[2]["rcv_qnty"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								else if($row[("booking_type")]==4 )
								{
									$summer_data[3]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[3]["rcv_qnty_intime"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[3]["rcv_qnty"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
							}
							else if($row[("fabric_source")]==1)
							{
								$rcv_date_arr=array_unique(explode(",",chop($receive_data_pord[$row[("booking_id")]][$row[("type")]],",")));
								if($row[("booking_type")]==1 && $row[("is_short")]==2)
								{
									$summer_data[1]["book_qnty"]+=$row[("fin_fab_qnty")];
									
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[1]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[1]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								else if($row[("booking_type")]==1 && $row[("is_short")]==1)
								{
									$summer_data[2]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[2]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[2]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								
								else if($row[("booking_type")]==4 )
								{
									$summer_data[3]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[3]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[3]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
							}
							else if($row[("fabric_source")]==4)
							{
								$summer_data[4]["book_qnty"]+=$row[("fin_fab_qnty")];
								foreach($rcv_date_arr as $rcv_date)
								{
									if($rcv_date<=$row[("delivery_date")])
									{
										$summer_data[4]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
									$summer_data[4]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
								}
							}
							
							$supplier_name="";
							if($row[("pay_mode")]==3 || $row[("pay_mode")]==5)
							{
								$supplier_name=$company_library[$row[("supplier_id")]];
							}
							else $supplier_name=$supplierArr[$row[("supplier_id")]];
							$ready_to_approved=$row[("ready_to_approved")];
							if($ready_to_approved==1)
							{
							$last_update_date=$row[("update_date")];
							}
							//echo $variable;
							//<a href='#report_details' onClick="generate_fabric_booking_report('<? echo $row[("booking_no")];','show_trim_booking_report');"></a>
							if($row[("delivery_date")]!="" && $row[("delivery_date_dtls")]=="" )  $row[("delivery_date")]=$row[("delivery_date")];else  $row[("delivery_date")]=$row[("delivery_date_dtls")];
							?>
							<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
								<td width="30"><? echo $i;?></td>
								<td width="100" align="center"><p><? echo $company_library[$row[("company_id")]]; ?></td>	
								<td width="70" align="center" title="Entry Form=<? echo $row["entry_form"];?>"><? echo $variable; ?><? //echo $row[("booking_no_prefix_num")];?></td>
                                <td width="70" align="center"><p><? echo $pay_mode[$row[("pay_mode")]]; ?></td>	

                                <?
								if ($cbo_category==3 || $cbo_category==2)
								{
									$pi_id=$pi_no_arr[$row[("booking_no")]]['pi_id'];
									?>
										<td width="100" align="center" title="<? echo 'Pi='.$pi_id.', Booking-'.$row[("booking_no")]; ?>"><p><? echo $pi_no_arr[$row[("booking_no")]]['pi_no']; ?></td>
									<? 
								}
								?>                                

								<td width="60" align="center"><p><? echo $row[("year_book")]; ?></td>
								<td width="70" align="center"><p><? echo change_date_format($row[("booking_date")]); ?></p></td>
								<td width="70" align="center"><p><?  $update_date=explode(" ",$row[("update_date")]);echo change_date_format($update_date[0])//echo change_date_format($wo_last_date_arr[$row[("booking_id")]]); ?></p></td>
								<td width="70" align="center"><p><? echo change_date_format($row[("delivery_date")]); ?></p></td>
								<td width="70" align="center"><p>
								<? 
								$lead_time=0;
								if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00")
								{
									$lead_time=datediff("d", $row[("booking_date")], $row[("delivery_date")]);
								}
								if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day";
								?></p></td>
											
								<td width="100" title="wo_type_id=<?=$wo_typw_id;?>"><p><? echo $wo_type;?></p></td>
                                
								<td width="100" align="center"><? echo $yes_no[$row[("ready_to_approved")]]; ?></td>
                              
								 <td width="100" align="center"><? $last_update_date=explode(" ",$last_update_date);echo change_date_format($last_update_date[0]).'<br>'.$last_update_date[1]; ?></td>
								
							 
								<td width="80"><p><? echo $approval_type_arr[$row[("is_approved")]]; ?></p></td>
                                <?
                                $approved_date=$last_app_arr[$row[("booking_id")]]['approved_date'];
								$approved_by=$last_app_arr[$row[("booking_id")]]['approved_by'];
								?>
                                 <td width="100" title="bookingId=<? echo $row[("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                                
                                 
								<td width="100"><p><? echo $supplier_name; ?></p></td>
								<td width="100"><p><? echo $buyerArr[$row[("buyer_id")]]; ?></p></td>
								<td width="70"><? echo $job_no;//$row[("job_no_prefix_num")]; ?></td>
                              	 <td width="70"><p><? echo $season_buyer;//$row[("job_no_prefix_num")]; ?>&nbsp;</p></td>
								<td width="60"><? echo $job_year; ?></td>
                                
								<td width="100"><p><? if ($row[("type")]==0) echo $style_ref_no; else echo $nonStyleArr[$style_ref_no]; ?></p></td>
								<td width="100"><p><? echo $printButton.$ref; ?></p></td>
								<td width="100"><p><? echo $file; ?></p></td>
								<td width="100"><p><? echo $po_number; ?></p></td>
								<td width="80"><p><? echo $item_category[$row[("item_category")]]; ?></p></td>
								<? 
								//booking_id
								$td_color="";
								if($row[("booking_type")]==2)
								{
									if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00" && $first_rec_date[$row[("booking_id")]]!="" && $first_rec_date[$row[("booking_id")]]!="0000-00-00")
									{
										if(strtotime($first_rec_date[$row[("booking_id")]])>strtotime($row[("delivery_date")])) $td_color='bgcolor="#FF0000"'; else $td_color='';
									}
									$first_rcv_date=change_date_format($first_rec_date[$row[("booking_id")]]);
								}
								else if($row[("booking_type")]==1 || $row[("booking_type")]==4)
								{
									if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00" && $first_rec_date_prod[$row[("booking_id")]]!="" && $first_rec_date_prod[$row[("booking_id")]]!="0000-00-00")
									{
										if(strtotime($first_rec_date_prod[$row[("booking_id")]])>strtotime($row[("delivery_date")])) $td_color='bgcolor="#FF0000"'; else $td_color='';
									}
									if ($cbo_category==3) //Woven Fabric
									{
										//echo $first_rec_date[$pi_id].'==AA'.$pi_id;
										$first_rcv_date=change_date_format($first_rec_date[$pi_id]);
									}
									else
									{
									$first_rcv_date=change_date_format($first_rec_date_prod[$row[("booking_id")]]);
									}
								}
								 //echo $row[("booking_type")]."***".$row[("type")] ;
								?>
								<td width="70" title="<? echo "Booking No : ".$booking_data[$row[("booking_id")]]["booking_no"].",\nBooking Type:".$row[("booking_type")]."\nFirst Receive No:".$first_rec_no[$row[("booking_id")]];  ?>" align="center" <? echo $td_color; ?> ><p><? echo $first_rcv_date; ?></p></td>
								<?
								if ($cbo_category==4)
								{
									?>
										<td width="100" align="right"><? echo number_format($row[("amount")],2); ?></td>
									<?
								}
								else
								{
									?>
										<td width="100" align="right"><? echo number_format($row[("fin_fab_qnty")],2); ?></td>
										<?
										if ($cbo_category==3) 
										{
											$tot_grey_fab_qnty+=$row[("amount")];
											?>
											<td width="100" align="right"><? echo number_format($row[("amount")],2); ?> </td>
											<?
										}
										else
										{
											$tot_grey_fab_qnty+=$row[("grey_fab_qnty")];
											?>
											<td width="100" align="right"><? echo number_format($row[("grey_fab_qnty")],2); ?></td>
											<?
										}
								}
								if($cbo_category==2)
								{
									?>
									<td width="80"><p><? echo number_format($sample_qnt,2); ?></p></td>
									<td width="80"><p><? echo $dept_name; ?></p></td>
									<td width="80"><p><? echo $short_reason; ?></p></td>
									<?
								}
								?>
								<td width="80"><? echo $level_arr[$row[("cbo_level")]]; ?></td>
								<td width="">&nbsp;&nbsp;&nbsp;&nbsp;<? //echo $row[("po_number")]; ?></td>
							</tr>
							<?
							$tot_wo_qnty+=$row[("amount")];
							$tot_fin_fab_qnty+=$row[("fin_fab_qnty")];
							
							$i++;
						
						}
					}
					else
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$print_report_format_ids=$print_report_format_arr[$cbo_company];
						$format_ids=explode(",",$print_report_format_ids);
					
						$first_print_button=array_shift($format_ids);
						$second_print_button= array_shift($format_ids);
						if ($row[("type")]==0)
						{	
							if ($row[("booking_type")]==1 || $row[("booking_type")]==2  || $row[("booking_type")]==3  || $row[("booking_type")]==6)
							{
								if ($row[("is_short")]==1)
								{
									$wo_type="Short";
									$wo_typw_id=1;
								}
								else
								{
									$wo_type="Main";
									$wo_typw_id=2;
								}
							}
							elseif($row[("booking_type")]==4)
							{
								$wo_type="Sample With Order";
								$wo_typw_id=3;
							}
						}
						else
						{
							$wo_type="Sample Non Order";
							$wo_typw_id=4;
						}
						$ready_to_approved=$row[("ready_to_approved")];
						if($ready_to_approved==1)
						{
						$last_update_date=$row[("update_date")];
						}
						// echo $wo_typw_id.'ssd';
						$job_no=$style_ref_no=$po_number=$file=$ref=$job_number="";
						$p=1;
						$ship_date_arr=array_unique(explode(",",chop($row[("pub_shipment_date")],",")));
						foreach($ship_date_arr as $ship_date)
						{
							if($p==1)
							{
								$min_ship_date=$ship_date;
								$max_ship_date=$ship_date;
							}
							
							if($min_ship_date>$ship_date) $min_ship_date=$ship_date;
							if($max_ship_date<$ship_date) $max_ship_date=$ship_date;
							$p++;
						}
						
						$all_po_id=implode(",",array_unique(explode(",",chop($row[("po_break_down_id")],","))));
						$job_no=implode(",",array_unique(explode(",",chop($row[("job_no_prefix_num")],","))));
						$season_buyer=implode(",",array_unique(explode(",",chop($row[("season_buyer_wise")],","))));
						//echo $season_buyer.'DDDD';
						$job_number=implode(",",array_unique(explode(",",chop($row[("job_no")],","))));
						$style_ref_no=implode(",",array_unique(explode(",",chop($row[("style_ref_no")],","))));
						$po_number=implode(", ",array_unique(explode(",",chop($row[("po_number")],","))));
						$file=implode(",",array_unique(explode(",",chop($row[("file_no")],","))));
						$ref=implode(",",array_unique(explode(",",chop($row[("grouping")],","))));
						$short_reason=implode(",",array_unique(explode(",",chop($row[("reason")],","))));
						$dept_name=implode(",",array_unique(explode(",",chop($row[("dept_name")],","))));
					    $job_year=implode(",",array_unique(explode(",",chop($row[("job_year")],","))));
					    $cbo_company=$row[("company_id")];
						$print_report_format_ids=$print_report_format_arr[$cbo_company];
						$format_ids=explode(",",$print_report_format_ids);
						$first_print_button=array_shift($format_ids);
						$second_print_button= array_shift($format_ids);
						//echo $cbo_company.'='.$first_print_button;
						$knit_print_report_format_ids=$multi_knit_print_report_format_arr[$cbo_company];
						$knit_format_ids=explode(",",$knit_print_report_format_ids);
						$knit_first_print_button=array_shift($knit_format_ids);
						
						$trim_format_ids=explode(",",$trim_print_report_format_arr[$cbo_company]);
						$trim_format_ids2=explode(",",$trim_print_report_format_arr2[$cbo_company]);
						$trim_format_ids3=explode(",",$trim_print_report_format_arr3[$cbo_company]);
						$trim_first_print_button=array_shift($trim_format_ids);
						$trim_country_order_v2_button= array_shift($trim_format_ids2);
						$trim_woven_button= array_shift($trim_format_ids3);
				     		//echo $row[("entry_form")].'d'.$trim_woven_button;
						
						if($cbo_category==4) //Accessories Start
						{
							//echo $trim_woven_button.'kk';
							  //echo $format_ids26[0].'='.$row["entry_form"];
							if($first_print_button==13 && $row["entry_form"]==272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							
							if($first_print_button==13 && $row["entry_form"]==262)
							{ 
							//echo $first_print_button.$row["entry_form"].'kk';
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($first_print_button==13 && $row["entry_form"]!=272 && $row["entry_form"]!=262)
							{ 
								$variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($first_print_button==14 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==15 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==16 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==17 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==18 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==19 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==774 && $row["entry_form"]!=493)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print_booking_wg','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							
							$print_report_format_ids26=$print_report_format_arr26[$cbo_company];
							$format_ids26=explode(",",$print_report_format_ids26);
							//echo $format_ids26[0].'D'. $row[("entry_form")];
							if($format_ids26[0]==67 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==746 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report7','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==183 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==177 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report9','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==209 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==85 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report8','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==235 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==174 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report7','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==14 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report16','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							
							if($format_ids26[0]==274 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report10','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							 if($format_ids26[0]==719 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report10','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							else if( $row["entry_form"]==272 && $variable==$row[("booking_no_prefix_num")] )
							{
								if($format_ids26[0]==67 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==183 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==177 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==209 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print_t','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==85 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report8','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==235 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==174 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report7','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==274 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report10','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
							}
							if($trim_country_order_v2_button==177 && $row["entry_form"]==260)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if(($trim_country_order_v2_button==13 || $trim_country_order_v2_button==17) && $row["entry_form"]==260)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if(($trim_country_order_v2_button==14 || $trim_country_order_v2_button==18) && $row["entry_form"]==260)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if(($trim_country_order_v2_button==15 || $trim_country_order_v2_button==19) && $row["entry_form"]==260)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_country_order_v2_button==16 && $row["entry_form"]==260)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_country_order_v2_button==175 && $row["entry_form"]==260)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_country_order_v2_button==176 && $row["entry_form"]==260)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report6','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_country_order_v2_button==174 && $row["entry_form"]==260)
							{
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report_gr','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_woven_button[0]==67 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==183 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==177 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==175 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==235 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report9','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==85 && $row["entry_form"]=492 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print_t','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==786 && $row["entry_form"]=492 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print_t7','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button==774 && $row["entry_form"]=492 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report_wg','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
							//else $variable=$row[("booking_no")];
						}
						else if($cbo_category==25)
						{
							
							if($row[("entry_form")]==201)
							{
							$variable="<a href='##' title='Print Actual' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."','".$row[("supplier_id")]."')\" >".$row[("booking_no_prefix_num")]." </a>"; //actual print
							}
							else
							{
								$variable="<a href='##' title='Print Actual' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."','".$row[("supplier_id")]."')\" >".$row[("booking_no_prefix_num")]." </a>";
							}
						}
						else if($cbo_category==12) //Service Fab. Booking...
						{
							
							$format_ids_aop=explode(",",$print_report_format_aop);
							$first_print_button_aop=array_shift($format_ids_aop);
							//echo $wo_typw_id.'=='.$row[("entry_form")].',';
							if($first_print_button==11)
							{ 
							 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==12)
							{ 
							 $variable="<a href='##' title='PB1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==59)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button_aop==164)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button_aop==163)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($row[("entry_form")]==228) //Multi Job Wise service Booking Knitting
							{
								if($knit_first_print_button==13)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==15)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==16)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report3','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==177)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report4','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==175)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report5','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==176)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report6','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button=='')
								{ 
								 $variable=$row[("booking_no_prefix_num")];
								}								
							}
							
						}
						if($row[("entry_form")]==178){
							$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
						}elseif($row["entry_form"]==262){
							$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
						}


						//$conversion_cost_head_array
						$process_id_all=array_unique(explode(",",chop($row[("process")],",")));
						$all_process="";
						foreach($process_id_all as $process_id)
						{
							$all_process.=$conversion_cost_head_array[$process_id].",";
						}
						$all_process=chop($all_process,",");
						
						$supplier_name="";
						if($row[("pay_mode")]==3 || $row[("pay_mode")]==5)
						{
							$supplier_name=$company_library[$row[("supplier_id")]];
						}
						else $supplier_name=$supplierArr[$row[("supplier_id")]];
						//echo $row[("currency_id")];.// $row[("booking_date")]
						if($row[("booking_type")]==2  && $row[("entry_form")]==43 )  $row[("delivery_date")]=$row[("delivery_date_dtls")];else  $row[("delivery_date")]=$row[("delivery_date_dtls")];
						
						$piWoNo="";
						$piWoNo=implode(",",array_unique(array_filter(explode("__",$wopi_arr[$row["booking_no"]]))));
						$piWoNoId=implode(",",array_unique(array_filter(explode("__",$wopiId_arr[$row["booking_no"]]))));
						?>
						<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
							<td width="30"><? echo $i;?></td>
							<td width="100" align="center"><p><? echo $company_library[$cbo_company]; ?></td>
							<td width="70" align="center" title="<?=$row['entry_form']?>"><? echo $variable; ?><? //echo $row[("booking_no_prefix_num")];?></td>
							<?
							if($cbo_category==25)
							{?>
							<td width="100" align="center"><? echo $emblishment_name_array[$emb_item_array[$job_number]['emb_name']]; ?><? //echo $row[("booking_no_prefix_num")];?></td>
							<?
							}?>
                            <td width="70" align="center"><p><? echo $pay_mode[$row[("pay_mode")]]; ?></td>						
                            <?
							if($cbo_category==12)
							{?>
								<td width="100" align="center" title="<? echo 'Pi='.$pi_id.', Booking-'.$row[("booking_no")]; ?>"><p><? echo $pi_no_arr[$row[("booking_no")]]['pi_no']; ?></td>
                                <td width="100"><p><? echo $all_process; ?>&nbsp;</p></td>
                                <?
							}
							else if($cbo_category==4)
							{
								?>					
								<td width="100" style="word-break:break-all" align="center"><? echo $piWoNo; ?>&nbsp; </td>
                                <td width="100" style="word-break:break-all" align="center"><? echo $btb_pi[$piWoNo]['lc_number'] ?>&nbsp; </td>
                                <td width="100" style="word-break:break-all" align="center"><? echo $lc_type[$btb_pi[$piWoNo]['lc_type_id']]; ?>&nbsp; </td>
								<td width="100" style="word-break:break-all" align="center"><? echo $pay_term[$btb_pi[$piWoNo]['payterm_id']]; ?>&nbsp; </td>
								<td width="100" style="word-break:break-all" align="center"><? echo $btb_pi[$piWoNo]['tenor']; ?>&nbsp; </td>
                                <?
							}else if($cbo_category==25)
							{
								?>
                                <td width="100" style="word-break:break-all"><? echo $pi_no_arr[$row[("booking_no")]]['pi_no']; ?>&nbsp;</td>
                                <?
							}
							?>
							<td width="60" align="center"><p><? echo $row[("year_book")]; ?>&nbsp;</p></td>
                            <td width="70" align="center"><? echo change_date_format($row[("booking_date")]);?></td>	
							<td width="70" align="center"><p><? echo change_date_format($row[("update_date")]); ?>&nbsp;</p></td>
							<td width="70" align="center"><p><? echo change_date_format($row[("delivery_date")]); ?>&nbsp;</p></td>
							<td width="70" align="center"><p>
							<?
							$lead_time=0;
							if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00")
							{
								$lead_time=datediff("d", $row[("booking_date")], $row[("delivery_date")]);
							}
							if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day";
							?>&nbsp;</p></td>
							<td width="100"><p><? echo $wo_type;?>&nbsp;</p></td>
							<td width="100" title="MSg=<? echo $row[("ready_to_approved")];?>" align="center"><? echo $yes_no[$row[("ready_to_approved")]]; ?></td>
                              <?
							//if ($cbo_category==4)
							//{
								?>
                             <td width="100" align="center"><? $last_update_date=explode(" ",$last_update_date);echo change_date_format($last_update_date[0]).'<br>'.$last_update_date[1]; ?></td>
                             <?
							//}
							 ?>
							<td width="80"><p><? echo $approval_type_arr[$row[("is_approved")]]; ?>&nbsp;</p></td>
                             <?
							//if ($cbo_category==4)
							//{
								$approved_date=$last_app_arr[$row[("booking_id")]]['approved_date'];
								$approved_by=$last_app_arr[$row[("booking_id")]]['approved_by'];
								?>
                             <td width="100" title="bookingId=<? echo $row[("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                              <?
							//}
							 ?>
							<td width="100"><p><? echo $supplier_name; ?>&nbsp;</p></td>
							<td width="100"><p><? echo $buyerArr[$row[("buyer_id")]]; ?>&nbsp;</p></td>
							<td width="70"><p><? echo $job_no;//$row[("job_no_prefix_num")]; ?>&nbsp;</p></td>
                            <td width="70"><p><? echo $season_buyer;//$row[("job_no_prefix_num")]; ?>&nbsp;</p></td>
							<td width="60"><? echo $job_year;// $year; ?></td>
							<td width="100"><p><? if ($row[("type")]==0) echo $style_ref_no; else echo $nonStyleArr[$style_ref_no]; ?>&nbsp;</p></td>
							<td width="100"><p><? echo $ref; ?>&nbsp;</p></td>
							<td width="100"><p><? echo $file; ?>&nbsp;</p></td>
							<td width="100"><p><? echo $po_number; ?>&nbsp;</p></td>
							<td width="80"><p><? echo $item_category[$row[("item_category")]]; ?>&nbsp;</p></td>
							<? 
							//booking_id
							$td_color="";
							
							if(strtotime($first_rec_date[$row[("booking_id")]])>strtotime($row[("delivery_date")])) $td_color='bgcolor="#FF0000"'; else $td_color='';
							$first_rcv_date=change_date_format($first_rec_date[$row[("booking_id")]]);
							
							 //echo $row[("booking_type")]."***".$row[("type")] ;
							?>
							<td width="70" title="<? echo "Booking No : ".$booking_data[$row[("booking_id")]]["booking_no"]."\nFirst Receive No:".$first_rec_no[$row[("booking_id")]]; ?>" align="center" <? echo $td_color; ?> ><p><? echo $first_rcv_date;  ?></p></td>
							<?
								if ($cbo_category==4)
								{
									$usd_id=2;
									if($db_type==0) $conversion_date=change_date_format($row[("booking_date")], "Y-m-d", "-",1);
									else $conversion_date=change_date_format($row[("booking_date")], "d-M-y", "-",1);
									$currency_rate=set_conversion_rate($usd_id,$conversion_date );
									if($row[("currency_id")]==2) $wo_currency_usd_amt=$row[("amount")];//USD
									else $wo_currency_usd_amt=$row[("amount")]/$currency_rate;
									$rec_amt=0;
									$rec_amt=$rec_amt_arr[$row["booking_id"]];
									$rec_currency=$rec_currency_arr[$row["booking_id"]];
									//echo $rec_currency.'GG';
									$rec_date=$first_rec_date[$row["booking_id"]];
									if($rec_currency==2) $recv_usd_amt=$rec_amt;//USD
									else $recv_usd_amt=$rec_amt/$currency_rate;
									?>
										<td width="100" align="right"><? echo number_format($row[("amount")],2); ?></td>
                                        <td width="100" align="right" title="Exchange Rate=<? echo $currency_rate;?>"><? echo number_format($wo_currency_usd_amt,2); ?></td>
                                        <td width="100" align="right"><? echo number_format($rec_amt,2); ?></td>
                                        <td width="100" align="right"><? echo number_format($recv_usd_amt,2); ?></td>
									<?
								}
								else
								{
									$currency_id=$row[("currency_id")];
								//echo $currency_id.'dddd,';
									if($cbo_category==25 && $currency_id==1)
									{	
									$cid=2;
									$ex_rate=set_conversion_rate($cid, $row[("booking_date")],$cbo_company);
									$wo_amount=$row[("amount")]/$ex_rate;
									//echo $exchnage_rate.'CCCC';
									} else $wo_amount=$row[("amount")];
									?>
										<td width="100" align="right"><? if ($cbo_category==25 || $cbo_category==12 ) echo number_format($row[("wo_qnty")],2); else echo number_format($row[("fin_fab_qnty")],2); ?></td>
                                        <?
                                        if($cbo_category==25)
										{
										?>
										<td width="100" align="left" ><?  echo $unit_of_measurement[$row[("uom")]]; ?></td>
										<td width="100" align="right" title="<? echo $ex_rate;?>"><?  echo number_format($wo_amount,2); ?></td>
										
									<?
										}
										else
										{ ?>
											<td width="100" align="right"><? if ($cbo_category==25 || $cbo_category==12) echo number_format($row[("wo_qnty")],2); else echo number_format($row[("grey_fab_qnty")],2); ?></td>
									<?	}
								}
								if ($cbo_category==2)
								{
									?>
									<td width="80"><p><?=number_format($sample_qnt,2)?></p></td>
									<td width="80"><p>&nbsp; </p></td>
									<td width="80"><p><? echo $short_reason; ?></p></td>
									<?
								}
							?>
							<td width="80"><? echo $level_arr[$row[("cbo_level")]]; ?></td>
							<td width="">&nbsp;&nbsp;&nbsp;&nbsp;<? //echo $row[("po_number")]; ?></td>
						</tr>
						<?
						$tot_wo_qnty+=$row[("amount")];
						$tot_rec_amt+=$rec_amt;
						
						$tot_wo_currency_usd_amt+=$wo_currency_usd_amt;
						$tot_recv_usd_amt+=$recv_usd_amt;
						
						if ($cbo_category==25 || $cbo_category==12)//Embllishment
						{
							$tot_fin_fab_qnty+=$row[("wo_qnty")];
							$tot_grey_fab_qnty+=$row[("wo_qnty")];
							$tot_embl_wo_amount+=$wo_amount;
						}
						else
						{
							$tot_fin_fab_qnty+=$row[("fin_fab_qnty")];
							$tot_grey_fab_qnty+=$row[("grey_fab_qnty")];
							$tot_embl_wo_amount+=$wo_amount;
						}
						$i++;
					}
				}
				?>
				</table>
			</table>
				<table class="rpt_table" width="<? echo $tbl_width; ?>" cellpadding="0" cellspacing="0" border="1" rules="all">
					<tfoot>
						<th width="30">&nbsp;</th>    
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <?
                        if ($cbo_category==25)
						{
							?>
                            <th width="100">&nbsp;</th>
                            <?
						}?>
						<th width="70">&nbsp;</th>
						<?
						if ($cbo_category==3 || $cbo_category==2 || $cbo_category==25 || $cbo_category==4)
						{
							?>
							<th width="100">&nbsp;</th>
							<?
						}
						if ($cbo_category==4)
						{
							?>
							<th width="100">&nbsp;</th>
							<th width="100">&nbsp;</th>
							<th width="100">&nbsp;</th>
							<th width="100">&nbsp;</th>
							<?
						}
						if ($cbo_category==12)
						{
							?>
							<th width="100">&nbsp;</th>
							<th width="100">&nbsp;</th>
							<?
						}
						
						?>
						<th width="60">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="70">&nbsp;</th>

						<?
						if ($cbo_category==4)
						{
							?>
								<th width="100">&nbsp;</th>
                                <th width="100"><? echo number_format($tot_wo_currency_usd_amt,2); ?></th>
                                <th width="100">&nbsp;</th>
                                <th width="100"><? echo number_format($tot_recv_usd_amt,2); ?></th>
							<?
						}						
						else
						{						
							?>
								<th width="100"><? echo number_format($tot_fin_fab_qnty,2); ?></th>
								<?
								if ($cbo_category==25)
								{
									?>
			                        <th width="100">&nbsp;</th>
			                        <?
								}
								if ($cbo_category==3 || $cbo_category==25)
								{
									?>
			                        <th width="100"><? echo number_format($tot_embl_wo_amount,2); ?></th>
			                        <?
								}
								else
								{
									?>
									<th width="100"><? echo number_format($tot_grey_fab_qnty,2); ?></th>
									<?
								}
								?>
								
							<?
						}
						if($cbo_category==2)
					{
						?>
						<th width="80"><?=number_format($tot_sample,2);?></th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<?
					}
					?>
					<th width="80">&nbsp;</th>
					<th>&nbsp;</th>
					</tfoot>
				</table>
			</div>
            <br>
            <?
			
			if ($cbo_category==2)
			{
				?>
                <table class="rpt_table" width="600" cellpadding="0" cellspacing="0" border="1" rules="all">
                	<thead>
                    	<tr bgcolor="#CCCCCC">
                                <td colspan="6" align="center" style="font-size:16px; font-weight:bold;">Finish Fabric OTD Summary</td>
                            </tr>
                    	<tr>
                        	<th width="100">WO Type</th>
                            <th width="100">Required Qty.</th>
                            <th width="100">On Time Rcvd Qty</th>
                            <th width="100">Total Rcvd Qty</th>
                            <th width="100">Balance</th>
                            <th >OTD %</th>
                        </tr>
                    </thead>
                    <tbody>
                    	<?
						$wo_type_arr=array(1=>"Main",2=>"Short",3=>"Sample",4=>"Non Ord Sample");
						foreach($summer_data as $wo_type=>$val)
						{
							$balance=$val["book_qnty"]-$val["rcv_qnty"];
							$otd_percent=(($val["rcv_qnty_intime"]/$val["book_qnty"])*100);
							?>
                            <tr>
                                <td><? echo $wo_type_arr[$wo_type]; ?></td>
                                <td align="right"><? echo number_format($val["book_qnty"],2); $tot_book_qnty+=$val["book_qnty"]; ?></td>
                                <td align="right"><? echo number_format($val["rcv_qnty_intime"],2); $tot_rcv_qnty_intime+=$val["rcv_qnty_intime"];  ?></td>
                                <td align="right"><? echo number_format($val["rcv_qnty"],2); $tot_rcv_qnty+=$val["rcv_qnty"];  ?></td>
                                <td align="right"><? echo number_format($balance,2); $tot_balance+=$balance;  ?></td>
                                <td align="right"><? echo number_format($otd_percent,2); ?></td>
                            </tr>
                            <?
						}
						?>
                    </tbody>
                    <tfoot>
                    	<tr>
                        	<th>Total</th>
                            <th><? echo number_format($tot_book_qnty,2); ?></th>
                            <th><? echo number_format($tot_rcv_qnty_intime,2); ?></th>
                            <th><? echo number_format($tot_rcv_qnty,2); ?></th>
                            <th><? echo number_format($tot_balance,2); ?></th>
                            <th>&nbsp;</th>
                        </tr>
                    </tfoot>
                </table>
                <?
			}
			?>
		</fieldset>
		<?
	}
	else if ($cbo_category==24)// Service Yarn
	{
		if($db_type==0)
		{
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and YEAR(a.insert_date)=$year_id";
		}
		elseif($db_type==2)
		{ 
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(a.insert_date,'YYYY')=$year_id";
		}
		
		if ($cbo_company==0) $company_id=""; else $company_id=" and a.company_id in ($cbo_company)";
		if ($cbo_buyer==0) $supplier_cond=""; else $supplier_cond=" and a.supplier_id=$cbo_buyer";
		if ($cbo_category==0) $category_id=""; else $category_id=" and a.item_category=$cbo_category";
		if ($wo_no=="") $wo_no_cond=""; else $wo_no_cond=" and a.ydw_no='$wo_no'";
		
		if ($wo_type==2) $wo_type_cond=" and a.entry_form=41"; else if ($wo_type==4) $wo_type_cond=" and a.entry_form=42"; else $wo_type_cond="";
		
		if ($job_no=="") $job_num=""; else $job_num=" and b.job_no='$job_no'";
		//if ($job_no=="") $job_num_mst=""; else $job_num_mst=" and b.job_no_mst=$job_no";
		if ($po_no=='') $po_no_no=""; else $po_no_no=" and d.po_number in ($po_no)";
		if ($hidd_po=="") $po_id=""; else $po_id=" and d.id in ( $hidd_po )";
		
		if ($hidd_po=="") $po_id_cond=""; else $po_id_cond=" and b.po_break_down_id in ( $hidd_po )";
		
		if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and d.file_no='".trim($file_no)."' "; 
		if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and d.grouping='".trim($internal_ref)."' "; 
		//echo $file_no_cond.'=='.$internal_ref_cond;die;
		
		if($db_type==0)
		{
			if($txt_date_category==1) 
			{	
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".$date_from."' and '".$date_to."'";
			}
			else 
			{
				if($txt_date_category==2) if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".$date_from."' and '".$date_to."'";
			}
		}
		if($db_type==2)
		{
			if($txt_date_category==1) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
			else if($txt_date_category==2) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
		}
	
		
		$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
		$supplierArr=return_library_array( "select id,supplier_name from lib_supplier", "id", "supplier_name");	
		$buyerArr=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
		//$nonStyleArr=return_library_array( "select id, style_ref_no from sample_development_mst", "id", "style_ref_no");		
		
		/*$sql="select a.job_no,d.id as po_id from wo_po_details_master a, wo_po_break_down d where a.job_no=d.job_no_mst and a.status_active=1 and a.is_deleted=0 and d.status_active=1 and d.is_deleted=0 $internal_ref_cond  $file_no_cond  group by a.job_no,d.id";
		$sql_result=sql_select($sql);
		$po_id_data="";$k=0;
		foreach($sql_result as $row)
		{
			if($k==0)
			{
				$po_data_cond=$row[csf('po_id')];
				 $job_data_cond=$row[csf('job_no')];
			}
			else
			{
				 $po_data_cond.=",".$row[csf('po_id')];
				 $job_data_cond.=",".$row[csf('job_no')];
			} 
		} //echo $job_data_cond;
		if($file_no_cond!="" || $internal_ref!="")
		{  
		 $po_data_file_ref=" and b.po_break_down_id in($po_data_cond) "; 
		 $job_data_file_ref=" and b.job_no in('$job_data_cond') "; 
		}
		else
		{
			$po_data_file_ref="";
			$job_data_file_ref="";
		}*/
		
		

		//var_dump($job_array);
		
		ob_start();
		?>
		<fieldset style="width:2310px">
			<table width="2290"  cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none; font-size:18px;" colspan="21">
						<? echo $company_library[str_replace("'","",$cbo_company_id)]; ?>                                
					</td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:16px; font-weight:bold" colspan="20"> <? echo $report_title; if($cbo_category!=0) echo " For ".$item_category[$cbo_category]; ?></td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:12px; font-weight:bold"  colspan="20"> <? if( $date_from!="" && $date_to!="" ) echo "From ".change_date_format($date_from)." To ".change_date_format($date_to);?></td>
				</tr>
			</table>
            <table class="rpt_table" width="2190" cellpadding="0" cellspacing="0" border="1" rules="all">
				<thead>
					<th width="30">SL</th>    
					<th width="100">Comapny</th>
					<th width="60">Wo No</th>
					<th width="60">PI No</th>
					<th width="60">Wo Year</th>
					<th width="70">Wo Date</th>
					<th width="70">Deli. Date</th>
                    <th width="70">Lead Time</th>
					<th width="100">Wo Type</th>
					<th width="100">Ready To App.</th>
                    <th width="100">Ready To Approved<br> date and time</th>                    
					<th width="80">App. Status</th>
                    <th width="100">Last Approval <br>Date time and Person</th>
					<th width="100">Supplier</th>
					<th width="100">Buyer</th>
					<th width="110">Job No.</th>
					<th width="60">Job Year</th>
					<th width="100">Style Ref.</th>
					<th width="100">Inter. Ref.</th>
					<th width="100">File No.</th>
					<th width="100">Order No</th>
					<th width="80">Item Cate.</th>
					<th width="70">First Rec. Date</th>
                    <th width="100">Wo Qty</th>
                    <th width="100">W/O Value USD</th>
					<th >Remarks</th>
				</thead>
			</table>
			<div style="max-height:350px; overflow-y:scroll; width:2210px" id="scroll_body" >
				<table cellspacing="0" cellpadding="0" border="1" class="rpt_table"  width="2190" rules="all" id="table_body" >
				<?
				if ($cbo_company==0) $company_cond_id=""; else $company_cond_id=" and b.company_id in ($cbo_company)";
				if($cbo_category==24)
				{
					$sql="select a.id, a.ydw_no, min(b.receive_date) as receive_date from wo_yarn_dyeing_mst a,inv_receive_master b where a.ydw_no=b.booking_no and b.item_category=1  and b.receive_basis=2 and b.receive_purpose=2 $company_cond_id group by a.id, a.ydw_no";	
					$sql_result=sql_select($sql);
					foreach($sql_result as $row)
					{
						$first_rec_date[$row[csf("id")]]=$row[csf("receive_date")];
					}
				}

			$sql="Select a.company_id,a.id as booking_id,a.is_approved,a.ready_to_approved,a.is_short,a.update_date, a.entry_form, a.ydw_no,a.pay_mode, TO_CHAR(a.insert_date,'YYYY') as year_book, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.supplier_id, b.job_no,b.job_no_id, b.uom, sum(b.yarn_wo_qty) as wo_qnty,sum(b.amount) as amount, a.currency,b.fab_booking_no from wo_yarn_dyeing_mst a, wo_yarn_dyeing_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $supplier_cond and a.item_category_id=24 $job_num $booking_date_cond $wo_no_cond $wo_type_cond group by a.company_id,a.id,a.update_date,a.entry_form, a.ydw_no,a.pay_mode, a.insert_date, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.is_approved,a.supplier_id, b.job_no,b.job_no_id, b.uom, a.ready_to_approved,a.is_short,a.currency,b.fab_booking_no order by a.id Desc";
				
				//echo $sql; //die;
				//echo  $po_id ;die;
				$tot_wo_amount=0;
				$sql_result=sql_select($sql); $i=1;
				foreach ($sql_result as $row) 
				{
					$booking_id_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
					$job_id_arr[$row[csf("job_no_id")]]=$row[csf("job_no_id")];
				}
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 1, $job_id_arr, $empty_arr);//Job ID Ref from=1
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 2, $booking_id_arr, $empty_arr);//Book ID Ref from=2

				if($db_type==0)
				{
					$job_sql="select a.job_no_prefix_num, a.job_no, a.buyer_name, Year(a.insert_date) as year, a.style_ref_no, a.garments_nature, 
					group_concat(b.id) as id,
					group_concat(b.po_number) as po_number,
					group_concat(b.file_no) as file_no,
					group_concat(b.grouping) as grouping,
					max(b.pub_shipment_date) as max_ship_date,
					min(b.pub_shipment_date) as min_ship_date
					from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.job_no_prefix_num, a.job_no, a.buyer_name, a.insert_date, a.style_ref_no, a.garments_nature";
				}
				elseif($db_type==2)
				{
					$job_sql="select a.job_no_prefix_num, a.job_no, a.buyer_name, TO_CHAR(a.insert_date,'YYYY') as year, a.style_ref_no, a.garments_nature, 
					 b.id as id,
					 b.po_number as po_number,
				 	b.file_no as file_no,
					 b.grouping as grouping,
					(b.pub_shipment_date) as max_ship_date,
					(b.pub_shipment_date) as min_ship_date
					from wo_po_details_master a, wo_po_break_down b,gbl_temp_engine g where a.id=b.job_id and  b.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 ";
				}
				
				$job_sql_result=sql_select($job_sql);
				foreach($job_sql_result as $row)
				{
					$order_no=$row[csf("po_number")];//implode(",",array_unique(explode(",",$row[csf("po_number")])));
					$order_id=$row[csf("id")];//implode(",",array_unique(explode(",",$row[csf("id")])));
					$file_no=$row[csf("file_no")];//implode(",",array_unique(explode(",",$row[csf("file_no")])));
					$int_ref=$row[csf("grouping")];//implode(",",array_unique(explode(",",$row[csf("grouping")])));
			
					$job_array[$row[csf("job_no")]]['job']=$row[csf("job_no_prefix_num")];
					$job_array[$row[csf("job_no")]]['job_no']=$row[csf("job_no")];
					$job_array[$row[csf("job_no")]]['buyer']=$row[csf("buyer_name")];
					$job_array[$row[csf("job_no")]]['year']=$row[csf("year")];
					$job_array[$row[csf("job_no")]]['style_ref_no']=$row[csf("style_ref_no")];
					$job_array[$row[csf("job_no")]]['garments_nature']=$row[csf("garments_nature")];
					$job_array[$row[csf("job_no")]]['max_ship_date'].=$row[csf("max_ship_date")].',';
					$job_array[$row[csf("job_no")]]['min_ship_date'].=$row[csf("min_ship_date")].',';
					$job_array[$row[csf("job_no")]]['id'].=$order_id.',';
					$job_array[$row[csf("job_no")]]['po_number'].=$order_no.',';
					$job_array[$row[csf("job_no")]]['file'].=$file_no.',';
					$job_array[$row[csf("job_no")]]['ref'].=$int_ref.',';
				}
				
					$emb_item_array=array();
						
					$emb_sql="select a.emb_name, b.item_number_id, c.job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b, wo_po_break_down c,gbl_temp_engine g where a.job_id=b.job_id and c.id=b.po_break_down_id and  b.job_id=g.ref_val and  c.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
					$emb_sql_result=sql_select($emb_sql);
					foreach($emb_sql_result as $row)
					{
						$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
						$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
					}
					$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id and  b.work_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0
					and a.item_category_id=24 and a.pi_basis_id=1 
					group by  a.id,a.pi_number, b.work_order_no order by a.pi_number desc";
					$pi_sql_result=sql_select($pi_sql);
					$pi_no_arr = array();
					foreach ($pi_sql_result as $value) 
					{
						$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
						$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];
					}
					unset($pi_sql_result);
						
				
				 $wo_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_yarn_dyeing_mst a, approval_history b,gbl_temp_engine g where a.id=b.mst_id and  a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(30) ".where_con_using_array($booking_id_arr,0,'a.id')." order by b.id desc";
				$wo_his_sql_result=sql_select($wo_his_sql);
				//$pi_no_arr = array();
				$user_arr=return_library_array( "select id, user_name from user_passwd", 'id', 'user_name' );	
				foreach ($wo_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_his_sql_result);
				
				/*$wo_non_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_non_ord_samp_booking_mst a, approval_history b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(8,7,32) ".where_con_using_array($booking_id_arr,0,'a.id')." order by b.id desc";
				$wo_non_his_sql_result=sql_select($wo_non_his_sql);
				//$pi_no_arr = array();
			 
				foreach ($wo_non_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_non_his_sql_result);*/

				$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id and  b.work_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0
				and a.item_category_id=24 and a.pi_basis_id=1";
				$pi_sql_result=sql_select($pi_sql);
				$pi_no_arr = array();
				foreach ($pi_sql_result as $value) 
				{
					$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
					$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];
				}
				unset($pi_sql_result);
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				
				foreach($sql_result as $row)
				{
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					if ($row[csf("entry_form")]==41) $wo_type="Order";
					else if ($row[csf("entry_form")]==42) $wo_type="Non Order";
					$job_number=implode(",",array_unique(explode(",",$row[csf("job_no")])));
					$supplier_name="";
					if($row[csf("pay_mode")]==3 || $row[csf("pay_mode")]==5)
					{
						$supplier_name=$company_library[$row[csf("supplier_id")]];
					}
					else $supplier_name=$supplierArr[$row[csf("supplier_id")]];

					$cid=2;
					if($row[csf('currency')]==2)
					{
						$cid=1;
					}
					if($row[csf('ready_to_approved')]==1) //ready
					{
						$last_update_date=$row[csf('update_date')];
					}
					
					$ex_rate=set_conversion_rate($cid, $row[csf("booking_date")],$cbo_company);
					$wo_amount=$row[csf("amount")]/$ex_rate;

					if($cbo_company!=0) $cbo_company_cond="and template_name in ($cbo_company)";else $cbo_company_cond="";
					$Yarn_Service_Work_order=return_field_value("format_id"," lib_report_template"," module_id=2 and report_id=14 and is_deleted=0 and status_active=1 $cbo_company_cond");
					$yswreportArr= explode(',',$Yarn_Service_Work_order);
					$yswreport=$yswreportArr[0];

					if($yswreport==79){$reporAction="show_trim_booking_report";}//Yarn Service With Order
					else if($yswreport==80){$reporAction="show_without_rate_booking_report";}//Yarn Service With Order
					else if($yswreport==867){$reporAction="sales_order_report";}//Yarn Service With Order
					else if($yswreport==868){$reporAction="sales_order_report_two";}//Yarn Service With Order

					$variable="<a  href='##'  onClick=\"generate_fabric_report('".$row[csf("entry_form")]."','".$row[csf("ydw_no")]."','".$row[csf("company_id")]."','".$row[csf("booking_id")]."','".$cbo_category."','','','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','','','".$reporAction."','".$i."')\">".$row[csf("yarn_dyeing_prefix_num")]."  <a/>";
						
					?>
					<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
						<td width="30"><? echo $i;?></td>
						<td width="100" align="center"><p><? echo $company_library[$row[csf("company_id")]]; ?></td>
						<td width="60" align="center"><? echo $variable; ?></td>	<!--<a href='#report_details' onClick="generate_fabric_report('<? //echo $row[csf("entry_form")]; ?>','<? //echo $row[csf("ydw_no")]; ?>','<? //echo $cbo_company; ?>','<? //echo $row[csf("job_no")]; ?>','<? //echo "24"; ?>','<? //echo $cbo_category; ?>');"></a>-->
						<td width="60" align="center"><p><? echo $pi_no_arr[$row[csf("ydw_no")]]['pi_no']; ?></td>
						<td width="60" align="center"><p><? echo $row[csf("year_book")]; ?></td>
						<td width="70"><p style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("booking_date")], "", "",0); ?></p></td>
						<td width="70"><p style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("delivery_date")]); ?></p></td>
                        
                        <td width="70"><p style="word-wrap:break-word; width:70px">
						<? 
						$lead_time=0;
						if($row[csf("delivery_date")]!="" && $row[csf("delivery_date")]!="0000-00-00")
						{
							$lead_time=datediff("d", $row[csf("booking_date")], $row[csf("delivery_date")]);
						}
						if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day"; 
						?></p></td>
                        
						<td width="100"><p><? echo $wo_type;?></p></td>
						<td width="100" align="center"><? echo $yes_no[$row[csf("ready_to_approved")]]; ?></td>
                         <td width="100" align="center"><? $last_update_dateArr=explode(" ",$last_update_date);echo change_date_format($last_update_dateArr[0]).'<br>'.$last_update_dateArr[1]; ?></td>
						<td width="80"><p><? echo $approval_type_arr[$row[csf("is_approved")]]; ?></p></td>
                         <?
							//if ($cbo_category==4)
							//{
								$approved_date=$last_app_arr[$row[csf("booking_id")]]['approved_date'];
								$approved_by=$last_app_arr[$row[csf("booking_id")]]['approved_by'];
								?>
                         <td width="100" title="bookingId=<? echo $row[csf("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                             
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $supplier_name; ?></p></td>
						<td width="100"><p><? echo $buyerArr[$job_array[$job_number]['buyer']]; ?></p></td>
						<td width="110"><p style="word-wrap:break-word; width:110px"><? echo $row[csf("job_no")];//$row[csf("job_no_prefix_num")]; ?></p></td>
						<td width="60"><? echo $job_array[$job_number]['year']; ?></td>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $job_array[$job_number]['style_ref_no']; ?></p></td>
						<?
						$ref_all=rtrim($job_array[$job_number]['ref'],',');
						$ref_all=implode(", ",array_unique(explode(",",$ref_all)));
						$file_all=rtrim($job_array[$job_number]['file'],',');
						$file_all=implode(", ",array_unique(explode(",",$file_all)));
						$po_all=rtrim($job_array[$job_number]['po_number'],',');
						$po_all=implode(", ",array_unique(explode(",",$po_all)));
						?>

						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $ref_all; ?></p></td>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $file_all; ?></p></td>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $po_all; ?></p></td>
						<td width="80"><p style="word-wrap:break-word; width:80px"><? echo $item_category[24]; ?></p></td>
						<td width="70" align="center"><p><? echo change_date_format($first_rec_date[$row[csf("booking_id")]]); ?></p></td>
						<td width="100" align="right"><? echo number_format($row[csf("wo_qnty")],2); ?></td>
						<td width="100" align="right"><? echo number_format($wo_amount,2); ?></td>
						<td>&nbsp; </td>
					</tr>
					<?
					$tot_wo_qnty+=$row[csf("wo_qnty")];
					$tot_wo_amount+=$wo_amount;
					$i++;
				}
				?>
				</table>
				<table class="rpt_table" width="2190" cellpadding="0" cellspacing="0" border="1" rules="all">
					<tfoot>
						<th width="30">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="70">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="110">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="80">Total</th>
						<th width="70">&nbsp;</th>
                        <th width="100" align="right" id="tot_fin_fab_qnty"><? echo number_format($tot_wo_qnty,2); ?></th>
                        <th width="100" align="right" id="tot_wo_amount"><? echo number_format($tot_wo_amount,2); ?></th>
						<th>&nbsp;</th>
					</tfoot>
				</table>
			</div>
		</fieldset>
		<?
	}
	
	else if ($cbo_category==31)//31=Services Lab Test
	{
		if($db_type==0)
		{
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and YEAR(a.insert_date)=$year_id";
		}
		elseif($db_type==2)
		{ 
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(a.insert_date,'YYYY')=$year_id";
		}
		
		if ($cbo_company==0) $company_id=""; else $company_id=" and a.company_id in ($cbo_company)";
		if ($wo_no=="") $wo_no_cond=""; else $wo_no_cond=" and a.labtest_no like '%$wo_no'";
		if ($job_no=="") $job_num=""; else $job_num=" and b.job_no='$job_no'";
		if ($hidd_po=='') $po_no_no=""; else $po_no_no=" and c.order_id in ($hidd_po)";
		
		
		if ($cbo_buyer==0) $supplier_cond=""; else $supplier_cond=" and a.supplier_id=$cbo_buyer";
		if ($cbo_category==0) $category_id=""; else $category_id=" and a.item_category=$cbo_category";
		if ($wo_type==2) $wo_type_cond=" and a.entry_form=41"; else if ($wo_type==4) $wo_type_cond=" and a.entry_form=42"; else $wo_type_cond="";
		
		//if ($job_no=="") $job_num_mst=""; else $job_num_mst=" and b.job_no_mst=$job_no";
		if ($hidd_po=="") $po_id=""; else $po_id=" and d.id in ( $hidd_po )";
		
		if ($hidd_po=="") $po_id_cond=""; else $po_id_cond=" and b.po_break_down_id in ( $hidd_po )";
		
		if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and d.file_no='".trim($file_no)."' "; 
		if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and d.grouping='".trim($internal_ref)."' "; 
		//echo $file_no_cond.'=='.$internal_ref_cond;die;
		
		if($db_type==0)
		{
			if($txt_date_category==1) 
			{	
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.wo_date between '".$date_from."' and '".$date_to."'";
			}
			else 
			{
				if($txt_date_category==2) if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".$date_from."' and '".$date_to."'";
			}
		}
		if($db_type==2)
		{
			if($txt_date_category==1) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.wo_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
			else if($txt_date_category==2) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
		}
	
	
		$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
		$supplierArr=return_library_array( "select id,supplier_name from lib_supplier", "id", "supplier_name");	
		$buyerArr=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
		//$nonStyleArr=return_library_array( "select id, style_ref_no from sample_development_mst", "id", "style_ref_no");		
		
		/*$sql="select a.job_no,d.id as po_id from wo_po_details_master a, wo_po_break_down d where a.job_no=d.job_no_mst and a.status_active=1 and a.is_deleted=0 and d.status_active=1 and d.is_deleted=0 $internal_ref_cond  $file_no_cond  group by a.job_no,d.id";
		$sql_result=sql_select($sql);
		$po_id_data="";$k=0;
		foreach($sql_result as $row)
		{
			if($k==0)
			{
				$po_data_cond=$row[csf('po_id')];
				 $job_data_cond=$row[csf('job_no')];
			}
			else
			{
				 $po_data_cond.=",".$row[csf('po_id')];
				 $job_data_cond.=",".$row[csf('job_no')];
			} 
		} //echo $job_data_cond;
		
		
		if($file_no_cond!="" || $internal_ref!="")
		{  
		 $po_data_file_ref=" and c.po_break_down_id in($po_data_cond) "; 
		 $job_data_file_ref=" and b.job_no in('$job_data_cond') "; 
		}
		else
		{
			$po_data_file_ref="";
			$job_data_file_ref="";
		}*/
		
	
		
		
		
	
		//============================start==============issue-23079========12-10-2021=============================================
		// $emb_item_array=array();		
		// $emb_sql="select a.emb_name, b.item_number_id, c.job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b, wo_po_break_down c where a.job_no=b.job_no_mst and c.id=b.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
		// $emb_sql_result=sql_select($emb_sql);
		// foreach($emb_sql_result as $row)
		// {
		// 	$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
		// 	$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
		// }
		//var_dump($job_array);
		//===========================end==============issue-23079========12-10-2021==============================================






		ob_start();
		?>
		<fieldset style="width:2410px">
			<table width="2490"  cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none; font-size:18px;" colspan="21">
						<? echo $company_library[str_replace("'","",$cbo_company_id)]; ?>                                
					</td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:16px; font-weight:bold" colspan="20"> <? echo $report_title; if($cbo_category!=0) echo " For ".$item_category[$cbo_category]; ?></td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:12px; font-weight:bold"  colspan="20"> <? if( $date_from!="" && $date_to!="" ) echo "From ".change_date_format($date_from)." To ".change_date_format($date_to);?></td>
				</tr>
			</table>
            <table class="rpt_table" width="2490" cellpadding="0" cellspacing="0" border="1" rules="all">
				<thead>
					<th width="30">SL</th>    
					<th width="100">Company</th>
					<th width="60">Wo No</th>
					<th width="60">PI No</th>
					<th width="60">Wo Year</th>
					<th width="70">Wo Date</th>
					<th width="70">Deli. Date</th>
                    <th width="70">Lead Time</th>
					<th width="100">Wo Type</th>
					<th width="100">Ready To App.</th>
				    <th width="100">Ready To Approved<br> date and time</th>
					<th width="80">App. Status</th>
                    <th width="100">Last Approval <br>Date time and Person</th>
					<th width="100">Supplier</th>
					<th width="100">Buyer</th>
					<th width="110">Job No.</th>
					<th width="60">Job Year</th>
					<th width="100">Style Ref.</th>
					<th width="100">Inter. Ref.</th>
					<th width="100">File No.</th>
					<th width="100">Order No</th>
					<th width="80">Item Cate.</th>
					<th width="70">First Rec. Date</th>
					<th width="100">Required Value</th>
                    <th width="100">WO value</th>
					<th width="100">WO value(USD)</th>
					<th width="100">Balance (USD)</th>
					<th>Remarks</th>
				</thead>
			</table>
			<div style="max-height:350px; overflow-y:scroll; width:2510px" id="scroll_body" >
				<table cellspacing="0" cellpadding="0" border="1" class="rpt_table"  width="2490" rules="all" id="table_body" >
				<?
				if ($cbo_company==0) $company_cond_id=""; else $company_cond_id=" and b.company_id in($cbo_company)";
				
				if($db_type==0)
				{	
					$sql="Select a.company_id,a.currency,a.id as booking_id, a.entry_form,a.pay_mode, Year(a.insert_date) as year_book, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id,a.ready_to_approved, b.job_no, sum(b.wo_value) as wo_value,b.po_id,c.order_qty,a.currency,a.ecchange_rate from wo_labtest_mst a, wo_labtest_dtls b,wo_labtest_order_dtls c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $supplier_cond $job_num $booking_date_cond $wo_no_cond $wo_type_cond $po_no_no group by a.id,a.company_id, a.entry_form, a.insert_date,a.pay_mode, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id,a.ready_to_approved, b.job_no,b.po_id,c.order_qty,a.currency,a.ecchange_rate  order by  b.job_no ASC";
				}
				else if ($db_type==2)
				{
					$sql="Select a.company_id,max(a.currency) as currency, a.id as booking_id, a.entry_form,a.pay_mode, TO_CHAR(a.insert_date,'YYYY') as year_book, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id, a.ready_to_approved, b.job_no, sum(c.wo_value) as wo_value,b.po_id,c.order_qty,a.currency,a.ecchange_rate from wo_labtest_mst a, wo_labtest_dtls b,wo_labtest_order_dtls c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $job_num $booking_date_cond $wo_no_cond $wo_type_cond $po_no_no group by a.id,a.company_id, a.entry_form,a.pay_mode, a.insert_date, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id,a.ready_to_approved,  b.job_no,b.po_id,c.order_qty,a.currency,a.ecchange_rate  order by  b.job_no ASC";
				}
				
				
	

				  
				   // echo $sql;die;
				//echo  $po_id ;die;
				$sql_result=sql_select($sql); $i=1;
				$job_no=array();
				foreach ($sql_result as $row) 
				{
					$booking_id_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
					$po_arr[$row[csf("po_id")]]=$row[csf("po_id")];
					$job_no[$row[csf("job_no")]]=$row[csf("job_no")];
					 $job_wise_data[$row[csf("job_no")]][]=$row;
				}

				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 1, $job_id_arr, $empty_arr);//Job ID Ref from=1
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 2, $booking_id_arr, $empty_arr);//Book ID Ref from=2
			 	fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 3, $po_arr, $empty_arr);//PO ID Ref from=3

				 if($cbo_category==24)
				 {
					 $sql="select a.id, a.ydw_no, min(b.receive_date) as receive_date from wo_yarn_dyeing_mst a,inv_receive_master b,gbl_temp_engine g where a.ydw_no=b.booking_no  a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and b.item_category=1  and b.receive_basis=2 and b.receive_purpose=2 $company_cond_id group by a.id, a.ydw_no";	
					 $sql_result=sql_select($sql);
					 foreach($sql_result as $row)
					 {
						 $first_rec_date[$row[csf("id")]]=$row[csf("receive_date")];
					 }
				 }

				
				if($db_type==0)
				{
					$job_sql="select a.job_no_prefix_num, a.job_no, a.buyer_name, Year(a.insert_date) as year, a.style_ref_no, a.garments_nature, 
					group_concat(b.id) as id,
					group_concat(b.po_number) as po_number,
					group_concat(b.file_no) as file_no,
					group_concat(b.grouping) as grouping,
					max(b.pub_shipment_date) as max_ship_date,
					min(b.pub_shipment_date) as min_ship_date
					from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.job_no_prefix_num, a.job_no, a.buyer_name, a.insert_date, a.style_ref_no, a.garments_nature";
				}
				elseif($db_type==2)
				{
					$job_sql="select a.job_no_prefix_num, a.job_no, a.buyer_name, TO_CHAR(a.insert_date,'YYYY') as year, a.style_ref_no, a.garments_nature, b.po_quantity,
					b.id as id,
					b.po_number as po_number,
					b.file_no as file_no,
					b.grouping as grouping,
					(b.pub_shipment_date) as max_ship_date,
					(b.pub_shipment_date) as min_ship_date

					from wo_po_details_master a, wo_po_break_down b,gbl_temp_engine g where a.id=b.job_id and a.id=g.ref_val  and b.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
				}
			
				$job_sql_result=sql_select($job_sql);
				
				foreach($job_sql_result as $row)
				{
					$order_no=$row[csf("po_number")];//implode(",",array_unique(explode(",",$row[csf("po_number")])));
					$order_id=$row[csf("id")];//implode(",",array_unique(explode(",",$row[csf("id")])));
					$file_no=$row[csf("file_no")];//implode(",",array_unique(explode(",",$row[csf("file_no")])));
					$int_ref=$row[csf("grouping")];//implode(",",array_unique(explode(",",$row[csf("grouping")])));
			
					$job_array[$row[csf("job_no")]]['job']=$row[csf("job_no_prefix_num")];
					$job_array[$row[csf("job_no")]]['job_no']=$row[csf("job_no")];
					$job_array[$row[csf("job_no")]]['buyer']=$row[csf("buyer_name")];
					$job_array[$row[csf("job_no")]]['year']=$row[csf("year")];
					$job_array[$row[csf("job_no")]]['style_ref_no']=$row[csf("style_ref_no")];
					$job_array[$row[csf("job_no")]]['garments_nature']=$row[csf("garments_nature")];
					$job_array[$row[csf("job_no")]]['max_ship_date'].=$row[csf("max_ship_date")].',';
					$job_array[$row[csf("job_no")]]['min_ship_date'].=$row[csf("min_ship_date")].',';
					$job_array[$row[csf("job_no")]]['id'].=$order_id.',';
					$job_array[$row[csf("job_no")]]['po_number'].=$order_no.',';
					$job_array[$row[csf("job_no")]]['file'].=$file_no.',';
					$job_array[$row[csf("job_no")]]['ref'].=$int_ref.',';

					$job_qty_arr[$row[csf("job_no")]]['job_qty']+=$row[csf("po_quantity")];
				}
				
			    //   echo "<pre>";
				//   print_r($job_wise_data);
				//===================================================================================================
				$emb_item_array=array();		
				$emb_sql="select a.emb_name, b.item_number_id, a.job_no as job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b,gbl_temp_engine g  where a.job_id=b.job_id  and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  ";
				$emb_sql_result=sql_select($emb_sql);
				foreach($emb_sql_result as $row)
				{
					$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
					$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];


				}


				//===================================================================================================

				$lab_test_sql="select b.id,b.job_no,b.costing_per_id,b.lab_test,b.lab_test_percent,b.inspection,b.inspection_percent,b.cm_cost,b.cm_cost_percent from wo_pre_cost_dtls b,gbl_temp_engine g where  b.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and b.status_active=1 and b.is_deleted=0  ";

				//echo $lab_test_sql;
				$lab_test_data=sql_select($lab_test_sql);
				foreach($lab_test_data as $row){

						$lab_test[$row[csf("job_no")]]['lab_test']=$row[csf("lab_test")];
				}

				//=============================================job_qty======================================================

				/*$job_qty_sql="select id,job_no,job_quantity from wo_po_details_master where  status_active=1 and is_deleted=0 ".where_con_using_array($job_no,1,'job_no')." ";

				//echo $lab_test_sql;
				$job_qty_data=sql_select($job_qty_sql);
				foreach($job_qty_data as $row){

						$job_qty_arr[$row[csf("job_no")]]['job_qty']=$row[csf("job_quantity")];
				} */

				// echo "<pre>";
				// print_r($lab_test);


				$wo_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_labtest_mst a, approval_history b,gbl_temp_engine g where a.id=b.mst_id and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(42)   order by b.id desc";
				$wo_his_sql_result=sql_select($wo_his_sql);
				//$pi_no_arr = array();
				$user_arr=return_library_array( "select id, user_name from user_passwd", 'id', 'user_name' );	
				foreach ($wo_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_his_sql_result);
				$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id and b.work_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0
				and a.item_category_id=31 and a.pi_basis_id=1 ";
				$pi_sql_result=sql_select($pi_sql);
				$pi_no_arr = array();
				foreach ($pi_sql_result as $value) 
				{
					$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
					$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];
				}
				unset($pi_sql_result);
				// $job_wise_data
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				foreach($job_wise_data as $job_id => $job_data)
				{
					foreach($job_data as $row)
				   {
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					if ($row[csf("entry_form")]==41 || $row[csf("entry_form")]==79) $wo_type="Order";
					else if ($row[csf("entry_form")]==42) $wo_type="Non Order";
					$job_number=implode(",",array_unique(explode(",",$row[csf("job_no")])));
					$cbo_company=$row[csf("company_id")];
					
					
						//function generate_fabric_report(type,booking_no,company_id,order_id,fabric_nature,fabric_source,job_no,approved,category,is_short,emb_name,item_number_id,action_type,i,supplier_id)
					
						 
					 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('','".$row[csf("booking_id")]."','".$cbo_company."','".$row[csf("currency")]."','".$cbo_category."','".change_date_format($row[csf("wo_date")])."','','','".$cbo_category."','','','','show_trim_booking_report','')\">".$row[csf("labtest_prefix_num")]." </a>";	     					
					$supplier_name="";
					if($row[csf("pay_mode")]==3 || $row[csf("pay_mode")]==5)
					{
						$supplier_name=$company_library[$row[csf("supplier_id")]];
					}
					else $supplier_name=$supplierArr[$row[csf("supplier_id")]];
					if($row[csf('ready_to_approved')]==1) //ready
					{
						$last_update_date=$row[csf('update_date')];
					}
					


					$usd_id=2;
					if($db_type==0) $conversion_date=change_date_format($row[csf("wo_date")], "Y-m-d", "-",1);
					else $conversion_date=change_date_format($row[csf("wo_date")], "d-M-y", "-",1);
					$currency_rate=set_conversion_rate($usd_id,$conversion_date );
					if($row[csf("currency")]==2) $wo_currency_usd_amt=$row[csf("wo_value")];//USD
					else $wo_currency_usd_amt=$row[csf("wo_value")]/$currency_rate;

					$req_value=($job_qty_arr[$row[csf("job_no")]]['job_qty']/12)*$lab_test[$row[csf("job_no")]]['lab_test'];
					
					// $wo_currency_usd_amt=$row[csf("wo_value")]/$row[csf("ecchange_rate")];
					?>
					<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
						<td width="30"><? echo $i;?></td>
						<td width="100" align="center"><p><? echo $company_library[$row[csf("company_id")]]; ?></td>
						<td width="60" align="center"><? echo $variable; ?></td>
						<td width="60" align="center"><p><? echo $pi_no_arr[$row[csf("booking_id")]]['pi_no']; ?></td>
						<td width="60" align="center"><p><? echo $row[csf("year_book")]; ?></td>					
						<td width="70"><div style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("wo_date")], "", "",0); ?></div></td>
						<td width="70"><div style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("delivery_date")]); ?></div></td>
                        <td width="70"><div style="word-wrap:break-word; width:70px">
						<? 
						$lead_time=0;
						if($row[csf("delivery_date")]!="" && $row[csf("delivery_date")]!="0000-00-00")
						{
							$lead_time=datediff("d", $row[csf("wo_date")], $row[csf("delivery_date")]);
						}
						if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day"; 
						?></div></td>
						<td width="100"><?=$wo_type; ?></td>
						<td width="100" align="center"><? echo $yes_no[$row[csf("ready_to_approved")]]; ?></td>
                        <td width="100" align="center"><? $last_update_dateArr=explode(" ",$last_update_date);echo change_date_format($last_update_dateArr[0]).'<br>'.$last_update_dateArr[1]; ?></td>
                        
						<td width="80"><p><? echo $approval_type_arr[$row[csf("is_approved")]]; ?></p></td>
                        <?
                       	 $approved_date=$last_app_arr[$row[("booking_id")]]['approved_date'];
						 $approved_by=$last_app_arr[$row[("booking_id")]]['approved_by'];
						?>
                         <td width="100" title="bookingId=<? echo $row[("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                         
                         
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $supplier_name; ?></div></td>
						<td width="100"><p><? echo $buyerArr[$job_array[$job_number]['buyer']]; ?></p></td>
						<td width="110"><div style="word-wrap:break-word; width:110px"><? echo $row[csf("job_no")];//$row[csf("job_no_prefix_num")]; ?></div></td>
						<td width="60"><? echo $job_array[$job_number]['year']; ?></td>
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $job_array[$job_number]['style_ref_no']; ?></div></td>
						<?
						$ref_all=rtrim($job_array[$job_number]['ref'],',');
						$ref_all=implode(", ",array_unique(explode(",",$ref_all)));
						$file_all=rtrim($job_array[$job_number]['file'],',');
						$file_all=implode(", ",array_unique(explode(",",$file_all)));
						$po_alls=rtrim($job_array[$job_number]['po_number'],',');
						$po_all=implode(", ",array_unique(explode(",",$po_alls)));
						?>
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $ref_all; ?></div></td>
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $file_all; ?></div></td>
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $po_all; ?></div></td>
						<td width="80"><div style="word-wrap:break-word; width:80px"><? echo $item_category[31]; ?></div></td>
						<td width="70" align="center"><p><? echo change_date_format($first_rec_date[$row[csf("booking_id")]]); ?></p></td>
						<? if(isset($balanced_usd_arr[$row[csf("job_no")]]) && $balanced_usd_arr[$row[csf("job_no")]]>0){
								$blance_usd=$balanced_usd_arr[$row[csf("job_no")]];
							}
							else{
								$blance_usd=($job_qty_arr[$row[csf("job_no")]]['job_qty']/12)*$lab_test[$row[csf("job_no")]]['lab_test'];
								} 
							?>
						<td width="100" align="right" title="<?="(".$job_qty_arr[$row[csf("job_no")]]['job_qty']."/12)*".$lab_test[$row[csf("job_no")]]['lab_test'];?>"><? echo number_format($blance_usd,2); ?></td>
						<td width="100" align="right"><? echo number_format($row[csf("wo_value")],2); ?></td>
						<td width="100" align="right" title="<?=$row[csf("wo_value")]."/".$currency_rate;?>"><? echo number_format($wo_currency_usd_amt,2); ?></td>
						<? 
						$balanced_usd_arr[$row[csf("job_no")]] = $blance_usd-$wo_currency_usd_amt;
						?>
						<td width="100" align="right" title="<?=$req_value."-".$wo_currency_usd_amt;?>"><? echo number_format($blance_usd-$wo_currency_usd_amt,2); ?></td>
						<td></td>
					</tr>
					<?
					$tot_req_qnty+=($job_qty_arr[$row[csf("job_no")]]['job_qty']/12)*$lab_test[$row[csf("job_no")]]['lab_test'];
					$tot_wo_qnty+=$row[csf("wo_value")];
					//$tot_bal_qnty+=$req_value-$wo_currency_usd_amt;
					$tot_bal_qnty=$balanced_usd_arr[$row[csf("job_no")]];
					$tot_wo_currency_usd_amt+=$wo_currency_usd_amt;
					

					$job_tot_req_qnty+=($job_qty_arr[$row[csf("job_no")]]['job_qty']/12)*$lab_test[$row[csf("job_no")]]['lab_test'];
					$job_tot_wo_qnty+=$row[csf("wo_value")];
					//$tot_bal_qnty+=$req_value-$wo_currency_usd_amt;
					$job_tot_bal_qnty=$balanced_usd_arr[$row[csf("job_no")]];
					$job_tot_wo_currency_usd_amt+=$wo_currency_usd_amt;
					$tot_balance_usd+=$blance_usd-$wo_currency_usd_amt;
					$job_tot_balance_usd+=$blance_usd-$wo_currency_usd_amt;
					$i++;
				}?>
				
					<tr style="background-color:LightGray">
						<td width="30">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="60">&nbsp;</td>
						<td width="60">&nbsp;</td>
						<td width="60">&nbsp;</td>
						<td width="70">&nbsp;</td>
                        <td width="70">&nbsp;</td>
						<td width="70">&nbsp;</td>
						<td width="100">&nbsp;</td>
                        <td width="100">&nbsp;</td>
						<td width="100">&nbsp;</td>
                        <td width="80">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="110">&nbsp;</td>
						<td width="60">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="100"><b>Total</b></td>
						<td width="80">&nbsp;</td>
						<td width="70">&nbsp;</td>
                        <td width="100" align="right" ><b><? //echo number_format($tot_req_qnty,2); ?></b></td>
						<td width="100" align="right" ><b><? echo number_format($job_tot_wo_qnty,2); ?></b></td>
						<td width="100" align="right"  ><b><? echo number_format($job_tot_wo_currency_usd_amt,2); ?></b></td>
						<td width="100" align="right" ><b><? echo number_format($job_tot_balance_usd,2); ?></b></td>
						<td>&nbsp;</td>
		        	</tr>
					<?
					$job_tot_req_qnty=0;$job_tot_wo_qnty=0;$job_tot_bal_qnty=0;$job_tot_wo_currency_usd_amt=0;$job_tot_balance_usd=0;
			}

				?>
				</table>
				<table class="rpt_table" width="2490" cellpadding="0" cellspacing="0" border="1" rules="all">
					<tfoot>
						<th width="30">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="70">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="110">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="100">Total</th>
						<th width="80">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="100" align="right" id="value_tot_req_qnty"><? //echo number_format($tot_req_qnty,2); ?></th>
						<th width="100" align="right" id="value_tot_fin_fab_qnty"><? echo number_format($tot_wo_qnty,2); ?></th>
						<th width="100" align="right"  id="usd_tot_fin_fab_qnty"><? echo number_format($tot_wo_currency_usd_amt,2); ?></th>
						<th width="100" align="right"  id="usd_tot_bal_qnty"><? echo number_format($tot_balance_usd,2); ?></th>
						<th>&nbsp;</th>
					</tfoot>
				</table>
			</div>
		</fieldset>
		<?
	}

	$html = ob_get_contents();
    ob_clean();
    //$new_link=create_delete_report_file( $html, 2, $delete, "../../../" );
    foreach (glob("*.xls") as $filename) {
    //if( @filemtime($filename) < (time()-$seconds_old) )
    @unlink($filename);
    }
    //---------end------------//
    $name=time();
    $filename=$user_id."_".$name.".xls";
    $create_new_doc = fopen($filename, 'w');	
    $is_created = fwrite($create_new_doc, $html);
    echo "$html**$filename"; 
	exit();
}


if ($action=="report_generate4")
{
	//extract($_REQUEST);
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	$cbo_company=str_replace("'","",$cbo_company_id);
	$cbo_buyer=str_replace("'","",$cbo_buyer_id);
	$cbo_category=str_replace("'","",$cbo_category_id);
	$wo_type=str_replace("'","",$cbo_wo_type);
	$year_id=str_replace("'","",$cbo_year_id);
	$job_year_id=str_replace("'","",$cbo_job_year_id);
	$wo_no=str_replace("'","",$txt_wo_no);
	$wo_id=str_replace("'","",$hidd_wo_id);
	$cbo_season_id=str_replace("'","",$cbo_season_id);
	
	$job_no=str_replace("'","",$txt_job_no);
	$hidd_job=str_replace("'","",$hidd_job_id);
	$po_no=str_replace("'","",$txt_po_no);
	$hidd_po=str_replace("'","",$hidd_po_id);
	$date_from=str_replace("'","",$txt_date_from);
	$date_to=str_replace("'","",$txt_date_to);
	$file_no=str_replace("'","",$txt_file_no);
	$internal_ref=str_replace("'","",$txt_internal_ref);
	$txt_date_category=str_replace("'","",$txt_date_category);
	$cbo_order_status=str_replace("'","",$cbo_order_status);
	
	if($cbo_category==2 || $cbo_category==3 || $cbo_category==4 || $cbo_category==12 || $cbo_category==25)
	{	
		if($db_type==0)
		{
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and YEAR(a.insert_date)=$year_id";
			if ($year_id==0) $year_id_cond_sam=""; else $year_id_cond_sam=" and YEAR(s.insert_date)=$year_id";
		}
		elseif($db_type==2)
		{ 
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(a.insert_date,'YYYY')=$year_id";
			if ($year_id==0) $year_id_cond_sam=""; else $year_id_cond_sam=" and TO_CHAR(s.insert_date,'YYYY')=$year_id";
		}
		
		if ($cbo_company==0) $company_id=""; else $company_id=" and a.company_id=$cbo_company";
		if ($cbo_company==0) $company_id_sam=""; else $company_id_sam=" and s.company_id=$cbo_company";
		if ($cbo_buyer==0) $buyer_id=""; else $buyer_id=" and a.buyer_id=$cbo_buyer";
		if ($cbo_buyer==0) $buyer_id_sam=""; else $buyer_id_sam=" and s.buyer_id=$cbo_buyer";
		if ($cbo_category==0) $category_id=""; else $category_id=" and a.item_category=$cbo_category";
		if ($cbo_category==0) $category_id_sam=""; else $category_id_sam=" and s.item_category=$cbo_category";
		if ($wo_no=="") $wo_no_cond=""; else $wo_no_cond=" and a.booking_no='$wo_no'";
		if ($wo_no=="") $wo_no_cond_sam=""; else $wo_no_cond_sam=" and s.booking_no='$wo_no'";
		if ($wo_type==1 || $wo_type==2)  $wo_type_cond=" and a.booking_type in (1,2,3) and a.is_short='$wo_type'"; else $wo_type_cond="";
		if ($wo_type==3) $wo_type_cond_sam="  and a.booking_type=4"; else $wo_type_cond_sam="";
		
		if ($job_no=="") $job_num=""; else $job_num=" and b.job_no='$job_no'";
		//if ($po_no=='') $po_no_no=""; else $po_no_no=" and d.po_number in ($po_no)";
		if ($hidd_po=="") $po_id=""; else $po_id=" and d.id in ( $hidd_po )";
		
		//if ($hidd_po=="") $po_id_cond=""; else $po_id_cond=" and b.po_break_down_id in ( $hidd_po )";
		
		if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and d.file_no='".trim($file_no)."' "; 
		if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and d.grouping='".trim($internal_ref)."' "; 
		//echo $file_no_cond.'=='.$internal_ref_cond;die;
		if ($cbo_season_id==0) $season_cond=""; else $season_cond=" and c.season_buyer_wise in(".$cbo_season_id.") "; 
		
		if($db_type==0)
		{
			if($txt_date_category==1){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".$date_from."' and '".$date_to."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.booking_date between '".$date_from."' and '".$date_to."'";
			}
			else if($txt_date_category==2){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".$date_from."' and '".$date_to."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.delivery_date between '".$date_from."' and '".$date_to."'";
			}
		}
		if($db_type==2)
		{
			if($txt_date_category==1){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.booking_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
			else if($txt_date_category==2){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
		}
	
		$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
		$supplierArr=return_library_array( "select id,supplier_name from lib_supplier", "id", "supplier_name");	
		$buyerArr=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
		//$nonStyleArr=return_library_array( "select id, style_ref_no from sample_development_mst", "id", "style_ref_no");	
		$team_leader_arr=return_library_array( "select a.id, a.team_member_name from lib_mkt_team_member_info a, lib_marketing_team b where a.team_id=b.id and b.team_type in (2) and a.status_active =1 and a.is_deleted=0 order by a.team_member_name","id","team_member_name");	
		
		

		if ($cbo_category==4) 
		{
			$colspan=30;
			$tbl_width=3700;
		}
		else if ($cbo_category==12)
		{
			$colspan=28;
			$tbl_width=3170;
		}
		else if ($cbo_category==2)
		{
			$colspan=31;
			$tbl_width=3170;
		}
		else
		{
			$colspan=35;
			$tbl_width=3170;
		}
		
		$emb_item_array=array();
		//================================================issue 19461====16-09-2021===============================
			// $emb_sql="select a.emb_name, b.item_number_id, c.job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b, wo_po_break_down c where a.job_no=b.job_no_mst and c.id=b.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
			// $emb_sql_result=sql_select($emb_sql);
			// foreach($emb_sql_result as $row)
			// {
			// 	$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
			// 	$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
			// }
			// unset($emb_sql_result);
			//var_dump($job_array);

		
		//================================================issue 19461====16-09-2021===============================
		if($cbo_company!=0) $cbo_company_cond="and template_name=$cbo_company";else $cbo_company_cond="";
		if($cbo_category==2 || $cbo_category==3)
		{
			$print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=1 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			
			$print_short_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=2 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$partial_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=35 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$woven_partial_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=138 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$sample_req_non_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=90 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$sample_req_booking_withorder_print_report_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=48 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");		
			$sample_booking_non_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=4 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$sample_booking_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=3 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$pre_print_report_format=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=43 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");

	
		}
		else if($cbo_category==4)
		{
			$print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(5,6) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			/*$print_report_format_arr26=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=26 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");*/
			$trim_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(5) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$trim_print_report_format_arr2=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(6) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$print_report_format_arr26=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=26 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$pre_print_report_format=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=43 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			
		}
		else if($cbo_category==12) // Service Fab. Booking.
		{
			//$print_report_format_ids=return_field_value("format_id","lib_report_template","template_name ='".$cbo_company."'   and module_id=2 and report_id=11 and is_deleted=0 and status_active=1");
			//echo "select template_name, format_id from lib_report_template where  module_id=2 and report_id=11 and is_deleted=0 and status_active=1 $cbo_company_cond";
			$print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=11 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$print_report_format_aop=return_field_value("format_id"," lib_report_template"," module_id=2 and report_id=49 and is_deleted=0 and status_active=1 $cbo_company_cond");
				$multi_knit_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=65 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");

			//$format_ids=explode(",",$print_report_format_ids);
		}
		//print_r($print_report_format_arr);
		//$first_print_button=array_shift($format_ids);
		//$second_print_button= array_shift($format_ids);
		$tot_fin_fab_qnty=0;
		
		//echo $first_print_button.'gg';
		ob_start();
		?>
		<fieldset>
			<table width="<? echo $tbl_width; ?>"  cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none; font-size:18px;" colspan="<? echo $colspan; ?>">
						<? echo $company_library[str_replace("'","",$cbo_company_id)]; ?>                                
					</td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:16px; font-weight:bold"  colspan="<? echo $colspan; ?>"> <? echo $report_title; if($cbo_category!=0) echo " For ".$item_category[$cbo_category]; ?></td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:12px; font-weight:bold"  colspan="<? echo $colspan; ?>"> <? if( $date_from!="" && $date_to!="" ) echo "From ".change_date_format($date_from)." To ".change_date_format($date_to);?></td>
				</tr>
			</table>
			<table width="<? echo $tbl_width; ?>" cellspacing="0" border="1" class="rpt_table" rules="all">
				<thead>
					<th width="30">SL</th>    
					<th width="100">Company</th>
					<th width="100">Supplier</th>
					<th width="100">Buyer</th>
					<th width="60">Job Year</th>
					<th width="70">Job No.</th>
					<th width="100">Last Version</th>
					<th width="100">Style Ref.</th>
					<th width="60">Booking No/Wo No</th>
					<th width="60">Wo Year</th>
					<th width="70">Wo Date</th>
					<th width="100">Wo Type</th>
                    <th width="70">Pay Mode</th>
                    <?
					if ($cbo_category==3 || $cbo_category==2 || $cbo_category==25 || $cbo_category==4)
					{
						?>
                        <th width="100">PI No</th>
                        <?
					}

					if ($cbo_category==4)
					{
						?>
                        <th width="100">BTB LC</th>
                        <th width="100">LC Type</th>
                        <th width="100">Pay Term</th>
                        <th width="100">Tenor</th>
                        <?
					}

					if ($cbo_category==12)
					{
						?>
						<th width="100">PI No</th>
                        <th width="100">Process</th>
                        <?
					}
					
					?>
					
					<th width="70">Wo Last Update</th>
					<th width="70">Delivery Date</th>
					<th width="70">Supp. Dlv. Revised Date</th>
                    <th width="70">Lead Time</th>
					<th width="100">Ready To Approved</th>
                    <th width="100">Ready To Approved<br>date and time</th>
					<th width="80">Approval Status</th>
                    <th width="100">Last Approval <br>Date time and Person</th>
					<th width="100">Internal Ref.</th>
					<th width="100">File No.</th>
					<th width="70">Season</th>
					<th width="100">Order No</th>
                    <th width="100">Shipment Date</th>
					<th width="80">Item Category</th>
					<th width="70">First Receive Date</th>
					<?
						if ($cbo_category==4)
						{
							?>
								<th width="100">Wo Value</th>
                                <th width="100">Wo value(USD)</th>
                                <th width="100">Receive Value</th>
                                <th width="100">Receive Value(USD)</th>
							<?
						}
						else
						{
							
							if ($cbo_category==25) 
							{ 
							  $head_type="Wo Qty[Dzn]";
							  $head_type2="[USD]";
							}
							else { 
							 $head_type="Wo Qty (Fin.)";
							 $head_type2="";
							}
							?>
								<th width="100"><? echo $head_type;?></th>
								<?
								if ($cbo_category==3 || $cbo_category==25)
								{
									?>
			                        <th width="100">WO Value<? echo $head_type2;?></th>
			                        <?
								}
								else
								{
									?>
									<th width="100">Wo Qty (Grey)</th>
									<?
								}
								?>
								
							<?
						}
					
						?>
						<th width="80">Sample QTY</th>
						<th width="80">Responsible Dept</th>
						<th width="80">Reason</th>		
						<th width="100">Merchandiser name</th>					
					    <th>Remarks</th>
				</thead>
			</table>
			<div style="max-height:350px; overflow-y:scroll; width:<? echo $tbl_width+30; ?>px" id="scroll_body" >
				<table cellspacing="0" cellpadding="0" border="1" class="rpt_table"  width="<? echo $tbl_width; ?>px" rules="all" id="table_body" >
				<?
				
				
				
				$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
				$fabric_source_cond="";$fabric_source_cond_nonOrder="";
				if($cbo_category==2 || $cbo_category==4)
				{ 
					if($cbo_fabric_source>0) 
					{
						$fabric_source_cond=" and a.fabric_source=$cbo_fabric_source"; 
					
						if($cbo_fabric_source==1 || $cbo_fabric_source==4){
							$fabric_source_cond_nonOrder=" and t.fabric_source=$cbo_fabric_source"; 
							$select_field="t.fabric_source";
						}
						else
						{
							$fabric_source_cond_nonOrder=" and s.fabric_source=$cbo_fabric_source"; 
							$select_field="s.fabric_source";
						}
					}
					else $select_field="s.fabric_source";
				}
				//echo $select_field.'DDD';die;
				//var_dump($receive_qnty_data_prod);die;
				
				if($db_type==0)
				{
					$year_book=" year(a.insert_date) as year_book";
					$year_book_non=" year(s.insert_date) as year_book";
					$select_job_year=" year(c.insert_date) as job_year"; 
				}
				else
				{
					$year_book=" TO_CHAR(a.insert_date,'YYYY') as year_book";
					$year_book_non=" TO_CHAR(s.insert_date,'YYYY') as year_book";
					$select_job_year=" TO_CHAR(c.insert_date,'YYYY') as job_year";
				}

				/*$wo_last_date_sql=sql_select("select id,update_date from wo_booking_mst where is_deleted=0 and  status_active=1");
				foreach($wo_last_date_sql as $val)
				{
					$wo_last_date_arr[$val[csf("id")]]=$val[csf("update_date")];
				}*/
 				//wo_non_ord_samp_booking_dtls
				if($wo_type==0)
				{
					if($job_no!='' || $hidd_po!='' || $file_no!='' || $internal_ref!='')
					{

						 $sql="Select a.entry_form,a.update_date, a.company_id, a.id as booking_id, a.pay_mode, a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date, a.delivery_date,a.sup_rev_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount,b.responsible_dept,b.reason, b.uom as uom,c.season_buyer_wise, c.job_no_prefix_num, c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date, 0 as type ,b.bh_qty,b.rf_qty,c.factory_marchant

						from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d  
						where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $booking_date_cond $wo_no_cond $fabric_source_cond  $job_num $po_id $internal_ref_cond  $file_no_cond $season_cond $year_id_cond";//die;
					}
					else
					{
						  $sql="(Select a.entry_form,a.update_date,a.company_id,a.id as booking_id, a.pay_mode,a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date as booking_date,a.delivery_date,a.sup_rev_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount, b.responsible_dept,b.reason,b.uom as uom,c.season_buyer_wise, c.job_no_prefix_num, c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date, 0 as type ,b.bh_qty,b.rf_qty 
						from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d
						where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $job_num $po_id $booking_date_cond $wo_no_cond $fabric_source_cond  $job_num $po_id $internal_ref_cond  $file_no_cond $year_id_cond $season_cond) 
						 union all
						 (SELECT s.entry_form_id as entry_form,s.update_date, s.company_id, s.id as booking_id, s.pay_mode, s.booking_type, s.is_short, s.booking_no, $year_book_non, s.booking_no_prefix_num, s.fabric_source, s.booking_date as booking_date, s.delivery_date,s.sup_rev_date,null as  delivery_date_dtls, s.is_approved, s.ready_to_approved, s.supplier_id, s.buyer_id, s.item_category, s.currency_id, s.exchange_rate, null as process, t.finish_fabric as fin_fab_qnty, t.grey_fabric as grey_fab_qnty, t.trim_qty as wo_qnty, t.amount as amount, null as responsible_dept, null as reason, t.uom as uom,null as season_buyer_wise, null as job_no_prefix_num, null as job_no, null as job_year, null as style_ref_no, null as garments_nature, 0 as po_break_down_id, null as po_number, null as file_no, null as grouping, null as pub_shipment_date, 1 as type ,t.bh_qty,t.rf_qty
						 FROM wo_non_ord_samp_booking_mst s, wo_non_ord_samp_booking_dtls t 
						 WHERE s.booking_no=t.booking_no and s.status_active =1 and s.is_deleted=0 and t.status_active =1 and t.is_deleted=0 $company_id_sam $buyer_id_sam ".set_user_lavel_filtering(' and s.buyer_id','buyer_id')." $category_id_sam $booking_date_cond_samp $wo_no_cond_sam $year_id_cond_sam $fabric_source_cond_nonOrder) order by booking_date ";//die;//LISTAGG(CAST(b.job_no AS VARCHAR(4000)), ',') WITHIN GROUP (ORDER BY b.job_no) as job_no,
					}
				}
				else
				{
					if ($wo_type==1 || $wo_type==2 || $wo_type==3)
					{
						 $sql="Select a.entry_form,a.update_date, a.company_id, a.id as booking_id, a.pay_mode, a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date,a.delivery_date,a.sup_rev_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.responsible_dept, b.reason, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount, b.uom as uom,c.season_buyer_wise, c.job_no_prefix_num, c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date,  0 as type,b.bh_qty,b.rf_qty,c.factory_marchant
						 from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d 
						 where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status  $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $job_num $po_id $booking_date_cond $wo_no_cond $wo_type_cond $wo_type_cond_sam $file_no_cond $internal_ref_cond $fabric_source_cond $year_id_cond $season_cond order by a.booking_no";//die;
					}
					else
					{  
						$sql="SELECT s.entry_form_id as entry_form,s.update_date,s.company_id, s.id as booking_id, s.pay_mode, s.booking_type, s.is_short, s.booking_no, $year_book_non, s.booking_no_prefix_num, $select_field , s.booking_date, s.delivery_date,s.sup_rev_date, s.is_approved, s.ready_to_approved, s.supplier_id, s.buyer_id, s.item_category, s.currency_id, s.exchange_rate, null as process, t.finish_fabric as fin_fab_qnty, t.grey_fabric as grey_fab_qnty, t.trim_qty as wo_qnty, t.amount as amount, t.uom as uom,null as season_buyer_wise, null as job_no_prefix_num, null as job_no, null as job_year, null as style_ref_no, null as garments_nature, 0 as po_break_down_id, null as po_number, null as file_no, null as grouping, null as pub_shipment_date, 1 as type,  t.bh_qty,t.rf_qty
						FROM wo_non_ord_samp_booking_mst s, wo_non_ord_samp_booking_dtls t 
						WHERE s.booking_no=t.booking_no and s.status_active =1 and s.is_deleted=0 and t.status_active =1 and t.is_deleted=0 $company_id_sam $buyer_id_sam ".set_user_lavel_filtering(' and s.buyer_id','buyer_id')." $category_id_sam $booking_date_cond_samp $wo_no_cond_sam $year_id_cond_sam  $fabric_source_cond_nonOrder";//die;
					}
				}
				  //echo $sql; die;
				$job_check=$order_check=array();
				$sql_result=sql_select($sql); 
				$booking_data=array();$booking_id_arr=array();

				



				foreach($sql_result as $row)
				{ 
					$booking_id_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
					$po_id_arr[$row[csf("po_break_down_id")]]=$row[csf("po_break_down_id")];
					
					$booking_data[$row[csf("booking_id")]]["booking_id"]=$row[csf("booking_id")];
					$booking_data[$row[csf("booking_id")]]["booking_type"]=$row[csf("booking_type")];
					$booking_data[$row[csf("booking_id")]]["update_date"]=$row[csf("update_date")];
					$booking_data[$row[csf("booking_id")]]["is_short"]=$row[csf("is_short")];
					$booking_data[$row[csf("booking_id")]]["booking_no"]=$row[csf("booking_no")];
					$booking_data[$row[csf("booking_id")]]["company_id"]=$row[csf("company_id")];
					$booking_data[$row[csf("booking_id")]]["year_book"]=$row[csf("year_book")];
					$booking_data[$row[csf("booking_id")]]["booking_no_prefix_num"]=$row[csf("booking_no_prefix_num")];
					$booking_data[$row[csf("booking_id")]]["entry_form"]=$row[csf("entry_form")];
					$booking_data[$row[csf("booking_id")]]["team_leader"]=$team_leader_arr[$row[csf("factory_marchant")]];
					
					$booking_data[$row[csf("booking_id")]]["fabric_source"]=$row[csf("fabric_source")];
					$booking_data[$row[csf("booking_id")]]["booking_date"]=$row[csf("booking_date")];
					$booking_data[$row[csf("booking_id")]]["update_date"]=$row[csf("update_date")];
					$booking_data[$row[csf("booking_id")]]["delivery_date"]=$row[csf("delivery_date")];
					$booking_data[$row[csf("booking_id")]]["sup_rev_date"]=$row[csf("sup_rev_date")];
					$booking_data[$row[csf("booking_id")]]["is_approved"]=$row[csf("is_approved")];
					$booking_data[$row[csf("booking_id")]]["ready_to_approved"]=$row[csf("ready_to_approved")];
					$booking_data[$row[csf("booking_id")]]["supplier_id"]=$row[csf("supplier_id")];
					$booking_data[$row[csf("booking_id")]]["buyer_id"]=$row[csf("buyer_id")];
					$booking_data[$row[csf("booking_id")]]["item_category"]=$row[csf("item_category")];
					$booking_data[$row[csf("booking_id")]]["type"]=$row[csf("type")];
					$booking_data[$row[csf("booking_id")]]["pay_mode"]=$row[csf("pay_mode")];
					$booking_data[$row[csf("booking_id")]]["delivery_date_dtls"]=$row[csf("delivery_date_dtls")];
					$booking_data[$row[csf("booking_id")]]["currency_id"]=$row[csf("currency_id")];
					$booking_data[$row[csf("booking_id")]]["process"].=$row[csf("process")].",";
					
					$booking_data[$row[csf("booking_id")]]["fin_fab_qnty"]+=$row[csf("fin_fab_qnty")];
					$booking_data[$row[csf("booking_id")]]["grey_fab_qnty"]+=$row[csf("grey_fab_qnty")];
					$booking_data[$row[csf("booking_id")]]["wo_qnty"]+=$row[csf("wo_qnty")];
					$booking_data[$row[csf("booking_id")]]["amount"]+=$row[csf("amount")];
					$booking_data[$row[csf("booking_id")]]["sample_qnt"]+=($row[csf("bh_qty")]*1+$row[csf("rf_qty")]*1);
					$booking_data[$row[csf("booking_id")]]["uom"]=$row[csf("uom")];
					if($job_check[$row[csf("booking_id")]][$row[csf("job_no")]]=="")
					{
						$booking_data[$row[csf("booking_id")]]["job_no"].=$row[csf("job_no")].",";
						$booking_data[$row[csf("booking_id")]]["job_no_prefix_num"].=$row[csf("job_no_prefix_num")].",";
						$booking_data[$row[csf("booking_id")]]["job_year"].=$row[csf("job_year")].",";
						$booking_data[$row[csf("booking_id")]]["style_ref_no"].=$row[csf("style_ref_no")].",";
						$booking_data[$row[csf("booking_id")]]["season_buyer_wise"].=$season_library[$row[csf("season_buyer_wise")]].",";
						
						$job_check[$row[csf("booking_id")]][$row[csf("job_no")]]=$row[csf("job_no")];
					}
					if($order_check[$row[csf("booking_id")]][$row[csf("po_break_down_id")]]=="")
					{
						$booking_data[$row[csf("booking_id")]]["po_break_down_id"].=$row[csf("po_break_down_id")].",";
						$booking_data[$row[csf("booking_id")]]["po_number"].=$row[csf("po_number")].",";
						$booking_data[$row[csf("booking_id")]]["file_no"].=$row[csf("file_no")].",";
						$booking_data[$row[csf("booking_id")]]["grouping"].=$row[csf("grouping")].",";
						$booking_data[$row[csf("booking_id")]]["pub_shipment_date"].=change_date_format($row[csf("pub_shipment_date")]).",";
						
						$order_check[$row[csf("booking_id")]][$row[csf("po_break_down_id")]]=$row[csf("po_break_down_id")];
					}
					if($row[csf("booking_type")]==1 && $row[csf("is_short")]==1)//responsible_dept,reason
					{
						if($row[csf("reason")]!='')
						{
							$booking_data[$row[csf("booking_id")]]["reason"].=$row[csf("reason")].",";
						}
						if($row[csf("responsible_dept")]!='')
						{
							$resp_dept=explode(",",$row[csf("responsible_dept")]);
							$dept_name="";
							foreach($resp_dept as $dept)
							{
								if($dept_name=="") $dept_name=$department_library[$dept]; else $dept_name.=",".$department_library[$dept];
							}
							$booking_data[$row[csf("booking_id")]]["dept_name"].=$dept_name.",";
						}
					}
				}
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 1, $booking_id_arr, $empty_arr);//Book ID Ref from=1
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 2, $po_id_arr, $empty_arr);//PO ID Ref from=2
				
				//===============*********************//
				$wopi_arr=array(); $tem_pi=array();
				if($cbo_category==4)
				{
					if($cbo_company>0) $piCond="and a.importer_id=$cbo_company"; else $piCond="";
					//echo "select a.pi_number, b.work_order_no, b.work_order_dtls_id from com_pi_master_details a, com_pi_item_details b where a.id=b.pi_id and a.item_category_id=4 and a.status_active=1 and a.importer_id=$cbo_company and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.work_order_dtls_id>0";
					$sql_wo_pi=sql_select("select a.id,a.pi_number, b.work_order_no, b.work_order_dtls_id from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id and b.work_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.item_category_id=4 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.work_order_dtls_id>0 $piCond");
					//echo "select a.pi_number, b.work_order_no, b.work_order_dtls_id from com_pi_master_details a, com_pi_item_details b where a.id=b.pi_id and a.item_category_id=4 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.work_order_dtls_id>0 $piCond";	
					foreach($sql_wo_pi as $rowPi)
					{
						//if($tem_pi[$rowPi[csf('work_order_no')]]=="")
						//{
							$tem_pi[$rowPi[csf('work_order_no')]]=$rowPi[csf('pi_number')];
							$wopi_arr[$rowPi[csf('work_order_no')]].=$rowPi[csf("pi_number")]."__";//.=$rowPi[csf('pi_number')]."**";
							$wopiId_arr[$rowPi[csf('work_order_no')]].=$rowPi[csf("id")]."__";//.=$rowPi[csf('pi_number')]."**";
						//}
						//echo $rowPi[csf('work_order_no')].'--'.$rowPi[csf('pi_number')].'==';
						$pi_number_arr[] = "'".$rowPi[csf('id')]."'";
						$piArr[$rowPi[csf("id")]]=$rowPi[csf("id")];
					}
					//unset($sql_wo_pi);

					fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 3, $piArr, $empty_arr);//PI ID Ref from=3
				
					$pi_number_string = implode(',',array_unique($pi_number_arr)); 

					//============== For BTB Lc Data ==================
					if($pi_number_string!="")
					{
						if($cbo_company>0) $comCond="and a.importer_id=$cbo_company"; else $comCond="";
				
						// $btb_sql="select pi_id,lc_number,lc_type_id,payterm_id,tenor from com_btb_lc_master_details where  status_active=1 and is_deleted=0 $comCond";
						
						$btb_sql = "SELECT a.id, a.lc_number,a.lc_type_id,a.payterm_id,a.tenor, c.pi_number
						FROM com_btb_lc_master_details a, com_btb_lc_pi b, com_pi_master_details c,gbl_temp_engine g 
						WHERE a.id=b.com_btb_lc_master_details_id and b.pi_id=c.id and c.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=37 and a.is_deleted = 0 and a.item_basis_id=1 $comCond
						
						UNION ALL
						SELECT a.id, a.lc_number,a.lc_type_id,a.payterm_id,a.tenor,c.pi_number
						FROM com_btb_lc_master_details a, com_btb_lc_pi b, com_pi_master_details c,gbl_temp_engine g 
						WHERE a.id=b.com_btb_lc_master_details_id and b.pi_id=c.id and c.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=37 and a.is_deleted = 0 and a.item_basis_id=2 $comCond";
						 //echo $btb_sql;
						$sql_result=sql_select($btb_sql);
						$btb_pi=array();
						foreach($sql_result as $rows)
						{					
							$btb_pi[$rows[csf('pi_number')]]['lc_number']=$rows[csf('lc_number')];
							$btb_pi[$rows[csf('pi_number')]]['lc_type_id']=$rows[csf('lc_type_id')];
							$btb_pi[$rows[csf('pi_number')]]['payterm_id']=$rows[csf('payterm_id')];
							$btb_pi[$rows[csf('pi_number')]]['tenor']=$rows[csf('tenor')];
						}
						//var_dump($btb_pi);
					}
				}
				
				//print_r($wopi_arr); die;
				//----------------------
				if($cbo_category==2 || $cbo_category==3 || $cbo_category==4 ||  $cbo_category==25)
				{
					if ($cbo_company==0) $company_cond_id=""; else $company_cond_id=" and b.company_id=$cbo_company";
					if($cbo_category==2)
					{
						$booking_check_prod=array();
						/*$prod_1st_sql=sql_select("select a.id as book_id, d.booking_without_order, d.receive_date as receive_date, c.cons_quantity as rcv_qnty from  wo_booking_mst a, pro_batch_create_mst b , inv_transaction c, inv_receive_master d where a.id=b.booking_no_id and b.id=c.pi_wo_batch_no and c.mst_id=d.id and a.item_category in(2,3)  and c.pi_wo_batch_no>0 and c.status_active=1 and c.item_category in(2,3) and c.transaction_type=1");*/

						$prod_1st_sql=sql_select("select a.id as book_id, c.booking_without_order, c.transaction_date as receive_date as receive_date, c.cons_quantity as rcv_qnty from  wo_booking_mst a, pro_batch_create_mst b , inv_transaction c,gbl_temp_engine g  where a.id=b.booking_no_id and b.id=c.pi_wo_batch_no and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and a.item_category in(2,3)  and c.pi_wo_batch_no>0 and c.status_active=1 and c.item_category in(2,3) and c.transaction_type=1");

						$first_rec_date_prod=array();
						foreach($prod_1st_sql as $row)
						{
							//$first_rec_date_prod[$row[csf("book_id")]]=$row[csf("receive_date")];
							$receive_data_pord[$row[csf("book_id")]][$row[csf("booking_without_order")]].=$row[csf("receive_date")].",";
							$receive_qnty_data_prod[$row[csf("book_id")]][$row[csf("booking_without_order")]][$row[csf("receive_date")]]+=$row[csf("rcv_qnty")];
							if($booking_check[$row[csf("book_id")]]=="")
							{
								$first_rec_date_prod[$row[csf("book_id")]]=$row[csf("receive_date")];
								$booking_check_prod[$row[csf("book_id")]]=$row[csf("receive_date")];
							}
						}
						
						$sql_receive="select b.recv_number,b.booking_id, b.receive_date, b.booking_without_order, c.cons_quantity as rcv_qnty from inv_receive_master b, inv_transaction c,gbl_temp_engine g where b.id=c.mst_id and b.booking_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and c.transaction_type=1 and b.item_category in(2,3)  and b.receive_basis in(12,2) $company_cond_id";
						 	
						$receive_result=sql_select($sql_receive);
						$receive_data=$receive_qnty_data=$booking_check=array();
						foreach($receive_result as $row)
						{
							$receive_data[$row[csf("booking_id")]][$row[csf("booking_without_order")]].=$row[csf("receive_date")].",";
							$receive_qnty_data[$row[csf("booking_id")]][$row[csf("booking_without_order")]][$row[csf("receive_date")]]+=$row[csf("rcv_qnty")];
							if($booking_check[$row[csf("booking_id")]]=="")
							{
								$first_rec_date[$row[csf("booking_id")]]=$row[csf("receive_date")];
								$booking_check[$row[csf("booking_id")]]=$row[csf("receive_date")];
								$first_rec_no[$row[csf("booking_id")]]=$row[csf("recv_number")];
							}
						}
						
					}
					else
					{
						 $sql="select min(a.recv_number) as recv_number,b.pi_wo_batch_no, min(a.receive_date) as receive_date,min(a.currency_id) as currency_id, sum(b.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,gbl_temp_engine g where a.id=b.mst_id and b.pi_wo_batch_no=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.entry_form=24 and  b.item_category in(4)  and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(2,12) $company_cond_id group by b.pi_wo_batch_no";	//echo $sql ;die;
						$sql_result=sql_select($sql);
						$booking_pi_check=array();
						foreach($sql_result as $row)
						{
							//if($booking_pi_check[$row[csf("pi_wo_batch_no")]]=="")
							//{
							$first_rec_date[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
							$first_rec_no[$row[csf("pi_wo_batch_no")]]=$row[csf("recv_number")];
							$booking_pi_check[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
							//}
							//$rec_amt_arr[$row[csf("pi_wo_batch_no")]]=$row[csf("rec_amt")];
							//$rec_currency_arr[$row[csf("pi_wo_batch_no")]]=$row[csf("currency_id")];
						}
						unset($sql_result);
							if($cbo_category==3) //Woven Fab
							{
								 $pi_recv_sql="select min(a.recv_number) as recv_number,b.pi_wo_batch_no, min(a.receive_date) as receive_date,min(a.currency_id) as currency_id, sum(b.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,gbl_temp_engine g where a.id=b.mst_id and b.pi_wo_batch_no=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and a.entry_form=17 and  b.item_category in(3)  and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(2,1) $company_cond_id group by b.pi_wo_batch_no";
								
							$wvn_receive_result=sql_select($pi_recv_sql);
							$receive_data=$receive_qnty_data=$booking_check=array();
							foreach($wvn_receive_result as $row)
							{
								$first_rec_date[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
								$first_rec_no[$row[csf("pi_wo_batch_no")]]=$row[csf("recv_number")];
								//$booking_pi_check[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
							}
							unset($wvn_receive_result);
						}
						
					}
				}

				///===============================================reserved no====================================
				/*$reserved_data=sql_select("select a.id, to_char(a.insert_date,'YYYY') as year, a.booking_no_prefix_num, a.booking_no, a.company_id, a.booking_type, a.is_short, a.buyer_id,a.supplier_id, a.is_approved, b.id as approval_id, b.sequence_no, b.approved_by, a.is_apply_last_update,a.entry_form,max(b.approved_no) as revised_no,c.grouping from wo_booking_mst a, approval_history b, wo_po_break_down c,wo_booking_dtls d where a.id=b.mst_id and a.booking_no=d.booking_no and d.job_no=c.job_no_mst and b.entry_form=7 and a.company_id=$cbo_company and a.is_short in(2,3) and a.booking_type=1 and a.item_category in(2,3,13) and a.status_active=1 and a.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and b.current_approval_status=1 and a.ready_to_approved=1 and a.is_approved in (1,3)  ".where_con_using_array($booking_id_arr,0,'a.id')." group by a.id, a.booking_no_prefix_num, a.booking_no,a.entry_form, a.company_id, a.booking_type, a.is_short, a.buyer_id, a.supplier_id, a.is_approved, b.id, b.sequence_no, b.approved_by, a.is_apply_last_update,a.update_date, a.insert_date,c.grouping order by NVL(a.update_date, a.insert_date) desc ");*/
				$reserved_data=sql_select("select a.id, to_char(a.insert_date,'YYYY') as year, a.booking_no_prefix_num, a.booking_no, a.company_id, a.booking_type, a.is_short, a.buyer_id,a.supplier_id, a.is_approved, b.id as approval_id, b.sequence_no, b.approved_by, a.is_apply_last_update,a.entry_form,max(b.approved_no) as revised_no from wo_booking_mst a, approval_history b, wo_booking_dtls d,gbl_temp_engine g where a.id=b.mst_id and a.booking_no=d.booking_no and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and b.entry_form=7 and a.company_id=$cbo_company and a.is_short in(2,3) and a.booking_type=1 and a.item_category in(2,3,13) and a.status_active=1 and a.is_deleted=0 and d.status_active=1 and d.is_deleted=0  and b.current_approval_status=1 and a.ready_to_approved=1 and a.is_approved in (1,3)   group by a.id, a.booking_no_prefix_num, a.booking_no,a.entry_form, a.company_id, a.booking_type, a.is_short, a.buyer_id, a.supplier_id, a.is_approved, b.id, b.sequence_no, b.approved_by, a.is_apply_last_update,a.update_date, a.insert_date order by NVL(a.update_date, a.insert_date) desc ");

				

				$reserved_data_arr=array();
				foreach($reserved_data as $row){

					$reserved_data_arr[$row[csf("id")]]['reserve_no']=$row[csf("revised_no")];
				}

				// echo "<pre>";
				// print_r($reserved_data_arr);



				$emb_sql="select a.emb_name, b.item_number_id, a.job_no as job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b, gbl_temp_engine g   where a.job_id=b.job_id  and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 ";
				// $po_id_arr
				// echo $emb_sql;
				$emb_sql_result=sql_select($emb_sql);
				foreach($emb_sql_result as $row)
				{
					$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
					$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
				}
				unset($emb_sql_result);

				//$booking_id_arr[$row[csf("booking_id")]]
				//var_dump($booking_data);die;
				//".where_con_using_array($po_id_arr,1,'po_break_down_id')."
				 //echo $sql;
				//echo  $po_id ;die;
				if($cbo_category!=2)
				{
				/* $sql_recv="select b.pi_wo_batch_no,b.prod_id, (a.currency_id) as currency_id,(c.quantity) as rcv_qnty, (c.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,order_wise_pro_details c,inv_trims_entry_dtls e where a.id=b.mst_id and  b.id=c.trans_id and e.id=c.dtls_id and e.trans_id=c.trans_id and e.mst_id=a.id and e.prod_id=b.prod_id and c.trans_type=1 and a.entry_form=24 and c.entry_form=24 and  b.item_category in(4)  and c.status_active=1 and c.is_deleted=0 and e.status_active=1 and e.is_deleted=0 and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(2,12) $company_cond_id ".where_con_using_array($po_id_arr,0,'c.po_breakdown_id')."  ";*/

				 $sql_recv="select b.pi_wo_batch_no,b.prod_id, (a.currency_id) as currency_id,(c.quantity) as rcv_qnty, (c.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,order_wise_pro_details c,gbl_temp_engine g where a.id=b.mst_id and  b.id=c.trans_id  and c.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and c.trans_type=1 and a.entry_form=24 and c.entry_form=24 and  b.item_category in(4)  and c.status_active=1 and c.is_deleted=0   and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(2,12) $company_cond_id  ";
						$sql_Recv_result=sql_select($sql_recv);
						$propo_id_check=array();
						foreach($sql_Recv_result as $row)
						{
							//$first_rec_date[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
							//$first_rec_no[$row[csf("pi_wo_batch_no")]]=$row[csf("recv_number")];
							if($propo_id_check[$row[csf('prop_id')]]=="")
							{
							$propo_id_check[$row[csf('prop_id')]]=$row[csf('prop_id')];
							$rec_amt_arr[$row[csf("pi_wo_batch_no")]]+=$row[csf("rec_amt")];
							}
							$rec_currency_arr[$row[csf("pi_wo_batch_no")]]=$row[csf("currency_id")];
						}
						unset($sql_Recv_result);
				}
				
				// $pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b where a.id=b.pi_id and a.status_active=1 and a.is_deleted=0
				// and a.item_category_id=3 and a.pi_basis_id=1 and a.entry_form=166
				// group by  a.id,a.pi_number, b.work_order_no order by a.pi_number desc";
					$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id  and b.work_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0
					and a.item_category_id in(2,3,12,25) and a.pi_basis_id=1 
					group by  a.id,a.pi_number, b.work_order_no order by a.pi_number desc";
				$pi_sql_result=sql_select($pi_sql);
				$pi_no_arr = array();
				foreach ($pi_sql_result as $value) 
				{
					$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
					$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];
				}
				unset($pi_sql_result);
		
				 $wo_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_booking_mst a, approval_history b,gbl_temp_engine g where a.id=b.mst_id  and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(8,7,32,13,12) ".where_con_using_array($booking_id_arr,0,'a.id')." order by b.id desc";
				$wo_his_sql_result=sql_select($wo_his_sql);
				//$pi_no_arr = array();
				$user_arr=return_library_array( "select id, user_name from user_passwd", 'id', 'user_name' );	
				foreach ($wo_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_his_sql_result);
				
				$wo_non_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_non_ord_samp_booking_mst a, approval_history b,gbl_temp_engine g where a.id=b.mst_id and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(9) ".where_con_using_array($booking_id_arr,0,'a.id')." order by b.id desc";
				$wo_non_his_sql_result=sql_select($wo_non_his_sql);
				//$pi_no_arr = array();
			 
				foreach ($wo_non_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_non_his_sql_result);
				
				/*echo "<pre>";
				print_r($pi_no_arr);die;*/
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				$i=1;$summer_data=array();$job_check=array();
				$tot_wo_currency_usd_amt=$tot_recv_usd_amt=$tot_embl_wo_amount=$tot_sample=0;
				$btype="";
				foreach($booking_data as $row)
				{
					$variable=$row[("booking_no_prefix_num")];
					$sample_qnt=0;
					$sample_qnt=$row['sample_qnt'];
					$tot_sample+=$row['sample_qnt'];

					if($row[("item_category")]==2 || $cbo_category==3)
					{
						if($row[("fabric_source")]==1 || $row[("fabric_source")]==2 || $row[("fabric_source")]==4)
						{
							if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
							if ($row[("type")]==0)
							{	
								if ($row[("booking_type")]==1 || $row[("booking_type")]==2  || $row[("booking_type")]==3  || $row[("booking_type")]==6)
								{
									if ($row[("is_short")]==1)
									{
										$wo_type="Short";
										$wo_typw_id=1;
									}
									else if ($row["entry_form"]==108){
										$wo_type="Partial";
										$wo_typw_id=5;
									}
									else
									{
										$wo_type="Main";
										$btype=2;
										$wo_typw_id=2;
									}
								}
								elseif($row[("booking_type")]==4)
								{
									$wo_type="Sample With Order";
									$wo_typw_id=3;
								}
							}
							else
							{
								$wo_type="Sample Non Order";
								$wo_typw_id=4;
							}
							// echo $wo_typw_id.'ssd';
							
							$job_no=$style_ref_no=$po_number=$file=$ref=$job_number="";
							
							$p=1;
							$ship_date_arr=array_unique(explode(",",chop($row[("pub_shipment_date")],",")));
							foreach($ship_date_arr as $ship_date)
							{
								if($p==1)
								{
									$min_ship_date=$ship_date;
									$max_ship_date=$ship_date;
								}
								
								if(strtotime($min_ship_date)>strtotime($ship_date)) $min_ship_date=$ship_date;
								if(strtotime($max_ship_date)<strtotime($ship_date)) $max_ship_date=$ship_date;
								$p++;
							}
							
							$all_po_id=implode(",",array_unique(explode(",",chop($row[("po_break_down_id")],","))));
							$job_no=implode(",",array_unique(explode(",",chop($row[("job_no_prefix_num")],","))));
							$job_number=implode(",",array_unique(explode(",",chop($row[("job_no")],","))));
							$job_year=implode(",",array_unique(explode(",",chop($row[("job_year")],","))));
							$style_ref_no=implode(",",array_unique(explode(",",chop($row[("style_ref_no")],","))));
							$po_number=implode(", ",array_unique(explode(",",chop($row[("po_number")],","))));
							$file=implode(",",array_unique(explode(",",chop($row[("file_no")],","))));
							$ref=implode(",",array_unique(explode(",",chop($row[("grouping")],","))));
							$short_reason=implode(",",array_unique(explode(",",chop($row[("reason")],","))));
							$dept_name=implode(",",array_unique(explode(",",chop($row[("dept_name")],","))));
							$season_buyer=implode(",",array_unique(explode(",",chop($row[("season_buyer_wise")],","))));
							
							$cbo_company=$row[("company_id")];
							$print_report_format_ids=$print_report_format_arr[$cbo_company];
							$partial_print_report_format_ids=$partial_print_report_format_arr[$cbo_company];
							$woven_partial_print_report_format_ids=$woven_partial_print_report_format_arr[$cbo_company];
							$sample_req_non_print_report_format_ids=$sample_req_non_print_report_format_arr[$cbo_company];
							$sample_req_withorder_print_report_ids=$sample_req_booking_withorder_print_report_arr[$cbo_company];
							$sample_booking_without_print_report_ids=$sample_booking_non_print_report_format_arr[$cbo_company];
							$sample_booking_withorder_print_report_ids=$sample_booking_print_report_format_arr[$cbo_company];
							$pre_print_report_format_ids=$pre_print_report_format[$cbo_company];
							
							//echo $pre_print_report_format_ids.'-D-';
							$short_booking_print_report_ids=$print_short_report_format_arr[$cbo_company];
							//echo $short_booking_print_report_ids.'-D-';
							
							$short_format_ids=explode(",",$short_booking_print_report_ids);
							$short_format_first_print_button=array_shift($short_format_ids);
							
							$sample_req_format_ids=explode(",",$sample_req_withorder_print_report_ids);
							$samp_req_wo_first_print_button=array_shift($sample_req_format_ids);

							$sample_req_without_format_ids=explode(",",$sample_req_non_print_report_format_ids);
							$samp_req_without_wo_first_print_button=array_shift($sample_req_without_format_ids);
							
							
							$sample_req_with_print_ids=explode(",",$sample_req_withorder_print_report_ids);
							$samp_req_with_first_print_button=array_shift($sample_req_with_print_ids);
							//echo $sample_req_format_first_print_button.'DF';
							$sample_booking_without_print_ids=explode(",",$sample_booking_without_print_report_ids);
							$samp_booking_without_first_print_button=array_shift($sample_booking_without_print_ids);
							
							$sample_booking_with_print_ids=explode(",",$sample_booking_withorder_print_report_ids);
							$samp_booking_with_first_print_button=array_shift($sample_booking_with_print_ids);

							$pre_print_report_ids=explode(",",$pre_print_report_format_ids);
							$print_button_first=array_shift($pre_print_report_ids);
							
							
							$partial_format_ids=explode(",",$partial_print_report_format_ids);
							$woven_partial_format_ids=explode(",",$woven_partial_print_report_format_ids);
							$part_first_print_button=array_shift($partial_format_ids);
							$woven_part_first_print_button=array_shift($woven_partial_format_ids);
							
							$format_ids=explode(",",$print_report_format_ids);
							$print_b_16="";
							foreach ($format_ids as $key => $button_id) {
								if($button_id==719)
								{
									$print_b_16=$button_id;
								}
							}
						
							$first_print_button=array_shift($format_ids);
							$second_print_button= array_shift($format_ids);
							//$part_first_print_button=array_shift($partial_format_ids);
							//echo $partial_print_report_format_ids.'=DD='.$first_print_button;
							
							
							//print ($part_first_print_button).'='.$row["entry_form"].'---';

							//143,160,220,151,175,155,218,84,85,235 partial
							if($cbo_category==2 || $cbo_category==3)
							{
								if($row["entry_form"]==118)
								{
									
									if($first_print_button==1)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report_gr";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										
										//part_first_print_button $row["entry_form"]
									}
									else if($first_print_button==2)
									{
										if($wo_typw_id==2)
										{
											$action_type="show_fabric_booking_report";
											$wo_typw_id=73;
										}
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##'  title='PB F1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." <a/>";			
									}
									else if($first_print_button==3)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report3";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##'  title='PB F2' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";	
									}
									else if($first_print_button==4)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report1";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##'  title='PFC F1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==5)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report2";
										else $action_type="show_fabric_booking_report";  
										$variable="<a href='##' title='PFC F2' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	    
									}
									else if($first_print_button==6)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report4";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##' title='FB F1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==7)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report5";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##' title='FB F2' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==28)
									{
										$action_type="show_fabric_booking_report_akh"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==45)
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==53)
									{
										$action_type="show_fabric_booking_report_jk";
										
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==93)
									{
										$action_type="show_fabric_booking_report_libas"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==786)
									{
										$action_type="show_fabric_booking_report25"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==73)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_mf";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==193)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_print4";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==269)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_knit";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($second_print_button==73)
									{
										$action_type="show_fabric_booking_report_mf";  
										$variable="<a href='##'  title='PB MF' onClick=\"generate_fabric_report('".$second_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==849)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_bl1";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==719)
									{
										$action_type="show_fabric_booking_report16";  
										$variable="<a href='##'  title='B16' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}else if($first_print_button==426)
									{
										$action_type="show_fabric_booking_report_print23";  
										$variable="<a href='##'  title='B23' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($second_print_button==719)
									{
										$action_type="show_fabric_booking_report16";  
										$variable="<a href='##'  title='B16' onClick=\"generate_fabric_report('".$second_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($print_b_16==719)
									{
										$action_type="show_fabric_booking_report16";  
										$variable="<a href='##'  title='B16' onClick=\"generate_fabric_report('".$print_b_16."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==140) //Sampe Req Fab Without Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition Fabric Booking -Without order";
									if($samp_req_without_wo_first_print_button==10)
									{
										$action_type="show_fabric_booking_report";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_without_wo_first_print_button==17)
									{
										$action_type="show_fabric_booking_report_barnali";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}else if($row["entry_form"]==203) //Sampe Req Fab Without Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition With Booking";
									if($samp_req_without_wo_first_print_button==109)
									{
										$action_type="sample_requisition_print";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(203,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_without_wo_first_print_button==111)
									{
										$action_type="sample_requisition_print6";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(203,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==142) //Sampe Req With Booking  
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition With Booking";
									if($samp_req_without_wo_first_print_button==110)
									{
										$action_type="sample_requisition_print";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_without_wo_first_print_button==109)
									{
										$action_type="sample_requisition_print1";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==139) //Sampe Req Fab With Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition Fabric Booking -With order";
									if($samp_req_wo_first_print_button==155)
									{
										$action_type="show_fabric_booking_report";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(139,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_wo_first_print_button==17)
									{
										$action_type="show_fabric_booking_report2";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(139,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==88) //Sampe Req Fab With Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									//echo $short_format_first_print_button.'X';
									$page_name="Short Fabric Booking";
									if($short_format_first_print_button==136)
									{
										$action_type="print_booking_3";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==8)
									{
										$action_type="show_fabric_booking_report";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==9)
									{
										$action_type="show_fabric_booking_report3";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==244)
									{
										$action_type="show_fabric_booking_report_ntg";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==46)
									{
										$action_type="show_fabric_booking_report_urmi";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==86) //Main Fabric Booking
								{
									if($first_print_button==1)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report_gr"; else $action_type="show_fabric_booking_report"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}
									else if($first_print_button==73)
									{
										 $action_type="show_fabric_booking_report_b6"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
									else if($first_print_button==53)
									{
										 $action_type="show_fabric_booking_report_jk"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
									else if($first_print_button==45)//
									{
										 $action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
									else if($first_print_button==28)//show_fabric_booking_report_akh
									{
										 $action_type="show_fabric_booking_report_akh"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
								}
								else if($row["entry_form"]==271) //Woven Partial Fabric Booking
								{
									//$variable=$row[("booking_no_prefix_num")];
									//echo $first_print_button.'D';
									if($part_first_print_button==143)
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										
										//part_first_print_button $row["entry_form"]
									}
									else if($part_first_print_button==84)
									{
										
										$action_type="show_fabric_booking_report_urmi_per_job";											
										$variable="<a href='##'  title='PB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." <a/>";			
									}
									else if($part_first_print_button==85)
									{
										$action_type="print_booking_3";
										 
										$variable="<a href='##'  title='PB F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";	
									}
									else if($part_first_print_button==151)
									{
										$action_type="show_fabric_booking_report_advance_attire_ltd";
										
										$variable="<a href='##'  title='PFC F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($part_first_print_button==160)
									{
										$action_type="print_booking_5";  
										$variable="<a href='##' title='PFC F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	    
									}
									else if($part_first_print_button==175)
									{
									   $action_type="print_booking_6";
										
										$variable="<a href='##' title='FB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($part_first_print_button==155)
									{
										$action_type="fabric_booking_report";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==160) //Woven Partial Start
									{
										$action_type="print_booking_5";  
										$variable="<a href='##' title='PFC F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]." </a>";	
									}
									else if($woven_part_first_print_button==143)
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										
										//part_first_print_button $row["entry_form"]
									}
									else if($woven_part_first_print_button==84)
									{
										
										$action_type="show_fabric_booking_report_urmi_per_job";											
										$variable="<a href='##'  title='PB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]." <a/>";			
									}
									else if($woven_part_first_print_button==85)
									{
										$action_type="print_booking_3";
										 
										$variable="<a href='##'  title='PB F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";	
									}
									else if($woven_part_first_print_button==151)
									{
										$action_type="show_fabric_booking_report_advance_attire_ltd";
										
										$variable="<a href='##'  title='PFC F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									
									else if($woven_part_first_print_button==175)
									{
									   $action_type="print_booking_6";
										
										$variable="<a href='##' title='FB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==155)
									{
										$action_type="fabric_booking_report";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==72) //
									{
										$action_type="print6booking";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==84) //
									{
										$action_type="show_fabric_booking_report_urmi_per_job";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','wvn_p')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									
								} //Woven Partial Booking end
								else if($row["entry_form"]==108) // Partial Fabric Booking
								{
									if ($part_first_print_button==143) // print 1
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==84) // print 2
									{
										$action_type="show_fabric_booking_report_urmi_per_job"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==85) // print 3
									{
										$action_type="print_booking_3"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==151) // print 4
									{
										$action_type="show_fabric_booking_report_advance_attire_ltd"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==160) // print 5
									{
										$action_type="print_booking_5"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==175) // print 6
									{
										$action_type="print_booking_6"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==218) // print 7
									{
										$action_type="print_booking_7"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==220) // print 8
									{
										$action_type="print_booking_northern_new"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==235) // print 9
									{
										$action_type="print_booking_northern_9"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==274) // print 10
									{
										$action_type="print_booking_10"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==241) // print 11
									{
										$action_type="print_booking_11"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==269) // print 12
									{
										$action_type="print_booking_12"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==28) // print 13
									{
										$action_type="print_booking_13"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==280) // print 14
									{
										$action_type="print_booking_14"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==304) // print 15
									{
										$action_type="print_booking_15"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==719) // print 16
									{
										$action_type="print_booking_16"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==723) // print 17
									{
										$action_type="print_booking_17"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==339) // print 18
									{
										$action_type="print_booking_18"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==370) // print 19
									{
										$action_type="print_booking_19"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==768) // print 20
									{
										$action_type="print_booking_20"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
								}
								else
								{
									if($row[("booking_type")]==4 && $row[("is_short")]=="")
									{  
										$page_name="Sample Fabric Booking Without order";
										// echo $samp_booking_without_first_print_button.'F'.$row[("is_short")].'<br>';
										if($sample_booking_without_print_ids[0]==64) //Metro
										{
											$action_type="show_fabric_booking_report5";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==37) //Akh
										{
											$action_type="show_fabric_booking_report4";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==36) //Amana
										{
											$action_type="show_fabric_booking_report3"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==34) //Print Booking
										{
											$action_type="show_fabric_booking_report"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==35) //Print Booking2
										{
											$action_type="show_fabric_booking_report2"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==72) //Print FFl
										{
											$action_type="show_fabric_booking_report6"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==174) //Print UG
										{
											$action_type="show_fabric_booking_report7"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
									}
									if($row[("booking_type")]==4 && $row[("is_short")]==2) //Sample Booking with order
									{  
										$page_name="Sample Fabric Booking With order";
										// echo $samp_booking_without_first_print_button.'F'.$row[("is_short")].'<br>';
										if($samp_booking_with_first_print_button==38) //Print Booking
										{
											$action_type="show_fabric_booking_report";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(89,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($samp_booking_without_first_print_button==39) //Print Booking2
										{
											$action_type="show_fabric_booking_report2";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(89,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($samp_booking_without_first_print_button==64) //Metro
										{
											$action_type="show_fabric_booking_report3"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(89,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($samp_booking_with_first_print_button==16) //Print Booking3
										{
										
											$action_type="show_fabric_booking_report_print_booking_3"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no")]."<a/>";
										}
										else if($samp_booking_with_first_print_button==177) //Print Booking4
										{
										
											$action_type="show_fabric_booking_report4"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no")]."<a/>";
										}
										else $variable=$row[("booking_no")];
									}
								}
							} //Fabric Booking End

							if ($cbo_category==2)
							{
								//echo $print_button_first.'D';


								if($print_button_first==50){$action='preCostRpt'; } //report_btn_1;
								else if($print_button_first==51){$action='preCostRpt2';} //report_btn_2;
								else if($print_button_first==52){$action='bomRpt';} //report_btn_3;
								else if($print_button_first==63){$action='bomRpt2';} //report_btn_4;
								else if($print_button_first==156){$action='accessories_details';} //report_btn_5;
								else if($print_button_first==157){$action='accessories_details2';} //report_btn_6;
								else if($print_button_first==158){$action='preCostRptWoven';} //report_btn_7;
								else if($print_button_first==159){$action='bomRptWoven';} //report_btn_8;
								else if($print_button_first==170){$action='preCostRpt3';} //report_btn_9;
								else if($print_button_first==171){$action='preCostRpt4';} //report_btn_10;
								else if($print_button_first==173){$action='preCostRpt5';} //report_btn_10;
								else if($print_button_first==211){$action='mo_sheet';}
								else if($print_button_first==142){$action='preCostRptBpkW';}
								else if($print_button_first==197){$action='bomRpt3';}
								else if($print_button_first==192){$action='checkListRpt';}
								else if($print_button_first==221){$action='fabric_cost_detail';}
								else if($print_button_first==238){$action='summary';}
								else if($print_button_first==215){$action='budget3_details';}
								else if($print_button_first==270){$action='preCostRpt6';}
								else if($print_button_first==129){$action='budget5';}
								else if($print_button_first==730){$action='budgetsheet';}

							}
							
						
							if($row[("fabric_source")]==2)
							{
								$rcv_date_arr=array_unique(explode(",",chop($receive_data[$row[("booking_id")]][$row[("type")]],",")));
								if($row[("booking_type")]==1 && $row[("is_short")]==2)
								{
									$summer_data[1]["book_qnty"]+=$row[("fin_fab_qnty")];
									
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[1]["rcv_qnty_intime"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[1]["rcv_qnty"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								else if($row[("booking_type")]==1 && $row[("is_short")]==1)
								{
									$summer_data[2]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[2]["rcv_qnty_intime"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[2]["rcv_qnty"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								else if($row[("booking_type")]==4 )
								{
									$summer_data[3]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[3]["rcv_qnty_intime"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[3]["rcv_qnty"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
							}
							else if($row[("fabric_source")]==1)
							{
								$rcv_date_arr=array_unique(explode(",",chop($receive_data_pord[$row[("booking_id")]][$row[("type")]],",")));
								if($row[("booking_type")]==1 && $row[("is_short")]==2)
								{
									$summer_data[1]["book_qnty"]+=$row[("fin_fab_qnty")];
									
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[1]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[1]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								else if($row[("booking_type")]==1 && $row[("is_short")]==1)
								{
									$summer_data[2]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[2]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[2]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								
								else if($row[("booking_type")]==4 )
								{
									$summer_data[3]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[3]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[3]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
							}
							else if($row[("fabric_source")]==4)
							{
								$summer_data[4]["book_qnty"]+=$row[("fin_fab_qnty")];
								foreach($rcv_date_arr as $rcv_date)
								{
									if($rcv_date<=$row[("delivery_date")])
									{
										$summer_data[4]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
									$summer_data[4]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
								}
							}
							
							$supplier_name="";
							if($row[("pay_mode")]==3 || $row[("pay_mode")]==5)
							{
								$supplier_name=$company_library[$row[("supplier_id")]];
							}
							else $supplier_name=$supplierArr[$row[("supplier_id")]];
							$ready_to_approved=$row[("ready_to_approved")];
							if($ready_to_approved==1)
							{
							$last_update_date=$row[("update_date")];
							}
							//echo $variable;
							//<a href='#report_details' onClick="generate_fabric_booking_report('<? echo $row[("booking_no")];','show_trim_booking_report');"></a>
							if($row[("delivery_date")]!="" && $row[("delivery_date_dtls")]=="" )  $row[("delivery_date")]=$row[("delivery_date")];else  $row[("delivery_date")]=$row[("delivery_date_dtls")];
							
						

							$style_variable2="";

					
							if($reserved_data_arr[$row["booking_id"]]['reserve_no']>0)
							{
								$action_type="show_fabric_booking_report_print23"; 
								for($q=1; $q<=$reserved_data_arr[$row["booking_id"]]['reserve_no']; $q++)
								{
									if($style_variable2=="") $style_variable2="<a  href='##'  onClick=\"generate_fabric_report('719_last_version_details','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."','','','".$q."')\">".$q."  <a/>";
									else $style_variable2.=","."<a  href='##'  onClick=\"generate_fabric_report('719_last_version_details','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."','','','".$q."')\">".$q."  <a/>";
									
									
									/*if($variable1=="")
										$variable1="<a href='#' onClick=\"generate_worder_report_history('".$type."','".$report_type."','".$row[csf('booking_no')]."','".$row[csf('company_id')]."','".$row[csf('po_break_down_id')]."','".$row[csf('item_category')]."','".$row[csf('fabric_source')]."','".$row[csf('job_no')]."','".$row[csf('is_approved')]."','show_fabric_booking_report3','".$i."','".$q."'".")\"> ".$q."<a/>";
									else
										$variable1.=", "."<a href='#' onClick=\"generate_worder_report_history('".$type."','".$report_type."','".$row[csf('booking_no')]."','".$row[csf('company_id')]."','".$row[csf('po_break_down_id')]."','".$row[csf('item_category')]."','".$row[csf('fabric_source')]."','".$row[csf('job_no')]."','".$row[csf('is_approved')]."','show_fabric_booking_report3','".$i."','".$q."'".")\"> ".$q."<a/>";*/
								}
							}



						if($wo_type=="Main"){
							if ($row[("type")]==0){
							$action_type="show_fabric_booking_report_print20"; 
							$style_variable="<a  href='##'  onClick=\"generate_fabric_report('719','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$style_ref_no."  <a/>";
						
							}else{
								$action_type="show_fabric_booking_report_print20"; 
								$style_variable="<a  href='##'  onClick=\"generate_fabric_report('719','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$nonStyleArr[$style_ref_no]."  <a/>";
							}	
							
						}else{
							if ($row[("type")]==0){
								$style_variable=$style_ref_no;
							}else{
								$style_variable=$nonStyleArr[$style_ref_no];
								}	
						}
							?>
							<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
								<td width="30"><? echo $i;?></td>
								<td width="100" align="center"><p><? echo $company_library[$row[("company_id")]]; ?></td>	
								<td width="100"><p><? echo $supplier_name; ?></p></td>
								<td width="100"><p><? echo $buyerArr[$row[("buyer_id")]]; ?></p></td>
								<td width="60"><? echo $job_year; ?></td>
								<?
								if($cbo_category==2)
								{?>
								<td width="70"><div style="word-wrap:break-word; width:70px">
								<a style="word-break: break-all;color: <? echo $style_color ?>" href='#report_details' onClick="generate_report('<? echo $cbo_company; ?>','<? echo $job_number; ?>','<? echo $action;?>','<? echo $row[('buyer_id')];?>','<? echo $style_ref_no;?>');"><? echo $job_no; ?></a>
								</div></td>
								<?
								}
								else
								{?>

							<td width="70"><div style="word-wrap:break-word; width:70px"><? echo $job_no; ?></div></td>

								<? } ?>
								<td width="100"><? echo $style_variable2;//$row[("job_no_prefix_num")]; ?></td>
								<td width="100"><p><?=  $style_variable  ?></p></td>                                
								<td width="60" align="center" title="Entry Form=<? echo $row["entry_form"];?>"><? echo $variable; ?><? //echo $row[("booking_no_prefix_num")];?></td>
								<td width="60" align="center"><p><? echo $row[("year_book")]; ?></td>
								<td width="70" align="center"><p><? echo change_date_format($row[("booking_date")]); ?></p></td>
								<td width="100"><p><? echo $wo_type;?></p></td>
                                <td width="70" align="center"><p><? echo $pay_mode[$row[("pay_mode")]]; ?></td>	

                                <?
								if ($cbo_category==3 || $cbo_category==2)
								{
									$pi_id=$pi_no_arr[$row[("booking_no")]]['pi_id'];
									?>
										<td width="100" align="center" title="<? echo 'Pi='.$pi_id.', Booking-'.$row[("booking_no")]; ?>"><p><? echo $pi_no_arr[$row[("booking_no")]]['pi_no']; ?></td>
									<? 
								}
								?>                                

					
								<td width="70" align="center"><p><?  $update_date=explode(" ",$row[("update_date")]);echo change_date_format($update_date[0])//echo change_date_format($wo_last_date_arr[$row[("booking_id")]]); ?></p></td>
								<td width="70" align="center"><p><? echo change_date_format($row[("delivery_date")]); ?></p></td>
								<td width="70" align="center"><p><? echo change_date_format($row[("sup_rev_date")]); ?></p></td>
								<td width="70" align="center"><p>
								<? 
								$lead_time=0;
								if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00")
								{
									$lead_time=datediff("d", $row[("booking_date")], $row[("delivery_date")]);
								}
								if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day";
								?></p></td>
								
                                
								<td width="100" align="center"><? echo $yes_no[$row[("ready_to_approved")]]; ?></td>
                              
								 <td width="100" align="center"><? $last_update_date=explode(" ",$last_update_date);echo change_date_format($last_update_date[0]).'<br>'.$last_update_date[1]; ?></td>
								
							 
								<td width="80"><p><? 
								$approval_typ_arr = array(0 => "Un-Approved", 1 => "Approved",2 => "Un-Approved", 3 => "Approved");
								echo $approval_typ_arr[$row[("is_approved")]]; ?></p></td>
                                <?
                                $approved_date=$last_app_arr[$row[("booking_id")]]['approved_date'];
								$approved_by=$last_app_arr[$row[("booking_id")]]['approved_by'];
								?>
                                 <td width="100" title="bookingId=<? echo $row[("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                                
                                 
								<td width="100"><p><? echo $printButton.$ref; ?></p></td>
								<td width="100"><p><? echo $file; ?></p></td>
								<td width="70"><p><? echo $season_buyer;//$row[("job_no_prefix_num")]; ?>&nbsp;</p></td>
								<td width="100"><p><? echo $po_number; ?></p></td>
								<td width="100"><p>
								<?
								if ($row[("type")]==0)
								{
									// echo "Max - ". $max_ship_date;
									echo " ". $max_ship_date;
									$order_count=explode(",",$po_number);
									// if(count($order_count)>1) echo "<br> Min  - " . $min_ship_date; 
									if(count($order_count)>1) echo "<br> " . $min_ship_date; 
								}
								?></p></td>
								<td width="80"><p><? echo $item_category[$row[("item_category")]]; ?></p></td>
								<? 
								//booking_id
								$td_color="";
								if($row[("booking_type")]==2)
								{
									if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00" && $first_rec_date[$row[("booking_id")]]!="" && $first_rec_date[$row[("booking_id")]]!="0000-00-00")
									{
										if(strtotime($first_rec_date[$row[("booking_id")]])>strtotime($row[("delivery_date")])) $td_color='bgcolor="#FF0000"'; else $td_color='';
									}
									$first_rcv_date=change_date_format($first_rec_date[$row[("booking_id")]]);
								}
								else if($row[("booking_type")]==1 || $row[("booking_type")]==4)
								{
									if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00" && $first_rec_date_prod[$row[("booking_id")]]!="" && $first_rec_date_prod[$row[("booking_id")]]!="0000-00-00")
									{
										if(strtotime($first_rec_date_prod[$row[("booking_id")]])>strtotime($row[("delivery_date")])) $td_color='bgcolor="#FF0000"'; else $td_color='';
									}
									if ($cbo_category==3) //Woven Fabric
									{
										//echo $first_rec_date[$pi_id].'==AA'.$pi_id;
										$first_rcv_date=change_date_format($first_rec_date[$pi_id]);
									}
									else
									{
									$first_rcv_date=change_date_format($first_rec_date_prod[$row[("booking_id")]]);
									}
								}
								 //echo $row[("booking_type")]."***".$row[("type")] ;
								?>
								<td width="70" title="<? echo "Booking No : ".$booking_data[$row[("booking_id")]]["booking_no"].",\nBooking Type:".$row[("booking_type")]."\nFirst Receive No:".$first_rec_no[$row[("booking_id")]];  ?>" align="center" <? echo $td_color; ?> ><p><? echo $first_rcv_date; ?></p></td>
								<?
								if ($cbo_category==4)
								{
									?>
										<td width="100" align="right"><? echo number_format($row[("amount")],2); ?></td>
									<?
								}
								else
								{
									?>
										<td width="100" align="right"><? echo number_format($row[("fin_fab_qnty")],2); ?></td>
										<?
										if ($cbo_category==3) 
										{
											$tot_grey_fab_qnty+=$row[("amount")];
											?>
											<td width="100" align="right"><? echo number_format($row[("amount")],2); ?> </td>
											<?
										}
										else
										{
											$tot_grey_fab_qnty+=$row[("grey_fab_qnty")];
											?>
											<td width="100" align="right"><? echo number_format($row[("grey_fab_qnty")],2); ?></td>
											<?
										}
								}
								
									?>
									<td width="80"><p><? echo number_format($sample_qnt,2); ?></p></td>
									<td width="80"><p><? echo $dept_name; ?></p></td>
									<td width="80"><p><? echo $short_reason; ?></p></td>
									<td width="100"><?=$row[("team_leader")];?></td>	
								    <td width="">&nbsp;&nbsp;&nbsp;&nbsp;<? //echo $row[("po_number")]; ?></td>
							</tr>
							<?
							$tot_wo_qnty+=$row[("amount")];
							$tot_fin_fab_qnty+=$row[("fin_fab_qnty")];
							
							$i++;
						
						}
					}
					else
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$print_report_format_ids=$print_report_format_arr[$cbo_company];
						$format_ids=explode(",",$print_report_format_ids);
					
						$first_print_button=array_shift($format_ids);
						$second_print_button= array_shift($format_ids);
						if ($row[("type")]==0)
						{	
							if ($row[("booking_type")]==1 || $row[("booking_type")]==2  || $row[("booking_type")]==3  || $row[("booking_type")]==6)
							{
								if ($row[("is_short")]==1)
								{
									$wo_type="Short";
									$wo_typw_id=1;
								}
								else
								{
									$wo_type="Main";
									$wo_typw_id=2;
								}
							}
							elseif($row[("booking_type")]==4)
							{
								$wo_type="Sample With Order";
								$wo_typw_id=3;
							}
						}
						else
						{
							$wo_type="Sample Non Order";
							$wo_typw_id=4;
						}
						$ready_to_approved=$row[("ready_to_approved")];
						if($ready_to_approved==1)
						{
						$last_update_date=$row[("update_date")];
						}
						// echo $wo_typw_id.'ssd';
						$job_no=$style_ref_no=$po_number=$file=$ref=$job_number="";
						$p=1;
						$ship_date_arr=array_unique(explode(",",chop($row[("pub_shipment_date")],",")));
						foreach($ship_date_arr as $ship_date)
						{
							if($p==1)
							{
								$min_ship_date=$ship_date;
								$max_ship_date=$ship_date;
							}
							
							if($min_ship_date>$ship_date) $min_ship_date=$ship_date;
							if($max_ship_date<$ship_date) $max_ship_date=$ship_date;
							$p++;
						}
						
						$all_po_id=implode(",",array_unique(explode(",",chop($row[("po_break_down_id")],","))));
						$job_no=implode(",",array_unique(explode(",",chop($row[("job_no_prefix_num")],","))));
						$season_buyer=implode(",",array_unique(explode(",",chop($row[("season_buyer_wise")],","))));
						//echo $season_buyer.'DDDD';
						$job_number=implode(",",array_unique(explode(",",chop($row[("job_no")],","))));
						$style_ref_no=implode(",",array_unique(explode(",",chop($row[("style_ref_no")],","))));
						$po_number=implode(", ",array_unique(explode(",",chop($row[("po_number")],","))));
						$file=implode(",",array_unique(explode(",",chop($row[("file_no")],","))));
						$ref=implode(",",array_unique(explode(",",chop($row[("grouping")],","))));
						$short_reason=implode(",",array_unique(explode(",",chop($row[("reason")],","))));
						$dept_name=implode(",",array_unique(explode(",",chop($row[("dept_name")],","))));
					    $job_year=implode(",",array_unique(explode(",",chop($row[("job_year")],","))));
					    $cbo_company=$row[("company_id")];
						$print_report_format_ids=$print_report_format_arr[$cbo_company];
						$format_ids=explode(",",$print_report_format_ids);
						$first_print_button=array_shift($format_ids);
						$second_print_button= array_shift($format_ids);
						//echo $cbo_company.'='.$first_print_button;
						$knit_print_report_format_ids=$multi_knit_print_report_format_arr[$cbo_company];
						$knit_format_ids=explode(",",$knit_print_report_format_ids);
						$knit_first_print_button=array_shift($knit_format_ids);
						
						$trim_format_ids=explode(",",$trim_print_report_format_arr[$cbo_company]);
						$trim_format_ids2=explode(",",$trim_print_report_format_arr2[$cbo_company]);
						$trim_first_print_button=array_shift($trim_format_ids);
							//$trim_second_print_button= array_shift($trim_format_ids2);
					 //	echo $row[("entry_form")].'d'.$knit_first_print_button;
						
						if($cbo_category==4) //Accessories Start
						{
							//echo $first_print_button.'kk';
							if($first_print_button==13 && $row["entry_form"]==272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($first_print_button==13 && $row["entry_form"]==262)
							{ 
							//echo $first_print_button.$row["entry_form"].'kk';
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($first_print_button==13 && $row["entry_form"]!=272 && $row["entry_form"]!=262)
							{ 
								$variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($first_print_button==14 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==15 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==16 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==17 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==18 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==19 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							
							$print_report_format_ids26=$print_report_format_arr26[$cbo_company];
							$format_ids26=explode(",",$print_report_format_ids26);
							//echo $format_ids26[0].'D'. $row[("entry_form")];
							if($format_ids26[0]==67 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==746 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report7','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==183 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==177 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report9','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==209 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==85 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report8','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==235 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==174 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report7','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==274 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report10','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==768 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_fabric_booking_report_print20','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==404 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report21','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==419 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report22','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							else if( $row["entry_form"]==272 && $variable==$row[("booking_no_prefix_num")] )
							{
								if($format_ids26[0]==67 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==183 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==177 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==209 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print_t','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==85 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report8','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==235 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==174 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report7','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==274 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report10','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
							}
							//else $variable=$row[("booking_no")];
						}
						else if($cbo_category==25)
						{
							
							if($row[("entry_form")]==201)
							{
							$variable="<a href='##' title='Print Actual' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."','".$row[("supplier_id")]."')\" >".$row[("booking_no_prefix_num")]." </a>"; //actual print
							}
							else
							{
								$variable="<a href='##' title='Print Actual' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."','".$row[("supplier_id")]."')\" >".$row[("booking_no_prefix_num")]." </a>";
							}
						}
						else if($cbo_category==12) //Service Fab. Booking...
						{
							
							$format_ids_aop=explode(",",$print_report_format_aop);
							$first_print_button_aop=array_shift($format_ids_aop);
							//echo $wo_typw_id.'=='.$row[("entry_form")].',';
							if($first_print_button==11)
							{ 
							 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==12)
							{ 
							 $variable="<a href='##' title='PB1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==59)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button_aop==164)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button_aop==163)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($row[("entry_form")]==228) //Multi Job Wise service Booking Knitting
							{
								if($knit_first_print_button==13)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==15)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==16)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report3','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==177)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report4','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==175)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report5','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==176)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report6','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button=='')
								{ 
								 $variable=$row[("booking_no_prefix_num")];
								}								
							}
							
						}
						if($row[("entry_form")]==178){
							$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
						}elseif($row["entry_form"]==262){
							$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
						}


						//$conversion_cost_head_array
						$process_id_all=array_unique(explode(",",chop($row[("process")],",")));
						$all_process="";
						foreach($process_id_all as $process_id)
						{
							$all_process.=$conversion_cost_head_array[$process_id].",";
						}
						$all_process=chop($all_process,",");
						
						$supplier_name="";
						if($row[("pay_mode")]==3 || $row[("pay_mode")]==5)
						{
							$supplier_name=$company_library[$row[("supplier_id")]];
						}
						else $supplier_name=$supplierArr[$row[("supplier_id")]];
						//echo $row[("currency_id")];.// $row[("booking_date")]
						if($row[("booking_type")]==2  && $row[("entry_form")]==43 )  $row[("delivery_date")]=$row[("delivery_date_dtls")];else  $row[("delivery_date")]=$row[("delivery_date_dtls")];
						
						$piWoNo="";
						?>
						<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
							<td width="30"><? echo $i;?></td>
							<td width="100" align="left" style="word-break:break-all"><div style="word-wrap:break-word; width:100px"><? echo $company_library[$cbo_company]; ?></div></td>
							<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $supplier_name; ?></div></td>
							<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $buyerArr[$row[("buyer_id")]]; ?></div></td>
							<td width="60"><div style="word-wrap:break-word; width:60px"><? echo $job_year; ?></div></td>
							<td width="70"><div style="word-wrap:break-word; width:60px"><? echo $job_no;?></div></td>
							<td width="100"><div style="word-wrap:break-word; width:100px"><?  ?>&nbsp;</div></td>
							<td width="100"><div style="word-wrap:break-word; width:100px"><? if ($row[("type")]==0) echo $style_ref_no; else echo $nonStyleArr[$style_ref_no]; ?>&nbsp;</div></td>
							<td width="60" align="center" title="<?=$row['entry_form']?>"><div style="word-wrap:break-word; width:60px"><? echo $variable;?></div></td>
							<td width="60" align="center"><div style="word-wrap:break-word; width:60px"><? echo $row[("year_book")]; ?></div></td>
                            <td width="70" align="center"><div style="word-wrap:break-word; width:70px"><? echo change_date_format($row[("booking_date")]);?></div></td>	
							<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $wo_type;?></div></td>

                            <td width="70" align="center"><div style="word-wrap:break-word; width:70px"><? echo $pay_mode[$row[("pay_mode")]]; ?></div></td>						
                            <?
							if($cbo_category==12)
							{?>
								<td width="100" align="center" title="<? echo 'Pi='.$pi_id.', Booking-'.$row[("booking_no")]; ?>"><div style="word-wrap:break-word; width:100px"><? echo $pi_no_arr[$row[("booking_no")]]['pi_no']; ?></div></td>
                                <td width="100"><div style="word-wrap:break-word; width:100px"><? echo $all_process; ?>&nbsp;</div></td>
                                <?
							}
							else if($cbo_category==4)
							{
								$piWoNo=implode(",",array_unique(array_filter(explode("__",$wopi_arr[$row["booking_no"]]))));
								?>
                                <td width="100" align="center"><div style="word-wrap:break-word; width:100px"><? echo $piWoNo; ?></div> </td>
                                <td width="100" align="center"><div style="word-wrap:break-word; width:100px"><? echo $btb_pi[$piWoNo]['lc_number'] ?></div> </td>
                                <td width="100" align="center"><div style="word-wrap:break-word; width:100px"><? echo $lc_type[$btb_pi[$piWoNo]['lc_type_id']]; ?></div> </td>
                                <td width="100" align="center"><div style="word-wrap:break-word; width:100px"><? echo $pay_term[$btb_pi[$piWoNo]['payterm_id']]; ?></div> </td>
                                <td width="100" align="center"><div style="word-wrap:break-word; width:100px"><? echo $btb_pi[$piWoNo]['tenor']; ?></div> </td>
                                <?
							}else if($cbo_category==25)
							{
								?>
                                <td width="100"><div style="word-wrap:break-word; width:100px"><? echo $pi_no_arr[$row[("booking_no")]]['pi_no']; ?></div></td>
                                <?
							}
							?>
						
							<td width="70" align="center"><div style="word-wrap:break-word; width:70px"><? echo change_date_format($row[("update_date")]); ?></div></td>
							<td width="70" align="center"><div style="word-wrap:break-word; width:70px"><? echo change_date_format($row[("delivery_date")]); ?></div></td>
							<td width="70" align="center"><div style="word-wrap:break-word; width:70px"><? echo change_date_format($row[("sup_rev_date")]); ?></div></td>
							<td width="70" align="center"><div style="word-wrap:break-word; width:70px">
							<?
							$lead_time=0;
							if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00")
							{
								$lead_time=datediff("d", $row[("booking_date")], $row[("delivery_date")]);
							}
							if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day";
							?></div></td>
						
							<td width="100" title="MSg=<? echo $row[("ready_to_approved")];?>" align="center"><div style="word-wrap:break-word; width:100px"><? echo $yes_no[$row[("ready_to_approved")]]; ?></div></td>
                             <td width="100" align="center"><div style="word-wrap:break-word; width:100px"><? $last_update_date=explode(" ",$last_update_date);echo change_date_format($last_update_date[0]).'<br>'.$last_update_date[1]; ?></div></td>
							<td width="80"><div style="word-wrap:break-word; width:80px"><? echo $approval_type_arr[$row[("is_approved")]]; ?></div></td>
                             <?
								$approved_date=$last_app_arr[$row[("booking_id")]]['approved_date'];
								$approved_by=$last_app_arr[$row[("booking_id")]]['approved_by'];
							?>
                             <td width="100" title="bookingId=<? echo $row[("booking_id")];?>" align="center"><div style="word-wrap:break-word; width:100px"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></div></td>
							<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $ref; ?></div></td>
							<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $file; ?></div></td>
							<td width="70"><div style="word-wrap:break-word; width:70px"><? echo $season_buyer;?></div></td>		
							<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $po_number; ?></div></td>
							<td width="100"><div style="word-wrap:break-word; width:100px">
							<?
							if ($row[("type")]==0)
							{
								echo "Max - ". $max_ship_date;
								$order_count=explode(",",$po_number);
								if(count($order_count)>1) echo "<br> Min  - " . $min_ship_date; 
							}
							?></div></td>
							<td width="80"><div style="word-wrap:break-word; width:80px"><? echo $item_category[$row[("item_category")]]; ?></div></td>
							<? 
							$td_color="";
							
							if(strtotime($first_rec_date[$row[("booking_id")]])>strtotime($row[("delivery_date")])) $td_color='bgcolor="#FF0000"'; else $td_color='';
							$first_rcv_date=change_date_format($first_rec_date[$row[("booking_id")]]);
							?>
							<td width="70" title="<? echo "Booking No : ".$booking_data[$row[("booking_id")]]["booking_no"]."\nFirst Receive No:".$first_rec_no[$row[("booking_id")]]; ?>" align="center" <? echo $td_color; ?> ><div style="word-wrap:break-word; width:70px"><? echo $first_rcv_date;  ?></div></td>
							<?
								if ($cbo_category==4)
								{
									$usd_id=2;
									if($db_type==0) $conversion_date=change_date_format($row[("booking_date")], "Y-m-d", "-",1);
									else $conversion_date=change_date_format($row[("booking_date")], "d-M-y", "-",1);
									$currency_rate=set_conversion_rate($usd_id,$conversion_date );
									if($row[("currency_id")]==2) $wo_currency_usd_amt=$row[("amount")];//USD
									else $wo_currency_usd_amt=$row[("amount")]/$currency_rate;
									$rec_amt=0;
									$rec_amt=$rec_amt_arr[$row["booking_id"]];
									$rec_currency=$rec_currency_arr[$row["booking_id"]];
									$rec_date=$first_rec_date[$row["booking_id"]];
									if($rec_currency==2) $recv_usd_amt=$rec_amt;//USD
									else $recv_usd_amt=$rec_amt/$currency_rate;
									?>
										<td width="100" align="right"><div style="word-wrap:break-word; width:100px"><? echo number_format($row[("amount")],2); ?></div></td>
                                        <td width="100" align="right" title="Exchange Rate=<? echo $currency_rate;?>"><div style="word-wrap:break-word; width:100px"><? echo number_format($wo_currency_usd_amt,2); ?></div></td>
                                        <td width="100" align="right"><div style="word-wrap:break-word; width:100px"><? echo number_format($rec_amt,2); ?></div></td>
                                        <td width="100" align="right"><div style="word-wrap:break-word; width:100px"><? echo number_format($recv_usd_amt,2); ?></div></td>
									<?
								}
								else
								{
									$currency_id=$row[("currency_id")];
									if($cbo_category==25 && $currency_id==1)
									{	
									$cid=2;
									$ex_rate=set_conversion_rate($cid, $row[("booking_date")],$cbo_company);
									$wo_amount=$row[("amount")]/$ex_rate;
									} else $wo_amount=$row[("amount")];
									?>
										<td width="100" align="right"><? if ($cbo_category==25 || $cbo_category==12 ) echo number_format($row[("wo_qnty")],2); else echo number_format($row[("fin_fab_qnty")],2); ?></td>
                                        <?
                                        if($cbo_category==25)
										{
										?>
										<td width="100" align="right" title="<? echo $ex_rate;?>"><?  echo number_format($wo_amount,2); ?></td>
									<?
										}
										else
										{ ?>
											<td width="100" align="right"><? if ($cbo_category==25 || $cbo_category==12) echo number_format($row[("wo_qnty")],2); else echo number_format($row[("grey_fab_qnty")],2); ?></td>
									<?	}
								}
								if ($cbo_category==2)
								{
									?>
									<td width="80"><div style="word-wrap:break-word; width:100px"><?=number_format($sample_qnt,2)?></div></td>
									<td width="80"><p>&nbsp; </p></td>
									<td width="80"><p><? echo $short_reason; ?></p></td>
									<?
								}
							?>
							<td width="80">&nbsp;&nbsp;&nbsp;&nbsp;<? //echo $row[("po_number")]; ?></td>
							<td width="80">&nbsp;&nbsp;&nbsp;&nbsp;<? //echo $row[("po_number")]; ?></td>
							<td width="80">&nbsp;&nbsp;&nbsp;&nbsp;<? //echo $row[("po_number")]; ?></td>
							<td width="100">&nbsp;&nbsp;&nbsp;&nbsp;<? //echo $row[("po_number")]; ?></td>
							<td width="">&nbsp;&nbsp;&nbsp;&nbsp;<? //echo $row[("po_number")]; ?></td>
						</tr>
						<?
						$tot_wo_qnty+=$row[("amount")];
						$tot_rec_amt+=$rec_amt;
						
						$tot_wo_currency_usd_amt+=$wo_currency_usd_amt;
						$tot_recv_usd_amt+=$recv_usd_amt;
						
						if ($cbo_category==25 || $cbo_category==12)//Embllishment
						{
							$tot_fin_fab_qnty+=$row[("wo_qnty")];
							$tot_grey_fab_qnty+=$row[("wo_qnty")];
							$tot_embl_wo_amount+=$wo_amount;
						}
						else
						{
							$tot_fin_fab_qnty+=$row[("fin_fab_qnty")];
							$tot_grey_fab_qnty+=$row[("grey_fab_qnty")];
							$tot_embl_wo_amount+=$wo_amount;
						}
						$i++;
					}
				}
				?>
				</table>
				<table class="rpt_table" width="<? echo $tbl_width; ?>" cellpadding="0" cellspacing="0" border="1" rules="all">
					<tfoot>
						<th width="30">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<?
							if ($cbo_category==3 || $cbo_category==2 || $cbo_category==25 || $cbo_category==4)
							{
								?>
								<th width="100"></th>
								<?
							}

							if ($cbo_category==4)
							{
								?>
								<th width="100"></th>
								<th width="100"></th>
								<th width="100"></th>
								<th width="100"></th>
								<?
							}

							if ($cbo_category==12)
							{
								?>
								<th width="100"></th>
								<th width="100"></th>
								<?
							}
						
						?>
						<th width="70"></th>
						<th width="70"></th>
						<th width="70"></th>
						<th width="70"></th>
						<th width="100"></th>
						<th width="100"></th>
						<th width="80"></th>
						<th width="100"></th>
						<th width="100"></th>
						<th width="100"></th>
						<th width="70"></th>
						<th width="100"></th>
						<th width="100"></th>
						<th width="80"></th>
						<th width="70">Total</th>

						<?
							if ($cbo_category==4)
							{
								?>
									<th width="100" align="right" id=""><??></th>
                                    <th width="100" align="right" id=""><? echo number_format($tot_wo_currency_usd_amt,2); ?></th>
                                    <th width="100" align="right" id=""><??></th>
                                    <th width="100" align="right" id=""><? echo number_format($tot_recv_usd_amt,2); ?></th>
									
								<?
							}
							else
							{							
								?>
									<th width="100" align="right"  id="value_grnad_total_wo_qty"><? echo number_format($tot_fin_fab_qnty,2); ?></th>
                                    <?
                                    if ($cbo_category==3 || $cbo_category==25)//Emblishment 
									{
									?>
									<th width="100" id="value_grnad_total_wo_val" align="right" ><? echo number_format($tot_embl_wo_amount,2); ?></th>
									<?
									}
									else
									{ ?>
										<th width="100" align="right" id="value_grnad_total_wo_val"><? echo number_format($tot_grey_fab_qnty,2); ?></th>
									<? }
							}
						if($cbo_category==2)//Knit Fab
						{
							?>    
							<th width="80" > <?=number_format($tot_sample,2);?></th>
							<!-- <th width="80">&nbsp;</th>
							<th width="80">&nbsp;</th> -->
							<?
						}
						?>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;&nbsp;&nbsp;&nbsp;</th>
						<th width="80">&nbsp;&nbsp;&nbsp;&nbsp;</th>
						<th width="100">&nbsp;&nbsp;&nbsp;&nbsp;</th>
						<th width="">&nbsp;&nbsp;&nbsp;&nbsp;</th>
					</tfoot>
				</table>
			</div>
            <br>
            <?
			
			if ($cbo_category==2)
			{
				?>
                <table class="rpt_table" width="600" cellpadding="0" cellspacing="0" border="1" rules="all">
                	<thead>
                    	<tr bgcolor="#CCCCCC">
                                <td colspan="6" align="center" style="font-size:16px; font-weight:bold;">Finish Fabric OTD Summary</td>
                            </tr>
                    	<tr>
                        	<th width="100">WO Type</th>
                            <th width="100">Required Qty.</th>
                            <th width="100">On Time Rcvd Qty</th>
                            <th width="100">Total Rcvd Qty</th>
                            <th width="100">Balance</th>
                            <th >OTD %</th>
                        </tr>
                    </thead>
                    <tbody>
                    	<?
						$wo_type_arr=array(1=>"Main",2=>"Short",3=>"Sample",4=>"Non Ord Sample");
						foreach($summer_data as $wo_type=>$val)
						{
							$balance=$val["book_qnty"]-$val["rcv_qnty"];
							$otd_percent=(($val["rcv_qnty_intime"]/$val["book_qnty"])*100);
							?>
                            <tr>
                                <td><? echo $wo_type_arr[$wo_type]; ?></td>
                                <td align="right"><? echo number_format($val["book_qnty"],2); $tot_book_qnty+=$val["book_qnty"]; ?></td>
                                <td align="right"><? echo number_format($val["rcv_qnty_intime"],2); $tot_rcv_qnty_intime+=$val["rcv_qnty_intime"];  ?></td>
                                <td align="right"><? echo number_format($val["rcv_qnty"],2); $tot_rcv_qnty+=$val["rcv_qnty"];  ?></td>
                                <td align="right"><? echo number_format($balance,2); $tot_balance+=$balance;  ?></td>
                                <td align="right"><? echo number_format($otd_percent,2); ?></td>
                            </tr>
                            <?
						}
						?>
                    </tbody>
                    <tfoot>
                    	<tr>
                        	<th>Total</th>
                            <th><? echo number_format($tot_book_qnty,2); ?></th>
                            <th><? echo number_format($tot_rcv_qnty_intime,2); ?></th>
                            <th><? echo number_format($tot_rcv_qnty,2); ?></th>
                            <th><? echo number_format($tot_balance,2); ?></th>
                            <th>&nbsp;</th>
                        </tr>
                    </tfoot>
                </table>
                <?
			}
			?>
		</fieldset>
		<?
	}
	else if ($cbo_category==24)// Service Yarn
	{
		if($db_type==0)
		{
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and YEAR(a.insert_date)=$year_id";
		}
		elseif($db_type==2)
		{ 
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(a.insert_date,'YYYY')=$year_id";
		}
		
		if ($cbo_company==0) $company_id=""; else $company_id=" and a.company_id=$cbo_company";
		if ($cbo_buyer==0) $supplier_cond=""; else $supplier_cond=" and a.supplier_id=$cbo_buyer";
		if ($cbo_category==0) $category_id=""; else $category_id=" and a.item_category=$cbo_category";
		if ($wo_no=="") $wo_no_cond=""; else $wo_no_cond=" and a.ydw_no='$wo_no'";
		
		if ($wo_type==2) $wo_type_cond=" and a.entry_form=41"; else if ($wo_type==4) $wo_type_cond=" and a.entry_form=42"; else $wo_type_cond="";
		
		if ($job_no=="") $job_num=""; else $job_num=" and b.job_no='$job_no'";
		//if ($job_no=="") $job_num_mst=""; else $job_num_mst=" and b.job_no_mst=$job_no";
		if ($po_no=='') $po_no_no=""; else $po_no_no=" and d.po_number in ($po_no)";
		if ($hidd_po=="") $po_id=""; else $po_id=" and d.id in ( $hidd_po )";
		
		if ($hidd_po=="") $po_id_cond=""; else $po_id_cond=" and b.po_break_down_id in ( $hidd_po )";
		
		if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and d.file_no='".trim($file_no)."' "; 
		if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and d.grouping='".trim($internal_ref)."' "; 
		//echo $file_no_cond.'=='.$internal_ref_cond;die;
		
		if($db_type==0)
		{
			if($txt_date_category==1) 
			{	
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".$date_from."' and '".$date_to."'";
			}
			else 
			{
				if($txt_date_category==2) if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".$date_from."' and '".$date_to."'";
			}
		}
		if($db_type==2)
		{
			if($txt_date_category==1) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
			else if($txt_date_category==2) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
		}
	
		
		$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
		$supplierArr=return_library_array( "select id,supplier_name from lib_supplier", "id", "supplier_name");	
		$buyerArr=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
		//$nonStyleArr=return_library_array( "select id, style_ref_no from sample_development_mst", "id", "style_ref_no");		
		
		/*$sql="select a.job_no,d.id as po_id from wo_po_details_master a, wo_po_break_down d where a.job_no=d.job_no_mst and a.status_active=1 and a.is_deleted=0 and d.status_active=1 and d.is_deleted=0 $internal_ref_cond  $file_no_cond  group by a.job_no,d.id";
		$sql_result=sql_select($sql);
		$po_id_data="";$k=0;
		foreach($sql_result as $row)
		{
			if($k==0)
			{
				$po_data_cond=$row[csf('po_id')];
				 $job_data_cond=$row[csf('job_no')];
			}
			else
			{
				 $po_data_cond.=",".$row[csf('po_id')];
				 $job_data_cond.=",".$row[csf('job_no')];
			} 
		} //echo $job_data_cond;
		if($file_no_cond!="" || $internal_ref!="")
		{  
		 $po_data_file_ref=" and b.po_break_down_id in($po_data_cond) "; 
		 $job_data_file_ref=" and b.job_no in('$job_data_cond') "; 
		}
		else
		{
			$po_data_file_ref="";
			$job_data_file_ref="";
		}*/
		
		
		//var_dump($job_array);
		
		ob_start();
		?>
		<fieldset style="width:2310px">
			<table width="2290"  cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none; font-size:18px;" colspan="21">
						<? echo $company_library[str_replace("'","",$cbo_company_id)]; ?>                                
					</td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:16px; font-weight:bold" colspan="21"> <? echo $report_title; if($cbo_category!=0) echo " For ".$item_category[$cbo_category]; ?></td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:12px; font-weight:bold"  colspan="21"> <? if( $date_from!="" && $date_to!="" ) echo "From ".change_date_format($date_from)." To ".change_date_format($date_to);?></td>
				</tr>
			</table>
            <table class="rpt_table" width="2290" cellpadding="0" cellspacing="0" border="1" rules="all">
				<thead>
					<th width="30">SL</th>    
					<th width="100">Comapny</th>
					<th width="60">Wo No</th>
					<th width="60">PI No</th>
					<th width="60">Wo Year</th>
					<th width="70">Wo Date</th>
					<th width="70">Deli. Date</th>
                    <th width="70">Lead Time</th>
					<th width="100">Wo Type</th>
					<th width="100">Ready To App.</th>
                    <th width="100">Ready To Approved<br> date and time</th>
                    
					<th width="80">App. Status</th>
                    <th width="100">Last Approval <br>Date time and Person</th>
					<th width="100">Supplier</th>
					<th width="100">Buyer</th>
					<th width="110">Job No.</th>
					<th width="60">Job Year</th>
					<th width="100">Style Ref.</th>
					<th width="100">Inter. Ref.</th>
					<th width="100">File No.</th>
					<th width="100">Order No</th>
                    <th width="100">Shipment Date</th>
					<th width="80">Item Cate.</th>
					<th width="70">First Rec. Date</th>
                    <th width="100">Wo Qty</th>
                    <th width="100">W/O Value USD</th>
					<th >Remarks</th>
				</thead>
			</table>
			<div style="max-height:350px; overflow-y:scroll; width:2310px" id="scroll_body" >
				<table cellspacing="0" cellpadding="0" border="1" class="rpt_table"  width="2290" rules="all" id="table_body" >
				<?
				if ($cbo_company==0) $company_cond_id=""; else $company_cond_id=" and b.company_id=$cbo_company";
				if($cbo_category==24)
				{
					$sql="select a.id, a.ydw_no, min(b.receive_date) as receive_date from wo_yarn_dyeing_mst a,inv_receive_master b where a.ydw_no=b.booking_no and b.item_category=1  and b.receive_basis=2 and b.receive_purpose=2 $company_cond_id group by a.id, a.ydw_no";	
					$sql_result=sql_select($sql);
					foreach($sql_result as $row)
					{
						$first_rec_date[$row[csf("id")]]=$row[csf("receive_date")];
					}
				}
				if($db_type==0)
				{	
					$sql="Select a.company_id,a.id as booking_id,a.is_approved,a.ready_to_approved,a.update_date, a.entry_form, a.ydw_no,a.pay_mode, Year(a.insert_date) as year_book, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.supplier_id, b.job_no, b.uom, sum(b.yarn_wo_qty) as wo_qnty,sum(b.amount) as amount, a.currency,b.fab_booking_no from wo_yarn_dyeing_mst a, wo_yarn_dyeing_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $supplier_cond and a.item_category_id=24 $job_num $booking_date_cond $wo_no_cond $wo_type_cond group by a.company_id,a.id,a.update_date, a.entry_form, a.ydw_no, a.insert_date, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.is_approved,a.supplier_id, b.job_no, b.uom order,a.ready_to_approved,b.fab_booking_no , a.currency by a.id Desc";
				}
				else if ($db_type==2)
				{
					$sql="Select a.company_id,a.id as booking_id,a.is_approved,a.ready_to_approved,a.update_date, a.entry_form, a.ydw_no,a.pay_mode, TO_CHAR(a.insert_date,'YYYY') as year_book, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.supplier_id, b.job_no,b.job_no_id, b.uom, sum(b.yarn_wo_qty) as wo_qnty,sum(b.amount) as amount, a.currency,b.fab_booking_no from wo_yarn_dyeing_mst a, wo_yarn_dyeing_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $supplier_cond and a.item_category_id=24 $job_num $booking_date_cond $wo_no_cond $wo_type_cond group by a.company_id,a.id,a.update_date,a.entry_form, a.ydw_no,a.pay_mode, a.insert_date, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.is_approved,a.supplier_id, b.job_no,b.job_no_id, b.uom, a.ready_to_approved,a.currency,b.fab_booking_no order by a.id Desc";
				}
				//echo $sql; //die;
				//echo  $po_id ;die;
				$tot_wo_amount=0;
				$sql_result=sql_select($sql); $i=1;
				foreach ($sql_result as $row) 
				{
					$booking_id_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
					$jobId_arr[$row[csf("job_no_id")]]=$row[csf("job_no_id")];
				}

				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 1, $booking_id_arr, $empty_arr);//Book ID Ref from=1
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 2, $jobId_arr, $empty_arr);//Job ID Ref from=2
				

				$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g  where a.id=b.pi_id and b.work_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0
				and a.item_category_id=24 and a.pi_basis_id=1 
				group by  a.id,a.pi_number, b.work_order_no order by a.pi_number desc";
				$pi_sql_result=sql_select($pi_sql);
				$pi_no_arr = array();
				foreach ($pi_sql_result as $value) 
				{
					$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
					$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];
				}
				unset($pi_sql_result);
				if($db_type==0)
				{
					$job_sql="select a.job_no_prefix_num, a.job_no, a.buyer_name, Year(a.insert_date) as year, a.style_ref_no, a.garments_nature, 
					group_concat(b.id) as id,
					group_concat(b.po_number) as po_number,
					group_concat(b.file_no) as file_no,
					group_concat(b.grouping) as grouping,
					max(b.pub_shipment_date) as max_ship_date,
					min(b.pub_shipment_date) as min_ship_date
					from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.job_no_prefix_num, a.job_no, a.buyer_name, a.insert_date, a.style_ref_no, a.garments_nature";
				}
				elseif($db_type==2)
				{
					$job_sql="select a.job_no_prefix_num, a.job_no, a.buyer_name, TO_CHAR(a.insert_date,'YYYY') as year, a.style_ref_no, a.garments_nature, 
					b.id as id,
					b.po_number as po_number,
					b.file_no as file_no,
					b.grouping as grouping,
					(b.pub_shipment_date) as max_ship_date,
					(b.pub_shipment_date) as min_ship_date
					from wo_po_details_master a, wo_po_break_down b,gbl_temp_engine g where a.id=b.job_id  and a.id=g.ref_val and b.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2  and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
				}
				
				$job_sql_result=sql_select($job_sql);
				foreach($job_sql_result as $row)
				{
					$order_no=$row[csf("po_number")];//implode(",",array_unique(explode(",",$row[csf("po_number")])));
					$order_id=$row[csf("id")];//implode(",",array_unique(explode(",",$row[csf("id")])));
					$file_no=$row[csf("file_no")];//implode(",",array_unique(explode(",",$row[csf("file_no")])));
					$int_ref=$row[csf("grouping")];//implode(",",array_unique(explode(",",$row[csf("grouping")])));

					$job_array[$row[csf("job_no")]]['job']=$row[csf("job_no_prefix_num")];
					$job_array[$row[csf("job_no")]]['job_no']=$row[csf("job_no")];
					$job_array[$row[csf("job_no")]]['buyer']=$row[csf("buyer_name")];
					$job_array[$row[csf("job_no")]]['year']=$row[csf("year")];
					$job_array[$row[csf("job_no")]]['style_ref_no']=$row[csf("style_ref_no")];
					$job_array[$row[csf("job_no")]]['garments_nature']=$row[csf("garments_nature")];
					$job_array[$row[csf("job_no")]]['max_ship_date'].=$row[csf("max_ship_date")].',';
					$job_array[$row[csf("job_no")]]['min_ship_date'].=$row[csf("min_ship_date")].',';
					$job_array[$row[csf("job_no")]]['id'].=$order_id.',';
					$job_array[$row[csf("job_no")]]['po_number'].=$order_no.',';
					$job_array[$row[csf("job_no")]]['file'].=$file_no.',';
					$job_array[$row[csf("job_no")]]['ref'].=$int_ref.',';
				}
				
				$emb_item_array=array();
				
				$emb_sql="select a.emb_name, b.item_number_id, a.job_no as job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b,  gbl_temp_engine g where a.job_id=b.job_id and a.job_id=g.ref_val and b.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2  and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
				$emb_sql_result=sql_select($emb_sql);
				foreach($emb_sql_result as $row)
				{
					$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
					$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
				}
				
				
				 $wo_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_yarn_dyeing_mst a, approval_history b,gbl_temp_engine g where a.id=b.mst_id and a.id=g.ref_val and g.user_id = ".$user_id." and g.ref_from=1  and g.entry_form=37  and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(30) ".where_con_using_array($booking_id_arr,0,'a.id')." order by b.id desc";
				$wo_his_sql_result=sql_select($wo_his_sql);
				//$pi_no_arr = array();
				$user_arr=return_library_array( "select id, user_name from user_passwd", 'id', 'user_name' );	
				foreach ($wo_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_his_sql_result);
				
				/*$wo_non_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_non_ord_samp_booking_mst a, approval_history b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(8,7,32) ".where_con_using_array($booking_id_arr,0,'a.id')." order by b.id desc";
				$wo_non_his_sql_result=sql_select($wo_non_his_sql);
				//$pi_no_arr = array();
			 
				foreach ($wo_non_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_non_his_sql_result);*/

				$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id and b.work_order_id=g.ref_val and g.user_id = ".$user_id." and g.ref_from=1  and g.entry_form=37 and a.status_active=1 and a.is_deleted=0
				and a.item_category_id=24 and a.pi_basis_id=1 ";
				$pi_sql_result=sql_select($pi_sql);
				$pi_no_arr = array();
				foreach ($pi_sql_result as $value) 
				{
					$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
					$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];
				}
				unset($pi_sql_result);
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				
				foreach($sql_result as $row)
				{
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					if ($row[csf("entry_form")]==41) $wo_type="Order";
					else if ($row[csf("entry_form")]==42) $wo_type="Non Order";
					$job_number=implode(",",array_unique(explode(",",$row[csf("job_no")])));
					$supplier_name="";
					if($row[csf("pay_mode")]==3 || $row[csf("pay_mode")]==5)
					{
						$supplier_name=$company_library[$row[csf("supplier_id")]];
					}
					else $supplier_name=$supplierArr[$row[csf("supplier_id")]];

					$cid=2;
					if($row[csf('currency')]==2)
					{
						$cid=1;
					}
					if($row[csf('ready_to_approved')]==1) //ready
					{
						$last_update_date=$row[csf('update_date')];
					}
					
					$ex_rate=set_conversion_rate($cid, $row[csf("booking_date")],$cbo_company);
					$wo_amount=$row[csf("amount")]/$ex_rate;
						
					?>
					<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
						<td width="30"><? echo $i;?></td>
						<td width="100" align="center"><p><? echo $company_library[$row[csf("company_id")]]; ?></td>
						<td width="60" align="center"><? echo $row[csf("yarn_dyeing_prefix_num")]; ?></td>	<!--<a href='#report_details' onClick="generate_fabric_report('<? //echo $row[csf("entry_form")]; ?>','<? //echo $row[csf("ydw_no")]; ?>','<? //echo $cbo_company; ?>','<? //echo $row[csf("job_no")]; ?>','<? //echo "24"; ?>','<? //echo $cbo_category; ?>');"></a>-->
						<td width="60" align="center"><p><? echo $pi_no_arr[$row[csf("ydw_no")]]['pi_no']; ?></td>
						<td width="60" align="center"><p><? echo $row[csf("year_book")]; ?></td>
						<td width="70"><p style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("booking_date")], "", "",0); ?></p></td>
						<td width="70"><p style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("delivery_date")]); ?></p></td>
                        
                        <td width="70"><p style="word-wrap:break-word; width:70px">
						<? 
						$lead_time=0;
						if($row[csf("delivery_date")]!="" && $row[csf("delivery_date")]!="0000-00-00")
						{
							$lead_time=datediff("d", $row[csf("booking_date")], $row[csf("delivery_date")]);
						}
						if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day"; 
						?></p></td>
                        
						<td width="100"><p><? echo $wo_type;?></p></td>
						<td width="100" align="center"><? echo $yes_no[$row[csf("ready_to_approved")]]; ?></td>
                         <td width="100" align="center"><? $last_update_dateArr=explode(" ",$last_update_date);echo change_date_format($last_update_dateArr[0]).'<br>'.$last_update_dateArr[1]; ?></td>
						<td width="80"><p><? echo $approval_type_arr[$row[csf("is_approved")]]; ?></p></td>
                         <?
							//if ($cbo_category==4)
							//{
								$approved_date=$last_app_arr[$row[csf("booking_id")]]['approved_date'];
								$approved_by=$last_app_arr[$row[csf("booking_id")]]['approved_by'];
								?>
                         <td width="100" title="bookingId=<? echo $row[csf("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                             
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $supplier_name; ?></p></td>
						<td width="100"><p><? echo $buyerArr[$job_array[$job_number]['buyer']]; ?></p></td>
						<td width="110"><p style="word-wrap:break-word; width:110px"><? echo $row[csf("job_no")];//$row[csf("job_no_prefix_num")]; ?></p></td>
						<td width="60"><? echo $job_array[$job_number]['year']; ?></td>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $job_array[$job_number]['style_ref_no']; ?></p></td>
						<?
						$ref_all=rtrim($job_array[$job_number]['ref'],',');
						$ref_all=implode(", ",array_unique(explode(",",$ref_all)));
						$file_all=rtrim($job_array[$job_number]['file'],',');
						$file_all=implode(", ",array_unique(explode(",",$file_all)));
						$po_alls=rtrim($job_array[$job_number]['po_number'],',');
						$po_all=implode(", ",array_unique(explode(",",$po_alls)));
						?>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $ref_all; ?></p></td>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $file_all; ?></p></td>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $po_all; ?></p></td>
                        <td width="100"><p style="word-wrap:break-word; width:100px">
						<? 
						$max_shipdate=rtrim($job_array[$job_number]['max_ship_date'],',');
						$max_ship_dateArr=explode(",",$max_shipdate);
						$max_ship_date=max($max_ship_dateArr);
						$min_shipdate=rtrim($job_array[$job_number]['min_ship_date'],',');
						$min_shipdateArr=explode(",",$min_shipdate);
						$min_shipdate=min($min_shipdateArr);

						if($max_ship_date!="" && $max_ship_date!="0000-00-00") echo "Max - ".change_date_format($max_ship_date);
						//if($job_array[$job_number]['max_ship_date']!=$job_array[$job_number]['min_ship_date']) echo "<br> " . change_date_format($job_array[$job_number]['min_ship_date']); 

						

						
						$order_count=explode(",",$po_all);
						if(count($order_count)>1) echo "<br> Min - " . change_date_format($min_shipdate);
						 
						?></p></td>
						<td width="80"><p style="word-wrap:break-word; width:80px"><? echo $item_category[24]; ?></p></td>
						<td width="70" align="center"><p><? echo change_date_format($first_rec_date[$row[csf("booking_id")]]); ?></p></td>
						<td width="100" align="right"><? echo number_format($row[csf("wo_qnty")],2); ?></td>
						<td width="100" align="right"><? echo number_format($wo_amount,2); ?></td>
						<td>&nbsp; </td>
					</tr>
					<?
					$tot_wo_qnty+=$row[csf("wo_qnty")];
					$tot_wo_amount+=$wo_amount;
					$i++;
				}
				?>
				</table>
				<table class="rpt_table" width="2290" cellpadding="0" cellspacing="0" border="1" rules="all">
					<tfoot>
						<th width="30">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="70">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="110">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="80">Total</th>
						<th width="70">&nbsp;</th>
                        <th width="100" align="right" id="tot_fin_fab_qnty"><? echo number_format($tot_wo_qnty,2); ?></th>
                        <th width="100" align="right" id="tot_wo_amount"><? echo number_format($tot_wo_amount,2); ?></th>
						<th>&nbsp;</th>
					</tfoot>
				</table>
			</div>
		</fieldset>
		<?
	}
	
	else if ($cbo_category==31)//31=Services Lab Test
	{
		if($db_type==0)
		{
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and YEAR(a.insert_date)=$year_id";
		}
		elseif($db_type==2)
		{ 
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(a.insert_date,'YYYY')=$year_id";
		}
		
		if ($cbo_company==0) $company_id=""; else $company_id=" and a.company_id=$cbo_company";
		if ($wo_no=="") $wo_no_cond=""; else $wo_no_cond=" and a.labtest_no like '%$wo_no'";
		if ($job_no=="") $job_num=""; else $job_num=" and b.job_no='$job_no'";
		if ($hidd_po=='') $po_no_no=""; else $po_no_no=" and c.order_id in ($hidd_po)";
		
		
		if ($cbo_buyer==0) $supplier_cond=""; else $supplier_cond=" and a.supplier_id=$cbo_buyer";
		if ($cbo_category==0) $category_id=""; else $category_id=" and a.item_category=$cbo_category";
		if ($wo_type==2) $wo_type_cond=" and a.entry_form=41"; else if ($wo_type==4) $wo_type_cond=" and a.entry_form=42"; else $wo_type_cond="";
		
		//if ($job_no=="") $job_num_mst=""; else $job_num_mst=" and b.job_no_mst=$job_no";
		if ($hidd_po=="") $po_id=""; else $po_id=" and d.id in ( $hidd_po )";
		
		if ($hidd_po=="") $po_id_cond=""; else $po_id_cond=" and b.po_break_down_id in ( $hidd_po )";
		
		if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and d.file_no='".trim($file_no)."' "; 
		if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and d.grouping='".trim($internal_ref)."' "; 
		//echo $file_no_cond.'=='.$internal_ref_cond;die;
		
		if($db_type==0)
		{
			if($txt_date_category==1) 
			{	
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.wo_date between '".$date_from."' and '".$date_to."'";
			}
			else 
			{
				if($txt_date_category==2) if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".$date_from."' and '".$date_to."'";
			}
		}
		if($db_type==2)
		{
			if($txt_date_category==1) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.wo_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
			else if($txt_date_category==2) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
		}
	
	
		$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
		$supplierArr=return_library_array( "select id,supplier_name from lib_supplier", "id", "supplier_name");	
		$buyerArr=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
		//$nonStyleArr=return_library_array( "select id, style_ref_no from sample_development_mst", "id", "style_ref_no");		
		
	/*	$sql="select a.job_no,d.id as po_id from wo_po_details_master a, wo_po_break_down d where a.job_no=d.job_no_mst and a.status_active=1 and a.is_deleted=0 and d.status_active=1 and d.is_deleted=0 $internal_ref_cond  $file_no_cond  group by a.job_no,d.id";
		$sql_result=sql_select($sql);
		$po_id_data="";$k=0;
		foreach($sql_result as $row)
		{
			if($k==0)
			{
				$po_data_cond=$row[csf('po_id')];
				 $job_data_cond=$row[csf('job_no')];
			}
			else
			{
				 $po_data_cond.=",".$row[csf('po_id')];
				 $job_data_cond.=",".$row[csf('job_no')];
			} 
		} //echo $job_data_cond;
		
		
		if($file_no_cond!="" || $internal_ref!="")
		{  
		 $po_data_file_ref=" and c.po_break_down_id in($po_data_cond) "; 
		 $job_data_file_ref=" and b.job_no in('$job_data_cond') "; 
		}
		else
		{
			$po_data_file_ref="";
			$job_data_file_ref="";
		}*/
		
	
		
		
	
	
		//============================start==============issue-23079========12-10-2021=============================================
		// $emb_item_array=array();		
		// $emb_sql="select a.emb_name, b.item_number_id, c.job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b, wo_po_break_down c where a.job_no=b.job_no_mst and c.id=b.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
		// $emb_sql_result=sql_select($emb_sql);
		// foreach($emb_sql_result as $row)
		// {
		// 	$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
		// 	$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
		// }
		//var_dump($job_array);
		//===========================end==============issue-23079========12-10-2021==============================================






		ob_start();
		?>
		<fieldset style="width:2410px">
			<table width="2490"  cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none; font-size:18px;" colspan="21">
						<? echo $company_library[str_replace("'","",$cbo_company_id)]; ?>                                
					</td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:16px; font-weight:bold" colspan="21"> <? echo $report_title; if($cbo_category!=0) echo " For ".$item_category[$cbo_category]; ?></td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:12px; font-weight:bold"  colspan="21"> <? if( $date_from!="" && $date_to!="" ) echo "From ".change_date_format($date_from)." To ".change_date_format($date_to);?></td>
				</tr>
			</table>
            <table class="rpt_table" width="2590" cellpadding="0" cellspacing="0" border="1" rules="all">
				<thead>
					<th width="30">SL</th>    
					<th width="100">Company</th>
					<th width="60">Wo No</th>
					<th width="60">PI No</th>
					<th width="60">Wo Year</th>
					<th width="70">Wo Date</th>
					<th width="70">Deli. Date</th>
                    <th width="70">Lead Time</th>
					<th width="100">Wo Type</th>
					<th width="100">sReady To App.</th>
				    <th width="100">Ready To Approved<br> date and time</th>
					<th width="80">App. Status</th>
                    <th width="100">Last Approval <br>Date time and Person</th>
					<th width="100">Supplier</th>
					<th width="100">Buyer</th>
					<th width="110">Job No.</th>
					<th width="60">Job Year</th>
					<th width="100">Style Ref.</th>
					<th width="100">Inter. Ref.</th>
					<th width="100">File No.</th>
					<th width="100">Order No</th>
                    <th width="100">Shipment Date</th>
					<th width="80">Item Cate.</th>
					<th width="70">First Rec. Date</th>
					<th width="100">Required Value</th>
                    <th width="100">WO value</th>
					<th width="100">WO value(USD)</th>
					<th width="100">Balance (USD)</th>
					<th>Remarks</th>
				</thead>
			</table>
			<div style="max-height:350px; overflow-y:scroll; width:2610px" id="scroll_body" >
				<table cellspacing="0" cellpadding="0" border="1" class="rpt_table"  width="2590" rules="all" id="table_body" >
				<?
				if ($cbo_company==0) $company_cond_id=""; else $company_cond_id=" and b.company_id=$cbo_company";
				
				if($db_type==0)
				{	
					$sql="Select a.company_id,a.currency,a.id as booking_id, a.entry_form,a.pay_mode, Year(a.insert_date) as year_book, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id,a.ready_to_approved, b.job_no, sum(b.wo_value) as wo_value,b.po_id,c.order_qty,a.currency,a.ecchange_rate from wo_labtest_mst a, wo_labtest_dtls b,wo_labtest_order_dtls c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $supplier_cond $job_num $booking_date_cond $wo_no_cond $wo_type_cond $po_no_no group by a.id,a.company_id, a.entry_form, a.insert_date,a.pay_mode, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id,a.ready_to_approved, b.job_no,b.po_id,c.order_qty,a.currency,a.ecchange_rate  order by a.id Desc";
				}
				else if ($db_type==2)
				{
					$sql="Select a.company_id,max(a.currency) as currency, a.id as booking_id, a.entry_form,a.pay_mode, TO_CHAR(a.insert_date,'YYYY') as year_book, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id, a.ready_to_approved, b.job_no, sum(c.wo_value) as wo_value,b.po_id,c.order_qty,a.currency,a.ecchange_rate from wo_labtest_mst a, wo_labtest_dtls b,wo_labtest_order_dtls c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $job_num $booking_date_cond $wo_no_cond $wo_type_cond $po_no_no group by a.id,a.company_id, a.entry_form,a.pay_mode, a.insert_date, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id,a.ready_to_approved,  b.job_no,b.po_id,c.order_qty,a.currency,a.ecchange_rate  order by a.id Desc";
				}
				
				
	
				  
				   // echo $sql;die;
				//echo  $po_id ;die;
				$sql_result=sql_select($sql); $i=1;
				$job_no=array();
				foreach ($sql_result as $row) 
				{
					$booking_id_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
					$po_arr[$row[csf("po_id")]]=$row[csf("po_id")];
					$job_no[$row[csf("job_no")]]=$row[csf("job_no")];
				}
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 1, $booking_id_arr, $empty_arr);//Book ID Ref from=1
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 2, $po_arr, $empty_arr);//PO ID Ref from=2
				 
				
			
				if($cbo_category==24)
				{
					$sql="select a.id, a.ydw_no, min(b.receive_date) as receive_date from wo_yarn_dyeing_mst a,inv_receive_master b,gbl_temp_engine g where a.ydw_no=b.booking_no and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and b.item_category=1  and b.receive_basis=2 and b.receive_purpose=2 $company_cond_id group by a.id, a.ydw_no";	
					$sql_result=sql_select($sql);
					foreach($sql_result as $row)
					{
						$first_rec_date[$row[csf("id")]]=$row[csf("receive_date")];
					}
				}
				if($db_type==0)
				{
					$job_sql="select a.job_no_prefix_num, a.job_no, a.buyer_name, Year(a.insert_date) as year, a.style_ref_no, a.garments_nature, 
					group_concat(b.id) as id,
					group_concat(b.po_number) as po_number,
					group_concat(b.file_no) as file_no,
					group_concat(b.grouping) as grouping,
					max(b.pub_shipment_date) as max_ship_date,
					min(b.pub_shipment_date) as min_ship_date
					from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.job_no_prefix_num, a.job_no, a.buyer_name, a.insert_date, a.style_ref_no, a.garments_nature";
				}
				elseif($db_type==2)
				{
					$job_sql="select a.job_no_prefix_num, a.job_no, a.buyer_name, TO_CHAR(a.insert_date,'YYYY') as year, a.style_ref_no, a.garments_nature, 
					b.id as id,
					b.po_number as po_number,
					b.file_no as file_no,
					b.grouping as grouping,
					(b.pub_shipment_date) as max_ship_date,
					(b.pub_shipment_date) as min_ship_date,
					b.po_quantity
					from wo_po_details_master a, wo_po_break_down b,gbl_temp_engine g where a.id=b.job_id and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.job_no_prefix_num, a.job_no, a.buyer_name, a.insert_date, a.style_ref_no, a.garments_nature";
				}
			
				$job_sql_result=sql_select($job_sql);
				
				foreach($job_sql_result as $row)
				{
					$order_no=$row[csf("po_number")];//implode(",",array_unique(explode(",",$row[csf("po_number")])));
					$order_id=$row[csf("id")];//implode(",",array_unique(explode(",",$row[csf("id")])));
					$file_no=$row[csf("file_no")];//implode(",",array_unique(explode(",",$row[csf("file_no")])));
					$int_ref=$row[csf("grouping")];//implode(",",array_unique(explode(",",$row[csf("grouping")])));
			
					$job_array[$row[csf("job_no")]]['job']=$row[csf("job_no_prefix_num")];
					$job_array[$row[csf("job_no")]]['job_no']=$row[csf("job_no")];
					$job_array[$row[csf("job_no")]]['buyer']=$row[csf("buyer_name")];
					$job_array[$row[csf("job_no")]]['year']=$row[csf("year")];
					$job_array[$row[csf("job_no")]]['style_ref_no']=$row[csf("style_ref_no")];
					$job_array[$row[csf("job_no")]]['max_ship_date'].=$row[csf("max_ship_date")].',';
					$job_array[$row[csf("job_no")]]['min_ship_date'].=$row[csf("min_ship_date")].',';
					$job_array[$row[csf("job_no")]]['id'].=$order_id.',';
					$job_array[$row[csf("job_no")]]['po_number'].=$order_no.',';
					$job_array[$row[csf("job_no")]]['file'].=$file_no.',';
					$job_array[$row[csf("job_no")]]['ref'].=$int_ref.',';
					$job_qty_arr[$row[csf("job_no")]]['job_qty']+=$row[csf("po_quantity")];
				}
				
				// print_r($job_no);
				//===================================================================================================
				$emb_item_array=array();		
				$emb_sql="select a.emb_name, b.item_number_id, b.job_no as job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b,  gbl_temp_engine g where a.job_id=b.job_id and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  ";
				$emb_sql_result=sql_select($emb_sql);
				foreach($emb_sql_result as $row)
				{
					$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
					$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];


				}


				//===================================================================================================

				$lab_test_sql="select b.id,b.job_no,b.costing_per_id,b.lab_test,b.lab_test_percent,b.inspection,b.inspection_percent,b.cm_cost,b.cm_cost_percent from wo_pre_cost_dtls b,wo_po_break_down c,gbl_temp_engine g where b.job_id=c.job_id and  c.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and b.status_active=1 and b.is_deleted=0  ";

				//echo $lab_test_sql;
				$lab_test_data=sql_select($lab_test_sql);
				foreach($lab_test_data as $row){

						$lab_test[$row[csf("job_no")]]['lab_test']=$row[csf("lab_test")];
				}

				//=============================================job_qty======================================================

			/*	$job_qty_sql="select id,job_no,job_quantity from wo_po_details_master where  status_active=1 and is_deleted=0 ".where_con_using_array($job_no,1,'job_no')." ";

				//echo $lab_test_sql;
				$job_qty_data=sql_select($job_qty_sql);
				foreach($job_qty_data as $row){

						$job_qty_arr[$row[csf("job_no")]]['job_qty']=$row[csf("job_quantity")];
				}*/

				// echo "<pre>";
				// print_r($lab_test);


				$wo_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_labtest_mst a, approval_history b,gbl_temp_engine g where a.id=b.mst_id and  a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(42) ".where_con_using_array($booking_id_arr,0,'a.id')." order by b.id desc";
				$wo_his_sql_result=sql_select($wo_his_sql);
				//$pi_no_arr = array();
				$user_arr=return_library_array( "select id, user_name from user_passwd", 'id', 'user_name' );	
				foreach ($wo_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_his_sql_result);
				$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id and  b.work_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and a.item_category_id=31 and a.pi_basis_id=1";
				$pi_sql_result=sql_select($pi_sql);
				$pi_no_arr = array();
				foreach ($pi_sql_result as $value) 
				{
					$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
					$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];
				}
				unset($pi_sql_result);
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);

				foreach($sql_result as $row)
				{
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					if ($row[csf("entry_form")]==41 || $row[csf("entry_form")]==79) $wo_type="Order";
					else if ($row[csf("entry_form")]==42) $wo_type="Non Order";
					$job_number=implode(",",array_unique(explode(",",$row[csf("job_no")])));
					$cbo_company=$row[csf("company_id")];
					
					
						//function generate_fabric_report(type,booking_no,company_id,order_id,fabric_nature,fabric_source,job_no,approved,category,is_short,emb_name,item_number_id,action_type,i,supplier_id)
					
						 
					 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('','".$row[csf("booking_id")]."','".$cbo_company."','".$row[csf("currency")]."','".$cbo_category."','".change_date_format($row[csf("wo_date")])."','','','".$cbo_category."','','','','show_trim_booking_report','')\">".$row[csf("labtest_prefix_num")]." </a>";	     					
					$supplier_name="";
					if($row[csf("pay_mode")]==3 || $row[csf("pay_mode")]==5)
					{
						$supplier_name=$company_library[$row[csf("supplier_id")]];
					}
					else $supplier_name=$supplierArr[$row[csf("supplier_id")]];
					if($row[csf('ready_to_approved')]==1) //ready
					{
						$last_update_date=$row[csf('update_date')];
					}
					


					$usd_id=2;
					if($db_type==0) $conversion_date=change_date_format($row[csf("wo_date")], "Y-m-d", "-",1);
					else $conversion_date=change_date_format($row[csf("wo_date")], "d-M-y", "-",1);
					$currency_rate=set_conversion_rate($usd_id,$conversion_date );
					if($row[csf("currency")]==2) $wo_currency_usd_amt=$row[csf("wo_value")];//USD
					else $wo_currency_usd_amt=$row[csf("wo_value")]/$currency_rate;

					$req_value=($job_qty_arr[$row[csf("job_no")]]['job_qty']/12)*$lab_test[$row[csf("job_no")]]['lab_test'];
					
					// $wo_currency_usd_amt=$row[csf("wo_value")]/$row[csf("ecchange_rate")];
					?>
					<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
						<td width="30"><? echo $i;?></td>
						<td width="100" align="center"><p><? echo $company_library[$row[csf("company_id")]]; ?></td>
						<td width="60" align="center"><? echo $variable; ?></td>
						<td width="60" align="center"><p><? echo $pi_no_arr[$row[csf("booking_id")]]['pi_no']; ?></td>
						<td width="60" align="center"><p><? echo $row[csf("year_book")]; ?></td>					
						<td width="70"><div style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("wo_date")], "", "",0); ?></div></td>
						<td width="70"><div style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("delivery_date")]); ?></div></td>
                        <td width="70"><div style="word-wrap:break-word; width:70px">
						<? 
						$lead_time=0;
						if($row[csf("delivery_date")]!="" && $row[csf("delivery_date")]!="0000-00-00")
						{
							$lead_time=datediff("d", $row[csf("wo_date")], $row[csf("delivery_date")]);
						}
						if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day"; 
						?></div></td>
						<td width="100"><?=$wo_type; ?></td>
						<td width="100" align="center"><? echo $yes_no[$row[csf("ready_to_approved")]]; ?></td>
                        <td width="100" align="center"><? $last_update_dateArr=explode(" ",$last_update_date);echo change_date_format($last_update_dateArr[0]).'<br>'.$last_update_dateArr[1]; ?></td>
                        
						<td width="80"><p><? echo $approval_type_arr[$row[csf("is_approved")]]; ?></p></td>
                        <?
                       	 $approved_date=$last_app_arr[$row[("booking_id")]]['approved_date'];
						 $approved_by=$last_app_arr[$row[("booking_id")]]['approved_by'];
						?>
                         <td width="100" title="bookingId=<? echo $row[("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                         
                         
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $supplier_name; ?></div></td>
						<td width="100"><p><? echo $buyerArr[$job_array[$job_number]['buyer']]; ?></p></td>
						<td width="110"><div style="word-wrap:break-word; width:110px"><? echo $row[csf("job_no")];//$row[csf("job_no_prefix_num")]; ?></div></td>
						<td width="60"><? echo $job_array[$job_number]['year']; ?></td>
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $job_array[$job_number]['style_ref_no']; ?></div></td>
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $job_array[$job_number]['ref']; ?></div></td>
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $job_array[$job_number]['file']; ?></div></td>
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $job_array[$job_number]['po_number']; ?></div></td>
                        <td width="100"><div style="word-wrap:break-word; width:100px">
						<? 
						if($job_array[$job_number]['max_ship_date']!="" && $job_array[$job_number]['max_ship_date']!="0000-00-00") echo "Max - ".change_date_format($job_array[$job_number]['max_ship_date']);
						//if($job_array[$job_number]['max_ship_date']!=$job_array[$job_number]['min_ship_date']) echo "<br> " . change_date_format($job_array[$job_number]['min_ship_date']); 
						
						$order_count=explode(",",$job_array[$job_number]['po_number']);
						if(count($order_count)>1) echo "<br> Min - " . change_date_format($job_array[$job_number]['min_ship_date']);
						 
						?></div></td>
						<td width="80"><div style="word-wrap:break-word; width:80px"><? echo $item_category[31]; ?></div></td>
						<td width="70" align="center"><p><? echo change_date_format($first_rec_date[$row[csf("booking_id")]]); ?></p></td>
						<td width="100" align="right" title="<?="(".$job_qty_arr[$row[csf("job_no")]]['job_qty']."/12)*".$lab_test[$row[csf("job_no")]]['lab_test'];?>"><? echo number_format(($job_qty_arr[$row[csf("job_no")]]['job_qty']/12)*$lab_test[$row[csf("job_no")]]['lab_test'],2); ?></td>
						<td width="100" align="right"><? echo number_format($row[csf("wo_value")],2); ?></td>
						<td width="100" align="right" title="<?=$row[csf("wo_value")]."/".$currency_rate;?>"><? echo number_format($wo_currency_usd_amt,2); ?></td>
						<td width="100" align="right" title="<?=$req_value."-".$wo_currency_usd_amt;?>"><? echo number_format($req_value-$wo_currency_usd_amt,2); ?></td>
						<td><? //echo $row[csf("po_number")]; ?></td>
					</tr>
					<?
					$tot_req_qnty+=($job_qty_arr[$row[csf("job_no")]]['job_qty']/12)*$lab_test[$row[csf("job_no")]]['lab_test'];
					$tot_wo_qnty+=$row[csf("wo_value")];
					$tot_bal_qnty+=$req_value-$wo_currency_usd_amt;
					$tot_wo_currency_usd_amt+=$wo_currency_usd_amt;
					$i++;
				}
				?>
				</table>
				<table class="rpt_table" width="2590" cellpadding="0" cellspacing="0" border="1" rules="all">
					<tfoot>
						<th width="30">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="70">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="110">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="100">Total</th>
						<th width="80">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="100" align="right" id="value_tot_req_qnty"><? echo number_format($tot_req_qnty,2); ?></th>
						<th width="100" align="right" id="value_tot_fin_fab_qnty"><? echo number_format($tot_wo_qnty,2); ?></th>
						<th width="100" align="right"  id="usd_tot_fin_fab_qnty"><? echo number_format($tot_wo_currency_usd_amt,2); ?></th>
						<th width="100" align="right"  id="usd_tot_bal_qnty"><? echo number_format($tot_bal_qnty,2); ?></th>
						<th>&nbsp;</th>
					</tfoot>
				</table>
			</div>
		</fieldset>
		<?
	}
 
	$html = ob_get_contents();
    ob_clean();
    //$new_link=create_delete_report_file( $html, 2, $delete, "../../../" );
    foreach (glob("*.xls") as $filename) {
    //if( @filemtime($filename) < (time()-$seconds_old) )
    @unlink($filename);
    }
    //---------end------------//
    $name=time();
    $filename=$user_id."_".$name.".xls";
    $create_new_doc = fopen($filename, 'w');	
    $is_created = fwrite($create_new_doc, $html);
    echo "$html**$filename"; 
	exit();
}
if ($action=="report_generate3")
{
	//extract($_REQUEST);
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	$cbo_company=str_replace("'","",$cbo_company_id);
	$cbo_buyer=str_replace("'","",$cbo_buyer_id);
	$cbo_category=str_replace("'","",$cbo_category_id);
	$wo_type=str_replace("'","",$cbo_wo_type);
	$year_id=str_replace("'","",$cbo_year_id);
	$job_year_id=str_replace("'","",$cbo_job_year_id);
	$wo_no=str_replace("'","",$txt_wo_no);
	$wo_id=str_replace("'","",$hidd_wo_id);
	$cbo_season_id=str_replace("'","",$cbo_season_id);
	
	$job_no=str_replace("'","",$txt_job_no);
	$hidd_job=str_replace("'","",$hidd_job_id);
	$po_no=str_replace("'","",$txt_po_no);
	$hidd_po=str_replace("'","",$hidd_po_id);
	$date_from=str_replace("'","",$txt_date_from);
	$date_to=str_replace("'","",$txt_date_to);
	$file_no=str_replace("'","",$txt_file_no);
	$internal_ref=str_replace("'","",$txt_internal_ref);
	$txt_date_category=str_replace("'","",$txt_date_category);
	$cbo_order_status=str_replace("'","",$cbo_order_status);
	
	if($cbo_category==2 || $cbo_category==3 || $cbo_category==4 || $cbo_category==12 || $cbo_category==25)
	{	
		if($db_type==0)
		{
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and YEAR(a.insert_date)=$year_id";
			if ($year_id==0) $year_id_cond_sam=""; else $year_id_cond_sam=" and YEAR(s.insert_date)=$year_id";
		}
		elseif($db_type==2)
		{ 
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(a.insert_date,'YYYY')=$year_id";
			if ($year_id==0) $year_id_cond_sam=""; else $year_id_cond_sam=" and TO_CHAR(s.insert_date,'YYYY')=$year_id";
		}
		
		if ($cbo_company==0) $company_id=""; else $company_id=" and a.company_id=$cbo_company";
		if ($cbo_company==0) $company_id_sam=""; else $company_id_sam=" and s.company_id=$cbo_company";
		if ($cbo_buyer==0) $buyer_id=""; else $buyer_id=" and a.buyer_id=$cbo_buyer";
		if ($cbo_buyer==0) $buyer_id_sam=""; else $buyer_id_sam=" and s.buyer_id=$cbo_buyer";
		if ($cbo_category==0) $category_id=""; else $category_id=" and a.item_category=$cbo_category";
		if ($cbo_category==0) $category_id_sam=""; else $category_id_sam=" and s.item_category=$cbo_category";
		if ($wo_no=="") $wo_no_cond=""; else $wo_no_cond=" and a.booking_no='$wo_no'";
		if ($wo_no=="") $wo_no_cond_sam=""; else $wo_no_cond_sam=" and s.booking_no='$wo_no'";
		if ($wo_type==1 || $wo_type==2)  $wo_type_cond=" and a.booking_type in (1,2,3) and a.is_short='$wo_type'"; else $wo_type_cond="";
		if ($wo_type==3) $wo_type_cond_sam="  and a.booking_type=4"; else $wo_type_cond_sam="";
		
		if ($job_no=="") $job_num=""; else $job_num=" and b.job_no='$job_no'";
		//if ($po_no=='') $po_no_no=""; else $po_no_no=" and d.po_number in ($po_no)";
		if ($hidd_po=="") $po_id=""; else $po_id=" and d.id in ( $hidd_po )";
		
		//if ($hidd_po=="") $po_id_cond=""; else $po_id_cond=" and b.po_break_down_id in ( $hidd_po )";
		
		if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and d.file_no='".trim($file_no)."' "; 
		if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and d.grouping='".trim($internal_ref)."' "; 
		//echo $file_no_cond.'=='.$internal_ref_cond;die;
		if ($cbo_season_id==0) $season_cond=""; else $season_cond=" and c.season_buyer_wise in(".$cbo_season_id.") "; 
		
		if($db_type==0)
		{
			if($txt_date_category==1){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".$date_from."' and '".$date_to."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.booking_date between '".$date_from."' and '".$date_to."'";
			}
			else if($txt_date_category==2){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".$date_from."' and '".$date_to."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.delivery_date between '".$date_from."' and '".$date_to."'";
			}
		}
		if($db_type==2)
		{
			if($txt_date_category==1){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.booking_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
			else if($txt_date_category==2){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
		}
	
		$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
		$supplierArr=return_library_array( "select id,supplier_name from lib_supplier", "id", "supplier_name");	
		$buyerArr=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
		//$nonStyleArr=return_library_array( "select id, style_ref_no from sample_development_mst", "id", "style_ref_no");		
		if ($cbo_category==4) 
		{
			$colspan=29;
			$tbl_width=3210;
		}
		else if ($cbo_category==12)
		{
			$colspan=27;
			$tbl_width=2640;
		}
		else if ($cbo_category==2)
		{
			$colspan=27;
			$tbl_width=3000;
		}
		else
		{
			$colspan=26;
			$tbl_width=2640;
		}
		
		$emb_item_array=array();
		//================================================issue 19461====16-09-2021===============================
			// $emb_sql="select a.emb_name, b.item_number_id, c.job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b, wo_po_break_down c where a.job_no=b.job_no_mst and c.id=b.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
			// $emb_sql_result=sql_select($emb_sql);
			// foreach($emb_sql_result as $row)
			// {
			// 	$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
			// 	$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
			// }
			// unset($emb_sql_result);
			//var_dump($job_array);
		//================================================issue 19461====16-09-2021===============================
		if($cbo_company!=0) $cbo_company_cond="and template_name=$cbo_company";else $cbo_company_cond="";
		if($cbo_category==2 || $cbo_category==3)
		{
			// $print_report_format_ids=return_field_value("format_id","lib_report_template","template_name=".$cbo_company."  and module_id=2 and report_id=1 and is_deleted=0 and status_active=1");
			$print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=1 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			
			$print_short_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=2 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$partial_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=35 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$woven_partial_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=138 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$sample_req_non_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=90 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$sample_req_booking_withorder_print_report_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=48 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			
			$sample_booking_non_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=4 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$sample_booking_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=3 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			//$format_ids=explode(",",$print_report_format_ids);
		}
		else if($cbo_category==4)
		{
			$print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(5,6) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			/*$print_report_format_arr26=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=26 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");*/
			$trim_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(5) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$trim_print_report_format_arr2=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(6) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$print_report_format_arr26=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=26 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$trim_print_report_format_arr3=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(219) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			
		}
		else if($cbo_category==12) // Service Fab. Booking.
		{
			//$print_report_format_ids=return_field_value("format_id","lib_report_template","template_name ='".$cbo_company."'   and module_id=2 and report_id=11 and is_deleted=0 and status_active=1");
			//echo "select template_name, format_id from lib_report_template where  module_id=2 and report_id=11 and is_deleted=0 and status_active=1 $cbo_company_cond";
			$print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=11 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$print_report_format_aop=return_field_value("format_id"," lib_report_template"," module_id=2 and report_id=49 and is_deleted=0 and status_active=1 $cbo_company_cond");
				$multi_knit_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=65 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");

			//$format_ids=explode(",",$print_report_format_ids);
		}
		//print_r($print_report_format_arr);
		//$first_print_button=array_shift($format_ids);
		//$second_print_button= array_shift($format_ids);
		$tot_fin_fab_qnty=0;
		
		//echo $first_print_button.'gg';
		ob_start();
		?>
		<fieldset>
			<table width="<? echo $tbl_width; ?>"  cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none; font-size:18px;" colspan="<? echo $colspan; ?>">
						<? echo $company_library[str_replace("'","",$cbo_company_id)]; ?>                                
					</td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:16px; font-weight:bold"  colspan="<? echo $colspan; ?>"> <? echo $report_title; if($cbo_category!=0) echo " For ".$item_category[$cbo_category]; ?></td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:12px; font-weight:bold"  colspan="<? echo $colspan; ?>"> <? if( $date_from!="" && $date_to!="" ) echo "From ".change_date_format($date_from)." To ".change_date_format($date_to);?></td>
				</tr>
			</table>
			<table width="<? echo $tbl_width; ?>" cellspacing="0" border="1" class="rpt_table" rules="all">
				<thead>
					<th width="30">SL</th>    
					<th width="100">Company</th>
					<th width="60">Wo No</th>
                    <th width="70">Pay Mode</th>
                    <?
					if ($cbo_category==3 || $cbo_category==2 || $cbo_category==25 || $cbo_category==4)
					{
						?>
                        <th width="100">PI No</th>
                        <?
					}

					if ($cbo_category==4)
					{
						?>
                        <th width="100">BTB LC</th>
                        <th width="100">LC Type</th>
                        <th width="100">Pay Term</th>
                        <th width="100">Tenor</th>
                        <?
					}

					if ($cbo_category==12)
					{
						?>
						<th width="100">PI No</th>
                        <th width="100">Process</th>
                        <?
					}
					
					?>
					<th width="60">Wo Year</th>
					<th width="70">Wo Date</th>
					<th width="70">Wo Last Update</th>
					<th width="70">Delivery Date</th>
                    <th width="70">Lead Time</th>
					<th width="100">Wo Type</th>
					<th width="100">Ready To Approved</th>
                     <?  //if ($cbo_category==4)
					//{
							
							 ?>
                    <th width="100">Ready To Approved<br>date and time</th>
                      <?
					//}
					?>
					<th width="80">Approval Status</th>
                     <?  //if ($cbo_category==4)
					//{
							
							 ?>
                    <th width="100">Last Approval <br>Date time and Person</th>
                      <?
					//}
					?>
					<th width="100">Supplier</th>
					<th width="100">Buyer</th>
					<th width="70">Job No.</th>
                    <th width="70">Season</th>
					<th width="60">Job Year</th>
					<th width="100">Style Ref.</th>
					<th width="100">Internal Ref.</th>
					<th width="100">File No.</th>
					<th width="100">Order No</th>
                    <th width="100">Shipment Date</th>
					<th width="80">Item Category</th>
					<th width="70">First Receive Date</th>
					<?
						if ($cbo_category==4)
						{
							?>
								<th width="100">Wo Value</th>
                                <th width="100">Wo value(USD)</th>
                                <th width="100">Receive Value</th>
                                <th width="100">Receive Value(USD)</th>
							<?
						}
						else
						{
							
							if ($cbo_category==25) 
							{ 
							  $head_type="Wo Qty[Dzn]";
							  $head_type2="[USD]";
							}
							else { 
							 $head_type="Fin. Qty Without PL";
							 $head_type2="";
							}
							?>
								<th width="100"><? echo $head_type;?></th>
								<?php
								if($cbo_category==2){?>
								<th width="100">Process Loss %</th>
								<?}?>
								<?
								if ($cbo_category==3 || $cbo_category==25)
								{
									?>
			                        <th width="100">WO Value<? echo $head_type2;?></th>
			                        <?
								}
								else
								{
									?>
									<th width="100">Fin. Qty With PL</th>

									
									<?
								}
								if($cbo_category==2){?>
								
								<th width="100">FSO (Grey)</th>
							<?
								}
						}
					if($cbo_category==2)//Knit Fab.
					{
						?>
						<th width="80">Sample QTY</th>
						<th width="80">Responsible Dept</th>
						<th width="80">Reason</th>
						<?
					}
					?>
					<th>Remarks</th>
				</thead>
			</table>
			<div style="max-height:350px; overflow-y:scroll; width:<? echo $tbl_width+20; ?>px" id="scroll_body" >
				<table cellspacing="0" cellpadding="0" border="1" class="rpt_table"  width="<? echo $tbl_width; ?>" rules="all" id="table_body" >
				<?
				
				
				
				//print_r($wopi_arr); die;
				
				
				$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
				$fabric_source_cond="";$fabric_source_cond_nonOrder="";
				if($cbo_category==2 || $cbo_category==4)
				{ 
					if($cbo_fabric_source>0) 
					{
						$fabric_source_cond=" and a.fabric_source=$cbo_fabric_source"; 
					
						if($cbo_fabric_source==1 || $cbo_fabric_source==4){
							$fabric_source_cond_nonOrder=" and t.fabric_source=$cbo_fabric_source"; 
							$select_field="t.fabric_source";
						}
						else
						{
							$fabric_source_cond_nonOrder=" and s.fabric_source=$cbo_fabric_source"; 
							$select_field="s.fabric_source";
						}
					}
					else $select_field="s.fabric_source";
				}
				//echo $select_field.'DDD';die;
				//var_dump($receive_qnty_data_prod);die;
				
				if($db_type==0)
				{
					$year_book=" year(a.insert_date) as year_book";
					$year_book_non=" year(s.insert_date) as year_book";
					$select_job_year=" year(c.insert_date) as job_year"; 
				}
				else
				{
					$year_book=" TO_CHAR(a.insert_date,'YYYY') as year_book";
					$year_book_non=" TO_CHAR(s.insert_date,'YYYY') as year_book";
					$select_job_year=" TO_CHAR(c.insert_date,'YYYY') as job_year";
				}

				/*$wo_last_date_sql=sql_select("select id,update_date from wo_booking_mst where is_deleted=0 and  status_active=1");
				foreach($wo_last_date_sql as $val)
				{
					$wo_last_date_arr[$val[csf("id")]]=$val[csf("update_date")];
				}*/
 				//wo_non_ord_samp_booking_dtls
				if($wo_type==0)
				{
					if($job_no!='' || $hidd_po!='' || $file_no!='' || $internal_ref!='')
					{

						 $sql="Select a.entry_form,a.update_date, a.company_id, a.id as booking_id, a.pay_mode, a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date, a.delivery_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount,b.responsible_dept,b.reason, b.uom as uom,c.season_buyer_wise, c.job_no_prefix_num, c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date, 0 as type ,b.bh_qty,b.rf_qty,b.process_loss_percent as process_loss

						from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d  
						where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $booking_date_cond $wo_no_cond $fabric_source_cond  $job_num $po_id $internal_ref_cond  $file_no_cond $season_cond $year_id_cond";//die;
					}
					else
					{
						  $sql="(Select a.entry_form,a.update_date,a.company_id,a.id as booking_id, a.pay_mode,a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date as booking_date,a.delivery_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount, b.responsible_dept,b.reason,b.uom as uom,c.season_buyer_wise, c.job_no_prefix_num, c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date, 0 as type ,b.bh_qty,b.rf_qty,b.process_loss_percent as process_loss
						from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d
						where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $job_num $po_id $booking_date_cond $wo_no_cond $fabric_source_cond  $job_num $po_id $internal_ref_cond  $file_no_cond $year_id_cond $season_cond) 
						 union all
						 (SELECT s.entry_form_id as entry_form,s.update_date, s.company_id, s.id as booking_id, s.pay_mode, s.booking_type, s.is_short, s.booking_no, $year_book_non, s.booking_no_prefix_num, s.fabric_source, s.booking_date as booking_date, s.delivery_date,null as  delivery_date_dtls, s.is_approved, s.ready_to_approved, s.supplier_id, s.buyer_id, s.item_category, s.currency_id, s.exchange_rate, null as process, t.finish_fabric as fin_fab_qnty, t.grey_fabric as grey_fab_qnty, t.trim_qty as wo_qnty, t.amount as amount, null as responsible_dept, null as reason, t.uom as uom,null as season_buyer_wise, null as job_no_prefix_num, null as job_no, null as job_year, null as style_ref_no, null as garments_nature, 0 as po_break_down_id, null as po_number, null as file_no, null as grouping, null as pub_shipment_date, 1 as type ,t.bh_qty,t.rf_qty,t.process_loss as process_loss
						 FROM wo_non_ord_samp_booking_mst s, wo_non_ord_samp_booking_dtls t 
						 WHERE s.booking_no=t.booking_no and s.status_active =1 and s.is_deleted=0 and t.status_active =1 and t.is_deleted=0 $company_id_sam $buyer_id_sam ".set_user_lavel_filtering(' and s.buyer_id','buyer_id')." $category_id_sam $booking_date_cond_samp $wo_no_cond_sam $year_id_cond_sam $fabric_source_cond_nonOrder) order by booking_date ";//die;//LISTAGG(CAST(b.job_no AS VARCHAR(4000)), ',') WITHIN GROUP (ORDER BY b.job_no) as job_no,
					}
				}
				else
				{
					if ($wo_type==1 || $wo_type==2 || $wo_type==3)
					{
						 $sql="Select a.entry_form,a.update_date, a.company_id, a.id as booking_id, a.pay_mode, a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date,a.delivery_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.responsible_dept, b.reason, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount, b.uom as uom,c.season_buyer_wise, c.job_no_prefix_num, c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date,  0 as type,b.bh_qty,b.rf_qty,b.process_loss_percent as process_loss
						 from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d 
						 where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status  $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $job_num $po_id $booking_date_cond $wo_no_cond $wo_type_cond $wo_type_cond_sam $file_no_cond $internal_ref_cond $fabric_source_cond $year_id_cond $season_cond order by a.booking_no";//die;
					}
					else
					{  
						$sql="SELECT s.entry_form_id as entry_form,s.update_date,s.company_id, s.id as booking_id, s.pay_mode, s.booking_type, s.is_short, s.booking_no, $year_book_non, s.booking_no_prefix_num, $select_field , s.booking_date, s.delivery_date, s.is_approved, s.ready_to_approved, s.supplier_id, s.buyer_id, s.item_category, s.currency_id, s.exchange_rate, null as process, t.finish_fabric as fin_fab_qnty, t.grey_fabric as grey_fab_qnty, t.trim_qty as wo_qnty, t.amount as amount, t.uom as uom,null as season_buyer_wise, null as job_no_prefix_num, null as job_no, null as job_year, null as style_ref_no, null as garments_nature, 0 as po_break_down_id, null as po_number, null as file_no, null as grouping, null as pub_shipment_date, 1 as type,  t.bh_qty,t.rf_qty,t.process_loss as process_loss
						FROM wo_non_ord_samp_booking_mst s, wo_non_ord_samp_booking_dtls t 
						WHERE s.booking_no=t.booking_no and s.status_active =1 and s.is_deleted=0 and t.status_active =1 and t.is_deleted=0 $company_id_sam $buyer_id_sam ".set_user_lavel_filtering(' and s.buyer_id','buyer_id')." $category_id_sam $booking_date_cond_samp $wo_no_cond_sam $year_id_cond_sam  $fabric_source_cond_nonOrder";//die;
					}
				}
				// echo $sql; //die;
				$job_check=$order_check=array();
				$sql_result=sql_select($sql); 
				$booking_data=array();$booking_id_arr=array();
				foreach($sql_result as $row)
				{ 
					$booking_id_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
					$po_id_arr[$row[csf("po_break_down_id")]]=$row[csf("po_break_down_id")];
					
					$booking_data[$row[csf("booking_id")]]["booking_id"]=$row[csf("booking_id")];
					$booking_data[$row[csf("booking_id")]]["booking_type"]=$row[csf("booking_type")];
					$booking_data[$row[csf("booking_id")]]["update_date"]=$row[csf("update_date")];
					$booking_data[$row[csf("booking_id")]]["is_short"]=$row[csf("is_short")];
					$booking_data[$row[csf("booking_id")]]["booking_no"]=$row[csf("booking_no")];
					$booking_data[$row[csf("booking_id")]]["company_id"]=$row[csf("company_id")];
					$booking_data[$row[csf("booking_id")]]["year_book"]=$row[csf("year_book")];
					$booking_data[$row[csf("booking_id")]]["booking_no_prefix_num"]=$row[csf("booking_no_prefix_num")];
					$booking_data[$row[csf("booking_id")]]["entry_form"]=$row[csf("entry_form")];
					$booking_data[$row[csf("booking_id")]]["process_loss_percent"]+=$row[csf("process_loss")];
					$booking_data[$row[csf("booking_id")]]["process_loss_cnt"]++;
					
					$booking_data[$row[csf("booking_id")]]["fabric_source"]=$row[csf("fabric_source")];
					$booking_data[$row[csf("booking_id")]]["booking_date"]=$row[csf("booking_date")];
					$booking_data[$row[csf("booking_id")]]["update_date"]=$row[csf("update_date")];
					$booking_data[$row[csf("booking_id")]]["delivery_date"]=$row[csf("delivery_date")];
					$booking_data[$row[csf("booking_id")]]["is_approved"]=$row[csf("is_approved")];
					$booking_data[$row[csf("booking_id")]]["ready_to_approved"]=$row[csf("ready_to_approved")];
					$booking_data[$row[csf("booking_id")]]["supplier_id"]=$row[csf("supplier_id")];
					$booking_data[$row[csf("booking_id")]]["buyer_id"]=$row[csf("buyer_id")];
					$booking_data[$row[csf("booking_id")]]["item_category"]=$row[csf("item_category")];
					$booking_data[$row[csf("booking_id")]]["type"]=$row[csf("type")];
					$booking_data[$row[csf("booking_id")]]["pay_mode"]=$row[csf("pay_mode")];
					$booking_data[$row[csf("booking_id")]]["delivery_date_dtls"]=$row[csf("delivery_date_dtls")];
					$booking_data[$row[csf("booking_id")]]["currency_id"]=$row[csf("currency_id")];
					$booking_data[$row[csf("booking_id")]]["process"].=$row[csf("process")].",";
					
					$booking_data[$row[csf("booking_id")]]["fin_fab_qnty"]+=$row[csf("fin_fab_qnty")];
					$booking_data[$row[csf("booking_id")]]["grey_fab_qnty"]+=$row[csf("grey_fab_qnty")];
					$booking_data[$row[csf("booking_id")]]["wo_qnty"]+=$row[csf("wo_qnty")];
					$booking_data[$row[csf("booking_id")]]["amount"]+=$row[csf("amount")];
					$booking_data[$row[csf("booking_id")]]["sample_qnt"]+=($row[csf("bh_qty")]*1+$row[csf("rf_qty")]*1);
					$booking_data[$row[csf("booking_id")]]["uom"]=$row[csf("uom")];
					if($job_check[$row[csf("booking_id")]][$row[csf("job_no")]]=="")
					{
						$booking_data[$row[csf("booking_id")]]["job_no"].=$row[csf("job_no")].",";
						$booking_data[$row[csf("booking_id")]]["job_no_prefix_num"].=$row[csf("job_no_prefix_num")].",";
						$booking_data[$row[csf("booking_id")]]["job_year"].=$row[csf("job_year")].",";
						$booking_data[$row[csf("booking_id")]]["style_ref_no"].=$row[csf("style_ref_no")].",";
						$booking_data[$row[csf("booking_id")]]["season_buyer_wise"].=$season_library[$row[csf("season_buyer_wise")]].",";
						
						$job_check[$row[csf("booking_id")]][$row[csf("job_no")]]=$row[csf("job_no")];
					}
					if($order_check[$row[csf("booking_id")]][$row[csf("po_break_down_id")]]=="")
					{
						$booking_data[$row[csf("booking_id")]]["po_break_down_id"].=$row[csf("po_break_down_id")].",";
						$booking_data[$row[csf("booking_id")]]["po_number"].=$row[csf("po_number")].",";
						$booking_data[$row[csf("booking_id")]]["file_no"].=$row[csf("file_no")].",";
						$booking_data[$row[csf("booking_id")]]["grouping"].=$row[csf("grouping")].",";
						$booking_data[$row[csf("booking_id")]]["pub_shipment_date"].=change_date_format($row[csf("pub_shipment_date")]).",";
						
						$order_check[$row[csf("booking_id")]][$row[csf("po_break_down_id")]]=$row[csf("po_break_down_id")];
					}
					if($row[csf("booking_type")]==1 && $row[csf("is_short")]==1)//responsible_dept,reason
					{
						if($row[csf("reason")]!='')
						{
							$booking_data[$row[csf("booking_id")]]["reason"].=$row[csf("reason")].",";
						}
						if($row[csf("responsible_dept")]!='')
						{
							$resp_dept=explode(",",$row[csf("responsible_dept")]);
							$dept_name="";
							foreach($resp_dept as $dept)
							{
								if($dept_name=="") $dept_name=$department_library[$dept]; else $dept_name.=",".$department_library[$dept];
							}
							$booking_data[$row[csf("booking_id")]]["dept_name"].=$dept_name.",";
						}
					}
					$booking_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
				}
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 1, $booking_id_arr, $empty_arr);//Book ID Ref from=1
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 2, $po_id_arr, $empty_arr);//PO ID Ref from=2
				//==================Temp=======================================
				$wopi_arr=array(); $tem_pi=array();
				if($cbo_category==4)
				{
					if($cbo_company>0) $piCond="and a.importer_id=$cbo_company"; else $piCond="";
					//echo "select a.pi_number, b.work_order_no, b.work_order_dtls_id from com_pi_master_details a, com_pi_item_details b where a.id=b.pi_id and a.item_category_id=4 and a.status_active=1 and a.importer_id=$cbo_company and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.work_order_dtls_id>0";
					$sql_wo_pi=sql_select("select a.id,a.pi_number, b.work_order_no, b.work_order_dtls_id from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g  where a.id=b.pi_id and  b.work_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.item_category_id=4 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.work_order_dtls_id>0 $piCond");
					//echo "select a.pi_number, b.work_order_no, b.work_order_dtls_id from com_pi_master_details a, com_pi_item_details b where a.id=b.pi_id and a.item_category_id=4 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.work_order_dtls_id>0 $piCond";	
					foreach($sql_wo_pi as $rowPi)
					{
						//if($tem_pi[$rowPi[csf('work_order_no')]]=="")
						//{
							$tem_pi[$rowPi[csf('work_order_no')]]=$rowPi[csf('pi_number')];
							$wopi_arr[$rowPi[csf('work_order_no')]].=$rowPi[csf("pi_number")]."__";//.=$rowPi[csf('pi_number')]."**";
							$wopiId_arr[$rowPi[csf('work_order_no')]].=$rowPi[csf("id")]."__";//.=$rowPi[csf('pi_number')]."**";
						//}
						//echo $rowPi[csf('work_order_no')].'--'.$rowPi[csf('pi_number')].'==';
						$pi_number_arr[] = "'".$rowPi[csf('id')]."'";
						$piArr[$rowPi[csf("id")]]=$rowPi[csf("id")];
					}
					//unset($sql_wo_pi);
					fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 3, $piArr, $empty_arr);//PI ID Ref from=3
					$pi_number_string = implode(',',array_unique($pi_number_arr));

					//============== For BTB Lc Data ==================
					if($pi_number_string!="")
					{
						if($cbo_company>0) $comCond="and a.importer_id=$cbo_company"; else $comCond="";
				
						// $btb_sql="select pi_id,lc_number,lc_type_id,payterm_id,tenor from com_btb_lc_master_details where  status_active=1 and is_deleted=0 $comCond";
						
						$btb_sql = "SELECT a.id, a.lc_number,a.lc_type_id,a.payterm_id,a.tenor, c.pi_number
						FROM com_btb_lc_master_details a, com_btb_lc_pi b, com_pi_master_details c,gbl_temp_engine g
						WHERE a.id=b.com_btb_lc_master_details_id  and b.pi_id=c.id and c.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=37  and a.is_deleted = 0 and a.item_basis_id=1 $comCond
						
						UNION ALL
						SELECT a.id, a.lc_number,a.lc_type_id,a.payterm_id,a.tenor,c.pi_number
						FROM com_btb_lc_master_details a, com_btb_lc_pi b, com_pi_master_details c,gbl_temp_engine g
						WHERE a.id=b.com_btb_lc_master_details_id and b.pi_id=c.id and c.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=37  and a.is_deleted = 0 and a.item_basis_id=2 $comCond
						";
						 //echo $btb_sql;
						$sql_result=sql_select($btb_sql);
						$btb_pi=array();
						foreach($sql_result as $rows)
						{					
							$btb_pi[$rows[csf('pi_number')]]['lc_number']=$rows[csf('lc_number')];
							$btb_pi[$rows[csf('pi_number')]]['lc_type_id']=$rows[csf('lc_type_id')];
							$btb_pi[$rows[csf('pi_number')]]['payterm_id']=$rows[csf('payterm_id')];
							$btb_pi[$rows[csf('pi_number')]]['tenor']=$rows[csf('tenor')];
						}
						//var_dump($btb_pi);
					}
				}
				//----------------------
				if($cbo_category==2 || $cbo_category==3 || $cbo_category==4 ||  $cbo_category==25)
				{
					if ($cbo_company==0) $company_cond_id=""; else $company_cond_id=" and b.company_id=$cbo_company";
					if($cbo_category==2)
					{
						$booking_check_prod=array();
						$prod_1st_sql=sql_select("select a.id as book_id, c.booking_without_order, transaction_date as receive_date, c.cons_quantity as rcv_qnty from  wo_booking_mst a, pro_batch_create_mst b , inv_transaction c, gbl_temp_engine g where a.id=b.booking_no_id and b.id=c.pi_wo_batch_no and   a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.item_category in(2,3)  and c.pi_wo_batch_no>0 and c.status_active=1 and c.item_category in(2,3) and c.transaction_type=1");
						$first_rec_date_prod=array();
						foreach($prod_1st_sql as $row)
						{
							//$first_rec_date_prod[$row[csf("book_id")]]=$row[csf("receive_date")];
							$receive_data_pord[$row[csf("book_id")]][$row[csf("booking_without_order")]].=$row[csf("receive_date")].",";
							$receive_qnty_data_prod[$row[csf("book_id")]][$row[csf("booking_without_order")]][$row[csf("receive_date")]]+=$row[csf("rcv_qnty")];
							if($booking_check[$row[csf("book_id")]]=="")
							{
								$first_rec_date_prod[$row[csf("book_id")]]=$row[csf("receive_date")];
								$booking_check_prod[$row[csf("book_id")]]=$row[csf("receive_date")];
							}
						}
						
						$sql_receive="select b.recv_number,b.booking_id, b.receive_date, b.booking_without_order, c.cons_quantity as rcv_qnty from inv_receive_master b, inv_transaction c,gbl_temp_engine g where b.id=c.mst_id and   b.booking_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and c.transaction_type=1 and b.item_category in(2,3)  and b.receive_basis in(12,2) $company_cond_id";
						 	  
						$receive_result=sql_select($sql_receive);
						$receive_data=$receive_qnty_data=$booking_check=array();
						foreach($receive_result as $row)
						{
							$receive_data[$row[csf("booking_id")]][$row[csf("booking_without_order")]].=$row[csf("receive_date")].",";
							$receive_qnty_data[$row[csf("booking_id")]][$row[csf("booking_without_order")]][$row[csf("receive_date")]]+=$row[csf("rcv_qnty")];
							if($booking_check[$row[csf("booking_id")]]=="")
							{
								$first_rec_date[$row[csf("booking_id")]]=$row[csf("receive_date")];
								$booking_check[$row[csf("booking_id")]]=$row[csf("receive_date")];
								$first_rec_no[$row[csf("booking_id")]]=$row[csf("recv_number")];
							}
						}
						
					}
					else
					{
						 $sql="select min(a.recv_number) as recv_number,b.pi_wo_batch_no, min(a.receive_date) as receive_date,min(a.currency_id) as currency_id, sum(b.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,gbl_temp_engine g where a.id=b.mst_id  and   b.pi_wo_batch_no=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.entry_form=24 and  b.item_category in(4)  and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(2,12) $company_cond_id group by b.pi_wo_batch_no";	//echo $sql ;die;
						$sql_result=sql_select($sql);
						$booking_pi_check=array();
						foreach($sql_result as $row)
						{
							//if($booking_pi_check[$row[csf("pi_wo_batch_no")]]=="")
							//{
							$first_rec_date[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
							$first_rec_no[$row[csf("pi_wo_batch_no")]]=$row[csf("recv_number")];
							$booking_pi_check[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
							//}
							//$rec_amt_arr[$row[csf("pi_wo_batch_no")]]=$row[csf("rec_amt")];
							//$rec_currency_arr[$row[csf("pi_wo_batch_no")]]=$row[csf("currency_id")];
						}
						unset($sql_result);
							if($cbo_category==3) //Woven Fab
							{
								 $pi_recv_sql="select min(a.recv_number) as recv_number,b.pi_wo_batch_no, min(a.receive_date) as receive_date,min(a.currency_id) as currency_id, sum(b.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,gbl_temp_engine g where a.id=b.mst_id and   b.pi_wo_batch_no=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.entry_form=17 and  b.item_category in(3)  and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(2,1) $company_cond_id group by b.pi_wo_batch_no";
								
							$wvn_receive_result=sql_select($pi_recv_sql);
							$receive_data=$receive_qnty_data=$booking_check=array();
							foreach($wvn_receive_result as $row)
							{
								$first_rec_date[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
								$first_rec_no[$row[csf("pi_wo_batch_no")]]=$row[csf("recv_number")];
								//$booking_pi_check[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
							}
							unset($wvn_receive_result);
						}
						
					}
				}
				//============Temp====================
			//=====================================FSO===================================================
						
			$fso_data = sql_select("select a.id, a.job_no, a.company_id, a.sales_booking_no, a.booking_id,a.po_job_no,sum(c.grey_qty) as grey_qty from gbl_temp_engine g,fabric_sales_order_mst a left join wo_booking_mst b 	on a.booking_id=b.id ,fabric_sales_order_dtls c where   a.booking_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and c.mst_id=a.id  ".where_con_using_array($booking_arr,1,'a.booking_id')."  group by a.id, a.job_no, a.company_id, a.sales_booking_no, a.booking_id,a.po_job_no");

			foreach($fso_data as $vals){
				$booking_wise_data_arr[$vals[csf('sales_booking_no')]]['fso_no']=$vals[csf('job_no')];
				$booking_data[$vals[csf('booking_id')]]['fso_qty']+=$vals[csf('grey_qty')];

			}

			//=================================================================================================
			
			$pre_cost_data=sql_select("select a.id as booking_id,avg(e.avg_process_loss) as avg_process_loss from gbl_temp_engine g,wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c left join wo_pre_cost_fabric_cost_dtls e on c.id=e.job_id where   a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and a.booking_no=b.booking_no     group by a.id");

			foreach($pre_cost_data as $val){
				$booking_data[$val[csf('booking_id')]]['process_loss']=$val[csf('avg_process_loss')];
				//$booking_data[$val[csf('booking_id')]]['process_loss_percent']=$val[csf('process_loss_percent')];
			}

				$emb_sql="select a.emb_name, b.item_number_id, a.job_no as job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b,gbl_temp_engine g where a.job_id=b.job_id  and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 ";
				// $po_id_arr
				// echo $emb_sql;
				$emb_sql_result=sql_select($emb_sql);
				foreach($emb_sql_result as $row)
				{
					$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
					$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
				}
				unset($emb_sql_result);

				//$booking_id_arr[$row[csf("booking_id")]]
				//var_dump($booking_data);die;
				//".where_con_using_array($po_id_arr,1,'po_break_down_id')."
				 //echo $sql;
				//echo  $po_id ;die;
				if($cbo_category!=2)
				{
				 $sql_recv="select b.pi_wo_batch_no,b.prod_id, (a.currency_id) as currency_id,(c.quantity) as rcv_qnty, (c.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,order_wise_pro_details c,gbl_temp_engine g   where a.id=b.mst_id and  b.id=c.trans_id and c.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37  and c.trans_type=1 and a.entry_form=24 and c.entry_form=24 and  b.item_category in(4)  and c.status_active=1 and c.is_deleted=0 and e.status_active=1 and e.is_deleted=0 and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(2,12) $company_cond_id   ";
						$sql_Recv_result=sql_select($sql_recv);
						$propo_id_check=array();
						foreach($sql_Recv_result as $row)
						{
							//$first_rec_date[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
							//$first_rec_no[$row[csf("pi_wo_batch_no")]]=$row[csf("recv_number")];
							if($propo_id_check[$row[csf('prop_id')]]=="")
							{
							$propo_id_check[$row[csf('prop_id')]]=$row[csf('prop_id')];
							$rec_amt_arr[$row[csf("pi_wo_batch_no")]]+=$row[csf("rec_amt")];
							}
							$rec_currency_arr[$row[csf("pi_wo_batch_no")]]=$row[csf("currency_id")];
						}
						unset($sql_Recv_result);
				}
				
				// $pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b where a.id=b.pi_id and a.status_active=1 and a.is_deleted=0
				// and a.item_category_id=3 and a.pi_basis_id=1 and a.entry_form=166
				// group by  a.id,a.pi_number, b.work_order_no order by a.pi_number desc";
					$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id and b.work_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0
					and a.item_category_id in(2,3,12,25) and a.pi_basis_id=1 
					 ";
				$pi_sql_result=sql_select($pi_sql);
				$pi_no_arr = array();
				foreach ($pi_sql_result as $value) 
				{
					$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
					$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];
				}
				unset($pi_sql_result);
		
				 $wo_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_booking_mst a, approval_history b,gbl_temp_engine g where a.id=b.mst_id and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(8,7,32,13,12) ".where_con_using_array($booking_id_arr,0,'a.id')." order by b.id desc";
				$wo_his_sql_result=sql_select($wo_his_sql);
				//$pi_no_arr = array();
				$user_arr=return_library_array( "select id, user_name from user_passwd", 'id', 'user_name' );	
				foreach ($wo_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_his_sql_result);
				
				$wo_non_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_non_ord_samp_booking_mst a, approval_history b,gbl_temp_engine g where a.id=b.mst_id and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(8,7,32,9) ".where_con_using_array($booking_id_arr,0,'a.id')." order by b.id desc";
				$wo_non_his_sql_result=sql_select($wo_non_his_sql);
				//$pi_no_arr = array();
			 
				foreach ($wo_non_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_non_his_sql_result);
				
				// echo "<pre>";
				// print_r($booking_data);//die;
				// echo "</pre>";
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);

				$i=1;$summer_data=array();$job_check=array();
				$tot_wo_currency_usd_amt=$tot_recv_usd_amt=$tot_embl_wo_amount=$tot_sample=0;
						
				foreach($booking_data as $row)
				{
					$variable=$row[("booking_no_prefix_num")];
					$sample_qnt=0;
					$sample_qnt=$row['sample_qnt'];
					$tot_sample+=$row['sample_qnt'];
					if($row[("item_category")]==2 || $cbo_category==3)
					{
						if($row[("fabric_source")]==1 || $row[("fabric_source")]==2 || $row[("fabric_source")]==4)
						{
							if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
							if ($row[("type")]==0)
							{	
								if ($row[("booking_type")]==1 || $row[("booking_type")]==2  || $row[("booking_type")]==3  || $row[("booking_type")]==6)
								{
									if ($row[("is_short")]==1)
									{
										$wo_type="Short";
										$wo_typw_id=1;
									}
									else if ($row["entry_form"]==108){
										$wo_type="Partial";
										$wo_typw_id=5;
									}
									else
									{
										$wo_type="Main";
										$wo_typw_id=2;
									}
								}
								elseif($row[("booking_type")]==4)
								{
									$wo_type="Sample With Order";
									$wo_typw_id=3;
								}
							}
							else
							{
								$wo_type="Sample Non Order";
								$wo_typw_id=4;
							}
							// echo $wo_typw_id.'ssd';
							
							$job_no=$style_ref_no=$po_number=$file=$ref=$job_number="";
							
							$p=1;
							$ship_date_arr=array_unique(explode(",",chop($row[("pub_shipment_date")],",")));
							foreach($ship_date_arr as $ship_date)
							{
								if($p==1)
								{
									$min_ship_date=$ship_date;
									$max_ship_date=$ship_date;
								}
								
								if(strtotime($min_ship_date)>strtotime($ship_date)) $min_ship_date=$ship_date;
								if(strtotime($max_ship_date)<strtotime($ship_date)) $max_ship_date=$ship_date;
								$p++;
							}
							
							$all_po_id=implode(",",array_unique(explode(",",chop($row[("po_break_down_id")],","))));
							$job_no=implode(",",array_unique(explode(",",chop($row[("job_no_prefix_num")],","))));
							$job_number=implode(",",array_unique(explode(",",chop($row[("job_no")],","))));
							$job_year=implode(",",array_unique(explode(",",chop($row[("job_year")],","))));
							$style_ref_no=implode(",",array_unique(explode(",",chop($row[("style_ref_no")],","))));
							$po_number=implode(", ",array_unique(explode(",",chop($row[("po_number")],","))));
							$file=implode(",",array_unique(explode(",",chop($row[("file_no")],","))));
							$ref=implode(",",array_unique(explode(",",chop($row[("grouping")],","))));
							$short_reason=implode(",",array_unique(explode(",",chop($row[("reason")],","))));
							$dept_name=implode(",",array_unique(explode(",",chop($row[("dept_name")],","))));
							$season_buyer=implode(",",array_unique(explode(",",chop($row[("season_buyer_wise")],","))));
							
							$cbo_company=$row[("company_id")];
							$print_report_format_ids=$print_report_format_arr[$cbo_company];
							$partial_print_report_format_ids=$partial_print_report_format_arr[$cbo_company];
							$woven_partial_print_report_format_ids=$woven_partial_print_report_format_arr[$cbo_company];
							$sample_req_non_print_report_format_ids=$sample_req_non_print_report_format_arr[$cbo_company];
							$sample_req_withorder_print_report_ids=$sample_req_booking_withorder_print_report_arr[$cbo_company];
							$sample_booking_without_print_report_ids=$sample_booking_non_print_report_format_arr[$cbo_company];
							$sample_booking_withorder_print_report_ids=$sample_booking_print_report_format_arr[$cbo_company];
							//echo $sample_req_non_print_report_format_ids.'-D-';
							$short_booking_print_report_ids=$print_short_report_format_arr[$cbo_company];
							//echo $short_booking_print_report_ids.'-D-';
							
							$short_format_ids=explode(",",$short_booking_print_report_ids);
							$short_format_first_print_button=array_shift($short_format_ids);
							
							$sample_req_format_ids=explode(",",$sample_req_withorder_print_report_ids);
							$samp_req_wo_first_print_button=array_shift($sample_req_format_ids);

							$sample_req_without_format_ids=explode(",",$sample_req_non_print_report_format_ids);
							$samp_req_without_wo_first_print_button=array_shift($sample_req_without_format_ids);
							
							
							$sample_req_with_print_ids=explode(",",$sample_req_withorder_print_report_ids);
							$samp_req_with_first_print_button=array_shift($sample_req_with_print_ids);
							//echo $sample_req_format_first_print_button.'DF';
							$sample_booking_without_print_ids=explode(",",$sample_booking_without_print_report_ids);
							$samp_booking_without_first_print_button=array_shift($sample_booking_without_print_ids);
							
							$sample_booking_with_print_ids=explode(",",$sample_booking_withorder_print_report_ids);
							$samp_booking_with_first_print_button=array_shift($sample_booking_with_print_ids);
							
							$partial_format_ids=explode(",",$partial_print_report_format_ids);
							$woven_partial_format_ids=explode(",",$woven_partial_print_report_format_ids);
							$part_first_print_button=array_shift($partial_format_ids);
							$woven_part_first_print_button=array_shift($woven_partial_format_ids);
							
							$format_ids=explode(",",$print_report_format_ids);
							$print_b_16="";
							foreach ($format_ids as $key => $button_id) {
								if($button_id==719)
								{
									$print_b_16=$button_id;
								}
							}
						
							$first_print_button=array_shift($format_ids);
							$second_print_button= array_shift($format_ids);
							//$part_first_print_button=array_shift($partial_format_ids);
							//echo $partial_print_report_format_ids.'=DD='.$first_print_button;
							
							
							//print ($part_first_print_button).'='.$row["entry_form"].'---';

							//143,160,220,151,175,155,218,84,85,235 partial
							if($cbo_category==2 || $cbo_category==3)
							{
								if($row["entry_form"]==118)
								{
									
									if($first_print_button==1)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report_gr";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										
										//part_first_print_button $row["entry_form"]
									}
									else if($first_print_button==2)
									{
										if($wo_typw_id==2)
										{
											$action_type="show_fabric_booking_report";
											$wo_typw_id=73;
										}
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##'  title='PB F1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." <a/>";			
									}
									else if($first_print_button==3)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report3";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##'  title='PB F2' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";	
									}
									else if($first_print_button==4)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report1";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##'  title='PFC F1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==5)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report2";
										else $action_type="show_fabric_booking_report";  
										$variable="<a href='##' title='PFC F2' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	    
									}
									else if($first_print_button==6)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report4";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##' title='FB F1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==7)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report5";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##' title='FB F2' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==28)
									{
										$action_type="show_fabric_booking_report_akh"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==45)
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==53)
									{
										$action_type="show_fabric_booking_report_jk";
										
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==93)
									{
										$action_type="show_fabric_booking_report_libas"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==786)
									{
										$action_type="show_fabric_booking_report25"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==73)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_mf";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==193)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_print4";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==269)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_knit";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($second_print_button==73)
									{
										$action_type="show_fabric_booking_report_mf";  
										$variable="<a href='##'  title='PB MF' onClick=\"generate_fabric_report('".$second_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==849)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_bl1";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==719)
									{
										$action_type="show_fabric_booking_report16";  
										$variable="<a href='##'  title='B16' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($second_print_button==719)
									{
										$action_type="show_fabric_booking_report16";  
										$variable="<a href='##'  title='B16' onClick=\"generate_fabric_report('".$second_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($print_b_16==719)
									{
										$action_type="show_fabric_booking_report16";  
										$variable="<a href='##'  title='B16' onClick=\"generate_fabric_report('".$print_b_16."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==140) //Sampe Req Fab Without Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition Fabric Booking -Without order";
									if($samp_req_without_wo_first_print_button==10)
									{
										$action_type="show_fabric_booking_report";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_without_wo_first_print_button==17)
									{
										$action_type="show_fabric_booking_report_barnali";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}else if($row["entry_form"]==203) //Sampe Req Fab Without Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition With Booking";
									if($samp_req_without_wo_first_print_button==109)
									{
										$action_type="sample_requisition_print";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(203,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_without_wo_first_print_button==111)
									{
										$action_type="sample_requisition_print6";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(203,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}else if($row["entry_form"]==142) //Sampe Req With Booking  
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition With Booking";
									if($samp_req_without_wo_first_print_button==110)
									{
										$action_type="sample_requisition_print";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_without_wo_first_print_button==109)
									{
										$action_type="sample_requisition_print1";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==139) //Sampe Req Fab With Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition Fabric Booking -With order";
									if($samp_req_wo_first_print_button==155)
									{
										$action_type="show_fabric_booking_report";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(139,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_wo_first_print_button==17)
									{
										$action_type="show_fabric_booking_report2";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(139,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==88) //Sampe Req Fab With Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									//echo $short_format_first_print_button.'X';
									$page_name="Short Fabric Booking";
									if($short_format_first_print_button==136)
									{
										$action_type="print_booking_3";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==8)
									{
										$action_type="show_fabric_booking_report";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==9)
									{
										$action_type="show_fabric_booking_report3";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==244)
									{
										$action_type="show_fabric_booking_report_ntg";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==46)
									{
										$action_type="show_fabric_booking_report_urmi";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==86) //Main Fabric Booking
								{
									if($first_print_button==1)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report_gr"; else $action_type="show_fabric_booking_report"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}
									else if($first_print_button==73)
									{
										 $action_type="show_fabric_booking_report_b6"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
									else if($first_print_button==53)
									{
										 $action_type="show_fabric_booking_report_jk"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
									else if($first_print_button==45)//
									{
										 $action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
									else if($first_print_button==28)//show_fabric_booking_report_akh
									{
										 $action_type="show_fabric_booking_report_akh"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
								}
								else if($row["entry_form"]==271) //Woven Partial Fabric Booking
								{
									//$variable=$row[("booking_no_prefix_num")];
									//echo $first_print_button.'D';
									if($part_first_print_button==143)
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										
										//part_first_print_button $row["entry_form"]
									}
									else if($part_first_print_button==84)
									{
										
										$action_type="show_fabric_booking_report_urmi_per_job";											
										$variable="<a href='##'  title='PB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." <a/>";			
									}
									else if($part_first_print_button==85)
									{
										$action_type="print_booking_3";
										 
										$variable="<a href='##'  title='PB F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";	
									}
									else if($part_first_print_button==151)
									{
										$action_type="show_fabric_booking_report_advance_attire_ltd";
										
										$variable="<a href='##'  title='PFC F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($part_first_print_button==160)
									{
										$action_type="print_booking_5";  
										$variable="<a href='##' title='PFC F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	    
									}
									else if($part_first_print_button==175)
									{
									   $action_type="print_booking_6";
										
										$variable="<a href='##' title='FB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($part_first_print_button==155)
									{
										$action_type="fabric_booking_report";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==160)
									{
										$action_type="print_booking_5";  
										$variable="<a href='##' title='PFC F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	
									}
									else if($woven_part_first_print_button==143)
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										
										//part_first_print_button $row["entry_form"]
									}
									else if($woven_part_first_print_button==84)
									{
										
										$action_type="show_fabric_booking_report_urmi_per_job";											
										$variable="<a href='##'  title='PB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." <a/>";			
									}
									else if($woven_part_first_print_button==85)
									{
										$action_type="print_booking_3";
										 
										$variable="<a href='##'  title='PB F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";	
									}
									else if($woven_part_first_print_button==151)
									{
										$action_type="show_fabric_booking_report_advance_attire_ltd";
										
										$variable="<a href='##'  title='PFC F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									
									else if($woven_part_first_print_button==175)
									{
									   $action_type="print_booking_6";
										
										$variable="<a href='##' title='FB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==155)
									{
										$action_type="fabric_booking_report";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								} //Woven Partial Booking end
								else if($row["entry_form"]==108) // Partial Fabric Booking
								{
									if ($part_first_print_button==143) // print 1
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==84) // print 2
									{
										$action_type="show_fabric_booking_report_urmi_per_job"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==85) // print 3
									{
										$action_type="print_booking_3"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==151) // print 4
									{
										$action_type="show_fabric_booking_report_advance_attire_ltd"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==160) // print 5
									{
										$action_type="print_booking_5"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==175) // print 6
									{
										$action_type="print_booking_6"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==218) // print 7
									{
										$action_type="print_booking_7"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==220) // print 8
									{
										$action_type="print_booking_northern_new"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==235) // print 9
									{
										$action_type="print_booking_northern_9"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==274) // print 10
									{
										$action_type="print_booking_10"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==241) // print 11
									{
										$action_type="print_booking_11"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==269) // print 12
									{
										$action_type="print_booking_12"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==28) // print 13
									{
										$action_type="print_booking_13"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==280) // print 14
									{
										$action_type="print_booking_14"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==304) // print 15
									{
										$action_type="print_booking_15"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==719) // print 16
									{
										$action_type="print_booking_16"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==723) // print 17
									{
										$action_type="print_booking_17"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==339) // print 18
									{
										$action_type="print_booking_18"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==370) // print 19
									{
										$action_type="print_booking_19"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==768) // print 20
									{
										$action_type="print_booking_20"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
								}
								else
								{
									if($row[("booking_type")]==4 && $row[("is_short")]=="")
									{  
										$page_name="Sample Fabric Booking Without order";
										// echo $samp_booking_without_first_print_button.'F'.$row[("is_short")].'<br>';
										if($sample_booking_without_print_ids[0]==64) //Metro
										{
											$action_type="show_fabric_booking_report5";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==37) //Akh
										{
											$action_type="show_fabric_booking_report4";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==36) //Amana
										{
											$action_type="show_fabric_booking_report3"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==34) //Print Booking
										{
											$action_type="show_fabric_booking_report"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==35) //Print Booking2
										{
											$action_type="show_fabric_booking_report2"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==72) //Print FFl
										{
											$action_type="show_fabric_booking_report6"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==174) //Print UG
										{
											$action_type="show_fabric_booking_report7"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
									}
									if($row[("booking_type")]==4 && $row[("is_short")]==2) //Sample Booking with order
									{  
										$page_name="Sample Fabric Booking With order";
										// echo $samp_booking_without_first_print_button.'F'.$row[("is_short")].'<br>';
										if($samp_booking_with_first_print_button==38) //Print Booking
										{
											$action_type="show_fabric_booking_report";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(89,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($samp_booking_without_first_print_button==39) //Print Booking2
										{
											$action_type="show_fabric_booking_report2";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(89,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($samp_booking_without_first_print_button==64) //Metro
										{
											$action_type="show_fabric_booking_report3"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(89,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($samp_booking_with_first_print_button==16) //Print Booking3
										{
										
											$action_type="show_fabric_booking_report_print_booking_3"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no")]."<a/>";
										}
										else if($samp_booking_with_first_print_button==177) //Print Booking4
										{
										
											$action_type="show_fabric_booking_report4"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no")]."<a/>";
										}
										else $variable=$row[("booking_no")];
									}
								}
							} //Fabric Booking End
							
							//143,160,220,151,175,155,218,84,85,235
						    //  if($part_first_print_button==220 && $row["entry_form"]==108)
							/*if($row["entry_form"]==108)
							{
								$action_type="print_booking_northern_new"; 
								$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
							}*/

							//echo $row[("booking_type")];						
						
							//echo $row[("fabric_source")];die;
						
							if($row[("fabric_source")]==2)
							{
								$rcv_date_arr=array_unique(explode(",",chop($receive_data[$row[("booking_id")]][$row[("type")]],",")));
								if($row[("booking_type")]==1 && $row[("is_short")]==2)
								{
									$summer_data[1]["book_qnty"]+=$row[("fin_fab_qnty")];
									
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[1]["rcv_qnty_intime"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[1]["rcv_qnty"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								else if($row[("booking_type")]==1 && $row[("is_short")]==1)
								{
									$summer_data[2]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[2]["rcv_qnty_intime"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[2]["rcv_qnty"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								else if($row[("booking_type")]==4 )
								{
									$summer_data[3]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[3]["rcv_qnty_intime"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[3]["rcv_qnty"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
							}
							else if($row[("fabric_source")]==1)
							{
								$rcv_date_arr=array_unique(explode(",",chop($receive_data_pord[$row[("booking_id")]][$row[("type")]],",")));
								if($row[("booking_type")]==1 && $row[("is_short")]==2)
								{
									$summer_data[1]["book_qnty"]+=$row[("fin_fab_qnty")];
									
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[1]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[1]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								else if($row[("booking_type")]==1 && $row[("is_short")]==1)
								{
									$summer_data[2]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[2]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[2]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								
								else if($row[("booking_type")]==4 )
								{
									$summer_data[3]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[3]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[3]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
							}
							else if($row[("fabric_source")]==4)
							{
								$summer_data[4]["book_qnty"]+=$row[("fin_fab_qnty")];
								foreach($rcv_date_arr as $rcv_date)
								{
									if($rcv_date<=$row[("delivery_date")])
									{
										$summer_data[4]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
									$summer_data[4]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
								}
							}
							
							$supplier_name="";
							if($row[("pay_mode")]==3 || $row[("pay_mode")]==5)
							{
								$supplier_name=$company_library[$row[("supplier_id")]];
							}
							else $supplier_name=$supplierArr[$row[("supplier_id")]];
							$ready_to_approved=$row[("ready_to_approved")];
							if($ready_to_approved==1)
							{
							$last_update_date=$row[("update_date")];
							}
							//echo $variable;
							//<a href='#report_details' onClick="generate_fabric_booking_report('<? echo $row[("booking_no")];','show_trim_booking_report');"></a>
							if($row[("delivery_date")]!="" && $row[("delivery_date_dtls")]=="" )  $row[("delivery_date")]=$row[("delivery_date")];else  $row[("delivery_date")]=$row[("delivery_date_dtls")];
							?>
							<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
								<td width="30"><? echo $i;?></td>
								<td width="100" align="center"><p><? echo $company_library[$row[("company_id")]]; ?></td>	
								<td width="60" align="center" title="Entry Form=<? echo $row["entry_form"];?>"><? echo $variable; ?><? //echo $row[("booking_no_prefix_num")];?></td>
                                <td width="70" align="center"><p><? echo $pay_mode[$row[("pay_mode")]]; ?></td>	

                                <?
								if ($cbo_category==3 || $cbo_category==2)
								{
									$pi_id=$pi_no_arr[$row[("booking_no")]]['pi_id'];
									?>
										<td width="100" align="center" title="<? echo 'Pi='.$pi_id.', Booking-'.$row[("booking_no")]; ?>"><p><? echo $pi_no_arr[$row[("booking_no")]]['pi_no']; ?></td>
									<? 
								}
								?>                                

								<td width="60" align="center"><p><? echo $row[("year_book")]; ?></td>
								<td width="70" align="center"><p><? echo change_date_format($row[("booking_date")]); ?></p></td>
								<td width="70" align="center"><p><?  $update_date=explode(" ",$row[("update_date")]);echo change_date_format($update_date[0])//echo change_date_format($wo_last_date_arr[$row[("booking_id")]]); ?></p></td>
								<td width="70" align="center"><p><? echo change_date_format($row[("delivery_date")]); ?></p></td>
								<td width="70" align="center"><p>
								<? 
								$lead_time=0;
								if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00")
								{
									$lead_time=datediff("d", $row[("booking_date")], $row[("delivery_date")]);
								}
								if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day";
								?></p></td>
								<td width="100"><p><? echo $wo_type;?></p></td>
                                
								<td width="100" align="center"><? echo $yes_no[$row[("ready_to_approved")]]; ?></td>
                              
								 <td width="100" align="center"><? $last_update_date=explode(" ",$last_update_date);echo change_date_format($last_update_date[0]).'<br>'.$last_update_date[1]; ?></td>
								
							 
								<td width="80"><p><? echo $approval_type_arr[$row[("is_approved")]]; ?></p></td>
                                <?
                                $approved_date=$last_app_arr[$row[("booking_id")]]['approved_date'];
								$approved_by=$last_app_arr[$row[("booking_id")]]['approved_by'];
								?>
                                 <td width="100" title="bookingId=<? echo $row[("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                                
                                 
								<td width="100"><p><? echo $supplier_name; ?></p></td>
								<td width="100"><p><? echo $buyerArr[$row[("buyer_id")]]; ?></p></td>
								<td width="70"><div style="word-wrap:break-word; width:70px"><? echo $job_no;//$row[("job_no_prefix_num")]; ?></div></td>
                              	 <td width="70"><p><? echo $season_buyer;//$row[("job_no_prefix_num")]; ?>&nbsp;</p></td>
								<td width="60"><? echo $job_year; ?></td>
                                
								<td width="100"><p><? if ($row[("type")]==0) echo $style_ref_no; else echo $nonStyleArr[$style_ref_no]; ?></p></td>
								<td width="100"><p><? echo $printButton.$ref; ?></p></td>
								<td width="100"><p><? echo $file; ?></p></td>
								<td width="100"><p><? echo $po_number; ?></p></td>
								<td width="100"><p>
								<?
								if ($row[("type")]==0)
								{
									echo "Max - ". $max_ship_date;
									$order_count=explode(",",$po_number);
									if(count($order_count)>1) echo "<br> Min  - " . $min_ship_date; 
								}
								?></p></td>
								<td width="80"><p><? echo $item_category[$row[("item_category")]]; ?></p></td>
								<? 
								//booking_id
								$td_color="";
								if($row[("booking_type")]==2)
								{
									if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00" && $first_rec_date[$row[("booking_id")]]!="" && $first_rec_date[$row[("booking_id")]]!="0000-00-00")
									{
										if(strtotime($first_rec_date[$row[("booking_id")]])>strtotime($row[("delivery_date")])) $td_color='bgcolor="#FF0000"'; else $td_color='';
									}
									$first_rcv_date=change_date_format($first_rec_date[$row[("booking_id")]]);
								}
								else if($row[("booking_type")]==1 || $row[("booking_type")]==4)
								{
									if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00" && $first_rec_date_prod[$row[("booking_id")]]!="" && $first_rec_date_prod[$row[("booking_id")]]!="0000-00-00")
									{
										if(strtotime($first_rec_date_prod[$row[("booking_id")]])>strtotime($row[("delivery_date")])) $td_color='bgcolor="#FF0000"'; else $td_color='';
									}
									if ($cbo_category==3) //Woven Fabric
									{
										//echo $first_rec_date[$pi_id].'==AA'.$pi_id;
										$first_rcv_date=change_date_format($first_rec_date[$pi_id]);
									}
									else
									{
									$first_rcv_date=change_date_format($first_rec_date_prod[$row[("booking_id")]]);
									}
								}
								 //echo $row[("booking_type")]."***".$row[("type")] ;
								?>
								<td width="70" title="<? echo "Booking No : ".$booking_data[$row[("booking_id")]]["booking_no"].",\nBooking Type:".$row[("booking_type")]."\nFirst Receive No:".$first_rec_no[$row[("booking_id")]];  ?>" align="center" <? echo $td_color; ?> ><p><? echo $first_rcv_date; ?></p></td>
								<?
								if ($cbo_category==4)
								{
									?>
										<td width="100" align="right"><? echo number_format($row[("amount")],2); ?></td>
									<?
								}
								else
								{
									$process_loss_booking=$row['process_loss_percent'];
									$process_loss_budget=$row['process_loss'];
									$process_loss_str='';
									//$title_txt=$row[("booking_type")].'_'.$row[("is_short")].'_'.$row["entry_form"];
									if($row[("booking_type")]==1 && $row[("is_short")]!=1 && $row["entry_form"]=108)
									{
										$process_loss=$process_loss_budget;
										$process_loss_str=$process_loss;
										$fin_qty_with_pl=($row[("fin_fab_qnty")]/(100+$process_loss))*100;
									}
									else
									{
										$process_loss_cnt=$row['process_loss_cnt'];
										$process_loss=$process_loss_booking/$process_loss_cnt;
										$fin_qty_with_pl=$row[("fin_fab_qnty")];
										$process_loss_str='average process loss '.$process_loss.'=('.$process_loss_booking.'/'.$process_loss_cnt.')';
									}
									
									//$fin_qty_with_pl=($row[("fin_fab_qnty")]/(100+$row[("process_loss")]))*100;
									
									$tot_fin_qty_with_pl+=$fin_qty_with_pl;
									?>
										<td width="100" align="right" ><? echo number_format($fin_qty_with_pl,2); ?></td>

										<?
											if ($cbo_category==2) 
											{?>
											<td width="100" align="right" title="<?=$process_loss_str?>"><? echo number_format($process_loss,2); //$row[("process_loss")]; ?></td>
												<?php
											}
										if ($cbo_category==3) 
										{
											$tot_grey_fab_qnty+=$row[("amount")];
											?>
											<td width="100" align="right"><? echo number_format($row[("amount")],2); ?> </td>
											<?
										}
										else
										{
											//$grey_fab_qnty=$row[("grey_fab_qnty")];
											$grey_fab_qnty=$fin_qty_with_pl+($fin_qty_with_pl*$process_loss)/100;
											$tot_grey_fab_qnty+=$row[('grey_fab_qnty')];
											?>
											<td width="100" align="right" title="<?=$grey_fab_qnty;?>"><? echo number_format($row[('grey_fab_qnty')],2); ?></td>
											<?
										}
										if ($cbo_category==2) 
											{?>
											<td width="100" align="right"><? echo number_format($row[("fso_qty")],2); ?></td>
												<?php
											$tot_fso_qty+=$row[("fso_qty")];
										}
								}
								if($cbo_category==2)
								{
									?>
									<td width="80" align="right"><p><? echo number_format($sample_qnt,2); ?></p></td>
									<td width="80"><p><? echo $dept_name; ?></p></td>
									<td width="80"><p><? echo $short_reason; ?></p></td>
									<?
								}
								?>
								<td width="">&nbsp;&nbsp;&nbsp;&nbsp;<? //echo $row[("po_number")]; ?></td>
							</tr>
							<?
							$tot_wo_qnty+=$row[("amount")];
							$tot_fin_fab_qnty+=$row[("fin_fab_qnty")];
							
							$i++;
						
						}
					}
					else
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$print_report_format_ids=$print_report_format_arr[$cbo_company];
						$format_ids=explode(",",$print_report_format_ids);
					
						$first_print_button=array_shift($format_ids);
						$second_print_button= array_shift($format_ids);
						if ($row[("type")]==0)
						{	
							if ($row[("booking_type")]==1 || $row[("booking_type")]==2  || $row[("booking_type")]==3  || $row[("booking_type")]==6)
							{
								if ($row[("is_short")]==1)
								{
									$wo_type="Short";
									$wo_typw_id=1;
								}
								else
								{
									$wo_type="Main";
									$wo_typw_id=2;
								}
							}
							elseif($row[("booking_type")]==4)
							{
								$wo_type="Sample With Order";
								$wo_typw_id=3;
							}
						}
						else
						{
							$wo_type="Sample Non Order";
							$wo_typw_id=4;
						}
						$ready_to_approved=$row[("ready_to_approved")];
						if($ready_to_approved==1)
						{
						$last_update_date=$row[("update_date")];
						}
						// echo $wo_typw_id.'ssd';
						$job_no=$style_ref_no=$po_number=$file=$ref=$job_number="";
						$p=1;
						$ship_date_arr=array_unique(explode(",",chop($row[("pub_shipment_date")],",")));
						foreach($ship_date_arr as $ship_date)
						{
							if($p==1)
							{
								$min_ship_date=$ship_date;
								$max_ship_date=$ship_date;
							}
							
							if($min_ship_date>$ship_date) $min_ship_date=$ship_date;
							if($max_ship_date<$ship_date) $max_ship_date=$ship_date;
							$p++;
						}
						
						$all_po_id=implode(",",array_unique(explode(",",chop($row[("po_break_down_id")],","))));
						$job_no=implode(",",array_unique(explode(",",chop($row[("job_no_prefix_num")],","))));
						$season_buyer=implode(",",array_unique(explode(",",chop($row[("season_buyer_wise")],","))));
						//echo $season_buyer.'DDDD';
						$job_number=implode(",",array_unique(explode(",",chop($row[("job_no")],","))));
						$style_ref_no=implode(",",array_unique(explode(",",chop($row[("style_ref_no")],","))));
						$po_number=implode(", ",array_unique(explode(",",chop($row[("po_number")],","))));
						$file=implode(",",array_unique(explode(",",chop($row[("file_no")],","))));
						$ref=implode(",",array_unique(explode(",",chop($row[("grouping")],","))));
						$short_reason=implode(",",array_unique(explode(",",chop($row[("reason")],","))));
						$dept_name=implode(",",array_unique(explode(",",chop($row[("dept_name")],","))));
					    $job_year=implode(",",array_unique(explode(",",chop($row[("job_year")],","))));
					    $cbo_company=$row[("company_id")];
						$print_report_format_ids=$print_report_format_arr[$cbo_company];
						$format_ids=explode(",",$print_report_format_ids);
						$first_print_button=array_shift($format_ids);
						$second_print_button= array_shift($format_ids);
						//echo $cbo_company.'='.$first_print_button;
						$knit_print_report_format_ids=$multi_knit_print_report_format_arr[$cbo_company];
						$knit_format_ids=explode(",",$knit_print_report_format_ids);
						$knit_first_print_button=array_shift($knit_format_ids);
						
						$trim_format_ids=explode(",",$trim_print_report_format_arr[$cbo_company]);
						$trim_format_ids2=explode(",",$trim_print_report_format_arr2[$cbo_company]);
						$trim_first_print_button=array_shift($trim_format_ids);
						$trim_format_ids3=explode(",",$trim_print_report_format_arr3[$cbo_company]);
						$trim_woven_button= array_shift($trim_format_ids3);
							//$trim_second_print_button= array_shift($trim_format_ids2);
						//	echo $row[("entry_form")].'d'.$knit_first_print_button;
						
						if($cbo_category==4) //Accessories Start
						{
							//echo $first_print_button.'kk';
							if($first_print_button==13 && $row["entry_form"]==272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($first_print_button==13 && $row["entry_form"]==262)
							{ 
							//echo $first_print_button.$row["entry_form"].'kk';
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($first_print_button==13 && $row["entry_form"]!=272 && $row["entry_form"]!=262)
							{ 
								$variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($first_print_button==14 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==15 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==16 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==17 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==18 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==19 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($trim_woven_button[0]==67 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==183 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==177 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==175 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==235 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report9','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==85 && $row["entry_form"]=492 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print_t','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==786 && $row["entry_form"]=492 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print_t7','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button==774 && $row["entry_form"]=492 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report_wg','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
							
							$print_report_format_ids26=$print_report_format_arr26[$cbo_company];
							$format_ids26=explode(",",$print_report_format_ids26);
							//echo $format_ids26[0].'D'. $row[("entry_form")];
							if($format_ids26[0]==67 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==746 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report7','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==183 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==177 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report9','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==209 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==85 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report8','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==235 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==174 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report7','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==274 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report10','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							else if( $row["entry_form"]==272 && $variable==$row[("booking_no_prefix_num")] )
							{
								if($format_ids26[0]==67 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==183 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==177 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==209 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print_t','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==85 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report8','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==235 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==174 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report7','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==274 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report10','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
							}
							//else $variable=$row[("booking_no")];
						}
						else if($cbo_category==25)
						{
							
							if($row[("entry_form")]==201)
							{
							$variable="<a href='##' title='Print Actual' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."','".$row[("supplier_id")]."')\" >".$row[("booking_no_prefix_num")]." </a>"; //actual print
							}
							else
							{
								$variable="<a href='##' title='Print Actual' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."','".$row[("supplier_id")]."')\" >".$row[("booking_no_prefix_num")]." </a>";
							}
						}
						else if($cbo_category==12) //Service Fab. Booking...
						{
							
							$format_ids_aop=explode(",",$print_report_format_aop);
							$first_print_button_aop=array_shift($format_ids_aop);
							//echo $wo_typw_id.'=='.$row[("entry_form")].',';
							if($first_print_button==11)
							{ 
							 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==12)
							{ 
							 $variable="<a href='##' title='PB1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==59)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button_aop==164)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button_aop==163)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($row[("entry_form")]==228) //Multi Job Wise service Booking Knitting
							{
								if($knit_first_print_button==13)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==15)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==16)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report3','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==177)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report4','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==175)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report5','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==176)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report6','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button=='')
								{ 
								 $variable=$row[("booking_no_prefix_num")];
								}								
							}
							
						}
						if($row[("entry_form")]==178){
							$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
						}elseif($row["entry_form"]==262){
							$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
						}


						//$conversion_cost_head_array
						$process_id_all=array_unique(explode(",",chop($row[("process")],",")));
						$all_process="";
						foreach($process_id_all as $process_id)
						{
							$all_process.=$conversion_cost_head_array[$process_id].",";
						}
						$all_process=chop($all_process,",");
						
						$supplier_name="";
						if($row[("pay_mode")]==3 || $row[("pay_mode")]==5)
						{
							$supplier_name=$company_library[$row[("supplier_id")]];
						}
						else $supplier_name=$supplierArr[$row[("supplier_id")]];
						//echo $row[("currency_id")];.// $row[("booking_date")]
						if($row[("booking_type")]==2  && $row[("entry_form")]==43 )  $row[("delivery_date")]=$row[("delivery_date_dtls")];else  $row[("delivery_date")]=$row[("delivery_date_dtls")];
						
						$piWoNo="";
						?>
						<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
							<td width="30"><? echo $i;?></td>
							<td width="100" align="center"><p><? echo $company_library[$cbo_company]; ?></td>
							<td width="60" align="center" title="<?=$row['entry_form']?>"><? echo $variable; ?><? //echo $row[("booking_no_prefix_num")];?></td>
                            <td width="70" align="center"><p><? echo $pay_mode[$row[("pay_mode")]]; ?></td>						
                            <?
							if($cbo_category==12)
							{?>
								<td width="100" align="center" title="<? echo 'Pi='.$pi_id.', Booking-'.$row[("booking_no")]; ?>"><p><? echo $pi_no_arr[$row[("booking_no")]]['pi_no']; ?></td>
                                <td width="100"><p><? echo $all_process; ?>&nbsp;</p></td>
                                <?
							}
							else if($cbo_category==4)
							{
								$piWoNo=implode(",",array_unique(array_filter(explode("__",$wopi_arr[$row["booking_no"]]))));
								//$piWoIdNo=implode(",",array_unique(array_filter(explode("__",$wopiId_arr[$row["booking_no"]]))));
								?>
                                <td width="100" style="word-break:break-all" align="center"><? echo $piWoNo; ?>&nbsp; </td>
                                <td width="100" style="word-break:break-all" align="center"><? echo $btb_pi[$piWoNo]['lc_number'] ?>&nbsp; </td>
                                <td width="100" style="word-break:break-all" align="center"><? echo $lc_type[$btb_pi[$piWoNo]['lc_type_id']]; ?>&nbsp; </td>
                                <td width="100" style="word-break:break-all" align="center"><? echo $pay_term[$btb_pi[$piWoNo]['payterm_id']]; ?>&nbsp; </td>
                                <td width="100" style="word-break:break-all" align="center"><? echo $btb_pi[$piWoNo]['tenor']; ?>&nbsp; </td>
                                <?
							}else if($cbo_category==25)
							{
								?>
                                <td width="100" style="word-break:break-all"><? echo $pi_no_arr[$row[("booking_no")]]['pi_no']; ?>&nbsp;</td>
                                <?
							}
							?>
							<td width="60" align="center"><p><? echo $row[("year_book")]; ?>&nbsp;</p></td>
                            <td width="70" align="center"><? echo change_date_format($row[("booking_date")]);?></td>	
							<td width="70" align="center"><p><? echo change_date_format($row[("update_date")]); ?>&nbsp;</p></td>
							<td width="70" align="center"><p><? echo change_date_format($row[("delivery_date")]); ?>&nbsp;</p></td>
							<td width="70" align="center"><p>
							<?
							$lead_time=0;
							if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00")
							{
								$lead_time=datediff("d", $row[("booking_date")], $row[("delivery_date")]);
							}
							if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day";
							?>&nbsp;</p></td>
							<td width="100"><p><? echo $wo_type;?>&nbsp;</p></td>
							<td width="100" title="MSg=<? echo $row[("ready_to_approved")];?>" align="center"><? echo $yes_no[$row[("ready_to_approved")]]; ?></td>
                              <?
							//if ($cbo_category==4)
							//{
								?>
                             <td width="100" align="center"><? $last_update_date=explode(" ",$last_update_date);echo change_date_format($last_update_date[0]).'<br>'.$last_update_date[1]; ?></td>
                             <?
							//}
							 ?>
							<td width="80"><p><? echo $approval_type_arr[$row[("is_approved")]]; ?>&nbsp;</p></td>
                             <?
							//if ($cbo_category==4)
							//{
								$approved_date=$last_app_arr[$row[("booking_id")]]['approved_date'];
								$approved_by=$last_app_arr[$row[("booking_id")]]['approved_by'];
								?>
                             <td width="100" title="bookingId=<? echo $row[("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                              <?
							//}
							 ?>
							<td width="100"><p><? echo $supplier_name; ?>&nbsp;</p></td>
							<td width="100"><p><? echo $buyerArr[$row[("buyer_id")]]; ?>&nbsp;</p></td>
							<td width="70"><p><? echo $job_no;//$row[("job_no_prefix_num")]; ?>&nbsp;</p></td>
                            <td width="70"><p><? echo $season_buyer;//$row[("job_no_prefix_num")]; ?>&nbsp;</p></td>
							<td width="60"><? echo $job_year;// $year; ?></td>
							<td width="100"><p><? if ($row[("type")]==0) echo $style_ref_no; else echo $nonStyleArr[$style_ref_no]; ?>&nbsp;</p></td>
							<td width="100"><p><? echo $ref; ?>&nbsp;</p></td>
							<td width="100"><p><? echo $file; ?>&nbsp;</p></td>
							<td width="100"><p><? echo $po_number; ?>&nbsp;</p></td>
							<td width="100"><p>
							<?
							if ($row[("type")]==0)
							{
								echo "Max - ". $max_ship_date;
								$order_count=explode(",",$po_number);
								if(count($order_count)>1) echo "<br> Min  - " . $min_ship_date; 
							}
							?>&nbsp;</p></td>
							<td width="80"><p><? echo $item_category[$row[("item_category")]]; ?>&nbsp;</p></td>
							<? 
							//booking_id
							$td_color="";
							
							if(strtotime($first_rec_date[$row[("booking_id")]])>strtotime($row[("delivery_date")])) $td_color='bgcolor="#FF0000"'; else $td_color='';
							$first_rcv_date=change_date_format($first_rec_date[$row[("booking_id")]]);
							
							 //echo $row[("booking_type")]."***".$row[("type")] ;
							?>
							<td width="70" title="<? echo "Booking No : ".$booking_data[$row[("booking_id")]]["booking_no"]."\nFirst Receive No:".$first_rec_no[$row[("booking_id")]]; ?>" align="center" <? echo $td_color; ?> ><p><? echo $first_rcv_date;  ?></p></td>
							<?
								if ($cbo_category==4)
								{
									$usd_id=2;
									if($db_type==0) $conversion_date=change_date_format($row[("booking_date")], "Y-m-d", "-",1);
									else $conversion_date=change_date_format($row[("booking_date")], "d-M-y", "-",1);
									$currency_rate=set_conversion_rate($usd_id,$conversion_date );
									if($row[("currency_id")]==2) $wo_currency_usd_amt=$row[("amount")];//USD
									else $wo_currency_usd_amt=$row[("amount")]/$currency_rate;
									$rec_amt=0;
									$rec_amt=$rec_amt_arr[$row["booking_id"]];
									$rec_currency=$rec_currency_arr[$row["booking_id"]];
									//echo $rec_currency.'GG';
									$rec_date=$first_rec_date[$row["booking_id"]];
									if($rec_currency==2) $recv_usd_amt=$rec_amt;//USD
									else $recv_usd_amt=$rec_amt/$currency_rate;
									?>
										<td width="100" align="right"><? echo number_format($row[("amount")],2); ?></td>
                                        <td width="100" align="right" title="Exchange Rate=<? echo $currency_rate;?>"><? echo number_format($wo_currency_usd_amt,2); ?></td>
                                        <td width="100" align="right"><? echo number_format($rec_amt,2); ?></td>
                                        <td width="100" align="right"><? echo number_format($recv_usd_amt,2); ?></td>
									<?
								}
								else
								{
									$currency_id=$row[("currency_id")];
								//echo $currency_id.'dddd,';
									if($cbo_category==25 && $currency_id==1)
									{	
									$cid=2;
									$ex_rate=set_conversion_rate($cid, $row[("booking_date")],$cbo_company);
									$wo_amount=$row[("amount")]/$ex_rate;
									//echo $exchnage_rate.'CCCC';
									} else $wo_amount=$row[("amount")];
									?>
										<td width="100" align="right"><? if ($cbo_category==25 || $cbo_category==12 ) echo number_format($row[("wo_qnty")],2); else echo number_format($row[("fin_fab_qnty")],2); ?></td>
                                        <?
                                        if($cbo_category==25)
										{
										?>
										<td width="100" align="right" title="<? echo $ex_rate;?>"><?  echo number_format($wo_amount,2); ?></td>
									<?
										}
										else
										{ ?>
											<td width="100" align="right"><? if ($cbo_category==25 || $cbo_category==12) echo number_format($row[("wo_qnty")],2); else echo number_format($row[("grey_fab_qnty")],2); ?></td>
									<?	}
								}
								if ($cbo_category==2)
								{
									?>
									<td width="80" align="right"><p><?=number_format($sample_qnt,2)?></p></td>
									<td width="80"><p>&nbsp; </p></td>
									<td width="80"><p><? echo $short_reason; ?></p></td>
									<?
								}
							?>
							<td width="">&nbsp;&nbsp;&nbsp;&nbsp;<? //echo $row[("po_number")]; ?></td>
						</tr>
						<?
						$tot_wo_qnty+=$row[("amount")];
						$tot_rec_amt+=$rec_amt;
						
						$tot_wo_currency_usd_amt+=$wo_currency_usd_amt;
						$tot_recv_usd_amt+=$recv_usd_amt;
						
						if ($cbo_category==25 || $cbo_category==12)//Embllishment
						{
							$tot_fin_fab_qnty+=$row[("wo_qnty")];
							$tot_grey_fab_qnty+=$row[("wo_qnty")];
							$tot_embl_wo_amount+=$wo_amount;
						}
						else
						{
							$tot_fin_fab_qnty+=$row[("fin_fab_qnty")];
							$tot_grey_fab_qnty+=$row[("grey_fab_qnty")];
							$tot_embl_wo_amount+=$wo_amount;
						}
						$i++;
					}
				}
				?>
				</table>
				<table class="rpt_table" width="<? echo $tbl_width; ?>" cellpadding="0" cellspacing="0" border="1" rules="all">
					<tfoot>
						<th width="30">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="60">&nbsp;</th>
                        <th width="70">&nbsp;</th>
                        <?
                        if ($cbo_category==3)
						{
							?>
                            <th width="100">&nbsp;</th>
                            <?
						}
						if ($cbo_category==12)
						{
							?>
							 <th width="100">&nbsp;</th>
                            <th width="100">&nbsp;</th>
                            <?
						}
						else if ($cbo_category==4)
						{
							?>
                            <th width="100">&nbsp;</th>
                            <th width="100">&nbsp;</th>
                            <th width="100">&nbsp;</th>
                            <th width="100">&nbsp;</th>
                            <th width="100">&nbsp;</th>
                            <?
						}
						?>
						<th width="60">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="70">&nbsp;</th>
                        <th width="70">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
                        <?
                       // if ($cbo_category==4)
						//{
							?>
						<th width="100">&nbsp;</th>
                        <?
						//}?>
						<th width="80">&nbsp;</th>
                         <?
                       // if ($cbo_category==4)
						//{
							?>
                        <th width="100">&nbsp;</th>
                         <?
						//}?>
                        
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="70"></th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="100">Total</th>
						<th width="80">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<?
							if ($cbo_category==4)
							{
								?>
									<th width="100" align="right" id=""><? //echo number_format($tot_wo_qnty,2); ?></th>
                                    <th width="100" align="right" id=""><? echo number_format($tot_wo_currency_usd_amt,2); ?></th>
                                    <th width="100" align="right" id=""><? //echo number_format($tot_wo_qnty,2); ?></th>
                                    <th width="100" align="right" id=""><? echo number_format($tot_recv_usd_amt,2); ?></th>
								<?
							}
							else
							{							
								?>

									<th width="100" align="right"  id="value_grnad_total_wo_qty"><? echo number_format($tot_fin_qty_with_pl,2); ?></th>
								 	<?
									  if ($cbo_category==2)//
									  {
									  ?>
									  <th width="100"  align="right" >&nbsp;</th>
									  <?
									  }
                                    if ($cbo_category==25)//Emblishment 
									{
									?>
									<th width="100" id="value_grnad_total_wo_val" align="right" ><? echo number_format($tot_embl_wo_amount,2); ?></th>
									<?
									}
									else
									{ ?>
										<th width="100" align="right" id="value_grnad_total_wo_val"><? echo number_format($tot_grey_fab_qnty,2); ?></th>
									<? }
									 if ($cbo_category==2)//Emblishment 
									 {
									 ?>
									 <th width="100"  align="right" ><? echo number_format($tot_fso_qty,2); ?></th>
									 <?
									 }

							}
						if($cbo_category==2)//Knit Fab
						{
							?>    
							<th width="80" > <?=number_format($tot_sample,2);?></th>
							<th width="80">&nbsp;</th>
							<th width="80">&nbsp;</th>
							<?
						}
						?>
						<th width="">&nbsp;&nbsp;&nbsp;&nbsp;</th>
					</tfoot>
				</table>
			</div>
            <br>
            <?
			
			if ($cbo_category==2)
			{
				?>
                <table class="rpt_table" width="600" cellpadding="0" cellspacing="0" border="1" rules="all">
                	<thead>
                    	<tr bgcolor="#CCCCCC">
                                <td colspan="6" align="center" style="font-size:16px; font-weight:bold;">Finish Fabric OTD Summary</td>
                            </tr>
                    	<tr>
                        	<th width="100">WO Type</th>
                            <th width="100">Required Qty.</th>
                            <th width="100">On Time Rcvd Qty</th>
                            <th width="100">Total Rcvd Qty</th>
                            <th width="100">Balance</th>
                            <th >OTD %</th>
                        </tr>
                    </thead>
                    <tbody>
                    	<?
						$wo_type_arr=array(1=>"Main",2=>"Short",3=>"Sample",4=>"Non Ord Sample");
						foreach($summer_data as $wo_type=>$val)
						{
							$balance=$val["book_qnty"]-$val["rcv_qnty"];
							$otd_percent=(($val["rcv_qnty_intime"]/$val["book_qnty"])*100);
							?>
                            <tr>
                                <td><? echo $wo_type_arr[$wo_type]; ?></td>
                                <td align="right"><? echo number_format($val["book_qnty"],2); $tot_book_qnty+=$val["book_qnty"]; ?></td>
                                <td align="right"><? echo number_format($val["rcv_qnty_intime"],2); $tot_rcv_qnty_intime+=$val["rcv_qnty_intime"];  ?></td>
                                <td align="right"><? echo number_format($val["rcv_qnty"],2); $tot_rcv_qnty+=$val["rcv_qnty"];  ?></td>
                                <td align="right"><? echo number_format($balance,2); $tot_balance+=$balance;  ?></td>
                                <td align="right"><? echo number_format($otd_percent,2); ?></td>
                            </tr>
                            <?
						}
						?>
                    </tbody>
                    <tfoot>
                    	<tr>
                        	<th>Total</th>
                            <th><? echo number_format($tot_book_qnty,2); ?></th>
                            <th><? echo number_format($tot_rcv_qnty_intime,2); ?></th>
                            <th><? echo number_format($tot_rcv_qnty,2); ?></th>
                            <th><? echo number_format($tot_balance,2); ?></th>
                            <th>&nbsp;</th>
                        </tr>
                    </tfoot>
                </table>
                <?
			}
			?>
		</fieldset>
		<?
	}
	else if ($cbo_category==24)// Service Yarn
	{
		if($db_type==0)
		{
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and YEAR(a.insert_date)=$year_id";
		}
		elseif($db_type==2)
		{ 
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(a.insert_date,'YYYY')=$year_id";
		}
		
		if ($cbo_company==0) $company_id=""; else $company_id=" and a.company_id=$cbo_company";
		if ($cbo_buyer==0) $supplier_cond=""; else $supplier_cond=" and a.supplier_id=$cbo_buyer";
		if ($cbo_category==0) $category_id=""; else $category_id=" and a.item_category=$cbo_category";
		if ($wo_no=="") $wo_no_cond=""; else $wo_no_cond=" and a.ydw_no='$wo_no'";
		
		if ($wo_type==2) $wo_type_cond=" and a.entry_form=41"; else if ($wo_type==4) $wo_type_cond=" and a.entry_form=42"; else $wo_type_cond="";
		
		if ($job_no=="") $job_num=""; else $job_num=" and b.job_no='$job_no'";
		//if ($job_no=="") $job_num_mst=""; else $job_num_mst=" and b.job_no_mst=$job_no";
		if ($po_no=='') $po_no_no=""; else $po_no_no=" and d.po_number in ($po_no)";
		if ($hidd_po=="") $po_id=""; else $po_id=" and d.id in ( $hidd_po )";
		
		if ($hidd_po=="") $po_id_cond=""; else $po_id_cond=" and b.po_break_down_id in ( $hidd_po )";
		
		if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and d.file_no='".trim($file_no)."' "; 
		if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and d.grouping='".trim($internal_ref)."' "; 
		//echo $file_no_cond.'=='.$internal_ref_cond;die;
		
		if($db_type==0)
		{
			if($txt_date_category==1) 
			{	
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".$date_from."' and '".$date_to."'";
			}
			else 
			{
				if($txt_date_category==2) if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".$date_from."' and '".$date_to."'";
			}
		}
		if($db_type==2)
		{
			if($txt_date_category==1) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
			else if($txt_date_category==2) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
		}
	
		
		
		ob_start();
		?>
		<fieldset style="width:2310px">
			<table width="2290"  cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none; font-size:18px;" colspan="21">
						<? echo $company_library[str_replace("'","",$cbo_company_id)]; ?>                                
					</td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:16px; font-weight:bold" colspan="21"> <? echo $report_title; if($cbo_category!=0) echo " For ".$item_category[$cbo_category]; ?></td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:12px; font-weight:bold"  colspan="21"> <? if( $date_from!="" && $date_to!="" ) echo "From ".change_date_format($date_from)." To ".change_date_format($date_to);?></td>
				</tr>
			</table>
            <table class="rpt_table" width="2290" cellpadding="0" cellspacing="0" border="1" rules="all">
				<thead>
					<th width="30">SL</th>    
					<th width="100">Comapny</th>
					<th width="60">Wo No</th>
					<th width="60">PI No</th>
					<th width="60">Wo Year</th>
					<th width="70">Wo Date</th>
					<th width="70">Deli. Date</th>
                    <th width="70">Lead Time</th>
					<th width="100">Wo Type</th>
					<th width="100">Ready To App.</th>
                    <th width="100">Ready To Approved<br> date and time</th>                    
					<th width="80">App. Status</th>
                    <th width="100">Last Approval <br>Date time and Person</th>
					<th width="100">Supplier</th>
					<th width="100">Buyer</th>
					<th width="110">Job No.</th>
					<th width="60">Job Year</th>
					<th width="100">Style Ref.</th>
					<th width="100">Inter. Ref.</th>
					<th width="100">File No.</th>
					<th width="100">Order No</th>
                    <th width="100">Shipment Date</th>
					<th width="80">Item Cate.</th>
					<th width="70">First Rec. Date</th>
                    <th width="100">Wo Qty</th>
                    <th width="100">W/O Value USD</th>
					<th >Remarks</th>
				</thead>
			</table>
			<div style="max-height:350px; overflow-y:scroll; width:2310px" id="scroll_body" >
				<table cellspacing="0" cellpadding="0" border="1" class="rpt_table"  width="2290" rules="all" id="table_body" >
				<?
				if ($cbo_company==0) $company_cond_id=""; else $company_cond_id=" and b.company_id=$cbo_company";
				if($cbo_category==24)
				{
					$sql="select a.id, a.ydw_no, min(b.receive_date) as receive_date from wo_yarn_dyeing_mst a,inv_receive_master b where a.ydw_no=b.booking_no and b.item_category=1  and b.receive_basis=2 and b.receive_purpose=2 $company_cond_id group by a.id, a.ydw_no";	
					$sql_result=sql_select($sql);
					foreach($sql_result as $row)
					{
						$first_rec_date[$row[csf("id")]]=$row[csf("receive_date")];
					}
				}
				if($db_type==0)
				{	
					$sql="Select a.company_id,a.id as booking_id,a.is_approved,a.ready_to_approved,a.update_date, a.entry_form, a.ydw_no,a.pay_mode, Year(a.insert_date) as year_book, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.supplier_id, b.job_no, b.uom, sum(b.yarn_wo_qty) as wo_qnty,sum(b.amount) as amount, a.currency,b.fab_booking_no from wo_yarn_dyeing_mst a, wo_yarn_dyeing_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $supplier_cond and a.item_category_id=24 $job_num $booking_date_cond $wo_no_cond $wo_type_cond group by a.company_id,a.id,a.update_date, a.entry_form, a.ydw_no, a.insert_date, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.is_approved,a.supplier_id, b.job_no, b.uom order,a.ready_to_approved,b.fab_booking_no , a.currency by a.id Desc";
				}
				else if ($db_type==2)
				{
					$sql="Select a.company_id,a.id as booking_id,a.is_approved,a.ready_to_approved,a.update_date, a.entry_form, a.ydw_no,a.pay_mode, TO_CHAR(a.insert_date,'YYYY') as year_book, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.supplier_id, b.job_no_id,b.job_no, b.uom, sum(b.yarn_wo_qty) as wo_qnty,sum(b.amount) as amount, a.currency,b.fab_booking_no from wo_yarn_dyeing_mst a, wo_yarn_dyeing_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $supplier_cond and a.item_category_id=24 $job_num $booking_date_cond $wo_no_cond $wo_type_cond group by a.company_id,a.id,a.update_date,a.entry_form, a.ydw_no,a.pay_mode, a.insert_date, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.is_approved,a.supplier_id, b.job_no,b.job_no_id, b.uom, a.ready_to_approved,a.currency,b.fab_booking_no order by a.id Desc";
				}
				//echo $sql; //die;
				//echo  $po_id ;die;
				$tot_wo_amount=0;
				$sql_result=sql_select($sql); $i=1;
				foreach ($sql_result as $row) 
				{
					$booking_id_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
					$job_id_arr[$row[csf("job_no_id")]]=$row[csf("job_no_id")];
				}
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 1, $booking_id_arr, $empty_arr);//Book ID Ref from=1
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 2, $job_id_arr, $empty_arr);//PO ID Ref from=2

		$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id and b.work_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1  and g.entry_form=37 and a.status_active=1 and a.is_deleted=0
		and a.item_category_id=24 and a.pi_basis_id=1 ";
		$pi_sql_result=sql_select($pi_sql);
		$pi_no_arr = array();
		foreach ($pi_sql_result as $value) 
		{
			$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
			$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];
		}
		unset($pi_sql_result);
		$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
		$supplierArr=return_library_array( "select id,supplier_name from lib_supplier", "id", "supplier_name");	
		$buyerArr=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
		//$nonStyleArr=return_library_array( "select id, style_ref_no from sample_development_mst", "id", "style_ref_no");		
		
		// $sql="select a.job_no,d.id as po_id from wo_po_details_master a, wo_po_break_down d where a.job_no=d.job_no_mst and a.status_active=1 and a.is_deleted=0 and d.status_active=1 and d.is_deleted=0 $internal_ref_cond  $file_no_cond  group by a.job_no,d.id";
		// $sql_result=sql_select($sql);
		// $po_id_data="";$k=0;
		// foreach($sql_result as $row)
		// {
		// 	if($k==0)
		// 	{
		// 		$po_data_cond=$row[csf('po_id')];
		// 		 $job_data_cond=$row[csf('job_no')];
		// 	}
		// 	else
		// 	{
		// 		 $po_data_cond.=",".$row[csf('po_id')];
		// 		 $job_data_cond.=",".$row[csf('job_no')];
		// 	} 
		// } //echo $job_data_cond;
		// if($file_no_cond!="" || $internal_ref!="")
		// {  
		//  $po_data_file_ref=" and b.po_break_down_id in($po_data_cond) "; 
		//  $job_data_file_ref=" and b.job_no in('$job_data_cond') "; 
		// }
		// else
		// {
		// 	$po_data_file_ref="";
		// 	$job_data_file_ref="";
		// }
		
			if($db_type==0)
			{
				$job_sql="select a.job_no_prefix_num, a.job_no, a.buyer_name, Year(a.insert_date) as year, a.style_ref_no, a.garments_nature, 
				group_concat(b.id) as id,
				group_concat(b.po_number) as po_number,
				group_concat(b.file_no) as file_no,
				group_concat(b.grouping) as grouping,
				max(b.pub_shipment_date) as max_ship_date,
				min(b.pub_shipment_date) as min_ship_date
				from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.job_no_prefix_num, a.job_no, a.buyer_name, a.insert_date, a.style_ref_no, a.garments_nature";
			}
			elseif($db_type==2)
			{
				$job_sql="select a.job_no_prefix_num, a.job_no, a.buyer_name, TO_CHAR(a.insert_date,'YYYY') as year, a.style_ref_no, a.garments_nature, 
				b.id as id,
					b.po_number as po_number,
					b.file_no as file_no,
					b.grouping as grouping,
					(b.pub_shipment_date) as max_ship_date,
					(b.pub_shipment_date) as min_ship_date
				from wo_po_details_master a, wo_po_break_down b, gbl_temp_engine g where a.job_id=b.job_id and b.job_id=g.ref_val  and a.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2  and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.job_no_prefix_num, a.job_no, a.buyer_name, a.insert_date, a.style_ref_no, a.garments_nature";
			}
			
			$job_sql_result=sql_select($job_sql);
			foreach($job_sql_result as $row)
			{
				$order_no=$row[csf("po_number")];//implode(",",array_unique(explode(",",$row[csf("po_number")])));
					$order_id=$row[csf("id")];//implode(",",array_unique(explode(",",$row[csf("id")])));
					$file_no=$row[csf("file_no")];//implode(",",array_unique(explode(",",$row[csf("file_no")])));
					$int_ref=$row[csf("grouping")];//implode(",",array_unique(explode(",",$row[csf("grouping")])));
		
				$job_array[$row[csf("job_no")]]['job']=$row[csf("job_no_prefix_num")];
				$job_array[$row[csf("job_no")]]['job_no']=$row[csf("job_no")];
				$job_array[$row[csf("job_no")]]['buyer']=$row[csf("buyer_name")];
				$job_array[$row[csf("job_no")]]['year']=$row[csf("year")];
				$job_array[$row[csf("job_no")]]['style_ref_no']=$row[csf("style_ref_no")];
				$job_array[$row[csf("job_no")]]['garments_nature']=$row[csf("garments_nature")];
				$job_array[$row[csf("job_no")]]['max_ship_date'].=$row[csf("max_ship_date")].',';
				$job_array[$row[csf("job_no")]]['min_ship_date'].=$row[csf("min_ship_date")].',';
				$job_array[$row[csf("job_no")]]['id'].=$order_id.',';
				$job_array[$row[csf("job_no")]]['po_number'].=$order_no.',';
				$job_array[$row[csf("job_no")]]['file'].=$file_no.',';
				$job_array[$row[csf("job_no")]]['ref'].=$int_ref.',';
			}
			
			$emb_item_array=array();
			
			$emb_sql="select a.emb_name, b.item_number_id, b.job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b,gbl_temp_engine g  where a.job_id=b.job_id  and a.job_id=g.ref_val   and b.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2  and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  ";
			$emb_sql_result=sql_select($emb_sql);
			foreach($emb_sql_result as $row)
			{
				$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
				$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
			}
			//var_dump($job_array);

				
				 $wo_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_yarn_dyeing_mst a, approval_history b,gbl_temp_engine g where a.id=b.mst_id and a.id=g.ref_val      and g.user_id = ".$user_id." and g.ref_from1  and g.entry_form=37 and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(30) ".where_con_using_array($booking_id_arr,0,'a.id')." order by b.id desc";
				$wo_his_sql_result=sql_select($wo_his_sql);
				//$pi_no_arr = array();
				$user_arr=return_library_array( "select id, user_name from user_passwd", 'id', 'user_name' );	
				foreach ($wo_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_his_sql_result);
				
				/*$wo_non_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_non_ord_samp_booking_mst a, approval_history b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(8,7,32) ".where_con_using_array($booking_id_arr,0,'a.id')." order by b.id desc";
				$wo_non_his_sql_result=sql_select($wo_non_his_sql);
				//$pi_no_arr = array();
			 
				foreach ($wo_non_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_non_his_sql_result);*/

				$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id b.work_order_id=g.ref_val    and g.user_id = ".$user_id." and g.ref_from1  and g.entry_form=37 and a.status_active=1 and a.is_deleted=0
				and a.item_category_id=24 and a.pi_basis_id=1";
				$pi_sql_result=sql_select($pi_sql);
				$pi_no_arr = array();
				foreach ($pi_sql_result as $value) 
				{
					$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
					$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];
				}
				unset($pi_sql_result);
				
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				
				foreach($sql_result as $row)
				{
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					if ($row[csf("entry_form")]==41) $wo_type="Order";
					else if ($row[csf("entry_form")]==42) $wo_type="Non Order";
					$job_number=implode(",",array_unique(explode(",",$row[csf("job_no")])));
					$supplier_name="";
					if($row[csf("pay_mode")]==3 || $row[csf("pay_mode")]==5)
					{
						$supplier_name=$company_library[$row[csf("supplier_id")]];
					}
					else $supplier_name=$supplierArr[$row[csf("supplier_id")]];

					$cid=2;
					if($row[csf('currency')]==2)
					{
						$cid=1;
					}
					if($row[csf('ready_to_approved')]==1) //ready
					{
						$last_update_date=$row[csf('update_date')];
					}
					$print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=28 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
					
					$ex_rate=set_conversion_rate($cid, $row[csf("booking_date")],$cbo_company);
					$wo_amount=$row[csf("amount")]/$ex_rate;
					// $variable='';
					// if($row[("entry_form")]==125){
					// 	$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print2','".$i."')\"> ".$row[("yarn_dyeing_prefix_num")]." </a>";
					// }elseif($row["entry_form"]==94){
					// 	$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("yarn_dyeing_prefix_num")]." </a>";
					// }
						
					?>
					<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
						<td width="30"><? echo $i;?></td>
						<td width="100" align="center"><p><? echo $company_library[$row[csf("company_id")]]; ?></td>
						<!-- <td width="60" align="center" title="<?=$row['entry_form']?>"><? echo $variable; ?><? //echo $row[("booking_no_prefix_num")];?></td> -->
						<td width="60" align="center"><? echo $row[csf("yarn_dyeing_prefix_num")]; ?></td>	<a href='#report_details' onClick="generate_fabric_report('<? echo $row[csf("entry_form")]; ?>','<? echo $row[csf("ydw_no")]; ?>','<? echo $cbo_company; ?>','<? echo $row[csf("job_no")]; ?>','<? //echo "24"; ?>','<? //echo $cbo_category; ?>');"></a>
						<td width="60" align="center"><p><? echo $pi_no_arr[$row[csf("ydw_no")]]['pi_no']; ?></td>
						<td width="60" align="center"><p><? echo $row[csf("year_book")]; ?></td>
						<td width="70"><p style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("booking_date")], "", "",0); ?></p></td>
						<td width="70"><p style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("delivery_date")]); ?></p></td>
                        
                        <td width="70"><p style="word-wrap:break-word; width:70px">
						<? 
						$lead_time=0;
						if($row[csf("delivery_date")]!="" && $row[csf("delivery_date")]!="0000-00-00")
						{
							$lead_time=datediff("d", $row[csf("booking_date")], $row[csf("delivery_date")]);
						}
						if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day"; 
						?></p></td>
                        
						<td width="100"><p><? echo $wo_type;?></p></td>
						<td width="100" align="center"><? echo $yes_no[$row[csf("ready_to_approved")]]; ?></td>
                         <td width="100" align="center"><? $last_update_dateArr=explode(" ",$last_update_date);echo change_date_format($last_update_dateArr[0]).'<br>'.$last_update_dateArr[1]; ?></td>
						<td width="80"><p><? echo $approval_type_arr[$row[csf("is_approved")]]; ?></p></td>
                         <?
							//if ($cbo_category==4)
							//{
								$approved_date=$last_app_arr[$row[csf("booking_id")]]['approved_date'];
								$approved_by=$last_app_arr[$row[csf("booking_id")]]['approved_by'];
								?>
                         <td width="100" title="bookingId=<? echo $row[csf("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                             
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $supplier_name; ?></p></td>
						<td width="100"><p><? echo $buyerArr[$job_array[$job_number]['buyer']]; ?></p></td>
						<td width="110"><p style="word-wrap:break-word; width:110px"><? echo $row[csf("job_no")];//$row[csf("job_no_prefix_num")]; ?></p></td>
						<td width="60"><? echo $job_array[$job_number]['year']; ?></td>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $job_array[$job_number]['style_ref_no']; ?></p></td>
						<?
						$ref_all=rtrim($job_array[$job_number]['ref'],',');
						$ref_all=implode(", ",array_unique(explode(",",$ref_all)));
						$file_all=rtrim($job_array[$job_number]['file'],',');
						$file_all=implode(", ",array_unique(explode(",",$file_all)));
						$po_alls=rtrim($job_array[$job_number]['po_number'],',');
						$po_all=implode(", ",array_unique(explode(",",$po_alls)));
						?>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $ref_all; ?></p></td>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $file_all; ?></p></td>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $po_all; ?></p></td>
                        <td width="100"><p style="word-wrap:break-word; width:100px">
						<? 
						$max_shipdate=rtrim($job_array[$job_number]['max_ship_date'],',');
						$max_ship_dateArr=explode(",",$max_shipdate);
						$max_ship_date=max($max_ship_dateArr);
						$min_shipdate=rtrim($job_array[$job_number]['min_ship_date'],',');
						$min_shipdateArr=explode(",",$min_shipdate);
						$min_shipdate=min($min_shipdateArr);

						if($max_ship_date!="" && $max_ship_date!="0000-00-00") echo "Max - ".change_date_format($max_ship_date);
						//if($job_array[$job_number]['max_ship_date']!=$job_array[$job_number]['min_ship_date']) echo "<br> " . change_date_format($job_array[$job_number]['min_ship_date']); 
						
						$order_count=explode(",",$po_all);
						if(count($order_count)>1) echo "<br> Min - " . change_date_format($min_shipdate);
						 
						?></p></td>
						<td width="80"><p style="word-wrap:break-word; width:80px"><? echo $item_category[24]; ?></p></td>
						<td width="70" align="center"><p><? echo change_date_format($first_rec_date[$row[csf("booking_id")]]); ?></p></td>
						<td width="100" align="right"><? echo number_format($row[csf("wo_qnty")],2); ?></td>
						<td width="100" align="right"><? echo number_format($wo_amount,2); ?></td>
						<td>&nbsp;</td>
					</tr>
					<?
					$tot_wo_qnty+=$row[csf("wo_qnty")];
					$tot_wo_amount+=$wo_amount;
					$i++;
				}
				?>
				</table>
				<table class="rpt_table" width="2290" cellpadding="0" cellspacing="0" border="1" rules="all">
					<tfoot>
						<th width="30">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="70">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="110">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="80">Total</th>
						<th width="70">&nbsp;</th>
                        <th width="100" align="right" id="tot_fin_fab_qnty"><? echo number_format($tot_wo_qnty,2); ?></th>
                        <th width="100" align="right" id="tot_wo_amount"><? echo number_format($tot_wo_amount,2); ?></th>
						<th>&nbsp;</th>
					</tfoot>
				</table>
			</div>
		</fieldset>
		<?
	}
	
	else if ($cbo_category==31)//31=Services Lab Test
	{
		if($db_type==0)
		{
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and YEAR(a.insert_date)=$year_id";
		}
		elseif($db_type==2)
		{ 
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(a.insert_date,'YYYY')=$year_id";
		}
		
		if ($cbo_company==0) $company_id=""; else $company_id=" and a.company_id=$cbo_company";
		if ($wo_no=="") $wo_no_cond=""; else $wo_no_cond=" and a.labtest_no like '%$wo_no'";
		if ($job_no=="") $job_num=""; else $job_num=" and b.job_no='$job_no'";
		if ($hidd_po=='') $po_no_no=""; else $po_no_no=" and c.order_id in ($hidd_po)";
		
		
		if ($cbo_buyer==0) $supplier_cond=""; else $supplier_cond=" and a.supplier_id=$cbo_buyer";
		if ($cbo_category==0) $category_id=""; else $category_id=" and a.item_category=$cbo_category";
		if ($wo_type==2) $wo_type_cond=" and a.entry_form=41"; else if ($wo_type==4) $wo_type_cond=" and a.entry_form=42"; else $wo_type_cond="";
		
		//if ($job_no=="") $job_num_mst=""; else $job_num_mst=" and b.job_no_mst=$job_no";
		if ($hidd_po=="") $po_id=""; else $po_id=" and d.id in ( $hidd_po )";
		
		if ($hidd_po=="") $po_id_cond=""; else $po_id_cond=" and b.po_break_down_id in ( $hidd_po )";
		
		if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and d.file_no='".trim($file_no)."' "; 
		if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and d.grouping='".trim($internal_ref)."' "; 
		//echo $file_no_cond.'=='.$internal_ref_cond;die;
		
		if($db_type==0)
		{
			if($txt_date_category==1) 
			{	
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.wo_date between '".$date_from."' and '".$date_to."'";
			}
			else 
			{
				if($txt_date_category==2) if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".$date_from."' and '".$date_to."'";
			}
		}
		if($db_type==2)
		{
			if($txt_date_category==1) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.wo_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
			else if($txt_date_category==2) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
		}
	
	
		$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
		$supplierArr=return_library_array( "select id,supplier_name from lib_supplier", "id", "supplier_name");	
		$buyerArr=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
		//$nonStyleArr=return_library_array( "select id, style_ref_no from sample_development_mst", "id", "style_ref_no");		
		
		// $sql="select a.job_no,d.id as po_id from wo_po_details_master a, wo_po_break_down d where a.id=d.job_id and a.status_active=1 and a.is_deleted=0 and d.status_active=1 and d.is_deleted=0 $internal_ref_cond  $file_no_cond  group by a.job_no,d.id";
		// $sql_result=sql_select($sql);
		// $po_id_data="";$k=0;
		// foreach($sql_result as $row)
		// {
		// 	if($k==0)
		// 	{
		// 		$po_data_cond=$row[csf('po_id')];
		// 		 $job_data_cond=$row[csf('job_no')];
		// 	}
		// 	else
		// 	{
		// 		 $po_data_cond.=",".$row[csf('po_id')];
		// 		 $job_data_cond.=",".$row[csf('job_no')];
		// 	} 
		// } //echo $job_data_cond;
		
		
		// if($file_no_cond!="" || $internal_ref!="")
		// {  
		//  $po_data_file_ref=" and c.po_break_down_id in($po_data_cond) "; 
		//  $job_data_file_ref=" and b.job_no in('$job_data_cond') "; 
		// }
		// else
		// {
		// 	$po_data_file_ref="";
		// 	$job_data_file_ref="";
		// }
		
		
		
		
		//var_dump($job_array);
		
		ob_start();
		?>
		<fieldset style="width:2310px">
			<table width="2390"  cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none; font-size:18px;" colspan="21">
						<? echo $company_library[str_replace("'","",$cbo_company_id)]; ?>                                
					</td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:16px; font-weight:bold" colspan="21"> <? echo $report_title; if($cbo_category!=0) echo " For ".$item_category[$cbo_category]; ?></td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:12px; font-weight:bold"  colspan="21"> <? if( $date_from!="" && $date_to!="" ) echo "From ".change_date_format($date_from)." To ".change_date_format($date_to);?></td>
				</tr>
			</table>
            <table class="rpt_table" width="2390" cellpadding="0" cellspacing="0" border="1" rules="all">
				<thead>
					<th width="30">SL</th>    
					<th width="100">Company</th>
					<th width="60">Wo No</th>
					<th width="60">PI No</th>
					<th width="60">Wo Year</th>
					<th width="70">Wo Date</th>
					<th width="70">Deli. Date</th>
                    <th width="70">Lead Time</th>
					<th width="100">Wo Type</th>
					<th width="100">Ready To App.</th>
				    <th width="100">Ready To Approved<br> date and time</th>
					<th width="80">App. Status</th>
                    <th width="100">Last Approval <br>Date time and Person</th>
					<th width="100">Supplier</th>
					<th width="100">Buyer</th>
					<th width="110">Job No.</th>
					<th width="60">Job Year</th>
					<th width="100">Style Ref.</th>
					<th width="100">Inter. Ref.</th>
					<th width="100">File No.</th>
					<th width="100">Order No</th>
                    <th width="100">Shipment Date</th>
					<th width="80">Item Cate.</th>
					<th width="70">First Rec. Date</th>
                    <th width="100">WO value</th>
					<th>Remarks</th>
				</thead>
			</table>
			<div style="max-height:350px; overflow-y:scroll; width:2410px" id="scroll_body" >
				<table cellspacing="0" cellpadding="0" border="1" class="rpt_table"  width="2290" rules="all" id="table_body" >
				<?
				if ($cbo_company==0) $company_cond_id=""; else $company_cond_id=" and b.company_id=$cbo_company";
				
				if($db_type==0)
				{	
					$sql="Select a.company_id,a.currency,a.id as booking_id, a.entry_form,a.pay_mode, Year(a.insert_date) as year_book, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id,a.ready_to_approved, b.job_no, sum(b.wo_value) as wo_value from wo_labtest_mst a, wo_labtest_dtls b,wo_labtest_order_dtls c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $supplier_cond $job_num $booking_date_cond $wo_no_cond $wo_type_cond $po_no_no group by a.id,a.company_id, a.entry_form, a.insert_date,a.pay_mode, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id,a.ready_to_approved, b.job_no order by a.id Desc";
				}
				else if ($db_type==2)
				{
					$sql="Select a.company_id,max(a.currency) as currency, a.id as booking_id, a.entry_form,a.pay_mode, TO_CHAR(a.insert_date,'YYYY') as year_book, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id, a.ready_to_approved, b.job_no, sum(c.wo_value) as wo_value from wo_labtest_mst a, wo_labtest_dtls b,wo_labtest_order_dtls c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $job_num $booking_date_cond $wo_no_cond $wo_type_cond $po_no_no group by a.id,a.company_id, a.entry_form,a.pay_mode, a.insert_date, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id,a.ready_to_approved,  b.job_no order by a.id Desc";
				}
				  
				  
				  
				   //echo $sql; //die;
				//echo  $po_id ;die;
				$sql_result=sql_select($sql); $i=1;
				foreach ($sql_result as $row) 
				{
					$booking_id_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
				}
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 1, $booking_id_arr, $empty_arr);//Book ID Ref from=1
				
				//==========Temp============================
				if($cbo_category==24)
				{
					$sql_book="select a.id, a.ydw_no, min(b.receive_date) as receive_date from wo_yarn_dyeing_mst a,inv_receive_master b,gbl_temp_engine g where  a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.ydw_no=b.booking_no and b.item_category=1  and b.receive_basis=2 and b.receive_purpose=2 $company_cond_id group by a.id, a.ydw_no";	
					$sql_resultBook=sql_select($sql_book);
					foreach($sql_resultBook as $row)
					{
						$first_rec_date[$row[csf("id")]]=$row[csf("receive_date")];
					}
				}

				if($db_type==0)
				{
					$job_sql="select a.job_no_prefix_num, a.job_no, a.buyer_name, Year(a.insert_date) as year, a.style_ref_no, a.garments_nature, 
					group_concat(b.id) as id,
					group_concat(b.po_number) as po_number,
					group_concat(b.file_no) as file_no,
					group_concat(b.grouping) as grouping,
					max(b.pub_shipment_date) as max_ship_date,
					min(b.pub_shipment_date) as min_ship_date
					from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.job_no_prefix_num, a.job_no, a.buyer_name, a.insert_date, a.style_ref_no, a.garments_nature";
				}
				elseif($db_type==2)
				{
					$job_sql="select a.id as job_id,a.job_no_prefix_num, a.job_no, a.buyer_name, TO_CHAR(a.insert_date,'YYYY') as year, a.style_ref_no, a.garments_nature, 
					b.id as id,
					b.po_number as po_number,
					b.file_no as file_no,
					b.grouping as grouping,
					(b.pub_shipment_date) as max_ship_date,
					(b.pub_shipment_date) as min_ship_date
					from wo_po_details_master a, wo_po_break_down b,wo_labtest_dtls c,gbl_temp_engine g where a.id=b.job_id and a.job_no=c.job_no and c.mst_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 ";
				}
				$job_sql_result=sql_select($job_sql);
				foreach($job_sql_result as $row)
				{
					$order_no=$row[csf("po_number")];//implode(",",array_unique(explode(",",$row[csf("po_number")])));
					$order_id=$row[csf("id")];//implode(",",array_unique(explode(",",$row[csf("id")])));
					$file_no=$row[csf("file_no")];//implode(",",array_unique(explode(",",$row[csf("file_no")])));
					$int_ref=$row[csf("grouping")];//implode(",",array_unique(explode(",",$row[csf("grouping")])));
					
					$jobIdArr[$row[csf("job_id")]]=$row[csf("job_id")];
					$job_array[$row[csf("job_no")]]['job']=$row[csf("job_no_prefix_num")];
					$job_array[$row[csf("job_no")]]['job_no']=$row[csf("job_no")];
					$job_array[$row[csf("job_no")]]['buyer']=$row[csf("buyer_name")];
					$job_array[$row[csf("job_no")]]['year']=$row[csf("year")];
					$job_array[$row[csf("job_no")]]['style_ref_no']=$row[csf("style_ref_no")];
					$job_array[$row[csf("job_no")]]['garments_nature']=$row[csf("garments_nature")];
					$job_array[$row[csf("job_no")]]['max_ship_date'].=$row[csf("max_ship_date")].',';
					$job_array[$row[csf("job_no")]]['min_ship_date'].=$row[csf("min_ship_date")].',';
					$job_array[$row[csf("job_no")]]['id'].=$order_id.',';
					$job_array[$row[csf("job_no")]]['po_number'].=$order_no.',';
					$job_array[$row[csf("job_no")]]['file'].=$file_no.',';
					$job_array[$row[csf("job_no")]]['ref'].=$int_ref.',';
				}
				 fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 2, $jobIdArr, $empty_arr);//Job ID Ref from=2
				$emb_item_array=array();
				
				$emb_sql="select a.emb_name, b.item_number_id, b.job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b, gbl_temp_engine g where a.job_id=b.job_id and a.job_id=g.ref_val  and c.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and ";
				$emb_sql_result=sql_select($emb_sql);
				foreach($emb_sql_result as $row)
				{
					$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
					$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
				}
				$wo_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_labtest_mst a, approval_history b,gbl_temp_engine g where a.id=b.mst_id and a.id=g.ref_val  and c.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(42) ".where_con_using_array($booking_id_arr,0,'a.id')." order by b.id desc";
				$wo_his_sql_result=sql_select($wo_his_sql);
				//$pi_no_arr = array();
				$user_arr=return_library_array( "select id, user_name from user_passwd", 'id', 'user_name' );	
				foreach ($wo_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_his_sql_result);
				$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id and a.id=g.ref_val  and c.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0
				and a.item_category_id=31 and a.pi_basis_id=1 
				group by  a.id,a.pi_number, b.work_order_no order by a.pi_number desc";
				
				$pi_sql_result=sql_select($pi_sql);
				$pi_no_arr = array();
				foreach ($pi_sql_result as $value) 
				{
					$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
					$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];
				}
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				unset($pi_sql_result);
				foreach($sql_result as $row)
				{
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					if ($row[csf("entry_form")]==41 || $row[csf("entry_form")]==79) $wo_type="Order";
					else if ($row[csf("entry_form")]==42) $wo_type="Non Order";
					$job_number=implode(",",array_unique(explode(",",$row[csf("job_no")])));
					$cbo_company=$row[csf("company_id")];
					
					
						//function generate_fabric_report(type,booking_no,company_id,order_id,fabric_nature,fabric_source,job_no,approved,category,is_short,emb_name,item_number_id,action_type,i,supplier_id)
					
						 
					 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('','".$row[csf("booking_id")]."','".$cbo_company."','".$row[csf("currency")]."','".$cbo_category."','".change_date_format($row[csf("wo_date")])."','','','".$cbo_category."','','','','show_trim_booking_report','')\">".$row[csf("labtest_prefix_num")]." </a>";	     					
					$supplier_name="";
					if($row[csf("pay_mode")]==3 || $row[csf("pay_mode")]==5)
					{
						$supplier_name=$company_library[$row[csf("supplier_id")]];
					}
					else $supplier_name=$supplierArr[$row[csf("supplier_id")]];
					if($row[csf('ready_to_approved')]==1) //ready
					{
						$last_update_date=$row[csf('update_date')];
					}
					
					?>
					<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
						<td width="30"><? echo $i;?></td>
						<td width="100" align="center"><p><? echo $company_library[$row[csf("company_id")]]; ?></td>
						<td width="60" align="center"><? echo $variable; ?></td>
						<td width="60" align="center"><p><? echo $pi_no_arr[$row[csf("booking_id")]]['pi_no']; ?></td>
						<td width="60" align="center"><p><? echo $row[csf("year_book")]; ?></td>					
						<td width="70"><div style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("wo_date")], "", "",0); ?></div></td>
						<td width="70"><div style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("delivery_date")]); ?></div></td>
                        <td width="70"><div style="word-wrap:break-word; width:70px">
						<? 
						$lead_time=0;
						if($row[csf("delivery_date")]!="" && $row[csf("delivery_date")]!="0000-00-00")
						{
							$lead_time=datediff("d", $row[csf("wo_date")], $row[csf("delivery_date")]);
						}
						if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day"; 
						?></div></td>
						<td width="100"><?=$wo_type; ?></td>
						<td width="100" align="center"><? echo $yes_no[$row[csf("ready_to_approved")]]; ?></td>
                        <td width="100" align="center"><? $last_update_dateArr=explode(" ",$last_update_date);echo change_date_format($last_update_dateArr[0]).'<br>'.$last_update_dateArr[1]; ?></td>
                        
						<td width="80"><p><? echo $approval_type_arr[$row[csf("is_approved")]]; ?></p></td>
                        <?
                       	 $approved_date=$last_app_arr[$row[("booking_id")]]['approved_date'];
						 $approved_by=$last_app_arr[$row[("booking_id")]]['approved_by'];
						?>
                         <td width="100" title="bookingId=<? echo $row[("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                         
                         
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $supplier_name; ?></div></td>
						<td width="100"><p><? echo $buyerArr[$job_array[$job_number]['buyer']]; ?></p></td>
						<td width="110"><div style="word-wrap:break-word; width:110px"><? echo $row[csf("job_no")];//$row[csf("job_no_prefix_num")]; ?></div></td>
						<td width="60"><? echo $job_array[$job_number]['year']; ?></td>
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $job_array[$job_number]['style_ref_no']; ?></div></td>
						<?
						$ref_all=rtrim($job_array[$job_number]['ref'],',');
						$ref_all=implode(", ",array_unique(explode(",",$ref_all)));
						$file_all=rtrim($job_array[$job_number]['file'],',');
						$file_all=implode(", ",array_unique(explode(",",$file_all)));
						$po_alls=rtrim($job_array[$job_number]['po_number'],',');
						$po_all=implode(", ",array_unique(explode(",",$po_alls)));
						?>
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $ref_all; ?></div></td>
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $file_all; ?></div></td>
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $po_all; ?></div></td>
                        <td width="100"><div style="word-wrap:break-word; width:100px">
						<? 
						$max_shipdate=rtrim($job_array[$job_number]['max_ship_date'],',');
						$max_ship_dateArr=explode(",",$max_shipdate);
						$max_ship_date=max($max_ship_dateArr);
						$min_shipdate=rtrim($job_array[$job_number]['min_ship_date'],',');
						$min_shipdateArr=explode(",",$min_shipdate);
						$min_shipdate=min($min_shipdateArr);

						if($max_ship_dateArr!="" && $max_ship_dateArr!="0000-00-00") echo "Max - ".change_date_format($max_ship_dateArr);
						//if($job_array[$job_number]['max_ship_date']!=$job_array[$job_number]['min_ship_date']) echo "<br> " . change_date_format($job_array[$job_number]['min_ship_date']); 
						
						$order_count=explode(",",$po_all);
						if(count($order_count)>1) echo "<br> Min - " . change_date_format($min_shipdate);
						 
						?></div></td>
						<td width="80"><div style="word-wrap:break-word; width:80px"><? echo $item_category[31]; ?></div></td>
						<td width="70" align="center"><p><? echo change_date_format($first_rec_date[$row[csf("booking_id")]]); ?></p></td>
						<td width="100" align="right"><? echo number_format($row[csf("wo_value")],2); ?></td>
						<td><? //echo $row[csf("po_number")]; ?></td>
					</tr>
					<?
					$tot_wo_qnty+=$row[csf("wo_value")];
					$i++;
				}
				?>
				</table>
				<table class="rpt_table" width="2290" cellpadding="0" cellspacing="0" border="1" rules="all">
					<tfoot>
						<th width="30">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="70">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="110">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="80">Total</th>
						<th width="70">&nbsp;</th>
                        <th width="100" align="right" id="value_tot_fin_fab_qnty"><? echo number_format($tot_wo_qnty,2); ?></th>
						<th>&nbsp;</th>
					</tfoot>
				</table>
			</div>
		</fieldset>
		<?
	}

	$html = ob_get_contents();
    ob_clean();
    //$new_link=create_delete_report_file( $html, 2, $delete, "../../../" );
    foreach (glob("*.xls") as $filename) {
    //if( @filemtime($filename) < (time()-$seconds_old) )
    @unlink($filename);
    }
    //---------end------------//
    $name=time();
    $filename=$user_id."_".$name.".xls";
    $create_new_doc = fopen($filename, 'w');	
    $is_created = fwrite($create_new_doc, $html);
    echo "$html**$filename"; 
	exit();
}


if ($action=="report_generate2")
{
	extract($_REQUEST);
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	$cbo_company=str_replace("'","",$cbo_company_id);
	$cbo_buyer=str_replace("'","",$cbo_buyer_id);
	$cbo_category=str_replace("'","",$cbo_category_id);
	$wo_type=str_replace("'","",$cbo_wo_type);
	$year_id=str_replace("'","",$cbo_year_id);
	$job_year_id=str_replace("'","",$cbo_job_year_id);
	$wo_no=str_replace("'","",$txt_wo_no);
	$wo_id=str_replace("'","",$hidd_wo_id);
	$cbo_season_id=str_replace("'","",$cbo_season_id);
	
	$job_no=str_replace("'","",$txt_job_no);
	$hidd_job=str_replace("'","",$hidd_job_id);
	$po_no=str_replace("'","",$txt_po_no);
	$hidd_po=str_replace("'","",$hidd_po_id);
	$date_from=str_replace("'","",$txt_date_from);
	$date_to=str_replace("'","",$txt_date_to);
	$file_no=str_replace("'","",$txt_file_no);
	$internal_ref=str_replace("'","",$txt_internal_ref);
	$txt_date_category=str_replace("'","",$txt_date_category);
	$cbo_order_status=str_replace("'","",$cbo_order_status);
	
	if($cbo_category==2 || $cbo_category==3 || $cbo_category==4 || $cbo_category==12 || $cbo_category==25)
	{	
		if($db_type==0)
		{
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and YEAR(a.insert_date)=$year_id";
			if ($year_id==0) $year_id_cond_sam=""; else $year_id_cond_sam=" and YEAR(s.insert_date)=$year_id";
		}
		elseif($db_type==2)
		{ 
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(a.insert_date,'YYYY')=$year_id";
			if ($year_id==0) $year_id_cond_sam=""; else $year_id_cond_sam=" and TO_CHAR(s.insert_date,'YYYY')=$year_id";
		}
		if($db_type==0)
		{
			if ($job_year_id==0) $job_year_id_cond=""; else $job_year_id_cond=" and YEAR(c.insert_date)=$job_year_id";
			if ($job_year_id==0) $job_year_id_cond_sam=""; else $job_year_id_cond_sam=" and YEAR(s.insert_date)=$job_year_id";
		}
		elseif($db_type==2)
		{ 
			if ($job_year_id==0) $job_year_id_cond=""; else $job_year_id_cond=" and TO_CHAR(c.insert_date,'YYYY')=$job_year_id";
			if ($job_year_id==0) $job_year_id_cond_sam=""; else $job_year_id_cond_sam=" and TO_CHAR(s.insert_date,'YYYY')=$job_year_id";
		}
		
		if ($cbo_company==0) $company_id=""; else $company_id=" and a.company_id=$cbo_company";
		if ($cbo_company==0) $company_id_sam=""; else $company_id_sam=" and s.company_id=$cbo_company";
		if ($cbo_buyer==0) $buyer_id=""; else $buyer_id=" and a.buyer_id=$cbo_buyer";
		if ($cbo_buyer==0) $buyer_id_sam=""; else $buyer_id_sam=" and s.buyer_id=$cbo_buyer";
		if ($cbo_category==0) $category_id=""; else $category_id=" and a.item_category=$cbo_category";
		if ($cbo_category==0) $category_id_sam=""; else $category_id_sam=" and s.item_category=$cbo_category";
		if ($wo_no=="") $wo_no_cond=""; else $wo_no_cond=" and a.booking_no='$wo_no'";
		if ($wo_no=="") $wo_no_cond_sam=""; else $wo_no_cond_sam=" and s.booking_no='$wo_no'";
		if ($wo_type==1 || $wo_type==2)  $wo_type_cond=" and a.booking_type in (1,2,3) and a.is_short='$wo_type'"; else $wo_type_cond="";
		if ($wo_type==3) $wo_type_cond_sam="  and a.booking_type=4"; else $wo_type_cond_sam="";
		
		if ($job_no=="") $job_num=""; else $job_num=" and b.job_no='$job_no'";
		//if ($po_no=='') $po_no_no=""; else $po_no_no=" and d.po_number in ($po_no)";
		if ($hidd_po=="") $po_id=""; else $po_id=" and d.id in ( $hidd_po )";
		
		//if ($hidd_po=="") $po_id_cond=""; else $po_id_cond=" and b.po_break_down_id in ( $hidd_po )";
		
		if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and d.file_no='".trim($file_no)."' "; 
		if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and d.grouping='".trim($internal_ref)."' "; 
		//echo $file_no_cond.'=='.$internal_ref_cond;die;
		if ($cbo_season_id==0) $season_cond=""; else $season_cond=" and c.season_buyer_wise in(".$cbo_season_id.") "; 
		
		if($db_type==0)
		{
			if($txt_date_category==1){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".$date_from."' and '".$date_to."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.booking_date between '".$date_from."' and '".$date_to."'";
			}
			else if($txt_date_category==2){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".$date_from."' and '".$date_to."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.delivery_date between '".$date_from."' and '".$date_to."'";
			}
		}
		if($db_type==2)
		{
			if($txt_date_category==1){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.booking_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
			else if($txt_date_category==2){
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
				if( $date_from=="" && $date_to=="" ) $booking_date_cond_samp=""; else $booking_date_cond_samp=" and s.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
		}
	
		$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
		$supplierArr=return_library_array( "select id,supplier_name from lib_supplier", "id", "supplier_name");	
		$buyerArr=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
		//$nonStyleArr=return_library_array( "select id, style_ref_no from sample_development_mst", "id", "style_ref_no");		
		if ($cbo_category==4) 
		{
			$colspan=33;
			$tbl_width=3300;
		}
		else if ($cbo_category==12)
		{
			$colspan=28;
			$tbl_width=3310;
		}
		else if ($cbo_category==2)
		{
			$colspan=28;
			$tbl_width=3470;
		}else if ($cbo_category==3)
		{
			$colspan=28;
			$tbl_width=4200;
		}
		else
		{
			$colspan=27;
			$tbl_width=3310;
		}
		

		//var_dump($job_array);
		if($cbo_company!=0) $cbo_company_cond="and template_name=$cbo_company";else $cbo_company_cond="";
		if($cbo_category==2 || $cbo_category==3)
		{
			// $print_report_format_ids=return_field_value("format_id","lib_report_template","template_name=".$cbo_company."  and module_id=2 and report_id=1 and is_deleted=0 and status_active=1");
			$print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=1 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			
			$print_short_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=2 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$partial_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=35 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$woven_partial_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=138 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$sample_req_non_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=90 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$sample_req_booking_withorder_print_report_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=48 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			
			
			$sample_booking_non_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=4 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$sample_booking_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=3 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$pre_print_report_format=return_library_array( "select template_name, format_id from lib_report_template where  module_id=5 and report_id=183 and is_deleted=0 and status_active=1 and template_name=$cbo_company", "template_name", "format_id");
			//$format_ids=explode(",",$print_report_format_ids);
		}
		else if($cbo_category==4)
		{
			$print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(5,6,219) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			/*$print_report_format_arr26=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=26 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");*/
			$trim_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(5) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$trim_print_report_format_arr2=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(6) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$print_report_format_arr26=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=26 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$trim_print_report_format_arr3=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id in(219) and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$pre_print_report_format=return_library_array( "select template_name, format_id from lib_report_template where  module_id=5 and report_id=183 and is_deleted=0 and status_active=1 and template_name=$cbo_company", "template_name", "format_id");
			
		}
		else if($cbo_category==12) // Service Fab. Booking.
		{
			$print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=11 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$knit_print_report_format_arr=return_library_array( "select template_name, format_id from lib_report_template where  module_id=2 and report_id=65 and is_deleted=0 and status_active=1 $cbo_company_cond", "template_name", "format_id");
			$print_report_format_aop=return_field_value("format_id"," lib_report_template"," module_id=2 and report_id=49 and is_deleted=0 and status_active=1 $cbo_company_cond");
			$print_report_format_multi_dyeing=return_field_value("format_id"," lib_report_template"," module_id=2 and report_id=195 and is_deleted=0 and status_active=1 $cbo_company_cond");
		}
		//print_r($print_report_format_multi_dyeing);
		$tot_fin_fab_qnty=0;
		?>
		<!-- <style>
		#center td{
		line-height: 10px;
		height: 15px;							
		text-align: center;
		}
		</style> -->
							<?
		ob_start();
		?>
		<fieldset>
			<table width="<? echo $tbl_width; ?>"  cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none; font-size:18px;" colspan="<? echo $colspan; ?>">
						<? echo $company_library[str_replace("'","",$cbo_company_id)]; ?>                                
					</td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:16px; font-weight:bold"  colspan="<? echo $colspan; ?>"> <? echo $report_title; if($cbo_category!=0) echo " For ".$item_category[$cbo_category]; ?></td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:12px; font-weight:bold"  colspan="<? echo $colspan; ?>"> <? if( $date_from!="" && $date_to!="" ) echo "From ".change_date_format($date_from)." To ".change_date_format($date_to);?></td>
				</tr>
			</table>
			<table width="<? echo $tbl_width; ?>" cellspacing="0" border="1" class="rpt_table" rules="all">
				<thead>
					<th width="30">SL</th>    
					<th width="100">Company</th>
					<th width="60">WO No</th>
                    <th width="70">Pay Mode</th>
                    <?
					if ($cbo_category==3 || $cbo_category==2 || $cbo_category==25 || $cbo_category==4)
					{
						?>
                        <th width="100">PI No</th>
                        <?
					}

					if ($cbo_category==12)
					{
						?>
						<th width="100">PI No</th>
                        <th width="100">Process</th>
                        <?
					}
					
					?>
					<th width="60">WO Year</th>
					<th width="70">WO Date</th>
					<th width="70">WO Last Update</th>
					<th width="70">Delivery Date</th>
					<th width="70">Supp. Dlv. Revised Date</th>
                    <th width="70">Lead Time</th>
					<th width="100">WO Type</th>
					<th width="100">Ready To Approved</th>
                     <?  //if ($cbo_category==4)
					//{
							
							 ?>
                    <th width="100">Ready To Approved<br>date and time</th>
                      <?
					//}
					?>
					<th width="80">Approval Status</th>
                     <?  //if ($cbo_category==4)
					//{
							
							 ?>
                    <th width="100">Last Approval <br>Date time and Person</th>
                      <?
					//}
					?>
					<th width="100">Supplier</th>
					<th width="100">Buyer</th>
					<th width="70">Job No.</th>
                    <th width="70">Season</th>
					<th width="60">Job Year</th>
					<th width="150">Style Ref.</th>
					<th width="100">Internal Ref.</th>
					<th width="100">File No.</th>
					<th width="150">Order No</th>
                    <th width="100">Shipment Date</th>
					<th width="80">Item Category</th>
					<?  if ($cbo_category==4){ ?>
						<th width="400">Item Name</th>
					<? } ?>
					<?  if ($cbo_category==3){ ?>
						<th width="150">Fabric Type</th>
					<? } ?>
					<th width="70">First Receive Date</th>
					<?
						if ($cbo_category==4)
						{
							?>								
                                <th width="100">WO value(USD)</th>                                
                                <th width="100">Receive Value(USD)</th>
							<?
						}
						else
						{
							
							if ($cbo_category==25) 
							{ 
							  $head_type="WO Qty[Dzn]";
							  $head_type2="[USD]";
							}
							else { 
							 $head_type="WO Qty (Fin.)";
							 $head_type2="";
							}
							?>
								<th width="100"><? echo $head_type;?></th>
								<?
								if ($cbo_category==3)
								{
									?>
			                        <th width="100">WO Value<? echo $head_type2;?></th>
									<th width="100">Receive Qty.</th>
									<th width="100">Receive Value(USD)</th>
									<th width="100">Issue Qty.</th>
									<th width="100" title="Calculate By Weight and Avg. Rate">Issue Value(USD)</th>
									<th width="100" >Balance Qty.</th>
									<th width="100" title="Receive Value(USD)-Issue Value(USD)">Balance Value</th>
			                        <?
								}elseif ( $cbo_category==25)
								{
									?>
			                        <th width="100">WO Value<? echo $head_type2;?></th>
			                        <?}
								else
								{
									?>
									<th width="100">WO Qty (Grey)</th>
									<?
								}
								?>
								
							<?
						}
					if($cbo_category==2)//Knit Fab.
					{
						?>
						<th width="80">Sample QTY</th>
						<th width="80">Responsible Dept</th>
						<th width="80">Reason</th>
						<?
					}
					?>
					<?  if ($cbo_category==4){ ?>
						<th width="100" title="Calculate By Weight and Avg. Rate">Issue Value (USD)</th>
						<th width="100" title="Receive Value(USD)-Issue Value(USD)">Balance Value</th>
					<? } ?>
					<th width="100">Remarks</th>
				</thead>
			</table>
			<div style="max-height:350px; overflow-y:scroll; width:<? echo $tbl_width+20; ?>px" id="scroll_body" >
				<table cellspacing="0" cellpadding="0" border="1" class="rpt_table"  width="<? echo $tbl_width; ?>" rules="all" id="table_body" >
				<?
				
				
				$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
				$fabric_source_cond="";$fabric_source_cond_nonOrder="";
				if($cbo_category==2 || $cbo_category==4)
				{ 
					if($cbo_fabric_source>0) 
					{
						$fabric_source_cond=" and a.fabric_source=$cbo_fabric_source"; 
					
						if($cbo_fabric_source==1 || $cbo_fabric_source==4){
							$fabric_source_cond_nonOrder=" and t.fabric_source=$cbo_fabric_source"; 
							$select_field="t.fabric_source";
						}
						else
						{
							$fabric_source_cond_nonOrder=" and s.fabric_source=$cbo_fabric_source"; 
							$select_field="s.fabric_source";
						}
					}
					else $select_field="s.fabric_source";
				}
				//echo $select_field.'DDD';die;
				//var_dump($receive_qnty_data_prod);die;
				
				if($db_type==0)
				{
					$year_book=" year(a.insert_date) as year_book";
					$year_book_non=" year(s.insert_date) as year_book";
					$select_job_year=" year(c.insert_date) as job_year"; 
				}
				else
				{
					$year_book=" TO_CHAR(a.insert_date,'YYYY') as year_book";
					$year_book_non=" TO_CHAR(s.insert_date,'YYYY') as year_book";
					$select_job_year=" TO_CHAR(c.insert_date,'YYYY') as job_year";
				}

				if($wo_type==0)
				{
					if($job_no!='' || $hidd_po!='' || $file_no!='' || $internal_ref!='')
					{

						 $sql="Select a.entry_form,a.update_date, a.company_id, a.id as booking_id, a.pay_mode, a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date, a.delivery_date,a.sup_rev_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount,b.responsible_dept,b.reason, b.uom as uom,c.season_buyer_wise, c.job_no_prefix_num,c.id as job_id, c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date, 0 as type ,b.bh_qty,b.rf_qty

						from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d  
						where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $booking_date_cond $wo_no_cond $fabric_source_cond  $job_num $po_id $internal_ref_cond  $file_no_cond $season_cond $year_id_cond $job_year_id_cond";//die;
					}
					else
					{
						  $sql="(Select a.entry_form,a.update_date,a.company_id,a.id as booking_id, a.pay_mode,a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date as booking_date,a.delivery_date,a.sup_rev_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount, b.responsible_dept,b.reason,b.uom as uom,c.season_buyer_wise,c.id as job_id, c.job_no_prefix_num, c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date, 0 as type ,b.bh_qty,b.rf_qty 
						from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d
						where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $job_num $po_id $booking_date_cond $wo_no_cond $fabric_source_cond  $job_num $po_id $internal_ref_cond  $file_no_cond $year_id_cond $job_year_id_cond $season_cond) 
						 union all
						 (SELECT s.entry_form_id as entry_form,s.update_date, s.company_id, s.id as booking_id, s.pay_mode, s.booking_type, s.is_short, s.booking_no, $year_book_non, s.booking_no_prefix_num, s.fabric_source, s.booking_date as booking_date, s.delivery_date,null as  delivery_date_dtls,s. sup_rev_date, s.is_approved, s.ready_to_approved, s.supplier_id, s.buyer_id, s.item_category, s.currency_id, s.exchange_rate, null as process, t.finish_fabric as fin_fab_qnty, t.grey_fabric as grey_fab_qnty, t.trim_qty as wo_qnty, t.amount as amount, null as responsible_dept, null as reason, t.uom as uom,null as season_buyer_wise,null as job_id, null as job_no_prefix_num, null as job_no, null as job_year, null as style_ref_no, null as garments_nature, 0 as po_break_down_id, null as po_number, null as file_no, null as grouping, null as pub_shipment_date, 1 as type ,t.bh_qty,t.rf_qty
						 FROM wo_non_ord_samp_booking_mst s, wo_non_ord_samp_booking_dtls t 
						 WHERE s.booking_no=t.booking_no and s.status_active =1 and s.is_deleted=0 and t.status_active =1 and t.is_deleted=0 $company_id_sam $buyer_id_sam ".set_user_lavel_filtering(' and s.buyer_id','buyer_id')." $category_id_sam $booking_date_cond_samp $wo_no_cond_sam $year_id_cond_sam $job_year_id_cond_sam $fabric_source_cond_nonOrder) order by booking_date ";//die;//LISTAGG(CAST(b.job_no AS VARCHAR(4000)), ',') WITHIN GROUP (ORDER BY b.job_no) as job_no,
					}
				}
				else
				{
					if ($wo_type==1 || $wo_type==2 || $wo_type==3)
					{
						 $sql="Select a.entry_form,a.update_date, a.company_id, a.id as booking_id, a.pay_mode, a.booking_type, a.is_short, a.booking_no, $year_book, a.booking_no_prefix_num, a.fabric_source, a.booking_date,a.delivery_date,a.sup_rev_date,b.delivery_date as delivery_date_dtls, a.is_approved, a.ready_to_approved, a.supplier_id, a.buyer_id, a.item_category, a.currency_id, a.exchange_rate, b.responsible_dept, b.reason, b.process, b.fin_fab_qnty as fin_fab_qnty, b.grey_fab_qnty as grey_fab_qnty, b.wo_qnty as wo_qnty, b.amount as amount, b.uom as uom,c.season_buyer_wise, c.job_no_prefix_num, c.id as job_id,c.job_no, $select_job_year, c.style_ref_no, c.garments_nature, d.id as po_break_down_id, d.po_number as po_number, d.file_no as file_no, d.grouping as grouping, d.pub_shipment_date,  0 as type,b.bh_qty,b.rf_qty
						 from wo_booking_mst a, wo_booking_dtls b, wo_po_details_master c, wo_po_break_down d 
						 where a.booking_no=b.booking_no and b.po_break_down_id=d.id and d.job_no_mst=c.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.is_deleted=0 and c.status_active=1 and d.status_active=$cbo_order_status  $company_id $buyer_id ".set_user_lavel_filtering(' and a.buyer_id','buyer_id')." $category_id $job_num $po_id $booking_date_cond $wo_no_cond $wo_type_cond $wo_type_cond_sam $file_no_cond $internal_ref_cond $fabric_source_cond $year_id_cond $job_year_id_cond $season_cond order by a.booking_no";//die;
					}
					else
					{  
						$sql="SELECT s.entry_form_id as entry_form,s.update_date,s.company_id, s.id as booking_id, s.pay_mode, s.booking_type, s.is_short, s.booking_no, $year_book_non, s.booking_no_prefix_num, $select_field , s.booking_date, s.delivery_date,s.sup_rev_date, s.is_approved, s.ready_to_approved, s.supplier_id, s.buyer_id, s.item_category, s.currency_id, s.exchange_rate, null as process, t.finish_fabric as fin_fab_qnty, t.grey_fabric as grey_fab_qnty, t.trim_qty as wo_qnty, t.amount as amount, t.uom as uom,null as season_buyer_wise, null as job_no_prefix_num, null as job_no, null as job_year, null as style_ref_no, null as garments_nature, 0 as po_break_down_id, null as po_number, null as file_no, null as grouping, null as pub_shipment_date, 1 as type,  t.bh_qty,t.rf_qty
						FROM wo_non_ord_samp_booking_mst s, wo_non_ord_samp_booking_dtls t 
						WHERE s.booking_no=t.booking_no and s.status_active =1 and s.is_deleted=0 and t.status_active =1 and t.is_deleted=0 $company_id_sam $buyer_id_sam ".set_user_lavel_filtering(' and s.buyer_id','buyer_id')." $category_id_sam $booking_date_cond_samp $wo_no_cond_sam $year_id_cond_sam $job_year_id_cond_sam $fabric_source_cond_nonOrder";//die;
					}
				}
				//echo $sql; 

				//==============================================================================
				$lib_item_group_arr = return_library_array("select item_name,id from lib_item_group where item_category=4 order by item_name", "id", "item_name");
					// print_r($finish_fab_type_arr);
					//=============================================================================
				$job_check=$order_check=array();
				$sql_result=sql_select($sql); 
				$booking_data=array();$booking_id_arr=array();
				foreach($sql_result as $rows)
				{ 
					$booking_arr[$rows[csf("booking_id")]]=$rows[csf("booking_id")];
				}		

				foreach($sql_result as $row)
				{ 
					$booking_id_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
					$po_id_arr[$row[csf("po_break_down_id")]]=$row[csf("po_break_down_id")];
					$job_id_arr[$row[csf("job_id")]]=$row[csf("job_id")];
					
					$booking_data[$row[csf("booking_id")]]["booking_id"]=$row[csf("booking_id")];
					$booking_data[$row[csf("booking_id")]]["booking_type"]=$row[csf("booking_type")];
					$booking_data[$row[csf("booking_id")]]["update_date"]=$row[csf("update_date")];
					$booking_data[$row[csf("booking_id")]]["is_short"]=$row[csf("is_short")];
					$booking_data[$row[csf("booking_id")]]["booking_no"]=$row[csf("booking_no")];
					$booking_data[$row[csf("booking_id")]]["company_id"]=$row[csf("company_id")];
					$booking_data[$row[csf("booking_id")]]["year_book"]=$row[csf("year_book")];
					$booking_data[$row[csf("booking_id")]]["booking_no_prefix_num"]=$row[csf("booking_no_prefix_num")];
					$booking_data[$row[csf("booking_id")]]["entry_form"]=$row[csf("entry_form")];
					
					$booking_data[$row[csf("booking_id")]]["fabric_source"]=$row[csf("fabric_source")];
					$booking_data[$row[csf("booking_id")]]["booking_date"]=$row[csf("booking_date")];
					$booking_data[$row[csf("booking_id")]]["update_date"]=$row[csf("update_date")];
					$booking_data[$row[csf("booking_id")]]["delivery_date"]=$row[csf("delivery_date")];
					$booking_data[$row[csf("booking_id")]]["sup_rev_date"]=$row[csf("sup_rev_date")];
					$booking_data[$row[csf("booking_id")]]["is_approved"]=$row[csf("is_approved")];
					$booking_data[$row[csf("booking_id")]]["ready_to_approved"]=$row[csf("ready_to_approved")];
					$booking_data[$row[csf("booking_id")]]["supplier_id"]=$row[csf("supplier_id")];
					$booking_data[$row[csf("booking_id")]]["buyer_id"]=$row[csf("buyer_id")];
					$booking_data[$row[csf("booking_id")]]["item_category"]=$row[csf("item_category")];
					$booking_data[$row[csf("booking_id")]]["type"]=$row[csf("type")];
					$booking_data[$row[csf("booking_id")]]["pay_mode"]=$row[csf("pay_mode")];
					$booking_data[$row[csf("booking_id")]]["delivery_date_dtls"]=$row[csf("delivery_date_dtls")];
					$booking_data[$row[csf("booking_id")]]["currency_id"]=$row[csf("currency_id")];
					$booking_data[$row[csf("booking_id")]]["process"].=$row[csf("process")].",";
					
					$booking_data[$row[csf("booking_id")]]["fin_fab_qnty"]+=$row[csf("fin_fab_qnty")];
					$booking_data[$row[csf("booking_id")]]["grey_fab_qnty"]+=$row[csf("grey_fab_qnty")];
					$booking_data[$row[csf("booking_id")]]["wo_qnty"]+=$row[csf("wo_qnty")];
					$booking_data[$row[csf("booking_id")]]["amount"]+=$row[csf("amount")];
					$booking_data[$row[csf("booking_id")]]["sample_qnt"]+=($row[csf("bh_qty")]*1+$row[csf("rf_qty")]*1);
					$booking_data[$row[csf("booking_id")]]["uom"]=$row[csf("uom")];
					if($job_check[$row[csf("booking_id")]][$row[csf("job_no")]]=="")
					{
						$booking_data[$row[csf("booking_id")]]["job_no"].=$row[csf("job_no")].",";
						$booking_data[$row[csf("booking_id")]]["job_no_prefix_num"].=$row[csf("job_no_prefix_num")].",";
						$booking_data[$row[csf("booking_id")]]["job_year"].=$row[csf("job_year")].",";
						$booking_data[$row[csf("booking_id")]]["style_ref_no"].=$row[csf("style_ref_no")].",";
						$booking_data[$row[csf("booking_id")]]["season_buyer_wise"].=$season_library[$row[csf("season_buyer_wise")]].",";
						
						$job_check[$row[csf("booking_id")]][$row[csf("job_no")]]=$row[csf("job_no")];
					}
					if($order_check[$row[csf("booking_id")]][$row[csf("po_break_down_id")]]=="")
					{
						$booking_data[$row[csf("booking_id")]]["po_break_down_id"].=$row[csf("po_break_down_id")].",";
						$booking_data[$row[csf("booking_id")]]["po_number"].=$row[csf("po_number")].",";
						$booking_data[$row[csf("booking_id")]]["file_no"].=$row[csf("file_no")].",";
						$booking_data[$row[csf("booking_id")]]["grouping"].=$row[csf("grouping")].",";
						$booking_data[$row[csf("booking_id")]]["pub_shipment_date"].=change_date_format($row[csf("pub_shipment_date")]).",";
						
						$order_check[$row[csf("booking_id")]][$row[csf("po_break_down_id")]]=$row[csf("po_break_down_id")];
					}
					if($row[csf("booking_type")]==1 && $row[csf("is_short")]==1)//responsible_dept,reason
					{
						if($row[csf("reason")]!='')
						{
							$booking_data[$row[csf("booking_id")]]["reason"].=$row[csf("reason")].",";
						}
						if($row[csf("responsible_dept")]!='')
						{
							$resp_dept=explode(",",$row[csf("responsible_dept")]);
							$dept_name="";
							foreach($resp_dept as $dept)
							{
								if($dept_name=="") $dept_name=$department_library[$dept]; else $dept_name.=",".$department_library[$dept];
							}
							$booking_data[$row[csf("booking_id")]]["dept_name"].=$dept_name.",";
						}
					}
				}
				/*echo '<pre>';
				print_r($po_id_arr); die;*/
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 1, $booking_id_arr, $empty_arr);//Book ID Ref from=1
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 2, $po_id_arr, $empty_arr);//PO ID Ref from=1
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 3, $job_id_arr, $empty_arr);//Job ID Ref from=1
				disconnect($con);
				//======================Temp==============================
				$finish_fab_type_job_data=sql_select("select b.id, b.job_no, b.item_number_id, b.body_part_id, b.color_type_id, b.lib_yarn_count_deter_id as lib_yarn_count_deter_id, b.body_part_type from wo_pre_cost_fabric_cost_dtls b,gbl_temp_engine g
					where    b.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=37 and  b.status_active=1 and b.is_deleted=0 order by id ");

					foreach($finish_fab_type_job_data as $row){
						$finish_fab_type_arr[$row[csf("job_no")]][$row[csf("body_part_id")]]=$body_part[$row[csf("body_part_id")]];
					}

					$trims_type_job_data=sql_select("select b.trim_group,b.job_no from wo_pre_cost_trim_cost_dtls  b,gbl_temp_engine g where   b.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=37 and b.is_deleted=0  ");

					foreach($trims_type_job_data as $row){
						$trims_type_arr[$row[csf("job_no")]][$row[csf("trim_group")]]=$lib_item_group_arr[$row[csf("trim_group")]];
					}
				 
				$wopi_arr=array(); $tem_pi=array();$wopiId_arr=array();
				if($cbo_category==4)
				{
					if($cbo_company>0) $piCond="and a.importer_id=$cbo_company"; else $piCond="";
					$sql_wo_pi=sql_select("select a.id,a.pi_number, b.work_order_no, b.work_order_dtls_id from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g  where a.id=b.pi_id and b.work_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and a.item_category_id=4 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.work_order_dtls_id>0 $piCond");	
					foreach($sql_wo_pi as $rowPi)
					{
						$tem_pi[$rowPi[csf('work_order_no')]]=$rowPi[csf('pi_number')];
						$wopiId_arr[$rowPi[csf('work_order_no')]].=$rowPi[csf("id")]."__";
						$wopi_arr[$rowPi[csf('work_order_no')]].=$rowPi[csf("pi_number")]."__";
					}
					//unset($sql_wo_pi);
				}
				if($cbo_category==2 || $cbo_category==3 || $cbo_category==4 ||  $cbo_category==25)
				{
					if ($cbo_company==0) $company_cond_id=""; else $company_cond_id=" and b.company_id=$cbo_company";
					if($cbo_category==2)
					{
						$booking_check_prod=array();
						$prod_1st_sql=sql_select("select a.id as book_id, b.booking_without_order, c.transaction_date as receive_date, c.cons_quantity as rcv_qnty from  wo_booking_mst a, pro_batch_create_mst b , inv_transaction c,gbl_temp_engine g where a.id=b.booking_no_id and b.id=c.pi_wo_batch_no and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.item_category in(2,3)  and c.pi_wo_batch_no>0 and c.status_active=1 and c.item_category in(2,3) and c.transaction_type=1");
						$first_rec_date_prod=array();
						foreach($prod_1st_sql as $row)
						{
							//$first_rec_date_prod[$row[csf("book_id")]]=$row[csf("receive_date")];
							$receive_data_pord[$row[csf("book_id")]][$row[csf("booking_without_order")]].=$row[csf("receive_date")].",";
							$receive_qnty_data_prod[$row[csf("book_id")]][$row[csf("booking_without_order")]][$row[csf("receive_date")]]+=$row[csf("rcv_qnty")];
							if($booking_check[$row[csf("book_id")]]=="")
							{
								$first_rec_date_prod[$row[csf("book_id")]]=$row[csf("receive_date")];
								$booking_check_prod[$row[csf("book_id")]]=$row[csf("receive_date")];
							}
						}
						
						$sql_receive="select b.recv_number,b.booking_id, b.receive_date, b.booking_without_order, c.cons_quantity as rcv_qnty from inv_receive_master b, inv_transaction c,gbl_temp_engine g where b.id=c.mst_id and b.booking_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and c.transaction_type=1 and b.item_category in(2,3)  and b.receive_basis in(12,2) $company_cond_id";
						 	
						$receive_result=sql_select($sql_receive);
						$receive_data=$receive_qnty_data=$booking_check=array();
						foreach($receive_result as $row)
						{
							$receive_data[$row[csf("booking_id")]][$row[csf("booking_without_order")]].=$row[csf("receive_date")].",";
							$receive_qnty_data[$row[csf("booking_id")]][$row[csf("booking_without_order")]][$row[csf("receive_date")]]+=$row[csf("rcv_qnty")];
							if($booking_check[$row[csf("booking_id")]]=="")
							{
								$first_rec_date[$row[csf("booking_id")]]=$row[csf("receive_date")];
								$booking_check[$row[csf("booking_id")]]=$row[csf("receive_date")];
								$first_rec_no[$row[csf("booking_id")]]=$row[csf("recv_number")];
							}
						}
						
					}
					else
					{
						 $sql="select min(a.recv_number) as recv_number,b.pi_wo_batch_no, min(a.receive_date) as receive_date,min(a.currency_id) as currency_id, sum(b.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,gbl_temp_engine g where a.id=b.mst_id and b.pi_wo_batch_no=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.entry_form=24 and  b.item_category in(4)  and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(2,12) $company_cond_id group by b.pi_wo_batch_no";	//echo $sql ;die;
						$sql_result=sql_select($sql);
						$booking_pi_check=array();
						foreach($sql_result as $row)
						{
							$first_rec_date[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
							$first_rec_no[$row[csf("pi_wo_batch_no")]]=$row[csf("recv_number")];
							$booking_pi_check[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
						}
						unset($sql_result);
							if($cbo_category==3) //Woven Fab
							{
								 $pi_recv_sql="select min(a.recv_number) as recv_number,b.pi_wo_batch_no, min(a.receive_date) as receive_date,min(a.currency_id) as currency_id, sum(b.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,gbl_temp_engine g where a.id=b.mst_id and b.pi_wo_batch_no=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and a.entry_form=17 and  b.item_category in(3)  and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(2,1) $company_cond_id group by b.pi_wo_batch_no";
								
							$wvn_receive_result=sql_select($pi_recv_sql);
							$receive_data=$receive_qnty_data=$booking_check=array();
							foreach($wvn_receive_result as $row)
							{
								$first_rec_date[$row[csf("pi_wo_batch_no")]]=$row[csf("receive_date")];
								$first_rec_no[$row[csf("pi_wo_batch_no")]]=$row[csf("recv_number")];
							}
							unset($wvn_receive_result);
						}
						
					}
				}

				
				
				
				if($cbo_category!=2)
				{

				 $sql_recv="select b.pi_wo_batch_no,b.prod_id, (a.currency_id) as currency_id,(c.quantity) as rcv_qnty, (c.order_amount) as rec_amt from inv_receive_master a, inv_transaction b,order_wise_pro_details c,gbl_temp_engine g where a.id=b.mst_id and  b.id=c.trans_id and c.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and c.trans_type=1 and a.entry_form=24 and c.entry_form=24 and  b.item_category in(4)  and c.status_active=1 and c.is_deleted=0   and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(2,12) $company_cond_id    ";
						$sql_Recv_result=sql_select($sql_recv);
						$propo_id_check=array();
						foreach($sql_Recv_result as $row)
						{
							if($propo_id_check[$row[csf('prop_id')]]=="")
							{
							$propo_id_check[$row[csf('prop_id')]]=$row[csf('prop_id')];
							$rec_amt_arr[$row[csf("pi_wo_batch_no")]]+=$row[csf("rec_amt")];
							}
							$rec_currency_arr[$row[csf("pi_wo_batch_no")]]=$row[csf("currency_id")];
						}
						unset($sql_Recv_result);
				}

				$emb_item_array=array();
	
				$emb_sql="select a.emb_name, b.item_number_id, b.job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b,gbl_temp_engine g where a.job_id=b.job_id  and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
				$emb_sql_result=sql_select($emb_sql);
				foreach($emb_sql_result as $row)
				{
					$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
					$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
				}
				unset($emb_sql_result);

				if($cbo_category==4)
				{
					 $trim_issue_qty_data=sql_select("SELECT a.issue_qnty as quantity, g.id as booking_id,a.rate,b.order_amount  from  inv_issue_master d join inv_trims_issue_dtls a on a.mst_id=d.id join product_details_master p on a.prod_id=p.id join order_wise_pro_details b on a.trans_id=b.trans_id join  gbl_temp_engine gg  on gg.ref_val=b.po_breakdown_id  and gg.user_id = ".$user_id." and gg.ref_from=2 and gg.entry_form=37 join wo_booking_dtls f on gg.ref_val=f.po_break_down_id join wo_booking_mst g on g.booking_no=f.booking_no where  b.trans_type=2 and b.entry_form=25 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and f.booking_type=2 and f.is_short=2 and f.is_deleted=0 and f.status_active=1 and g.is_deleted=0 and g.status_active=1    group by a.issue_qnty , g.id ,a.rate,b.order_amount ");
					
					foreach ($trim_issue_qty_data as $row) {
						//$booking_data[$row[csf("booking_id")]]["trims_issue_qty"]+=$row[csf("quantity")]*$row[csf("rate")];
						$booking_data[$row[csf("booking_id")]]["trims_issue_qty"]+=$row[csf("order_amount")];
					}
				}

				

				if($cbo_category==3){

				    // $finis_fab_issue_data=sql_select("select a.issue_qnty , g.id as booking_id ,c.entry_form, c.trans_type,f.booking_type,f.is_short, d.cons_amount from inv_wvn_finish_fab_iss_dtls a join product_details_master p on p.id=a.prod_id join order_wise_pro_details c on c.trans_id=a.trans_id join 	wo_booking_dtls f on c.po_breakdown_id=f.po_break_down_id join wo_booking_mst g on g.booking_no=f.booking_no JOIN pro_batch_create_mst m  on 
					// g.booking_no=m.booking_no join inv_transaction d on m.id=d.batch_id and	 c.trans_id=d.id  where a.status_active =1 and a.is_deleted =0 and f.booking_type=1 and f.is_short=2 and c.entry_form=19 and c.trans_type=2 ".where_con_using_array($po_id_arr,0,'c.po_breakdown_id')." group by a.issue_qnty, g.id ,c.entry_form, c.trans_type,f.booking_type,f.is_short, d.cons_amount");

					
					$finis_fab_issue_data=sql_select("select c.quantity as issue_qnty , g.id as booking_id ,c.entry_form, c.trans_type,f.booking_type,f.is_short, d.cons_amount from  order_wise_pro_details c  join 	wo_booking_dtls f on c.po_breakdown_id=f.po_break_down_id join gbl_temp_engine gg on  gg.ref_val=c.po_breakdown_id and gg.ref_val=f.po_break_down_id  and gg.user_id = ".$user_id." and gg.ref_from=2 and gg.entry_form=37 join wo_booking_mst g on g.booking_no=f.booking_no  join inv_transaction d on c.trans_id=d.id  where  f.booking_type=1 and f.is_short=2 and c.entry_form=19 and c.trans_type=2 group by c.quantity , g.id ,c.entry_form, c.trans_type,f.booking_type,f.is_short, d.cons_amount ");
					foreach ($finis_fab_issue_data as $row) {
						$booking_data[$row[csf("booking_id")]]["finish_issue_qty"]+=$row[csf("issue_qnty")];
						$booking_data[$row[csf("booking_id")]]["finish_issue_amount"]+=$row[csf("cons_amount")];
					}
					//  echo "<pre>";
					//  print_r($booking_data);
					// $finis_fab_recv_data=sql_select("SELECT b.pi_wo_batch_no, d.booking_id, b.order_qnty, b.order_rate,b.order_amount, b.cons_amount, d.trans_id from inv_receive_master a, inv_transaction b, product_details_master c, pro_finish_fabric_rcv_dtls d,order_wise_pro_details e where a.id=b.mst_id and a.id=d.mst_id and b.prod_id=c.id and  b.id=e.trans_id and b.id=d.trans_id and b.transaction_type=1 and b.item_category=3 and a.entry_form=17  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 ".where_con_using_array($po_id_arr,0,'e.po_breakdown_id')." group by 	b.pi_wo_batch_no,d.booking_id, b.order_qnty, b.order_rate,b.order_amount, b.cons_amount, d.trans_id");
					//$finis_fab_recv_data=sql_select("SELECT b.pi_wo_batch_no, a.booking_id, b.order_qnty, b.order_rate,b.order_amount, b.cons_amount, b.id as trans_id from inv_receive_master a, inv_transaction b,order_wise_pro_details e,gbl_temp_engine g where a.id=b.mst_id   and  b.id=e.trans_id   and g.ref_val=e.po_breakdown_id  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37  and b.transaction_type=1 and b.item_category=3 and a.entry_form=17  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0   ");

					$finis_fab_recv_data=sql_select("SELECT b.pi_wo_batch_no, c.booking_id, b.order_qnty, b.order_rate,b.order_amount, b.cons_amount, b.id as trans_id 
					from inv_receive_master a,pro_finish_fabric_rcv_dtls c, inv_transaction b,order_wise_pro_details e,gbl_temp_engine g 
					where a.id=c.mst_id and c.trans_id=b.id and a.id=b.mst_id and b.id=e.trans_id and g.ref_val=e.po_breakdown_id and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 
					and b.transaction_type=1 and b.item_category=3 and a.entry_form=17 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 
					and b.is_deleted=0 and a.receive_basis=1 
					
					union all 
					
					 SELECT b.pi_wo_batch_no, a.booking_id, b.order_qnty, b.order_rate,b.order_amount, b.cons_amount, b.id as trans_id 
					from inv_receive_master a, inv_transaction b,order_wise_pro_details e,gbl_temp_engine g 
					where a.id=b.mst_id and b.id=e.trans_id and g.ref_val=e.po_breakdown_id and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 
					and b.transaction_type=1 and b.item_category=3 and a.entry_form=17 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 
					and b.is_deleted=0 and a.receive_basis=2");


					foreach ($finis_fab_recv_data as $row) {
						$booking_data[$row[csf("booking_id")]]["finish_rcv_qty"]+=$row[csf("order_qnty")];
						$booking_data[$row[csf("booking_id")]]["finish_rcv_amount"]+=$row[csf("order_amount")];
						//$booking_data[$row[csf("booking_id")]]["finish_rcv_amount"]+=$row[csf("cons_amount")];
					}
				}

				/*  echo '<pre>';
				 print_r($booking_data); die; */

				

				$pi_sql = "SELECT a.id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b ,gbl_temp_engine g where a.id=b.pi_id and g.ref_val=b.work_order_id  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0
					and a.item_category_id in(2,3,12,25) and a.pi_basis_id=1 ";
				$pi_sql_result=sql_select($pi_sql);
				$pi_no_arr = array();$wopi_arr=array(); $wopiId_arr=array();
				foreach ($pi_sql_result as $value) 
				{
					$wopiId_arr[$value[csf('work_order_no')]].=$value[csf("id")]."__";
					$wopi_arr[$value[csf('work_order_no')]].=$value[csf("pi_number")]."__";
				}
				unset($pi_sql_result);
		
				 $wo_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_booking_mst a, approval_history b,gbl_temp_engine g  where a.id=b.mst_id and g.ref_val=a.id  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(8,7,32,13,12) order by b.id desc";
				$wo_his_sql_result=sql_select($wo_his_sql);
				//$pi_no_arr = array();
				$user_arr=return_library_array( "select id, user_name from user_passwd", 'id', 'user_name' );	
				foreach ($wo_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_his_sql_result);
				
				$wo_non_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_non_ord_samp_booking_mst a, approval_history b,gbl_temp_engine g where a.id=b.mst_id  and g.ref_val=a.id  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(8,7,32,9)  order by b.id desc";
				$wo_non_his_sql_result=sql_select($wo_non_his_sql);
				//$pi_no_arr = array();
			 
				foreach ($wo_non_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_non_his_sql_result);
				
				/*echo "<pre>";
				print_r($pi_no_arr);die;*/
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);

				$i=1;$summer_data=array();$job_check=array();
				$tot_wo_currency_usd_amt=$tot_recv_usd_amt=$tot_embl_wo_amount=$tot_sample=0;
						
				foreach($booking_data as $row)
				{
					
					$variable=$row[("booking_no_prefix_num")];
					$sample_qnt=0;
					$sample_qnt=$row['sample_qnt'];
					$tot_sample+=$row['sample_qnt'];
					if($row[("item_category")]==2 || $cbo_category==3)
					{
						if($row[("fabric_source")]==1 || $row[("fabric_source")]==2 || $row[("fabric_source")]==4)
						{
							if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
							if ($row[("type")]==0)
							{	
								if ($row[("booking_type")]==1 || $row[("booking_type")]==2  || $row[("booking_type")]==3  || $row[("booking_type")]==6)
								{
									if ($row[("is_short")]==1)
									{
										$wo_type="Short";
										$wo_typw_id=1;
									}
									else if ($row["entry_form"]==108){
										$wo_type="Partial";
										$wo_typw_id=5;
									}
									else
									{
										$wo_type="Main";
										$wo_typw_id=2;
									}
								}
								elseif($row[("booking_type")]==4)
								{
									$wo_type="Sample With Order";
									$wo_typw_id=3;
								}
							}
							else
							{
								$wo_type="Sample Non Order";
								$wo_typw_id=4;
							}
							// echo $wo_typw_id.'ssd';
							
							$job_no=$style_ref_no=$po_number=$file=$ref=$job_number="";
							
							$p=1;
							$ship_date_arr=array_unique(explode(",",chop($row[("pub_shipment_date")],",")));
							foreach($ship_date_arr as $ship_date)
							{
								if($p==1)
								{
									$min_ship_date=$ship_date;
									$max_ship_date=$ship_date;
								}
								
								if(strtotime($min_ship_date)>strtotime($ship_date)) $min_ship_date=$ship_date;
								if(strtotime($max_ship_date)<strtotime($ship_date)) $max_ship_date=$ship_date;
								$p++;
							}
							
							$all_po_id=implode(",",array_unique(explode(",",chop($row[("po_break_down_id")],","))));
							$job_no=implode(",",array_unique(explode(",",chop($row[("job_no_prefix_num")],","))));
							$job_number=implode(",",array_unique(explode(",",chop($row[("job_no")],","))));
							$job_list_arr=array_unique(explode(",",chop($row[("job_no")],",")));
						
							$job_year=implode(",",array_unique(explode(",",chop($row[("job_year")],","))));
							$style_ref_no=implode(",",array_unique(explode(",",chop($row[("style_ref_no")],","))));
							$po_number=implode(", ",array_unique(explode(",",chop($row[("po_number")],","))));
							$file=implode(",",array_unique(explode(",",chop($row[("file_no")],","))));
							$ref=implode(",",array_unique(explode(",",chop($row[("grouping")],","))));
							$short_reason=implode(",",array_unique(explode(",",chop($row[("reason")],","))));
							$dept_name=implode(",",array_unique(explode(",",chop($row[("dept_name")],","))));
							$season_buyer=implode(",",array_unique(explode(",",chop($row[("season_buyer_wise")],","))));
							
							$cbo_company=$row[("company_id")];
							$print_report_format_ids=$print_report_format_arr[$cbo_company];
							$partial_print_report_format_ids=$partial_print_report_format_arr[$cbo_company];
							$woven_partial_print_report_format_ids=$woven_partial_print_report_format_arr[$cbo_company];
							$sample_req_non_print_report_format_ids=$sample_req_non_print_report_format_arr[$cbo_company];
							$sample_req_withorder_print_report_ids=$sample_req_booking_withorder_print_report_arr[$cbo_company];
							$sample_booking_without_print_report_ids=$sample_booking_non_print_report_format_arr[$cbo_company];
							$sample_booking_withorder_print_report_ids=$sample_booking_print_report_format_arr[$cbo_company];
							//echo $sample_req_non_print_report_format_ids.'-D-';
							$short_booking_print_report_ids=$print_short_report_format_arr[$cbo_company];
							//echo $short_booking_print_report_ids.'-D-';
							
							$short_format_ids=explode(",",$short_booking_print_report_ids);
							$short_format_first_print_button=array_shift($short_format_ids);
							
							$sample_req_format_ids=explode(",",$sample_req_withorder_print_report_ids);
							$samp_req_wo_first_print_button=array_shift($sample_req_format_ids);

							$sample_req_without_format_ids=explode(",",$sample_req_non_print_report_format_ids);
							$samp_req_without_wo_first_print_button=array_shift($sample_req_without_format_ids);
							
							
							$sample_req_with_print_ids=explode(",",$sample_req_withorder_print_report_ids);
							$samp_req_with_first_print_button=array_shift($sample_req_with_print_ids);
							//echo $sample_req_format_first_print_button.'DF';
							$sample_booking_without_print_ids=explode(",",$sample_booking_without_print_report_ids);
							$samp_booking_without_first_print_button=array_shift($sample_booking_without_print_ids);
							
							$sample_booking_with_print_ids=explode(",",$sample_booking_withorder_print_report_ids);
							$samp_booking_with_first_print_button=array_shift($sample_booking_with_print_ids);
							
							$partial_format_ids=explode(",",$partial_print_report_format_ids);
							$woven_partial_format_ids=explode(",",$woven_partial_print_report_format_ids);
							$part_first_print_button=array_shift($partial_format_ids);
							$woven_part_first_print_button=array_shift($woven_partial_format_ids);
							
							$format_ids=explode(",",$print_report_format_ids);
							$print_b_16="";
							foreach ($format_ids as $key => $button_id) {
								if($button_id==719)
								{
									$print_b_16=$button_id;
								}
							}
						
							$first_print_button=array_shift($format_ids);
							$second_print_button= array_shift($format_ids);
							if($cbo_category==2 || $cbo_category==3)
							{
								if($row["entry_form"]==118)
								{
									
									if($first_print_button==1)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report_gr";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										
										//part_first_print_button $row["entry_form"]
									}
									else if($first_print_button==2)
									{
										if($wo_typw_id==2)
										{
											$action_type="show_fabric_booking_report";
											$wo_typw_id=73;
										}
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##'  title='PB F1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." <a/>";			
									}
									else if($first_print_button==3)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report3";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##'  title='PB F2' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";	
									}
									else if($first_print_button==4)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report1";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##'  title='PFC F1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==5)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report2";
										else $action_type="show_fabric_booking_report";  
										$variable="<a href='##' title='PFC F2' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	    
									}
									else if($first_print_button==6)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report4";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##' title='FB F1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==7)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report5";
										else $action_type="show_fabric_booking_report"; 
										$variable="<a href='##' title='FB F2' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==28)
									{
										$action_type="show_fabric_booking_report_akh"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==45)
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==53)
									{
										$action_type="show_fabric_booking_report_jk";
										
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==93)
									{
										$action_type="show_fabric_booking_report_libas"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==786)
									{
										$action_type="show_fabric_booking_report25"; 
										$variable="<a href='##' title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==73)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_mf";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==193)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_print4";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==269)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_knit";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($second_print_button==73)
									{
										$action_type="show_fabric_booking_report_mf";  
										$variable="<a href='##'  title='PB MF' onClick=\"generate_fabric_report('".$second_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==849)
									{
										// part_first_print_button 
										$action_type="show_fabric_booking_report_bl1";  
										$variable="<a href='##'  title='Fabric Booking' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($first_print_button==719)
									{
										$action_type="show_fabric_booking_report16";  
										$variable="<a href='##'  title='B16' onClick=\"generate_fabric_report('".$first_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($second_print_button==719)
									{
										$action_type="show_fabric_booking_report16";  
										$variable="<a href='##'  title='B16' onClick=\"generate_fabric_report('".$second_print_button."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($print_b_16==719)
									{
										$action_type="show_fabric_booking_report16";  
										$variable="<a href='##'  title='B16' onClick=\"generate_fabric_report('".$print_b_16."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==140) //Sampe Req Fab Without Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition Fabric Booking -Without order";
									if($samp_req_without_wo_first_print_button==10)
									{
										$action_type="show_fabric_booking_report";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_without_wo_first_print_button==17)
									{
										$action_type="show_fabric_booking_report_barnali";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}else if($row["entry_form"]==203) //Sampe Req Fab Without Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition With Booking";
									if($samp_req_without_wo_first_print_button==109)
									{
										$action_type="sample_requisition_print";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(203,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_without_wo_first_print_button==111)
									{
										$action_type="sample_requisition_print6";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(203,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}else if($row["entry_form"]==142) //Sampe Req With Booking  
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition With Booking";
									if($samp_req_without_wo_first_print_button==110)
									{
										$action_type="sample_requisition_print";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_without_wo_first_print_button==109)
									{
										$action_type="sample_requisition_print1";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(140,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==139) //Sampe Req Fab With Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									// echo $samp_req_wo_first_print_button.'X';
									$page_name="Sample Requisition Fabric Booking -With order";
									if($samp_req_wo_first_print_button==155)
									{
										$action_type="show_fabric_booking_report";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(139,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($samp_req_wo_first_print_button==17)
									{
										$action_type="show_fabric_booking_report2";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(139,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==88) //Sampe Req Fab With Order
								{
									// $variable= $row[("booking_no_prefix_num")].' Wo Type='.$wo_typw_id; 
									//echo $short_format_first_print_button.'X';
									$page_name="Short Fabric Booking";
									if($short_format_first_print_button==136)
									{
										$action_type="print_booking_3";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==8)
									{
										$action_type="show_fabric_booking_report";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==9)
									{
										$action_type="show_fabric_booking_report3";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==244)
									{
										$action_type="show_fabric_booking_report_ntg";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($short_format_first_print_button==46)
									{
										$action_type="show_fabric_booking_report_urmi";  
										$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(88,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
								}
								else if($row["entry_form"]==86) //Main Fabric Booking
								{
									if($first_print_button==1)
									{
										if($wo_typw_id==2) $action_type="show_fabric_booking_report_gr"; else $action_type="show_fabric_booking_report"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}
									else if($first_print_button==73)
									{
										 $action_type="show_fabric_booking_report_b6"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
									else if($first_print_button==53)
									{
										 $action_type="show_fabric_booking_report_jk"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
									else if($first_print_button==45)//
									{
										 $action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
									else if($first_print_button==28)//show_fabric_booking_report_akh
									{
										 $action_type="show_fabric_booking_report_akh"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										//part_first_print_button $row["entry_form"]
									}	
								}
								else if($row["entry_form"]==271) //Woven Partial Fabric Booking
								{
									//$variable=$row[("booking_no_prefix_num")];
									//echo $woven_part_first_print_button.'D';
									
									if($part_first_print_button==160)
									{
										$action_type="print_booking_5";  
										$variable="<a href='##' title='PFC F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	    
									}
									else if($part_first_print_button==175)
									{
									   $action_type="print_booking_6";
										
										$variable="<a href='##' title='FB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($part_first_print_button==155)
									{
										$action_type="fabric_booking_report";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==160)
									{
										$action_type="print_booking_5";  
										$variable="<a href='##' title='PFC F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	
									}
									else if($woven_part_first_print_button==143)
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										
										//part_first_print_button $row["entry_form"]
									}
									else if($woven_part_first_print_button==84)
									{
										
										$action_type="show_fabric_booking_report_urmi_per_job";											
										$variable="<a href='##'  title='PB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." <a/>";			
									}
									else if($woven_part_first_print_button==85)
									{
										$action_type="print_booking_3";
										 
										$variable="<a href='##'  title='PB F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";	
									}
									else if($woven_part_first_print_button==151)
									{
										$action_type="show_fabric_booking_report_advance_attire_ltd";
										
										$variable="<a href='##'  title='PFC F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									
									else if($woven_part_first_print_button==175)
									{
									   $action_type="print_booking_6";
										
										$variable="<a href='##' title='FB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==155)
									{
										$action_type="fabric_booking_report";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==241)
									{
										$action_type="print_booking_11";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==274)
									{
										$action_type="print_booking_10";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==72)
									{
										$action_type="print6booking";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									else if($woven_part_first_print_button==428)
									{
										$action_type="print_booking_eg1";  
										$variable="<a href='##'  title='Woven partial' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									}
									/* else if($part_first_print_button==143)
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";			
										
										//part_first_print_button $row["entry_form"]
									}
									else if($part_first_print_button==84)
									{
										
										$action_type="show_fabric_booking_report_urmi_per_job";											
										$variable="<a href='##'  title='PB F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]." <a/>";			
									}
									else if($part_first_print_button==85)
									{
										$action_type="print_booking_3";
										 
										$variable="<a href='##'  title='PB F2' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";	
									}
									else if($part_first_print_button==151)
									{
										$action_type="show_fabric_booking_report_advance_attire_ltd";
										
										$variable="<a href='##'  title='PFC F1' onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
									} */
								} //Woven Partial Booking end
								else if($row["entry_form"]==108) // Partial Fabric Booking
								{
									if ($part_first_print_button==143) // print 1
									{
										$action_type="show_fabric_booking_report_urmi"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==84) // print 2
									{
										$action_type="show_fabric_booking_report_urmi_per_job"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==85) // print 3
									{
										$action_type="print_booking_3"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==151) // print 4
									{
										$action_type="show_fabric_booking_report_advance_attire_ltd"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==160) // print 5
									{
										$action_type="print_booking_5"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==175) // print 6
									{
										$action_type="print_booking_6"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==218) // print 7
									{
										$action_type="print_booking_7"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==220) // print 8
									{
										$action_type="print_booking_northern_new"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==235) // print 9
									{
										$action_type="print_booking_northern_9"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==274) // print 10
									{
										$action_type="print_booking_10"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==241) // print 11
									{
										$action_type="print_booking_11"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==269) // print 12
									{
										$action_type="print_booking_12"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==28) // print 13
									{
										$action_type="print_booking_13"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==280) // print 14
									{
										$action_type="print_booking_14"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==304) // print 15
									{
										$action_type="print_booking_15"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==719) // print 16
									{
										$action_type="print_booking_16"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==723) // print 17
									{
										$action_type="print_booking_17"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==339) // print 18
									{
										$action_type="print_booking_18"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==370) // print 19
									{
										$action_type="print_booking_19"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
									else if ($part_first_print_button==768) // print 20
									{
										$action_type="print_booking_20"; 
										$variable="<a  href='##'  onClick=\"generate_fabric_report(108,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','".$row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."  <a/>";
									}
								}
								else
								{
									if($row[("booking_type")]==4 && $row[("is_short")]=="")
									{  
										$page_name="Sample Fabric Booking Without order";
										// echo $samp_booking_without_first_print_button.'F'.$row[("is_short")].'<br>';
										if($sample_booking_without_print_ids[0]==64) //Metro
										{
											$action_type="show_fabric_booking_report5";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==37) //Akh
										{
											$action_type="show_fabric_booking_report4";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==36) //Amana
										{
											$action_type="show_fabric_booking_report3"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==34) //Print Booking
										{
											$action_type="show_fabric_booking_report"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==35) //Print Booking2
										{
											$action_type="show_fabric_booking_report2"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==72) //Print FFl
										{
											$action_type="show_fabric_booking_report6"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($sample_booking_without_print_ids[0]==174) //Print UG
										{
											$action_type="show_fabric_booking_report7"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(90,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
									}
									if($row[("booking_type")]==4 && $row[("is_short")]==2) //Sample Booking with order
									{  
										$page_name="Sample Fabric Booking With order";
										// echo $samp_booking_without_first_print_button.'F'.$row[("is_short")].'<br>';
										if($samp_booking_with_first_print_button==38) //Print Booking
										{
											$action_type="show_fabric_booking_report";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(89,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($samp_booking_without_first_print_button==39) //Print Booking2
										{
											$action_type="show_fabric_booking_report2";  
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(89,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($samp_booking_without_first_print_button==64) //Metro
										{
											$action_type="show_fabric_booking_report3"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report(89,'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no_prefix_num")]."<a/>";
										}
										else if($samp_booking_with_first_print_button==16) //Print Booking3
										{
										
											$action_type="show_fabric_booking_report_print_booking_3"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no")]."<a/>";
										}
										else if($samp_booking_with_first_print_button==177) //Print Booking4
										{
										
											$action_type="show_fabric_booking_report4"; 
											$variable="<a href='##'  title='$page_name' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','".$action_type."','".$i."')\">".$row[("booking_no")]."<a/>";
										}
										else $variable=$row[("booking_no")];
									}
								}
							} //Fabric Booking End	
							
							$pre_print_report_format_ids=$pre_print_report_format[$cbo_company];
							$pre_print_report_ids=explode(",",$pre_print_report_format_ids);
							$print_button_first=array_shift($pre_print_report_ids);

							if($print_button_first==751){$action='print_pi'; } 
							else if($print_button_first==86){$action='pi_mst';} 
							else if($print_button_first==116){$action='print_wf';} 
							else if($print_button_first==85){$action='print_sf';} 
							else if($print_button_first==89){$action='print_f';} 
				
							if($row[("fabric_source")]==2)
							{
								$rcv_date_arr=array_unique(explode(",",chop($receive_data[$row[("booking_id")]][$row[("type")]],",")));
								if($row[("booking_type")]==1 && $row[("is_short")]==2)
								{
									$summer_data[1]["book_qnty"]+=$row[("fin_fab_qnty")];
									
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[1]["rcv_qnty_intime"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[1]["rcv_qnty"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								else if($row[("booking_type")]==1 && $row[("is_short")]==1)
								{
									$summer_data[2]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[2]["rcv_qnty_intime"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[2]["rcv_qnty"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								else if($row[("booking_type")]==4 )
								{
									$summer_data[3]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[3]["rcv_qnty_intime"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[3]["rcv_qnty"]+=$receive_qnty_data[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
							}
							else if($row[("fabric_source")]==1)
							{
								$rcv_date_arr=array_unique(explode(",",chop($receive_data_pord[$row[("booking_id")]][$row[("type")]],",")));
								if($row[("booking_type")]==1 && $row[("is_short")]==2)
								{
									$summer_data[1]["book_qnty"]+=$row[("fin_fab_qnty")];
									
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[1]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[1]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								else if($row[("booking_type")]==1 && $row[("is_short")]==1)
								{
									$summer_data[2]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[2]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[2]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
								
								else if($row[("booking_type")]==4 )
								{
									$summer_data[3]["book_qnty"]+=$row[("fin_fab_qnty")];
									foreach($rcv_date_arr as $rcv_date)
									{
										if($rcv_date<=$row[("delivery_date")])
										{
											$summer_data[3]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
										}
										$summer_data[3]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
								}
							}
							else if($row[("fabric_source")]==4)
							{
								$summer_data[4]["book_qnty"]+=$row[("fin_fab_qnty")];
								foreach($rcv_date_arr as $rcv_date)
								{
									if($rcv_date<=$row[("delivery_date")])
									{
										$summer_data[4]["rcv_qnty_intime"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
									}
									$summer_data[4]["rcv_qnty"]+=$receive_qnty_data_prod[$row[("booking_id")]][$row[("type")]][$rcv_date];
								}
							}
							
							$supplier_name="";
							if($row[("pay_mode")]==3 || $row[("pay_mode")]==5)
							{
								$supplier_name=$company_library[$row[("supplier_id")]];
							}
							else $supplier_name=$supplierArr[$row[("supplier_id")]];
							$ready_to_approved=$row[("ready_to_approved")];
							if($ready_to_approved==1)
							{
							$last_update_date=$row[("update_date")];
							}
							
							//echo $variable;
							//<a href='#report_details' onClick="generate_fabric_booking_report('<? echo $row[("booking_no")];','show_trim_booking_report');"></a>
							if($row[("delivery_date")]!="" && $row[("delivery_date_dtls")]=="" )  $row[("delivery_date")]=$row[("delivery_date")];else  $row[("delivery_date")]=$row[("delivery_date")];
							$piWoNo="";$piWoIdNo="";
							?>
							
							<tr id="center" bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
								<td width="30"><? echo $i;?></td>
								<td width="100" align="center"><p><? echo $company_library[$row[("company_id")]]; ?></td>	
								<td width="60" align="center" title="Entry Form=<? echo $row["entry_form"];?>"><? echo $variable; ?><? //echo $row[("booking_no_prefix_num")];?></td>
                                <td width="70" align="center"><p><? echo $pay_mode[$row[("pay_mode")]]; ?></td>	
								

                                <?
								if ($cbo_category==2)
								{
									$pi_id=$pi_no_arr[$row[("booking_no")]]['pi_id'];
									?>
										<td width="100" align="center" title="<? echo 'Pi='.$pi_id.', Booking-'.$row[("booking_no")]; ?>"><p><? echo $pi_no_arr[$row[("booking_no")]]['pi_no']; ?></td>
									<? 
								}
								?>    
								 <?
								if ($cbo_category==3)
								{
								$piWoNo=implode(",",array_unique(array_filter(explode("__",$wopi_arr[$row["booking_no"]]))));
								$piWoIdNo=implode(",",array_unique(array_filter(explode("__",$wopiId_arr[$row["booking_no"]]))));
								?>
                                <td align="center" width="100" style="word-break:break-all"><a href="#report_details" onClick="booking_woven_report_generate('<?=$cbo_company; ?>','<?=$piWoIdNo;?>','3','<?=$action; ?>','166')"><?=$piWoNo;?>
									<? 
								}
								?>                              

								<td width="60" align="center"><p><? echo $row[("year_book")]; ?></td>
								<td width="70" align="center"><p><? echo change_date_format($row[("booking_date")]); ?>&nbsp;</p></td>
								<td width="70" align="center"><p><?  $update_date=explode(" ",$row[("update_date")]);echo change_date_format($update_date[0])//echo change_date_format($wo_last_date_arr[$row[("booking_id")]]); ?>&nbsp;</p></td>
								<td width="70" align="center"><p><? echo change_date_format($row[("delivery_date")]); ?>&nbsp;</p></td>
								<td width="70" align="center"><p><? echo change_date_format($row[("sup_rev_date")]); ?>&nbsp;</p></td>
								<td width="70" align="center"><p>
								<? 
								$lead_time=0;
								if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00")
								{
									$lead_time=datediff("d", $row[("booking_date")], $row[("delivery_date")]);
								}
								if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day";
								?></p></td>
								<td width="100"><p><? echo $wo_type;?></p></td>
                                
								<td width="100" align="center"><? echo $yes_no[$row[("ready_to_approved")]]; ?></td>
                              
								 <td width="100" align="center"><? $last_update_date=explode(" ",$last_update_date);echo change_date_format($last_update_date[0]).'&nbsp;<br>'.$last_update_date[1]; ?></td>
								
							 
								<td width="80"><p><? echo $approval_type_arr[$row[("is_approved")]]; ?></p></td>
                                <?
                                $approved_date=$last_app_arr[$row[("booking_id")]]['approved_date'];
								$approved_by=$last_app_arr[$row[("booking_id")]]['approved_by'];
								?>
                                 <td width="100" title="bookingId=<? echo $row[("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                                
                                 
								<td width="100" align="left"><p><? echo $supplier_name; ?></p></td>
								<td width="100" align="left"><p><? echo $buyerArr[$row[("buyer_id")]]; ?></p></td>
								<td width="70" align="left"><div style="word-wrap:break-word; width:70px"><? echo $job_no;//$row[("job_no_prefix_num")]; ?></div></td>
                              	 <td width="70" align="left"><p><? echo $season_buyer;//$row[("job_no_prefix_num")]; ?>&nbsp;</p></td>
								<td width="60" align="center"><? echo $job_year; ?></td>
                                
								<td width="150"><p><? if ($row[("type")]==0) echo $style_ref_no; else echo $nonStyleArr[$style_ref_no]; ?></p></td>
								<td width="100"><p><? echo $printButton.$ref; ?></p></td>
								<td width="100"><p><? echo $file; ?></p></td>
								<td width="150"><p><? echo $po_number; ?></p></td>
								<td width="100"><p>
								<?
								if ($row[("type")]==0)
								{
									echo "Max - ". $max_ship_date;
									$order_count=explode(",",$po_number);
									if(count($order_count)>1) echo "<br> Min  - " . $min_ship_date; 
								}
								?></p></td>
								<td width="80"><p><? echo $item_category[$row[("item_category")]]; ?></p></td>
								<? 
								if($cbo_category==3){
										?>
									<td width="150"><p><?
									foreach($job_list_arr as $val){
									echo implode(",",$finish_fab_type_arr[$val]).",";
									}?>
								</p></td>
								<?}
								
								 
								//booking_id
								$td_color="";
								if($row[("booking_type")]==2)
								{
									if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00" && $first_rec_date[$row[("booking_id")]]!="" && $first_rec_date[$row[("booking_id")]]!="0000-00-00")
									{
										if(strtotime($first_rec_date[$row[("booking_id")]])>strtotime($row[("delivery_date")])) $td_color='bgcolor="#FF0000"'; else $td_color='';
									}
									$first_rcv_date=change_date_format($first_rec_date[$row[("booking_id")]]);
								}
								else if($row[("booking_type")]==1 || $row[("booking_type")]==4)
								{
									if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00" && $first_rec_date_prod[$row[("booking_id")]]!="" && $first_rec_date_prod[$row[("booking_id")]]!="0000-00-00")
									{
										if(strtotime($first_rec_date_prod[$row[("booking_id")]])>strtotime($row[("delivery_date")])) $td_color='bgcolor="#FF0000"'; else $td_color='';
									}
									if ($cbo_category==3) //Woven Fabric
									{
										//echo $first_rec_date[$pi_id].'==AA'.$pi_id;
										$first_rcv_date=change_date_format($first_rec_date[$row[("booking_id")]]);
									}
									else
									{
									$first_rcv_date=change_date_format($first_rec_date_prod[$row[("booking_id")]]);
									}
								}
								 //echo $row[("booking_type")]."***".$row[("type")] ;
								?>
								<td width="70" title="<? echo "Booking No : ".$booking_data[$row[("booking_id")]]["booking_no"].",\nBooking Type:".$row[("booking_type")]."\nFirst Receive No:".$first_rec_no[$row[("booking_id")]];  ?>" align="center" <? echo $td_color; ?> ><p><? echo $first_rcv_date; ?>&nbsp;</p></td>
								<?
								if ($cbo_category==4)
								{
									?>
										<td width="100" align="right"><? echo number_format($row[("amount")],2,'.',''); ?></td>
									<?
								}
								else
								{
									?>
										<td width="100" align="right"><? echo number_format($row[("fin_fab_qnty")],2); ?></td>
										<?
										if ($cbo_category==3) 
										{
											$tot_grey_fab_qnty+=$row[("amount")];

											$usd_id=2;
											if($db_type==0) $conversion_date=change_date_format($row[("booking_date")], "Y-m-d", "-",1);
											else $conversion_date=change_date_format($row[("booking_date")], "d-M-y", "-",1);
											$currency_rate=set_conversion_rate($usd_id,$conversion_date );
											
											$finish_issue_usd_amt=$row[("finish_issue_amount")]/$currency_rate;
											?>
											<td width="100" align="right"><? echo number_format($row[("amount")],2,'.',''); ?></td>
											<td width="100" align="right"><a href="#report_details" onClick="fncfabricrcvissue('fabric_receive_popup','<?= $row[("booking_id")]; ?>','850px');"><? echo number_format($row[("finish_rcv_qty")],2,'.',''); ?></a></td>
											<td width="100" align="right"><? echo number_format($row[("finish_rcv_amount")],2,'.',''); ?> </td>
											<td width="100" align="right"><a href="#report_details" onClick="fncfabricrcvissue('fabric_issue_popup','<?= $row[("booking_id")]; ?>','850px');"><? echo number_format($row[("finish_issue_qty")],2,'.',''); ?></a></td>
											<td width="100" align="right" title="usd=<?=$currency_rate."amt=".$row[("finish_issue_amount")];?>"><? echo number_format($finish_issue_usd_amt,2,'.',''); ?> </td>
											<td width="100" align="right"><? echo number_format($row[("finish_rcv_qty")]-$row[("finish_issue_qty")],2,'.',''); ?> </td>
											<td width="100" align="right"><? echo number_format($row[("finish_rcv_amount")]-$finish_issue_usd_amt,2,'.',''); ?> </td>
											<?
											$tot_fab_qnty+=$row[("fin_fab_qnty")];
											$tot_finish_fab_issue_qty+=$row[("finish_issue_qty")];
											$tot_finish_fab_issue_amount+=$finish_issue_usd_amt;
											$tot_finish_fab_rcv_amount+=$row[("finish_rcv_amount")];
											$tot_finish_fab_rcv_qty+=$row[("finish_rcv_qty")];
											$tot_finish_val_bal+=$row[("finish_rcv_amount")]-$finish_issue_usd_amt;
											$tot_finish_qty_bal+=$row[("finish_rcv_qty")]-$row[("finish_issue_qty")];
										}
										else
										{
											$tot_grey_fab_qnty+=$row[("grey_fab_qnty")];
											?>
											<td width="100" align="right"><? echo number_format($row[("grey_fab_qnty")],2); ?></td>
											<?
										}
								}
								if($cbo_category==2)
								{
									?>
									<td width="80"><p><? echo number_format($sample_qnt,2); ?></p></td>
									<td width="80"><p><? echo $dept_name; ?></p></td>
									<td width="80"><p><? echo $short_reason; ?></p></td>
									<?
								}
								?>
								<td width="100">&nbsp;&nbsp;&nbsp;&nbsp;<? //echo $row[("po_number")]; ?></td>
							</tr>
							<?
							$tot_wo_qnty+=$row[("amount")];
							$tot_fin_fab_qnty+=$row[("fin_fab_qnty")];
							
							$i++;
						
						}
					}
					else
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$print_report_format_ids=$print_report_format_arr[$cbo_company];
						$format_ids=explode(",",$print_report_format_ids);
					
						$first_print_button=array_shift($format_ids);
						$second_print_button= array_shift($format_ids);
						if ($row[("type")]==0)
						{	
							if ($row[("booking_type")]==1 || $row[("booking_type")]==2  || $row[("booking_type")]==3  || $row[("booking_type")]==6)
							{
								if ($row[("is_short")]==1)
								{
									$wo_type="Short";
									$wo_typw_id=1;
								}
								else
								{
									$wo_type="Main";
									$wo_typw_id=2;
								}
							}
							elseif($row[("booking_type")]==4)
							{
								$wo_type="Sample With Order";
								$wo_typw_id=3;
							}
						}
						else
						{
							$wo_type="Sample Non Order";
							$wo_typw_id=4;
						}
						$ready_to_approved=$row[("ready_to_approved")];
						if($ready_to_approved==1)
						{
						$last_update_date=$row[("update_date")];
						}
						// echo $wo_typw_id.'ssd';
						$job_no=$style_ref_no=$po_number=$file=$ref=$job_number="";
						$p=1;
						$ship_date_arr=array_unique(explode(",",chop($row[("pub_shipment_date")],",")));
						foreach($ship_date_arr as $ship_date)
						{
							if($p==1)
							{
								$min_ship_date=$ship_date;
								$max_ship_date=$ship_date;
							}
							
							if($min_ship_date>$ship_date) $min_ship_date=$ship_date;
							if($max_ship_date<$ship_date) $max_ship_date=$ship_date;
							$p++;
						}
						
						$all_po_id=implode(",",array_unique(explode(",",chop($row[("po_break_down_id")],","))));
						$job_no=implode(",",array_unique(explode(",",chop($row[("job_no_prefix_num")],","))));
						$season_buyer=implode(",",array_unique(explode(",",chop($row[("season_buyer_wise")],","))));
						//echo $season_buyer.'DDDD';
						$job_number=implode(",",array_unique(explode(",",chop($row[("job_no")],","))));
						$job_list_arr=array_unique(explode(",",chop($row[("job_no")],",")));
						$style_ref_no=implode(",",array_unique(explode(",",chop($row[("style_ref_no")],","))));
						$po_number=implode(", ",array_unique(explode(",",chop($row[("po_number")],","))));
						$file=implode(",",array_unique(explode(",",chop($row[("file_no")],","))));
						$ref=implode(",",array_unique(explode(",",chop($row[("grouping")],","))));
						$short_reason=implode(",",array_unique(explode(",",chop($row[("reason")],","))));
						$dept_name=implode(",",array_unique(explode(",",chop($row[("dept_name")],","))));
					    $job_year=implode(",",array_unique(explode(",",chop($row[("job_year")],","))));
					    $cbo_company=$row[("company_id")];
						$print_report_format_ids=$print_report_format_arr[$cbo_company];
						$format_ids=explode(",",$print_report_format_ids);
						$first_print_button=array_shift($format_ids);
						$second_print_button= array_shift($format_ids);
						//echo $cbo_company.'='.$first_print_button;

						$knit_print_report_format_ids=$knit_print_report_format_arr[$cbo_company];
						$knit_format_ids=explode(",",$knit_print_report_format_ids);
						$knit_first_print_button=array_shift($knit_format_ids);

						/* $dyeing_print_report_format_ids=$print_report_format_multi_dyeing[$cbo_company];
						$dyeing_format_ids=explode(",",$dyeing_print_report_format_ids);
						$dyeing_first_print_button=array_shift($dyeing_format_ids); */
						//echo $cbo_company.'='.$dyeing_first_print_button;
						
						$trim_format_ids=explode(",",$trim_print_report_format_arr[$cbo_company]);
						$trim_format_ids2=explode(",",$trim_print_report_format_arr2[$cbo_company]);
						$trim_first_print_button=array_shift($trim_format_ids);
						$trim_format_ids3=explode(",",$trim_print_report_format_arr3[$cbo_company]);
						$trim_woven_button= array_shift($trim_format_ids3);
							//$trim_second_print_button= array_shift($trim_format_ids2);
						if($cbo_category==4) //Accessories Start
						{
							//echo $trim_woven_button.$row["entry_form"].'kk';
							//echo $first_print_button.$row["entry_form"].'kk';
							if($trim_woven_button==67 && $row["entry_form"]==272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_woven_button==183 && $row["entry_form"]==272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_woven_button==177 && $row["entry_form"]==272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_woven_button==175 && $row["entry_form"]==272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_woven_button==235 && $row["entry_form"]==272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report9','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_woven_button==85 && $row["entry_form"]==272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print_t','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_woven_button==746 && $row["entry_form"]==272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print_t7','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_woven_button==774 && $row["entry_form"]==272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report_wg','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($trim_woven_button==14 && $row["entry_form"]==272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report16','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($first_print_button==13 && $row["entry_form"]==262)
							{ 
							//echo $first_print_button.$row["entry_form"].'kk';
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row["entry_form"]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($first_print_button==13 && $row["entry_form"]!=272 && $row["entry_form"]!=262)
							{ 
								$variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";
							}
							if($first_print_button==14 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==15 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==16 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==17 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==18 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==19 && $row["entry_form"]!=272)
							{ 
								$variable="<a href='##'  onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
								if($trim_woven_button[0]==67 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==183 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==177 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==175 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==235 && $row["entry_form"]=492)
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report9','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==85 && $row["entry_form"]=492 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print_t','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button[0]==786 && $row["entry_form"]=492 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print_t7','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($trim_woven_button==774 && $row["entry_form"]=492 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report_wg','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
							
							$print_report_format_ids26=$print_report_format_arr26[$cbo_company];
							$format_ids26=explode(",",$print_report_format_ids26);
							//echo $format_ids26[0].'D'. $row[("entry_form")];
							if($format_ids26[0]==67 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==746 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report7','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==183 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==177 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report9','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==209 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==85 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report8','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==235 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==174 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report7','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							if($format_ids26[0]==274 && $row["entry_form"]==87)
							{ 
								$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report10','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
							}
							else if( $row["entry_form"]==272 && $variable==$row[("booking_no_prefix_num")] )
							{
								if($format_ids26[0]==67 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==183 )
								{ 
									$variable="<a href='##' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==177 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==209 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','print_t','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==85 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report8','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==235 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==174 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report7','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
								if($format_ids26[0]==274 )
								{ 
									$variable="<a href='##' title='Woven' onClick=\"generate_fabric_report(".$row[("entry_form")].",'".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report10','".$i.",2')\"> ".$row[("booking_no_prefix_num")]." </a>";	
								}
							}
							//else $variable=$row[("booking_no")];
						}
						else if($cbo_category==25)
						{
							
							if($row[("entry_form")]==201)
							{
							$variable="<a href='##' title='Print Actual' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."','".$row[("supplier_id")]."')\" >".$row[("booking_no_prefix_num")]." </a>"; //actual print
							}
							else
							{
								$variable="<a href='##' title='Print Actual' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."','".$row[("supplier_id")]."')\" >".$row[("booking_no_prefix_num")]." </a>";
							}
						}
						else if($cbo_category==12) //Service Fab. Booking...
						{
							
							$format_ids_aop=explode(",",$print_report_format_aop);
							$first_print_button_aop=array_shift($format_ids_aop);
							$format_ids_multi_dyeing=explode(",",$print_report_format_multi_dyeing);
							$first_print_button_multi_dyeing=array_shift($format_ids_multi_dyeing);
							//echo $first_print_button_multi_dyeing.'=='.$row[("entry_form")].',';
							
								if($first_print_button_multi_dyeing==8)
								{ 
									$variable="<a href='##' title='MSD' onClick=\"generate_fabric_report('".$first_print_button_multi_dyeing."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";  
								}
								if($first_print_button_multi_dyeing==163)
								{ 
									$variable="<a href='##' title='MSD' onClick=\"generate_fabric_report('".$first_print_button_multi_dyeing."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";  
								}
								if($first_print_button_multi_dyeing==164)
								{ 
									$variable="<a href='##' title='MSD' onClick=\"generate_fabric_report('".$first_print_button_multi_dyeing."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";  
								}
								if($first_print_button_multi_dyeing==209)
								{ 
									$variable="<a href='##' title='MSD' onClick=\"generate_fabric_report('".$first_print_button_multi_dyeing."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";  
								}
								if($first_print_button_multi_dyeing==177)
								{ 
									$variable="<a href='##' title='MSD' onClick=\"generate_fabric_report('".$first_print_button_multi_dyeing."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";  
								}
								if($first_print_button_multi_dyeing==129)
								{ 
									$variable="<a href='##' title='MSD' onClick=\"generate_fabric_report('".$first_print_button_multi_dyeing."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";  
								}
								if($first_print_button_multi_dyeing==161)
								{ 
									$variable="<a href='##' title='MSD' onClick=\"generate_fabric_report('".$first_print_button_multi_dyeing."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report6','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";  
								}
								if($first_print_button_multi_dyeing==191)
								{ 
									$variable="<a href='##' title='MSD' onClick=\"generate_fabric_report('".$first_print_button_multi_dyeing."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report7','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";  
								}
								if($first_print_button_multi_dyeing==220)
								{ 
									$variable="<a href='##' title='MSD' onClick=\"generate_fabric_report('".$first_print_button_multi_dyeing."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report8','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";  
								}
								if($first_print_button_multi_dyeing==93)
								{ 
									$variable="<a href='##' title='MSD' onClick=\"generate_fabric_report('".$first_print_button_multi_dyeing."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report9','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";  
								}

							if($first_print_button==11)
							{ 
							 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==12)
							{ 
							 $variable="<a href='##' title='PB1' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button==59)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$wo_typw_id."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button_aop==164)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							/* if($first_print_button_aop==163)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report1','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							} */
							if($first_print_button_aop==16)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report3','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button_aop==177)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report4','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button_aop==288)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report5','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($first_print_button_aop==176)
							{ 
							 $variable="<a href='##' title='BPKW' onClick=\"generate_fabric_report('".$first_print_button_aop."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_trim_booking_report6','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
							}
							if($row[("entry_form")]==228) //Multi Job Wise service Booking Knitting
							{
								if($knit_first_print_button==13)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==15)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report2','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==16)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report3','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==177)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report4','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==175)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report5','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button==176)
								{ 
								 $variable="<a href='##' title='MKSB' onClick=\"generate_fabric_report('".$row[("entry_form")]."','".$row[("booking_no")]."','".$cbo_company."','".$all_po_id."','".$cbo_category."','".$row[("fabric_source")]."','".$job_number."','". $row[("is_approved")]."','".$cbo_category."','".$row[("is_short")]."','".$emb_item_array[$job_number]['emb_name']."','".$emb_item_array[$job_number]['item_number_id']."','show_service_booking_report6','".$i."')\">".$row[("booking_no_prefix_num")]." </a>";	  
								}
								if($knit_first_print_button=='')
								{ 
								 $variable=$row[("booking_no_prefix_num")];
								}								
							}						
						}	
						
						$pre_print_report_format_ids=$pre_print_report_format[$cbo_company];
						$pre_print_report_ids=explode(",",$pre_print_report_format_ids);
						$print_button_first=array_shift($pre_print_report_ids);

						if($print_button_first==751){$action='print_pi'; } 
						else if($print_button_first==86){$action='pi_mst';} 
						else if($print_button_first==116){$action='print_wf';} 
						else if($print_button_first==85){$action='print_sf';} 
						else if($print_button_first==89){$action='print_f';} 
						
						//$conversion_cost_head_array
						$process_id_all=array_unique(explode(",",chop($row[("process")],",")));
						$all_process="";
						foreach($process_id_all as $process_id)
						{
							$all_process.=$conversion_cost_head_array[$process_id].",";
						}
						$all_process=chop($all_process,",");
						
						$supplier_name="";
						if($row[("pay_mode")]==3 || $row[("pay_mode")]==5)
						{
							$supplier_name=$company_library[$row[("supplier_id")]];
						}
						else $supplier_name=$supplierArr[$row[("supplier_id")]];
						//echo $row[("currency_id")];.// $row[("booking_date")]
						if($row[("booking_type")]==2  && $row[("entry_form")]==43 )  $row[("delivery_date")]=$row[("delivery_date_dtls")];else  $row[("delivery_date")]=$row[("delivery_date")];
						
						$piWoNo="";$piWoIdNo="";
						?>
						<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
							<td width="30"><? echo $i;?></td>
							<td width="100" align="center"><p><? echo $company_library[$cbo_company]; ?></td>
							<td width="60" align="center" title="<?=$row['entry_form']?>"><? echo $variable; ?><? //echo $row[("booking_no_prefix_num")];?></td>
                            <td width="70" align="center"><p><? echo $pay_mode[$row[("pay_mode")]]; ?></td>						
                            <?
							if($cbo_category==12)
							{?>
								<td width="100" align="center" title="<? echo 'Pi='.$pi_id.', Booking-'.$row[("booking_no")]; ?>"><p><? echo $pi_no_arr[$row[("booking_no")]]['pi_no']; ?></td>
                                <td width="100"><p><? echo $all_process; ?>&nbsp;</p></td>
                                <?
							}
							else if($cbo_category==4)
							{
								$piWoNo=implode(",",array_unique(array_filter(explode("__",$wopi_arr[$row["booking_no"]]))));
								$piWoIdNo=implode(",",array_unique(array_filter(explode("__",$wopiId_arr[$row["booking_no"]]))));
								?>
                                <td width="100" style="word-break:break-all"><a href="#report_details" onClick="booking_report_generate('<?=$cbo_company; ?>','<?=$piWoIdNo;?>','4','<?=$action; ?>','167')"><?=$piWoNo;?>
							</a>&nbsp; </td>
                                <?
							}else if($cbo_category==25)
							{
								?>
                                <td width="100" style="word-break:break-all"><? echo $pi_no_arr[$row[("booking_no")]]['pi_no']; ?>&nbsp;</td>
                                <?
							}
							?>
							
						
						
						<!-- </td> -->
							<td width="60" align="center"><p><? echo $row[("year_book")]; ?>&nbsp;</p></td>
                            <td width="70" align="center"><? echo change_date_format($row[("booking_date")]);?>&nbsp;</td>	
							<td width="70" align="center"><p><? echo change_date_format($row[("update_date")]); ?>&nbsp;</p></td>
							<td width="70" align="center"><p><? echo change_date_format($row[("delivery_date")]); ?>&nbsp;</p></td>
							<td width="70" align="center"><p><? echo change_date_format($row[("sup_rev_date")]); ?>&nbsp;</p></td>
							
							<td width="70" align="center"><p>
							<?
							$lead_time=0;
							if($row[("delivery_date")]!="" && $row[("delivery_date")]!="0000-00-00")
							{
								$lead_time=datediff("d", $row[("booking_date")], $row[("delivery_date")]);
							}
							if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day";
							?>&nbsp;</p></td>
							<td width="100"><p><? echo $wo_type;?>&nbsp;</p></td>
							<td width="100" title="MSg=<? echo $row[("ready_to_approved")];?>" align="center"><? echo $yes_no[$row[("ready_to_approved")]]; ?></td>
                              <?
							//if ($cbo_category==4)
							//{
								?>
                             <td width="100" align="center"><? $last_update_date=explode(" ",$last_update_date);echo change_date_format($last_update_date[0]).'&nbsp;<br>'.$last_update_date[1]; ?></td>
                             <?
							//}
							 ?>
							<td width="80"><p><? echo $approval_type_arr[$row[("is_approved")]]; ?>&nbsp;</p></td>
                             <?
							//if ($cbo_category==4)
							//{
								$approved_date=$last_app_arr[$row[("booking_id")]]['approved_date'];
								$approved_by=$last_app_arr[$row[("booking_id")]]['approved_by'];
								?>
                             <td width="100" title="bookingId=<? echo $row[("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                              <?
							//}
							 ?>
							<td width="100" align="left"><p><? echo $supplier_name; ?>&nbsp;</p></td>
							<td width="100" align="left"><p><? echo $buyerArr[$row[("buyer_id")]]; ?>&nbsp;</p></td>
							<td width="70" align="left"><p><div style="word-wrap:break-word; width:70px"><? echo $job_no;//$row[("job_no_prefix_num")]; ?></div>&nbsp;</p></td>
                            <td width="70"><p><? echo $season_buyer;//$row[("job_no_prefix_num")]; ?>&nbsp;</p></td>
							<td width="60" align="center"><? echo $job_year;// $year; ?></td>
							<td width="150"><p><? if ($row[("type")]==0) echo $style_ref_no; else echo $nonStyleArr[$style_ref_no]; ?>&nbsp;</p></td>
							<td width="100"><p><? echo $ref; ?>&nbsp;</p></td>
							<td width="100"><p><? echo $file; ?>&nbsp;</p></td>
							<td width="150"><p><? echo $po_number; ?>&nbsp;</p></td>
							<td width="100"><p>
							<?
							if ($row[("type")]==0)
							{
								echo "Max - ". $max_ship_date;
								$order_count=explode(",",$po_number);
								if(count($order_count)>1) echo "<br> Min  - " . $min_ship_date; 
							}
							?>&nbsp;</p></td>
							<td width="80"><p><? echo $item_category[$row[("item_category")]]; ?>&nbsp;</p></td>

							<? 
								if($cbo_category==4){
										?>
									<td width="400"><p><?
									foreach($job_list_arr as $val){
									echo implode(",",$trims_type_arr[$val]).",";
									}?>
								</p></td>
								<?}
								
							//booking_id
							$td_color="";
							
							if(strtotime($first_rec_date[$row[("booking_id")]])>strtotime($row[("delivery_date")])) $td_color='bgcolor="#FF0000"'; else $td_color='';
							$first_rcv_date=change_date_format($first_rec_date[$row[("booking_id")]]);
							
							 //echo $row[("booking_type")]."***".$row[("type")] ;
							?>
							<td width="70" title="<? echo "Booking No : ".$booking_data[$row[("booking_id")]]["booking_no"]."\nFirst Receive No:".$first_rec_no[$row[("booking_id")]]; ?>" align="center" <? echo $td_color; ?> ><p><? echo $first_rcv_date;  ?>&nbsp;</p></td>
							<?
								if ($cbo_category==4)
								{
									$usd_id=2;
									if($db_type==0) $conversion_date=change_date_format($row[("booking_date")], "Y-m-d", "-",1);
									else $conversion_date=change_date_format($row[("booking_date")], "d-M-y", "-",1);
									$currency_rate=set_conversion_rate($usd_id,$conversion_date );
									if($row[("currency_id")]==2) $wo_currency_usd_amt=$row[("amount")];//USD
									else $wo_currency_usd_amt=$row[("amount")]/$currency_rate;
									$rec_amt=0;
									$rec_amt=$rec_amt_arr[$row["booking_id"]];
									$rec_currency=$rec_currency_arr[$row["booking_id"]];
									//echo $rec_currency.'GG';
									$rec_date=$first_rec_date[$row["booking_id"]];
									if($rec_currency==2) $recv_usd_amt=$rec_amt;//USD
									else $recv_usd_amt=$rec_amt/$currency_rate;
									//$issue_usd_amt=($row[("trims_issue_qty")])/$currency_rate;
									$issue_usd_amt=$row[("trims_issue_qty")];
									?>
										
                                        <td width="100" align="right" title="Exchange Rate=<? echo $currency_rate;?>"><? echo number_format($wo_currency_usd_amt,2,'.',''); ?></td>										
                                        <td width="100" align="right"><a href="#report_details" onClick="fncfabricrcvissue('trims_receive_popup','<?= $row[("booking_id")].'_'.$currency_rate; ?>','850px');"><? echo number_format($recv_usd_amt,2,'.',''); ?></a></td>
										<td width="100" align="right"><a href="#report_details" onClick="fncfabricrcvissue('trims_issue_popup','<?= $row[("booking_id")].'_'.$currency_rate; ?>','850px');"><? echo number_format($issue_usd_amt,2,'.',''); ?></a></td>
										<td width="100" align="right"><? echo number_format($recv_usd_amt-$issue_usd_amt,2,'.',''); ?></td>
									<?

										$tot_issue_usd_amt+=$issue_usd_amt;
										$tot_bal_usd_amt+=$recv_usd_amt-$issue_usd_amt;
								}
								else
								{
									$currency_id=$row[("currency_id")];
									if($cbo_category==25 && $currency_id==1)
									{	
									$cid=2;
									$ex_rate=set_conversion_rate($cid, $row[("booking_date")],$cbo_company);
									$wo_amount=$row[("amount")]/$ex_rate;
									} else $wo_amount=$row[("amount")];
									?>
										
                                        <?
                                        if($cbo_category==25)
										{
										?>
										<td width="100" align="right" title="<? echo $ex_rate;?>"><?  echo number_format($wo_amount,2); ?></td>
									<?
										}
										else
										{ ?>
											<td width="100" align="right"><? if ($cbo_category==25 || $cbo_category==12) echo number_format($row[("wo_qnty")],2); else echo number_format($row[("grey_fab_qnty")],2); ?></td>
									<?	} ?>
									<td width="100" align="right"><? if ($cbo_category==25 || $cbo_category==12 ) echo number_format($row[("wo_qnty")],2); else echo number_format($row[("fin_fab_qnty")],2); ?></td>
									<?
								}
								if ($cbo_category==2)
								{
									?>
									<td width="80"><p><?=number_format($sample_qnt,2)?></p></td>
									<td width="80"><p>&nbsp; </p></td>
									<td width="80"><p><? echo $short_reason; ?></p></td>
									<?
								}
							?>
							<td width="100">&nbsp;&nbsp;&nbsp;&nbsp;<? //echo $row[("po_number")]; ?></td>
						</tr>
						<?
						$tot_wo_qnty+=$row[("amount")];
						$tot_rec_amt+=$rec_amt;
						
						$tot_wo_currency_usd_amt+=$wo_currency_usd_amt;
						$tot_recv_usd_amt+=$recv_usd_amt;
						
						if ($cbo_category==25 || $cbo_category==12)//Embllishment
						{
							$tot_fin_fab_qnty+=$row[("wo_qnty")];
							$tot_grey_fab_qnty+=$row[("wo_qnty")];
							$tot_embl_wo_amount+=$wo_amount;
						}
						else
						{
							$tot_fin_fab_qnty+=$row[("fin_fab_qnty")];
							$tot_grey_fab_qnty+=$row[("grey_fab_qnty")];
							$tot_embl_wo_amount+=$wo_amount;
						}
						$i++;
					}
				}
				?>
				</table>
				<table class="rpt_table" width="<? echo $tbl_width; ?>" cellpadding="0" cellspacing="0" border="1" rules="all">
					<tfoot>
						
						<th width="30">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="60">&nbsp;</th>
                        <th width="70">&nbsp;</th>
                        <?
                        if ($cbo_category==3 || $cbo_category==2 || $cbo_category==25 || $cbo_category==4)
						{
							?>
                            <th width="100">&nbsp;</th>
                            <?
						}
						if ($cbo_category==12)
						{
							?>
							 <th width="100">&nbsp;</th>
                            <th width="100">&nbsp;</th>
                            <?
						}?>
						<th width="60">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="70">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="70">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="70"></th>
						<th width="60">&nbsp;</th>
						<th width="150">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="150">&nbsp;</th>
                        <th width="100">&nbsp;</th>					
						<th width="80">&nbsp;</th>
						<?  if ($cbo_category==4){ ?>
							<th width="400">&nbsp;</th>
						<? } ?>
						<?  if ($cbo_category==3){ ?>
							<th width="150">&nbsp;</th>
						<? } ?>
						<th width="70">Total</th>
						
						
						<?
							if ($cbo_category==4)
							{
								?>
									
                                    <th width="100" align="right" id=""><? echo number_format($tot_wo_currency_usd_amt,2,'.',''); ?></th>
                               
                                    <th width="100" align="right" id=""><? echo number_format($tot_recv_usd_amt,2,'.',''); ?></th>
									
								<?
							}
							else
							{							
								?>
									<th width="100" align="right"><? //echo number_format($tot_fin_fab_qnty,2); ?></th>
										<th width="100" align="right"><? if($cbo_category==25){echo " ";}else{echo number_format($tot_fin_fab_qnty,2);} ?></th>
                                    <?
                                    if ($cbo_category==25)//Emblishment 
									{
									?>
									<th width="110" align="right" ><? echo number_format($tot_embl_wo_amount,2); ?></th>
									<?
									}
									if($cbo_category==3)
									{ ?>


										<th width="100" align="right"><? echo $tot_finish_fab_rcv_qty//number_format($tot_finish_fab_rcv_qty,2,'.',''); ?></th>
										<th width="100" align="right" >
										<!-- id="total_fin_rcv_val" -->
										<? echo number_format($tot_finish_fab_rcv_amount,2,'.',''); ?></th>
										<th width="100" align="right" ><? echo number_format($tot_finish_fab_issue_qty,2); ?></th>
										<th width="100" align="right" >
										<? echo number_format($tot_finish_fab_issue_amount,2,'.',''); ?></th>
										<th width="100" align="right"><? echo number_format($tot_finish_qty_bal,2,'.',''); ?></th>
										<th width="100" align="right" >
										<!-- id="total_fin_bal_val" -->
											<? echo number_format($tot_finish_val_bal,2,'.',''); ?></th>
										
									<? }else{?>
										<th width="100" align="right" ><? echo number_format($tot_grey_fab_qnty,2); ?></th>
									<?}

							}
							if($cbo_category==2)//Knit Fab
							{
								?>    
								<th width="80" > <?=number_format($tot_sample,2);?></th>
								<th width="90">&nbsp;</th>
								<th width="80">&nbsp;</th>
								<?
							}
							
							
						?>
						<?  if ($cbo_category==4){ ?>
							<th width="100" align="right" id=""><? echo number_format($tot_issue_usd_amt,2,'.',''); ?></th>
							<th width="100" align="right" id=""><? echo number_format($tot_bal_usd_amt,2,'.',''); ?></th>
					<? } ?>
						<th width="100">&nbsp;&nbsp;&nbsp;&nbsp;</th>
					</tfoot>
				</table>
			</div>
            <br>
            <?
			
			if ($cbo_category==2)
			{
				?>
                <table class="rpt_table" width="600" cellpadding="0" cellspacing="0" border="1" rules="all">
                	<thead>
                    	<tr bgcolor="#CCCCCC">
                                <td colspan="6" align="center" style="font-size:16px; font-weight:bold;">Finish Fabric OTD Summary</td>
                            </tr>
                    	<tr>
                        	<th width="100">WO Type</th>
                            <th width="100">Required Qty.</th>
                            <th width="100">On Time Rcvd Qty</th>
                            <th width="100">Total Rcvd Qty</th>
                            <th width="100">Balance</th>
                            <th >OTD %</th>
                        </tr>
                    </thead>
                    <tbody>
                    	<?
						$wo_type_arr=array(1=>"Main",2=>"Short",3=>"Sample",4=>"Non Ord Sample");
						foreach($summer_data as $wo_type=>$val)
						{
							$balance=$val["book_qnty"]-$val["rcv_qnty"];
							$otd_percent=(($val["rcv_qnty_intime"]/$val["book_qnty"])*100);
							?>
                            <tr>
                                <td><? echo $wo_type_arr[$wo_type]; ?></td>
                                <td align="right"><? echo number_format($val["book_qnty"],2); $tot_book_qnty+=$val["book_qnty"]; ?></td>
                                <td align="right"><? echo number_format($val["rcv_qnty_intime"],2); $tot_rcv_qnty_intime+=$val["rcv_qnty_intime"];  ?></td>
                                <td align="right"><? echo number_format($val["rcv_qnty"],2); $tot_rcv_qnty+=$val["rcv_qnty"];  ?></td>
                                <td align="right"><? echo number_format($balance,2); $tot_balance+=$balance;  ?></td>
                                <td align="right"><? echo number_format($otd_percent,2); ?></td>
                            </tr>
                            <?
						}
						?>
                    </tbody>
                    <tfoot>
                    	<tr>
                        	<th>Total</th>
                            <th><? echo number_format($tot_book_qnty,2); ?></th>
                            <th><? echo number_format($tot_rcv_qnty_intime,2); ?></th>
                            <th><? echo number_format($tot_rcv_qnty,2); ?></th>
                            <th><? echo number_format($tot_balance,2); ?></th>
                            <th>&nbsp;</th>
                        </tr>
                    </tfoot>
                </table>
                <?
			}
			?>
		</fieldset>
		<?
	}
	else if ($cbo_category==24)// Service Yarn
	{
		if($db_type==0)
		{
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and YEAR(a.insert_date)=$year_id";
		}
		elseif($db_type==2)
		{ 
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(a.insert_date,'YYYY')=$year_id";
		}
		
		if ($cbo_company==0) $company_id=""; else $company_id=" and a.company_id=$cbo_company";
		if ($cbo_buyer==0) $supplier_cond=""; else $supplier_cond=" and a.supplier_id=$cbo_buyer";
		if ($cbo_category==0) $category_id=""; else $category_id=" and a.item_category=$cbo_category";
		if ($wo_no=="") $wo_no_cond=""; else $wo_no_cond=" and a.ydw_no='$wo_no'";
		
		if ($wo_type==2) $wo_type_cond=" and a.entry_form=41"; else if ($wo_type==4) $wo_type_cond=" and a.entry_form=42"; else $wo_type_cond="";
		
		if ($job_no=="") $job_num=""; else $job_num=" and b.job_no='$job_no'";
		//if ($job_no=="") $job_num_mst=""; else $job_num_mst=" and b.job_no_mst=$job_no";
		if ($po_no=='') $po_no_no=""; else $po_no_no=" and d.po_number in ($po_no)";
		if ($hidd_po=="") $po_id=""; else $po_id=" and d.id in ( $hidd_po )";
		
		if ($hidd_po=="") $po_id_cond=""; else $po_id_cond=" and b.po_break_down_id in ( $hidd_po )";
		
		if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and d.file_no='".trim($file_no)."' "; 
		if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and d.grouping='".trim($internal_ref)."' "; 
		//echo $file_no_cond.'=='.$internal_ref_cond;die;
		
		if($db_type==0)
		{
			if($txt_date_category==1) 
			{	
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".$date_from."' and '".$date_to."'";
			}
			else 
			{
				if($txt_date_category==2) if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".$date_from."' and '".$date_to."'";
			}
		}
		if($db_type==2)
		{
			if($txt_date_category==1) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.booking_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
			else if($txt_date_category==2) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
		}
	
	
		$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
		$supplierArr=return_library_array( "select id,supplier_name from lib_supplier", "id", "supplier_name");	
		$buyerArr=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
	//	$nonStyleArr=return_library_array( "select id, style_ref_no from sample_development_mst", "id", "style_ref_no");		
		
		// $sql="select a.job_no,d.id as po_id from wo_po_details_master a, wo_po_break_down d where a.job_no=d.job_no_mst and a.status_active=1 and a.is_deleted=0 and d.status_active=1 and d.is_deleted=0 $internal_ref_cond  $file_no_cond  group by a.job_no,d.id";
		// $sql_result=sql_select($sql);
		// $po_id_data="";$k=0;
		// foreach($sql_result as $row)
		// {
		// 	if($k==0)
		// 	{
		// 		$po_data_cond=$row[csf('po_id')];
		// 		 $job_data_cond=$row[csf('job_no')];
		// 	}
		// 	else
		// 	{
		// 		 $po_data_cond.=",".$row[csf('po_id')];
		// 		 $job_data_cond.=",".$row[csf('job_no')];
		// 	} 
		// } //echo $job_data_cond;
		// if($file_no_cond!="" || $internal_ref!="")
		// {  
		//  $po_data_file_ref=" and b.po_break_down_id in($po_data_cond) "; 
		//  $job_data_file_ref=" and b.job_no in('$job_data_cond') "; 
		// }
		// else
		// {
		// 	$po_data_file_ref="";
		// 	$job_data_file_ref="";
		// }
		

		
		
		ob_start();
		?>
		<fieldset style="width:2310px">
			<table width="2290"  cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none; font-size:18px;" colspan="21">
						<? echo $company_library[str_replace("'","",$cbo_company_id)]; ?>                                
					</td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:16px; font-weight:bold" colspan="21"> <? echo $report_title; if($cbo_category!=0) echo " For ".$item_category[$cbo_category]; ?></td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:12px; font-weight:bold"  colspan="21"> <? if( $date_from!="" && $date_to!="" ) echo "From ".change_date_format($date_from)." To ".change_date_format($date_to);?></td>
				</tr>
			</table>
            <table class="rpt_table" width="2290" cellpadding="0" cellspacing="0" border="1" rules="all">
				<thead>
					<th width="30">SL</th>    
					<th width="100">Comapny</th>
					<th width="60">Wo No</th>
					<th width="60">PI No</th>
					<th width="60">Wo Year</th>
					<th width="70">Wo Date</th>
					<th width="70">Deli. Date</th>
                    <th width="70">Lead Time</th>
					<th width="100">Wo Type</th>
					<th width="100">Ready To App.</th>
                    <th width="100">Ready To Approved<br> date and time</th>
                    
					<th width="80">App. Status</th>
                    <th width="100">Last Approval <br>Date time and Person</th>
					<th width="100">Supplier</th>
					<th width="100">Buyer</th>
					<th width="110">Job No.</th>
					<th width="60">Job Year</th>
					<th width="100">Style Ref.</th>
					<th width="100">Inter. Ref.</th>
					<th width="100">File No.</th>
					<th width="100">Order No</th>
                    <th width="100">Shipment Date</th>
					<th width="80">Item Cate.</th>
					<th width="70">First Rec. Date</th>
                    <th width="100">Wo Qty</th>
                    <th width="100">W/O Value USD</th>
					<th >Remarks</th>
				</thead>
			</table>
			<div style="max-height:350px; overflow-y:scroll; width:2310px" id="scroll_body" >
				<table cellspacing="0" cellpadding="0" border="1" class="rpt_table"  width="2290" rules="all" id="table_body" >
				<?
				if ($cbo_company==0) $company_cond_id=""; else $company_cond_id=" and b.company_id=$cbo_company";
				if($cbo_category==24)
				{
					$sql="select a.id, a.ydw_no, min(b.receive_date) as receive_date from wo_yarn_dyeing_mst a,inv_receive_master b where a.ydw_no=b.booking_no and b.item_category=1  and b.receive_basis=2 and b.receive_purpose=2 $company_cond_id group by a.id, a.ydw_no";	
					$sql_result=sql_select($sql);
					foreach($sql_result as $row)
					{
						$first_rec_date[$row[csf("id")]]=$row[csf("receive_date")];
					}
				}
				if($db_type==0)
				{	
					$sql="Select a.company_id,a.id as booking_id,a.is_approved,a.ready_to_approved,a.update_date, a.entry_form, a.ydw_no,a.pay_mode, Year(a.insert_date) as year_book, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.supplier_id, b.job_no, b.uom, sum(b.yarn_wo_qty) as wo_qnty,sum(b.amount) as amount, a.currency,b.fab_booking_no from wo_yarn_dyeing_mst a, wo_yarn_dyeing_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $supplier_cond and a.item_category_id=24 $job_num $booking_date_cond $wo_no_cond $wo_type_cond group by a.company_id,a.id,a.update_date, a.entry_form, a.ydw_no, a.insert_date, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.is_approved,a.supplier_id, b.job_no, b.uom order,a.ready_to_approved,b.fab_booking_no , a.currency by a.id Desc";
				}
				else if ($db_type==2)
				{
					$sql="Select a.company_id,a.id as booking_id,a.is_approved,a.ready_to_approved,a.update_date, a.entry_form, a.ydw_no,a.pay_mode, TO_CHAR(a.insert_date,'YYYY') as year_book, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.supplier_id, b.job_no_id,b.job_no, b.uom, sum(b.yarn_wo_qty) as wo_qnty,sum(b.amount) as amount, a.currency,b.fab_booking_no from wo_yarn_dyeing_mst a, wo_yarn_dyeing_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $supplier_cond and a.item_category_id=24 $job_num $booking_date_cond $wo_no_cond $wo_type_cond group by a.company_id,a.id,a.update_date,a.entry_form, a.ydw_no,a.pay_mode, a.insert_date, a.yarn_dyeing_prefix_num, a.booking_date, a.delivery_date, a.is_approved,a.supplier_id, b.job_no,b.job_no_id, b.uom, a.ready_to_approved,a.currency,b.fab_booking_no order by a.id Desc";
				}
				//echo $sql; //die;
				//echo  $po_id ;die;
				$tot_wo_amount=0;
				$sql_result=sql_select($sql); $i=1;
				foreach ($sql_result as $row) 
				{
					$booking_id_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
					$jobId[$row[csf("job_no_id")]]=$row[csf("job_no_id")];
				}
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 1, $booking_id_arr, $empty_arr);//Book ID Ref from=1
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 2, $jobId, $empty_arr);//Job ID Ref from=2
				

				$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g  where a.id=b.pi_id and b.work_order_id=g.ref_val and b.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0
				and a.item_category_id=24 and a.pi_basis_id=1 ";
				$pi_sql_result=sql_select($pi_sql);
				$pi_no_arr = array();
				foreach ($pi_sql_result as $value) 
				{
					$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
					$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];
				}
				unset($pi_sql_result);
				if($db_type==0)
				{
					$job_sql="select a.job_no_prefix_num, a.job_no, a.buyer_name, Year(a.insert_date) as year, a.style_ref_no, a.garments_nature, 
					group_concat(b.id) as id,
					group_concat(b.po_number) as po_number,
					group_concat(b.file_no) as file_no,
					group_concat(b.grouping) as grouping,
					max(b.pub_shipment_date) as max_ship_date,
					min(b.pub_shipment_date) as min_ship_date
					from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.job_no_prefix_num, a.job_no, a.buyer_name, a.insert_date, a.style_ref_no, a.garments_nature";
				}
				elseif($db_type==2)
				{
					$job_sql="select a.job_no_prefix_num, a.job_no, a.buyer_name, TO_CHAR(a.insert_date,'YYYY') as year, a.style_ref_no, a.garments_nature, 
					b.id as id,
					b.po_number as po_number,
					b.file_no as file_no,
					b.grouping as grouping,
					(b.pub_shipment_date) as max_ship_date,
					(b.pub_shipment_date) as min_ship_date
					from wo_po_details_master a, wo_po_break_down b,gbl_temp_engine g where a.id=b.job_id  and a.id=g.ref_val and b.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 ";
				}
				
				$job_sql_result=sql_select($job_sql);
				foreach($job_sql_result as $row)
				{
					$order_no=$row[csf("po_number")];//implode(",",array_unique(explode(",",$row[csf("po_number")])));
					$order_id=$row[csf("id")];//implode(",",array_unique(explode(",",$row[csf("id")])));
					$file_no=$row[csf("file_no")];//implode(",",array_unique(explode(",",$row[csf("file_no")])));
					$int_ref=$row[csf("grouping")];//implode(",",array_unique(explode(",",$row[csf("grouping")])));
			
					$job_array[$row[csf("job_no")]]['job']=$row[csf("job_no_prefix_num")];
					$job_array[$row[csf("job_no")]]['job_no']=$row[csf("job_no")];
					$job_array[$row[csf("job_no")]]['buyer']=$row[csf("buyer_name")];
					$job_array[$row[csf("job_no")]]['year']=$row[csf("year")];
					$job_array[$row[csf("job_no")]]['style_ref_no']=$row[csf("style_ref_no")];
					$job_array[$row[csf("job_no")]]['garments_nature']=$row[csf("garments_nature")];
					$job_array[$row[csf("job_no")]]['max_ship_date'].=$row[csf("max_ship_date")].',';
					$job_array[$row[csf("job_no")]]['min_ship_date'].=$row[csf("min_ship_date")].',';
					$job_array[$row[csf("job_no")]]['id'].=$order_id.',';
					$job_array[$row[csf("job_no")]]['po_number'].=$order_no.',';
					$job_array[$row[csf("job_no")]]['file'].=$file_no.',';
					$job_array[$row[csf("job_no")]]['ref'].=$int_ref.',';
				}
				
				$emb_item_array=array();
		
			$emb_sql="select a.emb_name, b.item_number_id, b.job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b, gbl_temp_engine g where a.job_id=b.job_id and b.job_id=g.ref_val and a.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 ";
			$emb_sql_result=sql_select($emb_sql);
			foreach($emb_sql_result as $row)
			{
				$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
				$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
			}
		//var_dump($job_array);
				 $wo_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_yarn_dyeing_mst a, approval_history b,gbl_temp_engine g where a.id=b.mst_id and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(30) ".where_con_using_array($booking_id_arr,0,'a.id')." order by b.id desc";
				$wo_his_sql_result=sql_select($wo_his_sql);
				//$pi_no_arr = array();
				$user_arr=return_library_array( "select id, user_name from user_passwd", 'id', 'user_name' );	
				foreach ($wo_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_his_sql_result);
				
				/*$wo_non_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_non_ord_samp_booking_mst a, approval_history b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(8,7,32) ".where_con_using_array($booking_id_arr,0,'a.id')." order by b.id desc";
				$wo_non_his_sql_result=sql_select($wo_non_his_sql);
				//$pi_no_arr = array();
			 
				foreach ($wo_non_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_non_his_sql_result);*/

				$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id and b.work_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37  and a.status_active=1 and a.is_deleted=0
				and a.item_category_id=24 and a.pi_basis_id=1 
				";
				$pi_sql_result=sql_select($pi_sql);
				$pi_no_arr = array();
				foreach ($pi_sql_result as $value) 
				{
					$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
					$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];
				}
				unset($pi_sql_result);
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con); 
				
				foreach($sql_result as $row)
				{
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					if ($row[csf("entry_form")]==41) $wo_type="Order";
					else if ($row[csf("entry_form")]==42) $wo_type="Non Order";
					$job_number=implode(",",array_unique(explode(",",$row[csf("job_no")])));
					$supplier_name="";
					if($row[csf("pay_mode")]==3 || $row[csf("pay_mode")]==5)
					{
						$supplier_name=$company_library[$row[csf("supplier_id")]];
					}
					else $supplier_name=$supplierArr[$row[csf("supplier_id")]];

					$cid=2;
					if($row[csf('currency')]==2)
					{
						$cid=1;
					}
					if($row[csf('ready_to_approved')]==1) //ready
					{
						$last_update_date=$row[csf('update_date')];
					}
					
					$ex_rate=set_conversion_rate($cid, $row[csf("booking_date")],$cbo_company);
					$wo_amount=$row[csf("amount")]/$ex_rate;//test2

					$variable="<a  href='##'  onClick=\"generate_fabric_report('".$row[csf("entry_form")]."','".$row[csf("ydw_no")]."','".$row[csf("company_id")]."','".$row[csf("booking_id")]."','".$cbo_category."','','','".$row[("is_approved")]."','".$cbo_category."','','','','','".$i."')\">".$row[csf("yarn_dyeing_prefix_num")]."  <a/>";	
					?>
					<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
						<td width="30"><? echo $i;?></td>
						<td width="100" align="center"><p><? echo $company_library[$row[csf("company_id")]]; ?></td>
						<td width="60" align="center"><? echo $variable; ?></td>	<!--<a href='#report_details' onClick="generate_fabric_report('<? //echo $row[csf("entry_form")]; ?>','<? //echo $row[csf("ydw_no")]; ?>','<? //echo $cbo_company; ?>','<? //echo $row[csf("job_no")]; ?>','<? //echo "24"; ?>','<? //echo $cbo_category; ?>');"></a>-->
						<td width="60" align="center"><p><? echo $pi_no_arr[$row[csf("ydw_no")]]['pi_no']; ?></td>
						<td width="60" align="center"><p><? echo $row[csf("year_book")]; ?></td>
						<td width="70"><p style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("booking_date")], "", "",0); ?></p></td>
						<td width="70"><p style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("delivery_date")]); ?></p></td>
                        
                        <td width="70"><p style="word-wrap:break-word; width:70px">
						<? 
						$lead_time=0;
						if($row[csf("delivery_date")]!="" && $row[csf("delivery_date")]!="0000-00-00")
						{
							$lead_time=datediff("d", $row[csf("booking_date")], $row[csf("delivery_date")]);
						}
						if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day"; 
						?></p></td>
                        
						<td width="100"><p><? echo $wo_type;?></p></td>
						<td width="100" align="center"><? echo $yes_no[$row[csf("ready_to_approved")]]; ?></td>
                         <td width="100" align="center"><? $last_update_dateArr=explode(" ",$last_update_date);echo change_date_format($last_update_dateArr[0]).'<br>'.$last_update_dateArr[1]; ?></td>
						<td width="80"><p><? echo $approval_type_arr[$row[csf("is_approved")]]; ?></p></td>
                         <?
							//if ($cbo_category==4)
							//{
								$approved_date=$last_app_arr[$row[csf("booking_id")]]['approved_date'];
								$approved_by=$last_app_arr[$row[csf("booking_id")]]['approved_by'];
								?>
                         <td width="100" title="bookingId=<? echo $row[csf("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                             
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $supplier_name; ?></p></td>
						<td width="100"><p><? echo $buyerArr[$job_array[$job_number]['buyer']]; ?></p></td>
						<td width="110"><p style="word-wrap:break-word; width:110px"><? echo $row[csf("job_no")];//$row[csf("job_no_prefix_num")]; ?></p></td>
						<td width="60"><? echo $job_array[$job_number]['year']; ?></td>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $job_array[$job_number]['style_ref_no']; ?></p></td>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $job_array[$job_number]['ref']; ?></p></td>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $job_array[$job_number]['file']; ?></p></td>
						<td width="100"><p style="word-wrap:break-word; width:100px"><? echo $job_array[$job_number]['po_number']; ?></p></td>
                        <td width="100"><p style="word-wrap:break-word; width:100px">
						<? 
						if($job_array[$job_number]['max_ship_date']!="" && $job_array[$job_number]['max_ship_date']!="0000-00-00") echo "Max - ".change_date_format($job_array[$job_number]['max_ship_date']);
						//if($job_array[$job_number]['max_ship_date']!=$job_array[$job_number]['min_ship_date']) echo "<br> " . change_date_format($job_array[$job_number]['min_ship_date']); 
						
						$order_count=explode(",",$job_array[$job_number]['po_number']);
						if(count($order_count)>1) echo "<br> Min - " . change_date_format($job_array[$job_number]['min_ship_date']);
						 
						?></p></td>
						<td width="80"><p style="word-wrap:break-word; width:80px"><? echo $item_category[24]; ?></p></td>
						<td width="70" align="center"><p><? echo change_date_format($first_rec_date[$row[csf("booking_id")]]); ?></p></td>
						<td width="100" align="right"><? echo number_format($row[csf("wo_qnty")],2); ?></td>
						<td width="100" align="right"><? echo number_format($wo_amount,2); ?></td>
						<td>&nbsp; </td>
					</tr>
					<?
					$tot_wo_qnty+=$row[csf("wo_qnty")];
					$tot_wo_amount+=$wo_amount;
					$i++;
				}
				?>
				</table>
				<table class="rpt_table" width="2290" cellpadding="0" cellspacing="0" border="1" rules="all">
					<tfoot>
						<th width="30">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="70">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="110">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="80">Total</th>
						<th width="70">&nbsp;</th>
                        <th width="100" align="right" id="tot_fin_fab_qnty"><? echo number_format($tot_wo_qnty,2); ?></th>
                        <th width="100" align="right" id="tot_wo_amount"><? echo number_format($tot_wo_amount,2); ?></th>
						<th>&nbsp;</th>
					</tfoot>
				</table>
			</div>
		</fieldset>
		<?
	}	
	else if ($cbo_category==31)//31=Services Lab Test
	{
		if($db_type==0)
		{
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and YEAR(a.insert_date)=$year_id";
		}
		elseif($db_type==2)
		{ 
			if ($year_id==0) $year_id_cond=""; else $year_id_cond=" and TO_CHAR(a.insert_date,'YYYY')=$year_id";
		}
		
		if ($cbo_company==0) $company_id=""; else $company_id=" and a.company_id=$cbo_company";
		if ($wo_no=="") $wo_no_cond=""; else $wo_no_cond=" and a.labtest_no like '%$wo_no'";
		if ($job_no=="") $job_num=""; else $job_num=" and b.job_no='$job_no'";
		if ($hidd_po=='') $po_no_no=""; else $po_no_no=" and c.order_id in ($hidd_po)";
		
		
		if ($cbo_buyer==0) $supplier_cond=""; else $supplier_cond=" and a.supplier_id=$cbo_buyer";
		if ($cbo_category==0) $category_id=""; else $category_id=" and a.item_category=$cbo_category";
		if ($wo_type==2) $wo_type_cond=" and a.entry_form=41"; else if ($wo_type==4) $wo_type_cond=" and a.entry_form=42"; else $wo_type_cond="";
		
		//if ($job_no=="") $job_num_mst=""; else $job_num_mst=" and b.job_no_mst=$job_no";
		if ($hidd_po=="") $po_id=""; else $po_id=" and d.id in ( $hidd_po )";
		
		if ($hidd_po=="") $po_id_cond=""; else $po_id_cond=" and b.po_break_down_id in ( $hidd_po )";
		
		if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and d.file_no='".trim($file_no)."' "; 
		if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and d.grouping='".trim($internal_ref)."' "; 
		//echo $file_no_cond.'=='.$internal_ref_cond;die;
		
		if($db_type==0)
		{
			if($txt_date_category==1) 
			{	
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.wo_date between '".$date_from."' and '".$date_to."'";
			}
			else 
			{
				if($txt_date_category==2) if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".$date_from."' and '".$date_to."'";
			}
		}
		if($db_type==2)
		{
			if($txt_date_category==1) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.wo_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
			else if($txt_date_category==2) 
			{
				if( $date_from=="" && $date_to=="" ) $booking_date_cond=""; else $booking_date_cond=" and a.delivery_date between '".change_date_format($date_from,'dd-mm-yyyy','-',1)."' and '".change_date_format($date_to,'dd-mm-yyyy','-',1)."'";
			}
		}
	
	
		$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
		$supplierArr=return_library_array( "select id,supplier_name from lib_supplier", "id", "supplier_name");	
		$buyerArr=return_library_array( "select id, buyer_name from lib_buyer", "id", "buyer_name");
		//$nonStyleArr=return_library_array( "select id, style_ref_no from sample_development_mst", "id", "style_ref_no");		
		
		// $sql="select a.job_no,d.id as po_id from wo_po_details_master a, wo_po_break_down d where a.job_no=d.job_no_mst and a.status_active=1 and a.is_deleted=0 and d.status_active=1 and d.is_deleted=0 $internal_ref_cond  $file_no_cond  group by a.job_no,d.id";
		// $sql_result=sql_select($sql);
		// $po_id_data="";$k=0;
		// foreach($sql_result as $row)
		// {
		// 	if($k==0)
		// 	{
		// 		$po_data_cond=$row[csf('po_id')];
		// 		 $job_data_cond=$row[csf('job_no')];
		// 	}
		// 	else
		// 	{
		// 		 $po_data_cond.=",".$row[csf('po_id')];
		// 		 $job_data_cond.=",".$row[csf('job_no')];
		// 	} 
		// } //echo $job_data_cond;
		
		
		// if($file_no_cond!="" || $internal_ref!="")
		// {  
		//  $po_data_file_ref=" and c.po_break_down_id in($po_data_cond) "; 
		//  $job_data_file_ref=" and b.job_no in('$job_data_cond') "; 
		// }
		// else
		// {
		// 	$po_data_file_ref="";
		// 	$job_data_file_ref="";
		// }
		
		
		
		
		
		ob_start();
		?>
		<fieldset style="width:2310px">
			<table width="2390"  cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none; font-size:18px;" colspan="21">
						<? echo $company_library[str_replace("'","",$cbo_company_id)]; ?>                                
					</td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:16px; font-weight:bold" colspan="21"> <? echo $report_title; if($cbo_category!=0) echo " For ".$item_category[$cbo_category]; ?></td>
				</tr>
				<tr class="form_caption" style="border:none;">
					<td align="center" style="border:none;font-size:12px; font-weight:bold"  colspan="21"> <? if( $date_from!="" && $date_to!="" ) echo "From ".change_date_format($date_from)." To ".change_date_format($date_to);?></td>
				</tr>
			</table>
            <table class="rpt_table" width="2390" cellpadding="0" cellspacing="0" border="1" rules="all">
				<thead>
					<th width="30">SL</th>    
					<th width="100">Company</th>
					<th width="60">Wo No</th>
					<th width="60">PI No</th>
					<th width="60">Wo Year</th>
					<th width="70">Wo Date</th>
					<th width="70">Deli. Date</th>
                    <th width="70">Lead Time</th>
					<th width="100">Wo Type</th>
					<th width="100">Ready To App.</th>
				    <th width="100">Ready To Approved<br> date and time</th>
					<th width="80">App. Status</th>
                    <th width="100">Last Approval <br>Date time and Person</th>
					<th width="100">Supplier</th>
					<th width="100">Buyer</th>
					<th width="110">Job No.</th>
					<th width="60">Job Year</th>
					<th width="100">Style Ref.</th>
					<th width="100">Inter. Ref.</th>
					<th width="100">File No.</th>
					<th width="100">Order No</th>
                    <th width="100">Shipment Date</th>
					<th width="80">Item Cate.</th>
					<th width="70">First Rec. Date</th>
                    <th width="100">WO value</th>
					<th>Remarks</th>
				</thead>
			</table>
			<div style="max-height:350px; overflow-y:scroll; width:2410px" id="scroll_body" >
				<table cellspacing="0" cellpadding="0" border="1" class="rpt_table"  width="2290" rules="all" id="table_body" >
				<?
				if ($cbo_company==0) $company_cond_id=""; else $company_cond_id=" and b.company_id=$cbo_company";
				if($cbo_category==24)
				{
					$sql="select a.id, a.ydw_no, min(b.receive_date) as receive_date from wo_yarn_dyeing_mst a,inv_receive_master b where a.ydw_no=b.booking_no and b.item_category=1  and b.receive_basis=2 and b.receive_purpose=2 $company_cond_id group by a.id, a.ydw_no";	
					$sql_result=sql_select($sql);
					foreach($sql_result as $row)
					{
						$first_rec_date[$row[csf("id")]]=$row[csf("receive_date")];
					}
				}
				if($db_type==0)
				{	
					$sql="Select a.company_id,a.currency,a.id as booking_id, a.entry_form,a.pay_mode, Year(a.insert_date) as year_book, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id,a.ready_to_approved, b.job_no, sum(b.wo_value) as wo_value from wo_labtest_mst a, wo_labtest_dtls b,wo_labtest_order_dtls c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $supplier_cond $job_num $booking_date_cond $wo_no_cond $wo_type_cond $po_no_no group by a.id,a.company_id, a.entry_form, a.insert_date,a.pay_mode, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id,a.ready_to_approved, b.job_no order by a.id Desc";
				}
				else if ($db_type==2)
				{
					$sql="Select a.company_id,max(a.currency) as currency, a.id as booking_id, a.entry_form,a.pay_mode, TO_CHAR(a.insert_date,'YYYY') as year_book, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id, a.ready_to_approved, b.job_no, sum(c.wo_value) as wo_value from wo_labtest_mst a, wo_labtest_dtls b,wo_labtest_order_dtls c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $company_id $job_num $booking_date_cond $wo_no_cond $wo_type_cond $po_no_no group by a.id,a.company_id, a.entry_form,a.pay_mode, a.insert_date, a.labtest_prefix_num, a.wo_date, a.delivery_date, a.supplier_id,a.ready_to_approved,  b.job_no order by a.id Desc";
				}
				  
				  
				   //echo $sql; //die;
				//echo  $po_id ;die;
				$sql_result=sql_select($sql); $i=1;
				foreach ($sql_result as $row) 
				{
					$booking_id_arr[$row[csf("booking_id")]]=$row[csf("booking_id")];
				}
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 1, $booking_id_arr, $empty_arr);//Book ID Ref from=1
				
				//==============**************============================
				if($db_type==0)
				{
					$job_sql="select a.job_no_prefix_num, a.job_no, a.buyer_name, Year(a.insert_date) as year, a.style_ref_no, a.garments_nature, 
					group_concat(b.id) as id,
					group_concat(b.po_number) as po_number,
					group_concat(b.file_no) as file_no,
					group_concat(b.grouping) as grouping,
					max(b.pub_shipment_date) as max_ship_date,
					min(b.pub_shipment_date) as min_ship_date
					from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.job_no_prefix_num, a.job_no, a.buyer_name, a.insert_date, a.style_ref_no, a.garments_nature";
				}
				elseif($db_type==2)
				{
					$job_sql="select a.id as job_id,a.job_no_prefix_num, a.job_no, a.buyer_name, TO_CHAR(a.insert_date,'YYYY') as year, a.style_ref_no, a.garments_nature, 
					b.id as id,
					b.po_number as po_number,
					b.file_no as file_no,
					b.grouping as grouping,
					(b.pub_shipment_date) as max_ship_date,
					(b.pub_shipment_date) as min_ship_date
					from wo_po_details_master a, wo_po_break_down b,wo_labtest_dtls c,gbl_temp_engine g  where a.id=b.job_id and c.job_no=a.job_no and  b.job_no_mst=c.job_no and c.mst_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 ";
				}
				$job_sql_result=sql_select($job_sql);
				foreach($job_sql_result as $row)
				{
					$order_no=$row[csf("po_number")];//implode(",",array_unique(explode(",",$row[csf("po_number")])));
					$order_id=$row[csf("id")];//implode(",",array_unique(explode(",",$row[csf("id")])));
					$file_no=$row[csf("file_no")];//implode(",",array_unique(explode(",",$row[csf("file_no")])));
					$int_ref=$row[csf("grouping")];//implode(",",array_unique(explode(",",$row[csf("grouping")])));
			
					$job_idArr[$row[csf("job_no")]]['job_id']=$row[csf("job_id")];
					$job_array[$row[csf("job_no")]]['job']=$row[csf("job_no_prefix_num")];
					$job_array[$row[csf("job_no")]]['job_no']=$row[csf("job_no")];
					$job_array[$row[csf("job_no")]]['buyer']=$row[csf("buyer_name")];
					$job_array[$row[csf("job_no")]]['year']=$row[csf("year")];
					$job_array[$row[csf("job_no")]]['style_ref_no']=$row[csf("style_ref_no")];
					$job_array[$row[csf("job_no")]]['garments_nature']=$row[csf("garments_nature")];
					$job_array[$row[csf("job_no")]]['max_ship_date'].=$row[csf("max_ship_date")].',';
					$job_array[$row[csf("job_no")]]['min_ship_date'].=$row[csf("min_ship_date")].',';
					$job_array[$row[csf("job_no")]]['id'].=$order_id.',';
					$job_array[$row[csf("job_no")]]['po_number'].=$order_no.',';
					$job_array[$row[csf("job_no")]]['file'].=$file_no.',';
					$job_array[$row[csf("job_no")]]['ref'].=$int_ref.',';
				}
				fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 37, 2, $job_idArr, $empty_arr);//Job ID Ref from=2

				$emb_item_array=array();
				
				$emb_sql="select a.emb_name, b.item_number_id, b.job_no_mst from wo_pre_cost_embe_cost_dtls a, wo_po_color_size_breakdown b, gbl_temp_engine g where a.job_id=b.job_id  and a.job_id=g.ref_val  and b.job_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
				$emb_sql_result=sql_select($emb_sql);
				foreach($emb_sql_result as $row)
				{
					$emb_item_array[$row[csf("job_no_mst")]]['emb_name']=$row[csf("emb_name")];
					$emb_item_array[$row[csf("job_no_mst")]]['item_number_id']=$row[csf("item_number_id")];
				}
				//var_dump($job_array);

				$wo_his_sql = "SELECT a.id as booking_mstId, b.approved_date, b.approved_by,b.id as his_mst_id  from wo_labtest_mst a, approval_history ,gbl_temp_engine g where a.id=b.mst_id  and a.id=g.ref_val and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0  and b.current_approval_status=1 and a.is_approved in (1,3) and b.entry_form in(42)  order by b.id desc";
				$wo_his_sql_result=sql_select($wo_his_sql);
				//$pi_no_arr = array();
				$user_arr=return_library_array( "select id, user_name from user_passwd", 'id', 'user_name' );	
				foreach ($wo_his_sql_result as $row) 
				{
					$last_app_arr[$row[csf("booking_mstId")]]['approved_date']=$row[csf("approved_date")];
					$last_app_arr[$row[csf("booking_mstId")]]['approved_by']=$user_arr[$row[csf("approved_by")]];
				}
				unset($wo_his_sql_result);
				$pi_sql = "SELECT a.id as pi_id,a.pi_number, b.work_order_no from com_pi_master_details a, com_pi_item_details b,gbl_temp_engine g where a.id=b.pi_id and b.work_order_id=g.ref_val and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=37 and a.status_active=1 and a.is_deleted=0
				and a.item_category_id=31 and a.pi_basis_id=1 
				group by  a.id,a.pi_number, b.work_order_no order by a.pi_number desc";
				$pi_sql_result=sql_select($pi_sql);
				$pi_no_arr = array();
				foreach ($pi_sql_result as $value) 
				{
					$pi_no_arr[$value[csf("work_order_no")]]['pi_no']=$value[csf("pi_number")];
					$pi_no_arr[$value[csf("work_order_no")]]['pi_id']=$value[csf("pi_id")];
				}
				unset($pi_sql_result);
				$con = connect();
				execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2,3) and ENTRY_FORM=37");
				oci_commit($con);
				disconnect($con);

				foreach($sql_result as $row)
				{
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					if ($row[csf("entry_form")]==41 || $row[csf("entry_form")]==79) $wo_type="Order";
					else if ($row[csf("entry_form")]==42) $wo_type="Non Order";
					$job_number=implode(",",array_unique(explode(",",$row[csf("job_no")])));
					$cbo_company=$row[csf("company_id")];
					
					
						//function generate_fabric_report(type,booking_no,company_id,order_id,fabric_nature,fabric_source,job_no,approved,category,is_short,emb_name,item_number_id,action_type,i,supplier_id)
					
						 
					 $variable="<a href='##' title='PB' onClick=\"generate_fabric_report('','".$row[csf("booking_id")]."','".$cbo_company."','".$row[csf("currency")]."','".$cbo_category."','".change_date_format($row[csf("wo_date")])."','','','".$cbo_category."','','','','show_trim_booking_report','')\">".$row[csf("labtest_prefix_num")]." </a>";	     					
					$supplier_name="";
					if($row[csf("pay_mode")]==3 || $row[csf("pay_mode")]==5)
					{
						$supplier_name=$company_library[$row[csf("supplier_id")]];
					}
					else $supplier_name=$supplierArr[$row[csf("supplier_id")]];
					if($row[csf('ready_to_approved')]==1) //ready
					{
						$last_update_date=$row[csf('update_date')];
					}
					
					?>
					<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
						<td width="30"><? echo $i;?></td>
						<td width="100" align="center"><p><? echo $company_library[$row[csf("company_id")]]; ?></td>
						<td width="60" align="center"><? echo $variable; ?></td>
						<td width="60" align="center"><p><? echo $pi_no_arr[$row[csf("booking_id")]]['pi_no']; ?></td>
						<td width="60" align="center"><p><? echo $row[csf("year_book")]; ?></td>					
						<td width="70"><div style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("wo_date")], "", "",0); ?></div></td>
						<td width="70"><div style="word-wrap:break-word; width:70px"><? echo change_date_format($row[csf("delivery_date")]); ?></div></td>
                        <td width="70"><div style="word-wrap:break-word; width:70px">
						<? 
						$lead_time=0;
						if($row[csf("delivery_date")]!="" && $row[csf("delivery_date")]!="0000-00-00")
						{
							$lead_time=datediff("d", $row[csf("wo_date")], $row[csf("delivery_date")]);
						}
						if($lead_time>1 || $lead_time<-1) echo $lead_time." Days"; else echo $lead_time." Day"; 
						?></div></td>
						<td width="100"><?=$wo_type; ?></td>
						<td width="100" align="center"><? echo $yes_no[$row[csf("ready_to_approved")]]; ?></td>
                        <td width="100" align="center"><? $last_update_dateArr=explode(" ",$last_update_date);echo change_date_format($last_update_dateArr[0]).'<br>'.$last_update_dateArr[1]; ?></td>
                        
						<td width="80"><p><? echo $approval_type_arr[$row[csf("is_approved")]]; ?></p></td>
                        <?
                       	 $approved_date=$last_app_arr[$row[("booking_id")]]['approved_date'];
						 $approved_by=$last_app_arr[$row[("booking_id")]]['approved_by'];
						?>
                         <td width="100" title="bookingId=<? echo $row[("booking_id")];?>" align="center"><?  $last_approve_date=explode(" ",$approved_date); if($approved_date!='') echo change_date_format($last_approve_date[0]).', '.$last_approve_date[1].'<br>'.$approved_by;else echo ' '; ?></td>
                         
                         
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $supplier_name; ?></div></td>
						<td width="100"><p><? echo $buyerArr[$job_array[$job_number]['buyer']]; ?></p></td>
						<td width="110"><div style="word-wrap:break-word; width:110px"><? echo $row[csf("job_no")];//$row[csf("job_no_prefix_num")]; ?></div></td>
						<td width="60"><? echo $job_array[$job_number]['year']; ?></td>
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $job_array[$job_number]['style_ref_no']; ?></div></td>
						<?
						$ref_all=rtrim($job_array[$job_number]['ref'],',');
						$ref_all=implode(", ",array_unique(explode(",",$ref_all)));
						$file_all=rtrim($job_array[$job_number]['file'],',');
						$file_all=implode(", ",array_unique(explode(",",$file_all)));
						$po_alls=rtrim($job_array[$job_number]['po_number'],',');
						$po_all=implode(", ",array_unique(explode(",",$po_alls)));
						?>

						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $ref_all; ?></div></td>
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $file_all; ?></div></td>
						<td width="100"><div style="word-wrap:break-word; width:100px"><? echo $po_all; ?></div></td>
                        <td width="100"><div style="word-wrap:break-word; width:100px">
						<? 
						$max_shipdate=rtrim($job_array[$job_number]['max_ship_date'],',');
						$max_ship_dateArr=explode(",",$max_shipdate);
						$max_ship_date=max($max_ship_dateArr);
						$min_shipdate=rtrim($job_array[$job_number]['min_ship_date'],',');
						$min_shipdateArr=explode(",",$min_shipdate);
						$min_shipdate=min($min_shipdateArr);

						if($max_ship_date!="" && $max_ship_date!="0000-00-00") echo "Max - ".change_date_format($max_ship_date);
						//if($job_array[$job_number]['max_ship_date']!=$job_array[$job_number]['min_ship_date']) echo "<br> " . change_date_format($job_array[$job_number]['min_ship_date']); 
						
						$order_count=explode(",",$po_all);
						if(count($order_count)>1) echo "<br> Min - " . change_date_format($min_shipdate);
						 
						?></div></td>
						<td width="80"><div style="word-wrap:break-word; width:80px"><? echo $item_category[31]; ?></div></td>
						<td width="70" align="center"><p><? echo change_date_format($first_rec_date[$row[csf("booking_id")]]); ?></p></td>
						<td width="100" align="right"><? echo number_format($row[csf("wo_value")],2); ?></td>
						<td><? //echo $row[csf("po_number")]; ?></td>
					</tr>
					<?
					$tot_wo_qnty+=$row[csf("wo_value")];
					$i++;
				}
				?>
				</table>
				<table class="rpt_table" width="2290" cellpadding="0" cellspacing="0" border="1" rules="all">
					<tfoot>
						<th width="30">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="70">&nbsp;</th>
                        <th width="70">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="110">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="100">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th width="80">Total</th>
						<th width="70">&nbsp;</th>
                        <th width="100" align="right" id="value_tot_fin_fab_qnty"><? echo number_format($tot_wo_qnty,2); ?></th>
						<th>&nbsp;</th>
					</tfoot>
				</table>
			</div>
		</fieldset>
		<?
	}

	$html = ob_get_contents();
    ob_clean();
    //$new_link=create_delete_report_file( $html, 2, $delete, "../../../" );
    foreach (glob("*.xls") as $filename) {
    //if( @filemtime($filename) < (time()-$seconds_old) )
    @unlink($filename);
    }
    //---------end------------//
    $name=time();
    $filename=$user_id."_".$name.".xls";
    $create_new_doc = fopen($filename, 'w');	
    $is_created = fwrite($create_new_doc, $html);
    echo "$html**$filename"; 
	exit();
}
 
if($action=='fabric_receive_popup'){
	echo load_html_head_contents("Fabric Receive Info", "../../../", 1,1,$unicode,1,1);
	//$expData=explode('__',$data);
	
	$rev_data=sql_select(" SELECT b.pi_wo_batch_no,d.booking_id, b.order_qnty, b.order_rate,b.order_amount, b.cons_amount, b.id as trans_id , a.recv_number, g.style_ref_no, g.job_no, a.receive_date, b.prod_id, c.unit_of_measure, b.remarks from inv_receive_master a, inv_transaction b, product_details_master c, pro_finish_fabric_rcv_dtls d, order_wise_pro_details e join wo_po_break_down f on f.id=e.po_breakdown_id join wo_po_details_master g on f.job_id=g.id where a.id=b.mst_id and a.id=d.mst_id and b.prod_id=c.id and b.id=e.trans_id and b.id=d.trans_id and b.transaction_type=1 and b.item_category=3 and a.entry_form=17 and a.status_active=1  and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0  and d.booking_id=$data group by b.pi_wo_batch_no,d.booking_id, b.order_qnty, b.order_rate,b.order_amount, b.cons_amount, b.id, a.recv_number, g.style_ref_no, g.job_no, a.receive_date, b.prod_id, c.unit_of_measure, b.remarks");

		foreach ($rev_data as $row)
		{
			$trans_data[$row[csf('trans_id')]]['booking_id']=$row[csf('booking_id')];
			$trans_data[$row[csf('trans_id')]]['order_qnty']=$row[csf('order_qnty')]; // don't sum order_qnty
			$trans_data[$row[csf('trans_id')]]['order_rate']=$row[csf('order_rate')];
			$trans_data[$row[csf('trans_id')]]['order_amount']=$row[csf('order_amount')]; // don't sum order_amount
			$trans_data[$row[csf('trans_id')]]['cons_amount']=$row[csf('cons_amount')]; // don't sum cons_amount
			$trans_data[$row[csf('trans_id')]]['recv_number']=$row[csf('recv_number')]; 
			$trans_data[$row[csf('trans_id')]]['receive_date']=$row[csf('receive_date')];
			$trans_data[$row[csf('trans_id')]]['prod_id']=$row[csf('prod_id')];
			$trans_data[$row[csf('trans_id')]]['unit_of_measure']=$row[csf('unit_of_measure')];
			$trans_data[$row[csf('trans_id')]]['remarks']=$row[csf('remarks')];
			$trans_data[$row[csf('trans_id')]]['style_ref_no'].=$row[csf('style_ref_no')]."***";
			$trans_data[$row[csf('trans_id')]]['job_no'].=$row[csf('job_no')]."***";
		}
	?>
	<fieldset style="width:800px">
        <div style="width:100%;" align="center">
            <table cellpadding="0" width="100%" class="rpt_table" rules="all" border="1">
                <thead>
                	<tr>
                    	<th colspan="11">Fabric Receive Info</th>
                    </tr>
                    <tr>
                        <th width="30">SL</th>
                        <th width="100">MRR No</th>
                        <th width="100">Style No</th>
                        <th width="100">Job No</th>
                        <th width="60">Receive Date</th>
                        <th width="60">UOM</th>
                        <th width="80">Receive Qty.</th>
                        <th width="60">Rate (USD)</th>
                        <th width="80">Value (USD)</th>
                        <th width="60">Product ID</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
            </table>
            <table cellpadding="0" width="100%" id="rcvinfopopup" class="rpt_table" rules="all" border="1">
                <tbody>
                	<? $i=1;
                	foreach ($trans_data as $row) { ?>
	                	<tr>
	                        <td width="30"><?= $i; ?></td>
	                        <td width="100"><?= $row[('recv_number')]; ?></td>
	                        <td width="100"><?=implode(",", array_filter(array_unique(explode("***", $row[('style_ref_no')])))); ?></td>
	                        <td width="100"><?=implode(",", array_filter(array_unique(explode("***", $row[('job_no')])))); ?></td>
	                        <td width="60"><?= change_date_format($row[('receive_date')]); ?></td>
	                        <td width="60"><?= $unit_of_measurement[$row[('unit_of_measure')]]; ?></td>
	                        <td width="80" align="right"><?= $row[('order_qnty')]; ?></td>
	                        <td width="60" align="right"><?= $row[('order_rate')]; ?></td>
	                        <td width="80" align="right"><?= $row[('order_amount')]; ?></td>
	                        <td width="60" align="right"><?= $row[('prod_id')]; ?></td>
	                        <td><?= $row[('remarks')]; ?></td>
	                    </tr>
                	<? 
                	$total_qty+=$row[('order_qnty')];
                	$total_amount+=$row[('order_amount')];
                	$i++;
                	} 
                	?>                    
                </tbody>
                </table>
                <table cellpadding="0" width="100%"  class="rpt_table" rules="all" border="1">
                <tfoot>
                	<tr>
                		<th width="30"></th>
                        <th width="100"></th>
                        <th width="100"></th>
                        <th width="100"></th>
                        <th width="60"></th>
                        <th width="60" align="right">Total</th>
                        <th width="80" align="right" id="total_order_qty"><?= $total_qty; ?></th>
                        <th width="60"></th>
                        <th width="80" align="right" id="total_order_amount"><?= $total_amount; ?></th>
                        <th width="60"></th>
                        <th></th>
                    </tr>
                </tfoot>
            </table>
            </div> 
	</fieldset>
		<script>
				var tableFilters = 
				{
					col_operation: {
					id: ["total_order_qty","total_order_amount"],
					col: [6,8],
					operation: ["sum","sum"],
					write_method: ["innerHTML","innerHTML"]
					}
				}
			setFilterGrid("rcvinfopopup",-1,tableFilters);
		</script>
	<?
}
if($action=='fabric_issue_popup'){
	echo load_html_head_contents("Fabric Receive Info", "../../../", 1,1,$unicode,1,1);

	$finis_fab_issue_data=sql_select("SELECT x.issue_number, a.issue_qnty , g.id as booking_id , h.style_ref_no, h.job_no,x.issue_date, d.prod_id, d.cons_uom, d.cons_quantity, d.cons_rate, d.cons_amount,x.remarks  from inv_wvn_finish_fab_iss_dtls a join product_details_master p on p.id=a.prod_id join order_wise_pro_details c on c.trans_id=a.trans_id join wo_booking_dtls f on c.po_breakdown_id=f.po_break_down_id join wo_booking_mst g on g.booking_no=f.booking_no JOIN pro_batch_create_mst m on g.booking_no=m.booking_no join inv_transaction d on m.id=d.batch_id and c.trans_id=d.id join INV_ISSUE_MASTER x on x.id=a.mst_id join wo_po_break_down j on j.id=c.po_breakdown_id join wo_po_details_master h on h.id=j.job_id where a.status_active =1 and a.is_deleted =0 and f.booking_type=1 and f.is_short=2 and c.entry_form=19 and c.trans_type=2 and g.id=$data group by x.issue_number, a.issue_qnty , g.id  , d.cons_amount, h.style_ref_no, h.job_no,x.issue_date, d.prod_id, d.cons_uom, d.cons_quantity, d.cons_rate, x.remarks");
	 ?>
	<fieldset style="width:800px">
        <div style="width:100%;" align="center">
            <table cellpadding="0" width="100%" class="rpt_table" rules="all" border="1">
                <thead>
                	<tr>
                    	<th colspan="11">Fabric Issue Info</th>
                    </tr>
                    <tr>
                        <th width="30">SL</th>
                        <th width="100">Issue No</th>
                        <th width="100">Style No</th>
                        <th width="100">Job No</th>
                        <th width="60">Issue Date</th>
                        <th width="60">UOM</th>
                        <th width="80">Issue Qty.</th>
                        <th width="60">Rate (USD)</th>
                        <th width="80">Value (USD)</th>
                        <th width="60">Product ID</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
            </table>
            <table cellpadding="0" width="100%" id="rcvinfopopup" class="rpt_table" rules="all" border="1">
                <tbody>
                	<? $i=1;
                	foreach ($finis_fab_issue_data as $row) { ?>
	                	<tr>
	                        <td width="30"><?= $i; ?></td>
	                        <td width="100"><?= $row[csf('issue_number')]; ?></td>
	                        <td width="100"><?= $row[csf('style_ref_no')]; ?></td>
	                        <td width="100"><?= $row[csf('job_no')]; ?></td>
	                        <td width="60"><?= change_date_format($row[csf('issue_date')]); ?></td>
	                        <td width="60"><?= $unit_of_measurement[$row[csf('cons_uom')]]; ?></td>
	                        <td width="80" align="right"><?= $row[csf('cons_quantity')]; ?></td>
	                        <td width="60" align="right"><?= $row[csf('cons_rate')]; ?></td>
	                        <td width="80" align="right"><?= $row[csf('cons_amount')]; ?></td>
	                        <td width="60" align="right"><?= $row[csf('prod_id')]; ?></td>
	                        <td><?= $row[csf('remarks')]; ?></td>
	                    </tr>
                	<? 
                	$total_qty+=$row[csf('cons_quantity')];
                	$total_amount+=$row[csf('cons_amount')];
                	$i++;
                	} 
                	?>                    
                </tbody>
                </table>
                <table cellpadding="0" width="100%"  class="rpt_table" rules="all" border="1">
                <tfoot>
                	<tr>
                		<th width="30"></th>
                        <th width="100"></th>
                        <th width="100"></th>
                        <th width="100"></th>
                        <th width="60"></th>
                        <th width="60" align="right">Total</th>
                        <th width="80" align="right" id="total_order_qty"><?= $total_qty; ?></th>
                        <th width="60"></th>
                        <th width="80" align="right" id="total_order_amount"><?= $total_amount; ?></th>
                        <th width="60"></th>
                        <th></th>
                    </tr>
                </tfoot>
            </table>
            </div> 
	</fieldset>
		<script>
				var tableFilters = 
				{
					col_operation: {
					id: ["total_order_qty","total_order_amount"],
					col: [6,8],
					operation: ["sum","sum"],
					write_method: ["innerHTML","innerHTML"]
					}
				}
			setFilterGrid("rcvinfopopup",-1,tableFilters);
		</script>
	<?
}
if($action=='trims_receive_popup'){
	echo load_html_head_contents("Trims Receive Info", "../../../", 1,1,$unicode,1,1);
	$expData=explode('_',$data);

	$finis_trims_rcv_data=sql_select("SELECT b.pi_wo_batch_no,b.prod_id, a.currency_id,c.quantity, c.order_amount, c.order_rate, a.recv_number, a.receive_date, g.style_ref_no, g.job_no,e.cons_uom, a.remarks from inv_receive_master a, inv_transaction b, order_wise_pro_details c,inv_trims_entry_dtls e ,  wo_po_break_down f, wo_po_details_master g where a.id=b.mst_id and b.id=c.trans_id and e.id=c.dtls_id and e.trans_id=c.trans_id and e.mst_id=a.id and e.prod_id=b.prod_id and  f.id=c.po_breakdown_id and f.job_id=g.id and c.trans_type=1 and a.entry_form=24 and c.entry_form=24 and b.item_category in(4) and c.status_active=1 and c.is_deleted=0 and e.status_active=1 and e.is_deleted=0 and b.transaction_type=1 and b.pi_wo_batch_no>0 and a.receive_basis in(2,12) and b.pi_wo_batch_no=$expData[0]"); ?>
	<fieldset style="width:800px">
        <div style="width:100%;" align="center">
            <table cellpadding="0" width="100%" class="rpt_table" rules="all" border="1">
                <thead>
                	<tr>
                    	<th colspan="11">Trims Receive Info</th>
                    </tr>
                    <tr>
                        <th width="30">SL</th>
                        <th width="100">MRR No</th>
                        <th width="100">Style No</th>
                        <th width="100">Job No</th>
                        <th width="60">Receive Date</th>
                        <th width="60">UOM</th>
                        <th width="80">Qty.</th>
                        <th width="60">Rate (USD)</th>
                        <th width="80">Value (USD)</th>
                        <th width="60">Product ID</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
            </table>
            <table cellpadding="0" width="100%" id="rcvinfopopup" class="rpt_table" rules="all" border="1">
                <tbody>
                	<? $i=1;
                	foreach ($finis_trims_rcv_data as $row) {
                		if($row[csf('currency_id')]==2) $recv_usd_amt=$row[csf('order_amount')];
						else $recv_usd_amt=$row[csf('order_amount')]/$expData[1];
                	 ?>
	                	<tr>
	                        <td width="30"><?= $i; ?></td>
	                        <td width="100"><?= $row[csf('recv_number')]; ?></td>
	                        <td width="100"><?= $row[csf('style_ref_no')]; ?></td>
	                        <td width="100"><?= $row[csf('job_no')]; ?></td>
	                        <td width="60"><?= change_date_format($row[csf('receive_date')]); ?></td>
	                        <td width="60"><?= $unit_of_measurement[$row[csf('cons_uom')]]; ?></td>
	                        <td width="80" align="right"><?= $row[csf('quantity')]; ?></td>
	                        <td width="60" align="right"><?= $row[csf('order_rate')]; ?></td>
	                        <td width="80" align="right"><?= $recv_usd_amt; ?></td>
	                        <td width="60" align="right"><?= $row[csf('prod_id')]; ?></td>
	                        <td><?= $row[csf('remarks')]; ?></td>
	                    </tr>
                	<? 
                	$total_qty+=$row[csf('quantity')];
                	$total_amount+=$recv_usd_amt;
                	$i++;
                	} 
                	?>                    
                </tbody>
                </table>
                <table cellpadding="0" width="100%"  class="rpt_table" rules="all" border="1">
                <tfoot>
                	<tr>
                		<th width="30"></th>
                        <th width="100"></th>
                        <th width="100"></th>
                        <th width="100"></th>
                        <th width="60"></th>
                        <th width="60" align="right">Total</th>
                        <th width="80" align="right" id="total_order_qty"><?= $total_qty; ?></th>
                        <th width="60"></th>
                        <th width="80" align="right" id="total_order_amount"><?= $total_amount; ?></th>
                        <th width="60"></th>
                        <th></th>
                    </tr>
                </tfoot>
            </table>
            </div> 
	</fieldset>
		<script>
				var tableFilters = 
				{
					col_operation: {
					id: ["total_order_qty","total_order_amount"],
					col: [6,8],
					operation: ["sum","sum"],
					write_method: ["innerHTML","innerHTML"]
					}
				}
			setFilterGrid("rcvinfopopup",-1,tableFilters);
		</script>
	<?
}
if($action=='trims_issue_popup'){
	echo load_html_head_contents("Trims Issue Info", "../../../", 1,1,$unicode,1,1);
	$expData=explode('_',$data);

	$finis_trims_rcv_data=sql_select(" SELECT b.quantity as quantity, g.id as booking_id,b.order_rate as rate, h.style_ref_no, h.job_no, d.issue_number, d.issue_date, a.uom, b.order_amount,a.remarks,a.prod_id from inv_issue_master d join inv_trims_issue_dtls a on a.mst_id=d.id join product_details_master p on a.prod_id=p.id join order_wise_pro_details b on a.trans_id=b.trans_id join wo_po_break_down e on e.id=b.po_breakdown_id join wo_booking_dtls f on e.id=f.po_break_down_id join wo_booking_mst g on g.booking_no=f.booking_no join wo_po_details_master h on e.job_id=h.id where b.trans_type=2 and b.entry_form=25 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and f.booking_type=2 and f.is_short=2 and f.is_deleted=0 and f.status_active=1 and g.is_deleted=0 and g.status_active=1 and g.id=$expData[0] group by b.quantity , g.id ,b.order_rate,h.style_ref_no, h.job_no, d.issue_number, d.issue_date, a.uom,b.order_amount,a.remarks,a.prod_id"); ?>
	 <fieldset style="width:800px">
        <div style="width:100%;" align="center">
            <table cellpadding="0" width="100%" class="rpt_table" rules="all" border="1">
                <thead>
                	<tr>
                    	<th colspan="11">Trims Issue Info</th>
                    </tr>
                    <tr>
                        <th width="30">SL</th>
                        <th width="100">Issue No</th>
                        <th width="100">Style No</th>
                        <th width="100">Job No</th>
                        <th width="60">Issue Date</th>
                        <th width="60">UOM</th>
                        <th width="80">Qty.</th>
                        <th width="60">Avg. Rate(USD)</th>
                        <th width="80">Value (USD)</th>
                        <th width="60">Product ID</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
            </table>
            <table cellpadding="0" width="100%" id="rcvinfopopup" class="rpt_table" rules="all" border="1">
                <tbody>
                	<? $i=1;
                	foreach ($finis_trims_rcv_data as $row) {                	 ?>
	                	<tr>
	                        <td width="30"><?= $i; ?></td>
	                        <td width="100"><?= $row[csf('issue_number')]; ?></td>
	                        <td width="100"><?= $row[csf('style_ref_no')]; ?></td>
	                        <td width="100"><?= $row[csf('job_no')]; ?></td>
	                        <td width="60"><?= change_date_format($row[csf('issue_date')]); ?></td>
	                        <td width="60"><?= $unit_of_measurement[$row[csf('uom')]]; ?></td>
	                        <td width="80" align="right"><?= $row[csf('quantity')]; ?></td>
	                        <td width="60" align="right"><?= $row[csf('rate')]; ?></td>
	                        <td width="80" align="right"><?= $row[csf('order_amount')]; ?></td>
	                        <td width="60" align="right"><?= $row[csf('prod_id')]; ?></td>
	                        <td><?= $row[csf('remarks')]; ?></td>
	                    </tr>
                	<? 
                	$total_qty+=$row[csf('quantity')];
                	$total_amount+=$row[csf('order_amount')];
                	$i++;
                	} 
                	?>                    
                </tbody>
                </table>
                <table cellpadding="0" width="100%"  class="rpt_table" rules="all" border="1">
                <tfoot>
                	<tr>
                		<th width="30"></th>
                        <th width="100"></th>
                        <th width="100"></th>
                        <th width="100"></th>
                        <th width="60"></th>
                        <th width="60" align="right">Total</th>
                        <th width="80" align="right" id="total_order_qty"><?= $total_qty; ?></th>
                        <th width="60"></th>
                        <th width="80" align="right" id="total_order_amount"><?= $total_amount; ?></th>
                        <th width="60"></th>
                        <th></th>
                    </tr>
                </tfoot>
            </table>
            </div> 
	</fieldset>
		<script>
				var tableFilters = 
				{
					col_operation: {
					id: ["total_order_qty","total_order_amount"],
					col: [6,8],
					operation: ["sum","sum"],
					write_method: ["innerHTML","innerHTML"]
					}
				}
			setFilterGrid("rcvinfopopup",-1,tableFilters);
		</script>
	<?
}





if($action=="show_fabric_booking_report_print20")//Print B20
{
	extract($_REQUEST);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
	$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
	$txt_job_no=str_replace("'","",$txt_job_no);
	$show_yarn_rate=str_replace("'","",$show_yarn_rate);
	$revised_no=str_replace("'","",$revised_no);
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1 and master_tble_id='$cbo_company_name'",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	$marchentrArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info ","id","team_member_name");
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$brand_name_arr=return_library_array( "select id, brand_name from lib_buyer_brand ",'id','brand_name');
	$user_name_arr=return_library_array( "select id, user_full_name from user_passwd ",'id','user_full_name');
 
	//$location_name_arr=return_library_array( "select id,location_name from lib_location",'id','location_name');
	
	//$po_qnty_tot=return_field_value( "sum(plan_cut)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	//$po_qnty_tot1=return_field_value( "sum(po_quantity)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	//wo_pre_cost_fabric_cost_dtls
	$pro_sub_dept_array=return_library_array( "select id,sub_department_name from lib_pro_sub_deparatment",'id','sub_department_name');
	?>
	<style type="text/css">
		@media print {
		    .pagebreak { page-break-before: always; } /* page-break-after works, as well */
		}
	</style>
	<div style="width:1330px" align="center">
    <?php
    	$lip_yarn_count=return_library_array( "select id,fabric_composition_id from lib_yarn_count_determina_mst where  status_active=1", "id", "fabric_composition_id");
		$fabric_composition=return_library_array( "select id,fabric_composition_name from lib_fabric_composition where  status_active=1", "id", "fabric_composition_name");

		
		$nameArray_approved = sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7");
		list($nameArray_approved_row) = $nameArray_approved;
		$nameArray_approved_date = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
		list($nameArray_approved_date_row) = $nameArray_approved_date;
		$nameArray_approved_comments = sql_select("select b.comments as comments from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
		list($nameArray_approved_comments_row) = $nameArray_approved_comments;

		$max_approve_date_data = sql_select("select min(b.approved_date) as approved_date,max(b.approved_date) as last_approve_date,max(b.un_approved_date) as un_approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7");
		$first_approve_date='';
		$last_approve_date='';
		$un_approved_date='';
		if(count($max_approve_date_data))
		{
			$last_approve_date=$max_approve_date_data[0][csf('last_approve_date')];
			$first_approve_date=$max_approve_date_data[0][csf('approved_date')];
			$un_approved_date=$max_approve_date_data[0][csf('un_approved_date')];
		}
		
		  if($txt_job_no!="") $location=return_field_value( "location_name", "wo_po_details_master","job_no='$txt_job_no'");
             else $location="";
		$sql_loc=sql_select("select id,location_name,address from lib_location where company_id=$cbo_company_name");
		foreach($sql_loc as $row)
		{
			$location_name_arr[$row[csf('id')]]= $row[csf('location_name')];
			$location_address_arr[$row[csf('id')]]= $row[csf('address')];
		}		
		$yes_no_sql=sql_select("select job_no,cons_process from  wo_pre_cost_fab_conv_cost_dtls where job_no='$txt_job_no'  and status_active=1 and is_deleted=0  order by id");
		
		$peach='';
		$brush='';
		$fab_wash='';
		// foreach ($yes_no_sql as $row) {
			
		// 	if (strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'peach') !== false)
        // 	{
		// 	    if(!empty($peach))
		// 	    {
		// 	    	$peach.=",".$conversion_cost_head_array[$row[csf('cons_process')]];
		// 	    }
		// 	    else{
		// 	    	$peach.=$conversion_cost_head_array[$row[csf('cons_process')]];
		// 	    }
			   
		// 	}
		// 	if (strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'brush') !== false)
        // 	{
		// 	    if(!empty($brush))
		// 	    {
		// 	    	$brush.=",".$conversion_cost_head_array[$row[csf('cons_process')]];
		// 	    }
		// 	    else{
		// 	    	$brush.=$conversion_cost_head_array[$row[csf('cons_process')]];
		// 	    }

		// 	}
		// 	if (strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'wash') !== false)
        // 	{
		// 	    if(!empty($fab_wash))
		// 	    {
		// 	    	$fab_wash.=",".$conversion_cost_head_array[$row[csf('cons_process')]];
		// 	    }
		// 	    else{
		// 	    	$fab_wash.=$conversion_cost_head_array[$row[csf('cons_process')]];
		// 	    }

		// 	}			

		// }
		// $emb_print=sql_select("select id, job_no, emb_name, emb_type from wo_pre_cost_embe_cost_dtls where  job_no='$txt_job_no' and status_active=1 and is_deleted=0 order by id");

		// $emb_print_data=array();
		// $type_array=array(0=>$blank_array,1=>$emblishment_print_type,2=>$emblishment_embroy_type,3=>$emblishment_wash_type,4=>$emblishment_spwork_type,5=>$emblishment_gmts_type,99=>$blank_array);
		// foreach ($emb_print as $row) 
		// {
		// 	$emb_print_data[$row[csf('job_no')]][$row[csf('emb_name')]].=$type_array[$row[csf("emb_name")]][$row[csf('emb_type')]].",";
		// }



		$emb_print=sql_select("select id, job_no, emb_name, emb_type from wo_pre_cost_embe_cost_dtls where  job_no='$txt_job_no' and status_active=1 and is_deleted=0 and cons_dzn_gmts>0 and emb_name in (1,2,3) order by id");
		
		


		$emb_print_data=array();
		$type_array=array(0=>$blank_array,1=>$emblishment_print_type,2=>$emblishment_embroy_type,3=>$emblishment_wash_type,4=>$emblishment_spwork_type,5=>$emblishment_gmts_type,99=>$blank_array);
		
		foreach ($emb_print as $row) 
		{
			$emb_print_data[$row[csf('job_no')]][$row[csf('emb_name')]].=$type_array[$row[csf("emb_name")]][$row[csf('emb_type')]].",";
		}
		

		// echo "<pre>";
		// print_r();

		$nameArray=sql_select( "select c.booking_no, c.booking_date, c.supplier_id, c.currency_id, c.exchange_rate, c.attention, c.delivery_date, c.po_break_down_id,c.colar_excess_percent, c.cuff_excess_percent, c.delivery_date, c.is_apply_last_update, c.fabric_source, c.rmg_process_breakdown,c.insert_date, c.update_date, a.tagged_booking_no, a.uom, a.pay_mode, c.booking_percent, b.job_no, b.buyer_name, b.style_ref_no,b.gmts_item_id, b.order_uom, b.total_set_qnty, b.style_description, b.season_buyer_wise as season, b.product_dept, b.product_code,b.pro_sub_dep, b.dealing_marchant,b.factory_marchant, b.order_repeat_no,b.repeat_job_no, a.fabric_composition, a.remarks,a.sustainability_standard,b.brand_id,a.quality_level,a.fab_material,a.requisition_no,b.qlty_label,b.packing,b.job_no,c.APPROVED_NO from wo_booking_mst a join wo_booking_mst_hstry c on c.booking_id=a.id, wo_po_details_master b where a.job_no=b.job_no and c.APPROVED_NO=$revised_no and a.booking_no=$txt_booking_no ");
		
		
		
		$po_id_all=$nameArray[0][csf('po_break_down_id')];
		$job_no_str=$nameArray[0][csf('job_no')];
		$booking_uom=$nameArray[0][csf('uom')];
		$bookingup_date=$nameArray[0][csf('update_date')];
		$bookingins_date=$nameArray[0][csf('insert_date')];
		$delivery_date=$nameArray[0][csf('delivery_date')];
		$requisition_no=$nameArray[0][csf('requisition_no')];
		
		$job_yes_no=sql_select("select id, job_id,job_no, gmts_item_id, set_item_ratio, smv_pcs, smv_set, smv_pcs_precost, smv_set_precost, complexity, embelishment, cutsmv_pcs, cutsmv_set, finsmv_pcs, finsmv_set, printseq, embro, embroseq, wash, washseq, spworks, spworksseq, gmtsdying, gmtsdyingseq, ws_id, aop, aopseq,bush,bushseq,peach,peachseq,yd,ydseq from wo_po_details_mas_set_details where job_no='$job_no_str'");

		$po_shipment_date=sql_select("select  MIN(pub_shipment_date) as min_shipment_date,max(pub_shipment_date) as max_shipment_date from wo_po_break_down where id in(".$po_id_all.") order by shipment_date asc ");
         $min_shipment_date='';
         $max_shipment_date='';
         foreach ($po_shipment_date as $row) {
         	 $min_shipment_date=$row[csf('min_shipment_date')];
         	 $max_shipment_date=$row[csf('max_shipment_date')];
         	 break;
         }

        $po_running_cancel= sql_select("select case when status_active=1 then  PO_NUMBER end as running_po, case when status_active>1 then po_number end as cancel_po,po_quantity from wo_po_break_down  where id in(".$po_id_all.") order by shipment_date asc ");
        $running_po='';
        $cancel_po='';
        $running_po_qnty=0;
        foreach ($po_running_cancel as $row) {
        	if(!empty($row[csf('running_po')]))
        	{
        		if(!empty($running_po))
        		{
        			$running_po.=",".$row[csf('running_po')];
        		}
        		else{
        			$running_po.=$row[csf('running_po')];
        		}
        		 $running_po_qnty+=$row[csf('po_quantity')];
        	}
        	if(!empty($row[csf('cancel_po')]))
        	{
        		if(!empty($cancel_po))
        		{
        			$cancel_po.=",".$row[csf('cancel_po')];
        		}
        		else{
        			$cancel_po.=$row[csf('cancel_po')];
        		}
        	}
        }
        $stype_color_res=sql_select("select  stripe_type from wo_pre_stripe_color where job_no='$txt_job_no' and status_active=1 and is_deleted=0 group by stripe_type");
        $stype_color='';
        foreach ($stype_color_res as $val) {
        	if(!empty($stype_color))
        	{
        		$stype_color.=", ".$stripe_type_arr[$val[csf('stripe_type')]];
        	}
        	else
        	{
        		$stype_color=$stripe_type_arr[$val[csf('stripe_type')]];
        	}
        	
        }
        $yd_aop_sql=sql_select("select id, job_no,  color_type_id from wo_pre_cost_fabric_cost_dtls where job_no='$txt_job_no' and status_active=1 and is_deleted=0 order by id asc");

        $yd='';
        $aop='';
		foreach ($yes_no_sql as $row) {
			
			if (strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'peach') !== false)
        	{
			    if(!empty($peach))
			    {
			    	$peach.=",".$conversion_cost_head_array[$row[csf('cons_process')]];
			    }
			    else{
			    	$peach.=$conversion_cost_head_array[$row[csf('cons_process')]];
			    }
			   
			}
			if (strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'brush') !== false || strtolower($conversion_cost_head_array[$row[csf('cons_process')]])==strtolower('Brushing at Main Fabric Booking') || strtolower($conversion_cost_head_array[$row[csf('cons_process')]])==strtolower('Brushing at Main Fabric Booking') || strtolower($conversion_cost_head_array[$row[csf('cons_process')]])==strtolower('Brush [With Finish]') || strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'brushing') !== false)
        	{
			    if(!empty($brush))
			    {
			    	$brush.=",".$conversion_cost_head_array[$row[csf('cons_process')]];
			    }
			    else{
			    	$brush.=$conversion_cost_head_array[$row[csf('cons_process')]];
			    }

			}
			if (strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'wash') !== false || strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'washing') !== false)
        	{
			    if(!empty($fab_wash))
			    {
			    	$fab_wash.=",".$conversion_cost_head_array[$row[csf('cons_process')]];
			    }
			    else{
			    	$fab_wash.=$conversion_cost_head_array[$row[csf('cons_process')]];
			    }

			}
			if (strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'y/d') !== false || strtolower($conversion_cost_head_array[$row[csf('cons_process')]])==strtolower('YD at Main Fabric Booking') || strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'yarn dyeing') !== false)
        	{
			    if(!empty($yd))
			    {
			    	$yd.=",".$conversion_cost_head_array[$row[csf('cons_process')]];
			    }
			    else{
			    	$yd.=$conversion_cost_head_array[$row[csf('cons_process')]];
			    }

			}
			if (strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'aop') !== false || strtolower($conversion_cost_head_array[$row[csf('cons_process')]])==strtolower('All Over Printing'))
        	{
			    if(!empty($aop))
			    {
			    	$aop.=",".$conversion_cost_head_array[$row[csf('cons_process')]];
			    }
			    else{
			    	$aop.=$conversion_cost_head_array[$row[csf('cons_process')]];
			    }

			}

			

		}
       

		?>	
											<!--    Header Company Information         -->
        <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black; font-family:Arial Narrow;" >
            <tr>
                <td width="200" style="font-size:28px"><img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' /></td>
                <td width="1250">
                    <table width="100%" cellpadding="0" cellspacing="0"  >
                        <tr>
                            <td align="center" style="font-size:28px;"> <?php echo $company_library[$cbo_company_name]; ?></td>
                            
                        </tr>
                        <tr>
                            <td align="center" style="font-size:18px">
                           <?
                                                      
                            echo $location_address_arr[$location];
                           ?> 
                            </td>
                            
                        </tr>
                        <tr>
                            <td align="center" style="font-size:24px">
                            <span style="float:center;"><b><strong> <font style="color:black">Main Fabric Booking </font></strong></b></span> 
                               
                            </td>
                            
                        </tr>
						
                        <tr>
                            <td align="center" style="font-size:20px">
							<?
							if(str_replace("'","",$id_approved_id) ==1){ ?>
                            <span style="font-size:20px; float:center;"><strong> <font style="color:green"> <? echo "[Approved]"; ?> </font></strong></span> 
                               <?}else{?>

								<span style="font-size:20px; float:center;"><strong> <font style="color:red"><? echo "[Not Approved]"; ?> </font></strong></span> 

							   <?}?>
                            </td>
                            
                        </tr>
                    </table>
                </td>
                <td width="200">
                	<table style="border:1px solid black; font-family:Arial Narrow;" width="100%">
                		<tr>
                			<td><b>Min. Ship Date:</b></td>
                			<td><b><?php echo  date('d-m-Y',strtotime($min_shipment_date));?></b></td>
                		</tr>
                		<tr>
                			<td><b>Max. Ship Date:</b></td>
                			<td><b><?php echo date('d-m-Y',strtotime($max_shipment_date));?></b></td>
                		</tr>
                	</table>
                	<br>
                	<table style="border:1px solid black; font-family:Arial Narrow;font-size: 10px;" width="100%">
                		<tr>
                			<td>Printing Date :</td>
                			<td><?php echo  date('d-m-Y');?></td>
                		</tr>
                		<tr>
                			<td>Printing Time:</td>
                			<td><?php echo  date('h:i:sa');?></td>
                		</tr>
                		<tr>
                			<td>User Name:</td>
                			<td><?php echo $user_name_arr[$user_id];?></td>
                		</tr>
                		<tr>
                			<?php 

                				function get_client_ip() {
								    $ipaddress = '';
								    if (getenv('HTTP_CLIENT_IP'))
								        $ipaddress = getenv('HTTP_CLIENT_IP');
								    else if(getenv('HTTP_X_FORWARDED_FOR'))
								        $ipaddress = getenv('HTTP_X_FORWARDED_FOR');
								    else if(getenv('HTTP_X_FORWARDED'))
								        $ipaddress = getenv('HTTP_X_FORWARDED');
								    else if(getenv('HTTP_FORWARDED_FOR'))
								        $ipaddress = getenv('HTTP_FORWARDED_FOR');
								    else if(getenv('HTTP_FORWARDED'))
								       $ipaddress = getenv('HTTP_FORWARDED');
								    else if(getenv('REMOTE_ADDR'))
								        $ipaddress = getenv('REMOTE_ADDR');
								    else
								        $ipaddress = 'UNKNOWN';
								    return $ipaddress;
								}

                			 ?>
                			<td>IP Address:</td>
                			<td><?php if(empty($user_ip)){echo get_client_ip();} echo $user_ip;?></td>
                		</tr>
                	</table>
                </td>
            </tr>
        </table>
		<?
		
       
		
        $job_no=trim($txt_job_no,"'"); $total_set_qnty=0; $colar_excess_percent=0; $cuff_excess_percent=0; $rmg_process_breakdown=0; $booking_percent=0; $booking_po_id='';
		
        
		
		if($db_type==0)
        {
            $date_dif_cond="DATEDIFF(pub_shipment_date,po_received_date)";
            $group_concat_all="group_concat(grouping) as grouping, group_concat(file_no) as file_no";
        }
        else
        {
            $date_dif_cond="(pub_shipment_date-po_received_date)";
            $group_concat_all=" listagg(cast(grouping as varchar2(4000)),',') within group (order by grouping) as grouping,
                                listagg(cast(file_no as varchar2(4000)),',') within group (order by file_no) as file_no  ";
        }
        $po_number_arr=array(); $po_ship_date_arr=array(); $shipment_date=""; $po_no=""; $po_received_date=""; $shiping_status="";
        $po_sql=sql_select("select id, po_number, pub_shipment_date, MIN(pub_shipment_date) as mpub_shipment_date, MIN(po_received_date) as po_received_date, MIN(insert_date) as insert_date, plan_cut, po_quantity, shiping_status, $date_dif_cond as date_diff,min(factory_received_date) as factory_received_date, $group_concat_all from wo_po_break_down where id in(".$po_id_all.") group by id, po_number, pub_shipment_date, plan_cut, po_quantity, shiping_status, po_received_date");
      
        $to_ship=0;
        $fp_ship=0;
        $f_ship=0;

        foreach($po_sql as $row)
        {
            $po_qnty_tot+=$row[csf('plan_cut')];
            $po_qnty_tot1+=$row[csf('po_quantity')];
            $po_number_arr[$row[csf('id')]]=$row[csf('po_number')];
            $po_ship_date_arr[$row[csf('id')]]=$row[csf('pub_shipment_date')];
            $po_num_arr[$row[csf('id')]]=$row[csf('po_number')];
            $po_no.=$row[csf('po_number')].", ";
            $shipment_date.=change_date_format($row[csf('mpub_shipment_date')],'dd-mm-yyyy','-').", ";
            $lead_time.=$row[csf('date_diff')].",";
            $po_received_date=change_date_format($row[csf('po_received_date')],'dd-mm-yyyy','-');
            $factory_received_date=change_date_format($row[csf('factory_received_date')],'dd-mm-yyyy','-');
            $grouping.=$row[csf('grouping')].",";
            $file_no.=$row[csf('file_no')].",";
			
			$daysInHand.=(datediff('d',date('d-m-Y',time()),$row[csf('mpub_shipment_date')])-1).",";
			
			if($bookingup_date=="" || $bookingup_date=="0000-00-00 00:00:00")
			{
				$booking_date=$bookingins_date;
			}
			$WOPreparedAfter.=(datediff('d',$row[csf('insert_date')],$booking_date)-1).",";

			if($row[csf('shiping_status')]==1) {
				$shiping_status.= "FP".",";
				$to_ship++;
				$fp_ship++;
			}
			else if($row[csf('shiping_status')]==2){
				$shiping_status.= "PD".",";
				$to_ship++;
			} 
			else if($row[csf('shiping_status')]==3){
				$shiping_status.= "FS".",";
				$to_ship++;
				$f_ship++;
			} 

			
        }

        if($to_ship==$f_ship)
        {
        	$shiping_status= "Full shipped";
        }
        else if($to_ship==$fp_ship)
        {
        	$shiping_status= "Full Pending";
        }
        else{
        	$shiping_status= "Partial Delivery";
        }
       
		
		$po_no=implode(",",array_filter(array_unique(explode(",",$po_no))));
		$shipment_date=implode(",",array_filter(array_unique(explode(",",$shipment_date))));
		$lead_time=implode(",",array_filter(array_unique(explode(",",$lead_time))));
		$po_received_date=implode(",",array_filter(array_unique(explode(",",$po_received_date))));
		$factory_received_date=implode(",",array_filter(array_unique(explode(",",$factory_received_date))));
		$grouping=implode(",",array_filter(array_unique(explode(",",$grouping))));
		$file_no=implode(",",array_filter(array_unique(explode(",",$file_no))));
		
		$daysInHand=implode(",",array_filter(array_unique(explode(",",$daysInHand))));
		$WOPreparedAfter=implode(",",array_filter(array_unique(explode(",",$WOPreparedAfter))));
		$shiping_status=implode(",",array_filter(array_unique(explode(",",$shiping_status))));
		
        foreach ($nameArray as $result)
        {
            $total_set_qnty=$result[csf('total_set_qnty')];
            $colar_excess_percent=$result[csf('colar_excess_percent')];
            $cuff_excess_percent=$result[csf('cuff_excess_percent')];
            $rmg_process_breakdown=$result[csf('rmg_process_breakdown')];
            
            $booking_percent=$result[csf('booking_percent')];
			$booking_po_id=$result[csf('po_break_down_id')];

			?>
			<table width="100%" class="rpt_table"  border="1" align="left" cellpadding="0"  cellspacing="0" rules="all"  style="font-size:18px; font-family:Arial Narrow;" >
				<tr>
					<td colspan="2" rowspan="6" width="210">
						<? $nameArray_imge =sql_select("SELECT image_location FROM common_photo_library where master_tble_id='$job_no' and file_type=1"); ?>
                        <div id="div_size_color_matrix" style="float:left;">
                            <fieldset id="" width="210">
                                <legend>Image </legend>
                                <table width="208">
                                    <tr>
										<?
                                        $img_counter = 0;
                                        foreach($nameArray_imge as $result_imge)
                                        {
											if($path=="") $path='../../';
											?>
											<td><img src="<? echo $path.$result_imge[csf('image_location')]; ?>" width="200" height="200" border="2" /></td>
											<?
											$img_counter++;
                                        }
                                        ?>
                                    </tr>
                                </table>
                            </fieldset>
                        </div>
					</td>
					<td width="100"><b>Job No</b></td>
					<?php 
						
					 	

					 ?>
					<td width="140"> <span style="font-size:18px"><b style="float:left;font-size:18px"><? echo trim($txt_job_no,"'");if(!empty($revised_no)){ ?>&nbsp;<span style="color: red;">/&nbsp;<? echo $revised_no; }?></span></b> </span> </td>
					<td colspan="7" width="760">
						<b><?php if(!empty($result[csf('remarks')])){ ?><span style="font-size: 25px;">&#8592;</span><? echo $result[csf('remarks')]; } ?></b>
					</td>
					
				</tr>
				<?php

					$order_yes_no=sql_select("Select embelishment ,embro ,wash  ,spworks ,gmtsdying , ws_id , aop , aopseq , bush ,  peach, yd    from wo_po_details_mas_set_details where job_no='$txt_job_no' order by id");			

				?>
				<tr>
					<td width="100" style="font-size:16px;"><b>Style</b></td>
					<td width="110"style="font-size:16px;" >&nbsp;<? echo $result[csf('style_ref_no')]; ?></td>
					
					<td width="100" style="font-size:16px;"><b>Dept. (Prod Code)</b></td>
					<td width="140"style="font-size:16px;" >&nbsp;<? echo $product_dept[$result[csf('product_dept')]]; if($result[csf('product_code')] !=""){ echo " (".$result[csf('product_code')].")";} ?></td>
					
					
					<td width="100"><b>YD</b></td>
					<td width="110"><?php echo (!empty($yd) || $order_yes_no[0][csf('yd')]==1)  ? 'Yes' : 'No' ;?></td>
					<td width="100"><?php 	echo $yd; ?></td>
					<td width="110"><b>Fac. Order Received Date</b></td>
					<td width="100"><?php echo $factory_received_date; ?></td>
				</tr>
				<tr>
					<td width="100"><span style="font-size:18px"><b>Buyer/Agent Name</b></span></td>
					<td width="110">&nbsp;<span style="font-size:18px"><? echo $buyer_name_arr[$result[csf('buyer_name')]]; ?></span></td>
					
					<td width="100"><b>Sub Dep</b></td>
					<td width="140"><? if($result[csf('pro_sub_dep')] !=0){ echo " (".$pro_sub_dept_array[$result[csf('pro_sub_dep')]].")";}?></td>
					<td width="100"><b>AOP</b></td>
					
					<td width="110"><?php echo   ($order_yes_no[0][csf('aop')]==1 || (!empty($aop))) ? 'Yes' : 'No' ;?></td>
					<td width="100"><?=$aop;?></td>
					<td width="110"><b>Booking Start<br>Appoval Date</b></td>
					<td width="100">
						<?php if(!empty($first_approve_date)){ echo date('d-m-Y',strtotime($first_approve_date)); } ?><br>
						<?php if(!empty($last_approve_date)){ echo date('d-m-Y',strtotime($last_approve_date)); } ?>
							
						</td>
					
				</tr>
				<tr>
					<td width="100"><span style="font-size:18px"><b>Garments Item</b></span></td>
					<td width="110">&nbsp;<span style="font-size:18px"> <?
                        $gmts_item_name="";
                        $gmts_item=explode(',',$result[csf('gmts_item_id')]);
                        for($g=0;$g<=count($gmts_item); $g++)
                        {
                            $gmts_item_name.= $garments_item[$gmts_item[$g]].",";
                        }
                        echo rtrim($gmts_item_name,',');
                        ?></span></td>
					
					<td width="100"><b>Season</b></td>
					<td width="140"><? echo $season_name_arr[$result[csf('season')]]; ?></td>
					<td width="100"><b>Peach</b></td>
					
				<td width="110"><?php echo  ($job_yes_no[0][csf('peach')]==1 || (!empty($peach))) ? 'Yes' : 'No' ;?></td>
					<td width="100"><?=$peach;?></td>
					<td width="110"><b>Approved Status</b></td>
					<td width="100">
					<? if(str_replace("'","",$id_approved_id) ==1){ ?>
					<b style="color:green"><?	echo "Yes";?></b>
					<?}else{?><b style="color:red"><?	echo "No";?></b><?}; ?></td>
					
				</tr>
				<tr>
					<td width="100"><span style="font-size:18px"><b>Sample Req. No</b></span></td>
					<td width="110">&nbsp;<span style="font-size:18px"><?php echo $requisition_no; ?></span></td>
					
					<td width="100"><b>Brand</b></td>
					<td width="140"><?php echo $brand_name_arr[$result[csf('brand_id')]]; ?></td>
					<td width="100"><b>Brushing</b></td>
					
					<td width="110"><?php echo  ($job_yes_no[0][csf('bush')]==1 ||  (!empty($brush))) ? 'Yes' : 'No' ;?></td>
					<td width="100"><?=$brush;?></td>
					<td width="110"><b>Booking Date</b></td>
					<td width="100"> <?
                        if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
                        {
                        }
                        $booking_date=$result[csf('insert_date')];
                        echo change_date_format($booking_date,'dd-mm-yyyy','-','');
                        ?>
                        	
                    </td>
					
				</tr>
				<tr>
					<td width="100"><span style="font-size:18px"><b>Booking No</b></span></td>
					<td width="110"><span style="font-size:18px"><b><? echo $result[csf('booking_no')];?></b><? echo "<br>(".$fabric_source[$result[csf('fabric_source')]].")"?></span></td>
					
					<td width="100"><b>Order Repeat No</b></td>
					<td width="140"><? echo  $result[csf('order_repeat_no')];?></td>

					<td width="100"><b>Print / Type</b></td>
					<td width="110"><?php echo   ($order_yes_no[0][csf('embelishment')]==1 || (!empty($emb_print_data[$txt_job_no][1]))) ? 'Yes' : 'No' ;?></td>
					<td width="100"><?php echo  !empty($emb_print_data[$txt_job_no][1]) ? chop($emb_print_data[$txt_job_no][1],",") : '' ;?></td>
					
					<td width="110"><b>Delivery Date</b></td>
					<td width="100"> 
                        <? echo change_date_format($delivery_date); ?>
                        	
                    </td>
					
				</tr>
				<tr>
					<td width="100"><span style="font-size:18px"><b>Running PO No</b></span></td>
					<td width="350" colspan="3" style="word-break: break-all;">
						<p style="font-size:12px;width: 450px;word-break: break-all;" ><?
					 echo $running_po; ?></p>
					</td>
					
					<td width="100"><b>Order Repeat Job No</b></td>
					<td width="110"><? echo $result[csf('repeat_job_no')];?></td>

					<td width="100"><b>EMB / Type</b></td>
					
					<td width="110"><?php echo  ($order_yes_no[0][csf('embro')]==1 || (!empty($emb_print_data[$txt_job_no][2]))) ? 'Yes' : 'No' ;?></td>
					<td width="100"><?php echo  !empty($emb_print_data[$txt_job_no][2]) ? chop($emb_print_data[$txt_job_no][2],",") : '' ;?></td>

					<td width="110"><b>Amendment Date</b></td>
					<td width="100"> 
                        <? if(!empty($un_approved_date)){echo change_date_format($un_approved_date);} ?>
                        	
                    </td>
					
					
				</tr>
				<tr>
					<td width="100"><span style="font-size:18px"><b>Cancelled PO</b></span></td>
					<td width="350" colspan="3" ><p style="font-size:12px;width: 450px;word-break: break-all;"><?
					 echo $cancel_po; ?></p></td>		

					<?php $fab_material=array(1=>"Organic",2=>"BCI"); ?>
					<td width="100"><b>Fab. Material</b> </td>
					<td width="110"><?php echo $fab_material[$result[csf('fab_material')]]; ?></td>


					<td width="100"><b>GMT Wash</b></td>
					
					<td width="110"><?php echo  ($order_yes_no[0][csf('wash')]==1 || (!empty($emb_print_data[$txt_job_no][3]))) ? 'Yes' : 'No' ;?></td>
					<td width="100"><?php echo  !empty($emb_print_data[$txt_job_no][3]) ? chop($emb_print_data[$txt_job_no][3],",") : '' ;?></td>

					<td width="110"><b>Dealing Merchandiser</b></td>
					<td width="100"> 
                        <? echo $marchentrArr[$result[csf('dealing_marchant')]]; ?>
                        	
                    </td>
					
				</tr>
				<tr>
					<td width="100"><span style="font-size:18px"><b>GMT/ Style Description</b></span></td>
					<td width="350" colspan="3"><span style="font-size:18px"><? echo $result[csf('style_description')]; ?></span></td>
					
					
					 
					<td width="100"><b>Sustainability Standard</b></td>
					<td width="110"><?php echo $sustainability_standard[$result[csf('sustainability_standard')]]; ?></td>
					

					<td width="100"><b>Fab Wash</b></td>
					<td width="110"><?php echo !empty($fab_wash)? 'Yes' : 'No'; ?></td>


					<td width="100"><?=$fab_wash?></td>
					
					<td width="110"><b>Factory Merchandiser</b></td>
					<td width="100"> 
                        
                         <? echo $marchentrArr[$result[csf('factory_marchant')]]; ?>
                        	
                    </td>
				</tr>
				<tr>
					<td width="100"><span style="font-size:18px"><b>Fabric Description</b></span></td>
					<td width="350" colspan="3"><span style="font-size:18px">

						<? 

							$sql_fab="
							  SELECT 
							         a.lib_yarn_count_deter_id AS determin_id,
							         a.construction
							        
							        
							    FROM wo_pre_cost_fabric_cost_dtls a,
							         wo_pre_cos_fab_co_avg_con_dtls b,
							         wo_booking_dtls d
							   WHERE     a.job_id = b.job_id
							         AND a.id = b.pre_cost_fabric_cost_dtls_id
							         AND a.id = d.pre_cost_fabric_cost_dtls_id
							         AND b.po_break_down_id = d.po_break_down_id
							         AND b.color_size_table_id = d.color_size_table_id
							         AND b.pre_cost_fabric_cost_dtls_id = d.pre_cost_fabric_cost_dtls_id
							         AND d.booking_no = $txt_booking_no
							         AND a.status_active = 1
							         AND d.status_active = 1
							         AND d.is_deleted = 0
							          and a.body_part_id in (1,20)

							    group by a.lib_yarn_count_deter_id , a.construction
							";
							//echo $sql_fab;
							$res_fab=sql_select($sql_fab);
							$des='';
							foreach ($res_fab as $row) 
							{

								if(!empty($des))
								{
									$des."***";
								}
								$des.=$row[csf('construction')] . " ". $fabric_composition[$lip_yarn_count[$row[csf('determin_id')]]];
							}

							echo implode(",", array_unique(explode("***", $des)));

						?>
							
						</span></td>
					
					
					<td width="100"><b>Order Nature</b></td>
					<td width="110"><?php echo $fbooking_order_nature[$result[csf('quality_level')]] ?></td>
					<td width="100"><b>Running Order Qty</b></td>
					<?php $order_uom_res=sql_select( "select a.order_uom from wo_po_details_master a where a.status_active=1 and a.is_deleted=0  and a.job_no='$txt_job_no' ");
						$order_uom='';
						if(count($order_uom_res))
						{
							$order_uom=$unit_of_measurement[$order_uom_res[0][csf('order_uom')]];
						}
					 ?>
					<td width="210" colspan="2" align="center"><b> <?php echo number_format($running_po_qnty,0); ?>&nbsp;(<?=$order_uom;?>)</b></td>
					
					
					<td width="110"><b>Shipment Status</b></td>
					<td width="100"> 
                        <? echo rtrim($shiping_status,','); ?>
                        	
                    </td>
				</tr>
				<tr>
					<td width="100"><span style="font-size:18px"><b>Attention</b></span></td>
					<td  width="350" colspan="3"><span style="font-size:18px"><? echo $result[csf('attention')]?></span></td>
					
					<td width="100"><b>Quality Label</b></td>
					<td width="110"><?php echo $quality_label[$result[csf('qlty_label')]] ?></td>
					<td width="100"><b>Packing</b></td>
					
					<td width="420" colspan="4" align="center"><b> <?php echo $packing[$result[csf('packing')]]; ?></b></td>					
				</tr>				
			</table>
			<br>
			<?
		}		
		if($cbo_fabric_source==1)
		{
			$nameArray_size=sql_select( "select size_number_id,min(id) as id, min(size_order) as size_order from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by size_number_id order by size_order");
			?>
			<table width="100%" style="font-family:Arial Narrow;font-size:18px" >
                <tr>
                    <td width="900">
                        <div id="div_size_color_matrix" style="float:left; max-width:1000;">
                            <fieldset id="div_size_color_matrix" style="max-width:1000;">
                                <legend>Size and Color Breakdown</legend>
                                <table  class="rpt_table"  border="1" align="left" cellpadding="0" width="1000" cellspacing="0" rules="all" >
                                    <tr>
                                        <td style="border:1px solid black"><strong>Color/Size</strong></td>
                                        <?
                                        foreach($nameArray_size  as $result_size)
                                        {
											?>
                                        	<td align="center" style="border:1px solid black"><strong><?=$size_library[$result_size[csf('size_number_id')]];?></strong></td>
                                        <? } ?>
                                        <td style="border:1px solid black; width:130px" align="center"><strong> Total Order Qty(Pcs)</strong></td>
                                        <td style="border:1px solid black; width:80px" align="center"><strong> Excess %</strong></td>
                                        <td style="border:1px solid black; width:130px" align="center"><strong> Total Plan Cut Qty(Pcs)</strong></td>
                                    </tr>
                                    <?
                                    $color_size_order_qnty_array=array(); $color_size_qnty_array=array(); $size_tatal=array(); $size_tatal_order=array();
                                    for($c=0;$c<count($gmts_item); $c++)
                                    {
										$item_size_tatal=array(); $item_size_tatal_order=array(); $item_grand_total=0; $item_grand_total_order=0;
										$nameArray_color=sql_select( "select  color_number_id,min(id) as id,min(color_order) as color_order from wo_po_color_size_breakdown where  item_number_id=$gmts_item[$c] and po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id  order by color_order");
										?>
										<tr>
											<td style="border:1px solid black; text-align:center;" colspan="<? echo count($nameArray_size)+3;?>"><strong><? echo $garments_item[$gmts_item[$c]];?></strong></td>
										</tr>
										<?
										foreach($nameArray_color as $result_color)
										{
											?>
											<tr>
                                                <td align="center" style="border:1px solid black"><?=$color_library[$result_color[csf('color_number_id')]]; ?></td>
                                                <?
                                                $color_total=0; $color_total_order=0;
                                                foreach($nameArray_size  as $result_size)
                                                {
													$nameArray_color_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as  order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$result_color[csf('color_number_id')]."  and item_number_id=$gmts_item[$c] and  status_active=1 and is_deleted =0");
													foreach($nameArray_color_size_qnty as $result_color_size_qnty)
													{
														?>
														<td style="border:1px solid black; text-align:center; font-size:18px;">
														<?
														if($result_color_size_qnty[csf('plan_cut_qnty')]!= "")
														{
															echo number_format($result_color_size_qnty[csf('order_quantity')],0);
															$color_total += $result_color_size_qnty[csf('plan_cut_qnty')] ;
															$color_total_order += $result_color_size_qnty[csf('order_quantity')] ;
															$item_grand_total+=$result_color_size_qnty[csf('plan_cut_qnty')];
															$item_grand_total_order+=$result_color_size_qnty[csf('order_quantity')];
															$grand_total +=$result_color_size_qnty[csf('plan_cut_qnty')];
															$grand_total_order +=$result_color_size_qnty[csf('order_quantity')];
															
															$color_size_qnty_array[$result_size[csf('size_number_id')]][$result_color[csf('color_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
															$color_size_order_qnty_array[$result_size[csf('size_number_id')]][$result_color[csf('color_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
															if (array_key_exists($result_size[csf('size_number_id')], $size_tatal))
															{
																$size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
																$size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
															}
															else
															{
																$size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
																$size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
															}
															if (array_key_exists($result_size[csf('size_number_id')], $item_size_tatal))
															{
																$item_size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
																$item_size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
															}
															else
															{
																$item_size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
																$item_size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
															}
														}
														else echo "0";
														?>
														</td>
														<?
													}
                                                }
                                                ?>
                                                <td style="border:1px solid black; text-align:center; font-size:18px;"><?=number_format(round($color_total_order),0); ?></td>
                                                <td style="border:1px solid black; text-align:center; font-size:18px;"><? $excexss_per=($color_total-$color_total_order)/$color_total_order*100; echo number_format($excexss_per,2)." %"; ?></td>
                                                <td style="border:1px solid black; text-align:center; font-size:18px;"><?=number_format(round($color_total),0); ?></td>
											</tr>
											<?
										}
										?>
										
										<td align="center" style="border:1px solid black"><strong>Sub Total</strong></td>
										<?
										foreach($nameArray_size  as $result_size)
										{
											?>
											<td style="border:1px solid black;  text-align:center; font-size:18px;"><? echo $item_size_tatal_order[$result_size[csf('size_number_id')]];  ?></td>
											<?
										}
										?>
										<td style="border:1px solid black;  text-align:center; font-size:18px;"><?  echo number_format(round($item_grand_total_order),0); ?></td>
										<td style="border:1px solid black;  text-align:center; font-size:18px;"><? $excess_item_gra_tot=($item_grand_total-$item_grand_total_order)/$item_grand_total_order*100; echo number_format($excess_item_gra_tot,2)." %"; ?></td>
										<td style="border:1px solid black;  text-align:center; font-size:18px;"><?  echo number_format(round($item_grand_total),0); ?></td>
										</tr>
										<?
                                    }
                                    ?>
                                    <tr>
                                    	<td style="border:1px solid black; font-size:18px;" align="center" colspan="<? echo count($nameArray_size)+3; ?>"><strong>&nbsp;</strong></td>
                                    </tr>
                                    <tr>
                                        <td align="center" style="border:1px solid black"><strong>Grand Total</strong></td>
                                        <?
                                        foreach($nameArray_size  as $result_size)
                                        {
											?>
											<td style="border:1px solid black; text-align:center; font-size:18px;"><? echo $size_tatal_order[$result_size[csf('size_number_id')]]; ?></td>
											<?
                                        }
                                        ?>
                                        <td style="border:1px solid black; text-align:center; font-size:18px;"><?=number_format(round($grand_total_order),0); ?></td>
                                        <td style="border:1px solid black; text-align:center; font-size:18px;"><? $excess_gra_tot=($grand_total-$grand_total_order)/$grand_total_order*100; echo number_format($excess_gra_tot,2)." %"; ?></td>
                                        <td style="border:1px solid black; text-align:center; font-size:18px;"><?  echo number_format(round($grand_total),0); ?></td>
                                    </tr>
                                </table>
                            </fieldset>
                        </div>
                    </td>
                    <td width="130" valign="top" align="left">
                        <div id="div_size_color_matrix" style="float:left;">
							
                        </div>
                    </td>
                    <td width="200" valign="top" align="right">
						
                        <div id="div_size_color_matrix" style="float:right;font-size:18px;font-family:Arial Narrow;">
                           <? $rmg_process_breakdown_arr=explode('_',$rmg_process_breakdown); ?>
                            <fieldset id="" >
                                <legend>RMG Process Loss % </legend>
                                <table width="180" class="rpt_table" border="1" rules="all">
									<?
                                    if(number_format($rmg_process_breakdown_arr[8],2)>0)
                                    {
										?>
										<tr>
                                            <td width="130">Cut Panel rejection <!-- Extra Cutting % breack Down 8--></td>
                                            <td align="right"><? echo number_format($rmg_process_breakdown_arr[8],2); ?></td>
										</tr>
										<?
                                    }
                                    if(number_format($rmg_process_breakdown_arr[2],2)>0)
                                    {
										?>
										<tr>
                                            <td width="130">Chest Printing <!-- Printing % breack Down 2--></td>
                                            <td align="right"><? echo number_format($rmg_process_breakdown_arr[2],2); ?></td>
										</tr>
										<?
                                    }
                                    if(number_format($rmg_process_breakdown_arr[10],2)>0)
                                    {
										?>
										<tr>
                                            <td width="130">Neck/Sleeve Printing <!-- New breack Down 10--></td>
                                            <td align="right"><? echo number_format($rmg_process_breakdown_arr[10],2); ?></td>
										</tr>
										<?
                                    }
                                    if(number_format($rmg_process_breakdown_arr[1],2)>0)
                                    {
										?>
										<tr>
                                            <td width="130">Embroidery   <!-- Embroidery  % breack Down 1--></td>
                                            <td align="right"><? echo number_format($rmg_process_breakdown_arr[1],2); ?></td>
										</tr>
										<?
                                    }
                                    if(number_format($rmg_process_breakdown_arr[4],2)>0)
                                    {
										?>
										<tr>
                                            <td width="130">Sewing /Input<!-- Sewing % breack Down 4--></td>
                                            <td align="right"><? echo number_format($rmg_process_breakdown_arr[4],2); ?></td>
										</tr>
										<?
                                    }
                                    if(number_format($rmg_process_breakdown_arr[3],2)>0)
                                    {
										?>
										<tr>
                                            <td width="130">Garments Wash <!-- Washing %breack Down 3--></td>
                                            <td align="right"><? echo number_format($rmg_process_breakdown_arr[3],2); ?></td>
										</tr>
										<?
                                    }
                                    if(number_format($rmg_process_breakdown_arr[15],2)>0)
                                    {
										?>
										<tr>
                                            <td width="130">Gmts Finishing <!-- Washing %breack Down 3--></td>
                                            <td align="right"><? echo number_format($rmg_process_breakdown_arr[15],2); ?></td>
										</tr>
										<?
                                    }
                                    if(number_format($rmg_process_breakdown_arr[11],2)>0)
                                    {
										?>
										<tr>
                                            <td width="130">Others <!-- New breack Down 11--></td>
                                            <td align="right"><? echo number_format($rmg_process_breakdown_arr[11],2); ?></td>
										</tr>
										<?
                                    }
                                    $gmts_pro_sub_tot=$rmg_process_breakdown_arr[8]+$rmg_process_breakdown_arr[2]+$rmg_process_breakdown_arr[10]+$rmg_process_breakdown_arr[1]+$rmg_process_breakdown_arr[4]+$rmg_process_breakdown_arr[3]+$rmg_process_breakdown_arr[11]+$rmg_process_breakdown_arr[15];
                                    if($gmts_pro_sub_tot>0)
                                    {
										?>
										<tr>
                                            <td width="130">Sub Total <!-- New breack Down 11--></td>
                                            <td align="right"><? echo number_format($gmts_pro_sub_tot,2); ?></td>
										</tr>
										<?
                                    }
                                    ?>
                                </table>
                            </fieldset>
                            <fieldset id="" >
                                <legend>Fabric Process Loss % </legend>
                                <table width="180" class="rpt_table" border="1" rules="all" style="font-family:Arial Narrow;">
                                    <?
                                    if(number_format($rmg_process_breakdown_arr[6],2)>0)
                                    {
										?>
										<tr>
                                            <td width="130">Knitting  <!--  Knitting % breack Down 6--></td>
                                            <td align="right"><? echo number_format($rmg_process_breakdown_arr[6],2); ?></td>
										</tr>
										<?
                                    }
                                    if(number_format($rmg_process_breakdown_arr[12],2)>0)
                                    {
										?>
										<tr>
                                            <td width="130">Yarn Dyeing  <!--  New breack Down 12--></td>
                                            <td align="right"><? echo number_format($rmg_process_breakdown_arr[12],2); ?></td>
										</tr>
										<?
                                    }
                                    if(number_format($rmg_process_breakdown_arr[5],2)>0)
                                    {
										?>
										<tr>
                                            <td width="130">Dyeing & Finishing  <!-- Finishing % breack Down 5--></td>
                                            <td align="right"><? echo number_format($rmg_process_breakdown_arr[5],2); ?></td>
										</tr>
										<?
                                    }
                                    if(number_format($rmg_process_breakdown_arr[13],2)>0)
                                    {
										?>
										<tr>
                                            <td width="130"> All Over Print <!-- new  breack Down 13--></td>
                                            <td align="right"><? echo number_format($rmg_process_breakdown_arr[13],2); ?></td>
										</tr>
										<?
                                    }
                                    if(number_format($rmg_process_breakdown_arr[14],2)>0)
                                    {
										?>
										<tr>
                                            <td width="130">Lay Wash (Fabric) <!-- new  breack Down 14--></td>
                                            <td align="right"><? echo number_format($rmg_process_breakdown_arr[14],2); ?></td>
										</tr>
										<?
                                    }
                                    if(number_format($rmg_process_breakdown_arr[7],2)>0)
                                    {
										?>
										<tr>
                                            <td width="130">Dying   <!-- breack Down 7--></td>
                                            <td align="right"><? echo number_format($rmg_process_breakdown_arr[7],2); ?></td>
										</tr>
										<?
                                    }
                                    if(number_format($rmg_process_breakdown_arr[0],2)>0)
                                    {
										?>
										<tr>
                                            <td width="130">Cutting (Fabric) <!-- Cutting % breack Down 0--></td>
                                            <td align="right"><? echo number_format($rmg_process_breakdown_arr[0],2); ?></td>
										</tr>
										<?
                                    }
                                    if(number_format($rmg_process_breakdown_arr[9],2)>0)
                                    {
										?>
										<tr>
                                            <td width="130">Others  <!-- Others% breack Down 9--></td>
                                            <td align="right"><? echo number_format($rmg_process_breakdown_arr[9],2); ?></td>
										</tr>
										<?
                                    }

                                    $fab_proce_sub_tot=$rmg_process_breakdown_arr[6]+$rmg_process_breakdown_arr[12]+$rmg_process_breakdown_arr[5]+$rmg_process_breakdown_arr[13]+$rmg_process_breakdown_arr[14]+$rmg_process_breakdown_arr[7]+$rmg_process_breakdown_arr[0]+$rmg_process_breakdown_arr[9];
                                    if(fab_proce_sub_tot>0)
                                    {
										?>
										<tr>
                                            <td width="130">Sub Total  <!-- Others% breack Down 9--></td>
                                            <td align="right"><? echo number_format($fab_proce_sub_tot,2); ?></td>
										</tr>
										<?
                                    }
                                    if($gmts_pro_sub_tot+$fab_proce_sub_tot>0)
                                    {
										?>
										<tr>
                                            <td width="130">Grand Total  <!-- Others% breack Down 9--></td>
                                            <td align="right"><? echo number_format($gmts_pro_sub_tot+$fab_proce_sub_tot,2); ?></td>
										</tr>
										<?
                                    }
                                    ?>
                                </table>
                            </fieldset>
                        </div>
                    </td>
                </tr>
			</table>
			<?
		}
		// if($cbo_fabric_source==1) end
		
	  	?>
		<br/>
		<br>
      	<!--  Here will be the main portion  -->
		<?
        $costing_per=""; $costing_per_qnty=0;
        $costing_per_id=return_field_value( "costing_per", "wo_pre_cost_mst","job_no ='$job_no'");
        if($costing_per_id==1)
        {
			$costing_per="1 Dzn";
			$costing_per_qnty=12;
        }
        if($costing_per_id==2)
        {
			$costing_per="1 Pcs";
			$costing_per_qnty=1;
        }
        if($costing_per_id==3)
        {
			$costing_per="2 Dzn";
			$costing_per_qnty=24;
        }
        if($costing_per_id==4)
        {
			$costing_per="3 Dzn";
			$costing_per_qnty=36;
        }
        if($costing_per_id==5)
        {
			$costing_per="4 Dzn";
			$costing_per_qnty=48;
        }

        $process_loss_method=return_field_value( "process_loss_method", "wo_pre_cost_fabric_cost_dtls","job_no='$job_no'");
		//$s_length=return_field_value( "stitch_length", "fabric_mapping","mst_id=$determin_id");;
		$s_lengthArr=return_library_array( "select mst_id, stitch_length from fabric_mapping",'mst_id','stitch_length');		
		if($cbo_fabric_source==1)
		{
			$fb_desc_sq="SELECT min(a.id) as fabric_cost_dtls_id, a.lib_yarn_count_deter_id as determin_id, a.item_number_id, a.body_part_id, a.color_type_id, a.construction, a.composition, a.gsm_weight, min(a.width_dia_type) as width_dia_type,  b.dia_width, avg(b.cons) as cons, avg(b.process_loss_percent) as process_loss_percent, avg(b.requirment) as requirment FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d WHERE a.job_id=b.job_id and a.id=b.pre_cost_fabric_cost_dtls_id  and a.id=d.pre_cost_fabric_cost_dtls_id  and b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and d.booking_no=$txt_booking_no and a.status_active=1 and d.status_active=1 and d.is_deleted=0 group by a.body_part_id, a.lib_yarn_count_deter_id, a.color_type_id, a.item_number_id, a.construction, a.composition, a.gsm_weight,  b.dia_width order by fabric_cost_dtls_id, a.body_part_id, b.dia_width";
			
			$nameArray_fabric_description= sql_select($fb_desc_sq);
			?>
			<table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" style="font-family:Arial Narrow;font-size:18px;" >
                <tr align="center">
                    <th colspan="3" align="left">Body Part</th>
                    <?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
						if( $result_fabric_description[csf('body_part_id')] == "") echo "<td  colspan='2'>&nbsp</td>";
						else echo "<td colspan='2'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
                    }
                    ?>
                    <td rowspan="10" width="50"><p>Total  Finish Fabric (<? echo $unit_of_measurement[$booking_uom];?>)</p></td>
                    <td rowspan="10" width="50"><p>Total Grey Fabric (<? echo $unit_of_measurement[$booking_uom];?>)</p></td>
                    <td rowspan="10" width="50"><p>Process Loss % </p></td>
                </tr>
                <tr align="center">
                    <th colspan="3" align="left">Color Type</th>
                    <?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
						if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='2'>&nbsp</td>";
						else echo "<td  colspan='2'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
                    }
                    ?>
                </tr>
                <tr align="center">
                    <th colspan="3" align="left">Fabric Construction</th>
                    <?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
						if($result_fabric_description[csf('construction')]== "") echo "<td  colspan='2'>&nbsp</td>";
						else echo "<td  colspan='2'>". $result_fabric_description[csf('construction')]."</td>";
                    }
                    ?>
                </tr>
                 <tr align="center">
                    <th colspan="3" align="left">Fabric Composition</th>
                    <?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
						if($result_fabric_description[csf('determin_id')]== "") echo "<td  colspan='2'>&nbsp</td>";
						else echo "<td  colspan='2'>". $fabric_composition[$lip_yarn_count[$result_fabric_description[csf('determin_id')]]]."</td>";
                    }
                    ?>
                </tr>
                <tr align="center">
                    <th colspan="3" align="left">Yarn Composition</th>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
						if( $result_fabric_description[csf('composition')] == "") echo "<td colspan='2' >&nbsp</td>";
						else echo "<td colspan='2' >".$result_fabric_description[csf('composition')]."</td>";
                    }
                    ?>
                </tr>
                <tr align="center">
                	<th colspan="3" align="left">GSM</th>
					<?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
						if( $result_fabric_description[csf('gsm_weight')] == "") echo "<td colspan='2'>&nbsp</td>";
						else echo "<td colspan='2' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
                    }
                    ?>
                </tr>
               
                <tr align="center">
                    <th colspan="3" align="left">Dia/Width (Inch)</th>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
						if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='2'>&nbsp</td>";
						else echo "<td colspan='2' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
                    }
                    ?>
                </tr>
                <tr align="center">
                    <th   colspan="3" align="left">Consumption For <? echo $costing_per; ?></th>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
						if( $result_fabric_description[csf('requirment')] == "")   echo "<td colspan='2'>&nbsp</td>";
						else echo "<td colspan='2' align='center'>A Fin: ".number_format($result_fabric_description[csf('cons')],4).", Grey: ".number_format($result_fabric_description[csf('requirment')],4)."</td>";
                    }
                    ?>
                </tr>
                <tr>
                	<th colspan="<? echo  count($nameArray_fabric_description)*2+3; ?>" align="left" style="height:30px">&nbsp;</th>
                </tr>
                <tr>
                    <th width="120" align="left">Fabric Color</th>
                    <th width="120" align="left">GMT Color</th>
                    <th width="120" align="left">Lab Dip No</th>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
                   		echo "<th width='50'>Finish</th><th width='50' >Grey</th>";
                    }
                    ?>
                </tr>
                <?
                $color_wise_wo_sql = "SELECT a.item_number_id, a.body_part_id, a.color_type_id, a.construction, a.composition, a.gsm_weight, a.lib_yarn_count_deter_id, b.dia_width, b.remarks, d.fabric_color_id, d.fin_fab_qnty as fin_fab_qnty, d.grey_fab_qnty as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a join wo_pre_cos_fab_co_avg_con_dtls b on  a.id=b.pre_cost_fabric_cost_dtls_id join wo_po_color_size_breakdown c on c.id=b.color_size_table_id join wo_booking_dtls d on b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id WHERE  d.booking_no =$txt_booking_no and a.uom=12 and d.status_active=1 and  d.is_deleted=0 ";
                
                $color_wise_wo_sql_res=sql_select($color_wise_wo_sql); $fin_grey_qty_arr=array(); $fin_grey_color_qty_arr=array();
                foreach($color_wise_wo_sql_res as $row)
                {
					$fin_grey_key = $row[csf('item_number_id')].'**'.$row[csf('body_part_id')].'**'.$row[csf('color_type_id')].'**'.$row[csf('construction')].'**'.$row[csf('composition')].'**'.$row[csf('gsm_weight')].'**'.$row[csf('lib_yarn_count_deter_id')].'**'.$row[csf('dia_width')];
					$fin_grey_color_key = $row[csf('item_number_id')].'**'.$row[csf('body_part_id')].'**'.$row[csf('color_type_id')].'**'.$row[csf('construction')].'**'.$row[csf('composition')].'**'.$row[csf('gsm_weight')].'**'.$row[csf('lib_yarn_count_deter_id')].'**'.$row[csf('dia_width')].'**'.$row[csf('fabric_color_id')];
					$fin_grey_qty_arr[$fin_grey_key]['fin'] += $row[csf('fin_fab_qnty')];
					$fin_grey_qty_arr[$fin_grey_key]['grey'] += $row[csf('grey_fab_qnty')];
					$fin_grey_color_qty_arr[$fin_grey_color_key]['fin'] +=$row[csf('fin_fab_qnty')];
					$fin_grey_color_qty_arr[$fin_grey_color_key]['grey'] +=$row[csf('grey_fab_qnty')];
                }
                unset($color_wise_wo_sql_res);
                
                $gmt_color_library=array();
                $gmt_color_data=sql_select("select a.id,b.gmts_color_id, b.contrast_color_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.fabric_source =$cbo_fabric_source and a.job_no ='$job_no' and a.status_active=1 and b.status_active=1 order by a.id");
                foreach( $gmt_color_data as $gmt_color_row)
                {
                	$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
                }
                
                $lab_dip_no_arr=array();
                $lab_dip_no_sql=sql_select("select lapdip_no, color_name_id from wo_po_lapdip_approval_info where job_no_mst='$job_no' and status_active=1 and is_deleted=0 and approval_status=3");
                foreach($lab_dip_no_sql as $row)
                {
                	$lab_dip_no_arr[$row[csf('color_name_id')]]=$row[csf('lapdip_no')];
                }
                unset($lab_dip_no_sql);
                
                $grand_total_fin_fab_qnty=0; $grand_total_grey_fab_qnty=0; $grand_totalcons_per_finish=0; $grand_totalcons_per_grey=0;
                $color_wise_wo_sql=sql_select("select fabric_color_id FROM wo_booking_dtls WHERE booking_no =$txt_booking_no and status_active=1 and is_deleted=0 group by fabric_color_id");
                foreach($color_wise_wo_sql as $color_wise_wo_result)
                {
					?>
					<tr>
                        <td width="120" align="left"><? echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]]; ?></td>
                        <td><? echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]); ?></td>
                        <td width="120" align="left">
							<?
                            $lapdip_no=""; $lapdip_no=$lab_dip_no_arr[$color_wise_wo_result[csf('fabric_color_id')]];
                            if($lapdip_no=="") echo "&nbsp;"; else echo $lapdip_no;
                            ?>
                        </td>
                        <?
                        $total_fin_fab_qnty=0; $total_grey_fab_qnty=0;
                        foreach($nameArray_fabric_description as $result_fabric_description)
                        {
							$color_wo_fin_qnty=0; $color_wo_grey_qnty=0;
							$fin_gray_color = $result_fabric_description[csf('item_number_id')].'**'.$result_fabric_description[csf('body_part_id')].'**'.$result_fabric_description[csf('color_type_id')].'**'.$result_fabric_description[csf('construction')].'**'.$result_fabric_description[csf('composition')].'**'.$result_fabric_description[csf('gsm_weight')].'**'.$result_fabric_description[csf('determin_id')].'**'.$result_fabric_description[csf('dia_width')].'**'.$color_wise_wo_result[csf('fabric_color_id')];
							$color_wo_fin_qnty=$fin_grey_color_qty_arr[$fin_gray_color]['fin'];
							
							$color_wo_grey_qnty=$fin_grey_color_qty_arr[$fin_gray_color]['grey'];
							?>
							<td width='50' align='center' style="font-size:18px;">
								<?
                                if($color_wo_fin_qnty!="")
                                {
                                    echo number_format($color_wo_fin_qnty,2) ;
                                    $total_fin_fab_qnty+=$color_wo_fin_qnty;
                                }
                                ?>
							</td>
							<td width='50' align='center' style="font-size:18px;">
								<?
                                if($color_wo_grey_qnty!="")
                                {
									echo number_format($color_wo_grey_qnty,2);
									$total_grey_fab_qnty+=$color_wo_grey_qnty;
                                }
                                ?>
							</td>
							<?
                        }
                        ?>
                        <td align="center" style="font-size:18px;"><? echo number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
                        <td align="center" style="font-size:18px;"><? echo number_format($total_grey_fab_qnty,2); $grand_total_grey_fab_qnty+=$total_grey_fab_qnty;?></td>
                        <td align="center" style="font-size:18px;">
                        <?
                        if($process_loss_method==1)
                        {
                        	$process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_fin_fab_qnty)*100;
                        }
                        if($process_loss_method==2)
                        {
                        	$process_percent=(($total_grey_fab_qnty-$total_fin_fab_qnty)/$total_grey_fab_qnty)*100;
                        }
                        echo number_format($process_percent,2);
                        ?>
                        </td>
					</tr>
					<?
                }
                ?>
                <tr style=" font-weight:bold">
                    <th width="120" align="left">&nbsp;</th>
                    <td width="120" align="left">&nbsp;</td>
                    <td width="120" align="left"><strong>Total</strong></td>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
						$wo_fin_qnty=0; $wo_grey_qnty=0;
						$fin_key = $result_fabric_description[csf('item_number_id')].'**'.$result_fabric_description[csf('body_part_id')].'**'.$result_fabric_description[csf('color_type_id')].'**'.$result_fabric_description[csf('construction')].'**'.$result_fabric_description[csf('composition')].'**'.$result_fabric_description[csf('gsm_weight')].'**'.$result_fabric_description[csf('determin_id')].'**'.$result_fabric_description[csf('dia_width')];
						
						$wo_fin_qnty=$fin_grey_qty_arr[$fin_key]['fin'];
						$wo_grey_qnty=$fin_grey_qty_arr[$fin_key]['grey'];
						?>
						<td width='50' align='center' style="font-size:18px;"><?  echo number_format($wo_fin_qnty,2) ;?></td><td width='50' align='center' style="font-size:18px;" > <? echo number_format($wo_grey_qnty,2);?></td>
						<?
                    }
                    ?>
                    <td align="center" style="font-size:18px;"><? echo number_format($grand_total_fin_fab_qnty,2);?></td>
                    <td align="center" style="font-size:18px;"><? echo number_format($grand_total_grey_fab_qnty,2);?></td>
                    <td align="center" style="font-size:18px;">
						<?
                        if($process_loss_method==1)// markup
                        {
                            $totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_fin_fab_qnty)*100;
                        }
                        
                        if($process_loss_method==2) //margin
                        {
                            $totalprocess_percent=(($grand_total_grey_fab_qnty-$grand_total_fin_fab_qnty)/$grand_total_grey_fab_qnty)*100;
                        }
                        echo number_format($totalprocess_percent,2);
                        ?>
                    </td>
                </tr>
                <tr style="font-weight:bold">
                    <th width="120" align="left">&nbsp;</th>
                    <td width="120" align="left">&nbsp;</td>
                    <td width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
						<?
                        foreach($nameArray_fabric_description as $result_fabric_description)
                        {
							?>
							<td width='50' align='center' style="font-size:18px;"></td>
                            <td width='50' align='right' > </td>
							<?
                        }
                        ?>
                    <td align="center" style="font-size:18px;">
						<?
                        //echo $grand_total_fin_fab_qnty;
                        echo number_format(($grand_total_fin_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4);
                        $grand_total_fin_fab_qnty_dzn=number_format(($grand_total_fin_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4);
                        ?>
                    </td>
                    <td align="center" style="font-size:18px;"><? echo number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4);$grand_total_grey_fab_qnty_dzn=number_format(($grand_total_grey_fab_qnty/$grand_total)*($total_set_qnty*$costing_per_qnty),4)?></td>
                    <td align="center" style="font-size:18px;">
						<?
                        if($process_loss_method==1)
                        {
                        	$totalprocess_percent_dzn=(($grand_total_grey_fab_qnty_dzn-$grand_total_fin_fab_qnty_dzn)/$grand_total_fin_fab_qnty_dzn)*100;
                        }
                        
                        if($process_loss_method==2)
                        {
                        	$totalprocess_percent_dzn=(($grand_total_grey_fab_qnty_dzn-$grand_total_fin_fab_qnty_dzn)/$grand_total_grey_fab_qnty_dzn)*100;
                        }
                        echo number_format($totalprocess_percent_dzn,2);
                        ?>
                    </td>
                </tr>
			</table>
			<?
		}
		//echo "kausar"; die;
		if($cbo_fabric_source==2)
		{
			$nameArray_fabric_description= sql_select("select min(a.id) as fabric_cost_dtls_id, e.lib_yarn_count_deter_id as determin_id, e.body_part_id, e.color_type_id, e.construction,e.composition, e.gsm_weight, min(e.width_dia_type) as width_dia_type, b.dia_width, avg(e.avg_finish_cons) as cons,avg(b.process_loss_percent) as process_loss_percent, avg(e.avg_cons) as requirment,e.APPROVED_NO FROM wo_pre_cost_fabric_cost_dtls a left join wo_pre_cost_fabric_cost_dtls_h e on e.PRE_COST_FABRIC_COST_DTLS_ID=a.id, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
			  WHERE a.job_id=b.job_id and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_id=a.job_id and c.id=b.color_size_table_id and 
			  b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and e.APPROVED_NO=$revised_no  and d.booking_no =$txt_booking_no and d.status_active=1 and d.is_deleted=0 group by e.body_part_id, e.lib_yarn_count_deter_id, e.color_type_id, e.construction, e.composition,
		   e.gsm_weight, b.dia_width,e.APPROVED_NO order by fabric_cost_dtls_id, e.body_part_id, b.dia_width");

			
			?>
			<table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" style="font-family:Arial Narrow;font-size:18px;" >
                <tr align="center">
                    <th colspan="3" align="left">Body Part</th>
                    <?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
						if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
						else echo "<td  colspan='3'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
                    }
                    ?>
                    <td rowspan="10" width="50"><p>Total Fabric (<? echo $unit_of_measurement[$booking_uom];?>)</p></td>
                    <td rowspan="10" width="50"><p>Avg Rate (<? echo $unit_of_measurement[$booking_uom];?>)</p></td>
                    <td rowspan="10" width="50"><p>Amount </p></td>
                </tr>
                <tr align="center"><th colspan="3" align="left">Color Type</th>
					<?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
                        if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
                        else echo "<td  colspan='3'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
                    }
                    ?>
                </tr>
                <tr align="center"><th colspan="3" align="left">Fabric Construction</th>
					<?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
						if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='3'>&nbsp</td>";
						else  echo "<td  colspan='3'>". $result_fabric_description[csf('construction')]."</td>";
                    }
                    ?>
                </tr>
                <tr align="center"><th colspan="3" align="left">Fabric Composition</th>
					<?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
						if( $result_fabric_description[csf('determin_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
						else  echo "<td  colspan='3'>". $fabric_composition[$lip_yarn_count[$result_fabric_description[csf('determin_id')]]]."</td>";

						
                    }
                    ?>
                </tr>
                <tr align="center"><th colspan="3" align="left">Yarn Composition</th>
					<?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
						if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='3' >&nbsp</td>";
						else echo "<td colspan='3' >".$result_fabric_description[csf('composition')]."</td>";
                    }
                    ?>
                </tr>
                <tr align="center"><th  colspan="3" align="left">GSM</th>
					<?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
						if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='3'>&nbsp</td>";
						else  echo "<td colspan='3' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
                    }
                    ?>
                </tr>
                
                <tr align="center"><th colspan="3" align="left">Dia/Width (Inch)</th>
					<?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
						if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='3'>&nbsp</td>";
						else echo "<td colspan='3' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
                    }
                    ?>
                </tr>
                <tr align="center"><th   colspan="3" align="left">Consumption For <? echo $costing_per; ?></th>
					<?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
						if( $result_fabric_description[csf('requirment')] == "")   echo "<td colspan='3'>&nbsp</td>";
						else echo "<td colspan='3' align='center'>Fin: ".number_format($result_fabric_description[csf('cons')],2).", Grey: ".number_format($result_fabric_description[csf('requirment')],2)."</td>";
                    }
                    ?>
                </tr>
                <tr>
                	<th colspan="<? echo  count($nameArray_fabric_description)*3+3; ?>" align="left" style="height:30px">&nbsp;</th>
                </tr>
                <tr>
                    <th width="120" align="left">Fabric Color</th>
                    <th width="120" align="left">GMT Color</th>
                    <th width="120" align="left">Lab Dip No</th>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
                    	echo "<th width='50'>Fab. Qty</th><th width='50' >Rate</th><th width='50' >Amount</th>";
                    }
                    ?>
                </tr>
                <?
                $gmt_color_library=array();
                $gmt_color_data=sql_select("select a.id as fab_id,b.gmts_color_id, b.contrast_color_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b  WHERE a.id=b.pre_cost_fabric_cost_dtls_id  and a.fabric_source =$cbo_fabric_source and a.job_no ='$job_no' and a.status_active=1 and b.status_active=1 order by a.id");
	
				// echo "select a.id as fab_id,b.gmts_color_id, b.contrast_color_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b  WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.fabric_source =$cbo_fabric_source and a.job_no ='$job_no' and a.status_active=1 and b.status_active=1 order by a.id";
                foreach( $gmt_color_data as $gmt_color_row)
                {
                	$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
                }
                
                $grand_total_fin_fab_qnty=0; $grand_total_amount=0;
                
                $color_wise_wo_sql=sql_select("select fabric_color_id FROM wo_booking_dtls WHERE booking_no =$txt_booking_no and status_active=1 and is_deleted=0 group by fabric_color_id");
                foreach($color_wise_wo_sql as $color_wise_wo_result)
                {
                ?>
                <tr>
                
                <td  width="120" align="left">
                <?
                echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];
                
                
                ?>
                </td>
                <td>
                <?
                echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
                ?>
                </td>
                <td  width="120" align="left">
                <?
                $lapdip_no="";
                $lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
                if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
                ?>
                </td>
                <?
                $total_fin_fab_qnty=0;
                $total_amount=0;
                
                foreach($nameArray_fabric_description as $result_fabric_description)
                {
                if($db_type==0)
                {
                $color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty, avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
                WHERE a.job_id=b.job_id and
                a.id=b.pre_cost_fabric_cost_dtls_id and
                c.job_id=a.job_id and
                c.id=b.color_size_table_id and
                b.po_break_down_id=d.po_break_down_id and
                b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
                d.booking_no =$txt_booking_no and
                a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
                a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
                a.construction='".$result_fabric_description[csf('construction')]."' and
                a.composition='".$result_fabric_description[csf('composition')]."' and
                a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
                a.lib_yarn_count_deter_id='".$result_fabric_description[csf('determin_id')]."' and
                b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
                d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
                d.status_active=1 and
                d.is_deleted=0
                ");
                }
                if($db_type==2)
                {
                
                $color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
                WHERE a.job_id=b.job_id and
                a.id=b.pre_cost_fabric_cost_dtls_id and
                c.job_id=a.job_id and
                c.id=b.color_size_table_id and
                b.po_break_down_id=d.po_break_down_id and
                b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
                d.booking_no =$txt_booking_no and
                a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
                a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
                a.construction='".$result_fabric_description[csf('construction')]."' and
                a.composition='".$result_fabric_description[csf('composition')]."' and
                a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
                a.lib_yarn_count_deter_id='".$result_fabric_description[csf('determin_id')]."' and
                b.dia_width='".$result_fabric_description[csf('dia_width')]."' and

                nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
                d.status_active=1 and
                d.is_deleted=0
                ");
				
                }
                list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
                ?>
                <td width='50' align='right'>
                <?
                if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
                {
                echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2) ;
                $total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
                }
                ?>
                </td>
                <td width='50' align='right' >
                <?
                if($color_wise_wo_result_qnty[csf('rate')]!="")
                {
                echo number_format($color_wise_wo_result_qnty[csf('rate')],2);
                }
                ?>
                </td>
                <td width='50' align='right' >
                <?
                $amount=$color_wise_wo_result_qnty[csf('grey_fab_qnty')]*$color_wise_wo_result_qnty[csf('rate')];
                if($amount!="")
                {
                echo number_format($amount,2);
                $total_amount+=$amount;
                }
                ?>
                </td>
                <?
                }
                ?>
                <td align="right"><? echo number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
                <td align="right"><? echo number_format($total_amount/$total_fin_fab_qnty,2); $grand_total_amount+=$total_amount;?></td>
                <td align="right">
                <?
                echo number_format($total_amount,2);
                
                ?>
                </td>
                </tr>
                <?
                }
                ?>
                <tr style=" font-weight:bold">
                <!--<td  width="120" align="left">&nbsp;</td>-->
                <th  width="120" align="left">&nbsp;</th>
                <td  width="120" align="left">&nbsp;</td>
                <td  width="120" align="left"><strong>Total</strong></td>
                <?
                foreach($nameArray_fabric_description as $result_fabric_description)
                {
                $color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
                WHERE a.job_id=b.job_id and
                a.id=b.pre_cost_fabric_cost_dtls_id and
                c.job_id=a.job_id and
                c.id=b.color_size_table_id and
                b.po_break_down_id=d.po_break_down_id and
                b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
                d.booking_no =$txt_booking_no and
                a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
                a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
                a.construction='".$result_fabric_description[csf('construction')]."' and
                a.composition='".$result_fabric_description[csf('composition')]."' and
                a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
                a.lib_yarn_count_deter_id='".$result_fabric_description[csf('determin_id')]."' and
                b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
                d.status_active=1 and
                d.is_deleted=0
                ");
                list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
                ?>
                <td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2) ;?></td>
                <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
                <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
                <?
                }
                ?>
                <td align="right"><? echo number_format($grand_total_fin_fab_qnty,2);?></td>
                <td align="right"><? echo number_format($grand_total_amount/$grand_total_fin_fab_qnty,2);?></td>
                <td align="right">
                <?
                echo number_format($grand_total_amount,2);
                ?>
                </td>
                </tr>
                <tr style="font-weight:bold">
                <!--<td  width="120" align="left">&nbsp;</td>-->
                <th  width="120" align="left">&nbsp;</th>
                <td  width="120" align="left">&nbsp;</td>
                <td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
                <?
                foreach($nameArray_fabric_description as $result_fabric_description)
                {
                $color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
                WHERE a.job_id=b.job_id and
                a.id=b.pre_cost_fabric_cost_dtls_id and
                c.job_id=a.job_id and
                c.id=b.color_size_table_id and
                b.po_break_down_id=d.po_break_down_id and
                b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
                d.booking_no =$txt_booking_no and
                a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
                a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
                a.construction='".$result_fabric_description[csf('construction')]."' and
                a.composition='".$result_fabric_description[csf('composition')]."' and
                a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
                a.lib_yarn_count_deter_id='".$result_fabric_description[csf('determin_id')]."' and
                b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
                d.status_active=1 and
                d.is_deleted=0
                ");
                list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
                
                ?>
                <td width='50' align='right'><?  //echo number_format(($color_wise_wo_result_qnty['fin_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td>
                <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
                <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
                <?
                }
                ?>
                <td align="right">
                <?
                $consumption_per_unit_fab=($grand_total_fin_fab_qnty/$po_qnty_tot)*($costing_per_qnty);
                echo number_format($consumption_per_unit_fab,4);
                ?>
                </td>
                <td align="right">
                <?
                $consumption_per_unit_amuont=($grand_total_amount/$po_qnty_tot)*($costing_per_qnty);
                echo number_format(($consumption_per_unit_amuont/$consumption_per_unit_fab),2);
                ?>
                </td>
                <td align="right">
                <?
                echo number_format($consumption_per_unit_amuont,2);
                ?>
                </td>
                </tr>
			</table>
			<?
		}
		?>
        <br/>
        <?
		if($cbo_fabric_source==1)
		{
			$lab_dip_color_arr=array();
			$lab_dip_color_sql=sql_select("select pre_cost_fabric_cost_dtls_id, gmts_color_id, contrast_color_id from wo_pre_cos_fab_co_color_dtls where job_no='$job_no'");
			foreach($lab_dip_color_sql as $row)
			{
				$lab_dip_color_arr[$row[csf('pre_cost_fabric_cost_dtls_id')]][$row[csf('gmts_color_id')]]=$row[csf('contrast_color_id')];
			}
			
			

			$collar_cuff_percent_arr=array(); $collar_cuff_body_arr=array(); $collar_cuff_color_arr=array(); $collar_cuff_size_arr=array(); $collar_cuff_item_size_arr=array(); $color_size_sensitive_arr=array();

			$collar_cuff_sql="select a.id, a.item_number_id, a.color_size_sensitive, a.color_break_down, b.color_number_id, b.gmts_sizes, b.item_size, c.size_number_id, d.colar_cuff_per, e.body_part_full_name, e.body_part_type
			FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c, wo_booking_dtls d, lib_body_part e

			WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=e.id and e.body_part_type in (40,50) and c.id=d.color_size_table_id and d.color_size_table_id=b.color_size_table_id  and d.po_break_down_id=c.po_break_down_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 order by  c.size_order";
			//echo $collar_cuff_sql;
			$collar_cuff_sql_res=sql_select($collar_cuff_sql);
			
			$itemIdArr=array();

			foreach($collar_cuff_sql_res as $collar_cuff_row)
			{
				$collar_cuff_percent_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('color_number_id')]][$collar_cuff_row[csf('gmts_sizes')]]=$collar_cuff_row[csf('colar_cuff_per')];
				$collar_cuff_body_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]]=$collar_cuff_row[csf('body_part_full_name')];
				$collar_cuff_size_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('size_number_id')]]=$collar_cuff_row[csf('size_number_id')];
				if(!empty($collar_cuff_row[csf('item_size')]))
				{
					$collar_cuff_item_size_arr[$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('size_number_id')]][$collar_cuff_row[csf('item_size')]]=$collar_cuff_row[csf('item_size')];
				}
				
				$color_size_sensitive_arr[$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('id')]][$collar_cuff_row[csf('color_number_id')]][$collar_cuff_row[csf('color_size_sensitive')]]=$collar_cuff_row[csf('color_break_down')];
				
				$itemIdArr[$collar_cuff_row[csf('body_part_type')]].=$collar_cuff_row[csf('item_number_id')].',';
			}
			//print_r($collar_cuff_percent_arr[40]) ;
			unset($collar_cuff_sql_res);
			//$count_collar_cuff=count($collar_cuff_size_arr);
			
			$order_plan_qty_arr=array();
			$color_wise_wo_sql_qnty=sql_select( "select item_number_id, color_number_id, size_number_id, sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in ($booking_po_id) and status_active=1 and is_deleted =0  group by item_number_id, color_number_id, size_number_id");//and item_number_id in (".implode(",",$itemIdArr).")
			foreach($color_wise_wo_sql_qnty as $row)
			{
				$order_plan_qty_arr[$row[csf('item_number_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]['plan']=$row[csf('plan_cut_qnty')];
				$order_plan_qty_arr[$row[csf('item_number_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]['order']=$row[csf('order_quantity')];
			}
			unset($color_wise_wo_sql_qnty);

			
			foreach($collar_cuff_body_arr as $body_type=>$body_name)
			{
				$gmtsItemId=array_filter(array_unique(explode(",",$itemIdArr[$body_type])));
				foreach($body_name as $body_val)
				{
					$count_collar_cuff=count($collar_cuff_size_arr[$body_type][$body_val]);
					$pre_grand_tot_collar=0; $pre_grand_tot_collar_order_qty=0;

					?>
                    <div style="max-height:1330px; overflow:auto; float:left; padding-top:5px; margin-left:5px; margin-bottom:5px; position:relative;font-size:18px;">
					<table width="625" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                        <tr>
                        	<td colspan="<? echo $count_collar_cuff+3; ?>" align="center"><b><? echo $body_val; ?> - Color Size Brakedown in Pcs.</b></td>
                        </tr>
                        <tr>
                            <td width="100">Size</td>
								<?
                                foreach($collar_cuff_size_arr[$body_type][$body_val]  as $size_number_id)
                                {
									?>
									<td align="center" style="border:1px solid black"><strong><? echo $size_library[$size_number_id];?></strong></td>
									<?
                                }
                                ?>
                            <td width="60" rowspan="2" align="center"><strong>Total</strong></td>
                            <td rowspan="2" align="center"><strong>Extra %</strong></td>
                        </tr>
                        <tr>
                            <td style="font-size:12px"><? echo $body_val; ?> Size</td>
                            <?
                            foreach($collar_cuff_item_size_arr[$body_val]  as $size_number_id=>$size_number)
                            {
								if(count($size_number)>0)
								{
									 foreach($size_number  as $item_size=>$val)
									 {
										?>
										<td align="center" style="border:1px solid black"><strong><? echo $item_size;?></strong></td>
										<?
									 }
								}
								else
								{
									?>
									<td align="center" style="border:1px solid black"><strong>&nbsp;</strong></td>
									<?
								}
                            }
                            ?>
                        </tr>
                            <?

                            $pre_size_total_arr=array();
                            foreach($color_size_sensitive_arr[$body_val] as $pre_cost_id=>$pre_cost_data)
                            {
								foreach($pre_cost_data as $color_number_id=>$color_number_data)
								{
									foreach($color_number_data as $color_size_sensitive=>$color_break_down)
									{
										$pre_color_total_collar=0;
										$pre_color_total_collar_order_qnty=0;
										$process_loss_method=$process_loss_method;
										$constrast_color_arr=array();
										if($color_size_sensitive==3)
										{
											$constrast_color=explode('__',$color_break_down);
											for($i=0;$i<count($constrast_color);$i++)
											{
												$constrast_color2=explode('_',$constrast_color[$i]);
												$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
											}
										}
										?>
										<tr>
											<td>
												<?
                                                if( $color_size_sensitive==3)
                                                {
                                                    echo strtoupper ($constrast_color_arr[$color_number_id]) ;
                                                    $lab_dip_color_id=$lab_dip_color_arr[$pre_cost_id][$color_number_id];
                                                }
                                                else
                                                {
                                                    echo $color_library[$color_number_id];
                                                    $lab_dip_color_id=$color_number_id;
                                                }
                                                ?>
											</td>
											<?
											foreach($collar_cuff_size_arr[$body_type][$body_val] as $size_number_id)
											{
												?>
												<td align="center" style="border:1px solid black">
													<? $plan_cut=0; $collerqty=0; $collar_ex_per=0;
													$plan_cut=0;
													foreach($gmtsItemId as $giid)
													{
														if($body_type==50) $plan_cut+=($order_plan_qty_arr[$giid][$color_number_id][$size_number_id]['plan'])*2;
														else $plan_cut+=$order_plan_qty_arr[$giid][$color_number_id][$size_number_id]['plan'];
													}
													
                                                    //$ord_qty=$order_plan_qty_arr[$color_number_id][$size_number_id]['order'];

                                                    $collar_ex_per=$collar_cuff_percent_arr[$body_type][$body_val][$color_number_id][$size_number_id];
                                                    // echo $collar_ex_per.'=';

												    if($body_type==50) { if($collar_ex_per==0 || $collar_ex_per=="") $collar_ex_per=$cuff_excess_percent; else $collar_ex_per=$collar_ex_per; }
                                                    else if($body_type==40) { if($collar_ex_per==0 || $collar_ex_per=="") $collar_ex_per=$colar_excess_percent; else $collar_ex_per=$collar_ex_per; }
                                                    $colar_excess_per=number_format(($plan_cut*$collar_ex_per)/100,6,".",",");
                                                    $collerqty=($plan_cut+$colar_excess_per);

                                                    //$collerqty=number_format(($requirment/$costing_per_qnty)*$plan_cut,2,'.','');

                                                    echo number_format($collerqty);
                                                    $pre_size_total_arr[$size_number_id]+=$collerqty;
                                                    $pre_color_total_collar+=$collerqty;
                                                    $pre_color_total_collar_order_qnty+=$plan_cut;

                                                    //$pre_grand_tot_collar_order_qty+=$plan_cut;
                                                    ?>
												</td>
												<?
											}
											?>

											<td align="center"><? echo number_format($pre_color_total_collar); ?></td>
											<td align="center"><? echo number_format((($pre_color_total_collar-$pre_color_total_collar_order_qnty)/$pre_color_total_collar_order_qnty)*100,2); ?></td>
										</tr>
										<?
										$pre_grand_collar_ex_per+=$collar_ex_per;
										$pre_grand_tot_collar+=$pre_color_total_collar;
										$pre_grand_tot_collar_order_qty+=$pre_color_total_collar_order_qnty;
									}
								}
							}
							?>
                        
                        <tr>
                            <td>Size Total</td>
								<?
                               // foreach($pre_size_total_arr  as $size_qty)
                               // {
                                	foreach($collar_cuff_size_arr[$body_type][$body_val] as $size_number_id)
									{
										$size_qty=$pre_size_total_arr[$size_number_id];
										?>
										<td style="border:1px solid black;  text-align:center"><? echo number_format($size_qty); ?></td>
										<?
									}

                               // }
                                ?>
                            <td style="border:1px solid black; text-align:center"><? echo number_format($pre_grand_tot_collar); ?></td>
                            <td align="center" style="border:1px solid black"><? echo number_format((($pre_grand_tot_collar-$pre_grand_tot_collar_order_qty)/$pre_grand_tot_collar_order_qty)*100,2); ?></td>
                        </tr>
					</table>
                </div>
                <br/>
                <?
            }
        }

        ?>

       		 <table width="98%">
       		 	<tr>
       		 		<td width="45%" style="float: left;">
       		 			<?php 

       		 				$sql_purchase="SELECT a.booking_no, a.uom, sum(b.fin_fab_qnty) as qnty , b.construction, b.copmposition, b.gsm_weight as dia, b.dia_width as gsm from wo_booking_mst a, wo_booking_dtls b where     a.booking_no = b.booking_no and a.fabric_source = 2 and b.job_no = '$txt_job_no'and b.status_active = 1 and b.is_deleted = 0 and a.status_active = 1 and a.is_deleted = 0 and  a.booking_type=1 group by a.booking_no, a.uom, b.construction, b.copmposition, b.dia, b.gsm_weight, b.dia_width"; 
       		 				//echo $sql_purchase;
							$purchase_res=sql_select($sql_purchase);
							?>
							<table  width="98%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">

 			                   <thead>
				                   <tr align="center">
				                    	<th colspan="5"><b>Purchased Booking Info</b></th>
				                    </tr>
				                    <tr align="center">
					                    <th>Sl</th>
					                    <th>Booking No</th>
					                    <th>Fabric Data</th>
					                    <th>UOM</th>
					                    <th>Qnty</th>
					                   
				                    </tr>
 			                   </thead>
 			                   <tbody>
 			                   		<?

 			                   			foreach ($purchase_res as  $row) 
 			                   			{
 			                   				?>
 			                   				<tr>
 			                   					<td><?=$p++;?></td>
 			                   					<td><p><?=$row[csf('booking_no')];?></p></td>
 			                   					<td><p><?=$row[csf('construction')] .", ".$row[csf('copmposition')].", ".$row[csf('gsm')].", ".$row[csf('dia')];?></p></td>
 			                   					<td><p><?=$unit_of_measurement[$row[csf('uom')]];?></p></td>
 			                   					<td><p><?=number_format($row[csf('qnty')],2);?></p></td>
 			                   				</tr>
 			                   				<?
 			                   			}


 			                   		?>
 			                   </tbody>
 			                   
 			            </table>

       		 			 
       		 		</td>
       		 		<td width="45%" style="float: right;">
 			       		 <table  width="98%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">

 			                   <tr align="center">
 			                    	<td colspan="10"><b>Dyes To Match</b></td>
 			                    </tr>
 			                    <tr align="center">
 				                    <td>Sl</td>
 				                    <td>Item</td>
 				                    <td>Item Description</td>
 				                    <td>Body Color</td>
 				                    <td>Item Color</td>
 				                    <td>Finish Qty.</td>
 				                    <td>UOM</td>
 			                    </tr>
 			                    <?
 								$lib_item_group_arr=return_library_array( "select item_name, id from lib_item_group where item_category=4 and is_deleted=0  and  status_active=1 order by item_name", "id", "item_name");
 								$sql=sql_select("select id from wo_booking_mst where booking_no=$txt_booking_no");
 								$bookingId=0;
 								foreach($sql as $row){
 									$bookingId= $row[csf('id')];
 								}
 								$co=0;
 								$sql_data=sql_select("select a.fabric_color,a.item_color,a.precost_trim_cost_id,b.trim_group,b.cons_uom,sum(qty) as qty, b.description   from wo_dye_to_match a, wo_pre_cost_trim_cost_dtls b where a.precost_trim_cost_id=b.id and a.booking_id=$bookingId and a.qty>0 and a.status_active=1 and b.status_active=1  group by a.fabric_color,a.item_color,a.precost_trim_cost_id,b.trim_group,b.cons_uom, b.description order by a.fabric_color");

 								foreach($sql_data  as $row)
 			                    {
 									$co++;
 									?>
 				                    <tr>
 				                    <td><? echo $co; ?></td>
 				                    <td> <? echo $lib_item_group_arr[$row[csf('trim_group')]];?></td>
 				                    <td><p> <? echo $row[csf('description')];?></p></td>
 				                    <td><? echo $color_library[$row[csf('fabric_color')]];?></td>
 				                    <td><? echo $color_library[$row[csf('item_color')]];?></td>
 				                    <td align="right"><? echo $row[csf('qty')];?></td>
 				                    <td><? echo $unit_of_measurement[$row[csf('cons_uom')]];?></td>
 				                    </tr>
 				                    <?
 								}
 								?>
 			            </table>
       		 		</td>
       		 	</tr>
       		 </table>
            <br>

        <?

		 $condition= new condition();
		if(str_replace("'","",$txt_order_no_id) !=''){
			$condition->po_id("in(".str_replace("'","",$txt_order_no_id).")");
		}

		$condition->init();
		$cos_per_arr=$condition->getCostingPerArr();
		$yarn= new yarn($condition);
		$yarn_data_array=$yarn->getCountCompositionPercentTypeColorAndRateWiseYarnQtyAndAmountArray();
		$yarn_count_arr=return_library_array( "select id,yarn_count from lib_yarn_count",'id','yarn_count');

		$yarn_sql_array=sql_select("SELECT min(a.id) as id ,a.count_id, a.copm_one_id, a.percent_one, a.color, a.type_id, sum(a.cons_qnty) as yarn_required, a.rate  from wo_pre_cost_fab_yarn_cost_dtls a, wo_booking_dtls b where a.job_no=b.job_no and a.fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.job_no='$job_no' and b.booking_no=$txt_booking_no  and  a.status_active=1 and a.is_deleted=0 group by a.count_id,a.copm_one_id,a.percent_one,a.color,a.type_id,a.rate order by id");
		?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" style="font-family:Arial Narrow;font-size:18px;" >
            <tr>
                <td width="49%" valign="top">
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td colspan="7"><b>Yarn Required Summary (Pre Cost)</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Yarn Description</td>
                    <td>Brand</td>
                    <td>Lot</td>
                    <?
					if($show_yarn_rate==1)
					{
					?>
                    <td>Rate</td>
                    <?
					}
					?>
                    <td>Cons for <? echo $costing_per; ?> Gmts</td>
                    <td>Total (KG)</td>
                    </tr>
                    <?
					$i=0;
					$total_yarn=0;
					foreach($yarn_sql_array  as $row)
                    {

						$i++;
						$rowcons_qnty = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['qty'];
						$rowcons_Amt = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['amount'];


						$rate=$rowcons_Amt/$rowcons_qnty;
						$rowcons_qnty =($rowcons_qnty/100)*$booking_percent;
					?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
					<?
					$yarn_des=$yarn_count_arr[$row[csf('count_id')]]." ".$composition[$row[csf('copm_one_id')]]." ".$row[csf('percent_one')]."%  ";
					$yarn_des.=$color_library[$row[csf('color')]]." ";
					$yarn_des.=$yarn_type[$row[csf('type_id')]];
					echo $yarn_des;
					?>
                    </td>
                    <td></td>
                    <td></td>
                    <?
					if($show_yarn_rate==1)
					{
					?>
                     <td><? echo number_format($row[csf('rate')],4); ?></td>
                     <?
					}
					 ?>
                    <td><?  echo number_format(($rowcons_qnty/$po_qnty_tot)*$cos_per_arr[$job_no],4);//echo number_format($row[csf('yarn_required')],4); ?></td>

                    <td align="right">
					<? echo number_format($rowcons_qnty,2); $total_yarn+=$rowcons_qnty; ?></td>
                    </tr>
                    <?
					}
					?>
                    <tr align="center">
                    <td>Total</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <?
					if($show_yarn_rate==1)
					{
					?>
                    <td></td>
                    <?
                    }
					?>
                    <td></td>
                    <td align="right"><? echo number_format($total_yarn,2); ?></td>
                    </tr>
                    </table>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top" align="center">
                <?
				$yarn_sql_array=sql_select("SELECT min(a.id) as id, a.item_id, sum(a.qnty) as qnty ,min(b.supplier_id) as supplier_id,min(b.lot) as lot from inv_material_allocation_dtls a,product_details_master b where a.item_id=b.id and a.booking_no=$txt_booking_no and  a.status_active=1 and a.is_deleted=0 group by a.item_id order by a.id");
				if(count($yarn_sql_array)>0)
				{
				?>
                   <table  width="100%"  style="font-size:18px;" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td colspan="7"><b>Allocated Yarn</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Yarn Description</td>
                    <td>Brand</td>
                    <td>Lot</td>


                    <td>Allocated Qty (Kg)</td>
                    </tr>
                    <?
					$total_allo=0;
					$item=return_library_array( "select id, product_name_details from   product_details_master",'id','product_name_details');
					$supplier=return_library_array( "select id, short_name from   lib_supplier",'id','short_name');
					$i=0;
					$total_yarn=0;
					foreach($yarn_sql_array  as $row)
                    {

						$i++;
					?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
					<?

					echo $item[$row[csf('item_id')]];
					?>
                    </td>
                    <td>
                    <?

					echo $supplier[$row[csf('supplier_id')]];
					?>
                    </td>
                    <td>
					<?

					echo $row[csf('lot')];
					?>
                    </td>
                    <td align="right"><? echo number_format($row[csf('qnty')],4); $total_allo+= $row[csf('qnty')];?></td>
                    </tr>
                    <?
					}
					?>
                    <tr align="center">
                    <td>Total</td>
                    <td></td>


                    <td></td>
                    <td></td>
                    <td align="right"><? echo number_format($total_allo,4); ?></td>
                    </tr>
                    </table>
                    <?
				}
				else
				{
					$is_yarn_allocated=return_field_value("allocation", "variable_settings_inventory", "company_name=$cbo_company_name and variable_list=18 and item_category_id=1");
					if($is_yarn_allocated==1)
					{
					?>
					<font style=" font-size:30px"><b> </b></font>
                    <?
					}
					else
					{
						echo "";
					}
				}
					?>
                </td>
                 <td width="49%" valign="top" align="center">
                	
               	
                </td>
            </tr>
        </table>
        <br/>
        <?
		$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
		?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" style="font-family:Arial Narrow;font-size:18px;">
            <tr>
                <td width="49%" valign="top">
                <?
				if(count($sql_embelishment)>0)
				{
				?>
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" style="font-family:Arial Narrow;font-size:18px;">
                    <tr align="center">
                    <td colspan="7"><b>Embelishment (Pre Cost)</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Embelishment Name</td>
                    <td>Embelishment Type</td>
                    <td>Cons <? echo $costing_per; ?> Gmts</td>
                    <td>Rate</td>
                    <td>Amount</td>

                    </tr>
                    <?
					$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
					$i=0;
					//$total_yarn=0;
					foreach($sql_embelishment  as $row_embelishment)
                    {

						$i++;
					?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
					<?
					echo $emblishment_name_array[$row_embelishment[csf('emb_name')]];
					?>
                    </td>
                    <td>
                    <?
					if($row_embelishment[csf('emb_name')]==1)
					{
					echo $emblishment_print_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==2)
					{
					echo $emblishment_embroy_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==3)
					{
					echo $emblishment_wash_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==4)
					{
					echo $emblishment_spwork_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==5)
					{
					echo $emblishment_gmts_type[$row_embelishment[csf('emb_type')]];
					}
					?>

                    </td>
                    <td>
                    <?
					echo $row_embelishment[csf('cons_dzn_gmts')];
					?>
                    </td>
                    <td>
					<?
					echo $row_embelishment[csf('rate')];
					?>
                    </td>

                    <td>
					<?
					echo $row_embelishment[csf('amount')];
					?>
                    </td>


                    </tr>
                    <?
					}
					?>

                    </table>
                    <?
				}
					?>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top" align="center">
                				<?
                				$lib_designation_arr=return_library_array(" select id,custom_designation from lib_designation","id","custom_designation");
									 $user_lib_designation_arr=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
									 $user_lib_name_arr=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");

								$mst_id=return_field_value("id as mst_id","wo_booking_mst","booking_no=$txt_booking_no","mst_id");
                				 $unapprove_data_array=sql_select("select b.approved_by,b.approved_date,b.un_approved_reason,b.un_approved_date,b.approved_no from   approval_history b where b.mst_id=$mst_id and b.entry_form=7  order by b.approved_date,b.approved_by");


                				if(count($unapprove_data_array)>0)
                				{
                				$sql_unapproved=sql_select("select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=7 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id=$mst_id");
                					$unapproved_request_arr=array();
                					foreach($sql_unapproved as $rowu)
                					{
                						$unapproved_request_arr[$rowu[csf('booking_id')]]=$rowu[csf('approval_cause')];
                					}
                		 		?>
                		       <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
                		            <thead>
                		            <tr style="border:1px solid black;">
                		                <th colspan="6" style="border:1px solid black;">Approval/Un Approval History</th>
                		                </tr>
                		                <tr style="border:1px solid black;">
                		                <th width="3%" style="border:1px solid black;">Sl</th>
                						<th width="30%" style="border:1px solid black;">Name</th>
                						<th width="20%" style="border:1px solid black;">Designation</th>
                						<th width="5%" style="border:1px solid black;">Approval Status</th>
                						<th width="20%" style="border:1px solid black;">Reason For Un Approval</th>
                						<th width="22%" style="border:1px solid black;"> Date</th>

                		                </tr>
                		            </thead>
                		            <tbody>
                		            <?
                					$i=1;
                					foreach($unapprove_data_array as $row){

                					?>
                		            <tr style="border:1px solid black;">
                		                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
                						<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
                						<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
                						<td width="5%" style="border:1px solid black; text-align:center"><? echo 'Yes';?></td>
                						<td width="20%" style="border:1px solid black;"><? echo '';?></td>
                						<td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); else echo "";?></td>
                		            </tr>
                		                <?
                						$i++;
                						$un_approved_date= explode(" ",$row[csf('un_approved_date')]);
                						$un_approved_date=$un_approved_date[0];
                						if($db_type==0) //Mysql
                						{
                							if($un_approved_date=="" || $un_approved_date=="0000-00-00") $un_approved_date="";else $un_approved_date=$un_approved_date;
                						}
                						else
                						{
                							if($un_approved_date=="") $un_approved_date="";else $un_approved_date=$un_approved_date;
                						}

                						if($un_approved_date!="")
                						{
                						?>
                					<tr style="border:1px solid black;">
                		                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
                						<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
                						<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
                						<td width="5%" style="border:1px solid black;text-align:center;"><? echo 'No';?></td>
                						<td width="20%" style="border:1px solid black;text-align:center"><? echo $unapproved_request_arr[$mst_id];?></td>
                						<td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('un_approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('un_approved_date')])); else echo "";?></td>
                		              </tr>

                		                <?
                						$i++;
                						}

                					}
                						?>
                		            </tbody>
                		        </table>
                				<?
                				}
                				?>

                </td>
            </tr>
        </table>
        <br/>
        <table  width="100%" style="margin: 0px;padding: 0px;">
        <?php $stripe_color_wise=array(); ?>
       
        <tr>
        	<td width="70%">
        		<table  class="rpt_table" border="1" cellpadding="1" cellspacing="1" rules="all" width="100%"   style="font-family:Arial Narrow;font-size:18px;margin: 0px;padding: 0px;" >
        		       
        		        <tr>
        		            <td align="center" colspan="9">  Stripe Details</td>
        		            
    		            </tr>
        		        <?
        				$color_name_arr=return_library_array( "select id,color_name from lib_color",'id','color_name');
        				$sql_stripe=("select c.id,c.composition,c.construction,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,sum(b.grey_fab_qnty) as fab_qty,b.dia_width,d.color_number_id as color_number_id,d.id as did,d.stripe_color,d.fabreqtotkg as fabreqtotkg ,d.measurement as measurement ,d.yarn_dyed,d.uom  from wo_booking_dtls b, wo_pre_cost_fabric_cost_dtls c,wo_pre_stripe_color d where c.id=b.pre_cost_fabric_cost_dtls_id and c.job_no=b.job_no and d.pre_cost_fabric_cost_dtls_id=c.id and d.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and b.job_no=d.job_no and b.job_no='$job_no'  and d.job_no='$job_no' and b.booking_no=$txt_booking_no  and c.color_type_id in (2,6,33,34) and b.status_active=1  and c.is_deleted=0 and c.status_active=1  and d.is_deleted=0 and d.status_active=1  and 	b.is_deleted=0  group by c.id,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,d.color_number_id,d.id,d.stripe_color,d.yarn_dyed,d.fabreqtotkg ,d.measurement,d.uom,c.composition,c.construction,b.dia_width order by d.id ");        				
        				$result_data=sql_select($sql_stripe);
        				foreach($result_data as $row)
        				{
        					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['stripe_color'][$row[csf('did')]]=$row[csf('stripe_color')];
        					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['measurement'][$row[csf('did')]]=$row[csf('measurement')];
        					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['uom'][$row[csf('did')]]=$row[csf('uom')];
        					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['fabreqtotkg'][$row[csf('did')]]=$row[csf('fabreqtotkg')];
        					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['yarn_dyed'][$row[csf('did')]]=$row[csf('yarn_dyed')];

        					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['composition']=$row[csf('composition')];
        					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['construction']=$row[csf('construction')];
        					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['gsm_weight']=$row[csf('gsm_weight')];
        					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['color_type_id']=$row[csf('color_type_id')];
        					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['dia_width']=$row[csf('dia_width')];
        				}
        				?>
        		            <tr>
	        		            <td align="center" width="30"> SL</td>
	        		            <td align="center" width="100"> Body Part</td>
	        		            <td align="center" width="80"> Fabric Color</td>
	        		            <td align="center" width="70"> Fabric Qty(KG)</td>
	        		            <td align="center" width="70"> Stripe Color</td>
	        		            <td align="center" width="70"> Stripe Measurement</td>
	        		            <td align="center" width="70"> Stripe Uom</td>
	        		            <td  align="center" width="70"> Qty.(KG)</td>
	        		            <td  align="center" width="70"> Y/D Req.</td>
        		            </tr>
        		            <?
        					$i=1;$total_fab_qty=0;$total_fabreqtotkg=0;$fab_data_array=array();
        		            foreach($stripe_arr as $body_id=>$body_data)
        		            {
        						foreach($body_data as $color_id=>$color_val)
        						{
        							$rowspan=count($color_val['stripe_color']);
        							$composition=$stripe_arr2[$body_id][$color_id]['composition'];
        							$construction=$stripe_arr2[$body_id][$color_id]['construction'];
        							$gsm_weight=$stripe_arr2[$body_id][$color_id]['gsm_weight'];
        							$color_type_id=$stripe_arr2[$body_id][$color_id]['color_type_id'];
        							$dia_width=$stripe_arr2[$body_id][$color_id]['dia_width'];

        							if($db_type==0) $color_cond="d.fabric_color_id='".$color_id."'";
        							else if($db_type==2) $color_cond="nvl(d.fabric_color_id,0)=nvl('".$color_id."',0)";

        							$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
        								WHERE a.job_id=b.job_id and
        								a.id=b.pre_cost_fabric_cost_dtls_id and
        								c.job_no_mst=a.job_no and
        								c.id=b.color_size_table_id and
        								b.po_break_down_id=d.po_break_down_id and
        								b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
        								d.booking_no =$txt_booking_no and
        								a.body_part_id='".$body_id."' and
        								a.color_type_id='".$color_type_id."' and
        								a.construction='".$construction."' and
        								a.composition='".$composition."' and
        								a.gsm_weight='".$gsm_weight."' and
        								$color_cond and
        								d.status_active=1 and
        								d.is_deleted=0
        								");
        						
        								list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty;
        							$sk=0;
    								foreach($color_val['stripe_color'] as $strip_color_id=>$s_color_val)
        							{
        								
        								?>
	        							<tr>
		        							<?
		        							if($sk==0)
		        							{


			        							$color_qty=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
			        							?>
			        							<td rowspan="<? echo $rowspan;?>"> <? echo $i; ?></td>
			        							<td rowspan="<? echo $rowspan;?>"> <? echo $body_part[$body_id]; ?></td>
			        							<td rowspan="<? echo $rowspan;?>"> <? echo $color_name_arr[$color_id]; ?></td>
			        							<td rowspan="<? echo $rowspan;?>" align="right"> <? echo number_format($color_qty,2); ?>&nbsp; </td>
			        							<?
			        							$total_fab_qty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
			        							$i++;
			        						}
		        							$sk=0;
		        							

		        								$measurement=$color_val['measurement'][$strip_color_id];
		        								$uom=$color_val['uom'][$strip_color_id];
		        								$fabreqtotkg=$color_val['fabreqtotkg'][$strip_color_id];
		        								$yarn_dyed=$color_val['yarn_dyed'][$strip_color_id];
		        								
		        								?>
		        							
			        								<td><?  echo  $color_name_arr[$s_color_val]; ?></td>
			        								<td align="right"> <? echo  number_format($measurement,2); ?> &nbsp; </td>
			        		                        <td> <? echo  $unit_of_measurement[$uom]; ?></td>
			        								<td align="right"> <? echo  number_format($fabreqtotkg,2); ?> &nbsp;</td>
			        								<td> <? echo  $yes_no[$yarn_dyed]; ?></td>
		        								
		        								<?
		        								
		        								$sk++;
		        								$total_fabreqtotkg+=$fabreqtotkg;
		        								$stripe_color_wise[$color_name_arr[$s_color_val]]+=$fabreqtotkg;
		        							
		        							
		        							?>
	        							</tr>
	        							<?
	        						}
        						}
        					}
        					?>
	        		            <tfoot>
		        		            <tr>
			        		            <td colspan="3">Total </td>
			        		            <td align="right">  <? echo  number_format($total_fab_qty,2); ?> &nbsp;</td>
			        		            <td></td>
			        		            <td></td>
			        		            <td>   </td>
			        		            <td align="right"><? echo  number_format($total_fabreqtotkg,2); ?> &nbsp;</td>
			        		        </tr>
	        		            </tfoot>
        		            </table>
        	</td>
        	
        	<td width="20%" >
        		        <table  class="rpt_table" border="1" cellpadding="1" cellspacing="1" rules="all" width="100%"   style="font-family:Arial Narrow;font-size:18px;margin: 0px;padding: 0px;"  >
        		       

        		        <tr>
        		            <td align="left" colspan="3"> Stripe  Color wise Summary</td>
        		            
        		           
        		           
    		            </tr>
        		        <?
        				
        				?>
        		            <tr>
	        		            <td width="30"> SL</td>
	        		            
	        		            <td width="70"> Stripe Color</td>
	        		           
	        		            <td  width="70"> Qty.(KG)</td>
	        		           
        		            </tr>
        		            <?

        					$i=1;$total_stripe_qnt=0;        		            
        						foreach($stripe_color_wise as $color=>$val)
        						{
        							
        							
        							?>
        							<tr>
	        							<td> <? echo $i; ?></td>
	        							
	        							<td > <? echo $color; ?></td>
	        							<td align="right"> <?php echo number_format($val,2); ?></td>
	        						</tr>
        							
        							<?
        							$total_stripe_qnt+=$val;
        							
        							$i++;
        						}
        					
        					?>
        		            <tfoot>
        		            <tr>
        		            
        		            <td></td>
        		            <td></td>
        		            
        		            <td align="right"><? echo  number_format($total_stripe_qnt,2); ?> </td>
        		            </tr>
        		            </tfoot>
        		            </table>
        	</td>
        </tr>
         </table >
      
        <br/>
        <table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" style="font-family:Arial Narrow;font-size:18px;">
        <tr align="center">
        <td colspan="10"><b> Comments(Production) </b></td>
        </tr>
        <tr align="center">
        <td>Sl</td>
        <td>Po NO</td>
        <td>Ship Date</td>
        <td>Pre-Cost Qty</td>
        <td>Mn.Book Qty</td>
        <td>Sht.Book Qty</td>
        <td>Smp.Book Qty</td>
        <td>Tot.Book Qty</td>
        <td>Balance</td>
        <td>Comments</td>
        </tr>
        <?
        $cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
        $cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
        if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
        if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
        $paln_cut_qnty_array=return_library_array( "select min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id,size_number_id,item_number_id,po_break_down_id", "id", "plan_cut_qnty");
        $item_ratio_array=return_library_array( "select gmts_item_id,set_item_ratio from wo_po_details_mas_set_details  where job_no ='$txt_job_no'", "gmts_item_id", "set_item_ratio");

        $nameArray=sql_select("SELECT a.id, a.item_number_id, a.costing_per, b.po_break_down_id, b.color_size_table_id, b.requirment, c.po_number FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_po_break_down c WHERE a.job_id=b.job_id and a.job_no=c.job_no_mst and a.id=b.pre_cost_fabric_cost_dtls_id and b.po_break_down_id=c.id and b.po_break_down_id in (".str_replace("'","",$txt_order_no_id).")  $cbo_fabric_natu $cbo_fabric_source_cond and a.status_active=1 and a.is_deleted=0 order by id");
        $count=0;
        $tot_grey_req_as_pre_cost_arr=array();
        foreach ($nameArray as $result)
        {
        if (count($nameArray)>0 )
        {
        if($result[csf("costing_per")]==1)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(12*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==2)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(1*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==3)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(24*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==4)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(36*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==5)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(48*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        $tot_grey_req_as_pre_cost_arr[$result[csf("po_number")]]+=$tot_grey_req_as_pre_cost;
        }
        }

        $total_pre_cost=0;
        $total_booking_qnty_main=0;
        $total_booking_qnty_short=0;
        $total_booking_qnty_sample=0;
        $total_tot_bok_qty=0;
        $tot_balance=0;
        $booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and a.is_short=2 and c.item_category=2 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

        $booking_qnty_short=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and c.item_category=2 and a.is_short=1 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
        $booking_qnty_sample=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c  where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =4 and c.fabric_source=$cbo_fabric_source and c.item_category=2  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
        $sql_data=sql_select( "select max(a.id) as id,  a.po_number,max(a.pub_shipment_date) as pub_shipment_date,sum(a.plan_cut) as plan_cut  from wo_po_break_down a,wo_pre_cost_sum_dtls b,wo_pre_cost_mst c where a.job_no_mst=b.job_no and a.job_no_mst=c.job_no and a.id in(".str_replace("'","",$txt_order_no_id).") group by a.po_number order by pub_shipment_date asc");
        foreach($sql_data  as $row)
        {
        $col++;
        ?>
        <tr align="center">
        <td><? echo $col; ?></td>
        <td><? echo $row[csf("po_number")]; ?></td>
        <td><? echo change_date_format($row[csf("pub_shipment_date")],"dd-mm-yyyy",'-'); ?></td>
        <td align="right"><? echo number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]],2); $total_pre_cost+=$tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]; ?></td>
        <td align="right"><? echo number_format($booking_qnty_main[$row[csf("id")]],2); $total_booking_qnty_main+=$booking_qnty_main[$row[csf("id")]];?></td>
        <td align="right"><? echo number_format($booking_qnty_short[$row[csf("id")]],2); $total_booking_qnty_short+=$booking_qnty_short[$row[csf("id")]];?></td>
        <td align="right"><? echo number_format($booking_qnty_sample[$row[csf("id")]],2); $total_booking_qnty_sample+=$booking_qnty_sample[$row[csf("id")]];?></td>
        <td align="right"><? $tot_bok_qty=$booking_qnty_main[$row[csf("id")]]+$booking_qnty_short[$row[csf("id")]]+$booking_qnty_sample[$row[csf("id")]]; echo number_format($tot_bok_qty,2); $total_tot_bok_qty+=$tot_bok_qty;?></td>
        <td align="right">
        <? $balance= def_number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]-$tot_bok_qty,2,""); echo number_format($balance,2); $tot_balance+= $balance?>
        </td>
        <td>
        <?
        if( $balance>0)
        {
        echo "Less Booking";
        }
        else if ($balance<0)
        {
        echo "Extra Booking";
        }
        else
        {
        echo "";
        }
        ?>
        </td>
        </tr>
        <?
        }
        ?>
        <tfoot>
        <tr>
        <td colspan="3">Total:</td>
        <td align="right"><? echo number_format($total_pre_cost,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_main,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_short,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_sample,2); ?></td>
        <td align="right"><? echo number_format($total_tot_bok_qty,2); ?></td>
        <td align="right"><? echo number_format($tot_balance,2); ?></td>
        <td></td>
        </tr>
        </tfoot>
        </table>

        <?
         if(count($purchase_res))
        {
        	?>
         <br/>
        <table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" style="font-family:Arial Narrow;font-size:18px;">
        <tr align="center">
        <td colspan="10"><b> Comments(Purchase)</b></td>
        </tr>
        <tr align="center">
        <td>Sl</td>
        <td>Po NO</td>
        <td>Ship Date</td>
        <td>Pre-Cost Qty</td>
        <td>Purchase<br>Booking Qty</td>
        <td>Sht.Book Qty</td>
        <td>Smp.Book Qty</td>
        <td>Tot.Book Qty</td>
        <td>Balance</td>
        <td>Comments</td>
        </tr>
        <?
        $cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
        $cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
        if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
        if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
        $paln_cut_qnty_array=return_library_array( "select min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id,size_number_id,item_number_id,po_break_down_id", "id", "plan_cut_qnty");
        $item_ratio_array=return_library_array( "select gmts_item_id,set_item_ratio from wo_po_details_mas_set_details  where job_no ='$txt_job_no'", "gmts_item_id", "set_item_ratio");

        $nameArray=sql_select("select a.id, a.item_number_id, a.costing_per, b.po_break_down_id, b.color_size_table_id, b.requirment, c.po_number FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_po_break_down c WHERE a.job_no=b.job_no and a.job_no=c.job_no_mst and a.id=b.pre_cost_fabric_cost_dtls_id and b.po_break_down_id=c.id and c.job_no_mst = '$txt_job_no'  and a.fab_nature_id=3 and   a.fabric_source = '2'  and a.status_active=1 and a.is_deleted=0 order by id");

        $count=0;
        $tot_grey_req_as_pre_cost_arr=array();
        foreach ($nameArray as $result)
        {
        if (count($nameArray)>0 )
        {
        if($result[csf("costing_per")]==1)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(12*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==2)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(1*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==3)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(24*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==4)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(36*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==5)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(48*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        $tot_grey_req_as_pre_cost_arr[$result[csf("po_number")]]+=$tot_grey_req_as_pre_cost;
        }
        }

        $total_pre_cost=0;
        $total_booking_qnty_main=0;
        $total_booking_qnty_short=0;
        $total_booking_qnty_sample=0;
        $total_tot_bok_qty=0;
        $tot_balance=0;
        $booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and   a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.job_no = '$txt_job_no' and a.booking_type =1  and c.fabric_source = 2  and a.is_short=2  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");


        $booking_qnty_short=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.job_no = '$txt_job_no' and a.booking_type =1 and c.fabric_source=2 and c.item_category=2 and a.is_short=1 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
        $booking_qnty_sample=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c  where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.job_no = '$txt_job_no' and a.booking_type =4 and c.fabric_source=2 and c.item_category=2  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
        $sql_data=sql_select( "select max(a.id) as id,  a.po_number,max(a.pub_shipment_date) as pub_shipment_date,sum(a.plan_cut) as plan_cut  from wo_po_break_down a,wo_pre_cost_sum_dtls b,wo_pre_cost_mst c where a.job_no_mst=b.job_no and a.job_no_mst=c.job_no and a.job_no_mst='$txt_job_no' group by a.po_number order by pub_shipment_date asc");
        foreach($sql_data  as $row)
        {
        $col++;
        ?>
        <tr align="center">
        <td><? echo $col; ?></td>
        <td><? echo $row[csf("po_number")]; ?></td>
        <td><? echo change_date_format($row[csf("pub_shipment_date")],"dd-mm-yyyy",'-'); ?></td>
        <td align="right"><? echo number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]],2); $total_pre_cost+=$tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]; ?></td>
        <td align="right"><? echo number_format($booking_qnty_main[$row[csf("id")]],2); $total_booking_qnty_main+=$booking_qnty_main[$row[csf("id")]];?></td>
        <td align="right"><? echo number_format($booking_qnty_short[$row[csf("id")]],2); $total_booking_qnty_short+=$booking_qnty_short[$row[csf("id")]];?></td>
        <td align="right"><? echo number_format($booking_qnty_sample[$row[csf("id")]],2); $total_booking_qnty_sample+=$booking_qnty_sample[$row[csf("id")]];?></td>
        <td align="right"><? $tot_bok_qty=$booking_qnty_main[$row[csf("id")]]+$booking_qnty_short[$row[csf("id")]]+$booking_qnty_sample[$row[csf("id")]]; echo number_format($tot_bok_qty,2); $total_tot_bok_qty+=$tot_bok_qty;?></td>
        <td align="right">
        <? $balance= def_number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]-$tot_bok_qty,2,""); echo number_format($balance,2); $tot_balance+= $balance?>
        </td>
        <td>
        <?
        if( $balance>0)
        {
        echo "Less Booking";
        }
        else if ($balance<0)
        {
        echo "Extra Booking";
        }
        else
        {
        echo "";
        }
        ?>
        </td>
        </tr>
        <?
        }
        ?>
        <tfoot>
        <tr>
        <td colspan="3">Total:</td>
        <td align="right"><? echo number_format($total_pre_cost,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_main,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_short,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_sample,2); ?></td>
        <td align="right"><? echo number_format($total_tot_bok_qty,2); ?></td>
        <td align="right"><? echo number_format($tot_balance,2); ?></td>
        <td></td>
        </tr>
       
        </tfoot>
        </table>
         <?
        	}
        ?>
       <br>

		<fieldset id="div_size_color_matrix" style="max-width:1000;">
		<?
		//------------------------------ Query for TNA start-----------------------------------
				$po_id_all=str_replace("'","",$txt_order_no_id);
				$po_num_arr=return_library_array("select id,po_number from wo_po_break_down where id in($po_id_all)",'id','po_number');
				$tna_start_sql=sql_select( "SELECT id,po_number_id, (case when task_number=31 then task_start_date else null end) as fab_booking_start_date, (case when task_number=31 then task_finish_date else null end) as fab_booking_end_date, (case when task_number=60 then task_start_date else null end) as knitting_start_date, (case when task_number=60 then task_finish_date else null end) as knitting_end_date, (case when task_number=61 then task_start_date else null end) as dying_start_date, (case when task_number=61 then task_finish_date else null end) as dying_end_date, (case when task_number=64 then task_start_date else null end) as finishing_start_date, (case when task_number=64 then task_finish_date else null end) as finishing_end_date, (case when task_number=84 then task_start_date else null end) as cutting_start_date, (case when task_number=84 then task_finish_date else null end) as cutting_end_date, (case when task_number=86 then task_start_date else null end) as sewing_start_date, (case when task_number=86 then task_finish_date else null end) as sewing_end_date, (case when task_number=110 then task_start_date else null end) as exfact_start_date, (case when task_number=110 then task_finish_date else null end) as exfact_end_date, (case when task_number=47 then task_start_date else null end) as yarn_rec_start_date, (case when task_number=47 then task_finish_date else null end) as yarn_rec_end_date from tna_process_mst where status_active=1 and po_number_id in($po_id_all)"); 
				$tna_fab_start=$tna_knit_start=$tna_dyeing_start=$tna_fin_start=$tna_cut_start=$tna_sewin_start=$tna_exfact_start="";
				$tna_date_task_arr=array();
				foreach($tna_start_sql as $row)
				{
					if($row[csf("fab_booking_start_date")]!="" && $row[csf("fab_booking_start_date")]!="0000-00-00")
					{
						if($tna_fab_start=="")
						{
							$tna_fab_start=$row[csf("fab_booking_start_date")];
						}
					}


					if($row[csf("knitting_start_date")]!="" && $row[csf("knitting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_start_date']=$row[csf("knitting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_end_date']=$row[csf("knitting_end_date")];
					}
					if($row[csf("dying_start_date")]!="" && $row[csf("dying_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['dying_start_date']=$row[csf("dying_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['dying_end_date']=$row[csf("dying_end_date")];
					}
					if($row[csf("finishing_start_date")]!="" && $row[csf("finishing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_start_date']=$row[csf("finishing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_end_date']=$row[csf("finishing_end_date")];
					}
					if($row[csf("cutting_start_date")]!="" && $row[csf("cutting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_start_date']=$row[csf("cutting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_end_date']=$row[csf("cutting_end_date")];
					}

					if($row[csf("sewing_start_date")]!="" && $row[csf("sewing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_start_date']=$row[csf("sewing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_end_date']=$row[csf("sewing_end_date")];
					}
					if($row[csf("exfact_start_date")]!="" && $row[csf("exfact_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_start_date']=$row[csf("exfact_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_end_date']=$row[csf("exfact_end_date")];
					}
					if($row[csf("yarn_rec_start_date")]!="" && $row[csf("yarn_rec_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_start_date']=$row[csf("yarn_rec_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_end_date']=$row[csf("yarn_rec_end_date")];
					}
				}

			//------------------------------ Query for TNA end-----------------------------------
		?>
        <legend>TNA Information</legend>
        <!--<span style="font-size:180; font-weight:bold;"></span>-->
        <table width="100%" style="border:1px solid black;font-size:17px; font-family:Arial Narrow;" border="1" cellpadding="2" cellspacing="0" rules="all">
            <tr>
            	<td rowspan="2" align="center" valign="top">SL</td>
            	<td width="180" rowspan="2"  align="center" valign="top"><b>Order No</b></td>
                <td colspan="2" align="center" valign="top"><b>Yarn Receive</b></td>
                <td colspan="2" align="center" valign="top"><b>Knitting</b></td>
                <td colspan="2" align="center" valign="top"><b>Dyeing</b></td>
                <td colspan="2" align="center" valign="top"><b>Finish Fabric Prod.</b></td>
                <td colspan="2" align="center" valign="top"><b>Cutting </b></td>
                <td colspan="2" align="center" valign="top"><b>Sewing </b></td>
                <td colspan="2"  align="center" valign="top"><b>Ex-factory </b></td>
            </tr>
            <tr>
            	<td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>

            </tr>
            <?
			$i=1;
			foreach($tna_date_task_arr as $order_id=>$row)
			{
				 //$tna_date_task_arr//knitting_start_date dying_start_date finishing_start_date cutting_start_date sewing_start_date exfact_start_date
				?>
                <tr>
                	<td><? echo $i; ?></td>
                    <td><? echo $po_num_arr[$order_id]; ?></td>
                    <td align="center"><? echo change_date_format($row['yarn_rec_start_date']); ?></td>
                    <td  align="center"><? echo change_date_format($row['yarn_rec_end_date']); ?></td>
                	<td align="center"><? echo change_date_format($row['knitting_start_date']); ?></td>
                    <td  align="center"><? echo change_date_format($row['knitting_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['dying_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['dying_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['cutting_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['cutting_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['sewing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['sewing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['exfact_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['exfact_end_date']); ?></td>
                </tr>
                <?
				$i++;
			}
			?>

        </table>
        </fieldset>
        <?
		}// fabric Source End
		if($isYarnPurchseValidate==2)
		{
			?>
            <br>
			<table align="left" width="350px" style="border:1px solid black;font-size:12px; font-family:Arial Narrow;" border="1" cellspacing="0" rules="all">
				<tr>
					<th colspan="3">Yarn Purchase Requisition Info</th>
				</tr>
				<tr>
					<th width="120">Job No</th>
					<th width="130">Purchase Req. No</th>
					<th>Qty.</th>
				</tr>
                
                <?
				$sqlYarnReq="select a.requ_no, b.job_no, sum(b.quantity) as qty from inv_purchase_requisition_mst a, inv_purchase_requisition_dtls b where a.id=b.mst_id and b.job_no='$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.requ_no, b.job_no";
				$sqlYarnReqRes=sql_select($sqlYarnReq);
				foreach($sqlYarnReqRes as $row)
				{
				?>
                <tr>
					<td width="120"><?=$row[csf("job_no")]; ?></td>
					<td width="130"><?=$row[csf("requ_no")]; ?></td>
					<td align="right"><?=number_format($row[csf("qty")],2); ?></td>
				</tr>
                
                <?
				}
				?>
        	</table>
            <br><br><br>
		<? } echo get_spacial_instruction($txt_booking_no,"97%",118); ?>
        
        
        <br>
         <div style="font-family:Arial Narrow;">
         <?
		 	echo signature_table(1, $cbo_company_name, "1400px");
		 ?>
         </div>
        <br>

        <?
        	$grand_order_total=0;
        	$grand_plan_total=0;
        	$size_wise_total=array();
			$nameArray_size=sql_select( "select size_number_id from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by size_number_id ");
			?>
			
                <div id="div_size_color_matrix" class="pagebreak">
                    <fieldset id="div_size_color_matrix" >
                        <legend>Size and Color Breakdown</legend>
                        <table  class="rpt_table"  border="1" align="left" cellpadding="0"  cellspacing="0" rules="all" >
                            <tr>
                            	<td>PO Number</td>
                            	<td>PO Received Date</td>
                            	<td>Ship Date</td>
                            	<td>Lead Time</td>
                            	<td>Ship.days in Hand</td>
                            	<td>Gmts Item</td>
                                <td style="border:1px solid black"><strong>Color/Size</strong></td>
                                <?
                                foreach($nameArray_size  as $result_size)
                                {
									?>
                                	<td align="center" style="border:1px solid black"><?=$size_library[$result_size[csf('size_number_id')]];?></td>
                                <? } ?>
                                <td  align="center"> Total Order Qty(Pcs)</td>
                                <td  align="center"> Excess %</td>
                                <td  align="center"> Total Plan Cut Qty(Pcs)</td>
                            </tr>
                            <?
                            $color_size_order_qnty_array=array(); $color_size_qnty_array=array(); $size_tatal=array(); $size_tatal_order=array();
                           	$item_size_tatal=array(); $item_size_tatal_order=array(); $item_grand_total=0; $item_grand_total_order=0;
                           	$result_cs=sql_select( "select b.item_number_id,b.color_number_id,sum(b.order_quantity) as order_quantity,b.size_number_id,b.po_break_down_id from wo_po_break_down a, wo_po_color_size_breakdown b where a.id=b.po_break_down_id and a.job_no_mst ='$job_no' and b.status_active=1 and a.is_deleted=0 and b.is_deleted=0 group by b.item_number_id,b.color_number_id,b.size_number_id,b.po_break_down_id");
                           	$color_size_data=array();
                           	foreach ($result_cs as $row) {
                           		$color_size_data[$row[csf('po_break_down_id')]][$row[csf('item_number_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]+=$row[csf('order_quantity')];
                           	}

                           	$sql_color="select a.po_number,a.id,a.po_received_date,a.shipment_date,b.item_number_id,b.color_number_id,sum(b.plan_cut_qnty) as plan_cut_qnty,a.shiping_status from wo_po_break_down a, wo_po_color_size_breakdown b where a.id=b.po_break_down_id and a.job_no_mst ='$job_no' and b.status_active=1 and a.is_deleted=0 and b.is_deleted=0 group by a.po_number,a.id,a.po_received_date,a.shipment_date,b.item_number_id,b.color_number_id,a.shiping_status order by a.shipment_date asc ";
                           	//echo $sql_color;
							$result_color_size=sql_select( $sql_color);

							foreach ($result_color_size as $row) 
							{
								
								?>

								<tr>
									<td><?php echo $row[csf('po_number')] ?></td>
									<td><?php echo change_date_format($row[csf('po_received_date')]); ?></td>
									<td><?php echo change_date_format($row[csf('shipment_date')]); ?></td>
									<?php 

										$date1=date_create($row[csf('po_received_date')]);
										$date2=date_create($row[csf('shipment_date')]);
										$diff=date_diff($date1,$date2);
										$current_date=date_create(strval(date('Y-m-d')));
										$diff1=date_diff($current_date,$date2);
										
										$day_in_hand=$diff1->format("%R%a days");
										if($row[csf('shiping_status')]==3)
										{
											$day_in_hand='0 days';
										}
									 ?>
									<td><?php echo $diff->format("%a days"); ?></td>
									<td><?php echo str_replace("+", "", $day_in_hand); ?></td>
									<td><?php echo $garments_item[$row[csf('item_number_id')]]; ?></td>
									<td><?php echo $color_library[$row[csf('color_number_id')]]; ?></td>
									<?
									$total=0;

                                    foreach($nameArray_size  as $key)
                                    {
										
										?>
                                    	<td align="center" style="border:1px solid black">
                                    		<?
                                    				$qnty=0;
                                    				$qnty=$color_size_data[$row[csf('id')]][$row[csf('item_number_id')]][$row[csf('color_number_id')]][$key[csf('size_number_id')]];

                                    				echo number_format($qnty);
                                    				$size_wise_total[$key[csf('size_number_id')]]+=$qnty;
                                    				$total+=$qnty;
                                    				
                                    			?>
                                    		
                                    	
                                    	</td>
                                   	 	<? 
                                	}

                                	$grand_order_total+=$total;
        							$grand_plan_total+=$row[csf('plan_cut_qnty')];

        							$plan_cut_dif=$row[csf('plan_cut_qnty')]-$total;
        							$ex_cut_perc=($plan_cut_dif/$total)*100;

                                	?>
                                	<td align="center"><?php echo number_format($total); ?></td>
                                	<td align="center"><?php echo number_format($ex_cut_perc,2); ?>%</td>
                                	<td align="center"><?php echo number_format($row[csf('plan_cut_qnty')]); ?></td>

								</tr>
								<?
							}

								
                            ?>
                            <tr>
                            	<td align="right" colspan="7">Total</td>
                            	
                            	<?
                                    foreach($nameArray_size  as $key)
                                    {
										
										?>
                                    	<td align="center" style="border:1px solid black">
                                    		<strong><?
                                    				
                                    				
                                    				echo number_format($size_wise_total[$key[csf('size_number_id')]])
                                    			?>
                                    		
                                    	</strong>

                                    	</td>
                                   	 	<? 
                                	}

                                	?>
                                <td align="center"><strong><?=number_format($grand_order_total)?></strong></td>
                                <td></td>
                                <td align="center"><strong><?=number_format($grand_plan_total)?></strong></td>
                            </tr>
                           
                           
                        </table>
                    </fieldset>
                </div>
          
			<?

			$actule_po_size=sql_select("select gmts_size_id from wo_po_acc_po_info where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by gmts_size_id ");
			$actule_po_data=sql_select( "SELECT a.id as po_id,a.po_number, b.acc_po_no, a.po_received_date, b.acc_ship_date, b.gmts_color_id, b.gmts_size_id, b.acc_po_qty, b.id as actule_po_id , b.gmts_item from wo_po_break_down a join wo_po_acc_po_info b on a.id=b.PO_BREAK_DOWN_ID where b.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and b.is_deleted=0 and b.status_active=1 and a.is_deleted=0 and a.status_active=1");
			$actule_po_arr=array();
			$attribute=array('po_number','acc_po_no','po_received_date','acc_ship_date','gmts_color_id','gmts_size_id','acc_po_qty','gmts_item');
			foreach ($actule_po_data as $row) {
				foreach ($attribute as $attr) {
					$actule_po_arr[$row[csf('po_id')]][$row[csf('actule_po_id')]][$attr]=$row[csf($attr)];
				}
				$actual_color_size[$row[csf('po_id')]][$row[csf('actule_po_id')]][$row[csf('gmts_item')]][$row[csf('gmts_color_id')]][$row[csf('gmts_size_id')]] =$row[csf('acc_po_qty')];				
			}

			$booking_dtls_data=sql_select(" SELECT a.po_number, a.pub_shipment_date,b.fabric_color_id,b.gmts_color_id, b.fin_fab_qnty, b.grey_fab_qnty, c.size_number_id,c.excess_cut_perc from wo_po_break_down a join wo_booking_dtls b on a.id=b.po_break_down_id join WO_PO_COLOR_SIZE_BREAKDOWN c on c.id=b.color_size_table_id where b.booking_no=$txt_booking_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0");
			$size_lib_arr = return_library_array("select id,size_name from  lib_size ","id","size_name");
		
		?>
		<div id="div_size_color_matrix" class="pagebreak">
            <fieldset id="div_size_color_matrix" >
                <legend>Actual PO Info</legend>
                <table  class="rpt_table"  border="1" align="left" cellpadding="0"  cellspacing="0" rules="all" >
                    <tr>
                    	<td>PO Number</td>
                    	<td>Actual PO</td>
                    	<td>PO Received Date</td>
                    	<td>Ship Date</td>
                    	<td>Gmts Item</td>
                        <td style="border:1px solid black"><strong>Color/Size</strong></td>
                        <?
                        foreach($actule_po_size  as $result_size)
                        {
							?>
                        	<td align="center" style="border:1px solid black"><?=$size_library[$result_size[csf('gmts_size_id')]];?></td>
                        <? } ?>
                        <td  align="center"> Total Order Qty(Pcs)</td>
                    </tr>
                    <?

					foreach ($actule_po_arr as $po_id=>$po_data) 
					{	$k=1;
						foreach ($po_data as $actule_po_id=>$data) {
							$total_size_qty=0;
							if($k==1){
						 	?>
							<tr>
								<td rowspan="<? echo count($po_data)?>"><?php echo $data['po_number'] ?></td>
								<td><?php echo $data['acc_po_no'] ?></td>								
								<td><?php echo change_date_format($data['po_received_date']) ?></td>		
								<td><?php echo change_date_format($data['acc_ship_date']) ?></td>			
								<td><?php echo $garments_item[$data['gmts_item']] ?></td>
								<td><?php echo $color_library[$data['gmts_color_id']] ?></td>
								<?php
								foreach($actule_po_size  as $result_size)
		                        {
		                        	$size_qty=$actual_color_size[$po_id][$actule_po_id][$data['gmts_item']][$data['gmts_color_id']][$result_size[csf('gmts_size_id')]];
		                        	$total_size_qty+=$size_qty;
									?>
		                        	<td align="center" width="30"><? echo $size_qty; ?></td>
		                        <? } ?>
		                        <td><? echo $total_size_qty ?></td>				
							</tr>
							<? 
							}
							else{ ?>
								<tr>
									<td><?php echo $data['acc_po_no'] ?></td>								
									<td><?php echo change_date_format($data['po_received_date']) ?></td>		
									<td><?php echo change_date_format($data['acc_ship_date']) ?></td>			
									<td><?php echo $garments_item[$data['gmts_item']] ?></td>
									<td><?php echo $color_library[$data['gmts_color_id']] ?></td>
									<?php
									foreach($actule_po_size  as $result_size)
			                        {
										$size_qty=$actual_color_size[$po_id][$actule_po_id][$data['gmts_item']][$data['gmts_color_id']][$result_size[csf('gmts_size_id')]];
										$total_size_qty+=$size_qty;
										?>
		                        	<td align="center" width="30"><? echo $size_qty; ?></td>
			                        <? } ?>
			                        <td><? echo $total_size_qty ?></td>					
								</tr>
							<? }
							$k++;
						}
					}						
                    ?>       
                   
                </table>
            </fieldset>
        </div>
        <div id="div_size_color_matrix" class="pagebreak">
            <fieldset id="div_size_color_matrix" >
                <legend>PO, Color and Size wise fabric Required Quantity</legend>
                <table  class="rpt_table"  border="1" align="left" cellpadding="0"  cellspacing="0" rules="all" >
                	<tr>
                    	<th>PO Number</th>
                    	<th>Ship Date</th>
                    	<th>Fabric Color</th>
                    	<th>Body Color</th>
                    	<th>Size</th>
                    	<th>Total Finish Fabric (Kg)</th>
                    	<th>Total Greige Fabric (Kg)</th>
                    	<th>Process Loss %</th>
                    </tr>
                    <? foreach ($booking_dtls_data as $row) { ?>
                    	<tr>
	                    	<td><? echo $row[csf('po_number')] ?></td>
	                    	<td><? echo change_date_format($row[csf('pub_shipment_date')]) ?></td>
	                    	<td><? echo $color_library[$row[csf('fabric_color_id')]] ?></td>
	                    	<td><? echo $color_library[$row[csf('gmts_color_id')]] ?></td>
	                    	<td align="center"><? echo $size_lib_arr[$row[csf('size_number_id')]] ?></td>
	                    	<td align="center"><? echo number_format($row[csf('fin_fab_qnty')],2) ?></td>
	                    	<td align="center"><? echo number_format($row[csf('grey_fab_qnty')],2) ?></td>
	                    	<td align="center"><? echo $row[csf('excess_cut_perc')] ?></td>
                    	</tr>
                    <? 
                    	$atotal_fin_fab_qnty+=$row[csf('fin_fab_qnty')];
                    	$atotal_grey_fab_qnty+=$row[csf('grey_fab_qnty')];
                    	} 
                    ?>
                    <tr>
                    	<th colspan="5" align="right">Total</th>
                    	<th><? echo number_format($atotal_fin_fab_qnty,2) ?></th>
                    	<th><? echo number_format($atotal_grey_fab_qnty,2) ?></th>
                    </tr>
                </table>
            </fieldset>
        </div>        
       </div>
       <?
	   exit();
}

if($action=="show_fabric_booking_report_print23")//Print B23=>13-03-2022(md mamun ahmed sagor)
{
	extract($_REQUEST);
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
	$cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
	$revised_no=str_replace("'","",$revised_no);
	$txt_job_no=str_replace("'","",$txt_job_no);
	$show_yarn_rate=str_replace("'","",$show_yarn_rate);
	$path=str_replace("'","",$path);
	if($path==1) $path="../../";
	if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
	
	$imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1 and master_tble_id='$cbo_company_name'",'master_tble_id','image_location');
	$country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
	$supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
	$marchentrArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info ","id","team_member_name");
	$buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
	$brand_name_arr=return_library_array( "select id, brand_name from lib_buyer_brand ",'id','brand_name');
	//$user_name_arr=return_library_array( "select id, user_full_name from user_passwd ",'id','user_full_name');
	$user_name_arr=return_library_array( "select id, user_name from user_passwd ",'id','user_name');
	$team_leader_arr=return_library_array( "select id,team_leader_name from lib_marketing_team",'id','team_leader_name');
	$color_library=return_library_array( "SELECT id,color_name from lib_color ", "id", "color_name");
 
	//$location_name_arr=return_library_array( "select id,location_name from lib_location",'id','location_name');
	
	//$po_qnty_tot=return_field_value( "sum(plan_cut)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	//$po_qnty_tot1=return_field_value( "sum(po_quantity)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
	//wo_pre_cost_fabric_cost_dtls
	$pro_sub_dept_array=return_library_array( "select id,sub_department_name from lib_pro_sub_deparatment",'id','sub_department_name');
	?>
	<style type="text/css">
		@media print {
		    .pagebreak { page-break-before: always; } /* page-break-after works, as well */
		}
	</style>
	<div style="width:1330px" align="center">
    <?php
    	$lip_yarn_count=return_library_array( "select id,fabric_composition_id from lib_yarn_count_determina_mst where  status_active=1", "id", "fabric_composition_id");
		$fabric_composition=return_library_array( "select id,fabric_composition_name from lib_fabric_composition where  status_active=1", "id", "fabric_composition_name");
		
		$nameArray_approved = sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7");
		list($nameArray_approved_row) = $nameArray_approved;
		$nameArray_approved_date = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
		//echo "select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'";
		//list($nameArray_approved_date) = $nameArray_approved_date;
		foreach($nameArray_approved_date  as $row)
		{
		$nameArray_approved_date_chk=strtotime($row[csf('approved_date')]);
		}
		
		$nameArray_approved_comments = sql_select("select b.comments as comments from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "'");
		list($nameArray_approved_comments_row) = $nameArray_approved_comments;

		$max_approve_date_data = sql_select("select min(b.approved_date) as approved_date,max(b.approved_date) as last_approve_date,max(b.un_approved_date) as un_approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no=$txt_booking_no and b.entry_form=7");
		$first_approve_date='';
		$last_approve_date='';
		$un_approved_date='';
		if(count($max_approve_date_data))
		{
			$last_approve_date=$max_approve_date_data[0][csf('last_approve_date')];
			$first_approve_date=$max_approve_date_data[0][csf('approved_date')];
			$un_approved_date=$max_approve_date_data[0][csf('un_approved_date')];
		}
		
		if($txt_job_no!="") $location=return_field_value( "location_name", "wo_po_details_master","job_no='$txt_job_no'"); else $location="";
		$sql_loc=sql_select("select id,location_name,address from lib_location where company_id=$cbo_company_name");
		foreach($sql_loc as $row)
		{
			$location_name_arr[$row[csf('id')]]= $row[csf('location_name')];
			$location_address_arr[$row[csf('id')]]= $row[csf('address')];
		}		
		$yes_no_sql=sql_select("select job_no,cons_process from  wo_pre_cost_fab_conv_cost_dtls where job_no='$txt_job_no'  and status_active=1 and is_deleted=0  order by id");
		
		$peach=''; $brush=''; $fab_wash='';

		$emb_print=sql_select("select id, job_no, emb_name, emb_type from wo_pre_cost_embe_cost_dtls where  job_no='$txt_job_no' and status_active=1 and is_deleted=0 and cons_dzn_gmts>0 and emb_name in (1,2,3) order by id");
		
		$emb_print_data=array();
		$type_array=array(0=>$blank_array,1=>$emblishment_print_type,2=>$emblishment_embroy_type,3=>$emblishment_wash_type,4=>$emblishment_spwork_type,5=>$emblishment_gmts_type,99=>$blank_array);
		
		foreach ($emb_print as $row) 
		{
			$emb_print_data[$row[csf('job_no')]][$row[csf('emb_name')]].=$type_array[$row[csf("emb_name")]][$row[csf('emb_type')]].",";
		}
		
		// echo "<pre>";
		// print_r();

		$nameArray=sql_select( "select a.booking_no, a.booking_date, a.supplier_id, a.currency_id, a.exchange_rate, a.attention, a.delivery_date, a.po_break_down_id, a.colar_excess_percent, a.cuff_excess_percent, a.delivery_date, a.is_apply_last_update, a.fabric_source, a.inserted_by,a.rmg_process_breakdown, a.insert_date, a.update_date, a.tagged_booking_no, a.uom, a.pay_mode, a.booking_percent, b.job_no, b.buyer_name, b.style_ref_no, b.gmts_item_id, b.order_uom, b.total_set_qnty, (b.job_quantity*b.total_set_qnty) as jobqtypcs, b.style_description, b.season_buyer_wise as season, b.product_dept, b.product_code, b.pro_sub_dep, b.dealing_marchant,b.factory_marchant, b.order_repeat_no, b.repeat_job_no, a.fabric_composition, a.remarks, a.sustainability_standard, b.brand_id, a.quality_level, a.fab_material, a.requisition_no, b.qlty_label, b.packing, b.job_no, a.proceed_knitting, a.proceed_dyeing,b.team_leader,c.APPROVED_NO from wo_booking_mst a join wo_booking_mst_hstry c on c.booking_id=a.id, wo_po_details_master b where a.job_no=b.job_no and a.booking_no=$txt_booking_no");


		
		$po_id_all=$nameArray[0][csf('po_break_down_id')];
		$job_no_str=$nameArray[0][csf('job_no')];
		$booking_uom=$nameArray[0][csf('uom')];
		$bookingup_date=$nameArray[0][csf('update_date')];
		$bookingins_date=$nameArray[0][csf('insert_date')];
		$delivery_date=$nameArray[0][csf('delivery_date')];
		$requisition_no=$nameArray[0][csf('requisition_no')];
		$jobqtypcs=$nameArray[0][csf('jobqtypcs')];
		$inserted_by2=$user_name_arr[$nameArray[0][csf('inserted_by')]];

		$service_knitting_dyeing=sql_select("SELECT booking_no_prefix_num, supplier_id, entry_form from wo_booking_mst  where booking_type=3 and entry_form in (534, 535) and status_active=1 and is_deleted=0 and item_category=12 and tagged_booking_no=$txt_booking_no and process in (1,31)");
		foreach($service_knitting_dyeing as $row){
			$service_working_company[$row[csf('entry_form')]]['booking_no'][$row[csf('booking_no_prefix_num')]]=$row[csf('booking_no_prefix_num')];
			$service_working_company[$row[csf('entry_form')]]['working_company'][$row[csf('supplier_id')]]=$supplier_name_arr[$row[csf('supplier_id')]];
		}
		
		$job_yes_no=sql_select("select id, job_id,job_no, gmts_item_id, set_item_ratio, smv_pcs, smv_set, smv_pcs_precost, smv_set_precost, complexity, embelishment, cutsmv_pcs, cutsmv_set, finsmv_pcs, finsmv_set, printseq, embro, embroseq, wash, washseq, spworks, spworksseq, gmtsdying, gmtsdyingseq, ws_id, aop, aopseq,bush,bushseq,peach,peachseq,yd,ydseq from wo_po_details_mas_set_details where job_no='$job_no_str'");

	

		 $cancel_po_arr=return_library_array( "select po_number,po_number from wo_po_break_down where job_no_mst='$job_no_str' and status_active=3", "po_number", "po_number");
	

		$po_shipment_date=sql_select("select  MIN(pub_shipment_date) as min_shipment_date,max(pub_shipment_date) as max_shipment_date from wo_po_break_down where id in(".$po_id_all.") order by shipment_date asc ");
         $min_shipment_date='';
         $max_shipment_date='';
         foreach ($po_shipment_date as $row) {
         	 $min_shipment_date=$row[csf('min_shipment_date')];
         	 $max_shipment_date=$row[csf('max_shipment_date')];
         	 break;
         }

        $po_running_cancel= sql_select("select case when status_active=1 then  PO_NUMBER end as running_po, case when status_active>1 then po_number end as cancel_po,po_quantity from wo_po_break_down  where id in(".$po_id_all.") order by shipment_date asc ");
		
        $running_po='';
        $cancel_po='';
        $running_po_qnty=0;
        foreach ($po_running_cancel as $row) {
        	if(!empty($row[csf('running_po')]))
        	{
        		if(!empty($running_po))
        		{
        			$running_po.=",".$row[csf('running_po')];
        		}
        		else{
        			$running_po.=$row[csf('running_po')];
        		}
        		$running_po_qnty+=$row[csf('po_quantity')];
        	}
        	if(!empty($row[csf('cancel_po')]))
        	{
        		if(!empty($cancel_po))
        		{
        			$cancel_po.=",".$row[csf('cancel_po')];
        		}
        		else{
        			$cancel_po.=$row[csf('cancel_po')];
        		}
        	}
        }
        $stype_color_res=sql_select("select  stripe_type from wo_pre_stripe_color where job_no='$txt_job_no' and status_active=1 and is_deleted=0 group by stripe_type");
        $stype_color='';
        foreach ($stype_color_res as $val) {
        	if(!empty($stype_color))
        	{
        		$stype_color.=", ".$stripe_type_arr[$val[csf('stripe_type')]];
        	}
        	else
        	{
        		$stype_color=$stripe_type_arr[$val[csf('stripe_type')]];
        	}
        	
        }
        $yd_aop_sql=sql_select("select id, job_no,  color_type_id from wo_pre_cost_fabric_cost_dtls where job_no='$txt_job_no' and status_active=1 and is_deleted=0 order by id asc");

        $yd=''; $aop='';
		foreach ($yes_no_sql as $row) {
			
			if (strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'peach') !== false)
        	{
			    if(!empty($peach))
			    {
			    	$peach.=",".$conversion_cost_head_array[$row[csf('cons_process')]];
			    }
			    else{
			    	$peach.=$conversion_cost_head_array[$row[csf('cons_process')]];
			    }
			}
			if (strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'brush') !== false || strtolower($conversion_cost_head_array[$row[csf('cons_process')]])==strtolower('Brushing at Main Fabric Booking') || strtolower($conversion_cost_head_array[$row[csf('cons_process')]])==strtolower('Brushing at Main Fabric Booking') || strtolower($conversion_cost_head_array[$row[csf('cons_process')]])==strtolower('Brush [With Finish]') || strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'brushing') !== false)
        	{
			    if(!empty($brush))
			    {
			    	$brush.=",".$conversion_cost_head_array[$row[csf('cons_process')]];
			    }
			    else{
			    	$brush.=$conversion_cost_head_array[$row[csf('cons_process')]];
			    }
			}
			if (strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'wash') !== false || strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'washing') !== false)
        	{
			    if(!empty($fab_wash))
			    {
			    	$fab_wash.=",".$conversion_cost_head_array[$row[csf('cons_process')]];
			    }
			    else{
			    	$fab_wash.=$conversion_cost_head_array[$row[csf('cons_process')]];
			    }
			}
			if (strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'y/d') !== false || strtolower($conversion_cost_head_array[$row[csf('cons_process')]])==strtolower('YD at Main Fabric Booking') || strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'yarn dyeing') !== false)
        	{
			    if(!empty($yd))
			    {
			    	$yd.=",".$conversion_cost_head_array[$row[csf('cons_process')]];
			    }
			    else{
			    	$yd.=$conversion_cost_head_array[$row[csf('cons_process')]];
			    }
			}
			if (strpos(strtolower($conversion_cost_head_array[$row[csf('cons_process')]]), 'aop') !== false || strtolower($conversion_cost_head_array[$row[csf('cons_process')]])==strtolower('All Over Printing'))
        	{
			    if(!empty($aop))
			    {
			    	$aop.=",".$conversion_cost_head_array[$row[csf('cons_process')]];
			    }
			    else{
			    	$aop.=$conversion_cost_head_array[$row[csf('cons_process')]];
			    }
			}
		}
  		ob_start();     
		?>	
											<!--    Header Company Information         -->
        <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black; font-family:Arial Narrow;" >
            <tr>
                <td width="200" style="font-size:28px"><img  src='../../<? echo $imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' /></td>
                <td width="1250">
                    <table width="100%" cellpadding="0" cellspacing="0"  style="position: relative;">
                        <tr>
                            <td align="center" style="font-size:28px;"> <?php echo $company_library[$cbo_company_name]; ?></td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:18px;position: relative;"><?=$location_address_arr[$location]; ?></td>
                        </tr>
                        <tr>
                            <td align="center" style="font-size:24px">
                            	<span style="float:center;"><b><strong> <font style="color:black">Main Fabric Booking </font></strong></b></span> 
                            </td>
                        </tr>                        
						<tr>
                            <td align="center" style="font-size:20px">
							<?
							//$booking_no=str_replace("'",$txt_booking_no);
							if(str_replace("'","",$id_approved_id) ==1){ ?>
                            <span style="font-size:20px; float:center;"><strong> <font style="color:green"> <? echo "[Approved]"; ?> </font></strong></span> 
                               <? }else{ ?>
								<span style="font-size:20px; float:center;"><strong> <font style="color:red"><? echo "[Not Approved]"; ?> </font></strong></span> 
							   <? } ?>
							  
                            </td>
                            
							
                        </tr>
                        <tr>
                         <!-- <td align="center" style="font-size:24px">
                            	<span style="float:center;padding:2%;"><strong style="background-color:yellow;font-size: 30px;"><? echo str_replace("'","",$txt_booking_no);?></strong></span> 
                            </td> -->
							<td align="right"><strong style="background-color:yellow;font-size: 30px;margin-right:10%;"><?=str_replace("'","",$txt_booking_no);;?></strong></td>
                        </tr>
                        
						
                    </table>
					
                </td>
                <td width="200">
                	<table style="border:1px solid black; font-family:Arial Narrow;" width="100%">
                		<tr>
                			<td><b>Min. Ship Date:</b></td>
                			<td><b><?php echo  date('d-m-Y',strtotime($min_shipment_date));?></b></td>
                		</tr>
                		<tr>
                			<td><b>Max. Ship Date:</b></td>
                			<td><b><?php echo date('d-m-Y',strtotime($max_shipment_date));?></b></td>
                		</tr>
                	</table>
                	<br>
                	<table style="border:1px solid black; font-family:Arial Narrow;font-size: 10px;" width="100%">
                		<tr>
                			<td>Printing Date :</td>
                			<td><?php echo  date('d-m-Y');?></td>
                		</tr>
                		<tr>
                			<td>Printing Time:</td>
                			<td><?php echo  date('h:i:sa');?></td>
                		</tr>
                		<tr>
                			<td>User Name:</td>
                			<td><?php echo $user_name_arr[$user_id];?></td>
                		</tr>
                		<tr>
                			<?php 
                				function get_client_ip() {
								    $ipaddress = '';
								    if (getenv('HTTP_CLIENT_IP'))
								        $ipaddress = getenv('HTTP_CLIENT_IP');
								    else if(getenv('HTTP_X_FORWARDED_FOR'))
								        $ipaddress = getenv('HTTP_X_FORWARDED_FOR');
								    else if(getenv('HTTP_X_FORWARDED'))
								        $ipaddress = getenv('HTTP_X_FORWARDED');
								    else if(getenv('HTTP_FORWARDED_FOR'))
								        $ipaddress = getenv('HTTP_FORWARDED_FOR');
								    else if(getenv('HTTP_FORWARDED'))
								       $ipaddress = getenv('HTTP_FORWARDED');
								    else if(getenv('REMOTE_ADDR'))
								        $ipaddress = getenv('REMOTE_ADDR');
								    else
								        $ipaddress = 'UNKNOWN';
								    return $ipaddress;
								}

                			 ?>
                			<td>IP Address:</td>
                			<td><?php if(empty($user_ip)){echo get_client_ip();} echo $user_ip;?></td>
                		</tr>
                	</table>
                </td>
            </tr>
        </table>
		<?
        $job_no=trim($txt_job_no,"'"); $total_set_qnty=0; $colar_excess_percent=0; $cuff_excess_percent=0; $rmg_process_breakdown=0; $booking_percent=0; $booking_po_id='';
		if($db_type==0)
        {
            $date_dif_cond="DATEDIFF(pub_shipment_date,po_received_date)";
            $group_concat_all="group_concat(grouping) as grouping, group_concat(file_no) as file_no";
        }
        else
        {
            $date_dif_cond="(pub_shipment_date-po_received_date)";
            $group_concat_all=" listagg(cast(grouping as varchar2(4000)),',') within group (order by grouping) as grouping,
                                listagg(cast(file_no as varchar2(4000)),',') within group (order by file_no) as file_no  ";
        }
        $po_number_arr=array(); $po_ship_date_arr=array(); $shipment_date=""; $po_no=""; $po_received_date=""; $shiping_status="";
        $po_sql=sql_select("select id, po_number, pub_shipment_date, MIN(pub_shipment_date) as mpub_shipment_date, MIN(po_received_date) as po_received_date, MIN(insert_date) as insert_date, plan_cut, po_quantity, shiping_status, $date_dif_cond as date_diff,min(factory_received_date) as factory_received_date, $group_concat_all,status_active from wo_po_break_down where id in(".$po_id_all.") group by id, po_number, pub_shipment_date, plan_cut, po_quantity, shiping_status, po_received_date,status_active ");
      
		
        $to_ship=0; $fp_ship=0; $f_ship=0;

        foreach($po_sql as $row)
        {
            $po_qnty_tot+=$row[csf('plan_cut')];
            $po_qnty_tot1+=$row[csf('po_quantity')];
            $po_number_arr[$row[csf('id')]]=$row[csf('po_number')];
            $po_ship_date_arr[$row[csf('id')]]=$row[csf('pub_shipment_date')];
            $po_num_arr[$row[csf('id')]]=$row[csf('po_number')];
            $po_no.=$row[csf('po_number')].", ";
            $shipment_date.=change_date_format($row[csf('mpub_shipment_date')],'dd-mm-yyyy','-').", ";
            $lead_time.=$row[csf('date_diff')].",";
            $po_received_date=change_date_format($row[csf('po_received_date')],'dd-mm-yyyy','-');
            $factory_received_date=change_date_format($row[csf('factory_received_date')],'dd-mm-yyyy','-');
            $grouping.=$row[csf('grouping')].",";
            $file_no.=$row[csf('file_no')].",";
			if($row[csf('status_active')]==3){
				$cancel_po_no[$row[csf('po_number')]]=$row[csf('po_number')];
			}

			
			$daysInHand.=(datediff('d',date('d-m-Y',time()),$row[csf('mpub_shipment_date')])-1).",";
			
			if($bookingup_date=="" || $bookingup_date=="0000-00-00 00:00:00")
			{
				$booking_date=$bookingins_date;
			}
			$WOPreparedAfter.=(datediff('d',$row[csf('insert_date')],$booking_date)-1).",";

			if($row[csf('shiping_status')]==1) {
				$shiping_status.= "FP".",";
				$to_ship++;
				$fp_ship++;
			}
			else if($row[csf('shiping_status')]==2){
				$shiping_status.= "PD".",";
				$to_ship++;
			} 
			else if($row[csf('shiping_status')]==3){
				$shiping_status.= "FS".",";
				$to_ship++;
				$f_ship++;
			} 
        }

        if($to_ship==$f_ship) $shiping_status= "<b style='color:green'>Full shipped</b>";
        else if($to_ship==$fp_ship) $shiping_status= "<b style='color:red'>Full Pending</b>";
        else $shiping_status= "<b style='color:red'>Partial Delivery</b>";
		
		$po_no=implode(",",array_filter(array_unique(explode(",",$po_no))));
		$shipment_date=implode(",",array_filter(array_unique(explode(",",$shipment_date))));
		$lead_time=implode(",",array_filter(array_unique(explode(",",$lead_time))));
		$po_received_date=implode(",",array_filter(array_unique(explode(",",$po_received_date))));
		$factory_received_date=implode(",",array_filter(array_unique(explode(",",$factory_received_date))));
		$grouping=implode(",",array_filter(array_unique(explode(",",$grouping))));
		$file_no=implode(",",array_filter(array_unique(explode(",",$file_no))));
		
		$daysInHand=implode(",",array_filter(array_unique(explode(",",$daysInHand))));
		$WOPreparedAfter=implode(",",array_filter(array_unique(explode(",",$WOPreparedAfter))));
		$shiping_status=implode(",",array_filter(array_unique(explode(",",$shiping_status))));
		
        foreach ($nameArray as $result)
        {
            $total_set_qnty=$result[csf('total_set_qnty')];
            $colar_excess_percent=$result[csf('colar_excess_percent')];
            $cuff_excess_percent=$result[csf('cuff_excess_percent')];
            $rmg_process_breakdown=$result[csf('rmg_process_breakdown')];
            
            $booking_percent=$result[csf('booking_percent')];
			$booking_po_id=$result[csf('po_break_down_id')];
			?>
			<table width="100%" class="rpt_table"  border="1" align="left" cellpadding="0"  cellspacing="0" rules="all"  style="font-size:18px; font-family:Arial Narrow;" >
				<tr>
					<td colspan="2" rowspan="6" width="210">
						<? $nameArray_imge =sql_select("SELECT image_location FROM common_photo_library where master_tble_id='$job_no' and file_type=1"); ?>
                        <div id="div_size_color_matrix" style="float:left;">
                            <fieldset id="" width="210">
                                <legend>Image </legend>
                                <table width="208">
                                    <tr>
										<?
                                        $img_counter = 0;
                                        foreach($nameArray_imge as $result_imge)
                                        {
											if($path=="") $path='../../../';
											?>
											<td><img src="<? echo $path.$result_imge[csf('image_location')]; ?>" width="200" height="200" border="2" /></td>
											<?
											$img_counter++;
                                        }
                                        ?>
                                    </tr>
                                </table>
                            </fieldset>
                        </div>
					</td>
					<td align="center" width="100" style="background-color:#808080"><b>Job No</b></td>
					<td align="center" width="140" colspan="3" style="background-color:#808080"> <span style="font-size:18px"><b style="float:left;font-size:18px"><? echo trim($txt_job_no,"'");if(!empty($revised_no)){ ?>&nbsp;<span style="color: red;">/&nbsp;<? echo $revised_no; }?></span></b> </span> </td>
					<td align="center" width="100" style="background-color:#808080"><span style="font-size:18px"><b>Booking No</b></span></td>
					<td align="center" width="110" style="background-color:#808080"><span style="font-size:18px"><b><?=$result[csf('booking_no')];?></b><?="<br>(".$fabric_source[$result[csf('fabric_source')]].")" ?> </span> </td>
					<td align="center" width="100" style="background-color:#808080"><span style="font-size:18px"><b>Sample Req. No</b></span></td>
					<td align="center" width="110" colspan="2" style="background-color:#808080">&nbsp;<span style="font-size:18px" ><?php echo $requisition_no; ?></span></td>
					
					<!-- <td align="center" colspan="2" width="340"></td> -->
				</tr>
				<?php
					$order_yes_no=sql_select("Select embelishment ,embro ,wash  ,spworks ,gmtsdying , ws_id , aop , aopseq , bush ,  peach, yd    from wo_po_details_mas_set_details where job_no='$txt_job_no' order by id");			
				?>
				<tr style="text-align:center">
					<td align="center"width="100" style="font-size:16px;"><b>Style</b></td>
					<td width="110"style="font-size:16px;" >&nbsp;<? echo $result[csf('style_ref_no')]; ?></td>
					
					<td width="100" style="font-size:16px;"><b>Dept. (Prod Code)</b></td>
					<td width="140"style="font-size:16px;" >&nbsp;<? echo $product_dept[$result[csf('product_dept')]]; if($result[csf('product_code')] !=""){ echo " (".$result[csf('product_code')].")";} ?></td>
					
					<td width="100"><b>Print / Type</b></td>
					<td width="110" align="center"><?=($order_yes_no[0][csf('embelishment')]==1 || (!empty($emb_print_data[$txt_job_no][1]))) ? 'Yes' : 'No' ;?></td>
					<td width="100"><?=!empty($emb_print_data[$txt_job_no][1]) ? chop($emb_print_data[$txt_job_no][1],",") : '' ;?></td>
				
					<td width="110"><b>Booking Date</b></td>
					<td width="100"> <?
                        if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
                        {
                        }
                        $booking_date=$result[csf('insert_date')];
                        echo change_date_format($booking_date,'dd-mm-yyyy','-','');
                        ?>
                    </td>
				</tr>
				<tr style="text-align:center">
					<td width="100"><span style="font-size:18px"><b>Buyer/Agent Name</b></span></td>
					<td width="110">&nbsp;<span style="font-size:18px"><? echo $buyer_name_arr[$result[csf('buyer_name')]]; ?></span></td>
					<td width="100"><b>Sub Dep</b></td>
					<td width="140"><? if($result[csf('pro_sub_dep')] !=0){ echo " (".$pro_sub_dept_array[$result[csf('pro_sub_dep')]].")";}?></td>
					<td width="100"><b>EMB / Type</b></td>
					<td width="110" align="center"><?php echo  ($order_yes_no[0][csf('embro')]==1 || (!empty($emb_print_data[$txt_job_no][2]))) ? 'Yes' : 'No' ;?></td>
					<td width="100"><?php echo  !empty($emb_print_data[$txt_job_no][2]) ? chop($emb_print_data[$txt_job_no][2],",") : '' ;?></td>

				
					<td width="110"><b>Delivery Date</b></td>
					<td width="100"><? echo change_date_format($delivery_date); ?></td>
				</tr>
				<tr style="text-align:center">
					<td width="100"><span style="font-size:18px"><b>Garments Item</b></span></td>
					<td width="110">&nbsp;<span style="font-size:18px"> <?
                        $gmts_item_name="";
                        $gmts_item=explode(',',$result[csf('gmts_item_id')]);
                        for($g=0;$g<=count($gmts_item); $g++)
                        {
                            $gmts_item_name.= $garments_item[$gmts_item[$g]].",";
                        }
                        echo rtrim($gmts_item_name,',');
                        ?></span></td>
					<td width="100"><b>Season</b></td>
					<td width="140"><? echo $season_name_arr[$result[csf('season')]]; ?></td>

							
					<td width="100"><b>AOP</b></td>
					<td width="110" align="center"><?php echo   ($order_yes_no[0][csf('aop')]==1 || (!empty($aop))) ? 'Yes' : 'No' ;?></td>
					<td width="100"><?=$aop;?></td>
				
					<td width="110"><b>Approved Date</b></td>
					<td width="100" align="center" title="Date=<?=$nameArray_approved_date_chk;?>">	<b style="color:green"><? //date('d-m-Y',strtotime($nameArray_approved_date_chk2)); 
					if($nameArray_approved_date_chk!="") echo date('d-m-Y',$nameArray_approved_date_chk);else echo ""; ?></b></td>
				</tr>
				<tr style="text-align:center">
					<td width="100"><span style="font-size:18px"><b>Order Repeat No</b></span></td>
					<td width="110">&nbsp;<span style="font-size:18px"><?=$result[csf('order_repeat_no')];?></span></td>
					<td width="100"><b>Brand</b></td>
					<td width="140"><?php echo $brand_name_arr[$result[csf('brand_id')]]; ?></td>
					<td width="100"><b>YD</b></td>
					<td width="110" align="center"><?php echo (!empty($yd) || $order_yes_no[0][csf('yd')]==1)  ? 'Yes' : 'No' ;?></td>
					<td width="100"><?php 	echo $yd; ?></td>
					
					<td width="110"><b>Approved Status</b></td>
					<td width="100" align="center">
					<? if(str_replace("'","",$id_approved_id) ==1){ ?>
					<b style="color:green"><?="Yes"; ?></b>
					<? }else{ ?><b style="color:red"><?	echo "No";?></b><? }; ?></td>
				</tr>
				<tr style="text-align:center">
					<td width="100"><span style="font-size:18px"><b>Order Repeat Job No</b></span></td>
					<td width="110"><span style="font-size:18px"><? echo $result[csf('repeat_job_no')];?><b> </span> </td>
					<td width="100"><b>Fab. Material</b></td>
					<td width="140"><?php echo $fab_material[$result[csf('fab_material')]]; ?></td>
					<td width="100"><b>Peach</b></td>
					
					<td width="110" align="center"><?php echo  ($job_yes_no[0][csf('peach')]==1 || (!empty($peach))) ? 'Yes' : 'No' ;?></td>
					<td width="100"><?=$peach;?></td>
					<td width="110"><b>Amendment Date</b></td>
					<td width="100"><? if(!empty($un_approved_date)){echo change_date_format($un_approved_date);} ?></td>
				</tr>
				<tr style="text-align:center">
					<td width="100"><span style="font-size:18px"><b>Running PO No</b></span></td>
					<td width="350" colspan="3" style="word-break: break-all;"><p style="font-size:12px;width: 450px;word-break: break-all;" ><? echo $running_po; ?></p></td>
					<td width="100"><b>Sustainability Standard</b></td>
					<td width="110"><?php echo $sustainability_standard[$result[csf('sustainability_standard')]]; ?></td>

					<td width="100"><b>Brushing</b></td>
					<td width="110" align="center"><?php echo  ($job_yes_no[0][csf('bush')]==1 ||  (!empty($brush))) ? 'Yes' : 'No' ;?></td>
					<td width="100"><?=$brush;?></td>
					<td width="110"><b>Team Leader</b></td>
					<td width="100"><?=$team_leader_arr[$result[csf('team_leader')]];?></td>
				</tr>
				<tr style="text-align:center">
					<td width="100"><span style="font-size:18px"><b>Cancelled PO</b></span></td>
					<td width="350" colspan="3" ><p style="font-size:12px;width: 450px;word-break: break-all;"><? 	echo implode(",",$cancel_po_arr);;//$cancel_po; ?></p></td>		
					<?php $fab_material=array(1=>"Organic",2=>"BCI"); ?>
					<td width="100"><b>Order Nature</b> </td>
					<td width="110"><?php echo $fbooking_order_nature[$result[csf('quality_level')]] ?></td>
					<td width="100"><b>Fab Wash</b></td>
					<td width="110" align="center"><?php echo !empty($fab_wash)? 'Yes' : 'No'; ?></td>
					<td width="100"><?=$fab_wash?></td>
				

					<td width="110"><b>Dealing Merchandiser</b></td>
					<td width="100"><? echo $marchentrArr[$result[csf('dealing_marchant')]]; ?></td>
				</tr>
				<tr style="text-align:center">
					<td width="100"><span style="font-size:18px"><b>GMT/ Style Description</b></span></td>
					<td width="350" colspan="3"><span style="font-size:18px"><? echo $result[csf('style_description')]; ?></span></td>
					<td width="100"><b>Quality Label</b></td>
					<td width="110"><?php echo $quality_label[$result[csf('qlty_label')]] ?></td>

					<td width="100"><b>GMT Wash</b></td>
					
					<td width="110" align="center"><?php echo  ($order_yes_no[0][csf('wash')]==1 || (!empty($emb_print_data[$txt_job_no][3]))) ? 'Yes' : 'No' ;?></td>
					<td width="100"><?php echo  !empty($emb_print_data[$txt_job_no][3]) ? chop($emb_print_data[$txt_job_no][3],",") : '' ;?></td>

					<td width="110"><b>Factory Merchandiser</b></td>
					<td width="100"><? echo $marchentrArr[$result[csf('factory_marchant')]]; ?></td>
				</tr>
				<tr style="text-align:center">
					<td width="100"><span style="font-size:18px"><b>Fabric Description</b></span></td>
					<td width="350" colspan="3"><span style="font-size:18px">
						<? 
							$sql_fab="SELECT a.lib_yarn_count_deter_id AS determin_id, a.construction
							    FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
							   WHERE a.job_id = b.job_id AND a.id = b.pre_cost_fabric_cost_dtls_id AND a.id = d.pre_cost_fabric_cost_dtls_id AND b.po_break_down_id = d.po_break_down_id AND b.color_size_table_id = d.color_size_table_id AND b.pre_cost_fabric_cost_dtls_id = d.pre_cost_fabric_cost_dtls_id AND d.booking_no = $txt_booking_no AND a.status_active = 1 AND d.status_active = 1 AND d.is_deleted = 0 and a.body_part_id in (1,20) group by a.lib_yarn_count_deter_id , a.construction";
							//echo $sql_fab;
							$res_fab=sql_select($sql_fab);
							$des='';
							foreach ($res_fab as $row) 
							{
								if(!empty($des))
								{
									$des."***";
								}
								$des.=$row[csf('construction')] . " ". $fabric_composition[$lip_yarn_count[$row[csf('determin_id')]]].",";
							}
							echo implode(",", array_unique(explode("***", $des)));
						?>
						</span></td>
					<td width="100"><b>Packing</b></td>
					<td width="110"><?php echo $packing[$result[csf('packing')]]; ?></td>
					<td width="100" style="background-color:#808080"><b>Running Order Qty</b></td>
					<?php $order_uom_res=sql_select( "select a.order_uom from wo_po_details_master a where a.status_active=1 and a.is_deleted=0  and a.job_no='$txt_job_no' ");
						$order_uom='';
						if(count($order_uom_res))
						{
							$order_uom=$unit_of_measurement[$order_uom_res[0][csf('order_uom')]];
						}
					 ?>
					<td width="210" colspan="2" align="center" style="background-color:#808080"><b> <?php echo number_format($running_po_qnty,0); ?>&nbsp;(<?=$order_uom;?>)</b></td>
					<td width="110" style="background-color:#808080"><b>Shipment Status</b></td>
					<td width="100" style="background-color:#808080"><? echo rtrim($shiping_status,','); ?></td>
				</tr>
				<tr style="text-align:center">
					<td width="100"><span style="font-size:18px"><b>Attention</b></span></td>
					<td  width="350" colspan="3"><span style="font-size:18px"><? echo $result[csf('attention')]?></span></td>
					<td width="100"><b>Proceed for Knitting</b></td>
					<td width="110">	<?php 
					if($result[csf('proceed_knitting')]==1){?>
					<b style="color:green"><? echo $yes_no[$result[csf('proceed_knitting')]]; ?></b>
					<?}else{?>
						<b style="color:red"><? echo $yes_no[$result[csf('proceed_knitting')]]; ?></b>
						<?}?></td>
					<td width="100"><b>Working Company</b></td>
					<td width="210"  align="center" colspan="2"><? echo implode(",",$service_working_company[534]['working_company'])  ?></td>
					<td width="100"><b>Work Order No</b></td>
					<td width="110"  align="center"><? echo implode(",",$service_working_company[534]['booking_no'])  ?></td>					
				</tr>
                <tr style="text-align:center">
				<td width="100"><span style="font-size:18px"><b>Remarks</b></span></td>
				<td  width="350" colspan="3"><b><?php if(!empty($result[csf('remarks')])){ ?><span style="font-size: 25px;">&#8592;</span><? echo $result[csf('remarks')]; } ?></b></td>
				<td><b>Proceed for Dyeing</b></td>
					<td>
						
					<?php 
					if($result[csf('proceed_dyeing')]==1){?>
					<b style="color:green"><? echo $yes_no[$result[csf('proceed_dyeing')]]; ?></b>
					<?}else{?>
						<b style="color:red"><? echo $yes_no[$result[csf('proceed_dyeing')]]; ?></b>
						<?}?>
					</td>
					<td><b>Working Company</b></td>
					<td width="210"  align="center" colspan="2"><? echo implode(",",$service_working_company[535]['working_company'])  ?></td>
					<td width="100"><b>Work Order No</b></td>
					<td width="110" align="center"><? echo implode(",",$service_working_company[535]['booking_no'])  ?></td>
				</tr>				
			</table>
			
			<?
		}	
			
	  	?>
		<span style="color:red; font-size:14px">PLS NOTE: BEFORE START KNITTING MUST CHECK ALL THE BELLOW INFORMATIONS, SPECIALLY DIA, GREY GSM, S/L & COUNT ETC. ANTIQUE WHITE MUST BE TEFLON FINISH TREATMENT</span>
		

		<?php
	
	$nameArray_fabric_description= sql_select("select a.body_part_id, a.lib_yarn_count_deter_id as determin_id, a.color_type_id, a.construction, a.composition, a.gsm_weight, min(a.width_dia_type) as width_dia_type, b.dia_width, b.remarks, avg(b.cons) as cons, b.process_loss_percent, avg(b.requirment) as requirment,b.po_break_down_id,  d.fabric_color_id, d.gmts_color_id, d.id as dtls_id, sum(d.fin_fab_qnty) as fin_fab_qnty, sum(d.grey_fab_qnty) as grey_fab_qnty,a.id FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and d.status_active=1 and d.is_deleted=0  AND a.status_active = 1 AND a.is_deleted = 0   AND c.status_active = 1  AND c.is_deleted = 0  AND b.status_active = 1  AND b.is_deleted = 0 group by a.body_part_id,a.id, a.lib_yarn_count_deter_id, a.color_type_id, a.construction, a.composition, a.gsm_weight, b.dia_width, b.remarks,d.fabric_color_id, d.gmts_color_id, d.id,b.po_break_down_id, b.process_loss_percent order by a.id, a.body_part_id, b.dia_width");
	
	
	
	
		foreach ($nameArray_fabric_description as $row) {	
			$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."'  and approval_status=3 and is_deleted=0  and color_name_id=".$row[csf('fabric_color_id')]." and  po_break_down_id=".$row[csf('po_break_down_id')]."  and status_active=1 and is_deleted=0 ");
	
			$grouping_item=$row[csf('fabric_color_id')].'*'.$row[csf('body_part_id')].'*'.$row[csf('construction')].'*'.$row[csf('composition')].'*'.$row[csf('gsm_weight')].'*'.$row[csf('dia_width')].'*'.$row[csf('color_type_id')];	
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['gmts_color_id'] = $row[csf('gmts_color_id')];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['fabric_color_id'] = $row[csf('fabric_color_id')];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['lapdip_no'] = $lapdip_no;
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['body_part_id'] = $row[csf('body_part_id')];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['fabric_des'] = $row[csf('construction')].','.$row[csf('composition')];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['gsm'] = $row[csf('gsm_weight')];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['fabric_dia'] = $row[csf('dia_width')].",".$fabric_typee[$row[csf('width_dia_type')]];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['color_type_id'] = $row[csf('color_type_id')];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['finsh_cons'] = $row[csf('cons')];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['gray_cons'] = $row[csf('requirment')];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['fin_fab_qnty'] += $row[csf('fin_fab_qnty')];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['grey_fab_qnty'] += $row[csf('grey_fab_qnty')];
			$fabric_data_arr[$row[csf('gmts_color_id')]][$grouping_item]['process_loss_percent'] = $row[csf('process_loss_percent')];
	
		}
	
		// /*echo '<pre>';
		// print_r($fabric_data_arr); die;*/
	
		?>
		 <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" style="font-size: 18px;">
			 <tr>
				 <th>Gmts Color</th>
				 <th>Fabric Color</th>
				 <th>Lab Dip No</th>
				 <th>Body Part</th>
				 <th>Fabrication</th>
				 <th>GSM</th>
				 <th>Dia Type with </br> Fabric Dia</th>			
				 <th>Color Type</th>
				 <th>Finsh Cons.</th>
				 <th>Finish  Qty</th>
				 <th>Grey Cons.</th>
				 <th>Grey Qty</th>
				 <th>Process Loss %</th>
			 </tr>
			 <? 
			 foreach ($fabric_data_arr as $gmts_id=>$fabric_data_arr) {  
				$i=1;     		  		
					foreach ($fabric_data_arr as $fabric_id => $value) {
							$fin_fab_qnty+=$value['fin_fab_qnty'];   		 	
							$grey_fab_qnty+=$value['grey_fab_qnty'];   		 	
							 if($i==1){
							  ?>
							 <tr>
								<td rowspan="<? echo count($fabric_data_arr) ?>"><? echo $color_library[$gmts_id] ?></td>
								<td><? echo $color_library[$value['fabric_color_id']] ?></td>
							    <td><? echo $value['lapdip_no']; ?></td>
								<td><? echo $body_part[$value['body_part_id']] ?></td>
								<td><? echo $value['fabric_des'] ?></td>
								<td><? echo $value['gsm'] ?></td>
								<td><? echo $value['fabric_dia'] ?></td>
								<td><? echo $color_type[$value['color_type_id']] ?></td>
								<td align="right"><? echo fn_number_format($value['finsh_cons'],4) ; ?></td>
								<td align="right"><? echo fn_number_format($value['fin_fab_qnty'],4) ; ?></td>
								<td align="right"><? echo fn_number_format($value['gray_cons'],4) ; ?></td>		     			
								<td align="right"><? echo fn_number_format($value['grey_fab_qnty'],4) ; ?></td>
								<td align="center"><? echo $value['process_loss_percent'] ?></td>
							</tr>
							 <? } 
							 else { ?>
								 <tr>
									<td><? echo $color_library[$value['fabric_color_id']] ?></td>
									<td><? echo $value['lapdip_no'];?></td>
									<td><? echo $body_part[$value['body_part_id']] ?></td>
									<td><? echo $value['fabric_des'] ?></td>
									<td><? echo $value['gsm'] ?></td>
									<td><? echo $value['fabric_dia'] ?></td>
									<td><? echo $color_type[$value['color_type_id']] ?></td> 
									<td align="right"><? echo fn_number_format($value['finsh_cons'],4) ; ?></td>
									<td align="right"><? echo number_format($value['fin_fab_qnty'],2) ?></td>
									<td align="right"><? echo fn_number_format($value['gray_cons'],4) ; ?></td>			     			
									<td align="right"><? echo number_format($value['grey_fab_qnty'],2) ?></td>
									<td align="center"><? echo $value['process_loss_percent'] ?></td>
								</tr>
							 <? }
							 $i++;
					}
				} 
			 ?>
			 <tr>
				 <th colspan="9">Total</th>
				 <th><? echo number_format($fin_fab_qnty);  ?></th>
				 <th></th>
				 <th><? echo number_format($grey_fab_qnty);  ?></th>
				 <th></th>
			 </tr>
		 </table>
		  <br/>



      	<!--  Here will be the main portion  -->
		<?
        $costing_per=""; $costing_per_qnty=0;
        $costing_per_id=return_field_value( "costing_per", "wo_pre_cost_mst","job_no ='$job_no'");
        if($costing_per_id==1)
        {
			$costing_per="1 Dzn";
			$costing_per_qnty=12;
        }
        if($costing_per_id==2)
        {
			$costing_per="1 Pcs";
			$costing_per_qnty=1;
        }
        if($costing_per_id==3)
        {
			$costing_per="2 Dzn";
			$costing_per_qnty=24;
        }
        if($costing_per_id==4)
        {
			$costing_per="3 Dzn";
			$costing_per_qnty=36;
        }
        if($costing_per_id==5)
        {
			$costing_per="4 Dzn";
			$costing_per_qnty=48;
        }




        $process_loss_method=return_field_value( "process_loss_method", "wo_pre_cost_fabric_cost_dtls","job_no='$job_no'");
		//$s_length=return_field_value( "stitch_length", "fabric_mapping","mst_id=$determin_id");;
		$s_lengthArr=return_library_array( "select mst_id, stitch_length from fabric_mapping",'mst_id','stitch_length');		
		if($cbo_fabric_source==1)
		{
			$fb_desc_sq="SELECT min(a.id) as fabric_cost_dtls_id, a.lib_yarn_count_deter_id as determin_id, a.item_number_id, a.body_part_id, a.color_type_id, a.construction, a.composition, a.gsm_weight, min(a.width_dia_type) as width_dia_type,  b.dia_width, avg(b.cons) as cons, avg(b.process_loss_percent) as process_loss_percent, avg(b.requirment) as requirment FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d WHERE a.job_id=b.job_id and a.id=b.pre_cost_fabric_cost_dtls_id  and a.id=d.pre_cost_fabric_cost_dtls_id  and b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and d.booking_no=$txt_booking_no and a.status_active=1 and d.status_active=1 and d.is_deleted=0 group by a.body_part_id, a.lib_yarn_count_deter_id, a.color_type_id, a.item_number_id, a.construction, a.composition, a.gsm_weight,  b.dia_width order by fabric_cost_dtls_id, a.body_part_id, b.dia_width";
			
			$nameArray_fabric_description= sql_select($fb_desc_sq);
			?>
			<table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" style="font-family:Arial Narrow;font-size:18px;" >
                <tr align="center">
                    <th colspan="2" align="left">Body Part</th>
                    <?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
						if( $result_fabric_description[csf('body_part_id')] == "") echo "<td  colspan='2'>&nbsp</td>";
						else echo "<td colspan='2'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
                    }
                    ?>
                   <th colspan="2" align="center">Total</th>
                </tr>
                <tr>
                    <th width="120" align="left">Fabric Color</th>
                    <th width="120" align="left">Body Color</th>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
                   		echo "<th width='50'>Finish</th><th width='50' >Grey</th>";
                    }
                    ?>
					<th width='50'>Finish</th>
					<th width='50' >Grey</th>
                </tr>
                <?
                $color_wise_wo_sql = "SELECT a.item_number_id, a.body_part_id, a.color_type_id, a.construction, a.composition, a.gsm_weight, a.lib_yarn_count_deter_id, b.dia_width, b.remarks, d.fabric_color_id, d.fin_fab_qnty as fin_fab_qnty, d.grey_fab_qnty as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a join wo_pre_cos_fab_co_avg_con_dtls b on  a.id=b.pre_cost_fabric_cost_dtls_id join wo_po_color_size_breakdown c on c.id=b.color_size_table_id join wo_booking_dtls d on b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id WHERE  d.booking_no =$txt_booking_no and a.uom=12 and d.status_active=1 and  d.is_deleted=0 ";
                
                $color_wise_wo_sql_res=sql_select($color_wise_wo_sql); $fin_grey_qty_arr=array(); $fin_grey_color_qty_arr=array();
                foreach($color_wise_wo_sql_res as $row)
                {
					$fin_grey_key = $row[csf('item_number_id')].'**'.$row[csf('body_part_id')].'**'.$row[csf('color_type_id')].'**'.$row[csf('construction')].'**'.$row[csf('composition')].'**'.$row[csf('gsm_weight')].'**'.$row[csf('lib_yarn_count_deter_id')].'**'.$row[csf('dia_width')];
					$fin_grey_color_key = $row[csf('item_number_id')].'**'.$row[csf('body_part_id')].'**'.$row[csf('color_type_id')].'**'.$row[csf('construction')].'**'.$row[csf('composition')].'**'.$row[csf('gsm_weight')].'**'.$row[csf('lib_yarn_count_deter_id')].'**'.$row[csf('dia_width')].'**'.$row[csf('fabric_color_id')];
					$fin_grey_qty_arr[$fin_grey_key]['fin'] += $row[csf('fin_fab_qnty')];
					$fin_grey_qty_arr[$fin_grey_key]['grey'] += $row[csf('grey_fab_qnty')];
					$fin_grey_color_qty_arr[$fin_grey_color_key]['fin'] +=$row[csf('fin_fab_qnty')];
					$fin_grey_color_qty_arr[$fin_grey_color_key]['grey'] +=$row[csf('grey_fab_qnty')];
                }
                unset($color_wise_wo_sql_res);
                
                $gmt_color_library=array();
                $gmt_color_data=sql_select("select a.id,b.gmts_color_id, b.contrast_color_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.fabric_source =$cbo_fabric_source and a.job_no ='$job_no' and a.status_active=1 and b.status_active=1 order by a.id");
                foreach( $gmt_color_data as $gmt_color_row)
                {
                	$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
                }
                
                $lab_dip_no_arr=array();
                $lab_dip_no_sql=sql_select("select lapdip_no, color_name_id from wo_po_lapdip_approval_info where job_no_mst='$job_no' and status_active=1 and is_deleted=0 and approval_status=3");
                foreach($lab_dip_no_sql as $row)
                {
                	$lab_dip_no_arr[$row[csf('color_name_id')]]=$row[csf('lapdip_no')];
                }
                unset($lab_dip_no_sql);
                
                $grand_total_fin_fab_qnty=0; $grand_total_grey_fab_qnty=0; $grand_totalcons_per_finish=0; $grand_totalcons_per_grey=0;
                $color_wise_wo_sql=sql_select("select fabric_color_id FROM wo_booking_dtls WHERE booking_no =$txt_booking_no and status_active=1 and is_deleted=0 group by fabric_color_id");
                foreach($color_wise_wo_sql as $color_wise_wo_result)
                {
					?>
					<tr>
                        <td width="120" align="left"><? echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]]; ?></td>
                        <td width="120"><? echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]); ?></td>
                       
                        <?
                        $total_fin_fab_qnty=0; $total_grey_fab_qnty=0;
                        foreach($nameArray_fabric_description as $result_fabric_description)
                        {
							$color_wo_fin_qnty=0; $color_wo_grey_qnty=0;
							$fin_gray_color = $result_fabric_description[csf('item_number_id')].'**'.$result_fabric_description[csf('body_part_id')].'**'.$result_fabric_description[csf('color_type_id')].'**'.$result_fabric_description[csf('construction')].'**'.$result_fabric_description[csf('composition')].'**'.$result_fabric_description[csf('gsm_weight')].'**'.$result_fabric_description[csf('determin_id')].'**'.$result_fabric_description[csf('dia_width')].'**'.$color_wise_wo_result[csf('fabric_color_id')];
							$color_wo_fin_qnty=$fin_grey_color_qty_arr[$fin_gray_color]['fin'];
							
							$color_wo_grey_qnty=$fin_grey_color_qty_arr[$fin_gray_color]['grey'];
							?>
							<td width='50' align='center' style="font-size:18px;">
								<?
                                if($color_wo_fin_qnty!="")
                                {
                                    echo number_format($color_wo_fin_qnty,2) ;
                                    $total_fin_fab_qnty+=$color_wo_fin_qnty;
                                }
                                ?>
							</td>
							<td width='50' align='center' style="font-size:18px;">
								<?
                                if($color_wo_grey_qnty!="")
                                {
									echo number_format($color_wo_grey_qnty,2);
									$total_grey_fab_qnty+=$color_wo_grey_qnty;
                                }
                                ?>
							</td>
							
							
							<?
                        }
                        ?>
						<td width='50' align='center' style="font-size:18px;">
								<?
                                
									echo number_format($total_fin_fab_qnty,2);
									 $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;
                                
                                ?>
							</td>
							
							<td width='50' align='center' style="font-size:18px;">
								<?
                               
									echo number_format($total_grey_fab_qnty,2);
									 $grand_total_grey_fab_qnty+=$total_grey_fab_qnty;
                                
                                ?>
							</td>
                        
					</tr>
					<?
                }
                ?>
                <tr style=" font-weight:bold">
                    <th width="120" align="left">&nbsp;</th>      
					                
                    <td width="120" align="left"><strong>Total</strong></td>
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
						$wo_fin_qnty=0; $wo_grey_qnty=0;
						$fin_key = $result_fabric_description[csf('item_number_id')].'**'.$result_fabric_description[csf('body_part_id')].'**'.$result_fabric_description[csf('color_type_id')].'**'.$result_fabric_description[csf('construction')].'**'.$result_fabric_description[csf('composition')].'**'.$result_fabric_description[csf('gsm_weight')].'**'.$result_fabric_description[csf('determin_id')].'**'.$result_fabric_description[csf('dia_width')];
						
						$wo_fin_qnty=$fin_grey_qty_arr[$fin_key]['fin'];
						$wo_grey_qnty=$fin_grey_qty_arr[$fin_key]['grey'];
						?>
						<td width='50' align='center' style="font-size:18px;"><?  echo number_format($wo_fin_qnty,2) ;?></td><td width='50' align='center' style="font-size:18px;" > <? echo number_format($wo_grey_qnty,2);?></td>
						<?
                    }
                    ?>
					<td width='50' align='center' style="font-size:18px;"><?  echo number_format($grand_total_fin_fab_qnty,2) ;?></td><td width='50' align='center' style="font-size:18px;" > <? echo number_format($grand_total_grey_fab_qnty,2);?></td>
                   
                </tr>
               
			</table>
			<?
		}
		//echo "kausar"; die;
		if($cbo_fabric_source==2)
		{
			$nameArray_fabric_description= sql_select("select min(a.id) as fabric_cost_dtls_id, a.lib_yarn_count_deter_id as determin_id, a.body_part_id, a.color_type_id, a.construction, a.composition, a.gsm_weight, min(a.width_dia_type) as width_dia_type, b.dia_width, avg(a.avg_finish_cons) as cons, avg(b.process_loss_percent) as process_loss_percent, avg(a.avg_cons) as requirment FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d WHERE a.job_id=b.job_id and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_id=a.job_id and c.id=b.color_size_table_id and b.po_break_down_id=d.po_break_down_id and b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and d.status_active=1 and d.is_deleted=0 group by a.body_part_id, a.lib_yarn_count_deter_id, a.color_type_id, a.construction, a.composition, a.gsm_weight, b.dia_width order by fabric_cost_dtls_id, a.body_part_id, b.dia_width");


			?>
			<table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" style="font-family:Arial Narrow;font-size:18px;" >
                <tr align="center">
                    <th colspan="2" align="left">Body Part</th>
                    <?
                    foreach($nameArray_fabric_description  as $result_fabric_description)
                    {
						if( $result_fabric_description[csf('body_part_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
						else echo "<td  colspan='3'>". $body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
                    }
                    ?>
                    <td rowspan="10" width="50"><p>Total Fabric (<? echo $unit_of_measurement[$booking_uom];?>)</p></td>
                    <td rowspan="10" width="50"><p>Avg Rate (<? echo $unit_of_measurement[$booking_uom];?>)</p></td>
                    <td rowspan="10" width="50"><p>Amount </p></td>
                </tr>
             
                <tr>
                	<th colspan="<? echo  count($nameArray_fabric_description)*3+3; ?>" align="left" style="height:30px">&nbsp;</th>
                </tr>
                <tr>
                    <th width="120" align="left">Fabric Color</th>
                    <th width="120" align="left">Body Color</th>
                   
                    <?
                    foreach($nameArray_fabric_description as $result_fabric_description)
                    {
                    	echo "<th width='50'>Fab. Qty</th><th width='50' >Rate</th><th width='50' >Amount</th>";
                    }
                    ?>
                </tr>
                <?
                $gmt_color_library=array();
                $gmt_color_data=sql_select("select a.id as fab_id,b.gmts_color_id, b.contrast_color_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b  WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.fabric_source =$cbo_fabric_source and a.job_no ='$job_no' and a.status_active=1 and b.status_active=1 order by a.id");
				
                foreach( $gmt_color_data as $gmt_color_row)
                {
                	$gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
                }
                
                $grand_total_fin_fab_qnty=0; $grand_total_amount=0;
                
                $color_wise_wo_sql=sql_select("select fabric_color_id FROM wo_booking_dtls WHERE booking_no =$txt_booking_no and status_active=1 and is_deleted=0 group by fabric_color_id");
				 "select fabric_color_id FROM wo_booking_dtls WHERE booking_no =$txt_booking_no and status_active=1 and is_deleted=0 group by fabric_color_id";
                foreach($color_wise_wo_sql as $color_wise_wo_result)
                {
                ?>
                <tr>
                
                <td  width="120" align="left">
                <?
                echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];
                
                
                ?>
                </td>
                <td>
                <?
				echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];
                // echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
                ?>
                </td>
               
                <?
                $total_fin_fab_qnty=0;
                $total_amount=0;
                
                foreach($nameArray_fabric_description as $result_fabric_description)
                {
                if($db_type==0)
                {
                $color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty, avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
                WHERE a.job_id=b.job_id and
                a.id=b.pre_cost_fabric_cost_dtls_id and
                c.job_id=a.job_id and
                c.id=b.color_size_table_id and
                b.po_break_down_id=d.po_break_down_id and
                b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
                d.booking_no =$txt_booking_no and
                a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
                a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
                a.construction='".$result_fabric_description[csf('construction')]."' and
                a.composition='".$result_fabric_description[csf('composition')]."' and
                a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
                a.lib_yarn_count_deter_id='".$result_fabric_description[csf('determin_id')]."' and
                b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
                d.fabric_color_id=".$color_wise_wo_result[csf('fabric_color_id')]." and
                d.status_active=1 and
                d.is_deleted=0
                ");
                }
                if($db_type==2)
                {
                
                $color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
                WHERE a.job_id=b.job_id and
                a.id=b.pre_cost_fabric_cost_dtls_id and
                c.job_id=a.job_id and
                c.id=b.color_size_table_id and
                b.po_break_down_id=d.po_break_down_id and
                b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
                d.booking_no =$txt_booking_no and
                a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
                a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
                a.construction='".$result_fabric_description[csf('construction')]."' and
                a.composition='".$result_fabric_description[csf('composition')]."' and
                a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
                a.lib_yarn_count_deter_id='".$result_fabric_description[csf('determin_id')]."' and
                b.dia_width='".$result_fabric_description[csf('dia_width')]."' and

                nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
                d.status_active=1 and
                d.is_deleted=0
                ");
                }
                list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
                ?>
                <td width='50' align='right'>
                <?
                if($color_wise_wo_result_qnty[csf('grey_fab_qnty')]!="")
                {
                echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2) ;
                $total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
                }
                ?>
                </td>
                <td width='50' align='right' >
                <?
                if($color_wise_wo_result_qnty[csf('rate')]!="")
                {
                echo number_format($color_wise_wo_result_qnty[csf('rate')],2);
                }
                ?>
                </td>
                <td width='50' align='right' >
                <?
                $amount=$color_wise_wo_result_qnty[csf('grey_fab_qnty')]*$color_wise_wo_result_qnty[csf('rate')];
                if($amount!="")
                {
                echo number_format($amount,2);
                $total_amount+=$amount;
                }
                ?>
                </td>
                <?
                }
                ?>
                <td align="right"><? echo number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
                <td align="right"><? echo number_format($total_amount/$total_fin_fab_qnty,2); $grand_total_amount+=$total_amount;?></td>
                <td align="right">
                <?
                echo number_format($total_amount,2);
                
                ?>
                </td>
                </tr>
                <?
                }
                ?>
                <tr style=" font-weight:bold">
                <!--<td  width="120" align="left">&nbsp;</td>-->
                <th  width="120" align="left">&nbsp;</th>
              
                <td  width="120" align="left"><strong>Total</strong></td>
                <?
                foreach($nameArray_fabric_description as $result_fabric_description)
                {
                $color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
                WHERE a.job_id=b.job_id and
                a.id=b.pre_cost_fabric_cost_dtls_id and
                c.job_id=a.job_id and
                c.id=b.color_size_table_id and
                b.po_break_down_id=d.po_break_down_id and
                b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
                d.booking_no =$txt_booking_no and
                a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
                a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
                a.construction='".$result_fabric_description[csf('construction')]."' and
                a.composition='".$result_fabric_description[csf('composition')]."' and
                a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
                a.lib_yarn_count_deter_id='".$result_fabric_description[csf('determin_id')]."' and
                b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
                d.status_active=1 and
                d.is_deleted=0
                ");
                list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
                ?>
                <td width='50' align='right'><?  echo number_format($color_wise_wo_result_qnty[csf('grey_fab_qnty')],2) ;?></td>
                <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
                <td width='50' align='right' > <? //echo number_format($color_wise_wo_result_qnty['grey_fab_qnty'],2);?></td>
                <?
                }
                ?>
                <td align="right"><? echo number_format($grand_total_fin_fab_qnty,2);?></td>
                <td align="right"><? echo number_format($grand_total_amount/$grand_total_fin_fab_qnty,2);?></td>
                <td align="right">
                <?
                echo number_format($grand_total_amount,2);
                ?>
                </td>
                </tr>
                <tr style="font-weight:bold">
                <!--<td  width="120" align="left">&nbsp;</td>-->
                <th  width="120" align="left">&nbsp;</th>
           
                <td  width="120" align="left"><strong>Consumption For <? echo $costing_per; ?></strong></td>
                <?
                foreach($nameArray_fabric_description as $result_fabric_description)
                {
                $color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
                WHERE a.job_id=b.job_id and
                a.id=b.pre_cost_fabric_cost_dtls_id and
                c.job_id=a.job_id and
                c.id=b.color_size_table_id and
                b.po_break_down_id=d.po_break_down_id and
                b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
                d.booking_no =$txt_booking_no and
                a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
                a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
                a.construction='".$result_fabric_description[csf('construction')]."' and
                a.composition='".$result_fabric_description[csf('composition')]."' and
                a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
                a.lib_yarn_count_deter_id='".$result_fabric_description[csf('determin_id')]."' and
                b.dia_width='".$result_fabric_description[csf('dia_width')]."' and
                d.status_active=1 and
                d.is_deleted=0
                ");
                list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
                
                ?>
                <td width='50' align='right'><?  //echo number_format(($color_wise_wo_result_qnty['fin_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4) ;?></td>
                <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
                <td width='50' align='right' > <? //echo number_format(($color_wise_wo_result_qnty['grey_fab_qnty']/$grand_total)*($total_set_qnty*$costing_per_qnty),4);?></td>
                <?
                }
                ?>
                <td align="right">
                <?
                $consumption_per_unit_fab=($grand_total_fin_fab_qnty/$po_qnty_tot)*($costing_per_qnty);
                echo number_format($consumption_per_unit_fab,4);
                ?>
                </td>
                <td align="right">
                <?
                $consumption_per_unit_amuont=($grand_total_amount/$po_qnty_tot)*($costing_per_qnty);
                echo number_format(($consumption_per_unit_amuont/$consumption_per_unit_fab),2);
                ?>
                </td>
                <td align="right">
                <?
                echo number_format($consumption_per_unit_amuont,2);
                ?>
                </td>
                </tr>
			</table>
			<?
		}
		?>
        <?
		if($cbo_fabric_source==1)
		{
			$lab_dip_color_arr=array();
			$lab_dip_color_sql=sql_select("select pre_cost_fabric_cost_dtls_id, gmts_color_id, contrast_color_id from wo_pre_cos_fab_co_color_dtls where job_no='$job_no'");
			foreach($lab_dip_color_sql as $row)
			{
				$lab_dip_color_arr[$row[csf('pre_cost_fabric_cost_dtls_id')]][$row[csf('gmts_color_id')]]=$row[csf('contrast_color_id')];
			}
			
			

			$collar_cuff_percent_arr=array(); $collar_cuff_body_arr=array(); $collar_cuff_color_arr=array(); $collar_cuff_size_arr=array(); $collar_cuff_item_size_arr=array(); $color_size_sensitive_arr=array();

			$collar_cuff_sql="select a.id, a.item_number_id, a.color_size_sensitive, a.color_break_down, b.color_number_id, b.gmts_sizes, b.item_size, c.size_number_id, d.colar_cuff_per, e.body_part_full_name, e.body_part_type
			FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c, wo_booking_dtls d, lib_body_part e

			WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no =$txt_booking_no and a.body_part_id=e.id and e.body_part_type in (40,50) and c.id=d.color_size_table_id and d.color_size_table_id=b.color_size_table_id  and d.po_break_down_id=c.po_break_down_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 order by  c.size_order";
			//echo $collar_cuff_sql;
			$collar_cuff_sql_res=sql_select($collar_cuff_sql);
			
			$itemIdArr=array();

			foreach($collar_cuff_sql_res as $collar_cuff_row)
			{
				$collar_cuff_percent_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('color_number_id')]][$collar_cuff_row[csf('gmts_sizes')]]=$collar_cuff_row[csf('colar_cuff_per')];
				$collar_cuff_body_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]]=$collar_cuff_row[csf('body_part_full_name')];
				$collar_cuff_size_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('size_number_id')]]=$collar_cuff_row[csf('size_number_id')];
				if(!empty($collar_cuff_row[csf('item_size')]))
				{
					$collar_cuff_item_size_arr[$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('size_number_id')]][$collar_cuff_row[csf('item_size')]]=$collar_cuff_row[csf('item_size')];
				}
				
				$color_size_sensitive_arr[$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('id')]][$collar_cuff_row[csf('color_number_id')]][$collar_cuff_row[csf('color_size_sensitive')]]=$collar_cuff_row[csf('color_break_down')];
				
				$itemIdArr[$collar_cuff_row[csf('body_part_type')]].=$collar_cuff_row[csf('item_number_id')].',';
			}
			//print_r($collar_cuff_percent_arr[40]) ;
			unset($collar_cuff_sql_res);
			//$count_collar_cuff=count($collar_cuff_size_arr);
			
			$order_plan_qty_arr=array();
			$color_wise_wo_sql_qnty=sql_select( "select item_number_id, color_number_id, size_number_id, sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in ($booking_po_id) and status_active=1 and is_deleted =0  group by item_number_id, color_number_id, size_number_id");//and item_number_id in (".implode(",",$itemIdArr).")
			foreach($color_wise_wo_sql_qnty as $row)
			{
				$order_plan_qty_arr[$row[csf('item_number_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]['plan']=$row[csf('plan_cut_qnty')];
				$order_plan_qty_arr[$row[csf('item_number_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]['order']=$row[csf('order_quantity')];
			}
			unset($color_wise_wo_sql_qnty);

			
			foreach($collar_cuff_body_arr as $body_type=>$body_name)
			{
				$gmtsItemId=array_filter(array_unique(explode(",",$itemIdArr[$body_type])));
				foreach($body_name as $body_val)
				{
					$count_collar_cuff=count($collar_cuff_size_arr[$body_type][$body_val]);
					$pre_grand_tot_collar=0; $pre_grand_tot_collar_order_qty=0;

					?>
                    <div style="max-height:1330px; overflow:auto; float:left; padding-top:5px; margin-left:5px; margin-bottom:5px; position:relative;font-size:18px;">
					<table width="625" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                        <tr>
                        	<td colspan="<? echo $count_collar_cuff+3; ?>" align="center"><b><? echo $body_val; ?> - Color Size Brakedown in Pcs.</b></td>
                        </tr>
                        <tr>
                            <td width="100">Size</td>
								<?
                                foreach($collar_cuff_size_arr[$body_type][$body_val]  as $size_number_id)
                                {
									?>
									<td align="center" style="border:1px solid black"><strong><? echo $size_library[$size_number_id];?></strong></td>
									<?
                                }
                                ?>
                            <td width="60" rowspan="2" align="center"><strong>Total</strong></td>
                            <td rowspan="2" align="center"><strong>Extra %</strong></td>
                        </tr>
                        <tr>
                            <td style="font-size:12px"><? echo $body_val; ?> Size</td>
                            <?
                            foreach($collar_cuff_item_size_arr[$body_val]  as $size_number_id=>$size_number)
                            {
								if(count($size_number)>0)
								{
									 foreach($size_number  as $item_size=>$val)
									 {
										?>
										<td align="center" style="border:1px solid black"><strong><? echo $item_size;?></strong></td>
										<?
									 }
								}
								else
								{
									?>
									<td align="center" style="border:1px solid black"><strong>&nbsp;</strong></td>
									<?
								}
                            }
                            ?>
                        </tr>
                            <?

                            $pre_size_total_arr=array();
                            foreach($color_size_sensitive_arr[$body_val] as $pre_cost_id=>$pre_cost_data)
                            {
								foreach($pre_cost_data as $color_number_id=>$color_number_data)
								{
									foreach($color_number_data as $color_size_sensitive=>$color_break_down)
									{
										$pre_color_total_collar=0;
										$pre_color_total_collar_order_qnty=0;
										$process_loss_method=$process_loss_method;
										$constrast_color_arr=array();
										if($color_size_sensitive==3)
										{
											$constrast_color=explode('__',$color_break_down);
											for($i=0;$i<count($constrast_color);$i++)
											{
												$constrast_color2=explode('_',$constrast_color[$i]);
												$constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
											}
										}
										?>
										<tr>
											<td>
												<?
                                                if( $color_size_sensitive==3)
                                                {
                                                    echo strtoupper ($constrast_color_arr[$color_number_id]) ;
                                                    $lab_dip_color_id=$lab_dip_color_arr[$pre_cost_id][$color_number_id];
                                                }
                                                else
                                                {
                                                    echo $color_library[$color_number_id];
                                                    $lab_dip_color_id=$color_number_id;
                                                }
                                                ?>
											</td>
											<?
											foreach($collar_cuff_size_arr[$body_type][$body_val] as $size_number_id)
											{
												?>
												<td align="center" style="border:1px solid black">
													<? $plan_cut=0; $collerqty=0; $collar_ex_per=0;
													$plan_cut=0;
													foreach($gmtsItemId as $giid)
													{
														// if($body_type==50) $plan_cut+=($order_plan_qty_arr[$giid][$color_number_id][$size_number_id]['plan'])*2;
														// else $plan_cut+=$order_plan_qty_arr[$giid][$color_number_id][$size_number_id]['plan'];

														$plan_cut+=$order_plan_qty_arr[$giid][$color_number_id][$size_number_id]['plan'];
													}
													
													
                                                    //$ord_qty=$order_plan_qty_arr[$color_number_id][$size_number_id]['order'];

                                                    $collar_ex_per=$collar_cuff_percent_arr[$body_type][$body_val][$color_number_id][$size_number_id];
                                                    // echo $collar_ex_per.'=';

												    if($body_type==50) { if($collar_ex_per==0 || $collar_ex_per=="") $collar_ex_per=$cuff_excess_percent; else $collar_ex_per=$collar_ex_per; }
                                                    else if($body_type==40) { if($collar_ex_per==0 || $collar_ex_per=="") $collar_ex_per=$colar_excess_percent; else $collar_ex_per=$collar_ex_per; }
                                                    $colar_excess_per=($plan_cut*$collar_ex_per)/100;

                                                	if($body_type==50){
														$collerqty=($plan_cut+$colar_excess_per)*2;
													}else{
														$collerqty=($plan_cut+$colar_excess_per);
													}

                                                    //$collerqty=number_format(($requirment/$costing_per_qnty)*$plan_cut,2,'.','');

                                                    echo number_format($collerqty);
                                                    $pre_size_total_arr[$size_number_id]+=$collerqty;
                                                    $pre_color_total_collar+=$collerqty;
                                                    $pre_color_total_collar_order_qnty+=$plan_cut;

                                                    //$pre_grand_tot_collar_order_qty+=$plan_cut;
                                                    ?>
												</td>
												<?
											}
											?>

											<td align="center"><? echo number_format($pre_color_total_collar); ?></td>
											<!-- <td align="center"><? echo number_format((($pre_color_total_collar-$pre_color_total_collar_order_qnty)/$pre_color_total_collar_order_qnty)*100,2); ?></td> -->
												<td align="center"><? echo $collar_ex_per; ?></td>
										</tr>
										<?
										$pre_grand_collar_ex_per+=$collar_ex_per;
										$pre_grand_tot_collar+=$pre_color_total_collar;
										$pre_grand_tot_collar_order_qty+=$pre_color_total_collar_order_qnty;
									}
								}
							}
							?>
                        
                        <tr>
                            <td>Size Total</td>
								<?
                               // foreach($pre_size_total_arr  as $size_qty)
                               // {
                                	foreach($collar_cuff_size_arr[$body_type][$body_val] as $size_number_id)
									{
										$size_qty=$pre_size_total_arr[$size_number_id];
										?>
										<td style="border:1px solid black;  text-align:center"><? echo number_format($size_qty); ?></td>
										<?
									}

                               // }
                                ?>
                            <td style="border:1px solid black; text-align:center"><? echo number_format($pre_grand_tot_collar); ?></td>
                            <!-- <td align="center" style="border:1px solid black"><? echo number_format((($pre_grand_tot_collar-$pre_grand_tot_collar_order_qty)/$pre_grand_tot_collar_order_qty)*100,2); ?></td> -->
							<td align="center" style="border:1px solid black"></td>
                        </tr>
					</table>
                </div>
                <?
            }
        }

        ?>

       		

        <?

	// if($show_yarn_rate==1)
	// {
		 $condition= new condition();
		if(str_replace("'","",$txt_order_no_id) !=''){
			$condition->po_id("in(".str_replace("'","",$txt_order_no_id).")");
		}

		$condition->init();
		$cos_per_arr=$condition->getCostingPerArr();
		$yarn= new yarn($condition);
		$yarn_data_array=$yarn->getCountCompositionPercentTypeColorAndRateWiseYarnQtyAndAmountArray();
		$yarn_count_arr=return_library_array( "select id,yarn_count from lib_yarn_count",'id','yarn_count');

		$yarn_sql_array=sql_select("SELECT min(a.id) as id ,a.count_id, a.copm_one_id, a.percent_one, a.color, a.type_id, sum(a.cons_qnty) as yarn_required, a.rate  from wo_pre_cost_fab_yarn_cost_dtls a, wo_booking_dtls b where a.job_no=b.job_no and a.fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.job_no='$job_no' and b.booking_no=$txt_booking_no  and  a.status_active=1 and a.is_deleted=0 group by a.count_id,a.copm_one_id,a.percent_one,a.color,a.type_id,a.rate order by id");
	
		?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" style="font-family:Arial Narrow;font-size:18px;" >
            <tr>
                <td width="100%" valign="top">
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td colspan="7"><b>Yarn Required Summary (Pre Cost)</b></td>

                    </tr>
                    <tr align="center">
                    <td width="40">Sl</td>
                    <td width="40">Yarn Count</td>
                    <td width="40">Yarn Type</td>
                    <td width="120">Yarn Description</td>
                    <td width="40">Brand</td>
                    <td width="40">Lot</td>                   
                    <td width="40">Rate</td>                  
                    <td width="40">Cons for <? echo $costing_per; ?> Gmts</td>
                    <td width="40">Total (KG)</td>
                    </tr>
                    <?
					$i=0;
					$total_yarn=0;
					foreach($yarn_sql_array  as $row)
                    {

						$i++;
						$rowcons_qnty = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['qty'];
						$rowcons_Amt = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['amount'];


						$rate=$rowcons_Amt/$rowcons_qnty;
						$rowcons_qnty =($rowcons_qnty/100)*$booking_percent;
					?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td><?	echo $yarn_count_arr[$row[csf('count_id')]];?>
                    </td>
					<td><? echo $yarn_type[$row[csf('type_id')]] ?></td>
                    <td>
						<? 
							$yarn_des=$composition[$row[csf('copm_one_id')]]." ".$row[csf('percent_one')]."%  ";
					$yarn_des.=$color_library[$row[csf('color')]]." ";
					echo $yarn_des;
						?>
					</td>
                    <td></td>                   
                    <td></td>                   
                    <td><? echo number_format($row[csf('rate')],4); ?></td>
                     
                    <td title="<?="(".$rowcons_qnty."/".$po_qnty_tot.")*".$cos_per_arr[$job_no];?>"><?  echo number_format(($rowcons_qnty/$po_qnty_tot)*$cos_per_arr[$job_no],4);//echo number_format($row[csf('yarn_required')],4); ?></td>

                    <td align="right">
					<? echo number_format($rowcons_qnty,2); $total_yarn+=$rowcons_qnty; ?></td>
                    </tr>
                    <?
					}
					?>
                    <tr align="center">
                    <td>Total</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>                  
                    <td></td>                   
                    <td></td>
                    <td align="right"><? echo number_format($total_yarn,2); ?></td>
                    </tr>
                    </table>
                </td>
               
                </td>
            </tr>
        </table>
        <?
	//}
		$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
		?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" style="font-family:Arial Narrow;font-size:18px;">
            <tr>
                <td width="49%" valign="top">
                <?
				/* if(count($sql_embelishment)>0)
				{ */
				?>
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" style="font-family:Arial Narrow;font-size:18px;">
                    <tr align="center">
                    <td colspan="7"><b>Embelishment (Pre Cost)</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Embelishment Name</td>
                    <td>Embelishment Type</td>
                    <td>Cons <? echo $costing_per; ?> Gmts</td>
                    <td>Rate</td>
                    <td>Amount</td>

                    </tr>
                    <?
					$sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and 	is_deleted=0");
					$i=0;
					//$total_yarn=0;
					foreach($sql_embelishment  as $row_embelishment)
                    {

						$i++;
					?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
					<?
					echo $emblishment_name_array[$row_embelishment[csf('emb_name')]];
					?>
                    </td>
                    <td>
                    <?
					if($row_embelishment[csf('emb_name')]==1)
					{
					echo $emblishment_print_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==2)
					{
					echo $emblishment_embroy_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==3)
					{
					echo $emblishment_wash_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==4)
					{
					echo $emblishment_spwork_type[$row_embelishment[csf('emb_type')]];
					}
					if($row_embelishment[csf('emb_name')]==5)
					{
					echo $emblishment_gmts_type[$row_embelishment[csf('emb_type')]];
					}
					?>

                    </td>
                    <td>
                    <?
					echo $row_embelishment[csf('cons_dzn_gmts')];
					?>
                    </td>
                    <td>
					<?
					echo $row_embelishment[csf('rate')];
					?>
                    </td>

                    <td>
					<?
					echo $row_embelishment[csf('amount')];
					?>
                    </td>


                    </tr>
                    <?
					}
					?>

                    </table>
                    <?
				//}
					?>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top" align="center">
                				<?
                				$lib_designation_arr=return_library_array(" select id,custom_designation from lib_designation","id","custom_designation");
									 $user_lib_designation_arr=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
									 $user_lib_name_arr=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");

								$mst_id=return_field_value("id as mst_id","wo_booking_mst","booking_no=$txt_booking_no","mst_id");
                				 $unapprove_data_array=sql_select("select b.approved_by,b.approved_date,b.un_approved_reason,b.un_approved_date,b.approved_no from   approval_history b where b.mst_id=$mst_id and b.entry_form=7  order by b.approved_date,b.approved_by");


                				/* if(count($unapprove_data_array)>0)
                				{ */
                				$sql_unapproved=sql_select("select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=7 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id=$mst_id");
                					$unapproved_request_arr=array();
                					foreach($sql_unapproved as $rowu)
                					{
                						$unapproved_request_arr[$rowu[csf('booking_id')]]=$rowu[csf('approval_cause')];
                					}
                		 		?>
                		       <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
                		            <thead>
                		            <tr style="border:1px solid black;">
                		                <th colspan="6" style="border:1px solid black;">Approval/Un Approval History</th>
                		                </tr>
                		                <tr style="border:1px solid black;">
                		                <th width="3%" style="border:1px solid black;">Sl</th>
                						<th width="30%" style="border:1px solid black;">Name</th>
                						<th width="20%" style="border:1px solid black;">Designation</th>
                						<th width="5%" style="border:1px solid black;">Approval Status</th>
                						<th width="20%" style="border:1px solid black;">Reason For Un Approval</th>
                						<th width="22%" style="border:1px solid black;"> Date</th>

                		                </tr>
                		            </thead>
                		            <tbody>
                		            <?
                					$i=1;
                					foreach($unapprove_data_array as $row){

                					?>
                		            <tr style="border:1px solid black;">
                		                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
                						<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
                						<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
                						<td width="5%" style="border:1px solid black; text-align:center"><? echo 'Yes';?></td>
                						<td width="20%" style="border:1px solid black;"><? echo '';?></td>
                						<td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); else echo "";?></td>
                		            </tr>
                		                <?
                						$i++;
                						$un_approved_date= explode(" ",$row[csf('un_approved_date')]);
                						$un_approved_date=$un_approved_date[0];
                						if($db_type==0) //Mysql
                						{
                							if($un_approved_date=="" || $un_approved_date=="0000-00-00") $un_approved_date="";else $un_approved_date=$un_approved_date;
                						}
                						else
                						{
                							if($un_approved_date=="") $un_approved_date="";else $un_approved_date=$un_approved_date;
                						}

                						if($un_approved_date!="")
                						{
                						?>
                					<tr style="border:1px solid black;">
                		                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
                						<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
                						<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
                						<td width="5%" style="border:1px solid black;text-align:center;"><? echo 'No';?></td>
                						<td width="20%" style="border:1px solid black;text-align:center"><? echo $unapproved_request_arr[$mst_id];?></td>
                						<td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('un_approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('un_approved_date')])); else echo "";?></td>
                		              </tr>

                		                <?
                						$i++;
                						}

                					}
                						?>
                		            </tbody>
                		        </table>
                				<?
                				//}
                				?>

                </td>
            </tr>
        </table>
        <table  width="100%" style="margin: 0px;padding: 0px;">
        <?php $stripe_color_wise=array(); ?>
       
        <tr>
        	<td width="70%">
        		<table  class="rpt_table" border="1" cellpadding="1" cellspacing="1" rules="all" width="100%"   style="font-family:Arial Narrow;font-size:18px;margin: 0px;padding: 0px;" >
        		       
        		        <tr>
        		            <td align="center" colspan="10">  Stripe Details</td>
        		            
    		            </tr>
        		        <?
        				$color_name_arr=return_library_array( "select id,color_name from lib_color",'id','color_name');
        				$sql_stripe=("select c.id,c.composition,c.construction,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,sum(b.grey_fab_qnty) as fab_qty,b.dia_width,d.color_number_id as color_number_id,d.totfidder,d.id as did,d.stripe_color,d.fabreqtotkg as fabreqtotkg ,d.measurement as measurement ,d.yarn_dyed,d.uom  from wo_booking_dtls b, wo_pre_cost_fabric_cost_dtls c,wo_pre_stripe_color d, wo_po_color_size_breakdown e where c.id=b.pre_cost_fabric_cost_dtls_id and c.job_no=b.job_no and d.pre_cost_fabric_cost_dtls_id=c.id and d.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and b.job_no=d.job_no and b.job_no='$job_no'  and d.job_no='$job_no' and b.booking_no=$txt_booking_no  and c.color_type_id in (2,6,33,34) and b.status_active=1  and c.is_deleted=0 and c.status_active=1  and d.is_deleted=0 and d.status_active=1 and b.is_deleted=0 and e.id=b.color_size_table_id and e.is_deleted=0 and e.status_active=1 and e.color_number_id=d.color_number_id  group by c.id,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,d.color_number_id,d.id,d.stripe_color,d.yarn_dyed,d.fabreqtotkg ,d.measurement,d.uom,c.composition,c.construction,b.dia_width,d.totfidder order by d.id ");        				
        				$result_data=sql_select($sql_stripe);
        				foreach($result_data as $row)
        				{
        					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['stripe_color'][$row[csf('did')]]=$row[csf('stripe_color')];
        					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['measurement'][$row[csf('did')]]=$row[csf('measurement')];
        					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['uom'][$row[csf('did')]]=$row[csf('uom')];
        					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['fabreqtotkg'][$row[csf('did')]]=$row[csf('fabreqtotkg')];
        					$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['yarn_dyed'][$row[csf('did')]]=$row[csf('yarn_dyed')];	
							$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['totfidder'][$row[csf('did')]]=$row[csf('totfidder')];
							$stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['subtotal_measurement'][$row[csf('did')]]=$row[csf('measurement')];;

        					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['composition']=$row[csf('composition')];
        					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['construction']=$row[csf('construction')];
        					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['gsm_weight']=$row[csf('gsm_weight')];
        					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['color_type_id']=$row[csf('color_type_id')];
        					$stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['dia_width']=$row[csf('dia_width')];
					

        				}
						// echo "<pre>";
						// print_r($stripe_arr2);
        				?>
        		            <tr>
	        		            <td align="center" width="30"> SL</td>
	        		            <td align="center" width="100"> Body Part</td>
	        		            <td align="center" width="80"> Fabric Color</td>
	        		            <td align="center" width="70"> Fabric Qty(KG)</td>
	        		            <td align="center" width="70"> Stripe Color</td>
	        		            <td align="center" width="70"> Stripe Measurement</td>
	        		            <td align="center" width="70"> Stripe Uom</td>
                                  <td  align="center" width="70"> Total Feeder</td>
	        		            <td  align="center" width="70"> Qty.(KG)</td>
                               
	        		            <td  align="center" width="70"> Y/D Req.</td>
        		            </tr>
        		            <?
							$color_wise_qty=sql_select("select  a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,d.gmts_color_id,(d.fin_fab_qnty) as fin_fab_qnty,(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
        								WHERE a.job_id=b.job_id and
        								a.id=b.pre_cost_fabric_cost_dtls_id and
        								c.job_no_mst=a.job_no and
        								c.id=b.color_size_table_id and
        								b.po_break_down_id=d.po_break_down_id and
        								b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
        								d.booking_no =$txt_booking_no and
        								d.status_active=1 and
        								d.is_deleted=0
        								");
										$tot_color_qty=0;
										foreach($color_wise_qty as $row)
										{
											$data_str=$row[csf('body_part_id')].$row[csf('color_type_id')].$row[csf('gmts_color_id')];
											$tot_color_qtyArr[$data_str]+=$row[csf('fin_fab_qnty')];
										}
										//echo $tot_color_qty.'=A';
										unset($color_wise_qty);
										
        					$i=1;$total_fab_qty=0;$total_fabreqtotkg=$total_totfidder=0;$fab_data_array=array();$qnty=0;
        		            foreach($stripe_arr as $body_id=>$body_data)
        		            {
        						foreach($body_data as $color_id=>$color_val)
        						{
        							$rowspan=count($color_val['stripe_color']);
        							$composition=$stripe_arr2[$body_id][$color_id]['composition'];
        							$construction=$stripe_arr2[$body_id][$color_id]['construction'];
        							$gsm_weight=$stripe_arr2[$body_id][$color_id]['gsm_weight'];
        							$color_type_id=$stripe_arr2[$body_id][$color_id]['color_type_id'];
        							$dia_width=$stripe_arr2[$body_id][$color_id]['dia_width'];
									$subtotal_measurement=array_sum($color_val['subtotal_measurement']);
									

        							/*if($db_type==0) $color_cond="d.gmts_color_id='".$color_id."'";
        							else if($db_type==2) $color_cond="nvl(d.gmts_color_id,0)=nvl('".$color_id."',0)";

        							$color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
        								WHERE a.job_id=b.job_id and
        								a.id=b.pre_cost_fabric_cost_dtls_id and
        								c.job_no_mst=a.job_no and
        								c.id=b.color_size_table_id and
        								b.po_break_down_id=d.po_break_down_id and
        								b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
        								d.booking_no =$txt_booking_no and
        								a.body_part_id='".$body_id."' and
        								a.color_type_id='".$color_type_id."' and
        								a.construction='".$construction."' and
        								a.composition='".$composition."' and
        								a.gsm_weight='".$gsm_weight."' and
        								$color_cond and
        								d.status_active=1 and
        								d.is_deleted=0
        								");
        						
        								list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty;*/
        							$sk=0;
    								foreach($color_val['stripe_color'] as $strip_color_id=>$s_color_val)
        							{
        								
        								?>
	        							<tr>
		        							<?
		        							if($sk==0)
		        							{

												$data_str=$body_id.$color_type_id.$color_id;
			        							$color_qty=$tot_color_qtyArr[$data_str];
			        							//$color_qty=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
												$qnty=$color_qty/$subtotal_measurement;
			        							?>
			        							<td rowspan="<? echo $rowspan;?>"> <? echo $i; ?></td>
			        							<td rowspan="<? echo $rowspan;?>"> <? echo $body_part[$body_id]; ?></td>
			        							<td rowspan="<? echo $rowspan;?>"> <? echo $color_name_arr[$color_id]; ?></td>
			        							<td rowspan="<? echo $rowspan;?>" align="right"> <? echo number_format($color_qty,2); ?>&nbsp; </td>
			        							<?
			        							$total_fab_qty+=$color_qty;
											
			        							$i++;
			        						}
		        							$sk=0;
		        							

		        								$measurement=$color_val['measurement'][$strip_color_id];
												$totfidder=$color_val['totfidder'][$strip_color_id];
		        								$uom=$color_val['uom'][$strip_color_id];
		        								$fabreqtotkg=$color_val['fabreqtotkg'][$strip_color_id];
		        								$yarn_dyed=$color_val['yarn_dyed'][$strip_color_id];
												$qnty_kg=$qnty*$measurement;
		        								
		        								?>
		        							
			        								<td><?  echo  $color_name_arr[$s_color_val]; ?></td>
			        								<td align="right"> <? echo  number_format($measurement,2); ?> &nbsp; </td>
			        		                        <td> <? echo  $unit_of_measurement[$uom]; ?></td>
                                                      <td align="right"> <? echo  number_format($totfidder,2); ?> &nbsp;</td>
			        								<td align="right"> <? echo  number_format($qnty_kg,2); ?> &nbsp;</td>
                                                  
			        								<td> <? echo  $yes_no[$yarn_dyed]; ?></td>
		        								
		        								<?
		        								
		        								$sk++;
		        								$total_fabreqtotkg+=$qnty_kg;
												$total_totfidder+=$totfidder;
		        								$stripe_color_wise[$color_name_arr[$s_color_val]]+=$qnty_kg;
		        								$color_sub_tot[$body_id][$color_id]['fab_qnty']+=$qnty_kg;
		        							
											
		        							?>
	        							</tr>
	        							<?
	        						}
									?>
								  <tr>
			        		            <td colspan="4">&nbsp; </td>
			        		            <td align="center" colspan="4"><b> Sub Total </b></td>
			        		            <td align="right"><b><? echo  number_format($color_sub_tot[$body_id][$color_id]['fab_qnty'],2); ?></b> &nbsp;</td>
			        		        </tr>

							<? }  
        						}?>
	        		            <tfoot>
		        		            <tr>
			        		            <td colspan="3">Total </td>
			        		            <td align="right">  <? echo  number_format($total_fab_qty,2); ?> &nbsp;</td>
			        		            <td></td>
			        		            <td></td>
                                       
			        		            <td>   </td>
                                          <td  align="right"><? echo  number_format($total_totfidder,2); ?></td>
			        		            <td align="right"><? echo  number_format($total_fabreqtotkg,2); ?> &nbsp;</td>
			        		        </tr>
	        		            </tfoot>
        		            </table>
        	</td>
        	
        	<td width="20%" >
        		        <table  class="rpt_table" border="1" cellpadding="1" cellspacing="1" rules="all" width="100%"   style="font-family:Arial Narrow;font-size:18px;margin: 0px;padding: 0px;"  >
        		       

        		        <tr>
        		            <td align="left" colspan="3"> Stripe  Color wise Summary</td>
        		            
        		           
        		           
    		            </tr>
        		        <?
        				
        				?>
        		            <tr>
	        		            <td width="30"> SL</td>
	        		            
	        		            <td width="70"> Stripe Color</td>
	        		           
	        		            <td  width="70"> Qty.(KG)</td>
	        		           
        		            </tr>
        		            <?

        					$i=1;$total_stripe_qnt=0;        		            
        						foreach($stripe_color_wise as $color=>$val)
        						{
        							
        							
        							?>
        							<tr>
	        							<td> <? echo $i; ?></td>
	        							
	        							<td > <? echo $color; ?></td>
	        							<td align="right"> <?php echo number_format($val,2); ?></td>
	        						</tr>
        							
        							<?
        							$total_stripe_qnt+=$val;
        							
        							$i++;
        						}
        					
        					?>
        		            <tfoot>
        		            <tr>
        		            
        		            <td></td>
        		            <td></td>
        		            
        		            <td align="right"><? echo  number_format($total_stripe_qnt,2); ?> </td>
        		            </tr>
        		            </tfoot>
        		            </table>
        	</td>
        </tr>
         </table >
			<table width="98%">
       		 	<tr>
       		 		<td width="45%" style="float: left;">
       		 			<?php 

       		 				$sql_purchase="SELECT a.booking_no, a.uom, sum(b.fin_fab_qnty) as qnty , b.construction, b.copmposition, b.gsm_weight as dia, b.dia_width as gsm from wo_booking_mst a, wo_booking_dtls b where     a.booking_no = b.booking_no and a.fabric_source = 2 and b.job_no = '$txt_job_no'and b.status_active = 1 and b.is_deleted = 0 and a.status_active = 1 and a.is_deleted = 0 and  a.booking_type=1 group by a.booking_no, a.uom, b.construction, b.copmposition, b.dia, b.gsm_weight, b.dia_width"; 
       		 				//echo $sql_purchase;
							$purchase_res=sql_select($sql_purchase);
							?>
							<table  width="98%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">

 			                   <thead>
				                   <tr align="center">
				                    	<th colspan="5"><b>Purchased Booking Info</b></th>
				                    </tr>
				                    <tr align="center">
					                    <th>Sl</th>
					                    <th>Booking No</th>
					                    <th>Fabric Data</th>
					                    <th>UOM</th>
					                    <th>Qnty</th>
					                   
				                    </tr>
 			                   </thead>
 			                   <tbody>
 			                   		<?

 			                   			foreach ($purchase_res as  $row) 
 			                   			{
 			                   				?>
 			                   				<tr>
 			                   					<td><?=$p++;?></td>
 			                   					<td><p><?=$row[csf('booking_no')];?></p></td>
 			                   					<td><p><?=$row[csf('construction')] .", ".$row[csf('copmposition')].", ".$row[csf('gsm')].", ".$row[csf('dia')];?></p></td>
 			                   					<td><p><?=$unit_of_measurement[$row[csf('uom')]];?></p></td>
 			                   					<td><p><?=number_format($row[csf('qnty')],2);?></p></td>
 			                   				</tr>
 			                   				<?
 			                   			}


 			                   		?>
 			                   </tbody>
 			                   
 			            </table>

       		 			 
       		 		</td>
       		 		<td width="45%" style="float: right;">
 			       		 <table  width="98%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">

 			                   <tr align="center">
 			                    	<td colspan="10"><b>Dyes To Match</b></td>
 			                    </tr>
 			                    <tr align="center">
 				                    <td>Sl</td>
 				                    <td>Item</td>
 				                    <td>Item Description</td>
 				                    <td>Body Color</td>
 				                    <td>Item Color</td>
 				                    <td>Finish Qty.</td>
 				                    <td>UOM</td>
 			                    </tr>
 			                    <?
 								$lib_item_group_arr=return_library_array( "select item_name, id from lib_item_group where item_category=4 and is_deleted=0  and  status_active=1 order by item_name", "id", "item_name");
 								$sql=sql_select("select id from wo_booking_mst where booking_no=$txt_booking_no");
 								$bookingId=0;
 								foreach($sql as $row){
 									$bookingId= $row[csf('id')];
 								}
 								$co=0;
 								$sql_data=sql_select("select a.fabric_color,a.item_color,a.precost_trim_cost_id,b.trim_group,b.cons_uom,sum(qty) as qty, b.description   from wo_dye_to_match a, wo_pre_cost_trim_cost_dtls b where a.precost_trim_cost_id=b.id and a.booking_id=$bookingId and a.qty>0 and a.status_active=1 and b.status_active=1  group by a.fabric_color,a.item_color,a.precost_trim_cost_id,b.trim_group,b.cons_uom, b.description order by a.fabric_color");

 								foreach($sql_data  as $row)
 			                    {
 									$co++;
 									?>
 				                    <tr>
 				                    <td><? echo $co; ?></td>
 				                    <td> <? echo $lib_item_group_arr[$row[csf('trim_group')]];?></td>
 				                    <td><p> <? echo $row[csf('description')];?></p></td>
 				                    <td><? echo $color_library[$row[csf('fabric_color')]];?></td>
 				                    <td><? echo $color_library[$row[csf('item_color')]];?></td>
 				                    <td align="right"><? echo $row[csf('qty')];?></td>
 				                    <td><? echo $unit_of_measurement[$row[csf('cons_uom')]];?></td>
 				                    </tr>
 				                    <?
 								}
 								?>
 			            </table>
       		 		</td>
       		 	</tr>
       		 </table>

			<table width="98%">
       		 	<tr>
       		 		<td width="45%" style="float: left;">
       		 			<?php 
							$rmg_process_breakdown_arr=array();
							$rmg_process_breakdown_arr=explode('_',$rmg_process_breakdown);
							?>
							<table  width="98%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">

 			                   <thead>
				                   <tr align="center">
				                    	<th colspan="9"><b>Fabrics Process Loss %</b></th>
				                    </tr>
				                    <tr align="center">
					                    <th>Yarn Dyeing</th>
					                    <th>Knitting </th>
					                    <th>Fabric Dyeing </th>
					                    <th>AOP</th>									
					                    <th>Dyeing & Finishing  </th>					                    
					                    <th>Others</th>
					                    <th>Total</th>
					                   
				                    </tr>
 			                   </thead>
 			                   <tbody>
									<tr>
										<td><? echo number_format($rmg_process_breakdown_arr[12],2); ?></td>
										<td><? echo number_format($rmg_process_breakdown_arr[6],2); ?></td>
										<td><? echo number_format($rmg_process_breakdown_arr[7],2); ?></td>
										<td><? echo number_format($rmg_process_breakdown_arr[13],2); ?></td>									
										<td><? echo number_format($rmg_process_breakdown_arr[5],2); ?></td>										
										<td><? echo number_format($rmg_process_breakdown_arr[9],2); ?></td>
										<? $total_fab=$rmg_process_breakdown_arr[12]+$rmg_process_breakdown_arr[6]+$rmg_process_breakdown_arr[7]+$rmg_process_breakdown_arr[13]+$rmg_process_breakdown_arr[5]+$rmg_process_breakdown_arr[9];?>
										<td><p><?=number_format($total_fab,2);?></p></td>
									</tr>
 			                   		
 			                   </tbody>
 			                   
 			            </table>

       		 			 
       		 		</td>
       		 		<td width="45%" style="float: right;">
 			       		 <table  width="98%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">

 			                   <tr align="center">
 			                    	<td colspan="8"><b>RMG Process Loss %</b></td>
 			                    </tr>
 			                    <tr align="center">
 				                    <td>Cutting</td>
 				                    <td>Sewing</td>
 				                    <td>Chest Printing</td>
 				                    <td>Embroidery</td>
 				                    <td>Finishing</td>
									<td>Cut Panel rejection</td>
 				                    <td>Neck/Sleeve Printing</td>
									<td> Garments Wash</td>
									<td> Lay Wash (Fabric) </td>
 				                    <td>Total</td>
 				                   
 			                    </tr>
									<? if($rmg_process_breakdown_arr[0]==''){
										$rmg_process_breakdown_arr[0]=0;
									} ?>
 				                    <tr>
 				                    <td><? echo fn_number_format($rmg_process_breakdown_arr[0],2); ?></td>
 				                    <td><? echo number_format($rmg_process_breakdown_arr[4],2); ?></td>
 				                    <td><? echo number_format($rmg_process_breakdown_arr[2],2); ?></td>
 				                    <td><? echo number_format($rmg_process_breakdown_arr[1],2); ?></td>
 				                    <td><? echo number_format($rmg_process_breakdown_arr[15],2); ?></td>
									<td><? echo number_format($rmg_process_breakdown_arr[8],2); ?></td>
 				                    <td><? echo number_format($rmg_process_breakdown_arr[10],2); ?></td>
									 <td><? echo number_format($rmg_process_breakdown_arr[3],2); ?></td>
									 <td><? echo number_format($rmg_process_breakdown_arr[14],2); ?></td>
									 <?php
										$total_rmg+=$rmg_process_breakdown_arr[0]+$rmg_process_breakdown_arr[2]+$rmg_process_breakdown_arr[8]+$rmg_process_breakdown_arr[4]+$rmg_process_breakdown_arr[10]+$rmg_process_breakdown_arr[1]+$rmg_process_breakdown_arr[15]+$rmg_process_breakdown_arr[3]+$rmg_process_breakdown_arr[14];
									 ?>
 				                    <td align="right"><? echo number_format($total_rmg,2);?></td>
 				                    
 				                    </tr>
 				                    <?
 								
 								?>
 			            </table>
       		 		</td>
       		 	</tr>
       		 </table>
        <?
			if($cbo_fabric_source==1)
			{
				$po_data=sql_select("select a.po_break_down_id	from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and  a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") 
				and a.booking_no=$txt_booking_no and a.booking_type=1 and a.status_active=1 and a.is_deleted=0 group by a.po_break_down_id");

			
				foreach($po_data as $val){

					$po_ids[$val[csf('po_break_down_id')]]=$val[csf('po_break_down_id')];
				}



        	$grand_order_total=0; $grand_plan_total=0; $size_wise_total=array();
			$nameArray_size=sql_select( "select size_number_id,size_order from wo_po_color_size_breakdown where  is_deleted=0 ".where_con_using_array($po_ids,1,'po_break_down_id')." and status_active=1 group by size_number_id,size_order  order by size_order");
			
			?>
                <div id="div_size_color_matrix" class="pagebreak">
                    <fieldset id="div_size_color_matrix" >
                        <legend>Size and Color Breakdown</legend>
                        <table  class="rpt_table"  border="1" align="left" cellpadding="0"  cellspacing="0" rules="all" >
                            <tr>
                            	<td>PO Number</td>
                            	<td>PO Received Date </td>
                                <td>Lab Dip No </td>
                            	<td>Ship Date</td>
                            	
                            	<td>Gmts Item</td>
                                <td style="border:1px solid black"><strong>Color/Size</strong></td>
                                <?
                                foreach($nameArray_size  as $result_size)
                                {
									?>
                                	<td align="center" style="border:1px solid black"><?=$size_library[$result_size[csf('size_number_id')]];?></td>
                                <? } ?>
                                <td  align="center"> Total Order Qty(Pcs)</td>
                                <td  align="center"> Excess %</td>
                                <td  align="center"> Total Plan Cut Qty(Pcs)</td>
                            </tr>
                            <?
                            $color_size_order_qnty_array=array(); $color_size_qnty_array=array(); $size_tatal=array(); $size_tatal_order=array();
                           	$item_size_tatal=array(); $item_size_tatal_order=array(); $item_grand_total=0; $item_grand_total_order=0;
                           	$result_cs=sql_select( "select b.item_number_id,b.color_number_id,sum(b.order_quantity) as order_quantity,b.size_number_id,b.po_break_down_id,b.size_order from wo_po_break_down a, wo_po_color_size_breakdown b where a.id=b.po_break_down_id and a.job_no_mst ='$job_no' ".where_con_using_array($po_ids,1,'b.po_break_down_id')." and b.status_active=1 and a.is_deleted=0 and b.is_deleted=0 group by b.item_number_id,b.color_number_id,b.size_number_id,b.po_break_down_id,b.size_order order by b.size_order ");
                           	$color_size_data=array();
                           	foreach ($result_cs as $row) {
                           		$color_size_data[$row[csf('po_break_down_id')]][$row[csf('item_number_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]+=$row[csf('order_quantity')];
                           	}

                           	$sql_color="select a.po_number,a.id,a.po_received_date,a.shipment_date,b.item_number_id,b.color_number_id,sum(b.plan_cut_qnty) as plan_cut_qnty,a.shiping_status from wo_po_break_down a, wo_po_color_size_breakdown b where a.id=b.po_break_down_id and a.job_no_mst ='$job_no' ".where_con_using_array($po_ids,1,'b.po_break_down_id')." and b.status_active=1 and a.is_deleted=0 and b.is_deleted=0 group by a.po_number,a.id,a.po_received_date,a.shipment_date,b.item_number_id,b.color_number_id,a.shiping_status order by a.po_number,a.shipment_date asc ";
                           	//echo $sql_color;
							$result_color_size=sql_select( $sql_color);

							foreach ($result_color_size as $row) 
							{
								$lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."'  and approval_status=3   and color_name_id=".$row[csf('color_number_id')]."  and po_break_down_id=".$row[csf('id')]."  and status_active=1 and is_deleted=0");
								?>
								<tr>
									<td><?php echo $row[csf('po_number')] ?></td>
									<td><?php echo change_date_format($row[csf('po_received_date')]); ?></td>
                                     <td><?php  echo $lapdip_no; ?></td>
									<td><?php echo change_date_format($row[csf('shipment_date')]); ?></td>	
                                   								
									<td><?php echo $garments_item[$row[csf('item_number_id')]]; ?></td>
									<td><?php echo $color_library[$row[csf('color_number_id')]]; ?></td>
									<?
									$total=0;

                                    foreach($nameArray_size  as $key)
                                    {
										?>
                                    	<td align="center" style="border:1px solid black">
                                    		<?
                                    				$qnty=0;
                                    				$qnty=$color_size_data[$row[csf('id')]][$row[csf('item_number_id')]][$row[csf('color_number_id')]][$key[csf('size_number_id')]];

                                    				echo number_format($qnty);
                                    				$size_wise_total[$key[csf('size_number_id')]]+=$qnty;
                                    				$total+=$qnty;
                                    			?>
                                    	</td>
                                   	 	<? 
                                	}

                                	$grand_order_total+=$total;
        							$grand_plan_total+=$row[csf('plan_cut_qnty')];

        							$plan_cut_dif=$row[csf('plan_cut_qnty')]-$total;
        							$ex_cut_perc=($plan_cut_dif/$total)*100;

                                	?>
                                	<td align="center"><?php echo number_format($total); ?></td>
                                	<td align="center"><?php echo number_format($ex_cut_perc,2); ?>%</td>
                                	<td align="center"><?php echo number_format($row[csf('plan_cut_qnty')]); ?></td>
								</tr>
								<?
							}
                            ?>
                            <tr>
                            	<td align="right" colspan="6">Total</td>
                            	<?
                                    foreach($nameArray_size  as $key)
                                    {
										?>
                                    	<td align="center" style="border:1px solid black">
                                    		<strong><?
                                    				echo number_format($size_wise_total[$key[csf('size_number_id')]])
                                    			?>
                                    	</strong>
                                    	</td>
                                   	 	<? 
                                	}
                                	?>
                                <td align="center"><strong><?=number_format($grand_order_total)?></strong></td>
                                <td></td>
                                <td align="center"><strong><?=number_format($grand_plan_total)?></strong></td>
                            </tr>  
                        </table>
                    </fieldset>
                </div>

			<?php
				}
			?>
        <table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" style="font-family:Arial Narrow;font-size:18px;">
        <tr align="center">
        <td colspan="10"><b> Comments(Production) </b></td>
        </tr>
        <tr align="center">
        <td>Sl</td>
        <td>Po NO</td>
        <td>Ship Date</td>
        <td>Pre-Cost Qty</td>
        <td>Mn.Book Qty</td>
        <td>Sht.Book Qty</td>
        <td>Smp.Book Qty</td>
        <td>Tot.Book Qty</td>
        <td>Balance</td>
        <td>Comments</td>
        </tr>
        <?
        $cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
        $cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
        if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
        if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
        $paln_cut_qnty_array=return_library_array( "select min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id,size_number_id,item_number_id,po_break_down_id", "id", "plan_cut_qnty");
        $item_ratio_array=return_library_array( "select gmts_item_id,set_item_ratio from wo_po_details_mas_set_details  where job_no ='$txt_job_no'", "gmts_item_id", "set_item_ratio");

        $nameArray=sql_select("SELECT a.id, a.item_number_id, a.costing_per, b.po_break_down_id, b.color_size_table_id, b.requirment, c.po_number FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_po_break_down c WHERE a.job_id=b.job_id and a.job_no=c.job_no_mst and a.id=b.pre_cost_fabric_cost_dtls_id and b.po_break_down_id=c.id and b.po_break_down_id in (".str_replace("'","",$txt_order_no_id).")  $cbo_fabric_natu $cbo_fabric_source_cond and a.status_active=1 and a.is_deleted=0 order by id");
        $count=0;
        $tot_grey_req_as_pre_cost_arr=array();
        foreach ($nameArray as $result)
        {
        if (count($nameArray)>0 )
        {
        if($result[csf("costing_per")]==1)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(12*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==2)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(1*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==3)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(24*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==4)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(36*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==5)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(48*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        $tot_grey_req_as_pre_cost_arr[$result[csf("po_number")]]+=$tot_grey_req_as_pre_cost;
        }
        }

        $total_pre_cost=0;
        $total_booking_qnty_main=0;
        $total_booking_qnty_short=0;
        $total_booking_qnty_sample=0;
        $total_tot_bok_qty=0;
        $tot_balance=0;
        $booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and a.is_short=2 and c.item_category=2 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

        $booking_qnty_short=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and c.item_category=2 and a.is_short=1 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
        $booking_qnty_sample=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c  where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =4 and c.fabric_source=$cbo_fabric_source and c.item_category=2  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
        $sql_data=sql_select( "select max(a.id) as id,  a.po_number,max(a.pub_shipment_date) as pub_shipment_date,sum(a.plan_cut) as plan_cut  from wo_po_break_down a,wo_pre_cost_sum_dtls b,wo_pre_cost_mst c where a.job_no_mst=b.job_no and a.job_no_mst=c.job_no and a.id in(".str_replace("'","",$txt_order_no_id).") group by a.po_number order by pub_shipment_date asc");
        foreach($sql_data  as $row)
        {
        $col++;
        ?>
			<tr align="center">
				<td><? echo $col; ?></td>
				<td><? echo $row[csf("po_number")]; ?></td>
				<td><? echo change_date_format($row[csf("pub_shipment_date")],"dd-mm-yyyy",'-'); ?></td>
				<td align="right"><? echo number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]],2); $total_pre_cost+=$tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]; ?></td>
				<td align="right"><? echo number_format($booking_qnty_main[$row[csf("id")]],2); $total_booking_qnty_main+=$booking_qnty_main[$row[csf("id")]];?></td>
				<td align="right"><? echo number_format($booking_qnty_short[$row[csf("id")]],2); $total_booking_qnty_short+=$booking_qnty_short[$row[csf("id")]];?></td>
				<td align="right"><? echo number_format($booking_qnty_sample[$row[csf("id")]],2); $total_booking_qnty_sample+=$booking_qnty_sample[$row[csf("id")]];?></td>
				<td align="right"><? $tot_bok_qty=$booking_qnty_main[$row[csf("id")]]+$booking_qnty_short[$row[csf("id")]]+$booking_qnty_sample[$row[csf("id")]]; echo number_format($tot_bok_qty,2); $total_tot_bok_qty+=$tot_bok_qty;?></td>
				<td align="right">
				<? $balance= def_number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]-$tot_bok_qty,2,""); echo number_format($balance,2); $tot_balance+= $balance?>
				</td>
				<td>
				<?
				if( $balance>0)
				{
				echo "Less Booking";
				}
				else if ($balance<0)
				{
				echo "Extra Booking";
				}
				else
				{
				echo "";
				}
				?>
				</td>
			</tr>
        <?
        }
        ?>
        <tfoot>
        <tr>
        <td colspan="3">Total:</td>
        <td align="right"><? echo number_format($total_pre_cost,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_main,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_short,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_sample,2); ?></td>
        <td align="right"><? echo number_format($total_tot_bok_qty,2); ?></td>
        <td align="right"><? echo number_format($tot_balance,2); ?></td>
        <td></td>
        </tr>
        </tfoot>
        </table>

        <?
       /*   if(count($purchase_res))
        { */
        	?>
        <table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" style="font-family:Arial Narrow;font-size:18px;">
        <tr align="center">
        <td colspan="10"><b> Comments(Purchase)</b></td>
        </tr>
        <tr align="center">
        <td>Sl</td>
        <td>Po NO</td>
        <td>Ship Date</td>
        <td>Pre-Cost Qty</td>
        <td>Purchase<br>Booking Qty</td>
        <td>Sht.Book Qty</td>
        <td>Smp.Book Qty</td>
        <td>Tot.Book Qty</td>
        <td>Balance</td>
        <td>Comments</td>
        </tr>
        <?
        $cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
        $cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
        if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
        if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
        $paln_cut_qnty_array=return_library_array( "select min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id,size_number_id,item_number_id,po_break_down_id", "id", "plan_cut_qnty");
        $item_ratio_array=return_library_array( "select gmts_item_id,set_item_ratio from wo_po_details_mas_set_details  where job_no ='$txt_job_no'", "gmts_item_id", "set_item_ratio");

        $nameArray=sql_select("select a.id, a.item_number_id, a.costing_per, b.po_break_down_id, b.color_size_table_id, b.requirment, c.po_number FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_po_break_down c WHERE a.job_no=b.job_no and a.job_no=c.job_no_mst and a.id=b.pre_cost_fabric_cost_dtls_id and b.po_break_down_id=c.id and c.job_no_mst = '$txt_job_no'   and   a.fabric_source = '2'  and a.status_active=1 and a.is_deleted=0 order by id");
		//echo "select a.id, a.item_number_id, a.costing_per, b.po_break_down_id, b.color_size_table_id, b.requirment, c.po_number FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_po_break_down c WHERE a.job_no=b.job_no and a.job_no=c.job_no_mst and a.id=b.pre_cost_fabric_cost_dtls_id and b.po_break_down_id=c.id and c.job_no_mst = '$txt_job_no'   and   a.fabric_source = '2'  and a.status_active=1 and a.is_deleted=0 order by id";
		 

        $count=0;
        $tot_grey_req_as_pre_cost_arr=array();
        foreach ($nameArray as $result)
        {
        if (count($nameArray)>0 )
        {
        if($result[csf("costing_per")]==1)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(12*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==2)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(1*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==3)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(24*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==4)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(36*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==5)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(48*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        $tot_grey_req_as_pre_cost_arr[$result[csf("po_number")]]+=$tot_grey_req_as_pre_cost;
        }
        }

        $total_pre_cost=0;
        $total_booking_qnty_main=0;
        $total_booking_qnty_short=0;
        $total_booking_qnty_sample=0;
        $total_tot_bok_qty=0;
        $tot_balance=0;
        $booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and   a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.job_no = '$txt_job_no' and a.booking_type =1  and c.fabric_source = 2  and a.is_short=2  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");


        $booking_qnty_short=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.job_no = '$txt_job_no' and a.booking_type =1 and c.fabric_source=2 and c.item_category=2 and a.is_short=1 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
        $booking_qnty_sample=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c  where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.job_no = '$txt_job_no' and a.booking_type =4 and c.fabric_source=2 and c.item_category=2  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
        $sql_data=sql_select( "select max(a.id) as id,  a.po_number,max(a.pub_shipment_date) as pub_shipment_date,sum(a.plan_cut) as plan_cut  from wo_po_break_down a,wo_pre_cost_sum_dtls b,wo_pre_cost_mst c where a.job_no_mst=b.job_no and a.job_no_mst=c.job_no and a.job_no_mst='$txt_job_no' group by a.po_number order by pub_shipment_date asc");
        foreach($sql_data  as $row)
        {
        $col++;
        ?>
        <tr align="center">
        <td><? echo $col; ?></td>
        <td><? echo $row[csf("po_number")]; ?></td>
        <td><? echo change_date_format($row[csf("pub_shipment_date")],"dd-mm-yyyy",'-'); ?></td>
        <td align="right"><? echo number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]],2); $total_pre_cost+=$tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]; ?></td>
        <td align="right"><? echo number_format($booking_qnty_main[$row[csf("id")]],2); $total_booking_qnty_main+=$booking_qnty_main[$row[csf("id")]];?></td>
        <td align="right"><? echo number_format($booking_qnty_short[$row[csf("id")]],2); $total_booking_qnty_short+=$booking_qnty_short[$row[csf("id")]];?></td>
        <td align="right"><? echo number_format($booking_qnty_sample[$row[csf("id")]],2); $total_booking_qnty_sample+=$booking_qnty_sample[$row[csf("id")]];?></td>
        <td align="right"><? $tot_bok_qty=$booking_qnty_main[$row[csf("id")]]+$booking_qnty_short[$row[csf("id")]]+$booking_qnty_sample[$row[csf("id")]]; echo number_format($tot_bok_qty,2); $total_tot_bok_qty+=$tot_bok_qty;?></td>
        <td align="right">
        <? $balance= def_number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]-$tot_bok_qty,2,""); echo number_format($balance,2); $tot_balance+= $balance?>
        </td>
        <td>
        <?
        if( $balance>0)
        {
        echo "Less Booking";
        }
        else if ($balance<0)
        {
        echo "Extra Booking";
        }
        else
        {
        echo "";
        }
        ?>
        </td>
        </tr>
        <?
        }
        ?>
        <tfoot>
        <tr>
        <td colspan="3">Total:</td>
        <td align="right"><? echo number_format($total_pre_cost,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_main,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_short,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_sample,2); ?></td>
        <td align="right"><? echo number_format($total_tot_bok_qty,2); ?></td>
        <td align="right"><? echo number_format($tot_balance,2); ?></td>
        <td></td>
        </tr>
       
        </tfoot>
        </table>
         <?
        	//}
        ?>

		<fieldset id="div_size_color_matrix" style="max-width:1000;">
		<?
		//------------------------------ Query for TNA start-----------------------------------
				$po_id_all=str_replace("'","",$txt_order_no_id);
				$po_num_arr=return_library_array("select id,po_number from wo_po_break_down where id in($po_id_all)",'id','po_number');
				$tna_start_sql=sql_select( "SELECT id,po_number_id, (case when task_number=31 then task_start_date else null end) as fab_booking_start_date, (case when task_number=31 then task_finish_date else null end) as fab_booking_end_date, (case when task_number=60 then task_start_date else null end) as knitting_start_date, (case when task_number=60 then task_finish_date else null end) as knitting_end_date, (case when task_number=61 then task_start_date else null end) as dying_start_date, (case when task_number=61 then task_finish_date else null end) as dying_end_date, (case when task_number=64 then task_start_date else null end) as finishing_start_date, (case when task_number=64 then task_finish_date else null end) as finishing_end_date, (case when task_number=84 then task_start_date else null end) as cutting_start_date, (case when task_number=84 then task_finish_date else null end) as cutting_end_date, (case when task_number=86 then task_start_date else null end) as sewing_start_date, (case when task_number=86 then task_finish_date else null end) as sewing_end_date, (case when task_number=110 then task_start_date else null end) as exfact_start_date, (case when task_number=110 then task_finish_date else null end) as exfact_end_date, (case when task_number=47 then task_start_date else null end) as yarn_rec_start_date, (case when task_number=47 then task_finish_date else null end) as yarn_rec_end_date from tna_process_mst where status_active=1 and po_number_id in($po_id_all)"); 
				$tna_fab_start=$tna_knit_start=$tna_dyeing_start=$tna_fin_start=$tna_cut_start=$tna_sewin_start=$tna_exfact_start="";
				$tna_date_task_arr=array();
				foreach($tna_start_sql as $row)
				{
					if($row[csf("fab_booking_start_date")]!="" && $row[csf("fab_booking_start_date")]!="0000-00-00")
					{
						if($tna_fab_start=="")
						{
							$tna_fab_start=$row[csf("fab_booking_start_date")];
						}
					}


					if($row[csf("knitting_start_date")]!="" && $row[csf("knitting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_start_date']=$row[csf("knitting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['knitting_end_date']=$row[csf("knitting_end_date")];
					}
					if($row[csf("dying_start_date")]!="" && $row[csf("dying_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['dying_start_date']=$row[csf("dying_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['dying_end_date']=$row[csf("dying_end_date")];
					}
					if($row[csf("finishing_start_date")]!="" && $row[csf("finishing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_start_date']=$row[csf("finishing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['finishing_end_date']=$row[csf("finishing_end_date")];
					}
					if($row[csf("cutting_start_date")]!="" && $row[csf("cutting_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_start_date']=$row[csf("cutting_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['cutting_end_date']=$row[csf("cutting_end_date")];
					}

					if($row[csf("sewing_start_date")]!="" && $row[csf("sewing_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_start_date']=$row[csf("sewing_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['sewing_end_date']=$row[csf("sewing_end_date")];
					}
					if($row[csf("exfact_start_date")]!="" && $row[csf("exfact_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_start_date']=$row[csf("exfact_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['exfact_end_date']=$row[csf("exfact_end_date")];
					}
					if($row[csf("yarn_rec_start_date")]!="" && $row[csf("yarn_rec_start_date")]!="0000-00-00")
					{
						$tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_start_date']=$row[csf("yarn_rec_start_date")];
						$tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_end_date']=$row[csf("yarn_rec_end_date")];
					}
				}

			//------------------------------ Query for TNA end-----------------------------------
		?>
        <legend>TNA Information</legend>
        <!--<span style="font-size:180; font-weight:bold;"></span>-->
        <table width="100%" style="border:1px solid black;font-size:17px; font-family:Arial Narrow;" border="1" cellpadding="2" cellspacing="0" rules="all">
            <tr>
            	<td rowspan="2" align="center" valign="top">SL</td>
            	<td width="180" rowspan="2"  align="center" valign="top"><b>Order No</b></td>
                <td colspan="2" align="center" valign="top"><b>Yarn Receive</b></td>
                <td colspan="2" align="center" valign="top"><b>Knitting</b></td>
                <td colspan="2" align="center" valign="top"><b>Dyeing</b></td>
                <td colspan="2" align="center" valign="top"><b>Finish Fabric Prod.</b></td>
                <td colspan="2" align="center" valign="top"><b>Cutting </b></td>
                <td colspan="2" align="center" valign="top"><b>Sewing </b></td>
                <td colspan="2"  align="center" valign="top"><b>Ex-factory </b></td>
            </tr>
            <tr>
            	<td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>

            </tr>
            <?
			$i=1;
			foreach($tna_date_task_arr as $order_id=>$row)
			{
				 //$tna_date_task_arr//knitting_start_date dying_start_date finishing_start_date cutting_start_date sewing_start_date exfact_start_date
				?>
                <tr>
                	<td><? echo $i; ?></td>
                    <td><? echo $po_num_arr[$order_id]; ?></td>
                    <td align="center"><? echo change_date_format($row['yarn_rec_start_date']); ?></td>
                    <td  align="center"><? echo change_date_format($row['yarn_rec_end_date']); ?></td>
                	<td align="center"><? echo change_date_format($row['knitting_start_date']); ?></td>
                    <td  align="center"><? echo change_date_format($row['knitting_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['dying_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['dying_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['cutting_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['cutting_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['sewing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['sewing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['exfact_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['exfact_end_date']); ?></td>
                </tr>
                <?
				$i++;
			}
			?>

        </table>
        </fieldset>
        <?
		}// fabric Source End
		if($isYarnPurchseValidate==2)
		{
			?>
			<table align="left" width="350px" style="border:1px solid black;font-size:12px; font-family:Arial Narrow;" border="1" cellspacing="0" rules="all">
				<tr>
					<th colspan="3">Yarn Purchase Requisition Info</th>
				</tr>
				<tr>
					<th width="120">Job No</th>
					<th width="130">Purchase Req. No</th>
					<th>Qty.</th>
				</tr>
                <?
				$sqlYarnReq="select a.requ_no, b.job_no, sum(b.quantity) as qty from inv_purchase_requisition_mst a, inv_purchase_requisition_dtls b where a.id=b.mst_id and b.job_no='$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.requ_no, b.job_no";
				$sqlYarnReqRes=sql_select($sqlYarnReq);
				foreach($sqlYarnReqRes as $row)
				{
				?>
                <tr>
					<td width="120"><?=$row[csf("job_no")]; ?></td>
					<td width="130"><?=$row[csf("requ_no")]; ?></td>
					<td align="right"><?=number_format($row[csf("qty")],2); ?></td>
				</tr>
                <?
				}
				?>
        	</table>
            <br>
		<? } echo get_spacial_instruction($txt_booking_no,"97%",118); ?>
        
        <div ><? echo signature_table(1, $cbo_company_name, "1400px",'',70,$inserted_by2);  //signature_table(1, $cbo_company_name, "1400px"); //$user_name_arr[$user_id] ?></div>
		<br>
       <table  class="rpt_table"  border="1" align="left" cellpadding="0" width="1300" cellspacing="0" rules="all" >
        	<thead>
            	<th colspan="16"><b>Job Progress Status: </b></th>
            </thead>
            <?
			$condition= new condition();
			if(str_replace("'","",$job_no) !=''){
				$condition->job_no("='$job_no'");
			}
			//Fabric Booking
			$condition->init();
			$fabric= new fabric($condition);  //echo $fabric->getQuery();
			$fabric_qty=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
			$fabreqQty=0;
			foreach($fabric_qty['knit']['grey'] as $fid=>$fdata)
			{
				foreach($fdata as $fuom=>$fuomdata)
				{
					$fabreqQty+=$fuomdata;
				}
			}
			
			$sqlJobPo=sql_select("select id from wo_po_break_down where job_no_mst='$job_no' and status_active=1 and is_deleted=0");
			$poIds="";
			foreach($sqlJobPo as $row)
			{
				if($poIds=="") $poIds=$row[csf('id')]; else $poIds.=','.$row[csf('id')];
			}
			unset($sqlJobPo);
			
			$sqlFabbooking=sql_select("select sum(grey_fab_qnty) as grey_fab_qnty from wo_booking_dtls where job_no='$job_no' and booking_type=1 and status_active=1 and is_deleted=0");
			$fabbookingQty=$sqlFabbooking[0][csf('grey_fab_qnty')];
			
			$fabbookingPer=($fabbookingQty/$fabreqQty)*100;
			
			//Yarn Allocation
			$sqlYarnAll=sql_select("select sum(qnty) as qnty from inv_material_allocation_dtls where job_no='$job_no' and item_category=1 and status_active=1 and is_deleted=0");
			$yarnAlloQty=$sqlYarnAll[0][csf('qnty')];
			$yarnAlloPer=($yarnAlloQty/$fabreqQty)*100;
			
			$sqlStore="select entry_form, trans_type, quantity from order_wise_pro_details where po_breakdown_id in(".$poIds.") and trans_type in (1,2) and entry_form in (2,3,22,23,58,82,7,66,37,225) and status_active=1";
			$sqlstoreRes=sql_select($sqlStore);
			
			$yarnIssueQty=$knittingFinishQty=$greyRecQty=$finishProdQty=$finishRecQty=0;
			foreach($sqlstoreRes as $row)
			{
				if($row[csf('trans_type')]==2 && $row[csf('entry_form')]==3)
				{
					$yarnIssueQty+=$row[csf('quantity')];
				}
				if($row[csf('trans_type')]==1)
				{
					if($row[csf('entry_form')]==2)
					{
						$knittingFinishQty+=$row[csf('quantity')];
					}
					else if($row[csf('entry_form')]==22 || $row[csf('entry_form')]==23 || $row[csf('entry_form')]==58 || $row[csf('entry_form')]==82)
					{
						$greyRecQty+=$row[csf('quantity')];
					}
					else if($row[csf('entry_form')]==7 || $row[csf('entry_form')]==66)
					{
						$finishProdQty+=$row[csf('quantity')];
					}
					else if($row[csf('entry_form')]==37 || $row[csf('entry_form')]==225)
					{
						$finishRecQty+=$row[csf('quantity')];
					}
				}
			}
			unset($sqlstoreRes);
			
			$yarnIssePer=($yarnIssueQty/$fabreqQty)*100;			//Yarn Issued
			$knittingFinishPer=($knittingFinishQty/$fabreqQty)*100;	//Knitting Finished
			$greyRecPer=($greyRecQty/$fabreqQty)*100;				//Greige Fabric Received
			$finishProdPer=($finishProdQty/$fabreqQty)*100;			//Finished Fabric Production
			$finishRecPer=($finishRecQty/$fabreqQty)*100;			//Finished Fabric Received
			
			
			$sqlGmtsProd="select production_type, embel_name, production_quantity from pro_garments_production_mst where po_break_down_id in(".$poIds.") and production_type in (1,3,5,7,15,11,8) and status_active=1";
			$sqlGmtsProdRes=sql_select($sqlGmtsProd);
			$cutQty=$printQty=$embRecQty=$sewOutQty=$ironQty=$hangTagQty=$polyQty=$packFinQty=0;
			foreach($sqlGmtsProdRes as $row)
			{
				if($row[csf('production_type')]==1)
				{
					$cutQty+=$row[csf('production_quantity')];
				}
				else if($row[csf('production_type')]==3 && $row[csf('embel_name')]==1)
				{
					$printQty+=$row[csf('production_quantity')];
				}
				else if($row[csf('production_type')]==3 && $row[csf('embel_name')]==1)
				{
					$embRecQty+=$row[csf('production_quantity')];
				}
				else if($row[csf('production_type')]==5)
				{
					$sewOutQty+=$row[csf('production_quantity')];
				}
				else if($row[csf('production_type')]==7)
				{
					$ironQty+=$row[csf('production_quantity')];
				}
				else if($row[csf('production_type')]==15)
				{
					$hangTagQty+=$row[csf('production_quantity')];
				}
				else if($row[csf('production_type')]==11)
				{
					$polyQty+=$row[csf('production_quantity')];
				}
				else if($row[csf('production_type')]==8)
				{
					$packFinQty+=$row[csf('production_quantity')];
				}
			}
			unset($sqlGmtsProdRes);
			$cutFinishPer=($cutQty/$jobqtypcs)*100;		//Cutting Finished
			$printRecPer=($printQty/$jobqtypcs)*100;	//Print Received
			$embRecPer=($embRecQty/$jobqtypcs)*100;		//Embroidery Received
			$sewOutPer=($sewOutQty/$jobqtypcs)*100;		//Sewing Completed
			$ironPer=($ironQty/$jobqtypcs)*100;			//Iron Completed
			$hangTagPer=($hangTagQty/$jobqtypcs)*100;	//Hang Tag Completed
			$polyPer=($polyQty/$jobqtypcs)*100;			//Poly Completed
			$packFinishPer=($packFinQty/$jobqtypcs)*100;//Packing Finishing Completed
			
			//Ex-factory Completed
			$sqlExFactory=return_field_value("sum(ex_factory_qnty) as exqty", "pro_ex_factory_mst", "po_break_down_id in(".$poIds.") and status_active=1", "exqty");
			$exFactoryPer=($sqlExFactory/$jobqtypcs)*100;
			
			?>
			<tr>
            	<td width="125"><b>Fabric Booking</b></td><td align="center" width="40"><?=number_format($fabbookingPer,2); ?></td>
                <td width="125"><b>Yarn Allocation</b></td><td align="center" width="40"><?=number_format($yarnAlloPer,2); ?></td>
                <td width="125"><b>Yarn Issued</b></td><td align="center" width="40"><?=number_format($yarnIssePer,2); ?></td>
                <td width="125"><b>Knitting Finished</b></td><td align="center" width="40"><?=number_format($knittingFinishPer,2); ?></td>
                <td width="125"><b>Greige Fabric Received</b></td><td align="center" width="40"><?=number_format($greyRecPer,2); ?></td>
                <td width="125"><b>Dye-Fin. Completed</b></td><td align="center" width="40"><?=number_format($finishProdPer,2); ?></td>
                <td width="125"><b>Finished Fabric Received</b></td><td align="center" width="40"><?=number_format($finishRecPer,2); ?></td>
                <td width="125"><b>Cutting Finished</b></td><td align="center"><?=number_format($cutFinishPer,2); ?></td>
            </tr>
            <tr>
            	<td><b>Print Received</b></td><td align="center"><?=number_format($printRecPer,2); ?></td>
            	<td><b>Embroidery Received</b></td><td align="center"><?=number_format($embRecPer,2); ?></td>
            	<td><b>Sewing Completed</b></td><td align="center"><?=number_format($sewOutPer,2); ?></td>
                <td><b>Iron Completed</b></td><td align="center"><?=number_format($ironPer,2); ?></td>
                <td><b>Hang Tag Completed</b></td><td align="center"><?=number_format($hangTagPer,2); ?></td>
                <td><b>Poly Completed</b></td><td align="center"><?=number_format($polyPer,2); ?></td>
                <td><b>Packing Finishing Completed</b></td><td align="center"><?=number_format($packFinishPer,2); ?></td>
                <td><b>Ex-factory Completed</b></td><td align="center"><?=number_format($exFactoryPer,2); ?></td>
            </tr>
        </table>

		
		<div >
                    <fieldset id="div_size_color_matrix" >
                        <legend>Actual PO Information</legend>
                        <table  class="rpt_table"  border="1" align="left" cellpadding="0"  cellspacing="0" rules="all" >
                            <tr>
                            	<th>PO Number</th>                            
                            	<th>Actual PO</th>
								<th>PO Recieve Date</th>
								<th>Ship Date</th>                           	
                                <th>GMTS Items</th>
                                <th >Gmts  Color</th>
								<th>Gmts Size</th>
                                <th>Total Order Qty(pcs)</th>
                            </tr>
			<?php
			$colorLibArr=return_library_array("select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");
			$sizeLibArr=return_library_array("select id, size_name from lib_size where status_active=1 and is_deleted=0", "id", "size_name");

					$ac_sql="select  b.po_number,a.acc_po_no, a.country_id, a.gmts_item, a.gmts_color_id,a.acc_po_qty as qnty, a.acc_ship_date,a.po_break_down_id,b.po_received_date,a.gmts_size_id
					from wo_po_acc_po_info a,wo_po_break_down b where  b.id=a.po_break_down_id and a.po_break_down_id=60252 and a.job_no='FAL-22-00707' and a.status_active=1 and a.is_deleted=0 ";
					$ac_po_data=sql_select($ac_sql);


					foreach($ac_po_data as $val){?>

						<tr>
							<td><?=$val[csf('po_number')];?></td>
							<td><?=$val[csf('acc_po_no')];?></td>
							<td><?=$val[csf('po_received_date')];?></td>
							<td><?=$val[csf('acc_ship_date')];?></td>
							<td><?=$garments_item[$val[csf('gmts_item')]];?></td>
							<td align="center"><?=$colorLibArr[$val[csf('gmts_color_id')]];?></td>
							<td align="center"><?=$sizeLibArr[$val[csf('gmts_size_id')]];?></td>
							<td align="center"><?=$val[csf('qnty')];?></td>
						</tr>


					<?}	?>


		                </table>
					
				</fieldset>


		</div >







        <?


					$item_ratio_array=return_library_array( "select gmts_item_id,set_item_ratio from wo_po_details_mas_set_details  where job_no ='$job_no'", "gmts_item_id", "set_item_ratio");
					$po_number_arr=return_library_array( "select id,po_number from wo_po_break_down  where job_no_mst ='$job_no'", "id", "po_number");
					$shipment_date_arr=return_library_array( "select id,shipment_date from wo_po_break_down  where job_no_mst ='$job_no'", "id", "shipment_date");
        	$grand_order_total=0; $grand_plan_total=0; $size_wise_total=array();
			$nameArray_size=sql_select( "select size_number_id,size_order from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by size_number_id,size_order order by size_order ");



			
			$booking_dtls_sql="SELECT a.id as booking_dtls_id, b.id, a.fabric_color_id, a.fin_fab_qnty, a.grey_fab_qnty, a.amount, a.rate, a.colar_cuff_per  from wo_booking_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_pre_cost_fabric_cost_dtls c where a.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.po_break_down_id=b.po_break_down_id and a.color_size_table_id=b.color_size_table_id and a.pre_cost_fabric_cost_dtls_id=c.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_no=$txt_booking_no and a.booking_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
			$booking_dtls_res=sql_select($booking_dtls_sql);
			
			$booking_dtls_id_array=array(); $fabric_color_array=array(); $finish_fabric_qnty_array=array(); $grey_fabric_qnty_array=array(); $grey_fabric_amount_array=array(); $grey_fabric_rate_array=array(); $colar_cuff_percent_array=array();
	
			foreach($booking_dtls_res as $row)
			{
				$booking_dtls_id_array[$row[csf("id")]]=$row[csf("booking_dtls_id")];
				//$job_no=$row[csf("job_no")];
				$fabric_color_array[$row[csf("id")]]=$row[csf("fabric_color_id")];
				$finish_fabric_qnty_array[$row[csf("id")]]+=$row[csf("fin_fab_qnty")];
				$grey_fabric_qnty_array[$row[csf("id")]]+=$row[csf("grey_fab_qnty")];
				$grey_fabric_amount_array[$row[csf("id")]]=$row[csf("amount")];
				$grey_fabric_rate_array[$row[csf("id")]]['rate']=$row[csf("rate")];
				$grey_fabric_rate_array[$row[csf("id")]]['colar_cuff_per']=$row[csf("colar_cuff_per")];
			}
			unset($booking_dtls_res);
		

			$name_sql="select a.id as pre_cost_fabric_cost_dtls_id, a.job_no, a.item_number_id, a.body_part_id, a.fab_nature_id, a.fabric_source, a.color_type_id, a.gsm_weight, a.construction, a.composition, a.color_size_sensitive, a.costing_per, a.color, a.color_break_down, a.rate as rate_mst, b.id, b.po_break_down_id, b.color_size_table_id, b.color_number_id, b.gmts_sizes as size_number_id, b.dia_width, b.item_size, b.cons, b.process_loss_percent, b.requirment, b.rate, b.pcs, b.remarks FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b
			WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and a.job_no='$job_no' and b.po_break_down_id in(".str_replace("'","",$txt_order_no_id).")   and a.status_active=1 and a.is_deleted=0 order by a.id,b.color_size_table_id";
			
	
			$nameArray=sql_select($name_sql);

			$po_fabric_wise_data=array();
			foreach ($nameArray as $result){

								if($finish_fabric_qnty_array[$result[csf("id")]]>0  || $grey_fabric_qnty_array[$result[csf("id")]]> 0  )
								{

									$ship_date=change_date_format($shipment_date_arr[$result[csf('po_break_down_id')]]);

									$po_fabric_wise_data[$result[csf('po_break_down_id')]][$ship_date][$result[csf('color_number_id')]]['finish_kg']+=$finish_fabric_qnty_array[$result[csf("id")]];
									$po_fabric_wise_data[$result[csf('po_break_down_id')]][$ship_date][$result[csf('color_number_id')]]['grey_kg']+=$grey_fabric_qnty_array[$result[csf("id")]];
									$po_fabric_wise_data[$result[csf('po_break_down_id')]][$ship_date][$result[csf('color_number_id')]]['process_loss']=$result[csf('process_loss_percent')];
									$po_fabric_wise_data[$result[csf('po_break_down_id')]][$ship_date][$result[csf('color_number_id')]]['color_size_sensitive']=$result[csf('color_size_sensitive')];
									$po_fabric_wise_data[$result[csf('po_break_down_id')]][$ship_date][$result[csf('color_number_id')]]['id']=$result[csf('id')];
							
								}
			  }

			?>
                <div id="div_size_color_matrix" class="pagebreak">
                    <fieldset id="div_size_color_matrix" >
                        <legend>Size and Color Breakdown</legend>
						<table  class="rpt_table"  border="1" align="left" style="float:left;" cellpadding="0"  cellspacing="0" rules="all" >
                            <tr>
                            	<td>PO Number</td>
                            
                            	<td>Ship Date</td>
								<td>fabric color</td>
								<td>Body Color</td>                           	
                                <td  align="center"> Total Finish Fabric(kg)</td>
                                <td  align="center"> Total Grey Fabric(kg)</td>
                                <td  align="center"> Process Loss</td>
                            </tr>
                            <?
                           
							foreach ($po_fabric_wise_data as $po_id=>$shipdate_data){
								foreach ($shipdate_data as $date_id=>$color_data) {
									foreach ($color_data as  $color_id=>$result){

								?>
								<tr>
									<td title="<?=$po_id;?>"><?php echo $po_number_arr[$po_id]; ?></td>
									
									<td><?php echo $date_id; ?></td>									
									<td><? if($result["color_size_sensitive"]!=0) echo $color_library[$color_id]; ?></td>									
									<td><?php
									
									$type=1;
									$color_id="";
									if($type==1)
									{
										echo $color_library[$fabric_color_array[$result["id"]]];
										$color_id=$fabric_color_array[$result["id"]];
									}
									else if($type==2)
									{
										if($result["color_size_sensitive"]==3)
										{
											echo $constrast_color_arr[$result["color_number_id"]]; $color_id=$contrastcolor_arr[$result["job_no"]][$result["pre_cost_fabric_cost_dtls_id"]][$result["color_number_id"]];
										}
										else if($result["color_size_sensitive"]==0)
										{
											echo $color_library[$result["color"]]; $color_id=$result["color"];
										}
										else
										{
											echo $color_library[$result["color_number_id"]]; $color_id=$result["color_number_id"];
										}
									}
									 ?></td>
									<?

                                	$grand_fabric_total+=$result["finish_kg"];
        							$grand_grey_total+=$result["grey_kg"];

                                    $po_fabric_tot[$po_id]+=$result["finish_kg"];
        							$po_grey_tot[$po_id]+=$result["grey_kg"];
                                    $color_wise_arr[$color_id]['finish_kg']+=$result["finish_kg"];
                                    $color_wise_arr[$color_id]['grey_kg']+=$result["grey_kg"];

        			

                                	?>
                                	<td align="center"><?php echo number_format($result["finish_kg"],2); ?></td>
                                	<td align="center"><?php echo number_format($result["grey_kg"],2); ?></td>
                                	<td align="center"><?php echo number_format($result['process_loss']); ?></td>
								</tr>
								<?
							     }
						      }?>

                            <tr>
                            	<td align="right" colspan="4"><b>Po Wise Total</b></td>                            	
                                <td align="center"><strong><?=number_format($po_fabric_tot[$po_id],2)?></strong></td>                                
                                <td align="center"><strong><?=number_format($po_grey_tot[$po_id],2)?></strong></td>
								<td></td>
                            </tr>
                            <?

							}
                            ?>
                            <tr>
                            	<td align="right" colspan="4"><b>Grand Total</b></td>                            	
                                <td align="center"><strong><?=number_format($grand_fabric_total,2)?></strong></td>                                
                                <td align="center"><strong><?=number_format($grand_grey_total,2)?></strong></td>
								<td></td>
                            </tr>
                        </table>
                        <table  class="rpt_table"  style="float:left;margin-left:5px;" border="1" align="left" cellpadding="0"  cellspacing="0" rules="all" >
                            <tr>
                                <td colspan="4" align="center">Color wise Summary</td>                               
                            </tr>
                            <tr>
                                <td>Sl</td>
                                <td>Color Name</td>
                                <td>Finish Fabric(kg)</td>
                                <td>Grey Fabric(kg)</td>
                            </tr>
                            <?php
                            $sl=1;
                                foreach($color_wise_arr as $cid=> $val){
                            ?>
                            <tr>
                                <td width="30"><?=$sl;?></td>
                                <td width="100"><?=$color_library[$cid];?></td>
                                <td width="100" align="right"><?=number_format($val['finish_kg'],2);?></td>
                                <td width="100" align="right"><?=number_format($val['grey_kg'],2);?></td>
                            </tr>
                            <?$sl++;
                        
                                    $grand_fabric_tot+=$val['finish_kg'];
        							$grand_grey_tot+=$val['grey_kg'];
                        }?>
                            <tr>
                              
                                <td colspan="2">Total</td>
                                <td align="right"><?=number_format($grand_fabric_tot,2);?></td>
                                <td align="right"><?=number_format($grand_grey_tot,2);?></td>
                            </tr>
                        </table>
                    </fieldset>
                </div>
			<?

			$actule_po_size=sql_select("select gmts_size_id from wo_po_acc_po_info where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by gmts_size_id ");
			$actule_po_data=sql_select( "SELECT a.id as po_id,a.po_number, b.acc_po_no, a.po_received_date, b.acc_ship_date, b.gmts_color_id, b.gmts_size_id, b.acc_po_qty, b.id as actule_po_id , b.gmts_item from wo_po_break_down a join wo_po_acc_po_info b on a.id=b.PO_BREAK_DOWN_ID where b.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and b.is_deleted=0 and b.status_active=1 and a.is_deleted=0 and a.status_active=1");
			$actule_po_arr=array();
			$attribute=array('po_number','acc_po_no','po_received_date','acc_ship_date','gmts_color_id','gmts_size_id','acc_po_qty','gmts_item');
			foreach ($actule_po_data as $row) {
				foreach ($attribute as $attr) {
					$actule_po_arr[$row[csf('po_id')]][$row[csf('actule_po_id')]][$attr]=$row[csf($attr)];
				}
				$actual_color_size[$row[csf('po_id')]][$row[csf('actule_po_id')]][$row[csf('gmts_item')]][$row[csf('gmts_color_id')]][$row[csf('gmts_size_id')]] =$row[csf('acc_po_qty')];				
			}

			$booking_dtls_data=sql_select(" SELECT a.po_number, a.pub_shipment_date,b.fabric_color_id,b.gmts_color_id, b.fin_fab_qnty, b.grey_fab_qnty, c.size_number_id,c.excess_cut_perc from wo_po_break_down a join wo_booking_dtls b on a.id=b.po_break_down_id join WO_PO_COLOR_SIZE_BREAKDOWN c on c.id=b.color_size_table_id where b.booking_no=$txt_booking_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0");
			$size_lib_arr = return_library_array("select id,size_name from  lib_size ","id","size_name");
		
		?>
		    
       </div>
       <?
	$emailBody=ob_get_contents();
	//ob_clean();
	if($is_mail_send==1){
		/*$req_approved=return_field_value("id", "ELECTRONIC_APPROVAL_SETUP", "PAGE_ID = 336 and is_deleted=0");
		$is_approved=return_field_value("IS_APPROVED", "WO_BOOKING_MST", "STATUS_ACTIVE = 1 and is_deleted=0 and booking_no='$txt_booking_no'");
		if($req_approved && $is_approved==1){
			$emailBody.="<h1 style='border:1px sloid #0ff;'>Approved</h1>";
		}
		elseif($req_approved && $is_approved==0){
			$emailBody.="<h1 style='border:1px sloid #0ff;'>Draft</h1>";
		}
	*/		
		
		$sql = "SELECT c.email_address as EMAIL FROM mail_group_mst a, mail_group_child b, user_mail_address c where b.mail_group_mst_id=a.id and a.mail_item=87 and b.mail_user_setup_id=c.id and a.company_id =$cbo_company_name";
		$mail_sql_res=sql_select($sql);
		
		$mailArr=array();
		foreach($mail_sql_res as $row)
		{
			$mailArr[$row[EMAIL]]=$row[EMAIL]; 
		}
		
		$supplier_id=$nameArray[0][csf('supplier_id')];
		$supplier_mail=return_field_value("email", "lib_supplier", "status_active=1 and is_deleted=0 and id=$supplier_id ");

		
		$mailArr=array();
		if($mail_id!=''){$mailArr[]=$mail_id;}
		if($supplier_mail_arr[$supplier_id]!=''){$mailArr[]=$supplier_mail;}
		
		$to=implode(',',$mailArr);
		$subject="Fabric Booking Auto Mail";
		
		if($to!=""){
			require '../../../vendor/phpmailer/phpmailer/PHPMailerAutoload.php';
			require_once('../../../auto_mail/setting/mail_setting.php');
			$header=mailHeader();
			sendMailMailer( $to, $subject, $emailBody );
		}
	}
	exit();
}





?>
