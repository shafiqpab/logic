<?
session_start();
require_once('../../../../includes/common.php');
require_once('../../../../includes/class4/class.conditions.php');
require_once('../../../../includes/class4/class.reports.php');
require_once('../../../../includes/class4/class.yarns.php');
require_once('../../../../includes/class4/class.conversions.php');
require_once('../../../../includes/class4/class.emblishments.php');
require_once('../../../../includes/class4/class.commisions.php');
require_once('../../../../includes/class4/class.commercials.php');
require_once('../../../../includes/class4/class.others.php');
require_once('../../../../includes/class4/class.trims.php');
require_once('../../../../includes/class4/class.fabrics.php');
require_once('../../../../includes/class4/class.washes.php');

extract($_REQUEST);
if ($_SESSION['logic_erp']['user_id'] == "") 
{
    header("location:login.php");
    die;
}

if($action=="print_button_variable_setting")
{
    $print_report_format_arr = return_library_array("select format_id,format_id from lib_report_template where template_name =$data and module_id=11 and report_id=72 and is_deleted=0 and status_active=1","format_id","format_id");
    echo "print_report_button_setting('".implode(',',$print_report_format_arr)."');\n";
    exit(); 
}

if ($action == "load_drop_down_buyer") 
{
    echo create_drop_down("cbo_buyer_name", 110, "select buy.id,buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company='$data' $buyer_cond  and buy.id in (select buyer_id from  lib_buyer_party_type where party_type in (1,3,21,90)) order by buyer_name", "id,buyer_name", 1, "-- Select Buyer --", $selected, "load_drop_down( 'requires/shipment_date_wise_wp_report_controller', this.value, 'load_drop_down_season', 'season_td');");
    exit();
}

$buyer_short_name_arr = return_library_array("select id, short_name from lib_buyer", 'id', 'short_name');
$company_short_name_arr = return_library_array("select id,company_name from lib_company", 'id', 'company_name');
$imge_arr = return_library_array("select master_tble_id,image_location from common_photo_library where file_type=1", 'master_tble_id', 'image_location');
//$dealing_merchant_array = return_library_array("select id, team_member_name from lib_mkt_team_member_info","id","team_member_name");

$SqlResult = sql_select("select id, team_member_name,member_contact_no from lib_mkt_team_member_info");
foreach ($SqlResult as $row) 
{
    if ($row[csf('member_contact_no')]) 
    {
        $phone = "<br>Ph:" . $row[csf('member_contact_no')];
    } 
    else 
    {
        $phone = "";
    }
    $dealing_merchant_array[$row[csf('id')]] = $row[csf('team_member_name')] . $phone;
}

if ($action == "report_generate") 
{
    $company_name   = str_replace("'", "", $cbo_company_name);
    $buyer_name     = str_replace("'", "", $cbo_buyer_name);
    $year_id        = str_replace("'", "", $cbo_year);    
    $job_no         = str_replace("'", "", $txt_job_no);
    $txt_style_ref  = str_replace("'", "", $txt_style_ref);
    $txt_order_no   = str_replace("'", "", $txt_order_no);
    $shipmentStatus= str_replace("'", "", $cbo_shipment_status);
    $orderStatus   = str_replace("'","", $cbo_order_status);
    $status         = str_replace("'", "", $cbo_status);
    $report_type    = str_replace("'", "", $cbo_report_type);
    $date_category  = str_replace("'", "", $cbo_date_category);    
    $type  = str_replace("'", "", $type);    

    /*===============================================================================/
    /                              Create Library Array                              /
    /============================================================================== */
    $team_library   = return_library_array("select id,team_leader_name from lib_marketing_team where status_active =1 and is_deleted=0", "id", "team_leader_name");
    $merchant_library   = return_library_array("select id,team_member_name from lib_mkt_team_member_info where status_active =1 and is_deleted=0", "id", "team_member_name");
    $country_library= return_library_array("select id, country_name from  lib_country", "id", "country_name");
    $buyer_library  = return_library_array("select id, buyer_name from  lib_buyer", "id", "buyer_name");
    $supplier_library  = return_library_array("select id, supplier_name from  lib_supplier", "id", "supplier_name");
    $color_library  = return_library_array("select id, color_name from  lib_color", "id", "color_name");
    $size_library   = return_library_array("select id, size_name from  lib_size", "id", "size_name");
    $company_library= return_library_array("select id, company_name from  lib_company", "id", "company_name");
    $sub_dep_library= return_library_array("select id,sub_department_name from lib_pro_sub_deparatment status_active =1 and is_deleted=0", "id", "sub_department_name");
    $season_library = return_library_array("select id, season_name from lib_buyer_season where status_active =1 and is_deleted=0", "id", "season_name");
    $brand_library = return_library_array("select id, brand_name from lib_buyer_brand brand where status_active =1 and is_deleted=0", "id", "brand_name");
    $sub_dep_library = return_library_array("select id,sub_department_name from lib_pro_sub_deparatment where status_active =1 and is_deleted=0", "id", "sub_department_name");
    $user_library = return_library_array("select id,user_full_name from user_passwd where status_active =1", "id", "user_full_name");
    $bank_library = return_library_array("select bank_name,id from lib_bank where is_deleted=0 and status_active=1 and lien_bank=1", "id", "bank_name");
    // echo "<pre>";print_r($user_library);die;

    $fab_material=array(1=>"Organic",2=>"BCI");

    /*===============================================================================/
    /                                   Query Condition                              /
    /============================================================================== */
    $sqlCond = "";
    $sqlCond = ($company_name) ? " and a.company_name=$company_name" : "";
    $sqlCond .= ($buyer_name) ? " and a.buyer_name=$buyer_name" : "";
    $sqlCond .= ($year_id) ? " and to_char(a.insert_date,'YYYY')=$year_id" : "";
    $sqlCond .= ($job_no!="") ? " and a.job_no_prefix_num=$job_no" : "";
    $sqlCond .= ($txt_style_ref!="") ? " and a.style_ref_no='$txt_style_ref'" : "";
    $sqlCond .= ($txt_order_no!="") ? " and b.po_number='$txt_order_no'" : "";
    $sqlCond .= ($orderStatus) ? " and b.status_active=$orderStatus" : "";
    $sqlCond .= ($status) ? " and b.is_confirmed=$status" : "";

    if($shipmentStatus)
    {
        if ($shipmentStatus==4) 
        {
            $sqlCond .= " and b.shiping_status in(1,2)";
        }
        else
        {
            $sqlCond .= " and b.shiping_status in($shipmentStatus)";
        }
    }

    if(str_replace("'", "", $txt_date_from) !="" && str_replace("'", "", $txt_date_to) !="")
    {
        switch ($date_category) 
        {
            case 1:
                $sqlCond .= " and b.shipment_date between $txt_date_from and $txt_date_to";
                break;

            case 2:
                $sqlCond .= " and b.shipment_date between $txt_date_from and $txt_date_to";
                break;    
            
            default:
                $sqlCond .= " and b.factory_received_date between $txt_date_from and $txt_date_to";
                break;
        }
    }

    /*===============================================================================/
    /                                  MAIN QUERY                                    /
    /============================================================================== */
    $sql = "SELECT a.id,a.job_no, a.company_name,a.style_owner,a.buyer_name,a.style_ref_no,a.requisition_no,a.style_description,a.repeat_job_no,a.season_buyer_wise,a.product_dept,a.product_code,a.pro_sub_dep,a.order_uom,  a.product_category,a.brand_id,a.region,a.sustainability_standard,a.fab_material,a.qlty_label,a.quality_level,(a.job_quantity*a.total_set_qnty) as job_qty_pcs,    to_char(a.insert_date,'YYYY') as year,a.ship_mode,a.set_smv,a.team_leader,a.dealing_marchant,a.factory_marchant,a.inserted_by,a.updated_by,a.total_price,a.qlty_label,

        b.is_confirmed,b.id as po_id,b.po_number,b.excess_cut,(b.po_quantity*a.total_set_qnty) as po_quantity,b.unit_price,(b.po_total_price*a.total_set_qnty) as po_total_price ,to_char(b.insert_date,'DD-MM-YYYY') as po_insert_date,to_char(b.po_received_date,'DD-MM-YYYY') as po_received_date,to_char(b.factory_received_date,'DD-MM-YYYY') as factory_received_date,to_char(b.pub_shipment_date,'DD-MM-YYYY') as pub_shipment_date,to_char(b.shipment_date,'DD-MM-YYYY') as shipment_date,to_char(b.txt_etd_ldd,'DD-MM-YYYY') as txt_etd_ldd,b.shiping_status,(b.pub_shipment_date-b.po_received_date) as lead_time,(b.pub_shipment_date - trunc(sysdate)) AS days_in_hand,b.rfi_date,

        c.country_id,c.item_number_id,c.color_number_id,c.size_number_id,c.order_quantity,c.plan_cut_qnty,to_char(c.cutup_date,'DD-MM-YYYY') as cutup_date,to_char(c.country_ship_date,'DD-MM-YYYY') as country_ship_date

        from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.id=b.job_id and b.id=c.po_break_down_id and a.id=c.job_id and a.status_active=1 and a.is_deleted=0 and c.status_active in(1,2,3) and c.is_deleted=0 $sqlCond";
     //echo $sql;die();
    $sql_res = sql_select($sql);
    if(count($sql_res)==0)
    {
        ?>
        <center>
            <div style="width: 80%;" class="alert alert-danger">Data not found.Please try again.</div>
        </center>
        <?
        die();
    }
    $data_array = array();
    $job_id_array = array();
    $job_no_array = array();
    $po_array = array();
    $po_wise_data = array();
    $po_wise_job_arr = array();
    $po_chk_array = array();
    $po_wise_unit_price_array = array();
    $rfi_date_array = array();
    foreach ($sql_res as $val) 
    {
        $rfi_date_array[$val['JOB_NO']][$val['RFI_DATE']] = $val['RFI_DATE'];

        $data_array[$val['JOB_NO']]['company_name'] = $val['COMPANY_NAME'];
        $data_array[$val['JOB_NO']]['buyer_name'] = $val['BUYER_NAME'];
        $data_array[$val['JOB_NO']]['wo_com_id'] = $val['STYLE_OWNER'];
        $data_array[$val['JOB_NO']]['year'] = $val['YEAR'];
        $data_array[$val['JOB_NO']]['style'] = $val['STYLE_REF_NO'];
        $data_array[$val['JOB_NO']]['req_no'] = $val['REQUISITION_NO'];
        $data_array[$val['JOB_NO']]['repeat_job_no'] = $val['REPEAT_JOB_NO'];
        $data_array[$val['JOB_NO']]['style_des'] = $val['STYLE_DESCRIPTION'];
        $data_array[$val['JOB_NO']]['season'] = $val['SEASON_BUYER_WISE'];
        $data_array[$val['JOB_NO']]['product_dept'] = $val['PRODUCT_DEPT'];
        $data_array[$val['JOB_NO']]['product_code'] = $val['PRODUCT_CODE'];
        $data_array[$val['JOB_NO']]['pro_sub_dep'] = $val['PRO_SUB_DEP'];
        $data_array[$val['JOB_NO']]['product_category'] = $val['PRODUCT_CATEGORY'];
        $data_array[$val['JOB_NO']]['brand_id'] = $val['BRAND_ID'];
        $data_array[$val['JOB_NO']]['region'] = $val['REGION'];
        $data_array[$val['JOB_NO']]['sustainability_standard'] = $val['SUSTAINABILITY_STANDARD'];
        $data_array[$val['JOB_NO']]['fab_material'] = $val['FAB_MATERIAL'];
        $data_array[$val['JOB_NO']]['order_nature'] = $val['QLTY_LABEL'];
        $data_array[$val['JOB_NO']]['quality_level'] = $val['QUALITY_LEVEL'];
        $data_array[$val['JOB_NO']]['qlty_label'] = $val['QLTY_LABEL'];
        $data_array[$val['JOB_NO']]['job_qty_pcs'] = $val['JOB_QTY_PCS'];
        $data_array[$val['JOB_NO']]['order_uom'] = $val['ORDER_UOM'];
        $data_array[$val['JOB_NO']]['ship_mode'] = $val['SHIP_MODE'];
        $data_array[$val['JOB_NO']]['set_smv'] = $val['SET_SMV'];
        $data_array[$val['JOB_NO']]['team_leader'] = $val['TEAM_LEADER'];
        $data_array[$val['JOB_NO']]['dealing_marchant'] = $val['DEALING_MARCHANT'];
        $data_array[$val['JOB_NO']]['factory_marchant'] = $val['FACTORY_MARCHANT'];
        $data_array[$val['JOB_NO']]['inserted_by'] = $val['INSERTED_BY'];
        $data_array[$val['JOB_NO']]['updated_by'] = $val['UPDATED_BY'];
        $data_array[$val['JOB_NO']]['total_price'] = $val['TOTAL_PRICE'];

        $data_array[$val['JOB_NO']]['po_number'] .= $val['PO_NUMBER'].",";
        $data_array[$val['JOB_NO']]['order_status'] .= $val['IS_CONFIRMED'].",";
        $po_wise_data[$val['JOB_NO']]['excess_cut'] .= $val['PO_NUMBER']."=".$val['EXCESS_CUT']."**";

        $data_array[$val['JOB_NO']]['country_id'] .= $val['COUNTRY_ID'].",";
        $data_array[$val['JOB_NO']]['item_id'] .= $val['ITEM_NUMBER_ID'].",";
        $data_array[$val['JOB_NO']]['color_id'] .= $val['COLOR_NUMBER_ID'].",";
        $data_array[$val['JOB_NO']]['size_id'] .= $val['SIZE_NUMBER_ID'].",";
        $data_array[$val['JOB_NO']]['order_quantity'] += $val['ORDER_QUANTITY'];
        $data_array[$val['JOB_NO']]['plan_cut_qnty'] += $val['PLAN_CUT_QNTY'];
        if(!in_array($val['PO_ID'], $po_chk_array))
        {
            $data_array[$val['JOB_NO']]['po_quantity'] += $val['PO_QUANTITY'];
            $data_array[$val['JOB_NO']]['order_value'] += $val['PO_TOTAL_PRICE'];
            $data_array[$val['JOB_NO']]['unit_price'] .= ($data_array[$val['JOB_NO']]['unit_price']=="") ? $val['UNIT_PRICE'] : ", ".$val['UNIT_PRICE'];
            $data_array[$val['JOB_NO']]['po_insert_date'] .= ($data_array[$val['JOB_NO']]['po_insert_date']=="") ? $val['PO_INSERT_DATE'] : ", ".$val['PO_INSERT_DATE'];
            $data_array[$val['JOB_NO']]['po_received_date'] .= ($data_array[$val['JOB_NO']]['po_received_date']=="") ? $val['PO_RECEIVED_DATE'] : ", ".$val['PO_RECEIVED_DATE'];
            $data_array[$val['JOB_NO']]['factory_received_date'] .= ($data_array[$val['JOB_NO']]['factory_received_date']=="") ? $val['FACTORY_RECEIVED_DATE'] : ", ".$val['FACTORY_RECEIVED_DATE'];
            $data_array[$val['JOB_NO']]['pub_shipment_date'] .= ($data_array[$val['JOB_NO']]['pub_shipment_date']=="") ? $val['PUB_SHIPMENT_DATE'] : ", ".$val['PUB_SHIPMENT_DATE'];
            $data_array[$val['JOB_NO']]['shipment_date'] .= ($data_array[$val['JOB_NO']]['shipment_date']=="") ? $val['SHIPMENT_DATE'] : ", ".$val['SHIPMENT_DATE'];
            $data_array[$val['JOB_NO']]['txt_etd_ldd'] .= ($data_array[$val['JOB_NO']]['txt_etd_ldd']=="") ? $val['TXT_ETD_LDD'] : ", ".$val['TXT_ETD_LDD'];
            $data_array[$val['JOB_NO']]['shipment_status'] .= ($data_array[$val['JOB_NO']]['shipment_status']=="") ? $shipment_status[$val['SHIPING_STATUS']] : ", ".$shipment_status[$val['SHIPING_STATUS']];
            $data_array[$val['JOB_NO']]['lead_time'] .= ($data_array[$val['JOB_NO']]['lead_time']=="") ? $val['LEAD_TIME'] : ", ".$val['LEAD_TIME'];
            $data_array[$val['JOB_NO']]['days_in_hand'] .= ($data_array[$val['JOB_NO']]['days_in_hand']=="") ? $val['DAYS_IN_HAND'] : ", ".$val['DAYS_IN_HAND'];

            $po_chk_array[$val['PO_ID']] = $val['PO_ID'];
        }
        $data_array[$val['JOB_NO']]['cutup_date'] .= ($data_array[$val['JOB_NO']]['cutup_date']=="") ? $val['CUTUP_DATE'] : ",".$val['CUTUP_DATE'];
        $data_array[$val['JOB_NO']]['country_ship_date'] .= ($data_array[$val['JOB_NO']]['country_ship_date']=="") ? $val['COUNTRY_SHIP_DATE'] : ",".$val['COUNTRY_SHIP_DATE'];


        $job_id_array[$val['ID']] = $val['ID'];
        $job_no_array[$val['JOB_NO']] = $val['JOB_NO'];
        $po_array[$val['PO_ID']] = $val['PO_ID'];
        $po_wise_job_arr[$val['PO_ID']] = $val['JOB_NO'];
        $po_wise_unit_price_array[$val['PO_ID']] = $val['UNIT_PRICE'];
    }

    unset($sql_res);
    // echo "<pre>";print_r($po_array);echo "</pre>";die();
    /*===============================================================================/
    /                                  Job Image                                     /
    /============================================================================== */
    $job_cond = where_con_using_array($job_no_array,1,"master_tble_id");

    $imge_arr = return_library_array("SELECT master_tble_id,image_location from common_photo_library where file_type=1 $job_cond", 'master_tble_id', 'image_location');
    /*===============================================================================/
    /                                  COSTING PER                                   /
    /============================================================================== */
    $job_ids = implode(",", $job_id_array);
    $costing_per_sql=sql_select("SELECT JOB_NO,COSTING_PER from wo_pre_cost_mst where status_active=1 and job_id in($job_ids)");
    $costing_per_arr=array();
    foreach($costing_per_sql as $cost_val)
    {
        $costing_per_arr[$cost_val['JOB_NO']] = $cost_val['COSTING_PER'];
    }
    unset($costing_per_sql);

    /*===============================================================================/
    /                                 Item Wise SMV                                  /
    /============================================================================== */
    $job_ids = implode(",", $job_id_array);
    $sql = "SELECT job_no,gmts_item_id,smv_pcs from wo_po_details_mas_set_details where job_id in($job_ids)";
    // echo $sql;die();
    $res = sql_select($sql);
    $item_smv_array = array();
    foreach ($res as $val) 
    {
        $item_smv_array[$val['JOB_NO']][$val['GMTS_ITEM_ID']] = $val['SMV_PCS'];        
    }
    // echo "<pre>";print_r($item_smv_array);
    /*===============================================================================/
    /                                   Conversion Cost                              /
    /============================================================================== */
    $job_cond = where_con_using_array($job_id_array,1,"job_id");
    $sql = "SELECT job_no,cons_process,charge_unit from wo_pre_cost_fab_conv_cost_dtls where status_active=1 and is_deleted=0 $job_cond";
    // echo $sql;
    $res = sql_select($sql);
    $conv_cost_arr = array();
    $conv_id_chk_arr = array();
    foreach ($res as $val) 
    {
            $conv_cost_arr[$val['JOB_NO']][$val['CONS_PROCESS']]['rate'] += $val['CHARGE_UNIT'];
            $conv_cost_arr[$val['JOB_NO']][$val['CONS_PROCESS']]['count']++;
        
    }
    // echo "<pre>";print_r($conv_id_chk_arr);die();
    /*===============================================================================/
    /                                  Embel Name                                    /
    /============================================================================== */
    $job_cond = where_con_using_array($job_id_array,1,"job_id");
    $sql = "SELECT job_no,emb_name from wo_pre_cost_embe_cost_dtls where status_active=1 and is_deleted=0 and emb_type!=0 $job_cond";
    // echo $sql;
    $res = sql_select($sql);
    $emb_name_arr = array();
    $emb_id_chk_arr = array();
    foreach ($res as $val) 
    {
        if(!in_array($val['EMB_NAME'], $emb_id_chk_arr[$val['JOB_NO']]))
        {
            $emb_name_arr[$val['JOB_NO']] .= ($emb_name_arr[$val['JOB_NO']]=="") ? $emblishment_name_array[$val['EMB_NAME']] : ",".$emblishment_name_array[$val['EMB_NAME']];
            $emb_id_chk_arr[$val['JOB_NO']][$val['EMB_NAME']] = $val['EMB_NAME'];
        }
    }

    /*===============================================================================/
    /                                Conversion Name                                 /
    /============================================================================== */
    $job_cond = where_con_using_array($job_id_array,1,"job_id");
    $sql = "SELECT job_no,cons_process from wo_pre_cost_fab_conv_cost_dtls where status_active=1 and is_deleted=0 $job_cond";
    // echo $sql;
    $res = sql_select($sql);
    $conv_name_arr = array();
    $conv_id_chk_arr = array();
    foreach ($res as $val) 
    {
        if(!in_array($val['CONS_PROCESS'], $conv_id_chk_arr[$val['JOB_NO']]))
        {
            $conv_name_arr[$val['JOB_NO']] .= ($conv_name_arr[$val['JOB_NO']]=="") ? $conversion_cost_head_array[$val['CONS_PROCESS']] : ",".$conversion_cost_head_array[$val['CONS_PROCESS']];
            $conv_id_chk_arr[$val['JOB_NO']][$val['CONS_PROCESS']] = $val['CONS_PROCESS'];
        }
    }
    // echo "<pre>";print_r($conv_id_chk_arr);die();
    /*===============================================================================/
    /                                  ACTUAL PO                                     /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"po_break_down_id");
    $sql = "SELECT job_no, acc_po_no FROM wo_po_acc_po_info where status_active=1 and is_deleted=0 $po_cond";
    $res = sql_select($sql);
    $acc_po_array = array();
    $acc_po_chk = array();
    foreach ($res as $key => $val) 
    {
        if(!in_array($val['ACC_PO_NO'], $acc_po_chk[$val['JOB_NO']]))
        {
            $acc_po_array[$val['JOB_NO']]['acc_po'] .= ($acc_po_array[$val['JOB_NO']]['acc_po']=="") ? $val['ACC_PO_NO'] : ", ".$val['ACC_PO_NO'];
            $acc_po_chk[$val['JOB_NO']][$val['ACC_PO_NO']] = $val['ACC_PO_NO'];
        }
    }

    /*===============================================================================/
    /                                  Booking Data                                  /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"b.po_break_down_id");
    $sql = "SELECT a.entry_form,a.process, b.job_no,a.item_category,to_char(a.booking_date,'DD-MM-YYYY') as booking_date,to_char(a.delivery_date,'DD-MM-YYYY') as delivery_date,a.booking_no,a.booking_no_prefix_num, b.po_break_down_id as po_id,a.booking_type,a.fabric_source,a.is_short,a.revised_no, b.fin_fab_qnty,b.grey_fab_qnty,a.is_approved,b.dia_width,b.gsm_weight,b.process_loss_percent,b.construction,b.copmposition,a.uom from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $booking_data_array = array();
    $pur_booking_data_array = array();
    $service_booking_data_array = array();
    $booking_qty_array = array();
    $booking_chk_array = array();
    foreach ($res as $val) 
    {
        if($val['ITEM_CATEGORY']==2)
        {
            if($val['FABRIC_SOURCE']==1)
            {
            
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['booking_date'] .= $val['BOOKING_DATE'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['booking_no'] .= $val['BOOKING_NO'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['uom'] .= $val['UOM'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['delivery_date'] .= $val['DELIVERY_DATE'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['revised_no'] .= $val['REVISED_NO'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['is_approved'] .= $val['IS_APPROVED'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['dia_width'] .= $val['DIA_WIDTH'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['gsm_weight'] .= $val['GSM_WEIGHT'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['process_loss'] .= $val['PROCESS_LOSS_PERCENT'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['construction'] .= $val['CONSTRUCTION']."__";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['copmposition'] .= $val['COPMPOSITION']."__";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['fin_fab_qnty'] += $val['FIN_FAB_QNTY'];
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['grey_fab_qnty'] += $val['GREY_FAB_QNTY'];
            }
            else
            {
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['booking_date'] .= $val['BOOKING_DATE'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['booking_no'] .= $val['BOOKING_NO'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['uom'] .= $val['UOM'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['delivery_date'] .= $val['DELIVERY_DATE'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['revised_no'] .= $val['REVISED_NO'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['is_approved'] .= $val['IS_APPROVED'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['dia_width'] .= $val['DIA_WIDTH'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['gsm_weight'] .= $val['GSM_WEIGHT'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['process_loss'] .= $val['PROCESS_LOSS_PERCENT'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['construction'] .= $val['CONSTRUCTION']."__";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['copmposition'] .= $val['COPMPOSITION']."__";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['fin_fab_qnty'] += $val['FIN_FAB_QNTY'];
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['grey_fab_qnty'] += $val['GREY_FAB_QNTY'];
            }
            if($val['ENTRY_FORM']!=108) // omit partial fab. booking
            {
                $booking_qty_array[$po_wise_job_arr[$val['PO_ID']]]['grey_fab_qnty'] += $val['GREY_FAB_QNTY'];
                $booking_qty_array[$po_wise_job_arr[$val['PO_ID']]]['fin_fab_qnty'] += $val['FIN_FAB_QNTY'];
            }
        }

        if($val['ENTRY_FORM']==228)
        {
            if($booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][228]=="")
            {
                $service_booking_data_array[$val['JOB_NO']]['knitting'] .= ($service_booking_data_array[$val['JOB_NO']]['knitting']=="") ? $val['BOOKING_NO'] : $val['BOOKING_NO'].",";
                $booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][228] = $val['BOOKING_NO'];
            }
        }

        if($val['ENTRY_FORM']==229)
        {
            if($booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][229]=="")
            {
                $service_booking_data_array[$val['JOB_NO']]['dyeing'] .= ($service_booking_data_array[$val['JOB_NO']]['dyeing']=="") ? $val['BOOKING_NO'] : $val['BOOKING_NO'].",";
                $booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][229] = $val['BOOKING_NO'];
            }
        }

        if($val['PROCESS']==35)
        {
            if($booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][35]=="")
            {
                $service_booking_data_array[$val['JOB_NO']]['aop'] .= ($service_booking_data_array[$val['JOB_NO']]['aop']=="") ? $val['BOOKING_NO'] : $val['BOOKING_NO'].",";
                $booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][35] = $val['BOOKING_NO'];
            }
        }
       
    }
    // echo "<pre>";print_r($pur_booking_data_array);echo "</pre>";die();

    /*===============================================================================/
    /                                   Short Fab booking_no                         /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"b.po_break_down_id");
    $sql="SELECT a.id as pre_cost_fabric_cost_dtls_id, a.job_no, a.color_type_id, a.gsm_weight, a.construction, a.composition FROM wo_pre_cost_fabric_cost_dtls a, wo_booking_dtls b, wo_pre_cos_fab_co_avg_con_dtls c WHERE a.job_no=b.job_no and a.id=c.pre_cost_fabric_cost_dtls_id and b.pre_cost_fabric_cost_dtls_id=a.id  and c.cons>0 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and c.status_active=1 and c.is_deleted=0 and b.is_short=1 and b.booking_type=1 $po_cond";
    // echo $sql;die();

    $res=sql_select($sql);
    $short_fab_array = array();
    foreach ($res as $val) 
    {
        $short_fab_array[$val["JOB_NO"]]=$body_part[$val[csf("body_part_id")]].', '.$color_type[$val[csf("color_type_id")]].', '.$val[csf("construction")].', '.$val[csf("composition")].', '.$val[csf("gsm_weight")];
    }


    $sql_res = sql_select("SELECT b.job_no, max(c.approved_no) as approved_no from wo_booking_mst a,wo_booking_dtls b, approval_history c where a.booking_no=b.booking_no and a.id=c.mst_id and c.entry_form=7  $po_cond group by b.job_no");
    $amendment_arr = array();
    foreach ($sql_res as $val) 
    {
        $amendment_arr[$val['JOB_NO']] = $val['APPROVED_NO'];
    }
    // echo "<pre>";print_r($amendment_arr);echo "</pre>";die();
    /*===============================================================================/
    /                                    Work order data                             /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"d.id");
    $sql="SELECT a.job_no,c.emb_name, f.booking_no from wo_po_details_master a, wo_pre_cost_mst b, wo_pre_cost_embe_cost_dtls c, wo_po_break_down d, wo_pre_cos_emb_co_avg_con_dtls e, wo_booking_dtls f
    where a.id=b.job_id and a.id=c.job_id and a.id=d.job_id and a.id=e.job_id and a.job_no=f.job_no and c.id=e.pre_cost_emb_cost_dtls_id and d.id=e.po_break_down_id and e.pre_cost_emb_cost_dtls_id= f.pre_cost_fabric_cost_dtls_id and e.po_break_down_id=f.po_break_down_id and f.booking_type=6 and d.is_deleted=0 and d.status_active=1 and f.status_active=1 and f.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $work_order_data_array = array();
    foreach ($res as $val) 
    {
        $bek = explode("-", $val['BOOKING_NO']);
        $work_order_data_array[$val['JOB_NO']][$val['EMB_NAME']] = $bek[3];
        
    }
    // echo "<pre>";print_r($work_order_data_array);die;
    /*===============================================================================/
    /                            YARN DYEING WORK ORDER DATA                         /
    /============================================================================== */
    $job_id_cond = where_con_using_array($job_id_array,0,"b.job_no_id");
    $sql="SELECT b.job_no,a.yarn_dyeing_prefix_num from wo_yarn_dyeing_mst a, wo_yarn_dyeing_dtls b
    where a.id=b.mst_id and a.is_deleted=0 and a.status_active=1 and b.status_active=1 and b.is_deleted=0 $job_id_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $yd_work_order_data_array = array();
    foreach ($res as $val) 
    {
        $yd_work_order_data_array[$val['JOB_NO']] = $val['YARN_DYEING_PREFIX_NUM'];
        
    }
    /*===============================================================================/
    /                                   YARN Allocation                              /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_break_down_id");
    $sql = "SELECT a.job_no,a.is_dyied_yarn,a.qnty from inv_material_allocation_dtls a where a.status_active=1 and a.is_deleted=0 and a.item_category=1 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $yarn_allocation_array = array();
    foreach ($res as $val) 
    {
        $yarn_allocation_array[$val['JOB_NO']] += $val['QNTY'];
    }
    /*===============================================================================/
    /                                      Textile Data                              /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_breakdown_id");
    $sql = "SELECT a.po_breakdown_id,a.entry_form,a.trans_type,a.quantity from order_wise_pro_details a where a.status_active=1 and a.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $textile_data_array = array();
    $transfer_data_array = array();
    foreach ($res as $val) 
    {
        $textile_data_array[$po_wise_job_arr[$val['PO_BREAKDOWN_ID']]][$val['ENTRY_FORM']] += $val['QUANTITY'];
        $transfer_data_array[$po_wise_job_arr[$val['PO_BREAKDOWN_ID']]][$val['ENTRY_FORM']][$val['TRANS_TYPE']] += $val['QUANTITY'];
    }
    // echo "<pre>";print_r($textile_data_array);die;

    /*===============================================================================/
    /                             Yarn Rcv From Dyeing                               /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"c.po_breakdown_id");
    $sql = "SELECT c.po_breakdown_id as po_id, c.QUANTITY  from inv_receive_master a, inv_transaction b,order_wise_pro_details c where a.id=b.mst_id and b.id=c.trans_id and b.item_category=1 and a.entry_form=1 and b.transaction_type in(1) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.receive_purpose in(2) $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $yarn_rcv_from_dyeing_array = array();
    foreach ($res as $val) 
    {
        $yarn_rcv_from_dyeing_array[$po_wise_job_arr[$val['PO_ID']]] += $val['QUANTITY'];
    }
    // echo "<pre>";print_r($yarn_rcv_from_dyeing_array);die;

    /*===============================================================================/
    /                               knitting plan data                               /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_id");
    $sql="SELECT a.program_qnty,a.po_id from ppl_planning_entry_plan_dtls a where a.status_active=1 and a.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $program_data_array = array();
    foreach ($res as $val) 
    {
        $program_data_array[$po_wise_job_arr[$val['PO_ID']]] += $val['PROGRAM_QNTY'];
    }

    /*===============================================================================/
    /                               knitting production                              /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"c.po_breakdown_id");
    $sql="SELECT a.knitting_source,c.po_breakdown_id as po_id,c.quantity from inv_receive_master a,pro_grey_prod_entry_dtls b, order_wise_pro_details c where a.id=b.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and c.entry_form=2 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $knitting_data_array = array();
    foreach ($res as $val) 
    {
        $knitting_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['KNITTING_SOURCE']] += $val['QUANTITY'];
    }

    /*===============================================================================/
    /                               Dyed yarn issue                                  /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"c.po_breakdown_id");
    $sql = "SELECT c.po_breakdown_id as po_id, c.QUANTITY  from inv_issue_master a, inv_transaction b,order_wise_pro_details c,product_details_master d where a.id=b.mst_id and b.id=c.trans_id and d.id=c.prod_id and b.item_category=1 and b.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.dyed_type=1 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $dyed_yarn_issue_array = array();
    foreach ($res as $val) 
    {
        $dyed_yarn_issue_array[$po_wise_job_arr[$val['PO_ID']]] += $val['QUANTITY'];
    }
    // echo "<pre>";print_r($dyed_yarn_issue_array);die;

    /*===============================================================================/
    /                                Roll Data                         
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_breakdown_id");
    $sql = "SELECT a.po_breakdown_id,a.entry_form,a.qnty from pro_roll_details a where a.status_active=1 and a.is_deleted=0  $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $roll_data_array = array();
    foreach ($res as $val) 
    {
        $roll_data_array[$po_wise_job_arr[$val['PO_BREAKDOWN_ID']]][$val['ENTRY_FORM']] += $val['QNTY'];
    }

    /*===============================================================================/
    /                                Fab Dyeing Prodduction                          /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_id");
    $sql = "SELECT c.load_unload_id,a.po_id,c.batch_qty,c.production_qty from pro_batch_create_dtls a, pro_fab_subprocess b,pro_fab_subprocess_dtls c where a.mst_id=b.batch_id and b.id=c.mst_id and a.status_active=1 and b.status_active=1 and c.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and c.load_unload_id=2 and b.result=1 and b.entry_form=35 and b.shade_matched=1 and a.PROD_ID = c.PROD_ID and a.ROLL_ID = c.ROLL_ID and a.BARCODE_NO = c.BARCODE_NO $po_cond";
    // echo $sql;die;
    $res = sql_select($sql);
    $fab_dyeing_array = array();
    foreach ($res as $val) 
    {
        $fab_dyeing_array[$po_wise_job_arr[$val['PO_ID']]] += $val['PRODUCTION_QTY'];
    }

    /*===============================================================================/
    /                           Fab Dyeing fin process name                          /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_id");
    $sql = "SELECT DISTINCT a.po_id,b.process_id from pro_batch_create_dtls a, pro_fab_subprocess b where a.mst_id=b.batch_id and a.status_active=1 and b.status_active=1 and b.entry_form!=35 $po_cond";
    // echo $sql;die;
    $res = sql_select($sql);
    $fab_dyeing_process_array = array();
    $process_id_chk_array = array();
    foreach ($res as $val) 
    {
        if($process_id_chk_array[$val['PROCESS_ID']]=="")
        {
            $fab_dyeing_process_array[$po_wise_job_arr[$val['PO_ID']]] .= ($fab_dyeing_process_array[$po_wise_job_arr[$val['PO_ID']]]=="") ? $conversion_cost_head_array[$val['PROCESS_ID']] : ", ".$conversion_cost_head_array[$val['PROCESS_ID']];
            $process_id_chk_array[$val['PROCESS_ID']] = $val['PROCESS_ID'];
        }
    }

    // echo "<Pre>";print_r($fab_dyeing_process_array);die();

    /*===============================================================================/
    /                                  Finish Fabric Issue                           /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"c.po_breakdown_id");
    $sql = "SELECT c.po_breakdown_id as po_id,c.quantity from inv_issue_master a, inv_finish_fabric_issue_dtls b, order_wise_pro_details c where a.id=b.mst_id and b.id=c.dtls_id and a.status_active=1 and b.status_active=1 and c.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and c.entry_form=71 and trans_type=2 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $fin_fab_data_array = array();
    foreach ($res as $val) 
    {
        $fin_fab_data_array[$po_wise_job_arr[$val['PO_ID']]]['qty'] += $val['QUANTITY'];
    }

    /*===============================================================================/
    /                                   Cut & Lay data                               /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.order_id");
    $sql = "SELECT b.entry_date, a.order_id, a.bundle_no,a.size_qty from ppl_cut_lay_bundle a,ppl_cut_lay_mst b where b.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $po_cond";
    // echo $sql;die;
    $res = sql_select($sql);
    $lay_data_array = array();
    foreach ($res as $val) 
    {
        $lay_data_array[$po_wise_job_arr[$val['ORDER_ID']]]['entry_date'] .= $val['ENTRY_DATE'].",";
        $lay_data_array[$po_wise_job_arr[$val['ORDER_ID']]]['qty'] += $val['SIZE_QTY'];
        $lay_data_array[$po_wise_job_arr[$val['ORDER_ID']]]['no_of_bndl']++;
    }

    /*===============================================================================/
    /                              Printing & Emb QC Data                            /
    /============================================================================== */
    // 254=print, 325=emb
    $po_cond = where_con_using_array($po_array,0,"c.buyer_po_id");
    $sql = "SELECT a.product_date,a.entry_form, c.buyer_po_id,b.qcpass_qty from subcon_embel_production_mst a,subcon_embel_production_dtls b,subcon_ord_dtls c where a.id=b.mst_id and c.id=b.po_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form in(223,324) $po_cond";
    // echo $sql;die;
    $res = sql_select($sql);
    $emb_qc_data_array = array();
    foreach ($res as $val) 
    {
        $emb_qc_data_array[$po_wise_job_arr[$val['BUYER_PO_ID']]][$val['ENTRY_FORM']]['product_date'] .= $val['PRODUCT_DATE'].",";
        $emb_qc_data_array[$po_wise_job_arr[$val['BUYER_PO_ID']]][$val['ENTRY_FORM']]['qty'] += $val['QCPASS_QTY'];
    }
    // echo "<pre>";print_r($emb_qc_data_array);echo "</pre>";die();

    /*===============================================================================/
    /                            Printing & Emb Delivery Data                        /
    /============================================================================== */
    // 254=print, 325=emb
    $po_cond = where_con_using_array($po_array,0,"c.buyer_po_id");
    $sql = "SELECT a.delivery_date,a.entry_form, b.buyer_po_id,b.delivery_qty from subcon_delivery_mst a,subcon_delivery_dtls b,subcon_ord_dtls c where a.id=b.mst_id and c.id=b.order_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form in(254,325)  $po_cond";
    // echo $sql;die;
    $res = sql_select($sql);
    $emb_delivery_data_array = array();
    foreach ($res as $val) 
    {
        $emb_delivery_data_array[$po_wise_job_arr[$val['BUYER_PO_ID']]][$val['ENTRY_FORM']]['delivery_date'] .= $val['DELIVERY_DATE'].",";
        $emb_delivery_data_array[$po_wise_job_arr[$val['BUYER_PO_ID']]][$val['ENTRY_FORM']]['qty'] += $val['DELIVERY_QTY'];
    }
    // echo "<pre>";print_r($emb_delivery_data_array);echo "</pre>";die();

    /*===============================================================================/
    /                                  Gmts Production                               /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_break_down_id");
    $sql = "SELECT a.production_source,a.serving_company, a.production_date,a.production_type,a.po_break_down_id as po_id,b.production_qnty,a.embel_name from pro_garments_production_mst a,pro_garments_production_dtls b,wo_po_color_size_breakdown c where a.id=b.mst_id and c.id=b.color_size_break_down_id and c.po_break_down_id=a.po_break_down_id and c.status_active=1 and c.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $po_cond order by a.production_date";
    // echo $sql;
    $res = sql_select($sql);
    $gmts_data_array = array();
    $embel_data_array = array();
    foreach ($res as $val) 
    {
        $gmts_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']]['date'] .= $val['PRODUCTION_DATE'].",";
        $gmts_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']]['qty'] += $val['PRODUCTION_QNTY'];

        $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['date'] .= $val['PRODUCTION_DATE'].",";
        $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['source'] .= $val['PRODUCTION_SOURCE'].",";
        if($val['SERVING_COMPANY']==1)
        {
            $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['wo_com_id'] .= $company_library[$val['SERVING_COMPANY']].",";
        }
        else
        {
            $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['wo_com_id'] .= $supplier_library[$val['SERVING_COMPANY']].",";
        }
        $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['qty'] += $val['PRODUCTION_QNTY'];
    }
    // echo "<pre>";print_r($gmts_data_array);echo "</pre>";die();

    /*===============================================================================/
    /                            Printing & Emb Order Data                           /
    /============================================================================== */
    // 204=printing, 311=emb
    $po_cond = where_con_using_array($po_array,0,"b.buyer_po_id");
    $sql = "SELECT a.entry_form, b.buyer_po_id as po_id, b.order_quantity,b.order_uom from subcon_ord_mst a, subcon_ord_dtls b where a.id=b.mst_id and a.status_active=1 and b.status_active=1 and b.is_deleted=0 and a.is_deleted=0 and a.within_group=1 and a.entry_form in(204,311) $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $print_emb_order_data_array = array();
    foreach ($res as $val) 
    {
        if($val['ORDER_UOM']==2) // for dzn
        {
            $print_emb_order_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['ENTRY_FORM']]['qty'] += $val['ORDER_QUANTITY']*12;
        }
        else
        {
            $print_emb_order_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['ENTRY_FORM']]['qty'] += $val['ORDER_QUANTITY'];
        }
    }

    /*===============================================================================/
    /                                 Buyer Inspection                               /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_break_down_id");
    $sql = "SELECT a.job_no,a.inspection_qnty,to_char(a.inspection_date,'DD-MM-YYYY') as inspection_date from pro_buyer_inspection a where a.status_active=1 and a.is_deleted=0 $po_cond";
    $res = sql_select($sql);
    $buyer_insp_data = array();
    foreach ($res as $val) 
    {
        $buyer_insp_data[$val['JOB_NO']]['qty'] += $val['INSPECTION_QNTY'];
        $buyer_insp_data[$val['JOB_NO']]['date'] = $val['INSPECTION_DATE'];
    }

    /*===============================================================================/
    /                                  ex-factory data                               /
    /============================================================================== */
    $sql = "SELECT a.id,a.po_break_down_id as po_id,a.ex_factory_date,(case when a.entry_form !=85 then b.production_qnty else 0 end) as production_qnty,(case when a.entry_form =85 then b.production_qnty else 0 end) as return_qnty,a.total_carton_qnty from pro_ex_factory_mst a,pro_ex_factory_dtls b where a.id=b.mst_id and a.status_active=1 and b.status_active=1 and a.is_deleted=0 and b.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $ex_data_array = array();
    $id_chk_array = array();
    foreach ($res as $val) 
    {
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['ex_date'] .= $val['EX_FACTORY_DATE'].",";
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['ex_qty'] += $val['PRODUCTION_QNTY']-$val['RETURN_QNTY'];
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['rtn_qty'] += $val['RETURN_QNTY'];
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['ex_value'] += (($val['PRODUCTION_QNTY']-$val['RETURN_QNTY'])*$po_wise_unit_price_array[$val['PO_ID']]);
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['ex_rtn_value'] += ($val['RETURN_QNTY']*$po_wise_unit_price_array[$val['PO_ID']]);
        if(!in_array($val['ID'], $id_chk_array))
        {
            $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['cartot_qnty'] += $val['TOTAL_CARTON_QNTY'];
            $id_chk_array[$val['ID']] = $val['ID'];
        }
    }
    // echo "<pre>";print_r($ex_data_array);die();
    /*===============================================================================/
    /                                 Export Invoice                                 /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"b.po_breakdown_id");
    $sql = "SELECT b.po_breakdown_id as po_id,b.current_invoice_qnty,b.current_invoice_value,a.invoice_no,a.net_invo_value,a.discount_ammount from com_export_invoice_ship_mst a, com_export_invoice_ship_dtls b where a.id=b.mst_id and a.status_active=1 and b.status_active=1 and a.is_deleted=0 and b.is_deleted=0 $po_cond";
    $res = sql_select($sql);
    $invice_data = array();
    $chk_inv = array();
    foreach ($res as $val) 
    {
        $invice_data[$po_wise_job_arr[$val['PO_ID']]]['inv_qty']+=$val['CURRENT_INVOICE_QNTY'];
        $invice_data[$po_wise_job_arr[$val['PO_ID']]]['inv_value']+=$val['CURRENT_INVOICE_VALUE'];
        if($chk_inv[$val['INVOICE_NO']]=="")
        {
            $invice_data[$po_wise_job_arr[$val['PO_ID']]]['net_inv_value']+=$val['NET_INVO_VALUE'];
            $invice_data[$po_wise_job_arr[$val['PO_ID']]]['discount_ammount']+=$val['DISCOUNT_AMMOUNT'];
            $chk_inv[$val['INVOICE_NO']] = $val['INVOICE_NO'];
        }
    }

    /*===============================================================================/
    /                                      LC/SC data                                /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"b.wo_po_break_down_id");
    $sql = "SELECT b.wo_po_break_down_id as po_id,a.lien_bank,a.pay_term,a.internal_file_no,a.tenor,max(c.amendment_no) as amendment_no from com_export_lc a,com_export_lc_order_info b, com_export_lc_amendment c where a.id=b.com_export_lc_id AND a.export_lc_no = c.export_lc_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $po_cond group by b.wo_po_break_down_id,a.lien_bank,a.pay_term,a.internal_file_no,a.tenor
    UNION ALL
    SELECT b.wo_po_break_down_id as po_id,a.lien_bank,a.pay_term,a.internal_file_no,a.tenor,max(c.amendment_no) as amendment_no from com_sales_contract a,com_sales_contract_order_info b,com_sales_contract_amendment c where a.id=b.com_sales_contract_id and a.contract_no=c.contract_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $po_cond group by b.wo_po_break_down_id,a.lien_bank,a.pay_term,a.internal_file_no,a.tenor
    ";
    // echo $sql;die();
    $res = sql_select($sql);
    $lc_sc_data_array = array();
    foreach ($res as $val) 
    {
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['lien_bank'] .= $bank_library[$val['LIEN_BANK']].",";
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['pay_term'] .= $pay_term[$val['PAY_TERM']].",";
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['internal_file_no'] .= $val['INTERNAL_FILE_NO'].",";
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['tenor'] .= $val['TENOR'].",";
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['amendment_no'] .= $val['AMENDMENT_NO'].",";
    }
    // echo "<pre>";print_r($lc_sc_data_array);die();

    /*===============================================================================/
    /                                      TNA Data                                  /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_number_id");
    $sql = "SELECT a.po_number_id,a.task_number,max(a.task_start_date) as start_date,max(a.task_finish_date) as end_date,max(a.actual_start_date) as actual_start_date,max(a.actual_finish_date) as actual_finish_date,b.job_no_mst from tna_process_mst a,wo_po_break_down b where a.po_number_id=b.id and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and a.task_start_date is not null and b.po_quantity>0 $po_cond and a.task_type=1 group by a.po_number_id,a.task_number,b.job_no_mst";
    // echo $sql;die();
    $res = sql_select($sql);
    $tnaDateArray = array();
    foreach ($res as $val) 
    {
        $tnaDateArray[$val['JOB_NO_MST']][$val['TASK_NUMBER']]['start_date']          = $val['START_DATE'];
        $tnaDateArray[$val['JOB_NO_MST']][$val['TASK_NUMBER']]['end_date']            = $val['END_DATE'];
        $tnaDateArray[$val['JOB_NO_MST']][$val['TASK_NUMBER']]['actual_start_date']   = $val['ACTUAL_START_DATE'];
        $tnaDateArray[$val['JOB_NO_MST']][$val['TASK_NUMBER']]['actual_finish_date']  = $val['ACTUAL_FINISH_DATE'];
    }

    // echo "<pre>";print_r($tnaDateArray);die();
    /*===============================================================================/
    /                                    Budget Data                                 /
    /============================================================================== */
    $job_id_cond = where_con_using_array($job_id_array,0,"a.job_id");
    $sql = "SELECT a.job_no,to_char(a.costing_date,'DD-MM-YYYY') as costing_date,a.approved,b.cm_cost from wo_pre_cost_mst a,wo_pre_cost_dtls b where a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.job_id=b.job_id $job_id_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $budget_data_array = array();
    foreach ($res as $val) 
    {
        $budget_data_array[$val['JOB_NO']]['costing_date'] = $val['COSTING_DATE'];
        $budget_data_array[$val['JOB_NO']]['approved'] = $val['APPROVED'];
        $budget_data_array[$val['JOB_NO']]['cm_cost'] = $val['CM_COST'];
    }

    /*===============================================================================/
    /                              Getting data from class                           /
    /============================================================================== */
    $poIDS = implode(",", $po_array);
    $condition= new condition();     
    $condition->po_id_in($poIDS);     
    $condition->init();
    // $fabric= new fabric($condition);
    $yarn= new yarn($condition);
    $yarn_costing_arr=$yarn->getJobWiseYarnAmountArray();
    $yarn_qty_amount_arr=$yarn->getJobWiseYarnQtyAndAmountArray();

    $yarnDataWithFabricidArr=$yarn->get_By_Precostfabricdtlsid_YarnQtyAmountArray();

    $fabric= new fabric($condition);
    $fabricAmoutByFabricSource= $fabric->getAmountArray_by_job_knitAndwoven_greyAndfinish();
    $fabricQtyByFabricSource= $fabric->getQtyArray_by_job_knitAndwoven_greyAndfinish_purchase();
    
    $fabric_qty_arr=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
    $fabric_amount_arr=$fabric->getAmountArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
    $conversion= new conversion($condition);
    $conversion_costing_arr_process=$conversion->getAmountArray_by_job();
    $conv_qty_job_process= $conversion->getQtyArray_by_jobAndProcess();
    $conv_amount_job_process= $conversion->getAmountArray_by_jobAndProcess();
    $con_qty_fabric_process = $conversion->getQtyArray_by_fabricAndProcess();
    $con_amount_fabric_process = $conversion->getAmountArray_by_fabricAndProcess();

    $trims= new trims($condition);
    $trims_costing_arr=$trims->getAmountArray_by_job();
    $trims_qty_arr=$trims->getQtyArray_by_job();

    $emblishment= new emblishment($condition);
    $emblishment_costing_arr=$emblishment->getAmountArray_by_job();
    $emb_qty_job_name_arr = $emblishment->getQtyArray_by_jobAndEmbname();
    $emb_amount_job_name_arr = $emblishment->getAmountArray_by_jobAndEmbname();
    // echo "<pre>";print_r($emb_qty_job_name_arr);die();

    $wash= new wash($condition);
    $emblishment_costing_arr_wash=$wash->getAmountArray_by_job();
    $wash_qty_job_name_arr =$wash->getQtyArray_by_jobAndEmbname();
    $wash_amount_job_name_arr =$wash->getAmountArray_by_jobAndEmbname();


    $commercial= new commercial($condition);
    $commercial_costing_arr=$commercial->getAmountArray_by_job();
    $commission= new commision($condition);
    $commission_costing_arr=$commission->getAmountArray_by_job();
    $other= new other($condition);
    $other_costing_arr=$other->getAmountArray_by_job();


    /*===============================================================================/
    /                        Functin for getting max min date                        /
    /============================================================================== */
    function get_max_min_date($date_arr)
    {
        $date_array = array();
        if(count($date_arr)>0)
        {
            if(count($date_arr)==1)
            {
                $date_arr = explode(",", implode(",", $date_arr));
                $date_array['max_date'] = $date_arr[0];
                $date_array['min_date'] = $date_arr[0];
                return $date_array;
            }
            else
            {       
                $date_arr = explode(",", implode(",", $date_arr));         
                for ($i = 0; $i < count($date_arr); $i++)
                {
                    if ($i == 0)
                    {
                        $max_date = date('d-m-Y', strtotime($date_arr[$i]));
                        $min_date = date('d-m-Y', strtotime($date_arr[$i]));
                        $date_array['max_date'] = $max_date;
                        $date_array['min_date'] = $min_date;
                    }
                    elseif ($i != 0)
                    {
                        $new_date = date('d-m-Y', strtotime($date_arr[$i]));
                        if ($new_date > $max_date)
                        {
                            $max_date = $new_date;
                            $date_array['max_date'] = $max_date;
                        }
                        elseif ($new_date < $min_date)
                        {
                            $min_date = $new_date;
                            $date_array['min_date'] = $min_date;
                        }
                    }
                }
                return $date_array;
            }
        }
        else
        {
            return $date_array;
        }
    }

    

    ob_start();
    if($type==1) // show button
    {
        $tbl_width = 25470;
        ?>
        <fieldset>
            <div class="title-part" style="margin: 0 auto;text-align: center;font-size: 20px;">
                <h2>Order Tracking Report</h2>
                <h2>Company : <?=$company_library[$company_name]; ?></h2>
                <? if($date_from!=""){?>
                <h2>Date : <?=change_date_format($date_from); ?>To<?=change_date_format($date_to); ?> </h2>
                <? } ?>
            </div>
            <style type="text/css">
                table thead tr td{
                    padding: 5px;text-align: center;font-weight: bold;font-size: 16px;
                }
                .zoom {
                padding: 0px;
                transition: transform .2s; 
                width: 30px;
                height: 30px;
                margin: 0 auto;
                z-index: 9999 !important;
                overflow: hidden !important;
                visibility: visible;
                position: relative;
                }

                .zoom:hover {
                transform: scale(4); 

                z-index: 9999 !important;
                overflow: hidden !important;
                visibility: visible;
                }
            </style>
            <div class="report-container-part">
                <!-- ================================= report header ================================== -->
                <table cellspacing="0" border="1" class="rpt_table"   rules="all" width="<?=$tbl_width;?>"  align="center" id="table_header_1">
                    <thead>
                        <tr>
                            <td style="background: #95DAC1;" colspan="86">Order Information</td>
                            <td style="background: #FACE7F;" colspan="5">Budget Information</td>
                            <td style="background: #5C7AEA;" colspan="14">Main Fabric Booking Information</td>
                            <td style="background: #F56FAD;" colspan="8">Purchase Fabric Booking Information</td>
                            <td style="background: #A2CDCD;" colspan="9">Short/EFR Fabric Booking Information</td>
                            <th width="80" rowspan="2"><p>Trims/Acc Status</p></th>
                            <td style="background: #F0D9FF;" colspan="6">Grey Yarn Status</td>
                            <td style="background: #B1E693;" colspan="8">Dyed Yarn Status (Business not ready)</td>
                            <td style="background: #63B4B8;" colspan="7">Yarn Dyed Production Status (Business not ready)</td>
                            <td style="background: #E05D5D;" colspan="13">Knitting Status</td>
                            <td style="background: #C8C6C6;" colspan="9">Grey Fabric Store Status</td>
                            <td style="background: #BFA2DB;" colspan="6">Dyeing Status</td>
                            <td style="background: #6B7AA1;" colspan="12">Dyeing Finishing Status</td>
                            <td style="background: #C1CFC0;" colspan="10">Finish Fabric Store Status</td>
                            <td style="background: #8FC1D4;" colspan="23">Cutting Status</td>
                            <td style="background: #FFF5B7;" colspan="7">Print Status</td>
                            <td style="background: #FF449F;" colspan="7">Embroidery Status</td>
                            <td style="background: #EBA83A;" colspan="9">Sewing Status</td>
                            <td style="background: #B5FFD9;" colspan="9">Garments Finishing Status</td>
                            <td style="background: #E798AE;" colspan="20">Shipment Status</td>
                            <td style="background: #867AE9;" colspan="25">Budget VS Actual</td>
                            <td style="background: #C449C2;" colspan="25">Order Activities/TNA</td>
                        </tr>
                        <tr>
                            <th width="30"><p>Sl.</p></th>
                            <th width="60"><p>Order Status</p></th>
                            <th width="100"><p>LC Company</p></th>
                            <th width="80"><p>Image</p></th>
                            <th width="100"><p>Buyer</p></th>
                            <th width="50"><p>Year</p></th>
                            <th width="90"><p>Job</p></th>
                            <th width="80"><p>Repeat Job No</p></th>
                            <th width="80"><p>Sample Req. No</p></th>
                            <th width="80"><p>Style Ref</p></th>
                            <th width="80"><p>Style Desc</p></th>
                            <th width="80"><p>Gmts Item</p></th>
                            <th width="80"><p>Season</p></th>
                            <th width="80"><p>Prod Dept</p></th>
                            <th width="80"><p>Prod. Dept Code / Class</p></th>
                            <th width="80"><p>Sub Dept</p></th>
                            <th width="80"><p>Brand</p></th>
                            <th width="80"><p>Prod. Catg</p></th>
                            <th width="80"><p>Country</p></th>
                            <th width="80"><p>Sustainability Standard</p></th>
                            <th width="80"><p>Fabric Material</p></th>
                            <th width="80"><p>Order Nature</p></th>
                            <th width="80"><p>Quality Label</p></th>
                            <th width="80"><p>Embilshement Name</p></th>
                            <th width="80"><p>Service Name</p></th>
                            <th width="80"><p>Order/PO No</p></th>
                            <th width="80"><p>Actual Order/PO No</p></th>
                            <th width="80"><p>GMT Color</p></th>
                            <th width="80"><p>Size</p></th>
                            <th width="80"><p>Ex Cut %</p></th>
                            <th width="80"><p>Order Qnty [Pcs]</p></th>
                            <th width="80"><p>Break Down Order Qnty [Pcs]</p></th>
                            <th width="80"><p>Order Qnty with Cut% [Pcs]</p></th>
                            <th width="80"><p>Order Qnty [Uom]</p></th>
                            <th width="80"><p>Uom</p></th>
                            <th width="80"><p>Per Unit Price</p></th>
                            <th width="80"><p>Order Value</p></th>
                            <th width="80"><p>PO Insert Date</p></th>
                            <th width="80"><p>PO Receive Date</p></th>
                            <th width="80"><p>Fabric Budget Start Date</p></th>
                            <th width="80"><p>1st Cut Date</p></th>
                            <th width="80"><p>Last Cut Date</p></th>
                            <th width="80"><p>1st Sew Date</p></th>
                            <th width="80"><p>Last Sew Date</p></th>
                            <th width="80"><p>1st Finish Date</p></th>
                            <th width="80"><p>Last Finish Date</p></th>
                            <th width="80"><p>Insp. Offer Date</p></th>
                            <th width="80"><p>Insp. Date</p></th>
                            <th width="80"><p>Pub. Shipment Date</p></th>
                            <th width="80"><p>First Shipment Date </p></th>
                            <th width="80"><p>Org. Shipment Date </p></th>
                            <th width="80"><p>ETD/LDD Date</p></th>
                            <th width="80"><p>Cut-off Date</p></th>
                            <th width="80"><p>Country Shipment Date</p></th>
                            <th width="80"><p>RFI Plan Date</p></th>
                            <th width="80"><p>Shipment Mode</p></th>
                            <th width="80"><p>Lead Time</p></th>
                            <th width="80"><p>Days in Hand</p></th>
                            <th width="80"><p>Commercial File No</p></th>
                            <th width="80"><p>Lien Bank</p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p>Ex. LC/SC Amendment No(Last)</p></th>
                            <th width="80"><p>Pay Term</p></th>
                            <th width="80"><p>Tenor</p></th>
                            <th width="80"><p>First Shipment Date</p></th>
                            <th width="80"><p>Last Shipment Date</p></th>
                            <th width="80"><p>Shipment Qnty</p></th>
                            <th width="80"><p>Shipment Value</p></th>
                            <th width="80"><p>Excess Shipment Qnty</p></th>
                            <th width="80"><p>Excess Shipment Value</p></th>
                            <th width="80"><p>Short Shipment Qnty</p></th>
                            <th width="80"><p>Short Shipment Value</p></th>
                            <th width="80"><p>Shipping Status</p></th>
                            <th width="80"><p>SMV</p></th>
                            <th width="80"><p>Total SMV</p></th>
                            <th width="80"><p>CM</p></th>
                            <th width="80"><p>Team Leader</p></th>
                            <th width="80"><p>Dealing Merchandiser</p></th>
                            <th width="80"><p>Factory Merchandiser</p></th>
                            <th width="80"><p>Insert User</p></th>
                            <th width="80"><p>Lab Dip No</p></th>
                            <th width="80"><p>Buyer Sample Status</p></th>
                            <th width="80"><p>Order Status</p></th>
                            <th width="80"><p>Referance Closed </p></th>
                            <th width="80"><p>Emb. Work Order No</p></th>
                            <th width="80"><p>Service Work Order No</p></th>

                            <th width="80"><p>Budget Date</p></th>
                            <th width="80"><p>Budget Value</p></th>
                            <th width="80"><p>Open Value</p></th>
                            <th width="80"><p>Approved</p></th>
                            <th width="80"><p>Amendment No</p></th>
                            
                            <th width="80"><p>M Fabric Booking Date</p></th>
                            <th width="80"><p>M Fabric Booking No</p></th>
                            <th width="80"><p>Fabric Delivery Date</p></th>
                            <th width="80"><p>Amendment No</p></th>
                            <th width="80"><p>Amendment Date</p></th>
                            <th width="80"><p>Approved Status</p></th>
                            <th width="80"><p>Yarn Description</p></th>
                            <th width="80"><p>Fabric Construction</p></th>
                            <th width="80"><p>Fabric Composition</p></th>
                            <th width="80"><p>GSM</p></th>
                            <th width="80"><p>Dia/Width</p></th>
                            <th width="80"><p>Grey Qnty Kg</p></th>
                            <th width="80"><p>Finish Quantity</p></th>
                            <th width="80"><p>Process Loss%</p></th>

                            <th width="80"><p>Fabric Booking Date</p></th>
                            <th width="80"><p>Fabric Booking No</p></th>
                            <th width="80"><p>Fabric Delivery Date</p></th>
                            <th width="80"><p>Fabrication</p></th>
                            <th width="80"><p>Uom</p></th>
                            <th width="80"><p>Qnty</p></th>
                            <th width="80"><p>Supplier</p></th>
                            <th width="80"><p>Approved Status</p></th>

                            <th width="80"><p>Fabric Booking Date</p></th>
                            <th width="80"><p>Fabric Booking No</p></th>
                            <th width="80"><p>Fabric Delivery Date</p></th>
                            <th width="80"><p>Fabrication</p></th>
                            <th width="80"><p>Uom</p></th>
                            <th width="80"><p>Grey Qnty</p></th>
                            <th width="80"><p>Finish Quantity</p></th>
                            <th width="80"><p>Process Loss%</p></th>
                            <th width="80"><p>Approved Status</p></th>

                            <th width="80"><p>Grey Yarn Require with Short/EFR Qnty</p></th>
                            <th width="80"><p>Yarn Allocation Qnty</p></th>
                            <th width="80"><p>Yarn Excess Allocation Qnty</p></th>
                            <th width="80"><p>Yarn Issued Qnty</p></th>
                            <th width="80"><p>Yarn Issue Balance Qnty</p></th>
                            <th width="80"><p>Yarn Excess Issued Qty </p></th>

                            <th width="80"><p>Dyed Yarn Require with Short/EFR Qnty</p></th>
                            <th width="80"><p>Dyed Yarn Allocation Qnty</p></th>
                            <th width="80"><p>Dyed Yarn Excess Allocation Qnty</p></th>
                            <th width="80"><p>Dyed Yarn Received Qnty</p></th>
                            <th width="80"><p>Dyed Yarn Receive Balance Qnty</p></th>
                            <th width="80"><p>Dyed Yarn Issued Qnty</p></th>
                            <th width="80"><p>Dyed Yarn Issue Balance Qnty</p></th>
                            <th width="80"><p>Dyed Yarn Excess Issued Qty </p></th>

                            <th width="80"><p>Dyed Yarn Require with Short/EFR Qnty</p></th>
                            <th width="80"><p>Service Work Order Qty</p></th>
                            <th width="80"><p>Yarn Dyed Produciton Qty</p></th>
                            <th width="80"><p>Yarn Dyed Produciton WIP Qty</p></th>
                            <th width="80"><p>Yarn Dyed Delivery Qty</p></th>
                            <th width="80"><p>Yarn Dyed Challan No</p></th>
                            <th width="80"><p>Yarn Dyed Challan Date</p></th>

                            <th width="80"><p>Knitting Require with EFR Qnty</p></th>
                            <th width="80"><p>Knitting Plan Qnty</p></th>
                            <th width="80"><p>Knitting Plan WIP Qnty</p></th>
                            <th width="80"><p>Knitting Work Order No</p></th>
                            <th width="80"><p>Knitting Production Qnty [Inbound]</p></th>
                            <th width="80"><p>Knitting Production Qnty [Outbound]</p></th>
                            <th width="80"><p>TTL Knitting Production Qnty </p></th>
                            <th width="80"><p>TTL Knitting Excess Production Qnty</p></th>
                            <th width="80"><p>TTL Knitting Production WIP Qnty</p></th>
                            <th width="80"><p>Price/KG [TK]</p></th>
                            <th width="80"><p>Total Price [TK]</p></th>
                            <th width="80"><p>Knitting Grey Fabric Delivery Qnty To Store</p></th>
                            <th width="80"><p>Closing Status</p></th>

                            <th width="80"><p>Require with Short/EFR Qnty</p></th>
                            <th width="80"><p>Normal Received Qnty</p></th>
                            <th width="80"><p>Receive Balance Qnty</p></th>
                            <th width="80"><p>Transfer Received Qnty</p></th>
                            <th width="80"><p>TTL Fabric Received Qnty</p></th>
                            <th width="80"><p>Normal Issued Qnty</p></th>
                            <th width="80"><p>Trasfered Issued Qnty</p></th>
                            <th width="80"><p>TTL Fabric Issued Qnty</p></th>
                            <th width="80"><p>Stock In Hand</p></th>

                            <th width="80"><p>Require with Short/EFR Qnty</p></th>
                            <th width="80"><p>Fabric Received by Batch </p></th>
                            <th width="80"><p>Batch Qnty</p></th>
                            <th width="80"><p>Production Qnty</p></th>
                            <th width="80"><p>Production Excess Qnty</p></th>
                            <th width="80"><p>Production WIP Qnty</p></th>

                            <th width="80"><p>Require with Short/EFR Qnty</p></th>
                            <th width="80"><p>Production Qnty</p></th>
                            <th width="80"><p>Production Excess Qnty</p></th>
                            <th width="80"><p>Production WIP Qnty</p></th>
                            <th width="80"><p>Process Name</p></th>
                            <th width="80"><p>QC Received Qnty</p></th>
                            <th width="80"><p>AOP Issue Qnty</p></th>
                            <th width="80"><p>AOP Receive Qnty</p></th>
                            <th width="80"><p>AOP Receive WIP Qnty</p></th>
                            <th width="80"><p>QC Delivery Qnty To Store</p></th>
                            <th width="80"><p>QC Stock in Hand</p></th>
                            <th width="80"><p>Closing Status</p></th>

                            <th width="80"><p>Require with Short/EFR Qnty</p></th>
                            <th width="80"><p>Received Qnty</p></th>
                            <th width="80"><p>Receive Excess Qnty</p></th>
                            <th width="80"><p>Receive Balance Qnty</p></th>
                            <th width="80"><p>Transfer Received Qnty</p></th>
                            <th width="80"><p>TTL Received Qnty</p></th>
                            <th width="80"><p>Normal Issued Qnty</p></th>
                            <th width="80"><p>Trasfered Issued Qnty</p></th>
                            <th width="80"><p>TTL Issued Qnty</p></th>
                            <th width="80"><p>Stock In Hand</p></th>

                            <th width="80"><p>Require with Short/EFR Qnty</p></th>
                            <th width="80"><p>Fabric Receive Qnty By Cutting</p></th>
                            <th width="80"><p>Excess Receive Qnty By Cutting </p></th>
                            <th width="80"><p>Receive Balance Qnty By Cutting</p></th>
                            <th width="80"><p>Cutting Status</p></th>
                            <th width="80"><p>Oreder Qnty</p></th>
                            <th width="80"><p>Excess Cutting %</p></th>
                            <th width="80"><p>Order Qnty with Cut%</p></th>
                            <th width="80"><p>Cutting Bundle Qnty</p></th>
                            <th width="80"><p>Cutting Lay Qnty</p></th>
                            <th width="80"><p>Cutting Production [QC] Qnty</p></th>
                            <th width="80"><p>Excess Cutting Qnty</p></th>
                            <th width="80"><p>Cutting Production Balance Qnty</p></th>
                            <th width="80"><p>Input Qnty</p></th>
                            <th width="80"><p>Input WIP Qnty</p></th>
                            <th width="80"><p>Print Send Qnty</p></th>
                            <th width="80"><p>Print Receive Qnty</p></th>
                            <th width="80"><p>Print WIP Qnty</p></th>
                            <th width="80"><p>Print Supplier</p></th>
                            <th width="80"><p>EMB Send Qnty</p></th>
                            <th width="80"><p>EMB Receive Qnty</p></th>
                            <th width="80"><p>EMB WIP Balance Qnty</p></th>
                            <th width="80"><p>EMB Supplier</p></th>

                            <th width="80"><p>Require Qnty</p></th>
                            <th width="80"><p>Order Qnty</p></th>
                            <th width="80"><p>Order Balance Qnty</p></th>
                            <th width="80"><p>Production [QC] Qnty</p></th>
                            <th width="80"><p>Production Excess Qnty</p></th>
                            <th width="80"><p>Production WIP Qnty</p></th>
                            <th width="80"><p>Delivery Qnty To Cutting</p></th>

                            <th width="80"><p>Require Qnty</p></th>
                            <th width="80"><p>Work Order Qnty</p></th>
                            <th width="80"><p>Work Order Balance Qnty</p></th>
                            <th width="80"><p>Production [QC] Qnty</p></th>
                            <th width="80"><p>Production Excess Qnty</p></th>
                            <th width="80"><p>Production WIP Qnty</p></th>
                            <th width="80"><p>Delivery Qnty To Cutting</p></th>

                            <th width="80"><p>Order Qnty</p></th>
                            <th width="80"><p>Require Cut% Qnty</p></th>
                            <th width="80"><p>Input Qnty</p></th>
                            <th width="80"><p>Input Excess Qnty</p></th>
                            <th width="80"><p>Input Balance Qnty</p></th>
                            <th width="80"><p>Production [Output] Qnty</p></th>
                            <th width="80"><p>Production Excess Qnty</p></th>
                            <th width="80"><p>Balance Qty</p></th>
                            <th width="80"><p>Production WIP Qnty</p></th>

                            <th width="80"><p>Require Qnty</p></th>
                            <th width="80"><p>Iron Qnty</p></th>
                            <th width="80"><p>Hangtag Qnty</p></th>
                            <th width="80"><p>Poly Qnty</p></th>
                            <th width="80"><p>Finish Quantity</p></th>
                            <th width="80"><p>Balance Qty</p></th>
                            <th width="80"><p>Inspection Offer Date</p></th>
                            <th width="80"><p>Inspection Date</p></th>
                            <th width="80"><p>Inspection Qnty</p></th>

                            <th width="80"><p>Carton Qty</p></th>
                            <th width="80"><p>Shipment Qnty</p></th>
                            <th width="80"><p>Invoice Qty</p></th>
                            <th width="80"><p>Shipment Value</p></th>
                            <th width="80"><p>Invoice Value</p></th>
                            <th width="80"><p>Net Invoice Value</p></th>
                            <th width="80"><p>Excess Shipment Qnty</p></th>
                            <th width="80"><p>Excess Shipment Value </p></th>
                            <th width="80"><p>Short Shipment Qnty</p></th>
                            <th width="80"><p>Short Shipment Value</p></th>
                            <th width="80"><p>Shipment Return Qnty</p></th>
                            <th width="80"><p>Shipment Return Value</p></th>
                            <th width="80"><p>First Shipment Date</p></th>
                            <th width="80"><p>Last Shipment Date</p></th>
                            <th width="80"><p>Discount / Penalty / Claim Amount</p></th>
                            <th width="80"><p>Reason of Discount / Penalty / Claim </p></th>
                            <th width="80"><p>Order to Ship Qty </p></th>
                            <th width="80"><p>Order to Ship % </p></th>
                            <th width="80"><p>Cut to Ship Qty </p></th>
                            <th width="80"><p>Cut to Ship % </p></th>

                            <th width="80"><p>Budget Date</p></th>
                            <th width="80"><p>Budget Yarn Cost</p></th>
                            <th width="80"><p>Actual Yarn Cost</p></th>
                            <th width="80"><p>Budget Finish YD Cost</p></th>
                            <th width="80"><p>Actual Finish YD Cost</p></th>
                            <th width="80"><p>Budget Knitting Cost</p></th>
                            <th width="80"><p>Actual Knitting Cost</p></th>
                            <th width="80"><p>Budget Dyeing & Finishing Cost</p></th>
                            <th width="80"><p>Actual Dyeing & Finishing Cost</p></th>
                            <th width="80"><p>Budget Fabric Purchase Cost</p></th>
                            <th width="80"><p>Actual Fabric Purchase Cost</p></th>
                            <th width="80"><p>Budget AOP Cost</p></th>
                            <th width="80"><p>Actual AOP Cost</p></th>
                            <th width="80"><p>Budget Print Cost</p></th>
                            <th width="80"><p>Actual Print Cost</p></th>
                            <th width="80"><p>Budget Emb Cost</p></th>
                            <th width="80"><p>Actual Emb Cost</p></th>
                            <th width="80"><p>Budget Wash Cost</p></th>
                            <th width="80"><p>Actual Wash Cost</p></th>
                            <th width="80"><p>Budget Trims Cost</p></th>
                            <th width="80"><p>Actual Trims Cost</p></th>
                            <th width="80"><p>Budget MISC Cost</p></th>
                            <th width="80"><p>Actual MISC Cost</p></th>
                            <th width="80"><p>Budget CM</p></th>
                            <th width="80"><p>Actual CM</p></th>

                            <th width="80"><p>Lead Time [Templete]</p></th>
                            <th width="80"><p>Yarn Receive Start</p></th>
                            <th width="80"><p>Yarn Receive End</p></th>
                            <th width="80"><p>Knitting Start</p></th>
                            <th width="80"><p>Knitting End</p></th>
                            <th width="80"><p>Dyeing Start</p></th>
                            <th width="80"><p>Dyeing End</p></th>
                            <th width="80"><p>Finish Fabric Prod. Start</p></th>
                            <th width="80"><p>Finish Fabric Prod. End</p></th>
                            <th width="80"><p>Trims Receive Start</p></th>
                            <th width="80"><p>Trims Receive End</p></th>
                            <th width="80"><p>Cutting Start</p></th>
                            <th width="80"><p>Cutting End</p></th>
                            <th width="80"><p>Print Start</p></th>
                            <th width="80"><p>Print End</p></th>
                            <th width="80"><p>Emb Start</p></th>
                            <th width="80"><p>Emb End</p></th>
                            <th width="80"><p>Sewing Start</p></th>
                            <th width="80"><p>Sewing End</p></th>
                            <th width="80"><p>GMT Finihsing Start</p></th>
                            <th width="80"><p>GMT Finihsing End</p></th>
                            <th width="80"><p>Inspection Start</p></th>
                            <th width="80"><p>Inspection End</p></th>
                            <th width="80"><p>Shipment  Start</p></th>
                            <th width="80"><p>Shipment  End</p></th>
                        </tr>
                    </thead>
                </table>
                <!-- =================================== report body ==================================== -->
                <div style=" max-height:300px; width:<?=$tbl_width+20;?>px; overflow-y:scroll;" id="scroll_body">
                    <table cellspacing="0" border="1" class="rpt_table"   rules="all" width="<?=$tbl_width;?>"  align="center" id="table_body">
                        <tbody>
                            <?
                            $i=1;
                            $gr_job_total = 0;
                            $gr_po_total = 0;
                            $gr_color_size_total = 0;
                            $gr_plan_cut_total = 0;
                            $gr_order_value_total = 0;

                            foreach ($data_array as $job_key => $row) 
                            {   
                                $bgcolor=($i%2==0)?"#E9F3FF":"#FFFFFF";   
                                $ship_excess_qty = max($ex_data_array[$job_key]['ex_qty'] - $row['order_quantity'],0);
                                $ship_excess_val = max($ex_data_array[$job_key]['ex_value'] - $row['order_value'],0); 
                                $ship_short_qty = max($row['order_quantity'] - $ex_data_array[$job_key]['ex_qty'],0);
                                $ship_short_val = max($row['order_value'] - $ex_data_array[$job_key]['ex_value'],0);

                                // =============================== for budget data ===========================
                                $finishing_arr = array('209','165','33','94','63','171','65','170','156','179','200','208','127','125','84','68','128','190','242','240','192','172','90','218','67','197','73','66','185','142');
                                $total_finishing_amount=0;
                                $total_finishing_qty=0;
                                $other_cost_attr = array('inspection','freight','certificate_pre_cost','deffdlc_cost','design_cost','studio_cost','common_oh','interest_cost','incometax_cost','depr_amor_pre_cost');
                                $total_other_cost = 0;
                                foreach ($other_cost_attr as $attr) {
                                    $total_other_cost+=$other_costing_arr[$job_key][$attr];
                                }
                                $misc_cost=$other_costing_arr[$job_key]['lab_test']+$commercial_costing_arr[$job_key]+$commission_costing_arr[$job_key]+$total_other_cost;

                                foreach ($finishing_arr as $fid) {
                                    $total_finishing_amount += array_sum($conv_amount_job_process[$job_key][$fid]);
                                    $total_finishing_qty += array_sum($conv_qty_job_process[$job_key][$fid]);
                                }

                                $total_fabic_cost=0;
                                if(count($conv_amount_job_process[$job_key][31])>0){
                                    $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][31])/array_sum($conv_qty_job_process[$job_key][31]);
                                }
                                $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][31]);
                                $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][31])/$order_values*100;
                                if(count($conv_amount_job_process[$job_key][30])>0){
                                    $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][30])/array_sum($conv_qty_job_process[$job_key][30]);
                                }
                                if($yarn_qty_amount_arr[$job_key]['amount']!=''){
                                    $total_fabic_cost+=$yarn_qty_amount_arr[$job_key]['amount']/$yarn_qty_amount_arr[$job_key]['qty'];
                                }
                                $total_fabric_amount +=$yarn_qty_amount_arr[$job_key]['amount']; 
                                $total_fabric_per +=$yarn_qty_amount_arr[$job_key]['amount']/$order_values*100;
                                if($total_finishing_amount!=0){
                                    $total_fabic_cost+=$total_finishing_amount/$total_finishing_qty;
                                } 
                                $total_fabric_amount +=$total_finishing_amount;
                                $total_fabric_per +=$total_finishing_amount/$order_values*100;
                                $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][30]);
                                $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][30])/$order_values*100;
                                if(count($conv_amount_job_process[$job_key][35])>0){
                                    $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][35])/array_sum($conv_qty_job_process[$job_key][35]);
                                }
                                $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][35]); 
                                $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][35])/$order_values*100;
                                if(count($conv_amount_job_process[$job_key][1])>0){
                                    $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][1])/array_sum($conv_qty_job_process[$job_key][1]);
                                }
                                $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][1]);
                                $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][1])/$order_values*100; 

                                $purchase_amount = array_sum($fabricAmoutByFabricSource['knit']['grey'][$job_key])+array_sum($fabricAmoutByFabricSource['woven']['grey'][$job_key]);
                                $purchase_qty = array_sum($fabricQtyByFabricSource['knit']['grey'][$job_key])+array_sum($fabricQtyByFabricSource['woven']['grey'][$job_key]);

                                $ather_emb_attr = array(4,5,6,99);
                                foreach ($ather_emb_attr as $att) {
                                    $others_emb_amount += $emb_amount_job_name_arr[$job_key][$att];
                                    $others_emb_qty += $emb_qty_job_name_arr[$job_key][$att];
                                }
                                $knitting_amount_summ=''; $dyeing_amount_summ=''; $yds_amount_summ=''; $aop_amount_summ='';
                                if(count($conv_amount_job_process[$job_key][1])>0) {
                                    $knitting_amount_summ = fn_number_format(array_sum($conv_amount_job_process[$job_key][1]),2);
                                }
                                $yarn_amount_summ = $yarn_qty_amount_arr[$job_key]['amount'];
                                $print_amount_summ = $emb_amount_job_name_arr[$job_key][1];      
                                $emb_amount_summ= $emb_amount_job_name_arr[$job_key][2];
                                $wash_amount_summ = $wash_amount_job_name_arr[$job_key][3];
                                if(count($conv_amount_job_process[$job_key][31])>0) {
                                    $dyeing_amount_summ=  array_sum($conv_amount_job_process[$job_key][31]);
                                }
                                if(count($conv_amount_job_process[$job_key][30])>0) {
                                    $yds_amount_summ = array_sum($conv_amount_job_process[$job_key][30]);
                                }
                                if(count($conv_amount_job_process[$job_key][35])>0) {
                                    $aop_amount_summ = array_sum($conv_amount_job_process[$job_key][35]);
                                }
                                
                                $total_budget_value = $yarn_amount_summ+$total_finishing_amount+$print_amount_summ+$trims_costing_arr[$job_key]+$yds_amount_summ+$aop_amount_summ+$emb_amount_summ+$knitting_amount_summ+$purchase_amount+$wash_amount_summ+$other_costing_arr[$job_key]['cm_cost']+$dyeing_amount_summ+$others_emb_amount+$misc_cost;
                                $open_value = $row['total_price']-$total_budget_value;

                                $cur_date = date('d-m-Y');
                                $currency_rate=set_conversion_rate( 2, $cur_date,$row['company_name']);
                                $price_kg_tk = ($conv_cost_arr[$job_key][1]['rate']*$currency_rate)/$conv_cost_arr[$job_key][1]['count'];
                                $total_price_kg_tk = ($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3])*$price_kg_tk;

                                $cutting_status = ($row['job_qty_pcs'] > $gmts_data_array[$job_key][1]['qty']) ? "Running" : "Close";
                                $excess_cut_qty = $gmts_data_array[$job_key][1]['qty'] - $row['job_qty_pcs'];
                                $excess_cut_prsnt = ($excess_cut_qty>0) ? ($excess_cut_qty/$row['job_qty_pcs'])*100 : 0;

                                $order_to_ship_qty = ($ex_data_array[$job_key]['ex_qty'] - $row['job_qty_pcs']);
                                $order_to_ship_prsnt = ($ex_data_array[$job_key]['ex_qty'] != $row['job_qty_pcs']) ? (($order_to_ship_qty/$row['job_qty_pcs'])*100) : 100;
                                $cut_to_ship_qty = ($ex_data_array[$job_key]['ex_qty'] - $lay_data_array[$job_key]['qty']);
                                // $cut_to_ship_prsnt = ($lay_data_array[$job_key]['qty']>0) ? (100 - ($cut_to_ship_qty/$lay_data_array[$job_key]['qty'])*100) : 0;
                                $cut_to_ship_prsnt = ($ex_data_array[$job_key]['ex_qty']>0) ? ($ex_data_array[$job_key]['ex_qty']/$lay_data_array[$job_key]['qty'])*100 : 0;
                                // echo "(".$ex_data_array[$job_key]['ex_qty']."/".$lay_data_array[$job_key]['qty'].")*100)<br>";

                                
                                $costingPer = $costing_per_arr[$job_key];            
                                if($costingPer==1) $pcs_value=1*12;
                                else if($costingPer==2) $pcs_value=1*1;
                                else if($costingPer==3) $pcs_value=2*12;
                                else if($costingPer==4) $pcs_value=3*12;
                                else if($costingPer==5) $pcs_value=4*12;
                                // echo $pcs_value;die;

                                ?>
                                <tr bgcolor="<? echo $bgcolor;?>" id="tr_<?= $i;?>" onClick="change_color('tr_<?= $i; ?>','<?= $bgcolor; ?>')">
                                    <td width="30"><p><?=$i;?></p></td>
                                    <td width="60">
                                        <p>
                                            <?
                                            $order_status_arr = array_unique(array_filter(explode(",", $row['order_status'])));
                                            $order_status_name = "";
                                            foreach ($order_status_arr as $val) 
                                            {
                                                $order_status_name .= ($order_status_name=="") ? $order_status[$val] : ", ".$order_status[$val];
                                            }
                                            echo $order_status_name;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="100"><p><?=$company_library[$row['company_name']];?></p></td>
                                    <td width="80"><img class="zoom" src='../../../<?= $imge_arr[$job_key]; ?>' height='40' width='50' /></td>
                                    <td width="100"><p><?=$buyer_library[$row['buyer_name']];?></p></td>
                                    <td width="50" align="center"><p><?=$row['year'];?></p></td>
                                    <td width="90"><p><?=$job_key;?></p></td>
                                    <td width="80"><p><?=$row['repeat_job_no'];?></p></td>
                                    <td width="80"><p><?=$row['req_no'];?></p></td>
                                    <td width="80"><p><?=$row['style'];?></p></td>
                                    <td width="80"><p><?=$row['style_des'];?></p></td>
                                    <td width="80">
                                        <p>
                                            <?
                                            $item_id_arr = array_unique(array_filter(explode(",", $row['item_id'])));
                                            $item_name = "";
                                            $item_smv = "";
                                            $tot_item_smv = 0;
                                            foreach ($item_id_arr as $val) 
                                            {
                                                $item_name .= ($item_name=="") ? $garments_item[$val] : ", ".$garments_item[$val];
                                                $item_smv .= ($item_smv=="") ? $garments_item[$val]." : ".$item_smv_array[$job_key][$val] : ", ".$garments_item[$val]." : ".$item_smv_array[$job_key][$val];
                                                $tot_item_smv += $item_smv_array[$job_key][$val];
                                            }
                                            echo $item_name;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80"><p><?=$season_library[$row['season']];?></p></td>
                                    <td width="80"><p><?=$product_dept[$row['product_dept']];?></p></td>
                                    <td width="80"><p><?=$row['product_code'];?></p></td>
                                    <td width="80"><p><?=$sub_dep_library[$row['pro_sub_dep']];?></p></td>
                                    <td width="80"><p><?=$brand_library[$row['brand_id']];?></p></td>
                                    <td width="80"><p><?=$product_category[$row['product_category']];?></p></td>
                                    <td width="80">
                                        <p>
                                            <?
                                            $country_id_arr = array_unique(array_filter(explode(",", $row['country_id'])));
                                            $country_name = "";
                                            foreach ($country_id_arr as $val) 
                                            {
                                                $country_name .= ($country_name=="") ? $country_library[$val] : ", ".$country_library[$val];
                                            }
                                            echo $country_name;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80"><p><?=$sustainability_standard[$row['sustainability_standard']];?></p></td>
                                    <td width="80"><p><?=$fab_material[$row['fab_material']];?></p></td>
                                    <td width="80"><p><?=$fbooking_order_nature[$row['quality_level']];?></p></td>
                                    <td width="80"><p><?=$quality_label[$row['qlty_label']];?></p></td>
                                    <td width="80"><p><?=$emb_name_arr[$job_key];?></p></td>
                                    <td width="80"><p><?=$conv_name_arr[$job_key];?></p></td>
                                    <td width="80">
                                        <p>
                                            <?
                                            $po_number_arr = array_unique(array_filter(explode(",", $row['po_number'])));
                                            $po_name = "";
                                            foreach ($po_number_arr as $val) 
                                            {
                                                $po_name .= ($po_name=="") ? $val : ", ".$val;
                                            }
                                            echo $po_name;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80"><p><?=$acc_po_array[$job_key]['acc_po'];?></p></td>
                                    <td width="80">
                                        <p>
                                            <?
                                            $color_arr = array_unique(array_filter(explode(",", $row['color_id'])));
                                            $color_name = "";
                                            foreach ($color_arr as $val) 
                                            {
                                                $color_name .= ($color_name=="") ? $color_library[$val] : ", ".$color_library[$val];
                                            }
                                            echo $color_name;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80">
                                        <p>
                                            <?
                                            $size_arr = array_unique(array_filter(explode(",", $row['size_id'])));
                                            $size_name = "";
                                            foreach ($size_arr as $val) 
                                            {
                                                $size_name .= ($size_name=="") ? $size_library[$val] : ", ".$size_library[$val];
                                            }
                                            echo $size_name;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80">
                                        <p>
                                            <?
                                            $excess_cut_arr = array_unique(array_filter(explode("**", $po_wise_data[$job_key]['excess_cut'])));
                                            $ex_cut = "";
                                            foreach ($excess_cut_arr as $val) 
                                            {
                                                $ex_cut .= ($ex_cut=="") ? "(".$val.")" : ",(".$val.")";
                                            }
                                            echo $ex_cut;
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80" align="right"><p><?=number_format($row['order_quantity'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($row['order_quantity'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($row['plan_cut_qnty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($row['po_quantity'],0);?></p></td>
                                    <td width="80" align="center"><p><?=$unit_of_measurement[$row['order_uom']];?></p></td>
                                    <td width="80" align="right"><p><?=$row['unit_price'];?></p></td>
                                    <td width="80" align="right"><p><?=number_format($row['order_value'],0);?></p></td>
                                    <td width="80" align="center"><p>&nbsp;<?=$row['po_insert_date'];?></p></td>
                                    <td width="80" align="center"><p>&nbsp;<?=$row['po_received_date'];?></p></td>
                                    <td width="80" align="center"><p>&nbsp;<?=$row['factory_received_date'];?></p></td>
                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            $lay_date_arr = array_unique(array_filter(explode(",", $lay_data_array[$job_key]['entry_date'])));
                                            $lay_date = get_max_min_date($lay_date_arr);
                                            echo ($lay_date['min_date']!="") ? change_date_format($lay_date['min_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            echo ($lay_date['max_date']!="") ? change_date_format($lay_date['max_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            $sew_out_date_arr = array_unique(array_filter(explode(",", $gmts_data_array[$job_key][5]['date'])));
                                            $sew_out_date = get_max_min_date($sew_out_date_arr);
                                            echo ($sew_out_date['min_date']!="") ? change_date_format($sew_out_date['min_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            echo ($sew_out_date['max_date']!="") ? change_date_format($sew_out_date['max_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            $gmt_fin_date_arr = array_unique(array_filter(explode(",", $gmts_data_array[$job_key][8]['date'])));
                                            $gmt_fin_date = get_max_min_date($gmt_fin_date_arr);
                                            echo ($gmt_fin_date['min_date']!="") ? change_date_format($gmt_fin_date['min_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            echo ($gmt_fin_date['max_date']!="") ? change_date_format($gmt_fin_date['max_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p>&nbsp;<?=$row['pub_shipment_date'];?></p></td>
                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            $ex_date_array = array_unique(array_filter(explode(",", $ex_data_array[$job_key]['ex_date'])));
                                            $ex_date = get_max_min_date($ex_date_array);
                                            // echo min($ex_date_array);
                                            echo ($ex_date['min_date']!="") ? change_date_format($ex_date['min_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80"><p>&nbsp;<?=$row['shipment_date'];?></p></td>
                                    <td width="80"><p><?=$row['txt_etd_ldd'];?></p></td>
                                    <td width="80"><p>&nbsp;<?=$cutup_date = implode(",", array_unique(array_filter(explode(",", $row['cutup_date']))));?></p></td>
                                    <td width="80"><p>&nbsp;<?=$coun_ship_date = implode(",", array_unique(array_filter(explode(",", $row['country_ship_date']))));?></p></td>
                                    <td width="80"><p>&nbsp;<?=$row['pub_shipment_date'];?></p></td>
                                    <td width="80"><p><?=$shipment_mode[$row['ship_mode']];?></p></td>
                                    <td width="80"><p><?=$row['lead_time'];?></p></td>
                                    <td width="80"><p><?=$row['days_in_hand'];?></p></td>
                                    <td width="80">
                                        <p>
                                            <?
                                            $com_file = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['internal_file_no']))));
                                            echo $com_file;
                                            ?>                                            
                                        </p>
                                    </td>                                
                                    <td width="80">
                                        <p>
                                            <?
                                            $lien_bank = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['lien_bank']))));
                                            echo $lien_bank;
                                            ?>                                            
                                        </p>
                                    </td>
                                    <td width="80"><p><?=$a;?></p></td>                                
                                    <td width="80">
                                        <p>
                                            <?
                                            $amendment_no = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['amendment_no']))));
                                            echo $amendment_no;
                                            ?>                                            
                                        </p>
                                    </td>                               
                                    <td width="80">
                                        <p>
                                            <?
                                            $pay_term = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['pay_term']))));
                                            echo $pay_term;
                                            ?>                                            
                                        </p>
                                    </td>                                
                                    <td width="80">
                                        <p>
                                            <?
                                            $tenor = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['tenor']))));
                                            echo $tenor;
                                            ?>                                            
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            echo ($ex_date['min_date']!="") ? change_date_format($ex_date['min_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            echo ($ex_date['max_date']!="") ? change_date_format($ex_date['max_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_qty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_value'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($ship_excess_qty,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($ship_excess_val,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($ship_short_qty,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($ship_short_val,0);?></p></td>
                                    <td width="80" align="center"><p><?=$row['shipment_status'];?></p></td>
                                    <td width="80" align="right"><p><?=$item_smv;?></p></td>
                                    <td width="80" align="right"><p><?=$tot_item_smv;?></p></td>
                                    <td width="80"><p><?=$budget_data_array[$job_key]['cm_cost'];?></p></td>
                                    <td width="80"><p><?=$team_library[$row['team_leader']];?></p></td>
                                    <td width="80"><p><?=$merchant_library[$row['dealing_marchant']];?></p></td>
                                    <td width="80"><p><?=$merchant_library[$row['factory_marchant']];?></p></td>
                                    <td width="80">
                                        <p>
                                            <?=$user_library[$row['inserted_by']];?>       
                                            <?
                                            if($row['updated_by']!="")
                                            {
                                                echo ", ".$user_library[$row['updated_by']];
                                            }
                                            ?>                                 
                                        </p>
                                    </td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80">
                                        <a href="javascript:void(0);" onclick="show_popup('sample_status', '<?=$job_key; ?>', '920px',1)">
                                            View
                                        </a>
                                    </td>
                                    <td width="80">
                                        <a href="javascript:void(0);" onclick="show_popup('order_status', '<?=$job_key; ?>', '320px',2)">
                                            View
                                        </a>
                                    </td>
                                    <td width="80">
                                        <a href="javascript:void(0);" onclick="show_popup('closing_status', '<?=$job_key; ?>', '320px',3)">
                                            View
                                        </a>
                                    </td>
                                    <td width="80">
                                        <p>
                                            <?
                                                echo ($work_order_data_array[$job_key][1]) ? "Printing : ".$work_order_data_array[$job_key][1] : "";
                                                echo ($work_order_data_array[$job_key][2]) ? "<br>Embroidery : ".$work_order_data_array[$job_key][2] : "";
                                                echo ($work_order_data_array[$job_key][3]) ? "<br>Wash : ".$work_order_data_array[$job_key][3] : "";
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80">
                                        <p>
                                            <?
                                                echo "AOP : ".$service_booking_data_array[$job_key]['aop'];
                                                echo "<br>Yarn Dyeing : ".$yd_work_order_data_array[$job_key];
                                                echo "<br>Knitting : ".$service_booking_data_array[$job_key]['knitting'];
                                                echo "<br>Fab. Dyeing : ".$service_booking_data_array[$job_key]['dyeing'];
                                            ?>
                                            
                                        </p>
                                    </td>



                                    <td width="80"><p>&nbsp;<?=$budget_data_array[$job_key]['costing_date'];?></p></td>
                                    <td width="80" align="right"><p><?=number_format($total_budget_value,2);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($open_value,0);?></p></td>
                                    <td width="80"><p><?=($budget_data_array[$job_key]['approved']==1) ? "Approved" : "Not Approved";?></p></td>
                                    <td width="80"><p><?=number_format($a,0);?></p></td>


                                    
                                    <td width="80" align="center" data="Main Fabric Booking Information">
                                        <p>&nbsp;
                                            <?
                                            $booking_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['booking_date'])));
                                            $booking_date = "";
                                            foreach ($booking_date_arr as $val) 
                                            {
                                                $booking_date .= ($booking_date=="") ? $val : ", ".$val;
                                            }
                                            echo $booking_date;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $booking_no_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['booking_no'])));
                                            $booking_no = "";
                                            foreach ($booking_no_arr as $val) 
                                            {
                                                $booking_no .= ($booking_no=="") ? $val : ", ".$val;
                                            }
                                            echo $booking_no;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            $delivery_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['delivery_date'])));
                                            $delivery_date = "";
                                            foreach ($delivery_date_arr as $val) 
                                            {
                                                $delivery_date .= ($delivery_date=="") ? $val : ", ".$val;
                                            }
                                            echo $delivery_date;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $revised_no_arr = array_unique(explode(",", $booking_data_array[$job_key][1][2]['revised_no']));
                                            $revised_no = "";
                                            foreach ($revised_no_arr as $val) 
                                            {
                                                $revised_no .= ($revised_no=="") ? $val : ", ".$val;
                                            }
                                            // echo $revised_no;
                                            if($amendment_arr[$job_key]!="")
                                            {
                                                echo $amendment_arr[$job_key]-1;
                                            }
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            $revised_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['revised_date'])));
                                            $revised_date = "";
                                            foreach ($revised_date_arr as $val) 
                                            {
                                                $revised_date .= ($revised_date=="") ? $val : ", ".$val;
                                            }
                                            echo $revised_date;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80" align="center">                                    
                                        <?
                                        $is_approved_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['is_approved'])));
                                        $is_approved = "";
                                        foreach ($is_approved_arr as $val) 
                                        {
                                            $is_approved .= ($is_approved=="") ? $approval_type_arr[$val] : ", ".$approval_type_arr[$val];
                                        }
                                        ?>
                                        <a href="javascript:void(0);" onclick="show_popup('fb_approval_status', '<?=$job_key; ?>__1', '920px',3)">
                                                <?
                                            echo ($is_approved=="") ? " Not Approved" : $is_approved;
                                            ?>
                                        </a> 
                                    </td>
                                    <td width="80"><p><?=$a;?></p>Yarn Desc</td>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $construction_arr = array_unique(array_filter(explode("__", $booking_data_array[$job_key][1][2]['construction'])));
                                            $construction = "";
                                            foreach ($construction_arr as $val) 
                                            {
                                                $construction .= ($construction=="") ? $val : ", ".$val;
                                            }
                                            echo $construction;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $copmposition_arr = array_unique(array_filter(explode("__", $booking_data_array[$job_key][1][2]['copmposition'])));
                                            $copmposition = "";
                                            foreach ($copmposition_arr as $val) 
                                            {
                                                $copmposition .= ($copmposition=="") ? $val : ", ".$val;
                                            }
                                            echo $copmposition;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $gsm_weight_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['gsm_weight'])));
                                            $gsm_weight = "";
                                            foreach ($gsm_weight_arr as $val) 
                                            {
                                                $gsm_weight .= ($gsm_weight=="") ? $val : ", ".$val;
                                            }
                                            echo $gsm_weight;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $dia_width_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['dia_width'])));
                                            $dia_width = "";
                                            foreach ($dia_width_arr as $val) 
                                            {
                                                $dia_width .= ($dia_width=="") ? $val : ", ".$val;
                                            }
                                            echo $dia_width;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][2]['grey_fab_qnty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][2]['fin_fab_qnty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][2]['process_loss'],0);?></p></td>



                                    
                                    <td width="80" align="center" data="Purchase Fabric Booking Information">
                                        <p>
                                            <?
                                            $booking_date_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['booking_date'])));
                                            $booking_date = "";
                                            foreach ($booking_date_arr as $val) 
                                            {
                                                $booking_date .= ($booking_date=="") ? $val : ", ".$val;
                                            }
                                            echo $booking_date;
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <?
                                            $booking_no_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['booking_no'])));
                                            $booking_no = "";
                                            foreach ($booking_no_arr as $val) 
                                            {
                                                ?>
                                                <a href="javascript:void(0)" onclick="generate_fabric_report('<?=$val; ?>');">
                                                <?
                                                // $booking_no .= ($booking_no=="") ? $val : ", ".$val;
                                                echo $val;
                                                ?>
                                            </a><br>
                                                <?
                                            }
                                            ?>
                                    </td>
                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            $delivery_date_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['delivery_date'])));
                                            $delivery_date = "";
                                            foreach ($delivery_date_arr as $val) 
                                            {
                                                $delivery_date .= ($delivery_date=="") ? $val : ", ".$val;
                                            }
                                            echo $delivery_date;
                                            ?>                                        
                                        </p>
                                    </td>                                
                                    <td width="80">
                                        <p>
                                            <?
                                            $construction_arr = array_unique(array_filter(explode("__", $pur_booking_data_array[$job_key][1]['construction'])));
                                            $construction = "";
                                            foreach ($construction_arr as $val) 
                                            {
                                                $construction .= ($construction=="") ? $val : ", ".$val;
                                            }
                                            echo $construction;
                                            ?>                                        
                                        </p>
                                    </td>                                                               
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $uom_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['uom'])));
                                            $uom = "";
                                            foreach ($uom_arr as $val) 
                                            {
                                                $uom .= ($uom=="") ? $unit_of_measurement[$val] : ", ".$unit_of_measurement[$val];
                                            }
                                            echo $uom;
                                            ?>                                        
                                        </p>
                                    </td>                                                                                               
                                    <td width="80" align="right">
                                        <p>
                                            <?
                                            $fin_fab_qnty_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['fin_fab_qnty'])));
                                            $fin_fab_qnty = "";
                                            foreach ($fin_fab_qnty_arr as $val) 
                                            {
                                                $fin_fab_qnty .= ($fin_fab_qnty=="") ? $val : ", ".$val;
                                            }
                                            echo number_format($fin_fab_qnty,2);
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <a href="javascript:void(0);" onclick="show_popup('work_order_details', '<?=$job_key; ?>', '920px',5)">View</a>
                                    </td>
                                    <td width="80" align="center">
                                        
                                        <?
                                        $is_approved_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1][2]['is_approved'])));
                                        $is_approved = "";
                                        foreach ($is_approved_arr as $val) 
                                        {
                                            $is_approved .= ($is_approved=="") ? $approval_type_arr[$val] : ", ".$approval_type_arr[$val];
                                        }
                                        ?>
                                        <a href="javascript:void(0);" onclick="show_popup('fb_approval_status', '<?=$job_key; ?>__2', '920px',4)">
                                            <?
                                            echo ($is_approved=="") ? " Not Approved" : $is_approved;
                                            ?>
                                            
                                        </a>
                                    </td>

                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            $booking_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['booking_date'])));
                                            $booking_date = "";
                                            foreach ($booking_date_arr as $val) 
                                            {
                                                $booking_date .= ($booking_date=="") ? $val : ", ".$val;
                                            }
                                            echo $booking_date;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $booking_no_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['booking_no'])));
                                            $booking_no = "";
                                            foreach ($booking_no_arr as $val) 
                                            {
                                                $booking_no .= ($booking_no=="") ? $val : ", ".$val;
                                            }
                                            echo $booking_no;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80" align="center" data="Short/EFR Fabric Booking Information">
                                        <p>&nbsp;
                                            <?
                                            $delivery_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['delivery_date'])));
                                            $delivery_date = "";
                                            foreach ($delivery_date_arr as $val) 
                                            {
                                                $delivery_date .= ($delivery_date=="") ? $val : ", ".$val;
                                            }
                                            echo $delivery_date;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>
                                            <?                                       
                                            echo $short_fab_array[$job_key];;
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $uom_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['uom'])));
                                            $uom = "";
                                            foreach ($uom_arr as $val) 
                                            {
                                                $uom .= ($uom=="") ? $unit_of_measurement[$val] : ", ".$unit_of_measurement[$val];
                                            }
                                            echo $uom;
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][1]['grey_fab_qnty'],0);?></p></td>                                 
                                    <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][1]['fin_fab_qnty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][1]['process_loss'],0);?></p></td>                               
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $is_approved_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['is_approved'])));
                                            $is_approved = "";
                                            foreach ($is_approved_arr as $val) 
                                            {
                                                $is_approved .= ($is_approved=="") ? $approval_type_arr[$val] : ", ".$approval_type_arr[$val];
                                            }
                                            echo ($is_approved=="") ? " Not Approved" : $is_approved;
                                            ?>
                                            
                                        </p>
                                    </td>


                                    
                                    <td width="80"><p><a href="javascript:void(0);" onclick="show_popup('trims_acc_status_popup', '<?=$job_key; ?>', '1120px',6)">View</a></p></td>



                                    <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['grey_fab_qnty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($yarn_allocation_array[$job_key],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($yarn_allocation_array[$job_key]-$booking_qty_array[$job_key]['grey_fab_qnty'])>0){ echo number_format(($yarn_allocation_array[$job_key]-$booking_qty_array[$job_key]['grey_fab_qnty']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><?=number_format($textile_data_array[$job_key][3],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format(($booking_qty_array[$job_key]['grey_fab_qnty']-$textile_data_array[$job_key][3]),0);?></p></td>
                                    <td width="80" align="right"><p>  <? if($textile_data_array[$job_key][3]-($booking_qty_array[$job_key]['grey_fab_qnty'])>0){ echo number_format($textile_data_array[$job_key][3]-($booking_qty_array[$job_key]['grey_fab_qnty']),0);} else{ echo " ";}?></p></td>
                                



                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($yarn_allocation_array[$job_key],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['grey_fab_qnty']-$yarn_allocation_array[$job_key])>0){ echo number_format(($booking_qty_array[$job_key]['grey_fab_qnty']-$yarn_allocation_array[$job_key]),0);} else{ echo " ";} ?></p></td>

                                    <td width="80" align="right"><p><?=number_format($yarn_rcv_from_dyeing_array[$job_key],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($dyed_yarn_issue_array[$job_key],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>



                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>



                                    <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['grey_fab_qnty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($program_data_array[$job_key],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['grey_fab_qnty']-$program_data_array[$job_key])>0){ echo number_format(($booking_qty_array[$job_key]['grey_fab_qnty']-$program_data_array[$job_key]),0);} else{ echo " ";}?></p></td>

                                    <td width="80" align="right"><p><?=$service_booking_data_array[$job_key]['knitting'];?></p></td>
                                    <td width="80" align="right"><p><?=number_format($knitting_data_array[$job_key][1],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($knitting_data_array[$job_key][3],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format(($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3]),0);?></p></td>
                                    <td width="80" align="right"><p>
                                        <? 
                                        // echo $booking_qty_array[$job_key]['grey_fab_qnty']."-(".$knitting_data_array[$job_key][3]."+".$knitting_data_array[$job_key][1]."<br>";
                                        if($booking_qty_array[$job_key]['grey_fab_qnty']-($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3])>0)
                                        { 
                                            echo number_format($booking_qty_array[$job_key]['grey_fab_qnty']-($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3]),0);
                                        } 
                                        else
                                        { 
                                            echo " ";
                                        } ?>
                                    </p></td>

                                    <td width="80" align="right"><p><? echo number_format($booking_qty_array[$job_key]['grey_fab_qnty']-($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3]),0) ?></p></td>
                                    <td width="80" align="right"><p><?=number_format($price_kg_tk,2);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($total_price_kg_tk,2);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][56],0);?></p></td>
                                    <td width="80" align="right" title="Knitting Reference closing"><p>Yes</p></td>



                                    <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['grey_fab_qnty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][58],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['grey_fab_qnty'] - $roll_data_array[$job_key][58])>0){ echo number_format(($booking_qty_array[$job_key]['grey_fab_qnty'] - $roll_data_array[$job_key][58]),0);} else{ echo " ";} ?></p></td>
                                    <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][82][5],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format(($roll_data_array[$job_key][58]+$transfer_data_array[$job_key][82][5]),0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][61],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][82][6],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format(($roll_data_array[$job_key][61]+$transfer_data_array[$job_key][82][6]),0);?></p></td>
                                    <td width="80" align="right"><p><? if((($roll_data_array[$job_key][58]+$transfer_data_array[$job_key][82][5]) -($roll_data_array[$job_key][61]+$transfer_data_array[$job_key][82][6]))){ echo number_format((($roll_data_array[$job_key][58]+$transfer_data_array[$job_key][82][5]) -($roll_data_array[$job_key][61]+$transfer_data_array[$job_key][82][6])) ,0);}else{ echo " ";}?></p></td>



                                    <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['grey_fab_qnty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][62],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][64],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($fab_dyeing_array[$job_key],0);?></p></td>

                                    <td width="80" align="right"><p><? if(($fab_dyeing_array[$job_key]-$booking_qty_array[$job_key]['grey_fab_qnty'])>0){ echo number_format(($fab_dyeing_array[$job_key]-$booking_qty_array[$job_key]['grey_fab_qnty']),0);} else{ echo "0";}?></p></td>

                                    <td width="80" align="center" title="Dyeing Reference closing"><p><?echo number_format(($booking_qty_array[$job_key]['grey_fab_qnty']-$fab_dyeing_array[$job_key]),0);?></p></td>



                                    <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['fin_fab_qnty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($textile_data_array[$job_key][66],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($textile_data_array[$job_key][66]-$booking_qty_array[$job_key]['fin_fab_qnty'])>0){ echo number_format(($textile_data_array[$job_key][66]-$booking_qty_array[$job_key]['fin_fab_qnty']),0);}  else{ echo "0";}?></p></td>
                                    <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['fin_fab_qnty'] - $textile_data_array[$job_key][66])>0){ echo number_format(($booking_qty_array[$job_key]['fin_fab_qnty'] - $textile_data_array[$job_key][66]),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="left"><p><?=$fab_dyeing_process_array[$job_key];?></p></td>
                                    <td width="80" align="right"><p><?=number_format($textile_data_array[$job_key][66],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][63],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][65],0);?></p></td>
                                    <td width="80" align="right" title="Issue - Rcv"><p><? if(($roll_data_array[$job_key][63] - $roll_data_array[$job_key][65])>0){ echo number_format(($roll_data_array[$job_key][63] - $roll_data_array[$job_key][65]),0);}  else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][67],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                    <td width="80" align="right" title="Dyeing Finishing Reference closing"><p>No</p></td>



                                    <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['fin_fab_qnty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][68],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($roll_data_array[$job_key][68]-$booking_qty_array[$job_key]['fin_fab_qnty'])>0){ echo number_format(($roll_data_array[$job_key][68]-$booking_qty_array[$job_key]['fin_fab_qnty']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['fin_fab_qnty']-$roll_data_array[$job_key][68])>0){ echo number_format(($booking_qty_array[$job_key]['fin_fab_qnty']-$roll_data_array[$job_key][68]),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][134][5],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][134][5],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($textile_data_array[$job_key][71],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][134][6],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][134][6],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($roll_data_array[$job_key][68] - $textile_data_array[$job_key][71])>0){ echo number_format(($roll_data_array[$job_key][68] - $textile_data_array[$job_key][71]),0);} else{ echo " ";}?></p></td>



                                    <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['fin_fab_qnty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][67],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($roll_data_array[$job_key][67]-$booking_qty_array[$job_key]['fin_fab_qnty'])>0){ echo number_format(($roll_data_array[$job_key][67]-$booking_qty_array[$job_key]['fin_fab_qnty']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['fin_fab_qnty'] - $roll_data_array[$job_key][67])>0){ echo number_format(($booking_qty_array[$job_key]['fin_fab_qnty'] - $roll_data_array[$job_key][67]),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="left"><p><?=$cutting_status;?></p></td>
                                    <td width="80" align="right"><p><?=number_format($row['job_qty_pcs'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($excess_cut_prsnt,2);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($row['plan_cut_qnty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($lay_data_array[$job_key]['no_of_bndl'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($lay_data_array[$job_key]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][1]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><? if (($gmts_data_array[$job_key][1]['qty']-$row['job_qty_pcs'])>0){ echo number_format(($gmts_data_array[$job_key][1]['qty']-$row['job_qty_pcs']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><? if(($row['job_qty_pcs']-$gmts_data_array[$job_key][1]['qty'])>0){ echo number_format(($row['job_qty_pcs']-$gmts_data_array[$job_key][1]['qty']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][4]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($row['job_qty_pcs']-$gmts_data_array[$job_key][4]['qty'])>0){ echo number_format(($row['job_qty_pcs']-$gmts_data_array[$job_key][4]['qty']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><?=number_format($embel_data_array[$job_key][2][1]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($embel_data_array[$job_key][3][1]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($row['job_qty_pcs']-$embel_data_array[$job_key][3][1]['qty'])>0){ echo number_format(($row['job_qty_pcs']-$embel_data_array[$job_key][3][1]['qty']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="left"><p><?=implode(", ", array_unique(array_filter(explode(",", $embel_data_array[$job_key][2][1]['wo_com_id']))));?></p></td>
                                    <td width="80" align="right"><p><?=number_format($embel_data_array[$job_key][2][2]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($embel_data_array[$job_key][3][2]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                    <td width="80" align="left"><p><?=implode(", ", array_unique(array_filter(explode(",", $embel_data_array[$job_key][3][1]['wo_com_id']))));?></p></td>



                                    
                                    <td width="80" align="right"><p><?=number_format(($emb_qty_job_name_arr[$job_key][1]*$pcs_value),0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($print_emb_order_data_array[$job_key][204]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($emb_qty_job_name_arr[$job_key][1]*$pcs_value - $print_emb_order_data_array[$job_key][204]['qty'])>0){ echo number_format(($emb_qty_job_name_arr[$job_key][1]*$pcs_value - $print_emb_order_data_array[$job_key][204]['qty']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><?=number_format($emb_qc_data_array[$job_key][223]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($emb_qc_data_array[$job_key][223]['qty']-$print_emb_order_data_array[$job_key][204]['qty'])>0){ echo number_format(($emb_qc_data_array[$job_key][223]['qty']-$print_emb_order_data_array[$job_key][204]['qty']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><? echo number_format(($print_emb_order_data_array[$job_key][204]['qty']-$emb_qc_data_array[$job_key][223]['qty']),0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($emb_delivery_data_array[$job_key][254]['qty'],0);?></p></td>



                                    <td width="80" align="right"><p><?=number_format(($emb_qty_job_name_arr[$job_key][2]*$pcs_value),0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($print_emb_order_data_array[$job_key][311]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($emb_qty_job_name_arr[$job_key][2]*$pcs_value - $print_emb_order_data_array[$job_key][311]['qty'])>0){ echo number_format(($emb_qty_job_name_arr[$job_key][2]*$pcs_value - $print_emb_order_data_array[$job_key][311]['qty']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><?=number_format($emb_qc_data_array[$job_key][324]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($emb_qc_data_array[$job_key][324]['qty']-$print_emb_order_data_array[$job_key][311]['qty'])>0){ echo number_format(($emb_qc_data_array[$job_key][324]['qty']-$print_emb_order_data_array[$job_key][311]['qty']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><? if(($print_emb_order_data_array[$job_key][311]['qty']-$emb_qc_data_array[$job_key][324]['qty'])>0){ echo number_format(($print_emb_order_data_array[$job_key][311]['qty']-$emb_qc_data_array[$job_key][324]['qty']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><?=number_format($emb_delivery_data_array[$job_key][325]['qty'],0);?></p></td>



                                    <td width="80" align="right"><p><?=number_format($row['job_qty_pcs'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($row['plan_cut_qnty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][4]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($row['plan_cut_qnty']-$gmts_data_array[$job_key][4]['qty'])>0){ echo number_format(($row['plan_cut_qnty']-$gmts_data_array[$job_key][4]['qty']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><?=number_format(($gmts_data_array[$job_key][1]['qty']-$gmts_data_array[$job_key][4]['qty']),0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][5]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($gmts_data_array[$job_key][5]['qty']-$row['plan_cut_qnty'])>0){ echo number_format(($gmts_data_array[$job_key][5]['qty']-$row['plan_cut_qnty']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><? echo number_format(($gmts_data_array[$job_key][4]['qty']-$gmts_data_array[$job_key][5]['qty']),0); ?></p></td>
                                    <td width="80" align="right"><p><? if(($gmts_data_array[$job_key][4]['qty']-$gmts_data_array[$job_key][5]['qty'])>0){ echo number_format(($gmts_data_array[$job_key][4]['qty']-$gmts_data_array[$job_key][5]['qty']),0);} else{ echo " ";}?></p></td>



                                    <td width="80" align="right"><p><?=number_format($row['job_qty_pcs'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][7]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][15]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][11]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][8]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($row['plan_cut_qnty']-$gmts_data_array[$job_key][8]['qty'])>0){ echo number_format(($row['plan_cut_qnty']-$gmts_data_array[$job_key][8]['qty']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="center"><p>&nbsp;<?=change_date_format(max($rfi_date_array[$job_key]));?></p></td>
                                    <td width="80" align="right"><p>&nbsp;<?=$buyer_insp_data[$job_key]['date'];?></p></td>
                                    <td width="80" align="right"><p><?=number_format($buyer_insp_data[$job_key]['qty'],0);?></p></td>



                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['cartot_qnty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_qty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($invice_data[$job_key]['inv_qty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_value'],2);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($invice_data[$job_key]['inv_value'],2);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($invice_data[$job_key]['net_inv_value'],2);?></p></td>
                                    <td width="80" align="right"><p><? if(($ex_data_array[$job_key]['ex_qty']-$row['job_qty_pcs'])>0){ echo number_format(($ex_data_array[$job_key]['ex_qty']-$row['job_qty_pcs']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><? if(($ex_data_array[$job_key]['ex_value']-$row['total_price'])>0){ echo number_format(($ex_data_array[$job_key]['ex_value']-$row['total_price']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><? if(($row['job_qty_pcs']-$ex_data_array[$job_key]['ex_qty'])>0){ echo number_format(($row['job_qty_pcs']-$ex_data_array[$job_key]['ex_qty']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><? if(($row['total_price']-$ex_data_array[$job_key]['ex_value'])>0){ echo number_format(($row['total_price']-$ex_data_array[$job_key]['ex_value']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['rtn_qty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_rtn_value'],0);?></p></td>
                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            $ex_data_array = array_unique(array_filter(explode(",", $ex_data_array[$job_key]['ex_date'])));
                                            $ex_date = get_max_min_date($ex_data_array);
                                            echo ($ex_date['min_date']!="") ? change_date_format($ex_date['min_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            $ex_date = get_max_min_date($ex_data_array);
                                            // print_r($ex_date);echo "wwwwwwww";
                                            echo ($ex_date['max_date']!="") ? change_date_format($ex_date['max_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80" align="right"><p><?=number_format($invice_data[$job_key]['discount_ammount'],2);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($order_to_ship_qty,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($order_to_ship_prsnt,2);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($cut_to_ship_qty,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($cut_to_ship_prsnt,2);?></p></td>
                                

                                    
                                    



                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>



                                    
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                </tr>
                                <?
                                $i++;
                                $gr_job_total += $row['job_qty_pcs'];
                                $gr_po_total += $row['order_quantity'];
                                $gr_color_size_total += $row['po_quantity'];
                                $gr_plan_cut_total += $row['plan_cut_qnty'];
                                $gr_order_value_total += $row['order_value'];
                            }
                            unset($data_array);
                            ?>                        
                        </tbody>
                    </table>
                </div>
                <!-- =============================== report footer ================================ -->
                <table cellspacing="0" border="1" class="rpt_table"   rules="all" width="<?=$tbl_width;?>"  align="center" id="report_table_footer">
                    <tfoot>                    
                        <tr>
                            <th width="30"><p></p></th>
                            <th width="60"><p></p></th>
                            <th width="100"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="100"><p></p></th>
                            <th width="50"><p></p></th>
                            <th width="90"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p>Grand Total</p></th>
                            <th width="80"><p><?=number_format($gr_job_total,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_po_total,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_plan_cut_total,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_color_size_total,0);?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=number_format($gr_order_value_total,2);?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                        </tr>
                    </tfoot>
                </table>
            </div>        
        </fieldset>
        <script type="text/javascript">
            // $("#zoom").elevateZoom({easing : true});
        </script>
        <?
    }
    else // summary button
    {
        $tbl_width = 7080;
        ?>
        <fieldset>
            <div class="title-part" style="margin: 0 auto;text-align: center;font-size: 20px;">
                <h2>Order Tracking Report</h2>
                <h2>Company : <?=$company_library[$company_name]; ?></h2>
                <? if($date_from!=""){?>
                <h2>Date : <?=change_date_format($date_from); ?>To<?=change_date_format($date_to); ?> </h2>
                <? } ?>
            </div>
            <style type="text/css">
                table thead tr td{
                    padding: 5px;text-align: center;font-weight: bold;font-size: 16px;
                }
                .zoom {
                padding: 0px;
                transition: transform .2s; 
                width: 30px;
                height: 30px;
                margin: 0 auto;
                z-index: 9999 !important;
                overflow: hidden !important;
                visibility: visible;
                position: relative;
                }

                .zoom:hover {
                transform: scale(4); 

                z-index: 9999 !important;
                overflow: hidden !important;
                visibility: visible;
                }
            </style>
            <?
                $gr_top_job_total = 0;
                $gr_top_po_total = 0;
                $gr_top_color_size_total = 0;
                $gr_top_plan_cut_total = 0;
                $gr_top_order_value_total = 0;

                $gr_top_knit_req_qty = 0;
                $gr_top_knit_prod_qty = 0;
                $gr_top_knit_prod_qty = 0;
                $gr_top_knit_wip_qty = 0;

                $gr_top_dye_prod_qty = 0;
                $gr_top_dye_wip_qty = 0;

                $gr_top_ff_req_qty = 0;
                $gr_top_ff_rcv_qty = 0;
                $gr_top_ff_rcv_bal = 0;
                $gr_top_ttl_ff_rcv_qty = 0;
                $gr_top_ff_stock_qty = 0;
                
                $gr_top_cutting_qty = 0;
                $gr_top_cutting_bal = 0;
                
                $gr_top_sew_qty = 0;
                $gr_top_sew_bal = 0;
                
                $gr_top_fin_qty = 0;
                $gr_top_fin_bal = 0;
                $gr_top_insp_qty = 0;
                
                $gr_top_ship_qty = 0;
                $gr_top_ship_val = 0;
                $gr_top_ex_ship_qty = 0;
                $gr_top_ex_ship_val = 0;
                $gr_top_short_ship_qty = 0;
                $gr_top_short_ship_val = 0;
                $gr_top_order_to_ship_qty = 0;
                $gr_top_cut_to_ship_qty = 0;

                foreach ($data_array as $job_key => $row) 
                { 
                    $ship_excess_qty = max($ex_data_array[$job_key]['ex_qty'] - $row['order_quantity'],0);
                    $ship_excess_val = max($ex_data_array[$job_key]['ex_value'] - $row['order_value'],0); 
                    $ship_short_qty = max($row['order_quantity'] - $ex_data_array[$job_key]['ex_qty'],0);
                    $ship_short_val = max($row['order_value'] - $ex_data_array[$job_key]['ex_value'],0);

                    // =============================== for budget data ===========================
                    $finishing_arr = array('209','165','33','94','63','171','65','170','156','179','200','208','127','125','84','68','128','190','242','240','192','172','90','218','67','197','73','66','185','142');
                    $total_finishing_amount=0;
                    $total_finishing_qty=0;
                    $other_cost_attr = array('inspection','freight','certificate_pre_cost','deffdlc_cost','design_cost','studio_cost','common_oh','interest_cost','incometax_cost','depr_amor_pre_cost');
                    $total_other_cost = 0;
                    foreach ($other_cost_attr as $attr) {
                        $total_other_cost+=$other_costing_arr[$job_key][$attr];
                    }
                    $misc_cost=$other_costing_arr[$job_key]['lab_test']+$commercial_costing_arr[$job_key]+$commission_costing_arr[$job_key]+$total_other_cost;

                    foreach ($finishing_arr as $fid) {
                        $total_finishing_amount += array_sum($conv_amount_job_process[$job_key][$fid]);
                        $total_finishing_qty += array_sum($conv_qty_job_process[$job_key][$fid]);
                    }

                    $total_fabic_cost=0;
                    if(count($conv_amount_job_process[$job_key][31])>0){
                        $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][31])/array_sum($conv_qty_job_process[$job_key][31]);
                    }
                    $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][31]);
                    $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][31])/$order_values*100;
                    if(count($conv_amount_job_process[$job_key][30])>0){
                        $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][30])/array_sum($conv_qty_job_process[$job_key][30]);
                    }
                    if($yarn_qty_amount_arr[$job_key]['amount']!=''){
                        $total_fabic_cost+=$yarn_qty_amount_arr[$job_key]['amount']/$yarn_qty_amount_arr[$job_key]['qty'];
                    }
                    $total_fabric_amount +=$yarn_qty_amount_arr[$job_key]['amount']; 
                    $total_fabric_per +=$yarn_qty_amount_arr[$job_key]['amount']/$order_values*100;
                    if($total_finishing_amount!=0){
                        $total_fabic_cost+=$total_finishing_amount/$total_finishing_qty;
                    } 
                    $total_fabric_amount +=$total_finishing_amount;
                    $total_fabric_per +=$total_finishing_amount/$order_values*100;
                    $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][30]);
                    $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][30])/$order_values*100;
                    if(count($conv_amount_job_process[$job_key][35])>0){
                        $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][35])/array_sum($conv_qty_job_process[$job_key][35]);
                    }
                    $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][35]); 
                    $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][35])/$order_values*100;
                    if(count($conv_amount_job_process[$job_key][1])>0){
                        $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][1])/array_sum($conv_qty_job_process[$job_key][1]);
                    }
                    $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][1]);
                    $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][1])/$order_values*100; 

                    $purchase_amount = array_sum($fabricAmoutByFabricSource['knit']['grey'][$job_key])+array_sum($fabricAmoutByFabricSource['woven']['grey'][$job_key]);
                    $purchase_qty = array_sum($fabricQtyByFabricSource['knit']['grey'][$job_key])+array_sum($fabricQtyByFabricSource['woven']['grey'][$job_key]);

                    $ather_emb_attr = array(4,5,6,99);
                    foreach ($ather_emb_attr as $att) {
                        $others_emb_amount += $emb_amount_job_name_arr[$job_key][$att];
                        $others_emb_qty += $emb_qty_job_name_arr[$job_key][$att];
                    }
                    $knitting_amount_summ=''; $dyeing_amount_summ=''; $yds_amount_summ=''; $aop_amount_summ='';
                    if(count($conv_amount_job_process[$job_key][1])>0) {
                        $knitting_amount_summ = fn_number_format(array_sum($conv_amount_job_process[$job_key][1]),2);
                    }
                    $yarn_amount_summ = $yarn_qty_amount_arr[$job_key]['amount'];
                    $print_amount_summ = $emb_amount_job_name_arr[$job_key][1];      
                    $emb_amount_summ= $emb_amount_job_name_arr[$job_key][2];
                    $wash_amount_summ = $wash_amount_job_name_arr[$job_key][3];
                    if(count($conv_amount_job_process[$job_key][31])>0) {
                        $dyeing_amount_summ=  array_sum($conv_amount_job_process[$job_key][31]);
                    }
                    if(count($conv_amount_job_process[$job_key][30])>0) {
                        $yds_amount_summ = array_sum($conv_amount_job_process[$job_key][30]);
                    }
                    if(count($conv_amount_job_process[$job_key][35])>0) {
                        $aop_amount_summ = array_sum($conv_amount_job_process[$job_key][35]);
                    }
                    
                    $total_budget_value = $yarn_amount_summ+$total_finishing_amount+$print_amount_summ+$trims_costing_arr[$job_key]+$yds_amount_summ+$aop_amount_summ+$emb_amount_summ+$knitting_amount_summ+$purchase_amount+$wash_amount_summ+$other_costing_arr[$job_key]['cm_cost']+$dyeing_amount_summ+$others_emb_amount+$misc_cost;
                    $open_value = $row['total_price']-$total_budget_value;

                    $cur_date = date('d-m-Y');
                    $currency_rate=set_conversion_rate( 2, $cur_date,$row['company_name']);
                    $price_kg_tk = ($conv_cost_arr[$job_key][1]['rate']*$currency_rate)/$conv_cost_arr[$job_key][1]['count'];
                    $total_price_kg_tk = ($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3])*$price_kg_tk;

                    $cutting_status = ($row['job_qty_pcs'] > $gmts_data_array[$job_key][1]['qty']) ? "Running" : "Close";
                    $excess_cut_qty = $gmts_data_array[$job_key][1]['qty'] - $row['job_qty_pcs'];
                    $excess_cut_prsnt = ($excess_cut_qty>0) ? ($excess_cut_qty/$row['job_qty_pcs'])*100 : 0;

                    $order_to_ship_qty = ($ex_data_array[$job_key]['ex_qty'] - $row['job_qty_pcs']);
                    $order_to_ship_prsnt = ($ex_data_array[$job_key]['ex_qty'] != $row['job_qty_pcs']) ? (($order_to_ship_qty/$row['job_qty_pcs'])*100) : 100;
                    $cut_to_ship_qty = ($ex_data_array[$job_key]['ex_qty'] - $lay_data_array[$job_key]['qty']);
                    // $cut_to_ship_prsnt = ($lay_data_array[$job_key]['qty']>0) ? (100 - ($cut_to_ship_qty/$lay_data_array[$job_key]['qty'])*100) : 0;
                    $cut_to_ship_prsnt = ($ex_data_array[$job_key]['ex_qty']>0) ? ($ex_data_array[$job_key]['ex_qty']/$lay_data_array[$job_key]['qty'])*100 : 0;
                    // echo "(".$ex_data_array[$job_key]['ex_qty']."/".$lay_data_array[$job_key]['qty'].")*100)<br>";

                    
                    $costingPer = $costing_per_arr[$job_key];            
                    if($costingPer==1) $pcs_value=1*12;
                    else if($costingPer==2) $pcs_value=1*1;
                    else if($costingPer==3) $pcs_value=2*12;
                    else if($costingPer==4) $pcs_value=3*12;
                    else if($costingPer==5) $pcs_value=4*12;
                    // echo $pcs_value;die;
                    $knit_wip = $booking_qty_array[$job_key]['grey_fab_qnty']-($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3]);
                    $dyeing_wip = $booking_qty_array[$job_key]['grey_fab_qnty']-$fab_dyeing_array[$job_key];
                   

                    $gr_top_job_total += $row['job_qty_pcs'];
                    $gr_top_po_total += $row['order_quantity'];
                    $gr_top_color_size_total += $row['po_quantity'];
                    $gr_top_plan_cut_total += $row['plan_cut_qnty'];
                    $gr_top_order_value_total += $row['order_value'];
                
                    $gr_top_knit_req_qty += $booking_qty_array[$job_key]['grey_fab_qnty'];
                    $gr_top_knit_prod_qty += $knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3];
                    $gr_top_knit_wip_qty += $knit_wip;

                    $gr_top_dye_prod_qty += $fab_dyeing_array[$job_key];
                    $gr_top_dye_wip_qty +=$dyeing_wip;

                    $gr_top_ff_req_qty += $booking_qty_array[$job_key]['fin_fab_qnty'];
                    $gr_top_ff_rcv_qty += $roll_data_array[$job_key][68];
                    $gr_top_ff_rcv_bal += $booking_qty_array[$job_key]['fin_fab_qnty']-$roll_data_array[$job_key][68];
                    $gr_top_ttl_ff_rcv_qty += $transfer_data_array[$job_key][134][5];
                    $gr_top_ff_stock_qty += $roll_data_array[$job_key][68] - $textile_data_array[$job_key][71];
                    
                    $gr_top_cutting_qty += $gmts_data_array[$job_key][1]['qty'];
                    $gr_top_cutting_bal += $row['job_qty_pcs']-$gmts_data_array[$job_key][1]['qty'];
                    
                    $gr_top_sew_qty += $gmts_data_array[$job_key][5]['qty'];
                    $gr_top_sew_bal += $gmts_data_array[$job_key][4]['qty']-$gmts_data_array[$job_key][5]['qty'];
                    
                    $gr_top_fin_qty += $gmts_data_array[$job_key][8]['qty'];
                    $gr_top_fin_bal += $row['plan_cut_qnty']-$gmts_data_array[$job_key][8]['qty'];
                    $gr_top_insp_qty += $buyer_insp_data[$job_key]['qty'];
                    
                    $gr_top_ship_qty += $ex_data_array[$job_key]['ex_qty'];
                    $gr_top_ship_val += $ex_data_array[$job_key]['ex_value'];
                    
                    $gr_top_ex_ship_qty += $ship_excess_qty;
                    $gr_top_ex_ship_val += $ship_excess_val;
                    $gr_top_short_ship_qty += $ship_short_qty;
                    $gr_top_short_ship_val += $ship_short_val;

                    $gr_top_order_to_ship_qty += $order_to_ship_qty;
                    $gr_top_cut_to_ship_qty += $cut_to_ship_qty;
                }
            ?>   
            <div class="report-container-part">
                <!-- ================================= report header ================================== -->
                <table cellspacing="0" border="1" class="rpt_table"   rules="all" width="<?=$tbl_width;?>"  align="center" id="table_header_1">
                    <thead>
                        <tr>
                            <td style="background: #95DAC1;" colspan="37">Order Information</td>
                            <td style="background: #E05D5D;" colspan="4">Knitting Status</td>
                            <td style="background: #BFA2DB;" colspan="3">Dyeing Status</td>
                            <td style="background: #C1CFC0;" colspan="5">Finish Fabric Store Status</td>
                            <td style="background: #8FC1D4;" colspan="3">Cutting Status</td>
                            <td style="background: #EBA83A;" colspan="2">Sewing Status</td>
                            <td style="background: #B5FFD9;" colspan="5">Garments Finishing Status</td>
                            <td style="background: #E798AE;" colspan="6">Shipment Status</td>
                            <td style="background: #C449C2;" colspan="25">Order Activities/TNA</td>
                        </tr>
                        <tr style="text-align:right;">
                            <td width="30"><p></p></td>
                            <td width="60"><p></p></td>
                            <td width="100"><p></p></td>
                            <td width="90"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p>Grand Total</p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_job_total,0);?></p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_po_total,0);?></p></td>
                            <td width="80"><p></p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_order_value_total,2);?></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p><?=number_format($gr_top_ship_qty,0);?></p></td>                          
                            <td width="80"><p><?=number_format($gr_top_ship_val,2);?></p></td>
                            <td width="80"><p><?=number_format($gr_top_ex_ship_qty,0);?></p></td>
                            <td width="80"><p><?=number_format($gr_top_ex_ship_val,0);?></p></td>
                            <td width="80"><p><?=number_format($gr_top_short_ship_qty,0);?></p></td>
                            <td width="80"><p><?=number_format($gr_top_short_ship_val,0);?></p></td>    
                            <td width="80"><p></p></td>                          

                           

                            <td width="80" align="right"><p><?=$gr_top_knit_req_qty;?></p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_knit_prod_qty,0);?></p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_knit_wip_qty,0);?></p></td>
                            <td width="80"><p></p></td>

                            

                            <td width="80" align="right"><p><?=number_format($gr_top_dye_prod_qty,0);?></p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_dye_wip_qty,0);?></p></td>
                            <td width="80"><p></p></td>



                           

                            <td width="80" align="right"><p><?=number_format($gr_top_ff_req_qty,0);?></p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_ff_rcv_qty,0);?></p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_ff_rcv_bal,0);?></p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_ttl_ff_rcv_qty,0);?></p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_ff_stock_qty,0);?></p></td>



                            <td width="80"><p></p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_cutting_qty,0);?></p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_cutting_bal,0);?></p></td>

                            

                            <td width="80" align="right"><p><?=number_format($gr_top_sew_qty,0);?></p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_sew_bal,0);?></p></td>


                            <td width="80" align="right"><p><?=number_format($gr_top_fin_qty,0);?></p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_fin_bal,0);?></p></td>
                            <td width="80"><p></p></td>
                            <td width="80"><p></p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_insp_qty,0);?></p></td>



                            <td width="80" align="right"><p><?=number_format($gr_top_ship_qty,0);?></p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_ship_val,0);?></p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_order_to_ship_qty,0);?></p></td>
                            <td width="80"><p></p></td>
                            <td width="80" align="right"><p><?=number_format($gr_top_cut_to_ship_qty,0);?></p></td>
                            <td width="80"><p></p></td>

                            

                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                            <td width="80"><p><?=$a;?></p></td>
                        </tr>
                        <tr>
                            <th width="30"><p>Sl.</p></th>
                            <th width="60"><p>Order Status</p></th>
                            <th width="100"><p>Buyer</p></th>
                            <th width="90"><p>Job</p></th>
                            <th width="80"><p>Style Ref</p></th>
                            <th width="80"><p>Gmts Item</p></th>
                            <th width="80"><p>Season</p></th>
                            <th width="80"><p>Prod Dept</p></th>
                            <th width="80"><p>Sub Dept</p></th>
                            <th width="80"><p>Order/PO No</p></th>
                            <th width="80"><p>GMT Color</p></th>
                            <th width="80"><p>Order Qnty [Pcs]</p></th>
                            <th width="80"><p>Break Down Order Qnty [Pcs]</p></th>
                            <th width="80"><p>Per Unit Price</p></th>
                            <th width="80"><p>Order Value</p></th>
                            <th width="80"><p>PO Insert Date</p></th>
                            <th width="80"><p>PO Receive Date</p></th>
                            <th width="80"><p>Fabric Budget Start Date</p></th>
                            <th width="80"><p>Insp. Date</p></th>
                            <th width="80"><p>Pub. Shipment Date</p></th>
                            <th width="80"><p>First Shipment Date </p></th>
                            <th width="80"><p>Org. Shipment Date </p></th>
                            <th width="80"><p>ETD/LDD Date</p></th>
                            <th width="80"><p>RFI Plan Date</p></th>
                            <th width="80"><p>Shipment Mode</p></th>
                            <th width="80"><p>Lead Time</p></th>
                            <th width="80"><p>Days in Hand</p></th>
                            <th width="80"><p>Commercial File No</p></th>
                            <th width="80"><p>First Shipment Date</p></th>
                            <th width="80"><p>Last Shipment Date</p></th>
                            <th width="80"><p>Shipment Qnty</p></th>
                            <th width="80"><p>Shipment Value</p></th>
                            <th width="80"><p>Excess Shipment Qnty</p></th>
                            <th width="80"><p>Excess Shipment Value</p></th>
                            <th width="80"><p>Short Shipment Qnty</p></th>
                            <th width="80"><p>Short Shipment Value</p></th>
                            <th width="80"><p>Shipping Status</p></th>

                            

                            <th width="80"><p>Knitting Require with EFR Qnty</p></th>
                            <th width="80"><p>TTL Knitting Production Qnty </p></th>
                            <th width="80"><p>TTL Knitting Production WIP Qnty</p></th>
                            <th width="80"><p>Closing Status</p></th>

                            

                            
                            <th width="80"><p>Production Qnty</p></th>
                            <th width="80"><p>Production WIP Qnty</p></th>
                            <th width="80"><p>Closing Status</p></th>

                            

                            <th width="80"><p>Require with Short/EFR Qnty</p></th>
                            <th width="80"><p>Received Qnty</p></th>
                            <th width="80"><p>Receive Balance Qnty</p></th>
                            <th width="80"><p>TTL Received Qnty</p></th>
                            <th width="80"><p>Stock In Hand</p></th>

                           
                            <th width="80"><p>Cutting Status</p></th>
                            <th width="80"><p>Cutting Production [QC] Qnty</p></th> 
                            <th width="80"><p>Cutting Production Balance Qnty</p></th>

                           

                            
                            <th width="80"><p>Production [Output] Qnty</p></th>
                            <th width="80"><p>Balance Qty</p></th>

                            
                            <th width="80"><p>Finish Quantity</p></th>
                            <th width="80"><p>Balance Qty</p></th>
                            <th width="80"><p>Inspection Offer Date</p></th>
                            <th width="80"><p>Inspection Date</p></th>
                            <th width="80"><p>Inspection Qnty</p></th>

                          
                            <th width="80"><p>Shipment Qnty</p></th>                            
                            <th width="80"><p>Shipment Value</p></th>
                            <th width="80"><p>Order to Ship Qty </p></th>
                            <th width="80"><p>Order to Ship % </p></th>
                            <th width="80"><p>Cut to Ship Qty </p></th>
                            <th width="80"><p>Cut to Ship % </p></th>

                            

                            <th width="80"><p>Lead Time [Templete]</p></th>
                            <th width="80"><p>Yarn Receive Start</p></th>
                            <th width="80"><p>Yarn Receive End</p></th>
                            <th width="80"><p>Knitting Start</p></th>
                            <th width="80"><p>Knitting End</p></th>
                            <th width="80"><p>Dyeing Start</p></th>
                            <th width="80"><p>Dyeing End</p></th>
                            <th width="80"><p>Finish Fabric Prod. Start</p></th>
                            <th width="80"><p>Finish Fabric Prod. End</p></th>
                            <th width="80"><p>Trims Receive Start</p></th>
                            <th width="80"><p>Trims Receive End</p></th>
                            <th width="80"><p>Cutting Start</p></th>
                            <th width="80"><p>Cutting End</p></th>
                            <th width="80"><p>Print Start</p></th>
                            <th width="80"><p>Print End</p></th>
                            <th width="80"><p>Emb Start</p></th>
                            <th width="80"><p>Emb End</p></th>
                            <th width="80"><p>Sewing Start</p></th>
                            <th width="80"><p>Sewing End</p></th>
                            <th width="80"><p>GMT Finihsing Start</p></th>
                            <th width="80"><p>GMT Finihsing End</p></th>
                            <th width="80"><p>Inspection Start</p></th>
                            <th width="80"><p>Inspection End</p></th>
                            <th width="80"><p>Shipment  Start</p></th>
                            <th width="80"><p>Shipment  End</p></th>
                        </tr>
                    </thead>
                </table>
                <!-- =================================== report body ==================================== -->
                <div style=" max-height:300px; width:<?=$tbl_width+20;?>px; overflow-y:scroll;" id="scroll_body">
                    <table cellspacing="0" border="1" class="rpt_table"   rules="all" width="<?=$tbl_width;?>"  align="center" id="table_body">
                        <tbody>
                            <?
                            $i=1;
                            $gr_job_total = 0;
                            $gr_po_total = 0;
                            $gr_color_size_total = 0;
                            $gr_plan_cut_total = 0;
                            $gr_order_value_total = 0;

                            $gr_knit_req_qty = 0;
                            $gr_knit_prod_qty = 0;
                            $gr_knit_prod_qty = 0;
                            $gr_knit_wip_qty = 0;

                            $gr_dye_prod_qty = 0;
                            $gr_dye_wip_qty = 0;

                            $gr_ff_req_qty = 0;
                            $gr_ff_rcv_qty = 0;
                            $gr_ff_rcv_bal = 0;
                            $gr_ttl_ff_rcv_qty = 0;
                            $gr_ff_stock_qty = 0;
                            
                            $gr_cutting_qty = 0;
                            $gr_cutting_bal = 0;
                            
                            $gr_sew_qty = 0;
                            $gr_sew_bal = 0;
                            
                            $gr_fin_qty = 0;
                            $gr_fin_bal = 0;
                            $gr_insp_qty = 0;
                            
                            $gr_ship_qty = 0;
                            $gr_ship_val = 0;
                            $gr_order_to_ship_qty = 0;
                            $gr_cut_to_ship_qty = 0;

                            foreach ($data_array as $job_key => $row) 
                            {   
                                $bgcolor=($i%2==0)?"#E9F3FF":"#FFFFFF";   
                                $ship_excess_qty = max($ex_data_array[$job_key]['ex_qty'] - $row['order_quantity'],0);
                                $ship_excess_val = max($ex_data_array[$job_key]['ex_value'] - $row['order_value'],0); 
                                $ship_short_qty = max($row['order_quantity'] - $ex_data_array[$job_key]['ex_qty'],0);
                                $ship_short_val = max($row['order_value'] - $ex_data_array[$job_key]['ex_value'],0);

                                // =============================== for budget data ===========================
                                $finishing_arr = array('209','165','33','94','63','171','65','170','156','179','200','208','127','125','84','68','128','190','242','240','192','172','90','218','67','197','73','66','185','142');
                                $total_finishing_amount=0;
                                $total_finishing_qty=0;
                                $other_cost_attr = array('inspection','freight','certificate_pre_cost','deffdlc_cost','design_cost','studio_cost','common_oh','interest_cost','incometax_cost','depr_amor_pre_cost');
                                $total_other_cost = 0;
                                foreach ($other_cost_attr as $attr) {
                                    $total_other_cost+=$other_costing_arr[$job_key][$attr];
                                }
                                $misc_cost=$other_costing_arr[$job_key]['lab_test']+$commercial_costing_arr[$job_key]+$commission_costing_arr[$job_key]+$total_other_cost;

                                foreach ($finishing_arr as $fid) {
                                    $total_finishing_amount += array_sum($conv_amount_job_process[$job_key][$fid]);
                                    $total_finishing_qty += array_sum($conv_qty_job_process[$job_key][$fid]);
                                }

                                $total_fabic_cost=0;
                                if(count($conv_amount_job_process[$job_key][31])>0){
                                    $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][31])/array_sum($conv_qty_job_process[$job_key][31]);
                                }
                                $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][31]);
                                $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][31])/$order_values*100;
                                if(count($conv_amount_job_process[$job_key][30])>0){
                                    $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][30])/array_sum($conv_qty_job_process[$job_key][30]);
                                }
                                if($yarn_qty_amount_arr[$job_key]['amount']!=''){
                                    $total_fabic_cost+=$yarn_qty_amount_arr[$job_key]['amount']/$yarn_qty_amount_arr[$job_key]['qty'];
                                }
                                $total_fabric_amount +=$yarn_qty_amount_arr[$job_key]['amount']; 
                                $total_fabric_per +=$yarn_qty_amount_arr[$job_key]['amount']/$order_values*100;
                                if($total_finishing_amount!=0){
                                    $total_fabic_cost+=$total_finishing_amount/$total_finishing_qty;
                                } 
                                $total_fabric_amount +=$total_finishing_amount;
                                $total_fabric_per +=$total_finishing_amount/$order_values*100;
                                $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][30]);
                                $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][30])/$order_values*100;
                                if(count($conv_amount_job_process[$job_key][35])>0){
                                    $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][35])/array_sum($conv_qty_job_process[$job_key][35]);
                                }
                                $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][35]); 
                                $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][35])/$order_values*100;
                                if(count($conv_amount_job_process[$job_key][1])>0){
                                    $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][1])/array_sum($conv_qty_job_process[$job_key][1]);
                                }
                                $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][1]);
                                $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][1])/$order_values*100; 

                                $purchase_amount = array_sum($fabricAmoutByFabricSource['knit']['grey'][$job_key])+array_sum($fabricAmoutByFabricSource['woven']['grey'][$job_key]);
                                $purchase_qty = array_sum($fabricQtyByFabricSource['knit']['grey'][$job_key])+array_sum($fabricQtyByFabricSource['woven']['grey'][$job_key]);

                                $ather_emb_attr = array(4,5,6,99);
                                foreach ($ather_emb_attr as $att) {
                                    $others_emb_amount += $emb_amount_job_name_arr[$job_key][$att];
                                    $others_emb_qty += $emb_qty_job_name_arr[$job_key][$att];
                                }
                                $knitting_amount_summ=''; $dyeing_amount_summ=''; $yds_amount_summ=''; $aop_amount_summ='';
                                if(count($conv_amount_job_process[$job_key][1])>0) {
                                    $knitting_amount_summ = fn_number_format(array_sum($conv_amount_job_process[$job_key][1]),2);
                                }
                                $yarn_amount_summ = $yarn_qty_amount_arr[$job_key]['amount'];
                                $print_amount_summ = $emb_amount_job_name_arr[$job_key][1];      
                                $emb_amount_summ= $emb_amount_job_name_arr[$job_key][2];
                                $wash_amount_summ = $wash_amount_job_name_arr[$job_key][3];
                                if(count($conv_amount_job_process[$job_key][31])>0) {
                                    $dyeing_amount_summ=  array_sum($conv_amount_job_process[$job_key][31]);
                                }
                                if(count($conv_amount_job_process[$job_key][30])>0) {
                                    $yds_amount_summ = array_sum($conv_amount_job_process[$job_key][30]);
                                }
                                if(count($conv_amount_job_process[$job_key][35])>0) {
                                    $aop_amount_summ = array_sum($conv_amount_job_process[$job_key][35]);
                                }
                                
                                $total_budget_value = $yarn_amount_summ+$total_finishing_amount+$print_amount_summ+$trims_costing_arr[$job_key]+$yds_amount_summ+$aop_amount_summ+$emb_amount_summ+$knitting_amount_summ+$purchase_amount+$wash_amount_summ+$other_costing_arr[$job_key]['cm_cost']+$dyeing_amount_summ+$others_emb_amount+$misc_cost;
                                $open_value = $row['total_price']-$total_budget_value;

                                $cur_date = date('d-m-Y');
                                $currency_rate=set_conversion_rate( 2, $cur_date,$row['company_name']);
                                $price_kg_tk = ($conv_cost_arr[$job_key][1]['rate']*$currency_rate)/$conv_cost_arr[$job_key][1]['count'];
                                $total_price_kg_tk = ($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3])*$price_kg_tk;

                                $cutting_status = ($row['job_qty_pcs'] > $gmts_data_array[$job_key][1]['qty']) ? "Running" : "Close";
                                $excess_cut_qty = $gmts_data_array[$job_key][1]['qty'] - $row['job_qty_pcs'];
                                $excess_cut_prsnt = ($excess_cut_qty>0) ? ($excess_cut_qty/$row['job_qty_pcs'])*100 : 0;

                                $order_to_ship_qty = ($ex_data_array[$job_key]['ex_qty'] - $row['job_qty_pcs']);
                                $order_to_ship_prsnt = ($ex_data_array[$job_key]['ex_qty'] != $row['job_qty_pcs']) ? (($order_to_ship_qty/$row['job_qty_pcs'])*100) : 100;
                                $cut_to_ship_qty = ($ex_data_array[$job_key]['ex_qty'] - $lay_data_array[$job_key]['qty']);
                                // $cut_to_ship_prsnt = ($lay_data_array[$job_key]['qty']>0) ? (100 - ($cut_to_ship_qty/$lay_data_array[$job_key]['qty'])*100) : 0;
                                $cut_to_ship_prsnt = ($ex_data_array[$job_key]['ex_qty']>0) ? ($ex_data_array[$job_key]['ex_qty']/$lay_data_array[$job_key]['qty'])*100 : 0;
                                // echo "(".$ex_data_array[$job_key]['ex_qty']."/".$lay_data_array[$job_key]['qty'].")*100)<br>";

                                
                                $costingPer = $costing_per_arr[$job_key];            
                                if($costingPer==1) $pcs_value=1*12;
                                else if($costingPer==2) $pcs_value=1*1;
                                else if($costingPer==3) $pcs_value=2*12;
                                else if($costingPer==4) $pcs_value=3*12;
                                else if($costingPer==5) $pcs_value=4*12;
                                // echo $pcs_value;die;

                                ?>
                                <tr bgcolor="<? echo $bgcolor;?>" id="tr_<?= $i;?>" onClick="change_color('tr_<?= $i; ?>','<?= $bgcolor; ?>')">
                                <td width="30"><p><?=$i;?></p></td>
                                    <td width="60">
                                        <p>
                                            <?
                                            $order_status_arr = array_unique(array_filter(explode(",", $row['order_status'])));
                                            $order_status_name = "";
                                            foreach ($order_status_arr as $val) 
                                            {
                                                $order_status_name .= ($order_status_name=="") ? $order_status[$val] : ", ".$order_status[$val];
                                            }
                                            echo $order_status_name;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="100"><p><?=$buyer_library[$row['buyer_name']];?></p></td>
                                    <td width="90"><p><?=$job_key;?></p></td>
                                    <td width="80"><p><?=$row['style'];?></p></td>
                                    <td width="80">
                                        <p>
                                            <?
                                            $item_id_arr = array_unique(array_filter(explode(",", $row['item_id'])));
                                            $item_name = "";
                                            $item_smv = "";
                                            $tot_item_smv = 0;
                                            foreach ($item_id_arr as $val) 
                                            {
                                                $item_name .= ($item_name=="") ? $garments_item[$val] : ", ".$garments_item[$val];
                                                $item_smv .= ($item_smv=="") ? $garments_item[$val]." : ".$item_smv_array[$job_key][$val] : ", ".$garments_item[$val]." : ".$item_smv_array[$job_key][$val];
                                                $tot_item_smv += $item_smv_array[$job_key][$val];
                                            }
                                            echo $item_name;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80"><p><?=$season_library[$row['season']];?></p></td>
                                    <td width="80"><p><?=$product_dept[$row['product_dept']];?></p></td>
                                    <td width="80"><p><?=$sub_dep_library[$row['pro_sub_dep']];?></p></td>
                                    
                                    <td width="80">
                                        <p>
                                            <?
                                            $po_number_arr = array_unique(array_filter(explode(",", $row['po_number'])));
                                            $po_name = "";
                                            foreach ($po_number_arr as $val) 
                                            {
                                                $po_name .= ($po_name=="") ? $val : ", ".$val;
                                            }
                                            echo $po_name;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80">
                                        <p>
                                            <?
                                            $color_arr = array_unique(array_filter(explode(",", $row['color_id'])));
                                            $color_name = "";
                                            foreach ($color_arr as $val) 
                                            {
                                                $color_name .= ($color_name=="") ? $color_library[$val] : ", ".$color_library[$val];
                                            }
                                            echo $color_name;
                                            ?>
                                            
                                        </p>
                                    </td>
                                    <td width="80" align="right"><p><?=number_format($row['order_quantity'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($row['order_quantity'],0);?></p></td>
                                   
                                    <td width="80" align="right"><p><?=$row['unit_price'];?></p></td>
                                    <td width="80" align="right"><p><?=number_format($row['order_value'],0);?></p></td>
                                    <td width="80" align="center"><p>&nbsp;<?=$row['po_insert_date'];?></p></td>
                                    <td width="80" align="center"><p>&nbsp;<?=$row['po_received_date'];?></p></td>
                                    <td width="80" align="center"><p>&nbsp;<?=$row['factory_received_date'];?></p></td>
                                   
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p>&nbsp;<?=$row['pub_shipment_date'];?></p></td>
                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            $ex_date_array = array_unique(array_filter(explode(",", $ex_data_array[$job_key]['ex_date'])));
                                            $ex_date = get_max_min_date($ex_date_array);
                                            // echo min($ex_date_array);
                                            echo ($ex_date['min_date']!="") ? change_date_format($ex_date['min_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80"><p>&nbsp;<?=$row['shipment_date'];?></p></td>
                                    <td width="80"><p>&nbsp;<?=$row['txt_etd_ldd'];?></p></td>
                                    <td width="80"><p>&nbsp;<?=$cutup_date = implode(",", array_unique(array_filter(explode(",", $row['cutup_date']))));?></p></td>
                                    <td width="80"><p><?=$shipment_mode[$row['ship_mode']];?></p></td>
                                    <td width="80"><p><?=$row['lead_time'];?></p></td>
                                    <td width="80"><p><?=$row['days_in_hand'];?></p></td>
                                    <td width="80">
                                        <p>
                                            <?
                                            $com_file = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['internal_file_no']))));
                                            echo $com_file;
                                            ?>                                            
                                        </p>
                                    </td> 
                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            echo ($ex_date['min_date']!="") ? change_date_format($ex_date['min_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80" align="center">
                                        <p>&nbsp;
                                            <?
                                            echo ($ex_date['max_date']!="") ? change_date_format($ex_date['max_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_qty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_value'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($ship_excess_qty,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($ship_excess_val,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($ship_short_qty,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($ship_short_val,0);?></p></td>
                                    <td width="80" align="center"><p><?=$row['shipment_status'];?></p></td>
                                    

                                   



                                    <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['grey_fab_qnty'],0);?></p></td>                                   
                                    <td width="80" align="right"><p><?=number_format(($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3]),0);?></p></td>
                                    <?$knit_wip = $booking_qty_array[$job_key]['grey_fab_qnty']-($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3]);?>
                                    <td width="80" align="right"><p><? echo number_format(max($knit_wip,0),0) ?></p></td>                                    
                                    <td width="80" align="right" title="Knitting Reference closing"><p>Yes</p></td>
                                    



                                    <?$dyeing_wip = $booking_qty_array[$job_key]['grey_fab_qnty']-$fab_dyeing_array[$job_key];?>
                                    <td width="80" align="right"><p><?=number_format($fab_dyeing_array[$job_key],0);?></p></td>
                                    <td width="80" align="center" title="Dyeing Reference closing"><p><?echo number_format(max($dyeing_wip,0),0);?></p></td>
                                    <td width="80" align="right"><p></p></td>

                                    



                                    <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['fin_fab_qnty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][68],0);?></p></td>
                                    
                                    <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['fin_fab_qnty']-$roll_data_array[$job_key][68])>0){ echo number_format(($booking_qty_array[$job_key]['fin_fab_qnty']-$roll_data_array[$job_key][68]),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][134][5],0);?></p></td>
                                   
                                    <td width="80" align="right"><p><? if(($roll_data_array[$job_key][68] - $textile_data_array[$job_key][71])>0){ echo number_format(($roll_data_array[$job_key][68] - $textile_data_array[$job_key][71]),0);} else{ echo " ";}?></p></td>



                                   
                                    <td width="80" align="left"><p><?=$cutting_status;?></p></td>
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][1]['qty'],0);?></p></td>                                   
                                    <td width="80" align="right"><p><? if(($row['job_qty_pcs']-$gmts_data_array[$job_key][1]['qty'])>0){ echo number_format(($row['job_qty_pcs']-$gmts_data_array[$job_key][1]['qty']),0);} else{ echo " ";}?></p></td>
                                    
                                   



                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][5]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><? echo number_format(($gmts_data_array[$job_key][4]['qty']-$gmts_data_array[$job_key][5]['qty']),0);?></p></td>  
                                    
                                    
                                    
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][8]['qty'],0);?></p></td>
                                    <td width="80" align="right"><p><? if(($row['plan_cut_qnty']-$gmts_data_array[$job_key][8]['qty'])>0){ echo number_format(($row['plan_cut_qnty']-$gmts_data_array[$job_key][8]['qty']),0);} else{ echo " ";}?></p></td>
                                    <td width="80" align="center"><p>&nbsp;<?=change_date_format(max($rfi_date_array[$job_key]));?></p></td>
                                    <td width="80" align="right"><p>&nbsp;<?=$buyer_insp_data[$job_key]['date'];?></p></td>
                                    <td width="80" align="right"><p><?=number_format($buyer_insp_data[$job_key]['qty'],0);?></p></td>



                                   
                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_qty'],0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_value'],2);?></p></td>                                   
                                    <td width="80" align="right"><p><?=number_format($order_to_ship_qty,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($order_to_ship_prsnt,2);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($cut_to_ship_qty,0);?></p></td>
                                    <td width="80" align="right"><p><?=number_format($cut_to_ship_prsnt,2);?></p></td>
                                

                                    



                                    
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                    <td width="80"><p><?=$a;?></p></td>
                                </tr>
                                <?
                                $i++;
                                $gr_job_total += $row['job_qty_pcs'];
                                $gr_po_total += $row['order_quantity'];
                                $gr_color_size_total += $row['po_quantity'];
                                $gr_plan_cut_total += $row['plan_cut_qnty'];
                                $gr_order_value_total += $row['order_value'];
                            
                                $gr_knit_req_qty += $booking_qty_array[$job_key]['grey_fab_qnty'];
                                $gr_knit_prod_qty += $knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3];
                                $gr_knit_wip_qty += $knit_wip;

                                $gr_dye_prod_qty += $fab_dyeing_array[$job_key];
                                $gr_dye_wip_qty +=$dyeing_wip;

                                $gr_ff_req_qty += $booking_qty_array[$job_key]['fin_fab_qnty'];
                                $gr_ff_rcv_qty += $roll_data_array[$job_key][68];
                                $gr_ff_rcv_bal += $booking_qty_array[$job_key]['fin_fab_qnty']-$roll_data_array[$job_key][68];
                                $gr_ttl_ff_rcv_qty += $transfer_data_array[$job_key][134][5];
                                $gr_ff_stock_qty += $roll_data_array[$job_key][68] - $textile_data_array[$job_key][71];
                                
                                $gr_cutting_qty += $gmts_data_array[$job_key][1]['qty'];
                                $gr_cutting_bal += $row['job_qty_pcs']-$gmts_data_array[$job_key][1]['qty'];
                                
                                $gr_sew_qty += $gmts_data_array[$job_key][5]['qty'];
                                $gr_sew_bal += $gmts_data_array[$job_key][4]['qty']-$gmts_data_array[$job_key][5]['qty'];
                                
                                $gr_fin_qty += $gmts_data_array[$job_key][8]['qty'];
                                $gr_fin_bal += $row['plan_cut_qnty']-$gmts_data_array[$job_key][8]['qty'];
                                $gr_insp_qty += $buyer_insp_data[$job_key]['qty'];
                                
                                $gr_ship_qty += $ex_data_array[$job_key]['ex_qty'];
                                $gr_ship_val += $ex_data_array[$job_key]['ex_value'];
                    
                                $gr_ex_ship_qty += $ship_excess_qty;
                                $gr_ex_ship_val += $ship_excess_val;
                                $gr_short_ship_qty += $ship_short_qty;
                                $gr_short_ship_val += $ship_short_val;

                                $gr_order_to_ship_qty += $order_to_ship_qty;
                                $gr_cut_to_ship_qty += $cut_to_ship_qty;
                            }
                            unset($data_array);
                            ?>                        
                        </tbody>
                    </table>
                </div>
                <!-- =============================== report footer ================================ -->
                <table cellspacing="0" border="1" class="rpt_table"   rules="all" width="<?=$tbl_width;?>"  align="center" id="report_table_footer">
                    <tfoot>                    
                        <tr>
                            <th width="30"><p></p></th>
                            <th width="60"><p></p></th>
                            <th width="100"><p></p></th>
                            <th width="90"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p>Grand Total</p></th>
                            <th width="80"><p><?=number_format($gr_job_total,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_po_total,0);?></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p><?=number_format($gr_order_value_total,2);?></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p><?=number_format($gr_ship_qty,0);?></p></th>                          
                            <th width="80"><p><?=number_format($gr_ship_val,2);?></p></th>
                            <th width="80"><p><?=number_format($gr_ex_ship_qty,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_ex_ship_val,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_short_ship_qty,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_short_ship_val,0);?></p></th>   
                            <th width="80"><p></p></th>                          

                           

                            <th width="80"><p><?=$gr_knit_req_qty;?></p></th>
                            <th width="80"><p><?=number_format($gr_knit_prod_qty,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_knit_wip_qty,0);?></p></th>
                            <th width="80"><p></p></th>

                            

                            <th width="80"><p><?=number_format($gr_dye_prod_qty,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_dye_wip_qty,0);?></p></th>
                            <th width="80"><p></p></th>



                           

                            <th width="80"><p><?=number_format($gr_ff_req_qty,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_ff_rcv_qty,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_ff_rcv_bal,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_ttl_ff_rcv_qty,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_ff_stock_qty,0);?></p></th>



                            <th width="80"><p></p></th>
                            <th width="80"><p><?=number_format($gr_cutting_qty,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_cutting_bal,0);?></p></th>

                            

                            <th width="80"><p><?=number_format($gr_sew_qty,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_sew_bal,0);?></p></th>


                            <th width="80"><p><?=number_format($gr_fin_qty,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_fin_bal,0);?></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p><?=number_format($gr_insp_qty,0);?></p></th>



                            <th width="80"><p><?=number_format($gr_ship_qty,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_ship_val,0);?></p></th>
                            <th width="80"><p><?=number_format($gr_order_to_ship_qty,0);?></p></th>
                            <th width="80"><p></p></th>
                            <th width="80"><p><?=number_format($gr_cut_to_ship_qty,0);?></p></th>
                            <th width="80"><p></p></th>

                            

                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                            <th width="80"><p><?=$a;?></p></th>
                        </tr>
                    </tfoot>
                </table>
            </div>        
        </fieldset>
        <script type="text/javascript">
            // $("#zoom").elevateZoom({easing : true});
        </script>
        <?
    }

}

if ($action == "report_generate_excel") 
{
    $company_name   = str_replace("'", "", $cbo_company_name);
    $buyer_name     = str_replace("'", "", $cbo_buyer_name);
    $year_id        = str_replace("'", "", $cbo_year);    
    $job_no         = str_replace("'", "", $txt_job_no);
    $txt_style_ref  = str_replace("'", "", $txt_style_ref);
    $txt_order_no   = str_replace("'", "", $txt_order_no);
    $shipmentStatus= str_replace("'", "", $cbo_shipment_status);
    $orderStatus   = str_replace("'","", $cbo_order_status);
    $status         = str_replace("'", "", $cbo_status);
    $report_type    = str_replace("'", "", $cbo_report_type);
    $date_category  = str_replace("'", "", $cbo_date_category);    

    /*===============================================================================/
    /                              Create Library Array                              /
    /============================================================================== */
    $team_library   = return_library_array("select id,team_leader_name from lib_marketing_team where status_active =1 and is_deleted=0", "id", "team_leader_name");
    $merchant_library   = return_library_array("select id,team_member_name from lib_mkt_team_member_info where status_active =1 and is_deleted=0", "id", "team_member_name");
    $country_library= return_library_array("select id, country_name from  lib_country", "id", "country_name");
    $buyer_library  = return_library_array("select id, buyer_name from  lib_buyer", "id", "buyer_name");
    $supplier_library  = return_library_array("select id, supplier_name from  lib_supplier", "id", "supplier_name");
    $color_library  = return_library_array("select id, color_name from  lib_color", "id", "color_name");
    $size_library   = return_library_array("select id, size_name from  lib_size", "id", "size_name");
    $company_library= return_library_array("select id, company_name from  lib_company", "id", "company_name");
    $sub_dep_library= return_library_array("select id,sub_department_name from lib_pro_sub_deparatment status_active =1 and is_deleted=0", "id", "sub_department_name");
    $season_library = return_library_array("select id, season_name from lib_buyer_season where status_active =1 and is_deleted=0", "id", "season_name");
    $brand_library = return_library_array("select id, brand_name from lib_buyer_brand brand where status_active =1 and is_deleted=0", "id", "brand_name");
    $sub_dep_library = return_library_array("select id,sub_department_name from lib_pro_sub_deparatment where status_active =1 and is_deleted=0", "id", "sub_department_name");
    $user_library = return_library_array("select id,user_full_name from user_passwd where status_active =1", "id", "user_full_name");
    $bank_library = return_library_array("select bank_name,id from lib_bank where is_deleted=0 and status_active=1 and lien_bank=1", "id", "bank_name");
    // echo "<pre>";print_r($user_library);die;

    $fab_material=array(1=>"Organic",2=>"BCI");

    /*===============================================================================/
    /                                   Query Condition                              /
    /============================================================================== */
    $sqlCond = "";
    $sqlCond = ($company_name) ? " and a.company_name=$company_name" : "";
    $sqlCond .= ($buyer_name) ? " and a.buyer_name=$buyer_name" : "";
    $sqlCond .= ($year_id) ? " and to_char(a.insert_date,'YYYY')=$year_id" : "";
    $sqlCond .= ($job_no!="") ? " and a.job_no_prefix_num=$job_no" : "";
    $sqlCond .= ($txt_style_ref!="") ? " and a.style_ref_no='$txt_style_ref'" : "";
    $sqlCond .= ($txt_order_no!="") ? " and b.po_number='$txt_order_no'" : "";
    $sqlCond .= ($orderStatus) ? " and b.is_confirmed=$orderStatus" : "";
    $sqlCond .= ($status) ? " and b.status_active=$status" : "";

    if($shipmentStatus)
    {
        if ($shipmentStatus==4) 
        {
            $sqlCond .= " and b.shiping_status in(1,2)";
        }
        else
        {
            $sqlCond .= " and b.shiping_status in($shipmentStatus)";
        }
    }

    if(str_replace("'", "", $txt_date_from) !="" && str_replace("'", "", $txt_date_to) !="")
    {
        switch ($date_category) 
        {
            case 1:
                $sqlCond .= " and b.shipment_date between $txt_date_from and $txt_date_to";
                break;

            case 2:
                $sqlCond .= " and b.shipment_date between $txt_date_from and $txt_date_to";
                break;    
            
            default:
                $sqlCond .= " and b.factory_received_date between $txt_date_from and $txt_date_to";
                break;
        }
    }

    /*===============================================================================/
    /                                  MAIN QUERY                                    /
    /============================================================================== */
    $sql = "SELECT a.id,a.job_no, a.company_name,a.style_owner,a.buyer_name,a.style_ref_no,a.requisition_no,a.style_description,a.repeat_job_no,a.season_buyer_wise,a.product_dept,a.product_code,a.pro_sub_dep,a.order_uom,  a.product_category,a.brand_id,a.region,a.sustainability_standard,a.fab_material,a.qlty_label,a.quality_level,(a.job_quantity*a.total_set_qnty) as job_qty_pcs,    to_char(a.insert_date,'YYYY') as year,a.ship_mode,a.set_smv,a.team_leader,a.dealing_marchant,a.factory_marchant,a.inserted_by,a.updated_by,a.total_price,a.qlty_label,

        b.is_confirmed,b.id as po_id,b.po_number,b.excess_cut,(b.po_quantity*a.total_set_qnty) as po_quantity,b.unit_price,(b.po_total_price*a.total_set_qnty) as po_total_price ,to_char(b.insert_date,'DD-MM-YYYY') as po_insert_date,to_char(b.po_received_date,'DD-MM-YYYY') as po_received_date,to_char(b.factory_received_date,'DD-MM-YYYY') as factory_received_date,to_char(b.pub_shipment_date,'DD-MM-YYYY') as pub_shipment_date,to_char(b.shipment_date,'DD-MM-YYYY') as shipment_date,to_char(b.txt_etd_ldd,'DD-MM-YYYY') as txt_etd_ldd,b.shiping_status,(b.pub_shipment_date-b.po_received_date) as lead_time,(b.pub_shipment_date - trunc(sysdate)) AS days_in_hand,b.rfi_date,

        c.country_id,c.item_number_id,c.color_number_id,c.size_number_id,c.order_quantity,c.plan_cut_qnty,to_char(c.cutup_date,'DD-MM-YYYY') as cutup_date,to_char(c.country_ship_date,'DD-MM-YYYY') as country_ship_date

        from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.id=b.job_id and b.id=c.po_break_down_id and a.id=c.job_id and a.status_active=1 and a.is_deleted=0 and c.status_active in(1,2,3) and c.is_deleted=0 $sqlCond";
    // echo $sql;die();
    $sql_res = sql_select($sql);
    if(count($sql_res)==0)
    {
        ?>
        <center>
            <div style="width: 80%;" class="alert alert-danger">Data not found.Please try again.</div>
        </center>
        <?
        die();
    }
    $data_array = array();
    $job_id_array = array();
    $job_no_array = array();
    $po_array = array();
    $po_wise_data = array();
    $po_wise_job_arr = array();
    $po_chk_array = array();
    $po_wise_unit_price_array = array();
    $rfi_date_array = array();
    foreach ($sql_res as $val) 
    {
        $rfi_date_array[$val['JOB_NO']][$val['RFI_DATE']] = $val['RFI_DATE'];

        $data_array[$val['JOB_NO']]['company_name'] = $val['COMPANY_NAME'];
        $data_array[$val['JOB_NO']]['buyer_name'] = $val['BUYER_NAME'];
        $data_array[$val['JOB_NO']]['wo_com_id'] = $val['STYLE_OWNER'];
        $data_array[$val['JOB_NO']]['year'] = $val['YEAR'];
        $data_array[$val['JOB_NO']]['style'] = $val['STYLE_REF_NO'];
        $data_array[$val['JOB_NO']]['req_no'] = $val['REQUISITION_NO'];
        $data_array[$val['JOB_NO']]['repeat_job_no'] = $val['REPEAT_JOB_NO'];
        $data_array[$val['JOB_NO']]['style_des'] = $val['STYLE_DESCRIPTION'];
        $data_array[$val['JOB_NO']]['season'] = $val['SEASON_BUYER_WISE'];
        $data_array[$val['JOB_NO']]['product_dept'] = $val['PRODUCT_DEPT'];
        $data_array[$val['JOB_NO']]['product_code'] = $val['PRODUCT_CODE'];
        $data_array[$val['JOB_NO']]['pro_sub_dep'] = $val['PRO_SUB_DEP'];
        $data_array[$val['JOB_NO']]['product_category'] = $val['PRODUCT_CATEGORY'];
        $data_array[$val['JOB_NO']]['brand_id'] = $val['BRAND_ID'];
        $data_array[$val['JOB_NO']]['region'] = $val['REGION'];
        $data_array[$val['JOB_NO']]['sustainability_standard'] = $val['SUSTAINABILITY_STANDARD'];
        $data_array[$val['JOB_NO']]['fab_material'] = $val['FAB_MATERIAL'];
        $data_array[$val['JOB_NO']]['order_nature'] = $val['QLTY_LABEL'];
        $data_array[$val['JOB_NO']]['quality_level'] = $val['QUALITY_LEVEL'];
        $data_array[$val['JOB_NO']]['qlty_label'] = $val['QLTY_LABEL'];
        $data_array[$val['JOB_NO']]['job_qty_pcs'] = $val['JOB_QTY_PCS'];
        $data_array[$val['JOB_NO']]['order_uom'] = $val['ORDER_UOM'];
        $data_array[$val['JOB_NO']]['ship_mode'] = $val['SHIP_MODE'];
        $data_array[$val['JOB_NO']]['set_smv'] = $val['SET_SMV'];
        $data_array[$val['JOB_NO']]['team_leader'] = $val['TEAM_LEADER'];
        $data_array[$val['JOB_NO']]['dealing_marchant'] = $val['DEALING_MARCHANT'];
        $data_array[$val['JOB_NO']]['factory_marchant'] = $val['FACTORY_MARCHANT'];
        $data_array[$val['JOB_NO']]['inserted_by'] = $val['INSERTED_BY'];
        $data_array[$val['JOB_NO']]['updated_by'] = $val['UPDATED_BY'];
        $data_array[$val['JOB_NO']]['total_price'] = $val['TOTAL_PRICE'];

        $data_array[$val['JOB_NO']]['po_number'] .= $val['PO_NUMBER'].",";
        $data_array[$val['JOB_NO']]['order_status'] .= $val['IS_CONFIRMED'].",";
        $po_wise_data[$val['JOB_NO']]['excess_cut'] .= $val['PO_NUMBER']."=".$val['EXCESS_CUT']."**";

        $data_array[$val['JOB_NO']]['country_id'] .= $val['COUNTRY_ID'].",";
        $data_array[$val['JOB_NO']]['item_id'] .= $val['ITEM_NUMBER_ID'].",";
        $data_array[$val['JOB_NO']]['color_id'] .= $val['COLOR_NUMBER_ID'].",";
        $data_array[$val['JOB_NO']]['size_id'] .= $val['SIZE_NUMBER_ID'].",";
        $data_array[$val['JOB_NO']]['order_quantity'] += $val['ORDER_QUANTITY'];
        $data_array[$val['JOB_NO']]['plan_cut_qnty'] += $val['PLAN_CUT_QNTY'];
        if(!in_array($val['PO_ID'], $po_chk_array))
        {
            $data_array[$val['JOB_NO']]['po_quantity'] += $val['PO_QUANTITY'];
            $data_array[$val['JOB_NO']]['order_value'] += $val['PO_TOTAL_PRICE'];
            $data_array[$val['JOB_NO']]['unit_price'] .= ($data_array[$val['JOB_NO']]['unit_price']=="") ? $val['UNIT_PRICE'] : ", ".$val['UNIT_PRICE'];
            $data_array[$val['JOB_NO']]['po_insert_date'] .= ($data_array[$val['JOB_NO']]['po_insert_date']=="") ? $val['PO_INSERT_DATE'] : ", ".$val['PO_INSERT_DATE'];
            $data_array[$val['JOB_NO']]['po_received_date'] .= ($data_array[$val['JOB_NO']]['po_received_date']=="") ? $val['PO_RECEIVED_DATE'] : ", ".$val['PO_RECEIVED_DATE'];
            $data_array[$val['JOB_NO']]['factory_received_date'] .= ($data_array[$val['JOB_NO']]['factory_received_date']=="") ? $val['FACTORY_RECEIVED_DATE'] : ", ".$val['FACTORY_RECEIVED_DATE'];
            $data_array[$val['JOB_NO']]['pub_shipment_date'] .= ($data_array[$val['JOB_NO']]['pub_shipment_date']=="") ? $val['PUB_SHIPMENT_DATE'] : ", ".$val['PUB_SHIPMENT_DATE'];
            $data_array[$val['JOB_NO']]['shipment_date'] .= ($data_array[$val['JOB_NO']]['shipment_date']=="") ? $val['SHIPMENT_DATE'] : ", ".$val['SHIPMENT_DATE'];
            $data_array[$val['JOB_NO']]['txt_etd_ldd'] .= ($data_array[$val['JOB_NO']]['txt_etd_ldd']=="") ? $val['TXT_ETD_LDD'] : ", ".$val['TXT_ETD_LDD'];
            $data_array[$val['JOB_NO']]['shipment_status'] .= ($data_array[$val['JOB_NO']]['shipment_status']=="") ? $shipment_status[$val['SHIPING_STATUS']] : ", ".$shipment_status[$val['SHIPING_STATUS']];
            $data_array[$val['JOB_NO']]['lead_time'] .= ($data_array[$val['JOB_NO']]['lead_time']=="") ? $val['LEAD_TIME'] : ", ".$val['LEAD_TIME'];
            $data_array[$val['JOB_NO']]['days_in_hand'] .= ($data_array[$val['JOB_NO']]['days_in_hand']=="") ? $val['DAYS_IN_HAND'] : ", ".$val['DAYS_IN_HAND'];

            $po_chk_array[$val['PO_ID']] = $val['PO_ID'];
        }
        $data_array[$val['JOB_NO']]['cutup_date'] .= ($data_array[$val['JOB_NO']]['cutup_date']=="") ? $val['CUTUP_DATE'] : ",".$val['CUTUP_DATE'];
        $data_array[$val['JOB_NO']]['country_ship_date'] .= ($data_array[$val['JOB_NO']]['country_ship_date']=="") ? $val['COUNTRY_SHIP_DATE'] : ",".$val['COUNTRY_SHIP_DATE'];


        $job_id_array[$val['ID']] = $val['ID'];
        $job_no_array[$val['JOB_NO']] = $val['JOB_NO'];
        $po_array[$val['PO_ID']] = $val['PO_ID'];
        $po_wise_job_arr[$val['PO_ID']] = $val['JOB_NO'];
        $po_wise_unit_price_array[$val['PO_ID']] = $val['UNIT_PRICE'];
    }

    unset($sql_res);
    // echo "<pre>";print_r($po_array);echo "</pre>";die();
    /*===============================================================================/
    /                                  Job Image                                     /
    /============================================================================== */
    $job_cond = where_con_using_array($job_no_array,1,"master_tble_id");

    $imge_arr = return_library_array("SELECT master_tble_id,image_location from common_photo_library where file_type=1 $job_cond", 'master_tble_id', 'image_location');
    /*===============================================================================/
    /                                  COSTING PER                                   /
    /============================================================================== */
    $job_ids = implode(",", $job_id_array);
    $costing_per_sql=sql_select("SELECT JOB_NO,COSTING_PER from wo_pre_cost_mst where status_active=1 and job_id in($job_ids)");
    $costing_per_arr=array();
    foreach($costing_per_sql as $cost_val)
    {
        $costing_per_arr[$cost_val['JOB_NO']] = $cost_val['COSTING_PER'];
    }
    unset($costing_per_sql);

    /*===============================================================================/
    /                                 Item Wise SMV                                  /
    /============================================================================== */
    $job_ids = implode(",", $job_id_array);
    $sql = "SELECT job_no,gmts_item_id,smv_pcs from wo_po_details_mas_set_details where job_id in($job_ids)";
    // echo $sql;die();
    $res = sql_select($sql);
    $item_smv_array = array();
    foreach ($res as $val) 
    {
        $item_smv_array[$val['JOB_NO']][$val['GMTS_ITEM_ID']] = $val['SMV_PCS'];        
    }
    // echo "<pre>";print_r($item_smv_array);
    /*===============================================================================/
    /                                   Conversion Cost                              /
    /============================================================================== */
    $job_cond = where_con_using_array($job_id_array,1,"job_id");
    $sql = "SELECT job_no,cons_process,charge_unit from wo_pre_cost_fab_conv_cost_dtls where status_active=1 and is_deleted=0 $job_cond";
    // echo $sql;
    $res = sql_select($sql);
    $conv_cost_arr = array();
    $conv_id_chk_arr = array();
    foreach ($res as $val) 
    {
            $conv_cost_arr[$val['JOB_NO']][$val['CONS_PROCESS']]['rate'] += $val['CHARGE_UNIT'];
            $conv_cost_arr[$val['JOB_NO']][$val['CONS_PROCESS']]['count']++;
        
    }
    // echo "<pre>";print_r($conv_id_chk_arr);die();
    /*===============================================================================/
    /                                  Embel Name                                    /
    /============================================================================== */
    $job_cond = where_con_using_array($job_id_array,1,"job_id");
    $sql = "SELECT job_no,emb_name from wo_pre_cost_embe_cost_dtls where status_active=1 and is_deleted=0 and emb_type!=0 $job_cond";
    // echo $sql;
    $res = sql_select($sql);
    $emb_name_arr = array();
    $emb_id_chk_arr = array();
    foreach ($res as $val) 
    {
        if(!in_array($val['EMB_NAME'], $emb_id_chk_arr[$val['JOB_NO']]))
        {
            $emb_name_arr[$val['JOB_NO']] .= ($emb_name_arr[$val['JOB_NO']]=="") ? $emblishment_name_array[$val['EMB_NAME']] : ",".$emblishment_name_array[$val['EMB_NAME']];
            $emb_id_chk_arr[$val['JOB_NO']][$val['EMB_NAME']] = $val['EMB_NAME'];
        }
    }

    /*===============================================================================/
    /                                Conversion Name                                 /
    /============================================================================== */
    $job_cond = where_con_using_array($job_id_array,1,"job_id");
    $sql = "SELECT job_no,cons_process from wo_pre_cost_fab_conv_cost_dtls where status_active=1 and is_deleted=0 $job_cond";
    // echo $sql;
    $res = sql_select($sql);
    $conv_name_arr = array();
    $conv_id_chk_arr = array();
    foreach ($res as $val) 
    {
        if(!in_array($val['CONS_PROCESS'], $conv_id_chk_arr[$val['JOB_NO']]))
        {
            $conv_name_arr[$val['JOB_NO']] .= ($conv_name_arr[$val['JOB_NO']]=="") ? $conversion_cost_head_array[$val['CONS_PROCESS']] : ",".$conversion_cost_head_array[$val['CONS_PROCESS']];
            $conv_id_chk_arr[$val['JOB_NO']][$val['CONS_PROCESS']] = $val['CONS_PROCESS'];
        }
    }
    // echo "<pre>";print_r($conv_id_chk_arr);die();
    /*===============================================================================/
    /                                  ACTUAL PO                                     /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"po_break_down_id");
    $sql = "SELECT job_no, acc_po_no FROM wo_po_acc_po_info where status_active=1 and is_deleted=0 $po_cond";
    $res = sql_select($sql);
    $acc_po_array = array();
    $acc_po_chk = array();
    foreach ($res as $key => $val) 
    {
        if(!in_array($val['ACC_PO_NO'], $acc_po_chk[$val['JOB_NO']]))
        {
            $acc_po_array[$val['JOB_NO']]['acc_po'] .= ($acc_po_array[$val['JOB_NO']]['acc_po']=="") ? $val['ACC_PO_NO'] : ", ".$val['ACC_PO_NO'];
            $acc_po_chk[$val['JOB_NO']][$val['ACC_PO_NO']] = $val['ACC_PO_NO'];
        }
    }

    /*===============================================================================/
    /                                  Booking Data                                  /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"b.po_break_down_id");
    $sql = "SELECT a.entry_form,a.process, b.job_no,a.item_category,to_char(a.booking_date,'DD-MM-YYYY') as booking_date,to_char(a.delivery_date,'DD-MM-YYYY') as delivery_date,a.booking_no,a.booking_no_prefix_num, b.po_break_down_id as po_id,a.booking_type,a.fabric_source,a.is_short,a.revised_no, b.fin_fab_qnty,b.grey_fab_qnty,a.is_approved,b.dia_width,b.gsm_weight,b.process_loss_percent,b.construction,b.copmposition,a.uom from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $booking_data_array = array();
    $pur_booking_data_array = array();
    $service_booking_data_array = array();
    $booking_qty_array = array();
    $booking_chk_array = array();
    foreach ($res as $val) 
    {
        if($val['ITEM_CATEGORY']==2)
        {
            if($val['FABRIC_SOURCE']==1)
            {
            
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['booking_date'] .= $val['BOOKING_DATE'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['booking_no'] .= $val['BOOKING_NO'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['uom'] .= $val['UOM'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['delivery_date'] .= $val['DELIVERY_DATE'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['revised_no'] .= $val['REVISED_NO'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['is_approved'] .= $val['IS_APPROVED'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['dia_width'] .= $val['DIA_WIDTH'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['gsm_weight'] .= $val['GSM_WEIGHT'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['process_loss'] .= $val['PROCESS_LOSS_PERCENT'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['construction'] .= $val['CONSTRUCTION']."__";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['copmposition'] .= $val['COPMPOSITION']."__";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['fin_fab_qnty'] += $val['FIN_FAB_QNTY'];
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['grey_fab_qnty'] += $val['GREY_FAB_QNTY'];
            }
            else
            {
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['booking_date'] .= $val['BOOKING_DATE'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['booking_no'] .= $val['BOOKING_NO'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['uom'] .= $val['UOM'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['delivery_date'] .= $val['DELIVERY_DATE'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['revised_no'] .= $val['REVISED_NO'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['is_approved'] .= $val['IS_APPROVED'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['dia_width'] .= $val['DIA_WIDTH'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['gsm_weight'] .= $val['GSM_WEIGHT'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['process_loss'] .= $val['PROCESS_LOSS_PERCENT'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['construction'] .= $val['CONSTRUCTION']."__";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['copmposition'] .= $val['COPMPOSITION']."__";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['fin_fab_qnty'] += $val['FIN_FAB_QNTY'];
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['grey_fab_qnty'] += $val['GREY_FAB_QNTY'];
            }
            if($val['ENTRY_FORM']!=108) // omit partial fab. booking
            {
                $booking_qty_array[$po_wise_job_arr[$val['PO_ID']]]['grey_fab_qnty'] += $val['GREY_FAB_QNTY'];
                $booking_qty_array[$po_wise_job_arr[$val['PO_ID']]]['fin_fab_qnty'] += $val['FIN_FAB_QNTY'];
            }
        }

        if($val['ENTRY_FORM']==228)
        {
            if($booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][228]=="")
            {
                $service_booking_data_array[$val['JOB_NO']]['knitting'] .= ($service_booking_data_array[$val['JOB_NO']]['knitting']=="") ? $val['BOOKING_NO'] : $val['BOOKING_NO'].",";
                $booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][228] = $val['BOOKING_NO'];
            }
        }

        if($val['ENTRY_FORM']==229)
        {
            if($booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][229]=="")
            {
                $service_booking_data_array[$val['JOB_NO']]['dyeing'] .= ($service_booking_data_array[$val['JOB_NO']]['dyeing']=="") ? $val['BOOKING_NO'] : $val['BOOKING_NO'].",";
                $booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][229] = $val['BOOKING_NO'];
            }
        }

        if($val['PROCESS']==35)
        {
            if($booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][35]=="")
            {
                $service_booking_data_array[$val['JOB_NO']]['aop'] .= ($service_booking_data_array[$val['JOB_NO']]['aop']=="") ? $val['BOOKING_NO'] : $val['BOOKING_NO'].",";
                $booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][35] = $val['BOOKING_NO'];
            }
        }
       
    }
    // echo "<pre>";print_r($pur_booking_data_array);echo "</pre>";die();

    /*===============================================================================/
    /                                   Short Fab booking_no                         /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"b.po_break_down_id");
    $sql="SELECT a.id as pre_cost_fabric_cost_dtls_id, a.job_no, a.color_type_id, a.gsm_weight, a.construction, a.composition FROM wo_pre_cost_fabric_cost_dtls a, wo_booking_dtls b, wo_pre_cos_fab_co_avg_con_dtls c WHERE a.job_no=b.job_no and a.id=c.pre_cost_fabric_cost_dtls_id and b.pre_cost_fabric_cost_dtls_id=a.id  and c.cons>0 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and c.status_active=1 and c.is_deleted=0 and b.is_short=1 and b.booking_type=1 $po_cond";
    // echo $sql;die();

    $res=sql_select($sql);
    $short_fab_array = array();
    foreach ($res as $val) 
    {
        $short_fab_array[$val["JOB_NO"]]=$body_part[$val[csf("body_part_id")]].', '.$color_type[$val[csf("color_type_id")]].', '.$val[csf("construction")].', '.$val[csf("composition")].', '.$val[csf("gsm_weight")];
    }


    $sql_res = sql_select("SELECT b.job_no, max(c.approved_no) as approved_no from wo_booking_mst a,wo_booking_dtls b, approval_history c where a.booking_no=b.booking_no and a.id=c.mst_id and c.entry_form=7  $po_cond group by b.job_no");
    $amendment_arr = array();
    foreach ($sql_res as $val) 
    {
        $amendment_arr[$val['JOB_NO']] = $val['APPROVED_NO'];
    }
    // echo "<pre>";print_r($amendment_arr);echo "</pre>";die();
    /*===============================================================================/
    /                                    Work order data                             /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"d.id");
    $sql="SELECT a.job_no,c.emb_name, f.booking_no from wo_po_details_master a, wo_pre_cost_mst b, wo_pre_cost_embe_cost_dtls c, wo_po_break_down d, wo_pre_cos_emb_co_avg_con_dtls e, wo_booking_dtls f
    where a.id=b.job_id and a.id=c.job_id and a.id=d.job_id and a.id=e.job_id and a.job_no=f.job_no and c.id=e.pre_cost_emb_cost_dtls_id and d.id=e.po_break_down_id and e.pre_cost_emb_cost_dtls_id= f.pre_cost_fabric_cost_dtls_id and e.po_break_down_id=f.po_break_down_id and f.booking_type=6 and d.is_deleted=0 and d.status_active=1 and f.status_active=1 and f.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $work_order_data_array = array();
    foreach ($res as $val) 
    {
        $bek = explode("-", $val['BOOKING_NO']);
        $work_order_data_array[$val['JOB_NO']][$val['EMB_NAME']] = $bek[3];
        
    }
    // echo "<pre>";print_r($work_order_data_array);die;
    /*===============================================================================/
    /                            YARN DYEING WORK ORDER DATA                         /
    /============================================================================== */
    $job_id_cond = where_con_using_array($job_id_array,0,"b.job_no_id");
    $sql="SELECT b.job_no,a.yarn_dyeing_prefix_num from wo_yarn_dyeing_mst a, wo_yarn_dyeing_dtls b
    where a.id=b.mst_id and a.is_deleted=0 and a.status_active=1 and b.status_active=1 and b.is_deleted=0 $job_id_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $yd_work_order_data_array = array();
    foreach ($res as $val) 
    {
        $yd_work_order_data_array[$val['JOB_NO']] = $val['YARN_DYEING_PREFIX_NUM'];
        
    }
    /*===============================================================================/
    /                                   YARN Allocation                              /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_break_down_id");
    $sql = "SELECT a.job_no,a.is_dyied_yarn,a.qnty from inv_material_allocation_dtls a where a.status_active=1 and a.is_deleted=0 and a.item_category=1 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $yarn_allocation_array = array();
    foreach ($res as $val) 
    {
        $yarn_allocation_array[$val['JOB_NO']] += $val['QNTY'];
    }
    /*===============================================================================/
    /                                      Textile Data                              /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_breakdown_id");
    $sql = "SELECT a.po_breakdown_id,a.entry_form,a.trans_type,a.quantity from order_wise_pro_details a where a.status_active=1 and a.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $textile_data_array = array();
    $transfer_data_array = array();
    foreach ($res as $val) 
    {
        $textile_data_array[$po_wise_job_arr[$val['PO_BREAKDOWN_ID']]][$val['ENTRY_FORM']] += $val['QUANTITY'];
        $transfer_data_array[$po_wise_job_arr[$val['PO_BREAKDOWN_ID']]][$val['ENTRY_FORM']][$val['TRANS_TYPE']] += $val['QUANTITY'];
    }
    // echo "<pre>";print_r($textile_data_array);die;

    /*===============================================================================/
    /                             Yarn Rcv From Dyeing                               /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"c.po_breakdown_id");
    $sql = "SELECT c.po_breakdown_id as po_id, c.QUANTITY  from inv_receive_master a, inv_transaction b,order_wise_pro_details c where a.id=b.mst_id and b.id=c.trans_id and b.item_category=1 and a.entry_form=1 and b.transaction_type in(1) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.receive_purpose in(2) $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $yarn_rcv_from_dyeing_array = array();
    foreach ($res as $val) 
    {
        $yarn_rcv_from_dyeing_array[$po_wise_job_arr[$val['PO_ID']]] += $val['QUANTITY'];
    }
    // echo "<pre>";print_r($yarn_rcv_from_dyeing_array);die;

    /*===============================================================================/
    /                               knitting plan data                               /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_id");
    $sql="SELECT a.program_qnty,a.po_id from ppl_planning_entry_plan_dtls a where a.status_active=1 and a.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $program_data_array = array();
    foreach ($res as $val) 
    {
        $program_data_array[$po_wise_job_arr[$val['PO_ID']]] += $val['PROGRAM_QNTY'];
    }

    /*===============================================================================/
    /                               knitting production                              /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"c.po_breakdown_id");
    $sql="SELECT a.knitting_source,c.po_breakdown_id as po_id,c.quantity from inv_receive_master a,pro_grey_prod_entry_dtls b, order_wise_pro_details c where a.id=b.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and c.entry_form=2 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $knitting_data_array = array();
    foreach ($res as $val) 
    {
        $knitting_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['KNITTING_SOURCE']] += $val['QUANTITY'];
    }

    /*===============================================================================/
    /                               Dyed yarn issue                                  /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"c.po_breakdown_id");
    $sql = "SELECT c.po_breakdown_id as po_id, c.QUANTITY  from inv_issue_master a, inv_transaction b,order_wise_pro_details c,product_details_master d where a.id=b.mst_id and b.id=c.trans_id and d.id=c.prod_id and b.item_category=1 and b.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.dyed_type=1 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $dyed_yarn_issue_array = array();
    foreach ($res as $val) 
    {
        $dyed_yarn_issue_array[$po_wise_job_arr[$val['PO_ID']]] += $val['QUANTITY'];
    }
    // echo "<pre>";print_r($dyed_yarn_issue_array);die;

    /*===============================================================================/
    /                                Roll Data                         
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_breakdown_id");
    $sql = "SELECT a.po_breakdown_id,a.entry_form,a.qnty from pro_roll_details a where a.status_active=1 and a.is_deleted=0  $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $roll_data_array = array();
    foreach ($res as $val) 
    {
        $roll_data_array[$po_wise_job_arr[$val['PO_BREAKDOWN_ID']]][$val['ENTRY_FORM']] += $val['QNTY'];
    }

    /*===============================================================================/
    /                                Fab Dyeing Prodduction                          /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_id");
    $sql = "SELECT c.load_unload_id,a.po_id,c.batch_qty,c.production_qty from pro_batch_create_dtls a, pro_fab_subprocess b,pro_fab_subprocess_dtls c where a.mst_id=b.batch_id and b.id=c.mst_id and a.status_active=1 and b.status_active=1 and c.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and c.load_unload_id=2 and b.result=1 and b.entry_form=35 and b.shade_matched=1 and a.PROD_ID = c.PROD_ID and a.ROLL_ID = c.ROLL_ID and a.BARCODE_NO = c.BARCODE_NO $po_cond";
    // echo $sql;die;
    $res = sql_select($sql);
    $fab_dyeing_array = array();
    foreach ($res as $val) 
    {
        $fab_dyeing_array[$po_wise_job_arr[$val['PO_ID']]] += $val['PRODUCTION_QTY'];
    }

    /*===============================================================================/
    /                           Fab Dyeing fin process name                          /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_id");
    $sql = "SELECT DISTINCT a.po_id,b.process_id from pro_batch_create_dtls a, pro_fab_subprocess b where a.mst_id=b.batch_id and a.status_active=1 and b.status_active=1 and b.entry_form!=35 $po_cond";
    // echo $sql;die;
    $res = sql_select($sql);
    $fab_dyeing_process_array = array();
    $process_id_chk_array = array();
    foreach ($res as $val) 
    {
        if($process_id_chk_array[$val['PROCESS_ID']]=="")
        {
            $fab_dyeing_process_array[$po_wise_job_arr[$val['PO_ID']]] .= ($fab_dyeing_process_array[$po_wise_job_arr[$val['PO_ID']]]=="") ? $conversion_cost_head_array[$val['PROCESS_ID']] : ", ".$conversion_cost_head_array[$val['PROCESS_ID']];
            $process_id_chk_array[$val['PROCESS_ID']] = $val['PROCESS_ID'];
        }
    }

    // echo "<Pre>";print_r($fab_dyeing_process_array);die();

    /*===============================================================================/
    /                                  Finish Fabric Issue                           /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"c.po_breakdown_id");
    $sql = "SELECT c.po_breakdown_id as po_id,c.quantity from inv_issue_master a, inv_finish_fabric_issue_dtls b, order_wise_pro_details c where a.id=b.mst_id and b.id=c.dtls_id and a.status_active=1 and b.status_active=1 and c.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and c.entry_form=71 and trans_type=2 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $fin_fab_data_array = array();
    foreach ($res as $val) 
    {
        $fin_fab_data_array[$po_wise_job_arr[$val['PO_ID']]]['qty'] += $val['QUANTITY'];
    }

    /*===============================================================================/
    /                                   Cut & Lay data                               /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.order_id");
    $sql = "SELECT b.entry_date, a.order_id, a.bundle_no,a.size_qty from ppl_cut_lay_bundle a,ppl_cut_lay_mst b where b.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $po_cond";
    // echo $sql;die;
    $res = sql_select($sql);
    $lay_data_array = array();
    foreach ($res as $val) 
    {
        $lay_data_array[$po_wise_job_arr[$val['ORDER_ID']]]['entry_date'] .= $val['ENTRY_DATE'].",";
        $lay_data_array[$po_wise_job_arr[$val['ORDER_ID']]]['qty'] += $val['SIZE_QTY'];
        $lay_data_array[$po_wise_job_arr[$val['ORDER_ID']]]['no_of_bndl']++;
    }

    /*===============================================================================/
    /                              Printing & Emb QC Data                            /
    /============================================================================== */
    // 254=print, 325=emb
    $po_cond = where_con_using_array($po_array,0,"c.buyer_po_id");
    $sql = "SELECT a.product_date,a.entry_form, c.buyer_po_id,b.qcpass_qty from subcon_embel_production_mst a,subcon_embel_production_dtls b,subcon_ord_dtls c where a.id=b.mst_id and c.id=b.po_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form in(223,324) $po_cond";
    // echo $sql;die;
    $res = sql_select($sql);
    $emb_qc_data_array = array();
    foreach ($res as $val) 
    {
        $emb_qc_data_array[$po_wise_job_arr[$val['BUYER_PO_ID']]][$val['ENTRY_FORM']]['product_date'] .= $val['PRODUCT_DATE'].",";
        $emb_qc_data_array[$po_wise_job_arr[$val['BUYER_PO_ID']]][$val['ENTRY_FORM']]['qty'] += $val['QCPASS_QTY'];
    }
    // echo "<pre>";print_r($emb_qc_data_array);echo "</pre>";die();

    /*===============================================================================/
    /                            Printing & Emb Delivery Data                        /
    /============================================================================== */
    // 254=print, 325=emb
    $po_cond = where_con_using_array($po_array,0,"c.buyer_po_id");
    $sql = "SELECT a.delivery_date,a.entry_form, b.buyer_po_id,b.delivery_qty from subcon_delivery_mst a,subcon_delivery_dtls b,subcon_ord_dtls c where a.id=b.mst_id and c.id=b.order_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form in(254,325)  $po_cond";
    // echo $sql;die;
    $res = sql_select($sql);
    $emb_delivery_data_array = array();
    foreach ($res as $val) 
    {
        $emb_delivery_data_array[$po_wise_job_arr[$val['BUYER_PO_ID']]][$val['ENTRY_FORM']]['delivery_date'] .= $val['DELIVERY_DATE'].",";
        $emb_delivery_data_array[$po_wise_job_arr[$val['BUYER_PO_ID']]][$val['ENTRY_FORM']]['qty'] += $val['DELIVERY_QTY'];
    }
    // echo "<pre>";print_r($emb_delivery_data_array);echo "</pre>";die();

    /*===============================================================================/
    /                                  Gmts Production                               /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_break_down_id");
    $sql = "SELECT a.production_source,a.serving_company, a.production_date,a.production_type,a.po_break_down_id as po_id,b.production_qnty,a.embel_name from pro_garments_production_mst a,pro_garments_production_dtls b,wo_po_color_size_breakdown c where a.id=b.mst_id and c.id=b.color_size_break_down_id and c.po_break_down_id=a.po_break_down_id and c.status_active=1 and c.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $po_cond order by a.production_date";
    // echo $sql;
    $res = sql_select($sql);
    $gmts_data_array = array();
    $embel_data_array = array();
    foreach ($res as $val) 
    {
        $gmts_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']]['date'] .= $val['PRODUCTION_DATE'].",";
        $gmts_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']]['qty'] += $val['PRODUCTION_QNTY'];

        $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['date'] .= $val['PRODUCTION_DATE'].",";
        $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['source'] .= $val['PRODUCTION_SOURCE'].",";
        if($val['SERVING_COMPANY']==1)
        {
            $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['wo_com_id'] .= $company_library[$val['SERVING_COMPANY']].",";
        }
        else
        {
            $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['wo_com_id'] .= $supplier_library[$val['SERVING_COMPANY']].",";
        }
        $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['qty'] += $val['PRODUCTION_QNTY'];
    }
    // echo "<pre>";print_r($gmts_data_array);echo "</pre>";die();

    /*===============================================================================/
    /                            Printing & Emb Order Data                           /
    /============================================================================== */
    // 204=printing, 311=emb
    $po_cond = where_con_using_array($po_array,0,"b.buyer_po_id");
    $sql = "SELECT a.entry_form, b.buyer_po_id as po_id, b.order_quantity,b.order_uom from subcon_ord_mst a, subcon_ord_dtls b where a.id=b.mst_id and a.status_active=1 and b.status_active=1 and b.is_deleted=0 and a.is_deleted=0 and a.within_group=1 and a.entry_form in(204,311) $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $print_emb_order_data_array = array();
    foreach ($res as $val) 
    {
        if($val['ORDER_UOM']==2) // for dzn
        {
            $print_emb_order_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['ENTRY_FORM']]['qty'] += $val['ORDER_QUANTITY']*12;
        }
        else
        {
            $print_emb_order_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['ENTRY_FORM']]['qty'] += $val['ORDER_QUANTITY'];
        }
    }

    /*===============================================================================/
    /                                 Buyer Inspection                               /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_break_down_id");
    $sql = "SELECT a.job_no,a.inspection_qnty,to_char(a.inspection_date,'DD-MM-YYYY') as inspection_date from pro_buyer_inspection a where a.status_active=1 and a.is_deleted=0 $po_cond";
    $res = sql_select($sql);
    $buyer_insp_data = array();
    foreach ($res as $val) 
    {
        $buyer_insp_data[$val['JOB_NO']]['qty'] += $val['INSPECTION_QNTY'];
        $buyer_insp_data[$val['JOB_NO']]['date'] = $val['INSPECTION_DATE'];
    }

    /*===============================================================================/
    /                                  ex-factory data                               /
    /============================================================================== */
    $sql = "SELECT a.id,a.po_break_down_id as po_id,a.ex_factory_date,(case when a.entry_form !=85 then b.production_qnty else 0 end) as production_qnty,(case when a.entry_form =85 then b.production_qnty else 0 end) as return_qnty,a.total_carton_qnty from pro_ex_factory_mst a,pro_ex_factory_dtls b where a.id=b.mst_id and a.status_active=1 and b.status_active=1 and a.is_deleted=0 and b.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $ex_data_array = array();
    $id_chk_array = array();
    foreach ($res as $val) 
    {
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['ex_date'] .= $val['EX_FACTORY_DATE'].",";
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['ex_qty'] += $val['PRODUCTION_QNTY']-$val['RETURN_QNTY'];
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['rtn_qty'] += $val['RETURN_QNTY'];
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['ex_value'] += (($val['PRODUCTION_QNTY']-$val['RETURN_QNTY'])*$po_wise_unit_price_array[$val['PO_ID']]);
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['ex_rtn_value'] += ($val['RETURN_QNTY']*$po_wise_unit_price_array[$val['PO_ID']]);
        if(!in_array($val['ID'], $id_chk_array))
        {
            $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['cartot_qnty'] += $val['TOTAL_CARTON_QNTY'];
            $id_chk_array[$val['ID']] = $val['ID'];
        }
    }
    // echo "<pre>";print_r($ex_data_array);die();
    /*===============================================================================/
    /                                 Export Invoice                                 /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"b.po_breakdown_id");
    $sql = "SELECT b.po_breakdown_id as po_id,b.current_invoice_qnty,b.current_invoice_value,a.invoice_no,a.net_invo_value,a.discount_ammount from com_export_invoice_ship_mst a, com_export_invoice_ship_dtls b where a.id=b.mst_id and a.status_active=1 and b.status_active=1 and a.is_deleted=0 and b.is_deleted=0 $po_cond";
    $res = sql_select($sql);
    $invice_data = array();
    $chk_inv = array();
    foreach ($res as $val) 
    {
        $invice_data[$po_wise_job_arr[$val['PO_ID']]]['inv_qty']+=$val['CURRENT_INVOICE_QNTY'];
        $invice_data[$po_wise_job_arr[$val['PO_ID']]]['inv_value']+=$val['CURRENT_INVOICE_VALUE'];
        if($chk_inv[$val['INVOICE_NO']]=="")
        {
            $invice_data[$po_wise_job_arr[$val['PO_ID']]]['net_inv_value']+=$val['NET_INVO_VALUE'];
            $invice_data[$po_wise_job_arr[$val['PO_ID']]]['discount_ammount']+=$val['DISCOUNT_AMMOUNT'];
            $chk_inv[$val['INVOICE_NO']] = $val['INVOICE_NO'];
        }
    }

    /*===============================================================================/
    /                                      LC/SC data                                /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"b.wo_po_break_down_id");
    $sql = "SELECT b.wo_po_break_down_id as po_id,a.lien_bank,a.pay_term,a.internal_file_no,a.tenor,max(c.amendment_no) as amendment_no from com_export_lc a,com_export_lc_order_info b, com_export_lc_amendment c where a.id=b.com_export_lc_id AND a.export_lc_no = c.export_lc_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $po_cond group by b.wo_po_break_down_id,a.lien_bank,a.pay_term,a.internal_file_no,a.tenor
    UNION ALL
    SELECT b.wo_po_break_down_id as po_id,a.lien_bank,a.pay_term,a.internal_file_no,a.tenor,max(c.amendment_no) as amendment_no from com_sales_contract a,com_sales_contract_order_info b,com_sales_contract_amendment c where a.id=b.com_sales_contract_id and a.contract_no=c.contract_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $po_cond group by b.wo_po_break_down_id,a.lien_bank,a.pay_term,a.internal_file_no,a.tenor
    ";
    // echo $sql;die();
    $res = sql_select($sql);
    $lc_sc_data_array = array();
    foreach ($res as $val) 
    {
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['lien_bank'] .= $bank_library[$val['LIEN_BANK']].",";
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['pay_term'] .= $pay_term[$val['PAY_TERM']].",";
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['internal_file_no'] .= $val['INTERNAL_FILE_NO'].",";
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['tenor'] .= $val['TENOR'].",";
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['amendment_no'] .= $val['AMENDMENT_NO'].",";
    }
    // echo "<pre>";print_r($lc_sc_data_array);die();

    /*===============================================================================/
    /                                      TNA Data                                  /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_number_id");
    $sql = "SELECT a.po_number_id,a.task_number,max(a.task_start_date) as start_date,max(a.task_finish_date) as end_date,max(a.actual_start_date) as actual_start_date,max(a.actual_finish_date) as actual_finish_date,b.job_no_mst from tna_process_mst a,wo_po_break_down b where a.po_number_id=b.id and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and a.task_start_date is not null and b.po_quantity>0 $po_cond and a.task_type=1 group by a.po_number_id,a.task_number,b.job_no_mst";
    // echo $sql;die();
    $res = sql_select($sql);
    $tnaDateArray = array();
    foreach ($res as $val) 
    {
        $tnaDateArray[$val['JOB_NO_MST']][$val['TASK_NUMBER']]['start_date']          = $val['START_DATE'];
        $tnaDateArray[$val['JOB_NO_MST']][$val['TASK_NUMBER']]['end_date']            = $val['END_DATE'];
        $tnaDateArray[$val['JOB_NO_MST']][$val['TASK_NUMBER']]['actual_start_date']   = $val['ACTUAL_START_DATE'];
        $tnaDateArray[$val['JOB_NO_MST']][$val['TASK_NUMBER']]['actual_finish_date']  = $val['ACTUAL_FINISH_DATE'];
    }

    // echo "<pre>";print_r($tnaDateArray);die();
    /*===============================================================================/
    /                                    Budget Data                                 /
    /============================================================================== */
    $job_id_cond = where_con_using_array($job_id_array,0,"a.job_id");
    $sql = "SELECT a.job_no,to_char(a.costing_date,'DD-MM-YYYY') as costing_date,a.approved,b.cm_cost from wo_pre_cost_mst a,wo_pre_cost_dtls b where a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.job_id=b.job_id $job_id_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $budget_data_array = array();
    foreach ($res as $val) 
    {
        $budget_data_array[$val['JOB_NO']]['costing_date'] = $val['COSTING_DATE'];
        $budget_data_array[$val['JOB_NO']]['approved'] = $val['APPROVED'];
        $budget_data_array[$val['JOB_NO']]['cm_cost'] = $val['CM_COST'];
    }

    /*===============================================================================/
    /                              Getting data from class                           /
    /============================================================================== */
    $poIDS = implode(",", $po_array);
    $condition= new condition();     
    $condition->po_id_in($poIDS);     
    $condition->init();
    // $fabric= new fabric($condition);
    $yarn= new yarn($condition);
    $yarn_costing_arr=$yarn->getJobWiseYarnAmountArray();
    $yarn_qty_amount_arr=$yarn->getJobWiseYarnQtyAndAmountArray();

    $yarnDataWithFabricidArr=$yarn->get_By_Precostfabricdtlsid_YarnQtyAmountArray();

    $fabric= new fabric($condition);
    $fabricAmoutByFabricSource= $fabric->getAmountArray_by_job_knitAndwoven_greyAndfinish();
    $fabricQtyByFabricSource= $fabric->getQtyArray_by_job_knitAndwoven_greyAndfinish_purchase();
    
    $fabric_qty_arr=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
    $fabric_amount_arr=$fabric->getAmountArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
    $conversion= new conversion($condition);
    $conversion_costing_arr_process=$conversion->getAmountArray_by_job();
    $conv_qty_job_process= $conversion->getQtyArray_by_jobAndProcess();
    $conv_amount_job_process= $conversion->getAmountArray_by_jobAndProcess();
    $con_qty_fabric_process = $conversion->getQtyArray_by_fabricAndProcess();
    $con_amount_fabric_process = $conversion->getAmountArray_by_fabricAndProcess();

    $trims= new trims($condition);
    $trims_costing_arr=$trims->getAmountArray_by_job();
    $trims_qty_arr=$trims->getQtyArray_by_job();

    $emblishment= new emblishment($condition);
    $emblishment_costing_arr=$emblishment->getAmountArray_by_job();
    $emb_qty_job_name_arr = $emblishment->getQtyArray_by_jobAndEmbname();
    $emb_amount_job_name_arr = $emblishment->getAmountArray_by_jobAndEmbname();
    // echo "<pre>";print_r($emb_qty_job_name_arr);die();

    $wash= new wash($condition);
    $emblishment_costing_arr_wash=$wash->getAmountArray_by_job();
    $wash_qty_job_name_arr =$wash->getQtyArray_by_jobAndEmbname();
    $wash_amount_job_name_arr =$wash->getAmountArray_by_jobAndEmbname();


    $commercial= new commercial($condition);
    $commercial_costing_arr=$commercial->getAmountArray_by_job();
    $commission= new commision($condition);
    $commission_costing_arr=$commission->getAmountArray_by_job();
    $other= new other($condition);
    $other_costing_arr=$other->getAmountArray_by_job();


    /*===============================================================================/
    /                        Functin for getting max min date                        /
    /============================================================================== */
    function get_max_min_date($date_arr)
    {
        $date_array = array();
        if(count($date_arr)>0)
        {
            if(count($date_arr)==1)
            {
                $date_arr = explode(",", implode(",", $date_arr));
                $date_array['max_date'] = $date_arr[0];
                $date_array['min_date'] = $date_arr[0];
                return $date_array;
            }
            else
            {       
                $date_arr = explode(",", implode(",", $date_arr));         
                for ($i = 0; $i < count($date_arr); $i++)
                {
                    if ($i == 0)
                    {
                        $max_date = date('d-m-Y', strtotime($date_arr[$i]));
                        $min_date = date('d-m-Y', strtotime($date_arr[$i]));
                        $date_array['max_date'] = $max_date;
                        $date_array['min_date'] = $min_date;
                    }
                    elseif ($i != 0)
                    {
                        $new_date = date('d-m-Y', strtotime($date_arr[$i]));
                        if ($new_date > $max_date)
                        {
                            $max_date = $new_date;
                            $date_array['max_date'] = $max_date;
                        }
                        elseif ($new_date < $min_date)
                        {
                            $min_date = $new_date;
                            $date_array['min_date'] = $min_date;
                        }
                    }
                }
                return $date_array;
            }
        }
        else
        {
            return $date_array;
        }
    }

    $tbl_width = 25470;

    ob_start();
    ?>
    <fieldset>
        <div class="title-part" style="margin: 0 auto;text-align: center;font-size: 20px;">
            <h2>Order Tracking Report</h2>
            <h2>Company : <?=$company_library[$company_name]; ?></h2>
            <? if($date_from!=""){?>
            <h2>Date : <?=change_date_format($date_from); ?>To<?=change_date_format($date_to); ?> </h2>
            <? } ?>
        </div>
        <style type="text/css">
            table thead tr td{
                padding: 5px;text-align: center;font-weight: bold;font-size: 16px;
            }
            .zoom {
              padding: 0px;
              transition: transform .2s; 
              width: 30px;
              height: 30px;
              margin: 0 auto;
              z-index: 9999 !important;
              overflow: hidden !important;
              visibility: visible;
              position: relative;
            }

            .zoom:hover {
              transform: scale(4); 

              z-index: 9999 !important;
              overflow: hidden !important;
              visibility: visible;
            }
        </style>
        <div class="report-container-part">
            <!-- ================================= report header ================================== -->
            <table cellspacing="0" border="1" class="rpt_table"   rules="all" width="<?=$tbl_width;?>"  align="center" id="table_header_1">
                <thead>
                    <tr>
                        <td style="background: #95DAC1;" colspan="86">Order Information</td>
                        <td style="background: #FACE7F;" colspan="5">Budget Information</td>
                        <td style="background: #5C7AEA;" colspan="14">Main Fabric Booking Information</td>
                        <td style="background: #F56FAD;" colspan="8">Purchase Fabric Booking Information</td>
                        <td style="background: #A2CDCD;" colspan="9">Short/EFR Fabric Booking Information</td>
                        <th width="80" rowspan="2"><p>Trims/Acc Status</p></th>
                        <td style="background: #F0D9FF;" colspan="6">Grey Yarn Status</td>
                        <td style="background: #B1E693;" colspan="8">Dyed Yarn Status (Business not ready)</td>
                        <td style="background: #63B4B8;" colspan="7">Yarn Dyed Production Status (Business not ready)</td>
                        <td style="background: #E05D5D;" colspan="13">Knitting Status</td>
                        <td style="background: #C8C6C6;" colspan="9">Grey Fabric Store Status</td>
                        <td style="background: #BFA2DB;" colspan="6">Dyeing Status</td>
                        <td style="background: #6B7AA1;" colspan="12">Dyeing Finishing Status</td>
                        <td style="background: #C1CFC0;" colspan="10">Finish Fabric Store Status</td>
                        <td style="background: #8FC1D4;" colspan="23">Cutting Status</td>
                        <td style="background: #FFF5B7;" colspan="7">Print Status</td>
                        <td style="background: #FF449F;" colspan="7">Embroidery Status</td>
                        <td style="background: #EBA83A;" colspan="9">Sewing Status</td>
                        <td style="background: #B5FFD9;" colspan="9">Garments Finishing Status</td>
                        <td style="background: #E798AE;" colspan="20">Shipment Status</td>
                        <td style="background: #867AE9;" colspan="25">Budget VS Actual</td>
                        <td style="background: #C449C2;" colspan="25">Order Activities/TNA</td>
                    </tr>
                    <tr>
                        <th width="30"><p>Sl.</p></th>
                        <th width="60"><p>Order Status</p></th>
                        <th width="100"><p>LC Company</p></th>
                        <th width="80"><p>Image</p></th>
                        <th width="100"><p>Buyer</p></th>
                        <th width="50"><p>Year</p></th>
                        <th width="90"><p>Job</p></th>
                        <th width="80"><p>Repeat Job No</p></th>
                        <th width="80"><p>Sample Req. No</p></th>
                        <th width="80"><p>Style Ref</p></th>
                        <th width="80"><p>Style Desc</p></th>
                        <th width="80"><p>Gmts Item</p></th>
                        <th width="80"><p>Season</p></th>
                        <th width="80"><p>Prod Dept</p></th>
                        <th width="80"><p>Prod. Dept Code / Class</p></th>
                        <th width="80"><p>Sub Dept</p></th>
                        <th width="80"><p>Brand</p></th>
                        <th width="80"><p>Prod. Catg</p></th>
                        <th width="80"><p>Country</p></th>
                        <th width="80"><p>Sustainability Standard</p></th>
                        <th width="80"><p>Fabric Material</p></th>
                        <th width="80"><p>Order Nature</p></th>
                        <th width="80"><p>Quality Label</p></th>
                        <th width="80"><p>Embilshement Name</p></th>
                        <th width="80"><p>Service Name</p></th>
                        <th width="80"><p>Order/PO No</p></th>
                        <th width="80"><p>Actual Order/PO No</p></th>
                        <th width="80"><p>GMT Color</p></th>
                        <th width="80"><p>Size</p></th>
                        <th width="80"><p>Ex Cut %</p></th>
                        <th width="80"><p>Order Qnty [Pcs]</p></th>
                        <th width="80"><p>Break Down Order Qnty [Pcs]</p></th>
                        <th width="80"><p>Order Qnty with Cut% [Pcs]</p></th>
                        <th width="80"><p>Order Qnty [Uom]</p></th>
                        <th width="80"><p>Uom</p></th>
                        <th width="80"><p>Per Unit Price</p></th>
                        <th width="80"><p>Order Value</p></th>
                        <th width="80"><p>PO Insert Date</p></th>
                        <th width="80"><p>PO Receive Date</p></th>
                        <th width="80"><p>Fabric Budget Start Date</p></th>
                        <th width="80"><p>1st Cut Date</p></th>
                        <th width="80"><p>Last Cut Date</p></th>
                        <th width="80"><p>1st Sew Date</p></th>
                        <th width="80"><p>Last Sew Date</p></th>
                        <th width="80"><p>1st Finish Date</p></th>
                        <th width="80"><p>Last Finish Date</p></th>
                        <th width="80"><p>Insp. Offer Date</p></th>
                        <th width="80"><p>Insp. Date</p></th>
                        <th width="80"><p>Pub. Shipment Date</p></th>
                        <th width="80"><p>First Shipment Date </p></th>
                        <th width="80"><p>Org. Shipment Date </p></th>
                        <th width="80"><p>ETD/LDD Date</p></th>
                        <th width="80"><p>Cut-off Date</p></th>
                        <th width="80"><p>Country Shipment Date</p></th>
                        <th width="80"><p>RFI Plan Date</p></th>
                        <th width="80"><p>Shipment Mode</p></th>
                        <th width="80"><p>Lead Time</p></th>
                        <th width="80"><p>Days in Hand</p></th>
                        <th width="80"><p>Commercial File No</p></th>
                        <th width="80"><p>Lien Bank</p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p>Ex. LC/SC Amendment No(Last)</p></th>
                        <th width="80"><p>Pay Term</p></th>
                        <th width="80"><p>Tenor</p></th>
                        <th width="80"><p>First Shipment Date</p></th>
                        <th width="80"><p>Last Shipment Date</p></th>
                        <th width="80"><p>Shipment Qnty</p></th>
                        <th width="80"><p>Shipment Value</p></th>
                        <th width="80"><p>Excess Shipment Qnty</p></th>
                        <th width="80"><p>Excess Shipment Value</p></th>
                        <th width="80"><p>Short Shipment Qnty</p></th>
                        <th width="80"><p>Short Shipment Value</p></th>
                        <th width="80"><p>Shipping Status</p></th>
                        <th width="80"><p>SMV</p></th>
                        <th width="80"><p>Total SMV</p></th>
                        <th width="80"><p>CM</p></th>
                        <th width="80"><p>Team Leader</p></th>
                        <th width="80"><p>Dealing Merchandiser</p></th>
                        <th width="80"><p>Factory Merchandiser</p></th>
                        <th width="80"><p>Insert User</p></th>
                        <th width="80"><p>Lab Dip No</p></th>
                        <th width="80"><p>Buyer Sample Status</p></th>
                        <th width="80"><p>Order Status</p></th>
                        <th width="80"><p>Referance Closed </p></th>
                        <th width="80"><p>Emb. Work Order No</p></th>
                        <th width="80"><p>Service Work Order No</p></th>

                        <th width="80"><p>Budget Date</p></th>
                        <th width="80"><p>Budget Value</p></th>
                        <th width="80"><p>Open Value</p></th>
                        <th width="80"><p>Approved</p></th>
                        <th width="80"><p>Amendment No</p></th>
                        
                        <th width="80"><p>M Fabric Booking Date</p></th>
                        <th width="80"><p>M Fabric Booking No</p></th>
                        <th width="80"><p>Fabric Delivery Date</p></th>
                        <th width="80"><p>Amendment No</p></th>
                        <th width="80"><p>Amendment Date</p></th>
                        <th width="80"><p>Approved Status</p></th>
                        <th width="80"><p>Yarn Description</p></th>
                        <th width="80"><p>Fabric Construction</p></th>
                        <th width="80"><p>Fabric Composition</p></th>
                        <th width="80"><p>GSM</p></th>
                        <th width="80"><p>Dia/Width</p></th>
                        <th width="80"><p>Grey Qnty Kg</p></th>
                        <th width="80"><p>Finish Quantity</p></th>
                        <th width="80"><p>Process Loss%</p></th>

                        <th width="80"><p>Fabric Booking Date</p></th>
                        <th width="80"><p>Fabric Booking No</p></th>
                        <th width="80"><p>Fabric Delivery Date</p></th>
                        <th width="80"><p>Fabrication</p></th>
                        <th width="80"><p>Uom</p></th>
                        <th width="80"><p>Qnty</p></th>
                        <th width="80"><p>Supplier</p></th>
                        <th width="80"><p>Approved Status</p></th>

                        <th width="80"><p>Fabric Booking Date</p></th>
                        <th width="80"><p>Fabric Booking No</p></th>
                        <th width="80"><p>Fabric Delivery Date</p></th>
                        <th width="80"><p>Fabrication</p></th>
                        <th width="80"><p>Uom</p></th>
                        <th width="80"><p>Grey Qnty</p></th>
                        <th width="80"><p>Finish Quantity</p></th>
                        <th width="80"><p>Process Loss%</p></th>
                        <th width="80"><p>Approved Status</p></th>

                        <th width="80"><p>Grey Yarn Require with Short/EFR Qnty</p></th>
                        <th width="80"><p>Yarn Allocation Qnty</p></th>
                        <th width="80"><p>Yarn Excess Allocation Qnty</p></th>
                        <th width="80"><p>Yarn Issued Qnty</p></th>
                        <th width="80"><p>Yarn Issue Balance Qnty</p></th>
                        <th width="80"><p>Yarn Excess Issued Qty </p></th>

                        <th width="80"><p>Dyed Yarn Require with Short/EFR Qnty</p></th>
                        <th width="80"><p>Dyed Yarn Allocation Qnty</p></th>
                        <th width="80"><p>Dyed Yarn Excess Allocation Qnty</p></th>
                        <th width="80"><p>Dyed Yarn Received Qnty</p></th>
                        <th width="80"><p>Dyed Yarn Receive Balance Qnty</p></th>
                        <th width="80"><p>Dyed Yarn Issued Qnty</p></th>
                        <th width="80"><p>Dyed Yarn Issue Balance Qnty</p></th>
                        <th width="80"><p>Dyed Yarn Excess Issued Qty </p></th>

                        <th width="80"><p>Dyed Yarn Require with Short/EFR Qnty</p></th>
                        <th width="80"><p>Service Work Order Qty</p></th>
                        <th width="80"><p>Yarn Dyed Produciton Qty</p></th>
                        <th width="80"><p>Yarn Dyed Produciton WIP Qty</p></th>
                        <th width="80"><p>Yarn Dyed Delivery Qty</p></th>
                        <th width="80"><p>Yarn Dyed Challan No</p></th>
                        <th width="80"><p>Yarn Dyed Challan Date</p></th>

                        <th width="80"><p>Knitting Require with EFR Qnty</p></th>
                        <th width="80"><p>Knitting Plan Qnty</p></th>
                        <th width="80"><p>Knitting Plan WIP Qnty</p></th>
                        <th width="80"><p>Knitting Work Order No</p></th>
                        <th width="80"><p>Knitting Production Qnty [Inbound]</p></th>
                        <th width="80"><p>Knitting Production Qnty [Outbound]</p></th>
                        <th width="80"><p>TTL Knitting Production Qnty </p></th>
                        <th width="80"><p>TTL Knitting Excess Production Qnty</p></th>
                        <th width="80"><p>TTL Knitting Production WIP Qnty</p></th>
                        <th width="80"><p>Price/KG [TK]</p></th>
                        <th width="80"><p>Total Price [TK]</p></th>
                        <th width="80"><p>Knitting Grey Fabric Delivery Qnty To Store</p></th>
                        <th width="80"><p>Closing Status</p></th>

                        <th width="80"><p>Require with Short/EFR Qnty</p></th>
                        <th width="80"><p>Normal Received Qnty</p></th>
                        <th width="80"><p>Receive Balance Qnty</p></th>
                        <th width="80"><p>Transfer Received Qnty</p></th>
                        <th width="80"><p>TTL Fabric Received Qnty</p></th>
                        <th width="80"><p>Normal Issued Qnty</p></th>
                        <th width="80"><p>Trasfered Issued Qnty</p></th>
                        <th width="80"><p>TTL Fabric Issued Qnty</p></th>
                        <th width="80"><p>Stock In Hand</p></th>

                        <th width="80"><p>Require with Short/EFR Qnty</p></th>
                        <th width="80"><p>Fabric Received by Batch </p></th>
                        <th width="80"><p>Batch Qnty</p></th>
                        <th width="80"><p>Production Qnty</p></th>
                        <th width="80"><p>Production Excess Qnty</p></th>
                        <th width="80"><p>Production WIP Qnty</p></th>

                        <th width="80"><p>Require with Short/EFR Qnty</p></th>
                        <th width="80"><p>Production Qnty</p></th>
                        <th width="80"><p>Production Excess Qnty</p></th>
                        <th width="80"><p>Production WIP Qnty</p></th>
                        <th width="80"><p>Process Name</p></th>
                        <th width="80"><p>QC Received Qnty</p></th>
                        <th width="80"><p>AOP Issue Qnty</p></th>
                        <th width="80"><p>AOP Receive Qnty</p></th>
                        <th width="80"><p>AOP Receive WIP Qnty</p></th>
                        <th width="80"><p>QC Delivery Qnty To Store</p></th>
                        <th width="80"><p>QC Stock in Hand</p></th>
                        <th width="80"><p>Closing Status</p></th>

                        <th width="80"><p>Require with Short/EFR Qnty</p></th>
                        <th width="80"><p>Received Qnty</p></th>
                        <th width="80"><p>Receive Excess Qnty</p></th>
                        <th width="80"><p>Receive Balance Qnty</p></th>
                        <th width="80"><p>Transfer Received Qnty</p></th>
                        <th width="80"><p>TTL Received Qnty</p></th>
                        <th width="80"><p>Normal Issued Qnty</p></th>
                        <th width="80"><p>Trasfered Issued Qnty</p></th>
                        <th width="80"><p>TTL Issued Qnty</p></th>
                        <th width="80"><p>Stock In Hand</p></th>

                        <th width="80"><p>Require with Short/EFR Qnty</p></th>
                        <th width="80"><p>Fabric Receive Qnty By Cutting</p></th>
                        <th width="80"><p>Excess Receive Qnty By Cutting </p></th>
                        <th width="80"><p>Receive Balance Qnty By Cutting</p></th>
                        <th width="80"><p>Cutting Status</p></th>
                        <th width="80"><p>Oreder Qnty</p></th>
                        <th width="80"><p>Excess Cutting %</p></th>
                        <th width="80"><p>Order Qnty with Cut%</p></th>
                        <th width="80"><p>Cutting Bundle Qnty</p></th>
                        <th width="80"><p>Cutting Lay Qnty</p></th>
                        <th width="80"><p>Cutting Production [QC] Qnty</p></th>
                        <th width="80"><p>Excess Cutting Qnty</p></th>
                        <th width="80"><p>Cutting Production Balance Qnty</p></th>
                        <th width="80"><p>Input Qnty</p></th>
                        <th width="80"><p>Input WIP Qnty</p></th>
                        <th width="80"><p>Print Send Qnty</p></th>
                        <th width="80"><p>Print Receive Qnty</p></th>
                        <th width="80"><p>Print WIP Qnty</p></th>
                        <th width="80"><p>Print Supplier</p></th>
                        <th width="80"><p>EMB Send Qnty</p></th>
                        <th width="80"><p>EMB Receive Qnty</p></th>
                        <th width="80"><p>EMB WIP Balance Qnty</p></th>
                        <th width="80"><p>EMB Supplier</p></th>

                        <th width="80"><p>Require Qnty</p></th>
                        <th width="80"><p>Order Qnty</p></th>
                        <th width="80"><p>Order Balance Qnty</p></th>
                        <th width="80"><p>Production [QC] Qnty</p></th>
                        <th width="80"><p>Production Excess Qnty</p></th>
                        <th width="80"><p>Production WIP Qnty</p></th>
                        <th width="80"><p>Delivery Qnty To Cutting</p></th>

                        <th width="80"><p>Require Qnty</p></th>
                        <th width="80"><p>Work Order Qnty</p></th>
                        <th width="80"><p>Work Order Balance Qnty</p></th>
                        <th width="80"><p>Production [QC] Qnty</p></th>
                        <th width="80"><p>Production Excess Qnty</p></th>
                        <th width="80"><p>Production WIP Qnty</p></th>
                        <th width="80"><p>Delivery Qnty To Cutting</p></th>

                        <th width="80"><p>Order Qnty</p></th>
                        <th width="80"><p>Require Cut% Qnty</p></th>
                        <th width="80"><p>Input Qnty</p></th>
                        <th width="80"><p>Input Excess Qnty</p></th>
                        <th width="80"><p>Input Balance Qnty</p></th>
                        <th width="80"><p>Production [Output] Qnty</p></th>
                        <th width="80"><p>Production Excess Qnty</p></th>
                        <th width="80"><p>Balance Qty</p></th>
                        <th width="80"><p>Production WIP Qnty</p></th>

                        <th width="80"><p>Require Qnty</p></th>
                        <th width="80"><p>Iron Qnty</p></th>
                        <th width="80"><p>Hangtag Qnty</p></th>
                        <th width="80"><p>Poly Qnty</p></th>
                        <th width="80"><p>Finish Quantity</p></th>
                        <th width="80"><p>Balance Qty</p></th>
                        <th width="80"><p>Inspection Offer Date</p></th>
                        <th width="80"><p>Inspection Date</p></th>
                        <th width="80"><p>Inspection Qnty</p></th>

                        <th width="80"><p>Carton Qty</p></th>
                        <th width="80"><p>Shipment Qnty</p></th>
                        <th width="80"><p>Invoice Qty</p></th>
                        <th width="80"><p>Shipment Value</p></th>
                        <th width="80"><p>Invoice Value</p></th>
                        <th width="80"><p>Net Invoice Value</p></th>
                        <th width="80"><p>Excess Shipment Qnty</p></th>
                        <th width="80"><p>Excess Shipment Value </p></th>
                        <th width="80"><p>Short Shipment Qnty</p></th>
                        <th width="80"><p>Short Shipment Value</p></th>
                        <th width="80"><p>Shipment Return Qnty</p></th>
                        <th width="80"><p>Shipment Return Value</p></th>
                        <th width="80"><p>First Shipment Date</p></th>
                        <th width="80"><p>Last Shipment Date</p></th>
                        <th width="80"><p>Discount / Penalty / Claim Amount</p></th>
                        <th width="80"><p>Reason of Discount / Penalty / Claim </p></th>
                        <th width="80"><p>Order to Ship Qty </p></th>
                        <th width="80"><p>Order to Ship % </p></th>
                        <th width="80"><p>Cut to Ship Qty </p></th>
                        <th width="80"><p>Cut to Ship % </p></th>

                        <th width="80"><p>Budget Date</p></th>
                        <th width="80"><p>Budget Yarn Cost</p></th>
                        <th width="80"><p>Actual Yarn Cost</p></th>
                        <th width="80"><p>Budget Finish YD Cost</p></th>
                        <th width="80"><p>Actual Finish YD Cost</p></th>
                        <th width="80"><p>Budget Knitting Cost</p></th>
                        <th width="80"><p>Actual Knitting Cost</p></th>
                        <th width="80"><p>Budget Dyeing & Finishing Cost</p></th>
                        <th width="80"><p>Actual Dyeing & Finishing Cost</p></th>
                        <th width="80"><p>Budget Fabric Purchase Cost</p></th>
                        <th width="80"><p>Actual Fabric Purchase Cost</p></th>
                        <th width="80"><p>Budget AOP Cost</p></th>
                        <th width="80"><p>Actual AOP Cost</p></th>
                        <th width="80"><p>Budget Print Cost</p></th>
                        <th width="80"><p>Actual Print Cost</p></th>
                        <th width="80"><p>Budget Emb Cost</p></th>
                        <th width="80"><p>Actual Emb Cost</p></th>
                        <th width="80"><p>Budget Wash Cost</p></th>
                        <th width="80"><p>Actual Wash Cost</p></th>
                        <th width="80"><p>Budget Trims Cost</p></th>
                        <th width="80"><p>Actual Trims Cost</p></th>
                        <th width="80"><p>Budget MISC Cost</p></th>
                        <th width="80"><p>Actual MISC Cost</p></th>
                        <th width="80"><p>Budget CM</p></th>
                        <th width="80"><p>Actual CM</p></th>

                        <th width="80"><p>Lead Time [Templete]</p></th>
                        <th width="80"><p>Yarn Receive Start</p></th>
                        <th width="80"><p>Yarn Receive End</p></th>
                        <th width="80"><p>Knitting Start</p></th>
                        <th width="80"><p>Knitting End</p></th>
                        <th width="80"><p>Dyeing Start</p></th>
                        <th width="80"><p>Dyeing End</p></th>
                        <th width="80"><p>Finish Fabric Prod. Start</p></th>
                        <th width="80"><p>Finish Fabric Prod. End</p></th>
                        <th width="80"><p>Trims Receive Start</p></th>
                        <th width="80"><p>Trims Receive End</p></th>
                        <th width="80"><p>Cutting Start</p></th>
                        <th width="80"><p>Cutting End</p></th>
                        <th width="80"><p>Print Start</p></th>
                        <th width="80"><p>Print End</p></th>
                        <th width="80"><p>Emb Start</p></th>
                        <th width="80"><p>Emb End</p></th>
                        <th width="80"><p>Sewing Start</p></th>
                        <th width="80"><p>Sewing End</p></th>
                        <th width="80"><p>GMT Finihsing Start</p></th>
                        <th width="80"><p>GMT Finihsing End</p></th>
                        <th width="80"><p>Inspection Start</p></th>
                        <th width="80"><p>Inspection End</p></th>
                        <th width="80"><p>Shipment  Start</p></th>
                        <th width="80"><p>Shipment  End</p></th>
                    </tr>
                </thead>
            </table>
            <!-- =================================== report body ==================================== -->
            <div style=" max-height:300px; width:<?=$tbl_width+20;?>px; overflow-y:scroll;" id="scroll_body">
                <table cellspacing="0" border="1" class="rpt_table"   rules="all" width="<?=$tbl_width;?>"  align="center" id="table_body">
                    <tbody>
                        <?
                        $i=1;
                        $gr_job_total = 0;
                        $gr_po_total = 0;
                        $gr_color_size_total = 0;
                        $gr_plan_cut_total = 0;
                        $gr_order_value_total = 0;

                        foreach ($data_array as $job_key => $row) 
                        {   
                            $bgcolor=($i%2==0)?"#E9F3FF":"#FFFFFF";   
                            $ship_excess_qty = max($ex_data_array[$job_key]['ex_qty'] - $row['order_quantity'],0);
                            $ship_excess_val = max($ex_data_array[$job_key]['ex_value'] - $row['order_value'],0); 
                            $ship_short_qty = max($row['order_quantity'] - $ex_data_array[$job_key]['ex_qty'],0);
                            $ship_short_val = max($row['order_value'] - $ex_data_array[$job_key]['ex_value'],0);

                            // =============================== for budget data ===========================
                            $finishing_arr = array('209','165','33','94','63','171','65','170','156','179','200','208','127','125','84','68','128','190','242','240','192','172','90','218','67','197','73','66','185','142');
                            $total_finishing_amount=0;
                            $total_finishing_qty=0;
                            $other_cost_attr = array('inspection','freight','certificate_pre_cost','deffdlc_cost','design_cost','studio_cost','common_oh','interest_cost','incometax_cost','depr_amor_pre_cost');
                            $total_other_cost = 0;
                            foreach ($other_cost_attr as $attr) {
                                $total_other_cost+=$other_costing_arr[$job_key][$attr];
                            }
                            $misc_cost=$other_costing_arr[$job_key]['lab_test']+$commercial_costing_arr[$job_key]+$commission_costing_arr[$job_key]+$total_other_cost;

                            foreach ($finishing_arr as $fid) {
                                $total_finishing_amount += array_sum($conv_amount_job_process[$job_key][$fid]);
                                $total_finishing_qty += array_sum($conv_qty_job_process[$job_key][$fid]);
                            }

                            $total_fabic_cost=0;
                            if(count($conv_amount_job_process[$job_key][31])>0){
                                $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][31])/array_sum($conv_qty_job_process[$job_key][31]);
                            }
                            $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][31]);
                            $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][31])/$order_values*100;
                            if(count($conv_amount_job_process[$job_key][30])>0){
                                $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][30])/array_sum($conv_qty_job_process[$job_key][30]);
                            }
                            if($yarn_qty_amount_arr[$job_key]['amount']!=''){
                                $total_fabic_cost+=$yarn_qty_amount_arr[$job_key]['amount']/$yarn_qty_amount_arr[$job_key]['qty'];
                            }
                            $total_fabric_amount +=$yarn_qty_amount_arr[$job_key]['amount']; 
                            $total_fabric_per +=$yarn_qty_amount_arr[$job_key]['amount']/$order_values*100;
                            if($total_finishing_amount!=0){
                                $total_fabic_cost+=$total_finishing_amount/$total_finishing_qty;
                            } 
                            $total_fabric_amount +=$total_finishing_amount;
                            $total_fabric_per +=$total_finishing_amount/$order_values*100;
                            $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][30]);
                            $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][30])/$order_values*100;
                            if(count($conv_amount_job_process[$job_key][35])>0){
                                $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][35])/array_sum($conv_qty_job_process[$job_key][35]);
                            }
                            $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][35]); 
                            $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][35])/$order_values*100;
                            if(count($conv_amount_job_process[$job_key][1])>0){
                                $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][1])/array_sum($conv_qty_job_process[$job_key][1]);
                            }
                            $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][1]);
                            $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][1])/$order_values*100; 

                            $purchase_amount = array_sum($fabricAmoutByFabricSource['knit']['grey'][$job_key])+array_sum($fabricAmoutByFabricSource['woven']['grey'][$job_key]);
                            $purchase_qty = array_sum($fabricQtyByFabricSource['knit']['grey'][$job_key])+array_sum($fabricQtyByFabricSource['woven']['grey'][$job_key]);

                            $ather_emb_attr = array(4,5,6,99);
                            foreach ($ather_emb_attr as $att) {
                                $others_emb_amount += $emb_amount_job_name_arr[$job_key][$att];
                                $others_emb_qty += $emb_qty_job_name_arr[$job_key][$att];
                            }
                            $knitting_amount_summ=''; $dyeing_amount_summ=''; $yds_amount_summ=''; $aop_amount_summ='';
                            if(count($conv_amount_job_process[$job_key][1])>0) {
                                $knitting_amount_summ = fn_number_format(array_sum($conv_amount_job_process[$job_key][1]),2);
                            }
                            $yarn_amount_summ = $yarn_qty_amount_arr[$job_key]['amount'];
                            $print_amount_summ = $emb_amount_job_name_arr[$job_key][1];      
                            $emb_amount_summ= $emb_amount_job_name_arr[$job_key][2];
                            $wash_amount_summ = $wash_amount_job_name_arr[$job_key][3];
                            if(count($conv_amount_job_process[$job_key][31])>0) {
                                $dyeing_amount_summ=  array_sum($conv_amount_job_process[$job_key][31]);
                            }
                            if(count($conv_amount_job_process[$job_key][30])>0) {
                                $yds_amount_summ = array_sum($conv_amount_job_process[$job_key][30]);
                            }
                            if(count($conv_amount_job_process[$job_key][35])>0) {
                                $aop_amount_summ = array_sum($conv_amount_job_process[$job_key][35]);
                            }
                            
                            $total_budget_value = $yarn_amount_summ+$total_finishing_amount+$print_amount_summ+$trims_costing_arr[$job_key]+$yds_amount_summ+$aop_amount_summ+$emb_amount_summ+$knitting_amount_summ+$purchase_amount+$wash_amount_summ+$other_costing_arr[$job_key]['cm_cost']+$dyeing_amount_summ+$others_emb_amount+$misc_cost;
                            $open_value = $row['total_price']-$total_budget_value;

                            $cur_date = date('d-m-Y');
                            $currency_rate=set_conversion_rate( 2, $cur_date,$row['company_name']);
                            $price_kg_tk = ($conv_cost_arr[$job_key][1]['rate']*$currency_rate)/$conv_cost_arr[$job_key][1]['count'];
                            $total_price_kg_tk = ($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3])*$price_kg_tk;

                            $cutting_status = ($row['job_qty_pcs'] > $gmts_data_array[$job_key][1]['qty']) ? "Running" : "Close";
                            $excess_cut_qty = $gmts_data_array[$job_key][1]['qty'] - $row['job_qty_pcs'];
                            $excess_cut_prsnt = ($excess_cut_qty>0) ? ($excess_cut_qty/$row['job_qty_pcs'])*100 : 0;

                            $order_to_ship_qty = ($ex_data_array[$job_key]['ex_qty'] - $row['job_qty_pcs']);
                            $order_to_ship_prsnt = ($ex_data_array[$job_key]['ex_qty'] != $row['job_qty_pcs']) ? (($order_to_ship_qty/$row['job_qty_pcs'])*100) : 100;
                            $cut_to_ship_qty = ($ex_data_array[$job_key]['ex_qty'] - $lay_data_array[$job_key]['qty']);
                            // $cut_to_ship_prsnt = ($lay_data_array[$job_key]['qty']>0) ? (100 - ($cut_to_ship_qty/$lay_data_array[$job_key]['qty'])*100) : 0;
                            $cut_to_ship_prsnt = ($ex_data_array[$job_key]['ex_qty']>0) ? ($ex_data_array[$job_key]['ex_qty']/$lay_data_array[$job_key]['qty'])*100 : 0;
                            // echo "(".$ex_data_array[$job_key]['ex_qty']."/".$lay_data_array[$job_key]['qty'].")*100)<br>";

                            
                            $costingPer = $costing_per_arr[$job_key];            
                            if($costingPer==1) $pcs_value=1*12;
                            else if($costingPer==2) $pcs_value=1*1;
                            else if($costingPer==3) $pcs_value=2*12;
                            else if($costingPer==4) $pcs_value=3*12;
                            else if($costingPer==5) $pcs_value=4*12;
                            // echo $pcs_value;die;

                            ?>
                            <tr bgcolor="<? echo $bgcolor;?>" id="tr_<?= $i;?>" onClick="change_color('tr_<?= $i; ?>','<?= $bgcolor; ?>')">
                                <td width="30"><p><?=$i;?></p></td>
                                <td width="60">
                                    <p>
                                        <?
                                        $order_status_arr = array_unique(array_filter(explode(",", $row['order_status'])));
                                        $order_status_name = "";
                                        foreach ($order_status_arr as $val) 
                                        {
                                            $order_status_name .= ($order_status_name=="") ? $order_status[$val] : ", ".$order_status[$val];
                                        }
                                        echo $order_status_name;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="100"><p><?=$company_library[$row['company_name']];?></p></td>
                                <td width="80"></td>
                                <td width="100"><p><?=$buyer_library[$row['buyer_name']];?></p></td>
                                <td width="50" align="center"><p><?=$row['year'];?></p></td>
                                <td width="90"><p><?=$job_key;?></p></td>
                                <td width="80"><p><?=$row['repeat_job_no'];?></p></td>
                                <td width="80"><p><?=$row['req_no'];?></p></td>
                                <td width="80"><p><?=$row['style'];?></p></td>
                                <td width="80"><p><?=$row['style_des'];?></p></td>
                                <td width="80">
                                    <p>
                                        <?
                                        $item_id_arr = array_unique(array_filter(explode(",", $row['item_id'])));
                                        $item_name = "";
                                        $item_smv = "";
                                        $tot_item_smv = 0;
                                        foreach ($item_id_arr as $val) 
                                        {
                                            $item_name .= ($item_name=="") ? $garments_item[$val] : ", ".$garments_item[$val];
                                            $item_smv .= ($item_smv=="") ? $garments_item[$val]." : ".$item_smv_array[$job_key][$val] : ", ".$garments_item[$val]." : ".$item_smv_array[$job_key][$val];
                                            $tot_item_smv += $item_smv_array[$job_key][$val];
                                        }
                                        echo $item_name;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80"><p><?=$season_library[$row['season']];?></p></td>
                                <td width="80"><p><?=$product_dept[$row['product_dept']];?></p></td>
                                <td width="80"><p><?=$row['product_code'];?></p></td>
                                <td width="80"><p><?=$sub_dep_library[$row['pro_sub_dep']];?></p></td>
                                <td width="80"><p><?=$brand_library[$row['brand_id']];?></p></td>
                                <td width="80"><p><?=$product_category[$row['product_category']];?></p></td>
                                <td width="80">
                                    <p>
                                        <?
                                        $country_id_arr = array_unique(array_filter(explode(",", $row['country_id'])));
                                        $country_name = "";
                                        foreach ($country_id_arr as $val) 
                                        {
                                            $country_name .= ($country_name=="") ? $country_library[$val] : ", ".$country_library[$val];
                                        }
                                        echo $country_name;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80"><p><?=$sustainability_standard[$row['sustainability_standard']];?></p></td>
                                <td width="80"><p><?=$fab_material[$row['fab_material']];?></p></td>
                                <td width="80"><p><?=$fbooking_order_nature[$row['quality_level']];?></p></td>
                                <td width="80"><p><?=$quality_label[$row['qlty_label']];?></p></td>
                                <td width="80"><p><?=$emb_name_arr[$job_key];?></p></td>
                                <td width="80"><p><?=$conv_name_arr[$job_key];?></p></td>
                                <td width="80">
                                    <p>
                                        <?
                                        $po_number_arr = array_unique(array_filter(explode(",", $row['po_number'])));
                                        $po_name = "";
                                        foreach ($po_number_arr as $val) 
                                        {
                                            $po_name .= ($po_name=="") ? $val : ", ".$val;
                                        }
                                        echo $po_name;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80"><p><?=$acc_po_array[$job_key]['acc_po'];?></p></td>
                                <td width="80">
                                    <p>
                                        <?
                                        $color_arr = array_unique(array_filter(explode(",", $row['color_id'])));
                                        $color_name = "";
                                        foreach ($color_arr as $val) 
                                        {
                                            $color_name .= ($color_name=="") ? $color_library[$val] : ", ".$color_library[$val];
                                        }
                                        echo $color_name;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80">
                                    <p>
                                        <?
                                        $size_arr = array_unique(array_filter(explode(",", $row['size_id'])));
                                        $size_name = "";
                                        foreach ($size_arr as $val) 
                                        {
                                            $size_name .= ($size_name=="") ? $size_library[$val] : ", ".$size_library[$val];
                                        }
                                        echo $size_name;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80">
                                    <p>
                                        <?
                                        $excess_cut_arr = array_unique(array_filter(explode("**", $po_wise_data[$job_key]['excess_cut'])));
                                        $ex_cut = "";
                                        foreach ($excess_cut_arr as $val) 
                                        {
                                            $ex_cut .= ($ex_cut=="") ? "(".$val.")" : ",(".$val.")";
                                        }
                                        echo $ex_cut;
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="right"><p><?=number_format($row['order_quantity'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($row['order_quantity'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($row['plan_cut_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($row['po_quantity'],0);?></p></td>
                                <td width="80" align="center"><p><?=$unit_of_measurement[$row['order_uom']];?></p></td>
                                <td width="80" align="right"><p><?=$row['unit_price'];?></p></td>
                                <td width="80" align="right"><p><?=number_format($row['order_value'],0);?></p></td>
                                <td width="80" align="center"><p><?=$row['po_insert_date'];?></p></td>
                                <td width="80" align="center"><p><?=$row['po_received_date'];?></p></td>
                                <td width="80" align="center"><p><?=$row['factory_received_date'];?></p></td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $lay_date_arr = array_unique(array_filter(explode(",", $lay_data_array[$job_key]['entry_date'])));
                                        $lay_date = get_max_min_date($lay_date_arr);
                                        echo ($lay_date['min_date']!="") ? change_date_format($lay_date['min_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        echo ($lay_date['max_date']!="") ? change_date_format($lay_date['max_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $sew_out_date_arr = array_unique(array_filter(explode(",", $gmts_data_array[$job_key][5]['date'])));
                                        $sew_out_date = get_max_min_date($sew_out_date_arr);
                                        echo ($sew_out_date['min_date']!="") ? change_date_format($sew_out_date['min_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        echo ($sew_out_date['max_date']!="") ? change_date_format($sew_out_date['max_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $gmt_fin_date_arr = array_unique(array_filter(explode(",", $gmts_data_array[$job_key][8]['date'])));
                                        $gmt_fin_date = get_max_min_date($gmt_fin_date_arr);
                                        echo ($gmt_fin_date['min_date']!="") ? change_date_format($gmt_fin_date['min_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        echo ($gmt_fin_date['max_date']!="") ? change_date_format($gmt_fin_date['max_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$row['pub_shipment_date'];?></p></td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $ex_date_array = array_unique(array_filter(explode(",", $ex_data_array[$job_key]['ex_date'])));
                                        $ex_date = get_max_min_date($ex_date_array);
                                        // echo min($ex_date_array);
                                        echo ($ex_date['min_date']!="") ? change_date_format($ex_date['min_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80"><p><?=$row['shipment_date'];?></p></td>
                                <td width="80"><p><?=$row['txt_etd_ldd'];?></p></td>
                                <td width="80"><p><?=$cutup_date = implode(",", array_unique(array_filter(explode(",", $row['cutup_date']))));?></p></td>
                                <td width="80"><p><?=$coun_ship_date = implode(",", array_unique(array_filter(explode(",", $row['country_ship_date']))));?></p></td>
                                <td width="80"><p><?=$row['pub_shipment_date'];?></p></td>
                                <td width="80"><p><?=$shipment_mode[$row['ship_mode']];?></p></td>
                                <td width="80"><p><?=$row['lead_time'];?></p></td>
                                <td width="80"><p><?=$row['days_in_hand'];?></p></td>
                                <td width="80">
                                    <p>
                                        <?
                                        $com_file = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['internal_file_no']))));
                                        echo $com_file;
                                        ?>                                            
                                    </p>
                                </td>                                
                                <td width="80">
                                    <p>
                                        <?
                                        $lien_bank = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['lien_bank']))));
                                        echo $lien_bank;
                                        ?>                                            
                                    </p>
                                </td>
                                <td width="80"><p><?=$a;?></p></td>                                
                                <td width="80">
                                    <p>
                                        <?
                                        $amendment_no = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['amendment_no']))));
                                        echo $amendment_no;
                                        ?>                                            
                                    </p>
                                </td>                               
                                <td width="80">
                                    <p>
                                        <?
                                        $pay_term = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['pay_term']))));
                                        echo $pay_term;
                                        ?>                                            
                                    </p>
                                </td>                                
                                <td width="80">
                                    <p>
                                        <?
                                        $tenor = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['tenor']))));
                                        echo $tenor;
                                        ?>                                            
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        echo ($ex_date['min_date']!="") ? change_date_format($ex_date['min_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        echo ($ex_date['max_date']!="") ? change_date_format($ex_date['max_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_value'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($ship_excess_qty,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($ship_excess_val,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($ship_short_qty,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($ship_short_val,0);?></p></td>
                                <td width="80" align="center"><p><?=$row['shipment_status'];?></p></td>
                                <td width="80" align="right"><p><?=$item_smv;?></p></td>
                                <td width="80" align="right"><p><?=$tot_item_smv;?></p></td>
                                <td width="80"><p><?=$budget_data_array[$job_key]['cm_cost'];?></p></td>
                                <td width="80"><p><?=$team_library[$row['team_leader']];?></p></td>
                                <td width="80"><p><?=$merchant_library[$row['dealing_marchant']];?></p></td>
                                <td width="80"><p><?=$merchant_library[$row['factory_marchant']];?></p></td>
                                <td width="80">
                                    <p>
                                        <?=$user_library[$row['inserted_by']];?>       
                                        <?
                                        if($row['updated_by']!="")
                                        {
                                            echo ", ".$user_library[$row['updated_by']];
                                        }
                                        ?>                                 
                                    </p>
                                </td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80">
                                    <a href="javascript:void(0);" onclick="show_popup('sample_status', '<?=$job_key; ?>', '920px',1)">
                                        View
                                    </a>
                                </td>
                                <td width="80">
                                    <a href="javascript:void(0);" onclick="show_popup('order_status', '<?=$job_key; ?>', '320px',2)">
                                        View
                                    </a>
                                </td>
                                <td width="80">
                                    <a href="javascript:void(0);" onclick="show_popup('closing_status', '<?=$job_key; ?>', '320px',3)">
                                        View
                                    </a>
                                </td>
                                <td width="80">
                                    <p>
                                        <?
                                            echo ($work_order_data_array[$job_key][1]) ? "Printing : ".$work_order_data_array[$job_key][1] : "";
                                            echo ($work_order_data_array[$job_key][2]) ? "Embroidery : ".$work_order_data_array[$job_key][2] : "";
                                            echo ($work_order_data_array[$job_key][3]) ? "Wash : ".$work_order_data_array[$job_key][3] : "";
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80">
                                    <p>
                                        <?
                                            echo "AOP : ".$service_booking_data_array[$job_key]['aop'];
                                            echo "Yarn Dyeing : ".$yd_work_order_data_array[$job_key];
                                            echo "Knitting : ".$service_booking_data_array[$job_key]['knitting'];
                                            echo "Fab. Dyeing : ".$service_booking_data_array[$job_key]['dyeing'];
                                        ?>
                                        
                                    </p>
                                </td>



                                <td width="80"><p><?=$budget_data_array[$job_key]['costing_date'];?></p></td>
                                <td width="80" align="right"><p><?=number_format($total_budget_value,2);?></p></td>
                                <td width="80" align="right"><p><?=number_format($open_value,0);?></p></td>
                                <td width="80"><p><?=($budget_data_array[$job_key]['approved']==1) ? "Approved" : "Not Approved";?></p></td>
                                <td width="80"><p><?=number_format($a,0);?></p></td>


                                
                                <td width="80" align="center" data="Main Fabric Booking Information">
                                    <p>
                                        <?
                                        $booking_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['booking_date'])));
                                        $booking_date = "";
                                        foreach ($booking_date_arr as $val) 
                                        {
                                            $booking_date .= ($booking_date=="") ? $val : ", ".$val;
                                        }
                                        echo $booking_date;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $booking_no_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['booking_no'])));
                                        $booking_no = "";
                                        foreach ($booking_no_arr as $val) 
                                        {
                                            $booking_no .= ($booking_no=="") ? $val : ", ".$val;
                                        }
                                        echo $booking_no;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $delivery_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['delivery_date'])));
                                        $delivery_date = "";
                                        foreach ($delivery_date_arr as $val) 
                                        {
                                            $delivery_date .= ($delivery_date=="") ? $val : ", ".$val;
                                        }
                                        echo $delivery_date;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $revised_no_arr = array_unique(explode(",", $booking_data_array[$job_key][1][2]['revised_no']));
                                        $revised_no = "";
                                        foreach ($revised_no_arr as $val) 
                                        {
                                            $revised_no .= ($revised_no=="") ? $val : ", ".$val;
                                        }
                                        // echo $revised_no;
                                        if($amendment_arr[$job_key]!="")
                                        {
                                            echo $amendment_arr[$job_key]-1;
                                        }
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $revised_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['revised_date'])));
                                        $revised_date = "";
                                        foreach ($revised_date_arr as $val) 
                                        {
                                            $revised_date .= ($revised_date=="") ? $val : ", ".$val;
                                        }
                                        echo $revised_date;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">                                    
                                    <?
                                    $is_approved_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['is_approved'])));
                                    $is_approved = "";
                                    foreach ($is_approved_arr as $val) 
                                    {
                                        $is_approved .= ($is_approved=="") ? $approval_type_arr[$val] : ", ".$approval_type_arr[$val];
                                    }
                                    ?>
                                    <a href="javascript:void(0);" onclick="show_popup('fb_approval_status', '<?=$job_key; ?>__1', '920px',3)">
                                            <?
                                        echo ($is_approved=="") ? " Not Approved" : $is_approved;
                                        ?>
                                    </a> 
                                </td>
                                <td width="80"><p><?=$a;?></p>Yarn Desc</td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $construction_arr = array_unique(array_filter(explode("__", $booking_data_array[$job_key][1][2]['construction'])));
                                        $construction = "";
                                        foreach ($construction_arr as $val) 
                                        {
                                            $construction .= ($construction=="") ? $val : ", ".$val;
                                        }
                                        echo $construction;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $copmposition_arr = array_unique(array_filter(explode("__", $booking_data_array[$job_key][1][2]['copmposition'])));
                                        $copmposition = "";
                                        foreach ($copmposition_arr as $val) 
                                        {
                                            $copmposition .= ($copmposition=="") ? $val : ", ".$val;
                                        }
                                        echo $copmposition;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $gsm_weight_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['gsm_weight'])));
                                        $gsm_weight = "";
                                        foreach ($gsm_weight_arr as $val) 
                                        {
                                            $gsm_weight .= ($gsm_weight=="") ? $val : ", ".$val;
                                        }
                                        echo $gsm_weight;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $dia_width_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['dia_width'])));
                                        $dia_width = "";
                                        foreach ($dia_width_arr as $val) 
                                        {
                                            $dia_width .= ($dia_width=="") ? $val : ", ".$val;
                                        }
                                        echo $dia_width;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][2]['grey_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][2]['fin_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][2]['process_loss'],0);?></p></td>



                                
                                <td width="80" align="center" data="Purchase Fabric Booking Information">
                                    <p>
                                        <?
                                        $booking_date_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['booking_date'])));
                                        $booking_date = "";
                                        foreach ($booking_date_arr as $val) 
                                        {
                                            $booking_date .= ($booking_date=="") ? $val : ", ".$val;
                                        }
                                        echo $booking_date;
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <?
                                        $booking_no_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['booking_no'])));
                                        $booking_no = "";
                                        foreach ($booking_no_arr as $val) 
                                        {
                                            ?>
                                            <a href="javascript:void(0)" onclick="generate_fabric_report('<?=$val; ?>');">
                                            <?
                                            // $booking_no .= ($booking_no=="") ? $val : ", ".$val;
                                            echo $val;
                                            ?>
                                        </a>
                                            <?
                                        }
                                        ?>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $delivery_date_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['delivery_date'])));
                                        $delivery_date = "";
                                        foreach ($delivery_date_arr as $val) 
                                        {
                                            $delivery_date .= ($delivery_date=="") ? $val : ", ".$val;
                                        }
                                        echo $delivery_date;
                                        ?>                                        
                                    </p>
                                </td>                                
                                <td width="80">
                                    <p>
                                        <?
                                        $construction_arr = array_unique(array_filter(explode("__", $pur_booking_data_array[$job_key][1]['construction'])));
                                        $construction = "";
                                        foreach ($construction_arr as $val) 
                                        {
                                            $construction .= ($construction=="") ? $val : ", ".$val;
                                        }
                                        echo $construction;
                                        ?>                                        
                                    </p>
                                </td>                                                               
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $uom_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['uom'])));
                                        $uom = "";
                                        foreach ($uom_arr as $val) 
                                        {
                                            $uom .= ($uom=="") ? $unit_of_measurement[$val] : ", ".$unit_of_measurement[$val];
                                        }
                                        echo $uom;
                                        ?>                                        
                                    </p>
                                </td>                                                                                               
                                <td width="80" align="right">
                                    <p>
                                        <?
                                        $fin_fab_qnty_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['fin_fab_qnty'])));
                                        $fin_fab_qnty = "";
                                        foreach ($fin_fab_qnty_arr as $val) 
                                        {
                                            $fin_fab_qnty .= ($fin_fab_qnty=="") ? $val : ", ".$val;
                                        }
                                        echo number_format($fin_fab_qnty,2);
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <a href="javascript:void(0);" onclick="show_popup('work_order_details', '<?=$job_key; ?>', '920px',5)">View</a>
                                </td>
                                <td width="80" align="center">
                                    
                                    <?
                                    $is_approved_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1][2]['is_approved'])));
                                    $is_approved = "";
                                    foreach ($is_approved_arr as $val) 
                                    {
                                        $is_approved .= ($is_approved=="") ? $approval_type_arr[$val] : ", ".$approval_type_arr[$val];
                                    }
                                    ?>
                                    <a href="javascript:void(0);" onclick="show_popup('fb_approval_status', '<?=$job_key; ?>__2', '920px',4)">
                                        <?
                                        echo ($is_approved=="") ? " Not Approved" : $is_approved;
                                        ?>
                                        
                                    </a>
                                </td>

                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $booking_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['booking_date'])));
                                        $booking_date = "";
                                        foreach ($booking_date_arr as $val) 
                                        {
                                            $booking_date .= ($booking_date=="") ? $val : ", ".$val;
                                        }
                                        echo $booking_date;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $booking_no_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['booking_no'])));
                                        $booking_no = "";
                                        foreach ($booking_no_arr as $val) 
                                        {
                                            $booking_no .= ($booking_no=="") ? $val : ", ".$val;
                                        }
                                        echo $booking_no;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center" data="Short/EFR Fabric Booking Information">
                                    <p>
                                        <?
                                        $delivery_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['delivery_date'])));
                                        $delivery_date = "";
                                        foreach ($delivery_date_arr as $val) 
                                        {
                                            $delivery_date .= ($delivery_date=="") ? $val : ", ".$val;
                                        }
                                        echo $delivery_date;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?                                       
                                        echo $short_fab_array[$job_key];;
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $uom_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['uom'])));
                                        $uom = "";
                                        foreach ($uom_arr as $val) 
                                        {
                                            $uom .= ($uom=="") ? $unit_of_measurement[$val] : ", ".$unit_of_measurement[$val];
                                        }
                                        echo $uom;
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][1]['grey_fab_qnty'],0);?></p></td>                                 
                                <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][1]['fin_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][1]['process_loss'],0);?></p></td>                               
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $is_approved_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['is_approved'])));
                                        $is_approved = "";
                                        foreach ($is_approved_arr as $val) 
                                        {
                                            $is_approved .= ($is_approved=="") ? $approval_type_arr[$val] : ", ".$approval_type_arr[$val];
                                        }
                                        echo ($is_approved=="") ? " Not Approved" : $is_approved;
                                        ?>
                                        
                                    </p>
                                </td>


                                
                                <td width="80"><p><a href="javascript:void(0);" onclick="show_popup('trims_acc_status_popup', '<?=$job_key; ?>', '1120px',6)">View</a></p></td>



                                <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['grey_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($yarn_allocation_array[$job_key],0);?></p></td>
                                <td width="80" align="right"><p><? if(($yarn_allocation_array[$job_key]-$booking_qty_array[$job_key]['grey_fab_qnty'])>0){ echo number_format(($yarn_allocation_array[$job_key]-$booking_qty_array[$job_key]['grey_fab_qnty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($textile_data_array[$job_key][3],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format(($booking_qty_array[$job_key]['grey_fab_qnty']-$textile_data_array[$job_key][3]),0);?></p></td>
                                <td width="80" align="right"><p>  <? if($textile_data_array[$job_key][3]-($booking_qty_array[$job_key]['grey_fab_qnty'])>0){ echo number_format($textile_data_array[$job_key][3]-($booking_qty_array[$job_key]['grey_fab_qnty']),0);} else{ echo " ";}?></p></td>
                              



                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($yarn_allocation_array[$job_key],0);?></p></td>
                                <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['grey_fab_qnty']-$yarn_allocation_array[$job_key])>0){ echo number_format(($booking_qty_array[$job_key]['grey_fab_qnty']-$yarn_allocation_array[$job_key]),0);} else{ echo " ";} ?></p></td>

                                <td width="80" align="right"><p><?=number_format($yarn_rcv_from_dyeing_array[$job_key],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($dyed_yarn_issue_array[$job_key],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>



                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>



                                <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['grey_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($program_data_array[$job_key],0);?></p></td>
                                <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['grey_fab_qnty']-$program_data_array[$job_key])>0){ echo number_format(($booking_qty_array[$job_key]['grey_fab_qnty']-$program_data_array[$job_key]),0);} else{ echo " ";}?></p></td>

                                <td width="80" align="right"><p><?=$service_booking_data_array[$job_key]['knitting'];?></p></td>
                                <td width="80" align="right"><p><?=number_format($knitting_data_array[$job_key][1],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($knitting_data_array[$job_key][3],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format(($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3]),0);?></p></td>
                                <td width="80" align="right"><p>
                                    <? 
                                    // echo $booking_qty_array[$job_key]['grey_fab_qnty']."-(".$knitting_data_array[$job_key][3]."+".$knitting_data_array[$job_key][1]."<br>";
                                    if($booking_qty_array[$job_key]['grey_fab_qnty']-($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3])>0)
                                    { 
                                        echo number_format($booking_qty_array[$job_key]['grey_fab_qnty']-($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3]),0);
                                    } 
                                    else
                                    { 
                                        echo " ";
                                    } ?>
                                 </p></td>

                                <td width="80" align="right"><p><? echo number_format($booking_qty_array[$job_key]['grey_fab_qnty']-($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3]),0) ?></p></td>
                                <td width="80" align="right"><p><?=number_format($price_kg_tk,2);?></p></td>
                                <td width="80" align="right"><p><?=number_format($total_price_kg_tk,2);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][56],0);?></p></td>
                                <td width="80" align="right" title="Knitting Reference closing"><p>Yes</p></td>



                                <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['grey_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][58],0);?></p></td>
                                <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['grey_fab_qnty'] - $roll_data_array[$job_key][58])>0){ echo number_format(($booking_qty_array[$job_key]['grey_fab_qnty'] - $roll_data_array[$job_key][58]),0);} else{ echo " ";} ?></p></td>
                                <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][82][5],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format(($roll_data_array[$job_key][58]+$transfer_data_array[$job_key][82][5]),0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][61],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][82][6],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format(($roll_data_array[$job_key][61]+$transfer_data_array[$job_key][82][6]),0);?></p></td>
                                <td width="80" align="right"><p><? if((($roll_data_array[$job_key][58]+$transfer_data_array[$job_key][82][5]) -($roll_data_array[$job_key][61]+$transfer_data_array[$job_key][82][6]))){ echo number_format((($roll_data_array[$job_key][58]+$transfer_data_array[$job_key][82][5]) -($roll_data_array[$job_key][61]+$transfer_data_array[$job_key][82][6])) ,0);}else{ echo " ";}?></p></td>



                                <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['grey_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][62],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][64],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($fab_dyeing_array[$job_key],0);?></p></td>

                                <td width="80" align="right"><p><? if(($fab_dyeing_array[$job_key]-$booking_qty_array[$job_key]['grey_fab_qnty'])>0){ echo number_format(($fab_dyeing_array[$job_key]-$booking_qty_array[$job_key]['grey_fab_qnty']),0);} else{ echo "0";}?></p></td>

                                <td width="80" align="center" title="Dyeing Reference closing"><p><?echo number_format(($booking_qty_array[$job_key]['grey_fab_qnty']-$fab_dyeing_array[$job_key]),0);?></p></td>



                                <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['fin_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($textile_data_array[$job_key][66],0);?></p></td>
                                <td width="80" align="right"><p><? if(($textile_data_array[$job_key][66]-$booking_qty_array[$job_key]['fin_fab_qnty'])>0){ echo number_format(($textile_data_array[$job_key][66]-$booking_qty_array[$job_key]['fin_fab_qnty']),0);}  else{ echo "0";}?></p></td>
                                <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['fin_fab_qnty'] - $textile_data_array[$job_key][66])>0){ echo number_format(($booking_qty_array[$job_key]['fin_fab_qnty'] - $textile_data_array[$job_key][66]),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="left"><p><?=$fab_dyeing_process_array[$job_key];?></p></td>
                                <td width="80" align="right"><p><?=number_format($textile_data_array[$job_key][66],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][63],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][65],0);?></p></td>
                                <td width="80" align="right" title="Issue - Rcv"><p><? if(($roll_data_array[$job_key][63] - $roll_data_array[$job_key][65])>0){ echo number_format(($roll_data_array[$job_key][63] - $roll_data_array[$job_key][65]),0);}  else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][67],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right" title="Dyeing Finishing Reference closing"><p>No</p></td>



                                <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['fin_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][68],0);?></p></td>
                                <td width="80" align="right"><p><? if(($roll_data_array[$job_key][68]-$booking_qty_array[$job_key]['fin_fab_qnty'])>0){ echo number_format(($roll_data_array[$job_key][68]-$booking_qty_array[$job_key]['fin_fab_qnty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['fin_fab_qnty']-$roll_data_array[$job_key][68])>0){ echo number_format(($booking_qty_array[$job_key]['fin_fab_qnty']-$roll_data_array[$job_key][68]),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][134][5],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][134][5],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($textile_data_array[$job_key][71],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][134][6],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][134][6],0);?></p></td>
                                <td width="80" align="right"><p><? if(($roll_data_array[$job_key][68] - $textile_data_array[$job_key][71])>0){ echo number_format(($roll_data_array[$job_key][68] - $textile_data_array[$job_key][71]),0);} else{ echo " ";}?></p></td>



                                <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['fin_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][67],0);?></p></td>
                                <td width="80" align="right"><p><? if(($roll_data_array[$job_key][67]-$booking_qty_array[$job_key]['fin_fab_qnty'])>0){ echo number_format(($roll_data_array[$job_key][67]-$booking_qty_array[$job_key]['fin_fab_qnty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['fin_fab_qnty'] - $roll_data_array[$job_key][67])>0){ echo number_format(($booking_qty_array[$job_key]['fin_fab_qnty'] - $roll_data_array[$job_key][67]),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="left"><p><?=$cutting_status;?></p></td>
                                <td width="80" align="right"><p><?=number_format($row['job_qty_pcs'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($excess_cut_prsnt,2);?></p></td>
                                <td width="80" align="right"><p><?=number_format($row['plan_cut_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($lay_data_array[$job_key]['no_of_bndl'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($lay_data_array[$job_key]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][1]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if (($gmts_data_array[$job_key][1]['qty']-$row['job_qty_pcs'])>0){ echo number_format(($gmts_data_array[$job_key][1]['qty']-$row['job_qty_pcs']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? if(($row['job_qty_pcs']-$gmts_data_array[$job_key][1]['qty'])>0){ echo number_format(($row['job_qty_pcs']-$gmts_data_array[$job_key][1]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][4]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($row['job_qty_pcs']-$gmts_data_array[$job_key][4]['qty'])>0){ echo number_format(($row['job_qty_pcs']-$gmts_data_array[$job_key][4]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($embel_data_array[$job_key][2][1]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($embel_data_array[$job_key][3][1]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($row['job_qty_pcs']-$embel_data_array[$job_key][3][1]['qty'])>0){ echo number_format(($row['job_qty_pcs']-$embel_data_array[$job_key][3][1]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="left"><p><?=implode(", ", array_unique(array_filter(explode(",", $embel_data_array[$job_key][2][1]['wo_com_id']))));?></p></td>
                                <td width="80" align="right"><p><?=number_format($embel_data_array[$job_key][2][2]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($embel_data_array[$job_key][3][2]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="left"><p><?=implode(", ", array_unique(array_filter(explode(",", $embel_data_array[$job_key][3][1]['wo_com_id']))));?></p></td>



                                
                                <td width="80" align="right"><p><?=number_format(($emb_qty_job_name_arr[$job_key][1]*$pcs_value),0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($print_emb_order_data_array[$job_key][204]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($emb_qty_job_name_arr[$job_key][1]*$pcs_value - $print_emb_order_data_array[$job_key][204]['qty'])>0){ echo number_format(($emb_qty_job_name_arr[$job_key][1]*$pcs_value - $print_emb_order_data_array[$job_key][204]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($emb_qc_data_array[$job_key][223]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($emb_qc_data_array[$job_key][223]['qty']-$print_emb_order_data_array[$job_key][204]['qty'])>0){ echo number_format(($emb_qc_data_array[$job_key][223]['qty']-$print_emb_order_data_array[$job_key][204]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? echo number_format(($print_emb_order_data_array[$job_key][204]['qty']-$emb_qc_data_array[$job_key][223]['qty']),0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($emb_delivery_data_array[$job_key][254]['qty'],0);?></p></td>



                                <td width="80" align="right"><p><?=number_format(($emb_qty_job_name_arr[$job_key][2]*$pcs_value),0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($print_emb_order_data_array[$job_key][311]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($emb_qty_job_name_arr[$job_key][2]*$pcs_value - $print_emb_order_data_array[$job_key][311]['qty'])>0){ echo number_format(($emb_qty_job_name_arr[$job_key][2]*$pcs_value - $print_emb_order_data_array[$job_key][311]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($emb_qc_data_array[$job_key][324]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($emb_qc_data_array[$job_key][324]['qty']-$print_emb_order_data_array[$job_key][311]['qty'])>0){ echo number_format(($emb_qc_data_array[$job_key][324]['qty']-$print_emb_order_data_array[$job_key][311]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? if(($print_emb_order_data_array[$job_key][311]['qty']-$emb_qc_data_array[$job_key][324]['qty'])>0){ echo number_format(($print_emb_order_data_array[$job_key][311]['qty']-$emb_qc_data_array[$job_key][324]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($emb_delivery_data_array[$job_key][325]['qty'],0);?></p></td>



                                <td width="80" align="right"><p><?=number_format($row['job_qty_pcs'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($row['plan_cut_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][4]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($row['plan_cut_qnty']-$gmts_data_array[$job_key][4]['qty'])>0){ echo number_format(($row['plan_cut_qnty']-$gmts_data_array[$job_key][4]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format(($gmts_data_array[$job_key][1]['qty']-$gmts_data_array[$job_key][4]['qty']),0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][5]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($gmts_data_array[$job_key][5]['qty']-$row['plan_cut_qnty'])>0){ echo number_format(($gmts_data_array[$job_key][5]['qty']-$row['plan_cut_qnty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? echo number_format(($gmts_data_array[$job_key][4]['qty']-$gmts_data_array[$job_key][5]['qty']),0); ?></p></td>
                                <td width="80" align="right"><p><? if(($gmts_data_array[$job_key][4]['qty']-$gmts_data_array[$job_key][5]['qty'])>0){ echo number_format(($gmts_data_array[$job_key][4]['qty']-$gmts_data_array[$job_key][5]['qty']),0);} else{ echo " ";}?></p></td>



                                <td width="80" align="right"><p><?=number_format($row['job_qty_pcs'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][7]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][15]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][11]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][8]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($row['plan_cut_qnty']-$gmts_data_array[$job_key][8]['qty'])>0){ echo number_format(($row['plan_cut_qnty']-$gmts_data_array[$job_key][8]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="center"><p><?=change_date_format(max($rfi_date_array[$job_key]));?></p></td>
                                <td width="80" align="right"><p><?=$buyer_insp_data[$job_key]['date'];?></p></td>
                                <td width="80" align="right"><p><?=number_format($buyer_insp_data[$job_key]['qty'],0);?></p></td>



                                <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['cartot_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($invice_data[$job_key]['inv_qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_value'],2);?></p></td>
                                <td width="80" align="right"><p><?=number_format($invice_data[$job_key]['inv_value'],2);?></p></td>
                                <td width="80" align="right"><p><?=number_format($invice_data[$job_key]['net_inv_value'],2);?></p></td>
                                <td width="80" align="right"><p><? if(($ex_data_array[$job_key]['ex_qty']-$row['job_qty_pcs'])>0){ echo number_format(($ex_data_array[$job_key]['ex_qty']-$row['job_qty_pcs']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? if(($ex_data_array[$job_key]['ex_value']-$row['total_price'])>0){ echo number_format(($ex_data_array[$job_key]['ex_value']-$row['total_price']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? if(($row['job_qty_pcs']-$ex_data_array[$job_key]['ex_qty'])>0){ echo number_format(($row['job_qty_pcs']-$ex_data_array[$job_key]['ex_qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? if(($row['total_price']-$ex_data_array[$job_key]['ex_value'])>0){ echo number_format(($row['total_price']-$ex_data_array[$job_key]['ex_value']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['rtn_qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_rtn_value'],0);?></p></td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $ex_data_array = array_unique(array_filter(explode(",", $ex_data_array[$job_key]['ex_date'])));
                                        $ex_date = get_max_min_date($ex_data_array);
                                        echo ($ex_date['min_date']!="") ? change_date_format($ex_date['min_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $ex_date = get_max_min_date($ex_data_array);
                                        // print_r($ex_date);echo "wwwwwwww";
                                        echo ($ex_date['max_date']!="") ? change_date_format($ex_date['max_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="right"><p><?=number_format($invice_data[$job_key]['discount_ammount'],2);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($order_to_ship_qty,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($order_to_ship_prsnt,2);?></p></td>
                                <td width="80" align="right"><p><?=number_format($cut_to_ship_qty,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($cut_to_ship_prsnt,2);?></p></td>
                               

                                
                                



                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>



                                
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                            </tr>
                            <?
                            $i++;
                            $gr_job_total += $row['job_qty_pcs'];
                            $gr_po_total += $row['order_quantity'];
                            $gr_color_size_total += $row['po_quantity'];
                            $gr_plan_cut_total += $row['plan_cut_qnty'];
                            $gr_order_value_total += $row['order_value'];
                        }
                        unset($data_array);
                        ?>                        
                    </tbody>
                </table>
            </div>
            <!-- =============================== report footer ================================ -->
            <table cellspacing="0" border="1" class="rpt_table"   rules="all" width="<?=$tbl_width;?>"  align="center" id="report_table_footer">
                <tfoot>                    
                    <tr>
                        <th width="30"><p></p></th>
                        <th width="60"><p></p></th>
                        <th width="100"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="100"><p></p></th>
                        <th width="50"><p></p></th>
                        <th width="90"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p>Grand Total</p></th>
                        <th width="80"><p><?=number_format($gr_job_total,0);?></p></th>
                        <th width="80"><p><?=number_format($gr_po_total,0);?></p></th>
                        <th width="80"><p><?=number_format($gr_plan_cut_total,0);?></p></th>
                        <th width="80"><p><?=number_format($gr_color_size_total,0);?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=number_format($gr_order_value_total,2);?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                    </tr>
                </tfoot>
            </table>
        </div>        
    </fieldset>
    <script type="text/javascript">
        // $("#zoom").elevateZoom({easing : true});
    </script>
    <?    
	foreach (glob("$user_id*.xls") as $filename) 
	{
		if( @filemtime($filename) < (time()-$seconds_old) )
		@unlink($filename);
	}
	//---------end------------//
	$name=time();
	$filename=$user_id."_".$name.".xls";
	$create_new_doc = fopen($filename,'w');
	$is_created = fwrite($create_new_doc,ob_get_contents());
	echo "$total_data####$filename";
	exit();  

}

if ($action == "report_generate_excel__") 
{
    $company_name   = str_replace("'", "", $cbo_company_name);
    $buyer_name     = str_replace("'", "", $cbo_buyer_name);
    $year_id        = str_replace("'", "", $cbo_year);    
    $job_no         = str_replace("'", "", $txt_job_no);
    $txt_style_ref  = str_replace("'", "", $txt_style_ref);
    $txt_order_no   = str_replace("'", "", $txt_order_no);
    $shipmentStatus= str_replace("'", "", $cbo_shipment_status);
    $orderStatus   = str_replace("'","", $cbo_order_status);
    $status         = str_replace("'", "", $cbo_status);
    $report_type    = str_replace("'", "", $cbo_report_type);
    $date_category  = str_replace("'", "", $cbo_date_category);    

    /*===============================================================================/
    /                              Create Library Array                              /
    /============================================================================== */
    $team_library   = return_library_array("select id,team_leader_name from lib_marketing_team where status_active =1 and is_deleted=0", "id", "team_leader_name");
    $merchant_library   = return_library_array("select id,team_member_name from lib_mkt_team_member_info where status_active =1 and is_deleted=0", "id", "team_member_name");
    $country_library= return_library_array("select id, country_name from  lib_country", "id", "country_name");
    $buyer_library  = return_library_array("select id, buyer_name from  lib_buyer", "id", "buyer_name");
    $supplier_library  = return_library_array("select id, supplier_name from  lib_supplier", "id", "supplier_name");
    $color_library  = return_library_array("select id, color_name from  lib_color", "id", "color_name");
    $size_library   = return_library_array("select id, size_name from  lib_size", "id", "size_name");
    $company_library= return_library_array("select id, company_name from  lib_company", "id", "company_name");
    $sub_dep_library= return_library_array("select id,sub_department_name from lib_pro_sub_deparatment status_active =1 and is_deleted=0", "id", "sub_department_name");
    $season_library = return_library_array("select id, season_name from lib_buyer_season where status_active =1 and is_deleted=0", "id", "season_name");
    $brand_library = return_library_array("select id, brand_name from lib_buyer_brand brand where status_active =1 and is_deleted=0", "id", "brand_name");
    $sub_dep_library = return_library_array("select id,sub_department_name from lib_pro_sub_deparatment where status_active =1 and is_deleted=0", "id", "sub_department_name");
    $user_library = return_library_array("select id,user_full_name from user_passwd where status_active =1", "id", "user_full_name");
    $bank_library = return_library_array("select bank_name,id from lib_bank where is_deleted=0 and status_active=1 and lien_bank=1", "id", "bank_name");
    // echo "<pre>";print_r($user_library);die;

    $fab_material=array(1=>"Organic",2=>"BCI");

    /*===============================================================================/
    /                                   Query Condition                              /
    /============================================================================== */
    $sqlCond = "";
    $sqlCond = ($company_name) ? " and a.company_name=$company_name" : "";
    $sqlCond .= ($buyer_name) ? " and a.buyer_name=$buyer_name" : "";
    $sqlCond .= ($year_id) ? " and to_char(a.insert_date,'YYYY')=$year_id" : "";
    $sqlCond .= ($job_no!="") ? " and a.job_no_prefix_num=$job_no" : "";
    $sqlCond .= ($txt_style_ref!="") ? " and a.style_ref_no='$txt_style_ref'" : "";
    $sqlCond .= ($txt_order_no!="") ? " and b.po_number='$txt_order_no'" : "";
    $sqlCond .= ($orderStatus) ? " and b.is_confirmed=$orderStatus" : "";
    $sqlCond .= ($status) ? " and b.status_active=$status" : "";

    if($shipmentStatus)
    {
        if ($shipmentStatus==4) 
        {
            $sqlCond .= " and b.shiping_status in(1,2)";
        }
        else
        {
            $sqlCond .= " and b.shiping_status in($shipmentStatus)";
        }
    }

    if(str_replace("'", "", $txt_date_from) !="" && str_replace("'", "", $txt_date_to) !="")
    {
        switch ($date_category) 
        {
            case 1:
                $sqlCond .= " and b.shipment_date between $txt_date_from and $txt_date_to";
                break;

            case 2:
                $sqlCond .= " and b.shipment_date between $txt_date_from and $txt_date_to";
                break;    
            
            default:
                $sqlCond .= " and b.factory_received_date between $txt_date_from and $txt_date_to";
                break;
        }
    }

    /*===============================================================================/
    /                                  MAIN QUERY                                    /
    /============================================================================== */
    $sql = "SELECT a.id,a.job_no, a.company_name,a.style_owner,a.buyer_name,a.style_ref_no,a.requisition_no,a.style_description,a.repeat_job_no,a.season_buyer_wise,a.product_dept,a.product_code,a.pro_sub_dep,a.order_uom,  a.product_category,a.brand_id,a.region,a.sustainability_standard,a.fab_material,a.qlty_label,a.quality_level,(a.job_quantity*a.total_set_qnty) as job_qty_pcs,    to_char(a.insert_date,'YYYY') as year,a.ship_mode,a.set_smv,a.team_leader,a.dealing_marchant,a.factory_marchant,a.inserted_by,a.updated_by,a.total_price,a.qlty_label,

        b.is_confirmed,b.id as po_id,b.po_number,b.excess_cut,(b.po_quantity*a.total_set_qnty) as po_quantity,b.unit_price,b.po_total_price,to_char(b.insert_date,'DD-MM-YYYY') as po_insert_date,to_char(b.po_received_date,'DD-MM-YYYY') as po_received_date,to_char(b.factory_received_date,'DD-MM-YYYY') as factory_received_date,to_char(b.pub_shipment_date,'DD-MM-YYYY') as pub_shipment_date,to_char(b.shipment_date,'DD-MM-YYYY') as shipment_date,to_char(b.txt_etd_ldd,'DD-MM-YYYY') as txt_etd_ldd,b.shiping_status,(b.pub_shipment_date-b.po_received_date) as lead_time,(b.pub_shipment_date - trunc(sysdate)) AS days_in_hand,

        c.country_id,c.item_number_id,c.color_number_id,c.size_number_id,c.order_quantity,c.plan_cut_qnty,to_char(c.cutup_date,'DD-MM-YYYY') as cutup_date,to_char(c.country_ship_date,'DD-MM-YYYY') as country_ship_date

        from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.id=b.job_id and b.id=c.po_break_down_id and a.id=c.job_id and a.status_active=1 and a.is_deleted=0 and c.status_active in(1,2,3) and c.is_deleted=0 $sqlCond";
    // echo $sql;die();
    $sql_res = sql_select($sql);
    if(count($sql_res)==0)
    {
        ?>
        <center>
            <div style="width: 80%;" class="alert alert-danger">Data not found.Please try again.</div>
        </center>
        <?
        die();
    }
    $data_array = array();
    $job_id_array = array();
    $job_no_array = array();
    $po_array = array();
    $po_wise_data = array();
    $po_wise_job_arr = array();
    $po_chk_array = array();
    $po_wise_unit_price_array = array();
    foreach ($sql_res as $val) 
    {
        $data_array[$val['JOB_NO']]['company_name'] = $val['COMPANY_NAME'];
        $data_array[$val['JOB_NO']]['buyer_name'] = $val['BUYER_NAME'];
        $data_array[$val['JOB_NO']]['wo_com_id'] = $val['STYLE_OWNER'];
        $data_array[$val['JOB_NO']]['year'] = $val['YEAR'];
        $data_array[$val['JOB_NO']]['style'] = $val['STYLE_REF_NO'];
        $data_array[$val['JOB_NO']]['req_no'] = $val['REQUISITION_NO'];
        $data_array[$val['JOB_NO']]['repeat_job_no'] = $val['REPEAT_JOB_NO'];
        $data_array[$val['JOB_NO']]['style_des'] = $val['STYLE_DESCRIPTION'];
        $data_array[$val['JOB_NO']]['season'] = $val['SEASON_BUYER_WISE'];
        $data_array[$val['JOB_NO']]['product_dept'] = $val['PRODUCT_DEPT'];
        $data_array[$val['JOB_NO']]['product_code'] = $val['PRODUCT_CODE'];
        $data_array[$val['JOB_NO']]['pro_sub_dep'] = $val['PRO_SUB_DEP'];
        $data_array[$val['JOB_NO']]['product_category'] = $val['PRODUCT_CATEGORY'];
        $data_array[$val['JOB_NO']]['brand_id'] = $val['BRAND_ID'];
        $data_array[$val['JOB_NO']]['region'] = $val['REGION'];
        $data_array[$val['JOB_NO']]['sustainability_standard'] = $val['SUSTAINABILITY_STANDARD'];
        $data_array[$val['JOB_NO']]['fab_material'] = $val['FAB_MATERIAL'];
        $data_array[$val['JOB_NO']]['order_nature'] = $val['QLTY_LABEL'];
        $data_array[$val['JOB_NO']]['quality_level'] = $val['QUALITY_LEVEL'];
        $data_array[$val['JOB_NO']]['qlty_label'] = $val['QLTY_LABEL'];
        $data_array[$val['JOB_NO']]['job_qty_pcs'] = $val['JOB_QTY_PCS'];
        $data_array[$val['JOB_NO']]['order_uom'] = $val['ORDER_UOM'];
        $data_array[$val['JOB_NO']]['ship_mode'] = $val['SHIP_MODE'];
        $data_array[$val['JOB_NO']]['set_smv'] = $val['SET_SMV'];
        $data_array[$val['JOB_NO']]['team_leader'] = $val['TEAM_LEADER'];
        $data_array[$val['JOB_NO']]['dealing_marchant'] = $val['DEALING_MARCHANT'];
        $data_array[$val['JOB_NO']]['factory_marchant'] = $val['FACTORY_MARCHANT'];
        $data_array[$val['JOB_NO']]['inserted_by'] = $val['INSERTED_BY'];
        $data_array[$val['JOB_NO']]['updated_by'] = $val['UPDATED_BY'];
        $data_array[$val['JOB_NO']]['total_price'] = $val['TOTAL_PRICE'];

        $data_array[$val['JOB_NO']]['po_number'] .= $val['PO_NUMBER'].",";
        $data_array[$val['JOB_NO']]['order_status'] .= $val['IS_CONFIRMED'].",";
        $po_wise_data[$val['JOB_NO']]['excess_cut'] .= $val['PO_NUMBER']."=".$val['EXCESS_CUT']."**";

        $data_array[$val['JOB_NO']]['country_id'] .= $val['COUNTRY_ID'].",";
        $data_array[$val['JOB_NO']]['item_id'] .= $val['ITEM_NUMBER_ID'].",";
        $data_array[$val['JOB_NO']]['color_id'] .= $val['COLOR_NUMBER_ID'].",";
        $data_array[$val['JOB_NO']]['size_id'] .= $val['SIZE_NUMBER_ID'].",";
        $data_array[$val['JOB_NO']]['order_quantity'] += $val['ORDER_QUANTITY'];
        $data_array[$val['JOB_NO']]['plan_cut_qnty'] += $val['PLAN_CUT_QNTY'];
        if(!in_array($val['PO_ID'], $po_chk_array))
        {
            $data_array[$val['JOB_NO']]['po_quantity'] += $val['PO_QUANTITY'];
            $data_array[$val['JOB_NO']]['order_value'] += $val['PO_TOTAL_PRICE'];
            $data_array[$val['JOB_NO']]['unit_price'] .= ($data_array[$val['JOB_NO']]['unit_price']=="") ? $val['UNIT_PRICE'] : ", ".$val['UNIT_PRICE'];
            $data_array[$val['JOB_NO']]['po_insert_date'] .= ($data_array[$val['JOB_NO']]['po_insert_date']=="") ? $val['PO_INSERT_DATE'] : ", ".$val['PO_INSERT_DATE'];
            $data_array[$val['JOB_NO']]['po_received_date'] .= ($data_array[$val['JOB_NO']]['po_received_date']=="") ? $val['PO_RECEIVED_DATE'] : ", ".$val['PO_RECEIVED_DATE'];
            $data_array[$val['JOB_NO']]['factory_received_date'] .= ($data_array[$val['JOB_NO']]['factory_received_date']=="") ? $val['FACTORY_RECEIVED_DATE'] : ", ".$val['FACTORY_RECEIVED_DATE'];
            $data_array[$val['JOB_NO']]['pub_shipment_date'] .= ($data_array[$val['JOB_NO']]['pub_shipment_date']=="") ? $val['PUB_SHIPMENT_DATE'] : ", ".$val['PUB_SHIPMENT_DATE'];
            $data_array[$val['JOB_NO']]['shipment_date'] .= ($data_array[$val['JOB_NO']]['shipment_date']=="") ? $val['SHIPMENT_DATE'] : ", ".$val['SHIPMENT_DATE'];
            $data_array[$val['JOB_NO']]['txt_etd_ldd'] .= ($data_array[$val['JOB_NO']]['txt_etd_ldd']=="") ? $val['TXT_ETD_LDD'] : ", ".$val['TXT_ETD_LDD'];
            $data_array[$val['JOB_NO']]['shipment_status'] .= ($data_array[$val['JOB_NO']]['shipment_status']=="") ? $shipment_status[$val['SHIPING_STATUS']] : ", ".$shipment_status[$val['SHIPING_STATUS']];
            $data_array[$val['JOB_NO']]['lead_time'] .= ($data_array[$val['JOB_NO']]['lead_time']=="") ? $val['LEAD_TIME'] : ", ".$val['LEAD_TIME'];
            $data_array[$val['JOB_NO']]['days_in_hand'] .= ($data_array[$val['JOB_NO']]['days_in_hand']=="") ? $val['DAYS_IN_HAND'] : ", ".$val['DAYS_IN_HAND'];

            $po_chk_array[$val['PO_ID']] = $val['PO_ID'];
        }
        $data_array[$val['JOB_NO']]['cutup_date'] .= ($data_array[$val['JOB_NO']]['cutup_date']=="") ? $val['CUTUP_DATE'] : ",".$val['CUTUP_DATE'];
        $data_array[$val['JOB_NO']]['country_ship_date'] .= ($data_array[$val['JOB_NO']]['country_ship_date']=="") ? $val['COUNTRY_SHIP_DATE'] : ",".$val['COUNTRY_SHIP_DATE'];


        $job_id_array[$val['ID']] = $val['ID'];
        $job_no_array[$val['JOB_NO']] = $val['JOB_NO'];
        $po_array[$val['PO_ID']] = $val['PO_ID'];
        $po_wise_job_arr[$val['PO_ID']] = $val['JOB_NO'];
        $po_wise_unit_price_array[$val['PO_ID']] = $val['UNIT_PRICE'];
    }

    unset($sql_res);
    // echo "<pre>";print_r($po_array);echo "</pre>";die();
    /*===============================================================================/
    /                                  Job Image                                     /
    /============================================================================== */
    $job_cond = where_con_using_array($job_no_array,1,"master_tble_id");

    $imge_arr = return_library_array("SELECT master_tble_id,image_location from common_photo_library where file_type=1 $job_cond", 'master_tble_id', 'image_location');

    /*===============================================================================/
    /                                 Item Wise SMV                                  /
    /============================================================================== */
    $job_ids = implode(",", $job_id_array);
    $sql = "SELECT job_no,gmts_item_id,smv_pcs from wo_po_details_mas_set_details where job_id in($job_ids)";
    // echo $sql;die();
    $res = sql_select($sql);
    $item_smv_array = array();
    foreach ($res as $val) 
    {
        $item_smv_array[$val['JOB_NO']][$val['GMTS_ITEM_ID']] = $val['SMV_PCS'];        
    }
    // echo "<pre>";print_r($item_smv_array);
    /*===============================================================================/
    /                                   Conversion Cost                              /
    /============================================================================== */
    $job_cond = where_con_using_array($job_id_array,1,"job_id");
    $sql = "SELECT job_no,cons_process,charge_unit from wo_pre_cost_fab_conv_cost_dtls where status_active=1 and is_deleted=0 $job_cond";
    // echo $sql;
    $res = sql_select($sql);
    $conv_cost_arr = array();
    $conv_id_chk_arr = array();
    foreach ($res as $val) 
    {
            $conv_cost_arr[$val['JOB_NO']][$val['CONS_PROCESS']]['rate'] += $val['CHARGE_UNIT'];
            $conv_cost_arr[$val['JOB_NO']][$val['CONS_PROCESS']]['count']++;
        
    }
    // echo "<pre>";print_r($conv_id_chk_arr);die();
    /*===============================================================================/
    /                                  Embel Name                                    /
    /============================================================================== */
    $job_cond = where_con_using_array($job_id_array,1,"job_id");
    $sql = "SELECT job_no,emb_name from wo_pre_cost_embe_cost_dtls where status_active=1 and is_deleted=0 and emb_type!=0 $job_cond";
    // echo $sql;
    $res = sql_select($sql);
    $emb_name_arr = array();
    $emb_id_chk_arr = array();
    foreach ($res as $val) 
    {
        if(!in_array($val['EMB_NAME'], $emb_id_chk_arr[$val['JOB_NO']]))
        {
            $emb_name_arr[$val['JOB_NO']] .= ($emb_name_arr[$val['JOB_NO']]=="") ? $emblishment_name_array[$val['EMB_NAME']] : ",".$emblishment_name_array[$val['EMB_NAME']];
            $emb_id_chk_arr[$val['JOB_NO']][$val['EMB_NAME']] = $val['EMB_NAME'];
        }
    }

    /*===============================================================================/
    /                                Conversion Name                                 /
    /============================================================================== */
    $job_cond = where_con_using_array($job_id_array,1,"job_id");
    $sql = "SELECT job_no,cons_process from wo_pre_cost_fab_conv_cost_dtls where status_active=1 and is_deleted=0 $job_cond";
    // echo $sql;
    $res = sql_select($sql);
    $conv_name_arr = array();
    $conv_id_chk_arr = array();
    foreach ($res as $val) 
    {
        if(!in_array($val['CONS_PROCESS'], $conv_id_chk_arr[$val['JOB_NO']]))
        {
            $conv_name_arr[$val['JOB_NO']] .= ($conv_name_arr[$val['JOB_NO']]=="") ? $conversion_cost_head_array[$val['CONS_PROCESS']] : ",".$conversion_cost_head_array[$val['CONS_PROCESS']];
            $conv_id_chk_arr[$val['JOB_NO']][$val['CONS_PROCESS']] = $val['CONS_PROCESS'];
        }
    }
    // echo "<pre>";print_r($conv_id_chk_arr);die();
    /*===============================================================================/
    /                                  ACTUAL PO                                     /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"po_break_down_id");
    $sql = "SELECT job_no, acc_po_no FROM wo_po_acc_po_info where status_active=1 and is_deleted=0 $po_cond";
    $res = sql_select($sql);
    $acc_po_array = array();
    $acc_po_chk = array();
    foreach ($res as $key => $val) 
    {
        if(!in_array($val['ACC_PO_NO'], $acc_po_chk[$val['JOB_NO']]))
        {
            $acc_po_array[$val['JOB_NO']]['acc_po'] .= ($acc_po_array[$val['JOB_NO']]['acc_po']=="") ? $val['ACC_PO_NO'] : ", ".$val['ACC_PO_NO'];
            $acc_po_chk[$val['JOB_NO']][$val['ACC_PO_NO']] = $val['ACC_PO_NO'];
        }
    }

    /*===============================================================================/
    /                                  Booking Data                                  /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"b.po_break_down_id");
    $sql = "SELECT a.entry_form,a.process, b.job_no,a.item_category,to_char(a.booking_date,'DD-MM-YYYY') as booking_date,to_char(a.delivery_date,'DD-MM-YYYY') as delivery_date,a.booking_no,a.booking_no_prefix_num, b.po_break_down_id as po_id,a.booking_type,a.fabric_source,a.is_short,a.revised_no, b.fin_fab_qnty,b.grey_fab_qnty,a.is_approved,b.dia_width,b.gsm_weight,b.process_loss_percent,b.construction,b.copmposition,a.uom from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $booking_data_array = array();
    $pur_booking_data_array = array();
    $service_booking_data_array = array();
    $booking_qty_array = array();
    $booking_chk_array = array();
    foreach ($res as $val) 
    {
        if($val['ITEM_CATEGORY']==2)
        {
            if($val['FABRIC_SOURCE']==1)
            {
            
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['booking_date'] .= $val['BOOKING_DATE'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['booking_no'] .= $val['BOOKING_NO'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['uom'] .= $val['UOM'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['delivery_date'] .= $val['DELIVERY_DATE'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['revised_no'] .= $val['REVISED_NO'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['is_approved'] .= $val['IS_APPROVED'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['dia_width'] .= $val['DIA_WIDTH'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['gsm_weight'] .= $val['GSM_WEIGHT'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['process_loss'] .= $val['PROCESS_LOSS_PERCENT'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['construction'] .= $val['CONSTRUCTION']."__";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['copmposition'] .= $val['COPMPOSITION']."__";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['fin_fab_qnty'] += $val['FIN_FAB_QNTY'];
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['grey_fab_qnty'] += $val['GREY_FAB_QNTY'];
            }
            else
            {
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['booking_date'] .= $val['BOOKING_DATE'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['booking_no'] .= $val['BOOKING_NO'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['uom'] .= $val['UOM'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['delivery_date'] .= $val['DELIVERY_DATE'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['revised_no'] .= $val['REVISED_NO'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['is_approved'] .= $val['IS_APPROVED'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['dia_width'] .= $val['DIA_WIDTH'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['gsm_weight'] .= $val['GSM_WEIGHT'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['process_loss'] .= $val['PROCESS_LOSS_PERCENT'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['construction'] .= $val['CONSTRUCTION']."__";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['copmposition'] .= $val['COPMPOSITION']."__";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['fin_fab_qnty'] += $val['FIN_FAB_QNTY'];
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['grey_fab_qnty'] += $val['GREY_FAB_QNTY'];
            }
            if($val['ENTRY_FORM']!=108) // omit partial fab. booking
            {
                $booking_qty_array[$po_wise_job_arr[$val['PO_ID']]]['grey_fab_qnty'] += $val['GREY_FAB_QNTY'];
                $booking_qty_array[$po_wise_job_arr[$val['PO_ID']]]['fin_fab_qnty'] += $val['FIN_FAB_QNTY'];
            }
        }

        if($val['ENTRY_FORM']==228)
        {
            if($booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][228]=="")
            {
                $service_booking_data_array[$val['JOB_NO']]['knitting'] .= ($service_booking_data_array[$val['JOB_NO']]['knitting']=="") ? $val['BOOKING_NO'] : $val['BOOKING_NO'].",";
                $booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][228] = $val['BOOKING_NO'];
            }
        }

        if($val['ENTRY_FORM']==229)
        {
            if($booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][229]=="")
            {
                $service_booking_data_array[$val['JOB_NO']]['dyeing'] .= ($service_booking_data_array[$val['JOB_NO']]['dyeing']=="") ? $val['BOOKING_NO'] : $val['BOOKING_NO'].",";
                $booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][229] = $val['BOOKING_NO'];
            }
        }

        if($val['PROCESS']==35)
        {
            if($booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][35]=="")
            {
                $service_booking_data_array[$val['JOB_NO']]['aop'] .= ($service_booking_data_array[$val['JOB_NO']]['aop']=="") ? $val['BOOKING_NO'] : $val['BOOKING_NO'].",";
                $booking_chk_array[$val['JOB_NO']][$val['BOOKING_NO']][35] = $val['BOOKING_NO'];
            }
        }
       
    }
    // echo "<pre>";print_r($service_booking_data_array);echo "</pre>";die();

    /*===============================================================================/
    /                                   Short Fab booking_no                         /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"b.po_break_down_id");
    $sql="SELECT a.id as pre_cost_fabric_cost_dtls_id, a.job_no, a.color_type_id, a.gsm_weight, a.construction, a.composition FROM wo_pre_cost_fabric_cost_dtls a, wo_booking_dtls b, wo_pre_cos_fab_co_avg_con_dtls c WHERE a.job_no=b.job_no and a.id=c.pre_cost_fabric_cost_dtls_id and b.pre_cost_fabric_cost_dtls_id=a.id  and c.cons>0 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and c.status_active=1 and c.is_deleted=0 and b.is_short=1 and b.booking_type=1 $po_cond";
    // echo $sql;die();

    $res=sql_select($sql);
    $short_fab_array = array();
    foreach ($res as $val) 
    {
        $short_fab_array[$val["JOB_NO"]]=$body_part[$val[csf("body_part_id")]].', '.$color_type[$val[csf("color_type_id")]].', '.$val[csf("construction")].', '.$val[csf("composition")].', '.$val[csf("gsm_weight")];
    }


    /*===============================================================================/
    /                                    Work order data                             /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"d.id");
    $sql="SELECT a.job_no,c.emb_name, f.booking_no from wo_po_details_master a, wo_pre_cost_mst b, wo_pre_cost_embe_cost_dtls c, wo_po_break_down d, wo_pre_cos_emb_co_avg_con_dtls e, wo_booking_dtls f
    where a.id=b.job_id and a.id=c.job_id and a.id=d.job_id and a.id=e.job_id and a.job_no=f.job_no and c.id=e.pre_cost_emb_cost_dtls_id and d.id=e.po_break_down_id and e.pre_cost_emb_cost_dtls_id= f.pre_cost_fabric_cost_dtls_id and e.po_break_down_id=f.po_break_down_id and f.booking_type=6 and d.is_deleted=0 and d.status_active=1 and f.status_active=1 and f.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $work_order_data_array = array();
    foreach ($res as $val) 
    {
        $bek = explode("-", $val['BOOKING_NO']);
        $work_order_data_array[$val['JOB_NO']][$val['EMB_NAME']] = $bek[3];
        
    }
    // echo "<pre>";print_r($work_order_data_array);die;
    /*===============================================================================/
    /                            YARN DYEING WORK ORDER DATA                         /
    /============================================================================== */
    $job_id_cond = where_con_using_array($job_id_array,0,"b.job_no_id");
    $sql="SELECT b.job_no,a.yarn_dyeing_prefix_num from wo_yarn_dyeing_mst a, wo_yarn_dyeing_dtls b
    where a.id=b.mst_id and a.is_deleted=0 and a.status_active=1 and b.status_active=1 and b.is_deleted=0 $job_id_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $yd_work_order_data_array = array();
    foreach ($res as $val) 
    {
        $yd_work_order_data_array[$val['JOB_NO']] = $val['YARN_DYEING_PREFIX_NUM'];
        
    }
    /*===============================================================================/
    /                                   YARN Allocation                              /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_break_down_id");
    $sql = "SELECT a.job_no,a.is_dyied_yarn,a.qnty from inv_material_allocation_dtls a where a.status_active=1 and a.is_deleted=0 and a.item_category=1 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $yarn_allocation_array = array();
    foreach ($res as $val) 
    {
        $yarn_allocation_array[$val['JOB_NO']] += $val['QNTY'];
    }
    /*===============================================================================/
    /                                      Textile Data                              /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_breakdown_id");
    $sql = "SELECT a.po_breakdown_id,a.entry_form,a.trans_type,a.quantity from order_wise_pro_details a where a.status_active=1 and a.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $textile_data_array = array();
    $transfer_data_array = array();
    foreach ($res as $val) 
    {
        $textile_data_array[$po_wise_job_arr[$val['PO_BREAKDOWN_ID']]][$val['ENTRY_FORM']] += $val['QUANTITY'];
        $transfer_data_array[$po_wise_job_arr[$val['PO_BREAKDOWN_ID']]][$val['ENTRY_FORM']][$val['TRANS_TYPE']] += $val['QUANTITY'];
    }
    // echo "<pre>";print_r($textile_data_array);die;

    /*===============================================================================/
    /                             Yarn Rcv From Dyeing                               /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"c.po_breakdown_id");
    $sql = "SELECT c.po_breakdown_id as po_id, c.QUANTITY  from inv_receive_master a, inv_transaction b,order_wise_pro_details c where a.id=b.mst_id and b.id=c.trans_id and b.item_category=1 and a.entry_form=1 and b.transaction_type in(1) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.receive_purpose in(2) $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $yarn_rcv_from_dyeing_array = array();
    foreach ($res as $val) 
    {
        $yarn_rcv_from_dyeing_array[$po_wise_job_arr[$val['PO_ID']]] += $val['QUANTITY'];
    }
    // echo "<pre>";print_r($yarn_rcv_from_dyeing_array);die;

    /*===============================================================================/
    /                               knitting plan data                               /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_id");
    $sql="SELECT a.program_qnty,a.po_id from ppl_planning_entry_plan_dtls a where a.status_active=1 and a.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $program_data_array = array();
    foreach ($res as $val) 
    {
        $program_data_array[$po_wise_job_arr[$val['PO_ID']]] += $val['PROGRAM_QNTY'];
    }

    /*===============================================================================/
    /                               knitting production                              /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"c.po_breakdown_id");
    $sql="SELECT a.knitting_source,c.po_breakdown_id as po_id,c.quantity from inv_receive_master a,pro_grey_prod_entry_dtls b, order_wise_pro_details c where a.id=b.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and c.entry_form=2 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $knitting_data_array = array();
    foreach ($res as $val) 
    {
        $knitting_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['KNITTING_SOURCE']] += $val['QUANTITY'];
    }

    /*===============================================================================/
    /                               Dyed yarn issue                                  /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"c.po_breakdown_id");
    $sql = "SELECT c.po_breakdown_id as po_id, c.QUANTITY  from inv_issue_master a, inv_transaction b,order_wise_pro_details c,product_details_master d where a.id=b.mst_id and b.id=c.trans_id and d.id=c.prod_id and b.item_category=1 and b.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.dyed_type=1 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $dyed_yarn_issue_array = array();
    foreach ($res as $val) 
    {
        $dyed_yarn_issue_array[$po_wise_job_arr[$val['PO_ID']]] += $val['QUANTITY'];
    }
    // echo "<pre>";print_r($dyed_yarn_issue_array);die;

    /*===============================================================================/
    /                                Roll Data                         
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_breakdown_id");
    $sql = "SELECT a.po_breakdown_id,a.entry_form,a.qnty from pro_roll_details a where a.status_active=1 and a.is_deleted=0  $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $roll_data_array = array();
    foreach ($res as $val) 
    {
        $roll_data_array[$po_wise_job_arr[$val['PO_BREAKDOWN_ID']]][$val['ENTRY_FORM']] += $val['QNTY'];
    }

    /*===============================================================================/
    /                                Fab Dyeing Prodduction                          /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_id");
    $sql = "SELECT c.load_unload_id,a.po_id,c.batch_qty,c.production_qty from pro_batch_create_dtls a, pro_fab_subprocess b,pro_fab_subprocess_dtls c where a.mst_id=b.batch_id and b.id=c.mst_id and a.status_active=1 and b.status_active=1 and c.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and c.load_unload_id=2 and b.result=1 and b.entry_form=35 $po_cond";
    // echo $sql;die;
    $res = sql_select($sql);
    $fab_dyeing_array = array();
    foreach ($res as $val) 
    {
        $fab_dyeing_array[$po_wise_job_arr[$val['PO_ID']]] += $val['PRODUCTION_QTY'];
    }

    /*===============================================================================/
    /                           Fab Dyeing fin process name                          /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_id");
    $sql = "SELECT DISTINCT a.po_id,b.process_id from pro_batch_create_dtls a, pro_fab_subprocess b where a.mst_id=b.batch_id and a.status_active=1 and b.status_active=1 and b.entry_form!=35 $po_cond";
    // echo $sql;die;
    $res = sql_select($sql);
    $fab_dyeing_process_array = array();
    $process_id_chk_array = array();
    foreach ($res as $val) 
    {
        if($process_id_chk_array[$val['PROCESS_ID']]=="")
        {
            $fab_dyeing_process_array[$po_wise_job_arr[$val['PO_ID']]] .= ($fab_dyeing_process_array[$po_wise_job_arr[$val['PO_ID']]]=="") ? $conversion_cost_head_array[$val['PROCESS_ID']] : ", ".$conversion_cost_head_array[$val['PROCESS_ID']];
            $process_id_chk_array[$val['PROCESS_ID']] = $val['PROCESS_ID'];
        }
    }

    // echo "<Pre>";print_r($fab_dyeing_process_array);die();

    /*===============================================================================/
    /                                  Finish Fabric Issue                           /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"c.po_breakdown_id");
    $sql = "SELECT c.po_breakdown_id as po_id,c.quantity from inv_issue_master a, inv_finish_fabric_issue_dtls b, order_wise_pro_details c where a.id=b.mst_id and b.id=c.dtls_id and a.status_active=1 and b.status_active=1 and c.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and c.entry_form=71 and trans_type=2 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $fin_fab_data_array = array();
    foreach ($res as $val) 
    {
        $fin_fab_data_array[$po_wise_job_arr[$val['PO_ID']]]['qty'] += $val['QUANTITY'];
    }

    /*===============================================================================/
    /                                   Cut & Lay data                               /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.order_id");
    $sql = "SELECT b.entry_date, a.order_id, a.bundle_no,a.size_qty from ppl_cut_lay_bundle a,ppl_cut_lay_mst b where b.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $po_cond";
    // echo $sql;die;
    $res = sql_select($sql);
    $lay_data_array = array();
    foreach ($res as $val) 
    {
        $lay_data_array[$po_wise_job_arr[$val['ORDER_ID']]]['entry_date'] .= $val['ENTRY_DATE'].",";
        $lay_data_array[$po_wise_job_arr[$val['ORDER_ID']]]['qty'] += $val['SIZE_QTY'];
        $lay_data_array[$po_wise_job_arr[$val['ORDER_ID']]]['no_of_bndl']++;
    }

    /*===============================================================================/
    /                              Printing & Emb QC Data                            /
    /============================================================================== */
    // 254=print, 325=emb
    $po_cond = where_con_using_array($po_array,0,"c.buyer_po_id");
    $sql = "SELECT a.product_date,a.entry_form, c.buyer_po_id,b.qcpass_qty from subcon_embel_production_mst a,subcon_embel_production_dtls b,subcon_ord_dtls c where a.id=b.mst_id and c.id=b.po_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form in(223,324) $po_cond";
    // echo $sql;die;
    $res = sql_select($sql);
    $emb_qc_data_array = array();
    foreach ($res as $val) 
    {
        $emb_qc_data_array[$po_wise_job_arr[$val['BUYER_PO_ID']]][$val['ENTRY_FORM']]['product_date'] .= $val['PRODUCT_DATE'].",";
        $emb_qc_data_array[$po_wise_job_arr[$val['BUYER_PO_ID']]][$val['ENTRY_FORM']]['qty'] += $val['QCPASS_QTY'];
    }
    // echo "<pre>";print_r($emb_qc_data_array);echo "</pre>";die();

    /*===============================================================================/
    /                            Printing & Emb Delivery Data                        /
    /============================================================================== */
    // 254=print, 325=emb
    $po_cond = where_con_using_array($po_array,0,"c.buyer_po_id");
    $sql = "SELECT a.delivery_date,a.entry_form, b.buyer_po_id,b.delivery_qty from subcon_delivery_mst a,subcon_delivery_dtls b,subcon_ord_dtls c where a.id=b.mst_id and c.id=b.order_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form in(254,325)  $po_cond";
    // echo $sql;die;
    $res = sql_select($sql);
    $emb_delivery_data_array = array();
    foreach ($res as $val) 
    {
        $emb_delivery_data_array[$po_wise_job_arr[$val['BUYER_PO_ID']]][$val['ENTRY_FORM']]['delivery_date'] .= $val['DELIVERY_DATE'].",";
        $emb_delivery_data_array[$po_wise_job_arr[$val['BUYER_PO_ID']]][$val['ENTRY_FORM']]['qty'] += $val['DELIVERY_QTY'];
    }
    // echo "<pre>";print_r($emb_delivery_data_array);echo "</pre>";die();

    /*===============================================================================/
    /                                  Gmts Production                               /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_break_down_id");
    $sql = "SELECT a.production_source,a.serving_company, a.production_date,a.production_type,a.po_break_down_id as po_id,b.production_qnty,a.embel_name from pro_garments_production_mst a,pro_garments_production_dtls b,wo_po_color_size_breakdown c where a.id=b.mst_id and c.id=b.color_size_break_down_id and c.po_break_down_id=a.po_break_down_id and c.status_active=1 and c.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $po_cond order by a.production_date";
    // echo $sql;
    $res = sql_select($sql);
    $gmts_data_array = array();
    $embel_data_array = array();
    foreach ($res as $val) 
    {
        $gmts_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']]['date'] .= $val['PRODUCTION_DATE'].",";
        $gmts_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']]['qty'] += $val['PRODUCTION_QNTY'];

        $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['date'] .= $val['PRODUCTION_DATE'].",";
        $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['source'] .= $val['PRODUCTION_SOURCE'].",";
        if($val['SERVING_COMPANY']==1)
        {
            $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['wo_com_id'] .= $company_library[$val['SERVING_COMPANY']].",";
        }
        else
        {
            $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['wo_com_id'] .= $supplier_library[$val['SERVING_COMPANY']].",";
        }
        $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['qty'] += $val['PRODUCTION_QNTY'];
    }
    // echo "<pre>";print_r($embel_data_array);echo "</pre>";die();

    /*===============================================================================/
    /                            Printing & Emb Order Data                           /
    /============================================================================== */
    // 204=printing, 311=emb
    $po_cond = where_con_using_array($po_array,0,"b.buyer_po_id");
    $sql = "SELECT a.entry_form, b.buyer_po_id as po_id, b.order_quantity from subcon_ord_mst a, subcon_ord_dtls b where a.id=b.mst_id and a.status_active=1 and b.status_active=1 and b.is_deleted=0 and a.is_deleted=0 and a.within_group=1 and a.entry_form in(204,311) $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $print_emb_order_data_array = array();
    foreach ($res as $val) 
    {
        $print_emb_order_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['ENTRY_FORM']]['qty'] += $val['ORDER_QUANTITY'];
    }

    /*===============================================================================/
    /                                 Buyer Inspection                               /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_break_down_id");
    $sql = "SELECT a.job_no,a.inspection_qnty,to_char(a.inspection_date,'DD-MM-YYYY') as inspection_date from pro_buyer_inspection a where a.status_active=1 and a.is_deleted=0 $po_cond";
    $res = sql_select($sql);
    $buyer_insp_data = array();
    foreach ($res as $val) 
    {
        $buyer_insp_data[$val['JOB_NO']]['qty'] += $val['INSPECTION_QNTY'];
        $buyer_insp_data[$val['JOB_NO']]['date'] = $val['INSPECTION_DATE'];
    }

    /*===============================================================================/
    /                                  ex-factory data                               /
    /============================================================================== */
    $sql = "SELECT a.id,a.po_break_down_id as po_id,a.ex_factory_date,(case when a.entry_form !=85 then b.production_qnty else 0 end) as production_qnty,(case when a.entry_form =85 then b.production_qnty else 0 end) as return_qnty,a.total_carton_qnty from pro_ex_factory_mst a,pro_ex_factory_dtls b where a.id=b.mst_id and a.status_active=1 and b.status_active=1 and a.is_deleted=0 and b.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $ex_data_array = array();
    $id_chk_array = array();
    foreach ($res as $val) 
    {
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['ex_date'] .= $val['EX_FACTORY_DATE'].",";
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['ex_qty'] += $val['PRODUCTION_QNTY']-$val['RETURN_QNTY'];
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['rtn_qty'] += $val['RETURN_QNTY'];
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['ex_value'] += (($val['PRODUCTION_QNTY']-$val['RETURN_QNTY'])*$po_wise_unit_price_array[$val['PO_ID']]);
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['ex_rtn_value'] += ($val['RETURN_QNTY']*$po_wise_unit_price_array[$val['PO_ID']]);
        if(!in_array($val['ID'], $id_chk_array))
        {
            $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['cartot_qnty'] += $val['TOTAL_CARTON_QNTY'];
            $id_chk_array[$val['ID']] = $val['ID'];
        }
    }
    // echo "<pre>";print_r($ex_data_array);die();
    /*===============================================================================/
    /                                 Export Invoice                                 /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"b.po_breakdown_id");
    $sql = "SELECT b.po_breakdown_id as po_id,b.current_invoice_qnty,b.current_invoice_value,a.invoice_no,a.net_invo_value,a.discount_ammount from com_export_invoice_ship_mst a, com_export_invoice_ship_dtls b where a.id=b.mst_id and a.status_active=1 and b.status_active=1 and a.is_deleted=0 and b.is_deleted=0 $po_cond";
    $res = sql_select($sql);
    $invice_data = array();
    $chk_inv = array();
    foreach ($res as $val) 
    {
        $invice_data[$po_wise_job_arr[$val['PO_ID']]]['inv_qty']+=$val['CURRENT_INVOICE_QNTY'];
        $invice_data[$po_wise_job_arr[$val['PO_ID']]]['inv_value']+=$val['CURRENT_INVOICE_VALUE'];
        if($chk_inv[$val['INVOICE_NO']]=="")
        {
            $invice_data[$po_wise_job_arr[$val['PO_ID']]]['net_inv_value']+=$val['NET_INVO_VALUE'];
            $invice_data[$po_wise_job_arr[$val['PO_ID']]]['discount_ammount']+=$val['DISCOUNT_AMMOUNT'];
            $chk_inv[$val['INVOICE_NO']] = $val['INVOICE_NO'];
        }
    }

    /*===============================================================================/
    /                                      LC/SC data                                /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"b.wo_po_break_down_id");
    $sql = "SELECT b.wo_po_break_down_id as po_id,a.lien_bank,a.pay_term,a.internal_file_no,a.tenor,max(c.amendment_no) as amendment_no from com_export_lc a,com_export_lc_order_info b, com_export_lc_amendment c where a.id=b.com_export_lc_id AND a.export_lc_no = c.export_lc_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $po_cond group by b.wo_po_break_down_id,a.lien_bank,a.pay_term,a.internal_file_no,a.tenor
    UNION ALL
    SELECT b.wo_po_break_down_id as po_id,a.lien_bank,a.pay_term,a.internal_file_no,a.tenor,max(c.amendment_no) as amendment_no from com_sales_contract a,com_sales_contract_order_info b,com_sales_contract_amendment c where a.id=b.com_sales_contract_id and a.contract_no=c.contract_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $po_cond group by b.wo_po_break_down_id,a.lien_bank,a.pay_term,a.internal_file_no,a.tenor
    ";
    // echo $sql;die();
    $res = sql_select($sql);
    $lc_sc_data_array = array();
    foreach ($res as $val) 
    {
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['lien_bank'] .= $bank_library[$val['LIEN_BANK']].",";
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['pay_term'] .= $pay_term[$val['PAY_TERM']].",";
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['internal_file_no'] .= $val['INTERNAL_FILE_NO'].",";
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['tenor'] .= $val['TENOR'].",";
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['amendment_no'] .= $val['AMENDMENT_NO'].",";
    }
    // echo "<pre>";print_r($lc_sc_data_array);die();

    /*===============================================================================/
    /                                      TNA Data                                  /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_number_id");
    $sql = "SELECT a.po_number_id,a.task_number,max(a.task_start_date) as start_date,max(a.task_finish_date) as end_date,max(a.actual_start_date) as actual_start_date,max(a.actual_finish_date) as actual_finish_date,b.job_no_mst from tna_process_mst a,wo_po_break_down b where a.po_number_id=b.id and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and a.task_start_date is not null and b.po_quantity>0 $po_cond and a.task_type=1 group by a.po_number_id,a.task_number,b.job_no_mst";
    // echo $sql;die();
    $res = sql_select($sql);
    $tnaDateArray = array();
    foreach ($res as $val) 
    {
        $tnaDateArray[$val['JOB_NO_MST']][$val['TASK_NUMBER']]['start_date']          = $val['START_DATE'];
        $tnaDateArray[$val['JOB_NO_MST']][$val['TASK_NUMBER']]['end_date']            = $val['END_DATE'];
        $tnaDateArray[$val['JOB_NO_MST']][$val['TASK_NUMBER']]['actual_start_date']   = $val['ACTUAL_START_DATE'];
        $tnaDateArray[$val['JOB_NO_MST']][$val['TASK_NUMBER']]['actual_finish_date']  = $val['ACTUAL_FINISH_DATE'];
    }

    // echo "<pre>";print_r($tnaDateArray);die();
    /*===============================================================================/
    /                                    Budget Data                                 /
    /============================================================================== */
    $job_id_cond = where_con_using_array($job_id_array,0,"a.job_id");
    $sql = "SELECT a.job_no,to_char(a.costing_date,'DD-MM-YYYY') as costing_date,a.approved,b.cm_cost from wo_pre_cost_mst a,wo_pre_cost_dtls b where a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.job_id=b.job_id $job_id_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $budget_data_array = array();
    foreach ($res as $val) 
    {
        $budget_data_array[$val['JOB_NO']]['costing_date'] = $val['COSTING_DATE'];
        $budget_data_array[$val['JOB_NO']]['approved'] = $val['APPROVED'];
        $budget_data_array[$val['JOB_NO']]['cm_cost'] = $val['CM_COST'];
    }

    /*===============================================================================/
    /                              Getting data from class                           /
    /============================================================================== */
    $poIDS = implode(",", $po_array);
    $condition= new condition();     
    $condition->po_id_in($poIDS);     
    $condition->init();
    // $fabric= new fabric($condition);
    $yarn= new yarn($condition);
    $yarn_costing_arr=$yarn->getJobWiseYarnAmountArray();
    $yarn_qty_amount_arr=$yarn->getJobWiseYarnQtyAndAmountArray();

    $yarnDataWithFabricidArr=$yarn->get_By_Precostfabricdtlsid_YarnQtyAmountArray();

    $fabric= new fabric($condition);
    $fabricAmoutByFabricSource= $fabric->getAmountArray_by_job_knitAndwoven_greyAndfinish();
    $fabricQtyByFabricSource= $fabric->getQtyArray_by_job_knitAndwoven_greyAndfinish_purchase();
    
    $fabric_qty_arr=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
    $fabric_amount_arr=$fabric->getAmountArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
    $conversion= new conversion($condition);
    $conversion_costing_arr_process=$conversion->getAmountArray_by_job();
    $conv_qty_job_process= $conversion->getQtyArray_by_jobAndProcess();
    $conv_amount_job_process= $conversion->getAmountArray_by_jobAndProcess();
    $con_qty_fabric_process = $conversion->getQtyArray_by_fabricAndProcess();
    $con_amount_fabric_process = $conversion->getAmountArray_by_fabricAndProcess();

    $trims= new trims($condition);
    $trims_costing_arr=$trims->getAmountArray_by_job();
    $trims_qty_arr=$trims->getQtyArray_by_job();

    $emblishment= new emblishment($condition);
    $emblishment_costing_arr=$emblishment->getAmountArray_by_job();
    $emb_qty_job_name_arr = $emblishment->getQtyArray_by_jobAndEmbname();
    $emb_amount_job_name_arr = $emblishment->getAmountArray_by_jobAndEmbname();
    // echo "<pre>";print_r($emb_qty_job_name_arr);die();

    $wash= new wash($condition);
    $emblishment_costing_arr_wash=$wash->getAmountArray_by_job();
    $wash_qty_job_name_arr =$wash->getQtyArray_by_jobAndEmbname();
    $wash_amount_job_name_arr =$wash->getAmountArray_by_jobAndEmbname();


    $commercial= new commercial($condition);
    $commercial_costing_arr=$commercial->getAmountArray_by_job();
    $commission= new commision($condition);
    $commission_costing_arr=$commission->getAmountArray_by_job();
    $other= new other($condition);
    $other_costing_arr=$other->getAmountArray_by_job();


    /*===============================================================================/
    /                        Functin for getting max min date                        /
    /============================================================================== */
    function get_max_min_date($date_arr)
    {
        $date_arr = explode(",", implode(",", $date_arr));
        $date_array = array();
        for ($i = 0; $i < count($date_arr); $i++)
        {
            if ($i == 0)
            {
                $max_date = date('d-m-Y', strtotime($date_arr[$i]));
                $min_date = date('d-m-Y', strtotime($date_arr[$i]));
                $date_array['max_date'] = $max_date;
                $date_array['min_date'] = $min_date;
            }
            elseif ($i != 0)
            {
                $new_date = date('d-m-Y', strtotime($date_arr[$i]));
                if ($new_date > $max_date)
                {
                    $max_date = $new_date;
                    $date_array['max_date'] = $max_date;
                }
                elseif ($new_date < $min_date)
                {
                    $min_date = $new_date;
                    $date_array['min_date'] = $min_date;
                }
            }
        }
        return $date_array;
    }

    $tbl_width = 25470;

    ob_start();
    ?>
    <fieldset>
        <div class="title-part" style="margin: 0 auto;text-align: center;font-size: 20px;">
            <h2>Order Tracking Report</h2>
            <h2>Company : <?=$company_library[$company_name]; ?></h2>
            <? if($date_from!=""){?>
            <h2>Date : <?=change_date_format($date_from); ?>To<?=change_date_format($date_to); ?> </h2>
            <? } ?>
        </div>
        <style type="text/css">
            table thead tr td{
                padding: 5px;text-align: center;font-weight: bold;font-size: 16px;
            }
            .zoom {
              padding: 0px;
              transition: transform .2s; 
              width: 30px;
              height: 30px;
              margin: 0 auto;
              z-index: 9999 !important;
              overflow: hidden !important;
              visibility: visible;
              position: relative;
            }

            .zoom:hover {
              transform: scale(4); 

              z-index: 9999 !important;
              overflow: hidden !important;
              visibility: visible;
            }
        </style>
        <div class="report-container-part">
            <!-- ================================= report header ================================== -->
            <table cellspacing="0" border="1" class="rpt_table"   rules="all" width="<?=$tbl_width;?>"  align="center" id="table_header_1">
                <thead>
                    <tr style="">
                        <td style="background: #95DAC1;" colspan="86">Order Information</td>
                        <td style="background: #FACE7F;" colspan="5">Budget Information</td>
                        <td style="background: #5C7AEA;" colspan="14">Main Fabric Booking Information</td>
                        <td style="background: #F56FAD;" colspan="8">Purchase Fabric Booking Information</td>
                        <td style="background: #A2CDCD;" colspan="9">Short/EFR Fabric Booking Information</td>
                        <th width="80" rowspan="2"><p>Trims/Acc Status</p></th>
                        <td style="background: #F0D9FF;" colspan="6">Grey Yarn Status</td>
                        <td style="background: #B1E693;" colspan="8">Dyed Yarn Status (Business not ready)</td>
                        <td style="background: #63B4B8;" colspan="7">Yarn Dyed Production Status (Business not ready)</td>
                        <td style="background: #E05D5D;" colspan="13">Knitting Status</td>
                        <td style="background: #C8C6C6;" colspan="9">Grey Fabric Store Status</td>
                        <td style="background: #BFA2DB;" colspan="6">Dyeing Status</td>
                        <td style="background: #6B7AA1;" colspan="12">Dyeing Finishing Status</td>
                        <td style="background: #C1CFC0;" colspan="10">Finish Fabric Store Status</td>
                        <td style="background: #8FC1D4;" colspan="23">Cutting Status</td>
                        <td style="background: #FFF5B7;" colspan="7">Print Status</td>
                        <td style="background: #FF449F;" colspan="7">Embroidery Status</td>
                        <td style="background: #EBA83A;" colspan="9">Sewing Status</td>
                        <td style="background: #B5FFD9;" colspan="9">Garments Finishing Status</td>
                        <td style="background: #E798AE;" colspan="20">Shipment Status</td>
                        <td style="background: #867AE9;" colspan="25">Budget VS Actual</td>
                        <td style="background: #C449C2;" colspan="25">Order Activities/TNA</td>
                    </tr>
                    <tr>
                        <th width="30"><p>Sl.</p></th>
                        <th width="60"><p>Order Status</p></th>
                        <th width="100"><p>LC Company</p></th>
                        <th width="80"><p>Image</p></th>
                        <th width="100"><p>Buyer</p></th>
                        <th width="50"><p>Year</p></th>
                        <th width="90"><p>Job</p></th>
                        <th width="80"><p>Repeat Job No</p></th>
                        <th width="80"><p>Sample Req. No</p></th>
                        <th width="80"><p>Style Ref</p></th>
                        <th width="80"><p>Style Desc</p></th>
                        <th width="80"><p>Gmts Item</p></th>
                        <th width="80"><p>Season</p></th>
                        <th width="80"><p>Prod Dept</p></th>
                        <th width="80"><p>Prod. Dept Code / Class</p></th>
                        <th width="80"><p>Sub Dept</p></th>
                        <th width="80"><p>Brand</p></th>
                        <th width="80"><p>Prod. Catg</p></th>
                        <th width="80"><p>Country</p></th>
                        <th width="80"><p>Sustainability Standard</p></th>
                        <th width="80"><p>Fabric Material</p></th>
                        <th width="80"><p>Order Nature</p></th>
                        <th width="80"><p>Quality Label</p></th>
                        <th width="80"><p>Embilshement Name</p></th>
                        <th width="80"><p>Service Name</p></th>
                        <th width="80"><p>Order/PO No</p></th>
                        <th width="80"><p>Actual Order/PO No</p></th>
                        <th width="80"><p>GMT Color</p></th>
                        <th width="80"><p>Size</p></th>
                        <th width="80"><p>Ex Cut %</p></th>
                        <th width="80"><p>Order Qnty [Pcs]</p></th>
                        <th width="80"><p>Break Down Order Qnty [Pcs]</p></th>
                        <th width="80"><p>Order Qnty with Cut% [Pcs]</p></th>
                        <th width="80"><p>Order Qnty [Uom]</p></th>
                        <th width="80"><p>Uom</p></th>
                        <th width="80"><p>Per Unit Price</p></th>
                        <th width="80"><p>Order Value</p></th>
                        <th width="80"><p>PO Insert Date</p></th>
                        <th width="80"><p>PO Receive Date</p></th>
                        <th width="80"><p>Fabric Budget Start Date</p></th>
                        <th width="80"><p>1st Cut Date</p></th>
                        <th width="80"><p>Last Cut Date</p></th>
                        <th width="80"><p>1st Sew Date</p></th>
                        <th width="80"><p>Last Sew Date</p></th>
                        <th width="80"><p>1st Finish Date</p></th>
                        <th width="80"><p>Last Finish Date</p></th>
                        <th width="80"><p>Insp. Offer Date</p></th>
                        <th width="80"><p>Insp. Date</p></th>
                        <th width="80"><p>Pub. Shipment Date</p></th>
                        <th width="80"><p>First Shipment Date </p></th>
                        <th width="80"><p>Org. Shipment Date </p></th>
                        <th width="80"><p>ETD/LDD Date</p></th>
                        <th width="80"><p>Cut-off Date</p></th>
                        <th width="80"><p>Country Shipment Date</p></th>
                        <th width="80"><p>RFI Plan Date</p></th>
                        <th width="80"><p>Shipment Mode</p></th>
                        <th width="80"><p>Lead Time</p></th>
                        <th width="80"><p>Days in Hand</p></th>
                        <th width="80"><p>Commercial File No</p></th>
                        <th width="80"><p>Lien Bank</p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p>Ex. LC/SC Amendment No(Last)</p></th>
                        <th width="80"><p>Pay Term</p></th>
                        <th width="80"><p>Tenor</p></th>
                        <th width="80"><p>First Shipment Date</p></th>
                        <th width="80"><p>Last Shipment Date</p></th>
                        <th width="80"><p>Shipment Qnty</p></th>
                        <th width="80"><p>Shipment Value</p></th>
                        <th width="80"><p>Excess Shipment Qnty</p></th>
                        <th width="80"><p>Excess Shipment Value</p></th>
                        <th width="80"><p>Short Shipment Qnty</p></th>
                        <th width="80"><p>Short Shipment Value</p></th>
                        <th width="80"><p>Shipping Status</p></th>
                        <th width="80"><p>SMV</p></th>
                        <th width="80"><p>Total SMV</p></th>
                        <th width="80"><p>CM</p></th>
                        <th width="80"><p>Team Leader</p></th>
                        <th width="80"><p>Dealing Merchandiser</p></th>
                        <th width="80"><p>Factory Merchandiser</p></th>
                        <th width="80"><p>Insert User</p></th>
                        <th width="80"><p>Lab Dip No</p></th>
                        <th width="80"><p>Buyer Sample Status</p></th>
                        <th width="80"><p>Order Status</p></th>
                        <th width="80"><p>Referance Closed </p></th>
                        <th width="80"><p>Emb. Work Order No</p></th>
                        <th width="80"><p>Service Work Order No</p></th>

                        <th width="80"><p>Budget Date</p></th>
                        <th width="80"><p>Budget Value</p></th>
                        <th width="80"><p>Open Value</p></th>
                        <th width="80"><p>Approved</p></th>
                        <th width="80"><p>Amendment No</p></th>
                        
                        <th width="80"><p>M Fabric Booking Date</p></th>
                        <th width="80"><p>M Fabric Booking No</p></th>
                        <th width="80"><p>Fabric Delivery Date</p></th>
                        <th width="80"><p>Amendment No</p></th>
                        <th width="80"><p>Amendment Date</p></th>
                        <th width="80"><p>Approved Status</p></th>
                        <th width="80"><p>Yarn Description</p></th>
                        <th width="80"><p>Fabric Construction</p></th>
                        <th width="80"><p>Fabric Composition</p></th>
                        <th width="80"><p>GSM</p></th>
                        <th width="80"><p>Dia/Width</p></th>
                        <th width="80"><p>Grey Qnty Kg</p></th>
                        <th width="80"><p>Finish Quantity</p></th>
                        <th width="80"><p>Process Loss%</p></th>

                        <th width="80"><p>Fabric Booking Date</p></th>
                        <th width="80"><p>Fabric Booking No</p></th>
                        <th width="80"><p>Fabric Delivery Date</p></th>
                        <th width="80"><p>Fabrication</p></th>
                        <th width="80"><p>Uom</p></th>
                        <th width="80"><p>Qnty</p></th>
                        <th width="80"><p>Supplier</p></th>
                        <th width="80"><p>Approved Status</p></th>

                        <th width="80"><p>Fabric Booking Date</p></th>
                        <th width="80"><p>Fabric Booking No</p></th>
                        <th width="80"><p>Fabric Delivery Date</p></th>
                        <th width="80"><p>Fabrication</p></th>
                        <th width="80"><p>Uom</p></th>
                        <th width="80"><p>Grey Qnty</p></th>
                        <th width="80"><p>Finish Quantity</p></th>
                        <th width="80"><p>Process Loss%</p></th>
                        <th width="80"><p>Approved Status</p></th>

                        <th width="80"><p>Grey Yarn Require with Short/EFR Qnty</p></th>
                        <th width="80"><p>Yarn Allocation Qnty</p></th>
                        <th width="80"><p>Yarn Excess Allocation Qnty</p></th>
                        <th width="80"><p>Yarn Issued Qnty</p></th>
                        <th width="80"><p>Yarn Issue Balance Qnty</p></th>
                        <th width="80"><p>Yarn Excess Issued Qty </p></th>

                        <th width="80"><p>Dyed Yarn Require with Short/EFR Qnty</p></th>
                        <th width="80"><p>Dyed Yarn Allocation Qnty</p></th>
                        <th width="80"><p>Dyed Yarn Excess Allocation Qnty</p></th>
                        <th width="80"><p>Dyed Yarn Received Qnty</p></th>
                        <th width="80"><p>Dyed Yarn Receive Balance Qnty</p></th>
                        <th width="80"><p>Dyed Yarn Issued Qnty</p></th>
                        <th width="80"><p>Dyed Yarn Issue Balance Qnty</p></th>
                        <th width="80"><p>Dyed Yarn Excess Issued Qty </p></th>

                        <th width="80"><p>Dyed Yarn Require with Short/EFR Qnty</p></th>
                        <th width="80"><p>Service Work Order Qty</p></th>
                        <th width="80"><p>Yarn Dyed Produciton Qty</p></th>
                        <th width="80"><p>Yarn Dyed Produciton WIP Qty</p></th>
                        <th width="80"><p>Yarn Dyed Delivery Qty</p></th>
                        <th width="80"><p>Yarn Dyed Challan No</p></th>
                        <th width="80"><p>Yarn Dyed Challan Date</p></th>

                        <th width="80"><p>Knitting Require with EFR Qnty</p></th>
                        <th width="80"><p>Knitting Plan Qnty</p></th>
                        <th width="80"><p>Knitting Plan WIP Qnty</p></th>
                        <th width="80"><p>Knitting Work Order No</p></th>
                        <th width="80"><p>Knitting Production Qnty [Inbound]</p></th>
                        <th width="80"><p>Knitting Production Qnty [Outbound]</p></th>
                        <th width="80"><p>TTL Knitting Production Qnty </p></th>
                        <th width="80"><p>TTL Knitting Excess Production Qnty</p></th>
                        <th width="80"><p>TTL Knitting Production WIP Qnty</p></th>
                        <th width="80"><p>Price/KG [TK]</p></th>
                        <th width="80"><p>Total Price [TK]</p></th>
                        <th width="80"><p>Knitting Grey Fabric Delivery Qnty To Store</p></th>
                        <th width="80"><p>Closing Status</p></th>

                        <th width="80"><p>Require with Short/EFR Qnty</p></th>
                        <th width="80"><p>Normal Received Qnty</p></th>
                        <th width="80"><p>Receive Balance Qnty</p></th>
                        <th width="80"><p>Transfer Received Qnty</p></th>
                        <th width="80"><p>TTL Fabric Received Qnty</p></th>
                        <th width="80"><p>Normal Issued Qnty</p></th>
                        <th width="80"><p>Trasfered Issued Qnty</p></th>
                        <th width="80"><p>TTL Fabric Issued Qnty</p></th>
                        <th width="80"><p>Stock In Hand</p></th>

                        <th width="80"><p>Require with Short/EFR Qnty</p></th>
                        <th width="80"><p>Fabric Received by Batch </p></th>
                        <th width="80"><p>Batch Qnty</p></th>
                        <th width="80"><p>Production Qnty</p></th>
                        <th width="80"><p>Production Excess Qnty</p></th>
                        <th width="80"><p>Production WIP Qnty</p></th>

                        <th width="80"><p>Require with Short/EFR Qnty</p></th>
                        <th width="80"><p>Production Qnty</p></th>
                        <th width="80"><p>Production Excess Qnty</p></th>
                        <th width="80"><p>Production WIP Qnty</p></th>
                        <th width="80"><p>Process Name</p></th>
                        <th width="80"><p>QC Received Qnty</p></th>
                        <th width="80"><p>AOP Issue Qnty</p></th>
                        <th width="80"><p>AOP Receive Qnty</p></th>
                        <th width="80"><p>AOP Receive WIP Qnty</p></th>
                        <th width="80"><p>QC Delivery Qnty To Store</p></th>
                        <th width="80"><p>QC Stock in Hand</p></th>
                        <th width="80"><p>Closing Status</p></th>

                        <th width="80"><p>Require with Short/EFR Qnty</p></th>
                        <th width="80"><p>Received Qnty</p></th>
                        <th width="80"><p>Receive Excess Qnty</p></th>
                        <th width="80"><p>Receive Balance Qnty</p></th>
                        <th width="80"><p>Transfer Received Qnty</p></th>
                        <th width="80"><p>TTL Received Qnty</p></th>
                        <th width="80"><p>Normal Issued Qnty</p></th>
                        <th width="80"><p>Trasfered Issued Qnty</p></th>
                        <th width="80"><p>TTL Issued Qnty</p></th>
                        <th width="80"><p>Stock In Hand</p></th>

                        <th width="80"><p>Require with Short/EFR Qnty</p></th>
                        <th width="80"><p>Fabric Receive Qnty By Cutting</p></th>
                        <th width="80"><p>Excess Receive Qnty By Cutting </p></th>
                        <th width="80"><p>Receive Balance Qnty By Cutting</p></th>
                        <th width="80"><p>Cutting Status</p></th>
                        <th width="80"><p>Oreder Qnty</p></th>
                        <th width="80"><p>Excess Cutting %</p></th>
                        <th width="80"><p>Order Qnty with Cut%</p></th>
                        <th width="80"><p>Cutting Bundle Qnty</p></th>
                        <th width="80"><p>Cutting Lay Qnty</p></th>
                        <th width="80"><p>Cutting Production [QC] Qnty</p></th>
                        <th width="80"><p>Excess Cutting Qnty</p></th>
                        <th width="80"><p>Cutting Production Balance Qnty</p></th>
                        <th width="80"><p>Input Qnty</p></th>
                        <th width="80"><p>Input WIP Qnty</p></th>
                        <th width="80"><p>Print Send Qnty</p></th>
                        <th width="80"><p>Print Receive Qnty</p></th>
                        <th width="80"><p>Print WIP Qnty</p></th>
                        <th width="80"><p>Print Supplier</p></th>
                        <th width="80"><p>EMB Send Qnty</p></th>
                        <th width="80"><p>EMB Receive Qnty</p></th>
                        <th width="80"><p>EMB WIP Balance Qnty</p></th>
                        <th width="80"><p>EMB Supplier</p></th>

                        <th width="80"><p>Require Qnty</p></th>
                        <th width="80"><p>Order Qnty</p></th>
                        <th width="80"><p>Order Balance Qnty</p></th>
                        <th width="80"><p>Production [QC] Qnty</p></th>
                        <th width="80"><p>Production Excess Qnty</p></th>
                        <th width="80"><p>Production WIP Qnty</p></th>
                        <th width="80"><p>Delivery Qnty To Cutting</p></th>

                        <th width="80"><p>Require Qnty</p></th>
                        <th width="80"><p>Work Order Qnty</p></th>
                        <th width="80"><p>Work Order Balance Qnty</p></th>
                        <th width="80"><p>Production [QC] Qnty</p></th>
                        <th width="80"><p>Production Excess Qnty</p></th>
                        <th width="80"><p>Production WIP Qnty</p></th>
                        <th width="80"><p>Delivery Qnty To Cutting</p></th>

                        <th width="80"><p>Order Qnty</p></th>
                        <th width="80"><p>Require Cut% Qnty</p></th>
                        <th width="80"><p>Input Qnty</p></th>
                        <th width="80"><p>Input Excess Qnty</p></th>
                        <th width="80"><p>Input Balance Qnty</p></th>
                        <th width="80"><p>Production [Output] Qnty</p></th>
                        <th width="80"><p>Production Excess Qnty</p></th>
                        <th width="80"><p>Balance Qty</p></th>
                        <th width="80"><p>Production WIP Qnty</p></th>

                        <th width="80"><p>Require Qnty</p></th>
                        <th width="80"><p>Iron Qnty</p></th>
                        <th width="80"><p>Hangtag Qnty</p></th>
                        <th width="80"><p>Poly Qnty</p></th>
                        <th width="80"><p>Finish Quantity</p></th>
                        <th width="80"><p>Balance Qty</p></th>
                        <th width="80"><p>Inspection Offer Date</p></th>
                        <th width="80"><p>Inspection Date</p></th>
                        <th width="80"><p>Inspection Qnty</p></th>

                        <th width="80"><p>Carton Qty</p></th>
                        <th width="80"><p>Shipment Qnty</p></th>
                        <th width="80"><p>Invoice Qty</p></th>
                        <th width="80"><p>Shipment Value</p></th>
                        <th width="80"><p>Invoice Value</p></th>
                        <th width="80"><p>Net Invoice Value</p></th>
                        <th width="80"><p>Excess Shipment Qnty</p></th>
                        <th width="80"><p>Excess Shipment Value </p></th>
                        <th width="80"><p>Short Shipment Qnty</p></th>
                        <th width="80"><p>Short Shipment Value</p></th>
                        <th width="80"><p>Shipment Return Qnty</p></th>
                        <th width="80"><p>Shipment Return Value</p></th>
                        <th width="80"><p>First Shipment Date</p></th>
                        <th width="80"><p>Last Shipment Date</p></th>
                        <th width="80"><p>Discount / Penalty / Claim Amount</p></th>
                        <th width="80"><p>Reason of Discount / Penalty / Claim </p></th>
                        <th width="80"><p>Order to Ship Qty </p></th>
                        <th width="80"><p>Order to Ship % </p></th>
                        <th width="80"><p>Cut to Ship Qty </p></th>
                        <th width="80"><p>Cut to Ship % </p></th>

                        <th width="80"><p>Budget Date</p></th>
                        <th width="80"><p>Budget Yarn Cost</p></th>
                        <th width="80"><p>Actual Yarn Cost</p></th>
                        <th width="80"><p>Budget Finish YD Cost</p></th>
                        <th width="80"><p>Actual Finish YD Cost</p></th>
                        <th width="80"><p>Budget Knitting Cost</p></th>
                        <th width="80"><p>Actual Knitting Cost</p></th>
                        <th width="80"><p>Budget Dyeing & Finishing Cost</p></th>
                        <th width="80"><p>Actual Dyeing & Finishing Cost</p></th>
                        <th width="80"><p>Budget Fabric Purchase Cost</p></th>
                        <th width="80"><p>Actual Fabric Purchase Cost</p></th>
                        <th width="80"><p>Budget AOP Cost</p></th>
                        <th width="80"><p>Actual AOP Cost</p></th>
                        <th width="80"><p>Budget Print Cost</p></th>
                        <th width="80"><p>Actual Print Cost</p></th>
                        <th width="80"><p>Budget Emb Cost</p></th>
                        <th width="80"><p>Actual Emb Cost</p></th>
                        <th width="80"><p>Budget Wash Cost</p></th>
                        <th width="80"><p>Actual Wash Cost</p></th>
                        <th width="80"><p>Budget Trims Cost</p></th>
                        <th width="80"><p>Actual Trims Cost</p></th>
                        <th width="80"><p>Budget MISC Cost</p></th>
                        <th width="80"><p>Actual MISC Cost</p></th>
                        <th width="80"><p>Budget CM</p></th>
                        <th width="80"><p>Actual CM</p></th>

                        <th width="80"><p>Lead Time [Templete]</p></th>
                        <th width="80"><p>Yarn Receive Start</p></th>
                        <th width="80"><p>Yarn Receive End</p></th>
                        <th width="80"><p>Knitting Start</p></th>
                        <th width="80"><p>Knitting End</p></th>
                        <th width="80"><p>Dyeing Start</p></th>
                        <th width="80"><p>Dyeing End</p></th>
                        <th width="80"><p>Finish Fabric Prod. Start</p></th>
                        <th width="80"><p>Finish Fabric Prod. End</p></th>
                        <th width="80"><p>Trims Receive Start</p></th>
                        <th width="80"><p>Trims Receive End</p></th>
                        <th width="80"><p>Cutting Start</p></th>
                        <th width="80"><p>Cutting End</p></th>
                        <th width="80"><p>Print Start</p></th>
                        <th width="80"><p>Print End</p></th>
                        <th width="80"><p>Emb Start</p></th>
                        <th width="80"><p>Emb End</p></th>
                        <th width="80"><p>Sewing Start</p></th>
                        <th width="80"><p>Sewing End</p></th>
                        <th width="80"><p>GMT Finihsing Start</p></th>
                        <th width="80"><p>GMT Finihsing End</p></th>
                        <th width="80"><p>Inspection Start</p></th>
                        <th width="80"><p>Inspection End</p></th>
                        <th width="80"><p>Shipment  Start</p></th>
                        <th width="80"><p>Shipment  End</p></th>
                    </tr>
                </thead>
            </table>
            <!-- =================================== report body ==================================== -->
            <div style=" max-height:300px; width:<?=$tbl_width+20;?>px; overflow-y:scroll;" id="scroll_body">
                <table cellspacing="0" border="1" class="rpt_table"   rules="all" width="<?=$tbl_width;?>"  align="center" id="table_body">
                    <tbody>
                        <?
                        $i=1;
                        $gr_job_total = 0;
                        $gr_po_total = 0;
                        $gr_color_size_total = 0;
                        $gr_plan_cut_total = 0;
                        $gr_order_value_total = 0;

                        foreach ($data_array as $job_key => $row) 
                        {   
                            $bgcolor=($i%2==0)?"#E9F3FF":"#FFFFFF";   
                            $ship_excess_qty = max($ex_data_array[$job_key]['ex_qty'] - $row['order_quantity'],0);
                            $ship_excess_val = max($ex_data_array[$job_key]['ex_value'] - $row['order_value'],0); 
                            $ship_short_qty = max($row['order_quantity'] - $ex_data_array[$job_key]['ex_qty'],0);
                            $ship_short_val = max($row['order_value'] - $ex_data_array[$job_key]['ex_value'],0);

                            // =============================== for budget data ===========================
                            $finishing_arr = array('209','165','33','94','63','171','65','170','156','179','200','208','127','125','84','68','128','190','242','240','192','172','90','218','67','197','73','66','185','142');
                            $total_finishing_amount=0;
                            $total_finishing_qty=0;
                            $other_cost_attr = array('inspection','freight','certificate_pre_cost','deffdlc_cost','design_cost','studio_cost','common_oh','interest_cost','incometax_cost','depr_amor_pre_cost');
                            $total_other_cost = 0;
                            foreach ($other_cost_attr as $attr) {
                                $total_other_cost+=$other_costing_arr[$job_key][$attr];
                            }
                            $misc_cost=$other_costing_arr[$job_key]['lab_test']+$commercial_costing_arr[$job_key]+$commission_costing_arr[$job_key]+$total_other_cost;

                            foreach ($finishing_arr as $fid) {
                                $total_finishing_amount += array_sum($conv_amount_job_process[$job_key][$fid]);
                                $total_finishing_qty += array_sum($conv_qty_job_process[$job_key][$fid]);
                            }

                            $total_fabic_cost=0;
                            if(count($conv_amount_job_process[$job_key][31])>0){
                                $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][31])/array_sum($conv_qty_job_process[$job_key][31]);
                            }
                            $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][31]);
                            $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][31])/$order_values*100;
                            if(count($conv_amount_job_process[$job_key][30])>0){
                                $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][30])/array_sum($conv_qty_job_process[$job_key][30]);
                            }
                            if($yarn_qty_amount_arr[$job_key]['amount']!=''){
                                $total_fabic_cost+=$yarn_qty_amount_arr[$job_key]['amount']/$yarn_qty_amount_arr[$job_key]['qty'];
                            }
                            $total_fabric_amount +=$yarn_qty_amount_arr[$job_key]['amount']; 
                            $total_fabric_per +=$yarn_qty_amount_arr[$job_key]['amount']/$order_values*100;
                            if($total_finishing_amount!=0){
                                $total_fabic_cost+=$total_finishing_amount/$total_finishing_qty;
                            } 
                            $total_fabric_amount +=$total_finishing_amount;
                            $total_fabric_per +=$total_finishing_amount/$order_values*100;
                            $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][30]);
                            $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][30])/$order_values*100;
                            if(count($conv_amount_job_process[$job_key][35])>0){
                                $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][35])/array_sum($conv_qty_job_process[$job_key][35]);
                            }
                            $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][35]); 
                            $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][35])/$order_values*100;
                            if(count($conv_amount_job_process[$job_key][1])>0){
                                $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][1])/array_sum($conv_qty_job_process[$job_key][1]);
                            }
                            $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][1]);
                            $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][1])/$order_values*100; 

                            $purchase_amount = array_sum($fabricAmoutByFabricSource['knit']['grey'][$job_key])+array_sum($fabricAmoutByFabricSource['woven']['grey'][$job_key]);
                            $purchase_qty = array_sum($fabricQtyByFabricSource['knit']['grey'][$job_key])+array_sum($fabricQtyByFabricSource['woven']['grey'][$job_key]);

                            $ather_emb_attr = array(4,5,6,99);
                            foreach ($ather_emb_attr as $att) {
                                $others_emb_amount += $emb_amount_job_name_arr[$job_key][$att];
                                $others_emb_qty += $emb_qty_job_name_arr[$job_key][$att];
                            }
                            $knitting_amount_summ=''; $dyeing_amount_summ=''; $yds_amount_summ=''; $aop_amount_summ='';
                            if(count($conv_amount_job_process[$job_key][1])>0) {
                                $knitting_amount_summ = fn_number_format(array_sum($conv_amount_job_process[$job_key][1]),2);
                            }
                            $yarn_amount_summ = $yarn_qty_amount_arr[$job_key]['amount'];
                            $print_amount_summ = $emb_amount_job_name_arr[$job_key][1];      
                            $emb_amount_summ= $emb_amount_job_name_arr[$job_key][2];
                            $wash_amount_summ = $wash_amount_job_name_arr[$job_key][3];
                            if(count($conv_amount_job_process[$job_key][31])>0) {
                                $dyeing_amount_summ=  array_sum($conv_amount_job_process[$job_key][31]);
                            }
                            if(count($conv_amount_job_process[$job_key][30])>0) {
                                $yds_amount_summ = array_sum($conv_amount_job_process[$job_key][30]);
                            }
                            if(count($conv_amount_job_process[$job_key][35])>0) {
                                $aop_amount_summ = array_sum($conv_amount_job_process[$job_key][35]);
                            }
                            
                            $total_budget_value = $yarn_amount_summ+$total_finishing_amount+$print_amount_summ+$trims_costing_arr[$job_key]+$yds_amount_summ+$aop_amount_summ+$emb_amount_summ+$knitting_amount_summ+$purchase_amount+$wash_amount_summ+$other_costing_arr[$job_key]['cm_cost']+$dyeing_amount_summ+$others_emb_amount+$misc_cost;
                            $open_value = $row['total_price']-$total_budget_value;

                            $cur_date = date('d-m-Y');
                            $currency_rate=set_conversion_rate( 2, $cur_date,$row['company_name']);
                            $price_kg_tk = ($conv_cost_arr[$job_key][1]['rate']*$currency_rate)/$conv_cost_arr[$job_key][1]['count'];
                            $total_price_kg_tk = ($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3])*$price_kg_tk;

                            $cutting_status = ($row['job_qty_pcs'] > $gmts_data_array[$job_key][1]['qty']) ? "Running" : "Close";
                            $excess_cut_qty = $gmts_data_array[$job_key][1]['qty'] - $row['job_qty_pcs'];
                            $excess_cut_prsnt = ($excess_cut_qty>0) ? ($excess_cut_qty/$row['job_qty_pcs'])*100 : 0;

                            $order_to_ship_qty = ($ex_data_array[$job_key]['ex_qty'] - $row['job_qty_pcs']);
                            $order_to_ship_prsnt = ($ex_data_array[$job_key]['ex_qty'] != $row['job_qty_pcs']) ? (($order_to_ship_qty/$row['job_qty_pcs'])*100) : 100;
                            $cut_to_ship_qty = ($ex_data_array[$job_key]['ex_qty'] - $lay_data_array[$job_key]['qty']);
                            $cut_to_ship_prsnt = ($lay_data_array[$job_key]['qty']>0) ? (100 - ($cut_to_ship_qty/$lay_data_array[$job_key]['qty'])*100) : 0;

                            ?>
                            <tr bgcolor="<? echo $bgcolor;?>" id="tr_<?= $i;?>" onClick="change_color('tr_<?= $i; ?>','<?= $bgcolor; ?>')">
                                <td width="30"><p><?=$i;?></p></td>
                                <td width="60">
                                    <p>
                                        <?
                                        $order_status_arr = array_unique(array_filter(explode(",", $row['order_status'])));
                                        $order_status_name = "";
                                        foreach ($order_status_arr as $val) 
                                        {
                                            $order_status_name .= ($order_status_name=="") ? $order_status[$val] : ", ".$order_status[$val];
                                        }
                                        echo $order_status_name;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="100"><p><?=$company_library[$row['company_name']];?></p></td>
                                <td width="80"></td>
                                <td width="100"><p><?=$buyer_library[$row['buyer_name']];?></p></td>
                                <td width="50" align="center"><p><?=$row['year'];?></p></td>
                                <td width="90"><p><?=$job_key;?></p></td>
                                <td width="80"><p><?=$row['repeat_job_no'];?></p></td>
                                <td width="80"><p><?=$row['req_no'];?></p></td>
                                <td width="80"><p><?=$row['style'];?></p></td>
                                <td width="80"><p><?=$row['style_des'];?></p></td>
                                <td width="80">
                                    <p>
                                        <?
                                        $item_id_arr = array_unique(array_filter(explode(",", $row['item_id'])));
                                        $item_name = "";
                                        $item_smv = "";
                                        $tot_item_smv = 0;
                                        foreach ($item_id_arr as $val) 
                                        {
                                            $item_name .= ($item_name=="") ? $garments_item[$val] : ", ".$garments_item[$val];
                                            $item_smv .= ($item_smv=="") ? $garments_item[$val]." : ".$item_smv_array[$job_key][$val] : ", ".$garments_item[$val]." : ".$item_smv_array[$job_key][$val];
                                            $tot_item_smv += $item_smv_array[$job_key][$val];
                                        }
                                        echo $item_name;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80"><p><?=$season_library[$row['season']];?></p></td>
                                <td width="80"><p><?=$product_dept[$row['product_dept']];?></p></td>
                                <td width="80"><p><?=$row['product_code'];?></p></td>
                                <td width="80"><p><?=$sub_dep_library[$row['pro_sub_dep']];?></p></td>
                                <td width="80"><p><?=$brand_library[$row['brand_id']];?></p></td>
                                <td width="80"><p><?=$product_category[$row['product_category']];?></p></td>
                                <td width="80">
                                    <p>
                                        <?
                                        $country_id_arr = array_unique(array_filter(explode(",", $row['country_id'])));
                                        $country_name = "";
                                        foreach ($country_id_arr as $val) 
                                        {
                                            $country_name .= ($country_name=="") ? $country_library[$val] : ", ".$country_library[$val];
                                        }
                                        echo $country_name;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80"><p><?=$sustainability_standard[$row['sustainability_standard']];?></p></td>
                                <td width="80"><p><?=$fab_material[$row['fab_material']];?></p></td>
                                <td width="80"><p><?=$fbooking_order_nature[$row['quality_level']];?></p></td>
                                <td width="80"><p><?=$quality_label[$row['qlty_label']];?></p></td>
                                <td width="80"><p><?=$emb_name_arr[$job_key];?></p></td>
                                <td width="80"><p><?=$conv_name_arr[$job_key];?></p></td>
                                <td width="80">
                                    <p>
                                        <?
                                        $po_number_arr = array_unique(array_filter(explode(",", $row['po_number'])));
                                        $po_name = "";
                                        foreach ($po_number_arr as $val) 
                                        {
                                            $po_name .= ($po_name=="") ? $val : ", ".$val;
                                        }
                                        echo $po_name;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80"><p><?=$acc_po_array[$job_key]['acc_po'];?></p></td>
                                <td width="80">
                                    <p>
                                        <?
                                        $color_arr = array_unique(array_filter(explode(",", $row['color_id'])));
                                        $color_name = "";
                                        foreach ($color_arr as $val) 
                                        {
                                            $color_name .= ($color_name=="") ? $color_library[$val] : ", ".$color_library[$val];
                                        }
                                        echo $color_name;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80">
                                    <p>
                                        <?
                                        $size_arr = array_unique(array_filter(explode(",", $row['size_id'])));
                                        $size_name = "";
                                        foreach ($size_arr as $val) 
                                        {
                                            $size_name .= ($size_name=="") ? $size_library[$val] : ", ".$size_library[$val];
                                        }
                                        echo $size_name;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80">
                                    <p>
                                        <?
                                        $excess_cut_arr = array_unique(array_filter(explode("**", $po_wise_data[$job_key]['excess_cut'])));
                                        $ex_cut = "";
                                        foreach ($excess_cut_arr as $val) 
                                        {
                                            $ex_cut .= ($ex_cut=="") ? "(".$val.")" : ",(".$val.")";
                                        }
                                        echo $ex_cut;
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="right"><p><?=number_format($row['order_quantity'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($row['order_quantity'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($row['plan_cut_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($row['po_quantity'],0);?></p></td>
                                <td width="80" align="center"><p><?=$unit_of_measurement[$row['order_uom']];?></p></td>
                                <td width="80" align="right"><p><?=$row['unit_price'];?></p></td>
                                <td width="80" align="right"><p><?=number_format($row['order_value'],0);?></p></td>
                                <td width="80" align="center"><p><?=$row['po_insert_date'];?></p></td>
                                <td width="80" align="center"><p><?=$row['po_received_date'];?></p></td>
                                <td width="80" align="center"><p><?=$row['factory_received_date'];?></p></td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $lay_date_arr = array_unique(array_filter(explode(",", $lay_data_array[$job_key]['entry_date'])));
                                        $lay_date = get_max_min_date($lay_date_arr);
                                        echo ($lay_date['min_date']!="") ? change_date_format($lay_date['min_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        echo ($lay_date['max_date']!="") ? change_date_format($lay_date['max_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $sew_out_date_arr = array_unique(array_filter(explode(",", $gmts_data_array[$job_key][5]['date'])));
                                        $sew_out_date = get_max_min_date($sew_out_date_arr);
                                        echo ($sew_out_date['min_date']!="") ? change_date_format($sew_out_date['min_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        echo ($sew_out_date['max_date']!="") ? change_date_format($sew_out_date['max_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $gmt_fin_date_arr = array_unique(array_filter(explode(",", $gmts_data_array[$job_key][8]['date'])));
                                        $gmt_fin_date = get_max_min_date($gmt_fin_date_arr);
                                        echo ($gmt_fin_date['min_date']!="") ? change_date_format($gmt_fin_date['min_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        echo ($gmt_fin_date['max_date']!="") ? change_date_format($gmt_fin_date['max_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$row['pub_shipment_date'];?></p></td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $ex_date_array = array_unique(array_filter(explode(",", $ex_data_array[$job_key]['ex_date'])));
                                        $ex_date = get_max_min_date($ex_date_array);
                                        // echo min($ex_date_array);
                                        echo ($ex_date['min_date']!="") ? change_date_format($ex_date['min_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80"><p><?=$row['shipment_date'];?></p></td>
                                <td width="80"><p><?=$row['txt_etd_ldd'];?></p></td>
                                <td width="80"><p><?=$cutup_date = implode(",", array_unique(array_filter(explode(",", $row['cutup_date']))));?></p></td>
                                <td width="80"><p><?=$coun_ship_date = implode(",", array_unique(array_filter(explode(",", $row['country_ship_date']))));?></p></td>
                                <td width="80"><p><?=$row['pub_shipment_date'];?></p></td>
                                <td width="80"><p><?=$shipment_mode[$row['ship_mode']];?></p></td>
                                <td width="80"><p><?=$row['lead_time'];?></p></td>
                                <td width="80"><p><?=$row['days_in_hand'];?></p></td>
                                <td width="80">
                                    <p>
                                        <?
                                        $com_file = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['internal_file_no']))));
                                        echo $com_file;
                                        ?>                                            
                                    </p>
                                </td>                                
                                <td width="80">
                                    <p>
                                        <?
                                        $lien_bank = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['lien_bank']))));
                                        echo $lien_bank;
                                        ?>                                            
                                    </p>
                                </td>
                                <td width="80"><p><?=$a;?></p></td>                                
                                <td width="80">
                                    <p>
                                        <?
                                        $amendment_no = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['amendment_no']))));
                                        echo $amendment_no;
                                        ?>                                            
                                    </p>
                                </td>                               
                                <td width="80">
                                    <p>
                                        <?
                                        $pay_term = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['pay_term']))));
                                        echo $pay_term;
                                        ?>                                            
                                    </p>
                                </td>                                
                                <td width="80">
                                    <p>
                                        <?
                                        $tenor = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['tenor']))));
                                        echo $tenor;
                                        ?>                                            
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        echo ($ex_date['min_date']!="") ? change_date_format($ex_date['min_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        echo ($ex_date['max_date']!="") ? change_date_format($ex_date['max_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_value'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($ship_excess_qty,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($ship_excess_val,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($ship_short_qty,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($ship_short_val,0);?></p></td>
                                <td width="80" align="center"><p><?=$row['shipment_status'];?></p></td>
                                <td width="80" align="right"><p><?=$item_smv;?></p></td>
                                <td width="80" align="right"><p><?=$tot_item_smv;?></p></td>
                                <td width="80"><p><?=$budget_data_array[$job_key]['cm_cost'];?></p></td>
                                <td width="80"><p><?=$team_library[$row['team_leader']];?></p></td>
                                <td width="80"><p><?=$merchant_library[$row['dealing_marchant']];?></p></td>
                                <td width="80"><p><?=$merchant_library[$row['factory_marchant']];?></p></td>
                                <td width="80">
                                    <p>
                                        <?=$user_library[$row['inserted_by']];?>       
                                        <?
                                        if($row['updated_by']!="")
                                        {
                                            echo ", ".$user_library[$row['updated_by']];
                                        }
                                        ?>                                 
                                    </p>
                                </td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80">
                                    <a href="javascript:void(0);" onclick="show_popup('sample_status', '<?=$job_key; ?>', '920px',1)">
                                        View
                                    </a>
                                </td>
                                <td width="80">
                                    <a href="javascript:void(0);" onclick="show_popup('order_status', '<?=$job_key; ?>', '320px',2)">
                                        View
                                    </a>
                                </td>
                                <td width="80">
                                    <a href="javascript:void(0);" onclick="show_popup('closing_status', '<?=$job_key; ?>', '320px',3)">
                                        View
                                    </a>
                                </td>
                                <td width="80">
                                    <p>
                                        <?
                                            echo ($work_order_data_array[$job_key][1]) ? "Printing : ".$work_order_data_array[$job_key][1] : "";
                                            echo ($work_order_data_array[$job_key][2]) ? "Embroidery : ".$work_order_data_array[$job_key][2] : "";
                                            echo ($work_order_data_array[$job_key][3]) ? "Wash : ".$work_order_data_array[$job_key][3] : "";
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80">
                                    <p>
                                        <?
                                            echo "AOP : ".$service_booking_data_array[$job_key]['aop'];
                                            echo "Yarn Dyeing : ".$yd_work_order_data_array[$job_key];
                                            echo "Knitting : ".$service_booking_data_array[$job_key]['knitting'];
                                            echo "Fab. Dyeing : ".$service_booking_data_array[$job_key]['dyeing'];
                                        ?>
                                        
                                    </p>
                                </td>



                                <td width="80"><p><?=$budget_data_array[$job_key]['costing_date'];?></p></td>
                                <td width="80" align="right"><p><?=number_format($total_budget_value,2);?></p></td>
                                <td width="80" align="right"><p><?=number_format($open_value,0);?></p></td>
                                <td width="80"><p><?=($budget_data_array[$job_key]['approved']==1) ? "Approved" : "Not Approved";?></p></td>
                                <td width="80"><p><?=number_format($a,0);?></p></td>


                                
                                <td width="80" align="center" data="Main Fabric Booking Information">
                                    <p>
                                        <?
                                        $booking_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['booking_date'])));
                                        $booking_date = "";
                                        foreach ($booking_date_arr as $val) 
                                        {
                                            $booking_date .= ($booking_date=="") ? $val : ", ".$val;
                                        }
                                        echo $booking_date;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $booking_no_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['booking_no'])));
                                        $booking_no = "";
                                        foreach ($booking_no_arr as $val) 
                                        {
                                            $booking_no .= ($booking_no=="") ? $val : ", ".$val;
                                        }
                                        echo $booking_no;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $delivery_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['delivery_date'])));
                                        $delivery_date = "";
                                        foreach ($delivery_date_arr as $val) 
                                        {
                                            $delivery_date .= ($delivery_date=="") ? $val : ", ".$val;
                                        }
                                        echo $delivery_date;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $revised_no_arr = array_unique(explode(",", $booking_data_array[$job_key][1][2]['revised_no']));
                                        $revised_no = "";
                                        foreach ($revised_no_arr as $val) 
                                        {
                                            $revised_no .= ($revised_no=="") ? $val : ", ".$val;
                                        }
                                        echo $revised_no;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $revised_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['revised_date'])));
                                        $revised_date = "";
                                        foreach ($revised_date_arr as $val) 
                                        {
                                            $revised_date .= ($revised_date=="") ? $val : ", ".$val;
                                        }
                                        echo $revised_date;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">                                    
                                    <?
                                    $is_approved_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['is_approved'])));
                                    $is_approved = "";
                                    foreach ($is_approved_arr as $val) 
                                    {
                                        $is_approved .= ($is_approved=="") ? $approval_type_arr[$val] : ", ".$approval_type_arr[$val];
                                    }
                                    ?>
                                    <a href="javascript:void(0);" onclick="show_popup('fb_approval_status', '<?=$job_key; ?>__1', '920px',3)">
                                            <?
                                        echo ($is_approved=="") ? " Not Approved" : $is_approved;
                                        ?>
                                    </a> 
                                </td>
                                <td width="80"><p><?=$a;?></p>Yarn Desc</td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $construction_arr = array_unique(array_filter(explode("__", $booking_data_array[$job_key][1][2]['construction'])));
                                        $construction = "";
                                        foreach ($construction_arr as $val) 
                                        {
                                            $construction .= ($construction=="") ? $val : ", ".$val;
                                        }
                                        echo $construction;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $copmposition_arr = array_unique(array_filter(explode("__", $booking_data_array[$job_key][1][2]['copmposition'])));
                                        $copmposition = "";
                                        foreach ($copmposition_arr as $val) 
                                        {
                                            $copmposition .= ($copmposition=="") ? $val : ", ".$val;
                                        }
                                        echo $copmposition;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $gsm_weight_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['gsm_weight'])));
                                        $gsm_weight = "";
                                        foreach ($gsm_weight_arr as $val) 
                                        {
                                            $gsm_weight .= ($gsm_weight=="") ? $val : ", ".$val;
                                        }
                                        echo $gsm_weight;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $dia_width_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['dia_width'])));
                                        $dia_width = "";
                                        foreach ($dia_width_arr as $val) 
                                        {
                                            $dia_width .= ($dia_width=="") ? $val : ", ".$val;
                                        }
                                        echo $dia_width;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][2]['grey_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][2]['fin_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][2]['process_loss'],0);?></p></td>



                                
                                <td width="80" align="center" data="Purchase Fabric Booking Information">
                                    <p>
                                        <?
                                        $booking_date_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['booking_date'])));
                                        $booking_date = "";
                                        foreach ($booking_date_arr as $val) 
                                        {
                                            $booking_date .= ($booking_date=="") ? $val : ", ".$val;
                                        }
                                        echo $booking_date;
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <?
                                        $booking_no_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['booking_no'])));
                                        $booking_no = "";
                                        foreach ($booking_no_arr as $val) 
                                        {
                                            ?>
                                            <a href="javascript:void(0)" onclick="generate_fabric_report('<?=$val; ?>');">
                                            <?
                                            // $booking_no .= ($booking_no=="") ? $val : ", ".$val;
                                            echo $val;
                                            ?>
                                        </a>
                                            <?
                                        }
                                        ?>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $delivery_date_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['delivery_date'])));
                                        $delivery_date = "";
                                        foreach ($delivery_date_arr as $val) 
                                        {
                                            $delivery_date .= ($delivery_date=="") ? $val : ", ".$val;
                                        }
                                        echo $delivery_date;
                                        ?>                                        
                                    </p>
                                </td>                                
                                <td width="80">
                                    <p>
                                        <?
                                        $construction_arr = array_unique(array_filter(explode("__", $pur_booking_data_array[$job_key][1]['construction'])));
                                        $construction = "";
                                        foreach ($construction_arr as $val) 
                                        {
                                            $construction .= ($construction=="") ? $val : ", ".$val;
                                        }
                                        echo $construction;
                                        ?>                                        
                                    </p>
                                </td>                                                               
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $uom_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['uom'])));
                                        $uom = "";
                                        foreach ($uom_arr as $val) 
                                        {
                                            $uom .= ($uom=="") ? $unit_of_measurement[$val] : ", ".$unit_of_measurement[$val];
                                        }
                                        echo $uom;
                                        ?>                                        
                                    </p>
                                </td>                                                                                               
                                <td width="80" align="right">
                                    <p>
                                        <?
                                        $fin_fab_qnty_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['fin_fab_qnty'])));
                                        $fin_fab_qnty = "";
                                        foreach ($fin_fab_qnty_arr as $val) 
                                        {
                                            $fin_fab_qnty .= ($fin_fab_qnty=="") ? $val : ", ".$val;
                                        }
                                        echo number_format($fin_fab_qnty,2);
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <a href="javascript:void(0);" onclick="show_popup('work_order_details', '<?=$job_key; ?>', '920px',5)">View</a>
                                </td>
                                <td width="80" align="center">
                                    
                                    <?
                                    $is_approved_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1][2]['is_approved'])));
                                    $is_approved = "";
                                    foreach ($is_approved_arr as $val) 
                                    {
                                        $is_approved .= ($is_approved=="") ? $approval_type_arr[$val] : ", ".$approval_type_arr[$val];
                                    }
                                    ?>
                                    <a href="javascript:void(0);" onclick="show_popup('fb_approval_status', '<?=$job_key; ?>__2', '920px',4)">
                                        <?
                                        echo ($is_approved=="") ? " Not Approved" : $is_approved;
                                        ?>
                                        
                                    </a>
                                </td>

                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $booking_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['booking_date'])));
                                        $booking_date = "";
                                        foreach ($booking_date_arr as $val) 
                                        {
                                            $booking_date .= ($booking_date=="") ? $val : ", ".$val;
                                        }
                                        echo $booking_date;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $booking_no_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['booking_no'])));
                                        $booking_no = "";
                                        foreach ($booking_no_arr as $val) 
                                        {
                                            $booking_no .= ($booking_no=="") ? $val : ", ".$val;
                                        }
                                        echo $booking_no;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center" data="Short/EFR Fabric Booking Information">
                                    <p>
                                        <?
                                        $delivery_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['delivery_date'])));
                                        $delivery_date = "";
                                        foreach ($delivery_date_arr as $val) 
                                        {
                                            $delivery_date .= ($delivery_date=="") ? $val : ", ".$val;
                                        }
                                        echo $delivery_date;
                                        ?>
                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?                                       
                                        echo $short_fab_array[$job_key];;
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $uom_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['uom'])));
                                        $uom = "";
                                        foreach ($uom_arr as $val) 
                                        {
                                            $uom .= ($uom=="") ? $unit_of_measurement[$val] : ", ".$unit_of_measurement[$val];
                                        }
                                        echo $uom;
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][1]['grey_fab_qnty'],0);?></p></td>                                 
                                <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][1]['fin_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][1]['process_loss'],0);?></p></td>                               
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $is_approved_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['is_approved'])));
                                        $is_approved = "";
                                        foreach ($is_approved_arr as $val) 
                                        {
                                            $is_approved .= ($is_approved=="") ? $approval_type_arr[$val] : ", ".$approval_type_arr[$val];
                                        }
                                        echo ($is_approved=="") ? " Not Approved" : $is_approved;
                                        ?>
                                        
                                    </p>
                                </td>


                                
                                <td width="80"><p><a href="javascript:void(0);" onclick="show_popup('trims_acc_status_popup', '<?=$job_key; ?>', '1120px',6)">View</a></p></td>



                                <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['grey_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($yarn_allocation_array[$job_key],0);?></p></td>
                                <td width="80" align="right"><p><? if(($yarn_allocation_array[$job_key]-$booking_qty_array[$job_key]['grey_fab_qnty'])>0){ echo number_format(($yarn_allocation_array[$job_key]-$booking_qty_array[$job_key]['grey_fab_qnty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($textile_data_array[$job_key][3],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format(($booking_qty_array[$job_key]['grey_fab_qnty']-$textile_data_array[$job_key][3]),0);?></p></td>
                                <td width="80" align="right"><p>  <? if($textile_data_array[$job_key][3]-($booking_qty_array[$job_key]['grey_fab_qnty'])>0){ echo number_format($textile_data_array[$job_key][3]-($booking_qty_array[$job_key]['grey_fab_qnty']),0);} else{ echo " ";}?></p></td>
                              



                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($yarn_allocation_array[$job_key],0);?></p></td>
                                <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['grey_fab_qnty']-$yarn_allocation_array[$job_key])>0){ echo number_format(($booking_qty_array[$job_key]['grey_fab_qnty']-$yarn_allocation_array[$job_key]),0);} else{ echo " ";} ?></p></td>

                                <td width="80" align="right"><p><?=number_format($yarn_rcv_from_dyeing_array[$job_key],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($dyed_yarn_issue_array[$job_key],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>



                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>



                                <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['grey_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($program_data_array[$job_key],0);?></p></td>
                                <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['grey_fab_qnty']-$program_data_array[$job_key])>0){ echo number_format(($booking_qty_array[$job_key]['grey_fab_qnty']-$program_data_array[$job_key]),0);} else{ echo " ";}?></p></td>

                                <td width="80" align="right"><p><?=$service_booking_data_array[$job_key]['knitting'];?></p></td>
                                <td width="80" align="right"><p><?=number_format($knitting_data_array[$job_key][1],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($knitting_data_array[$job_key][3],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format(($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3]),0);?></p></td>
                                <td width="80" align="right"><p><? if(($knitting_data_array[$job_key][3]-$knitting_data_array[$job_key][1])>0){ echo number_format(($knitting_data_array[$job_key][3])-$knitting_data_array[$job_key][1],0);} else{ echo " ";} ?></p></td>

                                <td width="80" align="right"><p><? echo number_format($booking_qty_array[$job_key]['grey_fab_qnty']-($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3]),0) ?></p></td>
                                <td width="80" align="right"><p><?=number_format($price_kg_tk,2);?></p></td>
                                <td width="80" align="right"><p><?=number_format($total_price_kg_tk,2);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][56],0);?></p></td>
                                <td width="80" align="right" title="Knitting Reference closing"><p>Yes</p></td>



                                <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['grey_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][58],0);?></p></td>
                                <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['grey_fab_qnty'] - $roll_data_array[$job_key][58])>0){ echo number_format(($booking_qty_array[$job_key]['grey_fab_qnty'] - $roll_data_array[$job_key][58]),0);} else{ echo " ";} ?></p></td>
                                <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][82][5],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format(($roll_data_array[$job_key][58]+$transfer_data_array[$job_key][82][5]),0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][61],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][82][6],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format(($roll_data_array[$job_key][61]+$transfer_data_array[$job_key][82][6]),0);?></p></td>
                                <td width="80" align="right"><p><? if((($roll_data_array[$job_key][58]+$transfer_data_array[$job_key][82][5]) -($roll_data_array[$job_key][61]+$transfer_data_array[$job_key][82][6]))){ echo number_format((($roll_data_array[$job_key][58]+$transfer_data_array[$job_key][82][5]) -($roll_data_array[$job_key][61]+$transfer_data_array[$job_key][82][6])) ,0);}else{ echo " ";}?></p></td>



                                <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['fin_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][62],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][64],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($fab_dyeing_array[$job_key],0);?></p></td>
                                <td width="80" align="right"><p><? if(($fab_dyeing_array[$job_key]-$roll_data_array[$job_key][62])>0){ echo number_format(($fab_dyeing_array[$job_key]-$roll_data_array[$job_key][62]),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="center" title="Dyeing Reference closing"><p><?echo number_format(($booking_qty_array[$job_key]['fin_fab_qnty']-$fab_dyeing_array[$job_key]),0);?></p></td>



                                <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['fin_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($textile_data_array[$job_key][66],0);?></p></td>
                                <td width="80" align="right"><p><? if(($textile_data_array[$job_key][66]-$booking_qty_array[$job_key]['fin_fab_qnty'])>0){ echo number_format(($textile_data_array[$job_key][66]-$booking_qty_array[$job_key]['fin_fab_qnty']),0);}  else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? if(($fab_dyeing_array[$job_key] - $textile_data_array[$job_key][66])>0){ echo number_format(($fab_dyeing_array[$job_key] - $textile_data_array[$job_key][66]),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="left"><p><?=$fab_dyeing_process_array[$job_key];?></p></td>
                                <td width="80" align="right"><p><?=number_format($textile_data_array[$job_key][66],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][63],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][65],0);?></p></td>
                                <td width="80" align="right" title="Issue - Rcv"><p><? if(($roll_data_array[$job_key][63] - $roll_data_array[$job_key][65])>0){ echo number_format(($roll_data_array[$job_key][63] - $roll_data_array[$job_key][65]),0);}  else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][67],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right" title="Dyeing Finishing Reference closing"><p>No</p></td>



                                <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['fin_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][68],0);?></p></td>
                                <td width="80" align="right"><p><? if(($roll_data_array[$job_key][68]-$booking_qty_array[$job_key]['fin_fab_qnty'])>0){ echo number_format(($roll_data_array[$job_key][68]-$booking_qty_array[$job_key]['fin_fab_qnty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['fin_fab_qnty']-$roll_data_array[$job_key][68])>0){ echo number_format(($booking_qty_array[$job_key]['fin_fab_qnty']-$roll_data_array[$job_key][68]),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][134][5],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][134][5],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($textile_data_array[$job_key][71],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][134][6],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][134][6],0);?></p></td>
                                <td width="80" align="right"><p><? if(($roll_data_array[$job_key][68] - $textile_data_array[$job_key][71])>0){ echo number_format(($roll_data_array[$job_key][68] - $textile_data_array[$job_key][71]),0);} else{ echo " ";}?></p></td>



                                <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['fin_fab_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][67],0);?></p></td>
                                <td width="80" align="right"><p><? if(($roll_data_array[$job_key][67]-$booking_qty_array[$job_key]['fin_fab_qnty'])>0){ echo number_format(($roll_data_array[$job_key][67]-$booking_qty_array[$job_key]['fin_fab_qnty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? if(($booking_qty_array[$job_key]['fin_fab_qnty'] - $roll_data_array[$job_key][67])>0){ echo number_format(($booking_qty_array[$job_key]['fin_fab_qnty'] - $roll_data_array[$job_key][67]),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="left"><p><?=$cutting_status;?></p></td>
                                <td width="80" align="right"><p><?=number_format($row['job_qty_pcs'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($excess_cut_prsnt,2);?></p></td>
                                <td width="80" align="right"><p><?=number_format($row['plan_cut_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($lay_data_array[$job_key]['no_of_bndl'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($lay_data_array[$job_key]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][1]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if (($gmts_data_array[$job_key][1]['qty']-$row['job_qty_pcs'])>0){ echo number_format(($gmts_data_array[$job_key][1]['qty']-$row['job_qty_pcs']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? if(($row['job_qty_pcs']-$gmts_data_array[$job_key][1]['qty'])>0){ echo number_format(($row['job_qty_pcs']-$gmts_data_array[$job_key][1]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][4]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($row['job_qty_pcs']-$gmts_data_array[$job_key][4]['qty'])>0){ echo number_format(($row['job_qty_pcs']-$gmts_data_array[$job_key][4]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($embel_data_array[$job_key][2][1]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($embel_data_array[$job_key][3][1]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($row['job_qty_pcs']-$embel_data_array[$job_key][3][1]['qty'])>0){ echo number_format(($row['job_qty_pcs']-$embel_data_array[$job_key][3][1]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="left"><p><?=implode(", ", array_unique(array_filter(explode(",", $embel_data_array[$job_key][2][1]['wo_com_id']))));?></p></td>
                                <td width="80" align="right"><p><?=number_format($embel_data_array[$job_key][2][2]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($embel_data_array[$job_key][3][2]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="left"><p><?=implode(", ", array_unique(array_filter(explode(",", $embel_data_array[$job_key][3][1]['wo_com_id']))));?></p></td>



                                
                                <td width="80" align="right"><p><?=number_format($emb_qty_job_name_arr[$job_key][1],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($print_emb_order_data_array[$job_key][204]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($emb_qty_job_name_arr[$job_key][1] - $print_emb_order_data_array[$job_key][204]['qty'])>0){ echo number_format(($emb_qty_job_name_arr[$job_key][1] - $print_emb_order_data_array[$job_key][204]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($emb_qc_data_array[$job_key][223]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($emb_qc_data_array[$job_key][223]['qty']-$print_emb_order_data_array[$job_key][204]['qty'])>0){ echo number_format(($emb_qc_data_array[$job_key][223]['qty']-$print_emb_order_data_array[$job_key][204]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? echo number_format(($print_emb_order_data_array[$job_key][204]['qty']-$emb_qc_data_array[$job_key][223]['qty']),0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($emb_delivery_data_array[$job_key][254]['qty'],0);?></p></td>



                                <td width="80" align="right"><p><?=number_format($emb_qty_job_name_arr[$job_key][2],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($print_emb_order_data_array[$job_key][311]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($emb_qty_job_name_arr[$job_key][2] - $print_emb_order_data_array[$job_key][311]['qty'])>0){ echo number_format(($emb_qty_job_name_arr[$job_key][2] - $print_emb_order_data_array[$job_key][311]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($emb_qc_data_array[$job_key][324]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($emb_qc_data_array[$job_key][324]['qty']-$print_emb_order_data_array[$job_key][311]['qty'])>0){ echo number_format(($emb_qc_data_array[$job_key][324]['qty']-$print_emb_order_data_array[$job_key][311]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? if(($print_emb_order_data_array[$job_key][311]['qty']-$emb_qc_data_array[$job_key][324]['qty'])>0){ echo number_format(($print_emb_order_data_array[$job_key][311]['qty']-$emb_qc_data_array[$job_key][324]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($emb_delivery_data_array[$job_key][325]['qty'],0);?></p></td>



                                <td width="80" align="right"><p><?=number_format($row['job_qty_pcs'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($row['job_qty_pcs'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][4]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($row['plan_cut_qnty']-$gmts_data_array[$job_key][4]['qty'])>0){ echo number_format(($row['plan_cut_qnty']-$gmts_data_array[$job_key][4]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][4]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][5]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($gmts_data_array[$job_key][5]['qty']-$row['plan_cut_qnty'])>0){ echo number_format(($gmts_data_array[$job_key][5]['qty']-$row['plan_cut_qnty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p></p></td>
                                <td width="80" align="right"><p><? if(($row['plan_cut_qnty']-$gmts_data_array[$job_key][5]['qty'])>0){ echo number_format(($row['plan_cut_qnty']-$gmts_data_array[$job_key][5]['qty']),0);} else{ echo " ";}?></p></td>



                                <td width="80" align="right"><p><?=number_format($row['job_qty_pcs'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][7]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][15]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][11]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][8]['qty'],0);?></p></td>
                                <td width="80" align="right"><p><? if(($row['plan_cut_qnty']-$gmts_data_array[$job_key][8]['qty'])>0){ echo number_format(($row['plan_cut_qnty']-$gmts_data_array[$job_key][8]['qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?=$buyer_insp_data[$job_key]['date'];?></p></td>
                                <td width="80" align="right"><p><?=number_format($buyer_insp_data[$job_key]['qty'],0);?></p></td>



                                <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['cartot_qnty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($invice_data[$job_key]['inv_qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_value'],2);?></p></td>
                                <td width="80" align="right"><p><?=number_format($invice_data[$job_key]['inv_value'],2);?></p></td>
                                <td width="80" align="right"><p><?=number_format($invice_data[$job_key]['net_inv_value'],2);?></p></td>
                                <td width="80" align="right"><p><? if(($ex_data_array[$job_key]['ex_qty']-$row['job_qty_pcs'])>0){ echo number_format(($ex_data_array[$job_key]['ex_qty']-$row['job_qty_pcs']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? if(($ex_data_array[$job_key]['ex_value']-$row['total_price'])>0){ echo number_format(($ex_data_array[$job_key]['ex_value']-$row['total_price']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? if(($row['job_qty_pcs']-$ex_data_array[$job_key]['ex_qty'])>0){ echo number_format(($row['job_qty_pcs']-$ex_data_array[$job_key]['ex_qty']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><? if(($row['total_price']-$ex_data_array[$job_key]['ex_value'])>0){ echo number_format(($row['total_price']-$ex_data_array[$job_key]['ex_value']),0);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['rtn_qty'],0);?></p></td>
                                <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_rtn_value'],0);?></p></td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        $ex_data_array = array_unique(array_filter(explode(",", $ex_data_array[$job_key]['ex_date'])));
                                        $ex_date = get_max_min_date($ex_data_array);
                                        echo ($ex_date['min_date']!="") ? change_date_format($ex_date['min_date']) : "";
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="center">
                                    <p>
                                        <?
                                        // $ex_data_array = array_unique(array_filter(explode(",", $ex_data_array[$job_key]['ex_date'])));
                                        // $ex_date = get_max_min_date($ex_data_array);
                                        // echo ($ex_date['max_date']!="") ? change_date_format($ex_date['max_date']) : "";
                                        $ex_data_array = array_unique(array_filter(explode(",", $ex_data_array[$job_key]['ex_date'])));
                                       if($ex_data_array[$job_key]['ex_date']!="")
                                        {
                                        $ex_max_date = get_max_min_date($ex_data_array);
                                        }
                                        $max_date=strtotime($ex_max_date['max_date']);
                                        if($max_date>0)
                                        {
                                            echo change_date_format($ex_max_date['max_date']);
                                            // echo "";
                                        }
                                        ?>                                        
                                    </p>
                                </td>
                                <td width="80" align="right"><p><?=number_format($invice_data[$job_key]['discount_ammount'],2);?></p></td>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <td width="80" align="right"><p><?  if(($ex_data_array[$job_key]['ex_qty'] - $row['job_qty_pcs'])>0){ echo number_format(($ex_data_array[$job_key]['ex_qty'] - $row['job_qty_pcs']),2);} else{ echo " ";}?></p></td>
                                <td width="80" align="right"><p><?  if($ex_data_array[$job_key]['ex_qty']>0){ echo number_format((($order_to_ship_qty/$row['job_qty_pcs'])*100),2);} else{ echo " ";}?></p></td>
                                                                                                       
                                <td width="80" align="right"><p><? if(($ex_data_array[$job_key]['ex_qty'] - $lay_data_array[$job_key]['qty'])>0){ echo number_format(($ex_data_array[$job_key]['ex_qty'] - $lay_data_array[$job_key]['qty']),0);} else{ echo " ";}?></p></td> 
                                <td width="80" align="right"><p><? if($lay_data_array[$job_key]['qty']>0){ echo number_format((100 - ($cut_to_ship_qty/$lay_data_array[$job_key]['qty'])*100),2);} else{ echo " ";}?></p></td>
                               

                                
                                



                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>



                                
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                                <td width="80"><p><?=$a;?></p></td>
                            </tr>
                            <?
                            $i++;
                            $gr_job_total += $row['job_qty_pcs'];
                            $gr_po_total += $row['order_quantity'];
                            $gr_color_size_total += $row['po_quantity'];
                            $gr_plan_cut_total += $row['plan_cut_qnty'];
                            $gr_order_value_total += $row['order_value'];
                        }
                        unset($data_array);
                        ?>                        
                    </tbody>
                </table>
            </div>
            <!-- =============================== report footer ================================ -->
            <table cellspacing="0" border="1" class="rpt_table"   rules="all" width="<?=$tbl_width;?>"  align="center" id="report_table_footer">
                <tfoot>                    
                    <tr>
                        <th width="30"><p></p></th>
                        <th width="60"><p></p></th>
                        <th width="100"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="100"><p></p></th>
                        <th width="50"><p></p></th>
                        <th width="90"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p></p></th>
                        <th width="80"><p>Grand Total</p></th>
                        <th width="80"><p><?=number_format($gr_job_total,0);?></p></th>
                        <th width="80"><p><?=number_format($gr_po_total,0);?></p></th>
                        <th width="80"><p><?=number_format($gr_plan_cut_total,0);?></p></th>
                        <th width="80"><p><?=number_format($gr_color_size_total,0);?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=number_format($gr_order_value_total,2);?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>

                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                        <th width="80"><p><?=$a;?></p></th>
                    </tr>
                </tfoot>
            </table>
        </div>        
    </fieldset>
    <?    
	foreach (glob("$user_id*.xls") as $filename) 
	{
		if( @filemtime($filename) < (time()-$seconds_old) )
		@unlink($filename);
	}
	//---------end------------//
	$name=time();
	$filename=$user_id."_".$name.".xls";
	$create_new_doc = fopen($filename,'w');
	$is_created = fwrite($create_new_doc,ob_get_contents());
	echo "$total_data####$filename";
	exit();   

}

if ($action == "sample_status") 
{
    $color_arr = return_library_array("select id, color_name from lib_color", 'id', 'color_name');
    $sampleArr = return_library_array("select id, sample_name from lib_sample", 'id', 'sample_name');
    echo load_html_head_contents("Sample Approve Details", "../../../../", 1, 1, $unicode, '', '');

    /*$expData = explode('_', $job_number);
    $job_number = $expData[0];
    $po_id = $expData[1];*/
    $po_arr = return_library_array("SELECT id, po_number from wo_po_break_down where job_no_mst='$job_number'", 'id', 'po_number');
    ?>
    <div style="width:100%" align="center">
        <fieldset style="width:900px">
            <table width="600">
                <?
                $job_sql = sql_select("SELECT job_no,buyer_name,company_name,style_ref_no from wo_po_details_master where job_no='$job_number'");
                foreach ($job_sql as $row_job)
                {
                    ?>
                    <tr class="form_caption">
                        <td align="center" colspan="4"><strong>Sample Approval Details</strong></td>    
                    </tr>
                    <tr>
                        <td align="right" width="130"> <strong>Job Number</strong> :</td> 
                        <td align="left"  width="200"><? echo $job_number; ?></td> 
                        <td align="right"  width="130"><strong>Buyer Name</strong> :</td>  
                        <td align="left"><? echo $buyer_short_name_arr[$row_job[csf("buyer_name")]]; ?></td> 
                    </tr>
                    <tr>
                        <td align="right"><strong>Company Name</strong> :</td> 
                        <td align="left"><? echo $company_short_name_arr[$row_job[csf("company_name")]]; ?></td> 
                        <td align="right"><strong>Style Ref No</strong> : </td> 
                        <td align="left"><? echo $row_job[csf("style_ref_no")]; ?> </td>
                    </tr> 
                    <tr>
                        <td colspan="4" height="15"></td>                   
                    </tr>   
                    <? 
                } 
                ?>         
            </table>
            <div style="width:100%;" align="left">
                <table cellpadding="0" width="100%" class="rpt_table" rules="all" border="1">
                    <thead>
                        <tr>
                            <th width="35">SL</th>
                            <th width="100">PO Number</th>
                            <th width="90">Sample Type</th>
                            <th width="90">Color Name</th>
                            <th width="80">Target Date</th>
                            <th width="80">To Factory</th>
                            <th width="80">To Buyer</th>
                            <th width="70">Status</th>
                            <th width="80">Approval Date</th>
                            <th width="70">Delay Day</th>
                            <th>Remarks</th>
                        </tr>
                    </thead>
                </table>
            </div>  
            <div style="width:100%; max-height:270px; overflow-y:scroll" align="left">
                <table cellpadding="0" width="100%" class="rpt_table" rules="all" border="1" >
                    <?
                    $i = 0;
                    if ($db_type == 0)
                        $date_diff = "DATEDIFF(approval_status_date,target_approval_date)";
                    else
                        $date_diff = "trunc(approval_status_date-target_approval_date)";
                    $sql = "SELECT a.sample_type_id,b.color_number_id,b.po_break_down_id, target_approval_date, send_to_factory_date, submitted_to_buyer, approval_status, approval_status_date, sample_comments, $date_diff as delay_day from wo_po_sample_approval_info a, wo_po_color_size_breakdown b where a.color_number_id=b.id and a.job_no_mst='$job_number' and a.current_status=1 and a.is_deleted=0 and a.status_active=1 order by a.sample_type_id,b.color_number_id";
                    //echo $sql; //and a.approval_status<>0
                    $apprv_sql = sql_select($sql);
                    foreach ($apprv_sql as $row) 
                    {
                        $i++;
                        if ($i % 2 == 0)
                            $bgcolor = "#EFEFEF";
                        else
                            $bgcolor = "#FFFFFF";

                        if ($row[csf("delay_day")] > 0) {
                            $td_color = "red";
                            $delay_day = $row[csf("delay_day")];
                        } else {
                            $td_color = "";
                            $delay_day = "&nbsp;";
                        }
                        ?>
                        <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_<? echo $i; ?>', '<? echo $bgcolor; ?>')" id="tr_<? echo $i; ?>">
                            <td width="35"><? echo $i; ?></td>
                            <td width="100"><p><? echo $po_arr[$row[csf("po_break_down_id")]]; ?></p></td>
                            <td width="90"><p><? echo $sampleArr[$row[csf("sample_type_id")]]; ?></p></td> 
                            <td width="90"><p><? echo $color_arr[$row[csf("color_number_id")]]; ?></p></td>
                            <td align="center" width="80"><?
                        if ($row[csf("target_approval_date")] == "0000-00-00" || $row[csf("target_approval_date")] == "")
                            echo "&nbsp;";
                        else
                            echo change_date_format($row[csf("target_approval_date")]);
                        ?>&nbsp;</td>
                            <td align="center" width="80"><?
                        if ($row[csf("send_to_factory_date")] == "0000-00-00" || $row[csf("send_to_factory_date")] == "")
                            echo "&nbsp;";
                        else
                            echo change_date_format($row[csf("send_to_factory_date")]);
                        ?>&nbsp;</td>
                            <td align="center" width="80"><?
                        if ($row[csf("submitted_to_buyer")] == "0000-00-00" || $row[csf("submitted_to_buyer")] == "")
                            echo "&nbsp;";
                        else
                            echo change_date_format($row[csf("submitted_to_buyer")]);
                        ?>&nbsp;</td>
                            <td align="center" width="70"><? echo $approval_status[$row[csf("approval_status")]]; ?>&nbsp;</td>
                            <td align="center" width="80"><?
                        if ($row[csf("approval_status_date")] == "0000-00-00" || $row[csf("approval_status_date")] == "")
                            echo "&nbsp;";
                        else
                            echo change_date_format($row[csf("approval_status_date")]);
                        ?>&nbsp;</td>
                            <td width="70" bgcolor="<? echo $td_color; ?>" align="right"><? echo $delay_day; ?>&nbsp;&nbsp;</td>
                            <td><p><? echo $row[csf("sample_comments")]; ?>&nbsp;</p></td>
                        </tr>
                        <? 
                    } 
                    ?>
                </table>
            </div> 
        </fieldset>
    </div> 
    <?
    exit();
}

if ($action == "order_status") 
{
    echo load_html_head_contents("Sample Approve Details", "../../../../", 1, 1, $unicode, '', '');

    ?>
    <div style="width:100%" align="center">
        <fieldset style="width:300px">        
            <div style="width:100%;" align="left">
                <table cellpadding="0" width="100%" class="rpt_table" rules="all" border="1">
                    <thead>
                        <tr>
                            <th width="35">SL</th>
                            <th width="100">PO Number</th>
                            <th width="90">Status</th>
                        </tr>
                    </thead>
                </table>
            </div>  
            <div style="width:100%; max-height:270px; overflow-y:auto" align="left">
                <table cellpadding="0" width="100%" class="rpt_table" rules="all" border="1" >
                    <?
                    $i = 0;
                    $sql = "SELECT po_number, is_confirmed from wo_po_break_down where job_no_mst='$job_number'";
                    //echo $sql; //and a.approval_status<>0
                    $res = sql_select($sql);
                    foreach ($res as $row) 
                    {
                        $i++;
                        if ($i % 2 == 0)
                            $bgcolor = "#EFEFEF";
                        else
                            $bgcolor = "#FFFFFF";
                       
                        ?>
                        <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_<? echo $i; ?>', '<? echo $bgcolor; ?>')" id="tr_<? echo $i; ?>">
                            <td width="35"><? echo $i; ?></td>
                            <td width="100"><p><?=$row['PO_NUMBER']; ?></p></td>
                            <td width="90"><p><?=$row_status[$row['IS_CONFIRMED']]; ?></p></td> 
                        </tr>
                        <? 
                    } 
                    ?>
                </table>
            </div> 
        </fieldset>
    </div> 
    <?
    exit();
}

if ($action == "closing_status") 
{
    echo load_html_head_contents("Sample Approve Details", "../../../../", 1, 1, $unicode, '', '');

    ?>
    <div style="width:100%" align="center">
        <fieldset style="width:300px">        
            <div style="width:100%;" align="left">
                <table cellpadding="0" width="100%" class="rpt_table" rules="all" border="1">
                    <thead>
                        <tr>
                            <th width="35">SL</th>
                            <th width="100">PO Number</th>
                            <th width="60">Status</th>
                            <th width="60">Date</th>
                        </tr>
                    </thead>
                </table>
            </div>  
            <div style="width:100%; max-height:270px; overflow-y:auto" align="left">
                <table cellpadding="0" width="100%" class="rpt_table" rules="all" border="1" >
                    <?
                    $i = 0;
                    $sql = "SELECT po_number, shiping_status from wo_po_break_down where job_no_mst='$job_number'";
                    //echo $sql; //and a.approval_status<>0
                    $res = sql_select($sql);
                    foreach ($res as $row) 
                    {
                        $i++;
                        if ($i % 2 == 0)
                            $bgcolor = "#EFEFEF";
                        else
                            $bgcolor = "#FFFFFF";
                       
                        ?>
                        <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_<? echo $i; ?>', '<? echo $bgcolor; ?>')" id="tr_<? echo $i; ?>">
                            <td width="35"><? echo $i; ?></td>
                            <td width="100"><p><?=$row['PO_NUMBER']; ?></p></td>
                            <td width="60"><p><?=$shipment_status[$row['SHIPING_STATUS']]; ?></p></td> 
                            <td width="60"><p></p></td> 
                        </tr>
                        <? 
                    } 
                    ?>
                </table>
            </div> 
        </fieldset>
    </div> 
    <?
    exit();
}

if($action=='save_excel_column')
{
    $exp=explode("*_*", $data);
    
    $search_data=explode("*__*", $exp[1]);
    $cbo_company_name=$search_data[0];
    $cbo_buyer_name=str_replace("'", "", $search_data[1]);
    $cbo_year=str_replace("'", "", $search_data[2]);
    $txt_job_no=str_replace("'", "", $search_data[3]);
    $txt_style_ref=str_replace("'", "", $search_data[4]);
    $txt_order_no=str_replace("'", "", $search_data[5]);
    $cbo_shipment_status=str_replace("'", "", $search_data[6]);
    $cbo_status=str_replace("'", "", $search_data[7]);
    $cbo_order_status=str_replace("'", "", $search_data[8]);
    $cbo_report_type=str_replace("'", "", $search_data[9]);
    $cbo_date_category=str_replace("'", "", $search_data[10]);
    $txt_date_from=str_replace("'", "", $search_data[11]);
    $txt_date_to=str_replace("'", "", $search_data[12]);
    $cbo_year_selection=str_replace("'", "", $search_data[13]);

    if($db_type==0) {
        $txt_date_from = date("Y-m-d",strtotime($txt_date_from));
        $txt_date_to = date("Y-m-d",strtotime($txt_date_to));
    }
    else {
        $txt_date_from = date("d-M-Y",strtotime($txt_date_from));
        $txt_date_to = date("d-M-Y",strtotime($txt_date_to));
    }

    $data=$exp[0];
    $data=array_filter(explode("***", $data));
    $con = connect();
    if($db_type==0)
    {
        mysql_query("BEGIN");
    }
    $id = return_next_id_by_sequence("order_tracking_report_history_mst_seq", "order_tracking_report_history_mst", $con);
    $field_array = "id,company_id,cbo_buyer_name,cbo_year,txt_job_no,txt_style_ref,txt_order_no,cbo_shipment_status,cbo_status,cbo_order_status,cbo_report_type,cbo_date_category,txt_date_from,txt_date_to,cbo_year_selection,inserted_by,insert_date";
    $data_array = "(" . $id .','.$cbo_company_name.",'".$cbo_buyer_name."','".$cbo_year."','".$txt_job_no."','".$txt_style_ref."','".$txt_order_no."','".$cbo_shipment_status."','".$cbo_status."','".$cbo_order_status."','".$cbo_report_type."','".$cbo_date_category."','".$txt_date_from."','".$txt_date_to."','".$cbo_year_selection. "'," . $_SESSION['logic_erp']['user_id'] . ",'" . $pc_date_time . "')";    
    $data_array_dtls = "";
    foreach ($data as $key => $value)
    {
        $dtls_id = return_next_id_by_sequence("order_tracking_report_history_dtls_seq", "order_tracking_report_history_dtls", $con);
        if ($data_array_dtls != "") $data_array_dtls .= ",";
        $column_name=str_replace(array("&", "*", "(", ")", "=","'","_","\r", "\n",'"','#'), "", $value);
        $data_array_dtls .= "(" . $dtls_id . "," . $id . "," . $_SESSION['logic_erp']['user_id']. ",'" . $column_name . "')";  
    } 
    $del1=execute_query("DELETE FROM order_tracking_report_history_mst WHERE inserted_by = ".$_SESSION['logic_erp']['user_id']);
    $del2=execute_query("DELETE FROM order_tracking_report_history_dtls WHERE user_id = ".$_SESSION['logic_erp']['user_id']);
   
    $dtls_field_array = "id,mst_id,user_id,column_name";
    $rID=sql_insert("order_tracking_report_history_mst",$field_array,$data_array,0);
    $rID1=sql_insert("order_tracking_report_history_dtls",$dtls_field_array,$data_array_dtls,0);  
    if($db_type==0)
    {
        if($rID  && $rID1 && $del1 && $del2){
            mysql_query("COMMIT");
            echo "0**".count($data);
        }
        else{
            mysql_query("ROLLBACK");
            echo "10**".$rID."**".$rID1."**".$del1."**".$del2;
        }
    }
    else if($db_type==2 || $db_type==1 )
    {
        if($rID  && $rID1 && $del1 && $del2){
            oci_commit($con);
            echo "0**".count($data);
        }
        else{
            oci_rollback($con);
            echo "10**".$rID."**".$rID1."**".$del1."**".$del2."** insert into order_tracking_report_history_dtls (".$dtls_field_array.") values".$data_array_dtls;
        }
    }
    disconnect($con);
}

if ($action == "report_excel_generate") 
{
    $user_id=$_SESSION['logic_erp']['user_id'];
    $sql="SELECT a.id,a.company_id,a.inserted_by,a.insert_date,a.cbo_buyer_name,a.cbo_year,a.txt_job_no,a.txt_style_ref,a.txt_order_no,a.cbo_shipment_status,a.cbo_order_status,a.cbo_status,a.cbo_report_type,a.cbo_date_category,b.column_name from order_tracking_report_history_mst a, order_tracking_report_history_dtls b where a.id=b.mst_id and a.inserted_by=$user_id";
    //echo $sql;
    $result=sql_select($sql);
    $column_name=array();
    $user_company_wise=array();
    $dynamic_table_width=0;
    $column_name['']='';
    foreach ($result as $row)
    {
        $column=$row[csf('column_name')];
        $column_name[$column]=$row[csf('column_name')];
    
        if($row[csf('column_name')]=='Sl.')
        {
            $dynamic_table_width+=30;
        }
        else if($row[csf('column_name')]=='Order Status')
        {
            $dynamic_table_width+=60;
        }
        else if($row[csf('column_name')]=='LC Company' || $row[csf('column_name')]=='Working Company' || $row[csf('column_name')]=='Buyer')
        {
            $dynamic_table_width+=100;
        }
        else if($row[csf('column_name')]=='Year')
        {
            $dynamic_table_width+=50;
        }
        else if($row[csf('column_name')]=='Job')
        {
            $dynamic_table_width+=90;
        }
        else{
             $dynamic_table_width+=80;
        }
        //$user_company_wise[$row[csf('inserted_by')]][$row[csf('company_id')]][$row[csf('insert_date')]][$row[csf('column_name')]]=1;
        $company_name   = str_replace("'", "", $row[csf('company_id')]);
        $buyer_name     = str_replace("'", "", $row[csf('cbo_buyer_name')]);
        $year_id        = str_replace("'", "", $row[csf('cbo_year')]);    
        $job_no         = str_replace("'", "", $row[csf('txt_job_no')]);
        $txt_style_ref  = str_replace("'", "", $row[csf('txt_style_ref')]);
        $txt_order_no   = str_replace("'", "", $row[csf('txt_order_no')]);
        $shipmentStatus= str_replace("'", "", $row[csf('cbo_shipment_status')]);
        $orderStatus   = str_replace("'","", $row[csf('cbo_order_status')]);
        $status         = str_replace("'", "", $row[csf('cbo_status')]);
        $report_type    = str_replace("'", "", $row[csf('cbo_report_type')]);
        $date_category  = str_replace("'", "", $row[csf('cbo_date_category')]);
    }

   // print_r($column_name);

    

    /*===============================================================================/
    /                              Create Library Array                              /
    /============================================================================== */
    $team_library   = return_library_array("select id,team_leader_name from lib_marketing_team where status_active =1 and is_deleted=0", "id", "team_leader_name");
    $merchant_library   = return_library_array("select id,team_member_name from lib_mkt_team_member_info where status_active =1 and is_deleted=0", "id", "team_member_name");
    $country_library= return_library_array("select id, country_name from  lib_country", "id", "country_name");
    $buyer_library  = return_library_array("select id, buyer_name from  lib_buyer", "id", "buyer_name");
    $color_library  = return_library_array("select id, color_name from  lib_color", "id", "color_name");
    $size_library   = return_library_array("select id, size_name from  lib_size", "id", "size_name");
    $company_library= return_library_array("select id, company_name from  lib_company", "id", "company_name");
    $sub_dep_library= return_library_array("select id,sub_department_name from lib_pro_sub_deparatment status_active =1 and is_deleted=0", "id", "sub_department_name");
    $season_library = return_library_array("select id, season_name from lib_buyer_season where status_active =1 and is_deleted=0", "id", "season_name");
    $brand_library = return_library_array("select id, brand_name from lib_buyer_brand brand where status_active =1 and is_deleted=0", "id", "brand_name");
    $sub_dep_library = return_library_array("select id,sub_department_name from lib_pro_sub_deparatment where status_active =1 and is_deleted=0", "id", "sub_department_name");
    $user_library = return_library_array("select id,user_full_name from user_passwd where status_active =1 and is_deleted=0", "id", "user_full_name");
    $bank_library = return_library_array("select bank_name,id from lib_bank where is_deleted=0 and status_active=1 and lien_bank=1", "id", "bank_name");

    $fab_material=array(1=>"Organic",2=>"BCI");

    /*===============================================================================/
    /                                   Query Condition                              /
    /============================================================================== */
    $sqlCond = "";
    $sqlCond = !empty($company_name) ? " and a.company_name=$company_name" : "";
    $sqlCond .= !empty($buyer_name) ? " and a.buyer_name=$buyer_name" : "";
    $sqlCond .= !empty($year_id) ? " and to_char(a.insert_date,'YYYY')=$year_id" : "";
    $sqlCond .= !empty($job_no!="") ? " and a.job_no_prefix_num=$job_no" : "";
    $sqlCond .= !empty($txt_style_ref!="") ? " and a.style_ref_no='$txt_style_ref'" : "";
    $sqlCond .= !empty($txt_order_no!="") ? " and b.po_number='$txt_order_no'" : "";
    $sqlCond .= !empty($orderStatus) ? " and b.is_confirmed=$orderStatus" : "";
    $sqlCond .= !empty($status) ? " and b.status_active=$status" : "";

    if($shipmentStatus)
    {
        if ($shipmentStatus==4) 
        {
            $sqlCond .= " and b.shiping_status in(1,2)";
        }
        else
        {
            $sqlCond .= " and b.shiping_status in($shipmentStatus)";
        }
    }

    if(str_replace("'", "", $txt_date_from) !="" && str_replace("'", "", $txt_date_to) !="")
    {
        switch ($date_category) 
        {
            case 1:
                $sqlCond .= " and b.shipment_date between $txt_date_from and $txt_date_to";
                break;

            case 2:
                $sqlCond .= " and b.shipment_date between $txt_date_from and $txt_date_to";
                break;    
            
            default:
                $sqlCond .= " and b.factory_received_date between $txt_date_from and $txt_date_to";
                break;
        }
    }

    /*===============================================================================/
    /                                  MAIN QUERY                                    /
    /============================================================================== */
    $sql = "SELECT a.id,a.job_no, a.company_name,a.style_owner,a.buyer_name,a.style_ref_no,a.requisition_no,a.style_description,a.repeat_job_no,a.season_buyer_wise,a.product_dept,a.product_code,a.pro_sub_dep,a.order_uom,  a.product_category,a.brand_id,a.region,a.sustainability_standard,a.fab_material,a.qlty_label,a.quality_level,(a.job_quantity*a.total_set_qnty) as job_qty_pcs,    to_char(a.insert_date,'YYYY') as year,a.ship_mode,a.set_smv,a.team_leader,a.dealing_marchant,a.factory_marchant,a.inserted_by,a.total_price,a.qlty_label,

        b.is_confirmed,b.id as po_id,b.po_number,b.excess_cut,(b.po_quantity*a.total_set_qnty) as po_quantity,b.unit_price,b.po_total_price,to_char(b.insert_date,'DD-MM-YYYY') as po_insert_date,to_char(b.po_received_date,'DD-MM-YYYY') as po_received_date,to_char(b.factory_received_date,'DD-MM-YYYY') as factory_received_date,to_char(b.pub_shipment_date,'DD-MM-YYYY') as pub_shipment_date,to_char(b.shipment_date,'DD-MM-YYYY') as shipment_date,to_char(b.txt_etd_ldd,'DD-MM-YYYY') as txt_etd_ldd,b.shiping_status,(b.pub_shipment_date-b.po_received_date) as lead_time,(b.pub_shipment_date - trunc(sysdate)) AS days_in_hand,

        c.country_id,c.item_number_id,c.color_number_id,c.size_number_id,c.order_quantity,c.plan_cut_qnty,to_char(c.cutup_date,'DD-MM-YYYY') as cutup_date,to_char(c.country_ship_date,'DD-MM-YYYY') as country_ship_date

        from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.id=b.job_id and b.id=c.po_break_down_id and a.id=c.job_id and a.status_active=1 and a.is_deleted=0 and c.status_active in(1,2,3) and c.is_deleted=0 $sqlCond";
    // echo $sql;die();
    $sql_res = sql_select($sql);
    if(count($sql_res)==0)
    {
        ?>
        <center>
            <div style="width: 80%;" class="alert alert-danger">Data not found.Please try again.</div>
        </center>
        <?
        die();
    }
    $data_array = array();
    $job_id_array = array();
    $job_no_array = array();
    $po_array = array();
    $po_wise_data = array();
    $po_wise_job_arr = array();
    $po_chk_array = array();
    $po_wise_unit_price_array = array();
    foreach ($sql_res as $val) 
    {
        $data_array[$val['JOB_NO']]['company_name'] = $val['COMPANY_NAME'];
        $data_array[$val['JOB_NO']]['buyer_name'] = $val['BUYER_NAME'];
        $data_array[$val['JOB_NO']]['wo_com_id'] = $val['STYLE_OWNER'];
        $data_array[$val['JOB_NO']]['year'] = $val['YEAR'];
        $data_array[$val['JOB_NO']]['style'] = $val['STYLE_REF_NO'];
        $data_array[$val['JOB_NO']]['req_no'] = $val['REQUISITION_NO'];
        $data_array[$val['JOB_NO']]['repeat_job_no'] = $val['REPEAT_JOB_NO'];
        $data_array[$val['JOB_NO']]['style_des'] = $val['STYLE_DESCRIPTION'];
        $data_array[$val['JOB_NO']]['season'] = $val['SEASON_BUYER_WISE'];
        $data_array[$val['JOB_NO']]['product_dept'] = $val['PRODUCT_DEPT'];
        $data_array[$val['JOB_NO']]['product_code'] = $val['PRODUCT_CODE'];
        $data_array[$val['JOB_NO']]['pro_sub_dep'] = $val['PRO_SUB_DEP'];
        $data_array[$val['JOB_NO']]['product_category'] = $val['PRODUCT_CATEGORY'];
        $data_array[$val['JOB_NO']]['brand_id'] = $val['BRAND_ID'];
        $data_array[$val['JOB_NO']]['region'] = $val['REGION'];
        $data_array[$val['JOB_NO']]['sustainability_standard'] = $val['SUSTAINABILITY_STANDARD'];
        $data_array[$val['JOB_NO']]['fab_material'] = $val['FAB_MATERIAL'];
        $data_array[$val['JOB_NO']]['order_nature'] = $val['QLTY_LABEL'];
        $data_array[$val['JOB_NO']]['quality_level'] = $val['QUALITY_LEVEL'];
        $data_array[$val['JOB_NO']]['qlty_label'] = $val['QLTY_LABEL'];
        $data_array[$val['JOB_NO']]['job_qty_pcs'] = $val['JOB_QTY_PCS'];
        $data_array[$val['JOB_NO']]['order_uom'] = $val['ORDER_UOM'];
        $data_array[$val['JOB_NO']]['ship_mode'] = $val['SHIP_MODE'];
        $data_array[$val['JOB_NO']]['set_smv'] = $val['SET_SMV'];
        $data_array[$val['JOB_NO']]['team_leader'] = $val['TEAM_LEADER'];
        $data_array[$val['JOB_NO']]['dealing_marchant'] = $val['DEALING_MARCHANT'];
        $data_array[$val['JOB_NO']]['factory_marchant'] = $val['FACTORY_MARCHANT'];
        $data_array[$val['JOB_NO']]['inserted_by'] = $val['INSERTED_BY'];
        $data_array[$val['JOB_NO']]['total_price'] = $val['TOTAL_PRICE'];

        $data_array[$val['JOB_NO']]['po_number'] .= $val['PO_NUMBER'].",";
        $data_array[$val['JOB_NO']]['order_status'] .= $val['IS_CONFIRMED'].",";
        $po_wise_data[$val['JOB_NO']]['excess_cut'] .= $val['PO_NUMBER']."=".$val['EXCESS_CUT']."**";

        $data_array[$val['JOB_NO']]['country_id'] .= $val['COUNTRY_ID'].",";
        $data_array[$val['JOB_NO']]['item_id'] .= $val['ITEM_NUMBER_ID'].",";
        $data_array[$val['JOB_NO']]['color_id'] .= $val['COLOR_NUMBER_ID'].",";
        $data_array[$val['JOB_NO']]['size_id'] .= $val['SIZE_NUMBER_ID'].",";
        $data_array[$val['JOB_NO']]['order_quantity'] += $val['ORDER_QUANTITY'];
        $data_array[$val['JOB_NO']]['plan_cut_qnty'] += $val['PLAN_CUT_QNTY'];
        if(!in_array($val['PO_ID'], $po_chk_array))
        {
            $data_array[$val['JOB_NO']]['po_quantity'] += $val['PO_QUANTITY'];
            $data_array[$val['JOB_NO']]['order_value'] += $val['PO_TOTAL_PRICE'];
            $data_array[$val['JOB_NO']]['unit_price'] .= ($data_array[$val['JOB_NO']]['unit_price']=="") ? $val['UNIT_PRICE'] : ", ".$val['UNIT_PRICE'];
            $data_array[$val['JOB_NO']]['po_insert_date'] .= ($data_array[$val['JOB_NO']]['po_insert_date']=="") ? $val['PO_INSERT_DATE'] : ", ".$val['PO_INSERT_DATE'];
            $data_array[$val['JOB_NO']]['po_received_date'] .= ($data_array[$val['JOB_NO']]['po_received_date']=="") ? $val['PO_RECEIVED_DATE'] : ", ".$val['PO_RECEIVED_DATE'];
            $data_array[$val['JOB_NO']]['factory_received_date'] .= ($data_array[$val['JOB_NO']]['factory_received_date']=="") ? $val['FACTORY_RECEIVED_DATE'] : ", ".$val['FACTORY_RECEIVED_DATE'];
            $data_array[$val['JOB_NO']]['pub_shipment_date'] .= ($data_array[$val['JOB_NO']]['pub_shipment_date']=="") ? $val['PUB_SHIPMENT_DATE'] : ", ".$val['PUB_SHIPMENT_DATE'];
            $data_array[$val['JOB_NO']]['shipment_date'] .= ($data_array[$val['JOB_NO']]['shipment_date']=="") ? $val['SHIPMENT_DATE'] : ", ".$val['SHIPMENT_DATE'];
            $data_array[$val['JOB_NO']]['txt_etd_ldd'] .= ($data_array[$val['JOB_NO']]['txt_etd_ldd']=="") ? $val['TXT_ETD_LDD'] : ", ".$val['TXT_ETD_LDD'];
            $data_array[$val['JOB_NO']]['shipment_status'] .= ($data_array[$val['JOB_NO']]['shipment_status']=="") ? $shipment_status[$val['SHIPING_STATUS']] : ", ".$shipment_status[$val['SHIPING_STATUS']];
            $data_array[$val['JOB_NO']]['lead_time'] .= ($data_array[$val['JOB_NO']]['lead_time']=="") ? $val['LEAD_TIME'] : ", ".$val['LEAD_TIME'];
            $data_array[$val['JOB_NO']]['days_in_hand'] .= ($data_array[$val['JOB_NO']]['days_in_hand']=="") ? $val['DAYS_IN_HAND'] : ", ".$val['DAYS_IN_HAND'];

            $po_chk_array[$val['PO_ID']] = $val['PO_ID'];
        }
        $data_array[$val['JOB_NO']]['cutup_date'] .= ($data_array[$val['JOB_NO']]['cutup_date']=="") ? $val['CUTUP_DATE'] : ",".$val['CUTUP_DATE'];
        $data_array[$val['JOB_NO']]['country_ship_date'] .= ($data_array[$val['JOB_NO']]['country_ship_date']=="") ? $val['COUNTRY_SHIP_DATE'] : ",".$val['COUNTRY_SHIP_DATE'];


        $job_id_array[$val['ID']] = $val['ID'];
        $job_no_array[$val['JOB_NO']] = $val['JOB_NO'];
        $po_array[$val['PO_ID']] = $val['PO_ID'];
        $po_wise_job_arr[$val['PO_ID']] = $val['JOB_NO'];
        $po_wise_unit_price_array[$val['PO_ID']] = $val['UNIT_PRICE'];
    }

    unset($sql_res);
    // echo "<pre>";print_r($po_array);echo "</pre>";die();
    /*===============================================================================/
    /                                  Job Image                                     /
    /============================================================================== */
    $job_cond = where_con_using_array($job_no_array,1,"master_tble_id");

    $imge_arr = return_library_array("SELECT master_tble_id,image_location from common_photo_library where file_type=1 $job_cond", 'master_tble_id', 'image_location');

    /*===============================================================================/
    /                                  Embel Name                                    /
    /============================================================================== */
    $job_cond = where_con_using_array($job_id_array,1,"job_id");
    $sql = "SELECT job_no,emb_name from wo_pre_cost_embe_cost_dtls where status_active=1 and is_deleted=0 and emb_type!=0 $job_cond";
    // echo $sql;
    $res = sql_select($sql);
    $emb_name_arr = array();
    $emb_id_chk_arr = array();
    foreach ($res as $val) 
    {
        if(!in_array($val['EMB_NAME'], $emb_id_chk_arr[$val['JOB_NO']]))
        {
            $emb_name_arr[$val['JOB_NO']] .= ($emb_name_arr[$val['JOB_NO']]=="") ? $emblishment_name_array[$val['EMB_NAME']] : ",".$emblishment_name_array[$val['EMB_NAME']];
            $emb_id_chk_arr[$val['JOB_NO']][$val['EMB_NAME']] = $val['EMB_NAME'];
        }
    }

    /*===============================================================================/
    /                                Conversion Name                                 /
    /============================================================================== */
    $job_cond = where_con_using_array($job_id_array,1,"job_id");
    $sql = "SELECT job_no,cons_process from wo_pre_cost_fab_conv_cost_dtls where status_active=1 and is_deleted=0 $job_cond";
    // echo $sql;
    $res = sql_select($sql);
    $conv_name_arr = array();
    $conv_id_chk_arr = array();
    foreach ($res as $val) 
    {
        if(!in_array($val['CONS_PROCESS'], $conv_id_chk_arr[$val['JOB_NO']]))
        {
            $conv_name_arr[$val['JOB_NO']] .= ($conv_name_arr[$val['JOB_NO']]=="") ? $conversion_cost_head_array[$val['CONS_PROCESS']] : ",".$conversion_cost_head_array[$val['CONS_PROCESS']];
            $conv_id_chk_arr[$val['JOB_NO']][$val['CONS_PROCESS']] = $val['CONS_PROCESS'];
        }
    }
    // echo "<pre>";print_r($conv_id_chk_arr);die();
    /*===============================================================================/
    /                                  ACTUAL PO                                     /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"po_break_down_id");
    $sql = "SELECT job_no, acc_po_no FROM wo_po_acc_po_info where status_active=1 and is_deleted=0 $po_cond";
    $res = sql_select($sql);
    $acc_po_array = array();
    $acc_po_chk = array();
    foreach ($res as $key => $val) 
    {
        if(!in_array($val['ACC_PO_NO'], $acc_po_chk[$val['JOB_NO']]))
        {
            $acc_po_array[$val['JOB_NO']]['acc_po'] .= ($acc_po_array[$val['JOB_NO']]['acc_po']=="") ? $val['ACC_PO_NO'] : ", ".$val['ACC_PO_NO'];
            $acc_po_chk[$val['JOB_NO']][$val['ACC_PO_NO']] = $val['ACC_PO_NO'];
        }
    }

    /*===============================================================================/
    /                                  Booking Data                                  /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"b.po_break_down_id");
    $sql = "SELECT a.entry_form,a.process, b.job_no,a.item_category,to_char(a.booking_date,'DD-MM-YYYY') as booking_date,to_char(a.delivery_date,'DD-MM-YYYY') as delivery_date,a.booking_no,a.booking_no_prefix_num, b.po_break_down_id as po_id,a.booking_type,a.fabric_source,a.is_short,a.revised_no, b.fin_fab_qnty,b.grey_fab_qnty,a.is_approved,b.dia_width,b.gsm_weight,b.process_loss_percent,b.construction,b.copmposition,a.uom from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $booking_data_array = array();
    $pur_booking_data_array = array();
    $service_booking_data_array = array();
    $booking_qty_array = array();
    foreach ($res as $val) 
    {
        if($val['ITEM_CATEGORY']==2)
        {
            if($val['FABRIC_SOURCE']==1)
            {
            
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['booking_date'] .= $val['BOOKING_DATE'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['booking_no'] .= $val['BOOKING_NO'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['uom'] .= $val['UOM'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['delivery_date'] .= $val['DELIVERY_DATE'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['revised_no'] .= $val['REVISED_NO'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['is_approved'] .= $val['IS_APPROVED'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['dia_width'] .= $val['DIA_WIDTH'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['gsm_weight'] .= $val['GSM_WEIGHT'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['process_loss'] .= $val['PROCESS_LOSS_PERCENT'].",";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['construction'] .= $val['CONSTRUCTION']."__";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['copmposition'] .= $val['COPMPOSITION']."__";
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['fin_fab_qnty'] += $val['FIN_FAB_QNTY'];
                $booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']][$val['IS_SHORT']]['grey_fab_qnty'] += $val['GREY_FAB_QNTY'];
            }
            else
            {
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['booking_date'] .= $val['BOOKING_DATE'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['booking_no'] .= $val['BOOKING_NO'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['uom'] .= $val['UOM'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['delivery_date'] .= $val['DELIVERY_DATE'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['revised_no'] .= $val['REVISED_NO'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['is_approved'] .= $val['IS_APPROVED'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['dia_width'] .= $val['DIA_WIDTH'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['gsm_weight'] .= $val['GSM_WEIGHT'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['process_loss'] .= $val['PROCESS_LOSS_PERCENT'].",";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['construction'] .= $val['CONSTRUCTION']."__";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['copmposition'] .= $val['COPMPOSITION']."__";
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['fin_fab_qnty'] += $val['FIN_FAB_QNTY'];
                $pur_booking_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['BOOKING_TYPE']]['grey_fab_qnty'] += $val['GREY_FAB_QNTY'];
            }
            $booking_qty_array[$po_wise_job_arr[$val['PO_ID']]]['grey_fab_qnty'] += $val['GREY_FAB_QNTY'];
            $booking_qty_array[$po_wise_job_arr[$val['PO_ID']]]['fin_fab_qnty'] += $val['FIN_FAB_QNTY'];
        }

        if($val['ENTRY_FORM']==228)
        {
            $service_booking_data_array[$val['JOB_NO']]['knitting'] = $val['BOOKING_NO_PREFIX_NUM'];
        }

        if($val['ENTRY_FORM']==229)
        {
            $service_booking_data_array[$val['JOB_NO']]['dyeing'] = $val['BOOKING_NO_PREFIX_NUM'];
        }

        if($val['PROCESS']==35)
        {
            $service_booking_data_array[$val['JOB_NO']]['aop'] = $val['BOOKING_NO_PREFIX_NUM'];
        }
       
    }
    // echo "<pre>";print_r($booking_data_array);echo "</pre>";die();
    /*===============================================================================/
    /                                    Work order data                             /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"d.id");
    $sql="SELECT a.job_no,c.emb_name, f.booking_no from wo_po_details_master a, wo_pre_cost_mst b, wo_pre_cost_embe_cost_dtls c, wo_po_break_down d, wo_pre_cos_emb_co_avg_con_dtls e, wo_booking_dtls f
    where a.id=b.job_id and a.id=c.job_id and a.id=d.job_id and a.id=e.job_id and a.job_no=f.job_no and c.id=e.pre_cost_emb_cost_dtls_id and d.id=e.po_break_down_id and e.pre_cost_emb_cost_dtls_id= f.pre_cost_fabric_cost_dtls_id and e.po_break_down_id=f.po_break_down_id and f.booking_type=6 and d.is_deleted=0 and d.status_active=1 and f.status_active=1 and f.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $work_order_data_array = array();
    foreach ($res as $val) 
    {
        $bek = explode("-", $val['BOOKING_NO']);
        $work_order_data_array[$val['JOB_NO']][$val['EMB_NAME']] = $bek[3];
        
    }
    // echo "<pre>";print_r($work_order_data_array);die;
    /*===============================================================================/
    /                            YARN DYEING WORK ORDER DATA                         /
    /============================================================================== */
    $job_id_cond = where_con_using_array($job_id_array,0,"b.job_no_id");
    $sql="SELECT b.job_no,a.yarn_dyeing_prefix_num from wo_yarn_dyeing_mst a, wo_yarn_dyeing_dtls b
    where a.id=b.mst_id and a.is_deleted=0 and a.status_active=1 and b.status_active=1 and b.is_deleted=0 $job_id_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $yd_work_order_data_array = array();
    foreach ($res as $val) 
    {
        $yd_work_order_data_array[$val['JOB_NO']] = $val['YARN_DYEING_PREFIX_NUM'];
        
    }
    /*===============================================================================/
    /                                   YARN Allocation                              /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_break_down_id");
    $sql = "SELECT a.job_no,a.is_dyied_yarn,a.qnty from inv_material_allocation_dtls a where a.status_active=1 and a.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $yarn_allocation_array = array();
    foreach ($res as $val) 
    {
        $yarn_allocation_array[$val['JOB_NO']][$val['IS_DYIED_YARN']] += $val['QNTY'];
    }
    /*===============================================================================/
    /                                      Textile Data                              /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_breakdown_id");
    $sql = "SELECT a.po_breakdown_id,a.entry_form,a.trans_type,a.quantity from order_wise_pro_details a where a.status_active=1 and a.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $textile_data_array = array();
    $transfer_data_array = array();
    foreach ($res as $val) 
    {
        $textile_data_array[$po_wise_job_arr[$val['PO_BREAKDOWN_ID']]][$val['ENTRY_FORM']] += $val['QUANTITY'];
        $transfer_data_array[$po_wise_job_arr[$val['PO_BREAKDOWN_ID']]][$val['ENTRY_FORM']][$val['TRANS_TYPE']] += $val['QUANTITY'];
    }
    // echo "<pre>";print_r($textile_data_array);die;

    /*===============================================================================/
    /                             Yarn Rcv From Dyeing                               /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"c.po_breakdown_id");
    $sql = "SELECT c.po_breakdown_id as po_id, c.QUANTITY  from inv_receive_master a, inv_transaction b,order_wise_pro_details c where a.id=b.mst_id and b.id=c.trans_id and b.item_category=1 and a.entry_form=1 and b.transaction_type in(1) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.receive_purpose in(2) $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $yarn_rcv_from_dyeing_array = array();
    foreach ($res as $val) 
    {
        $yarn_rcv_from_dyeing_array[$po_wise_job_arr[$val['PO_ID']]] += $val['QUANTITY'];
    }
    // echo "<pre>";print_r($yarn_rcv_from_dyeing_array);die;

    /*===============================================================================/
    /                               knitting plan data                               /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_id");
    $sql="SELECT a.program_qnty,a.po_id from ppl_planning_entry_plan_dtls a where a.status_active=1 and a.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $program_data_array = array();
    foreach ($res as $val) 
    {
        $program_data_array[$po_wise_job_arr[$val['PO_ID']]] += $val['PROGRAM_QNTY'];
    }

    /*===============================================================================/
    /                               knitting production                              /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"c.po_breakdown_id");
    $sql="SELECT a.knitting_source,c.po_breakdown_id,c.quantity from inv_receive_master a,pro_grey_prod_entry_dtls b, order_wise_pro_details c where a.id=b.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and c.entry_form=2 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $knitting_data_array = array();
    foreach ($res as $val) 
    {
        $knitting_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['KNITTING_SOURCE']] += $val['PROGRAM_QNTY'];
    }

    /*===============================================================================/
    /                               Dyed yarn issue                                  /  
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"c.po_breakdown_id");
    $sql = "SELECT c.po_breakdown_id as po_id, c.QUANTITY  from inv_issue_master a, inv_transaction b,order_wise_pro_details c,product_details_master d where a.id=b.mst_id and b.id=c.trans_id and d.id=c.prod_id and b.item_category=1 and b.transaction_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.dyed_type=1 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $dyed_yarn_issue_array = array();
    foreach ($res as $val) 
    {
        $dyed_yarn_issue_array[$po_wise_job_arr[$val['PO_ID']]] += $val['QUANTITY'];
    }
    // echo "<pre>";print_r($dyed_yarn_issue_array);die;

    /*===============================================================================/
    /                                Roll Data                         
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_breakdown_id");
    $sql = "SELECT a.po_breakdown_id,a.entry_form,a.qnty from pro_roll_details a where a.status_active=1 and a.is_deleted=0  $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $roll_data_array = array();
    foreach ($res as $val) 
    {
        $roll_data_array[$po_wise_job_arr[$val['PO_BREAKDOWN_ID']]][$val['ENTRY_FORM']] += $val['QNTY'];
    }

    /*===============================================================================/
    /                                Fab Dyeing Prodduction                          /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_id");
    $sql = "SELECT c.load_unload_id,a.po_id,c.batch_qty,c.production_qty from pro_batch_create_dtls a, pro_fab_subprocess b,pro_fab_subprocess_dtls c where a.mst_id=b.batch_id and b.id=c.mst_id and a.status_active=1 and b.status_active=1 and c.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and c.load_unload_id=1 and b.result=1 and b.entry_form=35 $po_cond";
    // echo $sql;die;
    $res = sql_select($sql);
    $fab_dyeing_array = array();
    foreach ($res as $val) 
    {
        $fab_dyeing_array[$po_wise_job_arr[$val['PO_ID']]] += $val['PRODUCTION_QTY'];
    }

    /*===============================================================================/
    /                                  Finish Fabric Issue                           /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"c.po_breakdown_id");
    $sql = "SELECT c.po_breakdown_id as po_id,c.quantity from inv_issue_master a, inv_finish_fabric_issue_dtls b, order_wise_pro_details c where a.id=b.mst_id and b.id=c.dtls_id and a.status_active=1 and b.status_active=1 and c.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and c.entry_form=71 and trans_type=2 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $fin_fab_data_array = array();
    foreach ($res as $val) 
    {
        $fin_fab_data_array[$po_wise_job_arr[$val['PO_ID']]]['qty'] + $val['QUANTITY'];
    }

    /*===============================================================================/
    /                                   Cut & Lay data                               /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.order_id");
    $sql = "SELECT b.entry_date, a.order_id, a.bundle_no,a.size_qty from ppl_cut_lay_bundle a,ppl_cut_lay_mst b where b.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $po_cond";
    // echo $sql;die;
    $res = sql_select($sql);
    $lay_data_array = array();
    foreach ($res as $val) 
    {
        $lay_data_array[$po_wise_job_arr[$val['ORDER_ID']]]['entry_date'] .= $val['ENTRY_DATE'].",";
        $lay_data_array[$po_wise_job_arr[$val['ORDER_ID']]]['qty'] += $val['SIZE_QTY'];
        $lay_data_array[$po_wise_job_arr[$val['ORDER_ID']]]['no_of_bndl']++;
    }

    /*===============================================================================/
    /                                  Gmts Production                               /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_break_down_id");
    $sql = "SELECT a.production_source,a.serving_company, a.production_date,a.production_type,a.po_break_down_id as po_id,b.production_qnty,a.embel_name from pro_garments_production_mst a,pro_garments_production_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $po_cond order by a.production_date";
    // echo $sql;
    $res = sql_select($sql);
    $gmts_data_array = array();
    $embel_data_array = array();
    foreach ($res as $val) 
    {
        $gmts_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']]['date'] .= $val['PRODUCTION_DATE'].",";
        $gmts_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']]['qty'] += $val['PRODUCTION_QNTY'];

        $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['date'] .= $val['PRODUCTION_DATE'].",";
        $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['source'] .= $val['PRODUCTION_SOURCE'].",";
        $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['wo_com_id'] .= $val['SERVING_COMPANY'].",";
        $embel_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['PRODUCTION_TYPE']][$val['EMBEL_NAME']]['qty'] += $val['PRODUCTION_QNTY'];
    }
    // echo "<pre>";print_r($gmts_data_array);echo "</pre>";die();

    /*===============================================================================/
    /                            Printing & Emb Order Data                           /
    /============================================================================== */
    // 204=printing, 311=emb
    $po_cond = where_con_using_array($po_array,0,"b.buyer_po_no");
    $sql = "SELECT a.entry_form, b.buyer_po_no as po_id, b.order_quantity from subcon_ord_mst a, subcon_ord_dtls b where a.id=b.mst_id and a.status_active=1 and b.status_active=1 and b.is_deleted=0 and a.is_deleted=0 and a.within_group=1 and a.entry_form in(204,311) $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $print_emb_order_data_array = array();
    foreach ($res as $val) 
    {
        $print_emb_order_data_array[$po_wise_job_arr[$val['PO_ID']]][$val['ENTRY_FORM']]['qty'] += $val['ORDER_QUANTITY'];
    }

    /*===============================================================================/
    /                                 Buyer Inspection                               /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_break_down_id");
    $sql = "SELECT a.job_no,a.inspection_qnty,to_char(a.inspection_date,'DD-MM-YYYY') as inspection_date from pro_buyer_inspection a where a.status_active=1 and a.is_deleted=0 $po_cond";
    $res = sql_select($sql);
    $buyer_insp_data = array();
    foreach ($res as $val) 
    {
        $buyer_insp_data[$val['JOB_NO']]['qty'] += $val['INSPECTION_QNTY'];
        $buyer_insp_data[$val['JOB_NO']]['date'] = $val['INSPECTION_DATE'];
    }

    /*===============================================================================/
    /                                  ex-factory data                               /
    /============================================================================== */
    $sql = "SELECT a.id,a.po_break_down_id as po_id,a.ex_factory_date,(case when a.entry_form !=85 then b.production_qnty else 0 end) as production_qnty,(case when a.entry_form =85 then b.production_qnty else 0 end) as return_qnty,a.total_carton_qnty from pro_ex_factory_mst a,pro_ex_factory_dtls b where a.id=b.mst_id and a.status_active=1 and b.status_active=1 and a.is_deleted=0 and b.is_deleted=0 $po_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $ex_data_array = array();
    $id_chk_array = array();
    foreach ($res as $val) 
    {
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['ex_date'] .= $val['EX_FACTORY_DATE'].",";
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['ex_qty'] += $val['PRODUCTION_QNTY'];
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['rtn_qty'] += $val['RETURN_QNTY'];
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['ex_value'] += ($val['PRODUCTION_QNTY']*$po_wise_unit_price_array[$val['PO_ID']]);
        $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['ex_rtn_value'] += ($val['RETURN_QNTY']*$po_wise_unit_price_array[$val['PO_ID']]);
        if(!in_array($val['ID'], $id_chk_array))
        {
            $ex_data_array[$po_wise_job_arr[$val['PO_ID']]]['cartot_qnty'] += $val['TOTAL_CARTON_QNTY'];
            $id_chk_array[$val['ID']] = $val['ID'];
        }
    }
    // echo "<pre>";print_r($ex_data_array);die();
    /*===============================================================================/
    /                                 Export Invoice                                 /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"b.po_breakdown_id");
    $sql = "SELECT b.po_breakdown_id as po_id,b.current_invoice_qnty,b.current_invoice_value,a.invoice_no from com_export_invoice_ship_mst a, com_export_invoice_ship_dtls b where a.id=b.mst_id and a.status_active=1 and b.status_active=1 and a.is_deleted=0 and b.is_deleted=0 $po_cond";
    $res = sql_select($sql);
    $invice_data = array();
    foreach ($res as $val) 
    {
        $invice_data[$po_wise_job_arr[$val['PO_ID']]]['inv_qty']+=$val['CURRENT_INVOICE_QNTY'];
        $invice_data[$po_wise_job_arr[$val['PO_ID']]]['inv_value']+=$val['CURRENT_INVOICE_VALUE'];
    }

    /*===============================================================================/
    /                                      LC/SC data                                /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"b.wo_po_break_down_id");
    $sql = "SELECT b.wo_po_break_down_id as po_id,a.lien_bank,a.pay_term,a.internal_file_no,a.tenor,max(c.amendment_no) as amendment_no from com_export_lc a,com_export_lc_order_info b, com_export_lc_amendment c where a.id=b.com_export_lc_id AND a.export_lc_no = c.export_lc_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $po_cond group by b.wo_po_break_down_id,a.lien_bank,a.pay_term,a.internal_file_no,a.tenor
    UNION ALL
    SELECT b.wo_po_break_down_id as po_id,a.lien_bank,a.pay_term,a.internal_file_no,a.tenor,max(c.amendment_no) as amendment_no from com_sales_contract a,com_sales_contract_order_info b,com_sales_contract_amendment c where a.id=b.com_sales_contract_id and a.contract_no=c.contract_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $po_cond group by b.wo_po_break_down_id,a.lien_bank,a.pay_term,a.internal_file_no,a.tenor
    ";
    // echo $sql;die();
    $res = sql_select($sql);
    $lc_sc_data_array = array();
    foreach ($res as $val) 
    {
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['lien_bank'] .= $bank_library[$val['LIEN_BANK']].",";
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['pay_term'] .= $pay_term[$val['PAY_TERM']].",";
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['internal_file_no'] .= $val['INTERNAL_FILE_NO'].",";
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['tenor'] .= $val['TENOR'].",";
        $lc_sc_data_array[$po_wise_job_arr[$val['PO_ID']]]['amendment_no'] .= $val['AMENDMENT_NO'].",";
    }
    // echo "<pre>";print_r($lc_sc_data_array);die();

    /*===============================================================================/
    /                                      TNA Data                                  /
    /============================================================================== */
    $po_cond = where_con_using_array($po_array,0,"a.po_number_id");
    $sql = "SELECT a.po_number_id,a.task_number,max(a.task_start_date) as start_date,max(a.task_finish_date) as end_date,max(a.actual_start_date) as actual_start_date,max(a.actual_finish_date) as actual_finish_date,b.job_no_mst from tna_process_mst a,wo_po_break_down b where a.po_number_id=b.id and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and a.task_start_date is not null and b.po_quantity>0 $po_cond and a.task_type=1 group by a.po_number_id,a.task_number,b.job_no_mst";
    // echo $sql;die();
    $res = sql_select($sql);
    $tnaDateArray = array();
    foreach ($res as $val) 
    {
        $tnaDateArray[$val['JOB_NO_MST']][$val['TASK_NUMBER']]['start_date']          = $val['START_DATE'];
        $tnaDateArray[$val['JOB_NO_MST']][$val['TASK_NUMBER']]['end_date']            = $val['END_DATE'];
        $tnaDateArray[$val['JOB_NO_MST']][$val['TASK_NUMBER']]['actual_start_date']   = $val['ACTUAL_START_DATE'];
        $tnaDateArray[$val['JOB_NO_MST']][$val['TASK_NUMBER']]['actual_finish_date']  = $val['ACTUAL_FINISH_DATE'];
    }

    // echo "<pre>";print_r($tnaDateArray);die();
    /*===============================================================================/
    /                                    Budget Data                                 /
    /============================================================================== */
    $job_id_cond = where_con_using_array($job_id_array,0,"a.job_id");
    $sql = "SELECT a.job_no,to_char(a.costing_date,'DD-MM-YYYY') as costing_date,a.approved,b.cm_cost from wo_pre_cost_mst a,wo_pre_cost_dtls b where a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.job_id=b.job_id $job_id_cond";
    // echo $sql;die();
    $res = sql_select($sql);
    $budget_data_array = array();
    foreach ($res as $val) 
    {
        $budget_data_array[$val['JOB_NO']]['costing_date'] = $val['COSTING_DATE'];
        $budget_data_array[$val['JOB_NO']]['approved'] = $val['APPROVED'];
        $budget_data_array[$val['JOB_NO']]['cm_cost'] = $val['CM_COST'];
    }

    /*===============================================================================/
    /                              Getting data from class                           /
    /============================================================================== */
    $poIDS = implode(",", $po_array);
    $condition= new condition();     
    $condition->po_id_in($poIDS);     
    $condition->init();
    // $fabric= new fabric($condition);
    $yarn= new yarn($condition);
    $yarn_costing_arr=$yarn->getJobWiseYarnAmountArray();
    $yarn_qty_amount_arr=$yarn->getJobWiseYarnQtyAndAmountArray();

    $yarnDataWithFabricidArr=$yarn->get_By_Precostfabricdtlsid_YarnQtyAmountArray();

    $fabric= new fabric($condition);
    $fabricAmoutByFabricSource= $fabric->getAmountArray_by_job_knitAndwoven_greyAndfinish();
    $fabricQtyByFabricSource= $fabric->getQtyArray_by_job_knitAndwoven_greyAndfinish_purchase();
    
    $fabric_qty_arr=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
    $fabric_amount_arr=$fabric->getAmountArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
    $conversion= new conversion($condition);
    $conversion_costing_arr_process=$conversion->getAmountArray_by_job();
    $conv_qty_job_process= $conversion->getQtyArray_by_jobAndProcess();
    $conv_amount_job_process= $conversion->getAmountArray_by_jobAndProcess();
    $con_qty_fabric_process = $conversion->getQtyArray_by_fabricAndProcess();
    $con_amount_fabric_process = $conversion->getAmountArray_by_fabricAndProcess();

    $trims= new trims($condition);
    $trims_costing_arr=$trims->getAmountArray_by_job();
    $trims_qty_arr=$trims->getQtyArray_by_job();

    $emblishment= new emblishment($condition);
    $emblishment_costing_arr=$emblishment->getAmountArray_by_job();
    $emb_qty_job_name_arr = $emblishment->getQtyArray_by_jobAndEmbname();
    $emb_amount_job_name_arr = $emblishment->getAmountArray_by_jobAndEmbname();

    $wash= new wash($condition);
    $emblishment_costing_arr_wash=$wash->getAmountArray_by_job();
    $wash_qty_job_name_arr =$wash->getQtyArray_by_jobAndEmbname();
    $wash_amount_job_name_arr =$wash->getAmountArray_by_jobAndEmbname();


    $commercial= new commercial($condition);
    $commercial_costing_arr=$commercial->getAmountArray_by_job();
    $commission= new commision($condition);
    $commission_costing_arr=$commission->getAmountArray_by_job();
    $other= new other($condition);
    $other_costing_arr=$other->getAmountArray_by_job();


    /*===============================================================================/
    /                        Functin for getting max min date                        /
    /============================================================================== */
    function get_max_min_date($date_arr)
    {
        $date_arr = explode(",", implode(",", $date_arr));
        $date_array = array();
        for ($i = 0; $i < count($date_arr); $i++)
        {
            if ($i == 0)
            {
                $max_date = date('d-m-Y', strtotime($date_arr[$i]));
                $min_date = date('d-m-Y', strtotime($date_arr[$i]));
                $date_array['max_date'] = $max_date;
                $date_array['min_date'] = $min_date;
            }
            elseif ($i != 0)
            {
                $new_date = date('d-m-Y', strtotime($date_arr[$i]));
                if ($new_date > $max_date)
                {
                    $max_date = $new_date;
                    $date_array['max_date'] = $max_date;
                }
                elseif ($new_date < $min_date)
                {
                    $min_date = $new_date;
                    $date_array['min_date'] = $min_date;
                }
            }
        }
        return $date_array;
    }

   

    //$tbl_width = 25330;
    $tbl_width = $dynamic_table_width;

    ob_start();
    ?>
    <fieldset>
        <div class="title-part" style="margin: 0 auto;text-align: center;font-size: 20px;">
            <h2>Order Tracking Report</h2>
            <h2>Company : <?=$company_arr[$company_name]; ?></h2>
            <h2>Date : <?=change_date_format($date_from); ?>To<?=change_date_format($date_to); ?> </h2>
        </div>
        <style type="text/css">
            table thead tr td{
                padding: 5px;text-align: center;font-weight: bold;font-size: 16px;
            }
            .zoom {
              padding: 0px;
              transition: transform .2s; 
              width: 30px;
              height: 30px;
              margin: 0 auto;
              z-index: 9999 !important;
              overflow: hidden !important;
              visibility: visible;
              position: relative;
            }

            .zoom:hover {
              transform: scale(10); 

              z-index: 9999 !important;
              overflow: hidden !important;
              visibility: visible;
            }
        </style>
        <div class="report-container-part">
            <!-- ================================= report header ================================== -->
            <table cellspacing="0" border="1" class="rpt_table"   rules="all" width="<?=$tbl_width;?>"  align="center" id="table_header_1">
                <thead>
                    
                    <tr>
                        <?php if(!empty($column_name['Sl.'])): ?>
                            <th width="30" style="word-wrap: break-word;"><p>Sl.</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Order Status'])): ?>
                            <th width="60" style="word-wrap: break-word;"><p>Order Status</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['LC Company'])): ?>
                            <th width="100" style="word-wrap: break-word;"><p>LC Company</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Working Company'])): ?>
                            <th width="100" style="word-wrap: break-word;"><p>Working Company</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Image'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Image</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Buyer'])): ?>
                            <th width="100" style="word-wrap: break-word;"><p>Buyer</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Year'])): ?>
                            <th width="50" style="word-wrap: break-word;"><p>Year</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Job'])): ?>
                            <th width="90" style="word-wrap: break-word;"><p>Job</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Repeat Job No'])): ?>
                        <th width="80" style="word-wrap: break-word;"><p>Repeat Job No</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Sample Req. No'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Sample Req. No</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Style Ref'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Style Ref</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Style Desc'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Style Desc</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Gmts Item'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Gmts Item</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Season'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Season</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Prod Dept'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Prod Dept</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Prod. Dept Code / Class'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Prod. Dept Code / Class</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Sub Dept'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Sub Dept</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Brand'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Brand</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Region'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Region</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Prod. Catg'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Prod. Catg</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Country'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Country</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Sustainability Standard'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Sustainability Standard</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Fabric Material'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Fabric Material</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Order Nature'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Order Nature</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Quality Label'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Quality Label</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Embilshement Name'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Embilshement Name</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Service Name'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Service Name</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Order/PO No'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Order/PO No</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Actual Order/PO No'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Actual Order/PO No</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['GMT Color'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>GMT Color</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Size'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Size</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Ex Cut %'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Ex Cut %</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Order Qnty [Pcs]'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Order Qnty [Pcs]</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Break Down Order Qnty [Pcs]'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Break Down Order Qnty [Pcs]</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Order Qnty with Cut% [Pcs]'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Order Qnty with Cut% [Pcs]</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Order Qnty [Uom]'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Order Qnty [Uom]</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Uom'])): ?>
                            <th width="80" style="word-wrap: break-word;"><p>Uom</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Per Unit Price'])): ?>
                            <th width="80"><p>Per Unit Price</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Order Value'])): ?>
                            <th width="80"><p>Order Value</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['PO Insert Date'])): ?>
                            <th width="80"><p>PO Insert Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['PO Receive Date'])): ?>
                            <th width="80"><p>PO Receive Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Factory Receive Date'])): ?>
                            <th width="80"><p>Factory Receive Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['1st Cut Date'])): ?>
                            <th width="80"><p>1st Cut Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Last Cut Date'])): ?>
                            <th width="80"><p>Last Cut Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['1st Sew Date'])): ?>
                            <th width="80"><p>1st Sew Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Last Sew Date'])): ?>
                            <th width="80"><p>Last Sew Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['1st Finish Date'])): ?>
                            <th width="80"><p>1st Finish Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Last Finish Date'])): ?>
                            <th width="80"><p>Last Finish Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Insp. Offer Date'])): ?>
                            <th width="80"><p>Insp. Offer Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Insp. Date'])): ?>
                            <th width="80"><p>Insp. Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Pub. Shipment Date'])): ?>
                            <th width="80"><p>Pub. Shipment Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['First Shipment Date'])): ?>
                            <th width="80"><p>First Shipment Date </p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Org. Shipment Date'])): ?>
                            <th width="80"><p>Org. Shipment Date </p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['ETD/LDD Date'])): ?>
                            <th width="80"><p>ETD/LDD Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Cut-off Date'])): ?>
                            <th width="80"><p>Cut-off Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Country Shipment Date'])): ?>
                            <th width="80"><p>Country Shipment Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['RFI Plan Date'])): ?>
                            <th width="80"><p>RFI Plan Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Shipment Mode'])): ?>
                            <th width="80"><p>Shipment Mode</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Lead Time'])): ?>
                            <th width="80"><p>Lead Time</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Days in Hand'])): ?>
                            <th width="80"><p>Days in Hand</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Commercial File No'])): ?>
                            <th width="80"><p>Commercial File No</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Lien Bank'])): ?>
                            <th width="80"><p>Lien Bank</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Ex. LC/SC Amendment No(Last)'])): ?>
                            <th width="80"><p>Ex. LC/SC Amendment No(Last)</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Pay Term'])): ?>
                            <th width="80"><p>Pay Term</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Tenor'])): ?>
                            <th width="80"><p>Tenor</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['First Shipment Date'])): ?>
                            <th width="80"><p>First Shipment Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Last Shipment Date'])): ?>
                            <th width="80"><p>Last Shipment Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Shipment Qnty'])): ?>
                            <th width="80"><p>Shipment Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Shipment Value'])): ?>
                            <th width="80"><p>Shipment Value</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Excess Shipment Qnty'])): ?>
                            <th width="80"><p>Excess Shipment Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Excess Shipment Value'])): ?>
                            <th width="80"><p>Excess Shipment Value</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Short Shipment Qnty'])): ?>
                            <th width="80"><p>Short Shipment Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Short Shipment Value'])): ?>
                            <th width="80"><p>Short Shipment Value</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Shipping Status'])): ?>
                            <th width="80"><p>Shipping Status</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['SMV'])): ?>
                            <th width="80"><p>SMV</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Total SMV'])): ?>
                            <th width="80"><p>Total SMV</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['CM'])): ?>
                            <th width="80"><p>CM</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Team Leader'])): ?>
                            <th width="80"><p>Team Leader</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Dealing Merchandiser'])): ?>
                            <th width="80"><p>Dealing Merchandiser</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Factory Merchandiser'])): ?>
                            <th width="80"><p>Factory Merchandiser</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Insert User'])): ?>
                            <th width="80"><p>Insert User</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Lab Dip No'])): ?>
                            <th width="80"><p>Lab Dip No</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Buyer Sample Status'])): ?>
                            <th width="80"><p>Buyer Sample Status</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Order Status'])): ?>
                            <th width="80"><p>Order Status</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Referance Closed'])): ?>
                            <th width="80"><p>Referance Closed</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Emb. Work Order No'])): ?>
                            <th width="80"><p>Emb. Work Order No</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Service Work Order No'])): ?>
                            <th width="80"><p>Service Work Order No</p></th>
                        <?php endif ?>


                        <?php if(!empty($column_name['Budget Date'])): ?>
                            <th width="80"><p>Budget Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Budget Value'])): ?>
                            <th width="80"><p>Budget Value</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Open Value'])): ?>
                            <th width="80"><p>Open Value</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Approved'])): ?>
                            <th width="80"><p>Approved</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Amendment No'])): ?>
                            <th width="80"><p>Amendment No</p></th>
                        <?php endif ?>


                        <?php if(!empty($column_name['M Fabric Booking Date'])): ?>
                            <th width="80"><p>M Fabric Booking Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['M Fabric Booking No'])): ?>
                            <th width="80"><p>M Fabric Booking No</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Fabric Delivery Date'])): ?>
                            <th width="80"><p>Fabric Delivery Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Amendment No'])): ?>
                            <th width="80"><p>Amendment No</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Amendment Date'])): ?>
                            <th width="80"><p>Amendment Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Approved Status'])): ?>
                            <th width="80"><p>Approved Status</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Yarn Description'])): ?>
                            <th width="80"><p>Yarn Description</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Fabric Construction'])): ?>
                            <th width="80"><p>Fabric Construction</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Fabric Composition'])): ?>
                            <th width="80"><p>Fabric Composition</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['GSM'])): ?>
                            <th width="80"><p>GSM</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Dia/Width'])): ?>
                            <th width="80"><p>Dia/Width</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Finish Quantity'])): ?>
                            <th width="80"><p>Finish Quantity</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Process Loss%'])): ?>
                            <th width="80"><p>Process Loss%</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Grey Qnty Kg'])): ?>
                            <th width="80"><p>Grey Qnty Kg</p></th>
                        <?php endif ?>


                        <?php if(!empty($column_name['Fabric Booking Date'])): ?>
                            <th width="80"><p>Fabric Booking Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Fabric Booking No'])): ?>
                            <th width="80"><p>Fabric Booking No</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Fabric Delivery Date'])): ?>
                            <th width="80"><p>Fabric Delivery Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Fabrication'])): ?>
                            <th width="80"><p>Fabrication</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Uom'])): ?>
                            <th width="80"><p>Uom</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Qnty'])): ?>
                            <th width="80"><p>Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Approved Status'])): ?>
                            <th width="80"><p>Approved Status</p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Fabric Booking Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Fabric Booking No</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Fabric Delivery Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Fabrication</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Uom</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Finish Quantity</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Process Loss%</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Grey Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Approved Status</p></th>
                        <?php endif ?>


                        <?php if(!empty($column_name[''])): ?>
                            <th width="80" ><p>Trims/Acc Status</p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Grey Yarn Require with Short/EFR Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Yarn Allocation Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Yarn Excess Allocation Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Yarn Received Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Yarn Receive Balance Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Yarn Issued Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Yarn Issue Balance Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Yarn Excess Issued Qty </p></th>
                        <?php endif ?>


                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Dyed Yarn Require with Short/EFR Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Dyed Yarn Allocation Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Dyed Yarn Excess Allocation Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Dyed Yarn Received Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Dyed Yarn Receive Balance Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Dyed Yarn Issued Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Dyed Yarn Issue Balance Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Dyed Yarn Excess Issued Qty </p></th>
                        <?php endif ?>


                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Dyed Yarn Require with Short/EFR Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Service Work Order Qty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Yarn Dyed Produciton Qty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Yarn Dyed Produciton WIP Qty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Yarn Dyed Delivery Qty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Yarn Dyed Challan No</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Yarn Dyed Challan Date</p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Knitting Require with EFR Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Knitting Plan Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Knitting Plan WIP Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Knitting Work Order No</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Knitting Production Qnty [Inbound]</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Knitting Production Qnty [Outbound]</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>TTL Knitting Production Qnty </p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>TTL Knitting Excess Production Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>TTL Knitting Production WIP Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Price/KG [TK]</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Total Price [TK]</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Knitting Grey Fabric Delivery Qnty To Store</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Closing Status</p></th>
                        <?php endif ?>


                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Require with Short/EFR Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Normal Received Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Normal Receive Excess Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Receive Balance Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Transfer Received Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>TTL Fabric Received Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Normal Issued Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Trasfered Issued Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>TTL Fabric Issued Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Stock In Hand</p></th>
                        <?php endif ?>




                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Require with Short/EFR Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Fabric Received by Batch </p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Batch Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Production Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Production Excess Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Production WIP Qnty</p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Require with Short/EFR Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Production Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Production Excess Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Production WIP Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Process Name</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>QC Received Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>AOP Issue Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>AOP Receive Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>AOP Receive WIP Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>QC Delivery Qnty To Store</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>QC Stock in Hand</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Closing Status</p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Require with Short/EFR Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Normal Received Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Normal Receive Excess Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Receive Balance Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Transfer Received Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>TTL Received Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Normal Issued Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Trasfered Issued Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>TTL Issued Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Stock In Hand</p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Require with Short/EFR Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Fabric Receive Qnty By Cutting</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Excess Receive Qnty By Cutting </p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Receive Balance Qnty By Cutting</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Cutting Status</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Oreder Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Excess Cutting %</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Order Qnty with C%</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Cutting Bundle Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Cutting Lay Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Cutting Production [QC] Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Excess Cutting Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Cutting Production Balance Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Input Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Input WIP Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Print Send Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Print Receive Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Print WIP Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Print Supplier</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>EMB Send Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>EMB Receive Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>EMB WIP Balance Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>EMB Supplier</p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Require Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Order Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Order Balance Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Production [QC] Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Production Excess Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Production WIP Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Delivery Qnty To Cutting</p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Require Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Work Order Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Work Order Balance Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Production [QC] Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Production Excess Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Production WIP Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Delivery Qnty To Cutting</p></th>
                        <?php endif ?>


                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Require Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Input Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Input Excess Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Input Balance Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Production [Output] Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Production Excess Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Production WIP Qnty</p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Require Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Iron Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>HANGTAG Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>POLY Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Finish Quantity</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Balance Qty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Inspection Offer Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Inspection Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Inspection Qnty</p></th>
                        <?php endif ?>




                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Carton Qty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Shipment Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Invoice Qty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Shipment Value</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Invoice Value</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Net Invoice Value</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Excess Shipment Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Excess Shipment Value </p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Short Shipment Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Short Shipment Value</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Shipment Return Qnty</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Shipment Return Value</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>First Shipment Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Last Shipment Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Discount / Penalty / Claim Amount</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Reason of Discount / Penalty / Claim </p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Budget Date</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Budget Yarn Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Actual Yarn Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Budget Finish YD Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Actual Finish YD Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Budget Knitting Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Actual Knitting Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Budget Dyeing & Finishing Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Actual Dyeing & Finishing Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Budget Fabric Purchase Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Actual Fabric Purchase Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Budget AOP Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Actual AOP Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Budget Print Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Actual Print Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Budget Emb Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Actual Emb Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Budget Wash Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Actual Wash Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Budget Trims Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Actual Trims Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Budget MISC Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Actual MISC Cost</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Budget CM</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Actual CM</p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Lead Time [Templete]</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Yarn Receive Start</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Yarn Receive End</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Knitting Start</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Knitting End</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Dyeing Start</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Dyeing End</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Finish Fabric Prod. Start</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Finish Fabric Prod. End</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Trims Receive Start</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Trims Receive End</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Cutting Start</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Cutting End</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Print Start</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Print End</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Emb Start</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Emb End</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Sewing Start</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Sewing End</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>GMT Finihsing Start</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>GMT Finihsing End</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Inspection Start</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Inspection End</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Shipment  Start</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p>Shipment  End</p></th>
                        <?php endif ?>
                    </tr>
                </thead>
            </table>
            <!-- =================================== report body ==================================== -->
            <div style=" max-height:300px; width:<?=$tbl_width+20;?>px; overflow-y:scroll;" id="scroll_body">
                <table cellspacing="0" border="1" class="rpt_table"   rules="all" width="<?=$tbl_width;?>"  align="center" id="table_body">
                    <tbody>
                        <?
                        $i=1;
                        $gr_job_total = 0;
                        $gr_po_total = 0;
                        $gr_color_size_total = 0;
                        $gr_plan_cut_total = 0;
                        $gr_order_value_total = 0;

                        foreach ($data_array as $job_key => $row) 
                        {   
                            $bgcolor=($i%2==0)?"#E9F3FF":"#FFFFFF";   
                            $ship_excess_qty = max($ex_data_array[$job_key]['ex_qty'] - $row['order_quantity'],0);
                            $ship_excess_val = max($ex_data_array[$job_key]['ex_value'] - $row['order_value'],0); 
                            $ship_short_qty = max($row['order_quantity'] - $ex_data_array[$job_key]['ex_qty'],0);
                            $ship_short_val = max($row['order_value'] - $ex_data_array[$job_key]['ex_value'],0);

                            // =============================== for budget data ===========================
                            $finishing_arr = array('209','165','33','94','63','171','65','170','156','179','200','208','127','125','84','68','128','190','242','240','192','172','90','218','67','197','73','66','185','142');
                            $total_finishing_amount=0;
                            $total_finishing_qty=0;
                            $other_cost_attr = array('inspection','freight','certificate_pre_cost','deffdlc_cost','design_cost','studio_cost','common_oh','interest_cost','incometax_cost','depr_amor_pre_cost');
                            $total_other_cost = 0;
                            foreach ($other_cost_attr as $attr) {
                                $total_other_cost+=$other_costing_arr[$job_key][$attr];
                            }
                            $misc_cost=$other_costing_arr[$job_key]['lab_test']+$commercial_costing_arr[$job_key]+$commission_costing_arr[$job_key]+$total_other_cost;

                            foreach ($finishing_arr as $fid) {
                                $total_finishing_amount += array_sum($conv_amount_job_process[$job_key][$fid]);
                                $total_finishing_qty += array_sum($conv_qty_job_process[$job_key][$fid]);
                            }

                            $total_fabic_cost=0;
                            if(count($conv_amount_job_process[$job_key][31])>0){
                                $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][31])/array_sum($conv_qty_job_process[$job_key][31]);
                            }
                            $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][31]);
                            $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][31])/$order_values*100;
                            if(count($conv_amount_job_process[$job_key][30])>0){
                                $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][30])/array_sum($conv_qty_job_process[$job_key][30]);
                            }
                            if($yarn_qty_amount_arr[$job_key]['amount']!=''){
                                $total_fabic_cost+=$yarn_qty_amount_arr[$job_key]['amount']/$yarn_qty_amount_arr[$job_key]['qty'];
                            }
                            $total_fabric_amount +=$yarn_qty_amount_arr[$job_key]['amount']; 
                            $total_fabric_per +=$yarn_qty_amount_arr[$job_key]['amount']/$order_values*100;
                            if($total_finishing_amount!=0){
                                $total_fabic_cost+=$total_finishing_amount/$total_finishing_qty;
                            } 
                            $total_fabric_amount +=$total_finishing_amount;
                            $total_fabric_per +=$total_finishing_amount/$order_values*100;
                            $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][30]);
                            $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][30])/$order_values*100;
                            if(count($conv_amount_job_process[$job_key][35])>0){
                                $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][35])/array_sum($conv_qty_job_process[$job_key][35]);
                            }
                            $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][35]); 
                            $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][35])/$order_values*100;
                            if(count($conv_amount_job_process[$job_key][1])>0){
                                $total_fabic_cost+=array_sum($conv_amount_job_process[$job_key][1])/array_sum($conv_qty_job_process[$job_key][1]);
                            }
                            $total_fabric_amount +=array_sum($conv_amount_job_process[$job_key][1]);
                            $total_fabric_per +=array_sum($conv_amount_job_process[$job_key][1])/$order_values*100; 

                            $purchase_amount = array_sum($fabricAmoutByFabricSource['knit']['grey'][$job_key])+array_sum($fabricAmoutByFabricSource['woven']['grey'][$job_key]);
                            $purchase_qty = array_sum($fabricQtyByFabricSource['knit']['grey'][$job_key])+array_sum($fabricQtyByFabricSource['woven']['grey'][$job_key]);

                            $ather_emb_attr = array(4,5,6,99);
                            foreach ($ather_emb_attr as $att) {
                                $others_emb_amount += $emb_amount_job_name_arr[$job_key][$att];
                                $others_emb_qty += $emb_qty_job_name_arr[$job_key][$att];
                            }
                            $knitting_amount_summ=''; $dyeing_amount_summ=''; $yds_amount_summ=''; $aop_amount_summ='';
                            if(count($conv_amount_job_process[$job_key][1])>0) {
                                $knitting_amount_summ = fn_number_format(array_sum($conv_amount_job_process[$job_key][1]),2);
                            }
                            $yarn_amount_summ = $yarn_qty_amount_arr[$job_key]['amount'];
                            $print_amount_summ = $emb_amount_job_name_arr[$job_key][1];      
                            $emb_amount_summ= $emb_amount_job_name_arr[$job_key][2];
                            $wash_amount_summ = $wash_amount_job_name_arr[$job_key][3];
                            if(count($conv_amount_job_process[$job_key][31])>0) {
                                $dyeing_amount_summ=  array_sum($conv_amount_job_process[$job_key][31]);
                            }
                            if(count($conv_amount_job_process[$job_key][30])>0) {
                                $yds_amount_summ = array_sum($conv_amount_job_process[$job_key][30]);
                            }
                            if(count($conv_amount_job_process[$job_key][35])>0) {
                                $aop_amount_summ = array_sum($conv_amount_job_process[$job_key][35]);
                            }
                            
                            $total_budget_value = $yarn_amount_summ+$total_finishing_amount+$print_amount_summ+$trims_costing_arr[$job_key]+$yds_amount_summ+$aop_amount_summ+$emb_amount_summ+$knitting_amount_summ+$purchase_amount+$wash_amount_summ+$other_costing_arr[$job_key]['cm_cost']+$dyeing_amount_summ+$others_emb_amount+$misc_cost;
                            $open_value = $row['total_price']-$total_budget_value;
                            ?>
                            <tr bgcolor="<? echo $bgcolor;?>" id="tr_<?= $i;?>" onClick="change_color('tr_<?= $i; ?>','<?= $bgcolor; ?>')">
                                <?php if(!empty($column_name['Sl.'])): ?>
                                    <td width="30">.<p><?=$i;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Order Status'])): ?>
                                    <td width="60">
                                            <p>
                                                <?
                                                $order_status_arr = array_unique(array_filter(explode(",", $row['order_status'])));
                                                $order_status_name = "";
                                                foreach ($order_status_arr as $val) 
                                                {
                                                    $order_status_name .= ($order_status_name=="") ? $order_status[$val] : ", ".$order_status[$val];
                                                }
                                                echo $order_status_name;
                                                ?>
                                                
                                            </p>
                                        </td>
                                <?php endif ?>

                                <?php if(!empty($column_name['LC Company'])): ?>
                                    <td width="100"><p><?=$company_library[$row['company_name']];?></p></td>
                                <?php endif ?>
                                
                                <?php if(!empty($column_name['Working Company'])): ?>
                                    <td width="100"><p><?=$company_library[$row['wo_com_id']];?></p></td>
                                <?php endif ?>
                                
                                <?php if(!empty($column_name['Image'])): ?>
                                    <td width="80"><img class="zoom" src='../../../<?= $imge_arr[$job_key]; ?>' height='40' width='50' /></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Buyer'])): ?>
                                    <td width="100"><p><?=$buyer_library[$row['buyer_name']];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Year'])): ?>
                                    <td width="50" align="center"><p><?=$row['year'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Job'])): ?>
                                    <td width="90"><p><?=$job_key;?></p></td>
                                <?php endif ?>
                                
                                <?php if(!empty($column_name['Repeat Job No'])): ?>
                                    <td width="80"><p><?=$row['repeat_job_no'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Sample Req. No'])): ?>
                                    <td width="80"><p><?=$row['req_no'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Style Ref'])): ?>
                                    <td width="80"><p><?=$row['style'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Style Desc'])): ?>
                                    <td width="80"><p><?=$row['style_des'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Gmts Item'])): ?>
                                    <td width="80">
                                        <p>
                                            <?
                                            $item_id_arr = array_unique(array_filter(explode(",", $row['item_id'])));
                                            $item_name = "";
                                            foreach ($item_id_arr as $val) 
                                            {
                                                $item_name .= ($item_name=="") ? $garments_item[$val] : ", ".$garments_item[$val];
                                            }
                                            echo $item_name;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Season'])): ?>
                                    <td width="80"><p><?=$season_library[$row['season']];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Prod Dept'])): ?>
                                    <td width="80"><p><?=$product_dept[$row['product_dept']];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Prod. Dept Code / Class'])): ?>
                                    <td width="80"><p><?=$row['product_code'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Sub Dept'])): ?>
                                    <td width="80"><p><?=$sub_dep_library[$row['pro_sub_dep']];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Brand'])): ?>
                                    <td width="80"><p><?=$brand_library[$row['brand_id']];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Region'])): ?>
                                    <td width="80"><p><?=$region[$row['region']];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Prod. Catg'])): ?>
                                    <td width="80"><p><?=$product_category[$row['product_category']];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Country'])): ?>
                                    <td width="80">
                                        <p>
                                            <?
                                            $country_id_arr = array_unique(array_filter(explode(",", $row['country_id'])));
                                            $country_name = "";
                                            foreach ($country_id_arr as $val) 
                                            {
                                                $country_name .= ($country_name=="") ? $country_library[$val] : ", ".$country_library[$val];
                                            }
                                            echo $country_name;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Sustainability Standard'])): ?>
                                    <td width="80"><p><?=$sustainability_standard[$row['sustainability_standard']];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Fabric Material'])): ?>
                                    <td width="80"><p><?=$fab_material[$row['fab_material']];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Order Nature'])): ?>
                                    <td width="80"><p><?=$fbooking_order_nature[$row['quality_level']];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Quality Label'])): ?>
                                    <td width="80"><p><?=$quality_label[$row['qlty_label']];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Embilshement Name'])): ?>
                                    <td width="80"><p><?=$emb_name_arr[$job_key];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Service Name'])): ?>
                                    <td width="80"><p><?=$conv_name_arr[$job_key];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Order/PO No'])): ?>
                                    <td width="80">
                                        <p>
                                            <?
                                            $po_number_arr = array_unique(array_filter(explode(",", $row['po_number'])));
                                            $po_name = "";
                                            foreach ($po_number_arr as $val) 
                                            {
                                                $po_name .= ($po_name=="") ? $val : ", ".$val;
                                            }
                                            echo $po_name;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Actual Order/PO No'])): ?>
                                    <td width="80"><p><?=$acc_po_array[$job_key]['acc_po'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['GMT Color'])): ?>
                                    <td width="80">
                                        <p>
                                            <?
                                            $color_arr = array_unique(array_filter(explode(",", $row['color_id'])));
                                            $color_name = "";
                                            foreach ($color_arr as $val) 
                                            {
                                                $color_name .= ($color_name=="") ? $color_library[$val] : ", ".$color_library[$val];
                                            }
                                            echo $color_name;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Size'])): ?>
                                    <td width="80">
                                        <p>
                                            <?
                                            $size_arr = array_unique(array_filter(explode(",", $row['size_id'])));
                                            $size_name = "";
                                            foreach ($size_arr as $val) 
                                            {
                                                $size_name .= ($size_name=="") ? $size_library[$val] : ", ".$size_library[$val];
                                            }
                                            echo $size_name;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Ex Cut %'])): ?>
                                    <td width="80">
                                        <p>
                                            <?
                                            $excess_cut_arr = array_unique(array_filter(explode("**", $po_wise_data[$job_key]['excess_cut'])));
                                            $ex_cut = "";
                                            foreach ($excess_cut_arr as $val) 
                                            {
                                                $ex_cut .= ($ex_cut=="") ? "(".$val.")" : ",(".$val.")";
                                            }
                                            echo $ex_cut;
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Order Qnty [Pcs]'])): ?>
                                    <td width="80" align="right"><p><?=number_format($row['job_qty_pcs'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Break Down Order Qnty [Pcs]'])): ?>
                                    <td width="80" align="right"><p><?=number_format($row['order_quantity'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Order Qnty with Cut% [Pcs]'])): ?>
                                    <td width="80" align="right"><p><?=number_format($row['plan_cut_qnty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Order Qnty [Uom]'])): ?>
                                    <td width="80" align="right"><p><?=number_format($row['po_quantity'],0);?></p></td>
                                <?php endif ?>
                                <?php if(array_key_exists('Uom', $column_name)): ?>
                                    <td width="80" align="center"><p><?=$unit_of_measurement[$row['order_uom']];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Per Unit Price'])): ?>
                                    <td width="80" align="right"><p><?=$row['unit_price'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Order Value'])): ?>
                                    <td width="80" align="right"><p><?=number_format($row['order_value'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['PO Insert Date'])): ?>
                                    <td width="80" align="center"><p><?=$row['po_insert_date'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['PO Receive Date'])): ?>
                                    <td width="80" align="center"><p><?=$row['po_received_date'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Factory Receive Date'])): ?>
                                    <td width="80" align="center"><p><?=$row['factory_received_date'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['1st Cut Date'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $lay_date_arr = array_unique(array_filter(explode(",", $lay_data_array[$job_key]['entry_date'])));
                                            $lay_date = get_max_min_date($lay_date_arr);
                                            echo ($lay_date['min_date']!="") ? change_date_format($lay_date['min_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Last Cut Date'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            echo ($lay_date['max_date']!="") ? change_date_format($lay_date['max_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['1st Sew Date'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $sew_out_date_arr = array_unique(array_filter(explode(",", $gmts_data_array[$job_key][5]['date'])));
                                            $sew_out_date = get_max_min_date($sew_out_date_arr);
                                            echo ($sew_out_date['min_date']!="") ? change_date_format($sew_out_date['min_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>   
                                <?php endif ?>
                                <?php if(!empty($column_name['Last Sew Date'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            echo ($sew_out_date['max_date']!="") ? change_date_format($sew_out_date['max_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['1st Finish Date'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $gmt_fin_date_arr = array_unique(array_filter(explode(",", $gmts_data_array[$job_key][8]['date'])));
                                            $gmt_fin_date = get_max_min_date($gmt_fin_date_arr);
                                            echo ($gmt_fin_date['min_date']!="") ? change_date_format($gmt_fin_date['min_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Last Finish Date'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            echo ($gmt_fin_date['max_date']!="") ? change_date_format($gmt_fin_date['max_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Insp. Offer Date'])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Insp. Date'])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Pub. Shipment Date'])): ?>
                                    <td width="80"><p><?=$row['pub_shipment_date'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['First Shipment Date'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $ex_date_array = array_unique(array_filter(explode(",", $ex_data_array[$job_key]['ex_date'])));
                                            $ex_date = get_max_min_date($ex_date_array);
                                            // echo min($ex_date_array);
                                            echo ($ex_date['min_date']!="") ? change_date_format($ex_date['min_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Org. Shipment Date'])): ?>
                                    <td width="80"><p><?=$row['shipment_date'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['ETD/LDD Date'])): ?>
                                    <td width="80"><p><?=$row['txt_etd_ldd'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Cut-off Date'])): ?>
                                    <td width="80"><p><?=$cutup_date = implode(",", array_unique(array_filter(explode(",", $row['cutup_date']))));?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Country Shipment Date'])): ?>
                                    <td width="80"><p><?=$coun_ship_date = implode(",", array_unique(array_filter(explode(",", $row['country_ship_date']))));?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['RFI Plan Date'])): ?>
                                    <td width="80"><p><?=$row['pub_shipment_date'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Shipment Mode'])): ?>
                                    <td width="80"><p><?=$shipment_mode[$row['ship_mode']];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Lead Time'])): ?>
                                    <td width="80"><p><?=$row['lead_time'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Days in Hand'])): ?>
                                    <td width="80"><p><?=$row['days_in_hand'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Commercial File No'])): ?>
                                    <td width="80">
                                        <p>
                                            <?
                                            $com_file = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['internal_file_no']))));
                                            echo $com_file;
                                            ?>                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Lien Bank'])): ?>                                
                                    <td width="80">
                                        <p>
                                            <?
                                            $lien_bank = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['lien_bank']))));
                                            echo $lien_bank;
                                            ?>                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Ex. LC/SC Amendment NoLast'])): ?>                                
                                    <td width="80">
                                        <p>
                                            <?
                                            $amendment_no = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['amendment_no']))));
                                            echo $amendment_no;
                                            ?>                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Pay Term'])): ?>                               
                                    <td width="80">
                                        <p>
                                            <?
                                            $pay_term = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['pay_term']))));
                                            echo $pay_term;
                                            ?>                                            
                                        </p>
                                    </td>     
                                <?php endif ?>
                                <?php if(!empty($column_name['Tenor'])): ?>                               
                                    <td width="80">
                                        <p>
                                            <?
                                            $tenor = implode(",",array_unique(array_filter(explode(",",$lc_sc_data_array[$job_key]['tenor']))));
                                            echo $tenor;
                                            ?>                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['First Shipment Date'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            echo ($ex_date['min_date']!="") ? change_date_format($ex_date['min_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Last Shipment Date'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            echo ($ex_date['max_date']!="") ? change_date_format($ex_date['max_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Shipment Qnty'])): ?>
                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Shipment Value'])): ?>
                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_value'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Excess Shipment Qnty'])): ?>
                                    <td width="80" align="right"><p><?=number_format($ship_excess_qty,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Excess Shipment Value'])): ?>
                                    <td width="80" align="right"><p><?=number_format($ship_excess_val,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Short Shipment Qnty'])): ?>
                                    <td width="80" align="right"><p><?=number_format($ship_short_qty,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Short Shipment Value'])): ?>
                                    <td width="80" align="right"><p><?=number_format($ship_short_val,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Shipping Status'])): ?>
                                    <td width="80" align="center"><p><?=$row['shipment_status'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['SMV'])): ?>
                                    <td width="80" align="right"><p><?=$row['set_smv'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Total SMV'])): ?>
                                    <td width="80" align="right"><p><?=$row['set_smv'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['CM'])): ?>
                                    <td width="80"><p><?=$budget_data_array[$job_key]['cm_cost'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Team Leader'])): ?>
                                    <td width="80"><p><?=$team_library[$row['team_leader']];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Dealing Merchandiser'])): ?>
                                    <td width="80"><p><?=$merchant_library[$row['dealing_marchant']];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Factory Merchandiser'])): ?>
                                    <td width="80"><p><?=$merchant_library[$row['factory_marchant']];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Insert User'])): ?>
                                    <td width="80"><p><?=$user_library[$row['inserted_by']];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Lab Dip No'])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Buyer Sample Status'])): ?>
                                    <td width="80">
                                        <a href="javascript:void(0);" onclick="show_popup('sample_status', '<?=$job_key; ?>', '920px',1)">
                                            View
                                        </a>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Order Status'])): ?>
                                    <td width="80">
                                        <a href="javascript:void(0);" onclick="show_popup('order_status', '<?=$job_key; ?>', '320px',2)">
                                            View
                                        </a>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Referance Closed'])): ?>
                                    <td width="80">
                                        <a href="javascript:void(0);" onclick="show_popup('closing_status', '<?=$job_key; ?>', '320px',3)">
                                            View
                                        </a>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Emb. Work Order No'])): ?>
                                    <td width="80">
                                        <p>
                                            <?
                                                echo ($work_order_data_array[$job_key][1]) ? "Printing : ".$work_order_data_array[$job_key][1] : "";
                                                echo ($work_order_data_array[$job_key][2]) ? "<br>Embroidery : ".$work_order_data_array[$job_key][2] : "";
                                                echo ($work_order_data_array[$job_key][3]) ? "<br>Wash : ".$work_order_data_array[$job_key][3] : "";
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Service Work Order No'])): ?>
                                    <td width="80">
                                        <p>
                                            <?
                                                echo "AOP : ".$service_booking_data_array[$job_key]['aop'];
                                                echo "<br>Yarn Dyeing : ".$yd_work_order_data_array[$job_key];
                                                echo "<br>Knitting : ".$service_booking_data_array[$job_key]['knitting'];
                                                echo "<br>Fab. Dyeing : ".$service_booking_data_array[$job_key]['dyeing'];
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Budget Date'])): ?>
                                    <td width="80"><p><?=$budget_data_array[$job_key]['costing_date'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Budget Value'])): ?>
                                    <td width="80" align="right"><p><?=number_format($total_budget_value,2);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Open Value'])): ?>
                                    <td width="80" align="right"><p><?=number_format($open_value,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Approved'])): ?>
                                    <td width="80"><p><?=($budget_data_array[$job_key]['approved']==1) ? "Approved" : "Not Approved";?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Amendment No'])): ?>
                                    <td width="80"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['M Fabric Booking Date'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $booking_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['booking_date'])));
                                            $booking_date = "";
                                            foreach ($booking_date_arr as $val) 
                                            {
                                                $booking_date .= ($booking_date=="") ? $val : ", ".$val;
                                            }
                                            echo $booking_date;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['M Fabric Booking No'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $booking_no_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['booking_no'])));
                                            $booking_no = "";
                                            foreach ($booking_no_arr as $val) 
                                            {
                                                $booking_no .= ($booking_no=="") ? $val : ", ".$val;
                                            }
                                            echo $booking_no;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Fabric Delivery Date'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $delivery_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['delivery_date'])));
                                            $delivery_date = "";
                                            foreach ($delivery_date_arr as $val) 
                                            {
                                                $delivery_date .= ($delivery_date=="") ? $val : ", ".$val;
                                            }
                                            echo $delivery_date;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Amendment No'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $revised_no_arr = array_unique(explode(",", $booking_data_array[$job_key][1][2]['revised_no']));
                                            $revised_no = "";
                                            foreach ($revised_no_arr as $val) 
                                            {
                                                $revised_no .= ($revised_no=="") ? $val : ", ".$val;
                                            }
                                            echo $revised_no;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Amendment Date'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $revised_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['revised_date'])));
                                            $revised_date = "";
                                            foreach ($revised_date_arr as $val) 
                                            {
                                                $revised_date .= ($revised_date=="") ? $val : ", ".$val;
                                            }
                                            echo $revised_date;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Approved Status'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $is_approved_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['is_approved'])));
                                            $is_approved = "";
                                            foreach ($is_approved_arr as $val) 
                                            {
                                                $is_approved .= ($is_approved=="") ? $approval_type_arr[$val] : ", ".$approval_type_arr[$val];
                                            }
                                            echo ($is_approved=="") ? " Not Approved" : $is_approved;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Yarn Description'])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Fabric Construction'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $construction_arr = array_unique(array_filter(explode("__", $booking_data_array[$job_key][1][2]['construction'])));
                                            $construction = "";
                                            foreach ($construction_arr as $val) 
                                            {
                                                $construction .= ($construction=="") ? $val : ", ".$val;
                                            }
                                            echo $construction;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Fabric Composition'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $copmposition_arr = array_unique(array_filter(explode("__", $booking_data_array[$job_key][1][2]['copmposition'])));
                                            $copmposition = "";
                                            foreach ($copmposition_arr as $val) 
                                            {
                                                $copmposition .= ($copmposition=="") ? $val : ", ".$val;
                                            }
                                            echo $copmposition;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['GSM'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $gsm_weight_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['gsm_weight'])));
                                            $gsm_weight = "";
                                            foreach ($gsm_weight_arr as $val) 
                                            {
                                                $gsm_weight .= ($gsm_weight=="") ? $val : ", ".$val;
                                            }
                                            echo $gsm_weight;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Dia/Width'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $dia_width_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][2]['dia_width'])));
                                            $dia_width = "";
                                            foreach ($dia_width_arr as $val) 
                                            {
                                                $dia_width .= ($dia_width=="") ? $val : ", ".$val;
                                            }
                                            echo $dia_width;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Finish Quantity'])): ?>
                                    <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][2]['fin_fab_qnty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Process Loss%'])): ?>
                                    <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][2]['process_loss'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Grey Qnty Kg'])): ?>
                                    <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][2]['grey_fab_qnty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Fabric Booking Date'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $booking_date_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['booking_date'])));
                                            $booking_date = "";
                                            foreach ($booking_date_arr as $val) 
                                            {
                                                $booking_date .= ($booking_date=="") ? $val : ", ".$val;
                                            }
                                            echo $booking_date;
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Fabric Booking No'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $booking_no_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['booking_no'])));
                                            $booking_no = "";
                                            foreach ($booking_no_arr as $val) 
                                            {
                                                $booking_no .= ($booking_no=="") ? $val : ", ".$val;
                                            }
                                            echo $booking_no;
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Fabric Delivery Date'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $delivery_date_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['delivery_date'])));
                                            $delivery_date = "";
                                            foreach ($delivery_date_arr as $val) 
                                            {
                                                $delivery_date .= ($delivery_date=="") ? $val : ", ".$val;
                                            }
                                            echo $delivery_date;
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Fabrication'])): ?>                                
                                    <td width="80">
                                        <p>
                                            <?
                                            $construction_arr = array_unique(array_filter(explode("__", $pur_booking_data_array[$job_key][1]['construction'])));
                                            $construction = "";
                                            foreach ($construction_arr as $val) 
                                            {
                                                $construction .= ($construction=="") ? $val : ", ".$val;
                                            }
                                            echo $construction;
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Uom'])): ?>                                                               
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $uom_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['uom'])));
                                            $uom = "";
                                            foreach ($uom_arr as $val) 
                                            {
                                                $uom .= ($uom=="") ? $unit_of_measurement[$val] : ", ".$unit_of_measurement[$val];
                                            }
                                            echo $uom;
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Qnty'])): ?>                                                                                               
                                    <td width="80" align="right">
                                        <p>
                                            <?
                                            $fin_fab_qnty_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1]['fin_fab_qnty'])));
                                            $fin_fab_qnty = "";
                                            foreach ($fin_fab_qnty_arr as $val) 
                                            {
                                                $fin_fab_qnty .= ($fin_fab_qnty=="") ? $val : ", ".$val;
                                            }
                                            echo $fin_fab_qnty;
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name['Approved Status'])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $is_approved_arr = array_unique(array_filter(explode(",", $pur_booking_data_array[$job_key][1][2]['is_approved'])));
                                            $is_approved = "";
                                            foreach ($is_approved_arr as $val) 
                                            {
                                                $is_approved .= ($is_approved=="") ? $approval_type_arr[$val] : ", ".$approval_type_arr[$val];
                                            }
                                            echo ($is_approved=="") ? " Not Approved" : $is_approved;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $booking_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['booking_date'])));
                                            $booking_date = "";
                                            foreach ($booking_date_arr as $val) 
                                            {
                                                $booking_date .= ($booking_date=="") ? $val : ", ".$val;
                                            }
                                            echo $booking_date;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $booking_no_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['booking_no'])));
                                            $booking_no = "";
                                            foreach ($booking_no_arr as $val) 
                                            {
                                                $booking_no .= ($booking_no=="") ? $val : ", ".$val;
                                            }
                                            echo $booking_no;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $delivery_date_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['delivery_date'])));
                                            $delivery_date = "";
                                            foreach ($delivery_date_arr as $val) 
                                            {
                                                $delivery_date .= ($delivery_date=="") ? $val : ", ".$val;
                                            }
                                            echo $delivery_date;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $construction_arr = array_unique(array_filter(explode("__", $booking_data_array[$job_key][1][1]['construction'])));
                                            $construction = "";
                                            foreach ($construction_arr as $val) 
                                            {
                                                $construction .= ($construction=="") ? $val : ", ".$val;
                                            }
                                            echo $construction;
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $uom_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['uom'])));
                                            $uom = "";
                                            foreach ($uom_arr as $val) 
                                            {
                                                $uom .= ($uom=="") ? $unit_of_measurement[$val] : ", ".$unit_of_measurement[$val];
                                            }
                                            echo $uom;
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>                                
                                    <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][1]['fin_fab_qnty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][1]['process_loss'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($booking_data_array[$job_key][1][1]['grey_fab_qnty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>                                
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $is_approved_arr = array_unique(array_filter(explode(",", $booking_data_array[$job_key][1][1]['is_approved'])));
                                            $is_approved = "";
                                            foreach ($is_approved_arr as $val) 
                                            {
                                                $is_approved .= ($is_approved=="") ? $approval_type_arr[$val] : ", ".$approval_type_arr[$val];
                                            }
                                            echo ($is_approved=="") ? " Not Approved" : $is_approved;
                                            ?>
                                            
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><a href="javascript:void(0);">View</a></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['grey_fab_qnty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($yarn_allocation_array[$job_key][2],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($booking_qty_array[$job_key]['grey_fab_qnty']-$yarn_allocation_array[$job_key][2]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($textile_data_array[$job_key][3],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($booking_qty_array[$job_key]['grey_fab_qnty']-$textile_data_array[$job_key][3]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($booking_qty_array[$job_key]['grey_fab_qnty']-$textile_data_array[$job_key][3]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($yarn_allocation_array[$job_key][1],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($booking_qty_array[$job_key]['grey_fab_qnty']-$yarn_allocation_array[$job_key][1]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($yarn_rcv_from_dyeing_array[$job_key],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($dyed_yarn_issue_array[$job_key],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>


                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>


                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['grey_fab_qnty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($program_data_array[$job_key],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($booking_qty_array[$job_key]['grey_fab_qnty']-$program_data_array[$job_key]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($knitting_data_array[$job_key][1],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($knitting_data_array[$job_key][3],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($knitting_data_array[$job_key][1]+$knitting_data_array[$job_key][3]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($knitting_data_array[$job_key][1]-$knitting_data_array[$job_key][3]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($knitting_data_array[$job_key][1]-$knitting_data_array[$job_key][3]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][56],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>


                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['grey_fab_qnty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][58],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($booking_qty_array[$job_key]['grey_fab_qnty'] - $roll_data_array[$job_key][58]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($booking_qty_array[$job_key]['grey_fab_qnty'] - $roll_data_array[$job_key][58]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][82][5],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($roll_data_array[$job_key][58]+$transfer_data_array[$job_key][82][5]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][61],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][82][6],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($roll_data_array[$job_key][61]+$transfer_data_array[$job_key][82][6]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format((($roll_data_array[$job_key][58]+$transfer_data_array[$job_key][82][5]) -($roll_data_array[$job_key][61]+$transfer_data_array[$job_key][82][6])) ,0);?></p></td>
                                <?php endif ?>


                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['fin_fab_qnty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($textile_data_array[$job_key][62],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][64],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($fab_dyeing_array[$job_key],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($textile_data_array[$job_key][62] - $fab_dyeing_array[$job_key]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($textile_data_array[$job_key][62] - $fab_dyeing_array[$job_key]),0);?></p></td>
                                <?php endif ?>


                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['fin_fab_qnty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($textile_data_array[$job_key][66],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($booking_qty_array[$job_key]['fin_fab_qnty'] - $textile_data_array[$job_key][66]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($fab_dyeing_array[$job_key] - $textile_data_array[$job_key][66]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][63],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][65],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($roll_data_array[$job_key][63] - $roll_data_array[$job_key][65]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][67],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>




                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($booking_qty_array[$job_key]['fin_fab_qnty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($roll_data_array[$job_key][68],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($booking_qty_array[$job_key]['fin_fab_qnty']-$roll_data_array[$job_key][68]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($booking_qty_array[$job_key]['fin_fab_qnty']-$roll_data_array[$job_key][68]),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][134][5],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][134][5],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($textile_data_array[$job_key][71],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][134][6],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($transfer_data_array[$job_key][134][6],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($roll_data_array[$job_key][68] - $textile_data_array[$job_key][71]),0);?></p></td>
                                <?php endif ?>




                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($fin_fab_data_array[$job_key]['qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($row['job_qty_pcs'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($row['plan_cut_qnty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($lay_data_array[$job_key]['no_of_bndl'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($lay_data_array[$job_key]['qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][1]['qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($row['job_qty_pcs']-$gmts_data_array[$job_key][1]['qty']),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($row['job_qty_pcs']-$gmts_data_array[$job_key][1]['qty']),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][4]['qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($embel_data_array[$job_key][2][1]['qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($embel_data_array[$job_key][3][1]['qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="left"><p><?=number_format($company_library[$embel_data_array[$job_key][2][1]['wo_com_id']],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($embel_data_array[$job_key][2][2]['qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($embel_data_array[$job_key][3][2]['qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="left"><p><?=$company_library[$embel_data_array[$job_key][2][2]['wo_com_id']];?></p></td>
                                <?php endif ?>





                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($emb_qty_job_name_arr[$job_key][1],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($print_emb_order_data_array[$job_key][204]['qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>




                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($emb_qty_job_name_arr[$job_key][2],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($print_emb_order_data_array[$job_key][311]['qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>




                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($row['job_qty_pcs'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][4]['qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($row['plan_cut_qnty']-$gmts_data_array[$job_key][4]['qty']),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][4]['qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][5]['qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($row['plan_cut_qnty']-$gmts_data_array[$job_key][5]['qty']),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($row['plan_cut_qnty']-$gmts_data_array[$job_key][5]['qty']),0);?></p></td>
                                <?php endif ?>



                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($row['job_qty_pcs'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][7]['qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][11]['qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($gmts_data_array[$job_key][8]['qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($row['plan_cut_qnty']-$gmts_data_array[$job_key][8]['qty']),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=$buyer_insp_data[$job_key]['date'];?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($buyer_insp_data[$job_key]['qty'],0);?></p></td>
                                <?php endif ?>




                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['cartot_qnty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($invice_data[$job_key]['inv_qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_value'],2);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($invice_data[$job_key]['inv_value'],2);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($row['job_qty_pcs']-$ex_data_array[$job_key]['ex_qty']),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($row['total_price']-$ex_data_array[$job_key]['ex_value']),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($row['job_qty_pcs']-$ex_data_array[$job_key]['ex_qty']),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format(($row['total_price']-$ex_data_array[$job_key]['ex_value']),0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['rtn_qty'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($ex_data_array[$job_key]['ex_rtn_value'],0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $ex_data_array = array_unique(array_filter(explode(",", $ex_data_array[$job_key]['ex_date'])));
                                            $ex_date = get_max_min_date($ex_data_array);
                                            echo ($ex_date['min_date']!="") ? change_date_format($ex_date['min_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="center">
                                        <p>
                                            <?
                                            $ex_data_array = array_unique(array_filter(explode(",", $ex_data_array[$job_key]['ex_date'])));
                                            $ex_date = get_max_min_date($ex_data_array);
                                            echo ($ex_date['max_date']!="") ? change_date_format($ex_date['max_date']) : "";
                                            ?>                                        
                                        </p>
                                    </td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80" align="right"><p><?=number_format($a,0);?></p></td>
                                <?php endif ?>





                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>





                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                <?php if(!empty($column_name[''])): ?>
                                    <td width="80"><p><?=$a;?></p></td>
                                <?php endif ?>
                                
                            </tr>
                            <?
                            $i++;
                            $gr_job_total += $row['job_qty_pcs'];
                            $gr_po_total += $row['order_quantity'];
                            $gr_color_size_total += $row['po_quantity'];
                            $gr_plan_cut_total += $row['plan_cut_qnty'];
                            $gr_order_value_total += $row['order_value'];
                        }
                        unset($data_array);
                        ?>                        
                    </tbody>
                </table>
            </div>
            <!-- =============================== report footer ================================ -->
            <table cellspacing="0" border="1" class="rpt_table"   rules="all" width="<?=$tbl_width;?>"  align="center">
                <tfoot>                    
                    <tr>
                        <?php if(!empty($column_name['Sl.'])): ?>
                            <th width="30"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Order Status'])): ?>
                            <th width="60"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['LC Company'])): ?>
                            <th width="100"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Working Company'])): ?>
                            <th width="100"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Image'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Buyer'])): ?>
                            <th width="100"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Year'])): ?>
                            <th width="50"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Job'])): ?>
                            <th width="90"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Repeat Job No'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Sample Req. No'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>    
                        <?php if(!empty($column_name['Style Ref'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>

                        <?php if(!empty($column_name['Style Desc'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Gmts Item'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Season'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Prod Dept'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Prod. Dept Code / Class'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Sub Dept'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Brand'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Region'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Prod. Catg'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Country'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Sustainability Standard'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Fabric Material'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Order Nature'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Quality Label'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Embilshement Name'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Service Name'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Order/PO No'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Actual Order/PO No'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['GMT Color'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Size'])): ?>
                            <th width="80"><p></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Ex Cut %'])): ?>
                            <th width="80"><p>Grand Total</p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Order Qnty [Pcs]'])): ?>
                            <th width="80"><p><?=number_format($gr_job_total,0);?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Break Down Order Qnty [Pcs]'])): ?>
                             <th width="80"><p><?=number_format($gr_po_total,0);?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Order Qnty with Cut% [Pcs]'])): ?>
                           <th width="80"><p><?=number_format($gr_plan_cut_total,0);?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Order Qnty [Uom]'])): ?>
                            <th width="80"><p><?=number_format($gr_color_size_total,0);?></p></th>
                        <?php endif ?>
                        <?php if(array_key_exists('Uom', $column_name)): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Per Unit Price'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Order Value'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['PO Insert Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                       
                        <?php if(!empty($column_name['PO Receive Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Factory Receive Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                       <?php if(!empty($column_name['1st Cut Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Last Cut Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['1st Sew Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Last Sew Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                       <?php if(!empty($column_name['1st Finish Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Last Finish Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Insp. Offer Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Insp. Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Pub. Shipment Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['First Shipment Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Org. Shipment Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['ETD/LDD Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Cut-off Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Country Shipment Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['RFI Plan Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Shipment Mode'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Lead Time'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Days in Hand'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Commercial File No'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Lien Bank'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                       <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Ex. LC/SC Amendment NoLast'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Pay Term'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Tenor'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['First Shipment Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Last Shipment Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Shipment Qnty'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Shipment Value'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Excess Shipment Qnty'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Excess Shipment Value'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Short Shipment Qnty'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Short Shipment Value'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Shipping Status'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['SMV'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Total SMV'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                       <?php if(!empty($column_name['CM'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Team Leader'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Dealing Merchandiser'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Factory Merchandiser'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Insert User'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Lab Dip No'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Buyer Sample Status'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Order Status'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Referance Closed'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Emb. Work Order No'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Service Work Order No'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Budget Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name['Budget Value'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Open Value'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Approved'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Amendment No'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['M Fabric Booking Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name['M Fabric Booking No'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Fabric Delivery Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Amendment No'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Amendment Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Approved Status'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Yarn Description'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Fabric Construction'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Fabric Composition'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['GSM'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Dia/Width'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Finish Quantity'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Process Loss%'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Grey Qnty Kg'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Fabric Booking Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>





                        <?php if(!empty($column_name['Fabric Booking No'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Fabric Delivery Date'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Fabrication'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Uom'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Qnty'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name['Approved Status'])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>


                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                           <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>




                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>




                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>




                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>




                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>




                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>




                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>




                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>



                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>




                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>




                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>




                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        <?php if(!empty($column_name[''])): ?>
                            <th width="80"><p><?=$a;?></p></th>
                        <?php endif ?>
                        
                    </tr>
                </tfoot>
            </table>
        </div>        
    </fieldset>
    <script type="text/javascript">
        // $("#zoom").elevateZoom({easing : true});
    </script>
    <? 

    foreach (glob("$user_id*.xls") as $filename) 
    {
        if( @filemtime($filename) < (time()-$seconds_old) )
        @unlink($filename);
    }
    //---------end------------//
    $name=time();
    $filename=$user_id."_".$name.".xls";
    $create_new_doc = fopen($filename, 'w');
    $is_created = fwrite($create_new_doc,ob_get_contents());
    //$filename=$user_id."_".$name.".xls";
    echo "$total_data####$filename";  
}
 
if($action=="fb_approval_status")
{
    extract($_REQUEST);
    $data = explode("__", $job_number); 
    $job_number = $data[0];                     
    $fabric_source = 1; 

    $lib_designation_arr=return_library_array(" SELECT id,custom_designation from lib_designation","id","custom_designation");
    $user_lib_designation_arr=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
    $user_lib_name_arr=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
    $booking_id_arr=return_library_array("SELECT a.id,a.id from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no and a.status_active=1 and a.booking_type=1 and a.is_short=2 and a.fabric_source=$fabric_source and b.job_no='$job_number'", "id", "id");
    // print_r($booking_id_arr);die();

    $mst_ids=implode(",", $booking_id_arr);
    $unapprove_data_array=sql_select("SELECT b.approved_by,b.approved_date,b.un_approved_reason,b.un_approved_date,b.approved_no from   approval_history b where b.mst_id in($mst_ids) and b.entry_form=7  order by b.approved_date,b.approved_by");


    if(count($unapprove_data_array)>0)
    {
        $sql_unapproved=sql_select("SELECT booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=7 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id in($mst_ids)");
        $unapproved_request_arr=array();
        foreach($sql_unapproved as $rowu)
        {
            $unapproved_request_arr[$rowu[csf('booking_id')]]=$rowu[csf('approval_cause')];
        }
        ?>
       <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>
                <tr style="border:1px solid black;">
                    <th colspan="6" style="border:1px solid black;">Approval/Un Approval History</th>
                    </tr>
                    <tr style="border:1px solid black;">
                    <th width="3%" style="border:1px solid black;">Sl</th>
                    <th width="30%" style="border:1px solid black;">Name</th>
                    <th width="20%" style="border:1px solid black;">Designation</th>
                    <th width="5%" style="border:1px solid black;">Approval Status</th>
                    <th width="20%" style="border:1px solid black;">Reason For Un Approval</th>
                    <th width="22%" style="border:1px solid black;"> Date</th>

                </tr>
            </thead>
            <tbody>
            <?
            $i=1;
            foreach($unapprove_data_array as $row)
            {

                ?>
                <tr style="border:1px solid black;">
                    <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
                    <td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
                    <td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
                    <td width="5%" style="border:1px solid black; text-align:center"><? echo 'Yes';?></td>
                    <td width="20%" style="border:1px solid black;"><? echo '';?></td>
                    <td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); else echo "";?></td>
                </tr>
                <?
                $i++;
                $un_approved_date= explode(" ",$row[csf('un_approved_date')]);
                $un_approved_date=$un_approved_date[0];
                if($db_type==0) //Mysql
                {
                    if($un_approved_date=="" || $un_approved_date=="0000-00-00") $un_approved_date="";else $un_approved_date=$un_approved_date;
                }
                else
                {
                    if($un_approved_date=="") $un_approved_date="";else $un_approved_date=$un_approved_date;
                }

                if($un_approved_date!="")
                {
                    ?>
                    <tr style="border:1px solid black;">
                        <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
                        <td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
                        <td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
                        <td width="5%" style="border:1px solid black;text-align:center;"><? echo 'No';?></td>
                        <td width="20%" style="border:1px solid black;text-align:center"><? echo $unapproved_request_arr[$mst_id];?></td>
                        <td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('un_approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('un_approved_date')])); else echo "";?></td>
                    </tr>

                    <?
                    $i++;
                }

            }
            ?>
            </tbody>
        </table>
        <?
    }
    exit();
}

if($action=="work_order_details")
{
    echo load_html_head_contents("Order Tracking Report", "../../../../", 1, 1, $unicode, 1, 1);
    extract($_REQUEST);
    // $data = explode("__", $job_number); 
    // $job_number = $data[0];                     
    // $fabric_source = $data[1]; 

    
    $supplier_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');

    $sql="SELECT a.id, a.booking_no_prefix_num as wo_no,a.booking_date,a.supplier_id,a.item_category,b.construction,a.uom,b.fin_fab_qnty as wo_qnty,b.rate, b.amount from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_fabric_cost_dtls c where a.id=b.booking_mst_id and a.status_active=1 and a.booking_type=1 and a.is_short=2 and c.id=b.pre_cost_fabric_cost_dtls_id and c.job_no='$job_number' and a.entry_form=108 order by a.booking_no_prefix_num ASC";
    // echo $sql;die;
    $result = sql_select($sql);
    $booking_id_arr = array();
    foreach ($result as $val) 
    {
        $booking_id_arr[$val['ID']] = $val['ID'];
    }
    $booking_cond = where_con_using_array($booking_id_arr,0,"a.booking_id");

    // ======================= fin fab rcv qty ====================
    $sql = "SELECT a.booking_id,b.receive_qnty from inv_receive_master a, pro_finish_fabric_rcv_dtls b where a.id=b.mst_id and a.status_active=1 and b.status_active=1 and a.entry_form=37 and a.item_category=2 and a.receive_basis in(1,2) $booking_cond";
    // echo $sql;
    $res = sql_select($sql);
    $rcv_qty_arr = array();
    foreach ($res as $val) 
    {
        $rcv_qty_arr[$val['BOOKING_ID']] += $val['RECEIVE_QNTY'];
    }



    if(count($result)>0)
    {
        ?>
       <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>              
                <tr>
                    <th width="3%">Sl</th>
                    <th width="10%">WO NO</th>
                    <th width="10%">WO Date</th>
                    <th width="15%">Supplier</th>
                    <th width="15%">Item Category</th>
                    <th width="15%">Construction</th>
                    <th width="4%">UOM</th>
                    <th width="7%">WO Qnty</th>
                    <th width="7%">Unit Price</th>
                    <th width="7%">WO Amount</th>
                    <th width="7%"> MRR Qty</th>
                </tr>
            </thead>
            <tbody>
            <?
            $i=1;
            $total_wo_qty = 0;
            $total_amount = 0;
            $total_mrr_qty = 0;
            foreach($result as $row)
            {
                ?>
                <tr>
                    <td><?=$i;?></td>
                    <td><?=$row['WO_NO'];?></td>
                    <td><?=$row['BOOKING_DATE'];?></td>
                    <td><?=$supplier_arr[$row['SUPPLIER_ID']];?></td>
                    <td><?=$item_category[$row['ITEM_CATEGORY']];?></td>
                    <td><?=$row['CONSTRUCTION'];?></td>
                    <td><?=$unit_of_measurement[$row['UOM']];?></td>
                    <td align="right"><?=number_format($row['WO_QNTY'],2);?></td>
                    <td align="right"><?=$row['RATE'];?></td>
                    <td align="right"><?=number_format($row['AMOUNT'],2);?></td>
                    <td align="right"><?=number_format($rcv_qty_arr[$row['ID']],2);?></td>
                </tr>
                <?
                $i++;
                $total_wo_qty += $row['WO_QNTY'];
                $total_amount += $row['AMOUNT'];
                $total_mrr_qty += $rcv_qty_arr[$row['ID']];

            }
            ?>
            </tbody>
            <tfoot>
                <tr>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th></th>
                    <th>Total</th>
                    <th><?=number_format($total_wo_qty,2);?></th>
                    <th></th>
                    <th><?=number_format($total_amount,2);?></th>
                    <th><?=number_format($total_mrr_qty,2);?></th>
                </tr>
            </tfoot>
        </table>
        <?
    }
    exit();
}

if($action=="trims_acc_status_popup")
{
    echo load_html_head_contents("Order Tracking Report", "../../../../", 1, 1, $unicode, 1, 1);
    extract($_REQUEST);
    // $data = explode("__", $job_number); 
    // $job_number = $data[0];                     
    // $fabric_source = $data[1]; 

    $costing_per_sql=sql_select("SELECT JOB_NO,COSTING_PER from wo_pre_cost_mst where job_no='$job_number'");
    $costing_per_arr=array();
    foreach($costing_per_sql as $cost_val)
    {
        $costing_per_arr[$cost_val['JOB_NO']] = $cost_val['COSTING_PER'];
    }
    unset($costing_per_sql);

    $gmtsitemRatioArray = array();
    $gmtsitemRatioSql=sql_select("SELECT a.job_no AS JOB_NO,b.gmts_item_id AS GMTS_ITEM_ID ,b.set_item_ratio AS SET_ITEM_RATIO from wo_po_details_master a, wo_po_details_mas_set_details b where 1=1 and a.id=b.job_id and job_no='$job_number'");
    foreach($gmtsitemRatioSql as $gmtsitemRatioSqlRow)
    {
        $gmtsitemRatioArray[$gmtsitemRatioSqlRow['JOB_NO']][$gmtsitemRatioSqlRow['GMTS_ITEM_ID']]=$gmtsitemRatioSqlRow['SET_ITEM_RATIO'];    
    }
    unset($gmtsitemRatioSql);
    // echo "<pre>";print_r($gmtsitemRatioArray);die();

    $lib_item_group_name = return_library_array("select id,item_name from lib_item_group", "id", "item_name");
    $lib_supplier = return_library_array("select id,short_name from lib_supplier", "id", "short_name");

    $sql = "SELECT a.id as job_id, a.job_no AS JOB_NO,a.style_ref_no as STYLE,a.total_set_qnty AS TOTAL_SET_QNTY,b.id AS PO_ID,b.grouping as INT_REF,c.item_number_id AS ITEM_NUMBER_ID, c.order_quantity AS ORDER_QUANTITY ,c.plan_cut_qnty AS PLAN_CUT_QNTY,d.trim_group AS TRIM_GROUP,d.CONS_UOM,e.cons AS CONS from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c, wo_pre_cost_trim_cost_dtls d, wo_pre_cost_trim_co_cons_dtls e where 1=1 and a.id=b.job_id and b.id=c.po_break_down_id and a.id=d.job_id and d.id=e.wo_pre_cost_trim_cost_dtls_id and b.id=e.po_break_down_id and c.item_number_id= e.item_number_id and c.color_number_id=e.color_number_id and c.size_number_id=e.size_number_id and e.cons>0 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 and d.is_deleted=0 and d.status_active=1 and e.is_deleted=0 and e.status_active=1 and a.job_no='$job_number' order by b.grouping";
    // echo $sql;die;
    $sqlRes = sql_select($sql);
    if(count($sqlRes)==0)
    {
        echo '<div style="text-align: center;color: red;font-weight: bold;font-size: 20px;">Data not found.</div>';die();
    }
    $job_id_arr = array();
    $item_number_id_arr = array();
    $item_group_id_arr = array();
    foreach ($sqlRes as $row) 
    {
        $job_id_arr[$row['JOB_ID']] = $row['JOB_ID'];
        $item_number_id_arr[$row['ITEM_NUMBER_ID']] = $row['ITEM_NUMBER_ID'];
        $item_group_id_arr[$row['TRIM_GROUP']] = $row['TRIM_GROUP'];
    }

    $job_id_cond = where_con_using_array($job_id_arr,0,"a.id");
    $item_id_cond = where_con_using_array($item_number_id_arr,0,"b.gmts_item_id");
    $item_group_cond = where_con_using_array($item_group_id_arr,0,"id");

    // ============================ gmtsitemRatioArray ==========================
    $gmtsitemRatioArray = array();
    $gmtsitemRatioSql=sql_select("SELECT a.job_no AS JOB_NO,b.gmts_item_id AS GMTS_ITEM_ID ,b.set_item_ratio AS SET_ITEM_RATIO from wo_po_details_master a, wo_po_details_mas_set_details b where 1=1 and a.id=b.job_id and a.job_no='$job_number'");//  $job_id_cond $item_id_cond
    foreach($gmtsitemRatioSql as $gmtsitemRatioSqlRow)
    {
        $gmtsitemRatioArray[$gmtsitemRatioSqlRow['JOB_NO']][$gmtsitemRatioSqlRow['GMTS_ITEM_ID']]=$gmtsitemRatioSqlRow['SET_ITEM_RATIO'];    
    }
    unset($gmtsitemRatioSql);

    // ============================ item category =========================
    $item_cat_arr = return_library_array("SELECT id,item_category from lib_item_group where status_active=1 $item_group_cond", "id", "item_category");

    $poIdArray = array();
    $dataArray = array();
    foreach ($sqlRes as $row) 
    {
        $reqQty = 0;
        $costingPer = $costing_per_arr[$row['JOB_NO']];            
        if($costingPer==1) $pcs_value=1*12;
        else if($costingPer==2) $pcs_value=1*1;
        else if($costingPer==3) $pcs_value=2*12;
        else if($costingPer==4) $pcs_value=3*12;
        else if($costingPer==5) $pcs_value=4*12;
        $gmtsitemRatio = $gmtsitemRatioArray[$row['JOB_NO']][$row['ITEM_NUMBER_ID']];
        $reqQty = ($row['ORDER_QUANTITY']/$gmtsitemRatio)*($row['CONS']/$pcs_value);
        // echo "(".$row['ORDER_QUANTITY']."/".$gmtsitemRatio.")*(".$row['CONS']."/".$pcs_value.")<br>";
        $tgroup = strtolower($lib_item_group_name[$row['TRIM_GROUP']]);
        $category = strtolower($item_category[$item_cat_arr[$row['TRIM_GROUP']]]);

        $dataArray[$category][$tgroup]['trim_group'] = $row['TRIM_GROUP'];       
        $dataArray[$category][$tgroup]['req_qty'] += $reqQty;   
        $dataArray[$category][$tgroup]['cons_uom'] = $row['CONS_UOM'];  

        $poIdArray[$row['PO_ID']] = $row['PO_ID'];
    }
    // echo "<pre>";print_r($dataArray);die();
    $poIDS = implode(",", $poIdArray);
    $po_id_list_arr=array_chunk($poIdArray,999);

    $poCon = " and ";$poCon2 = " and ";$poCon3 = " and ";
    $p=1;
    foreach($po_id_list_arr as $po_process)
    {
        if($p==1) $poCon .="  ( c.po_break_down_id in(".implode(',',$po_process).")"; 
        else  $poCon .=" or c.po_break_down_id in(".implode(',',$po_process).")";
        

        if($p==1) $poCon2 .="  ( c.po_breakdown_id in(".implode(',',$po_process).")"; 
        else  $poCon2 .=" or c.po_breakdown_id in(".implode(',',$po_process).")"; 
        
        if($p==1) $poCon3 .="  ( e.id in(".implode(',',$po_process).")"; 
        else  $poCon3 .=" or e.id in(".implode(',',$po_process).")";         
        
        $p++;
    }
    $poCon .=")";$poCon2 .=")";$poCon3 .=")";
    /*======================================================================================/
    /                                    trims booking qty                                  /
    /======================================================================================*/
    $sqlTrims = "SELECT a.booking_no_prefix_num as BOOKING_NUM,a.BOOKING_NO,a.id as BOOKING_ID,d.job_no as JOB_NO,e.grouping as INT_REF, c.po_break_down_id as PO_ID,b.trim_group as TRIM_GROUP, sum(case when a.is_short=2 then c.requirment else 0 end) as QTY, sum(case when a.is_short=1 then c.requirment else 0 end) as SHOR_QTY, max(a.booking_date) as BOOKING_DATE,a.SUPPLIER_ID,c.rate,sum(c.amount) as amount FROM wo_booking_mst a,wo_booking_dtls b,wo_trim_book_con_dtls c,wo_po_details_master d,wo_po_break_down e WHERE a.booking_no=b.booking_no and b.booking_no=c.booking_no and b.id=c.wo_trim_booking_dtls_id and d.id=e.job_id and c.po_break_down_id=e.id $poCon and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.entry_form in(87,262)  and a.item_category=4 and a.booking_type=2  group by a.booking_no_prefix_num,a.id,a.booking_no,d.job_no,e.grouping,b.trim_group,a.supplier_id,c.po_break_down_id,c.rate ";
    // echo $sqlTrims;die();
    $trimsRes = sql_select($sqlTrims);
    $tbArray = array();
    $bookingDataArray = array();
    foreach ($trimsRes as  $val) 
    {
        $tgroup = strtolower($lib_item_group_name[$val['TRIM_GROUP']]);
        $category = strtolower($item_category[$item_cat_arr[$val['TRIM_GROUP']]]);
        $bookingDataArray[$category][$tgroup]['book_qty'] += $val['QTY'];
        $bookingDataArray[$category][$tgroup]['short_book_qty'] += $val['SHOR_QTY'];
        $bookingDataArray[$category][$tgroup]['booking_date'] = $val['BOOKING_DATE'];
        $bookingDataArray[$category][$tgroup]['supplier_id'] .= $val['SUPPLIER_ID'].",";
        $bookingDataArray[$category][$tgroup]['booking_num'] .= $val['BOOKING_NUM'].",";
        $bookingDataArray[$category][$tgroup]['booking_no'] = $val['BOOKING_NO'];
        $bookingDataArray[$category][$tgroup]['rate'] = $val['RATE'];
        $bookingDataArray[$category][$tgroup]['amount'] += $val['AMOUNT'];
        $tbArray[$val['BOOKING_ID']] = $val['BOOKING_ID'];
    }
    // echo "<pre>";print_r($bookingDataArray);die();
    $trimsBoingIds = implode(",", $tbArray);
    $tb_id_list_arr=array_chunk($tbArray,999);

    $tbCon = " and ";
    $p=1;
    foreach($tb_id_list_arr as $tb_process)
    {
        if($p==1) $tbCon .="  ( b.work_order_id in(".implode(',',$tb_process).")"; 
        else  $tbCon .=" or b.work_order_id in(".implode(',',$tb_process).")";       
        
        $p++;
    }
    $tbCon .=")";

    /*======================================================================================/
    /                                    trims receive qty                                  /
    /======================================================================================*/
    $sqlacc = "SELECT a.receive_date, d.job_no as JOB_NO,e.grouping as INT_REF, B.ITEM_GROUP_ID as TRIM_GROUP,c.quantity AS QNTY,c.reject_qty as REJ_QTY FROM inv_receive_master a,inv_trims_entry_dtls b,order_wise_pro_details c,wo_po_details_master d,wo_po_break_down e where a.id=b.mst_id and b.id=c.dtls_id and c.trans_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.entry_form=24 AND c.entry_form = 24 AND c.entry_form = 24 and a.item_category=4 and d.id=e.job_id and c.po_breakdown_id=e.id $poCon2";
    // echo $sqlacc;die();
    $accRes = sql_select($sqlacc);
    $trimsDataArray = array();
    foreach ($accRes as $val) 
    {
        $tgroup = strtolower($lib_item_group_name[$val['TRIM_GROUP']]);
        $category = strtolower($item_category[$item_cat_arr[$val['TRIM_GROUP']]]);
        $trimsDataArray[$category][$tgroup]['rcv_qty'] += $val['QNTY'];
        $trimsDataArray[$category][$tgroup]['rej_qty'] += $val['REJ_QTY'];
    }

    /*======================================================================================/
    /                               trims issue and rcv return                              /
    /======================================================================================*/
    $sqlacc = "SELECT d.job_no as JOB_NO,e.grouping as INT_REF,a.entry_form,a.issue_date, B.ITEM_GROUP_ID,C.QUANTITY AS QNTY FROM inv_issue_master a,inv_trims_issue_dtls b,order_wise_pro_details c,wo_po_details_master d,wo_po_break_down e where a.id=b.mst_id and b.id=c.dtls_id and c.trans_type in(2,3) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.entry_form in(25,49) AND c.entry_form in(25,49) AND c.entry_form in(25,49) and a.item_category=4 and d.id=e.job_id and c.po_breakdown_id=e.id  $poCon2";
    // echo $sqlacc;die();
    $accRes = sql_select($sqlacc);
    foreach ($accRes as $val) 
    {
        $tgroup = strtolower($lib_item_group_name[$val['ITEM_GROUP_ID']]);
        $category = strtolower($item_category[$item_cat_arr[$val['ITEM_GROUP_ID']]]);
        if($val['ENTRY_FORM']==49)
        {
            $trimsDataArray[$category][$tgroup]['rcv_rtn_qty'] += $val['QNTY'];
        }
        if($val['ENTRY_FORM']==25)
        {
            $trimsDataArray[$category][$tgroup]['issue_qty'] += $val['QNTY'];
        }
    }

    /*======================================================================================/
    /                                    trims issue return                                   /
    /======================================================================================*/
    $sqlacc = "SELECT a.receive_date, d.job_no as JOB_NO,e.grouping as INT_REF, f.item_group_id as ITEM_GROUP_ID,b.CONS_QUANTITY AS QNTY FROM inv_receive_master a,inv_transaction b,order_wise_pro_details c,wo_po_details_master d,wo_po_break_down e,product_details_master f where a.id=b.mst_id and b.id=c.trans_id and c.trans_type=4 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.entry_form=73 AND c.entry_form = 73 AND c.entry_form = 73 and a.item_category=4 and d.id=e.job_id and c.po_breakdown_id=e.id and c.prod_id=f.id  $poCon2";
    // echo $sqlacc;die();
    $accRes = sql_select($sqlacc);
    foreach ($accRes as $val) 
    {
        $tgroup = strtolower($lib_item_group_name[$val['ITEM_GROUP_ID']]);
        $category = strtolower($item_category[$item_cat_arr[$val['ITEM_GROUP_ID']]]);
        $trimsDataArray[$category][$tgroup]['issue_rtn_qty'] += $val['QNTY'];
    }
    /*======================================================================================/
    /                                    LC and   PI Infor                                  /
    /======================================================================================*/
    /*$sqlpi = "SELECT d.job_no as JOB_NO,e.grouping as INT_REF, a.ID,a.PI_DATE,b.WORK_ORDER_NO,b.ITEM_GROUP as TRIM_GROUP from com_pi_master_details a, com_pi_item_details b,wo_booking_dtls c,wo_po_details_master d,wo_po_break_down e where a.id=b.pi_id and c.booking_no=b.work_order_no and c.po_break_down_id=e.id and d.id=e.job_id $poCon3 and a.item_category_id=4";//$tbCon
    // echo $sqlpi;die();
    $piRes = sql_select($sqlpi);
    $lib_pi_rcv_date = array();
    $lib_pi_no = array();
    $piDataArray = array();
    foreach ($piRes as $val) 
    {
        $tgroup = strtolower($lib_item_group_name[$val['TRIM_GROUP']]);
        $category = strtolower($item_category[$item_cat_arr[$val['TRIM_GROUP']]]);
        $piDataArray[$category][$tgroup]['pi_date'] .= $val['PI_DATE'].",";
        $lib_pi_no[$val['ID']] = $val['ID'];
    }
    $piIds = implode(",", $lib_pi_no);
    $pi_id_list_arr=array_chunk($lib_pi_no,999);

    if($piIds !="")
    {
        $piCon = " and ";
        $p=1;
        foreach($pi_id_list_arr as $pi_process)
        {
            if($p==1) $piCon .="  ( b.pi_id in(".implode(',',$pi_process).")"; 
            else  $piCon .=" or b.pi_id in(".implode(',',$pi_process).")";       
            
            $p++;
        }
        $piCon .=")";
    }

    $lcsql = "SELECT c.ITEM_GROUP as TRIM_GROUP, d.JOB_NO,f.grouping as INT_REF,a.LC_NUMBER from com_btb_lc_master_details a,com_btb_lc_pi b,com_pi_item_details c,wo_booking_dtls d,wo_po_details_master e,wo_po_break_down f where a.id=b.com_btb_lc_master_details_id and c.pi_id=b.pi_id and c.work_order_no=d.booking_no and d.po_break_down_id=f.id and f.job_id=e.id $piCon and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
    // echo $lcsql;die();
    $lcRes = sql_select($lcsql);
    $lc_array = array();
    foreach ($lcRes as $val) 
    {
        $tgroup = strtolower($lib_item_group_name[$val['TRIM_GROUP']]);
        $category = strtolower($item_category[$item_cat_arr[$val['TRIM_GROUP']]]);
        $lc_array[$category][$tgroup]['lc_number'] .= $val['LC_NUMBER'].",";
    }*/
    /*======================================================================================/
    /                                    trims transfer                                     /
    /======================================================================================*/
    $item_group_cond = where_con_using_array($item_group_id_arr,0,"b.item_group");
    // $sql = "SELECT b.item_category,b.item_group,b.transfer_qnty from inv_item_transfer_mst a,inv_item_transfer_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form in(78,112) $item_group_cond";

    $to_order_id_con =where_con_using_array($poIdArray,0,"a.to_order_id");
    $from_order_id_con =where_con_using_array($poIdArray,0,"a.from_order_id");

    $transfer_sql_in=sql_select("SELECT a.transfer_date, b.item_category,b.item_group,b.transfer_qnty as qnty FROM inv_item_transfer_mst a, inv_item_transfer_dtls b WHERE a.id = b.mst_id   and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.item_category=4 and a.entry_form in(78,112) $to_order_id_con $item_group_cond");
    $transfer_data=array();
    foreach ($transfer_sql_in as $row) 
    {
        $transfer_data[$row[csf('item_category')]][$row[csf('item_group')]]['in']+=$row[csf('qnty')];
    }
    $transfer_sql_out=sql_select("SELECT a.transfer_date, b.item_category,b.item_group,b.transfer_qnty as qnty FROM inv_item_transfer_mst a, inv_item_transfer_dtls b WHERE a.id = b.mst_id   and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.item_category=4 and a.entry_form in(78,112)  $from_order_id_con $item_group_cond");
    foreach ($transfer_sql_out as $row) 
    {
        $transfer_data[$row[csf('item_category')]][$row[csf('item_group')]]['out']+=$row[csf('qnty')];
    }
    // echo "<pre>";print_r($dataArray);die();
    if(count($dataArray)>0)
    {
        ?>
       <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>              
                <tr>
                    <th rowspan="2" width="3%">Sl</th>
                    <th rowspan="2" width="20%">Item</th>
                    <th rowspan="2" width="5%">UOM</th>
                    <th rowspan="2" width="7%">Req Qty</th>
                    <th rowspan="2" width="7%">WO Qty</th>
                    <th width="35%" colspan="5">Received Status</th>
                    <th width="14%" colspan="2">Issue Status</th>
                    <th width="7%">Closing Status</th>
                </tr>
                <tr>
                    <th>Rate $</th>
                    <th>Amount $</th>
                    <th>Qty</th>
                    <th>%</th>
                    <th>In-house Bal</th>

                    <th>Issue Qty</th>
                    <th>%</th>

                    <th>Qty</th>
                </tr>
            </thead>
            <tbody>
            <?
            $i=1;
            $total_req_qty = 0;
            $total_wo_qty = 0;
            $total_amount = 0;
            $total_rcv_qty = 0;
            $total_rcv_inhoune_qty = 0;
            $total_issue_qty = 0;
            $total_stock = 0;
            ksort($dataArray);
            foreach ($dataArray as $trims_cat => $trimsCatData) 
            {                
                ksort($trimsCatData);                     
                foreach ($trimsCatData as $trims_group => $row) 
                {

                    $book_qty = $bookingDataArray[$trims_cat][$trims_group]['book_qty'];
                    $short_book_qty = $bookingDataArray[$trims_cat][$trims_group]['short_book_qty'];
                    $rate = $bookingDataArray[$trims_cat][$trims_group]['rate'];
                    $amount = $bookingDataArray[$trims_cat][$trims_group]['amount'];

                    $rcv_qty = $trimsDataArray[$trims_cat][$trims_group]['rcv_qty'];
                    $rej_qty = $trimsDataArray[$trims_cat][$trims_group]['rej_qty'];
                    $rcv_rtn_qty = $trimsDataArray[$trims_cat][$trims_group]['rcv_rtn_qty'];

                    $rcv_without_rtn = $rcv_qty - $rcv_rtn_qty;
                    $rcv_prsnt = ($book_qty+$short_book_qty>0) ? ($rcv_without_rtn/($book_qty+$short_book_qty))*100 : 0;
                    // echo $rcv_without_rtn."/".$book_qty."+".$short_book_qty."*100<br>";

                    $in_house_bal_qty = $book_qty+$short_book_qty - $rcv_without_rtn;

                    $issue_qty = $trimsDataArray[$trims_cat][$trims_group]['issue_qty'];
                    $issue_rtn_qty = $trimsDataArray[$trims_cat][$trims_group]['issue_rtn_qty'];
                    $issue_without_rtn_qty = $issue_qty-$issue_rtn_qty;

                    $issue_prsnt = ($book_qty+$short_book_qty>0) ? ($issue_without_rtn_qty/($book_qty+$short_book_qty))*100 : 0;

                    $totQty = $row['req_qty']+$short_book_qty;
                    $bookingBal = $totQty - ($book_qty+$short_book_qty);
                    $balQty = $totQty - $rcv_without_rtn;
                    $trans_in = $transfer_data[4][$itm_id]['in'];
                    $trans_out = $transfer_data[4][$itm_id]['out'];
                    $ovrl_bal = $totQty - ($rcv_without_rtn+$trans_in-$trans_out);

                    $stock_qty = ($rcv_qty+$issue_rtn_qty+$trans_in) - ($issue_qty+$rcv_rtn_qty+$trans_out);

                    $bgcolor=($i%2==0)?"#E9F3FF":"#FFFFFF" ;
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('trs_<? echo $i; ?>','<? echo $bgcolor; ?>')" id="trs_<? echo $i; ?>">
                        <td><?=$i;?></td>
                        <td><?=$trims_group;?></td>
                        <td><?=$unit_of_measurement[$row['cons_uom']];?></td>
                        <td align="right"><?=number_format($row['req_qty'],0);?></td>
                        <td align="right"><?=number_format(($book_qty+$short_book_qty),0);?></td>

                        <td align="right"><?=number_format($rate,2);?></td>
                        <td align="right"><?=number_format($amount,2);?></td>
                        <td align="right"><?=number_format($rcv_without_rtn,2);?></td>
                        <td align="right"><?=number_format($rcv_prsnt,2);?></td>
                        <td align="right"><?=number_format($in_house_bal_qty,2);?></td>

                        <td align="right"><?=number_format($issue_without_rtn_qty,2);?></td>
                        <td align="right"><?=number_format($issue_prsnt,2);?></td>

                        <td align="right"><?=number_format($stock_qty,2);?></td>
                    </tr>
                    <?
                    $i++;
                    
                    $total_req_qty += $row['req_qty'];
                    $total_wo_qty += $book_qty+$short_book_qty;
                    $total_amount += $amount;
                    $total_rcv_qty += $rcv_without_rtn;
                    $total_rcv_inhoune_qty += $in_house_bal_qty;
                    $total_issue_qty += $issue_without_rtn_qty;
                    $total_stock += $stock_qty;
                }

            }
            ?>
            </tbody>
            <tfoot>
                <tr>
                    <th></th>
                    <th></th>
                    <th>Total</th>
                    <th><?=number_format($total_req_qty,2);?></th>
                    <th><?=number_format($total_wo_qty,2);?></th>
                    <th></th>
                    <th><?=number_format($total_amount,2);?></th>
                    <th><?=number_format($total_rcv_qty,2);?></th>
                    <th></th>
                    <th><?=number_format($total_rcv_inhoune_qty,2);?></th>
                    <th><?=number_format($total_issue_qty,2);?></th>
                    <th></th>
                    <th><?=number_format($total_stock,2);?></th>
                </tr>
            </tfoot>
        </table>
        <?
    }
    exit();
}

if($action=="print_booking_10")
{
    extract($_REQUEST);
    $cbo_company_name=str_replace("'","",$cbo_company_name);
    $cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
    $cbo_fabric_source=2;

    $imge_arr=return_library_array( "select master_tble_id,image_location from   common_photo_library where form_name='company_details' and file_type=1",'master_tble_id','image_location');
    $company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
    $color_library=return_library_array( "select id,color_name from lib_color", "id", "color_name");
    $size_library=return_library_array( "select id,size_name from lib_size", "id", "size_name");
    $country_arr=return_library_array( "select id,country_name from   lib_country",'id','country_name');
    $supplier_name_arr=return_library_array( "select id,supplier_name from   lib_supplier",'id','supplier_name');
    //$supplier_address_arr=return_library_array( "select id,address_1 from   lib_supplier",'id','address_1');
    $marchentrArr = return_library_array("select id,team_member_name from lib_mkt_team_member_info ","id","team_member_name");
    $buyer_name_arr=return_library_array( "select id,buyer_name from lib_buyer",'id','buyer_name');
    $location_name_arr=return_library_array( "select id,location_name from lib_location",'id','location_name');
    //$po_qnty_tot=return_field_value( "sum(plan_cut)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
    //$po_qnty_tot1=return_field_value( "sum(po_quantity)", "wo_po_break_down","id in(".str_replace("'","",$txt_order_no_id).")");
    $pro_sub_dept_array=return_library_array( "select id,sub_department_name from lib_pro_sub_deparatment",'id','sub_department_name');
    $season_arr=return_library_array("select id,season_name from lib_buyer_season","id","season_name");

    $uom=0;
    $job_data_arr=array();
    $nameArray_buyer=sql_select( "SELECT  a.style_ref_no,a.style_description, a.job_no, a.style_owner, a.buyer_name, a.client_id, a.dealing_marchant, a.season, a.season_matrix, a.total_set_qnty, a.product_dept, a.product_code, a.pro_sub_dep, a.gmts_item_id, a.order_repeat_no, a.qlty_label,a.season_buyer_wise, a.factory_marchant from wo_po_details_master a, wo_booking_dtls b where a.job_no=b.job_no and b.booking_no='$txt_booking_no' and b.status_active =1 and b.is_deleted=0");

    foreach ($nameArray_buyer as $result_buy){
    $job_data_arr['job_no'][$result_buy[csf('job_no')]]=$result_buy[csf('job_no')];
    $job_data_arr['job_no_in'][$result_buy[csf('job_no')]]="'".$result_buy[csf('job_no')]."'";
    $job_data_arr['total_set_qnty'][$result_buy[csf('job_no')]]=$result_buy[csf('total_set_qnty')];
    $job_data_arr['product_dept'][$result_buy[csf('job_no')]]=$product_dept[$result_buy[csf('product_dept')]];
    $job_data_arr['product_code'][$result_buy[csf('job_no')]]=$result_buy[csf('product_code')];
    $job_data_arr['pro_sub_dep'][$result_buy[csf('job_no')]]=$pro_sub_dept_array[$result_buy[csf('pro_sub_dep')]];
    $job_data_arr['gmts_item_id'][$result_buy[csf('job_no')]]=$result_buy[csf('gmts_item_id')];
    $job_data_arr['style_ref_no'][$result_buy[csf('job_no')]]=$result_buy[csf('style_ref_no')];
    $job_data_arr['style_description'][$result_buy[csf('job_no')]]=$result_buy[csf('style_description')];
    $job_data_arr['dealing_marchant'][$result_buy[csf('job_no')]]=$marchentrArr[$result_buy[csf('dealing_marchant')]];
    $job_data_arr['factory_marchant'][$result_buy[csf('job_no')]]=$marchentrArr[$result_buy[csf('factory_marchant')]];
    $job_data_arr['season_matrix'][$result_buy[csf('job_no')]]=$season_arr[$result_buy[csf('season_matrix')]];
    $job_data_arr['season_buyer_wise'][$result_buy[csf('job_no')]]=$season_arr[$result_buy[csf('season_buyer_wise')]];
    $job_data_arr['order_repeat_no'][$result_buy[csf('job_no')]]=$result_buy[csf('order_repeat_no')];
    $job_data_arr['qlty_label'][$result_buy[csf('job_no')]]=$quality_label[$result_buy[csf('qlty_label')]];
    $job_data_arr['client'][$result_buy[csf('job_no')]]=$result_buy[csf('client_id')];
    }

    $job_no= implode(",",array_unique($job_data_arr['job_no']));
    $job_no_in= implode(",",array_unique($job_data_arr['job_no_in']));
    $product_depertment=implode(",",array_unique($job_data_arr['product_dept']));
    $product_code=implode(",",array_unique($job_data_arr['product_code']));
    $pro_sub_dep=implode(",",array_unique($job_data_arr['pro_sub_dep']));
    $gmts_item_id=implode(",",array_unique($job_data_arr['gmts_item_id']));
    $style_sting=implode(",",array_unique($job_data_arr['style_ref_no']));
    $style_description=implode(",",array_unique($job_data_arr['style_description']));
    $dealing_marchant=implode(",",array_unique($job_data_arr['dealing_marchant']));
    $factory_marchant=implode(",",array_unique($job_data_arr['factory_marchant']));
    $season_matrix=implode(",",array_unique($job_data_arr['season_matrix']));
    $season_buyer_wise=implode(",",array_unique($job_data_arr['season_buyer_wise']));
    $order_repeat_no= implode(",",array_unique($job_data_arr['order_repeat_no']));
    $qlty_label= implode(",",array_unique($job_data_arr['qlty_label']));
    $client_id= implode(",",array_unique($job_data_arr['client']));
    ?>
    <div style="width:1330px" align="center">
    <?php
    $nameArray_approved = sql_select("select max(b.approved_no) as approved_no from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=7 and a.status_active =1 and a.is_deleted=0 ");
    list($nameArray_approved_row) = $nameArray_approved;
    $nameArray_approved_date = sql_select("select b.approved_date as approved_date from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "' and a.status_active =1 and a.is_deleted=0 ");
    list($nameArray_approved_date_row) = $nameArray_approved_date;
    $nameArray_approved_comments = sql_select("select b.comments as comments from wo_booking_mst a, approval_history b where a.id=b.mst_id and booking_no='$txt_booking_no' and b.entry_form=7 and b.approved_no='" . $nameArray_approved_row[csf('approved_no')] . "' and a.status_active =1 and a.is_deleted=0 ");
    list($nameArray_approved_comments_row) = $nameArray_approved_comments;
    $path = str_replace("'", "", $path);
    if ($path != "") {
        $path = $path;
    } else {
        $path = "../../";
    }

    ?>                                      <!--    Header Company Information         -->
    <style type="text/css">
         .table_valign { vertical-align: top;word-break: break-all;word-wrap: break-word; }
    </style>
    <table width="100%" cellpadding="0" cellspacing="0" style="border:1px solid black"  >
    <tr>
    <td width="100">
    <img  src='<? echo $path.$imge_arr[$cbo_company_name]; ?>' height='100%' width='100%' />
    </td>
    <td width="1250">
    <table width="100%" cellpadding="0" cellspacing="0"  >
    <tr>
    <td align="center" style="font-size:20px;">
    <?php
    echo $company_library[$cbo_company_name];
    ?>
    </td>
    <td rowspan="3" width="250">

    <span style="font-size:18px"><b> Job No:&nbsp;&nbsp;<? echo trim($job_no,"'"); ?></b></span><br/>
    <?
    if($nameArray_approved_row[csf('approved_no')]>1)
    {
    ?>
    <b> Revised No: <? echo $nameArray_approved_row[csf('approved_no')]-1; ?></b>
    <br/>
    Approved Date: <? echo $nameArray_approved_date_row[csf('approved_date')]; ?>
    <?
    }
    ?>


    </td>
    </tr>
    <tr>
    <td align="center" style="font-size:14px">
    <?
    $nameArray=sql_select( "select plot_no,level_no,road_no,block_no,country_id,province,city,zip_code,email,website from lib_company where id=$cbo_company_name");
    if($txt_job_no!="")
    {
    $location=return_field_value( "location_name", "wo_po_details_master","job_no='$txt_job_no'");
    }
    else
    {
    $location="";
    }

    foreach ($nameArray as $result)
    {
    echo  $location_name_arr[$location];
    ?>

    Email Address: <? echo $result[csf('email')];?>
    Website No: <? echo $result[csf('website')]; ?>

    <?

    }

    ?>
    </td>
    </tr>
    <tr>
    <td align="center" style="font-size:20px">
    <strong><? if($report_title !=""){ echo $report_title;} else { echo "General Work Order";}?> &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style="color:#F00"><? if(str_replace("'","",$id_approved_id) ==1){ echo "(Approved)";}else{echo "";}; ?> </font></strong>
    </td>
    </tr>
    </table>
    </td>
    </tr>
    </table>
    <?
    $po_data=array();
    if($db_type==0){
    $nameArray_job=sql_select( "select b.job_no_mst,b.id, b.po_number,b.grouping, b.file_no, b.po_quantity,DATEDIFF(pub_shipment_date,po_received_date) date_diff,MIN(po_received_date) as po_received_date ,MIN(pub_shipment_date) as pub_shipment_date,MIN(b.insert_date) as insert_date,b.shiping_status  from wo_booking_dtls a, wo_po_break_down b where a.po_break_down_id=b.id and a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0   group by b.job_no_mst,b.id, b.po_number,b.grouping, b.file_no, b.po_quantity,pub_shipment_date,po_received_date,b.insert_date,b.shiping_status ");
    }
    if($db_type==2){
    $nameArray_job=sql_select( "SELECT b.job_no_mst,b.id, b.po_number,b.grouping, b.file_no, b.po_quantity,(pub_shipment_date-po_received_date) date_diff,MIN(po_received_date) as po_received_date,MIN(pub_shipment_date) as pub_shipment_date,MIN(b.insert_date) as insert_date,b.shiping_status, c.order_uom, c.factory_marchant   from wo_booking_dtls a, wo_po_break_down b , wo_po_details_master c where a.po_break_down_id=b.id and b.job_id = c.id and b.job_id = c.id and a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0  group by b.job_no_mst,b.id, b.po_number,b.grouping, b.file_no,pub_shipment_date,po_received_date, b.po_quantity, b.insert_date,b.shiping_status, c.order_uom, c.factory_marchant");
    }

    foreach ($nameArray_job as $result_job){
        $po_data['po_id'][$result_job[csf('id')]]=$result_job[csf('id')];
        $po_data['po_number'][$result_job[csf('id')]]=$result_job[csf('po_number')];
        $po_data['leadtime'][$result_job[csf('id')]]=$result_job[csf('date_diff')];
        $po_data['po_quantity'][$result_job[csf('id')]]=$result_job[csf('po_quantity')];
        $po_data['po_received_date'][$result_job[csf('id')]]=change_date_format($result_job[csf('po_received_date')],'dd-mm-yyyy','-');
        $ddd=strtotime($result_job[csf('pub_shipment_date')]);
        $po_data['pub_shipment_date'][$ddd]=$ddd;
        $po_data['pub_shipment_date_po'][$result_job[csf('id')]]=$result_job[csf('pub_shipment_date')];
        $po_data['insert_date'][$result_job[csf('id')]]=$result_job[csf('insert_date')];

        if($result_job[csf('shiping_status')]==1){
        $shiping_status= "FP";
        }
        else if($result_job[csf('shiping_status')]==2){
        $shiping_status= "PS";
        }
        else if($result_job[csf('shiping_status')]==3){
        $shiping_status= "FS";
        }
        $po_data['shiping_status'][$result_job[csf('id')]]=$shiping_status;
        $po_data['file_no'][$result_job[csf('id')]]=$result_job[csf('file_no')];
        $po_data['grouping'][$result_job[csf('id')]]=$result_job[csf('grouping')];
        $uom_wise_qty[$result_job[csf('order_uom')]] += $result_job[csf('po_quantity')];
    }
    $txt_order_no_id=implode(",",array_unique($po_data['po_id']));
    $leadtime=implode(",",array_unique($po_data['leadtime']));
    $po_quantity=array_sum($po_data['po_quantity']);
    $po_received_date=implode(",",array_unique($po_data['po_received_date']));
    $po_number=implode(",",array_unique($po_data['po_number']));
    $shipment_date=date('d-m-Y',min($po_data['pub_shipment_date']));
    $maxshipment_date=date('d-m-Y',max($po_data['pub_shipment_date']));
    $shiping_status=implode(",",array_unique($po_data['shiping_status']));
    $file_no=implode(",",array_unique($po_data['file_no']));
    $grouping=implode(",",array_unique($po_data['grouping']));

    $colar_excess_percent=0;
    $cuff_excess_percent=0;
    $rmg_process_breakdown=0;
    $nameArray=sql_select( "select a.buyer_id,a.booking_no,a.booking_date,a.supplier_id,a.currency_id,a.exchange_rate,a.attention,a.delivery_date,a.po_break_down_id,a.colar_excess_percent,a.cuff_excess_percent,a.delivery_date,a.is_apply_last_update,a.fabric_source,a.rmg_process_breakdown,a.insert_date,a.update_date,a.uom,a.remarks,a.pay_mode,a.fabric_composition from wo_booking_mst a  where   a.booking_no='$txt_booking_no' and a.status_active =1 and a.is_deleted=0 ");
    foreach ($nameArray as $result)
    {
        $total_set_qnty=$result[csf('total_set_qnty')];
        $colar_excess_percent=$result[csf('colar_excess_percent')];
        $cuff_excess_percent=$result[csf('cuff_excess_percent')];
        $rmg_process_breakdown=$result[csf('rmg_process_breakdown')];
        foreach ($po_data['po_id'] as $po_id=>$po_val){
            $daysInHand.=(datediff('d',date('d-m-Y',time()),$po_data['pub_shipment_date_po'][$po_id])-1).",";
            $booking_date=$result[csf('update_date')];
            if($booking_date=="" || $booking_date=="0000-00-00 00:00:00"){
            $booking_date=$result[csf('insert_date')];
            }
            $WOPreparedAfter.=(datediff('d',$po_data['insert_date'][$po_id],$booking_date)-1).",";
        }
    ?>
    <table width="100%" style="border:1px solid black;table-layout: fixed;" id="table_h" >
    <tr>
    <td colspan="6" valign="top" style="font-size:18px; color:#F00"><? if($result[csf('is_apply_last_update')]==2){echo "Booking Info not synchronized with order entry and pre-costing. order entry or pre-costing has updated after booking entry.  Contact to ".$marchentrArr[$result[csf('dealing_marchant')]]; } else{ echo "";} ?></td>
    </tr>
    <tr>
    <th>Buyer/Agent Name</th>   
    <td>:&nbsp;<? $buyer_name_str=""; if($client_id!=0) $buyer_name_str=$buyer_name_arr[$result[csf('buyer_id')]]."-".$buyer_name_arr[$client_id]; else $buyer_name_str=$buyer_name_arr[$result[csf('buyer_id')]];  if($show_yarn_rate!=1) { echo $buyer_name_str; } ?></b></td>
    <th>Product Depertment</th>
    <td>:&nbsp;
    <?
    echo $product_depertment ;
    if($product_code !=""){
    echo " (".$product_code.")";
    }
    if($pro_sub_dep != ""){
    echo " (".$pro_sub_dep.")";
    }
    ?>
    </td>
    <th>Order Qnty</th>
    <td>:&nbsp;<? 
        $l=1; 
        foreach ($uom_wise_qty as $uomid => $qty) {
            if($l==1){
                $poqtydata .= $qty."(".$unit_of_measurement[$uomid].")" ;   
            }
            else{
                $poqtydata .= $qty."(".$unit_of_measurement[$uomid]."), " ;
            }
            
        }
        echo $poqtydata; ?>
            
    </td>
    </tr>
    <tr>

    <td><b>Garments Item</b></td>
    <td>:&nbsp;
    <?
    $gmts_item_name="";
    $gmts_item=explode(',',$gmts_item_id);
    for($g=0;$g<=count($gmts_item); $g++)
    {
    $gmts_item_name.= $garments_item[$gmts_item[$g]].",";
    }
    echo rtrim($gmts_item_name,',');
    ?>
    </td>
    <td><b>Booking Release Date</b></td>
    <td>:&nbsp;
    <?
    $booking_date=$result[csf('update_date')];
    if($booking_date=="" || $booking_date=="0000-00-00 00:00:00")
    {
    $booking_date=$result[csf('insert_date')];
    }
    echo change_date_format($booking_date,'dd-mm-yyyy','-','');
    ?>&nbsp;&nbsp;&nbsp;</td>
    <td><b>Style Ref.</b>   </td>
    <td style="font-size:18px">:&nbsp;<b>
    <?
    if($show_yarn_rate!=1) { echo $style_sting; }
    ?>
    </b>
    </td>
    </tr>
    <tr>
    <td><b>Style Des.</b></td>
    <td>:&nbsp;<? echo $style_description;?></td>   
    <td><b>Dealing Merchandiser</b></td>
    <td>:&nbsp;<? echo $dealing_marchant; ?></td>
    <td><b>Factory Merchandiser</b></td>
    <td>:&nbsp;<? echo $factory_marchant; ?></td>
    </tr>

    <tr>
    <td><b>Supplier Name</b> </td>
    <td>:&nbsp;
    <?
    if($result[csf('pay_mode')]==5){
    echo $company_library[$result[csf('supplier_id')]];
    }
    else{
    echo $supplier_name_arr[$result[csf('supplier_id')]];
    }
    ?>    </td>
    <td><b>Delivery Date</b></td>
    <td>:&nbsp;<? echo change_date_format( $result[csf('delivery_date')],'dd-mm-yyyy','-');?></td>
    <td><b>Booking No </b>   </td>
    <td>:&nbsp;<b><? echo $result[csf('booking_no')];?></b><? echo "(".$fabric_source[$result[csf('fabric_source')]].")"?> <? //echo "(".$unit_of_measurement[$result[csf('uom')]].")"; $uom=$result[csf('uom')];?></td>
    </tr>
    <tr>
        <td  class="table_valign"><p><b>Attention</b></p></td>
        <td class="table_valign" ><p>:&nbsp;<? echo $result[csf('attention')]; ?></p></td>
        <td class="table_valign"><p><b>Lead Time </b> </p>  </td>
        <td class="table_valign"><p>:&nbsp;
            <?
            echo $leadtime;
            ?> </p>
        </td>
        <td class="table_valign" ><p><b>Po Received Date</b></p></td>
        <td class="table_valign"><p>:&nbsp;<? echo $po_received_date; ?></p></td>
    </tr>
    <tr>
        <td class="table_valign"><b>Order No</b></td>
        <td class="table_valign" colspan="3">:&nbsp;<? echo $po_number; ?></td>
        <td class="table_valign"><b>Repeat No</b></td>
        <td class="table_valign">:&nbsp;<? echo $order_repeat_no; ?></td>
    </tr>
    <tr>
    <td><b>Shipment Date</b></td>
    <td colspan="3" style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;"> : First:&nbsp;<? echo rtrim($shipment_date,", "); //echo $max_pub_shipment_date; ?>, Last: <? echo $maxshipment_date; ?></td>
    <td><b>Quality Label</b></td>
    <td  >:&nbsp;<? echo $qlty_label; ?></td>
    </tr>
    </tr>
    <tr>
    <td><b>WO Prepared After</b></td>
    <td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;"> :&nbsp;
    <?
    $WOPreparedAfter=implode(",",array_unique(explode(",",chop($WOPreparedAfter,","))));
    echo $WOPreparedAfter.' Days' ;
    ?></td>

    <td><b>Ship.days in Hand</b></td>
    <td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;"> :&nbsp;
    <?
    $daysInHand=implode(",",array_unique(explode(",",chop($daysInHand,","))));
    echo $daysInHand.' Days' ;
    ?></td>

    <td><b>Ex-factory status</b></td>
    <td style="overflow:hidden;text-overflow: ellipsis;white-space: nowrap;"> :&nbsp;
    <?
    echo $shiping_status;
    ?></td>

    </tr>
    <tr>
    <td><b>Internal Ref No</b></td>
    <td> :&nbsp;<b><? echo $grouping; ?></b></td>
    <td><b>File no</b></td>
    <td> :&nbsp;<b><? echo  $file_no;?></b></td>
    <td><b>Currency</b></td>
    <td> :&nbsp;<b><? echo  $currency[$result[csf("currency_id")]];?></b></td>
    </tr>
    <tr>
    <td><b>Rmarks</b></td>
    <td colspan="3"> :<? echo $result[csf('remarks')]?></td>
    <td><b>Season</b></td>
    <td>:&nbsp;<?  if($season_matrix!="") echo $season_matrix; else echo $season_buyer_wise; ?></td>
    </tr>
    <tr>
    <td><b>Fabric Composition</b></td>
    <td colspan="5"> :<? echo $result[csf('fabric_composition')]?></td>
    </tr>

    </table>
    <?
    }

    if($cbo_fabric_source==1 || $cbo_fabric_source==2){
    $nameArray_size=sql_select( "select  size_number_id,min(id) as id,  min(size_order) as size_order from wo_po_color_size_breakdown where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and   is_deleted=0 and status_active!=0 group by size_number_id order by size_order");
    ?>
    <table width="100%" >
    <tr>
    <td width="800">
    <div id="div_size_color_matrix" style="float:left; max-width:1000;">
    <fieldset id="div_size_color_matrix" style="max-width:1000;">
    <legend>Size and Color Breakdown</legend>
    <table  class="rpt_table"  border="1" align="left" cellpadding="0" width="750" cellspacing="0" rules="all" >
    <tr>
    <td style="border:1px solid black"><strong>Color/Size</strong></td>
    <?
    foreach($nameArray_size  as $result_size)
    {        ?>
    <td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
    <?  }    ?>
    <td style="border:1px solid black; width:130px" align="center"><strong> Total Order Qty(Pcs)</strong></td>
    <td style="border:1px solid black; width:80px" align="center"><strong> Excess %</strong></td>
    <td style="border:1px solid black; width:130px" align="center"><strong> Total Plan Cut Qty(Pcs)</strong></td>
    </tr>
    <?
    $color_size_order_qnty_array=array();
    $color_size_qnty_array=array();
    $size_tatal=array();
    $size_tatal_order=array();
    for($c=0;$c<count($gmts_item); $c++)
    {
    $item_size_tatal=array();
    $item_size_tatal_order=array();
    $item_grand_total=0;
    $item_grand_total_order=0;
    $nameArray_color=sql_select( "select  color_number_id,min(id) as id,min(color_order) as color_order from wo_po_color_size_breakdown where  item_number_id=$gmts_item[$c] and po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active!=0 group by color_number_id  order by color_order");
    ?>
    <tr>
    <td style="border:1px solid black" colspan="<? echo count($nameArray_size)+3;?>"><strong><? echo $garments_item[$gmts_item[$c]];?></strong></td>

    </tr>
    <?
    foreach($nameArray_color as $result_color)
    {
    ?>
    <tr>
    <td align="center" style="border:1px solid black"><? echo $color_library[$result_color[csf('color_number_id')]]; // echo $row_num_tr; ?></td>
    <?
    $color_total=0;
    $color_total_order=0;

    foreach($nameArray_size  as $result_size)
    {
    $nameArray_color_size_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as  order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$result_color[csf('color_number_id')]."  and item_number_id=$gmts_item[$c] and  status_active!=0 and is_deleted =0");
    foreach($nameArray_color_size_qnty as $result_color_size_qnty)
    {
    ?>
    <td style="border:1px solid black; text-align:right">
    <?
    if($result_color_size_qnty[csf('plan_cut_qnty')]!= "")
    {
    echo number_format($result_color_size_qnty[csf('order_quantity')],0);
    $color_total += $result_color_size_qnty[csf('plan_cut_qnty')] ;
    $color_total_order += $result_color_size_qnty[csf('order_quantity')] ;
    $item_grand_total+=$result_color_size_qnty[csf('plan_cut_qnty')];
    $item_grand_total_order+=$result_color_size_qnty[csf('order_quantity')];
    $grand_total +=$result_color_size_qnty[csf('plan_cut_qnty')];
    $grand_total_order +=$result_color_size_qnty[csf('order_quantity')];


    $color_size_qnty_array[$result_size[csf('size_number_id')]][$result_color[csf('color_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
    $color_size_order_qnty_array[$result_size[csf('size_number_id')]][$result_color[csf('color_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
    if (array_key_exists($result_size[csf('size_number_id')], $size_tatal))
    {
    $size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
    $size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
    }
    else
    {
    $size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
    $size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
    }
    if (array_key_exists($result_size[csf('size_number_id')], $item_size_tatal))
    {
    $item_size_tatal[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('plan_cut_qnty')];
    $item_size_tatal_order[$result_size[csf('size_number_id')]]+=$result_color_size_qnty[csf('order_quantity')];
    }
    else
    {
    $item_size_tatal[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('plan_cut_qnty')];
    $item_size_tatal_order[$result_size[csf('size_number_id')]]=$result_color_size_qnty[csf('order_quantity')];
    }
    }
    else echo "0";
    ?>
    </td>

    <?
    }
    }
    ?>
    <td style="border:1px solid black; text-align:right"><?  echo number_format(round($color_total_order),0); ?></td>

    <td style="border:1px solid black; text-align:right"><? $excexss_per=($color_total-$color_total_order)/$color_total_order*100; echo number_format($excexss_per,2)." %"; ?>
    </td>
    <td style="border:1px solid black; text-align:right"><? echo number_format(round($color_total),0); ?></td>
    </tr>
    <?
    }
    ?>

    <td align="center" style="border:1px solid black"><strong>Sub Total</strong></td>
    <?
    foreach($nameArray_size  as $result_size)
    {
    ?>
    <td style="border:1px solid black;  text-align:right"><? echo $item_size_tatal_order[$result_size[csf('size_number_id')]];  ?></td>
    <?
    }
    ?>
    <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($item_grand_total_order),0); ?></td>
    <td  style="border:1px solid black;  text-align:right"><? $excess_item_gra_tot=($item_grand_total-$item_grand_total_order)/$item_grand_total_order*100; echo number_format($excess_item_gra_tot,2)." %"; ?></td>
    <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($item_grand_total),0); ?></td>
    </tr>
    <?
    }
    ?>
    <tr>
    <td style="border:1px solid black" align="center" colspan="<? echo count($nameArray_size)+3; ?>"><strong>&nbsp;</strong></td>
    </tr>
    <tr>
    <tr>
    <td align="center" style="border:1px solid black"><strong>Grand Total</strong></td>
    <?
    foreach($nameArray_size  as $result_size)
    {
    ?>
    <td style="border:1px solid black;  text-align:right"><? echo $size_tatal_order[$result_size[csf('size_number_id')]];  ?></td>
    <?
    }
    ?>
    <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($grand_total_order),0); ?></td>
    <td  style="border:1px solid black;  text-align:right"><? $excess_gra_tot= ($grand_total-$grand_total_order)/$grand_total_order*100; echo number_format($excess_gra_tot,2)." %"; ?></td>
    <td  style="border:1px solid black;  text-align:right"><?  echo number_format(round($grand_total),0); ?></td>
    </tr>
    </table>
    </fieldset>
    </div>
    </td>
    <td width="200" valign="top" align="left">
    <div id="div_size_color_matrix" style="float:left;">
    <?
    $rmg_process_breakdown_arr=explode('_',$rmg_process_breakdown)
    ?>
    <fieldset>
    <legend>RMG Process Loss % </legend>
    <table width="180" class="rpt_table" border="1" rules="all">
    <?
    if(number_format($rmg_process_breakdown_arr[8],2)>0)
    {
    ?>
    <tr>
    <td width="130">
    Cut Panel rejection <!-- Extra Cutting % breack Down 8-->
    </td>
    <td align="right">
    <?
    echo number_format($rmg_process_breakdown_arr[8],2);
    ?>
    </td>
    </tr>
    <?
    }
    if(number_format($rmg_process_breakdown_arr[2],2)>0)
    {
    ?>
    <tr>
    <td width="130">
    Chest Printing <!-- Printing % breack Down 2-->
    </td>
    <td align="right">
    <?
    echo number_format($rmg_process_breakdown_arr[2],2);
    ?>
    </td>
    </tr>
    <?
    }
    if(number_format($rmg_process_breakdown_arr[10],2)>0)
    {
    ?>
    <tr>
    <td width="130">
    Neck/Sleeve Printing <!-- New breack Down 10-->
    </td>
    <td align="right">
    <?
    echo number_format($rmg_process_breakdown_arr[10],2);
    ?>
    </td>
    </tr>
    <?
    }
    if(number_format($rmg_process_breakdown_arr[1],2)>0)
    {
    ?>
    <tr>
    <td width="130">
    Embroidery   <!-- Embroidery  % breack Down 1-->
    </td>
    <td align="right">
    <?
    echo number_format($rmg_process_breakdown_arr[1],2);
    ?>
    </td>
    </tr>
    <?
    }
    if(number_format($rmg_process_breakdown_arr[4],2)>0)
    {
    ?>
    <tr>
    <td width="130">
    Sewing /Input<!-- Sewing % breack Down 4-->
    </td>
    <td align="right">
    <?
    echo number_format($rmg_process_breakdown_arr[4],2);
    ?>
    </td>
    </tr>
    <?
    }
    if(number_format($rmg_process_breakdown_arr[3],2)>0)
    {
    ?>
    <tr>
    <td width="130">
    Garments Wash <!-- Washing %breack Down 3-->
    </td>
    <td align="right">
    <?
    echo number_format($rmg_process_breakdown_arr[3],2);
    ?>
    </td>
    </tr>
    <?
    }
    if(number_format($rmg_process_breakdown_arr[15],2)>0)
    {
    ?>
    <tr>
    <td width="130">
    Gmts Finishing <!-- Washing %breack Down 3-->
    </td>
    <td align="right">
    <?
    echo number_format($rmg_process_breakdown_arr[15],2);
    ?>
    </td>
    </tr>
    <?
    }
    if(number_format($rmg_process_breakdown_arr[11],2)>0)
    {
    ?>
    <tr>
    <td width="130">
    Others <!-- New breack Down 11-->
    </td>
    <td align="right">
    <?
    echo number_format($rmg_process_breakdown_arr[11],2);
    ?>
    </td>
    </tr>
    <?
    }
    $gmts_pro_sub_tot=$rmg_process_breakdown_arr[8]+$rmg_process_breakdown_arr[2]+$rmg_process_breakdown_arr[10]+$rmg_process_breakdown_arr[1]+$rmg_process_breakdown_arr[4]+$rmg_process_breakdown_arr[3]+$rmg_process_breakdown_arr[11]+$rmg_process_breakdown_arr[15];
    if($gmts_pro_sub_tot>0)
    {
    ?>
    <tr>
    <td width="130">
    Sub Total <!-- New breack Down 11-->
    </td>
    <td align="right">
    <?

    echo number_format($gmts_pro_sub_tot,2);
    ?>
    </td>
    </tr>
    <?
    }
    ?>
    </table>
    </fieldset>


    <fieldset>
    <legend>Fabric Process Loss % </legend>
    <table width="180" class="rpt_table" border="1" rules="all">
    <?
    if(number_format($rmg_process_breakdown_arr[6],2)>0)
    {
    ?>
    <tr>
    <td width="130">
    Knitting  <!--  Knitting % breack Down 6-->
    </td>
    <td align="right">
    <?
    echo number_format($rmg_process_breakdown_arr[6],2);
    ?>
    </td>
    </tr>
    <?
    }
    if(number_format($rmg_process_breakdown_arr[12],2)>0)
    {
    ?>
    <tr>
    <td width="130">
    Yarn Dyeing  <!--  New breack Down 12-->
    </td>
    <td align="right">
    <?
    echo number_format($rmg_process_breakdown_arr[12],2);
    ?>
    </td>
    </tr>
    <?
    }
    if(number_format($rmg_process_breakdown_arr[5],2)>0)
    {
    ?>
    <tr>
    <td width="130">
    Dyeing & Finishing  <!-- Finishing % breack Down 5-->
    </td>
    <td align="right">
    <?
    echo number_format($rmg_process_breakdown_arr[5],2);
    ?>
    </td>
    </tr>
    <?
    }
    if(number_format($rmg_process_breakdown_arr[13],2)>0)
    {
    ?>
    <tr>
    <td width="130">
    All Over Print <!-- new  breack Down 13-->
    </td>
    <td align="right">
    <?
    echo number_format($rmg_process_breakdown_arr[13],2);
    ?>
    </td>
    </tr>
    <?
    }
    if(number_format($rmg_process_breakdown_arr[14],2)>0)
    {
    ?>
    <tr>
    <td width="130">
    Lay Wash (Fabric) <!-- new  breack Down 14-->
    </td>
    <td align="right">
    <?
    echo number_format($rmg_process_breakdown_arr[14],2);
    ?>
    </td>
    </tr>
    <?
    }
    if(number_format($rmg_process_breakdown_arr[7],2)>0)
    {
    ?>
    <tr>
    <td width="130">
    Dying   <!-- breack Down 7-->
    </td>
    <td align="right">
    <?
    echo number_format($rmg_process_breakdown_arr[7],2);
    ?>
    </td>
    </tr>
    <?
    }
    if(number_format($rmg_process_breakdown_arr[0],2)>0)
    {
    ?>
    <tr>
    <td width="130">
    Cutting (Fabric) <!-- Cutting % breack Down 0-->
    </td>
    <td align="right">
    <?
    echo number_format($rmg_process_breakdown_arr[0],2);
    ?>
    </td>
    </tr>
    <?
    }
    if(number_format($rmg_process_breakdown_arr[9],2)>0)
    {
    ?>
    <tr>
    <td width="130">
    Others  <!-- Others% breack Down 9-->
    </td>
    <td align="right">
    <?
    echo number_format($rmg_process_breakdown_arr[9],2);
    ?>
    </td>
    </tr>
    <?
    }
    $fab_proce_sub_tot=$rmg_process_breakdown_arr[6]+$rmg_process_breakdown_arr[12]+$rmg_process_breakdown_arr[5]+$rmg_process_breakdown_arr[13]+$rmg_process_breakdown_arr[14]+$rmg_process_breakdown_arr[7]+$rmg_process_breakdown_arr[0]+$rmg_process_breakdown_arr[9];
    if(fab_proce_sub_tot>0)
    {
    ?>
    <tr>
    <td width="130">
    Sub Total  <!-- Others% breack Down 9-->
    </td>
    <td align="right">
    <?

    echo number_format($fab_proce_sub_tot,2);
    ?>
    </td>
    </tr>
    <?
    }
    if($gmts_pro_sub_tot+$fab_proce_sub_tot>0)
    {
    ?>
    <tr>
    <td width="130">
    Grand Total  <!-- Others% breack Down 9-->
    </td>
    <td align="right">
    <?
    echo number_format($gmts_pro_sub_tot+$fab_proce_sub_tot,2);
    ?>
    </td>
    </tr>
    <?
    }
    ?>
    </table>
    </fieldset>
    </div>
    </td>
    <td width="330" valign="top" align="left">
    <?
    $nameArray_imge =sql_select("SELECT image_location FROM common_photo_library where master_tble_id in($job_no_in) and file_type=1");
    ?>
    <div id="div_size_color_matrix" style="float:left;">
    <fieldset>
    <legend>Image</legend>
    <table width="310">
    <tr>
    <?
    $img_counter = 0;
    foreach($nameArray_imge as $result_imge)
    {
    if($path=="")
    {
    $path='../../';
    }
    ?>
    <td>
    <img src="<? echo $path.$result_imge[csf('image_location')]; ?>" width="90" height="100" border="2" />
    </td>
    <?

    $img_counter++;
    }
    ?>
    </tr>
    </table>
    </fieldset>
    </div>
    </td>
    </tr>
    </table>
    <?
    }// if($cbo_fabric_source==1) end

    ?>
    <br/>
    <!--  Here will be the main portion  -->
    <?
    $costing_per="";
    $costing_per_qnty=0;
    $costing_per_id=return_field_value( "costing_per", "wo_pre_cost_mst","job_no in($job_no_in)");
    if($costing_per_id==1)
    {
    $costing_per="1 Dzn";
    $costing_per_qnty=12;

    }
    if($costing_per_id==2)
    {
    $costing_per="1 Pcs";
    $costing_per_qnty=1;

    }
    if($costing_per_id==3)
    {
    $costing_per="2 Dzn";
    $costing_per_qnty=24;

    }
    if($costing_per_id==4)
    {
    $costing_per="3 Dzn";

    $costing_per_qnty=36;

    }
    if($costing_per_id==5)
    {
    $costing_per="4 Dzn";
    $costing_per_qnty=48;
    }
    $process_loss_method=return_field_value( "process_loss_method", "wo_pre_cost_fabric_cost_dtls","job_no in($job_no_in)");

    $uom_arr=array(1=>"Pcs",12=>"Kg",23=>"Mtr",27=>"Yds");
    foreach($uom_arr as $uom_id=>$uom_val){
    if($cbo_fabric_source==1){
    $nameArray_fabric_description= sql_select("SELECT a.job_no, a.id as fabric_cost_dtls_id, a.item_number_id, a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,a.width_dia_type as width_dia_type , b.dia_width,d.pre_cost_remarks, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent, avg(b.requirment) as requirment  FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and b.po_break_down_id=d.po_break_down_id and b.color_number_id=d.gmts_color_id and b.dia_width=d.dia_width and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and d.booking_no ='$txt_booking_no' and a.uom=$uom_id and d.status_active=1 and d.is_deleted=0 and b.cons>0 group by a.job_no, a.id,a.item_number_id,a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,a.width_dia_type,b.dia_width,d.pre_cost_remarks order by fabric_cost_dtls_id,a.body_part_id,b.dia_width"); 

    if(count($nameArray_fabric_description)>0){
    ?>

    <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
    <caption style="font-weight: bold; font-size: 18px">Fabric Details in <? echo $uom_val ?></caption>
    <tr align="center">
    <th colspan="3" align="left">Job</th>
    <?
    foreach($nameArray_fabric_description  as $result_fabric_description)
    {   if( $result_fabric_description[csf('job_no')] == "")
        echo "<td colspan='3'>&nbsp</td>";
        else
        echo "<td colspan='3'>". $result_fabric_description[csf('job_no')]."</td>";
    }
    ?>  
    <td  rowspan="13" width="50"><p>Total Finish Fabric</p></td>

    <td  rowspan="13" width="50"><p>Avg Rate</p></td>
    <td  rowspan="13" width="50"><p>Amount </p></td>
    </tr>
    <tr align="center">
        <th colspan="3" align="left">Style</th>
    <?
    foreach($nameArray_fabric_description  as $result_fabric_description)
    {   if( $result_fabric_description[csf('job_no')] == "")
        {
            echo "<td colspan='3'>&nbsp</td>";
        }       
        else
        {
            if($show_yarn_rate!=1) { 
            echo "<td colspan='3'>". $job_data_arr['style_ref_no'][$result_fabric_description[csf('job_no')]]."</td>";
            }
            else{
                echo "<td colspan='3'>&nbsp</td>";
            }
        }       
    }?> 
    </tr>
    <tr align="center">
    <th colspan="3" align="left">Item Name</th>
    <?
    foreach($nameArray_fabric_description  as $result_fabric_description)
    {
    if( $result_fabric_description[csf('body_part_id')] == "")
    echo "<td colspan='3'>&nbsp</td>";
    else
    echo "<td colspan='3'>". $garments_item[$result_fabric_description[csf('item_number_id')]]."</td>";
    }
    ?>
    </tr>
    <tr align="center">
    <th colspan="3" align="left">Body Part</th>
    <?

    foreach($nameArray_fabric_description  as $result_fabric_description)
    {
    if( $result_fabric_description[csf('body_part_id')] == "")
    echo "<td colspan='3'>&nbsp</td>";
    else
    echo "<td colspan='3'>".$body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
    }
    ?>
    </tr>
    <tr align="center"><th colspan="3" align="left">Color Type</th>
    <?
    foreach($nameArray_fabric_description  as $result_fabric_description)
    {
    if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
    else                               echo "<td  colspan='3'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
    }
    ?>
    </tr>
    <tr align="center"><th colspan="3" align="left">Fabric Construction</th>
    <?
    foreach($nameArray_fabric_description  as $result_fabric_description)
    {
    if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='3'>&nbsp</td>";
    else                               echo "<td  colspan='3'>". $result_fabric_description[csf('construction')]."</td>";
    }
    ?>


    </tr>
    <tr align="center"><th   colspan="3" align="left">Yarn Composition</th>
    <?
    foreach($nameArray_fabric_description as $result_fabric_description)
    {
    if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='3' >&nbsp</td>";
    else                               echo "<td colspan='3' >".$result_fabric_description[csf('composition')]."</td>";
    }
    ?>

    </tr>
    <tr align="center"><th  colspan="3" align="left">GSM</th>
    <?
    foreach($nameArray_fabric_description  as $result_fabric_description)
    {
    if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='3'>&nbsp</td>";
    else                       echo "<td colspan='3' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
    }
    ?>

    </tr>
    <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
    <?
    foreach($nameArray_fabric_description as $result_fabric_description)
    {
    if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='3'>&nbsp</td>";
    else                              echo "<td colspan='3' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
    }
    ?>

    </tr>
    <tr align="center"><th   colspan="3" align="left">Consumption For <? echo $costing_per; ?></th>
    <?
    foreach($nameArray_fabric_description as $result_fabric_description)
    {
    if( $result_fabric_description[csf('cons')] == "")   echo "<td colspan='3'>&nbsp</td>";
    else                              echo "<td colspan='3' align='center'>Fin: ".number_format($result_fabric_description[csf('cons')],2)."</td>";
    }
    ?>
    </tr>
    <tr align="center"><th   colspan="3" align="left">Remarks</th>
        <?
        foreach($nameArray_fabric_description as $result_fabric_description)
        {
            if( $result_fabric_description[csf('pre_cost_remarks')] == "")   echo "<td colspan='3'>&nbsp</td>";
            else                              echo "<td colspan='3' align='center'>".$result_fabric_description[csf('pre_cost_remarks')]."</td>";
        }
        ?>

       </tr>
    <tr>
    <th  colspan="<? echo  count($nameArray_fabric_description)*3+3; ?>" align="left" style="height:30px">&nbsp;</th>
    </tr>
    <tr>
    <th  width="120" align="left">Fabric Color</th>
    <th  width="120" align="left">Body Color</th>
    <th  width="120" align="left">Lab Dip No</th>
    <?
    foreach($nameArray_fabric_description as $result_fabric_description)
    {
    echo "<th width='50'>Fab. Qty</th><th width='50' >Rate</th><th width='50' >Amount</th>";
    }
    ?>
    </tr>
    <?
    $gmt_color_library=array();
    $gmt_color_data=sql_select("select b.gmts_color_id, b.contrast_color_id
    FROM
    wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b
    WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.uom=$uom_id  and a.fabric_source =$cbo_fabric_source and
    a.job_no in ($job_no_in)");
    foreach( $gmt_color_data as $gmt_color_row){
    $gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
    }
    $grand_total_fin_fab_qnty=0;
    $grand_total_amount=0;
    $color_wise_wo_sql=sql_select("select b.fabric_color_id
    FROM
    wo_pre_cost_fabric_cost_dtls a,
    wo_booking_dtls b
    WHERE
    a.id=b.pre_cost_fabric_cost_dtls_id and
    a.uom=$uom_id and
    b.booking_no ='$txt_booking_no' and
    b.status_active=1 and
    b.is_deleted=0
    group by b.fabric_color_id");
    foreach($color_wise_wo_sql as $color_wise_wo_result)
    {
    ?>
    <tr>
    <td  width="120" align="left">
    <?
    echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];
    ?>
    </td>
    <td>
    <?
    echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
    ?>
    </td>
    <td  width="120" align="left">
    <?
    $lapdip_no="";
    $lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
    if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
    ?>
    </td>
    <?
    $total_fin_fab_qnty=0;
    $total_amount=0;

    foreach($nameArray_fabric_description as $result_fabric_description)
    {
    if($db_type==0)
    {
    $color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate,sum(d.fin_fab_qnty*d.rate) as amount FROM wo_pre_cost_fabric_cost_dtls a, wo_booking_dtls d
    WHERE
    a.job_no=d.job_no and
    a.id=d.pre_cost_fabric_cost_dtls_id and
    d.booking_no ='$txt_booking_no' and
    a.uom=$uom_id and
    a.id='".$result_fabric_description[csf('fabric_cost_dtls_id')]."' and
    a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
    a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
    a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
    a.construction='".$result_fabric_description[csf('construction')]."' and
    a.composition='".$result_fabric_description[csf('composition')]."' and
    a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
    d.dia_width='".$result_fabric_description[csf('dia_width')]."' and
    d.pre_cost_remarks='".$result_fabric_description[csf('pre_cost_remarks')]."' and
    d.fabric_color_id='".$color_wise_wo_result[csf('fabric_color_id')]."' and
    d.status_active=1 and
    d.is_deleted=0
    ");
    }
    if($db_type==2)
    {
    $color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate,sum(d.fin_fab_qnty*d.rate) as amount FROM wo_pre_cost_fabric_cost_dtls a, wo_booking_dtls d
    WHERE
    a.job_no=d.job_no and
    a.id=d.pre_cost_fabric_cost_dtls_id and
    d.booking_no ='$txt_booking_no' and
    a.uom=$uom_id and
    a.id='".$result_fabric_description[csf('fabric_cost_dtls_id')]."' and
    a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
    a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
    a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
    a.construction='".$result_fabric_description[csf('construction')]."' and
    a.composition='".$result_fabric_description[csf('composition')]."' and
    a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
    d.dia_width='".$result_fabric_description[csf('dia_width')]."' and
    d.pre_cost_remarks='".$result_fabric_description[csf('pre_cost_remarks')]."' and
    nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
    d.status_active=1 and
    d.is_deleted=0
    ");
    }
    list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
    ?>
    <td width='50' align='right'>
    <?
    if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
    {
    echo def_number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;
    $total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('fin_fab_qnty')];
    }
    ?>
    </td>
    <td width='50' align='right' >
    <?
    if($color_wise_wo_result_qnty[csf('rate')]!="")
    {
    echo def_number_format($color_wise_wo_result_qnty[csf('rate')],5);
    }
    ?>
    </td>
    <td width='50' align='right' >
    <?
    $amount=def_number_format($color_wise_wo_result_qnty[csf('amount')],2,'',0);
    if($amount!="")
    {
    echo $amount;
    $total_amount+=$amount;
    }
    ?>
    </td>
    <?
    }
    ?>
    <td align="right"><? echo def_number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
    <td align="right"><? echo def_number_format($total_amount/$total_fin_fab_qnty,2); $grand_total_amount+=$total_amount;?></td>
    <td align="right">
    <?
    echo def_number_format($total_amount,2);

    ?>
    </td>
    </tr>
    <?
    }
    ?>
    <tr style=" font-weight:bold">
    <th  width="120" align="left">&nbsp;</th>
    <td  width="120" align="left">&nbsp;</td>
    <td  width="120" align="left"><strong>Total</strong></td>
    <?
    foreach($nameArray_fabric_description as $result_fabric_description)
    {
    $color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate,sum(d.fin_fab_qnty*d.rate) as amount FROM wo_pre_cost_fabric_cost_dtls a, wo_booking_dtls d
    WHERE
    a.job_no=d.job_no and
    a.id=d.pre_cost_fabric_cost_dtls_id and
    d.booking_no ='$txt_booking_no' and
    a.uom=$uom_id and
    a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
    a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
    a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
    a.construction='".$result_fabric_description[csf('construction')]."' and
    a.composition='".$result_fabric_description[csf('composition')]."' and
    a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
    d.dia_width='".$result_fabric_description[csf('dia_width')]."' and
    d.pre_cost_remarks='".$result_fabric_description[csf('pre_cost_remarks')]."' and
    d.status_active=1 and
    d.is_deleted=0
    ");
    list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
    ?>
    <td width='50' align='right'><?  echo def_number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;?></td>
    <td width='50' align='right'></td>
    <td width='50' align='right'></td>
    <?
    }
    ?>
    <td align="right"><? echo def_number_format($grand_total_fin_fab_qnty,2);?></td>
    <td align="right"><? echo def_number_format($grand_total_amount/$grand_total_fin_fab_qnty,2);?></td>
    <td align="right">
    <?
    echo def_number_format($grand_total_amount,2);
    ?>
    </td>
    </tr>   
    </table>
    <br/>
    <?
    }
    }
    }
    //===========================

    foreach($uom_arr as $uom_id=>$uom_val){
    if($cbo_fabric_source==2){
    $nameArray_fabric_description= sql_select("SELECT a.job_no, a.id as fabric_cost_dtls_id, a.item_number_id, a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,a.width_dia_type as width_dia_type , b.dia_width,d.pre_cost_remarks, avg(b.cons) as cons  , avg(b.process_loss_percent) as process_loss_percent, avg(b.requirment) as requirment  FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and b.po_break_down_id=d.po_break_down_id and b.color_number_id=d.gmts_color_id and b.dia_width=d.dia_width and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and d.booking_no ='$txt_booking_no' and a.uom=$uom_id and d.status_active=1 and d.is_deleted=0  and b.cons>0 group by a.id,a.item_number_id,a.body_part_id,a.color_type_id,a.construction,a.composition,a.gsm_weight,a.width_dia_type,b.dia_width,d.pre_cost_remarks,a.job_no order by fabric_cost_dtls_id,a.body_part_id,b.dia_width"); 
    if(count($nameArray_fabric_description)>0){
    ?>
    <table class="rpt_table" width="100%"  border="1" cellpadding="0" cellspacing="0" rules="all" >
    <caption style="font-weight: bold; font-size: 18px">Fabric Details in <? echo $uom_val;?></caption>
    <tr align="center">
    <th colspan="3" align="left">Job</th>
    <?
    foreach($nameArray_fabric_description  as $result_fabric_description)
    {   if( $result_fabric_description[csf('job_no')] == "")
        echo "<td colspan='3'>&nbsp</td>";
        else
        echo "<td colspan='3'>". $result_fabric_description[csf('job_no')]."</td>";
    }
    ?>  
    <td  rowspan="13" width="50"><p>Total Finish Fabric</p></td>

    <td  rowspan="13" width="50"><p>Avg Rate</p></td>
    <td  rowspan="13" width="50"><p>Amount </p></td>
    </tr>
    <tr align="center">
        <th colspan="3" align="left">Style</th>
    <?
    foreach($nameArray_fabric_description  as $result_fabric_description)
    {   
        if( $result_fabric_description[csf('job_no')] == "")
        {
            echo "<td colspan='3'>&nbsp</td>";
        }       
        else
        {
            if($show_yarn_rate!=1) { 
            echo "<td colspan='3'>". $job_data_arr['style_ref_no'][$result_fabric_description[csf('job_no')]]."</td>";
            }
            else{
                echo "<td colspan='3'>&nbsp</td>";
            }
        }
    }?> 
    </tr>
    <tr align="center">
    <th colspan="3" align="left">Item Name</th>
    <?
    foreach($nameArray_fabric_description  as $result_fabric_description)
    {
    if( $result_fabric_description[csf('body_part_id')] == "")
    echo "<td colspan='3'>&nbsp</td>";
    else
    echo "<td colspan='3'>". $garments_item[$result_fabric_description[csf('item_number_id')]]."</td>";
    }
    ?>
    </tr>
    <tr align="center">
    <th colspan="3" align="left">Body Part</th>
    <?
    foreach($nameArray_fabric_description  as $result_fabric_description)
    {
    if( $result_fabric_description[csf('body_part_id')] == "")
    echo "<td colspan='3'>&nbsp</td>";
    else
    echo "<td colspan='3'>".$body_part[$result_fabric_description[csf('body_part_id')]]."</td>";
    }
    ?>
    </tr>
    <tr align="center"><th colspan="3" align="left">Color Type</th>
    <?
    foreach($nameArray_fabric_description  as $result_fabric_description)
    {
    if( $result_fabric_description[csf('color_type_id')] == "")  echo "<td  colspan='3'>&nbsp</td>";
    else                               echo "<td  colspan='3'>". $color_type[$result_fabric_description[csf('color_type_id')]]."</td>";
    }
    ?>
    </tr>
    <tr align="center"><th colspan="3" align="left">Fabric Construction</th>
    <?
    foreach($nameArray_fabric_description  as $result_fabric_description)
    {
    if( $result_fabric_description[csf('construction')] == "")  echo "<td  colspan='3'>&nbsp</td>";
    else                               echo "<td  colspan='3'>". $result_fabric_description[csf('construction')]."</td>";
    }
    ?>
    </tr>
    <tr align="center"><th   colspan="3" align="left">Yarn Composition</th>
    <?
    foreach($nameArray_fabric_description as $result_fabric_description)
    {
    if( $result_fabric_description[csf('composition')] == "")   echo "<td colspan='3' >&nbsp</td>";
    else                               echo "<td colspan='3' >".$result_fabric_description[csf('composition')]."</td>";
    }
    ?>
    </tr>
    <tr align="center"><th  colspan="3" align="left">GSM</th>
    <?
    foreach($nameArray_fabric_description  as $result_fabric_description)
    {
    if( $result_fabric_description[csf('gsm_weight')] == "")   echo "<td colspan='3'>&nbsp</td>";
    else                       echo "<td colspan='3' align='center'>". $result_fabric_description[csf('gsm_weight')]."</td>";
    }
    ?>
    </tr>
    <tr align="center"><th   colspan="3" align="left">Dia/Width (Inch)</th>
    <?
    foreach($nameArray_fabric_description as $result_fabric_description)
    {
    if( $result_fabric_description[csf('dia_width')] == "")   echo "<td colspan='3'>&nbsp</td>";
    else                              echo "<td colspan='3' align='center'>".$result_fabric_description[csf('dia_width')].",".$fabric_typee[$result_fabric_description[csf('width_dia_type')]]."</td>";
    }
    ?>

    </tr>
    <tr align="center"><th   colspan="3" align="left">Consumption For <? echo $costing_per; ?></th>
    <?
    foreach($nameArray_fabric_description as $result_fabric_description)
    {
    if( $result_fabric_description[csf('cons')] == "")   echo "<td colspan='3'>&nbsp</td>";
    else                              echo "<td colspan='3' align='center'>Fin: ".number_format($result_fabric_description[csf('cons')],2)."</td>";
    }
    ?>

    </tr>
    <tr align="center"><th   colspan="3" align="left">Remarks</th>
        <?
        foreach($nameArray_fabric_description as $result_fabric_description)
        {
            if( $result_fabric_description[csf('pre_cost_remarks')] == "")   echo "<td colspan='3'>&nbsp</td>";
            else                              echo "<td colspan='3' align='center'>".$result_fabric_description[csf('pre_cost_remarks')]."</td>";
        }
        ?>

       </tr>
    <tr>
    <th  colspan="<? echo  count($nameArray_fabric_description)*3+3; ?>" align="left" style="height:30px">&nbsp;</th>
    </tr>
    <tr>
    <th  width="120" align="left">Fabric Color</th>
    <th  width="120" align="left">Body Color</th>
    <th  width="120" align="left">Lab Dip No</th>
    <?
    if($cbo_fabric_source==2)
    {
    foreach($nameArray_fabric_description as $result_fabric_description)
    {
    echo "<th width='50'>Fab. Qty</th><th width='50' >Rate</th><th width='50' >Amount</th>";
    }
    }
    else
    {
    foreach($nameArray_fabric_description as $result_fabric_description)
    {
    echo "<th width='50'>Fab. Qty</th>";
    }
    }

    ?>
    </tr>
    <?
    $gmt_color_library=array();

    $gmt_color_data=sql_select("select b.gmts_color_id, b.contrast_color_id
    FROM
    wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_color_dtls b
    WHERE a.id=b.pre_cost_fabric_cost_dtls_id and a.fab_nature_id=$cbo_fabric_natu and a.uom=$uom_id  and a.fabric_source =$cbo_fabric_source and
    a.job_no in ($job_no_in)");
    foreach( $gmt_color_data as $gmt_color_row){
    $gmt_color_library[$gmt_color_row[csf("contrast_color_id")]][$gmt_color_row[csf("gmts_color_id")]]=$color_library[$gmt_color_row[csf("gmts_color_id")]];
    }
    $grand_total_fin_fab_qnty=0;
    $grand_total_amount=0;
    $color_wise_wo_sql=sql_select("select b.fabric_color_id
    FROM
    wo_pre_cost_fabric_cost_dtls a,
    wo_booking_dtls b
    WHERE
    a.id=b.pre_cost_fabric_cost_dtls_id and
    a.uom=$uom_id and
    b.booking_no ='$txt_booking_no' and
    b.status_active=1 and
    b.is_deleted=0
    group by b.fabric_color_id");
    foreach($color_wise_wo_sql as $color_wise_wo_result)
    {
    ?>
    <tr>
    <td  width="120" align="left">
    <?
    echo $color_library[$color_wise_wo_result[csf('fabric_color_id')]];
    ?>
    </td>
    <td>
    <?
    echo implode(",",$gmt_color_library[$color_wise_wo_result[csf('fabric_color_id')]]);
    ?>
    </td>
    <td  width="120" align="left">
    <?
    $lapdip_no="";
    $lapdip_no=return_field_value("lapdip_no","wo_po_lapdip_approval_info","job_no_mst='".$job_no."' and approval_status=3 and color_name_id=".$color_wise_wo_result[csf('fabric_color_id')]."");
    if($lapdip_no=="") echo "&nbsp;"; echo $lapdip_no;
    ?>
    </td>
    <?
    $total_fin_fab_qnty=0;
    $total_amount=0;

    foreach($nameArray_fabric_description as $result_fabric_description)
    {
    if($db_type==0)
    {
    $color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate,sum(d.fin_fab_qnty*d.rate) as amount FROM wo_pre_cost_fabric_cost_dtls a, wo_booking_dtls d
    WHERE
    a.job_no=d.job_no and
    a.id=d.pre_cost_fabric_cost_dtls_id and
    d.booking_no ='$txt_booking_no' and
    a.uom=$uom_id and
    a.id='".$result_fabric_description[csf('fabric_cost_dtls_id')]."' and
    a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
    a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
    a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
    a.construction='".$result_fabric_description[csf('construction')]."' and
    a.composition='".$result_fabric_description[csf('composition')]."' and
    a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
    d.dia_width='".$result_fabric_description[csf('dia_width')]."' and
    d.pre_cost_remarks='".$result_fabric_description[csf('pre_cost_remarks')]."' and
    d.fabric_color_id='".$color_wise_wo_result[csf('fabric_color_id')]."' and
    d.status_active=1 and
    d.is_deleted=0
    ");
    }
    if($db_type==2)
    {
    $color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate,sum(d.fin_fab_qnty*d.rate) as amount FROM wo_pre_cost_fabric_cost_dtls a, wo_booking_dtls d
    WHERE
    a.job_no=d.job_no and
    a.id=d.pre_cost_fabric_cost_dtls_id and
    d.booking_no ='$txt_booking_no' and
    a.uom=$uom_id and
    a.id='".$result_fabric_description[csf('fabric_cost_dtls_id')]."' and
    a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
    a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
    a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
    a.construction='".$result_fabric_description[csf('construction')]."' and
    a.composition='".$result_fabric_description[csf('composition')]."' and
    a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
    d.dia_width='".$result_fabric_description[csf('dia_width')]."' and
    d.pre_cost_remarks='".$result_fabric_description[csf('pre_cost_remarks')]."' and
    nvl(d.fabric_color_id,0)=nvl('".$color_wise_wo_result[csf('fabric_color_id')]."',0) and
    d.status_active=1 and
    d.is_deleted=0
    ");
    }
    list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
    ?>
    <td width='50' align='right'>
    <?
    if($color_wise_wo_result_qnty[csf('fin_fab_qnty')]!="")
    {
    echo def_number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;
    $total_fin_fab_qnty+=$color_wise_wo_result_qnty[csf('fin_fab_qnty')];
    }
    ?>
    </td>
    <td width='50' align='right' >
    <?
    if($color_wise_wo_result_qnty[csf('rate')]!="")
    {
    echo def_number_format($color_wise_wo_result_qnty[csf('rate')],5);
    }
    ?>
    </td>
    <td width='50' align='right' >
    <?
    $amount=def_number_format($color_wise_wo_result_qnty[csf('amount')],2,'',0);
    if($amount!="")
    {
    echo $amount;
    $total_amount+=$amount;
    }
    ?>
    </td>
    <?
    }
    ?>
    <td align="right"><? echo def_number_format($total_fin_fab_qnty,2); $grand_total_fin_fab_qnty+=$total_fin_fab_qnty;?></td>
    <td align="right"><? echo def_number_format($total_amount/$total_fin_fab_qnty,2); $grand_total_amount+=$total_amount;?></td>
    <td align="right">
    <?
    echo def_number_format($total_amount,2);

    ?>
    </td>
    </tr>
    <?
    }
    ?>
    <tr style=" font-weight:bold">
    <th  width="120" align="left">&nbsp;</th>
    <td  width="120" align="left">&nbsp;</td>
    <td  width="120" align="left"><strong>Total</strong></td>
    <?
    foreach($nameArray_fabric_description as $result_fabric_description)
    {
    $color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty,avg(d.rate) as rate,sum(d.fin_fab_qnty*d.rate) as amount FROM wo_pre_cost_fabric_cost_dtls a, wo_booking_dtls d
    WHERE
    a.job_no=d.job_no and
    a.id=d.pre_cost_fabric_cost_dtls_id and
    d.booking_no ='$txt_booking_no' and
    a.uom=$uom_id and
    a.id='".$result_fabric_description[csf('fabric_cost_dtls_id')]."' and
    a.item_number_id='".$result_fabric_description[csf('item_number_id')]."' and
    a.body_part_id='".$result_fabric_description[csf('body_part_id')]."' and
    a.color_type_id='".$result_fabric_description[csf('color_type_id')]."' and
    a.construction='".$result_fabric_description[csf('construction')]."' and
    a.composition='".$result_fabric_description[csf('composition')]."' and
    a.gsm_weight='".$result_fabric_description[csf('gsm_weight')]."' and
    d.dia_width='".$result_fabric_description[csf('dia_width')]."' and
    d.pre_cost_remarks='".$result_fabric_description[csf('pre_cost_remarks')]."' and
    d.status_active=1 and
    d.is_deleted=0
    ");
    list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty
    ?>
    <td width='50' align='right'><?  echo def_number_format($color_wise_wo_result_qnty[csf('fin_fab_qnty')],2) ;?></td>
    <td width='50' align='right' ></td>
    <td width='50' align='right' ></td>
    <?
    }
    ?>
    <td align="right"><? echo def_number_format($grand_total_fin_fab_qnty,2);?></td>
    <td align="right"><? echo number_format($grand_total_amount/$grand_total_fin_fab_qnty,2);?></td>
    <td align="right">
    <?
    echo def_number_format($grand_total_amount,2);
    ?>
    </td>
    </tr>
    </table>
    <br/>
    <?
    }
    }
    }
    //===========================
     
    //Collar Cuff && Item Size Dtls
        if($cbo_fabric_source==1 || $cbo_fabric_source==2)
        {
            $lab_dip_color_arr=array();
            $lab_dip_color_sql=sql_select("select pre_cost_fabric_cost_dtls_id, gmts_color_id, contrast_color_id from wo_pre_cos_fab_co_color_dtls where job_no in($job_no_in)");
            //echo "select pre_cost_fabric_cost_dtls_id, gmts_color_id, contrast_color_id from wo_pre_cos_fab_co_color_dtls where job_no in($job_no_in)";
            foreach($lab_dip_color_sql as $row)
            {
                $lab_dip_color_arr[$row[csf('pre_cost_fabric_cost_dtls_id')]][$row[csf('gmts_color_id')]]=$row[csf('contrast_color_id')];
            }
            
            

            $collar_cuff_percent_arr=array(); $collar_cuff_body_arr=array(); $collar_cuff_color_arr=array(); $collar_cuff_size_arr=array(); $collar_cuff_item_size_arr=array(); $color_size_sensitive_arr=array();

            $collar_cuff_sql="select a.id, a.item_number_id, a.color_size_sensitive, a.color_break_down, b.color_number_id, b.gmts_sizes, b.item_size, c.size_number_id, d.colar_cuff_per, e.body_part_full_name, e.body_part_type
            FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c, wo_booking_dtls d, lib_body_part e

            WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no ='$txt_booking_no' and a.body_part_id=e.id and e.body_part_type in (40,50) and c.id=b.color_size_table_id and d.gmts_color_id=b.color_number_id  and d.po_break_down_id=c.po_break_down_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 order by  c.size_order";
            //echo $collar_cuff_sql;
            $collar_cuff_sql_res=sql_select($collar_cuff_sql);
            
            $itemIdArr=array();

            foreach($collar_cuff_sql_res as $collar_cuff_row)
            {
                $collar_cuff_percent_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('color_number_id')]][$collar_cuff_row[csf('gmts_sizes')]]=$collar_cuff_row[csf('colar_cuff_per')];
                $collar_cuff_body_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]]=$collar_cuff_row[csf('body_part_full_name')];
                $collar_cuff_size_arr[$collar_cuff_row[csf('body_part_type')]][$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('size_number_id')]]=$collar_cuff_row[csf('size_number_id')];
                if(!empty($collar_cuff_row[csf('item_size')]))
                {
                    $collar_cuff_item_size_arr[$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('size_number_id')]][$collar_cuff_row[csf('item_size')]]=$collar_cuff_row[csf('item_size')];
                }
                
                $color_size_sensitive_arr[$collar_cuff_row[csf('body_part_full_name')]][$collar_cuff_row[csf('id')]][$collar_cuff_row[csf('color_number_id')]][$collar_cuff_row[csf('color_size_sensitive')]]=$collar_cuff_row[csf('color_break_down')];
                
                $itemIdArr[$collar_cuff_row[csf('body_part_type')]].=$collar_cuff_row[csf('item_number_id')].',';
            }
            //print_r($collar_cuff_percent_arr[40]) ;
            unset($collar_cuff_sql_res);
            //$count_collar_cuff=count($collar_cuff_size_arr);
            $booking_po_id=$txt_order_no_id;
            $order_plan_qty_arr=array();
            $color_wise_wo_sql_qnty=sql_select( "select item_number_id, color_number_id, size_number_id, sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in ($booking_po_id) and status_active=1 and is_deleted =0  group by item_number_id, color_number_id, size_number_id");
            //echo  "select item_number_id, color_number_id, size_number_id, sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in ($booking_po_id) and status_active=1 and is_deleted =0  group by item_number_id, color_number_id, size_number_id";
            //and item_number_id in (".implode(",",$itemIdArr).")
            foreach($color_wise_wo_sql_qnty as $row)
            {
                $order_plan_qty_arr[$row[csf('item_number_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]['plan']=$row[csf('plan_cut_qnty')];
                $order_plan_qty_arr[$row[csf('item_number_id')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]['order']=$row[csf('order_quantity')];
            }
            unset($color_wise_wo_sql_qnty);

            
            foreach($collar_cuff_body_arr as $body_type=>$body_name)
            {
                $gmtsItemId=array_filter(array_unique(explode(",",$itemIdArr[$body_type])));
                foreach($body_name as $body_val)
                {
                    $count_collar_cuff=count($collar_cuff_size_arr[$body_type][$body_val]);
                    $pre_grand_tot_collar=0; $pre_grand_tot_collar_order_qty=0;

                    ?>
                    <div style="max-height:1330px; overflow:auto; float:left; padding-top:5px; margin:5px; margin-bottom:5px; position:relative;font-size:18px;">
                    <table width="625" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                        <tr>
                            <td colspan="<? echo $count_collar_cuff+3; ?>" align="center"><b><? echo $body_val; ?> - Color Size Brakedown in Pcs.</b></td>
                        </tr>
                        <tr>
                            <td width="100">Size</td>
                                <?
                                foreach($collar_cuff_size_arr[$body_type][$body_val]  as $size_number_id)
                                {
                                    ?>
                                    <td align="center" style="border:1px solid black"><strong><? echo $size_library[$size_number_id];?></strong></td>
                                    <?
                                }
                                ?>
                            <td width="60" rowspan="2" align="center"><strong>Total</strong></td>
                            <td rowspan="2" align="center"><strong>Extra %</strong></td>
                        </tr>
                        <tr>
                            <td style="font-size:12px"><? echo $body_val; ?> Size</td>
                            <?
                            foreach($collar_cuff_item_size_arr[$body_val]  as $size_number_id=>$size_number)
                            {
                                if(count($size_number)>0)
                                {
                                     foreach($size_number  as $item_size=>$val)
                                     {
                                        ?>
                                        <td align="center" style="border:1px solid black"><strong><? echo $item_size;?></strong></td>
                                        <?
                                     }
                                }
                                else
                                {
                                    ?>
                                    <td align="center" style="border:1px solid black"><strong>&nbsp;</strong></td>
                                    <?
                                }
                            }
                            ?>
                        </tr>
                            <?

                            $pre_size_total_arr=array();
                            foreach($color_size_sensitive_arr[$body_val] as $pre_cost_id=>$pre_cost_data)
                            {
                                foreach($pre_cost_data as $color_number_id=>$color_number_data)
                                {
                                    foreach($color_number_data as $color_size_sensitive=>$color_break_down)
                                    {
                                        $pre_color_total_collar=0;
                                        $pre_color_total_collar_order_qnty=0;
                                        $process_loss_method=$process_loss_method;
                                        $constrast_color_arr=array();
                                        if($color_size_sensitive==3)
                                        {
                                            $constrast_color=explode('__',$color_break_down);
                                            for($i=0;$i<count($constrast_color);$i++)
                                            {
                                                $constrast_color2=explode('_',$constrast_color[$i]);
                                                $constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
                                            }
                                        }
                                        ?>
                                        <tr>
                                            <td>
                                                <?
                                                if( $color_size_sensitive==3)
                                                {
                                                    echo strtoupper ($constrast_color_arr[$color_number_id]) ;
                                                    $lab_dip_color_id=$lab_dip_color_arr[$pre_cost_id][$color_number_id];
                                                }
                                                else
                                                {
                                                    echo $color_library[$color_number_id];
                                                    $lab_dip_color_id=$color_number_id;
                                                }
                                                ?>
                                            </td>
                                            <?
                                            foreach($collar_cuff_size_arr[$body_type][$body_val] as $size_number_id)
                                            {
                                                ?>
                                                <td align="center" style="border:1px solid black">
                                                    <? $plan_cut=0; $collerqty=0; $collar_ex_per=0;
                                                    $plan_cut=0;
                                                    foreach($gmtsItemId as $giid)
                                                    {
                                                        if($body_type==50) $plan_cut+=($order_plan_qty_arr[$giid][$color_number_id][$size_number_id]['plan'])*2;
                                                        else $plan_cut+=$order_plan_qty_arr[$giid][$color_number_id][$size_number_id]['plan'];
                                                    }
                                                    
                                                    //$ord_qty=$order_plan_qty_arr[$color_number_id][$size_number_id]['order'];

                                                    $collar_ex_per=$collar_cuff_percent_arr[$body_type][$body_val][$color_number_id][$size_number_id];
                                                    // echo $collar_ex_per.'=';

                                                    if($body_type==50) { if($collar_ex_per==0 || $collar_ex_per=="") $collar_ex_per=$cuff_excess_percent; else $collar_ex_per=$collar_ex_per; }
                                                    else if($body_type==40) { if($collar_ex_per==0 || $collar_ex_per=="") $collar_ex_per=$colar_excess_percent; else $collar_ex_per=$collar_ex_per; }
                                                    $colar_excess_per=number_format(($plan_cut*$collar_ex_per)/100,6,".",",");
                                                    $collerqty=($plan_cut+$colar_excess_per);

                                                    //$collerqty=number_format(($requirment/$costing_per_qnty)*$plan_cut,2,'.','');

                                                    echo number_format($collerqty);
                                                    $pre_size_total_arr[$size_number_id]+=$collerqty;
                                                    $pre_color_total_collar+=$collerqty;
                                                    $pre_color_total_collar_order_qnty+=$plan_cut;

                                                    //$pre_grand_tot_collar_order_qty+=$plan_cut;
                                                    ?>
                                                </td>
                                                <?
                                            }
                                            ?>

                                            <td align="center"><? echo number_format($pre_color_total_collar); ?></td>
                                            <td align="center"><? echo number_format((($pre_color_total_collar-$pre_color_total_collar_order_qnty)/$pre_color_total_collar_order_qnty)*100,2); ?></td>
                                        </tr>
                                        <?
                                        $pre_grand_collar_ex_per+=$collar_ex_per;
                                        $pre_grand_tot_collar+=$pre_color_total_collar;
                                        $pre_grand_tot_collar_order_qty+=$pre_color_total_collar_order_qnty;
                                    }
                                }
                            }
                            ?>
                        
                        <tr>
                            <td>Size Total</td>
                                <?
                               // foreach($pre_size_total_arr  as $size_qty)
                               // {
                                    foreach($collar_cuff_size_arr[$body_type][$body_val] as $size_number_id)
                                    {
                                        $size_qty=$pre_size_total_arr[$size_number_id];
                                        ?>
                                        <td style="border:1px solid black;  text-align:center"><? echo number_format($size_qty); ?></td>
                                        <?
                                    }

                               // }
                                ?>
                            <td style="border:1px solid black; text-align:center"><? echo number_format($pre_grand_tot_collar); ?></td>
                            <td align="center" style="border:1px solid black"><? echo number_format((($pre_grand_tot_collar-$pre_grand_tot_collar_order_qty)/$pre_grand_tot_collar_order_qty)*100,2); ?></td>
                        </tr>
                    </table>
                </div>
                <br/>
                <?
            }
        }

        ?>

             <table width="98%">
                <tr>
                    <td width="45%" style="float: left;">
                        <?php 

                            $sql_purchase="SELECT a.booking_no, a.uom, sum(b.fin_fab_qnty) as qnty , b.construction, b.copmposition, b.gsm_weight as dia, b.dia_width as gsm from wo_booking_mst a, wo_booking_dtls b where     a.booking_no = b.booking_no and a.fabric_source = 2 and b.job_no = '$txt_job_no' and b.status_active = 1 and b.is_deleted = 0 and a.status_active = 1 and a.is_deleted = 0 and  a.booking_type=1 group by a.booking_no, a.uom, b.construction, b.copmposition, b.dia, b.gsm_weight, b.dia_width"; 
                            //echo $sql_purchase;
                            $purchase_res=sql_select($sql_purchase);
                            ?>
                            <table  width="98%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">

                               <thead>
                                   <tr align="center">
                                        <th colspan="5"><b>Purchased Booking Info</b></th>
                                    </tr>
                                    <tr align="center">
                                        <th>Sl</th>
                                        <th>Booking No</th>
                                        <th>Fabric Data</th>
                                        <th>UOM</th>
                                        <th>Qnty</th>
                                       
                                    </tr>
                               </thead>
                               <tbody>
                                    <?

                                        foreach ($purchase_res as  $row) 
                                        {
                                            ?>
                                            <tr>
                                                <td><?=$p++;?></td>
                                                <td><p><?=$row[csf('booking_no')];?></p></td>
                                                <td><p><?=$row[csf('construction')] .", ".$row[csf('copmposition')].", ".$row[csf('gsm')].", ".$row[csf('dia')];?></p></td>
                                                <td><p><?=$unit_of_measurement[$row[csf('uom')]];?></p></td>
                                                <td><p><?=number_format($row[csf('qnty')],2);?></p></td>
                                            </tr>
                                            <?
                                        }


                                    ?>
                               </tbody>
                               
                        </table>

                         
                    </td>
                    <td width="45%" style="float: right;">
                         <table  width="98%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">

                               <tr align="center">
                                    <td colspan="10"><b>Dyes To Match</b></td>
                                </tr>
                                <tr align="center">
                                    <td>Sl</td>
                                    <td>Item</td>
                                    <td>Item Description</td>
                                    <td>Body Color</td>
                                    <td>Item Color</td>
                                    <td>Finish Qty.</td>
                                    <td>UOM</td>
                                </tr>
                                <?
                                $lib_item_group_arr=return_library_array( "select item_name, id from lib_item_group where item_category=4 and is_deleted=0  and  status_active=1 order by item_name", "id", "item_name");
                                $sql=sql_select("select id from wo_booking_mst where booking_no='$txt_booking_no'");
                                $bookingId=0;
                                foreach($sql as $row){
                                    $bookingId= $row[csf('id')];
                                }
                                $co=0;
                                $sql_data=sql_select("select a.fabric_color,a.item_color,a.precost_trim_cost_id,b.trim_group,b.cons_uom,sum(qty) as qty, b.description   from wo_dye_to_match a, wo_pre_cost_trim_cost_dtls b where a.precost_trim_cost_id=b.id and a.booking_id=$bookingId and a.qty>0 and a.status_active=1 and b.status_active=1  group by a.fabric_color,a.item_color,a.precost_trim_cost_id,b.trim_group,b.cons_uom, b.description order by a.fabric_color");

                                foreach($sql_data  as $row)
                                {
                                    $co++;
                                    ?>
                                    <tr>
                                    <td><? echo $co; ?></td>
                                    <td> <? echo $lib_item_group_arr[$row[csf('trim_group')]];?></td>
                                    <td><p> <? echo $row[csf('description')];?></p></td>
                                    <td><? echo $color_library[$row[csf('fabric_color')]];?></td>
                                    <td><? echo $color_library[$row[csf('item_color')]];?></td>
                                    <td align="right"><? echo $row[csf('qty')];?></td>
                                    <td><? echo $unit_of_measurement[$row[csf('cons_uom')]];?></td>
                                    </tr>

                                    <?
                                }
                                ?>
                        </table>
                    </td>
                </tr>
             </table>
            <br>

        <?

         $condition= new condition();
        if(str_replace("'","",$txt_order_no_id) !=''){
            $condition->po_id("in(".str_replace("'","",$txt_order_no_id).")");
        }

        $condition->init();
        $cos_per_arr=$condition->getCostingPerArr();
        $yarn= new yarn($condition);
        $yarn_data_array=$yarn->getCountCompositionPercentTypeColorAndRateWiseYarnQtyAndAmountArray();
        $yarn_count_arr=return_library_array( "select id,yarn_count from lib_yarn_count",'id','yarn_count');

        $yarn_sql_array=sql_select("SELECT min(a.id) as id ,a.count_id, a.copm_one_id, a.percent_one, a.color, a.type_id, sum(a.cons_qnty) as yarn_required, a.rate  from wo_pre_cost_fab_yarn_cost_dtls a, wo_booking_dtls b where a.job_no=b.job_no and a.fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and a.job_no='$job_no' and b.booking_no='$txt_booking_no'  and  a.status_active=1 and a.is_deleted=0 group by a.count_id,a.copm_one_id,a.percent_one,a.color,a.type_id,a.rate order by id");
        ?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" style="font-family:Arial Narrow;font-size:18px;" >
            <tr>
                <td width="49%" valign="top">
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td colspan="7"><b>Yarn Required Summary (Pre Cost)</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Yarn Description</td>
                    <td>Brand</td>
                    <td>Lot</td>
                    <?
                    if($show_yarn_rate==1)
                    {
                    ?>
                    <td>Rate</td>
                    <?
                    }
                    ?>
                    <td>Cons for <? echo $costing_per; ?> Gmts</td>
                    <td>Total (KG)</td>
                    </tr>
                    <?
                    $i=0;
                    $total_yarn=0;
                    foreach($yarn_sql_array  as $row)
                    {

                        $i++;
                        $rowcons_qnty = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['qty'];
                        $rowcons_Amt = $yarn_data_array[$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("percent_one")]][$row[csf("type_id")]][$row[csf("color")]][$row[csf("rate")]]['amount'];


                        $rate=$rowcons_Amt/$rowcons_qnty;
                        $rowcons_qnty =($rowcons_qnty/100)*$booking_percent;
                    ?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
                    <?
                    $yarn_des=$yarn_count_arr[$row[csf('count_id')]]." ".$composition[$row[csf('copm_one_id')]]." ".$row[csf('percent_one')]."%  ";
                    $yarn_des.=$color_library[$row[csf('color')]]." ";
                    $yarn_des.=$yarn_type[$row[csf('type_id')]];
                    echo $yarn_des;
                    ?>
                    </td>
                    <td></td>
                    <td></td>
                    <?
                    if($show_yarn_rate==1)
                    {
                    ?>
                     <td><? echo number_format($row[csf('rate')],4); ?></td>
                     <?
                    }
                     ?>
                    <td><?  echo number_format(($rowcons_qnty/$po_qnty_tot)*$cos_per_arr[$job_no],4);//echo number_format($row[csf('yarn_required')],4); ?></td>

                    <td align="right">
                    <? echo number_format($rowcons_qnty,2); $total_yarn+=$rowcons_qnty; ?></td>
                    </tr>
                    <?
                    }
                    ?>
                    <tr align="center">
                    <td>Total</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <?
                    if($show_yarn_rate==1)
                    {
                    ?>
                    <td></td>
                    <?
                    }
                    ?>
                    <td></td>
                    <td align="right"><? echo number_format($total_yarn,2); ?></td>
                    </tr>
                    </table>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top" align="center">
                <?
                $yarn_sql_array=sql_select("SELECT min(a.id) as id, a.item_id, sum(a.qnty) as qnty ,min(b.supplier_id) as supplier_id,min(b.lot) as lot from inv_material_allocation_dtls a,product_details_master b where a.item_id=b.id and a.booking_no='$txt_booking_no' and  a.status_active=1 and a.is_deleted=0 group by a.item_id order by a.id");
                if(count($yarn_sql_array)>0)
                {
                ?>
                   <table  width="100%"  style="font-size:18px;" border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
                    <tr align="center">
                    <td colspan="7"><b>Allocated Yarn</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Yarn Description</td>
                    <td>Brand</td>
                    <td>Lot</td>


                    <td>Allocated Qty (Kg)</td>
                    </tr>
                    <?
                    $total_allo=0;
                    $item=return_library_array( "select id, product_name_details from   product_details_master",'id','product_name_details');
                    $supplier=return_library_array( "select id, short_name from   lib_supplier",'id','short_name');
                    $i=0;
                    $total_yarn=0;
                    foreach($yarn_sql_array  as $row)
                    {

                        $i++;
                    ?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
                    <?

                    echo $item[$row[csf('item_id')]];
                    ?>
                    </td>
                    <td>
                    <?

                    echo $supplier[$row[csf('supplier_id')]];
                    ?>
                    </td>
                    <td>
                    <?

                    echo $row[csf('lot')];
                    ?>
                    </td>
                    <td align="right"><? echo number_format($row[csf('qnty')],4); $total_allo+= $row[csf('qnty')];?></td>
                    </tr>
                    <?
                    }
                    ?>
                    <tr align="center">
                    <td>Total</td>
                    <td></td>


                    <td></td>
                    <td></td>
                    <td align="right"><? echo number_format($total_allo,4); ?></td>
                    </tr>
                    </table>
                    <?
                }
                else
                {
                    $is_yarn_allocated=return_field_value("allocation", "variable_settings_inventory", "company_name=$cbo_company_name and variable_list=18 and item_category_id=1");
                    if($is_yarn_allocated==1)
                    {
                    ?>
                    <font style=" font-size:30px"><b> </b></font>
                    <?
                    }
                    else
                    {
                        echo "";
                    }
                }
                    ?>
                </td>
                 <td width="49%" valign="top" align="center">
                    
                
                </td>
            </tr>
        </table>
        <br/>
        <?
        $sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and     is_deleted=0");
        ?>
        <table  width="100%"  border="0" cellpadding="0" cellspacing="0" style="font-family:Arial Narrow;font-size:18px;">
            <tr>
                <td width="49%" valign="top">
                <?
                if(count($sql_embelishment)>0)
                {
                ?>
                    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" style="font-family:Arial Narrow;font-size:18px;">
                    <tr align="center">
                    <td colspan="7"><b>Embelishment (Pre Cost)</b></td>

                    </tr>
                    <tr align="center">
                    <td>Sl</td>
                    <td>Embelishment Name</td>
                    <td>Embelishment Type</td>
                    <td>Cons <? echo $costing_per; ?> Gmts</td>
                    <td>Rate</td>
                    <td>Amount</td>

                    </tr>
                    <?
                    $sql_embelishment=sql_select("select emb_name,emb_type,cons_dzn_gmts,rate,amount from wo_pre_cost_embe_cost_dtls where job_no='$job_no' and status_active=1 and     is_deleted=0");
                    $i=0;
                    //$total_yarn=0;
                    foreach($sql_embelishment  as $row_embelishment)
                    {

                        $i++;
                    ?>
                    <tr align="center">
                    <td><? echo $i; ?></td>
                    <td>
                    <?
                    echo $emblishment_name_array[$row_embelishment[csf('emb_name')]];
                    ?>
                    </td>
                    <td>
                    <?
                    if($row_embelishment[csf('emb_name')]==1)
                    {
                    echo $emblishment_print_type[$row_embelishment[csf('emb_type')]];
                    }
                    if($row_embelishment[csf('emb_name')]==2)
                    {
                    echo $emblishment_embroy_type[$row_embelishment[csf('emb_type')]];
                    }
                    if($row_embelishment[csf('emb_name')]==3)
                    {
                    echo $emblishment_wash_type[$row_embelishment[csf('emb_type')]];
                    }
                    if($row_embelishment[csf('emb_name')]==4)
                    {
                    echo $emblishment_spwork_type[$row_embelishment[csf('emb_type')]];
                    }
                    if($row_embelishment[csf('emb_name')]==5)
                    {
                    echo $emblishment_gmts_type[$row_embelishment[csf('emb_type')]];
                    }
                    ?>

                    </td>
                    <td>
                    <?
                    echo $row_embelishment[csf('cons_dzn_gmts')];
                    ?>
                    </td>
                    <td>
                    <?
                    echo $row_embelishment[csf('rate')];
                    ?>
                    </td>

                    <td>
                    <?
                    echo $row_embelishment[csf('amount')];
                    ?>
                    </td>


                    </tr>
                    <?
                    }
                    ?>

                    </table>
                    <?
                }
                    ?>
                </td>
                <td width="2%">
                </td>
                <td width="49%" valign="top" align="center">
                                <?
                                $lib_designation_arr=return_library_array(" select id,custom_designation from lib_designation","id","custom_designation");
                                     $user_lib_designation_arr=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
                                     $user_lib_name_arr=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");

                                $mst_id=return_field_value("id as mst_id","wo_booking_mst","booking_no='$txt_booking_no'","mst_id");
                                 $unapprove_data_array=sql_select("select b.approved_by,b.approved_date,b.un_approved_reason,b.un_approved_date,b.approved_no from   approval_history b where b.mst_id=$mst_id and b.entry_form=7  order by b.approved_date,b.approved_by");


                                if(count($unapprove_data_array)>0)
                                {
                                $sql_unapproved=sql_select("select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=7 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id=$mst_id");
                                    $unapproved_request_arr=array();
                                    foreach($sql_unapproved as $rowu)
                                    {
                                        $unapproved_request_arr[$rowu[csf('booking_id')]]=$rowu[csf('approval_cause')];
                                    }
                                ?>
                               <table  width="100%" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
                                    <thead>
                                    <tr style="border:1px solid black;">
                                        <th colspan="6" style="border:1px solid black;">Approval/Un Approval History</th>
                                        </tr>
                                        <tr style="border:1px solid black;">
                                        <th width="3%" style="border:1px solid black;">Sl</th>
                                        <th width="30%" style="border:1px solid black;">Name</th>
                                        <th width="20%" style="border:1px solid black;">Designation</th>
                                        <th width="5%" style="border:1px solid black;">Approval Status</th>
                                        <th width="20%" style="border:1px solid black;">Reason For Un Approval</th>
                                        <th width="22%" style="border:1px solid black;"> Date</th>

                                        </tr>
                                    </thead>
                                    <tbody>
                                    <?
                                    $i=1;
                                    foreach($unapprove_data_array as $row){

                                    ?>
                                    <tr style="border:1px solid black;">
                                        <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
                                        <td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
                                        <td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
                                        <td width="5%" style="border:1px solid black; text-align:center"><? echo 'Yes';?></td>
                                        <td width="20%" style="border:1px solid black;"><? echo '';?></td>
                                        <td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); else echo "";?></td>
                                    </tr>
                                        <?
                                        $i++;
                                        $un_approved_date= explode(" ",$row[csf('un_approved_date')]);
                                        $un_approved_date=$un_approved_date[0];
                                        if($db_type==0) //Mysql
                                        {
                                            if($un_approved_date=="" || $un_approved_date=="0000-00-00") $un_approved_date="";else $un_approved_date=$un_approved_date;
                                        }
                                        else
                                        {
                                            if($un_approved_date=="") $un_approved_date="";else $un_approved_date=$un_approved_date;
                                        }

                                        if($un_approved_date!="")
                                        {
                                        ?>
                                    <tr style="border:1px solid black;">
                                        <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
                                        <td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
                                        <td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
                                        <td width="5%" style="border:1px solid black;text-align:center;"><? echo 'No';?></td>
                                        <td width="20%" style="border:1px solid black;text-align:center"><? echo $unapproved_request_arr[$mst_id];?></td>
                                        <td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('un_approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('un_approved_date')])); else echo "";?></td>
                                      </tr>

                                        <?
                                        $i++;
                                        }

                                    }
                                        ?>
                                    </tbody>
                                </table>
                                <?
                                }
                                ?>

                </td>
            </tr>
        </table>
        <br/>
        <table  width="100%" style="margin: 0px;padding: 0px;">
        <?php $stripe_color_wise=array(); ?>
       
        <tr>
            <td width="70%" style="float: left;">
                <table  class="rpt_table" border="1" cellpadding="1" cellspacing="1" rules="all" width="100%"   style="font-family:Arial Narrow;font-size:18px;margin: 0px;padding: 0px;" >
                       
                        <tr>
                            <td align="center" colspan="9">  Stripe Details</td>
                            
                        </tr>
                        <?
                        $color_name_arr=return_library_array( "select id,color_name from lib_color",'id','color_name');
                        $sql_stripe=("select c.id,c.composition,c.construction,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,sum(b.grey_fab_qnty) as fab_qty,b.dia_width,d.color_number_id as color_number_id,d.id as did,d.stripe_color,d.fabreqtotkg as fabreqtotkg ,d.measurement as measurement ,d.yarn_dyed,d.uom  from wo_booking_dtls b, wo_pre_cost_fabric_cost_dtls c,wo_pre_stripe_color d where c.id=b.pre_cost_fabric_cost_dtls_id and c.job_no=b.job_no and d.pre_cost_fabric_cost_dtls_id=c.id and d.pre_cost_fabric_cost_dtls_id=b.pre_cost_fabric_cost_dtls_id and b.job_no=d.job_no and b.job_no='$job_no'  and d.job_no='$job_no' and b.booking_no='$txt_booking_no'  and c.color_type_id in (2,6,33,34) and b.status_active=1  and c.is_deleted=0 and c.status_active=1  and d.is_deleted=0 and d.status_active=1  and  b.is_deleted=0  group by c.id,c.body_part_id,c.fabric_description,c.gsm_weight,c.color_type_id,d.color_number_id,d.id,d.stripe_color,d.yarn_dyed,d.fabreqtotkg ,d.measurement,d.uom,c.composition,c.construction,b.dia_width order by d.id ");                      
                        $result_data=sql_select($sql_stripe);
                        foreach($result_data as $row)
                        {
                            $stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['stripe_color'][$row[csf('did')]]=$row[csf('stripe_color')];
                            $stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['measurement'][$row[csf('did')]]=$row[csf('measurement')];
                            $stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['uom'][$row[csf('did')]]=$row[csf('uom')];
                            $stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['fabreqtotkg'][$row[csf('did')]]=$row[csf('fabreqtotkg')];
                            $stripe_arr[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['yarn_dyed'][$row[csf('did')]]=$row[csf('yarn_dyed')];

                            $stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['composition']=$row[csf('composition')];
                            $stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['construction']=$row[csf('construction')];
                            $stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['gsm_weight']=$row[csf('gsm_weight')];
                            $stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['color_type_id']=$row[csf('color_type_id')];
                            $stripe_arr2[$row[csf('body_part_id')]][$row[csf('color_number_id')]]['dia_width']=$row[csf('dia_width')];
                        }
                        ?>
                            <tr>
                                <td align="center" width="30"> SL</td>
                                <td align="center" width="100"> Body Part</td>
                                <td align="center" width="80"> Fabric Color</td>
                                <td align="center" width="70"> Fabric Qty(KG)</td>
                                <td align="center" width="70"> Stripe Color</td>
                                <td align="center" width="70"> Stripe Measurement</td>
                                <td align="center" width="70"> Stripe Uom</td>
                                <td  align="center" width="70"> Qty.(KG)</td>
                                <td  align="center" width="70"> Y/D Req.</td>
                            </tr>
                            <?
                            //if($db_type==0) $color_cond="d.fabric_color_id='".$color_id."'";
                            //else if($db_type==2) $color_cond="nvl(d.fabric_color_id,0)=nvl('".$color_id."',0)";
                                //else if($db_type==2) $color_cond="nvl(d.fabric_color_id,0)=nvl('".$color_id."',0)";


                            $i=1;$total_fab_qty=0;$total_fabreqtotkg=0;$fab_data_array=array();
                            foreach($stripe_arr as $body_id=>$body_data)
                            {
                                foreach($body_data as $color_id=>$color_val)
                                {
                                    $rowspan=count($color_val['stripe_color']);
                                    $composition=$stripe_arr2[$body_id][$color_id]['composition'];
                                    $construction=$stripe_arr2[$body_id][$color_id]['construction'];
                                    $gsm_weight=$stripe_arr2[$body_id][$color_id]['gsm_weight'];
                                    $color_type_id=$stripe_arr2[$body_id][$color_id]['color_type_id'];
                                    $dia_width=$stripe_arr2[$body_id][$color_id]['dia_width'];

                                    if($db_type==0) $color_cond="d.fabric_color_id='".$color_id."'";
                                    else if($db_type==2) $color_cond="nvl(d.fabric_color_id,0)=nvl('".$color_id."',0)";

                                    $color_wise_wo_sql_qnty=sql_select("select  sum(d.fin_fab_qnty) as fin_fab_qnty,sum(d.grey_fab_qnty) as grey_fab_qnty FROM wo_pre_cost_fabric_cost_dtls a, wo_po_color_size_breakdown c, wo_pre_cos_fab_co_avg_con_dtls b, wo_booking_dtls d
                                        WHERE a.job_no=b.job_no and
                                        a.id=b.pre_cost_fabric_cost_dtls_id and
                                        c.job_no_mst=a.job_no and
                                        c.id=b.color_size_table_id and
                                        b.po_break_down_id=d.po_break_down_id and
                                        b.color_size_table_id=d.color_size_table_id and b.pre_cost_fabric_cost_dtls_id=d.pre_cost_fabric_cost_dtls_id and
                                        d.booking_no ='$txt_booking_no' and
                                        a.body_part_id='".$body_id."' and
                                        a.color_type_id='".$color_type_id."' and
                                        a.construction='".$construction."' and
                                        a.composition='".$composition."' and
                                        a.gsm_weight='".$gsm_weight."' and
                                        $color_cond and
                                        d.status_active=1 and
                                        d.is_deleted=0
                                        ");
                                
                                        list($color_wise_wo_result_qnty)=$color_wise_wo_sql_qnty;
                                    ?>
                                    <tr>
                                        <?
                                        $color_qty=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
                                        ?>
                                        <td rowspan="<? echo $rowspan;?>"> <? echo $i; ?></td>
                                        <td rowspan="<? echo $rowspan;?>"> <? echo $body_part[$body_id]; ?></td>
                                        <td rowspan="<? echo $rowspan;?>"> <? echo $color_name_arr[$color_id]; ?></td>
                                        <td rowspan="<? echo $rowspan;?>" align="right"> <? echo number_format($color_qty,2); ?>&nbsp; </td>
                                        <?
                                        $total_fab_qty+=$color_wise_wo_result_qnty[csf('grey_fab_qnty')];
                                        $sk=0;
                                        foreach($color_val['stripe_color'] as $strip_color_id=>$s_color_val)
                                        {

                                            $measurement=$color_val['measurement'][$strip_color_id];
                                            $uom=$color_val['uom'][$strip_color_id];
                                            $fabreqtotkg=$color_val['fabreqtotkg'][$strip_color_id];
                                            $yarn_dyed=$color_val['yarn_dyed'][$strip_color_id];
                                            if($sk>0)
                                            {
                                                echo "<tr>";
                                            }
                                            ?>
                                        
                                                <td><?  echo  $color_name_arr[$s_color_val]; ?></td>
                                                <td align="right"> <? echo  number_format($measurement,2); ?> &nbsp; </td>
                                                <td> <? echo  $unit_of_measurement[$uom]; ?></td>
                                                <td align="right"> <? echo  number_format($fabreqtotkg,2); ?> &nbsp;</td>
                                                <td> <? echo  $yes_no[$yarn_dyed]; ?></td>
                                            
                                            <?
                                            if($sk>0)
                                            {
                                                echo "</tr>";
                                            }
                                            $sk++;
                                            $total_fabreqtotkg+=$fabreqtotkg;
                                            $stripe_color_wise[$color_name_arr[$s_color_val]]+=$fabreqtotkg;
                                        }
                                        $i++;
                                        ?>
                                    </tr>
                                    <?
                                }
                            }
                            ?>
                                <tfoot>
                                    <tr>
                                        <td colspan="3">Total </td>
                                        <td align="right">  <? echo  number_format($total_fab_qty,2); ?> &nbsp;</td>
                                        <td></td>
                                        <td></td>
                                        <td>   </td>
                                        <td align="right"><? echo  number_format($total_fabreqtotkg,2); ?> &nbsp;</td>
                                    </tr>
                                </tfoot>
                            </table>
            </td>
            
            <td width="20%" style="float: right;">
                        <table  class="rpt_table" border="1" cellpadding="1" cellspacing="1" rules="all" width="100%"   style="font-family:Arial Narrow;font-size:18px;margin: 0px;padding: 0px;"  >
                       

                        <tr>
                            <td align="left" colspan="3"> Stripe  Color wise Summary</td>
                            
                           
                           
                        </tr>
                        <?
                        
                        ?>
                            <tr>
                                <td width="30"> SL</td>
                                
                                <td width="70"> Stripe Color</td>
                               
                                <td  width="70"> Qty.(KG)</td>
                               
                            </tr>
                            <?

                            $i=1;$total_stripe_qnt=0;                           
                                foreach($stripe_color_wise as $color=>$val)
                                {
                                    
                                    
                                    ?>
                                    <tr>
                                        <td> <? echo $i; ?></td>
                                        
                                        <td > <? echo $color; ?></td>
                                        <td align="right"> <?php echo number_format($val,2); ?></td>
                                    </tr>
                                    
                                    <?
                                    $total_stripe_qnt+=$val;
                                    
                                    $i++;
                                }
                            
                            ?>
                            <tfoot>
                            <tr>
                            
                            <td></td>
                            <td></td>
                            
                            <td align="right"><? echo  number_format($total_stripe_qnt,2); ?> </td>
                            </tr>
                            </tfoot>
                            </table>
            </td>
        </tr>
         </table >
      
        <br/>
        <table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" style="font-family:Arial Narrow;font-size:18px;">
        <tr align="center">
        <td colspan="10"><b> Comments(Production) </b></td>
        </tr>
        <tr align="center">
        <td>Sl</td>
        <td>Po NO</td>
        <td>Ship Date</td>
        <td>Pre-Cost Qty</td>
        <td>Mn.Book Qty</td>
        <td>Sht.Book Qty</td>
        <td>Smp.Book Qty</td>
        <td>Tot.Book Qty</td>
        <td>Balance</td>
        <td>Comments</td>
        </tr>
        <?
        $cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
        $cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
        if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
        if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
        $paln_cut_qnty_array=return_library_array( "select min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id,size_number_id,item_number_id,po_break_down_id", "id", "plan_cut_qnty");
        $item_ratio_array=return_library_array( "select gmts_item_id,set_item_ratio from wo_po_details_mas_set_details  where job_no ='$txt_job_no'", "gmts_item_id", "set_item_ratio");

        $nameArray=sql_select("
        select
        a.id,
        a.item_number_id,
        a.costing_per,
        b.po_break_down_id,
        b.color_size_table_id,
        b.requirment,
        c.po_number
        FROM
        wo_pre_cost_fabric_cost_dtls a,
        wo_pre_cos_fab_co_avg_con_dtls b,
        wo_po_break_down c
        WHERE
        a.job_no=b.job_no and
        a.job_no=c.job_no_mst and
        a.id=b.pre_cost_fabric_cost_dtls_id and
        b.po_break_down_id=c.id and
        b.po_break_down_id in (".str_replace("'","",$txt_order_no_id).")  $cbo_fabric_natu $cbo_fabric_source_cond and a.status_active=1 and a.is_deleted=0
        order by id");

        $count=0;
        $tot_grey_req_as_pre_cost_arr=array();
        foreach ($nameArray as $result)
        {
        if (count($nameArray)>0 )
        {
        if($result[csf("costing_per")]==1)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(12*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==2)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(1*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==3)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(24*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==4)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(36*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==5)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(48*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        $tot_grey_req_as_pre_cost_arr[$result[csf("po_number")]]+=$tot_grey_req_as_pre_cost;
        }
        }

        $total_pre_cost=0;
        $total_booking_qnty_main=0;
        $total_booking_qnty_short=0;
        $total_booking_qnty_sample=0;
        $total_tot_bok_qty=0;
        $tot_balance=0;
        $booking_qnty_main=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and a.is_short=2 and c.item_category=2 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");

        $booking_qnty_short=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =1 and c.fabric_source=$cbo_fabric_source and c.item_category=2 and a.is_short=1 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
        $booking_qnty_sample=return_library_array( "select max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c  where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and a.booking_type =4 and c.fabric_source=$cbo_fabric_source and c.item_category=2  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
        $sql_data=sql_select( "select max(a.id) as id,  a.po_number,max(a.pub_shipment_date) as pub_shipment_date,sum(a.plan_cut) as plan_cut  from wo_po_break_down a,wo_pre_cost_sum_dtls b,wo_pre_cost_mst c where a.job_no_mst=b.job_no and a.job_no_mst=c.job_no and a.id in(".str_replace("'","",$txt_order_no_id).") group by a.po_number order by pub_shipment_date asc");
        foreach($sql_data  as $row)
        {
        $col++;
        ?>
        <tr align="center">
        <td><? echo $col; ?></td>
        <td><? echo $row[csf("po_number")]; ?></td>
        <td><? echo change_date_format($row[csf("pub_shipment_date")],"dd-mm-yyyy",'-'); ?></td>
        <td align="right"><? echo number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]],2); $total_pre_cost+=$tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]; ?></td>
        <td align="right"><? echo number_format($booking_qnty_main[$row[csf("id")]],2); $total_booking_qnty_main+=$booking_qnty_main[$row[csf("id")]];?></td>
        <td align="right"><? echo number_format($booking_qnty_short[$row[csf("id")]],2); $total_booking_qnty_short+=$booking_qnty_short[$row[csf("id")]];?></td>
        <td align="right"><? echo number_format($booking_qnty_sample[$row[csf("id")]],2); $total_booking_qnty_sample+=$booking_qnty_sample[$row[csf("id")]];?></td>
        <td align="right"><? $tot_bok_qty=$booking_qnty_main[$row[csf("id")]]+$booking_qnty_short[$row[csf("id")]]+$booking_qnty_sample[$row[csf("id")]]; echo number_format($tot_bok_qty,2); $total_tot_bok_qty+=$tot_bok_qty;?></td>
        <td align="right">
        <? $balance= def_number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]-$tot_bok_qty,2,""); echo number_format($balance,2); $tot_balance+= $balance?>
        </td>
        <td>
        <?
        if( $balance>0)
        {
        echo "Less Booking";
        }
        else if ($balance<0)
        {
        echo "Extra Booking";
        }
        else
        {
        echo "";
        }
        ?>
        </td>
        </tr>
        <?
        }
        ?>
        <tfoot>
        <tr>
        <td colspan="3">Total:</td>
        <td align="right"><? echo number_format($total_pre_cost,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_main,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_short,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_sample,2); ?></td>
        <td align="right"><? echo number_format($total_tot_bok_qty,2); ?></td>
        <td align="right"><? echo number_format($tot_balance,2); ?></td>
        <td></td>
        </tr>
        </tfoot>
        </table>

        <?
         if(count($purchase_res))
        {
            ?>
         <br/>
        <table width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" style="font-family:Arial Narrow;font-size:18px;">
        <tr align="center">
        <td colspan="10"><b> Comments(Purchase)</b></td>
        </tr>
        <tr align="center">
        <td>Sl</td>
        <td>Po NO</td>
        <td>Ship Date</td>
        <td>Pre-Cost Qty</td>
        <td>Purchase<br>Booking Qty</td>
        <td>Sht.Book Qty</td>
        <td>Smp.Book Qty</td>
        <td>Tot.Book Qty</td>
        <td>Balance</td>
        <td>Comments</td>
        </tr>
        <?
        $cbo_fabric_natu=str_replace("'","",$cbo_fabric_natu);
        $cbo_fabric_source=str_replace("'","",$cbo_fabric_source);
        if ($cbo_fabric_natu!=0) $cbo_fabric_natu="and a.fab_nature_id='$cbo_fabric_natu'";
        if ($cbo_fabric_source!=0) $cbo_fabric_source_cond="and a.fabric_source='$cbo_fabric_source'";
        $paln_cut_qnty_array=return_library_array( "SELECT min(id) as id,sum(plan_cut_qnty) as plan_cut_qnty from wo_po_color_size_breakdown  where po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and is_deleted=0 and status_active=1 group by color_number_id,size_number_id,item_number_id,po_break_down_id", "id", "plan_cut_qnty");
        $item_ratio_array=return_library_array( "select gmts_item_id,set_item_ratio from wo_po_details_mas_set_details  where job_no ='$txt_job_no'", "gmts_item_id", "set_item_ratio");

        $nameArray=sql_select("SELECT a.id, a.item_number_id, a.costing_per, b.po_break_down_id, b.color_size_table_id, b.requirment, c.po_number FROM wo_pre_cost_fabric_cost_dtls a, wo_pre_cos_fab_co_avg_con_dtls b, wo_po_break_down c WHERE a.job_no=b.job_no and a.job_no=c.job_no_mst and a.id=b.pre_cost_fabric_cost_dtls_id and b.po_break_down_id=c.id and c.job_no_mst = '$txt_job_no'  and a.fab_nature_id=3 and   a.fabric_source = '2'  and a.status_active=1 and a.is_deleted=0 order by id");

        $count=0;
        $tot_grey_req_as_pre_cost_arr=array();
        foreach ($nameArray as $result)
        {
        if (count($nameArray)>0 )
        {
        if($result[csf("costing_per")]==1)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(12*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==2)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(1*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==3)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(24*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==4)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(36*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        if($result[csf("costing_per")]==5)
        {
        $tot_grey_req_as_pre_cost=def_number_format((($paln_cut_qnty_array[$result[csf("color_size_table_id")]]/(48*$item_ratio_array[$result[csf("item_number_id")]]))*$result[csf("requirment")]),5,"");
        }
        $tot_grey_req_as_pre_cost_arr[$result[csf("po_number")]]+=$tot_grey_req_as_pre_cost;
        }
        }

        $total_pre_cost=0;
        $total_booking_qnty_main=0;
        $total_booking_qnty_short=0;
        $total_booking_qnty_sample=0;
        $total_tot_bok_qty=0;
        $tot_balance=0;
        $booking_qnty_main=return_library_array( "SELECT max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b, wo_booking_mst c where a.job_no =b.job_no_mst and   a.booking_no =c.booking_no  and a.po_break_down_id =b.id and a.job_no = '$txt_job_no' and a.booking_type =1  and c.fabric_source = 2  and a.is_short=2  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");


        $booking_qnty_short=return_library_array( "SELECT max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.job_no = '$txt_job_no' and a.booking_type =1 and c.fabric_source=2 and c.item_category=2 and a.is_short=1 and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
        $booking_qnty_sample=return_library_array( "SELECT max(a.po_break_down_id) as po_break_down_id ,sum(a.grey_fab_qnty) as grey_fab_qnty  from wo_booking_dtls a, wo_po_break_down b , wo_booking_mst c  where a.job_no =b.job_no_mst and  a.job_no =c.job_no and  a.booking_no =c.booking_no and a.po_break_down_id =b.id and a.job_no = '$txt_job_no' and a.booking_type =4 and c.fabric_source=2 and c.item_category=2  and a.status_active=1 and a.is_deleted=0 group by b.po_number order by po_break_down_id", "po_break_down_id", "grey_fab_qnty");
        $sql_data=sql_select( "SELECT max(a.id) as id,  a.po_number,max(a.pub_shipment_date) as pub_shipment_date,sum(a.plan_cut) as plan_cut  from wo_po_break_down a,wo_pre_cost_sum_dtls b,wo_pre_cost_mst c where a.job_no_mst=b.job_no and a.job_no_mst=c.job_no and a.job_no_mst='$txt_job_no' group by a.po_number order by pub_shipment_date asc");
        foreach($sql_data  as $row)
        {
        $col++;
        ?>
        <tr align="center">
        <td><? echo $col; ?></td>
        <td><? echo $row[csf("po_number")]; ?></td>
        <td><? echo change_date_format($row[csf("pub_shipment_date")],"dd-mm-yyyy",'-'); ?></td>
        <td align="right"><? echo number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]],2); $total_pre_cost+=$tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]; ?></td>
        <td align="right"><? echo number_format($booking_qnty_main[$row[csf("id")]],2); $total_booking_qnty_main+=$booking_qnty_main[$row[csf("id")]];?></td>
        <td align="right"><? echo number_format($booking_qnty_short[$row[csf("id")]],2); $total_booking_qnty_short+=$booking_qnty_short[$row[csf("id")]];?></td>
        <td align="right"><? echo number_format($booking_qnty_sample[$row[csf("id")]],2); $total_booking_qnty_sample+=$booking_qnty_sample[$row[csf("id")]];?></td>
        <td align="right"><? $tot_bok_qty=$booking_qnty_main[$row[csf("id")]]+$booking_qnty_short[$row[csf("id")]]+$booking_qnty_sample[$row[csf("id")]]; echo number_format($tot_bok_qty,2); $total_tot_bok_qty+=$tot_bok_qty;?></td>
        <td align="right">
        <? $balance= def_number_format($tot_grey_req_as_pre_cost_arr[$row[csf("po_number")]]-$tot_bok_qty,2,""); echo number_format($balance,2); $tot_balance+= $balance?>
        </td>
        <td>
        <?
        if( $balance>0)
        {
        echo "Less Booking";
        }
        else if ($balance<0)
        {
        echo "Extra Booking";
        }
        else
        {
        echo "";
        }
        ?>
        </td>
        </tr>
        <?
        }
        ?>
        <tfoot>
        <tr>
        <td colspan="3">Total:</td>
        <td align="right"><? echo number_format($total_pre_cost,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_main,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_short,2); ?></td>
        <td align="right"><? echo number_format($total_booking_qnty_sample,2); ?></td>
        <td align="right"><? echo number_format($total_tot_bok_qty,2); ?></td>
        <td align="right"><? echo number_format($tot_balance,2); ?></td>
        <td></td>
        </tr>
       
        </tfoot>
        </table>
         <?
            }
        ?>
       <br>

        <fieldset id="div_size_color_matrix" style="max-width:1000;">
        <?
        //------------------------------ Query for TNA start-----------------------------------
                $po_id_all=str_replace("'","",$txt_order_no_id);
                $po_num_arr=return_library_array("select id,po_number from wo_po_break_down where id in($po_id_all)",'id','po_number');
                $tna_start_sql=sql_select( "SELECT id,po_number_id,
                                (case when task_number=31 then task_start_date else null end) as fab_booking_start_date,
                                (case when task_number=31 then task_finish_date else null end) as fab_booking_end_date,
                                (case when task_number=60 then task_start_date else null end) as knitting_start_date,
                                (case when task_number=60 then task_finish_date else null end) as knitting_end_date,
                                (case when task_number=61 then task_start_date else null end) as dying_start_date,
                                (case when task_number=61 then task_finish_date else null end) as dying_end_date,
                                (case when task_number=64 then task_start_date else null end) as finishing_start_date,
                                (case when task_number=64 then task_finish_date else null end) as finishing_end_date,
                                (case when task_number=84 then task_start_date else null end) as cutting_start_date,
                                (case when task_number=84 then task_finish_date else null end) as cutting_end_date,
                                (case when task_number=86 then task_start_date else null end) as sewing_start_date,
                                (case when task_number=86 then task_finish_date else null end) as sewing_end_date,
                                (case when task_number=110 then task_start_date else null end) as exfact_start_date,
                                (case when task_number=110 then task_finish_date else null end) as exfact_end_date,
                                (case when task_number=47 then task_start_date else null end) as yarn_rec_start_date,
                                (case when task_number=47 then task_finish_date else null end) as yarn_rec_end_date
                                from tna_process_mst
                                where status_active=1 and po_number_id in($po_id_all)");
                $tna_fab_start=$tna_knit_start=$tna_dyeing_start=$tna_fin_start=$tna_cut_start=$tna_sewin_start=$tna_exfact_start="";
                $tna_date_task_arr=array();
                foreach($tna_start_sql as $row)
                {
                    if($row[csf("fab_booking_start_date")]!="" && $row[csf("fab_booking_start_date")]!="0000-00-00")
                    {
                        if($tna_fab_start=="")
                        {
                            $tna_fab_start=$row[csf("fab_booking_start_date")];
                        }
                    }


                    if($row[csf("knitting_start_date")]!="" && $row[csf("knitting_start_date")]!="0000-00-00")
                    {
                        $tna_date_task_arr[$row[csf("po_number_id")]]['knitting_start_date']=$row[csf("knitting_start_date")];
                        $tna_date_task_arr[$row[csf("po_number_id")]]['knitting_end_date']=$row[csf("knitting_end_date")];
                    }
                    if($row[csf("dying_start_date")]!="" && $row[csf("dying_start_date")]!="0000-00-00")
                    {
                        $tna_date_task_arr[$row[csf("po_number_id")]]['dying_start_date']=$row[csf("dying_start_date")];
                        $tna_date_task_arr[$row[csf("po_number_id")]]['dying_end_date']=$row[csf("dying_end_date")];
                    }
                    if($row[csf("finishing_start_date")]!="" && $row[csf("finishing_start_date")]!="0000-00-00")
                    {
                        $tna_date_task_arr[$row[csf("po_number_id")]]['finishing_start_date']=$row[csf("finishing_start_date")];
                        $tna_date_task_arr[$row[csf("po_number_id")]]['finishing_end_date']=$row[csf("finishing_end_date")];
                    }
                    if($row[csf("cutting_start_date")]!="" && $row[csf("cutting_start_date")]!="0000-00-00")
                    {
                        $tna_date_task_arr[$row[csf("po_number_id")]]['cutting_start_date']=$row[csf("cutting_start_date")];
                        $tna_date_task_arr[$row[csf("po_number_id")]]['cutting_end_date']=$row[csf("cutting_end_date")];
                    }

                    if($row[csf("sewing_start_date")]!="" && $row[csf("sewing_start_date")]!="0000-00-00")
                    {
                        $tna_date_task_arr[$row[csf("po_number_id")]]['sewing_start_date']=$row[csf("sewing_start_date")];
                        $tna_date_task_arr[$row[csf("po_number_id")]]['sewing_end_date']=$row[csf("sewing_end_date")];
                    }
                    if($row[csf("exfact_start_date")]!="" && $row[csf("exfact_start_date")]!="0000-00-00")
                    {
                        $tna_date_task_arr[$row[csf("po_number_id")]]['exfact_start_date']=$row[csf("exfact_start_date")];
                        $tna_date_task_arr[$row[csf("po_number_id")]]['exfact_end_date']=$row[csf("exfact_end_date")];
                    }
                    if($row[csf("yarn_rec_start_date")]!="" && $row[csf("yarn_rec_start_date")]!="0000-00-00")
                    {
                        $tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_start_date']=$row[csf("yarn_rec_start_date")];
                        $tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_end_date']=$row[csf("yarn_rec_end_date")];
                    }
                }

            //------------------------------ Query for TNA end-----------------------------------
        ?>
        <legend>TNA Information</legend>
        <!--<span style="font-size:180; font-weight:bold;"></span>-->
        <table width="100%" style="border:1px solid black;font-size:17px; font-family:Arial Narrow;" border="1" cellpadding="2" cellspacing="0" rules="all">
            <tr>
                <td rowspan="2" align="center" valign="top">SL</td>
                <td width="180" rowspan="2"  align="center" valign="top"><b>Order No</b></td>
                <td colspan="2" align="center" valign="top"><b>Yarn Receive</b></td>
                <td colspan="2" align="center" valign="top"><b>Knitting</b></td>
                <td colspan="2" align="center" valign="top"><b>Dyeing</b></td>
                <td colspan="2" align="center" valign="top"><b>Finish Fabric Prod.</b></td>
                <td colspan="2" align="center" valign="top"><b>Cutting </b></td>
                <td colspan="2" align="center" valign="top"><b>Sewing </b></td>
                <td colspan="2"  align="center" valign="top"><b>Ex-factory </b></td>
            </tr>
            <tr>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>
                <td width="85" align="center" valign="top"><b>Start Date</b></td>
                <td width="85" align="center" valign="top"><b>End Date</b></td>

            </tr>
            <?
            $i=1;
            foreach($tna_date_task_arr as $order_id=>$row)
            {
                 //$tna_date_task_arr//knitting_start_date dying_start_date finishing_start_date cutting_start_date sewing_start_date exfact_start_date
                ?>
                <tr>
                    <td><? echo $i; ?></td>
                    <td><? echo $po_num_arr[$order_id]; ?></td>
                    <td align="center"><? echo change_date_format($row['yarn_rec_start_date']); ?></td>
                    <td  align="center"><? echo change_date_format($row['yarn_rec_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['knitting_start_date']); ?></td>
                    <td  align="center"><? echo change_date_format($row['knitting_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['dying_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['dying_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['finishing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['cutting_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['cutting_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['sewing_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['sewing_end_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['exfact_start_date']); ?></td>
                    <td align="center"><? echo change_date_format($row['exfact_end_date']); ?></td>
                </tr>
                <?
                $i++;
            }
            ?>

        </table>
        </fieldset>
        <?
        }// fabric Source End
    $sql_data=sql_select("SELECT a.id as fabric_cost_dtls_id, a.item_number_id, a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,a.width_dia_type,a.uom,b.dia_width,b.pre_cost_remarks,b.fabric_color_id,b.remark, sum(b.grey_fab_qnty) as grey_fab_qnty,sum(b.adjust_qty)as adjust_qty,sum(b.fin_fab_qnty) as fin_fab_qnty,avg(b.rate) as rate,sum(b.grey_fab_qnty*b.rate) as amount FROM wo_pre_cost_fabric_cost_dtls a, wo_booking_dtls b WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and b.booking_no ='$txt_booking_no' and b.adjust_qty>0 and b.status_active=1 and b.is_deleted=0 group by a.id,a.item_number_id, a.body_part_id,a.color_type_id, a.construction, a.composition, a.gsm_weight,a.width_dia_type,a.uom,b.dia_width,b.pre_cost_remarks,b.fabric_color_id,b.remark order by a.id,a.body_part_id");

        ?>
        <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">

        <tr>
        <td colspan="7">
        <strong>Fabric Stock Adjustment Details</strong>
        </td>

        </tr>

        <tr>
        <td>
        Fabrication
        </td>
        <td>
        Process
        </td>
        <td>
        Fabric Color
        </td>
        <td>
        Required
        </td>
        <td>
        Stock Used
        </td>
        <td>
        Booking Qty
        </td><td>
        Uom
        </td>
         <td>
        Remarks
        </td>
        </tr>
        <?
        foreach($sql_data as $row){
        ?>
          <tr>
        <td>
        <? echo $body_part[$row[csf('body_part_id')]].",".$color_type[$row[csf('color_type_id')]].",".$row[csf('construction')].",".$row[csf('composition')].",".$row[csf('gsm_weight')].",".$fabric_typee[$row[csf('width_dia_type')]].",".$row[csf('dia_width')]  ?>
        </td>
        <td>
        <? echo $row[csf('pre_cost_remarks')];  ?>
        </td>
        <td>
        <? echo $color_library[$row[csf('fabric_color_id')]];  ?>
        </td>
        <td align="right">
        <? echo number_format($row[csf('grey_fab_qnty')],4);  ?>
        </td>
        <td align="right">
         <? echo number_format($row[csf('adjust_qty')],4) ; ?>
        </td>
        <td align="right">
       <? echo number_format($row[csf('fin_fab_qnty')],4);  ?>
        </td>
         <td>
        <? echo $unit_of_measurement[$row[csf('uom')]];  ?>
        </td>
         <td>
         <? echo $row[csf('remark')];  ?>
        </td>
        </tr>
        <?
        }
        ?>
        </table>


    <?
    //echo $cbo_fabric_source;
    if($cbo_fabric_source==1 || $cbo_fabric_source==2){
    ?>
    <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
    <tr>
    <?

    $nameArray_item_size=sql_select( "SELECT min(c.id) as id,b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no ='$txt_booking_no'  and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id  and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by id");
    if(count($nameArray_item_size)>0)
    {
    ?>
    <td width="49%">
    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
    <tr>
    <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Collar -  Colour Size Brakedown in Pcs</b></td>
    </tr>
    <tr>
    <td width="70">Size</td>
    <?
    foreach($nameArray_item_size  as $result_size)
    {
    ?>
    <td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
    <?
    }
    ?>
    <td rowspan="2" align="center"><strong>Total</strong></td>
    <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
    </tr>
    <tr>
    <td>Collar Size</td>

    <?
    foreach($nameArray_item_size  as $result_item_size)
    {
    ?>
    <td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
    <?
    }
    ?>
    <?
    $color_wise_wo_sql=sql_select("SELECT a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id,sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no ='$txt_booking_no' and a.body_part_id=2  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by c.color_number_id,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method order by a.id
    ");
    foreach($color_wise_wo_sql as $color_wise_wo_result)
    {
    $color_total_collar=0;
    $color_total_collar_order_qnty=0;
    $process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
    $constrast_color_arr=array();
    if($color_wise_wo_result[csf("color_size_sensitive")]==3)
    {
    $constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
    for($i=0;$i<count($constrast_color);$i++)
    {
    $constrast_color2=explode('_',$constrast_color[$i]);
    $constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
    }
    }
    ?>
    <tr>
    <td>
    <?
    if($color_wise_wo_result[csf("color_size_sensitive")]==3)
    {
    echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]) ;
    $lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
    }
    else
    {
    echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
    $lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
    }
    ?>
    </td>
    <?

    foreach($nameArray_item_size  as $result_size)
    {
         $sql_excess_per="select a.po_break_down_id,a.gmts_color_id,a.size_number_id,a.excess_per,b.body_part_id FROM wo_booking_colar_culff_dtls a,wo_pre_cost_fabric_cost_dtls b where
     a.booking_no ='$txt_booking_no' and a.pre_cost_fabric_cost_dtls_id=b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  a.size_number_id =".$result_size[csf('size_number_id')]." and a.gmts_color_id =".$color_wise_wo_result[csf('color_number_id')]." and b.body_part_id=2 and a.status_active=1 ";
    $resultData=sql_select($sql_excess_per);
    list($excess_percent)=$resultData;
    $colar_excess_percent=$excess_percent[csf('excess_per')];

    ?>
    <td align="center" style="border:1px solid black" title="<? echo $colar_excess_percentage;?>">
    <?


    $color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active!=0 and is_deleted =0");
    list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
    $plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
    $colar_excess_per=($plan_cut*$colar_excess_percent)/100;
    echo number_format($plan_cut+$colar_excess_per,0);
    $color_total_collar+=$plan_cut+$colar_excess_per;
    $color_total_collar_order_qnty+=$plan_cut;
    $grand_total_collar+=$plan_cut+$colar_excess_per;
    $grand_total_collar_order_qnty+=$plan_cut;
    ?>
    </td>
    <?
    }
    ?>
    <td align="center"><? echo number_format($color_total_collar,0); ?></td>
    <td align="center"><? echo number_format((($color_total_collar-$color_total_collar_order_qnty)/$color_total_collar_order_qnty)*100,2); ?></td>
    </tr>
    <?
    }
    ?>
    <tr>
    <td>Size Total</td>
    <?
    foreach($nameArray_item_size  as $result_size)
    {
    ?>
    <td style="border:1px solid black;  text-align:center"><? $colar_excess_pers=($size_tatal[$result_size[csf('size_number_id')]]*$colar_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]+$colar_excess_pers,0); ?></td>
    <?
    }
    ?>
    <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_collar,0); ?></td>
    <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_collar-$grand_total_collar_order_qnty)/$grand_total_collar_order_qnty)*100,2); ?></td>
    </tr>
    </table>
    </td>
    <td width="2%">
    </td>
    <?
    }
    ?>
    <?
    $nameArray_item_size=sql_select( "SELECT min(c.id) as id, b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no ='$txt_booking_no'  and a.body_part_id=3  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by id");

    if(count($nameArray_item_size)>0)
    {
    ?>
    <td width="49%">
    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
    <tr>
    <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Cuff -  Colour Size Brakedown in Pcs</b></td>
    </tr>
    <tr>
    <td width="70">Size</td>

    <?
    foreach($nameArray_item_size  as $result_size)
    {
    ?>
    <td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
    <?
    }
    ?>
    <td rowspan="2" align="center"><strong>Total</strong></td>
    <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
    </tr>
    <tr>
    <td>Cuff Size</td>

    <?
    foreach($nameArray_item_size  as $result_item_size)
    {
    ?>
    <td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
    <?
    }
    ?>
    <?
    $color_wise_wo_sql=sql_select("SELECT a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id,sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no ='$txt_booking_no' and a.body_part_id=3  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id and  d.status_active=1 and d.is_deleted=0 group by c.color_number_id ,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method order by a.id
    ");
    foreach($color_wise_wo_sql as $color_wise_wo_result)
    {
    $color_total_cuff=0;
    $color_total_cuff_order_qnty=0;
    $process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
    $constrast_color_arr=array();
    if($color_wise_wo_result[csf("color_size_sensitive")]==3)
    {
    $constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
    for($i=0;$i<count($constrast_color);$i++)
    {
    $constrast_color2=explode('_',$constrast_color[$i]);
    $constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
    }
    }
    ?>
    <tr>
    <td>
    <?
    if($color_wise_wo_result[csf("color_size_sensitive")]==3)
    {
    echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]);
    $lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
    }
    else
    {
    echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
    $lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
    }
    ?>
    </td>
    <?
    foreach($nameArray_item_size  as $result_size)
    {
         $sql_excess_cuff="select a.po_break_down_id,a.gmts_color_id,a.size_number_id,a.excess_per,b.body_part_id FROM wo_booking_colar_culff_dtls a,wo_pre_cost_fabric_cost_dtls b where
     a.booking_no ='$txt_booking_no' and a.pre_cost_fabric_cost_dtls_id=b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  a.size_number_id =".$result_size[csf('size_number_id')]." and a.gmts_color_id =".$color_wise_wo_result[csf('color_number_id')]." and b.body_part_id=3 and a.status_active=1 ";
    $resultData_cuff=sql_select($sql_excess_cuff);
    list($cuff_excess_percent)=$resultData_cuff;
    $cuff_excess_percent=$cuff_excess_percent[csf('excess_per')];
    ?>
    <td align="center" style="border:1px solid black">
    <?
    $color_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active!=0 and is_deleted =0");
    list($plan_cut_qnty)=$color_wise_wo_sql_qnty;
    $plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
    $cuff_excess_per=(($plan_cut*2)*$cuff_excess_percent)/100;
    echo number_format($plan_cut*2+$cuff_excess_per,0);
    $color_total_cuff+=$plan_cut*2+$cuff_excess_per;
    $color_total_cuff_order_qnty+=$plan_cut*2;
    $grand_total_cuff+=$plan_cut*2+$cuff_excess_per;
    $grand_total_cuff_order_qnty+=$plan_cut*2;
    ?>
    </td>
    <?
    }
    ?>
    <td align="center"><? echo number_format($color_total_cuff,0); ?></td>
    <td align="center"><? echo number_format((($color_total_cuff-$color_total_cuff_order_qnty)/$color_total_cuff_order_qnty)*100,2); ?></td>
    </tr>
    <?
    }
    ?>
    <tr>
    <td>Size Total</td>
    <?
    foreach($nameArray_item_size  as $result_size)
    {
    ?>
    <td style="border:1px solid black;  text-align:center"><? $cuff_excess_pers=(($size_tatal[$result_size[csf('size_number_id')]]*2)*$cuff_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]*2+$cuff_excess_pers,0); ?></td>
    <?
    }
    ?>
    <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_cuff,0); ?></td>
    <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_cuff-$grand_total_cuff_order_qnty)/$grand_total_cuff_order_qnty)*100,2); ?></td>
    </tr>
    </table>
    </td>
    <?
    }
    ?>
    </tr>
    </table>
    <br/>
    <table  width="100%"  border="0" cellpadding="0" cellspacing="0" >
    <tr>
    <?

    $nameArray_item_size=sql_select( "SELECT min(c.id) as id,b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no ='$txt_booking_no'  and a.body_part_id=172  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id  and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by id");
    if(count($nameArray_item_size)>0)
    {
    ?>
    <td width="49%">
    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
    <tr>
    <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Collar Tipping -  Colour Size Brakedown in Pcs</b></td>
    </tr>
    <tr>
    <td width="70">Size</td>
    <?
    foreach($nameArray_item_size  as $result_size)
    {
    ?>
    <td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
    <?
    }
    ?>
    <td rowspan="2" align="center"><strong>Total</strong></td>
    <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
    </tr>
    <tr>
    <td>Collar Size</td>
    <?
    foreach($nameArray_item_size  as $result_item_size)
    {
    ?>
    <td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
    <?
    }
    ?>
    <?
    $color_wise_wo_sql=sql_select("SELECT a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id,sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no ='$txt_booking_no' and a.body_part_id=172  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by c.color_number_id,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method order by a.id
    ");
    foreach($color_wise_wo_sql as $color_wise_wo_result)
    {
    $color_total_collar_tipping=0;
    $color_total_collar_tipping_order_qnty=0;
    $process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
    $constrast_color_arr=array();
    if($color_wise_wo_result[csf("color_size_sensitive")]==3)
    {
    $constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
    for($i=0;$i<count($constrast_color);$i++)
    {
    $constrast_color2=explode('_',$constrast_color[$i]);
    $constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
    }
    }
    ?>
    <tr>
    <td>
    <?
    if($color_wise_wo_result[csf("color_size_sensitive")]==3)
    {
    echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]) ;
    $lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
    }
    else
    {
    echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
    $lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
    }
    ?>
    </td>
    <?
    foreach($nameArray_item_size  as $result_size)
    {
        $sql_excess_collarTip="select a.po_break_down_id,a.gmts_color_id,a.size_number_id,a.excess_per,b.body_part_id FROM wo_booking_colar_culff_dtls a,wo_pre_cost_fabric_cost_dtls b where
     a.booking_no ='$txt_booking_no' and a.pre_cost_fabric_cost_dtls_id=b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  a.size_number_id =".$result_size[csf('size_number_id')]." and a.gmts_color_id =".$color_wise_wo_result[csf('color_number_id')]." and b.body_part_id=172 and a.status_active=1 ";
    $resultData_collar_tip=sql_select($sql_excess_collarTip);
    list($collarTip_excess_percent)=$resultData_collar_tip;
    $colar_excess_percent=$collarTip_excess_percent[csf('excess_per')];

    ?>
    <td align="center" style="border:1px solid black">
    <?
    $color_tipping_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active!=0 and is_deleted =0");

    list($plan_cut_qnty)=$color_tipping_wise_wo_sql_qnty;
    $plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
    $colar_excess_per=($plan_cut*$colar_excess_percent)/100;
    echo number_format($plan_cut+$colar_excess_per,0);
    $color_total_collar_tipping+=$plan_cut+$colar_excess_per;
    $color_total_collar_tipping_order_qnty+=$plan_cut;
    $grand_total_collar_tipping+=$plan_cut+$colar_excess_per;
    $grand_total_collar_tipping_order_qnty+=$plan_cut;
    ?>
    </td>
    <?
    }
    ?>
    <td align="center"><? echo number_format($color_total_collar_tipping,0); ?></td>
    <td align="center"><? echo number_format((($color_total_collar_tipping-$color_total_collar_tipping_order_qnty)/$color_total_collar_tipping_order_qnty)*100,2); ?></td>
    </tr>
    <?
    }
    ?>
    <tr>
    <td>Size Total</td>
    <?
    foreach($nameArray_item_size  as $result_size)
    {
    ?>
    <td style="border:1px solid black;  text-align:center"><? $colar_excess_pers=($size_tatal[$result_size[csf('size_number_id')]]*$colar_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]+$colar_excess_pers,0); ?></td>
    <?
    }
    ?>
    <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_collar_tipping,0); ?></td>
    <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_collar_tipping-$grand_total_collar_tipping_order_qnty)/$grand_total_collar_tipping_order_qnty)*100,2); ?></td>
    </tr>
    </table>
    </td>
    <td width="2%">
    </td>
    <?
    }
    ?>
    <?
    $nameArray_item_size=sql_select( "SELECT min(c.id) as id, b.item_size,c.size_number_id FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no ='$txt_booking_no'  and a.body_part_id=214  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id and d.status_active=1 and d.is_deleted=0 group by b.item_size,c.size_number_id order by id");
    if(count($nameArray_item_size)>0)
    {
    ?>
    <td width="49%">
    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
    <tr>
    <td colspan="<? echo count($nameArray_size)+4;?>" align="center"><b>Cuff Tipping -  Colour Size Brakedown in Pcs</b></td>
    </tr>
    <tr>
    <td width="70">Size</td>
    <?
    foreach($nameArray_item_size  as $result_size)
    {
    ?>
    <td align="center" style="border:1px solid black"><strong><? echo $size_library[$result_size[csf('size_number_id')]];?></strong></td>
    <?
    }
    ?>
    <td rowspan="2" align="center"><strong>Total</strong></td>
    <td width="60" rowspan="2" align="center"><strong>Extra %</strong></td>
    </tr>
    <tr>
    <td>Cuff Size</td>
    <?
    foreach($nameArray_item_size  as $result_item_size)
    {
    ?>
    <td align="center" style="border:1px solid black"><strong><? echo $result_item_size[csf('item_size')];?></strong></td>
    <?
    }
    ?>
    <?
    $color_wise_wo_sql=sql_select("SELECT a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method,c.color_number_id,sum(c.plan_cut_qnty) as plan_cut_qnty FROM wo_pre_cost_fabric_cost_dtls a,wo_pre_cos_fab_co_avg_con_dtls b, wo_po_color_size_breakdown c , wo_booking_dtls d WHERE a.job_no=b.job_no and a.id=b.pre_cost_fabric_cost_dtls_id and d.booking_no ='$txt_booking_no' and a.body_part_id=214  and c.job_no_mst=a.job_no and c.id=b.color_size_table_id and d.po_break_down_id=c.po_break_down_id and c.color_number_id=d.gmts_color_id and a.id=d.pre_cost_fabric_cost_dtls_id and  d.status_active=1 and d.is_deleted=0 group by c.color_number_id ,a.id,a.job_no, a.color_size_sensitive,a.color_break_down,a.process_loss_method order by a.id
    ");
    foreach($color_wise_wo_sql as $color_wise_wo_result)
    {
    $color_total_cuff_tipping=0;
    $color_total_cuff_tipping_order_qnty=0;
    $process_loss_method=$color_wise_wo_result[csf("process_loss_method")];
    $constrast_color_arr=array();
    if($color_wise_wo_result[csf("color_size_sensitive")]==3)
    {
    $constrast_color=explode('__',$color_wise_wo_result[csf("color_break_down")]);
    for($i=0;$i<count($constrast_color);$i++)
    {
    $constrast_color2=explode('_',$constrast_color[$i]);
    $constrast_color_arr[$constrast_color2[0]]=$constrast_color2[2];
    }
    }
    ?>
    <tr>
    <td>
    <?
    if($color_wise_wo_result[csf("color_size_sensitive")]==3)
    {
    echo strtoupper ($constrast_color_arr[$color_wise_wo_result[csf('color_number_id')]]);
    $lab_dip_color_id=return_field_value("contrast_color_id","wo_pre_cos_fab_co_color_dtls","job_no='".$color_wise_wo_result[csf('job_no')]."' and pre_cost_fabric_cost_dtls_id=".$color_wise_wo_result[csf('id')]." and gmts_color_id=".$color_wise_wo_result[csf('color_number_id')]."");
    }
    else
    {
    echo $color_library[$color_wise_wo_result[csf('color_number_id')]];
    $lab_dip_color_id=$color_wise_wo_result[csf('color_number_id')];
    }
    ?>
    </td>
    <?
    foreach($nameArray_item_size  as $result_size)
    {
        $sql_excess_cuffTip="select a.po_break_down_id,a.gmts_color_id,a.size_number_id,a.excess_per,b.body_part_id FROM wo_booking_colar_culff_dtls a,wo_pre_cost_fabric_cost_dtls b where
     a.booking_no ='$txt_booking_no' and a.pre_cost_fabric_cost_dtls_id=b.id and a.po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  a.size_number_id =".$result_size[csf('size_number_id')]." and a.gmts_color_id =".$color_wise_wo_result[csf('color_number_id')]." and b.body_part_id=214 and a.status_active=1 ";
    $resultData_cuff_tip=sql_select($sql_excess_cuffTip);
    list($cuffTip_excess_percent)=$resultData_cuff_tip;
    $cuff_excess_percent=$cuffTip_excess_percent[csf('excess_per')];

    ?>
    <td align="center" style="border:1px solid black">
    <?
    $cuff_tipping_wise_wo_sql_qnty=sql_select( "select sum(plan_cut_qnty) as plan_cut_qnty, sum(order_quantity) as order_quantity  from wo_po_color_size_breakdown where  po_break_down_id in(".str_replace("'","",$txt_order_no_id).") and  size_number_id =".$result_size[csf('size_number_id')]." and color_number_id =".$color_wise_wo_result[csf('color_number_id')]."   and  status_active!=0 and is_deleted =0");
    list($plan_cut_qnty)=$cuff_tipping_wise_wo_sql_qnty;
    $plan_cut=$plan_cut_qnty[csf('plan_cut_qnty')];
    $cuff_tipping_excess_per=(($plan_cut*2)*$cuff_excess_percent)/100;
    echo number_format($plan_cut*2+$cuff_tipping_excess_per,0);
    $color_total_cuff_tipping+=$plan_cut*2+$cuff_tipping_excess_per;
    $color_total_cuff_tipping_order_qnty+=$plan_cut*2;
    $grand_total_cuff_tipping+=$plan_cut*2+$cuff_excess_per;
    $grand_total_cuff_tipping_order_qnty+=$plan_cut*2;
    ?>
    </td>
    <?
    }
    ?>
    <td align="center"><? echo number_format($color_total_cuff_tipping,0); ?></td>
    <td align="center" title="<? echo $color_total_cuff_tipping."**".$color_total_cuff_tipping_order_qnty; ?>"><? echo number_format((($color_total_cuff_tipping-$color_total_cuff_tipping_order_qnty)/$color_total_cuff_tipping_order_qnty)*100,2); ?></td>
    </tr>
    <?
    }
    ?>
    <tr>
    <td>Size Total</td>
    <?
    foreach($nameArray_item_size  as $result_size)
    {
    ?>
    <td style="border:1px solid black;  text-align:center"><? $cuff_excess_pers=(($size_tatal[$result_size[csf('size_number_id')]]*2)*$cuff_excess_percent)/100; echo number_format($size_tatal[$result_size[csf('size_number_id')]]*2+$cuff_excess_pers,0); ?></td>
    <?
    }
    ?>
    <td  style="border:1px solid black;  text-align:center"><?  echo number_format($grand_total_cuff_tipping,0); ?></td>
    <td align="center" style="border:1px solid black"> <? echo number_format((($grand_total_cuff_tipping-$grand_total_cuff_tipping_order_qnty)/$grand_total_cuff_tipping_order_qnty)*100,2); ?></td>
    </tr>
    </table>
    </td>
    <?
    }
    ?>
    </tr>
    </table>
    <br/>
    <table  width="100%"  border="0" cellpadding="0" cellspacing="0">
    <tr>
    <td width="49%" style="border:solid; border-color:#000; border-width:thin" valign="top">
    <table  width="100%"  border="0" cellpadding="0" cellspacing="0">
    <thead>
    <tr>
    <th width="3%"></th><th width="97%" align="left"><u>Special Instruction</u></th>
    </tr>
    </thead>
    <tbody>
    <?
    $data_array=sql_select("select id, terms from  wo_booking_terms_condition where booking_no='$txt_booking_no'");
    if ( count($data_array)>0)
    {
    $i=0;
    foreach( $data_array as $row )
    {
    $i++;
    ?>
    <tr id="settr_1" valign="top">
    <td style="vertical-align:top">
    <? echo $i;?>
    </td>
    <td>
    <strong style="font-size:20px"> <? echo $row[csf('terms')]; ?></strong>
    </td>
    </tr>
    <?
    }
    }
    ?>
    </tbody>
    </table>
    </td>
    <td width="2%">
    </td>
    <td width="49%" valign="top">
    <table  width="100%"  border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all">
    <tr align="center">
    <td><b>Approved Instructions</b></td>
    </tr>
    <tr>
    <td>
    <?  echo $nameArray_approved_comments_row[csf('comments')];  ?>
    </td>
    </tr>
    </table>
    <br />
    </td>
    </tr>
    </table>
    <br>
    <?
    //------------------------------ Query for TNA start-----------------------------------
    $po_id_all=str_replace("'","",$txt_order_no_id);
    $po_num_arr=return_library_array("select id,po_number from wo_po_break_down where id in($po_id_all)",'id','po_number');
    $tna_start_sql=sql_select( "SELECT id,po_number_id,
    (case when task_number=31 then task_start_date else null end) as fab_booking_start_date,
    (case when task_number=31 then task_finish_date else null end) as fab_booking_end_date,
    (case when task_number=60 then task_start_date else null end) as knitting_start_date,
    (case when task_number=60 then task_finish_date else null end) as knitting_end_date,
    (case when task_number=61 then task_start_date else null end) as dying_start_date,
    (case when task_number=61 then task_finish_date else null end) as dying_end_date,
    (case when task_number=73 then task_start_date else null end) as finishing_start_date,
    (case when task_number=73 then task_finish_date else null end) as finishing_end_date,
    (case when task_number=84 then task_start_date else null end) as cutting_start_date,
    (case when task_number=84 then task_finish_date else null end) as cutting_end_date,
    (case when task_number=86 then task_start_date else null end) as sewing_start_date,
    (case when task_number=86 then task_finish_date else null end) as sewing_end_date,
    (case when task_number=110 then task_start_date else null end) as exfact_start_date,
    (case when task_number=110 then task_finish_date else null end) as exfact_end_date,
    (case when task_number=47 then task_start_date else null end) as yarn_rec_start_date,
    (case when task_number=47 then task_finish_date else null end) as yarn_rec_end_date
    from tna_process_mst
    where status_active=1 and po_number_id in($po_id_all)");
    $tna_fab_start=$tna_knit_start=$tna_dyeing_start=$tna_fin_start=$tna_cut_start=$tna_sewin_start=$tna_exfact_start="";
    $tna_date_task_arr=array();
    foreach($tna_start_sql as $row)
    {
    if($row[csf("fab_booking_start_date")]!="" && $row[csf("fab_booking_start_date")]!="0000-00-00")
    {
    if($tna_fab_start=="")
    {
    $tna_fab_start=$row[csf("fab_booking_start_date")];
    }
    }
    if($row[csf("knitting_start_date")]!="" && $row[csf("knitting_start_date")]!="0000-00-00")
    {
    $tna_date_task_arr[$row[csf("po_number_id")]]['knitting_start_date']=$row[csf("knitting_start_date")];
    $tna_date_task_arr[$row[csf("po_number_id")]]['knitting_end_date']=$row[csf("knitting_end_date")];
    }
    if($row[csf("dying_start_date")]!="" && $row[csf("dying_start_date")]!="0000-00-00")
    {
    $tna_date_task_arr[$row[csf("po_number_id")]]['dying_start_date']=$row[csf("dying_start_date")];
    $tna_date_task_arr[$row[csf("po_number_id")]]['dying_end_date']=$row[csf("dying_end_date")];
    }
    if($row[csf("finishing_start_date")]!="" && $row[csf("finishing_start_date")]!="0000-00-00")
    {
    $tna_date_task_arr[$row[csf("po_number_id")]]['finishing_start_date']=$row[csf("finishing_start_date")];
    $tna_date_task_arr[$row[csf("po_number_id")]]['finishing_end_date']=$row[csf("finishing_end_date")];
    }
    if($row[csf("cutting_start_date")]!="" && $row[csf("cutting_start_date")]!="0000-00-00")
    {
    $tna_date_task_arr[$row[csf("po_number_id")]]['cutting_start_date']=$row[csf("cutting_start_date")];
    $tna_date_task_arr[$row[csf("po_number_id")]]['cutting_end_date']=$row[csf("cutting_end_date")];
    }
    if($row[csf("sewing_start_date")]!="" && $row[csf("sewing_start_date")]!="0000-00-00")
    {
    $tna_date_task_arr[$row[csf("po_number_id")]]['sewing_start_date']=$row[csf("sewing_start_date")];
    $tna_date_task_arr[$row[csf("po_number_id")]]['sewing_end_date']=$row[csf("sewing_end_date")];
    }
    if($row[csf("exfact_start_date")]!="" && $row[csf("exfact_start_date")]!="0000-00-00")
    {
    $tna_date_task_arr[$row[csf("po_number_id")]]['exfact_start_date']=$row[csf("exfact_start_date")];
    $tna_date_task_arr[$row[csf("po_number_id")]]['exfact_end_date']=$row[csf("exfact_end_date")];
    }
    if($row[csf("yarn_rec_start_date")]!="" && $row[csf("yarn_rec_start_date")]!="0000-00-00")
    {
    $tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_start_date']=$row[csf("yarn_rec_start_date")];
    $tna_date_task_arr[$row[csf("po_number_id")]]['yarn_rec_end_date']=$row[csf("yarn_rec_end_date")];
    }
    }
    //------------------------------ Query for TNA end-----------------------------------
    ?>
    <fieldset id="div_size_color_matrix" style="max-width:1000; display:none">
    <legend>TNA Information</legend>
    <table width="100%" style="border:1px solid black;font-size:12px" border="1" cellpadding="2" cellspacing="0" rules="all">
    <tr>
    <td rowspan="2" align="center" valign="top">SL</td>
    <td width="180" rowspan="2"  align="center" valign="top"><b>Order No</b></td>
    <td colspan="2" align="center" valign="top"><b>Yarn Receive</b></td>
    <td colspan="2" align="center" valign="top"><b>Knitting</b></td>
    <td colspan="2" align="center" valign="top"><b>Dyeing</b></td>
    <td colspan="2" align="center" valign="top"><b>Finishing Fabric</b></td>
    <td colspan="2" align="center" valign="top"><b>Cutting </b></td>
    <td colspan="2" align="center" valign="top"><b>Sewing </b></td>
    <td colspan="2"  align="center" valign="top"><b>Ex-factory </b></td>
    </tr>
    <tr>
    <td width="85" align="center" valign="top"><b>Start Date</b></td>
    <td width="85" align="center" valign="top"><b>End Date</b></td>
    <td width="85" align="center" valign="top"><b>Start Date</b></td>
    <td width="85" align="center" valign="top"><b>End Date</b></td>
    <td width="85" align="center" valign="top"><b>Start Date</b></td>
    <td width="85" align="center" valign="top"><b>End Date</b></td>
    <td width="85" align="center" valign="top"><b>Start Date</b></td>
    <td width="85" align="center" valign="top"><b>End Date</b></td>
    <td width="85" align="center" valign="top"><b>Start Date</b></td>
    <td width="85" align="center" valign="top"><b>End Date</b></td>
    <td width="85" align="center" valign="top"><b>Start Date</b></td>
    <td width="85" align="center" valign="top"><b>End Date</b></td>
    <td width="85" align="center" valign="top"><b>Start Date</b></td>
    <td width="85" align="center" valign="top"><b>End Date</b></td>
    </tr>
    <?
    $i=1;
    foreach($tna_date_task_arr as $order_id=>$row)
    {
        ?>
        <tr>
        <td><? echo $i; ?></td>
        <td><? echo $po_num_arr[$order_id]; ?></td>
        <td align="center"><? echo change_date_format($row['yarn_rec_start_date']); ?></td>
        <td  align="center"><? echo change_date_format($row['yarn_rec_end_date']); ?></td>
        <td align="center"><? echo change_date_format($row['knitting_start_date']); ?></td>
        <td  align="center"><? echo change_date_format($row['knitting_end_date']); ?></td>
        <td align="center"><? echo change_date_format($row['dying_start_date']); ?></td>
        <td align="center"><? echo change_date_format($row['dying_end_date']); ?></td>
        <td align="center"><? echo change_date_format($row['finishing_start_date']); ?></td>
        <td align="center"><? echo change_date_format($row['finishing_end_date']); ?></td>
        <td align="center"><? echo change_date_format($row['cutting_start_date']); ?></td>
        <td align="center"><? echo change_date_format($row['cutting_end_date']); ?></td>
        <td align="center"><? echo change_date_format($row['sewing_start_date']); ?></td>
        <td align="center"><? echo change_date_format($row['sewing_end_date']); ?></td>
        <td align="center"><? echo change_date_format($row['exfact_start_date']); ?></td>
        <td align="center"><? echo change_date_format($row['exfact_end_date']); ?></td>
        </tr>
        <?
        $i++;
    }
    ?>
    </table>
    </fieldset>
    <?
    }// fabric Source End
    ?>
    <?
    //echo signature_table(1, $cbo_company_name, "1330px");
    echo signature_table(121, $cbo_company_name, "1330px", 1);
    echo "****".custom_file_name($txt_booking_no,$style_sting,$job_no);
    ?>
    </div>
    <?
}
?>	
